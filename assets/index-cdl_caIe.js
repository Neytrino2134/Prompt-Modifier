(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function o(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=o(a);fetch(a.href,i)}})();var Yi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Hu(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var U0={exports:{}},Ml={},V0={exports:{}},Rt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hi=Symbol.for("react.element"),Nv=Symbol.for("react.portal"),Ev=Symbol.for("react.fragment"),Pv=Symbol.for("react.strict_mode"),jv=Symbol.for("react.profiler"),Iv=Symbol.for("react.provider"),Tv=Symbol.for("react.context"),Av=Symbol.for("react.forward_ref"),Rv=Symbol.for("react.suspense"),Mv=Symbol.for("react.memo"),Lv=Symbol.for("react.lazy"),ch=Symbol.iterator;function Dv(e){return e===null||typeof e!="object"?null:(e=ch&&e[ch]||e["@@iterator"],typeof e=="function"?e:null)}var W0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},$0=Object.assign,K0={};function Ha(e,t,o){this.props=e,this.context=t,this.refs=K0,this.updater=o||W0}Ha.prototype.isReactComponent={};Ha.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Ha.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function J0(){}J0.prototype=Ha.prototype;function Gu(e,t,o){this.props=e,this.context=t,this.refs=K0,this.updater=o||W0}var Uu=Gu.prototype=new J0;Uu.constructor=Gu;$0(Uu,Ha.prototype);Uu.isPureReactComponent=!0;var dh=Array.isArray,Y0=Object.prototype.hasOwnProperty,Vu={current:null},X0={key:!0,ref:!0,__self:!0,__source:!0};function Z0(e,t,o){var r,a={},i=null,s=null;if(t!=null)for(r in t.ref!==void 0&&(s=t.ref),t.key!==void 0&&(i=""+t.key),t)Y0.call(t,r)&&!X0.hasOwnProperty(r)&&(a[r]=t[r]);var l=arguments.length-2;if(l===1)a.children=o;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];a.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps,l)a[r]===void 0&&(a[r]=l[r]);return{$$typeof:Hi,type:e,key:i,ref:s,props:a,_owner:Vu.current}}function zv(e,t){return{$$typeof:Hi,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Wu(e){return typeof e=="object"&&e!==null&&e.$$typeof===Hi}function qv(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(o){return t[o]})}var uh=/\/+/g;function jc(e,t){return typeof e=="object"&&e!==null&&e.key!=null?qv(""+e.key):t.toString(36)}function Rs(e,t,o,r,a){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var s=!1;if(e===null)s=!0;else switch(i){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case Hi:case Nv:s=!0}}if(s)return s=e,a=a(s),e=r===""?"."+jc(s,0):r,dh(a)?(o="",e!=null&&(o=e.replace(uh,"$&/")+"/"),Rs(a,t,o,"",function(d){return d})):a!=null&&(Wu(a)&&(a=zv(a,o+(!a.key||s&&s.key===a.key?"":(""+a.key).replace(uh,"$&/")+"/")+e)),t.push(a)),1;if(s=0,r=r===""?".":r+":",dh(e))for(var l=0;l<e.length;l++){i=e[l];var c=r+jc(i,l);s+=Rs(i,t,o,c,a)}else if(c=Dv(e),typeof c=="function")for(e=c.call(e),l=0;!(i=e.next()).done;)i=i.value,c=r+jc(i,l++),s+=Rs(i,t,o,c,a);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function Xi(e,t,o){if(e==null)return e;var r=[],a=0;return Rs(e,r,"","",function(i){return t.call(o,i,a++)}),r}function Ov(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(o){(e._status===0||e._status===-1)&&(e._status=1,e._result=o)},function(o){(e._status===0||e._status===-1)&&(e._status=2,e._result=o)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var qn={current:null},Ms={transition:null},Fv={ReactCurrentDispatcher:qn,ReactCurrentBatchConfig:Ms,ReactCurrentOwner:Vu};function Q0(){throw Error("act(...) is not supported in production builds of React.")}Rt.Children={map:Xi,forEach:function(e,t,o){Xi(e,function(){t.apply(this,arguments)},o)},count:function(e){var t=0;return Xi(e,function(){t++}),t},toArray:function(e){return Xi(e,function(t){return t})||[]},only:function(e){if(!Wu(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Rt.Component=Ha;Rt.Fragment=Ev;Rt.Profiler=jv;Rt.PureComponent=Gu;Rt.StrictMode=Pv;Rt.Suspense=Rv;Rt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Fv;Rt.act=Q0;Rt.cloneElement=function(e,t,o){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=$0({},e.props),a=e.key,i=e.ref,s=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,s=Vu.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)Y0.call(t,c)&&!X0.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=o;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:Hi,type:e.type,key:a,ref:i,props:r,_owner:s}};Rt.createContext=function(e){return e={$$typeof:Tv,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Iv,_context:e},e.Consumer=e};Rt.createElement=Z0;Rt.createFactory=function(e){var t=Z0.bind(null,e);return t.type=e,t};Rt.createRef=function(){return{current:null}};Rt.forwardRef=function(e){return{$$typeof:Av,render:e}};Rt.isValidElement=Wu;Rt.lazy=function(e){return{$$typeof:Lv,_payload:{_status:-1,_result:e},_init:Ov}};Rt.memo=function(e,t){return{$$typeof:Mv,type:e,compare:t===void 0?null:t}};Rt.startTransition=function(e){var t=Ms.transition;Ms.transition={};try{e()}finally{Ms.transition=t}};Rt.unstable_act=Q0;Rt.useCallback=function(e,t){return qn.current.useCallback(e,t)};Rt.useContext=function(e){return qn.current.useContext(e)};Rt.useDebugValue=function(){};Rt.useDeferredValue=function(e){return qn.current.useDeferredValue(e)};Rt.useEffect=function(e,t){return qn.current.useEffect(e,t)};Rt.useId=function(){return qn.current.useId()};Rt.useImperativeHandle=function(e,t,o){return qn.current.useImperativeHandle(e,t,o)};Rt.useInsertionEffect=function(e,t){return qn.current.useInsertionEffect(e,t)};Rt.useLayoutEffect=function(e,t){return qn.current.useLayoutEffect(e,t)};Rt.useMemo=function(e,t){return qn.current.useMemo(e,t)};Rt.useReducer=function(e,t,o){return qn.current.useReducer(e,t,o)};Rt.useRef=function(e){return qn.current.useRef(e)};Rt.useState=function(e){return qn.current.useState(e)};Rt.useSyncExternalStore=function(e,t,o){return qn.current.useSyncExternalStore(e,t,o)};Rt.useTransition=function(){return qn.current.useTransition()};Rt.version="18.3.1";V0.exports=Rt;var y=V0.exports;const At=Hu(y);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bv=y,Hv=Symbol.for("react.element"),Gv=Symbol.for("react.fragment"),Uv=Object.prototype.hasOwnProperty,Vv=Bv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Wv={key:!0,ref:!0,__self:!0,__source:!0};function ef(e,t,o){var r,a={},i=null,s=null;o!==void 0&&(i=""+o),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(s=t.ref);for(r in t)Uv.call(t,r)&&!Wv.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:Hv,type:e,key:i,ref:s,props:a,_owner:Vv.current}}Ml.Fragment=Gv;Ml.jsx=ef;Ml.jsxs=ef;U0.exports=Ml;var n=U0.exports,wd={},tf={exports:{}},eo={},nf={exports:{}},of={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(L,W){var D=L.length;L.push(W);e:for(;0<D;){var T=D-1>>>1,F=L[T];if(0<a(F,W))L[T]=W,L[D]=F,D=T;else break e}}function o(L){return L.length===0?null:L[0]}function r(L){if(L.length===0)return null;var W=L[0],D=L.pop();if(D!==W){L[0]=D;e:for(var T=0,F=L.length,te=F>>>1;T<te;){var $=2*(T+1)-1,Y=L[$],oe=$+1,le=L[oe];if(0>a(Y,D))oe<F&&0>a(le,Y)?(L[T]=le,L[oe]=D,T=oe):(L[T]=Y,L[$]=D,T=$);else if(oe<F&&0>a(le,D))L[T]=le,L[oe]=D,T=oe;else break e}}return W}function a(L,W){var D=L.sortIndex-W.sortIndex;return D!==0?D:L.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var s=Date,l=s.now();e.unstable_now=function(){return s.now()-l}}var c=[],d=[],u=1,p=null,m=3,w=!1,k=!1,b=!1,x=typeof setTimeout=="function"?setTimeout:null,f=typeof clearTimeout=="function"?clearTimeout:null,h=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(L){for(var W=o(d);W!==null;){if(W.callback===null)r(d);else if(W.startTime<=L)r(d),W.sortIndex=W.expirationTime,t(c,W);else break;W=o(d)}}function N(L){if(b=!1,v(L),!k)if(o(c)!==null)k=!0,O(_);else{var W=o(d);W!==null&&z(N,W.startTime-L)}}function _(L,W){k=!1,b&&(b=!1,f(B),B=-1),w=!0;var D=m;try{for(v(W),p=o(c);p!==null&&(!(p.expirationTime>W)||L&&!V());){var T=p.callback;if(typeof T=="function"){p.callback=null,m=p.priorityLevel;var F=T(p.expirationTime<=W);W=e.unstable_now(),typeof F=="function"?p.callback=F:p===o(c)&&r(c),v(W)}else r(c);p=o(c)}if(p!==null)var te=!0;else{var $=o(d);$!==null&&z(N,$.startTime-W),te=!1}return te}finally{p=null,m=D,w=!1}}var E=!1,I=null,B=-1,M=5,G=-1;function V(){return!(e.unstable_now()-G<M)}function j(){if(I!==null){var L=e.unstable_now();G=L;var W=!0;try{W=I(!0,L)}finally{W?P():(E=!1,I=null)}}else E=!1}var P;if(typeof h=="function")P=function(){h(j)};else if(typeof MessageChannel<"u"){var S=new MessageChannel,A=S.port2;S.port1.onmessage=j,P=function(){A.postMessage(null)}}else P=function(){x(j,0)};function O(L){I=L,E||(E=!0,P())}function z(L,W){B=x(function(){L(e.unstable_now())},W)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(L){L.callback=null},e.unstable_continueExecution=function(){k||w||(k=!0,O(_))},e.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<L?Math.floor(1e3/L):5},e.unstable_getCurrentPriorityLevel=function(){return m},e.unstable_getFirstCallbackNode=function(){return o(c)},e.unstable_next=function(L){switch(m){case 1:case 2:case 3:var W=3;break;default:W=m}var D=m;m=W;try{return L()}finally{m=D}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(L,W){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var D=m;m=L;try{return W()}finally{m=D}},e.unstable_scheduleCallback=function(L,W,D){var T=e.unstable_now();switch(typeof D=="object"&&D!==null?(D=D.delay,D=typeof D=="number"&&0<D?T+D:T):D=T,L){case 1:var F=-1;break;case 2:F=250;break;case 5:F=1073741823;break;case 4:F=1e4;break;default:F=5e3}return F=D+F,L={id:u++,callback:W,priorityLevel:L,startTime:D,expirationTime:F,sortIndex:-1},D>T?(L.sortIndex=D,t(d,L),o(c)===null&&L===o(d)&&(b?(f(B),B=-1):b=!0,z(N,D-T))):(L.sortIndex=F,t(c,L),k||w||(k=!0,O(_))),L},e.unstable_shouldYield=V,e.unstable_wrapCallback=function(L){var W=m;return function(){var D=m;m=W;try{return L.apply(this,arguments)}finally{m=D}}}})(of);nf.exports=of;var $v=nf.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kv=y,Qn=$v;function ct(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,o=1;o<arguments.length;o++)t+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var rf=new Set,ki={};function Wr(e,t){ja(e,t),ja(e+"Capture",t)}function ja(e,t){for(ki[e]=t,e=0;e<t.length;e++)rf.add(t[e])}var Vo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),bd=Object.prototype.hasOwnProperty,Jv=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ph={},hh={};function Yv(e){return bd.call(hh,e)?!0:bd.call(ph,e)?!1:Jv.test(e)?hh[e]=!0:(ph[e]=!0,!1)}function Xv(e,t,o,r){if(o!==null&&o.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:o!==null?!o.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Zv(e,t,o,r){if(t===null||typeof t>"u"||Xv(e,t,o,r))return!0;if(r)return!1;if(o!==null)switch(o.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function On(e,t,o,r,a,i,s){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=o,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=s}var Nn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Nn[e]=new On(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Nn[t]=new On(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Nn[e]=new On(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Nn[e]=new On(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Nn[e]=new On(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Nn[e]=new On(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Nn[e]=new On(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Nn[e]=new On(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Nn[e]=new On(e,5,!1,e.toLowerCase(),null,!1,!1)});var $u=/[\-:]([a-z])/g;function Ku(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace($u,Ku);Nn[t]=new On(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace($u,Ku);Nn[t]=new On(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace($u,Ku);Nn[t]=new On(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Nn[e]=new On(e,1,!1,e.toLowerCase(),null,!1,!1)});Nn.xlinkHref=new On("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Nn[e]=new On(e,1,!1,e.toLowerCase(),null,!0,!0)});function Ju(e,t,o,r){var a=Nn.hasOwnProperty(t)?Nn[t]:null;(a!==null?a.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Zv(t,o,a,r)&&(o=null),r||a===null?Yv(t)&&(o===null?e.removeAttribute(t):e.setAttribute(t,""+o)):a.mustUseProperty?e[a.propertyName]=o===null?a.type===3?!1:"":o:(t=a.attributeName,r=a.attributeNamespace,o===null?e.removeAttribute(t):(a=a.type,o=a===3||a===4&&o===!0?"":""+o,r?e.setAttributeNS(r,t,o):e.setAttribute(t,o))))}var Yo=Kv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Zi=Symbol.for("react.element"),sa=Symbol.for("react.portal"),la=Symbol.for("react.fragment"),Yu=Symbol.for("react.strict_mode"),Cd=Symbol.for("react.profiler"),af=Symbol.for("react.provider"),sf=Symbol.for("react.context"),Xu=Symbol.for("react.forward_ref"),kd=Symbol.for("react.suspense"),_d=Symbol.for("react.suspense_list"),Zu=Symbol.for("react.memo"),sr=Symbol.for("react.lazy"),lf=Symbol.for("react.offscreen"),mh=Symbol.iterator;function Za(e){return e===null||typeof e!="object"?null:(e=mh&&e[mh]||e["@@iterator"],typeof e=="function"?e:null)}var on=Object.assign,Ic;function li(e){if(Ic===void 0)try{throw Error()}catch(o){var t=o.stack.trim().match(/\n( *(at )?)/);Ic=t&&t[1]||""}return`
`+Ic+e}var Tc=!1;function Ac(e,t){if(!e||Tc)return"";Tc=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var r=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){r=d}e.call(t.prototype)}else{try{throw Error()}catch(d){r=d}e()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var a=d.stack.split(`
`),i=r.stack.split(`
`),s=a.length-1,l=i.length-1;1<=s&&0<=l&&a[s]!==i[l];)l--;for(;1<=s&&0<=l;s--,l--)if(a[s]!==i[l]){if(s!==1||l!==1)do if(s--,l--,0>l||a[s]!==i[l]){var c=`
`+a[s].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=s&&0<=l);break}}}finally{Tc=!1,Error.prepareStackTrace=o}return(e=e?e.displayName||e.name:"")?li(e):""}function Qv(e){switch(e.tag){case 5:return li(e.type);case 16:return li("Lazy");case 13:return li("Suspense");case 19:return li("SuspenseList");case 0:case 2:case 15:return e=Ac(e.type,!1),e;case 11:return e=Ac(e.type.render,!1),e;case 1:return e=Ac(e.type,!0),e;default:return""}}function Sd(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case la:return"Fragment";case sa:return"Portal";case Cd:return"Profiler";case Yu:return"StrictMode";case kd:return"Suspense";case _d:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case sf:return(e.displayName||"Context")+".Consumer";case af:return(e._context.displayName||"Context")+".Provider";case Xu:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Zu:return t=e.displayName||null,t!==null?t:Sd(e.type)||"Memo";case sr:t=e._payload,e=e._init;try{return Sd(e(t))}catch{}}return null}function e2(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Sd(t);case 8:return t===Yu?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function br(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function cf(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function t2(e){var t=cf(e)?"checked":"value",o=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var a=o.get,i=o.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(s){r=""+s,i.call(this,s)}}),Object.defineProperty(e,t,{enumerable:o.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Qi(e){e._valueTracker||(e._valueTracker=t2(e))}function df(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var o=t.getValue(),r="";return e&&(r=cf(e)?e.checked?"true":"false":e.value),e=r,e!==o?(t.setValue(e),!0):!1}function Qs(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Nd(e,t){var o=t.checked;return on({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??e._wrapperState.initialChecked})}function gh(e,t){var o=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;o=br(t.value!=null?t.value:o),e._wrapperState={initialChecked:r,initialValue:o,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function uf(e,t){t=t.checked,t!=null&&Ju(e,"checked",t,!1)}function Ed(e,t){uf(e,t);var o=br(t.value),r=t.type;if(o!=null)r==="number"?(o===0&&e.value===""||e.value!=o)&&(e.value=""+o):e.value!==""+o&&(e.value=""+o);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Pd(e,t.type,o):t.hasOwnProperty("defaultValue")&&Pd(e,t.type,br(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function fh(e,t,o){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,o||t===e.value||(e.value=t),e.defaultValue=t}o=e.name,o!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,o!==""&&(e.name=o)}function Pd(e,t,o){(t!=="number"||Qs(e.ownerDocument)!==e)&&(o==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+o&&(e.defaultValue=""+o))}var ci=Array.isArray;function ba(e,t,o,r){if(e=e.options,t){t={};for(var a=0;a<o.length;a++)t["$"+o[a]]=!0;for(o=0;o<e.length;o++)a=t.hasOwnProperty("$"+e[o].value),e[o].selected!==a&&(e[o].selected=a),a&&r&&(e[o].defaultSelected=!0)}else{for(o=""+br(o),t=null,a=0;a<e.length;a++){if(e[a].value===o){e[a].selected=!0,r&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function jd(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(ct(91));return on({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function xh(e,t){var o=t.value;if(o==null){if(o=t.children,t=t.defaultValue,o!=null){if(t!=null)throw Error(ct(92));if(ci(o)){if(1<o.length)throw Error(ct(93));o=o[0]}t=o}t==null&&(t=""),o=t}e._wrapperState={initialValue:br(o)}}function pf(e,t){var o=br(t.value),r=br(t.defaultValue);o!=null&&(o=""+o,o!==e.value&&(e.value=o),t.defaultValue==null&&e.defaultValue!==o&&(e.defaultValue=o)),r!=null&&(e.defaultValue=""+r)}function yh(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function hf(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Id(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?hf(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var es,mf=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,o,r,a){MSApp.execUnsafeLocalFunction(function(){return e(t,o,r,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(es=es||document.createElement("div"),es.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=es.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function _i(e,t){if(t){var o=e.firstChild;if(o&&o===e.lastChild&&o.nodeType===3){o.nodeValue=t;return}}e.textContent=t}var mi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},n2=["Webkit","ms","Moz","O"];Object.keys(mi).forEach(function(e){n2.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),mi[t]=mi[e]})});function gf(e,t,o){return t==null||typeof t=="boolean"||t===""?"":o||typeof t!="number"||t===0||mi.hasOwnProperty(e)&&mi[e]?(""+t).trim():t+"px"}function ff(e,t){e=e.style;for(var o in t)if(t.hasOwnProperty(o)){var r=o.indexOf("--")===0,a=gf(o,t[o],r);o==="float"&&(o="cssFloat"),r?e.setProperty(o,a):e[o]=a}}var o2=on({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Td(e,t){if(t){if(o2[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(ct(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(ct(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(ct(61))}if(t.style!=null&&typeof t.style!="object")throw Error(ct(62))}}function Ad(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Rd=null;function Qu(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Md=null,Ca=null,ka=null;function vh(e){if(e=Vi(e)){if(typeof Md!="function")throw Error(ct(280));var t=e.stateNode;t&&(t=Ol(t),Md(e.stateNode,e.type,t))}}function xf(e){Ca?ka?ka.push(e):ka=[e]:Ca=e}function yf(){if(Ca){var e=Ca,t=ka;if(ka=Ca=null,vh(e),t)for(e=0;e<t.length;e++)vh(t[e])}}function vf(e,t){return e(t)}function wf(){}var Rc=!1;function bf(e,t,o){if(Rc)return e(t,o);Rc=!0;try{return vf(e,t,o)}finally{Rc=!1,(Ca!==null||ka!==null)&&(wf(),yf())}}function Si(e,t){var o=e.stateNode;if(o===null)return null;var r=Ol(o);if(r===null)return null;o=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(o&&typeof o!="function")throw Error(ct(231,t,typeof o));return o}var Ld=!1;if(Vo)try{var Qa={};Object.defineProperty(Qa,"passive",{get:function(){Ld=!0}}),window.addEventListener("test",Qa,Qa),window.removeEventListener("test",Qa,Qa)}catch{Ld=!1}function r2(e,t,o,r,a,i,s,l,c){var d=Array.prototype.slice.call(arguments,3);try{t.apply(o,d)}catch(u){this.onError(u)}}var gi=!1,el=null,tl=!1,Dd=null,a2={onError:function(e){gi=!0,el=e}};function i2(e,t,o,r,a,i,s,l,c){gi=!1,el=null,r2.apply(a2,arguments)}function s2(e,t,o,r,a,i,s,l,c){if(i2.apply(this,arguments),gi){if(gi){var d=el;gi=!1,el=null}else throw Error(ct(198));tl||(tl=!0,Dd=d)}}function $r(e){var t=e,o=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(o=t.return),e=t.return;while(e)}return t.tag===3?o:null}function Cf(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function wh(e){if($r(e)!==e)throw Error(ct(188))}function l2(e){var t=e.alternate;if(!t){if(t=$r(e),t===null)throw Error(ct(188));return t!==e?null:e}for(var o=e,r=t;;){var a=o.return;if(a===null)break;var i=a.alternate;if(i===null){if(r=a.return,r!==null){o=r;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===o)return wh(a),e;if(i===r)return wh(a),t;i=i.sibling}throw Error(ct(188))}if(o.return!==r.return)o=a,r=i;else{for(var s=!1,l=a.child;l;){if(l===o){s=!0,o=a,r=i;break}if(l===r){s=!0,r=a,o=i;break}l=l.sibling}if(!s){for(l=i.child;l;){if(l===o){s=!0,o=i,r=a;break}if(l===r){s=!0,r=i,o=a;break}l=l.sibling}if(!s)throw Error(ct(189))}}if(o.alternate!==r)throw Error(ct(190))}if(o.tag!==3)throw Error(ct(188));return o.stateNode.current===o?e:t}function kf(e){return e=l2(e),e!==null?_f(e):null}function _f(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=_f(e);if(t!==null)return t;e=e.sibling}return null}var Sf=Qn.unstable_scheduleCallback,bh=Qn.unstable_cancelCallback,c2=Qn.unstable_shouldYield,d2=Qn.unstable_requestPaint,ln=Qn.unstable_now,u2=Qn.unstable_getCurrentPriorityLevel,ep=Qn.unstable_ImmediatePriority,Nf=Qn.unstable_UserBlockingPriority,nl=Qn.unstable_NormalPriority,p2=Qn.unstable_LowPriority,Ef=Qn.unstable_IdlePriority,Ll=null,Ro=null;function h2(e){if(Ro&&typeof Ro.onCommitFiberRoot=="function")try{Ro.onCommitFiberRoot(Ll,e,void 0,(e.current.flags&128)===128)}catch{}}var yo=Math.clz32?Math.clz32:f2,m2=Math.log,g2=Math.LN2;function f2(e){return e>>>=0,e===0?32:31-(m2(e)/g2|0)|0}var ts=64,ns=4194304;function di(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ol(e,t){var o=e.pendingLanes;if(o===0)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,s=o&268435455;if(s!==0){var l=s&~a;l!==0?r=di(l):(i&=s,i!==0&&(r=di(i)))}else s=o&~a,s!==0?r=di(s):i!==0&&(r=di(i));if(r===0)return 0;if(t!==0&&t!==r&&!(t&a)&&(a=r&-r,i=t&-t,a>=i||a===16&&(i&4194240)!==0))return t;if(r&4&&(r|=o&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)o=31-yo(t),a=1<<o,r|=e[o],t&=~a;return r}function x2(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function y2(e,t){for(var o=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var s=31-yo(i),l=1<<s,c=a[s];c===-1?(!(l&o)||l&r)&&(a[s]=x2(l,t)):c<=t&&(e.expiredLanes|=l),i&=~l}}function zd(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Pf(){var e=ts;return ts<<=1,!(ts&4194240)&&(ts=64),e}function Mc(e){for(var t=[],o=0;31>o;o++)t.push(e);return t}function Gi(e,t,o){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-yo(t),e[t]=o}function v2(e,t){var o=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<o;){var a=31-yo(o),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,o&=~i}}function tp(e,t){var o=e.entangledLanes|=t;for(e=e.entanglements;o;){var r=31-yo(o),a=1<<r;a&t|e[r]&t&&(e[r]|=t),o&=~a}}var Vt=0;function jf(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var If,np,Tf,Af,Rf,qd=!1,os=[],hr=null,mr=null,gr=null,Ni=new Map,Ei=new Map,cr=[],w2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ch(e,t){switch(e){case"focusin":case"focusout":hr=null;break;case"dragenter":case"dragleave":mr=null;break;case"mouseover":case"mouseout":gr=null;break;case"pointerover":case"pointerout":Ni.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ei.delete(t.pointerId)}}function ei(e,t,o,r,a,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:o,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},t!==null&&(t=Vi(t),t!==null&&np(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function b2(e,t,o,r,a){switch(t){case"focusin":return hr=ei(hr,e,t,o,r,a),!0;case"dragenter":return mr=ei(mr,e,t,o,r,a),!0;case"mouseover":return gr=ei(gr,e,t,o,r,a),!0;case"pointerover":var i=a.pointerId;return Ni.set(i,ei(Ni.get(i)||null,e,t,o,r,a)),!0;case"gotpointercapture":return i=a.pointerId,Ei.set(i,ei(Ei.get(i)||null,e,t,o,r,a)),!0}return!1}function Mf(e){var t=Rr(e.target);if(t!==null){var o=$r(t);if(o!==null){if(t=o.tag,t===13){if(t=Cf(o),t!==null){e.blockedOn=t,Rf(e.priority,function(){Tf(o)});return}}else if(t===3&&o.stateNode.current.memoizedState.isDehydrated){e.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Ls(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var o=Od(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(o===null){o=e.nativeEvent;var r=new o.constructor(o.type,o);Rd=r,o.target.dispatchEvent(r),Rd=null}else return t=Vi(o),t!==null&&np(t),e.blockedOn=o,!1;t.shift()}return!0}function kh(e,t,o){Ls(e)&&o.delete(t)}function C2(){qd=!1,hr!==null&&Ls(hr)&&(hr=null),mr!==null&&Ls(mr)&&(mr=null),gr!==null&&Ls(gr)&&(gr=null),Ni.forEach(kh),Ei.forEach(kh)}function ti(e,t){e.blockedOn===t&&(e.blockedOn=null,qd||(qd=!0,Qn.unstable_scheduleCallback(Qn.unstable_NormalPriority,C2)))}function Pi(e){function t(a){return ti(a,e)}if(0<os.length){ti(os[0],e);for(var o=1;o<os.length;o++){var r=os[o];r.blockedOn===e&&(r.blockedOn=null)}}for(hr!==null&&ti(hr,e),mr!==null&&ti(mr,e),gr!==null&&ti(gr,e),Ni.forEach(t),Ei.forEach(t),o=0;o<cr.length;o++)r=cr[o],r.blockedOn===e&&(r.blockedOn=null);for(;0<cr.length&&(o=cr[0],o.blockedOn===null);)Mf(o),o.blockedOn===null&&cr.shift()}var _a=Yo.ReactCurrentBatchConfig,rl=!0;function k2(e,t,o,r){var a=Vt,i=_a.transition;_a.transition=null;try{Vt=1,op(e,t,o,r)}finally{Vt=a,_a.transition=i}}function _2(e,t,o,r){var a=Vt,i=_a.transition;_a.transition=null;try{Vt=4,op(e,t,o,r)}finally{Vt=a,_a.transition=i}}function op(e,t,o,r){if(rl){var a=Od(e,t,o,r);if(a===null)Uc(e,t,r,al,o),Ch(e,r);else if(b2(a,e,t,o,r))r.stopPropagation();else if(Ch(e,r),t&4&&-1<w2.indexOf(e)){for(;a!==null;){var i=Vi(a);if(i!==null&&If(i),i=Od(e,t,o,r),i===null&&Uc(e,t,r,al,o),i===a)break;a=i}a!==null&&r.stopPropagation()}else Uc(e,t,r,null,o)}}var al=null;function Od(e,t,o,r){if(al=null,e=Qu(r),e=Rr(e),e!==null)if(t=$r(e),t===null)e=null;else if(o=t.tag,o===13){if(e=Cf(t),e!==null)return e;e=null}else if(o===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return al=e,null}function Lf(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(u2()){case ep:return 1;case Nf:return 4;case nl:case p2:return 16;case Ef:return 536870912;default:return 16}default:return 16}}var ur=null,rp=null,Ds=null;function Df(){if(Ds)return Ds;var e,t=rp,o=t.length,r,a="value"in ur?ur.value:ur.textContent,i=a.length;for(e=0;e<o&&t[e]===a[e];e++);var s=o-e;for(r=1;r<=s&&t[o-r]===a[i-r];r++);return Ds=a.slice(e,1<r?1-r:void 0)}function zs(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function rs(){return!0}function _h(){return!1}function to(e){function t(o,r,a,i,s){this._reactName=o,this._targetInst=a,this.type=r,this.nativeEvent=i,this.target=s,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(o=e[l],this[l]=o?o(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?rs:_h,this.isPropagationStopped=_h,this}return on(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=rs)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=rs)},persist:function(){},isPersistent:rs}),t}var Ga={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ap=to(Ga),Ui=on({},Ga,{view:0,detail:0}),S2=to(Ui),Lc,Dc,ni,Dl=on({},Ui,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ip,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ni&&(ni&&e.type==="mousemove"?(Lc=e.screenX-ni.screenX,Dc=e.screenY-ni.screenY):Dc=Lc=0,ni=e),Lc)},movementY:function(e){return"movementY"in e?e.movementY:Dc}}),Sh=to(Dl),N2=on({},Dl,{dataTransfer:0}),E2=to(N2),P2=on({},Ui,{relatedTarget:0}),zc=to(P2),j2=on({},Ga,{animationName:0,elapsedTime:0,pseudoElement:0}),I2=to(j2),T2=on({},Ga,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),A2=to(T2),R2=on({},Ga,{data:0}),Nh=to(R2),M2={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},L2={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},D2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function z2(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=D2[e])?!!t[e]:!1}function ip(){return z2}var q2=on({},Ui,{key:function(e){if(e.key){var t=M2[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=zs(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?L2[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ip,charCode:function(e){return e.type==="keypress"?zs(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?zs(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),O2=to(q2),F2=on({},Dl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Eh=to(F2),B2=on({},Ui,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ip}),H2=to(B2),G2=on({},Ga,{propertyName:0,elapsedTime:0,pseudoElement:0}),U2=to(G2),V2=on({},Dl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),W2=to(V2),$2=[9,13,27,32],sp=Vo&&"CompositionEvent"in window,fi=null;Vo&&"documentMode"in document&&(fi=document.documentMode);var K2=Vo&&"TextEvent"in window&&!fi,zf=Vo&&(!sp||fi&&8<fi&&11>=fi),Ph=" ",jh=!1;function qf(e,t){switch(e){case"keyup":return $2.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Of(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ca=!1;function J2(e,t){switch(e){case"compositionend":return Of(t);case"keypress":return t.which!==32?null:(jh=!0,Ph);case"textInput":return e=t.data,e===Ph&&jh?null:e;default:return null}}function Y2(e,t){if(ca)return e==="compositionend"||!sp&&qf(e,t)?(e=Df(),Ds=rp=ur=null,ca=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return zf&&t.locale!=="ko"?null:t.data;default:return null}}var X2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ih(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!X2[e.type]:t==="textarea"}function Ff(e,t,o,r){xf(r),t=il(t,"onChange"),0<t.length&&(o=new ap("onChange","change",null,o,r),e.push({event:o,listeners:t}))}var xi=null,ji=null;function Z2(e){Xf(e,0)}function zl(e){var t=pa(e);if(df(t))return e}function Q2(e,t){if(e==="change")return t}var Bf=!1;if(Vo){var qc;if(Vo){var Oc="oninput"in document;if(!Oc){var Th=document.createElement("div");Th.setAttribute("oninput","return;"),Oc=typeof Th.oninput=="function"}qc=Oc}else qc=!1;Bf=qc&&(!document.documentMode||9<document.documentMode)}function Ah(){xi&&(xi.detachEvent("onpropertychange",Hf),ji=xi=null)}function Hf(e){if(e.propertyName==="value"&&zl(ji)){var t=[];Ff(t,ji,e,Qu(e)),bf(Z2,t)}}function ew(e,t,o){e==="focusin"?(Ah(),xi=t,ji=o,xi.attachEvent("onpropertychange",Hf)):e==="focusout"&&Ah()}function tw(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return zl(ji)}function nw(e,t){if(e==="click")return zl(t)}function ow(e,t){if(e==="input"||e==="change")return zl(t)}function rw(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Co=typeof Object.is=="function"?Object.is:rw;function Ii(e,t){if(Co(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var o=Object.keys(e),r=Object.keys(t);if(o.length!==r.length)return!1;for(r=0;r<o.length;r++){var a=o[r];if(!bd.call(t,a)||!Co(e[a],t[a]))return!1}return!0}function Rh(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Mh(e,t){var o=Rh(e);e=0;for(var r;o;){if(o.nodeType===3){if(r=e+o.textContent.length,e<=t&&r>=t)return{node:o,offset:t-e};e=r}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=Rh(o)}}function Gf(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Gf(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Uf(){for(var e=window,t=Qs();t instanceof e.HTMLIFrameElement;){try{var o=typeof t.contentWindow.location.href=="string"}catch{o=!1}if(o)e=t.contentWindow;else break;t=Qs(e.document)}return t}function lp(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function aw(e){var t=Uf(),o=e.focusedElem,r=e.selectionRange;if(t!==o&&o&&o.ownerDocument&&Gf(o.ownerDocument.documentElement,o)){if(r!==null&&lp(o)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in o)o.selectionStart=t,o.selectionEnd=Math.min(e,o.value.length);else if(e=(t=o.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=o.textContent.length,i=Math.min(r.start,a);r=r.end===void 0?i:Math.min(r.end,a),!e.extend&&i>r&&(a=r,r=i,i=a),a=Mh(o,i);var s=Mh(o,r);a&&s&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}}for(t=[],e=o;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<t.length;o++)e=t[o],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var iw=Vo&&"documentMode"in document&&11>=document.documentMode,da=null,Fd=null,yi=null,Bd=!1;function Lh(e,t,o){var r=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Bd||da==null||da!==Qs(r)||(r=da,"selectionStart"in r&&lp(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),yi&&Ii(yi,r)||(yi=r,r=il(Fd,"onSelect"),0<r.length&&(t=new ap("onSelect","select",null,t,o),e.push({event:t,listeners:r}),t.target=da)))}function as(e,t){var o={};return o[e.toLowerCase()]=t.toLowerCase(),o["Webkit"+e]="webkit"+t,o["Moz"+e]="moz"+t,o}var ua={animationend:as("Animation","AnimationEnd"),animationiteration:as("Animation","AnimationIteration"),animationstart:as("Animation","AnimationStart"),transitionend:as("Transition","TransitionEnd")},Fc={},Vf={};Vo&&(Vf=document.createElement("div").style,"AnimationEvent"in window||(delete ua.animationend.animation,delete ua.animationiteration.animation,delete ua.animationstart.animation),"TransitionEvent"in window||delete ua.transitionend.transition);function ql(e){if(Fc[e])return Fc[e];if(!ua[e])return e;var t=ua[e],o;for(o in t)if(t.hasOwnProperty(o)&&o in Vf)return Fc[e]=t[o];return e}var Wf=ql("animationend"),$f=ql("animationiteration"),Kf=ql("animationstart"),Jf=ql("transitionend"),Yf=new Map,Dh="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _r(e,t){Yf.set(e,t),Wr(t,[e])}for(var Bc=0;Bc<Dh.length;Bc++){var Hc=Dh[Bc],sw=Hc.toLowerCase(),lw=Hc[0].toUpperCase()+Hc.slice(1);_r(sw,"on"+lw)}_r(Wf,"onAnimationEnd");_r($f,"onAnimationIteration");_r(Kf,"onAnimationStart");_r("dblclick","onDoubleClick");_r("focusin","onFocus");_r("focusout","onBlur");_r(Jf,"onTransitionEnd");ja("onMouseEnter",["mouseout","mouseover"]);ja("onMouseLeave",["mouseout","mouseover"]);ja("onPointerEnter",["pointerout","pointerover"]);ja("onPointerLeave",["pointerout","pointerover"]);Wr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wr("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ui="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),cw=new Set("cancel close invalid load scroll toggle".split(" ").concat(ui));function zh(e,t,o){var r=e.type||"unknown-event";e.currentTarget=o,s2(r,t,void 0,e),e.currentTarget=null}function Xf(e,t){t=(t&4)!==0;for(var o=0;o<e.length;o++){var r=e[o],a=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var s=r.length-1;0<=s;s--){var l=r[s],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&a.isPropagationStopped())break e;zh(a,l,d),i=c}else for(s=0;s<r.length;s++){if(l=r[s],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&a.isPropagationStopped())break e;zh(a,l,d),i=c}}}if(tl)throw e=Dd,tl=!1,Dd=null,e}function Zt(e,t){var o=t[Wd];o===void 0&&(o=t[Wd]=new Set);var r=e+"__bubble";o.has(r)||(Zf(t,e,2,!1),o.add(r))}function Gc(e,t,o){var r=0;t&&(r|=4),Zf(o,e,r,t)}var is="_reactListening"+Math.random().toString(36).slice(2);function Ti(e){if(!e[is]){e[is]=!0,rf.forEach(function(o){o!=="selectionchange"&&(cw.has(o)||Gc(o,!1,e),Gc(o,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[is]||(t[is]=!0,Gc("selectionchange",!1,t))}}function Zf(e,t,o,r){switch(Lf(t)){case 1:var a=k2;break;case 4:a=_2;break;default:a=op}o=a.bind(null,t,o,e),a=void 0,!Ld||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),r?a!==void 0?e.addEventListener(t,o,{capture:!0,passive:a}):e.addEventListener(t,o,!0):a!==void 0?e.addEventListener(t,o,{passive:a}):e.addEventListener(t,o,!1)}function Uc(e,t,o,r,a){var i=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var l=r.stateNode.containerInfo;if(l===a||l.nodeType===8&&l.parentNode===a)break;if(s===4)for(s=r.return;s!==null;){var c=s.tag;if((c===3||c===4)&&(c=s.stateNode.containerInfo,c===a||c.nodeType===8&&c.parentNode===a))return;s=s.return}for(;l!==null;){if(s=Rr(l),s===null)return;if(c=s.tag,c===5||c===6){r=i=s;continue e}l=l.parentNode}}r=r.return}bf(function(){var d=i,u=Qu(o),p=[];e:{var m=Yf.get(e);if(m!==void 0){var w=ap,k=e;switch(e){case"keypress":if(zs(o)===0)break e;case"keydown":case"keyup":w=O2;break;case"focusin":k="focus",w=zc;break;case"focusout":k="blur",w=zc;break;case"beforeblur":case"afterblur":w=zc;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":w=Sh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":w=E2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":w=H2;break;case Wf:case $f:case Kf:w=I2;break;case Jf:w=U2;break;case"scroll":w=S2;break;case"wheel":w=W2;break;case"copy":case"cut":case"paste":w=A2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":w=Eh}var b=(t&4)!==0,x=!b&&e==="scroll",f=b?m!==null?m+"Capture":null:m;b=[];for(var h=d,v;h!==null;){v=h;var N=v.stateNode;if(v.tag===5&&N!==null&&(v=N,f!==null&&(N=Si(h,f),N!=null&&b.push(Ai(h,N,v)))),x)break;h=h.return}0<b.length&&(m=new w(m,k,null,o,u),p.push({event:m,listeners:b}))}}if(!(t&7)){e:{if(m=e==="mouseover"||e==="pointerover",w=e==="mouseout"||e==="pointerout",m&&o!==Rd&&(k=o.relatedTarget||o.fromElement)&&(Rr(k)||k[Wo]))break e;if((w||m)&&(m=u.window===u?u:(m=u.ownerDocument)?m.defaultView||m.parentWindow:window,w?(k=o.relatedTarget||o.toElement,w=d,k=k?Rr(k):null,k!==null&&(x=$r(k),k!==x||k.tag!==5&&k.tag!==6)&&(k=null)):(w=null,k=d),w!==k)){if(b=Sh,N="onMouseLeave",f="onMouseEnter",h="mouse",(e==="pointerout"||e==="pointerover")&&(b=Eh,N="onPointerLeave",f="onPointerEnter",h="pointer"),x=w==null?m:pa(w),v=k==null?m:pa(k),m=new b(N,h+"leave",w,o,u),m.target=x,m.relatedTarget=v,N=null,Rr(u)===d&&(b=new b(f,h+"enter",k,o,u),b.target=v,b.relatedTarget=x,N=b),x=N,w&&k)t:{for(b=w,f=k,h=0,v=b;v;v=Jr(v))h++;for(v=0,N=f;N;N=Jr(N))v++;for(;0<h-v;)b=Jr(b),h--;for(;0<v-h;)f=Jr(f),v--;for(;h--;){if(b===f||f!==null&&b===f.alternate)break t;b=Jr(b),f=Jr(f)}b=null}else b=null;w!==null&&qh(p,m,w,b,!1),k!==null&&x!==null&&qh(p,x,k,b,!0)}}e:{if(m=d?pa(d):window,w=m.nodeName&&m.nodeName.toLowerCase(),w==="select"||w==="input"&&m.type==="file")var _=Q2;else if(Ih(m))if(Bf)_=ow;else{_=tw;var E=ew}else(w=m.nodeName)&&w.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(_=nw);if(_&&(_=_(e,d))){Ff(p,_,o,u);break e}E&&E(e,m,d),e==="focusout"&&(E=m._wrapperState)&&E.controlled&&m.type==="number"&&Pd(m,"number",m.value)}switch(E=d?pa(d):window,e){case"focusin":(Ih(E)||E.contentEditable==="true")&&(da=E,Fd=d,yi=null);break;case"focusout":yi=Fd=da=null;break;case"mousedown":Bd=!0;break;case"contextmenu":case"mouseup":case"dragend":Bd=!1,Lh(p,o,u);break;case"selectionchange":if(iw)break;case"keydown":case"keyup":Lh(p,o,u)}var I;if(sp)e:{switch(e){case"compositionstart":var B="onCompositionStart";break e;case"compositionend":B="onCompositionEnd";break e;case"compositionupdate":B="onCompositionUpdate";break e}B=void 0}else ca?qf(e,o)&&(B="onCompositionEnd"):e==="keydown"&&o.keyCode===229&&(B="onCompositionStart");B&&(zf&&o.locale!=="ko"&&(ca||B!=="onCompositionStart"?B==="onCompositionEnd"&&ca&&(I=Df()):(ur=u,rp="value"in ur?ur.value:ur.textContent,ca=!0)),E=il(d,B),0<E.length&&(B=new Nh(B,e,null,o,u),p.push({event:B,listeners:E}),I?B.data=I:(I=Of(o),I!==null&&(B.data=I)))),(I=K2?J2(e,o):Y2(e,o))&&(d=il(d,"onBeforeInput"),0<d.length&&(u=new Nh("onBeforeInput","beforeinput",null,o,u),p.push({event:u,listeners:d}),u.data=I))}Xf(p,t)})}function Ai(e,t,o){return{instance:e,listener:t,currentTarget:o}}function il(e,t){for(var o=t+"Capture",r=[];e!==null;){var a=e,i=a.stateNode;a.tag===5&&i!==null&&(a=i,i=Si(e,o),i!=null&&r.unshift(Ai(e,i,a)),i=Si(e,t),i!=null&&r.push(Ai(e,i,a))),e=e.return}return r}function Jr(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function qh(e,t,o,r,a){for(var i=t._reactName,s=[];o!==null&&o!==r;){var l=o,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,a?(c=Si(o,i),c!=null&&s.unshift(Ai(o,c,l))):a||(c=Si(o,i),c!=null&&s.push(Ai(o,c,l)))),o=o.return}s.length!==0&&e.push({event:t,listeners:s})}var dw=/\r\n?/g,uw=/\u0000|\uFFFD/g;function Oh(e){return(typeof e=="string"?e:""+e).replace(dw,`
`).replace(uw,"")}function ss(e,t,o){if(t=Oh(t),Oh(e)!==t&&o)throw Error(ct(425))}function sl(){}var Hd=null,Gd=null;function Ud(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Vd=typeof setTimeout=="function"?setTimeout:void 0,pw=typeof clearTimeout=="function"?clearTimeout:void 0,Fh=typeof Promise=="function"?Promise:void 0,hw=typeof queueMicrotask=="function"?queueMicrotask:typeof Fh<"u"?function(e){return Fh.resolve(null).then(e).catch(mw)}:Vd;function mw(e){setTimeout(function(){throw e})}function Vc(e,t){var o=t,r=0;do{var a=o.nextSibling;if(e.removeChild(o),a&&a.nodeType===8)if(o=a.data,o==="/$"){if(r===0){e.removeChild(a),Pi(t);return}r--}else o!=="$"&&o!=="$?"&&o!=="$!"||r++;o=a}while(o);Pi(t)}function fr(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Bh(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var o=e.data;if(o==="$"||o==="$!"||o==="$?"){if(t===0)return e;t--}else o==="/$"&&t++}e=e.previousSibling}return null}var Ua=Math.random().toString(36).slice(2),Io="__reactFiber$"+Ua,Ri="__reactProps$"+Ua,Wo="__reactContainer$"+Ua,Wd="__reactEvents$"+Ua,gw="__reactListeners$"+Ua,fw="__reactHandles$"+Ua;function Rr(e){var t=e[Io];if(t)return t;for(var o=e.parentNode;o;){if(t=o[Wo]||o[Io]){if(o=t.alternate,t.child!==null||o!==null&&o.child!==null)for(e=Bh(e);e!==null;){if(o=e[Io])return o;e=Bh(e)}return t}e=o,o=e.parentNode}return null}function Vi(e){return e=e[Io]||e[Wo],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function pa(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(ct(33))}function Ol(e){return e[Ri]||null}var $d=[],ha=-1;function Sr(e){return{current:e}}function Qt(e){0>ha||(e.current=$d[ha],$d[ha]=null,ha--)}function Yt(e,t){ha++,$d[ha]=e.current,e.current=t}var Cr={},Rn=Sr(Cr),Un=Sr(!1),Fr=Cr;function Ia(e,t){var o=e.type.contextTypes;if(!o)return Cr;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a={},i;for(i in o)a[i]=t[i];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Vn(e){return e=e.childContextTypes,e!=null}function ll(){Qt(Un),Qt(Rn)}function Hh(e,t,o){if(Rn.current!==Cr)throw Error(ct(168));Yt(Rn,t),Yt(Un,o)}function Qf(e,t,o){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return o;r=r.getChildContext();for(var a in r)if(!(a in t))throw Error(ct(108,e2(e)||"Unknown",a));return on({},o,r)}function cl(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Cr,Fr=Rn.current,Yt(Rn,e),Yt(Un,Un.current),!0}function Gh(e,t,o){var r=e.stateNode;if(!r)throw Error(ct(169));o?(e=Qf(e,t,Fr),r.__reactInternalMemoizedMergedChildContext=e,Qt(Un),Qt(Rn),Yt(Rn,e)):Qt(Un),Yt(Un,o)}var Bo=null,Fl=!1,Wc=!1;function ex(e){Bo===null?Bo=[e]:Bo.push(e)}function xw(e){Fl=!0,ex(e)}function Nr(){if(!Wc&&Bo!==null){Wc=!0;var e=0,t=Vt;try{var o=Bo;for(Vt=1;e<o.length;e++){var r=o[e];do r=r(!0);while(r!==null)}Bo=null,Fl=!1}catch(a){throw Bo!==null&&(Bo=Bo.slice(e+1)),Sf(ep,Nr),a}finally{Vt=t,Wc=!1}}return null}var ma=[],ga=0,dl=null,ul=0,oo=[],ro=0,Br=null,Ho=1,Go="";function Ir(e,t){ma[ga++]=ul,ma[ga++]=dl,dl=e,ul=t}function tx(e,t,o){oo[ro++]=Ho,oo[ro++]=Go,oo[ro++]=Br,Br=e;var r=Ho;e=Go;var a=32-yo(r)-1;r&=~(1<<a),o+=1;var i=32-yo(t)+a;if(30<i){var s=a-a%5;i=(r&(1<<s)-1).toString(32),r>>=s,a-=s,Ho=1<<32-yo(t)+a|o<<a|r,Go=i+e}else Ho=1<<i|o<<a|r,Go=e}function cp(e){e.return!==null&&(Ir(e,1),tx(e,1,0))}function dp(e){for(;e===dl;)dl=ma[--ga],ma[ga]=null,ul=ma[--ga],ma[ga]=null;for(;e===Br;)Br=oo[--ro],oo[ro]=null,Go=oo[--ro],oo[ro]=null,Ho=oo[--ro],oo[ro]=null}var Zn=null,Yn=null,en=!1,xo=null;function nx(e,t){var o=ao(5,null,null,0);o.elementType="DELETED",o.stateNode=t,o.return=e,t=e.deletions,t===null?(e.deletions=[o],e.flags|=16):t.push(o)}function Uh(e,t){switch(e.tag){case 5:var o=e.type;return t=t.nodeType!==1||o.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Zn=e,Yn=fr(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Zn=e,Yn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(o=Br!==null?{id:Ho,overflow:Go}:null,e.memoizedState={dehydrated:t,treeContext:o,retryLane:1073741824},o=ao(18,null,null,0),o.stateNode=t,o.return=e,e.child=o,Zn=e,Yn=null,!0):!1;default:return!1}}function Kd(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Jd(e){if(en){var t=Yn;if(t){var o=t;if(!Uh(e,t)){if(Kd(e))throw Error(ct(418));t=fr(o.nextSibling);var r=Zn;t&&Uh(e,t)?nx(r,o):(e.flags=e.flags&-4097|2,en=!1,Zn=e)}}else{if(Kd(e))throw Error(ct(418));e.flags=e.flags&-4097|2,en=!1,Zn=e}}}function Vh(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Zn=e}function ls(e){if(e!==Zn)return!1;if(!en)return Vh(e),en=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Ud(e.type,e.memoizedProps)),t&&(t=Yn)){if(Kd(e))throw ox(),Error(ct(418));for(;t;)nx(e,t),t=fr(t.nextSibling)}if(Vh(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(ct(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var o=e.data;if(o==="/$"){if(t===0){Yn=fr(e.nextSibling);break e}t--}else o!=="$"&&o!=="$!"&&o!=="$?"||t++}e=e.nextSibling}Yn=null}}else Yn=Zn?fr(e.stateNode.nextSibling):null;return!0}function ox(){for(var e=Yn;e;)e=fr(e.nextSibling)}function Ta(){Yn=Zn=null,en=!1}function up(e){xo===null?xo=[e]:xo.push(e)}var yw=Yo.ReactCurrentBatchConfig;function oi(e,t,o){if(e=o.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(ct(309));var r=o.stateNode}if(!r)throw Error(ct(147,e));var a=r,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(s){var l=a.refs;s===null?delete l[i]:l[i]=s},t._stringRef=i,t)}if(typeof e!="string")throw Error(ct(284));if(!o._owner)throw Error(ct(290,e))}return e}function cs(e,t){throw e=Object.prototype.toString.call(t),Error(ct(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Wh(e){var t=e._init;return t(e._payload)}function rx(e){function t(f,h){if(e){var v=f.deletions;v===null?(f.deletions=[h],f.flags|=16):v.push(h)}}function o(f,h){if(!e)return null;for(;h!==null;)t(f,h),h=h.sibling;return null}function r(f,h){for(f=new Map;h!==null;)h.key!==null?f.set(h.key,h):f.set(h.index,h),h=h.sibling;return f}function a(f,h){return f=wr(f,h),f.index=0,f.sibling=null,f}function i(f,h,v){return f.index=v,e?(v=f.alternate,v!==null?(v=v.index,v<h?(f.flags|=2,h):v):(f.flags|=2,h)):(f.flags|=1048576,h)}function s(f){return e&&f.alternate===null&&(f.flags|=2),f}function l(f,h,v,N){return h===null||h.tag!==6?(h=Qc(v,f.mode,N),h.return=f,h):(h=a(h,v),h.return=f,h)}function c(f,h,v,N){var _=v.type;return _===la?u(f,h,v.props.children,N,v.key):h!==null&&(h.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===sr&&Wh(_)===h.type)?(N=a(h,v.props),N.ref=oi(f,h,v),N.return=f,N):(N=Us(v.type,v.key,v.props,null,f.mode,N),N.ref=oi(f,h,v),N.return=f,N)}function d(f,h,v,N){return h===null||h.tag!==4||h.stateNode.containerInfo!==v.containerInfo||h.stateNode.implementation!==v.implementation?(h=ed(v,f.mode,N),h.return=f,h):(h=a(h,v.children||[]),h.return=f,h)}function u(f,h,v,N,_){return h===null||h.tag!==7?(h=zr(v,f.mode,N,_),h.return=f,h):(h=a(h,v),h.return=f,h)}function p(f,h,v){if(typeof h=="string"&&h!==""||typeof h=="number")return h=Qc(""+h,f.mode,v),h.return=f,h;if(typeof h=="object"&&h!==null){switch(h.$$typeof){case Zi:return v=Us(h.type,h.key,h.props,null,f.mode,v),v.ref=oi(f,null,h),v.return=f,v;case sa:return h=ed(h,f.mode,v),h.return=f,h;case sr:var N=h._init;return p(f,N(h._payload),v)}if(ci(h)||Za(h))return h=zr(h,f.mode,v,null),h.return=f,h;cs(f,h)}return null}function m(f,h,v,N){var _=h!==null?h.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return _!==null?null:l(f,h,""+v,N);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Zi:return v.key===_?c(f,h,v,N):null;case sa:return v.key===_?d(f,h,v,N):null;case sr:return _=v._init,m(f,h,_(v._payload),N)}if(ci(v)||Za(v))return _!==null?null:u(f,h,v,N,null);cs(f,v)}return null}function w(f,h,v,N,_){if(typeof N=="string"&&N!==""||typeof N=="number")return f=f.get(v)||null,l(h,f,""+N,_);if(typeof N=="object"&&N!==null){switch(N.$$typeof){case Zi:return f=f.get(N.key===null?v:N.key)||null,c(h,f,N,_);case sa:return f=f.get(N.key===null?v:N.key)||null,d(h,f,N,_);case sr:var E=N._init;return w(f,h,v,E(N._payload),_)}if(ci(N)||Za(N))return f=f.get(v)||null,u(h,f,N,_,null);cs(h,N)}return null}function k(f,h,v,N){for(var _=null,E=null,I=h,B=h=0,M=null;I!==null&&B<v.length;B++){I.index>B?(M=I,I=null):M=I.sibling;var G=m(f,I,v[B],N);if(G===null){I===null&&(I=M);break}e&&I&&G.alternate===null&&t(f,I),h=i(G,h,B),E===null?_=G:E.sibling=G,E=G,I=M}if(B===v.length)return o(f,I),en&&Ir(f,B),_;if(I===null){for(;B<v.length;B++)I=p(f,v[B],N),I!==null&&(h=i(I,h,B),E===null?_=I:E.sibling=I,E=I);return en&&Ir(f,B),_}for(I=r(f,I);B<v.length;B++)M=w(I,f,B,v[B],N),M!==null&&(e&&M.alternate!==null&&I.delete(M.key===null?B:M.key),h=i(M,h,B),E===null?_=M:E.sibling=M,E=M);return e&&I.forEach(function(V){return t(f,V)}),en&&Ir(f,B),_}function b(f,h,v,N){var _=Za(v);if(typeof _!="function")throw Error(ct(150));if(v=_.call(v),v==null)throw Error(ct(151));for(var E=_=null,I=h,B=h=0,M=null,G=v.next();I!==null&&!G.done;B++,G=v.next()){I.index>B?(M=I,I=null):M=I.sibling;var V=m(f,I,G.value,N);if(V===null){I===null&&(I=M);break}e&&I&&V.alternate===null&&t(f,I),h=i(V,h,B),E===null?_=V:E.sibling=V,E=V,I=M}if(G.done)return o(f,I),en&&Ir(f,B),_;if(I===null){for(;!G.done;B++,G=v.next())G=p(f,G.value,N),G!==null&&(h=i(G,h,B),E===null?_=G:E.sibling=G,E=G);return en&&Ir(f,B),_}for(I=r(f,I);!G.done;B++,G=v.next())G=w(I,f,B,G.value,N),G!==null&&(e&&G.alternate!==null&&I.delete(G.key===null?B:G.key),h=i(G,h,B),E===null?_=G:E.sibling=G,E=G);return e&&I.forEach(function(j){return t(f,j)}),en&&Ir(f,B),_}function x(f,h,v,N){if(typeof v=="object"&&v!==null&&v.type===la&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case Zi:e:{for(var _=v.key,E=h;E!==null;){if(E.key===_){if(_=v.type,_===la){if(E.tag===7){o(f,E.sibling),h=a(E,v.props.children),h.return=f,f=h;break e}}else if(E.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===sr&&Wh(_)===E.type){o(f,E.sibling),h=a(E,v.props),h.ref=oi(f,E,v),h.return=f,f=h;break e}o(f,E);break}else t(f,E);E=E.sibling}v.type===la?(h=zr(v.props.children,f.mode,N,v.key),h.return=f,f=h):(N=Us(v.type,v.key,v.props,null,f.mode,N),N.ref=oi(f,h,v),N.return=f,f=N)}return s(f);case sa:e:{for(E=v.key;h!==null;){if(h.key===E)if(h.tag===4&&h.stateNode.containerInfo===v.containerInfo&&h.stateNode.implementation===v.implementation){o(f,h.sibling),h=a(h,v.children||[]),h.return=f,f=h;break e}else{o(f,h);break}else t(f,h);h=h.sibling}h=ed(v,f.mode,N),h.return=f,f=h}return s(f);case sr:return E=v._init,x(f,h,E(v._payload),N)}if(ci(v))return k(f,h,v,N);if(Za(v))return b(f,h,v,N);cs(f,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,h!==null&&h.tag===6?(o(f,h.sibling),h=a(h,v),h.return=f,f=h):(o(f,h),h=Qc(v,f.mode,N),h.return=f,f=h),s(f)):o(f,h)}return x}var Aa=rx(!0),ax=rx(!1),pl=Sr(null),hl=null,fa=null,pp=null;function hp(){pp=fa=hl=null}function mp(e){var t=pl.current;Qt(pl),e._currentValue=t}function Yd(e,t,o){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===o)break;e=e.return}}function Sa(e,t){hl=e,pp=fa=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Gn=!0),e.firstContext=null)}function lo(e){var t=e._currentValue;if(pp!==e)if(e={context:e,memoizedValue:t,next:null},fa===null){if(hl===null)throw Error(ct(308));fa=e,hl.dependencies={lanes:0,firstContext:e}}else fa=fa.next=e;return t}var Mr=null;function gp(e){Mr===null?Mr=[e]:Mr.push(e)}function ix(e,t,o,r){var a=t.interleaved;return a===null?(o.next=o,gp(t)):(o.next=a.next,a.next=o),t.interleaved=o,$o(e,r)}function $o(e,t){e.lanes|=t;var o=e.alternate;for(o!==null&&(o.lanes|=t),o=e,e=e.return;e!==null;)e.childLanes|=t,o=e.alternate,o!==null&&(o.childLanes|=t),o=e,e=e.return;return o.tag===3?o.stateNode:null}var lr=!1;function fp(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function sx(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Uo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function xr(e,t,o){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,qt&2){var a=r.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),r.pending=t,$o(e,o)}return a=r.interleaved,a===null?(t.next=t,gp(r)):(t.next=a.next,a.next=t),r.interleaved=t,$o(e,o)}function qs(e,t,o){if(t=t.updateQueue,t!==null&&(t=t.shared,(o&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,o|=r,t.lanes=o,tp(e,o)}}function $h(e,t){var o=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,o===r)){var a=null,i=null;if(o=o.firstBaseUpdate,o!==null){do{var s={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};i===null?a=i=s:i=i.next=s,o=o.next}while(o!==null);i===null?a=i=t:i=i.next=t}else a=i=t;o={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},e.updateQueue=o;return}e=o.lastBaseUpdate,e===null?o.firstBaseUpdate=t:e.next=t,o.lastBaseUpdate=t}function ml(e,t,o,r){var a=e.updateQueue;lr=!1;var i=a.firstBaseUpdate,s=a.lastBaseUpdate,l=a.shared.pending;if(l!==null){a.shared.pending=null;var c=l,d=c.next;c.next=null,s===null?i=d:s.next=d,s=c;var u=e.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==s&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(i!==null){var p=a.baseState;s=0,u=d=c=null,l=i;do{var m=l.lane,w=l.eventTime;if((r&m)===m){u!==null&&(u=u.next={eventTime:w,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var k=e,b=l;switch(m=t,w=o,b.tag){case 1:if(k=b.payload,typeof k=="function"){p=k.call(w,p,m);break e}p=k;break e;case 3:k.flags=k.flags&-65537|128;case 0:if(k=b.payload,m=typeof k=="function"?k.call(w,p,m):k,m==null)break e;p=on({},p,m);break e;case 2:lr=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,m=a.effects,m===null?a.effects=[l]:m.push(l))}else w={eventTime:w,lane:m,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=w,c=p):u=u.next=w,s|=m;if(l=l.next,l===null){if(l=a.shared.pending,l===null)break;m=l,l=m.next,m.next=null,a.lastBaseUpdate=m,a.shared.pending=null}}while(!0);if(u===null&&(c=p),a.baseState=c,a.firstBaseUpdate=d,a.lastBaseUpdate=u,t=a.shared.interleaved,t!==null){a=t;do s|=a.lane,a=a.next;while(a!==t)}else i===null&&(a.shared.lanes=0);Gr|=s,e.lanes=s,e.memoizedState=p}}function Kh(e,t,o){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(a!==null){if(r.callback=null,r=o,typeof a!="function")throw Error(ct(191,a));a.call(r)}}}var Wi={},Mo=Sr(Wi),Mi=Sr(Wi),Li=Sr(Wi);function Lr(e){if(e===Wi)throw Error(ct(174));return e}function xp(e,t){switch(Yt(Li,t),Yt(Mi,e),Yt(Mo,Wi),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Id(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Id(t,e)}Qt(Mo),Yt(Mo,t)}function Ra(){Qt(Mo),Qt(Mi),Qt(Li)}function lx(e){Lr(Li.current);var t=Lr(Mo.current),o=Id(t,e.type);t!==o&&(Yt(Mi,e),Yt(Mo,o))}function yp(e){Mi.current===e&&(Qt(Mo),Qt(Mi))}var tn=Sr(0);function gl(e){for(var t=e;t!==null;){if(t.tag===13){var o=t.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var $c=[];function vp(){for(var e=0;e<$c.length;e++)$c[e]._workInProgressVersionPrimary=null;$c.length=0}var Os=Yo.ReactCurrentDispatcher,Kc=Yo.ReactCurrentBatchConfig,Hr=0,nn=null,gn=null,wn=null,fl=!1,vi=!1,Di=0,vw=0;function En(){throw Error(ct(321))}function wp(e,t){if(t===null)return!1;for(var o=0;o<t.length&&o<e.length;o++)if(!Co(e[o],t[o]))return!1;return!0}function bp(e,t,o,r,a,i){if(Hr=i,nn=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Os.current=e===null||e.memoizedState===null?kw:_w,e=o(r,a),vi){i=0;do{if(vi=!1,Di=0,25<=i)throw Error(ct(301));i+=1,wn=gn=null,t.updateQueue=null,Os.current=Sw,e=o(r,a)}while(vi)}if(Os.current=xl,t=gn!==null&&gn.next!==null,Hr=0,wn=gn=nn=null,fl=!1,t)throw Error(ct(300));return e}function Cp(){var e=Di!==0;return Di=0,e}function Eo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return wn===null?nn.memoizedState=wn=e:wn=wn.next=e,wn}function co(){if(gn===null){var e=nn.alternate;e=e!==null?e.memoizedState:null}else e=gn.next;var t=wn===null?nn.memoizedState:wn.next;if(t!==null)wn=t,gn=e;else{if(e===null)throw Error(ct(310));gn=e,e={memoizedState:gn.memoizedState,baseState:gn.baseState,baseQueue:gn.baseQueue,queue:gn.queue,next:null},wn===null?nn.memoizedState=wn=e:wn=wn.next=e}return wn}function zi(e,t){return typeof t=="function"?t(e):t}function Jc(e){var t=co(),o=t.queue;if(o===null)throw Error(ct(311));o.lastRenderedReducer=e;var r=gn,a=r.baseQueue,i=o.pending;if(i!==null){if(a!==null){var s=a.next;a.next=i.next,i.next=s}r.baseQueue=a=i,o.pending=null}if(a!==null){i=a.next,r=r.baseState;var l=s=null,c=null,d=i;do{var u=d.lane;if((Hr&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:e(r,d.action);else{var p={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=p,s=r):c=c.next=p,nn.lanes|=u,Gr|=u}d=d.next}while(d!==null&&d!==i);c===null?s=r:c.next=l,Co(r,t.memoizedState)||(Gn=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,o.lastRenderedState=r}if(e=o.interleaved,e!==null){a=e;do i=a.lane,nn.lanes|=i,Gr|=i,a=a.next;while(a!==e)}else a===null&&(o.lanes=0);return[t.memoizedState,o.dispatch]}function Yc(e){var t=co(),o=t.queue;if(o===null)throw Error(ct(311));o.lastRenderedReducer=e;var r=o.dispatch,a=o.pending,i=t.memoizedState;if(a!==null){o.pending=null;var s=a=a.next;do i=e(i,s.action),s=s.next;while(s!==a);Co(i,t.memoizedState)||(Gn=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),o.lastRenderedState=i}return[i,r]}function cx(){}function dx(e,t){var o=nn,r=co(),a=t(),i=!Co(r.memoizedState,a);if(i&&(r.memoizedState=a,Gn=!0),r=r.queue,kp(hx.bind(null,o,r,e),[e]),r.getSnapshot!==t||i||wn!==null&&wn.memoizedState.tag&1){if(o.flags|=2048,qi(9,px.bind(null,o,r,a,t),void 0,null),bn===null)throw Error(ct(349));Hr&30||ux(o,t,a)}return a}function ux(e,t,o){e.flags|=16384,e={getSnapshot:t,value:o},t=nn.updateQueue,t===null?(t={lastEffect:null,stores:null},nn.updateQueue=t,t.stores=[e]):(o=t.stores,o===null?t.stores=[e]:o.push(e))}function px(e,t,o,r){t.value=o,t.getSnapshot=r,mx(t)&&gx(e)}function hx(e,t,o){return o(function(){mx(t)&&gx(e)})}function mx(e){var t=e.getSnapshot;e=e.value;try{var o=t();return!Co(e,o)}catch{return!0}}function gx(e){var t=$o(e,1);t!==null&&vo(t,e,1,-1)}function Jh(e){var t=Eo();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:zi,lastRenderedState:e},t.queue=e,e=e.dispatch=Cw.bind(null,nn,e),[t.memoizedState,e]}function qi(e,t,o,r){return e={tag:e,create:t,destroy:o,deps:r,next:null},t=nn.updateQueue,t===null?(t={lastEffect:null,stores:null},nn.updateQueue=t,t.lastEffect=e.next=e):(o=t.lastEffect,o===null?t.lastEffect=e.next=e:(r=o.next,o.next=e,e.next=r,t.lastEffect=e)),e}function fx(){return co().memoizedState}function Fs(e,t,o,r){var a=Eo();nn.flags|=e,a.memoizedState=qi(1|t,o,void 0,r===void 0?null:r)}function Bl(e,t,o,r){var a=co();r=r===void 0?null:r;var i=void 0;if(gn!==null){var s=gn.memoizedState;if(i=s.destroy,r!==null&&wp(r,s.deps)){a.memoizedState=qi(t,o,i,r);return}}nn.flags|=e,a.memoizedState=qi(1|t,o,i,r)}function Yh(e,t){return Fs(8390656,8,e,t)}function kp(e,t){return Bl(2048,8,e,t)}function xx(e,t){return Bl(4,2,e,t)}function yx(e,t){return Bl(4,4,e,t)}function vx(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function wx(e,t,o){return o=o!=null?o.concat([e]):null,Bl(4,4,vx.bind(null,t,e),o)}function _p(){}function bx(e,t){var o=co();t=t===void 0?null:t;var r=o.memoizedState;return r!==null&&t!==null&&wp(t,r[1])?r[0]:(o.memoizedState=[e,t],e)}function Cx(e,t){var o=co();t=t===void 0?null:t;var r=o.memoizedState;return r!==null&&t!==null&&wp(t,r[1])?r[0]:(e=e(),o.memoizedState=[e,t],e)}function kx(e,t,o){return Hr&21?(Co(o,t)||(o=Pf(),nn.lanes|=o,Gr|=o,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Gn=!0),e.memoizedState=o)}function ww(e,t){var o=Vt;Vt=o!==0&&4>o?o:4,e(!0);var r=Kc.transition;Kc.transition={};try{e(!1),t()}finally{Vt=o,Kc.transition=r}}function _x(){return co().memoizedState}function bw(e,t,o){var r=vr(e);if(o={lane:r,action:o,hasEagerState:!1,eagerState:null,next:null},Sx(e))Nx(t,o);else if(o=ix(e,t,o,r),o!==null){var a=Dn();vo(o,e,r,a),Ex(o,t,r)}}function Cw(e,t,o){var r=vr(e),a={lane:r,action:o,hasEagerState:!1,eagerState:null,next:null};if(Sx(e))Nx(t,a);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var s=t.lastRenderedState,l=i(s,o);if(a.hasEagerState=!0,a.eagerState=l,Co(l,s)){var c=t.interleaved;c===null?(a.next=a,gp(t)):(a.next=c.next,c.next=a),t.interleaved=a;return}}catch{}finally{}o=ix(e,t,a,r),o!==null&&(a=Dn(),vo(o,e,r,a),Ex(o,t,r))}}function Sx(e){var t=e.alternate;return e===nn||t!==null&&t===nn}function Nx(e,t){vi=fl=!0;var o=e.pending;o===null?t.next=t:(t.next=o.next,o.next=t),e.pending=t}function Ex(e,t,o){if(o&4194240){var r=t.lanes;r&=e.pendingLanes,o|=r,t.lanes=o,tp(e,o)}}var xl={readContext:lo,useCallback:En,useContext:En,useEffect:En,useImperativeHandle:En,useInsertionEffect:En,useLayoutEffect:En,useMemo:En,useReducer:En,useRef:En,useState:En,useDebugValue:En,useDeferredValue:En,useTransition:En,useMutableSource:En,useSyncExternalStore:En,useId:En,unstable_isNewReconciler:!1},kw={readContext:lo,useCallback:function(e,t){return Eo().memoizedState=[e,t===void 0?null:t],e},useContext:lo,useEffect:Yh,useImperativeHandle:function(e,t,o){return o=o!=null?o.concat([e]):null,Fs(4194308,4,vx.bind(null,t,e),o)},useLayoutEffect:function(e,t){return Fs(4194308,4,e,t)},useInsertionEffect:function(e,t){return Fs(4,2,e,t)},useMemo:function(e,t){var o=Eo();return t=t===void 0?null:t,e=e(),o.memoizedState=[e,t],e},useReducer:function(e,t,o){var r=Eo();return t=o!==void 0?o(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=bw.bind(null,nn,e),[r.memoizedState,e]},useRef:function(e){var t=Eo();return e={current:e},t.memoizedState=e},useState:Jh,useDebugValue:_p,useDeferredValue:function(e){return Eo().memoizedState=e},useTransition:function(){var e=Jh(!1),t=e[0];return e=ww.bind(null,e[1]),Eo().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,o){var r=nn,a=Eo();if(en){if(o===void 0)throw Error(ct(407));o=o()}else{if(o=t(),bn===null)throw Error(ct(349));Hr&30||ux(r,t,o)}a.memoizedState=o;var i={value:o,getSnapshot:t};return a.queue=i,Yh(hx.bind(null,r,i,e),[e]),r.flags|=2048,qi(9,px.bind(null,r,i,o,t),void 0,null),o},useId:function(){var e=Eo(),t=bn.identifierPrefix;if(en){var o=Go,r=Ho;o=(r&~(1<<32-yo(r)-1)).toString(32)+o,t=":"+t+"R"+o,o=Di++,0<o&&(t+="H"+o.toString(32)),t+=":"}else o=vw++,t=":"+t+"r"+o.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},_w={readContext:lo,useCallback:bx,useContext:lo,useEffect:kp,useImperativeHandle:wx,useInsertionEffect:xx,useLayoutEffect:yx,useMemo:Cx,useReducer:Jc,useRef:fx,useState:function(){return Jc(zi)},useDebugValue:_p,useDeferredValue:function(e){var t=co();return kx(t,gn.memoizedState,e)},useTransition:function(){var e=Jc(zi)[0],t=co().memoizedState;return[e,t]},useMutableSource:cx,useSyncExternalStore:dx,useId:_x,unstable_isNewReconciler:!1},Sw={readContext:lo,useCallback:bx,useContext:lo,useEffect:kp,useImperativeHandle:wx,useInsertionEffect:xx,useLayoutEffect:yx,useMemo:Cx,useReducer:Yc,useRef:fx,useState:function(){return Yc(zi)},useDebugValue:_p,useDeferredValue:function(e){var t=co();return gn===null?t.memoizedState=e:kx(t,gn.memoizedState,e)},useTransition:function(){var e=Yc(zi)[0],t=co().memoizedState;return[e,t]},useMutableSource:cx,useSyncExternalStore:dx,useId:_x,unstable_isNewReconciler:!1};function go(e,t){if(e&&e.defaultProps){t=on({},t),e=e.defaultProps;for(var o in e)t[o]===void 0&&(t[o]=e[o]);return t}return t}function Xd(e,t,o,r){t=e.memoizedState,o=o(r,t),o=o==null?t:on({},t,o),e.memoizedState=o,e.lanes===0&&(e.updateQueue.baseState=o)}var Hl={isMounted:function(e){return(e=e._reactInternals)?$r(e)===e:!1},enqueueSetState:function(e,t,o){e=e._reactInternals;var r=Dn(),a=vr(e),i=Uo(r,a);i.payload=t,o!=null&&(i.callback=o),t=xr(e,i,a),t!==null&&(vo(t,e,a,r),qs(t,e,a))},enqueueReplaceState:function(e,t,o){e=e._reactInternals;var r=Dn(),a=vr(e),i=Uo(r,a);i.tag=1,i.payload=t,o!=null&&(i.callback=o),t=xr(e,i,a),t!==null&&(vo(t,e,a,r),qs(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var o=Dn(),r=vr(e),a=Uo(o,r);a.tag=2,t!=null&&(a.callback=t),t=xr(e,a,r),t!==null&&(vo(t,e,r,o),qs(t,e,r))}};function Xh(e,t,o,r,a,i,s){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,i,s):t.prototype&&t.prototype.isPureReactComponent?!Ii(o,r)||!Ii(a,i):!0}function Px(e,t,o){var r=!1,a=Cr,i=t.contextType;return typeof i=="object"&&i!==null?i=lo(i):(a=Vn(t)?Fr:Rn.current,r=t.contextTypes,i=(r=r!=null)?Ia(e,a):Cr),t=new t(o,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Hl,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function Zh(e,t,o,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(o,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(o,r),t.state!==e&&Hl.enqueueReplaceState(t,t.state,null)}function Zd(e,t,o,r){var a=e.stateNode;a.props=o,a.state=e.memoizedState,a.refs={},fp(e);var i=t.contextType;typeof i=="object"&&i!==null?a.context=lo(i):(i=Vn(t)?Fr:Rn.current,a.context=Ia(e,i)),a.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(Xd(e,t,i,o),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&Hl.enqueueReplaceState(a,a.state,null),ml(e,o,a,r),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function Ma(e,t){try{var o="",r=t;do o+=Qv(r),r=r.return;while(r);var a=o}catch(i){a=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:a,digest:null}}function Xc(e,t,o){return{value:e,source:null,stack:o??null,digest:t??null}}function Qd(e,t){try{console.error(t.value)}catch(o){setTimeout(function(){throw o})}}var Nw=typeof WeakMap=="function"?WeakMap:Map;function jx(e,t,o){o=Uo(-1,o),o.tag=3,o.payload={element:null};var r=t.value;return o.callback=function(){vl||(vl=!0,cu=r),Qd(e,t)},o}function Ix(e,t,o){o=Uo(-1,o),o.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var a=t.value;o.payload=function(){return r(a)},o.callback=function(){Qd(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(o.callback=function(){Qd(e,t),typeof r!="function"&&(yr===null?yr=new Set([this]):yr.add(this));var s=t.stack;this.componentDidCatch(t.value,{componentStack:s!==null?s:""})}),o}function Qh(e,t,o){var r=e.pingCache;if(r===null){r=e.pingCache=new Nw;var a=new Set;r.set(t,a)}else a=r.get(t),a===void 0&&(a=new Set,r.set(t,a));a.has(o)||(a.add(o),e=Fw.bind(null,e,t,o),t.then(e,e))}function em(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function tm(e,t,o,r,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(t=Uo(-1,1),t.tag=2,xr(o,t,1))),o.lanes|=1),e)}var Ew=Yo.ReactCurrentOwner,Gn=!1;function Ln(e,t,o,r){t.child=e===null?ax(t,null,o,r):Aa(t,e.child,o,r)}function nm(e,t,o,r,a){o=o.render;var i=t.ref;return Sa(t,a),r=bp(e,t,o,r,i,a),o=Cp(),e!==null&&!Gn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Ko(e,t,a)):(en&&o&&cp(t),t.flags|=1,Ln(e,t,r,a),t.child)}function om(e,t,o,r,a){if(e===null){var i=o.type;return typeof i=="function"&&!Ap(i)&&i.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(t.tag=15,t.type=i,Tx(e,t,i,r,a)):(e=Us(o.type,null,r,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&a)){var s=i.memoizedProps;if(o=o.compare,o=o!==null?o:Ii,o(s,r)&&e.ref===t.ref)return Ko(e,t,a)}return t.flags|=1,e=wr(i,r),e.ref=t.ref,e.return=t,t.child=e}function Tx(e,t,o,r,a){if(e!==null){var i=e.memoizedProps;if(Ii(i,r)&&e.ref===t.ref)if(Gn=!1,t.pendingProps=r=i,(e.lanes&a)!==0)e.flags&131072&&(Gn=!0);else return t.lanes=e.lanes,Ko(e,t,a)}return eu(e,t,o,r,a)}function Ax(e,t,o){var r=t.pendingProps,a=r.children,i=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Yt(ya,Kn),Kn|=o;else{if(!(o&1073741824))return e=i!==null?i.baseLanes|o:o,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Yt(ya,Kn),Kn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:o,Yt(ya,Kn),Kn|=r}else i!==null?(r=i.baseLanes|o,t.memoizedState=null):r=o,Yt(ya,Kn),Kn|=r;return Ln(e,t,a,o),t.child}function Rx(e,t){var o=t.ref;(e===null&&o!==null||e!==null&&e.ref!==o)&&(t.flags|=512,t.flags|=2097152)}function eu(e,t,o,r,a){var i=Vn(o)?Fr:Rn.current;return i=Ia(t,i),Sa(t,a),o=bp(e,t,o,r,i,a),r=Cp(),e!==null&&!Gn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Ko(e,t,a)):(en&&r&&cp(t),t.flags|=1,Ln(e,t,o,a),t.child)}function rm(e,t,o,r,a){if(Vn(o)){var i=!0;cl(t)}else i=!1;if(Sa(t,a),t.stateNode===null)Bs(e,t),Px(t,o,r),Zd(t,o,r,a),r=!0;else if(e===null){var s=t.stateNode,l=t.memoizedProps;s.props=l;var c=s.context,d=o.contextType;typeof d=="object"&&d!==null?d=lo(d):(d=Vn(o)?Fr:Rn.current,d=Ia(t,d));var u=o.getDerivedStateFromProps,p=typeof u=="function"||typeof s.getSnapshotBeforeUpdate=="function";p||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==r||c!==d)&&Zh(t,s,r,d),lr=!1;var m=t.memoizedState;s.state=m,ml(t,r,s,a),c=t.memoizedState,l!==r||m!==c||Un.current||lr?(typeof u=="function"&&(Xd(t,o,u,r),c=t.memoizedState),(l=lr||Xh(t,o,l,r,m,c,d))?(p||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(t.flags|=4194308)):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),s.props=r,s.state=c,s.context=d,r=l):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,sx(e,t),l=t.memoizedProps,d=t.type===t.elementType?l:go(t.type,l),s.props=d,p=t.pendingProps,m=s.context,c=o.contextType,typeof c=="object"&&c!==null?c=lo(c):(c=Vn(o)?Fr:Rn.current,c=Ia(t,c));var w=o.getDerivedStateFromProps;(u=typeof w=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==p||m!==c)&&Zh(t,s,r,c),lr=!1,m=t.memoizedState,s.state=m,ml(t,r,s,a);var k=t.memoizedState;l!==p||m!==k||Un.current||lr?(typeof w=="function"&&(Xd(t,o,w,r),k=t.memoizedState),(d=lr||Xh(t,o,d,r,m,k,c)||!1)?(u||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,k,c),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,k,c)),typeof s.componentDidUpdate=="function"&&(t.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof s.componentDidUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=k),s.props=r,s.state=k,s.context=c,r=d):(typeof s.componentDidUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),r=!1)}return tu(e,t,o,r,i,a)}function tu(e,t,o,r,a,i){Rx(e,t);var s=(t.flags&128)!==0;if(!r&&!s)return a&&Gh(t,o,!1),Ko(e,t,i);r=t.stateNode,Ew.current=t;var l=s&&typeof o.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&s?(t.child=Aa(t,e.child,null,i),t.child=Aa(t,null,l,i)):Ln(e,t,l,i),t.memoizedState=r.state,a&&Gh(t,o,!0),t.child}function Mx(e){var t=e.stateNode;t.pendingContext?Hh(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Hh(e,t.context,!1),xp(e,t.containerInfo)}function am(e,t,o,r,a){return Ta(),up(a),t.flags|=256,Ln(e,t,o,r),t.child}var nu={dehydrated:null,treeContext:null,retryLane:0};function ou(e){return{baseLanes:e,cachePool:null,transitions:null}}function Lx(e,t,o){var r=t.pendingProps,a=tn.current,i=!1,s=(t.flags&128)!==0,l;if((l=s)||(l=e!==null&&e.memoizedState===null?!1:(a&2)!==0),l?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),Yt(tn,a&1),e===null)return Jd(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(s=r.children,e=r.fallback,i?(r=t.mode,i=t.child,s={mode:"hidden",children:s},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=s):i=Vl(s,r,0,null),e=zr(e,r,o,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=ou(o),t.memoizedState=nu,e):Sp(t,s));if(a=e.memoizedState,a!==null&&(l=a.dehydrated,l!==null))return Pw(e,t,s,r,l,a,o);if(i){i=r.fallback,s=t.mode,a=e.child,l=a.sibling;var c={mode:"hidden",children:r.children};return!(s&1)&&t.child!==a?(r=t.child,r.childLanes=0,r.pendingProps=c,t.deletions=null):(r=wr(a,c),r.subtreeFlags=a.subtreeFlags&14680064),l!==null?i=wr(l,i):(i=zr(i,s,o,null),i.flags|=2),i.return=t,r.return=t,r.sibling=i,t.child=r,r=i,i=t.child,s=e.child.memoizedState,s=s===null?ou(o):{baseLanes:s.baseLanes|o,cachePool:null,transitions:s.transitions},i.memoizedState=s,i.childLanes=e.childLanes&~o,t.memoizedState=nu,r}return i=e.child,e=i.sibling,r=wr(i,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=o),r.return=t,r.sibling=null,e!==null&&(o=t.deletions,o===null?(t.deletions=[e],t.flags|=16):o.push(e)),t.child=r,t.memoizedState=null,r}function Sp(e,t){return t=Vl({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function ds(e,t,o,r){return r!==null&&up(r),Aa(t,e.child,null,o),e=Sp(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Pw(e,t,o,r,a,i,s){if(o)return t.flags&256?(t.flags&=-257,r=Xc(Error(ct(422))),ds(e,t,s,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=r.fallback,a=t.mode,r=Vl({mode:"visible",children:r.children},a,0,null),i=zr(i,a,s,null),i.flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,t.mode&1&&Aa(t,e.child,null,s),t.child.memoizedState=ou(s),t.memoizedState=nu,i);if(!(t.mode&1))return ds(e,t,s,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(ct(419)),r=Xc(i,r,void 0),ds(e,t,s,r)}if(l=(s&e.childLanes)!==0,Gn||l){if(r=bn,r!==null){switch(s&-s){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|s)?0:a,a!==0&&a!==i.retryLane&&(i.retryLane=a,$o(e,a),vo(r,e,a,-1))}return Tp(),r=Xc(Error(ct(421))),ds(e,t,s,r)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=Bw.bind(null,e),a._reactRetry=t,null):(e=i.treeContext,Yn=fr(a.nextSibling),Zn=t,en=!0,xo=null,e!==null&&(oo[ro++]=Ho,oo[ro++]=Go,oo[ro++]=Br,Ho=e.id,Go=e.overflow,Br=t),t=Sp(t,r.children),t.flags|=4096,t)}function im(e,t,o){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),Yd(e.return,t,o)}function Zc(e,t,o,r,a){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:o,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=o,i.tailMode=a)}function Dx(e,t,o){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(Ln(e,t,r.children,o),r=tn.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&im(e,o,t);else if(e.tag===19)im(e,o,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Yt(tn,r),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(o=t.child,a=null;o!==null;)e=o.alternate,e!==null&&gl(e)===null&&(a=o),o=o.sibling;o=a,o===null?(a=t.child,t.child=null):(a=o.sibling,o.sibling=null),Zc(t,!1,a,o,i);break;case"backwards":for(o=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&gl(e)===null){t.child=a;break}e=a.sibling,a.sibling=o,o=a,a=e}Zc(t,!0,o,null,i);break;case"together":Zc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Bs(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ko(e,t,o){if(e!==null&&(t.dependencies=e.dependencies),Gr|=t.lanes,!(o&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(ct(153));if(t.child!==null){for(e=t.child,o=wr(e,e.pendingProps),t.child=o,o.return=t;e.sibling!==null;)e=e.sibling,o=o.sibling=wr(e,e.pendingProps),o.return=t;o.sibling=null}return t.child}function jw(e,t,o){switch(t.tag){case 3:Mx(t),Ta();break;case 5:lx(t);break;case 1:Vn(t.type)&&cl(t);break;case 4:xp(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Yt(pl,r._currentValue),r._currentValue=a;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(Yt(tn,tn.current&1),t.flags|=128,null):o&t.child.childLanes?Lx(e,t,o):(Yt(tn,tn.current&1),e=Ko(e,t,o),e!==null?e.sibling:null);Yt(tn,tn.current&1);break;case 19:if(r=(o&t.childLanes)!==0,e.flags&128){if(r)return Dx(e,t,o);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),Yt(tn,tn.current),r)break;return null;case 22:case 23:return t.lanes=0,Ax(e,t,o)}return Ko(e,t,o)}var zx,ru,qx,Ox;zx=function(e,t){for(var o=t.child;o!==null;){if(o.tag===5||o.tag===6)e.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===t)break;for(;o.sibling===null;){if(o.return===null||o.return===t)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};ru=function(){};qx=function(e,t,o,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,Lr(Mo.current);var i=null;switch(o){case"input":a=Nd(e,a),r=Nd(e,r),i=[];break;case"select":a=on({},a,{value:void 0}),r=on({},r,{value:void 0}),i=[];break;case"textarea":a=jd(e,a),r=jd(e,r),i=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=sl)}Td(o,r);var s;o=null;for(d in a)if(!r.hasOwnProperty(d)&&a.hasOwnProperty(d)&&a[d]!=null)if(d==="style"){var l=a[d];for(s in l)l.hasOwnProperty(s)&&(o||(o={}),o[s]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(ki.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=a!=null?a[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(o||(o={}),o[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(o||(o={}),o[s]=c[s])}else o||(i||(i=[]),i.push(d,o)),o=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(ki.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Zt("scroll",e),i||l===c||(i=[])):(i=i||[]).push(d,c))}o&&(i=i||[]).push("style",o);var d=i;(t.updateQueue=d)&&(t.flags|=4)}};Ox=function(e,t,o,r){o!==r&&(t.flags|=4)};function ri(e,t){if(!en)switch(e.tailMode){case"hidden":t=e.tail;for(var o=null;t!==null;)t.alternate!==null&&(o=t),t=t.sibling;o===null?e.tail=null:o.sibling=null;break;case"collapsed":o=e.tail;for(var r=null;o!==null;)o.alternate!==null&&(r=o),o=o.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Pn(e){var t=e.alternate!==null&&e.alternate.child===e.child,o=0,r=0;if(t)for(var a=e.child;a!==null;)o|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)o|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=o,t}function Iw(e,t,o){var r=t.pendingProps;switch(dp(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pn(t),null;case 1:return Vn(t.type)&&ll(),Pn(t),null;case 3:return r=t.stateNode,Ra(),Qt(Un),Qt(Rn),vp(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(ls(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,xo!==null&&(pu(xo),xo=null))),ru(e,t),Pn(t),null;case 5:yp(t);var a=Lr(Li.current);if(o=t.type,e!==null&&t.stateNode!=null)qx(e,t,o,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(ct(166));return Pn(t),null}if(e=Lr(Mo.current),ls(t)){r=t.stateNode,o=t.type;var i=t.memoizedProps;switch(r[Io]=t,r[Ri]=i,e=(t.mode&1)!==0,o){case"dialog":Zt("cancel",r),Zt("close",r);break;case"iframe":case"object":case"embed":Zt("load",r);break;case"video":case"audio":for(a=0;a<ui.length;a++)Zt(ui[a],r);break;case"source":Zt("error",r);break;case"img":case"image":case"link":Zt("error",r),Zt("load",r);break;case"details":Zt("toggle",r);break;case"input":gh(r,i),Zt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Zt("invalid",r);break;case"textarea":xh(r,i),Zt("invalid",r)}Td(o,i),a=null;for(var s in i)if(i.hasOwnProperty(s)){var l=i[s];s==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&ss(r.textContent,l,e),a=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&ss(r.textContent,l,e),a=["children",""+l]):ki.hasOwnProperty(s)&&l!=null&&s==="onScroll"&&Zt("scroll",r)}switch(o){case"input":Qi(r),fh(r,i,!0);break;case"textarea":Qi(r),yh(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=sl)}r=a,t.updateQueue=r,r!==null&&(t.flags|=4)}else{s=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=hf(o)),e==="http://www.w3.org/1999/xhtml"?o==="script"?(e=s.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=s.createElement(o,{is:r.is}):(e=s.createElement(o),o==="select"&&(s=e,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):e=s.createElementNS(e,o),e[Io]=t,e[Ri]=r,zx(e,t,!1,!1),t.stateNode=e;e:{switch(s=Ad(o,r),o){case"dialog":Zt("cancel",e),Zt("close",e),a=r;break;case"iframe":case"object":case"embed":Zt("load",e),a=r;break;case"video":case"audio":for(a=0;a<ui.length;a++)Zt(ui[a],e);a=r;break;case"source":Zt("error",e),a=r;break;case"img":case"image":case"link":Zt("error",e),Zt("load",e),a=r;break;case"details":Zt("toggle",e),a=r;break;case"input":gh(e,r),a=Nd(e,r),Zt("invalid",e);break;case"option":a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=on({},r,{value:void 0}),Zt("invalid",e);break;case"textarea":xh(e,r),a=jd(e,r),Zt("invalid",e);break;default:a=r}Td(o,a),l=a;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?ff(e,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&mf(e,c)):i==="children"?typeof c=="string"?(o!=="textarea"||c!=="")&&_i(e,c):typeof c=="number"&&_i(e,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(ki.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Zt("scroll",e):c!=null&&Ju(e,i,c,s))}switch(o){case"input":Qi(e),fh(e,r,!1);break;case"textarea":Qi(e),yh(e);break;case"option":r.value!=null&&e.setAttribute("value",""+br(r.value));break;case"select":e.multiple=!!r.multiple,i=r.value,i!=null?ba(e,!!r.multiple,i,!1):r.defaultValue!=null&&ba(e,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=sl)}switch(o){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Pn(t),null;case 6:if(e&&t.stateNode!=null)Ox(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(ct(166));if(o=Lr(Li.current),Lr(Mo.current),ls(t)){if(r=t.stateNode,o=t.memoizedProps,r[Io]=t,(i=r.nodeValue!==o)&&(e=Zn,e!==null))switch(e.tag){case 3:ss(r.nodeValue,o,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&ss(r.nodeValue,o,(e.mode&1)!==0)}i&&(t.flags|=4)}else r=(o.nodeType===9?o:o.ownerDocument).createTextNode(r),r[Io]=t,t.stateNode=r}return Pn(t),null;case 13:if(Qt(tn),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(en&&Yn!==null&&t.mode&1&&!(t.flags&128))ox(),Ta(),t.flags|=98560,i=!1;else if(i=ls(t),r!==null&&r.dehydrated!==null){if(e===null){if(!i)throw Error(ct(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(ct(317));i[Io]=t}else Ta(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Pn(t),i=!1}else xo!==null&&(pu(xo),xo=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=o,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||tn.current&1?fn===0&&(fn=3):Tp())),t.updateQueue!==null&&(t.flags|=4),Pn(t),null);case 4:return Ra(),ru(e,t),e===null&&Ti(t.stateNode.containerInfo),Pn(t),null;case 10:return mp(t.type._context),Pn(t),null;case 17:return Vn(t.type)&&ll(),Pn(t),null;case 19:if(Qt(tn),i=t.memoizedState,i===null)return Pn(t),null;if(r=(t.flags&128)!==0,s=i.rendering,s===null)if(r)ri(i,!1);else{if(fn!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(s=gl(e),s!==null){for(t.flags|=128,ri(i,!1),r=s.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=o,o=t.child;o!==null;)i=o,e=r,i.flags&=14680066,s=i.alternate,s===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=s.childLanes,i.lanes=s.lanes,i.child=s.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=s.memoizedProps,i.memoizedState=s.memoizedState,i.updateQueue=s.updateQueue,i.type=s.type,e=s.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),o=o.sibling;return Yt(tn,tn.current&1|2),t.child}e=e.sibling}i.tail!==null&&ln()>La&&(t.flags|=128,r=!0,ri(i,!1),t.lanes=4194304)}else{if(!r)if(e=gl(s),e!==null){if(t.flags|=128,r=!0,o=e.updateQueue,o!==null&&(t.updateQueue=o,t.flags|=4),ri(i,!0),i.tail===null&&i.tailMode==="hidden"&&!s.alternate&&!en)return Pn(t),null}else 2*ln()-i.renderingStartTime>La&&o!==1073741824&&(t.flags|=128,r=!0,ri(i,!1),t.lanes=4194304);i.isBackwards?(s.sibling=t.child,t.child=s):(o=i.last,o!==null?o.sibling=s:t.child=s,i.last=s)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=ln(),t.sibling=null,o=tn.current,Yt(tn,r?o&1|2:o&1),t):(Pn(t),null);case 22:case 23:return Ip(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?Kn&1073741824&&(Pn(t),t.subtreeFlags&6&&(t.flags|=8192)):Pn(t),null;case 24:return null;case 25:return null}throw Error(ct(156,t.tag))}function Tw(e,t){switch(dp(t),t.tag){case 1:return Vn(t.type)&&ll(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Ra(),Qt(Un),Qt(Rn),vp(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return yp(t),null;case 13:if(Qt(tn),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(ct(340));Ta()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Qt(tn),null;case 4:return Ra(),null;case 10:return mp(t.type._context),null;case 22:case 23:return Ip(),null;case 24:return null;default:return null}}var us=!1,jn=!1,Aw=typeof WeakSet=="function"?WeakSet:Set,vt=null;function xa(e,t){var o=e.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(r){sn(e,t,r)}else o.current=null}function au(e,t,o){try{o()}catch(r){sn(e,t,r)}}var sm=!1;function Rw(e,t){if(Hd=rl,e=Uf(),lp(e)){if("selectionStart"in e)var o={start:e.selectionStart,end:e.selectionEnd};else e:{o=(o=e.ownerDocument)&&o.defaultView||window;var r=o.getSelection&&o.getSelection();if(r&&r.rangeCount!==0){o=r.anchorNode;var a=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{o.nodeType,i.nodeType}catch{o=null;break e}var s=0,l=-1,c=-1,d=0,u=0,p=e,m=null;t:for(;;){for(var w;p!==o||a!==0&&p.nodeType!==3||(l=s+a),p!==i||r!==0&&p.nodeType!==3||(c=s+r),p.nodeType===3&&(s+=p.nodeValue.length),(w=p.firstChild)!==null;)m=p,p=w;for(;;){if(p===e)break t;if(m===o&&++d===a&&(l=s),m===i&&++u===r&&(c=s),(w=p.nextSibling)!==null)break;p=m,m=p.parentNode}p=w}o=l===-1||c===-1?null:{start:l,end:c}}else o=null}o=o||{start:0,end:0}}else o=null;for(Gd={focusedElem:e,selectionRange:o},rl=!1,vt=t;vt!==null;)if(t=vt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,vt=e;else for(;vt!==null;){t=vt;try{var k=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(k!==null){var b=k.memoizedProps,x=k.memoizedState,f=t.stateNode,h=f.getSnapshotBeforeUpdate(t.elementType===t.type?b:go(t.type,b),x);f.__reactInternalSnapshotBeforeUpdate=h}break;case 3:var v=t.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ct(163))}}catch(N){sn(t,t.return,N)}if(e=t.sibling,e!==null){e.return=t.return,vt=e;break}vt=t.return}return k=sm,sm=!1,k}function wi(e,t,o){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,i!==void 0&&au(t,o,i)}a=a.next}while(a!==r)}}function Gl(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var o=t=t.next;do{if((o.tag&e)===e){var r=o.create;o.destroy=r()}o=o.next}while(o!==t)}}function iu(e){var t=e.ref;if(t!==null){var o=e.stateNode;switch(e.tag){case 5:e=o;break;default:e=o}typeof t=="function"?t(e):t.current=e}}function Fx(e){var t=e.alternate;t!==null&&(e.alternate=null,Fx(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Io],delete t[Ri],delete t[Wd],delete t[gw],delete t[fw])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Bx(e){return e.tag===5||e.tag===3||e.tag===4}function lm(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Bx(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function su(e,t,o){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?o.nodeType===8?o.parentNode.insertBefore(e,t):o.insertBefore(e,t):(o.nodeType===8?(t=o.parentNode,t.insertBefore(e,o)):(t=o,t.appendChild(e)),o=o._reactRootContainer,o!=null||t.onclick!==null||(t.onclick=sl));else if(r!==4&&(e=e.child,e!==null))for(su(e,t,o),e=e.sibling;e!==null;)su(e,t,o),e=e.sibling}function lu(e,t,o){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?o.insertBefore(e,t):o.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(lu(e,t,o),e=e.sibling;e!==null;)lu(e,t,o),e=e.sibling}var _n=null,fo=!1;function tr(e,t,o){for(o=o.child;o!==null;)Hx(e,t,o),o=o.sibling}function Hx(e,t,o){if(Ro&&typeof Ro.onCommitFiberUnmount=="function")try{Ro.onCommitFiberUnmount(Ll,o)}catch{}switch(o.tag){case 5:jn||xa(o,t);case 6:var r=_n,a=fo;_n=null,tr(e,t,o),_n=r,fo=a,_n!==null&&(fo?(e=_n,o=o.stateNode,e.nodeType===8?e.parentNode.removeChild(o):e.removeChild(o)):_n.removeChild(o.stateNode));break;case 18:_n!==null&&(fo?(e=_n,o=o.stateNode,e.nodeType===8?Vc(e.parentNode,o):e.nodeType===1&&Vc(e,o),Pi(e)):Vc(_n,o.stateNode));break;case 4:r=_n,a=fo,_n=o.stateNode.containerInfo,fo=!0,tr(e,t,o),_n=r,fo=a;break;case 0:case 11:case 14:case 15:if(!jn&&(r=o.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var i=a,s=i.destroy;i=i.tag,s!==void 0&&(i&2||i&4)&&au(o,t,s),a=a.next}while(a!==r)}tr(e,t,o);break;case 1:if(!jn&&(xa(o,t),r=o.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=o.memoizedProps,r.state=o.memoizedState,r.componentWillUnmount()}catch(l){sn(o,t,l)}tr(e,t,o);break;case 21:tr(e,t,o);break;case 22:o.mode&1?(jn=(r=jn)||o.memoizedState!==null,tr(e,t,o),jn=r):tr(e,t,o);break;default:tr(e,t,o)}}function cm(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var o=e.stateNode;o===null&&(o=e.stateNode=new Aw),t.forEach(function(r){var a=Hw.bind(null,e,r);o.has(r)||(o.add(r),r.then(a,a))})}}function ho(e,t){var o=t.deletions;if(o!==null)for(var r=0;r<o.length;r++){var a=o[r];try{var i=e,s=t,l=s;e:for(;l!==null;){switch(l.tag){case 5:_n=l.stateNode,fo=!1;break e;case 3:_n=l.stateNode.containerInfo,fo=!0;break e;case 4:_n=l.stateNode.containerInfo,fo=!0;break e}l=l.return}if(_n===null)throw Error(ct(160));Hx(i,s,a),_n=null,fo=!1;var c=a.alternate;c!==null&&(c.return=null),a.return=null}catch(d){sn(a,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Gx(t,e),t=t.sibling}function Gx(e,t){var o=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ho(t,e),_o(e),r&4){try{wi(3,e,e.return),Gl(3,e)}catch(b){sn(e,e.return,b)}try{wi(5,e,e.return)}catch(b){sn(e,e.return,b)}}break;case 1:ho(t,e),_o(e),r&512&&o!==null&&xa(o,o.return);break;case 5:if(ho(t,e),_o(e),r&512&&o!==null&&xa(o,o.return),e.flags&32){var a=e.stateNode;try{_i(a,"")}catch(b){sn(e,e.return,b)}}if(r&4&&(a=e.stateNode,a!=null)){var i=e.memoizedProps,s=o!==null?o.memoizedProps:i,l=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&uf(a,i),Ad(l,s);var d=Ad(l,i);for(s=0;s<c.length;s+=2){var u=c[s],p=c[s+1];u==="style"?ff(a,p):u==="dangerouslySetInnerHTML"?mf(a,p):u==="children"?_i(a,p):Ju(a,u,p,d)}switch(l){case"input":Ed(a,i);break;case"textarea":pf(a,i);break;case"select":var m=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!i.multiple;var w=i.value;w!=null?ba(a,!!i.multiple,w,!1):m!==!!i.multiple&&(i.defaultValue!=null?ba(a,!!i.multiple,i.defaultValue,!0):ba(a,!!i.multiple,i.multiple?[]:"",!1))}a[Ri]=i}catch(b){sn(e,e.return,b)}}break;case 6:if(ho(t,e),_o(e),r&4){if(e.stateNode===null)throw Error(ct(162));a=e.stateNode,i=e.memoizedProps;try{a.nodeValue=i}catch(b){sn(e,e.return,b)}}break;case 3:if(ho(t,e),_o(e),r&4&&o!==null&&o.memoizedState.isDehydrated)try{Pi(t.containerInfo)}catch(b){sn(e,e.return,b)}break;case 4:ho(t,e),_o(e);break;case 13:ho(t,e),_o(e),a=e.child,a.flags&8192&&(i=a.memoizedState!==null,a.stateNode.isHidden=i,!i||a.alternate!==null&&a.alternate.memoizedState!==null||(Pp=ln())),r&4&&cm(e);break;case 22:if(u=o!==null&&o.memoizedState!==null,e.mode&1?(jn=(d=jn)||u,ho(t,e),jn=d):ho(t,e),_o(e),r&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!u&&e.mode&1)for(vt=e,u=e.child;u!==null;){for(p=vt=u;vt!==null;){switch(m=vt,w=m.child,m.tag){case 0:case 11:case 14:case 15:wi(4,m,m.return);break;case 1:xa(m,m.return);var k=m.stateNode;if(typeof k.componentWillUnmount=="function"){r=m,o=m.return;try{t=r,k.props=t.memoizedProps,k.state=t.memoizedState,k.componentWillUnmount()}catch(b){sn(r,o,b)}}break;case 5:xa(m,m.return);break;case 22:if(m.memoizedState!==null){um(p);continue}}w!==null?(w.return=m,vt=w):um(p)}u=u.sibling}e:for(u=null,p=e;;){if(p.tag===5){if(u===null){u=p;try{a=p.stateNode,d?(i=a.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=p.stateNode,c=p.memoizedProps.style,s=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=gf("display",s))}catch(b){sn(e,e.return,b)}}}else if(p.tag===6){if(u===null)try{p.stateNode.nodeValue=d?"":p.memoizedProps}catch(b){sn(e,e.return,b)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===e)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===e)break e;for(;p.sibling===null;){if(p.return===null||p.return===e)break e;u===p&&(u=null),p=p.return}u===p&&(u=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:ho(t,e),_o(e),r&4&&cm(e);break;case 21:break;default:ho(t,e),_o(e)}}function _o(e){var t=e.flags;if(t&2){try{e:{for(var o=e.return;o!==null;){if(Bx(o)){var r=o;break e}o=o.return}throw Error(ct(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(_i(a,""),r.flags&=-33);var i=lm(e);lu(e,i,a);break;case 3:case 4:var s=r.stateNode.containerInfo,l=lm(e);su(e,l,s);break;default:throw Error(ct(161))}}catch(c){sn(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Mw(e,t,o){vt=e,Ux(e)}function Ux(e,t,o){for(var r=(e.mode&1)!==0;vt!==null;){var a=vt,i=a.child;if(a.tag===22&&r){var s=a.memoizedState!==null||us;if(!s){var l=a.alternate,c=l!==null&&l.memoizedState!==null||jn;l=us;var d=jn;if(us=s,(jn=c)&&!d)for(vt=a;vt!==null;)s=vt,c=s.child,s.tag===22&&s.memoizedState!==null?pm(a):c!==null?(c.return=s,vt=c):pm(a);for(;i!==null;)vt=i,Ux(i),i=i.sibling;vt=a,us=l,jn=d}dm(e)}else a.subtreeFlags&8772&&i!==null?(i.return=a,vt=i):dm(e)}}function dm(e){for(;vt!==null;){var t=vt;if(t.flags&8772){var o=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:jn||Gl(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!jn)if(o===null)r.componentDidMount();else{var a=t.elementType===t.type?o.memoizedProps:go(t.type,o.memoizedProps);r.componentDidUpdate(a,o.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&Kh(t,i,r);break;case 3:var s=t.updateQueue;if(s!==null){if(o=null,t.child!==null)switch(t.child.tag){case 5:o=t.child.stateNode;break;case 1:o=t.child.stateNode}Kh(t,s,o)}break;case 5:var l=t.stateNode;if(o===null&&t.flags&4){o=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&o.focus();break;case"img":c.src&&(o.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var p=u.dehydrated;p!==null&&Pi(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ct(163))}jn||t.flags&512&&iu(t)}catch(m){sn(t,t.return,m)}}if(t===e){vt=null;break}if(o=t.sibling,o!==null){o.return=t.return,vt=o;break}vt=t.return}}function um(e){for(;vt!==null;){var t=vt;if(t===e){vt=null;break}var o=t.sibling;if(o!==null){o.return=t.return,vt=o;break}vt=t.return}}function pm(e){for(;vt!==null;){var t=vt;try{switch(t.tag){case 0:case 11:case 15:var o=t.return;try{Gl(4,t)}catch(c){sn(t,o,c)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var a=t.return;try{r.componentDidMount()}catch(c){sn(t,a,c)}}var i=t.return;try{iu(t)}catch(c){sn(t,i,c)}break;case 5:var s=t.return;try{iu(t)}catch(c){sn(t,s,c)}}}catch(c){sn(t,t.return,c)}if(t===e){vt=null;break}var l=t.sibling;if(l!==null){l.return=t.return,vt=l;break}vt=t.return}}var Lw=Math.ceil,yl=Yo.ReactCurrentDispatcher,Np=Yo.ReactCurrentOwner,io=Yo.ReactCurrentBatchConfig,qt=0,bn=null,un=null,Sn=0,Kn=0,ya=Sr(0),fn=0,Oi=null,Gr=0,Ul=0,Ep=0,bi=null,Hn=null,Pp=0,La=1/0,Fo=null,vl=!1,cu=null,yr=null,ps=!1,pr=null,wl=0,Ci=0,du=null,Hs=-1,Gs=0;function Dn(){return qt&6?ln():Hs!==-1?Hs:Hs=ln()}function vr(e){return e.mode&1?qt&2&&Sn!==0?Sn&-Sn:yw.transition!==null?(Gs===0&&(Gs=Pf()),Gs):(e=Vt,e!==0||(e=window.event,e=e===void 0?16:Lf(e.type)),e):1}function vo(e,t,o,r){if(50<Ci)throw Ci=0,du=null,Error(ct(185));Gi(e,o,r),(!(qt&2)||e!==bn)&&(e===bn&&(!(qt&2)&&(Ul|=o),fn===4&&dr(e,Sn)),Wn(e,r),o===1&&qt===0&&!(t.mode&1)&&(La=ln()+500,Fl&&Nr()))}function Wn(e,t){var o=e.callbackNode;y2(e,t);var r=ol(e,e===bn?Sn:0);if(r===0)o!==null&&bh(o),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(o!=null&&bh(o),t===1)e.tag===0?xw(hm.bind(null,e)):ex(hm.bind(null,e)),hw(function(){!(qt&6)&&Nr()}),o=null;else{switch(jf(r)){case 1:o=ep;break;case 4:o=Nf;break;case 16:o=nl;break;case 536870912:o=Ef;break;default:o=nl}o=Zx(o,Vx.bind(null,e))}e.callbackPriority=t,e.callbackNode=o}}function Vx(e,t){if(Hs=-1,Gs=0,qt&6)throw Error(ct(327));var o=e.callbackNode;if(Na()&&e.callbackNode!==o)return null;var r=ol(e,e===bn?Sn:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=bl(e,r);else{t=r;var a=qt;qt|=2;var i=$x();(bn!==e||Sn!==t)&&(Fo=null,La=ln()+500,Dr(e,t));do try{qw();break}catch(l){Wx(e,l)}while(!0);hp(),yl.current=i,qt=a,un!==null?t=0:(bn=null,Sn=0,t=fn)}if(t!==0){if(t===2&&(a=zd(e),a!==0&&(r=a,t=uu(e,a))),t===1)throw o=Oi,Dr(e,0),dr(e,r),Wn(e,ln()),o;if(t===6)dr(e,r);else{if(a=e.current.alternate,!(r&30)&&!Dw(a)&&(t=bl(e,r),t===2&&(i=zd(e),i!==0&&(r=i,t=uu(e,i))),t===1))throw o=Oi,Dr(e,0),dr(e,r),Wn(e,ln()),o;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(ct(345));case 2:Tr(e,Hn,Fo);break;case 3:if(dr(e,r),(r&130023424)===r&&(t=Pp+500-ln(),10<t)){if(ol(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){Dn(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=Vd(Tr.bind(null,e,Hn,Fo),t);break}Tr(e,Hn,Fo);break;case 4:if(dr(e,r),(r&4194240)===r)break;for(t=e.eventTimes,a=-1;0<r;){var s=31-yo(r);i=1<<s,s=t[s],s>a&&(a=s),r&=~i}if(r=a,r=ln()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Lw(r/1960))-r,10<r){e.timeoutHandle=Vd(Tr.bind(null,e,Hn,Fo),r);break}Tr(e,Hn,Fo);break;case 5:Tr(e,Hn,Fo);break;default:throw Error(ct(329))}}}return Wn(e,ln()),e.callbackNode===o?Vx.bind(null,e):null}function uu(e,t){var o=bi;return e.current.memoizedState.isDehydrated&&(Dr(e,t).flags|=256),e=bl(e,t),e!==2&&(t=Hn,Hn=o,t!==null&&pu(t)),e}function pu(e){Hn===null?Hn=e:Hn.push.apply(Hn,e)}function Dw(e){for(var t=e;;){if(t.flags&16384){var o=t.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var r=0;r<o.length;r++){var a=o[r],i=a.getSnapshot;a=a.value;try{if(!Co(i(),a))return!1}catch{return!1}}}if(o=t.child,t.subtreeFlags&16384&&o!==null)o.return=t,t=o;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function dr(e,t){for(t&=~Ep,t&=~Ul,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var o=31-yo(t),r=1<<o;e[o]=-1,t&=~r}}function hm(e){if(qt&6)throw Error(ct(327));Na();var t=ol(e,0);if(!(t&1))return Wn(e,ln()),null;var o=bl(e,t);if(e.tag!==0&&o===2){var r=zd(e);r!==0&&(t=r,o=uu(e,r))}if(o===1)throw o=Oi,Dr(e,0),dr(e,t),Wn(e,ln()),o;if(o===6)throw Error(ct(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Tr(e,Hn,Fo),Wn(e,ln()),null}function jp(e,t){var o=qt;qt|=1;try{return e(t)}finally{qt=o,qt===0&&(La=ln()+500,Fl&&Nr())}}function Ur(e){pr!==null&&pr.tag===0&&!(qt&6)&&Na();var t=qt;qt|=1;var o=io.transition,r=Vt;try{if(io.transition=null,Vt=1,e)return e()}finally{Vt=r,io.transition=o,qt=t,!(qt&6)&&Nr()}}function Ip(){Kn=ya.current,Qt(ya)}function Dr(e,t){e.finishedWork=null,e.finishedLanes=0;var o=e.timeoutHandle;if(o!==-1&&(e.timeoutHandle=-1,pw(o)),un!==null)for(o=un.return;o!==null;){var r=o;switch(dp(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&ll();break;case 3:Ra(),Qt(Un),Qt(Rn),vp();break;case 5:yp(r);break;case 4:Ra();break;case 13:Qt(tn);break;case 19:Qt(tn);break;case 10:mp(r.type._context);break;case 22:case 23:Ip()}o=o.return}if(bn=e,un=e=wr(e.current,null),Sn=Kn=t,fn=0,Oi=null,Ep=Ul=Gr=0,Hn=bi=null,Mr!==null){for(t=0;t<Mr.length;t++)if(o=Mr[t],r=o.interleaved,r!==null){o.interleaved=null;var a=r.next,i=o.pending;if(i!==null){var s=i.next;i.next=a,r.next=s}o.pending=r}Mr=null}return e}function Wx(e,t){do{var o=un;try{if(hp(),Os.current=xl,fl){for(var r=nn.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}fl=!1}if(Hr=0,wn=gn=nn=null,vi=!1,Di=0,Np.current=null,o===null||o.return===null){fn=1,Oi=t,un=null;break}e:{var i=e,s=o.return,l=o,c=t;if(t=Sn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,p=u.tag;if(!(u.mode&1)&&(p===0||p===11||p===15)){var m=u.alternate;m?(u.updateQueue=m.updateQueue,u.memoizedState=m.memoizedState,u.lanes=m.lanes):(u.updateQueue=null,u.memoizedState=null)}var w=em(s);if(w!==null){w.flags&=-257,tm(w,s,l,i,t),w.mode&1&&Qh(i,d,t),t=w,c=d;var k=t.updateQueue;if(k===null){var b=new Set;b.add(c),t.updateQueue=b}else k.add(c);break e}else{if(!(t&1)){Qh(i,d,t),Tp();break e}c=Error(ct(426))}}else if(en&&l.mode&1){var x=em(s);if(x!==null){!(x.flags&65536)&&(x.flags|=256),tm(x,s,l,i,t),up(Ma(c,l));break e}}i=c=Ma(c,l),fn!==4&&(fn=2),bi===null?bi=[i]:bi.push(i),i=s;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var f=jx(i,c,t);$h(i,f);break e;case 1:l=c;var h=i.type,v=i.stateNode;if(!(i.flags&128)&&(typeof h.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(yr===null||!yr.has(v)))){i.flags|=65536,t&=-t,i.lanes|=t;var N=Ix(i,l,t);$h(i,N);break e}}i=i.return}while(i!==null)}Jx(o)}catch(_){t=_,un===o&&o!==null&&(un=o=o.return);continue}break}while(!0)}function $x(){var e=yl.current;return yl.current=xl,e===null?xl:e}function Tp(){(fn===0||fn===3||fn===2)&&(fn=4),bn===null||!(Gr&268435455)&&!(Ul&268435455)||dr(bn,Sn)}function bl(e,t){var o=qt;qt|=2;var r=$x();(bn!==e||Sn!==t)&&(Fo=null,Dr(e,t));do try{zw();break}catch(a){Wx(e,a)}while(!0);if(hp(),qt=o,yl.current=r,un!==null)throw Error(ct(261));return bn=null,Sn=0,fn}function zw(){for(;un!==null;)Kx(un)}function qw(){for(;un!==null&&!c2();)Kx(un)}function Kx(e){var t=Xx(e.alternate,e,Kn);e.memoizedProps=e.pendingProps,t===null?Jx(e):un=t,Np.current=null}function Jx(e){var t=e;do{var o=t.alternate;if(e=t.return,t.flags&32768){if(o=Tw(o,t),o!==null){o.flags&=32767,un=o;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{fn=6,un=null;return}}else if(o=Iw(o,t,Kn),o!==null){un=o;return}if(t=t.sibling,t!==null){un=t;return}un=t=e}while(t!==null);fn===0&&(fn=5)}function Tr(e,t,o){var r=Vt,a=io.transition;try{io.transition=null,Vt=1,Ow(e,t,o,r)}finally{io.transition=a,Vt=r}return null}function Ow(e,t,o,r){do Na();while(pr!==null);if(qt&6)throw Error(ct(327));o=e.finishedWork;var a=e.finishedLanes;if(o===null)return null;if(e.finishedWork=null,e.finishedLanes=0,o===e.current)throw Error(ct(177));e.callbackNode=null,e.callbackPriority=0;var i=o.lanes|o.childLanes;if(v2(e,i),e===bn&&(un=bn=null,Sn=0),!(o.subtreeFlags&2064)&&!(o.flags&2064)||ps||(ps=!0,Zx(nl,function(){return Na(),null})),i=(o.flags&15990)!==0,o.subtreeFlags&15990||i){i=io.transition,io.transition=null;var s=Vt;Vt=1;var l=qt;qt|=4,Np.current=null,Rw(e,o),Gx(o,e),aw(Gd),rl=!!Hd,Gd=Hd=null,e.current=o,Mw(o),d2(),qt=l,Vt=s,io.transition=i}else e.current=o;if(ps&&(ps=!1,pr=e,wl=a),i=e.pendingLanes,i===0&&(yr=null),h2(o.stateNode),Wn(e,ln()),t!==null)for(r=e.onRecoverableError,o=0;o<t.length;o++)a=t[o],r(a.value,{componentStack:a.stack,digest:a.digest});if(vl)throw vl=!1,e=cu,cu=null,e;return wl&1&&e.tag!==0&&Na(),i=e.pendingLanes,i&1?e===du?Ci++:(Ci=0,du=e):Ci=0,Nr(),null}function Na(){if(pr!==null){var e=jf(wl),t=io.transition,o=Vt;try{if(io.transition=null,Vt=16>e?16:e,pr===null)var r=!1;else{if(e=pr,pr=null,wl=0,qt&6)throw Error(ct(331));var a=qt;for(qt|=4,vt=e.current;vt!==null;){var i=vt,s=i.child;if(vt.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(vt=d;vt!==null;){var u=vt;switch(u.tag){case 0:case 11:case 15:wi(8,u,i)}var p=u.child;if(p!==null)p.return=u,vt=p;else for(;vt!==null;){u=vt;var m=u.sibling,w=u.return;if(Fx(u),u===d){vt=null;break}if(m!==null){m.return=w,vt=m;break}vt=w}}}var k=i.alternate;if(k!==null){var b=k.child;if(b!==null){k.child=null;do{var x=b.sibling;b.sibling=null,b=x}while(b!==null)}}vt=i}}if(i.subtreeFlags&2064&&s!==null)s.return=i,vt=s;else e:for(;vt!==null;){if(i=vt,i.flags&2048)switch(i.tag){case 0:case 11:case 15:wi(9,i,i.return)}var f=i.sibling;if(f!==null){f.return=i.return,vt=f;break e}vt=i.return}}var h=e.current;for(vt=h;vt!==null;){s=vt;var v=s.child;if(s.subtreeFlags&2064&&v!==null)v.return=s,vt=v;else e:for(s=h;vt!==null;){if(l=vt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Gl(9,l)}}catch(_){sn(l,l.return,_)}if(l===s){vt=null;break e}var N=l.sibling;if(N!==null){N.return=l.return,vt=N;break e}vt=l.return}}if(qt=a,Nr(),Ro&&typeof Ro.onPostCommitFiberRoot=="function")try{Ro.onPostCommitFiberRoot(Ll,e)}catch{}r=!0}return r}finally{Vt=o,io.transition=t}}return!1}function mm(e,t,o){t=Ma(o,t),t=jx(e,t,1),e=xr(e,t,1),t=Dn(),e!==null&&(Gi(e,1,t),Wn(e,t))}function sn(e,t,o){if(e.tag===3)mm(e,e,o);else for(;t!==null;){if(t.tag===3){mm(t,e,o);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(yr===null||!yr.has(r))){e=Ma(o,e),e=Ix(t,e,1),t=xr(t,e,1),e=Dn(),t!==null&&(Gi(t,1,e),Wn(t,e));break}}t=t.return}}function Fw(e,t,o){var r=e.pingCache;r!==null&&r.delete(t),t=Dn(),e.pingedLanes|=e.suspendedLanes&o,bn===e&&(Sn&o)===o&&(fn===4||fn===3&&(Sn&130023424)===Sn&&500>ln()-Pp?Dr(e,0):Ep|=o),Wn(e,t)}function Yx(e,t){t===0&&(e.mode&1?(t=ns,ns<<=1,!(ns&130023424)&&(ns=4194304)):t=1);var o=Dn();e=$o(e,t),e!==null&&(Gi(e,t,o),Wn(e,o))}function Bw(e){var t=e.memoizedState,o=0;t!==null&&(o=t.retryLane),Yx(e,o)}function Hw(e,t){var o=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(o=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(ct(314))}r!==null&&r.delete(t),Yx(e,o)}var Xx;Xx=function(e,t,o){if(e!==null)if(e.memoizedProps!==t.pendingProps||Un.current)Gn=!0;else{if(!(e.lanes&o)&&!(t.flags&128))return Gn=!1,jw(e,t,o);Gn=!!(e.flags&131072)}else Gn=!1,en&&t.flags&1048576&&tx(t,ul,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Bs(e,t),e=t.pendingProps;var a=Ia(t,Rn.current);Sa(t,o),a=bp(null,t,r,e,a,o);var i=Cp();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Vn(r)?(i=!0,cl(t)):i=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,fp(t),a.updater=Hl,t.stateNode=a,a._reactInternals=t,Zd(t,r,e,o),t=tu(null,t,r,!0,i,o)):(t.tag=0,en&&i&&cp(t),Ln(null,t,a,o),t=t.child),t;case 16:r=t.elementType;e:{switch(Bs(e,t),e=t.pendingProps,a=r._init,r=a(r._payload),t.type=r,a=t.tag=Uw(r),e=go(r,e),a){case 0:t=eu(null,t,r,e,o);break e;case 1:t=rm(null,t,r,e,o);break e;case 11:t=nm(null,t,r,e,o);break e;case 14:t=om(null,t,r,go(r.type,e),o);break e}throw Error(ct(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:go(r,a),eu(e,t,r,a,o);case 1:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:go(r,a),rm(e,t,r,a,o);case 3:e:{if(Mx(t),e===null)throw Error(ct(387));r=t.pendingProps,i=t.memoizedState,a=i.element,sx(e,t),ml(t,r,null,o);var s=t.memoizedState;if(r=s.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){a=Ma(Error(ct(423)),t),t=am(e,t,r,o,a);break e}else if(r!==a){a=Ma(Error(ct(424)),t),t=am(e,t,r,o,a);break e}else for(Yn=fr(t.stateNode.containerInfo.firstChild),Zn=t,en=!0,xo=null,o=ax(t,null,r,o),t.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(Ta(),r===a){t=Ko(e,t,o);break e}Ln(e,t,r,o)}t=t.child}return t;case 5:return lx(t),e===null&&Jd(t),r=t.type,a=t.pendingProps,i=e!==null?e.memoizedProps:null,s=a.children,Ud(r,a)?s=null:i!==null&&Ud(r,i)&&(t.flags|=32),Rx(e,t),Ln(e,t,s,o),t.child;case 6:return e===null&&Jd(t),null;case 13:return Lx(e,t,o);case 4:return xp(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Aa(t,null,r,o):Ln(e,t,r,o),t.child;case 11:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:go(r,a),nm(e,t,r,a,o);case 7:return Ln(e,t,t.pendingProps,o),t.child;case 8:return Ln(e,t,t.pendingProps.children,o),t.child;case 12:return Ln(e,t,t.pendingProps.children,o),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,i=t.memoizedProps,s=a.value,Yt(pl,r._currentValue),r._currentValue=s,i!==null)if(Co(i.value,s)){if(i.children===a.children&&!Un.current){t=Ko(e,t,o);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var l=i.dependencies;if(l!==null){s=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=Uo(-1,o&-o),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}i.lanes|=o,c=i.alternate,c!==null&&(c.lanes|=o),Yd(i.return,o,t),l.lanes|=o;break}c=c.next}}else if(i.tag===10)s=i.type===t.type?null:i.child;else if(i.tag===18){if(s=i.return,s===null)throw Error(ct(341));s.lanes|=o,l=s.alternate,l!==null&&(l.lanes|=o),Yd(s,o,t),s=i.sibling}else s=i.child;if(s!==null)s.return=i;else for(s=i;s!==null;){if(s===t){s=null;break}if(i=s.sibling,i!==null){i.return=s.return,s=i;break}s=s.return}i=s}Ln(e,t,a.children,o),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Sa(t,o),a=lo(a),r=r(a),t.flags|=1,Ln(e,t,r,o),t.child;case 14:return r=t.type,a=go(r,t.pendingProps),a=go(r.type,a),om(e,t,r,a,o);case 15:return Tx(e,t,t.type,t.pendingProps,o);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:go(r,a),Bs(e,t),t.tag=1,Vn(r)?(e=!0,cl(t)):e=!1,Sa(t,o),Px(t,r,a),Zd(t,r,a,o),tu(null,t,r,!0,e,o);case 19:return Dx(e,t,o);case 22:return Ax(e,t,o)}throw Error(ct(156,t.tag))};function Zx(e,t){return Sf(e,t)}function Gw(e,t,o,r){this.tag=e,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ao(e,t,o,r){return new Gw(e,t,o,r)}function Ap(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Uw(e){if(typeof e=="function")return Ap(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Xu)return 11;if(e===Zu)return 14}return 2}function wr(e,t){var o=e.alternate;return o===null?(o=ao(e.tag,t,e.key,e.mode),o.elementType=e.elementType,o.type=e.type,o.stateNode=e.stateNode,o.alternate=e,e.alternate=o):(o.pendingProps=t,o.type=e.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=e.flags&14680064,o.childLanes=e.childLanes,o.lanes=e.lanes,o.child=e.child,o.memoizedProps=e.memoizedProps,o.memoizedState=e.memoizedState,o.updateQueue=e.updateQueue,t=e.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},o.sibling=e.sibling,o.index=e.index,o.ref=e.ref,o}function Us(e,t,o,r,a,i){var s=2;if(r=e,typeof e=="function")Ap(e)&&(s=1);else if(typeof e=="string")s=5;else e:switch(e){case la:return zr(o.children,a,i,t);case Yu:s=8,a|=8;break;case Cd:return e=ao(12,o,t,a|2),e.elementType=Cd,e.lanes=i,e;case kd:return e=ao(13,o,t,a),e.elementType=kd,e.lanes=i,e;case _d:return e=ao(19,o,t,a),e.elementType=_d,e.lanes=i,e;case lf:return Vl(o,a,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case af:s=10;break e;case sf:s=9;break e;case Xu:s=11;break e;case Zu:s=14;break e;case sr:s=16,r=null;break e}throw Error(ct(130,e==null?e:typeof e,""))}return t=ao(s,o,t,a),t.elementType=e,t.type=r,t.lanes=i,t}function zr(e,t,o,r){return e=ao(7,e,r,t),e.lanes=o,e}function Vl(e,t,o,r){return e=ao(22,e,r,t),e.elementType=lf,e.lanes=o,e.stateNode={isHidden:!1},e}function Qc(e,t,o){return e=ao(6,e,null,t),e.lanes=o,e}function ed(e,t,o){return t=ao(4,e.children!==null?e.children:[],e.key,t),t.lanes=o,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Vw(e,t,o,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Mc(0),this.expirationTimes=Mc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Mc(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Rp(e,t,o,r,a,i,s,l,c){return e=new Vw(e,t,o,l,c),t===1?(t=1,i===!0&&(t|=8)):t=0,i=ao(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},fp(i),e}function Ww(e,t,o){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:sa,key:r==null?null:""+r,children:e,containerInfo:t,implementation:o}}function Qx(e){if(!e)return Cr;e=e._reactInternals;e:{if($r(e)!==e||e.tag!==1)throw Error(ct(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Vn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(ct(171))}if(e.tag===1){var o=e.type;if(Vn(o))return Qf(e,o,t)}return t}function e1(e,t,o,r,a,i,s,l,c){return e=Rp(o,r,!0,e,a,i,s,l,c),e.context=Qx(null),o=e.current,r=Dn(),a=vr(o),i=Uo(r,a),i.callback=t??null,xr(o,i,a),e.current.lanes=a,Gi(e,a,r),Wn(e,r),e}function Wl(e,t,o,r){var a=t.current,i=Dn(),s=vr(a);return o=Qx(o),t.context===null?t.context=o:t.pendingContext=o,t=Uo(i,s),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=xr(a,t,s),e!==null&&(vo(e,a,s,i),qs(e,a,s)),s}function Cl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function gm(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var o=e.retryLane;e.retryLane=o!==0&&o<t?o:t}}function Mp(e,t){gm(e,t),(e=e.alternate)&&gm(e,t)}function $w(){return null}var t1=typeof reportError=="function"?reportError:function(e){console.error(e)};function Lp(e){this._internalRoot=e}$l.prototype.render=Lp.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(ct(409));Wl(e,t,null,null)};$l.prototype.unmount=Lp.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Ur(function(){Wl(null,e,null,null)}),t[Wo]=null}};function $l(e){this._internalRoot=e}$l.prototype.unstable_scheduleHydration=function(e){if(e){var t=Af();e={blockedOn:null,target:e,priority:t};for(var o=0;o<cr.length&&t!==0&&t<cr[o].priority;o++);cr.splice(o,0,e),o===0&&Mf(e)}};function Dp(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Kl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function fm(){}function Kw(e,t,o,r,a){if(a){if(typeof r=="function"){var i=r;r=function(){var d=Cl(s);i.call(d)}}var s=e1(t,r,e,0,null,!1,!1,"",fm);return e._reactRootContainer=s,e[Wo]=s.current,Ti(e.nodeType===8?e.parentNode:e),Ur(),s}for(;a=e.lastChild;)e.removeChild(a);if(typeof r=="function"){var l=r;r=function(){var d=Cl(c);l.call(d)}}var c=Rp(e,0,!1,null,null,!1,!1,"",fm);return e._reactRootContainer=c,e[Wo]=c.current,Ti(e.nodeType===8?e.parentNode:e),Ur(function(){Wl(t,c,o,r)}),c}function Jl(e,t,o,r,a){var i=o._reactRootContainer;if(i){var s=i;if(typeof a=="function"){var l=a;a=function(){var c=Cl(s);l.call(c)}}Wl(t,s,e,a)}else s=Kw(o,t,e,a,r);return Cl(s)}If=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var o=di(t.pendingLanes);o!==0&&(tp(t,o|1),Wn(t,ln()),!(qt&6)&&(La=ln()+500,Nr()))}break;case 13:Ur(function(){var r=$o(e,1);if(r!==null){var a=Dn();vo(r,e,1,a)}}),Mp(e,1)}};np=function(e){if(e.tag===13){var t=$o(e,134217728);if(t!==null){var o=Dn();vo(t,e,134217728,o)}Mp(e,134217728)}};Tf=function(e){if(e.tag===13){var t=vr(e),o=$o(e,t);if(o!==null){var r=Dn();vo(o,e,t,r)}Mp(e,t)}};Af=function(){return Vt};Rf=function(e,t){var o=Vt;try{return Vt=e,t()}finally{Vt=o}};Md=function(e,t,o){switch(t){case"input":if(Ed(e,o),t=o.name,o.type==="radio"&&t!=null){for(o=e;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<o.length;t++){var r=o[t];if(r!==e&&r.form===e.form){var a=Ol(r);if(!a)throw Error(ct(90));df(r),Ed(r,a)}}}break;case"textarea":pf(e,o);break;case"select":t=o.value,t!=null&&ba(e,!!o.multiple,t,!1)}};vf=jp;wf=Ur;var Jw={usingClientEntryPoint:!1,Events:[Vi,pa,Ol,xf,yf,jp]},ai={findFiberByHostInstance:Rr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Yw={bundleType:ai.bundleType,version:ai.version,rendererPackageName:ai.rendererPackageName,rendererConfig:ai.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Yo.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=kf(e),e===null?null:e.stateNode},findFiberByHostInstance:ai.findFiberByHostInstance||$w,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var hs=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!hs.isDisabled&&hs.supportsFiber)try{Ll=hs.inject(Yw),Ro=hs}catch{}}eo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Jw;eo.createPortal=function(e,t){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Dp(t))throw Error(ct(200));return Ww(e,t,null,o)};eo.createRoot=function(e,t){if(!Dp(e))throw Error(ct(299));var o=!1,r="",a=t1;return t!=null&&(t.unstable_strictMode===!0&&(o=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=Rp(e,1,!1,null,null,o,!1,r,a),e[Wo]=t.current,Ti(e.nodeType===8?e.parentNode:e),new Lp(t)};eo.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(ct(188)):(e=Object.keys(e).join(","),Error(ct(268,e)));return e=kf(t),e=e===null?null:e.stateNode,e};eo.flushSync=function(e){return Ur(e)};eo.hydrate=function(e,t,o){if(!Kl(t))throw Error(ct(200));return Jl(null,e,t,!0,o)};eo.hydrateRoot=function(e,t,o){if(!Dp(e))throw Error(ct(405));var r=o!=null&&o.hydratedSources||null,a=!1,i="",s=t1;if(o!=null&&(o.unstable_strictMode===!0&&(a=!0),o.identifierPrefix!==void 0&&(i=o.identifierPrefix),o.onRecoverableError!==void 0&&(s=o.onRecoverableError)),t=e1(t,null,e,1,o??null,a,!1,i,s),e[Wo]=t.current,Ti(e),r)for(e=0;e<r.length;e++)o=r[e],a=o._getVersion,a=a(o._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[o,a]:t.mutableSourceEagerHydrationData.push(o,a);return new $l(t)};eo.render=function(e,t,o){if(!Kl(t))throw Error(ct(200));return Jl(null,e,t,!1,o)};eo.unmountComponentAtNode=function(e){if(!Kl(e))throw Error(ct(40));return e._reactRootContainer?(Ur(function(){Jl(null,null,e,!1,function(){e._reactRootContainer=null,e[Wo]=null})}),!0):!1};eo.unstable_batchedUpdates=jp;eo.unstable_renderSubtreeIntoContainer=function(e,t,o,r){if(!Kl(o))throw Error(ct(200));if(e==null||e._reactInternals===void 0)throw Error(ct(38));return Jl(e,t,o,!1,r)};eo.version="18.3.1-next-f1338f8080-20240426";function n1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n1)}catch(e){console.error(e)}}n1(),tf.exports=eo;var Va=tf.exports;const Xw=Hu(Va);var xm=Va;wd.createRoot=xm.createRoot,wd.hydrateRoot=xm.hydrateRoot;const Zw={"app.title":"Prompt Modifier","app.subtitle":"Connect ideas to create a masterpiece","app.error.title":"Notification","app.error.copy":"Copy Message","app.error.copied":"Copied!","error.apiKey":"Your API key is invalid or missing permissions. Please select a valid API key.","error.scriptModifierCanvas":"This canvas belongs to another application - Script Modifier. Please use Script Modifier to open this file.","welcome.title":"Welcome to","welcome.description":"Welcome to Prompt Modifier. Connect ideas to create masterpieces. Use nodes to generate and edit content.","welcome.apiKeyLabel":"API Key","welcome.apiKeyPlaceholder":"Enter your API key","welcome.apiKeyHelp":"Your API key is stored locally in your browser.","welcome.getKeyLink":"Get API Key","welcome.iAmDeveloper":"I am a Developer","welcome.letsGo":"Let's Go","welcome.resume":"Resume","welcome.startNew":"Start New Canvas","welcome.freeModeActive":"Free Mode Active","welcome.selectLanguage":"Select your primary language","welcome.navHint":"Use keyboard keys  and  to change language","toast.contentCleared":"Content cleared","toast.downloadStarted":"Download started","toast.characterLoaded":"Character card loaded","toast.characterSavedDisk":"Character card saved to disk","toast.copiedToClipboard":"Copied to clipboard","toast.pastedFromClipboard":"Pasted from clipboard","toast.pasteFailed":"Paste failed","toast.nodeDuplicated":"Node duplicated","toast.groupSavedToDisk":'Group "{groupTitle}" saved to disk',"toast.groupDeleted":"Group and contents deleted","toast.characterSavedCatalog":"Character saved to catalog","toast.promptSaved":"Prompt saved to library: {promptName}...","toast.connectionsCut":"Connections removed","toast.apiKeySaved":"API Key saved successfully","toast.cacheCleared":"Cleared {count} unused items from cache","toast.cacheEmpty":"Cache is already optimized","toast.scriptSaved":"Script saved to disk","toast.modificationComplete":"Character modified successfully","toast.canvasSaved":"Canvas saved successfully","toast.projectSaved":"Project saved successfully","alert.groupSaved":'Group "{groupTitle}" saved to catalog.',"alert.loadCatalogFailed":"Failed to load catalog file","alert.invalidCatalogFile":"Invalid catalog file format","alert.fileNotSupported":'File not supported. Missing or incorrect "appName".',"alert.invalidCatalogStructure":'Invalid catalog structure. Missing "root".',"tutorial.step1":"Click here to add a random word to the prompt.","tutorial.step2":'Click "Process Prompt" to combine inputs using AI.',"tutorial.step2_waiting":"The AI is currently analyzing your inputs and generating a technical prompt specification...","tutorial.step3":"Finally, click here to generate the image.","tutorial.step3b":"Generation takes some time. You can monitor the progress here.","tutorial.step4":"You can add new nodes manually from this toolbar.","tutorial.group.catalog":"Use the Catalog to search for nodes or manage groups.","tutorial.group.general":"Add Sticky Notes and Data Readers for debugging.","tutorial.group.input":"Basic inputs for text, images, and sequences.","tutorial.group.processing":"Analyze and process prompts or images with AI.","tutorial.group.character":"Create, analyze, and store detailed characters.","tutorial.group.output":"Display results and generate sequences.","tutorial.group.ai":"Chat with Gemini and translate text.","tutorial.group.video":"Tools for video prompts and editing.","tutorial.group.scripts":"Generate and view scripts for complex stories.","tutorial.group.file":"Save your work, load projects, or download the canvas.","tutorial.success.title":"Tutorial Completed!","tutorial.success.message":"You have successfully learned the basics of Prompt Modifier. Good luck creating masterpieces!","tutorial.success.button":"Start Creating","tutorial.skip":"Skip","tutorial.next":"Next","tutorial.finish":"Got it"},Qw={"toolbar.settings":"Settings","toolbar.resetCanvas":"Reset to Default","toolbar.clearCache":"Clear Unused Cache","toolbar.home":"Home","toolbar.exitApp":"Close Project","toolbar.edit":"Edit (V)","toolbar.cutter":"Cut Connection (C) / (Hold Ctrl)","toolbar.selection":"Selection (S) / (Hold Shift)","toolbar.reroute":"Reroute (R) / (Hold Ctrl+Alt)","toolbar.zoom":"Zoom (Hold Z)","toolbar.snapToGrid":"Snap to Grid","toolbar.smartGuides":"Smart Guides (Magnet)","toolbar.lineStyleSpaghetti":"Spaghetti Lines","toolbar.lineStyleOrthogonal":"Orthogonal Lines","toolbar.resetZoom":"Reset Zoom","toolbar.resetCamera":"Reset Camera Position","toolbar.clearCanvas":"Clear Canvas","toolbar.addNode":"Add Node (F)","toolbar.catalog":"Open Catalog (Ctrl + Space)","toolbar.addNote":"Add Note (N)","toolbar.addDataReader":"Add Data Reader (Shift + R)","toolbar.addTextInput":"Add Text Input (T)","toolbar.addImageInput":"Add Image Input (I)","toolbar.addPromptSequenceEditor":"Add Prompt Sequence Editor (Q)","toolbar.addImageAnalyzer":"Add Image Analyzer (Shift+A)","toolbar.addPromptAnalyzer":"Add Prompt Analyzer (A)","toolbar.addPromptProcessor":"Add Prompt Processor (P)","toolbar.addCharacterGenerator":"Add Character Generator (Shift+C)","toolbar.addCharacterAnalyzer":"Add Character Analyzer (Ctrl+Shift+A)","toolbar.addCharacterCard":"Add Character Card (Ctrl+Shift+C)","toolbar.addImageOutput":"Add Image Output (O)","toolbar.addImageEditor":"Add AI Image Editor (Shift+I)","toolbar.addImageSequenceGenerator":"Add Image Sequence Generator (Shift+Q)","toolbar.addTranslator":"Add Translator (L)","toolbar.addGeminiChat":"Add Gemini Chat (M)","toolbar.addVideoPromptProcessor":"Add Video Prompt Processor (Shift+P)","toolbar.addVideoOutput":"Add Video Output (Shift+O)","toolbar.addScriptGenerator":"Add Script Generator","toolbar.addScriptViewer":"Add Script Viewer (Shift + V)","toolbar.saveCanvas":"Save Canvas (Ctrl + S)","toolbar.saveProject":"Save Project","toolbar.saveToDrive":"Save to Google Drive","toolbar.loadCanvas":"Load Project/Canvas (Ctrl + O)","toolbar.group.general":"General","toolbar.group.catalog":"Catalog","toolbar.group.input":"Input","toolbar.group.processing":"Processing","toolbar.group.character":"Character","toolbar.group.output":"Output","toolbar.group.aiTools":"AI Tools","toolbar.group.video":"Video","toolbar.group.scripts":"Scripts","toolbar.group.file":"File","toolbar.title":"Toolbar","toolbar.dock":"Dock Toolbar","toolbar.detach":"Detach Toolbar","toolbar.expandPanel":"Expand Panel","toolbar.collapsePanel":"Collapse Panel","toolbar.dockArea.title":"Dock Toolbar Here","toolbar.duplicate":"Duplicate Node","toolbar.duplicateWithContent":"Duplicate with Content","toolbar.dock.q1":"Left 1st Qtr","toolbar.dock.q2":"Left 2nd Qtr","toolbar.dock.q3":"Right 3rd Qtr","toolbar.dock.q4":"Right 4th Qtr","toolbar.dock.tl":"Top Left","toolbar.dock.bl":"Bottom Left","toolbar.dock.tr":"Top Right","toolbar.dock.br":"Bottom Right","toolbar.dock.left":"Left Half","toolbar.dock.right":"Right Half","toolbar.dock.full":"Full Screen","toolbar.dock.exitFull":"Exit Full Screen","toolbar.dock.fullFocus":"Full Screen Focus","hotkeys.show":"Show Hotkeys","hotkeys.tools.title":"Tools","hotkeys.tools.edit":"Edit Mode","hotkeys.tools.cutter":"Cutter Tool","hotkeys.tools.selection":"Selection Tool","hotkeys.tools.reroute":"Reroute Tool","hotkeys.tools.zoom":"Zoom Tool","hotkeys.tools.toggleLineStyle":"Toggle Line Style","hotkeys.tools.group":"Group Selection","hotkeys.tools.closeNode":"Delete Selected","hotkeys.tools.duplicate":"Duplicate Node","hotkeys.tools.duplicateWithContent":"Duplicate with Content","hotkeys.tools.deleteGroup":"Delete Group (Shift+Click)","hotkeys.windows.title":"Windows","hotkeys.windows.search":"Quick Search","hotkeys.windows.catalog":"Catalog","hotkeys.createNode.title":"Create Node","help.panelTitle":"Help & Hotkeys","help.subtitle":"Help Center","help.title":"Keyboard Shortcuts","help.howToUse.title":"How to Use","help.howToUse.content":"Welcome to Prompt Modifier! Use the toolbar or hotkeys to add nodes. Connect nodes to pass data. Use the Edit tool to move nodes and pan the canvas. Double-click on empty space to open Quick Add menu. Right-click for context menu.","help.author":"Author","help.tab.links":"Other Apps & Links","help.section.socials":"Socials","help.section.studioStable":"Google AI Studio (Stable)","help.section.studioAlpha":"Google AI Studio (Alpha)","help.section.netlify":"Netlify Apps","help.section.github":"GitHub Repos","help.section.githubPages":"Applications on GitHub","help.license":"Licensed under GNU GPLv3","help.copyLink":"Copy Link","help.copied":"Copied!","contextMenu.undoPosition":"Undo Position","contextMenu.redoPosition":"Redo Position","contextMenu.align.left":"Align Left (F)","contextMenu.align.centerX":"Align Center X (E)","contextMenu.align.right":"Align Right (R)","contextMenu.align.top":"Align Top (T)","contextMenu.align.centerY":"Align Center Y (D)","contextMenu.align.bottom":"Align Bottom (B)","contextMenu.distribute.horizontal":"Distribute Horiz. (Ctrl+D)","contextMenu.distribute.vertical":"Distribute Vert. (Ctrl+E)","contextMenu.emptySlot":"Empty Slot (Right-click to assign)","contextMenu.saveSlots":"Save Slots Config","contextMenu.loadSlots":"Load Slots Config","quickadd.title":"Quick Add","quickadd.group.tools":"Tools","quickadd.group.inputs":"Inputs","quickadd.group.processing":"Processing","quickadd.group.character":"Character","quickadd.group.outputs":"Outputs","quickadd.group.ai":"AI Tools","quickadd.group.video":"Video","quickadd.group.scripts":"Scripts","quickadd.group.general":"General","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"Edit","quickadd.tool.cutter":"Cutter","quickadd.tool.selection":"Selection","search.placeholder":"Search for a node to add...","search.noResults":"No nodes found.","search.group.input":"Input & Basic","search.group.process":"Processing & Character","search.group.output":"Image & Sequence","search.group.ai":"AI Tools","search.group.video":"Video & Scripting","search.group.scripts":"Scripts","toolbar.enterFullScreen":"Full Screen","toolbar.exitFullScreen":"Exit Full Screen","dialog.settings.hoverHighlightLabel":"Node Hover Highlight"},eb={"node.title.text_input":"Text Input","node.title.image_input":"Image Input","node.title.prompt_processor":"Prompt Processor","node.title.prompt_sanitizer":"Prompt Sanitizer","node.title.video_prompt_processor":"Video Prompt Proc.","node.title.image_output":"Image Output","node.title.video_output":"Video Output","node.title.prompt_analyzer":"Prompt Analyzer","node.title.character_analyzer":"Character Analyzer","node.title.character_generator":"Character Generator","node.title.character_card":"Character Card","node.title.image_analyzer":"Image Analyzer","node.title.image_editor":"AI Image Editor","node.title.image_sequence_generator":"Image Sequence Gen.","node.title.prompt_sequence_editor":"Prompt Sequence Editor","node.title.gemini_chat":"Gemini Chat","node.title.translator":"Translator","node.title.script_generator":"Script Generator","node.title.script_viewer":"Script Viewer","node.title.note":"Note","node.title.reroute_dot":"Reroute Dot","node.title.data_reader":"Data Reader","node.title.video_editor":"Video Editor Alpha","node.title.media_viewer":"Media Viewer","node.title.data_protection":"Data Protection","node.title.pose_creator":"Pose Creator","node.help.text_input":"A simple multiline text field for entering prompts or notes.","node.help.image_input":"Allows you to upload or paste an image to use as input for other nodes.","node.help.prompt_processor":"Combines multiple text inputs into a single, technical prompt specification using AI.","node.help.prompt_sanitizer":"Rewrites the input prompt to be safer for image generation policies while preserving artistic intent.","node.help.video_prompt_processor":"Specialized processor for creating detailed video generation prompts.","node.help.image_output":"Displays the result of image generation. Supports downloading and viewing.","node.help.video_output":"Displays the result of video generation using the Veo model.","node.help.prompt_analyzer":"Deconstructs a prompt into components like subject, style, and environment.","node.help.character_analyzer":"Analyses a character description and splits it into appearance and clothing.","node.help.character_generator":"Generates detailed character descriptions based on a short prompt.","node.help.character_card":"Stores comprehensive character data including image and description.","node.help.image_analyzer":"Uses AI to describe the content of an input image.","node.help.image_editor":"Advanced tool for editing images using text prompts and inpainting/outpainting.","node.help.image_sequence_generator":"Generates a sequence of images based on a list of prompts.","node.help.prompt_sequence_editor":"Allows bulk editing of prompt sequences using AI instructions.","node.help.gemini_chat":"A general-purpose chat interface with Gemini for brainstorming or assistance.","node.help.translator":"Translates text between languages using AI models.","node.help.script_generator":"Generates a structured script (scenes, characters) from a story idea.","node.help.script_viewer":"Visualizes and manages script data for frame-by-frame generation.","node.help.note":"A sticky note for adding comments or instructions to the canvas.","node.help.reroute_dot":"A small dot used to organize connections and create cleaner layouts.","node.help.data_reader":"Debug tool for inspecting raw data flowing through connections.","node.help.video_editor":"A timeline-based tool for editing video clips and images.","node.help.media_viewer":"A player for viewing video and audio files with playback controls.","node.help.data_protection":"An interactive Tower Defense game node. Defend your data stream from corruption.","node.help.pose_creator":"Visual rig to define and generate character poses for consistency.","node.action.expand":"Expand","node.action.collapse":"Collapse","node.action.help":"Help","node.action.download":"Download","node.action.clear":"Clear Content","node.action.refreshChat":"Clear and Restart Chat","node.action.paste":"Paste","node.action.resetEditor":"Reset Editor","node.action.saveCharacter":"Save to Disk","node.action.loadCharacter":"Load from Disk","node.action.copy":"Copy","node.action.copyImage":"Copy Image","node.action.copyTextPrompt":"Copy Prompt","node.action.copyImagePrompt":"Copy Image Prompt","node.action.copyVideoPrompt":"Copy Video Prompt","node.action.cutConnections":"Cut Connections","node.action.close":"Close","node.action.closeNode":"Close Node (Shift+Click for instant close)","node.action.closeNodeSimple":"Close Node","node.action.randomWord":"Add Random Word","node.action.processImage":"Remove Watermarks","node.action.processImageTitle":"Uses Gemini to remove watermarks and text from the image.","node.action.editor":"Editor","node.action.rasterEditor":"Raster Editor","node.action.openInAIEditor":"Open in AI Editor","node.action.openInAnalyzer":"Open in Analyzer","node.action.outputToInput":"Use Output as Input","node.action.processChainForward":"Process Forward","node.action.executeChain":"Execute Chain","node.action.executeChainTitle":"Execute all upstream nodes to generate the final result.","node.action.sanitize":"Sanitize","node.action.rename":"Rename","node.action.stop":"Stop","node.action.stopping":"Stopping...","node.action.deleteItem":"Delete Item","node.action.detachAndPaste":"Detach and Paste","node.action.delete":"Delete","node.action.flipImage":"Flip Image","node.action.pin":"Pin Node to Top","node.action.unpin":"Unpin Node","node.action.updateDescription":"Update description from prompt","node.action.updatePersonality":"Update Personality","node.action.updateAppearance":"Update Appearance from prompt","node.action.updateClothing":"Update Clothing from prompt","node.action.modifyCharacter":"Request Changes","node.action.updateDataFormat":"Update data format","node.action.expand169":"Expand to 16:9","node.action.expand916":"Expand to 9:16","node.action.sync":"Sync from connections","node.action.expandRatio":"Extend Aspect Ratio","node.action.markPrimary":"Mark as Primary","node.action.addCard":"Add Card","node.action.removeCard":"Remove Card","node.action.showOutputs":"Show Outputs","node.action.hideOutputs":"Hide Outputs","node.action.showImages":"Show Images","node.action.hideImages":"Hide Images","node.action.characterConcept":"Character Concept","node.action.objectConcept":"Object Concept","node.action.downloadTxt":"Download .txt","node.action.downloadDoc":"Download .doc","node.mediaViewer.play":"Play","node.mediaViewer.pause":"Pause","node.mediaViewer.stop":"Stop","node.mediaViewer.addMarker":"Add Marker","node.mediaViewer.exportSRT":"Export Markers (SRT)","node.mediaViewer.deleteAllMarkers":"Delete All Markers","node.mediaViewer.saveMarkers":"Save Markers to Disk","node.mediaViewer.loadMarkers":"Load Markers from Disk","node.mediaViewer.relink":"Relink File","node.content.notePlaceholder":"Type your notes here...","node.content.dropImage":"Drop image here or click to upload","node.content.dropMedia":"Drop video or audio here","node.content.processing":"Processing...","node.content.processingChain":"Processing Chain...","node.content.metadataPrompt":"Prompt from Image Metadata:","node.content.metadataPromptPlaceholder":"No prompt found in image.","node.content.copyPrompt":"Use","node.content.prompt":"Prompt","node.content.promptPlaceholder":"Enter prompt for image generation...","node.content.inputPrompt":"Input Prompt","node.content.enhancedResult":"Processed Result","node.content.videoPrompt":"Video Prompt","node.content.editPromptPlaceholder":"Add to or edit the prompt...","node.content.enhancedPromptHere":"Processed prompt will appear here...","node.content.safePrompt":"Safe for commercial use","node.content.generating":"Generating...","node.content.imageHere":"Image will appear here","node.content.generationMode":"Generation Model","node.content.aspectRatio":"Aspect Ratio","node.content.aspectRatioHelp":"Set aspect ratio for image generation","node.content.aspectRatioNotSupportedFast":"Aspect ratio only available for Imagen models.","node.content.enableAspectRatioFormatting":"Enable Aspect Ratio Formatting","node.content.autoDownload":"Auto Download","node.content.generateImage":"Generate Image","node.content.enhancing":"Processing...","node.content.enhancePrompt":"Process Prompt","node.content.sanitizing":"Sanitizing...","node.content.sanitizedPromptHere":"Sanitized prompt will appear here...","node.content.analyzing":"Analyzing...","node.content.analyzePrompt":"Analyze Prompt","node.content.analyzeImage":"Analyze Image","node.content.imageToText":"Image to Text","node.content.updatePromptFromImage":"Update prompt from image","node.content.analyzeCharacter":"Analyze Character","node.content.generateCharacters":"Generate Characters","node.content.characterPromptPlaceholder":"Describe character(s) to generate...","node.content.character":"Character","node.content.clothing":"Clothing","node.content.characterPlaceholder":"Character description will appear here...","node.content.clothingPlaceholder":"Clothing description will appear here...","node.content.appearance":"Appearance","node.content.appearancePlaceholder":"Describe physical appearance...","node.content.personality":"Personality","node.content.personalityPlaceholder":"Describe personality or request changes...","node.content.environment":"Environment/Setting","node.content.action":"Action","node.content.emotion":"Emotion","node.content.style":"Style","node.content.environmentPlaceholder":"Detailed description of the environment...","node.content.charactersPlaceholder":"List of main characters...","node.content.characters":"Characters","node.content.characterConcepts":"Character Concepts","node.content.actionPlaceholder":"Description of the action...","node.content.emotionPlaceholder":"Description of the emotion...","node.content.stylePlaceholder":"Description of the art style...","node.content.descriptionHere":"Description will appear here...","node.content.enableOutpainting":"Enable Outpainting","node.content.outpaintingPromptPlaceholder":"Outpainting prompt...","node.content.inputImage":"Input Images","node.content.dropOrClick":"Drop or Click","node.content.outputImage":"Output Image","node.content.applyEdit":"Apply Edit","node.content.editing":"Editing...","node.content.chatPlaceholder":"Type your message...","node.content.connectedPlaceholder":"Connected to node, edit in source.","node.content.connectedNode":"Connected via node","node.content.connectedEmpty":"Connected node has no image.","node.content.translatePlaceholder":"Text to translate...","node.content.translatedTextPlaceholder":"Text translated...","node.content.targetLanguage":"Target Language","node.content.translate":"Translate","node.content.translating":"Translating...","node.content.scriptPromptPlaceholder":"Enter a story idea or plot...","node.content.generateScript":"Generate Script","node.content.loadScript":"Load Script File","node.content.summary":"Summary","node.content.scenes":"Scenes","node.content.unrecognizedFormat":"Unrecognized script format.","node.content.frames":"Frames","node.content.characterIndex":"Index","node.content.readData":"Read Data","node.content.textDataHere":"Text data will appear here.","node.content.noDataRead":'Connect a node and click "Read Data" to view its contents.',"node.content.previewError":"Preview Error","node.content.previewPlaceholder":"Preview will appear here","node.content.imagePrompt":"Image Prompt","node.output.allPromptData":"All Prompt Data","node.note.tab.note":"Note","node.note.tab.references":"References","node.note.nestedImages":"Nested Images","node.note.dropPlaceholder":"Drop images or click to add","node.note.addCaption":"Caption","node.note.action.shuffle":"Shuffle","node.note.action.undoShuffle":"Undo Shuffle","node.content.characterTypeShort":"Type:","node.content.numberOfCharactersShort":"Qty:","node.content.characterType.simple":"Simple","node.content.characterType.anthro":"Anthro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Key Item","node.content.style.simple":"Simple","node.content.style.realistic":"Realistic","node.content.style.3d_cartoon":"3D Cartoon","node.content.style.3d_realistic":"3D Realistic","node.content.style.2d_animation":"2D Animation","node.content.style.anime":"Anime","node.content.style.comics":"Comics","node.content.style.custom":"Custom","node.content.fullDescriptionTitle":"Full character description","node.content.integrationInstruction":"Integration Instruction","node.content.additionalPromptSuffix":"Additional Prompt (Suffix)","node.content.suffix":"Suffix","node.content.insertSceneContext":"Insert Scene Context","node.content.modificationRequest":"Modification Request","search.node.text_input.title":"Text Input","search.node.text_input.description":"A simple multiline text field.","search.node.image_input.title":"Image Input","search.node.image_input.description":"Allows you to upload or paste an image.","search.node.prompt_sequence_editor.title":"Prompt Sequence Editor","search.node.prompt_sequence_editor.description":"Edits a list of prompts using a single instruction, allowing for batch modifications.","search.node.data_reader.title":"Data Reader","search.node.data_reader.description":"Reads and displays the raw output (text or image) from any connected node for debugging purposes.","search.node.note.title":"Note","search.node.note.description":"A sticky note for comments.","search.node.prompt_processor.title":"Prompt Processor","search.node.prompt_processor.description":"Combines inputs into an enhanced prompt.","search.node.prompt_analyzer.title":"Prompt Analyzer","search.node.prompt_analyzer.description":"Deconstructs a prompt into components.","search.node.prompt_sanitizer.title":"Prompt Sanitizer","search.node.prompt_sanitizer.description":"Rewrites the prompt to be safer for AI models.","search.node.character_card.title":"Character Card","search.node.character_card.description":"Stores detailed information about a character.","search.node.character_analyzer.title":"Character Analyzer","search.node.character_analyzer.description":"Splits a description into appearance and clothing.","search.node.character_generator.title":"Character Generator","search.node.character_generator.description":"Generates one or more detailed character descriptions based on a prompt.","search.node.image_analyzer.title":"Image Analyzer","search.node.image_analyzer.description":"Describes an image using AI.","search.node.image_editor.title":"AI Image Editor","search.node.image_editor.description":"Edits or combines images with a prompt.","search.node.image_sequence_generator.title":"Image Sequence Generator","search.node.image_sequence_generator.description":"Generates a sequence of images based on a list of prompts.","search.node.gemini_chat.title":"Gemini Chat","search.node.gemini_chat.description":"A conversational interface to chat with Gemini, useful for brainstorming or assistance.","search.node.translator.title":"Translator","search.node.translator.description":"Translates text between languages using AI models.","search.node.script_generator.title":"Script Generator","search.node.script_generator.description":"Generates a structured script (scenes, characters) from a story idea.","search.node.script_viewer.title":"Script Viewer","search.node.script_viewer.description":"Visualizes and manages script data for frame-by-frame generation.","search.node.note":"A simple text box for leaving notes and comments on the canvas.","search.node.reroute_dot":"A small dot used to organize connections and create cleaner layouts.","search.node.video_prompt_processor.title":"Video Prompt Processor","search.node.video_prompt_processor.description":"Creates detailed prompts for video generation.","search.node.video_output.title":"Video Output","search.node.video_output.description":"Generates a video using the Veo model.","search.node.image_output.title":"Image Output","search.node.image_output.description":"Displays and allows downloading of generated images.","search.node.media_viewer.title":"Media Viewer","search.node.media_viewer.description":"Player for viewing video and audio files with playback controls.","search.node.data_protection.title":"Data Protection","search.node.data_protection.description":"Defend your data stream from corruption in this mini-game node.","search.node.pose_creator.title":"Pose Creator","search.node.pose_creator.description":"Visually rig and create character poses for generation guidance.","prompt_sequence_editor.instructionPlaceholder":"Enter instruction to modify prompts...","prompt_sequence_editor.modifying":"Modifying...","prompt_sequence_editor.modifySelected":"Modify Selected ({count})","prompt_sequence_editor.sourcePrompts":"Source Prompts","prompt_sequence_editor.finalPrompts":"Modified Prompts","prompt_sequence_editor.error.invalidInput":"Invalid data format. Please connect a prompt sequence array.","geminiChat.mode.general":"General","geminiChat.mode.prompt":"Prompt Expert","geminiChat.mode.script":"Script Writer","geminiChat.mode.youtube":"YouTube Analyst","geminiChat.mode.friend":"Best Friend","image_sequence.shot_type.WS":"Integrate the Entity with a Wide Shot (WS) into the scene and action. Show the environment.","image_sequence.shot_type.MS":"Integrate the Entity with a Medium Shot (MS) into the scene. Character from waist up.","image_sequence.shot_type.CU":"Integrate the Entity with a Close-Up (CU) into the scene.","image_sequence.shot_type.ECU":"Integrate the Entity with an Extreme Close-Up (ECU) into the scene. Maximum detail.","image_sequence.shot_type.LS":"Integrate the Entity with a Long Shot (LS) into the scene to show scale."},tb={"imageEditor.title":"Image Editor","imageEditor.canvasResolution":"Canvas Resolution","imageEditor.background":"Background","imageEditor.toolSettings":"Tool Settings","imageEditor.snapToEdges":"Snap to Edges","imageEditor.freeAspect":"Free Aspect Ratio","imageEditor.section.aiRequest":"AI Modification Request","imageEditor.input.modificationPlaceholder":'Describe changes, e.g., "change background to blue"',"imageEditor.action.sendRequest":"Send Request","imageEditor.tooltip.removeObject":"Remove (Red) / Keep (Green)","imageEditor.action.removeObject":"Remove Object","imageEditor.action.removeBackground":"Remove Background","imageEditor.tool.transform":"Transform","imageEditor.tool.hand":"Hand (Pan)","imageEditor.tool.zoom":"Zoom","imageEditor.tool.pencil":"Pencil","imageEditor.tool.rectangle":"Rectangle","imageEditor.action.fit":"Fit to Canvas","imageEditor.action.fill":"Fill Canvas","imageEditor.action.cancel":"Cancel","imageEditor.action.resetEdits":"Reset Edits","imageEditor.action.apply":"Apply","imageViewer.title":"Image Viewer","imageEditor.outputResolution":"Output Resolution","imageEditor.outputResolutionHelp":'Set output resolution. If "Auto", uses canvas resolution.',"imageEditor.currentSize":"Current Size: {width}x{height}","imageEditor.sequenceMode":"Sequence Mode","imageEditor.sequenceModeHelp":"Process input images from Input A sequentially.","imageEditor.sequentialCombination":"Sequential Image Combination","imageEditor.sequentialCombinationHelp":"For each frame: Sends current Input A image + All Input B images.","imageEditor.sequentialPrompt":"Sequential Prompt Combination","imageEditor.sequentialPromptHelp":"For each frame: Uses a unique prompt from the list + current image.","imageEditor.sequentialEditingWithPrompts":"Sequential Editing with Prompts","imageEditor.sequentialEditingWithPromptsHelp":"For each frame: Uses Input B image + unique prompt. Input A is ignored.","imageEditor.input":"Input","imageEditor.inputA":"Input A","imageEditor.inputB":"Input B","imageEditor.status.queued":"Queued","imageEditor.status.generating":"Generating...","imageEditor.action.regenerate":"Regenerate","imageEditor.tooltip.fit":"Fit image to canvas boundaries (contain).","imageEditor.tooltip.fill":"Scale image to fill canvas (cover).","imageEditor.tooltip.flip":"Flip image horizontally.","imageEditor.background.white":"White","imageEditor.background.gray":"Gray","imageEditor.background.black":"Black","imageEditor.background.dark":"Dark","image_sequence.regenerate":"Regenerate","image_sequence.stop_queue":"Stop Queue","image_sequence.move_up":"Move Up","image_sequence.move_down":"Move Down","image_sequence.copy_prompt":"Copy Prompt","image_sequence.add_frame":"Add Frame","image_sequence.delete_frame":"Delete Frame","image_sequence.expand_all_frames":"Expand/Collapse All Frames","image_sequence.collapse_all_frames":"Collapse All Frames","image_sequence.expand_all_scenes":"Expand/Collapse All Scenes","image_sequence.collapse_all_scenes":"Collapse All Scenes","image_sequence.expand_all":"Expand All","image_sequence.collapse_all":"Collapse All","image_sequence.clear_all_prompts":"Clear All Prompts","image_sequence.add_first_frame":"Add First Frame","image_sequence.drop_or_add_title":"Drop Sequence JSON or Add Frame","image_sequence.drop_or_add_desc":"Drop a JSON file here or click to add a frame manually.","image_sequence.load_prompts":"Load Prompts","image_sequence.output_images_title":"Output Images","image_sequence.prompts_list_title":"Source Prompts","image_sequence.download_selected":"Download Selected","image_sequence.select_all":"Select All","image_sequence.select_none":"Select None","image_sequence.invert_selection":"Invert Selection","image_sequence.run_selected":"Run Selected","image_sequence.start_queue":"Start Queue","image_sequence.character_prompt_combination":"Character Prompt Combination","image_sequence.combination_none":"None","image_sequence.combination_combine":"Combine","image_sequence.combination_replace":"Replace Tags","image_sequence.status.error":"Error","image_sequence.status.pending":"Queued","image_sequence.clear_selected_prompts":"Clear Selected Prompts","image_sequence.range_from":"From:","image_sequence.range_to":"To:","image_sequence.stats.total":"Total Frames: {count}","image_sequence.stats.generated":"Generated: {count}","image_sequence.stats.queue":"Queue: {count}","image_sequence.edit_in_source":"Edit in Source","image_sequence.edit_prompt":"Edit Prompt","image_sequence.select_scene":"Select Scene","image_sequence.next_scene":"Next Scene","image_sequence.prev_scene":"Previous Scene","image_sequence.scene_input_label":"Scene","image_sequence.select_square":"Select Square (1:1)","image_sequence.select_landscape":"Select Landscape (16:9)","image_sequence.select_portrait":"Select Portrait (9:16)","image_sequence.select_range":"Select Range","image_sequence.force_refresh":"Force Refresh","image_sequence.select_scene_frames":"Select all frames in this scene","image_sequence.collapse_other_scenes":"Collapse other scenes","prompt_sequence_editor.instructionPlaceholder":"Enter instruction to modify prompts...","prompt_sequence_editor.modifying":"Modifying...","prompt_sequence_editor.modifySelected":"Modify Selected ({count})","prompt_sequence_editor.sourcePrompts":"Source Prompts","prompt_sequence_editor.finalPrompts":"Modified Prompts","prompt_sequence_editor.error.invalidInput":"Invalid data format. Please connect a prompt sequence array.","geminiChat.mode.general":"General","geminiChat.mode.prompt":"Prompt Expert","geminiChat.mode.script":"Script Writer","geminiChat.mode.youtube":"YouTube Analyst","image_sequence.shot_type.WS":"Integrate the Entity with a Wide Shot (WS) into the scene and action. Show the environment.","image_sequence.shot_type.MS":"Integrate the Entity with a Medium Shot (MS) into the scene.","image_sequence.shot_type.CU":"Integrate the Entity with a Close-Up (CU) into the scene.","image_sequence.shot_type.ECU":"Integrate the Entity with an Extreme Close-Up (ECU) into the scene. Maximum detail.","image_sequence.shot_type.LS":"Integrate the Entity with a Long Shot (LS) into the scene to show scale."},nb={"dialog.permission.title":"Permission Required","dialog.permission.description":"This app needs permission to read from your clipboard to allow pasting content into nodes. Your data is not stored or sent anywhere.","dialog.permission.allow":"Allow","dialog.permission.decline":"Decline","dialog.rename.title":"Rename Item","dialog.rename.group.title":"Rename Group","dialog.rename.catalog.title":"Rename Catalog Item","dialog.rename.node.title":"Rename Node","dialog.rename.label":"New Name:","dialog.rename.confirm":"Rename","dialog.rename.cancel":"Cancel","dialog.promptEdit.title":"Edit Prompt","dialog.promptEdit.nameLabel":"Name:","dialog.promptEdit.contentLabel":"Content:","dialog.promptEdit.confirm":"Save","dialog.promptEdit.cancel":"Cancel","dialog.confirmDelete.title":"Confirm Deletion","dialog.confirmDelete.message":"Are you sure you want to delete this item? This action cannot be undone.","dialog.confirmDelete.confirm":"Delete","dialog.confirmDelete.cancel":"Cancel","dialog.confirmCloseTab.title":"Close Tab","dialog.confirmCloseTab.message":'Are you sure you want to close the tab "{tabName}"? Unsaved changes will be lost.',"dialog.confirmClear.title":"Clear Canvas","dialog.confirmClear.message":"Are you sure you want to clear the entire canvas? This action cannot be undone.","dialog.confirmReset.title":"Reset to Default","dialog.confirmReset.message":"Are you sure you want to reset the canvas to the default state? All current work will be lost.","dialog.confirmReset.confirm":"Reset","dialog.confirmLoad.title":"Confirm Load","dialog.confirmLoad.message":"Loading a new file will replace the current content. Any unsaved changes will be lost. Continue?","dialog.apiKey.title":"Select API Key","dialog.apiKey.description":'This feature requires a Project API key with the "AI Platform" API enabled. Video generation can take a few minutes.',"dialog.apiKey.billingLink":"Learn more about billing","dialog.apiKey.button":"Select API Key","dialog.settings.title":"Settings","dialog.settings.apiKeyLabel":"Google Gemini API Key","settings.googleClientIdLabel":"Client ID","settings.googleDriveTitle":"Google Drive Integration","settings.signInWithGoogle":"Sign In with Google","settings.updateId":"Update Client ID","settings.connecting":"Connecting...","dialog.settings.useDevKeyLabel":"Use free API key (for development)","dialog.settings.instantNodeCloseLabel":"Instant node closing","dialog.settings.nodeAnimationLabel":"Node Addition Animation","dialog.settings.animationModeLabel":"Creation Animation Mode","dialog.settings.anim.pulse":"Pulse","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"None","dialog.settings.description":"Configure your environment preferences and API access below.","dialog.settings.getKeyLink":"Get an API Key here","dialog.settings.save":"Save & Close","dialog.settings.reload":"Restart App","dialog.deleteNode.title":"Close node?","dialog.deleteNode.titlePlural":"Close nodes?","dialog.deleteNode.confirm":"Yes","dialog.deleteNode.cancel":"No","dialog.deleteNode.confirmTooltip":"Close node - lost data cannot be recovered","dialog.deleteNode.cancelTooltip":"Do not close - continue working with the node","dialog.deleteNode.dontShowAgain":"Don't show again","dialog.exitApp.title":"Close Project?","dialog.exitApp.message":"Are you sure you want to close the project? All current work will be lost and the canvas will be reset.","toast.driveSaved":"Project saved to Google Drive successfully","toast.driveSaveFailed":"Failed to save to Google Drive","error.googleDriveInit":"Google Drive Client ID not set. Please configure it in Settings.","settings.group.api":"API & Access","settings.group.style":"Appearance & Behavior","settings.group.drive":"Cloud Storage","settings.themeLabel":"Interface Theme","dialog.reload.title":"Restart Application?","dialog.reload.message":"This will clear the current canvas completely and reload the page. Any unsaved changes will be lost.","dialog.settings.connectionsLabel":"Connections Style","dialog.settings.connectionAnimationLabel":"Data Flow Animation","dialog.settings.connectionOpacityLabel":"Line Opacity","dialog.settings.downloadPathLabel":"Download Path","dialog.settings.selectFolder":"Select Folder","dialog.settings.resetPath":"Reset to Default"},ob={"group.button.create":"Create Group ({count})","group.rename":"Rename Group","group.saveToCatalog":"Save to Catalog","group.saveToDisk":"Save to Disk","group.ungroup":"Ungroup (Shift+Click to delete with content)","group.duplicate":"Duplicate group with content","catalog.tabs.groups":"Groups","catalog.tabs.library":"Library","catalog.tabs.characters":"Characters","catalog.tabs.scripts":"Scripts","catalog.tabs.sequences":"Sequences","catalog.back":"Back","catalog.load":"Load from File","catalog.newFolder":"New Folder","catalog.saveTo":"Save to Catalog","catalog.card.addToCanvas":"Add to Canvas","catalog.card.rename":"Rename","catalog.card.save":"Save","catalog.card.delete":"Delete","catalog.empty.description":"This folder is empty. You can add items or create new folders.","catalog.clearCloudCategory":"Clear Cloud Category","library.loadFromFile":"Load","library.actions.newFolder":"New Folder","library.actions.newPrompt":"New Prompt","library.actions.copy":"Copy","library.actions.edit":"Edit","library.empty.title":"Empty Folder","library.empty.description":"Create prompts and folders to get started.","library.emptyPrompt":"Empty prompt"},rb={...Zw,...Qw,...eb,...tb,...nb,...ob},ab={"app.title":" ","app.subtitle":"    ","app.error.title":"","app.error.copy":" ","app.error.copied":"!","error.apiKey":" API-   . ,   API-.","error.scriptModifierCanvas":'      - " ". ,  " "    .',"welcome.title":"  ","welcome.description":"    .     .       .","welcome.apiKeyLabel":" API  Google Gemini","welcome.apiKeyPlaceholder":"  API  ...","welcome.apiKeyHelp":" API     .","welcome.getKeyLink":"  API ","welcome.iAmDeveloper":" ","welcome.letsGo":"","welcome.resume":"","welcome.startNew":" ","welcome.freeModeActive":"  ","welcome.selectLanguage":"Select your primary language","welcome.navHint":"        ","toast.contentCleared":" ","toast.downloadStarted":" ","toast.characterLoaded":"  ","toast.characterSavedDisk":"    ","toast.copiedToClipboard":"   ","toast.pastedFromClipboard":"   ","toast.pasteFailed":" ","toast.nodeDuplicated":" ","toast.groupSavedToDisk":' "{groupTitle}" .  ',"toast.groupDeleted":"   ","toast.characterSavedCatalog":"   ","toast.promptSaved":"   : {promptName}...","toast.connectionsCut":" ","toast.apiKeySaved":"API   ","toast.cacheCleared":" {count}    ","toast.cacheEmpty":"  ","toast.scriptSaved":"   ","toast.modificationComplete":"  ","toast.canvasSaved":"  ","toast.projectSaved":"  ","alert.groupSaved":' "{groupTitle}" .  .',"alert.loadCatalogFailed":"    ","alert.invalidCatalogFile":"   ","alert.fileNotSupported":'  .    "appName".',"alert.invalidCatalogStructure":'  .  "root".',"tutorial.step1":" ,      .","tutorial.step2":' " ",      .',"tutorial.step2_waiting":"       ...","tutorial.step3":",     .","tutorial.step3b":"   .      .","tutorial.step4":"          .","tutorial.group.catalog":"       .","tutorial.group.general":"      .","tutorial.group.input":"   ,   .","tutorial.group.processing":"        .","tutorial.group.character":",     .","tutorial.group.output":"    .","tutorial.group.ai":"  Gemini   .","tutorial.group.video":"     .","tutorial.group.scripts":"      .","tutorial.group.file":" ,     .","tutorial.success.title":" !","tutorial.success.message":"     .    !","tutorial.success.button":" ","tutorial.skip":"","tutorial.next":"","tutorial.finish":""},ib={"toolbar.settings":"","toolbar.resetCanvas":" ","toolbar.clearCache":"  ","toolbar.home":"","toolbar.exitApp":" ","toolbar.edit":" (V)","toolbar.cutter":"  (C) / ( Ctrl)","toolbar.selection":" (S) / ( Shift)","toolbar.reroute":" (R) / ( Ctrl+Alt)","toolbar.zoom":" ( Z)","toolbar.snapToGrid":"  ","toolbar.smartGuides":" ","toolbar.lineStyleSpaghetti":' ""',"toolbar.lineStyleOrthogonal":" ","toolbar.resetZoom":" ","toolbar.resetCamera":"  ","toolbar.clearCanvas":" ","toolbar.addNode":"  (F)","toolbar.catalog":"  (Ctrl + )","toolbar.addNote":"  (N)","toolbar.addDataReader":"   (Shift + R)","toolbar.addTextInput":"   (T)","toolbar.addImageInput":"   (I)","toolbar.addPromptSequenceEditor":"   (Q)","toolbar.addImageAnalyzer":"   (Shift+A)","toolbar.addPromptAnalyzer":"   (A)","toolbar.addPromptProcessor":"   (P)","toolbar.addCharacterGenerator":"  (Shift+C)","toolbar.addCharacterAnalyzer":"  (Ctrl+Shift+A)","toolbar.addCharacterCard":"  (Ctrl+Shift+C)","toolbar.addImageOutput":"   (O)","toolbar.addImageEditor":"    (Shift+I)","toolbar.addImageSequenceGenerator":"   (Shift+Q)","toolbar.addTranslator":"  (L)","toolbar.addGeminiChat":"   Gemini (M)","toolbar.addVideoPromptProcessor":"    (Shift+P)","toolbar.addVideoOutput":"   (Shift+O)","toolbar.addScriptGenerator":"  ","toolbar.addScriptViewer":"   (Shift + V)","toolbar.saveCanvas":"  (Ctrl + S)","toolbar.saveProject":" ","toolbar.saveToDrive":"  Google ","toolbar.loadCanvas":" / (Ctrl + O)","toolbar.group.general":"","toolbar.group.catalog":"","toolbar.group.input":"","toolbar.group.processing":"","toolbar.group.character":"","toolbar.group.output":"","toolbar.group.aiTools":" ","toolbar.group.video":"","toolbar.group.scripts":"","toolbar.group.file":"","toolbar.title":" ","toolbar.dock":" ","toolbar.detach":" ","toolbar.expandPanel":" ","toolbar.collapsePanel":" ","toolbar.dockArea.title":"  ","toolbar.duplicate":" ","toolbar.duplicateWithContent":"  ","toolbar.dock.q1":" 1- .","toolbar.dock.q2":" 2- .","toolbar.dock.q3":" 3- .","toolbar.dock.q4":" 4- .","toolbar.dock.tl":" ","toolbar.dock.bl":" ","toolbar.dock.tr":" ","toolbar.dock.br":" ","toolbar.dock.left":" ","toolbar.dock.right":" ","toolbar.dock.full":" ","toolbar.dock.exitFull":"   ","toolbar.dock.fullFocus":"   ","hotkeys.show":"  ","hotkeys.tools.title":"","hotkeys.tools.edit":" ","hotkeys.tools.cutter":" ","hotkeys.tools.selection":" ","hotkeys.tools.reroute":" ","hotkeys.tools.zoom":" ","hotkeys.tools.toggleLineStyle":"  ","hotkeys.tools.group":"","hotkeys.tools.closeNode":" ","hotkeys.tools.duplicate":" ","hotkeys.tools.duplicateWithContent":"  ","hotkeys.tools.deleteGroup":"  (Shift+)","hotkeys.windows.title":"","hotkeys.windows.search":" ","hotkeys.windows.catalog":"","hotkeys.createNode.title":" ","help.panelTitle":"   ","help.subtitle":" ","help.title":" ","help.howToUse.title":" ","help.howToUse.content":"   Prompt Modifier!         .     .         .         .   -  .","help.author":"","help.tab.links":"   ","help.section.socials":" ","help.section.studioStable":"Google AI Studio ()","help.section.studioAlpha":"Google AI Studio ()","help.section.netlify":" Netlify","help.section.github":" GitHub","help.section.githubPages":"  GitHub","help.license":" GNU GPLv3","help.copyLink":" ","help.copied":"!","contextMenu.undoPosition":" ","contextMenu.redoPosition":" ","contextMenu.align.left":"   (F)","contextMenu.align.centerX":"  . (E)","contextMenu.align.right":"   (R)","contextMenu.align.top":"  (T)","contextMenu.align.centerY":"  . (D)","contextMenu.align.bottom":"  (B)","contextMenu.distribute.horizontal":".  . (Ctrl+D)","contextMenu.distribute.vertical":".  . (Ctrl+E)","contextMenu.emptySlot":"  (  )","contextMenu.saveSlots":"  ","contextMenu.loadSlots":"  ","quickadd.title":" ","quickadd.group.tools":"","quickadd.group.inputs":"","quickadd.group.processing":"","quickadd.group.character":"","quickadd.group.outputs":"","quickadd.group.ai":"","quickadd.group.video":"","quickadd.group.scripts":"","quickadd.group.general":"","quickadd.group.youtube":"","quickadd.tool.edit":"","quickadd.tool.cutter":"","quickadd.tool.selection":"","search.placeholder":"   ...","search.noResults":"  .","search.group.input":"  ","search.group.process":"  ","search.group.output":"  ","search.group.ai":" ","search.group.video":"  ","search.group.scripts":"","toolbar.enterFullScreen":"  ","toolbar.exitFullScreen":"   ","dialog.settings.hoverHighlightLabel":"   "},sb={"node.title.text_input":" ","node.title.image_input":" ","node.title.prompt_processor":" ","node.title.prompt_sanitizer":" ","node.title.video_prompt_processor":"  ","node.title.image_output":" ","node.title.video_output":" ","node.title.prompt_analyzer":" ","node.title.character_analyzer":" ","node.title.character_generator":" ","node.title.character_card":" ","node.title.image_analyzer":" ","node.title.image_editor":"  ","node.title.image_sequence_generator":"  ","node.title.prompt_sequence_editor":"  ","node.title.gemini_chat":"  Gemini","node.title.translator":"","node.title.script_generator":" ","node.title.script_viewer":" ","node.title.note":"","node.title.reroute_dot":" ","node.title.data_reader":" ","node.title.video_editor":"   ","node.title.media_viewer":"  ","node.title.data_protection":" ","node.title.pose_creator":" ","node.help.text_input":"        .","node.help.image_input":"         .","node.help.prompt_processor":"           .","node.help.prompt_sanitizer":"  ,       ,   .","node.help.video_prompt_processor":"        .","node.help.image_output":"   .    .","node.help.video_output":"       Veo.","node.help.prompt_analyzer":"   : , ,   ..","node.help.character_analyzer":"         .","node.help.character_generator":"       .","node.help.character_card":"    ,    .","node.help.image_analyzer":"      .","node.help.image_editor":"          inpainting/outpainting.","node.help.image_sequence_generator":"      .","node.help.prompt_sequence_editor":"       -.","node.help.gemini_chat":" -  Gemini     .","node.help.translator":"   ,   .","node.help.script_generator":"   (, )   .","node.help.script_viewer":"       .","node.help.note":"       .","node.help.reroute_dot":" ,         .","node.help.data_reader":"     ,   .","node.help.video_editor":"        .","node.help.media_viewer":"         .","node.help.data_protection":"  Tower Defense.      ,   .","node.help.pose_creator":"     .","node.action.expand":"","node.action.collapse":"","node.action.help":"","node.action.download":"","node.action.clear":" ","node.action.refreshChat":"   ","node.action.paste":"","node.action.resetEditor":" ","node.action.saveCharacter":"  ","node.action.loadCharacter":"  ","node.action.copy":"","node.action.copyImage":" ","node.action.copyTextPrompt":" ","node.action.copyImagePrompt":"  ","node.action.copyVideoPrompt":"  ","node.action.cutConnections":" ","node.action.close":"","node.action.closeNode":"  (Shift+   )","node.action.closeNodeSimple":" ","node.action.randomWord":"  ","node.action.processImage":"  ","node.action.processImageTitle":" Gemini        .","node.action.editor":"","node.action.rasterEditor":" ","node.action.openInAIEditor":"   ","node.action.openInAnalyzer":"  ","node.action.outputToInput":"   ","node.action.processChainForward":" ","node.action.executeChain":" ","node.action.executeChainTitle":"       .","node.action.sanitize":"","node.action.rename":"","node.action.stop":"","node.action.stopping":"...","node.action.deleteItem":" ","node.action.detachAndPaste":"  ","node.action.delete":"","node.action.flipImage":"","node.action.pin":"  ","node.action.unpin":" ","node.action.updateDescription":"   ","node.action.updatePersonality":" ","node.action.updateAppearance":"   ","node.action.updateClothing":"   ","node.action.modifyCharacter":" ","node.action.updateDataFormat":"  ","node.action.expand169":"  16:9","node.action.expand916":"  9:16","node.action.sync":" ","node.action.expandRatio":" ","node.action.markPrimary":" ","node.action.addCard":" ","node.action.removeCard":" ","node.action.showOutputs":" ","node.action.hideOutputs":" ","node.action.showImages":" ","node.action.hideImages":" ","node.action.characterConcept":" ","node.action.objectConcept":" ","node.action.downloadTxt":" .txt","node.action.downloadDoc":" .doc","node.mediaViewer.play":"","node.mediaViewer.pause":"","node.mediaViewer.stop":"","node.mediaViewer.addMarker":" ","node.mediaViewer.exportSRT":"  (SRT)","node.mediaViewer.deleteAllMarkers":"  ","node.mediaViewer.saveMarkers":" ","node.mediaViewer.loadMarkers":" ","node.mediaViewer.relink":" ","node.content.notePlaceholder":"   ...","node.content.dropImage":"      ","node.content.dropMedia":"    ","node.content.processing":"...","node.content.processingChain":" ...","node.content.metadataPrompt":"   :","node.content.metadataPromptPlaceholder":"    .","node.content.copyPrompt":".","node.content.prompt":"","node.content.promptPlaceholder":"    ...","node.content.inputPrompt":" ","node.content.enhancedResult":" ","node.content.videoPrompt":"Video Prompt","node.content.editPromptPlaceholder":"   ...","node.content.enhancedPromptHere":"   ...","node.content.safePrompt":"   ","node.content.generating":"...","node.content.imageHere":"  ","node.content.generationMode":" ","node.content.aspectRatio":" ","node.content.aspectRatioHelp":"     ","node.content.aspectRatioNotSupportedFast":"      Imagen.","node.content.enableAspectRatioFormatting":"   ","node.content.autoDownload":"","node.content.generateImage":" ","node.content.enhancing":"...","node.content.enhancePrompt":" ","node.content.sanitizing":"...","node.content.sanitizedPromptHere":"   ...","node.content.analyzing":"...","node.content.analyzePrompt":" ","node.content.analyzeImage":" ","node.content.imageToText":"  ","node.content.updatePromptFromImage":"   ","node.content.analyzeCharacter":" ","node.content.generateCharacters":" ","node.content.characterPromptPlaceholder":" ()  ...","node.content.character":"","node.content.clothing":"","node.content.characterPlaceholder":"   ...","node.content.clothingPlaceholder":"   ...","node.content.appearance":"","node.content.appearancePlaceholder":"   ...","node.content.personality":"","node.content.personalityPlaceholder":"      ...","node.content.environment":"/","node.content.action":"","node.content.emotion":"","node.content.style":"","node.content.environmentPlaceholder":"  ...","node.content.charactersPlaceholder":"  ...","node.content.characters":"","node.content.characterConcepts":" ","node.content.actionPlaceholder":" ...","node.content.emotionPlaceholder":" ...","node.content.stylePlaceholder":"  ...","node.content.descriptionHere":"  ...","node.content.enableOutpainting":" Outpainting","node.content.outpaintingPromptPlaceholder":"  Outpainting...","node.content.inputImage":" ","node.content.dropOrClick":"  ","node.content.outputImage":" ","node.content.applyEdit":"","node.content.editing":"...","node.content.chatPlaceholder":"  ...","node.content.connectedPlaceholder":"  ,   .","node.content.connectedNode":"  ","node.content.connectedEmpty":"    .","node.content.translatePlaceholder":"  ...","node.content.translatedTextPlaceholder":" ...","node.content.targetLanguage":" ","node.content.translate":"","node.content.translating":"...","node.content.scriptPromptPlaceholder":"    ...","node.content.generateScript":" ","node.content.loadScript":"  ","node.content.summary":" ","node.content.scenes":"","node.content.unrecognizedFormat":"  .","node.content.frames":"","node.content.characterIndex":"","node.content.readData":" ","node.content.textDataHere":"   .","node.content.noDataRead":'    " ",   .',"node.content.previewError":" ","node.content.previewPlaceholder":"  ","node.content.imagePrompt":" ","node.output.allPromptData":"  ","node.note.tab.note":"","node.note.tab.references":"","node.note.nestedImages":" ","node.note.dropPlaceholder":"     ","node.note.addCaption":"","node.note.action.shuffle":"","node.note.action.undoShuffle":" ","node.content.characterTypeShort":":","node.content.numberOfCharactersShort":"-:","node.content.characterType.simple":"","node.content.characterType.anthro":"","node.content.characterType.chibi":"","node.content.characterType.key_item":" ","node.content.style.simple":"","node.content.style.realistic":"","node.content.style.3d_cartoon":"3D ","node.content.style.3d_realistic":"3D ","node.content.style.2d_animation":"2D ","node.content.style.anime":"","node.content.style.comics":"","node.content.style.custom":" ","node.content.fullDescriptionTitle":"  ","node.content.integrationInstruction":" ","node.content.additionalPromptSuffix":".  ()","node.content.suffix":"","node.content.insertSceneContext":"  ","node.content.modificationRequest":"  ","search.node.text_input.title":" ","search.node.text_input.description":"   .","search.node.image_input.title":" ","search.node.image_input.description":"   .","search.node.prompt_sequence_editor.title":"  ","search.node.prompt_sequence_editor.description":"      ,   .","search.node.data_reader.title":" ","search.node.data_reader.description":"     (  )       .","search.node.note.title":"","search.node.note.description":"  .","search.node.prompt_processor.title":" ","search.node.prompt_processor.description":"     .","search.node.prompt_analyzer.title":" ","search.node.prompt_analyzer.description":"   .","search.node.prompt_sanitizer.title":" ","search.node.prompt_sanitizer.description":" ,       .","search.node.character_card.title":" ","search.node.character_card.description":"    .","search.node.character_analyzer.title":" ","search.node.character_analyzer.description":"     .","search.node.character_generator.title":" ","search.node.character_generator.description":"       .","search.node.image_analyzer.title":" ","search.node.image_analyzer.description":"    .","search.node.image_editor.title":"  ","search.node.image_editor.description":"    con .","search.node.image_sequence_generator.title":"  ","search.node.image_sequence_generator.description":"      .","search.node.gemini_chat.title":"  Gemini","search.node.gemini_chat.description":"    con Gemini,       .","search.node.translator.title":"","search.node.translator.description":"         .","search.node.script_generator.title":" ","search.node.script_generator.description":"   (, )   .","search.node.script_viewer.title":" ","search.node.script_viewer.description":"       .","search.node.note":"        .","search.node.reroute_dot":" ,         .","search.node.video_prompt_processor.title":"  ","search.node.video_prompt_processor.description":"     .","search.node.video_output.title":" ","search.node.video_output.description":"     Veo.","search.node.image_output.title":" ","search.node.image_output.description":"     .","search.node.media_viewer.title":"  ","search.node.media_viewer.description":"         .","search.node.data_protection.title":" ","search.node.data_protection.description":"- Tower Defense.     ,     .","search.node.pose_creator.title":" ","search.node.pose_creator.description":"     .","prompt_sequence_editor.instructionPlaceholder":"    ...","prompt_sequence_editor.modifying":"...","prompt_sequence_editor.modifySelected":"  ({count})","prompt_sequence_editor.sourcePrompts":" ","prompt_sequence_editor.finalPrompts":" ","prompt_sequence_editor.error.invalidInput":"  . ,    .","geminiChat.mode.general":"","geminiChat.mode.prompt":"  ","geminiChat.mode.script":"","geminiChat.mode.youtube":" ","geminiChat.mode.developer":"","geminiChat.mode.friend":"","image_sequence.shot_type.WS":"     (WS)    .  .","image_sequence.shot_type.MS":"     (MS)  .   .","image_sequence.shot_type.CU":"     (CU)  .","image_sequence.shot_type.ECU":"      (ECU)  .  .","image_sequence.shot_type.LS":"     (LS)  ,   ."},lb={"imageEditor.title":" ","imageEditor.canvasResolution":" ","imageEditor.background":"","imageEditor.toolSettings":" ","imageEditor.snapToEdges":"  ","imageEditor.freeAspect":" ","imageEditor.section.aiRequest":"  ","imageEditor.input.modificationPlaceholder":" , :      ...","imageEditor.action.sendRequest":" ","imageEditor.tooltip.removeObject":" () /  ()","imageEditor.action.removeObject":" ","imageEditor.action.removeBackground":" ","imageEditor.tool.transform":"","imageEditor.tool.hand":" ()","imageEditor.tool.zoom":"","imageEditor.tool.pencil":"","imageEditor.tool.rectangle":"","imageEditor.action.fit":"  ","imageEditor.action.fill":" ","imageEditor.action.cancel":"","imageEditor.action.resetEdits":" ","imageEditor.action.apply":"","imageViewer.title":" ","imageEditor.outputResolution":" ","imageEditor.outputResolutionHelp":'    .  "Auto",   .',"imageEditor.currentSize":" : {width}x{height}","imageEditor.sequenceMode":" ","imageEditor.sequenceModeHelp":"     .","imageEditor.sequentialCombination":"  ","imageEditor.sequentialCombinationHelp":"  :     +    .","imageEditor.sequentialPrompt":"  ","imageEditor.sequentialPromptHelp":"  :      +  .","imageEditor.sequentialEditingWithPrompts":"   ","imageEditor.sequentialEditingWithPromptsHelp":"  :     +  .   .","imageEditor.input":"","imageEditor.inputA":" A","imageEditor.inputB":" B","imageEditor.status.queued":" ","imageEditor.status.generating":"...","imageEditor.action.regenerate":"","imageEditor.tooltip.fit":"     (contain).","imageEditor.tooltip.fill":"     (cover).","imageEditor.tooltip.flip":"   .","imageEditor.background.white":"","imageEditor.background.gray":"","imageEditor.background.black":"","imageEditor.background.dark":"","image_sequence.regenerate":"","image_sequence.stop_queue":" ","image_sequence.move_up":"","image_sequence.move_down":"","image_sequence.copy_prompt":" ","image_sequence.add_frame":" ","image_sequence.delete_frame":" ","image_sequence.expand_all_frames":"/  ","image_sequence.collapse_all_frames":"  ","image_sequence.expand_all_scenes":"/  ","image_sequence.collapse_all_scenes":"  ","image_sequence.expand_all":" ","image_sequence.collapse_all":" ","image_sequence.clear_all_prompts":"  ","image_sequence.add_first_frame":"  ","image_sequence.drop_or_add_title":" JSON    ","image_sequence.drop_or_add_desc":" JSON  ,       .","image_sequence.load_prompts":" ","image_sequence.output_images_title":" ","image_sequence.prompts_list_title":" ","image_sequence.download_selected":" ","image_sequence.select_all":" ","image_sequence.select_none":" ","image_sequence.invert_selection":"","image_sequence.run_selected":" ","image_sequence.start_queue":" ","image_sequence.character_prompt_combination":"  ","image_sequence.combination_none":"","image_sequence.combination_combine":"","image_sequence.combination_replace":" ","image_sequence.status.error":"","image_sequence.status.pending":" ","image_sequence.clear_selected_prompts":"  ","image_sequence.range_from":":","image_sequence.range_to":":","image_sequence.stats.total":" : {count}","image_sequence.stats.generated":": {count}","image_sequence.stats.queue":" : {count}","image_sequence.edit_in_source":"  ","image_sequence.edit_prompt":" ","image_sequence.select_scene":" ","image_sequence.next_scene":" ","image_sequence.prev_scene":" ","image_sequence.scene_input_label":"","image_sequence.select_square":"  (1:1)","image_sequence.select_landscape":"  (16:9)","image_sequence.select_portrait":"  (9:16)","image_sequence.select_range":" ","image_sequence.force_refresh":" ","image_sequence.select_scene_frames":"   ","image_sequence.collapse_other_scenes":"  ","prompt_sequence_editor.instructionPlaceholder":"    ...","prompt_sequence_editor.modifying":"...","prompt_sequence_editor.modifySelected":"  ({count})","prompt_sequence_editor.sourcePrompts":" ","prompt_sequence_editor.finalPrompts":" ","prompt_sequence_editor.error.invalidInput":"  . ,    .","geminiChat.mode.general":"","geminiChat.mode.prompt":"  ","geminiChat.mode.script":"","geminiChat.mode.youtube":" ","geminiChat.mode.developer":"","image_sequence.shot_type.WS":"     (WS)    .  .","image_sequence.shot_type.MS":"     (MS)  .   .","image_sequence.shot_type.CU":"     (CU)  .","image_sequence.shot_type.ECU":"      (ECU)  .  .","image_sequence.shot_type.LS":"     (LS)  ,   ."},cb={"dialog.permission.title":" ","dialog.permission.description":"        ,     .        .","dialog.permission.allow":"","dialog.permission.decline":"","dialog.rename.title":" ","dialog.rename.group.title":" ","dialog.rename.catalog.title":"  ","dialog.rename.node.title":" ","dialog.rename.label":" :","dialog.rename.confirm":"","dialog.rename.cancel":"","dialog.promptEdit.title":" ","dialog.promptEdit.nameLabel":":","dialog.promptEdit.contentLabel":":","dialog.promptEdit.confirm":"","dialog.promptEdit.cancel":"","dialog.confirmDelete.title":" ","dialog.confirmDelete.message":" ,     ?    .","dialog.confirmDelete.confirm":"","dialog.confirmDelete.cancel":"","dialog.confirmCloseTab.title":" ","dialog.confirmCloseTab.message":' ,     "{tabName}"?    .',"dialog.confirmClear.title":" ","dialog.confirmClear.message":" ,     ?    .","dialog.confirmReset.title":"  ","dialog.confirmReset.message":" ,        ?     .","dialog.confirmReset.confirm":"","dialog.confirmLoad.title":" ","dialog.confirmLoad.message":"     .     . ?","dialog.apiKey.title":" API-","dialog.apiKey.description":'    API-    API "AI Platform".      .',"dialog.apiKey.billingLink":"   ","dialog.apiKey.button":" API-","dialog.settings.title":"","dialog.settings.apiKeyLabel":"API  Google Gemini","settings.googleClientIdLabel":"Client ID","settings.googleDriveTitle":"  Google Drive","settings.signInWithGoogle":"  Google","settings.updateId":" ID","settings.connecting":"...","dialog.settings.useDevKeyLabel":"  ( )","dialog.settings.instantNodeCloseLabel":"  ","dialog.settings.nodeAnimationLabel":"   ","dialog.settings.animationModeLabel":"  ","dialog.settings.anim.pulse":"","dialog.settings.anim.bladeRunner":"  ","dialog.settings.anim.none":"","dialog.settings.description":"    API    .","dialog.settings.getKeyLink":" API  ","dialog.settings.save":"","dialog.settings.reload":"","dialog.deleteNode.title":" ?","dialog.deleteNode.titlePlural":" ?","dialog.deleteNode.confirm":"","dialog.deleteNode.cancel":"","dialog.deleteNode.confirmTooltip":"  -     ","dialog.deleteNode.cancelTooltip":"  -    ","dialog.deleteNode.dontShowAgain":"  ","dialog.exitApp.title":" ?","dialog.exitApp.message":" ,    ?     ,   .","toast.driveSaved":"    Google ","toast.driveSaveFailed":"   Google ","error.googleDriveInit":"Google Drive Client ID  . ,    .","settings.group.api":"API  ","settings.group.style":"   ","settings.group.drive":" ","settings.themeLabel":" ","dialog.reload.title":" ?","dialog.reload.message":"       .     .","dialog.settings.connectionsLabel":" ","dialog.settings.connectionAnimationLabel":"  ","dialog.settings.connectionOpacityLabel":" ","dialog.settings.downloadPathLabel":"  ","dialog.settings.selectFolder":" ","dialog.settings.resetPath":" "},db={"group.button.create":"  ({count})","group.rename":" ","group.saveToCatalog":"  ","group.saveToDisk":"  ","group.ungroup":" (shift +    )","group.duplicate":"   ","catalog.tabs.groups":"","catalog.tabs.library":"","catalog.tabs.characters":"","catalog.tabs.scripts":"","catalog.tabs.sequences":"","catalog.back":"","catalog.load":"  ","catalog.newFolder":" ","catalog.saveTo":"  ","catalog.card.addToCanvas":"  ","catalog.card.rename":"","catalog.card.save":"","catalog.card.delete":"","catalog.empty.description":"  .        .","catalog.clearCloudCategory":"   ","library.loadFromFile":"","library.actions.newFolder":" ","library.actions.newPrompt":" ","library.actions.copy":"","library.actions.edit":"","library.empty.title":" ","library.empty.description":"   ,  .","library.emptyPrompt":" "},ub={...ab,...ib,...sb,...lb,...cb,...db},pb={"app.title":"Modificador de Prompt","app.subtitle":"Conecta ideas para crear una obra maestra","app.error.title":"Notificacin","app.error.copy":"Copiar Mensaje","app.error.copied":"Copiado!","error.apiKey":"Tu clave API es invlida o le faltan permisos. Por favor selecciona una clave API vlida.","error.scriptModifierCanvas":"Este lienzo pertenece a otra aplicacin: Modificador de Guiones. Por favor usa esa aplicacin para abrir este archivo.","welcome.title":"Bienvenido a","welcome.description":"Bienvenido a Prompt Modifier. Conecta ideas para crear obras maestras. Usa nodos para generar y editar contenido.","welcome.apiKeyLabel":"Tu Clave API de Google Gemini","welcome.apiKeyPlaceholder":"Ingresa tu clave API aqu...","welcome.apiKeyHelp":"Tu clave API se almacena localmente.","welcome.getKeyLink":"Obtener Clave API","welcome.iAmDeveloper":"Soy Desarrollador","welcome.letsGo":"Vamos!","welcome.resume":"Continuar","welcome.startNew":"Nueva Tela","welcome.freeModeActive":"Modo Gratuito Activo","welcome.selectLanguage":"Selecciona tu idioma principal","welcome.navHint":"Usa las teclas del teclado  y  para cambiar el idioma","toast.contentCleared":"Contenido borrado","toast.downloadStarted":"Descarga iniciada","toast.characterLoaded":"Tarjeta de personaje cargada","toast.characterSavedDisk":"Tarjeta de personaje guardada en disco","toast.copiedToClipboard":"Copiado al portapapeles","toast.pastedFromClipboard":"Pegado desde el portapapeles","toast.pasteFailed":"Fallo al pegar","toast.nodeDuplicated":"Nodo duplicado","toast.groupSavedToDisk":'Grupo "{groupTitle}" guardado en disco',"toast.groupDeleted":"Grupo y contenido eliminados","toast.characterSavedCatalog":"Personaje guardado en catlogo","toast.promptSaved":"Prompt guardado en biblioteca: {promptName}...","toast.connectionsCut":"Conexiones eliminadas","toast.apiKeySaved":"Clave API guardada exitosamente","toast.cacheCleared":"Se limpiaron {count} elementos no usados de la cach","toast.cacheEmpty":"La cach ya est optimizada","toast.scriptSaved":"Guion guardado en disco","alert.groupSaved":'Grupo "{groupTitle}" guardado en catlogo.',"alert.loadCatalogFailed":"Fallo al cargar archivo de catlogo","alert.invalidCatalogFile":"Formato de archivo de catlogo invlido","alert.fileNotSupported":'Archivo no soportado. Falta o es incorrecto "appName".',"alert.invalidCatalogStructure":'Estructura de catlogo invlida. Falta "root".'},hb={"toolbar.settings":"Ajustes","toolbar.resetCanvas":"Restablecer Lienzo","toolbar.clearCache":"Borrar Cach No Usada","toolbar.home":"Inicio","toolbar.edit":"Editar (V)","toolbar.cutter":"Cortar Conexin (C) / (Mantener Ctrl)","toolbar.selection":"Seleccin (S) / (Mantener Shift)","toolbar.reroute":"Redirigir (R) / (Mantener Ctrl+Alt)","toolbar.zoom":"Zoom (Mantener Z)","toolbar.snapToGrid":"Ajustar a la Cuadrcula","toolbar.smartGuides":"Guas Inteligentes","toolbar.lineStyleSpaghetti":"Lneas Espagueti","toolbar.lineStyleOrthogonal":"Lneas Ortogonales","toolbar.resetZoom":"Restablecer Zoom","toolbar.resetCamera":"Restablecer Cmara","toolbar.clearCanvas":"Limpiar Lienzo","toolbar.addNode":"Aadir Nodo (F)","toolbar.catalog":"Abrir Catlogo (Ctrl + Espacio)","toolbar.addNote":"Aadir Nota (N)","toolbar.addDataReader":"Aadir Lector de Datos (Shift + R)","toolbar.addTextInput":"Aadir Entrada de Texto (T)","toolbar.addImageInput":"Aadir Entrada de Imagen (I)","toolbar.addPromptSequenceEditor":"Aadir Editor de Secuencia de Prompts (Q)","toolbar.addImageAnalyzer":"Aadir Analizador de Imagen (Shift+A)","toolbar.addPromptAnalyzer":"Aadir Analizador de Prompt (A)","toolbar.addPromptProcessor":"Aadir Procesador de Prompt (P)","toolbar.addCharacterGenerator":"Aadir Generador de Personajes (Shift+C)","toolbar.addCharacterAnalyzer":"Aadir Analizador de Personajes (Ctrl+Shift+A)","toolbar.addCharacterCard":"Aadir Tarjeta de Personaje (Ctrl+Shift+C)","toolbar.addImageOutput":"Aadir Salida de Imagen (O)","toolbar.addImageEditor":"Aadir Editor de Imagen IA (Shift+I)","toolbar.addImageSequenceGenerator":"Aadir Generador de Secuencia de Imgenes (Shift+Q)","toolbar.addTranslator":"Aadir Traductor (L)","toolbar.addGeminiChat":"Aadir Chat Gemini (M)","toolbar.addVideoPromptProcessor":"Aadir Procesador de Prompt de Video (Shift+P)","toolbar.addVideoOutput":"Aadir Salida de Video (Shift+O)","toolbar.addScriptGenerator":"Aadir Generador de Guiones","toolbar.addScriptViewer":"Aadir Visor de Guiones (Shift + V)","toolbar.saveCanvas":"Guardar Lienzo (Ctrl + S)","toolbar.saveProject":"Guardar Proyecto","toolbar.loadCanvas":"Cargar Proyecto/Lienzo (Ctrl + O)","toolbar.group.general":"General","toolbar.group.catalog":"Catlogo","toolbar.group.input":"Entrada","toolbar.group.processing":"Procesamiento","toolbar.group.character":"Personaje","toolbar.group.output":"Salida","toolbar.group.aiTools":"Herramientas IA","toolbar.group.video":"Video","toolbar.group.scripts":"Guiones","toolbar.group.file":"Archivo","toolbar.title":"Barra de Herramientas","toolbar.dock":"Acoplar Barra","toolbar.detach":"Desacoplar Barra","toolbar.expandPanel":"Expandir Panel","toolbar.collapsePanel":"Colapsar Panel","toolbar.dockArea.title":"Acoplar Barra Aqu","toolbar.duplicate":"Duplicar Nodo","toolbar.duplicateWithContent":"Duplicar con Contenido","toolbar.dock.q1":"Izq. 1er Cto","toolbar.dock.q2":"Izq. 2do Cto","toolbar.dock.q3":"Der. 3er Cto","toolbar.dock.q4":"Der. 4to Cto","toolbar.dock.tl":"Arriba Izq.","toolbar.dock.bl":"Abajo Izq.","toolbar.dock.tr":"Arriba Der.","toolbar.dock.br":"Abajo Der.","toolbar.dock.left":"Mitad Izq.","toolbar.dock.right":"Mitad Der.","toolbar.dock.full":"Pantalla Completa","toolbar.dock.exitFull":"Salir Pantalla Completa","toolbar.dock.fullFocus":"Enfoque Pantalla Completa","hotkeys.show":"Mostrar Atajos","hotkeys.tools.title":"Herramientas","hotkeys.tools.edit":"Modo Edicin","hotkeys.tools.cutter":"Herramienta de Corte","hotkeys.tools.selection":"Herramienta de Seleccin","hotkeys.tools.reroute":"Herramienta de Redireccin","hotkeys.tools.zoom":"Herramienta de Zoom","hotkeys.tools.toggleLineStyle":"Cambiar Estilo de Lnea","hotkeys.tools.group":"Seleccin de Grupo","hotkeys.tools.closeNode":"Eliminar Seleccionado","hotkeys.tools.duplicate":"Duplicar Nodo","hotkeys.tools.duplicateWithContent":"Duplicar con Contenido","hotkeys.tools.deleteGroup":"Eliminar Grupo (Shift+Clic)","hotkeys.windows.title":"Ventanas","hotkeys.windows.search":"Bsqueda Rpida","hotkeys.windows.catalog":"Catlogo","hotkeys.createNode.title":"Crear Nodo","help.panelTitle":"Ayuda y Atajos","help.subtitle":"Centro de Ayuda","help.title":"Atajos de Teclado","help.howToUse.title":"Cmo Usar","help.howToUse.content":"Bienvenido a Prompt Modifier! Usa la barra de herramientas o atajos para aadir nodos. Conecta nodos para pasar datos. Usa la herramienta Editar para mover nodos y el lienzo. Haz doble clic en el espacio vaco para abrir el men de adicin rpida. Clic derecho para el men contextual.","help.author":"Autor","help.tab.links":"Otras Apps y Enlaces","help.section.socials":"Redes Sociales","help.section.studioStable":"Google AI Studio (Estable)","help.section.studioAlpha":"Google AI Studio (Alpha)","help.section.netlify":"Apps Netlify","help.section.github":"Repositorios GitHub","help.license":"Licencia GNU GPLv3","help.copyLink":"Copiar Enlace","help.copied":"Copiado!","contextMenu.undoPosition":"Deshacer Posicin","contextMenu.redoPosition":"Rehacer Posicin","contextMenu.align.left":"Alinear Izquierda (F)","contextMenu.align.centerX":"Alinear Centro X (E)","contextMenu.align.right":"Alinear Derecha (R)","contextMenu.align.top":"Alinear Arriba (T)","contextMenu.align.centerY":"Alinear Centro Y (D)","contextMenu.align.bottom":"Alinear Abajo (B)","contextMenu.distribute.horizontal":"Distribuir Horiz. (Ctrl+D)","contextMenu.distribute.vertical":"Distribuir Vert. (Ctrl+E)","contextMenu.emptySlot":"Ranura Vaca (Click Der. para asignar)","contextMenu.saveSlots":"Guardar Config. Ranuras","contextMenu.loadSlots":"Cargar Config. Ranuras","quickadd.title":"Aadir Rpido","quickadd.group.tools":"Herramientas","quickadd.group.inputs":"Entradas","quickadd.group.processing":"Procesamiento","quickadd.group.character":"Personaje","quickadd.group.outputs":"Salidas","quickadd.group.ai":"Herramientas IA","quickadd.group.video":"Video","quickadd.group.scripts":"Guiones","quickadd.group.general":"General","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"Editar","quickadd.tool.cutter":"Cortar","quickadd.tool.selection":"Seleccin","search.placeholder":"Buscar un nodo para aadir...","search.noResults":"No se encontraron nodos.","search.group.input":"Entrada y Bsico","search.group.process":"Procesamiento y Personaje","search.group.output":"Imagen y Secuencia","search.group.ai":"Herramientas IA","search.group.video":"Video y Guion","search.group.scripts":"Guiones","toolbar.exitApp":"Cerrar Proyecto","toolbar.enterFullScreen":"Pantalla Completa","toolbar.exitFullScreen":"Salir Pantalla Completa"},mb={"node.title.text_input":"Entrada de Texto","node.title.image_input":"Entrada de Imagen","node.title.prompt_processor":"Procesador de Prompt","node.title.prompt_sanitizer":"Sanitizador de Prompt","node.title.video_prompt_processor":"Proc. de Prompt de Video","node.title.image_output":"Salida de Imagen","node.title.video_output":"Salida de Video","node.title.prompt_analyzer":"Analizador de Prompt","node.title.character_analyzer":"Analizador de Personaje","node.title.character_generator":"Generador de Personajes","node.title.character_card":"Tarjeta de Personaje","node.title.image_analyzer":"Analizador de Imagen","node.title.image_editor":"Editor de Imagen IA","node.title.image_sequence_generator":"Generador de Secuencia de Imgenes","node.title.prompt_sequence_editor":"Editor de Secuencia de Prompts","node.title.gemini_chat":"Chat Gemini","node.title.translator":"Traductor","node.title.script_generator":"Generador de Guiones","node.title.script_viewer":"Visor de Guiones","node.title.note":"Nota","node.title.reroute_dot":"Punto de Redireccin","node.title.data_reader":"Lector de Datos","node.title.video_editor":"Editor de Video Versin Alfa","node.title.media_viewer":"Visor Multimedia","node.title.data_protection":"Proteccin de Datos","node.title.pose_creator":"Pose Creator","node.help.text_input":"Un campo de texto multilnea simple para ingresar prompts o notas.","node.help.image_input":"Permite subir o pegar una imagen para usarla como entrada en otros nodos.","node.help.prompt_processor":"Combina mltiples entradas de texto en un solo prompt mejorado usando IA.","node.help.prompt_sanitizer":"Reescribe el prompt de entrada para que sea ms seguro para las polticas de generacin de imgenes.","node.help.video_prompt_processor":"Procesador especializado para crear prompts detallados de generacin de video.","node.help.image_output":"Muestra el resultado de la generacin de imagen. Permite descargar y ver.","node.help.video_output":"Muestra el resultado de la generacin de video usando el modelo Veo.","node.help.prompt_analyzer":"Deconstruye un prompt en componentes como sujeto, estilo y entorno.","node.help.character_analyzer":"Analiza una descripcin de personaje y la divide en apariencia y ropa.","node.help.character_generator":"Genera descripciones detalladas de personajes basadas en un prompt corto.","node.help.character_card":"Almacena datos completos del personaje, incluyendo imagen y descripcin.","node.help.image_analyzer":"Usa IA para describir el contenido de una imagen de entrada.","node.help.image_editor":"Herramienta avanzada para editar imgenes usando prompts de texto e inpainting/outpainting.","node.help.image_sequence_generator":"Genera una secuencia de imgenes basada en una lista de prompts.","node.help.prompt_sequence_editor":"Permite la edicin masiva de secuencias de prompts usando instrucciones de IA.","node.help.gemini_chat":"Una interfaz de chat de propsito general con Gemini para lluvia de ideas o asistencia.","node.help.translator":"Traduce texto entre idiomas usando modelos de IA.","node.help.script_generator":"Genera un guion estructurado (escenas, personajes) a partir de una idea de historia.","node.help.script_viewer":"Visualiza y gestiona datos de guiones para la generacin cuadro por cuadro.","node.help.note":"Una nota adhesiva para agregar comentarios o instrucciones al lienzo.","node.help.reroute_dot":"Un punto pequeo usado para organizar conexiones y crear diseos ms limpios.","node.help.data_reader":"Herramienta de depuracin para inspeccionar los datos brutos que fluyen a travs de las conexiones.","node.help.video_editor":"Una herramienta basada en lnea de tiempo para editar clips de video e imgenes.","node.help.media_viewer":"Un reproductor para ver archivos de video y audio con controles de reproduccin.","node.help.data_protection":"Un nodo de mini-juego interactivo de Defensa de Torres. Defiende tus datos.","node.help.pose_creator":"Visual rig to define and generate character poses for consistency.","node.action.expand":"Expandir","node.action.collapse":"Colapsar","node.action.help":"Ayuda","node.action.download":"Descargar","node.action.clear":"Borrar Contenido","node.action.refreshChat":"Borrar y Reiniciar Chat","node.action.paste":"Pegar","node.action.resetEditor":"Restablecer Editor","node.action.saveCharacter":"Guardar Tarjeta","node.action.loadCharacter":"Cargar Tarjeta","node.action.copy":"Copiar","node.action.copyImage":"Copiar Imagen","node.action.copyTextPrompt":"Copiar Prompt","node.action.copyImagePrompt":"Copiar Prompt de Imagen","node.action.copyVideoPrompt":"Copiar Prompt de Video","node.action.cutConnections":"Cortar Conexiones","node.action.close":"Cerrar","node.action.closeNode":"Cerrar Nodo (Shift+Clic para cierre instantneo)","node.action.closeNodeSimple":"Cerrar Nodo","node.action.randomWord":"Aadir Palabra Aleatoria","node.action.processImage":"Eliminar Marcas de Agua","node.action.processImageTitle":"Usa Gemini para eliminar marcas de agua y texto de la imagen.","node.action.editor":"Editor","node.action.rasterEditor":"Editor Raster","node.action.openInAIEditor":"Abrir en Editor IA","node.action.openInAnalyzer":"Abrir en Analizador","node.action.outputToInput":"Usar Salida como Entrada","node.action.processChainForward":"Procesar Hacia Adelante","node.action.executeChain":"Ejecutar Cadena","node.action.executeChainTitle":"Ejecutar todos los nodos anteriores para generar el resultado final.","node.action.sanitize":"Sanitizar","node.action.rename":"Renombrar","node.action.stop":"Parar","node.action.stopping":"Parando...","node.action.deleteItem":"Eliminar Elemento","node.action.detachAndPaste":"Despegar y Pegar","node.action.delete":"Eliminar","node.action.flipImage":"Voltear Imagen","node.action.pin":"Fijar Nodo Arriba","node.action.unpin":"Desfijar Nodo","node.action.updateDescription":"Actualizar descripcin desde prompt","node.action.modifyCharacter":"Solicitar Cambios","node.action.updateDataFormat":"Actualizar formato de datos","node.action.expand169":"Expandir a 16:9","node.action.expand916":"Expandir a 9:16","node.action.sync":"Sincronizar desde conexiones","node.action.expandRatio":"Extender Relacin de Aspecto","node.action.markPrimary":"Marcar como Principal","node.action.addCard":"Aadir Tarjeta","node.action.removeCard":"Eliminar Tarjeta","node.action.showOutputs":"Mostrar Salidas","node.action.hideOutputs":"Ocultar Salidas","node.action.characterConcept":"Concepto de Personaje","node.action.objectConcept":"Concepto de Objeto","node.action.downloadTxt":"Descargar .txt","node.action.downloadDoc":"Descargar .doc","node.mediaViewer.play":"Reproducir","node.mediaViewer.pause":"Pausa","node.mediaViewer.stop":"Parar","node.mediaViewer.addMarker":"Aadir Marcador","node.mediaViewer.exportSRT":"Exportar Marcadores (SRT)","node.mediaViewer.deleteAllMarkers":"Eliminar Todos los Marcadores","node.mediaViewer.saveMarkers":"Guardar Marcadores en Disco","node.mediaViewer.loadMarkers":"Cargar Marcadores desde Disco","node.mediaViewer.relink":"Revincular Archivo","node.content.notePlaceholder":"Escribe tus notas aqu...","node.content.dropImage":"Suelta imagen aqu o clic para subir","node.content.dropMedia":"Suelta video o audio aqu","node.content.processing":"Procesando...","node.content.processingChain":"Procesando Cadena...","node.content.metadataPrompt":"Prompt de Metadatos:","node.content.metadataPromptPlaceholder":"No se encontr prompt en la imagen.","node.content.copyPrompt":"Usar","node.content.prompt":"Prompt","node.content.inputPrompt":"Prompt de Entrada","node.content.enhancedResult":"Resultado Mejorado","node.content.videoPrompt":"Prompt de Video","node.content.editPromptPlaceholder":"Aade o edita el prompt...","node.content.enhancedPromptHere":"El prompt mejorado aparecer aqu...","node.content.safePrompt":"Seguro para uso comercial","node.content.generating":"Generando...","node.content.imageHere":"La imagen aparecer aqu","node.content.generationMode":"Modelo de Generacin","node.content.aspectRatio":"Relacin de Aspecto","node.content.aspectRatioHelp":"Establecer relacin de aspecto para generacin de imagen","node.content.aspectRatioNotSupportedFast":"Relacin de aspecto solo disponible para modelos Imagen.","node.content.enableAspectRatioFormatting":"Habilitar Formato de Relacin de Aspecto","node.content.autoDownload":"Auto Descarga","node.content.generateImage":"Generar Imagen","node.content.enhancing":"Mejorando...","node.content.enhancePrompt":"Mejorar Prompt","node.content.sanitizing":"Sanitizando...","node.content.sanitizedPromptHere":"El prompt sanitizado aparecer aqu...","node.content.analyzing":"Analizando...","node.content.analyzePrompt":"Analizar Prompt","node.content.analyzeImage":"Analizar Imagen","node.content.imageToText":"Imagen a Texto","node.content.updatePromptFromImage":"Actualizar prompt desde imagen","node.content.analyzeCharacter":"Analizar Personaje","node.content.generateCharacters":"Generar Personajes","node.content.characterPromptPlaceholder":"Describe personaje(s) para generar...","node.content.character":"Personaje","node.content.clothing":"Ropa","node.content.characterPlaceholder":"La descripcin del personaje aparecer aqu...","node.content.clothingPlaceholder":"La descripcin de la ropa aparecer aqu...","node.content.appearance":"Apariencia","node.content.personality":"Personalidad","node.content.environment":"Entorno/Escenario","node.content.action":"Accin","node.content.emotion":"Emocin","node.content.style":"Estilo","node.content.environmentPlaceholder":"Descripcin detallada del entorno...","node.content.charactersPlaceholder":"Lista de personajes principales...","node.content.characters":"Personajes","node.content.characterConcepts":"Conceptos de Personaje","node.content.actionPlaceholder":"Descripcin de la accin...","node.content.emotionPlaceholder":"Descripcin de la emocin...","node.content.stylePlaceholder":"Descripcin del estilo artstico...","node.content.descriptionHere":"La descripcin aparecer aqu...","node.content.enableOutpainting":"Habilitar Outpainting","node.content.outpaintingPromptPlaceholder":"Prompt de Outpainting...","node.content.inputImage":"Imgenes de Entrada","node.content.dropOrClick":"Soltar o Clic","node.content.outputImage":"Imagen de Salida","node.content.applyEdit":"Aplicar Edicin","node.content.editing":"Editando...","node.content.chatPlaceholder":"Escribe tu mensaje...","node.content.connectedPlaceholder":"Conectado a nodo, editar en fuente.","node.content.connectedNode":"Conectado via nodo","node.content.connectedEmpty":"El nodo conectado no tiene imagen.","node.content.translatePlaceholder":"Texto a traducir...","node.content.translatedTextPlaceholder":"Texto traducido...","node.content.targetLanguage":"Idioma de Destino","node.content.translate":"Traducir","node.content.translating":"Traduciendo...","node.content.scriptPromptPlaceholder":"Introduce una idea de historia o trama...","node.content.generateScript":"Generar Guion","node.content.loadScript":"Cargar Archivo de Guion","node.content.summary":"Resumen","node.content.scenes":"Escenas","node.content.unrecognizedFormat":"Formato de guion no reconocido.","node.content.frames":"Cuadros","node.content.characterIndex":"ndice","node.content.readData":"Leer Datos","node.content.textDataHere":"Los datos de texto aparecern aqu.","node.content.noDataRead":'Conecta un nodo y haz clic en "Leer Datos" para ver su contenido.',"node.content.previewError":"Error de Previsualizacin","node.content.previewPlaceholder":"La previsualizacin aparecer aqu","node.content.imagePrompt":"Prompt de Imagen","node.output.allPromptData":"Todos los Datos del Prompt","node.note.tab.note":"Nota","node.note.tab.references":"Referencias","node.note.nestedImages":"Imgenes Anidadas","node.note.dropPlaceholder":"Suelta imgenes o clic para aadir","node.note.addCaption":"Leyenda","node.note.action.shuffle":"Mezclar","node.note.action.undoShuffle":"Deshacer Mezcla","node.content.characterTypeShort":"Tipo:","node.content.numberOfCharactersShort":"Cant:","node.content.characterType.simple":"Simple","node.content.characterType.anthro":"Anthro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Objeto Clave","node.content.style.simple":"Simple","node.content.style.realistic":"Realista","node.content.style.3d_cartoon":"3D Cartoon","node.content.style.3d_realistic":"3D Realista","node.content.style.2d_animation":"Animacin 2D","node.content.style.anime":"Anime","node.content.style.comics":"Comics","node.content.style.custom":"Personalizado","node.content.fullDescriptionTitle":"Descripcin completa del personaje","node.content.integrationInstruction":"Instruccin de integracin","node.content.additionalPromptSuffix":"Prompt Adicional (Sufijo)","image_sequence.auto_crop":"Recorte Auto 16:9","image_sequence.create_zip":"Crear Archivo ZIP","node.content.modificationRequest":"Solicitud de modificacin","node.content.technicalPrompt":"Prompt Tcnico","node.promptProcessor.safePromptTooltip":"Reescribe el prompt para cumplir con las pautas de seguridad y evitar infracciones de polticas.","node.promptProcessor.technicalPromptTooltip":"Convierte el prompt en una especificacin tcnica altamente detallada (iluminacin, cmara, ajustes de renderizado).","node.promptProcessor.enhanceTooltip":"Usa IA para expandir y enriquecer el prompt con detalles descriptivos.","node.promptProcessor.chainTooltip":"Ejecuta este nodo y activa todos los nodos posteriores conectados.","image_sequence.tooltip.autoCrop":"Recorta automticamente las imgenes generadas a una proporcin de 16:9.","image_sequence.tooltip.autoDownload":"Guarda automticamente cada imagen en tu dispositivo tras la generacin.","image_sequence.tooltip.createZip":"Empaqueta todas las imgenes seleccionadas en un nico archivo ZIP para su descarga."},gb={"imageEditor.title":"Editor de Imagen","imageEditor.canvasResolution":"Resolucin del Lienzo","imageEditor.background":"Fondo","imageEditor.toolSettings":"Ajustes de Herramienta","imageEditor.snapToEdges":"Ajustar a Bordes","imageEditor.freeAspect":"Relacin de Aspecto Libre","imageEditor.section.aiRequest":"Solicitud de Modificacin IA","imageEditor.input.modificationPlaceholder":'Describe cambios, ej. "cambiar fondo a azul"',"imageEditor.action.sendRequest":"Enviar Solicitud","imageEditor.tooltip.removeObject":"Eliminar (Rojo) / Mantener (Verde)","imageEditor.action.removeObject":"Eliminar Objeto","imageEditor.tool.transform":"Transformar","imageEditor.tool.hand":"Mano (Panormica)","imageEditor.tool.zoom":"Zoom","imageEditor.tool.pencil":"Lpiz","imageEditor.tool.rectangle":"Rectngulo","imageEditor.action.fit":"Ajustar al Lienzo","imageEditor.action.fill":"Llenar Lienzo","imageEditor.action.cancel":"Cancelar","imageEditor.action.resetEdits":"Restablecer Ediciones","imageEditor.action.apply":"Aplicar","imageViewer.title":"Visor de Imagen","imageEditor.outputResolution":"Resolucin de Salida","imageEditor.outputResolutionHelp":'Establecer resolucin de salida. Si es "Auto", usa la resolucin del lienzo.',"imageEditor.currentSize":"Tamao Actual: {width}x{height}","imageEditor.sequenceMode":"Modo Secuencia","imageEditor.sequenceModeHelp":"Procesar imgenes de entrada desde Entrada A secuencialmente.","imageEditor.sequentialCombination":"Combinacin Secuencial de Imgenes","imageEditor.sequentialCombinationHelp":"Para cada cuadro: Enve la imagen actual de A + Todas las imgenes de B.","imageEditor.sequentialPrompt":"Combinacin Secuencial de Prompts","imageEditor.sequentialPromptHelp":"Para cada cuadro: Usa un prompt nico de la lista + imagen actual.","imageEditor.sequentialEditingWithPrompts":"Edicin Secuencial con Prompts","imageEditor.sequentialEditingWithPromptsHelp":"Para cada cuadro: Usa imagen de B + prompt nico. La Entrada A se ignora.","imageEditor.input":"Entrada","imageEditor.inputA":"Entrada A","imageEditor.inputB":"Entrada B","imageEditor.status.queued":"En cola","imageEditor.status.generating":"Generando...","imageEditor.action.regenerate":"Regenerar","imageEditor.tooltip.fit":"Ajustar imagen a lmites del lienzo (contener).","imageEditor.tooltip.fill":"Escalar imagen para llenar lienzo (cubrir).","imageEditor.tooltip.flip":"Voltear imagen horizontalmente.","imageEditor.background.white":"Blanco","imageEditor.background.gray":"Gris","imageEditor.background.black":"Negro","imageEditor.background.dark":"Oscuro","image_sequence.regenerate":"Regenerar","image_sequence.stop_queue":"Detener Cola","image_sequence.move_up":"Mover Arriba","image_sequence.move_down":"Mover Abajo","image_sequence.copy_prompt":"Copiar Prompt","image_sequence.add_frame":"Aadir Cuadro","image_sequence.delete_frame":"Eliminar Cuadro","image_sequence.expand_all_frames":"Expandir/Colapsar Todos los Cuadros","image_sequence.collapse_all_frames":"Colapsar Todos los Cuadros","image_sequence.expand_all_scenes":"Expandir/Colapsar Todas las Escenas","image_sequence.collapse_all_scenes":"Colapsar Todas las Escenas","image_sequence.expand_all":"Expandir Todo","image_sequence.collapse_all":"Colapsar Todo","image_sequence.clear_all_prompts":"Borrar Todos los Prompts","image_sequence.add_first_frame":"Aadir Primer Cuadro","image_sequence.drop_or_add_title":"Soltar JSON de Secuencia o Aadir Cuadro","image_sequence.drop_or_add_desc":"Suelta un archivo JSON aqu o haz clic para aadir un cuadro manualmente.","image_sequence.load_prompts":"Cargar Prompts","image_sequence.output_images_title":"Imgenes de Salida","image_sequence.prompts_list_title":"Prompts de Origen","image_sequence.download_selected":"Descargar Seleccionados","image_sequence.select_all":"Seleccionar Todo","image_sequence.select_none":"Deseleccionar","image_sequence.invert_selection":"Invertir Seleccin","image_sequence.run_selected":"Ejecutar Seleccionados","image_sequence.start_queue":"Iniciar Cola","image_sequence.character_prompt_combination":"Combinacin de Prompt de Personaje","image_sequence.combination_none":"Ninguna","image_sequence.combination_combine":"Combinar","image_sequence.combination_replace":"Reemplazar Etiquetas","image_sequence.status.error":"Error","image_sequence.status.pending":"En cola","image_sequence.clear_selected_prompts":"Borrar Prompts Seleccionados","image_sequence.range_from":"De:","image_sequence.range_to":"A:","image_sequence.stats.total":"Total Cuadros: {count}","image_sequence.stats.generated":"Generados: {count}","image_sequence.stats.queue":"Cola: {count}","image_sequence.edit_in_source":"Editar en Fuente","image_sequence.edit_prompt":"Editar Prompt","image_sequence.select_scene":"Seleccionar Escena","image_sequence.next_scene":"Siguiente Escena","image_sequence.prev_scene":"Escena Anterior","image_sequence.scene_input_label":"Escena","image_sequence.select_square":"Seleccionar Cuadradas (1:1)","image_sequence.select_landscape":"Seleccionar Paisaje (16:9)","image_sequence.select_portrait":"Seleccionar Retrato (9:16)","image_sequence.select_range":"Seleccionar Rango","image_sequence.force_refresh":"Forzar Actualizacin","image_sequence.select_scene_frames":"Seleccionar todos los cuadros en esta escena","image_sequence.collapse_other_scenes":"Colapsar otras escenas","prompt_sequence_editor.instructionPlaceholder":"Introducir instruccin para modificar prompts...","prompt_sequence_editor.modifying":"Modificando...","prompt_sequence_editor.modifySelected":"Modificar Seleccionados ({count})","prompt_sequence_editor.sourcePrompts":"Prompts de Origen","prompt_sequence_editor.finalPrompts":"Prompts Modificados","prompt_sequence_editor.error.invalidInput":"Formato de datos invlido. Por favor conecte un array de secuencia de prompts.","geminiChat.mode.general":"General","geminiChat.mode.prompt":"Experto en Prompts","geminiChat.mode.script":"Guionista","geminiChat.mode.youtube":"Analista de YouTube","image_sequence.shot_type.WS":"Integra la Entidad con un Plano General (WS) en la escena y la accin. Muestra el entorno.","image_sequence.shot_type.MS":"Integra la Entidad con un Plano Medio (MS) en la escena. Personaje desde la cintura hacia arriba.","image_sequence.shot_type.CU":"Integra la Entidad con un Primer Plano (CU) en la escena.","image_sequence.shot_type.ECU":"Integra la Entidad con un Primersimo Primer Plano (ECU) en la escena. Mximo detalle.","image_sequence.shot_type.LS":"Integra la Entidad con un Plano Largo (LS) en la escena para mostrar escala."},fb={"dialog.permission.title":"Permiso Requerido","dialog.permission.description":"Esta aplicacin necesita permiso para leer tu portapapeles y permitir pegar contenido en los nodos. Tus datos no se almacenan ni se envan a ningn lado.","dialog.permission.allow":"Permitir","dialog.permission.decline":"Rechazar","dialog.rename.title":"Renombrar Elemento","dialog.rename.group.title":"Renombrar Grupo","dialog.rename.catalog.title":"Renombrar Elemento de Catlogo","dialog.rename.node.title":"Renombrar Nodo","dialog.rename.label":"Nuevo Nombre:","dialog.rename.confirm":"Renombrar","dialog.rename.cancel":"Cancelar","dialog.promptEdit.title":"Editar Prompt","dialog.promptEdit.nameLabel":"Nombre:","dialog.promptEdit.contentLabel":"Contenido:","dialog.promptEdit.confirm":"Guardar","dialog.promptEdit.cancel":"Cancelar","dialog.confirmDelete.title":"Confirmar Eliminacin","dialog.confirmDelete.message":"Ests seguro de que quieres eliminar este elemento? Esta accin no se puede deshacer.","dialog.confirmDelete.confirm":"Eliminar","dialog.confirmDelete.cancel":"Cancelar","dialog.confirmCloseTab.title":"Cerrar Pestaa","dialog.confirmCloseTab.message":'Ests seguro de que quieres cerrar la pestaa "{tabName}"? Se perdern los cambios no guardados.',"dialog.confirmClear.title":"Limpiar Lienzo","dialog.confirmClear.message":"Ests seguro de que quieres limpiar todo el lienzo? Esta accin no se puede deshacer.","dialog.confirmReset.title":"Restablecer a Predeterminado","dialog.confirmReset.message":"Ests seguro de que quieres restablecer el lienzo al estado predeterminado? Se perder todo el trabajo actual.","dialog.confirmReset.confirm":"Restablecer","dialog.confirmLoad.title":"Confirmar Carga","dialog.confirmLoad.message":"Cargar un nuevo archivo reemplazar el contenido actual. Se perder cualquier cambio no guardado. Continuar?","dialog.apiKey.title":"Seleccionar Clave API","dialog.apiKey.description":'Esta funcin requiere una clave API de proyecto con la API "AI Platform" habilitada. La generacin de video puede tardar unos minutos.',"dialog.apiKey.billingLink":"Aprende ms sobre facturacin","dialog.apiKey.button":"Seleccionar Clave API","dialog.settings.title":"Ajustes","dialog.settings.apiKeyLabel":"Tu Clave API de Google Gemini:","dialog.settings.useDevKeyLabel":"Usar clave API gratuita (para desarrollo)","dialog.settings.instantNodeCloseLabel":"Cierre instantneo de nodos","dialog.settings.nodeAnimationLabel":"Animacin de Adicin de Nodo","dialog.settings.animationModeLabel":"Modo de Animacin de Creacin","dialog.settings.anim.pulse":"Pulso","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"Ninguna","dialog.settings.description":"Para usar tus propias cuotas y acceder a modelos especficos, ingresa tu clave API personal. La clave se almacena localmente en tu navegador.","dialog.settings.getKeyLink":"Obtn una Clave API aqu","dialog.settings.save":"Guardar","dialog.settings.reload":"Recargar App","dialog.deleteNode.title":"Cerrar nodo?","dialog.deleteNode.titlePlural":"Cerrar nodos?","dialog.deleteNode.confirm":"S","dialog.deleteNode.cancel":"No","dialog.deleteNode.confirmTooltip":"Cerrar nodo - los datos perdidos no se pueden recuperar","dialog.deleteNode.cancelTooltip":"No cerrar - continuar trabajando con el nodo","dialog.deleteNode.dontShowAgain":"No mostrar de nuevo","dialog.exitApp.title":"Cerrar Proyecto?","dialog.exitApp.message":"Ests seguro de que quieres cerrar el proyecto? Todo el trabajo actual se perder y el lienzo se reiniciar."},xb={"group.button.create":"Crear Grupo ({count})","group.rename":"Renombrar Grupo","group.saveToCatalog":"Guardar en Catlogo","group.saveToDisk":"Guardar en Disco","group.ungroup":"Desagrupar (Shift+Clic para eliminar con contenido)","group.duplicate":"Duplicar grupo con contenido","catalog.tabs.groups":"Grupos","catalog.tabs.library":"Biblioteca","catalog.tabs.characters":"Personajes","catalog.tabs.scripts":"Guiones","catalog.tabs.sequences":"Secuencias","catalog.back":"Atrs","catalog.load":"Cargar desde Archivo","catalog.newFolder":"Nueva Carpeta","catalog.saveTo":"Guardar en Catlogo","catalog.card.addToCanvas":"Aadir al Lienzo","catalog.card.rename":"Renombrar","catalog.card.save":"Guardar","catalog.card.delete":"Eliminar","catalog.empty.description":"Esta carpeta est vaca. Puedes aadir elementos o crear nuevas carpetas.","library.loadFromFile":"Cargar","library.actions.newFolder":"Nueva Carpeta","library.actions.newPrompt":"Nuevo Prompt","library.actions.copy":"Copiar","library.actions.edit":"Editar","library.empty.title":"Carpeta Vaca","library.empty.description":"Crea prompts y carpetas para empezar.","library.emptyPrompt":"Prompt vaco"},yb={...pb,...hb,...mb,...gb,...fb,...xb},vb={"app.title":"Prompt Modifikatori","app.subtitle":"G'oyalarni bog'lab, shoh asar yarating","app.error.title":"Bildirishnoma","app.error.copy":"Xabarni nusxalash","app.error.copied":"Nusxalandi!","error.apiKey":"API kalitingiz yaroqsiz yoki ruxsatlar yetishmayapti. Iltimos, to'g'ri API kalitini tanlang.","error.scriptModifierCanvas":"Bu xolst boshqa ilovaga tegishli - Script Modifier. Iltimos, ushbu faylni ochish uchun Script Modifier-dan foydalaning.","welcome.title":"Xush kelibsiz","welcome.description":"Prompt Modifier-ga xush kelibsiz. G'oyalarni bog'lab, shoh asar yarating. Tarkibni yaratish va tahrirlash uchun tugunlardan foydalaning.","welcome.apiKeyLabel":"Sizning Google Gemini API Kalitingiz","welcome.apiKeyPlaceholder":"API kalitingizni shu yerga kiriting...","welcome.apiKeyHelp":"Sizning API kalitingiz lokal tarzda saqlanadi.","welcome.getKeyLink":"API Kalitini Olish","welcome.iAmDeveloper":"Men Dasturchiman","welcome.letsGo":"Boshladik","welcome.freeModeActive":"Bepul Rejim Faol","welcome.selectLanguage":"Asosiy tilingizni tanlang","welcome.navHint":"Tilni o'zgartirish uchun klaviatura tugmalari  va  dan foydalaning","toast.contentCleared":"Tarkib tozalandi","toast.downloadStarted":"Yuklab olish boshlandi","toast.characterLoaded":"Personaj kartasi yuklandi","toast.characterSavedDisk":"Personaj kartasi diskka saqlandi","toast.copiedToClipboard":"Buferga nusxalandi","toast.pastedFromClipboard":"Buferdan joylandi","toast.pasteFailed":"Joylash amalga oshmadi","toast.nodeDuplicated":"Tugun nusxalandi","toast.groupSavedToDisk":'"{groupTitle}" guruhi diskka saqlandi',"toast.groupDeleted":"Guruh va uning tarkibi o'chirildi","toast.characterSavedCatalog":"Personaj katalogga saqlandi","toast.promptSaved":"Prompt kutubxonaga saqlandi: {promptName}...","toast.connectionsCut":"Ulanishlar uzildi","toast.apiKeySaved":"API Kaliti muvaffaqiyatli saqlandi","toast.cacheCleared":"{count} ta foydalanilmagan element keshdan tozalandi","toast.cacheEmpty":"Kesh allaqachon optimallashtirilgan","toast.scriptSaved":"Ssenariy diskka saqlandi","alert.groupSaved":'"{groupTitle}" guruhi katalogga saqlandi.',"alert.loadCatalogFailed":"Katalog faylini yuklashda xatolik","alert.invalidCatalogFile":"Katalog fayli formati noto'g'ri","alert.fileNotSupported":`Fayl qo'llab-quvvatlanmaydi. "appName" yetishmayapti yoki noto'g'ri.`,"alert.invalidCatalogStructure":`Katalog tuzilishi noto'g'ri. "root" yetishmayapti.`},wb={"toolbar.settings":"Sozlamalar","toolbar.resetCanvas":"Xolstni tiklash","toolbar.clearCache":"Foydalanilmagan keshni tozalash","toolbar.home":"Bosh sahifa","toolbar.edit":"Tahrirlash (V)","toolbar.cutter":"Ulanishni qirqish (C) / (Ctrl bosib turing)","toolbar.selection":"Tanlash (S) / (Shift bosib turing)","toolbar.reroute":"Yo'naltirish (R) / (Ctrl+Alt bosib turing)","toolbar.zoom":"Kattalashtirish (Z bosib turing)","toolbar.snapToGrid":"To'rga yopishtirish","toolbar.smartGuides":"Aqlli qo'llanmalar","toolbar.lineStyleSpaghetti":"Spagetti chiziqlar","toolbar.lineStyleOrthogonal":"To'g'ri chiziqlar","toolbar.resetZoom":"Masshtabni tiklash","toolbar.resetCamera":"Kamera holatini tiklash","toolbar.clearCanvas":"Xolstni tozalash","toolbar.addNode":"Tugun qo'shish (F)","toolbar.catalog":"Katalogni ochish (Ctrl + Space)","toolbar.addNote":"Eslatma qo'shish (N)","toolbar.addDataReader":"Ma'lumot o'quvchi qo'shish (Shift + R)","toolbar.addTextInput":"Matn kiritish qo'shish (T)","toolbar.addImageInput":"Rasm kiritish qo'shish (I)","toolbar.addPromptSequenceEditor":"Prompt ketma-ketligi muharriri (Q)","toolbar.addImageAnalyzer":"Rasm analizatorini qo'shish (Shift+A)","toolbar.addPromptAnalyzer":"Prompt analizatorini qo'shish (A)","toolbar.addPromptProcessor":"Prompt protsessorini qo'shish (P)","toolbar.addCharacterGenerator":"Personaj generatorini qo'shish (Shift+C)","toolbar.addCharacterAnalyzer":"Personaj analizatorini qo'shish (Ctrl+Shift+A)","toolbar.addCharacterCard":"Personaj kartasini qo'shish (Ctrl+Shift+C)","toolbar.addImageOutput":"Rasm natijasini qo'shish (O)","toolbar.addImageEditor":"AI Rasm muharririni qo'shish (Shift+I)","toolbar.addImageSequenceGenerator":"Rasm ketma-ketligi generatorini qo'shish (Shift+Q)","toolbar.addTranslator":"Tarjimon qo'shish (L)","toolbar.addGeminiChat":"Gemini Chat qo'shish (M)","toolbar.addVideoPromptProcessor":"Video prompt protsessorini qo'shish (Shift+P)","toolbar.addVideoOutput":"Video natijasini qo'shish (Shift+O)","toolbar.addScriptGenerator":"Ssenariy generatorini qo'shish","toolbar.addScriptViewer":"Ssenariy ko'ruvchisini qo'shish (Shift + V)","toolbar.saveCanvas":"Xolstni saqlash (Ctrl + S)","toolbar.saveProject":"Loyihani saqlash","toolbar.loadCanvas":"Loyiha/Xolstni yuklash (Ctrl + O)","toolbar.group.general":"Umumiy","toolbar.group.catalog":"Katalog","toolbar.group.input":"Kiritish","toolbar.group.processing":"Qayta ishlash","toolbar.group.character":"Personaj","toolbar.group.output":"Chiqarish","toolbar.group.aiTools":"AI Vositalari","toolbar.group.video":"Video","toolbar.group.scripts":"Ssenariylar","toolbar.group.file":"Fayl","toolbar.title":"Asboblar paneli","toolbar.dock":"Panelni mahkamlash","toolbar.detach":"Panelni ajratish","toolbar.expandPanel":"Panelni kengaytirish","toolbar.collapsePanel":"Panelni yig'ish","toolbar.dockArea.title":"Panelni shu yerga mahkamlash","toolbar.duplicate":"Tugunni nusxalash","toolbar.duplicateWithContent":"Tarkib bilan nusxalash","toolbar.dock.q1":"Chap 1-chorak","toolbar.dock.q2":"Chap 2-chorak","toolbar.dock.q3":"O'ng 3-chorak","toolbar.dock.q4":"O'ng 4-chorak","toolbar.dock.tl":"Yuqori Chap","toolbar.dock.bl":"Pastki Chap","toolbar.dock.tr":"Yuqori O'ng","toolbar.dock.br":"Pastki O'ng","toolbar.dock.left":"Chap Yarim","toolbar.dock.right":"O'ng Yarim","toolbar.dock.full":"To'liq Ekran","toolbar.dock.exitFull":"To'liq ekrandan chiqish","toolbar.dock.fullFocus":"To'liq ekran fokusi","hotkeys.show":"Tugmalar birikmasini ko'rsatish","hotkeys.tools.title":"Vositalar","hotkeys.tools.edit":"Tahrirlash rejimi","hotkeys.tools.cutter":"Qirqish vositasi","hotkeys.tools.selection":"Tanlash vositasi","hotkeys.tools.reroute":"Yo'naltirish vositasi","hotkeys.tools.zoom":"Kattalashtirish vositasi","hotkeys.tools.toggleLineStyle":"Chiziq uslubini o'zgartirish","hotkeys.tools.group":"Guruh tanlash","hotkeys.tools.closeNode":"Tanlanganni o'chirish","hotkeys.tools.duplicate":"Tugunni nusxalash","hotkeys.tools.duplicateWithContent":"Tarkib bilan nusxalash","hotkeys.tools.deleteGroup":"Guruhni o'chirish (Shift+Click)","hotkeys.windows.title":"Oynalar","hotkeys.windows.search":"Tezkor qidiruv","hotkeys.windows.catalog":"Katalog","hotkeys.createNode.title":"Tugun yaratish","help.panelTitle":"Yordam va Tugmalar","help.title":"Klaviatura tugmalari","help.howToUse.title":"Qanday ishlatiladi","help.howToUse.content":"Prompt Modifier-ga xush kelibsiz! Tugunlarni qo'shish uchun asboblar paneli yoki tugmalar birikmasidan foydalaning. Ma'lumot uzatish uchun tugunlarni ulang. Tugunlarni ko'chirish va xolstni surish uchun Tahrirlash vositasidan foydalaning. Tezkor qo'shish menyusini ochish uchun bo'sh joyga ikki marta bosing. O'ng tugma kontekst menyusi uchun.","help.author":"Muallif","contextMenu.undoPosition":"Joylashuvni bekor qilish","contextMenu.redoPosition":"Joylashuvni qaytarish","contextMenu.align.left":"Chapga tekislash (F)","contextMenu.align.centerX":"Markazga (X) tekislash (E)","contextMenu.align.right":"O'ngga tekislash (R)","contextMenu.align.top":"Yuqoriga tekislash (T)","contextMenu.align.centerY":"Markazga (Y) tekislash (D)","contextMenu.align.bottom":"Pastga tekislash (B)","contextMenu.distribute.horizontal":"Gorizontal taqsimlash (Ctrl+D)","contextMenu.distribute.vertical":"Vertikal taqsimlash (Ctrl+E)","contextMenu.emptySlot":"Bo'sh slot (Tayinlash uchun o'ng tugma)","contextMenu.saveSlots":"Slotlar konfiguratsiyasini saqlash","contextMenu.loadSlots":"Slotlar konfiguratsiyasini yuklash","quickadd.title":"Tezkor Qo'shish","quickadd.group.tools":"Vositalar","quickadd.group.inputs":"Kiritish","quickadd.group.processing":"Qayta ishlash","quickadd.group.character":"Personaj","quickadd.group.outputs":"Chiqarish","quickadd.group.ai":"AI Vositalari","quickadd.group.video":"Video","quickadd.group.scripts":"Ssenariylar","quickadd.group.general":"Umumiy","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"Tahrirlash","quickadd.tool.cutter":"Qirqish","quickadd.tool.selection":"Tanlash","search.placeholder":"Qo'shish uchun tugunni qidiring...","search.noResults":"Tugunlar topilmadi.","search.group.input":"Kiritish va Asosiy","search.group.process":"Qayta ishlash va Personaj","search.group.output":"Rasm va Ketma-ketlik","search.group.ai":"AI Vositalari","search.group.video":"Video va Skriptlash","search.group.scripts":"Ssenariylar","toolbar.exitApp":"Loyihani yopish"},bb={"node.title.text_input":"Matn Kiritish","node.title.image_input":"Rasm Kiritish","node.title.prompt_processor":"Prompt Protsessori","node.title.prompt_sanitizer":"Prompt Tozalagich","node.title.video_prompt_processor":"Video Prompt Protsessori","node.title.image_output":"Rasm Natijasi","node.title.video_output":"Video Natijasi","node.title.prompt_analyzer":"Prompt Analizatori","node.title.character_analyzer":"Personaj Analizatori","node.title.character_generator":"Personaj Generatori","node.title.character_card":"Personaj Kartasi","node.title.image_analyzer":"Rasm Analizatori","node.title.image_editor":"AI Rasm Muharriri","node.title.image_sequence_generator":"Rasm Ketma-ketligi Generatori","node.title.prompt_sequence_editor":"Prompt Ketma-ketligi Muharriri","node.title.gemini_chat":"Gemini Chat","node.title.translator":"Tarjimon","node.title.script_generator":"Ssenariy Generatori","node.title.script_viewer":"Ssenariy Ko'ruvchisi","node.title.note":"Eslatma","node.title.reroute_dot":"Yo'naltirish Nuqtasi","node.title.data_reader":"Ma'lumot O'quvchi","node.title.video_editor":"Video Muharriri Alfa Versiyasi","node.title.media_viewer":"Media Ko'ruvchi","node.title.data_protection":"Ma'lumotlarni Himoyalash","node.title.pose_creator":"Pose Creator","node.help.text_input":"Promptlar yoki eslatmalar kiritish uchun oddiy ko'p qatorli matn maydoni.","node.help.image_input":"Boshqa tugunlarda ishlatish uchun rasm yuklash yoki joylash imkonini beradi.","node.help.prompt_processor":"AI yordamida bir nechta matnli kiritmalarni bitta yaxshilangan promptga birlashtiradi.","node.help.prompt_sanitizer":"San'at maqsadini saqlagan holda rasm yaratish siyosati uchun xavfsizroq bo'lishi uchun kirish promptini qayta yozadi.","node.help.video_prompt_processor":"Video yaratish uchun batafsil promptlar yaratishga ixtisoslashgan protsessor.","node.help.image_output":"Rasm yaratish natijasini ko'rsatadi. Yuklab olish va ko'rishni qo'llab-quvvatlaydi.","node.help.video_output":"Veo modeli yordamida video yaratish natijasini ko'rsatadi.","node.help.prompt_analyzer":"Promptni mavzu, uslub va muhit kabi tarkibiy qismlarga ajratadi.","node.help.character_analyzer":"Personaj tavsifini tahlil qiladi va uni tashqi ko'rinish va kiyimga ajratadi.","node.help.character_generator":"Qisqa prompt asosida batafsil personaj tavsiflarini yaratadi.","node.help.character_card":"Rasm va tavsifni o'z ichiga olgan to'liq personaj ma'lumotlarini saqlaydi.","node.help.image_analyzer":"Kiritilgan rasmning mazmunini tasvirlash uchun AIdan foydalanadi.","node.help.image_editor":"Matn promptlari va inpainting/outpainting yordamida rasmlarni tahrirlash uchun ilg'or vosita.","node.help.image_sequence_generator":"Promptlar ro'yxati asosida rasmlar ketma-ketligini yaratadi.","node.help.prompt_sequence_editor":"AI ko'rsatmalari yordamida promptlar ketma-ketligini ommaviy tahrirlash imkonini beradi.","node.help.gemini_chat":"Fikr almashish yoki yordam olish uchun Gemini bilan umumiy maqsadli suhbat interfeysi.","node.help.translator":"AI modellari yordamida matnni tillar o'rtasida tarjima qiladi.","node.help.script_generator":"Hikoya g'oyasidan tuzilgan ssenariy (sahnalar, personajlar) yaratadi.","node.help.script_viewer":"Kadrlar bo'yicha generatsiya qilish uchun ssenariy ma'lumotlarini vizualizatsiya qiladi va boshqaradi.","node.help.note":"Xolstga izohlar yoki ko'rsatmalar qo'shish uchun yopishqoq eslatma.","node.help.reroute_dot":"Ulanishlarni tashkil qilish va toza chizmalar yaratish uchun kichik nuqta.","node.help.data_reader":"Ulanishlar orqali oqayotgan xom ma'lumotlarni tekshirish uchun disk raskadrovka vositasi.","node.help.video_editor":"Video kliplar va rasmlarni tahrirlash uchun vaqt shkalasi asosidagi vosita.","node.help.media_viewer":"Video va audio fayllarni ijro etish boshqaruvlari bilan ko'rish uchun pleyer.","node.help.data_protection":"Ma'lumotlar oqimini buzilishdan himoya qiluvchi mini-o'yin tuguni.","node.help.pose_creator":"Vizual rig yordamida personaj pozalarini yaratish va generatsiya uchun yo'riqnoma sifatida foydalanish.","node.action.expand":"Kengaytirish","node.action.collapse":"Yig'ish","node.action.help":"Yordam","node.action.download":"Yuklab olish","node.action.clear":"Tarkibni tozalash","node.action.refreshChat":"Chatni tozalash va qayta boshlash","node.action.paste":"Joylash","node.action.resetEditor":"Muharrirni tiklash","node.action.saveCharacter":"Diskka saqlash","node.action.loadCharacter":"Diskdan yuklash","node.action.copy":"Nusxalash","node.action.copyImage":"Rasmni nusxalash","node.action.copyTextPrompt":"Promptni nusxalash","node.action.copyImagePrompt":"Rasm promptini nusxalash","node.action.copyVideoPrompt":"Video promptini nusxalash","node.action.cutConnections":"Ulanishlarni uzish","node.action.close":"Yopish","node.action.closeNode":"Tugunni yopish (Shift+Click)","node.action.closeNodeSimple":"Tugunni yopish","node.action.randomWord":"Tasodifiy so'z qo'shish","node.action.processImage":"Belgilarni olib tashlash","node.action.processImageTitle":"Rasm va matn belgilarini olib tashlash uchun Gemini-dan foydalanadi.","node.action.editor":"Muharrir","node.action.rasterEditor":"Raster Muharriri","node.action.openInAIEditor":"AI Muharririda ochish","node.action.openInAnalyzer":"Analizatorda ochish","node.action.outputToInput":"Chiqishni kirish sifatida ishlatish","node.action.processChainForward":"Oldinga qayta ishlash","node.action.executeChain":"Zanjirni bajarish","node.action.executeChainTitle":"Yakuniy natijani yaratish uchun barcha yuqori oqim tugunlarini bajaring.","node.action.sanitize":"Tozalash","node.action.rename":"Nomini o'zgartirish","node.action.stop":"To'xtatish","node.action.stopping":"To'xtatilmoqda...","node.action.deleteItem":"Elementni o'chirish","node.action.detachAndPaste":"Ajratish va joylash","node.action.delete":"O'chirish","node.action.flipImage":"Rasmni aylantirish","node.action.pin":"Tugunni yuqoriga mahkamlash","node.action.unpin":"Tugunni bo'shatish","node.action.updateDescription":"Tavsifni yangilash","node.action.modifyCharacter":"O'zgarishlarni so'rash","node.action.updateDataFormat":"Ma'lumot formatini yangilash","node.action.expand169":"16:9 ga kengaytirish","node.action.expand916":"9:16 ga kengaytirish","node.action.sync":"Ulanishlardan sinxronlash","node.action.expandRatio":"Nisbatni kengaytirish","node.action.markPrimary":"Asosiy qilib belgilash","node.action.addCard":"Karta qo'shish","node.action.removeCard":"Kartani o'chirish","node.action.showOutputs":"Chiqishlarni ko'rsatish","node.action.hideOutputs":"Chiqishlarni yashirish","node.mediaViewer.play":"Ijro etish","node.mediaViewer.pause":"Pauza","node.mediaViewer.stop":"To'xtatish","node.mediaViewer.addMarker":"Marker qo'shish","node.mediaViewer.exportSRT":"Markerlarni eksport qilish (SRT)","node.mediaViewer.deleteAllMarkers":"Barcha markerlarni o'chirish","node.mediaViewer.saveMarkers":"Markerlarni saqlash","node.mediaViewer.loadMarkers":"Markerlarni yuklash","node.mediaViewer.relink":"Faylni qayta ulash","node.content.notePlaceholder":"Matningizni shu yerga kiriting...","node.content.dropImage":"Rasmni shu yerga tashlang yoki yuklash uchun bosing","node.content.dropMedia":"Video yoki audioni shu yerga tashlang","node.content.processing":"Qayta ishlanmoqda...","node.content.processingChain":"Zanjir qayta ishlanmoqda...","node.content.metadataPrompt":"Rasm metama'lumotlaridan prompt:","node.content.metadataPromptPlaceholder":"Rasmda prompt topilmadi.","node.content.copyPrompt":"Ishlatish","node.content.prompt":"Prompt","node.content.inputPrompt":"Kirish Prompti","node.content.enhancedResult":"Yaxshilangan Natija","node.content.videoPrompt":"Video Prompt","node.content.editPromptPlaceholder":"Promptga qo'shing yoki tahrirlang...","node.content.enhancedPromptHere":"Yaxshilangan prompt shu yerda paydo bo'ladi...","node.content.safePrompt":"Tijorat uchun xavfsiz","node.content.generating":"Yaratilmoqda...","node.content.imageHere":"Rasm shu yerda paydo bo'ladi","node.content.generationMode":"Yaratish Modeli","node.content.aspectRatio":"Tomonlar nisbati","node.content.aspectRatioHelp":"Rasm yaratish uchun tomonlar nisbatini o'rnating","node.content.aspectRatioNotSupportedFast":"Tomonlar nisbati faqat Imagen modellari uchun mavjud.","node.content.enableAspectRatioFormatting":"Nisbatni formatlashni yoqish","node.content.autoDownload":"Avto Yuklash","node.content.generateImage":"Rasm Yaratish","node.content.enhancing":"Yaxshilanmoqda...","node.content.enhancePrompt":"Promptni Yaxshilash","node.content.sanitizing":"Tozalanmoqda...","node.content.sanitizedPromptHere":"Tozalangan prompt shu yerda paydo bo'ladi...","node.content.analyzing":"Tahlil qilinmoqda...","node.content.analyzePrompt":"Promptni Tahlil Qilish","node.content.analyzeImage":"Rasmni Tahlil Qilish","node.content.imageToText":"Rasmdan Matnga","node.content.updatePromptFromImage":"Rasmdan promptni yangilash","node.content.analyzeCharacter":"Personajni Tahlil Qilish","node.content.generateCharacters":"Personajlarni Yaratish","node.content.characterPromptPlaceholder":"Yaratish uchun personaj(lar)ni tasvirlang...","node.content.character":"Personaj","node.content.clothing":"Kiyim","node.content.characterPlaceholder":"Personaj tavsifi shu yerda paydo bo'ladi...","node.content.clothingPlaceholder":"Kiyim tavsifi shu yerda paydo bo'ladi...","node.content.appearance":"Tashqi ko'rinish","node.content.personality":"Shaxsiyat","node.content.environment":"Muhit/Sozlama","node.content.action":"Harakat","node.content.emotion":"Hissiyot","node.content.style":"Uslub","node.content.environmentPlaceholder":"Muhitning batafsil tavsifi...","node.content.charactersPlaceholder":"Asosiy personajlar ro'yxati...","node.content.characters":"Personajlar","node.content.characterConcepts":"Personaj Konseptlari","node.content.actionPlaceholder":"Harakat tavsifi...","node.content.emotionPlaceholder":"Hissiyot tavsifi...","node.content.stylePlaceholder":"San'at uslubi tavsifi...","node.content.descriptionHere":"Tavsif shu yerda paydo bo'ladi...","node.content.enableOutpainting":"Outpainting-ni yoqish","node.content.outpaintingPromptPlaceholder":"Outpainting prompti...","node.content.inputImage":"Kirish Rasmlari","node.content.dropOrClick":"Tashlang yoki Bosing","node.content.outputImage":"Chiqish Rasmi","node.content.applyEdit":"Tahrirni Qo'llash","node.content.editing":"Tahrirlanmoqda...","node.content.chatPlaceholder":"Xabaringizni kiriting...","node.content.connectedPlaceholder":"Tugunga ulangan, manbada tahrirlang.","node.content.connectedNode":"Tugun orqali ulangan","node.content.connectedEmpty":"Ulangan tugunda rasm yo'q.","node.content.translatePlaceholder":"Tarjima qilinadigan matn...","node.content.translatedTextPlaceholder":"Tarjima qilingan matn...","node.content.targetLanguage":"Maqsadli Til","node.content.translate":"Tarjima qilish","node.content.translating":"Tarjima qilinmoqda...","node.content.scriptPromptPlaceholder":"Hikoya g'oyasi yoki syujetini kiriting...","node.content.generateScript":"Ssenariy Yaratish","node.content.loadScript":"Ssenariy faylini yuklash","node.content.summary":"Xulosa","node.content.scenes":"Sahnalar","node.content.unrecognizedFormat":"Tanilmagan ssenariy formati.","node.content.frames":"Kadrlar","node.content.characterIndex":"Indeks","node.content.readData":"Ma'lumotni O'qish","node.content.textDataHere":"Matn ma'lumotlari shu yerda paydo bo'ladi.","node.content.noDataRead":`Tarkibni ko'rish uchun tugunni ulang va "Ma'lumotni O'qish" ni bosing.`,"node.content.previewError":"Ko'rib chiqish xatosi","node.content.previewPlaceholder":"Ko'rib chiqish shu yerda paydo bo'ladi","node.content.imagePrompt":"Rasm Prompti","node.output.allPromptData":"Barcha Prompt Ma'lumotlari","node.note.tab.note":"Eslatma","node.note.tab.references":"Manbalar","node.note.nestedImages":"Ichki Rasmlar","node.note.dropPlaceholder":"Rasmlarni tashlang yoki qo'shish uchun bosing","node.note.addCaption":"Sarlavha","node.note.action.shuffle":"Aralashtirish","node.note.action.undoShuffle":"Aralashtirishni bekor qilish","node.content.characterTypeShort":"Tur:","node.content.numberOfCharactersShort":"Son:","node.content.characterType.simple":"Oddiy","node.content.characterType.anthro":"Anthro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Kalit element","node.content.style.simple":"Oddiy","node.content.style.realistic":"Haqiqiy","node.content.style.3d_cartoon":"3D Multfilm","node.content.style.3d_realistic":"3D Haqiqiy","node.content.style.2d_animation":"2D Animatsiya","node.content.style.anime":"Anime","node.content.style.comics":"Komiks","node.content.style.custom":"Maxsus","node.content.fullDescriptionTitle":"To'liq personaj tavsifi","node.content.integrationInstruction":"Integratsiya bo'yicha ko'rsatma","node.content.additionalPromptSuffix":"Qo'shimcha Prompt (Suffiks)","image_sequence.auto_crop":"Avto-qirqish 16:9","image_sequence.create_zip":"ZIP arxiv yaratish","node.content.modificationRequest":"O'zgartirish So'rovi","node.content.technicalPrompt":"Texnik Prompt","node.promptProcessor.safePromptTooltip":"Xavfsizlik qoidalariga rioya qilish va siyosat buzilishining oldini olish uchun promptni qayta yozadi.","node.promptProcessor.technicalPromptTooltip":"Promptni juda batafsil texnik spetsifikatsiyaga aylantiradi (yorug'lik, kamera, render sozlamalari).","node.promptProcessor.enhanceTooltip":"Promptni tavsiflovchi tafsilotlar bilan kengaytirish va boyitish uchun AIdan foydalanadi.","node.promptProcessor.chainTooltip":"Ushbu tugunni bajaradi va barcha ulangan quyi oqim tugunlarini ishga tushiradi.","image_sequence.tooltip.autoCrop":"Yaratilgan rasmlarni avtomatik ravishda 16:9 nisbatiga qirqadi.","image_sequence.tooltip.autoDownload":"Yaratilgandan so'ng har bir rasmni avtomatik ravishda qurilmangizga saqlaydi.","image_sequence.tooltip.createZip":"Yuklab olish uchun barcha tanlangan rasmlarni bitta ZIP arxiviga joylaydi."},Cb={"imageEditor.title":"Rasm Muharriri","imageEditor.canvasResolution":"Xolst O'lchami","imageEditor.background":"Orqa Fon","imageEditor.toolSettings":"Asbob Sozlamalari","imageEditor.snapToEdges":"Chegaralarga yopishtirish","imageEditor.freeAspect":"Erkin Nisbat","imageEditor.section.aiRequest":"AI O'zgartirish So'rovi","imageEditor.input.modificationPlaceholder":`O'zgarishlarni tavsiflang, masalan "orqa fonni ko'k rangga o'zgartir"`,"imageEditor.action.sendRequest":"So'rov yuborish","imageEditor.tooltip.removeObject":"O'chirish (Qizil) / Saqlash (Yashil)","imageEditor.action.removeObject":"Obyektni o'chirish","imageEditor.tool.transform":"Transfarmatsiya","imageEditor.tool.hand":"Qo'l (Siljitish)","imageEditor.tool.zoom":"Kattalashtirish","imageEditor.tool.pencil":"Qalam","imageEditor.tool.rectangle":"To'rtburchak","imageEditor.action.fit":"Xolstga moslashtirish","imageEditor.action.fill":"Xolstni to'ldirish","imageEditor.action.cancel":"Bekor qilish","imageEditor.action.resetEdits":"Tahrirlarni tiklash","imageEditor.action.apply":"Qo'llash","imageViewer.title":"Rasm Ko'ruvchi","imageEditor.outputResolution":"Chiqish O'lchami","imageEditor.outputResolutionHelp":`Chiqish o'lchamini o'rnating. Agar "Auto" bo'lsa, xolst o'lchamidan foydalanadi.`,"imageEditor.currentSize":"Joriy O'lcham: {width}x{height}","imageEditor.sequenceMode":"Ketma-ketlik Rejimi","imageEditor.sequenceModeHelp":"Input A dagi kirish rasmlarini ketma-ket qayta ishlash.","imageEditor.sequentialCombination":"Rasmlarni Ketma-ket Birlashtirish","imageEditor.sequentialCombinationHelp":"Har bir kadr uchun: Joriy Input A rasmi + Barcha Input B rasmlarini yuboradi.","imageEditor.sequentialPrompt":"Promptlarni Ketma-ket Birlashtirish","imageEditor.sequentialPromptHelp":"Har bir kadr uchun: Ro'yxatdagi noyob prompt + joriy rasmni ishlatadi.","imageEditor.sequentialEditingWithPrompts":"Promptlar bilan Ketma-ket Tahrirlash","imageEditor.sequentialEditingWithPromptsHelp":"Har bir kadr uchun: Input B rasmi + noyob prompt ishlatiladi. Input A e'tiborga olinmaydi.","imageEditor.input":"Kirish","imageEditor.inputA":"Kirish A","imageEditor.inputB":"Kirish B","imageEditor.status.queued":"Navbatda","imageEditor.status.generating":"Yaratilmoqda...","imageEditor.action.regenerate":"Qayta yaratish","imageEditor.tooltip.fit":"Rasmni xolst chegaralariga moslashtirish (sig'dirish).","imageEditor.tooltip.fill":"Rasmni xolstni to'ldirish uchun masshtablash (qoplash).","imageEditor.tooltip.flip":"Rasmni gorizontal aylantirish.","imageEditor.background.white":"Oq","imageEditor.background.gray":"Kulrang","imageEditor.background.black":"Qora","imageEditor.background.dark":"To'q","image_sequence.regenerate":"Qayta yaratish","image_sequence.stop_queue":"Navbatni to'xtatish","image_sequence.move_up":"Yuqoriga","image_sequence.move_down":"Pastga","image_sequence.copy_prompt":"Promptni nusxalash","image_sequence.add_frame":"Kadr qo'shish","image_sequence.delete_frame":"Kadrni o'chirish","image_sequence.expand_all_frames":"Barcha Kadrlarni Yoyish/Yig'ish","image_sequence.collapse_all_frames":"Barcha Kadrlarni Yig'ish","image_sequence.expand_all_scenes":"Barcha Sahnalarni Yoyish/Yig'ish","image_sequence.collapse_all_scenes":"Barcha Sahnalarni Yig'ish","image_sequence.expand_all":"Hammasini Yoyish","image_sequence.collapse_all":"Hammasini Yig'ish","image_sequence.clear_all_prompts":"Barcha Promptlarni Tozalash","image_sequence.add_first_frame":"Birinchi Kadrni Qo'shish","image_sequence.drop_or_add_title":"Ketma-ketlik JSON tashlang yoki Kadr qo'shing","image_sequence.drop_or_add_desc":"JSON faylni shu yerga tashlang yoki kadrni qo'lda qo'shish uchun tugmani bosing.","image_sequence.load_prompts":"Promptlarni Yuklash","image_sequence.output_images_title":"Chiqish Rasmlari","image_sequence.prompts_list_title":"Manba Promptlar","image_sequence.download_selected":"Tanlanganlarni Yuklash","image_sequence.select_all":"Hammasini Tanlash","image_sequence.select_none":"Tanlovni Bekor Qilish","image_sequence.invert_selection":"Tanlovni Teskari Qilish","image_sequence.run_selected":"Tanlanganlarni Ishga Tushirish","image_sequence.start_queue":"Navbatni Boshlash","image_sequence.character_prompt_combination":"Personaj Prompt Kombinatsiyasi","image_sequence.combination_none":"Yo'q","image_sequence.combination_combine":"Birlashtirish","image_sequence.combination_replace":"Teglarni almashtirish","image_sequence.status.error":"Xato","image_sequence.status.pending":"Navbatda","image_sequence.clear_selected_prompts":"Tanlangan Promptlarni Tozalash","image_sequence.range_from":"Dan:","image_sequence.range_to":"Gacha:","image_sequence.stats.total":"Jami Kadrlar: {count}","image_sequence.stats.generated":"Yaratildi: {count}","image_sequence.stats.queue":"Navbat: {count}","image_sequence.edit_in_source":"Manbada Tahrirlash","image_sequence.edit_prompt":"Promptni Tahrirlash","image_sequence.select_scene":"Sahnani Tanlash","image_sequence.next_scene":"Keyingi Sahna","image_sequence.prev_scene":"Oldingi Sahna","image_sequence.scene_input_label":"Sahna","image_sequence.select_square":"Kvadrat Rasmlarni Tanlash (1:1)","image_sequence.select_landscape":"Landshaft Rasmlarni Tanlash (16:9)","image_sequence.select_portrait":"Portret Rasmlarni Tanlash (9:16)","image_sequence.select_range":"Oraliqni Tanlash","image_sequence.force_refresh":"Majburiy Yangilash","image_sequence.select_scene_frames":"Ushbu sahnadagi barcha kadrlarni tanlash","image_sequence.collapse_other_scenes":"Boshqa sahnalarni yig'ish","prompt_sequence_editor.instructionPlaceholder":"Promptlarni o'zgartirish uchun ko'rsatma kiriting...","prompt_sequence_editor.modifying":"O'zgartirilmoqda...","prompt_sequence_editor.modifySelected":"Tanlanganlarni O'zgartirish ({count})","prompt_sequence_editor.sourcePrompts":"Manba Promptlar","prompt_sequence_editor.finalPrompts":"O'zgartirilgan Promptlar","prompt_sequence_editor.error.invalidInput":"Ma'lumot formati noto'g'ri. Iltimos, prompt ketma-ketligi massivini ulang.","geminiChat.mode.general":"Umumiy","geminiChat.mode.prompt":"Prompt Mutaxassisi","geminiChat.mode.script":"Ssenarist","geminiChat.mode.youtube":"YouTube Analitik","image_sequence.shot_type.WS":"Ob'ektni Keng Plan (WS) bilan sahnaga va harakatga birlashtiring. Atrof-muhitni ko'rsating.","image_sequence.shot_type.MS":"Ob'ektni O'rta Plan (MS) bilan sahnaga birlashtiring. Personaj belidan yuqori.","image_sequence.shot_type.CU":"Ob'ektni Yirik Plan (CU) bilan sahnaga birlashtiring.","image_sequence.shot_type.ECU":"Ob'ektni Juda Yirik Plan (ECU) bilan sahnaga birlashtiring. Maksimal tafsilot.","image_sequence.shot_type.LS":"Ob'ektni Uzoq Plan (LS) bilan sahnaga birlashtirib, ko'lamni ko'rsating."},kb={"dialog.permission.title":"Ruxsat Talab Qilinadi","dialog.permission.description":"Ushbu ilova tugunlarga kontent joylash uchun buferingizni o'qishga ruxsat so'raydi. Ma'lumotlaringiz saqlanmaydi va hech qayerga yuborilmaydi.","dialog.permission.allow":"Ruxsat berish","dialog.permission.decline":"Rad etish","dialog.rename.title":"Element nomini o'zgartirish","dialog.rename.group.title":"Guruh nomini o'zgartirish","dialog.rename.catalog.title":"Katalog elementini qayta nomlash","dialog.rename.node.title":"Tugun nomini o'zgartirish","dialog.rename.label":"Yangi nom:","dialog.rename.confirm":"O'zgartirish","dialog.rename.cancel":"Bekor qilish","dialog.promptEdit.title":"Promptni Tahrirlash","dialog.promptEdit.nameLabel":"Nom:","dialog.promptEdit.contentLabel":"Tarkib:","dialog.promptEdit.confirm":"Saqlash","dialog.promptEdit.cancel":"Bekor qilish","dialog.confirmDelete.title":"O'chirishni Tasdiqlash","dialog.confirmDelete.message":"Haqiqatan ham ushbu elementni o'chirmoqchimisiz? Bu amalni bekor qilib bo'lmaydi.","dialog.confirmDelete.confirm":"O'chirish","dialog.confirmDelete.cancel":"Bekor qilish","dialog.confirmCloseTab.title":"Tabni Yopish","dialog.confirmCloseTab.message":`"{tabName}" tabini yopishni xohlaysizmi? Saqlanmagan o'zgarishlar yo'qoladi.`,"dialog.confirmClear.title":"Xolstni Tozalash","dialog.confirmClear.message":"Haqiqatan ham butun xolstni tozalamoqchimisiz? Bu amalni bekor qilib bo'lmaydi.","dialog.confirmReset.title":"Asl holatga qaytarish","dialog.confirmReset.message":"Xolstni asl holatiga qaytarishni xohlaysizmi? Barcha joriy ishlar yo'qoladi.","dialog.confirmReset.confirm":"Qaytarish","dialog.confirmLoad.title":"Yuklashni Tasdiqlash","dialog.confirmLoad.message":"Yangi faylni yuklash joriy tarkibni almashtiradi. Saqlanmagan o'zgarishlar yo'qoladi. Davom etasizmi?","dialog.apiKey.title":"API Kalitini Tanlash","dialog.apiKey.description":'Bu xususiyat "AI Platform" API yoqilgan Loyiha API kalitini talab qiladi. Video yaratish bir necha daqiqa vaqt olishi mumkin.',"dialog.apiKey.billingLink":"To'lovlar haqida ko'proq ma'lumot","dialog.apiKey.button":"API Kalitini Tanlash","dialog.settings.title":"Sozlamalar","dialog.settings.apiKeyLabel":"Sizning Google Gemini API Kalitingiz:","dialog.settings.useDevKeyLabel":"Bepul API kalitidan foydalanish (ishlab chiqish uchun)","dialog.settings.instantNodeCloseLabel":"Tugunni tezkor yopish","dialog.settings.nodeAnimationLabel":"Tugun Qo'shish Animatsiyasi","dialog.settings.animationModeLabel":"Yaratish Animatsiya Rejimi","dialog.settings.anim.pulse":"Puls","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"Yo'q","dialog.settings.description":"O'z kvotalaringizdan foydalanish va maxsus modellarga kirish uchun shaxsiy API kalitingizni kiriting. Kalit brauzeringizda lokal saqlanadi.","dialog.settings.getKeyLink":"API Kalitini bu yerdan oling","dialog.settings.save":"Saqlash","dialog.deleteNode.title":"Tugunni yopish?","dialog.deleteNode.titlePlural":"Tugunlarni yopish?","dialog.deleteNode.confirm":"Ha","dialog.deleteNode.cancel":"Yo'q","dialog.deleteNode.confirmTooltip":"Tugunni yopish - yo'qolgan ma'lumotlarni qaytarib bo'lmaydi","dialog.deleteNode.cancelTooltip":"Yopmaslik - tugun bilan ishlashni davom ettirish","dialog.deleteNode.dontShowAgain":"Qayta ko'rsatilmasin","dialog.exitApp.title":"Loyihani yopishni xohlaysizmi?","dialog.exitApp.message":"Loyihani yopishni xohlaysizmi? Barcha joriy ishlar yo'qoladi va xolst asl holatiga qaytariladi."},_b={"group.button.create":"Guruh Yaratish ({count})","group.rename":"Guruh Nomini O'zgartirish","group.saveToCatalog":"Katalogga Saqlash","group.saveToDisk":"Diskka Saqlash","group.ungroup":"Guruhdan Chiqarish (Tarkib bilan o'chirish uchun Shift+Click)","group.duplicate":"Guruhni tarkib bilan nusxalash","catalog.tabs.groups":"Guruhlar","catalog.tabs.library":"Kutubxona","catalog.tabs.characters":"Personajlar","catalog.tabs.scripts":"Ssenariylar","catalog.tabs.sequences":"Ketma-ketliklar","catalog.back":"Orqaga","catalog.load":"Fayldan Yuklash","catalog.newFolder":"Yangi Papka","catalog.saveTo":"Katalogga Saqlash","catalog.card.addToCanvas":"Xolstga Qo'shish","catalog.card.rename":"Nomini O'zgartirish","catalog.card.save":"Saqlash","catalog.card.delete":"O'chirish","catalog.empty.description":"Bu papka bo'sh. Siz elementlar qo'shishingiz yoki yangi papkalar yaratishingiz mumkin.","library.loadFromFile":"Yuklash","library.actions.newFolder":"Yangi Papka","library.actions.newPrompt":"Yangi Prompt","library.actions.copy":"Nusxalash","library.actions.edit":"Tahrirlash","library.empty.title":"Bo'sh Papka","library.empty.description":"Boshlash uchun promptlar va papkalar yarating.","library.emptyPrompt":"Bo'sh prompt"},Sb={...vb,...wb,...bb,...Cb,...kb,..._b},Nb={"app.title":"Modificateur de Prompt","app.subtitle":"Connectez des ides pour crer un chef-d'uvre","app.error.title":"Notification","app.error.copy":"Copier le message","app.error.copied":"Copi !","error.apiKey":"Votre cl API est invalide ou manque de permissions. Veuillez slectionner une cl API valide.","error.scriptModifierCanvas":"Ce canevas appartient  une autre application - Script Modifier. Veuillez utiliser Script Modifier pour ouvrir ce fichier.","welcome.title":"Bienvenue dans","welcome.description":"Bienvenue dans Prompt Modifier. Connectez des ides pour crer des chefs-d'uvre. Utilisez les nuds pour gnrer et diter du contenu.","welcome.apiKeyLabel":"Votre cl API Google Gemini","welcome.apiKeyPlaceholder":"Entrez votre cl API ici...","welcome.apiKeyHelp":"Votre cl API est stocke localement.","welcome.getKeyLink":"Obtenir une cl API","welcome.iAmDeveloper":"Je suis dveloppeur","welcome.letsGo":"C'est parti","welcome.resume":"Reprendre","welcome.startNew":"Nouveau Canevas","welcome.freeModeActive":"Mode Gratuit Actif","welcome.selectLanguage":"Slectionnez votre langue principale","welcome.navHint":"Utilisez les touches du clavier  et  pour changer de langue","toast.contentCleared":"Contenu effac","toast.downloadStarted":"Tlchargement commenc","toast.characterLoaded":"Carte de personnage charge","toast.characterSavedDisk":"Carte de personnage enregistre sur le disque","toast.copiedToClipboard":"Copi dans le presse-papiers","toast.pastedFromClipboard":"Coll depuis le presse-papiers","toast.pasteFailed":"chec du collage","toast.nodeDuplicated":"Nud dupliqu","toast.groupSavedToDisk":'Groupe "{groupTitle}" enregistr sur le disque',"toast.groupDeleted":"Groupe et contenu supprims","toast.characterSavedCatalog":"Personnage enregistr dans le catalogue","toast.promptSaved":"Prompt enregistr dans la bibliothque : {promptName}...","toast.connectionsCut":"Connexions supprimes","toast.apiKeySaved":"Cl API enregistre avec succs","toast.cacheCleared":"{count} lments inutiliss effacs du cache","toast.cacheEmpty":"Le cache est dj optimis","toast.scriptSaved":"Scnario enregistr sur le disque","alert.groupSaved":'Groupe "{groupTitle}" enregistr dans le catalogue.',"alert.loadCatalogFailed":"chec du chargement du fichier catalogue","alert.invalidCatalogFile":"Format de fichier catalogue invalide","alert.fileNotSupported":'Fichier non support. "appName" manquant ou incorrect.',"alert.invalidCatalogStructure":'Structure de catalogue invalide. "root" manquant.'},Eb={"toolbar.settings":"Paramtres","toolbar.resetCanvas":"Rinitialiser le canevas","toolbar.clearCache":"Vider le cache inutilis","toolbar.home":"Accueil","toolbar.edit":"diter (V)","toolbar.cutter":"Couper connexion (C) / (Maintenir Ctrl)","toolbar.selection":"Slection (S) / (Maintenir Shift)","toolbar.reroute":"Rediriger (R) / (Maintenir Ctrl+Alt)","toolbar.zoom":"Zoom (Maintenir Z)","toolbar.snapToGrid":"Aligner sur la grille","toolbar.smartGuides":"Guides intelligents","toolbar.lineStyleSpaghetti":"Lignes Spaghetti","toolbar.lineStyleOrthogonal":"Lignes Orthogonales","toolbar.resetZoom":"Rinitialiser le zoom","toolbar.resetCamera":"Rinitialiser la camra","toolbar.clearCanvas":"Effacer le canevas","toolbar.addNode":"Ajouter un nud (F)","toolbar.catalog":"Ouvrir le catalogue (Ctrl + Espace)","toolbar.addNote":"Ajouter une note (N)","toolbar.addDataReader":"Ajouter un lecteur de donnes (Shift + R)","toolbar.addTextInput":"Ajouter une entre texte (T)","toolbar.addImageInput":"Ajouter une entre image (I)","toolbar.addPromptSequenceEditor":"Ajouter diteur de squence (Q)","toolbar.addImageAnalyzer":"Ajouter analyseur d'image (Shift+A)","toolbar.addPromptAnalyzer":"Ajouter analyseur de prompt (A)","toolbar.addPromptProcessor":"Ajouter processeur de prompt (P)","toolbar.addCharacterGenerator":"Ajouter gnrateur de personnage (Shift+C)","toolbar.addCharacterAnalyzer":"Ajouter analyseur de personnage (Ctrl+Shift+A)","toolbar.addCharacterCard":"Ajouter carte de personnage (Ctrl+Shift+C)","toolbar.addImageOutput":"Ajouter sortie image (O)","toolbar.addImageEditor":"Ajouter diteur d'image IA (Shift+I)","toolbar.addImageSequenceGenerator":"Ajouter gnrateur de squence (Shift+Q)","toolbar.addTranslator":"Ajouter traducteur (L)","toolbar.addGeminiChat":"Ajouter Chat Gemini (M)","toolbar.addVideoPromptProcessor":"Ajouter processeur de prompt vido (Shift+P)","toolbar.addVideoOutput":"Ajouter sortie vido (Shift+O)","toolbar.addScriptGenerator":"Ajouter gnrateur de scnario","toolbar.addScriptViewer":"Ajouter visualiseur de scnario (Shift + V)","toolbar.saveCanvas":"Enregistrer le canevas (Ctrl + S)","toolbar.saveProject":"Enregistrer le projet","toolbar.loadCanvas":"Charger Projet/Canevas (Ctrl + O)","toolbar.group.general":"Gnral","toolbar.group.catalog":"Catalogue","toolbar.group.input":"Entre","toolbar.group.processing":"Traitement","toolbar.group.character":"Personnage","toolbar.group.output":"Sortie","toolbar.group.aiTools":"Outils IA","toolbar.group.video":"Vido","toolbar.group.scripts":"Scnarios","toolbar.group.file":"Fichier","toolbar.title":"Barre d'outils","toolbar.dock":"Ancrer la barre","toolbar.detach":"Dtacher la barre","toolbar.expandPanel":"Agrandir le panneau","toolbar.collapsePanel":"Rduire le panneau","toolbar.dockArea.title":"Ancrer la barre ici","toolbar.duplicate":"Dupliquer le nud","toolbar.duplicateWithContent":"Dupliquer avec contenu","toolbar.dock.q1":"1er Quart Gauche","toolbar.dock.q2":"2me Quart Gauche","toolbar.dock.q3":"3me Quart Droite","toolbar.dock.q4":"4me Quart Droite","toolbar.dock.tl":"Haut Gauche","toolbar.dock.bl":"Bas Gauche","toolbar.dock.tr":"Haut Droite","toolbar.dock.br":"Bas Droite","toolbar.dock.left":"Moiti Gauche","toolbar.dock.right":"Moiti Droite","toolbar.dock.full":"Plein cran","toolbar.dock.exitFull":"Quitter Plein cran","toolbar.dock.fullFocus":"Focus Plein cran","hotkeys.show":"Voir les raccourcis","hotkeys.tools.title":"Outils","hotkeys.tools.edit":"Mode dition","hotkeys.tools.cutter":"Outil Couteau","hotkeys.tools.selection":"Outil Slection","hotkeys.tools.reroute":"Outil Redirection","hotkeys.tools.zoom":"Outil Zoom","hotkeys.tools.toggleLineStyle":"Changer style de ligne","hotkeys.tools.group":"Slection de Groupe","hotkeys.tools.closeNode":"Supprimer la slection","hotkeys.tools.duplicate":"Dupliquer le nud","hotkeys.tools.duplicateWithContent":"Dupliquer avec contenu","hotkeys.tools.deleteGroup":"Supprimer le groupe (Shift+Clic)","hotkeys.windows.title":"Fentres","hotkeys.windows.search":"Recherche Rapide","hotkeys.windows.catalog":"Catalogue","hotkeys.createNode.title":"Crer un nud","help.panelTitle":"Aide et Raccourcis","help.title":"Raccourcis Clavier","help.howToUse.title":"Comment utiliser","help.howToUse.content":"Bienvenue dans Prompt Modifier ! Utilisez la barre d'outils ou les raccourcis pour ajouter des nuds. Connectez les nuds pour transmettre les donnes. Utilisez l'outil dition pour dplacer les nuds et le canevas. Double-cliquez sur l'espace vide pour ouvrir le menu d'ajout rapide. Clic droit pour le menu contextuel.","help.author":"Auteur","contextMenu.undoPosition":"Annuler dplacement","contextMenu.redoPosition":"Rtablir dplacement","contextMenu.align.left":"Aligner  gauche (F)","contextMenu.align.centerX":"Aligner au centre X (E)","contextMenu.align.right":"Aligner  droite (R)","contextMenu.align.top":"Aligner en haut (T)","contextMenu.align.centerY":"Aligner au centre Y (D)","contextMenu.align.bottom":"Aligner en bas (B)","contextMenu.distribute.horizontal":"Distribuer Horiz. (Ctrl+D)","contextMenu.distribute.vertical":"Distribuer Vert. (Ctrl+E)","contextMenu.emptySlot":"Emplacement vide (Clic droit pour assigner)","contextMenu.saveSlots":"Sauvegarder config slots","contextMenu.loadSlots":"Charger config slots","quickadd.title":"Ajout Rapide","quickadd.group.tools":"Outils","quickadd.group.inputs":"Entres","quickadd.group.processing":"Traitement","quickadd.group.character":"Personnage","quickadd.group.outputs":"Sorties","quickadd.group.ai":"Outils IA","quickadd.group.video":"Vido","quickadd.group.scripts":"Scnarios","quickadd.group.general":"Gnral","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"diter","quickadd.tool.cutter":"Couper","quickadd.tool.selection":"Slection","search.placeholder":"Rechercher un nud  ajouter...","search.noResults":"Aucun nud trouv.","search.group.input":"Entre & Basique","search.group.process":"Traitement & Personnage","search.group.output":"Image & Squence","search.group.ai":"Outils IA","search.group.video":"Vido & Script","search.group.scripts":"Scnarios","toolbar.exitApp":"Fermer le projet"},Pb={"node.title.text_input":"Entre de Texte","node.title.image_input":"Entre d'Image","node.title.prompt_processor":"Processeur de Prompt","node.title.prompt_sanitizer":"Nettoyeur de Prompt","node.title.video_prompt_processor":"Proc. Prompt Vido","node.title.image_output":"Sortie Image","node.title.video_output":"Sortie Vido","node.title.prompt_analyzer":"Analyseur de Prompt","node.title.character_analyzer":"Analyseur de Personnage","node.title.character_generator":"Gnrateur de Personnage","node.title.character_card":"Carte de Personnage","node.title.image_analyzer":"Analyseur d'Image","node.title.image_editor":"diteur d'Image IA","node.title.image_sequence_generator":"Gnrateur de Squence","node.title.prompt_sequence_editor":"diteur de Squence de Prompts","node.title.gemini_chat":"Chat Gemini","node.title.translator":"Traducteur","node.title.script_generator":"Gnrateur de Scnario","node.title.script_viewer":"Visualiseur de Scnario","node.title.note":"Note","node.title.reroute_dot":"Point de Redirection","node.title.data_reader":"Lecteur de Donnes","node.title.video_editor":"diteur Vido Alpha","node.title.media_viewer":"Lecteur Multimdia","node.title.data_protection":"Protection des Donnes","node.title.pose_creator":"Pose Creator","node.help.text_input":"Un champ de texte simple pour entrer des prompts ou des notes.","node.help.image_input":"Permet de tlcharger ou coller une image pour l'utiliser comme entre.","node.help.prompt_processor":"Combine plusieurs textes en un seul prompt amlior via IA.","node.help.prompt_sanitizer":"Rcrit le prompt pour le rendre plus sr pour les modles d'IA.","node.help.video_prompt_processor":"Processeur spcialis pour crer des prompts vido dtaills.","node.help.image_output":"Affiche le rsultat de la gnration d'image. Permet le tlchargement.","node.help.video_output":"Affiche le rsultat de la gnration vido via Veo.","node.help.prompt_analyzer":"Dcompose un prompt en sujet, style, environnement, etc.","node.help.character_analyzer":"Analyse une description de personnage (apparence vs vtements).","node.help.character_generator":"Gnre des descriptions dtailles bases sur un prompt court.","node.help.character_card":"Stocke les donnes compltes d'un personnage (image, description).","node.help.image_analyzer":"Utilise l'IA pour dcrire le contenu d'une image.","node.help.image_editor":"Outil avanc pour diter des images avec du texte (inpainting/outpainting).","node.help.image_sequence_generator":"Gnre une squence d'images base sur une liste de prompts.","node.help.prompt_sequence_editor":"Permet l'dition en masse de squences de prompts via instructions IA.","node.help.gemini_chat":"Interface de chat avec Gemini pour le brainstorming.","node.help.translator":"Traduit du texte entre les langues via l'IA.","node.help.script_generator":"Gnre un scnario structur (scnes, persos) depuis une ide.","node.help.script_viewer":"Visualise et gre les donnes de scnario pour la gnration.","node.help.note":"Une note adhsive pour ajouter des commentaires sur le canevas.","node.help.reroute_dot":"Un petit point pour organiser les connexions proprement.","node.help.data_reader":"Outil de dbogage pour inspecter les donnes brutes.","node.help.video_editor":"Outil de montage vido et image bas sur une timeline.","node.help.media_viewer":"Lecteur pour voir les fichiers vido et audio avec contrles.","node.help.data_protection":"Mini-jeu de Tower Defense pour protger vos donnes.","node.help.pose_creator":"Visually rig and create character poses for generation guidance.","node.action.expand":"Agrandir","node.action.collapse":"Rduire","node.action.help":"Aide","node.action.download":"Tlcharger","node.action.clear":"Effacer contenu","node.action.refreshChat":"Redmarrer le chat","node.action.paste":"Coller","node.action.resetEditor":"Rinitialiser","node.action.saveCharacter":"Sauver carte","node.action.loadCharacter":"Charger carte","node.action.copy":"Copier","node.action.copyImage":"Copier image","node.action.copyTextPrompt":"Copier prompt","node.action.copyImagePrompt":"Copier prompt image","node.action.copyVideoPrompt":"Copier prompt vido","node.action.cutConnections":"Couper connexions","node.action.close":"Fermer","node.action.closeNode":"Fermer le nud (Shift+Clic pour instantan)","node.action.closeNodeSimple":"Fermer le nud","node.action.randomWord":"Mot alatoire","node.action.processImage":"Enlever filigranes","node.action.processImageTitle":"Utilise Gemini pour enlever filigranes et textes.","node.action.editor":"diteur","node.action.rasterEditor":"diteur Raster","node.action.openInAIEditor":"Ouvrir diteur IA","node.action.openInAnalyzer":"Ouvrir Analyseur","node.action.outputToInput":"Sortie vers Entre","node.action.processChainForward":"Traiter la chane","node.action.executeChain":"Excuter la chane","node.action.executeChainTitle":"Excute tous les nuds en amont pour gnrer le rsultat.","node.action.sanitize":"Nettoyer","node.action.rename":"Renommer","node.action.stop":"Arrter","node.action.stopping":"Arrt...","node.action.deleteItem":"Supprimer lment","node.action.detachAndPaste":"Dtacher et Coller","node.action.delete":"Supprimer","node.action.flipImage":"Retourner l'image","node.action.pin":"pingler le nud","node.action.unpin":"Dspingler","node.action.updateDescription":"Mettre  jour la description","node.action.modifyCharacter":"Demander des modifications","node.action.updateDataFormat":"Mettre  jour le format des donnes","node.action.expand169":"tendre  16:9","node.action.expand916":"tendre  9:16","node.action.sync":"Synchroniser depuis les connexions","node.action.expandRatio":"tendre le ratio d'aspect","node.action.markPrimary":"Marquer comme principal","node.action.addCard":"Ajouter une carte","node.action.removeCard":"Retirer la carte","node.action.showOutputs":"Afficher les sorties","node.action.hideOutputs":"Masquer les sorties","node.mediaViewer.play":"Lecture","node.mediaViewer.pause":"Pause","node.mediaViewer.stop":"Arrt","node.mediaViewer.addMarker":"Ajouter marqueur","node.mediaViewer.exportSRT":"Exporter marqueurs (SRT)","node.mediaViewer.deleteAllMarkers":"Tout effacer","node.mediaViewer.saveMarkers":"Sauvegarder marqueurs","node.mediaViewer.loadMarkers":"Charger marqueurs","node.mediaViewer.relink":"Relier fichier","node.content.notePlaceholder":"crivez vos notes ici...","node.content.dropImage":"Dposez une image ou cliquez","node.content.dropMedia":"Dposez une vido ou un audio","node.content.processing":"Traitement...","node.content.processingChain":"Traitement chane...","node.content.metadataPrompt":"Prompt des mtadonnes :","node.content.metadataPromptPlaceholder":"Aucun prompt trouv.","node.content.copyPrompt":"Utiliser","node.content.prompt":"Prompt","node.content.inputPrompt":"Prompt d'entre","node.content.enhancedResult":"Rsultat amlior","node.content.videoPrompt":"Prompt Vido","node.content.editPromptPlaceholder":"Ajouter ou diter le prompt...","node.content.enhancedPromptHere":"Le prompt amlior apparatra ici...","node.content.safePrompt":"Sr pour usage commercial","node.content.generating":"Gnration...","node.content.imageHere":"L'image apparatra ici","node.content.generationMode":"Modle de gnration","node.content.aspectRatio":"Format","node.content.aspectRatioHelp":"Dfinir le format de l'image","node.content.aspectRatioNotSupportedFast":"Format disponible uniquement pour modles Imagen.","node.content.enableAspectRatioFormatting":"Activer le formatage du ratio","node.content.autoDownload":"Auto Tlchargement","node.content.generateImage":"Gnrer Image","node.content.enhancing":"Amlioration...","node.content.enhancePrompt":"Amliorer le prompt","node.content.sanitizing":"Nettoyage...","node.content.sanitizedPromptHere":"Le prompt nettoy apparatra ici...","node.content.analyzing":"Analyse...","node.content.analyzePrompt":"Analyser le prompt","node.content.analyzeImage":"Analyser l'image","node.content.imageToText":"Image vers Texte","node.content.updatePromptFromImage":"Mettre  jour le prompt depuis l'image","node.content.analyzeCharacter":"Analyser Personnage","node.content.generateCharacters":"Gnrer Personnages","node.content.characterPromptPlaceholder":"Dcrivez le(s) personnage(s)...","node.content.character":"Personnage","node.content.clothing":"Vtements","node.content.characterPlaceholder":"Description du personnage ici...","node.content.clothingPlaceholder":"Description des vtements ici...","node.content.appearance":"Apparence","node.content.personality":"Personnalit","node.content.environment":"Environnement","node.content.action":"Action","node.content.emotion":"motion","node.content.style":"Style","node.content.environmentPlaceholder":"Description dtaille de l'environnement...","node.content.charactersPlaceholder":"Liste des personnages principaux...","node.content.characters":"Personnages","node.content.characterConcepts":"Concepts de personnage","node.content.actionPlaceholder":"Description de l'action...","node.content.emotionPlaceholder":"Description de l'motion...","node.content.stylePlaceholder":"Description du style artistique...","node.content.descriptionHere":"La description apparatra ici...","node.content.enableOutpainting":"Activer Outpainting","node.content.outpaintingPromptPlaceholder":"Prompt d'outpainting...","node.content.inputImage":"Images d'entre","node.content.dropOrClick":"Dposer ou Cliquer","node.content.outputImage":"Image de sortie","node.content.applyEdit":"Appliquer","node.content.editing":"dition...","node.content.chatPlaceholder":"Tapez votre message...","node.content.connectedPlaceholder":"Connect  un nud, ditez  la source.","node.content.connectedNode":"Connect via nud","node.content.connectedEmpty":"Le nud connect n'a pas d'image.","node.content.translatePlaceholder":"Texte  traduire...","node.content.translatedTextPlaceholder":"Texte traduit...","node.content.targetLanguage":"Langue cible","node.content.translate":"Traduire","node.content.translating":"Traduction...","node.content.scriptPromptPlaceholder":"Entrez une ide d'histoire...","node.content.generateScript":"Gnrer Scnario","node.content.loadScript":"Charger Scnario","node.content.summary":"Rsum","node.content.scenes":"Scnes","node.content.unrecognizedFormat":"Format de scnario non reconnu.","node.content.frames":"Cadres","node.content.characterIndex":"Index","node.content.readData":"Lire les donnes","node.content.textDataHere":"Les donnes texte apparatront ici.","node.content.noDataRead":'Connectez un nud et cliquez sur "Lire les donnes".',"node.content.previewError":"Erreur Aperu","node.content.previewPlaceholder":"L'aperu apparatra ici","node.content.imagePrompt":"Prompt Image","node.output.allPromptData":"Toutes les donnes","node.note.tab.note":"Note","node.note.tab.references":"Rfrences","node.note.nestedImages":"Images Imbriques","node.note.dropPlaceholder":"Dposez des images","node.note.addCaption":"Lgende","node.note.action.shuffle":"Mlanger","node.note.action.undoShuffle":"Annuler Mlange","node.content.characterTypeShort":"Type:","node.content.numberOfCharactersShort":"Qt:","node.content.characterType.simple":"Simple","node.content.characterType.anthro":"Anthro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Objet Cl","node.content.style.simple":"Simple","node.content.style.realistic":"Raliste","node.content.style.3d_cartoon":"3D Cartoon","node.content.style.3d_realistic":"3D Raliste","node.content.style.2d_animation":"Animation 2D","node.content.style.anime":"Anime","node.content.style.comics":"Comics","node.content.style.custom":"Personnalis","node.content.fullDescriptionTitle":"Description complte du personnage","node.content.integrationInstruction":"Instruction d'intgration","node.content.additionalPromptSuffix":"Prompt Additionnel (Suffixe)","search.node.text_input.title":"Entre de Texte","search.node.text_input.description":"Un champ texte simple.","search.node.image_input.title":"Entre d'Image","search.node.image_input.description":"Charger une image.","search.node.prompt_sequence_editor.title":"diteur Squence Prompts","search.node.prompt_sequence_editor.description":"diter une liste de prompts en masse.","search.node.data_reader.title":"Lecteur de Donnes","search.node.data_reader.description":"Inspecter les donnes brutes d'un nud.","search.node.note.title":"Note","search.node.note.description":"Une note adhsive.","search.node.prompt_processor.title":"Processeur de Prompt","search.node.prompt_processor.description":"Amliore un prompt via IA.","search.node.prompt_analyzer.title":"Analyseur de Prompt","search.node.prompt_analyzer.description":"Dcompose un prompt.","search.node.prompt_sanitizer.title":"Nettoyeur de Prompt","search.node.prompt_sanitizer.description":"Rend le prompt sr pour l'IA.","search.node.character_card.title":"Carte Personnage","search.node.character_card.description":"Info dtaille d'un personnage.","search.node.character_analyzer.title":"Analyseur Personnage","search.node.character_analyzer.description":"Spare apparence et vtements.","search.node.character_generator.title":"Gnrateur Personnage","search.node.character_generator.description":"Cre des personnages depuis un prompt.","search.node.image_analyzer.title":"Analyseur d'Image","search.node.image_analyzer.description":"Dcrit une image.","search.node.image_editor.title":"diteur Image IA","search.node.image_editor.description":"dite des images avec des prompts.","search.node.image_sequence_generator.title":"Gnrateur Squence Image","search.node.image_sequence_generator.description":"Cre des squences d'images.","search.node.gemini_chat.title":"Chat Gemini","search.node.gemini_chat.description":"Discuter avec Gemini.","search.node.translator.title":"Traducteur","search.node.translator.description":"Traduit du texte.","search.node.script_generator.title":"Gnrateur Scnario","search.node.script_generator.description":"Cre un script structur.","search.node.script_viewer.title":"Visualiseur Scnario","search.node.script_viewer.description":"Gre les donnes de scnario.","search.node.note":"Bote de texte simple.","search.node.reroute_dot":"Point pour organiser les cbles.","search.node.video_prompt_processor.title":"Proc. Prompt Vido","search.node.video_prompt_processor.description":"Cre des prompts pour vido.","search.node.video_output.title":"Sortie Vido","search.node.video_output.description":"Gnre une vido avec Veo.","search.node.image_output.title":"Sortie Image","search.node.image_output.description":"Affiche les images gnres.","search.node.media_viewer.title":"Lecteur Multimdia","search.node.media_viewer.description":"Lecteur vido et audio.","search.node.data_protection.title":"Protection Donnes","search.node.data_protection.description":"Mini-jeu Tower Defense.","search.node.pose_creator.title":"Pose Creator","search.node.pose_creator.description":"Visually rig and create character poses for generation guidance.","prompt_sequence_editor.instructionPlaceholder":"Entrez une instruction pour modifier les prompts...","prompt_sequence_editor.modifying":"Modification...","prompt_sequence_editor.modifySelected":"Modifier slection ({count})","prompt_sequence_editor.sourcePrompts":"Prompts Source","prompt_sequence_editor.finalPrompts":"Prompts Modifis","prompt_sequence_editor.error.invalidInput":"Format invalide. Connectez une squence de prompts.","geminiChat.mode.general":"Gnral","geminiChat.mode.prompt":"Expert Prompt","geminiChat.mode.script":"Scnariste","geminiChat.mode.youtube":"Analyste YouTube","image_sequence.deselect_scene":"Dslectionner la scne","image_sequence.clear_prompts_only":"Effacer Textes Uniquement","image_sequence.prev_scene":"Scne Prcdente","image_sequence.next_scene":"Scne Suivante","image_sequence.frames_hidden":"({count} cadres masqus)","image_sequence.frames_count":"({count} cadres)","node.content.modificationRequest":"Demande de modification","node.content.technicalPrompt":"Prompt Technique","node.promptProcessor.safePromptTooltip":"Rcrit le prompt pour se conformer aux consignes de scurit et viter les violations de politique.","node.promptProcessor.technicalPromptTooltip":"Convertit le prompt en une spcification technique hautement dtaille (clairage, camra, paramtres de rendu).","node.promptProcessor.enhanceTooltip":"Utilise l'IA pour tendre et enrichir le prompt avec des dtails descriptifs.","node.promptProcessor.chainTooltip":"Excute ce nud et dclenche tous les nuds connects en aval.","image_sequence.tooltip.autoCrop":"Recadre automatiquement les images gnres au format 16:9.","image_sequence.tooltip.autoDownload":"Enregistre automatiquement chaque image sur votre appareil aprs sa gnration.","image_sequence.tooltip.createZip":"Regroupe toutes les images slectionnes dans une archive ZIP unique lors du tlchargement."},jb={"imageEditor.title":"diteur d'Image","imageEditor.canvasResolution":"Rsolution Canevas","imageEditor.background":"Arrire-plan","imageEditor.toolSettings":"Paramtres Outil","imageEditor.snapToEdges":"Magntisme","imageEditor.freeAspect":"Ratio Libre","imageEditor.section.aiRequest":"Demande Modification IA","imageEditor.input.modificationPlaceholder":'Dcrivez les changements, ex: "fond bleu"',"imageEditor.action.sendRequest":"Envoyer Demande","imageEditor.tooltip.removeObject":"Supprimer (Rouge) / Garder (Vert)","imageEditor.action.removeObject":"Supprimer Objet","imageEditor.tool.transform":"Transformer","imageEditor.tool.hand":"Main (Pan)","imageEditor.tool.zoom":"Zoom","imageEditor.tool.pencil":"Crayon","imageEditor.tool.rectangle":"Rectangle","imageEditor.action.fit":"Ajuster","imageEditor.action.fill":"Remplir","imageEditor.action.cancel":"Annuler","imageEditor.action.resetEdits":"Rinitialiser","imageEditor.action.apply":"Appliquer","imageViewer.title":"Visionneuse","imageEditor.outputResolution":"Rsolution Sortie","imageEditor.outputResolutionHelp":'Dfinir rsolution de sortie. "Auto" utilise le canevas.',"imageEditor.currentSize":"Taille Actuelle : {width}x{height}","imageEditor.sequenceMode":"Mode Squence","imageEditor.sequenceModeHelp":"Traiter les images de l'Entre A squentiellement.","imageEditor.sequentialCombination":"Combinaison Squentielle","imageEditor.sequentialCombinationHelp":"Pour chaque cadre : Envoie image A actuelle + Toutes images B.","imageEditor.sequentialPrompt":"Combinaison Prompt Squentiel","imageEditor.sequentialPromptHelp":"Pour chaque cadre : Utilise un prompt unique de la liste + image actuelle.","imageEditor.sequentialEditingWithPrompts":"dition Squentielle avec Prompts","imageEditor.sequentialEditingWithPromptsHelp":"Pour chaque cadre : Utilise image B + prompt unique. Entre A ignore.","imageEditor.input":"Entre","imageEditor.inputA":"Entre A","imageEditor.inputB":"Entre B","imageEditor.status.queued":"En attente","imageEditor.status.generating":"Gnration...","imageEditor.action.regenerate":"Rgnrer","imageEditor.tooltip.fit":"Ajuster l'image aux limites (contain).","imageEditor.tooltip.fill":"Remplir le canevas (cover).","imageEditor.tooltip.flip":"Retourner horizontalement.","imageEditor.background.white":"Blanc","imageEditor.background.gray":"Gris","imageEditor.background.black":"Noir","imageEditor.background.dark":"Sombre","image_sequence.regenerate":"Rgnrer","image_sequence.stop_queue":"Arrter File","image_sequence.move_up":"Monter","image_sequence.move_down":"Descendre","image_sequence.copy_prompt":"Copier Prompt","image_sequence.add_frame":"Ajouter Cadre","image_sequence.delete_frame":"Supprimer Cadre","image_sequence.expand_all_frames":"Tout Dplier/Replier","image_sequence.collapse_all_frames":"Tout Replier (Cadres)","image_sequence.expand_all_scenes":"Tout Dplier (Scnes)","image_sequence.collapse_all_scenes":"Tout Replier (Scnes)","image_sequence.expand_all":"Tout Dplier","image_sequence.collapse_all":"Tout Replier","image_sequence.clear_all_prompts":"Effacer Tous Prompts","image_sequence.add_first_frame":"Ajouter 1er Cadre","image_sequence.drop_or_add_title":"Dposer JSON ou Ajouter","image_sequence.drop_or_add_desc":"Dposez un fichier JSON ou cliquez pour ajouter.","image_sequence.load_prompts":"Charger Prompts","image_sequence.output_images_title":"Images de Sortie","image_sequence.prompts_list_title":"Prompts Source","image_sequence.download_selected":"Tlcharger Slection","image_sequence.select_all":"Tout Slectionner","image_sequence.select_none":"Dslectionner","image_sequence.invert_selection":"Inverser","image_sequence.run_selected":"Lancer Slection","image_sequence.start_queue":"Lancer File","image_sequence.character_prompt_combination":"Combinaison Prompt Perso","image_sequence.combination_none":"Aucun","image_sequence.combination_combine":"Combiner","image_sequence.combination_replace":"Remplacer Tags","image_sequence.status.error":"Erreur","image_sequence.status.pending":"En attente","image_sequence.clear_selected_prompts":"Effacer Prompts Slectionns","image_sequence.range_from":"De :","image_sequence.range_to":" :","image_sequence.stats.total":"Total : {count}","image_sequence.stats.generated":"Gnrs : {count}","image_sequence.stats.queue":"File : {count}","image_sequence.edit_in_source":"diter Source","image_sequence.edit_prompt":"diter Prompt","image_sequence.select_scene":"Slectionner Scne","image_sequence.next_scene":"Scne Suivante","image_sequence.prev_scene":"Scne Prcdente","image_sequence.scene_input_label":"Scne","image_sequence.select_square":"Carr (1:1)","image_sequence.select_landscape":"Paysage (16:9)","image_sequence.select_portrait":"Portrait (9:16)","image_sequence.select_range":"Slectionner Plage","image_sequence.force_refresh":"Forcer Actualisation","image_sequence.select_scene_frames":"Slectionner toute la scne","image_sequence.collapse_other_scenes":"Replier autres scnes","prompt_sequence_editor.instructionPlaceholder":"Entrez une instruction...","prompt_sequence_editor.modifying":"Modification...","prompt_sequence_editor.modifySelected":"Modifier Slection ({count})","prompt_sequence_editor.sourcePrompts":"Prompts Source","prompt_sequence_editor.finalPrompts":"Prompts Modifis","prompt_sequence_editor.error.invalidInput":"Format invalide.","geminiChat.mode.general":"Gnral","geminiChat.mode.prompt":"Expert Prompt","geminiChat.mode.script":"Scnariste","geminiChat.mode.youtube":"Analyste YouTube","image_sequence.shot_type.WS":"Intgrez l'Entit avec un Plan Large (WS) dans la scne et l'action. Montrez l'environnement.","image_sequence.shot_type.MS":"Intgrez l'Entit avec un Plan Moyen (MS) dans la scne. Personnage de la taille vers le haut.","image_sequence.shot_type.CU":"Intgrez l'Entit avec un Gros Plan (CU) dans la scne.","image_sequence.shot_type.ECU":"Intgrez l'Entit avec un Trs Gros Plan (ECU) dans la scne. Dtails maximum.","image_sequence.shot_type.LS":"Intgrez l'Entit avec un Plan d'Ensemble (LS) dans la scne pour montrer l'chelle."},Ib={"dialog.permission.title":"Permission Requise","dialog.permission.description":"Cette application a besoin d'accder au presse-papiers pour coller du contenu dans les nuds. Vos donnes ne sont ni stockes ni envoyes.","dialog.permission.allow":"Autoriser","dialog.permission.decline":"Refuser","dialog.rename.title":"Renommer l'lment","dialog.rename.group.title":"Renommer le groupe","dialog.rename.catalog.title":"Renommer lment catalogue","dialog.rename.node.title":"Renommer le nud","dialog.rename.label":"Nouveau nom :","dialog.rename.confirm":"Renommer","dialog.rename.cancel":"Annuler","dialog.promptEdit.title":"diter le Prompt","dialog.promptEdit.nameLabel":"Nom :","dialog.promptEdit.contentLabel":"Contenu :","dialog.promptEdit.confirm":"Enregistrer","dialog.promptEdit.cancel":"Annuler","dialog.confirmDelete.title":"Confirmer la suppression","dialog.confirmDelete.message":"tes-vous sr de vouloir supprimer cet lment ? Cette action est irrversible.","dialog.confirmDelete.confirm":"Supprimer","dialog.confirmDelete.cancel":"Annuler","dialog.confirmCloseTab.title":"Fermer l'onglet","dialog.confirmCloseTab.message":`Voulez-vous vraiment fermer l'onglet "{tabName}" ? Les changements non sauvegards seront perdus.`,"dialog.confirmClear.title":"Effacer le canevas","dialog.confirmClear.message":"Voulez-vous vraiment tout effacer ? Cette action est irrversible.","dialog.confirmReset.title":"Rinitialiser","dialog.confirmReset.message":"Voulez-vous remettre le canevas  l'tat par dfaut ? Tout travail actuel sera perdu.","dialog.confirmReset.confirm":"Rinitialiser","dialog.confirmLoad.title":"Confirmer le chargement","dialog.confirmLoad.message":"Charger un fichier remplacera le contenu actuel. Les changements non sauvegards seront perdus. Continuer ?","dialog.apiKey.title":"Slectionner Cl API","dialog.apiKey.description":'Cette fonction ncessite une cl API Projet avec "AI Platform" activ. La gnration vido peut prendre quelques minutes.',"dialog.apiKey.billingLink":"En savoir plus sur la facturation","dialog.apiKey.button":"Slectionner Cl API","dialog.settings.title":"Paramtres","dialog.settings.apiKeyLabel":"Votre Cl API Google Gemini :","dialog.settings.useDevKeyLabel":"Utiliser la cl gratuite (dveloppement)","dialog.settings.instantNodeCloseLabel":"Fermeture instantane des nuds","dialog.settings.nodeAnimationLabel":"Animation d'ajout de nud","dialog.settings.animationModeLabel":"Mode d'animation de cration","dialog.settings.anim.pulse":"Pulsion","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"Aucune","dialog.settings.description":"Pour utiliser vos propres quotas et accder  des modles spcifiques, entrez votre cl API personnelle. Elle est stocke localement.","dialog.settings.getKeyLink":"Obtenir une cl API ici","dialog.settings.save":"Enregistrer","dialog.deleteNode.title":"Fermer le nud ?","dialog.deleteNode.titlePlural":"Fermer les nuds ?","dialog.deleteNode.confirm":"Oui","dialog.deleteNode.cancel":"Non","dialog.deleteNode.confirmTooltip":"Fermer le nud - les donnes perdues ne peuvent pas tre rcupres","dialog.deleteNode.cancelTooltip":"Ne pas fermer - continuer  travailler","dialog.deleteNode.dontShowAgain":"Ne plus afficher","dialog.exitApp.title":"Fermer le projet ?","dialog.exitApp.message":"Voulez-vous vraiment fermer le projet ? Tout travail actuel sera perdu et le canevas sera rinitialis."},Tb={"group.button.create":"Crer un groupe ({count})","group.rename":"Renommer le groupe","group.saveToCatalog":"Sauver dans le catalogue","group.saveToDisk":"Sauver sur le disque","group.ungroup":"Dgrouper (Shift+Clic pour tout supprimer)","group.duplicate":"Dupliquer avec contenu","catalog.tabs.groups":"Groupes","catalog.tabs.library":"Bibliothque","catalog.tabs.characters":"Personnages","catalog.tabs.scripts":"Scnarios","catalog.tabs.sequences":"Squences","catalog.back":"Retour","catalog.load":"Charger un fichier","catalog.newFolder":"Nouveau Dossier","catalog.saveTo":"Sauver dans le catalogue","catalog.card.addToCanvas":"Ajouter au canevas","catalog.card.rename":"Renommer","catalog.card.save":"Sauvegarder","catalog.card.delete":"Supprimer","catalog.empty.description":"Ce dossier est vide. Ajoutez des lments ou crez des dossiers.","library.loadFromFile":"Charger","library.actions.newFolder":"Nouveau Dossier","library.actions.newPrompt":"Nouveau Prompt","library.actions.copy":"Copier","library.actions.edit":"diter","library.empty.title":"Dossier Vide","library.empty.description":"Crez des prompts et des dossiers pour commencer.","library.emptyPrompt":"Prompt vide"},Ab={...Nb,...Eb,...Pb,...jb,...Ib,...Tb},Rb={"app.title":"Prompt Modifier","app.subtitle":"Verbinden Sie Ideen, um ein Meisterwerk zu schaffen","app.error.title":"Benachrichtigung","app.error.copy":"Nachricht kopieren","app.error.copied":"Kopiert!","error.apiKey":"Ihr API-Schlssel ist ungltig oder hat keine Berechtigungen. Bitte whlen Sie einen gltigen API-Schlssel.","error.scriptModifierCanvas":"Diese Leinwand gehrt zu einer anderen Anwendung - Script Modifier. Bitte verwenden Sie Script Modifier, um diese Datei zu ffnen.","welcome.title":"Willkommen bei","welcome.description":"Willkommen beim Prompt Modifier. Verbinden Sie Ideen, um Meisterwerke zu schaffen. Verwenden Sie Knoten, um Inhalte zu generieren und zu bearbeiten.","welcome.apiKeyLabel":"Ihr Google Gemini API-Schlssel","welcome.apiKeyPlaceholder":"Geben Sie hier Ihren API-Schlssel ein...","welcome.apiKeyHelp":"Ihr API-Schlssel wird lokal gespeichert.","welcome.getKeyLink":"API-Schlssel erhalten","welcome.iAmDeveloper":"Ich bin Entwickler","welcome.letsGo":"Los geht's","welcome.resume":"Fortsetzen","welcome.startNew":"Neue Leinwand","welcome.freeModeActive":"Kostenloser Modus aktiv","welcome.selectLanguage":"Whlen Sie Ihre Hauptsprache","welcome.navHint":"Verwenden Sie die Tastaturtasten  und , um die Sprache zu ndern","toast.contentCleared":"Inhalt gelscht","toast.downloadStarted":"Download gestartet","toast.characterLoaded":"Charakterkarte geladen","toast.characterSavedDisk":"Charakterkarte auf Festplatte gespeichert","toast.copiedToClipboard":"In die Zwischenablage kopiert","toast.pastedFromClipboard":"Aus der Zwischenablage eingefgt","toast.pasteFailed":"Einfgen fehlgeschlagen","toast.nodeDuplicated":"Knoten dupliziert","toast.groupSavedToDisk":'Gruppe "{groupTitle}" auf Festplatte gespeichert',"toast.groupDeleted":"Gruppe und Inhalt gelscht","toast.characterSavedCatalog":"Charakter im Katalog gespeichert","toast.promptSaved":"Prompt in Bibliothek gespeichert: {promptName}...","toast.connectionsCut":"Verbindungen getrennt","toast.apiKeySaved":"API-Schlssel erfolgreich gespeichert","toast.cacheCleared":"{count} ungenutzte Elemente aus dem Cache gelscht","toast.cacheEmpty":"Cache ist bereits optimiert","toast.scriptSaved":"Skript auf Festplatte gespeichert","alert.groupSaved":'Gruppe "{groupTitle}" im Katalog gespeichert.',"alert.loadCatalogFailed":"Laden der Katalogdatei fehlgeschlagen","alert.invalidCatalogFile":"Ungltiges Katalogdateiformat","alert.fileNotSupported":'Datei nicht untersttzt. "appName" fehlt oder ist falsch.',"alert.invalidCatalogStructure":'Ungltige Katalogstruktur. "root" fehlt.',"tutorial.step1":"Klicken Sie hier, um dem Prompt ein zuflliges Wort hinzuzufgen.","tutorial.step2":'Klicken Sie auf "Prompt verbessern", um Eingaben mithilfe von KI zu kombinieren.',"tutorial.step2_waiting":"Die KI analysiert Ihre Eingaben und generiert einen reichhaltigeren Prompt...","tutorial.step3":"Klicken Sie schlielich hier, um das Bild zu generieren.","tutorial.step3b":"Die Generierung dauert einige Zeit. Sie knnen den Fortschritt hier berwachen.","tutorial.step4":"Sie knnen neue Knoten manuell ber diese Symbolleiste hinzufgen.","tutorial.group.catalog":"Verwenden Sie den Katalog, um nach Knoten zu suchen oder Gruppen zu verwalten.","tutorial.group.general":"Fgen Sie Haftnotizen und Datenleser zum Debuggen hinzu.","tutorial.group.input":"Grundlegende Eingaben fr Text, Bilder und Sequenzen.","tutorial.group.processing":"Analysieren und verarbeiten Sie Prompts oder Bilder mit KI.","tutorial.group.character":"Erstellen, analysieren und speichern Sie detaillierte Charaktere.","tutorial.group.output":"Ergebnisse anzeigen und Sequenzen generieren.","tutorial.group.ai":"Chatten Sie mit Gemini und bersetzen Sie Text.","tutorial.group.video":"Tools fr Videoprompts und Bearbeitung.","tutorial.group.scripts":"Generieren und betrachten Sie Skripte fr komplexe Geschichten.","tutorial.group.file":"Speichern Sie Ihre Arbeit, laden Sie Projekte oder laden Sie die Leinwand herunter.","tutorial.success.title":"Tutorial abgeschlossen!","tutorial.success.message":"Sie haben die Grundlagen von Prompt Modifier erfolgreich erlernt. Viel Glck beim Erstellen von Meisterwerken!","tutorial.success.button":"Erstellen beginnen","tutorial.skip":"berspringen","tutorial.next":"Weiter","tutorial.finish":"Verstanden"},Mb={"toolbar.settings":"Einstellungen","toolbar.resetCanvas":"Leinwand zurcksetzen","toolbar.clearCache":"Ungenutzten Cache leeren","toolbar.home":"Startseite","toolbar.edit":"Bearbeiten (V)","toolbar.cutter":"Verbindung trennen (C) / (Strg halten)","toolbar.selection":"Auswahl (S) / (Umschalt halten)","toolbar.reroute":"Umlenken (R) / (Strg+Alt halten)","toolbar.zoom":"Zoom (Z halten)","toolbar.snapToGrid":"Am Raster ausrichten","toolbar.smartGuides":"Intelligente Hilfslinien","toolbar.lineStyleSpaghetti":"Spaghetti-Linien","toolbar.lineStyleOrthogonal":"Orthogonale Linien","toolbar.resetZoom":"Zoom zurcksetzen","toolbar.resetCamera":"Kameraposition zurcksetzen","toolbar.clearCanvas":"Leinwand leeren","toolbar.addNode":"Knoten hinzufgen (F)","toolbar.catalog":"Katalog ffnen (Strg + Leertaste)","toolbar.addNote":"Notiz hinzufgen (N)","toolbar.addDataReader":"Datenleser hinzufgen (Umschalt + R)","toolbar.addTextInput":"Texteingabe hinzufgen (T)","toolbar.addImageInput":"Bildeingabe hinzufgen (I)","toolbar.addPromptSequenceEditor":"Prompt-Sequenz-Editor hinzufgen (Q)","toolbar.addImageAnalyzer":"Bildanalysator hinzufgen (Umschalt+A)","toolbar.addPromptAnalyzer":"Prompt-Analysator hinzufgen (A)","toolbar.addPromptProcessor":"Prompt-Prozessor hinzufgen (P)","toolbar.addCharacterGenerator":"Charaktergenerator hinzufgen (Umschalt+C)","toolbar.addCharacterAnalyzer":"Charakteranalysator hinzufgen (Strg+Umschalt+A)","toolbar.addCharacterCard":"Charakterkarte hinzufgen (Strg+Umschalt+C)","toolbar.addImageOutput":"Bildausgabe hinzufgen (O)","toolbar.addImageEditor":"KI-Bildeditor hinzufgen (Umschalt+I)","toolbar.addImageSequenceGenerator":"Bildsequenz-Generator hinzufgen (Umschalt+Q)","toolbar.addTranslator":"bersetzer hinzufgen (L)","toolbar.addGeminiChat":"Gemini Chat hinzufgen (M)","toolbar.addVideoPromptProcessor":"Video-Prompt-Prozessor hinzufgen (Umschalt+P)","toolbar.addVideoOutput":"Videoausgabe hinzufgen (Umschalt+O)","toolbar.addScriptGenerator":"Skriptgenerator hinzufgen","toolbar.addScriptViewer":"Skript-Viewer hinzufgen (Umschalt + V)","toolbar.saveCanvas":"Leinwand speichern (Strg + S)","toolbar.saveProject":"Projekt speichern","toolbar.loadCanvas":"Projekt/Leinwand laden (Strg + O)","toolbar.group.general":"Allgemein","toolbar.group.catalog":"Katalog","toolbar.group.input":"Eingabe","toolbar.group.processing":"Verarbeitung","toolbar.group.character":"Charakter","toolbar.group.output":"Ausgabe","toolbar.group.aiTools":"KI-Tools","toolbar.group.video":"Video","toolbar.group.scripts":"Skripte","toolbar.group.file":"Datei","toolbar.title":"Symbolleiste","toolbar.dock":"Leiste andocken","toolbar.detach":"Leiste lsen","toolbar.expandPanel":"Panel erweitern","toolbar.collapsePanel":"Panel einklappen","toolbar.dockArea.title":"Leiste hier andocken","toolbar.duplicate":"Knoten duplizieren","toolbar.duplicateWithContent":"Mit Inhalt duplizieren","toolbar.dock.q1":"Links 1. Vtl.","toolbar.dock.q2":"Links 2. Vtl.","toolbar.dock.q3":"Rechts 3. Vtl.","toolbar.dock.q4":"Rechts 4. Vtl.","toolbar.dock.tl":"Oben Links","toolbar.dock.bl":"Unten Links","toolbar.dock.tr":"Oben Rechts","toolbar.dock.br":"Unten Rechts","toolbar.dock.left":"Linke Hlfte","toolbar.dock.right":"Rechte Hlfte","toolbar.dock.full":"Vollbild","toolbar.dock.exitFull":"Vollbild beenden","toolbar.dock.fullFocus":"Vollbild-Fokus","hotkeys.show":"Tastenkrzel anzeigen","hotkeys.tools.title":"Werkzeuge","hotkeys.tools.edit":"Bearbeitungsmodus","hotkeys.tools.cutter":"Schneidewerkzeug","hotkeys.tools.selection":"Auswahlwerkzeug","hotkeys.tools.reroute":"Umlenkwerkzeug","hotkeys.tools.zoom":"Zoom-Werkzeug","hotkeys.tools.toggleLineStyle":"Linienstil umschalten","hotkeys.tools.group":"Gruppenauswahl","hotkeys.tools.closeNode":"Auswahl lschen","hotkeys.tools.duplicate":"Knoten duplizieren","hotkeys.tools.duplicateWithContent":"Mit Inhalt duplizieren","hotkeys.tools.deleteGroup":"Gruppe lschen (Umschalt+Klick)","hotkeys.windows.title":"Fenster","hotkeys.windows.search":"Schnellsuche","hotkeys.windows.catalog":"Katalog","hotkeys.createNode.title":"Knoten erstellen","help.panelTitle":"Hilfe & Tastenkrzel","help.title":"Tastaturkrzel","help.howToUse.title":"Verwendung","help.howToUse.content":"Willkommen bei Prompt Modifier! Verwenden Sie die Symbolleiste oder Tastenkrzel, um Knoten hinzuzufgen. Verbinden Sie Knoten, um Daten zu bertragen. Verwenden Sie das Bearbeitungswerkzeug, um Knoten zu verschieben und die Leinwand zu schwenken. Doppelklicken Sie auf einen leeren Bereich, um das Schnellmen zu ffnen. Rechtsklick fr das Kontextmen.","help.author":"Autor","contextMenu.undoPosition":"Position rckgngig","contextMenu.redoPosition":"Position wiederherstellen","contextMenu.align.left":"Links ausrichten (F)","contextMenu.align.centerX":"Zentrieren X (E)","contextMenu.align.right":"Rechts ausrichten (R)","contextMenu.align.top":"Oben ausrichten (T)","contextMenu.align.centerY":"Zentrieren Y (D)","contextMenu.align.bottom":"Unten ausrichten (B)","contextMenu.distribute.horizontal":"Horiz. verteilen (Strg+D)","contextMenu.distribute.vertical":"Vert. verteilen (Strg+E)","contextMenu.emptySlot":"Leerer Slot (Rechtsklick zum Zuweisen)","contextMenu.saveSlots":"Slots speichern","contextMenu.loadSlots":"Slots laden","quickadd.title":"Schnell hinzufgen","quickadd.group.tools":"Werkzeuge","quickadd.group.inputs":"Eingaben","quickadd.group.processing":"Verarbeitung","quickadd.group.character":"Charakter","quickadd.group.outputs":"Ausgaben","quickadd.group.ai":"KI-Tools","quickadd.group.video":"Video","quickadd.group.scripts":"Skripte","quickadd.group.general":"Allgemein","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"Bearbeiten","quickadd.tool.cutter":"Schneiden","quickadd.tool.selection":"Auswahl","search.placeholder":"Knoten suchen...","search.noResults":"Keine Knoten gefunden.","search.group.input":"Eingabe & Basis","search.group.process":"Verarbeitung & Charakter","search.group.output":"Bild & Sequenz","search.group.ai":"KI-Tools","search.group.video":"Video & Skript","search.group.scripts":"Skripte","toolbar.exitApp":"Projekt schlieen"},Lb={"node.title.text_input":"Texteingabe","node.title.image_input":"Bildeingabe","node.title.prompt_processor":"Prompt-Prozessor","node.title.prompt_sanitizer":"Prompt-Bereiniger","node.title.video_prompt_processor":"Video-Prompt-Prozessor","node.title.image_output":"Bildausgabe","node.title.video_output":"Videoausgabe","node.title.prompt_analyzer":"Prompt-Analysator","node.title.character_analyzer":"Charakter-Analysator","node.title.character_generator":"Charakter-Generator","node.title.character_card":"Charakterkarte","node.title.image_analyzer":"Bildanalysator","node.title.image_editor":"KI-Bildeditor","node.title.image_sequence_generator":"Bildsequenz-Generator","node.title.prompt_sequence_editor":"Prompt-Sequenz-Editor","node.title.gemini_chat":"Gemini Chat","node.title.translator":"bersetzer","node.title.script_generator":"Skript-Generator","node.title.script_viewer":"Skript-Viewer","node.title.note":"Notiz","node.title.reroute_dot":"Umlenkpunkt","node.title.data_reader":"Datenleser","node.title.video_editor":"Video-Editor Alpha","node.title.media_viewer":"Media Viewer","node.title.data_protection":"Datenschutz","node.title.pose_creator":"Pose Creator","node.help.text_input":"Ein einfaches mehrzeiliges Textfeld zur Eingabe von Prompts oder Notizen.","node.help.image_input":"Ermglicht das Hochladen oder Einfgen eines Bildes zur Verwendung als Eingabe fr andere Knoten.","node.help.prompt_processor":"Kombiniert mehrere Texteingaben zu einem einzigen, verbesserten Prompt mithilfe von KI.","node.help.prompt_sanitizer":"Schreibt den Eingabe-Prompt um, damit er sicherer fr Bildgenerierungsrichtlinien ist.","node.help.video_prompt_processor":"Spezialisierter Prozessor zum Erstellen detaillierter Videogenerierungs-Prompts.","node.help.image_output":"Zeigt das Ergebnis der Bildgenerierung an. Untersttzt das Herunterladen und Anzeigen.","node.help.video_output":"Zeigt das Ergebnis der Videogenerierung mit dem Veo-Modell an.","node.help.prompt_analyzer":"Zerlegt einen Prompt in Komponenten wie Subjekt, Stil und Umgebung.","node.help.character_analyzer":"Analysiert eine Charakterbeschreibung und teilt sie in Aussehen und Kleidung auf.","node.help.character_generator":"Generiert detaillierte Charakterbeschreibungen basierend auf einem kurzen Prompt.","node.help.character_card":"Speichert umfassende Charakterdaten einschlielich Bild und Beschreibung.","node.help.image_analyzer":"Verwendet KI, um den Inhalt eines Eingabebildes zu beschreiben.","node.help.image_editor":"Erweitertes Tool zum Bearbeiten von Bildern mit Text-Prompts und Inpainting/Outpainting.","node.help.image_sequence_generator":"Generiert eine Bildsequenz basierend auf einer Liste von Prompts.","node.help.prompt_sequence_editor":"Ermglicht die Massenbearbeitung von Prompt-Sequenzen mithilfe von KI-Anweisungen.","node.help.gemini_chat":"Eine universelle Chat-Schnittstelle mit Gemini fr Brainstorming oder Untersttzung.","node.help.translator":"bersetzt Text zwischen Sprachen mithilfe von KI-Modellen.","node.help.script_generator":"Generiert ein strukturiertes Skript (Szenen, Charaktere) aus einer Story-Idee.","node.help.script_viewer":"Visualisiert und verwaltet Skriptdaten fr die bildweise Generierung.","node.help.note":"Eine Haftnotiz zum Hinzufgen von Kommentaren oder Anweisungen auf der Leinwand.","node.help.reroute_dot":"Ein kleiner Punkt, um Verbindungen zu organisieren und sauberere Layouts zu erstellen.","node.help.data_reader":"Debug-Tool zum berprfen der Rohdaten, die durch Verbindungen flieen.","node.help.video_editor":"Ein zeitleistenbasiertes Tool zum Bearbeiten von Videoclips und Bildern.","node.help.media_viewer":"Ein Player zum Anzeigen von Video- und Audiodateien mit Wiedergabesteuerung.","node.help.data_protection":"Ein interaktives Tower-Defense-Spiel-Knoten. Verteidigen Sie Ihre Daten.","node.help.pose_creator":"Visual rig to define and generate character poses for consistency.","node.action.expand":"Erweitern","node.action.collapse":"Einklappen","node.action.help":"Hilfe","node.action.download":"Herunterladen","node.action.clear":"Inhalt lschen","node.action.refreshChat":"Chat leeren und neu starten","node.action.paste":"Einfgen","node.action.resetEditor":"Editor zurcksetzen","node.action.saveCharacter":"Karte speichern","node.action.loadCharacter":"Karte laden","node.action.copy":"Kopieren","node.action.copyImage":"Bild kopieren","node.action.copyTextPrompt":"Prompt kopieren","node.action.copyImagePrompt":"Bild-Prompt kopieren","node.action.copyVideoPrompt":"Video-Prompt kopieren","node.action.cutConnections":"Verbindungen trennen","node.action.close":"Schlieen","node.action.closeNode":"Knoten schlieen (Umschalt+Klick fr sofort)","node.action.closeNodeSimple":"Knoten schlieen","node.action.randomWord":"Zuflliges Wort","node.action.processImage":"Wasserzeichen entfernen","node.action.processImageTitle":"Verwendet Gemini, um Wasserzeichen und Text aus dem Bild zu entfernen.","node.action.editor":"Editor","node.action.rasterEditor":"Raster-Editor","node.action.openInAIEditor":"In KI-Editor ffnen","node.action.openInAnalyzer":"In Analysator ffnen","node.action.outputToInput":"Ausgabe als Eingabe","node.action.processChainForward":"Vorwrts verarbeiten","node.action.executeChain":"Kette ausfhren","node.action.executeChainTitle":"Fhrt alle vorgelagerten Knoten aus, um das Endergebnis zu generieren.","node.action.sanitize":"Bereinigen","node.action.rename":"Umbenennen","node.action.stop":"Stopp","node.action.stopping":"Stoppen...","node.action.deleteItem":"Element lschen","node.action.detachAndPaste":"Lsen und Einfgen","node.action.delete":"Lschen","node.action.flipImage":"Bild spiegeln","node.action.pin":"Knoten anpinnen","node.action.unpin":"Knoten lsen","node.mediaViewer.play":"Abspielen","node.mediaViewer.pause":"Pause","node.mediaViewer.stop":"Stopp","node.mediaViewer.addMarker":"Marker hinzufgen","node.mediaViewer.exportSRT":"Marker exportieren (SRT)","node.mediaViewer.deleteAllMarkers":"Alle Marker lschen","node.mediaViewer.saveMarkers":"Marker speichern","node.mediaViewer.loadMarkers":"Marker laden","node.mediaViewer.relink":"Datei neu verknpfen","node.content.notePlaceholder":"Schreiben Sie Ihre Notizen hier...","node.content.dropImage":"Bild hier ablegen oder klicken zum Hochladen","node.content.dropMedia":"Video oder Audio hier ablegen","node.content.processing":"Verarbeitung...","node.content.processingChain":"Kette wird verarbeitet...","node.content.metadataPrompt":"Prompt aus Bildmetadaten:","node.content.metadataPromptPlaceholder":"Kein Prompt im Bild gefunden.","node.content.copyPrompt":"Verwenden","node.content.prompt":"Prompt","node.content.inputPrompt":"Eingabe-Prompt","node.content.enhancedResult":"Verbessertes Ergebnis","node.content.videoPrompt":"Video-Prompt","node.content.editPromptPlaceholder":"Fgen Sie dem Prompt hinzu oder bearbeiten Sie ihn...","node.content.enhancedPromptHere":"Verbesserter Prompt erscheint hier...","node.content.safePrompt":"Sicher fr kommerzielle Nutzung","node.content.generating":"Generierung...","node.content.imageHere":"Bild erscheint hier","node.content.generationMode":"Generierungsmodell","node.content.aspectRatio":"Seitenverhltnis","node.content.aspectRatioHelp":"Seitenverhltnis fr die Bildgenerierung festlegen","node.content.aspectRatioNotSupportedFast":"Seitenverhltnis nur fr Imagen-Modelle verfgbar.","node.content.enableAspectRatioFormatting":"Seitenverhltnis-Formatierung aktivieren","node.content.autoDownload":"Autom. Download","node.content.generateImage":"Bild generieren","node.content.enhancing":"Verbesserung...","node.content.enhancePrompt":"Prompt verbessern","node.content.sanitizing":"Bereinigung...","node.content.sanitizedPromptHere":"Bereinigter Prompt erscheint hier...","node.content.analyzing":"Analyse...","node.content.analyzePrompt":"Prompt analysieren","node.content.analyzeImage":"Bild analysieren","node.content.imageToText":"Bild zu Text","node.content.updatePromptFromImage":"Prompt aus Bild aktualisieren","node.content.analyzeCharacter":"Charakter analysieren","node.content.generateCharacters":"Charaktere generieren","node.content.characterPromptPlaceholder":"Beschreiben Sie den/die Charakter(e)...","node.content.character":"Charakter","node.content.clothing":"Kleidung","node.content.characterPlaceholder":"Charakterbeschreibung erscheint hier...","node.content.clothingPlaceholder":"Kleidungsbeschreibung erscheint hier...","node.content.appearance":"Aussehen","node.content.personality":"Persnlichkeit","node.content.environment":"Umgebung/Setting","node.content.action":"Handlung","node.content.emotion":"Emotion","node.content.style":"Stil","node.content.environmentPlaceholder":"Detaillierte Beschreibung der Umgebung...","node.content.charactersPlaceholder":"Liste der Hauptcharaktere...","node.content.characters":"Charaktere","node.content.characterConcepts":"Charakterkonzepte","node.content.actionPlaceholder":"Beschreibung der Handlung...","node.content.emotionPlaceholder":"Beschreibung der Emotion...","node.content.stylePlaceholder":"Beschreibung des Kunststils...","node.content.descriptionHere":"Beschreibung erscheint hier...","node.content.enableOutpainting":"Outpainting aktivieren","node.content.outpaintingPromptPlaceholder":"Outpainting-Prompt...","node.content.inputImage":"Eingabebilder","node.content.dropOrClick":"Ablegen oder Klicken","node.content.outputImage":"Ausgabebild","node.content.applyEdit":"Bearbeitung anwenden","node.content.editing":"Bearbeitung...","node.content.chatPlaceholder":"Geben Sie Ihre Nachricht ein...","node.content.connectedPlaceholder":"Mit Knoten verbunden, in Quelle bearbeiten.","node.content.connectedNode":"ber Knoten verbunden","node.content.connectedEmpty":"Verbundener Knoten hat kein Bild.","node.content.translatePlaceholder":"Text zum bersetzen...","node.content.translatedTextPlaceholder":"bersetzter Text...","node.content.targetLanguage":"Zielsprache","node.content.translate":"bersetzen","node.content.translating":"bersetzung...","node.content.scriptPromptPlaceholder":"Geben Sie eine Story-Idee oder einen Plot ein...","node.content.generateScript":"Skript generieren","node.content.loadScript":"Skriptdatei laden","node.content.summary":"Zusammenfassung","node.content.scenes":"Szenen","node.content.unrecognizedFormat":"Nicht erkanntes Skriptformat.","node.content.frames":"Frames","node.content.characterIndex":"Index","node.content.readData":"Daten lesen","node.content.textDataHere":"Textdaten erscheinen hier.","node.content.noDataRead":'Verbinden Sie einen Knoten und klicken Sie auf "Daten lesen".',"node.content.previewError":"Vorschaufehler","node.content.previewPlaceholder":"Vorschau erscheint hier","node.content.imagePrompt":"Bild-Prompt","node.output.allPromptData":"Alle Prompt-Daten","node.note.tab.note":"Notiz","node.note.tab.references":"Referenzen","node.note.nestedImages":"Verschachtelte Bilder","node.note.dropPlaceholder":"Bilder ablegen oder klicken","node.note.addCaption":"Bildunterschrift","node.note.action.shuffle":"Mischen","node.note.action.undoShuffle":"Mischen rckgngig machen","node.content.characterTypeShort":"Typ:","node.content.numberOfCharactersShort":"Menge:","node.content.characterType.simple":"Einfach","node.content.characterType.anthro":"Anthro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Schlsselobjekt","node.content.style.simple":"Einfach","node.content.style.realistic":"Realistisch","node.content.style.3d_cartoon":"3D Cartoon","node.content.style.3d_realistic":"3D Realistisch","node.content.style.2d_animation":"2D Animation","node.content.style.anime":"Anime","node.content.style.comics":"Comics","node.content.style.custom":"Benutzerdefiniert","node.content.fullDescriptionTitle":"Detaillierte Charakterbeschreibung","node.content.integrationInstruction":"Integrationsanweisung","node.content.additionalPromptSuffix":"Zustzlicher Prompt (Suffix)","image_sequence.auto_crop":"Autom. Zuschnitt 16:9","image_sequence.create_zip":"ZIP-Archiv erstellen","node.content.modificationRequest":"nderungsanfrage","node.content.technicalPrompt":"Technischer Prompt","node.promptProcessor.safePromptTooltip":"Schreibt den Prompt um, um die Sicherheitsrichtlinien einzuhalten und Richtlinienverste zu vermeiden.","node.promptProcessor.technicalPromptTooltip":"Wandelt den Prompt in eine hochdetaillierte technische Spezifikation um (Beleuchtung, Kamera, Rendereinstellungen).","node.promptProcessor.enhanceTooltip":"Nutzt KI, um den Prompt mit beschreibenden Details zu erweitern und anzureichern.","node.promptProcessor.chainTooltip":"Fhrt diesen Knoten aus und lst alle verbundenen nachgelagerten Knoten aus.","image_sequence.tooltip.autoCrop":"Schneidet generierte Bilder automatisch auf ein Seitenverhltnis von 16:9 zu.","image_sequence.tooltip.autoDownload":"Speichert jedes Bild sofort nach der Generierung automatisch auf Ihrem Gert.","image_sequence.tooltip.createZip":"Packt alle ausgewhlten Bilder beim Herunterladen in ein einziges ZIP-Archiv."},Db={"imageEditor.title":"Bildeditor","imageEditor.canvasResolution":"Leinwandauflsung","imageEditor.background":"Hintergrund","imageEditor.toolSettings":"Werkzeugeinstellungen","imageEditor.snapToEdges":"An Rndern ausrichten","imageEditor.freeAspect":"Freies Seitenverhltnis","imageEditor.section.aiRequest":"KI-nderungsanfrage","imageEditor.input.modificationPlaceholder":'Beschreiben Sie nderungen, z.B. "Hintergrund blau machen"',"imageEditor.action.sendRequest":"Anfrage senden","imageEditor.tooltip.removeObject":"Entfernen (Rot) / Behalten (Grn)","imageEditor.action.removeObject":"Objekt entfernen","imageEditor.tool.transform":"Transformieren","imageEditor.tool.hand":"Hand (Schwenken)","imageEditor.tool.zoom":"Zoom","imageEditor.tool.pencil":"Stift","imageEditor.tool.rectangle":"Rechteck","imageEditor.action.fit":"An Leinwand anpassen","imageEditor.action.fill":"Leinwand fllen","imageEditor.action.cancel":"Abbrechen","imageEditor.action.resetEdits":"nderungen zurcksetzen","imageEditor.action.apply":"Anwenden","imageViewer.title":"Bildbetrachter","imageEditor.outputResolution":"Ausgabeauflsung","imageEditor.outputResolutionHelp":'Ausgabeauflsung festlegen. Bei "Auto" wird die Leinwandauflsung verwendet.',"imageEditor.currentSize":"Aktuelle Gre: {width}x{height}","imageEditor.sequenceMode":"Sequenzmodus","imageEditor.sequenceModeHelp":"Eingabebilder von Eingang A sequenziell verarbeiten.","imageEditor.sequentialCombination":"Sequenzielle Bildkombination","imageEditor.sequentialCombinationHelp":"Fr jeden Frame: Sendet aktuelles Bild A + Alle Bilder B.","imageEditor.sequentialPrompt":"Sequenzielle Prompt-Kombination","imageEditor.sequentialPromptHelp":"Fr jeden Frame: Verwendet einen eindeutigen Prompt aus der Liste + aktuelles Bild.","imageEditor.sequentialEditingWithPrompts":"Sequenzielle Bearbeitung mit Prompts","imageEditor.sequentialEditingWithPromptsHelp":"Fr jeden Frame: Verwendet Bild B + eindeutigen Prompt. Eingang A wird ignoriert.","imageEditor.input":"Eingang","imageEditor.inputA":"Eingang A","imageEditor.inputB":"Eingang B","imageEditor.status.queued":"In Warteschlange","imageEditor.status.generating":"Generierung...","imageEditor.action.regenerate":"Neu generieren","imageEditor.tooltip.fit":"Bild in Leinwand einpassen (contain).","imageEditor.tooltip.fill":"Bild skalieren, um Leinwand zu fllen (cover).","imageEditor.tooltip.flip":"Bild horizontal spiegeln.","imageEditor.background.white":"Wei","imageEditor.background.gray":"Grau","imageEditor.background.black":"Schwarz","imageEditor.background.dark":"Dunkel","image_sequence.regenerate":"Neu generieren","image_sequence.stop_queue":"Warteschlange stoppen","image_sequence.move_up":"Nach oben","image_sequence.move_down":"Nach unten","image_sequence.copy_prompt":"Prompt kopieren","image_sequence.add_frame":"Frame hinzufgen","image_sequence.delete_frame":"Frame lschen","image_sequence.expand_all_frames":"Alle Frames erweitern/einklappen","image_sequence.collapse_all_frames":"Alle Frames einklappen","image_sequence.expand_all_scenes":"Alle Szenen erweitern/einklappen","image_sequence.collapse_all_scenes":"Alle Szenen einklappen","image_sequence.expand_all":"Alles erweitern","image_sequence.collapse_all":"Alles einklappen","image_sequence.clear_all_prompts":"Alle Prompts lschen","image_sequence.add_first_frame":"Ersten Frame hinzufgen","image_sequence.drop_or_add_title":"Sequenz-JSON ablegen oder Frame hinzufgen","image_sequence.drop_or_add_desc":"Legen Sie hier eine JSON-Datei ab oder klicken Sie auf die Schaltflche, um manuell einen Frame hinzuzufgen.","image_sequence.load_prompts":"Prompts laden","image_sequence.output_images_title":"Ausgabebilder","image_sequence.prompts_list_title":"Quell-Prompts","image_sequence.download_selected":"Auswahl herunterladen","image_sequence.select_all":"Alle auswhlen","image_sequence.select_none":"Keine auswhlen","image_sequence.invert_selection":"Auswahl umkehren","image_sequence.run_selected":"Auswahl ausfhren","image_sequence.start_queue":"Warteschlange starten","image_sequence.character_prompt_combination":"Charakter-Prompt-Kombination","image_sequence.combination_none":"Keine","image_sequence.combination_combine":"Kombinieren","image_sequence.combination_replace":"Tags ersetzen","image_sequence.status.error":"Fehler","image_sequence.status.pending":"In Warteschlange","image_sequence.clear_selected_prompts":"Ausgewhlte Prompts lschen","image_sequence.range_from":"Von:","image_sequence.range_to":"Bis:","image_sequence.stats.total":"Gesamt Frames: {count}","image_sequence.stats.generated":"Generiert: {count}","image_sequence.stats.queue":"Warteschlange: {count}","image_sequence.edit_in_source":"In Quelle bearbeiten","image_sequence.edit_prompt":"Prompt bearbeiten","image_sequence.select_scene":"Szene auswhlen","image_sequence.next_scene":"Nchste Szene","image_sequence.prev_scene":"Vorherige Szene","image_sequence.scene_input_label":"Szene","image_sequence.select_square":"Quadratisch (1:1) auswhlen","image_sequence.select_landscape":"Landschaft (16:9) auswhlen","image_sequence.select_portrait":"Portrt (9:16) auswhlen","image_sequence.select_range":"Bereich auswhlen","image_sequence.force_refresh":"Aktualisierung erzwingen","image_sequence.select_scene_frames":"Alle Frames in dieser Szene auswhlen","image_sequence.collapse_other_scenes":"Andere Szenen einklappen","prompt_sequence_editor.instructionPlaceholder":"Anweisung eingeben...","prompt_sequence_editor.modifying":"nderung luft...","prompt_sequence_editor.modifySelected":"Auswahl ndern ({count})","prompt_sequence_editor.sourcePrompts":"Quell-Prompts","prompt_sequence_editor.finalPrompts":"Genderte Prompts","prompt_sequence_editor.error.invalidInput":"Ungltiges Format.","geminiChat.mode.general":"Allgemein","geminiChat.mode.prompt":"Prompt-Experte","geminiChat.mode.script":"Drehbuchautor","geminiChat.mode.youtube":"YouTube-Analyst","image_sequence.shot_type.WS":"Integrieren Sie die Entitt mit einer Totalen (WS) in die Szene und Handlung. Zeigen Sie die Umgebung.","image_sequence.shot_type.MS":"Integrieren Sie die Entitt mit einer Halbnahaufnahme (MS) in die Szene. Charakter ab der Taille aufwrts.","image_sequence.shot_type.CU":"Integrieren Sie die Entitt mit einer Nahaufnahme (CU) in die Szene.","image_sequence.shot_type.ECU":"Integrieren Sie die Entitt mit einer extremen Nahaufnahme (ECU) in die Szene. Maximale Details.","image_sequence.shot_type.LS":"Integrieren Sie die Entitt mit einer Weitwinkeleinstellung (LS) in die Szene, um den Mastab zu zeigen."},zb={"dialog.permission.title":"Berechtigung erforderlich","dialog.permission.description":"Diese App bentigt Zugriff auf Ihre Zwischenablage, um Inhalte in Knoten einzufgen. Ihre Daten werden weder gespeichert noch gesendet.","dialog.permission.allow":"Erlauben","dialog.permission.decline":"Ablehnen","dialog.rename.title":"Element umbenennen","dialog.rename.group.title":"Gruppe umbenennen","dialog.rename.catalog.title":"Katalogelement umbenennen","dialog.rename.node.title":"Knoten umbenennen","dialog.rename.label":"Neuer Name:","dialog.rename.confirm":"Umbenennen","dialog.rename.cancel":"Abbrechen","dialog.promptEdit.title":"Prompt bearbeiten","dialog.promptEdit.nameLabel":"Name:","dialog.promptEdit.contentLabel":"Inhalt:","dialog.promptEdit.confirm":"Speichern","dialog.promptEdit.cancel":"Abbrechen","dialog.confirmDelete.title":"Lschen besttigen","dialog.confirmDelete.message":"Sind Sie sicher, dass Sie dieses Element lschen mchten? Dies kann nicht rckgngig gemacht werden.","dialog.confirmDelete.confirm":"Lschen","dialog.confirmDelete.cancel":"Abbrechen","dialog.confirmCloseTab.title":"Tab schlieen","dialog.confirmCloseTab.message":'Mchten Sie den Tab "{tabName}" wirklich schlieen? Nicht gespeicherte nderungen gehen verloren.',"dialog.confirmClear.title":"Leinwand leeren","dialog.confirmClear.message":"Mchten Sie wirklich alles lschen? Dies kann nicht rckgngig gemacht werden.","dialog.confirmReset.title":"Zurcksetzen","dialog.confirmReset.message":"Mchten Sie die Leinwand auf den Standardzustand zurcksetzen? Alle aktuellen Arbeiten gehen verloren.","dialog.confirmReset.confirm":"Zurcksetzen","dialog.confirmLoad.title":"Laden besttigen","dialog.confirmLoad.message":"Das Laden einer neuen Datei ersetzt den aktuellen Inhalt. Nicht gespeicherte nderungen gehen verloren. Fortfahren?","dialog.apiKey.title":"API-Schlssel whlen","dialog.apiKey.description":'Diese Funktion erfordert einen Projekt-API-Schlssel mit aktivierter "AI Platform"-API. Die Videogenerierung kann einige Minuten dauern.',"dialog.apiKey.billingLink":"Mehr ber Abrechnung erfahren","dialog.apiKey.button":"API-Schlssel whlen","dialog.settings.title":"Einstellungen","dialog.settings.apiKeyLabel":"Ihr Google Gemini API-Schlssel:","dialog.settings.useDevKeyLabel":"Kostenlosen Schlssel verwenden (Entwicklung)","dialog.settings.instantNodeCloseLabel":"Sofortiges Schlieen von Knoten","dialog.settings.nodeAnimationLabel":"Knoten-Hinzufge-Animation","dialog.settings.animationModeLabel":"Erstellungs-Animationsmodus","dialog.settings.anim.pulse":"Pulsieren","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"Keine","dialog.settings.description":"Um Ihre eigenen Quoten zu nutzen und auf bestimmte Modelle zuzugreifen, geben Sie Ihren persnlichen API-Schlssel ein. Er wird lokal gespeichert.","dialog.settings.getKeyLink":"Hier API-Schlssel erhalten","dialog.settings.save":"Speichern","dialog.deleteNode.title":"Knoten schlieen?","dialog.deleteNode.titlePlural":"Knoten schlieen?","dialog.deleteNode.confirm":"Ja","dialog.deleteNode.cancel":"Nein","dialog.deleteNode.confirmTooltip":"Knoten schlieen - verlorene Daten knnen nicht wiederhergestellt werden","dialog.deleteNode.cancelTooltip":"Nicht schlieen - weiterarbeiten","dialog.deleteNode.dontShowAgain":"Nicht mehr anzeigen","dialog.exitApp.title":"Projekt schlieen?","dialog.exitApp.message":"Mchten Sie das Projekt wirklich schlieen? Alle aktuellen Arbeiten gehen verloren und die Leinwand wird zurckgesetzt."},qb={"group.button.create":"Gruppe erstellen ({count})","group.rename":"Gruppe umbenennen","group.saveToCatalog":"Im Katalog speichern","group.saveToDisk":"Auf Festplatte speichern","group.ungroup":"Gruppierung aufheben (Umschalt+Klick zum Lschen inkl. Inhalt)","group.duplicate":"Mit Inhalt duplizieren","catalog.tabs.groups":"Gruppen","catalog.tabs.library":"Bibliothek","catalog.tabs.characters":"Charaktere","catalog.tabs.scripts":"Skripte","catalog.tabs.sequences":"Sequenzen","catalog.back":"Zurck","catalog.load":"Aus Datei laden","catalog.newFolder":"Neuer Ordner","catalog.saveTo":"Im Katalog speichern","catalog.card.addToCanvas":"Zur Leinwand hinzufgen","catalog.card.rename":"Umbenennen","catalog.card.save":"Speichern","catalog.card.delete":"Lschen","catalog.empty.description":"Dieser Ordner ist leer. Sie knnen Elemente hinzufgen oder Ordner erstellen.","library.loadFromFile":"Laden","library.actions.newFolder":"Neuer Ordner","library.actions.newPrompt":"Neuer Prompt","library.actions.copy":"Kopieren","library.actions.edit":"Bearbeiten","library.empty.title":"Leerer Ordner","library.empty.description":"Erstellen Sie Prompts und Ordner, um zu beginnen.","library.emptyPrompt":"Leerer Prompt"},Ob={...Rb,...Mb,...Lb,...Db,...zb,...qb},Fb={"app.title":"Modificatore di Prompt","app.subtitle":"Connetti idee per creare un capolavoro","app.error.title":"Notifica","app.error.copy":"Copia Messaggio","app.error.copied":"Copiato!","error.apiKey":"La tua chiave API non  valida o mancano i permessi. Seleziona una chiave API valida.","error.scriptModifierCanvas":"Questa tela appartiene a un'altra applicazione - Script Modifier. Utilizza Script Modifier per aprire questo file.","welcome.title":"Benvenuto in","welcome.description":"Benvenuto in Prompt Modifier. Connetti idee per creare capolavori. Usa i nodi per generare e modificare contenuti.","welcome.apiKeyLabel":"La tua Chiave API Google Gemini","welcome.apiKeyPlaceholder":"Inserisci la tua chiave API qui...","welcome.apiKeyHelp":"La tua chiave API  salvata localmente.","welcome.getKeyLink":"Ottieni Chiave API","welcome.iAmDeveloper":"Sono uno Sviluppatore","welcome.letsGo":"Andiamo","welcome.resume":"Riprendi","welcome.startNew":"Nuova Tela","welcome.freeModeActive":"Modalit Gratuita Attiva","welcome.selectLanguage":"Seleziona la tua lingua principale","welcome.navHint":"Usa i tasti della tastiera  e  per cambiare lingua","toast.contentCleared":"Contenuto cancellato","toast.downloadStarted":"Download avviato","toast.characterLoaded":"Scheda personaggio caricata","toast.characterSavedDisk":"Scheda personaggio salvata su disco","toast.copiedToClipboard":"Copiato negli appunti","toast.pastedFromClipboard":"Incollato dagli appunti","toast.pasteFailed":"Incollaggio fallito","toast.nodeDuplicated":"Nodo duplicato","toast.groupSavedToDisk":'Gruppo "{groupTitle}" salvato su disco',"toast.groupDeleted":"Gruppo e contenuti eliminati","toast.characterSavedCatalog":"Personaggio salvato nel catalogo","toast.promptSaved":"Prompt salvato nella libreria: {promptName}...","toast.connectionsCut":"Connessioni rimosse","toast.apiKeySaved":"Chiave API salvata con successo","toast.cacheCleared":"{count} elementi inutilizzati rimossi dalla cache","toast.cacheEmpty":"Cache gi ottimizzata","toast.scriptSaved":"Sceneggiatura salvata su disco","alert.groupSaved":'Gruppo "{groupTitle}" salvato nel catalogo.',"alert.loadCatalogFailed":"Impossibile caricare il file del catalogo","alert.invalidCatalogFile":"Formato file catalogo non valido","alert.fileNotSupported":'File non supportato. "appName" mancante o errato.',"alert.invalidCatalogStructure":'Struttura catalogo non valida. "root" mancante.',"tutorial.step1":"Clicca qui per aggiungere una parola casuale al prompt.","tutorial.step2":`Clicca su "Migliora Prompt" per combinare gli input usando l'IA.`,"tutorial.step2_waiting":"L'IA sta analizzando i tuoi input e generando un prompt pi ricco...","tutorial.step3":"Infine, clicca qui per generare l'immagine.","tutorial.step3b":"La generazione richiede del tempo. Puoi monitorare i progressi qui.","tutorial.step4":"Puoi aggiungere nuovi nodi manualmente da questa barra degli strumenti.","tutorial.group.catalog":"Usa il Catalogo per cercare nodi o gestire gruppi.","tutorial.group.general":"Aggiungi Note Adesive e Lettori di Dati per il debug.","tutorial.group.input":"Input di base per testo, immagini e sequenze.","tutorial.group.processing":"Analizza ed elabora prompt o immagini con l'IA.","tutorial.group.character":"Crea, analizza e memorizza personaggi dettagliati.","tutorial.group.output":"Visualizza i risultati e genera sequenze.","tutorial.group.ai":"Chatta con Gemini e traduci testi.","tutorial.group.video":"Strumenti per prompt video e montaggio.","tutorial.group.scripts":"Genera e visualizza sceneggiature per storie complesse.","tutorial.group.file":"Salva il tuo lavoro, carica progetti o scarica la tela.","tutorial.success.title":"Tutorial Completato!","tutorial.success.message":"Hai imparato con successo le basi di Prompt Modifier. Buona fortuna nella creazione di capolavori!","tutorial.success.button":"Inizia a Creare","tutorial.skip":"Salta","tutorial.next":"Avanti","tutorial.finish":"Capito"},Bb={"toolbar.settings":"Impostazioni","toolbar.resetCanvas":"Resetta Tela","toolbar.clearCache":"Svuota Cache Inutilizzata","toolbar.home":"Home","toolbar.edit":"Modifica (V)","toolbar.cutter":"Taglia Connessione (C) / (Tieni premuto Ctrl)","toolbar.selection":"Selezione (S) / (Tieni premuto Shift)","toolbar.reroute":"Reindirizza (R) / (Tieni premuto Ctrl+Alt)","toolbar.zoom":"Zoom (Tieni premuto Z)","toolbar.snapToGrid":"Aggancia alla Griglia","toolbar.smartGuides":"Guide Intelligenti","toolbar.lineStyleSpaghetti":"Linee Spaghetti","toolbar.lineStyleOrthogonal":"Linee Ortogonali","toolbar.resetZoom":"Resetta Zoom","toolbar.resetCamera":"Resetta Posizione Camera","toolbar.clearCanvas":"Pulisci Tela","toolbar.addNode":"Aggiungi Nodo (F)","toolbar.catalog":"Apri Catalogo (Ctrl + Spazio)","toolbar.addNote":"Aggiungi Nota (N)","toolbar.addDataReader":"Aggiungi Lettore Dati (Shift + R)","toolbar.addTextInput":"Aggiungi Input Testo (T)","toolbar.addImageInput":"Aggiungi Input Immagine (I)","toolbar.addPromptSequenceEditor":"Aggiungi Editor Sequenza Prompt (Q)","toolbar.addImageAnalyzer":"Aggiungi Analizzatore Immagine (Shift+A)","toolbar.addPromptAnalyzer":"Aggiungi Analizzatore Prompt (A)","toolbar.addPromptProcessor":"Aggiungi Processore Prompt (P)","toolbar.addCharacterGenerator":"Aggiungi Generatore Personaggi (Shift+C)","toolbar.addCharacterAnalyzer":"Aggiungi Analizzatore Personaggi (Ctrl+Shift+A)","toolbar.addCharacterCard":"Aggiungi Scheda Personaggio (Ctrl+Shift+C)","toolbar.addImageOutput":"Aggiungi Output Immagine (O)","toolbar.addImageEditor":"Aggiungi Editor Immagini IA (Shift+I)","toolbar.addImageSequenceGenerator":"Aggiungi Generatore Sequenza Immagini (Shift+Q)","toolbar.addTranslator":"Aggiungi Traduttore (L)","toolbar.addGeminiChat":"Aggiungi Chat Gemini (M)","toolbar.addVideoPromptProcessor":"Aggiungi Processore Prompt Video (Shift+P)","toolbar.addVideoOutput":"Aggiungi Output Video (Shift+O)","toolbar.addScriptGenerator":"Aggiungi Generatore Sceneggiatura","toolbar.addScriptViewer":"Aggiungi Visualizzatore Sceneggiatura (Shift + V)","toolbar.saveCanvas":"Salva Tela (Ctrl + S)","toolbar.saveProject":"Salva Progetto","toolbar.loadCanvas":"Carica Progetto/Tela (Ctrl + O)","toolbar.group.general":"Generale","toolbar.group.catalog":"Catalogo","toolbar.group.input":"Input","toolbar.group.processing":"Elaborazione","toolbar.group.character":"Personaggio","toolbar.group.output":"Output","toolbar.group.aiTools":"Strumenti IA","toolbar.group.video":"Video","toolbar.group.scripts":"Sceneggiature","toolbar.group.file":"File","toolbar.title":"Barra degli Strumenti","toolbar.dock":"Ancora Barra","toolbar.detach":"Stacca Barra","toolbar.expandPanel":"Espandi Pannello","toolbar.collapsePanel":"Comprimi Pannello","toolbar.dockArea.title":"Ancora Barra Qui","toolbar.duplicate":"Duplica Nodo","toolbar.duplicateWithContent":"Duplica con Contenuto","toolbar.dock.q1":"Sinistra 1 Qrt","toolbar.dock.q2":"Sinistra 2 Qrt","toolbar.dock.q3":"Destra 3 Qrt","toolbar.dock.q4":"Destra 4 Qrt","toolbar.dock.tl":"Alto Sinistra","toolbar.dock.bl":"Basso Sinistra","toolbar.dock.tr":"Alto Destra","toolbar.dock.br":"Basso Destra","toolbar.dock.left":"Met Sinistra","toolbar.dock.right":"Met Destra","toolbar.dock.full":"Schermo Intero","toolbar.dock.exitFull":"Esci da Schermo Intero","toolbar.dock.fullFocus":"Focus Schermo Intero","hotkeys.show":"Mostra Scorciatoie","hotkeys.tools.title":"Strumenti","hotkeys.tools.edit":"Modalit Modifica","hotkeys.tools.cutter":"Strumento Taglierina","hotkeys.tools.selection":"Strumento Selezione","hotkeys.tools.reroute":"Strumento Reindirizzamento","hotkeys.tools.zoom":"Strumento Zoom","hotkeys.tools.toggleLineStyle":"Cambia Stile Linea","hotkeys.tools.group":"Selezione Gruppo","hotkeys.tools.closeNode":"Elimina Selezionati","hotkeys.tools.duplicate":"Duplica Nodo","hotkeys.tools.duplicateWithContent":"Duplica con Contenuto","hotkeys.tools.deleteGroup":"Elimina Gruppo (Shift+Click)","hotkeys.windows.title":"Finestre","hotkeys.windows.search":"Ricerca Rapida","hotkeys.windows.catalog":"Catalogo","hotkeys.createNode.title":"Crea Nodo","help.panelTitle":"Aiuto e Scorciatoie","help.title":"Scorciatoie da Tastiera","help.howToUse.title":"Come Usare","help.howToUse.content":"Benvenuto in Prompt Modifier! Usa la barra degli strumenti o le scorciatoie per aggiungere nodi. Connetti i nodi per passare i dati. Usa lo strumento Modifica per spostare i nodi e scorrere la tela. Doppio clic su uno spazio vuoto per aprire il menu di aggiunta rapida. Clic destro per il menu contestuale.","help.author":"Autore","contextMenu.undoPosition":"Annulla Posizione","contextMenu.redoPosition":"Ripeti Posizione","contextMenu.align.left":"Allinea a Sinistra (F)","contextMenu.align.centerX":"Allinea Centro X (E)","contextMenu.align.right":"Allinea a Destra (R)","contextMenu.align.top":"Allinea in Alto (T)","contextMenu.align.centerY":"Allinea Centro Y (D)","contextMenu.align.bottom":"Allinea in Basso (B)","contextMenu.distribute.horizontal":"Distribuisci Orizz. (Ctrl+D)","contextMenu.distribute.vertical":"Distribuisci Vert. (Ctrl+E)","contextMenu.emptySlot":"Slot Vuoto (Click destro per assegnare)","contextMenu.saveSlots":"Salva Config Slot","contextMenu.loadSlots":"Carica Config Slot","quickadd.title":"Aggiunta Rapida","quickadd.group.tools":"Strumenti","quickadd.group.inputs":"Input","quickadd.group.processing":"Elaborazione","quickadd.group.character":"Personaggio","quickadd.group.outputs":"Output","quickadd.group.ai":"Strumenti IA","quickadd.group.video":"Video","quickadd.group.scripts":"Sceneggiature","quickadd.group.general":"Generale","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"Modifica","quickadd.tool.cutter":"Taglierina","quickadd.tool.selection":"Selezione","search.placeholder":"Cerca un nodo da aggiungere...","search.noResults":"Nessun nodo trovato.","search.group.input":"Input & Base","search.group.process":"Elaborazione & Personaggio","search.group.output":"Immagine & Sequenza","search.group.ai":"Strumenti IA","search.group.video":"Video & Scrittura","search.group.scripts":"Sceneggiature","toolbar.exitApp":"Chiudi Progetto"},Hb={"node.title.text_input":"Input Testo","node.title.image_input":"Input Immagine","node.title.prompt_processor":"Processore Prompt","node.title.prompt_sanitizer":"Sanitizzatore Prompt","node.title.video_prompt_processor":"Proc. Prompt Video","node.title.image_output":"Output Immagine","node.title.video_output":"Output Video","node.title.prompt_analyzer":"Analizzatore Prompt","node.title.character_analyzer":"Analizzatore Personaggio","node.title.character_generator":"Generatore Personaggio","node.title.character_card":"Scheda Personaggio","node.title.image_analyzer":"Analizzatore Immagine","node.title.image_editor":"Editor Immagini IA","node.title.image_sequence_generator":"Generatore Sequenza Immagini","node.title.prompt_sequence_editor":"Editor Sequenza Prompt","node.title.gemini_chat":"Chat Gemini","node.title.translator":"Traduttore","node.title.script_generator":"Generatore Sceneggiatura","node.title.script_viewer":"Visualizzatore Sceneggiatura","node.title.note":"Nota","node.title.reroute_dot":"Punto Reindirizzamento","node.title.data_reader":"Lettore Dati","node.title.video_editor":"Video Editor Alpha","node.title.media_viewer":"Visualizzatore Media","node.title.data_protection":"Protezione Dati","node.title.pose_creator":"Pose Creator","node.help.text_input":"Un semplice campo di testo multilinea per inserire prompt o note.","node.help.image_input":"Consente di caricare o incollare un'immagine da usare come input per altri nodi.","node.help.prompt_processor":"Combina pi input di testo in un singolo prompt migliorato usando l'IA.","node.help.prompt_sanitizer":"Riscrive il prompt di input per renderlo pi sicuro per le politiche di generazione immagini, preservando l'intento artistico.","node.help.video_prompt_processor":"Processore specializzato per creare prompt dettagliati per la generazione video.","node.help.image_output":"Visualizza il risultato della generazione di immagini. Supporta il download e la visualizzazione.","node.help.video_output":"Visualizza il risultato della generazione video usando il modello Veo.","node.help.prompt_analyzer":"Decostruisce un prompt in componenti come soggetto, stile e ambiente.","node.help.character_analyzer":"Analizza una descrizione del personaggio e la divide in aspetto e abbigliamento.","node.help.character_generator":"Genera descrizioni dettagliate di personaggi basate su un breve prompt.","node.help.character_card":"Memorizza dati completi del personaggio inclusi immagine e descrizione.","node.help.image_analyzer":"Usa l'IA per descrivere il contenuto di un'immagine di input.","node.help.image_editor":"Strumento avanzato per modificare immagini usando prompt di testo e inpainting/outpainting.","node.help.image_sequence_generator":"Genera una sequenza di immagini basata su una lista di prompt.","node.help.prompt_sequence_editor":"Permette la modifica in massa di sequenze di prompt usando istruzioni IA.","node.help.gemini_chat":"Un'interfaccia di chat generica con Gemini per brainstorming o assistenza.","node.help.translator":"Traduce il testo tra le lingue usando modelli IA.","node.help.script_generator":"Genera una sceneggiatura strutturata (scene, personaggi) da un'idea di storia.","node.help.script_viewer":"Visualizza e gestisce i dati della sceneggiatura per la generazione fotogramma per fotogramma.","node.help.note":"Una nota adesiva per aggiungere commenti o istruzioni sulla tela.","node.help.reroute_dot":"Un piccolo punto usato per organizzare le connessioni e creare layout pi puliti.","node.help.data_reader":"Strumento di debug per ispezionare i dati grezzi che fluiscono attraverso le connessioni.","node.help.video_editor":"Uno strumento basato su timeline per modificare clip video e immagini.","node.help.media_viewer":"Un lettore per visualizzare file video e audio con controlli di riproduzione.","node.help.data_protection":"Un nodo mini-gioco interattivo Tower Defense. Difendi il flusso di dati dalla corruzione.","node.help.pose_creator":"Visual rig to define and generate character poses for consistency.","node.action.expand":"Espandi","node.action.collapse":"Comprimi","node.action.help":"Aiuto","node.action.download":"Scarica","node.action.clear":"Pulisci Contenuto","node.action.refreshChat":"Pulisci e Riavvia Chat","node.action.paste":"Incolla","node.action.resetEditor":"Resetta Editor","node.action.saveCharacter":"Salva Scheda","node.action.loadCharacter":"Carica Scheda","node.action.copy":"Copia","node.action.copyImage":"Copia Immagine","node.action.copyTextPrompt":"Copia Prompt","node.action.copyImagePrompt":"Copia Prompt Immagine","node.action.copyVideoPrompt":"Copia Prompt Video","node.action.cutConnections":"Taglia Connessioni","node.action.close":"Chiudi","node.action.closeNode":"Chiudi Nodo (Shift+Click per chiusura istantanea)","node.action.closeNodeSimple":"Chiudi Nodo","node.action.randomWord":"Aggiungi Parola Casuale","node.action.processImage":"Rimuovi Watermark","node.action.processImageTitle":"Usa Gemini per rimuovere watermark e testo dall'immagine.","node.action.editor":"Editor","node.action.rasterEditor":"Editor Raster","node.action.openInAIEditor":"Apri in Editor IA","node.action.openInAnalyzer":"Apri in Analizzatore","node.action.outputToInput":"Usa Output come Input","node.action.processChainForward":"Processa in Avanti","node.action.executeChain":"Esegui Catena","node.action.executeChainTitle":"Esegui tutti i nodi a monte per generare il risultato finale.","node.action.sanitize":"Sanitizza","node.action.rename":"Rinomina","node.action.stop":"Stop","node.action.stopping":"Arresto...","node.action.deleteItem":"Elimina Elemento","node.action.detachAndPaste":"Stacca e Incolla","node.action.delete":"Elimina","node.action.flipImage":"Ribalta Immagine","node.action.pin":"Fissa Nodo in Alto","node.action.unpin":"Sblocca Nodo","node.action.updateDescription":"Aggiorna Descrizione","node.action.modifyCharacter":"Richiedi Modifiche","node.action.updateDataFormat":"Aggiorna Formato Dati","node.action.expand169":"Espandi a 16:9","node.action.expand916":"Espandi a 9:16","node.action.sync":"Sincronizza dalle Connessioni","node.action.expandRatio":"Espandi Proporzioni","node.action.markPrimary":"Segna come Principale","node.action.addCard":"Aggiungi Scheda","node.action.removeCard":"Rimuovi Scheda","node.action.showOutputs":"Mostra Output","node.action.hideOutputs":"Nascondi Output","node.mediaViewer.play":"Play","node.mediaViewer.pause":"Pausa","node.mediaViewer.stop":"Stop","node.mediaViewer.addMarker":"Aggiungi Marker","node.mediaViewer.exportSRT":"Esporta Marker (SRT)","node.mediaViewer.deleteAllMarkers":"Elimina Tutti i Marker","node.mediaViewer.saveMarkers":"Salva Marker su Disco","node.mediaViewer.loadMarkers":"Carica Marker da Disco","node.mediaViewer.relink":"Ricollega File","node.content.notePlaceholder":"Scrivi qui le tue note...","node.content.dropImage":"Trascina immagine qui o clicca per caricare","node.content.dropMedia":"Trascina video o audio qui","node.content.processing":"Elaborazione...","node.content.processingChain":"Elaborazione Catena...","node.content.metadataPrompt":"Prompt da Metadati Immagine:","node.content.metadataPromptPlaceholder":"Nessun prompt trovato nell'immagine.","node.content.copyPrompt":"Usa","node.content.prompt":"Prompt","node.content.inputPrompt":"Prompt di Input","node.content.enhancedResult":"Risultato Migliorato","node.content.videoPrompt":"Prompt Video","node.content.editPromptPlaceholder":"Aggiungi o modifica il prompt...","node.content.enhancedPromptHere":"Il prompt migliorato apparir qui...","node.content.safePrompt":"Sicuro per uso commerciale","node.content.generating":"Generazione...","node.content.imageHere":"L'immagine apparir qui","node.content.generationMode":"Modello di Generazione","node.content.aspectRatio":"Proporzioni","node.content.aspectRatioHelp":"Imposta le proporzioni per la generazione dell'immagine","node.content.aspectRatioNotSupportedFast":"Proporzioni disponibili solo per modelli Imagen.","node.content.enableAspectRatioFormatting":"Abilita Formattazione Proporzioni","node.content.autoDownload":"Auto Download","node.content.generateImage":"Genera Immagine","node.content.enhancing":"Miglioramento...","node.content.enhancePrompt":"Migliora Prompt","node.content.sanitizing":"Sanitizzazione...","node.content.sanitizedPromptHere":"Il prompt sanitizzato apparir qui...","node.content.analyzing":"Analisi...","node.content.analyzePrompt":"Analizza Prompt","node.content.analyzeImage":"Analizza Immagine","node.content.imageToText":"Immagine a Testo","node.content.updatePromptFromImage":"Aggiorna prompt da immagine","node.content.analyzeCharacter":"Analizza Personaggio","node.content.generateCharacters":"Genera Personaggi","node.content.characterPromptPlaceholder":"Descrivi il/i personaggio/i da generare...","node.content.character":"Personaggio","node.content.clothing":"Abbigliamento","node.content.characterPlaceholder":"La descrizione del personaggio apparir qui...","node.content.clothingPlaceholder":"La descrizione dell'abbigliamento apparir qui...","node.content.appearance":"Aspetto","node.content.personality":"Personalit","node.content.environment":"Ambiente/Setting","node.content.action":"Azione","node.content.emotion":"Emozione","node.content.style":"Stile","node.content.environmentPlaceholder":"Descrizione dettagliata dell'ambiente...","node.content.charactersPlaceholder":"Lista dei personaggi principali...","node.content.characters":"Personaggi","node.content.characterConcepts":"Concetti Personaggio","node.content.actionPlaceholder":"Descrizione dell'azione...","node.content.emotionPlaceholder":"Descrizione dell'emozione...","node.content.stylePlaceholder":"Descrizione dello stile artistico...","node.content.descriptionHere":"La descrizione apparir qui...","node.content.enableOutpainting":"Abilita Outpainting","node.content.outpaintingPromptPlaceholder":"Prompt Outpainting...","node.content.inputImage":"Immagini di Input","node.content.dropOrClick":"Trascina o Clicca","node.content.outputImage":"Immagine di Output","node.content.applyEdit":"Applica Modifica","node.content.editing":"Modifica...","node.content.chatPlaceholder":"Scrivi il tuo messaggio...","node.content.connectedPlaceholder":"Connesso al nodo, modifica nella sorgente.","node.content.connectedNode":"Connesso via nodo","node.content.connectedEmpty":"Il nodo connesso non ha immagini.","node.content.translatePlaceholder":"Testo da tradurre...","node.content.translatedTextPlaceholder":"Testo tradotto...","node.content.targetLanguage":"Lingua di Destinazione","node.content.translate":"Traduci","node.content.translating":"Traduzione...","node.content.scriptPromptPlaceholder":"Inserisci un'idea per la storia o trama...","node.content.generateScript":"Genera Sceneggiatura","node.content.loadScript":"Carica File Sceneggiatura","node.content.summary":"Riepilogo","node.content.scenes":"Scene","node.content.unrecognizedFormat":"Formato sceneggiatura non riconosciuto.","node.content.frames":"Fotogrammi","node.content.characterIndex":"Indice","node.content.readData":"Leggi Dati","node.content.textDataHere":"I dati di testo appariranno qui.","node.content.noDataRead":'Connetti un nodo e clicca "Leggi Dati" per visualizzarne il contenuto.',"node.content.previewError":"Errore Anteprima","node.content.previewPlaceholder":"L'anteprima apparir qui","node.content.imagePrompt":"Prompt Immagine","node.output.allPromptData":"Tutti i Dati Prompt","node.note.tab.note":"Nota","node.note.tab.references":"Riferimenti","node.note.nestedImages":"Immagini Nidificate","node.note.dropPlaceholder":"Trascina immagini o clicca per aggiungere","node.note.addCaption":"Didascalia","node.note.action.shuffle":"Mescola","node.note.action.undoShuffle":"Annulla Mescolamento","node.content.characterTypeShort":"Tipo:","node.content.numberOfCharactersShort":"Qt:","node.content.characterType.simple":"Semplice","node.content.characterType.anthro":"Antro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Oggetto Chiave","node.content.style.simple":"Semplice","node.content.style.realistic":"Realistico","node.content.style.3d_cartoon":"Cartone 3D","node.content.style.3d_realistic":"3D Realistico","node.content.style.2d_animation":"Animazione 2D","node.content.style.anime":"Anime","node.content.style.comics":"Fumetti","node.content.style.custom":"Personalizzato","node.content.fullDescriptionTitle":"Descrizione completa del personaggio","node.content.integrationInstruction":"Istruzione di integrazione","node.content.additionalPromptSuffix":"Prompt Aggiuntivo (Suffisso)","image_sequence.auto_crop":"Ritaglio Auto 16:9","image_sequence.create_zip":"Crea Archivio ZIP","node.content.modificationRequest":"Richiesta di modifica","node.content.technicalPrompt":"Prompt Tecnico","node.promptProcessor.safePromptTooltip":"Riscrive il prompt per rispettare le linee guida di sicurezza ed evitare violazioni delle norme.","node.promptProcessor.technicalPromptTooltip":"Converte il prompt in una specifica tecnica altamente dettagliata (illuminazione, camera, impostazioni di rendering).","node.promptProcessor.enhanceTooltip":"Usa l'IA per espandere e arricchire il prompt con dettagli descrittivi.","node.promptProcessor.chainTooltip":"Esegue questo nodo e innesca tutti i nodi connessi a valle.","image_sequence.tooltip.autoCrop":"Ritaglia automaticamente le immagini generate in rapporto 16:9.","image_sequence.tooltip.autoDownload":"Salva automaticamente ogni immagine sul dispositivo dopo la generazione.","image_sequence.tooltip.createZip":"Raggruppa tutte le immagini selezionate in un unico archivio ZIP per il download."},Gb={"imageEditor.title":"Editor Immagini","imageEditor.canvasResolution":"Risoluzione Tela","imageEditor.background":"Sfondo","imageEditor.toolSettings":"Impostazioni Strumento","imageEditor.snapToEdges":"Aggancia ai Bordi","imageEditor.freeAspect":"Proporzioni Libere","imageEditor.section.aiRequest":"Richiesta Modifica IA","imageEditor.input.modificationPlaceholder":'Descrivi le modifiche, es. "cambia sfondo in blu"',"imageEditor.action.sendRequest":"Invia Richiesta","imageEditor.tooltip.removeObject":"Rimuovi (Rosso) / Mantieni (Verde)","imageEditor.action.removeObject":"Rimuovi Oggetto","imageEditor.tool.transform":"Trasforma","imageEditor.tool.hand":"Mano (Pan)","imageEditor.tool.zoom":"Zoom","imageEditor.tool.pencil":"Matita","imageEditor.tool.rectangle":"Rettangolo","imageEditor.action.fit":"Adatta alla Tela","imageEditor.action.fill":"Riempi Tela","imageEditor.action.cancel":"Annulla","imageEditor.action.resetEdits":"Resetta Modifiche","imageEditor.action.apply":"Applica","imageViewer.title":"Visualizzatore Immagini","imageEditor.outputResolution":"Risoluzione Output","imageEditor.outputResolutionHelp":'Imposta risoluzione output. Se "Auto", usa la risoluzione della tela.',"imageEditor.currentSize":"Dimensione Attuale: {width}x{height}","imageEditor.sequenceMode":"Modalit Sequenza","imageEditor.sequenceModeHelp":"Elabora le immagini di input da Input A in sequenza.","imageEditor.sequentialCombination":"Combinazione Sequenziale Immagini","imageEditor.sequentialCombinationHelp":"Per ogni fotogramma: Invia immagine Input A corrente + Tutte le immagini Input B.","imageEditor.sequentialPrompt":"Combinazione Sequenziale Prompt","imageEditor.sequentialPromptHelp":"Per ogni fotogramma: Usa un prompt unico dalla lista + immagine corrente.","imageEditor.sequentialEditingWithPrompts":"Modifica Sequenziale con Prompt","imageEditor.sequentialEditingWithPromptsHelp":"Per ogni fotogramma: Usa immagine Input B + prompt unico. Input A ignorato.","imageEditor.input":"Input","imageEditor.inputA":"Input A","imageEditor.inputB":"Input B","imageEditor.status.queued":"In Coda","imageEditor.status.generating":"Generazione...","imageEditor.action.regenerate":"Rigenera","imageEditor.tooltip.fit":"Adatta immagine ai bordi della tela (contain).","imageEditor.tooltip.fill":"Scala immagine per riempire la tela (cover).","imageEditor.tooltip.flip":"Ribalta immagine orizzontalmente.","imageEditor.background.white":"Bianco","imageEditor.background.gray":"Grigio","imageEditor.background.black":"Nero","imageEditor.background.dark":"Scuro","image_sequence.regenerate":"Rigenera","image_sequence.stop_queue":"Ferma Coda","image_sequence.move_up":"Sposta Su","image_sequence.move_down":"Sposta Gi","image_sequence.copy_prompt":"Copia Prompt","image_sequence.add_frame":"Aggiungi Fotogramma","image_sequence.delete_frame":"Elimina Fotogramma","image_sequence.expand_all_frames":"Espandi/Comprimi Tutti i Fotogrammi","image_sequence.collapse_all_frames":"Comprimi Tutti i Fotogrammi","image_sequence.expand_all_scenes":"Espandi/Comprimi Tutte le Scene","image_sequence.collapse_all_scenes":"Comprimi Tutte le Scene","image_sequence.expand_all":"Espandi Tutto","image_sequence.collapse_all":"Comprimi Tutto","image_sequence.clear_all_prompts":"Pulisci Tutti i Prompt","image_sequence.add_first_frame":"Aggiungi Primo Fotogramma","image_sequence.drop_or_add_title":"Trascina JSON Sequenza o Aggiungi Fotogramma","image_sequence.drop_or_add_desc":"Trascina un file JSON qui o clicca per aggiungere un fotogramma manualmente.","image_sequence.load_prompts":"Carica Prompt","image_sequence.output_images_title":"Immagini Output","image_sequence.prompts_list_title":"Prompt Sorgente","image_sequence.download_selected":"Scarica Selezionati","image_sequence.select_all":"Seleziona Tutto","image_sequence.select_none":"Deseleziona Tutto","image_sequence.invert_selection":"Inverti Selezione","image_sequence.run_selected":"Esegui Selezionati","image_sequence.start_queue":"Avvia Coda","image_sequence.character_prompt_combination":"Combinazione Prompt Personaggio","image_sequence.combination_none":"Nessuna","image_sequence.combination_combine":"Combina","image_sequence.combination_replace":"Sostituisci Tag","image_sequence.status.error":"Erro","image_sequence.status.pending":"In Coda","image_sequence.clear_selected_prompts":"Pulisci Prompt Selezionati","image_sequence.range_from":"Da:","image_sequence.range_to":"A:","image_sequence.stats.total":"Totale Fotogrammi: {count}","image_sequence.stats.generated":"Generati: {count}","image_sequence.stats.queue":"Coda: {count}","image_sequence.edit_in_source":"Modifica in Sorgente","image_sequence.edit_prompt":"Modifica Prompt","image_sequence.select_scene":"Seleziona Scena","image_sequence.next_scene":"Scena Successiva","image_sequence.prev_scene":"Scena Precedente","image_sequence.scene_input_label":"Scena","image_sequence.select_square":"Seleziona Quadrato (1:1)","image_sequence.select_landscape":"Seleziona Paesaggio (16:9)","image_sequence.select_portrait":"Seleziona Ritratto (9:16)","image_sequence.select_range":"Seleziona Intervallo","image_sequence.force_refresh":"Forza Aggiornamento","image_sequence.select_scene_frames":"Seleziona tutti i fotogrammi in questa scena","image_sequence.collapse_other_scenes":"Comprimi altre scene","prompt_sequence_editor.instructionPlaceholder":"Inserisci istruzione per modificare i prompt...","prompt_sequence_editor.modifying":"Modifica in corso...","prompt_sequence_editor.modifySelected":"Modifica Selezionati ({count})","prompt_sequence_editor.sourcePrompts":"Prompt Sorgente","prompt_sequence_editor.finalPrompts":"Prompt Modificati","prompt_sequence_editor.error.invalidInput":"Formato dati non valido. Connetti un array di sequenza prompt.","geminiChat.mode.general":"Generale","geminiChat.mode.prompt":"Esperto Prompt","geminiChat.mode.script":"Sceneggiatore","geminiChat.mode.youtube":"Analista YouTube","image_sequence.shot_type.WS":"Integra l'Entit con un Campo Lungo (WS) nella scena e nell'azione. Mostra l'ambiente.","image_sequence.shot_type.MS":"Integra l'Entit con un Piano Medio (MS) nella scena. Personaggio dalla vita in su.","image_sequence.shot_type.CU":"Integra l'Entit con un Primo Piano (CU) nella scena.","image_sequence.shot_type.ECU":"Integra l'Entit con un Primissimo Piano (ECU) nella scena. Massimo dettaglio.","image_sequence.shot_type.LS":"Integra l'Entit con un Piano Totale (LS) nella scena per mostrare la scala."},Ub={"dialog.permission.title":"Permesso Richiesto","dialog.permission.description":"Questa app necessita del permesso di leggere gli appunti per incollare contenuti nei nodi. I tuoi dati non vengono memorizzati o inviati da nessuna parte.","dialog.permission.allow":"Consenti","dialog.permission.decline":"Rifiuta","dialog.rename.title":"Rinomina Elemento","dialog.rename.group.title":"Rinomina Gruppo","dialog.rename.catalog.title":"Rinomina Elemento Catalogo","dialog.rename.node.title":"Rinomina Nodo","dialog.rename.label":"Nuovo Nome:","dialog.rename.confirm":"Rinomina","dialog.rename.cancel":"Annulla","dialog.promptEdit.title":"Modifica Prompt","dialog.promptEdit.nameLabel":"Nome:","dialog.promptEdit.contentLabel":"Contenuto:","dialog.promptEdit.confirm":"Salva","dialog.promptEdit.cancel":"Annulla","dialog.confirmDelete.title":"Conferma Eliminazione","dialog.confirmDelete.message":"Sei sicuro di voler eliminare questo elemento? Questa azione non pu essere annullata.","dialog.confirmDelete.confirm":"Elimina","dialog.confirmDelete.cancel":"Annulla","dialog.confirmCloseTab.title":"Chiudi Scheda","dialog.confirmCloseTab.message":'Sei sicuro di voler chiudere la scheda "{tabName}"? Le modifiche non salvate andranno perse.',"dialog.confirmClear.title":"Pulisci Tela","dialog.confirmClear.message":"Sei sicuro di voler pulire l'intera tela? Questa azione non pu essere annullata.","dialog.confirmReset.title":"Resetta a Default","dialog.confirmReset.message":"Sei sicuro di voler resettare la tela allo stato predefinito? Tutto il lavoro corrente andr perso.","dialog.confirmReset.confirm":"Resetta","dialog.confirmLoad.title":"Conferma Caricamento","dialog.confirmLoad.message":"Caricare un nuovo file sostituir il contenuto corrente. Eventuali modifiche non salvate andranno perse. Continuare?","dialog.apiKey.title":"Seleziona Chiave API","dialog.apiKey.description":`Questa funzionalit richiede una chiave API di Progetto con l'API "AI Platform" abilitata. La generazione video pu richiedere alcuni minuti.`,"dialog.apiKey.billingLink":"Scopri di pi sulla fatturazione","dialog.apiKey.button":"Seleziona Chiave API","dialog.settings.title":"Impostazioni","dialog.settings.apiKeyLabel":"La tua Chiave API Google Gemini:","dialog.settings.useDevKeyLabel":"Usa chiave API gratuita (per sviluppo)","dialog.settings.instantNodeCloseLabel":"Chiusura istantanea nodi","dialog.settings.nodeAnimationLabel":"Animazione Aggiunta Nodo","dialog.settings.animationModeLabel":"Modalit Animazione Creazione","dialog.settings.anim.pulse":"Impulso","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"Nessuna","dialog.settings.description":"Per usare le tue quote e accedere a modelli specifici, inserisci la tua chiave API personale. La chiave  salvata localmente nel tuo browser.","dialog.settings.getKeyLink":"Ottieni una Chiave API qui","dialog.settings.save":"Salva","dialog.deleteNode.title":"Chiudere nodo?","dialog.deleteNode.titlePlural":"Chiudere nodi?","dialog.deleteNode.confirm":"S","dialog.deleteNode.cancel":"No","dialog.deleteNode.confirmTooltip":"Chiudi nodo - i dati persi non possono essere recuperati","dialog.deleteNode.cancelTooltip":"Non chiudere - continua a lavorare con il nodo","dialog.deleteNode.dontShowAgain":"Non mostrare pi","dialog.exitApp.title":"Chiudere il Progetto?","dialog.exitApp.message":"Sei sicuro di voler chiudere il progetto? Tutto il lavoro corrente andr perso e la tela verr resettata."},Vb={"group.button.create":"Crea Gruppo ({count})","group.rename":"Rinomina Gruppo","group.saveToCatalog":"Salva nel Catalogo","group.saveToDisk":"Salva su Disco","group.ungroup":"Separa (Shift+Click per eliminare con contenuto)","group.duplicate":"Duplica gruppo con contenuto","catalog.tabs.groups":"Gruppi","catalog.tabs.library":"Libreria","catalog.tabs.characters":"Personaggi","catalog.tabs.scripts":"Sceneggiature","catalog.tabs.sequences":"Sequenze","catalog.back":"Indietro","catalog.load":"Carica da File","catalog.newFolder":"Nuova Cartella","catalog.saveTo":"Salva nel Catalogo","catalog.card.addToCanvas":"Aggiungi alla Tela","catalog.card.rename":"Rinomina","catalog.card.save":"Salva","catalog.card.delete":"Elimina","catalog.empty.description":"Questa cartella  vuota. Puoi aggiungere elementi o creare nuove cartelle.","library.loadFromFile":"Carica","library.actions.newFolder":"Nuova Cartella","library.actions.newPrompt":"Nuovo Prompt","library.actions.copy":"Copia","library.actions.edit":"Modifica","library.empty.title":"Cartella Vuota","library.empty.description":"Crea prompt e cartelle per iniziare.","library.emptyPrompt":"Prompt vuoto"},Wb={...Fb,...Bb,...Hb,...Gb,...Ub,...Vb},$b={"app.title":"Modificador de Prompt","app.subtitle":"Conecte ideias para criar uma obra-prima","app.error.title":"Notificao","app.error.copy":"Copiar Mensagem","app.error.copied":"Copiado!","error.apiKey":"Sua chave API  invlida ou no tem permisses. Por favor, selecione uma chave API vlida.","error.scriptModifierCanvas":"Esta tela pertence a outra aplicao - Script Modifier. Por favor, use o Script Modifier para abrir este arquivo.","welcome.title":"Bem-vindo ao","welcome.description":"Bem-vindo ao Modificador de Prompt. Conecte ideias para criar obras-primas. Use ns para gerar e editar contedo.","welcome.apiKeyLabel":"Sua Chave API Google Gemini","welcome.apiKeyPlaceholder":"Insira sua chave API aqui...","welcome.apiKeyHelp":"Sua chave API  armazenada localmente.","welcome.getKeyLink":"Obter Chave API","welcome.iAmDeveloper":"Sou Desenvolvedor","welcome.letsGo":"Vamos l","welcome.resume":"Continuar","welcome.startNew":"Nova Tela","welcome.freeModeActive":"Modo Gratuito Ativo","welcome.selectLanguage":"Selecione seu idioma principal","welcome.navHint":"Use as teclas do teclado  e  para mudar o idioma","toast.contentCleared":"Contedo limpo","toast.downloadStarted":"Download iniciado","toast.characterLoaded":"Carto de personagem carregado","toast.characterSavedDisk":"Carto de personagem salvo no disco","toast.copiedToClipboard":"Copiado para a rea de transferncia","toast.pastedFromClipboard":"Colado da rea de transferncia","toast.pasteFailed":"Falha ao colar","toast.nodeDuplicated":"N duplicado","toast.groupSavedToDisk":'Grupo "{groupTitle}" salvo no disco',"toast.groupDeleted":"Grupo e contedo excludos","toast.characterSavedCatalog":"Personagem salvo no catlogo","toast.promptSaved":"Prompt salvo na biblioteca: {promptName}...","toast.connectionsCut":"Conexes removidas","toast.apiKeySaved":"Chave API salva com sucesso","toast.cacheCleared":"Limpos {count} itens no utilizados do cache","toast.cacheEmpty":"Cache j est otimizado","toast.scriptSaved":"Roteiro salvo no disco","alert.groupSaved":'Grupo "{groupTitle}" salvo no catlogo.',"alert.loadCatalogFailed":"Falha ao carregar arquivo de catlogo","alert.invalidCatalogFile":"Formato de arquivo de catlogo invlido","alert.fileNotSupported":'Arquivo no suportado. "appName" ausente ou incorreto.',"alert.invalidCatalogStructure":'Estrutura de catlogo invlida. "root" ausente.',"tutorial.step1":"Clique aqui para adicionar uma palavra aleatria ao prompt.","tutorial.step2":'Clique em "Melhorar Prompt" para combinar entradas usando IA.',"tutorial.step2_waiting":"A IA est analisando suas entradas e gerando um prompt mais rico...","tutorial.step3":"Finalmente, clique aqui para gerar a imagem.","tutorial.step3b":"A gerao leva algum tempo. Voc pode monitorar o progresso aqui.","tutorial.step4":"Voc pode adicionar novos ns manualmente a partir desta barra de ferramentas.","tutorial.group.catalog":"Use o Catlogo para buscar ns ou gerenciar grupos.","tutorial.group.general":"Adicione Notas Adesivas e Leitores de Dados para depurao.","tutorial.group.input":"Entradas bsicas para texto, imagens e sequncias.","tutorial.group.processing":"Analise e processe prompts ou imagens com IA.","tutorial.group.character":"Crie, analise e armazene personagens detalhados.","tutorial.group.output":"Exiba resultados e gere sequncias.","tutorial.group.ai":"Converse com Gemini e traduza textos.","tutorial.group.video":"Ferramentas para prompts de vdeo e edio.","tutorial.group.scripts":"Gere e visualize roteiros para histrias complexas.","tutorial.group.file":"Salve seu trabalho, carregue projetos ou baixe a tela.","tutorial.success.title":"Tutorial Concludo!","tutorial.success.message":"Voc aprendeu com sucesso o bsico do Modificador de Prompt. Boa sorte criando obras-primas!","tutorial.success.button":"Comear a Criar","tutorial.skip":"Pular","tutorial.next":"Prximo","tutorial.finish":"Entendi"},Kb={"toolbar.settings":"Configuraes","toolbar.resetCanvas":"Redefinir Tela","toolbar.clearCache":"Limpar Cache No Usado","toolbar.home":"Incio","toolbar.edit":"Editar (V)","toolbar.cutter":"Cortar Conexo (C) / (Segure Ctrl)","toolbar.selection":"Seleo (S) / (Segure Shift)","toolbar.reroute":"Redirecionar (R) / (Segure Ctrl+Alt)","toolbar.zoom":"Zoom (Segure Z)","toolbar.snapToGrid":"Alinhar  Grade","toolbar.smartGuides":"Guias Inteligentes","toolbar.lineStyleSpaghetti":"Linhas Spaghetti","toolbar.lineStyleOrthogonal":"Linhas Ortogonais","toolbar.resetZoom":"Redefinir Zoom","toolbar.resetCamera":"Redefinir Posio da Cmera","toolbar.clearCanvas":"Limpar Tela","toolbar.addNode":"Adicionar N (F)","toolbar.catalog":"Abrir Catlogo (Ctrl + Espao)","toolbar.addNote":"Adicionar Nota (N)","toolbar.addDataReader":"Adicionar Leitor de Dados (Shift + R)","toolbar.addTextInput":"Adicionar Entrada de Texto (T)","toolbar.addImageInput":"Adicionar Entrada de Imagem (I)","toolbar.addPromptSequenceEditor":"Adicionar Editor de Sequncia de Prompt (Q)","toolbar.addImageAnalyzer":"Adicionar Analisador de Imagem (Shift+A)","toolbar.addPromptAnalyzer":"Adicionar Analisador de Prompt (A)","toolbar.addPromptProcessor":"Adicionar Processador de Prompt (P)","toolbar.addCharacterGenerator":"Adicionar Gerador de Personagem (Shift+C)","toolbar.addCharacterAnalyzer":"Adicionar Analisador de Personagem (Ctrl+Shift+A)","toolbar.addCharacterCard":"Adicionar Carto de Personagem (Ctrl+Shift+C)","toolbar.addImageOutput":"Adicionar Sada de Imagem (O)","toolbar.addImageEditor":"Adicionar Editor de Imagem IA (Shift+I)","toolbar.addImageSequenceGenerator":"Adicionar Gerador de Sequncia de Imagem (Shift+Q)","toolbar.addTranslator":"Adicionar Tradutor (L)","toolbar.addGeminiChat":"Adicionar Chat Gemini (M)","toolbar.addVideoPromptProcessor":"Adicionar Processador de Prompt de Vdeo (Shift+P)","toolbar.addVideoOutput":"Adicionar Sada de Vdeo (Shift+O)","toolbar.addScriptGenerator":"Adicionar Gerador de Roteiro","toolbar.addScriptViewer":"Adicionar Visualizador de Roteiro (Shift + V)","toolbar.saveCanvas":"Salvar Tela (Ctrl + S)","toolbar.saveProject":"Salvar Projeto","toolbar.loadCanvas":"Carregar Projeto/Tela (Ctrl + O)","toolbar.group.general":"Geral","toolbar.group.catalog":"Catlogo","toolbar.group.input":"Entrada","toolbar.group.processing":"Processamento","toolbar.group.character":"Personagem","toolbar.group.output":"Sada","toolbar.group.aiTools":"Ferramentas IA","toolbar.group.video":"Vdeo","toolbar.group.scripts":"Roteiros","toolbar.group.file":"Arquivo","toolbar.title":"Barra de Ferramentas","toolbar.dock":"Ancorar Barra","toolbar.detach":"Desancorar Barra","toolbar.expandPanel":"Expandir Painel","toolbar.collapsePanel":"Recolher Painel","toolbar.dockArea.title":"Ancorar Barra Aqui","toolbar.duplicate":"Duplicar N","toolbar.duplicateWithContent":"Duplicar com Contedo","toolbar.dock.q1":"Esq 1 Qrt","toolbar.dock.q2":"Esq 2 Qrt","toolbar.dock.q3":"Dir 3 Qrt","toolbar.dock.q4":"Dir 4 Qrt","toolbar.dock.tl":"Topo Esquerda","toolbar.dock.bl":"Fundo Esquerda","toolbar.dock.tr":"Topo Direita","toolbar.dock.br":"Fundo Direita","toolbar.dock.left":"Metade Esquerda","toolbar.dock.right":"Metade Direita","toolbar.dock.full":"Tela Cheia","toolbar.dock.exitFull":"Sair Tela Cheia","toolbar.dock.fullFocus":"Foco Tela Cheia","hotkeys.show":"Mostrar Atalhos","hotkeys.tools.title":"Ferramentas","hotkeys.tools.edit":"Modo Edio","hotkeys.tools.cutter":"Ferramenta de Corte","hotkeys.tools.selection":"Ferramenta de Seleo","hotkeys.tools.reroute":"Ferramenta de Redirecionamento","hotkeys.tools.zoom":"Ferramenta de Zoom","hotkeys.tools.toggleLineStyle":"Alternar Estilo de Linha","hotkeys.tools.group":"Seleo de Grupo","hotkeys.tools.closeNode":"Excluir Selecionados","hotkeys.tools.duplicate":"Duplicar N","hotkeys.tools.duplicateWithContent":"Duplicar com Contedo","hotkeys.tools.deleteGroup":"Excluir Grupo (Shift+Clique)","hotkeys.windows.title":"Janelas","hotkeys.windows.search":"Busca Rpida","hotkeys.windows.catalog":"Catlogo","hotkeys.createNode.title":"Criar N","help.panelTitle":"Ajuda e Atalhos","help.title":"Atalhos de Teclado","help.howToUse.title":"Como Usar","help.howToUse.content":"Bem-vindo ao Modificador de Prompt! Use a barra de ferramentas ou atalhos para adicionar ns. Conecte ns para passar dados. Use a ferramenta Editar para mover ns e a tela. Clique duas vezes no espao vazio para abrir o menu de adio rpida. Clique com o boto direito para o menu de contexto.","help.author":"Autor","contextMenu.undoPosition":"Desfazer Posio","contextMenu.redoPosition":"Refazer Posio","contextMenu.align.left":"Alinhar  Esquerda (F)","contextMenu.align.centerX":"Alinhar Centro X (E)","contextMenu.align.right":"Alinhar  Direita (R)","contextMenu.align.top":"Alinhar ao Topo (T)","contextMenu.align.centerY":"Alinhar Centro Y (D)","contextMenu.align.bottom":"Alinhar ao Fundo (B)","contextMenu.distribute.horizontal":"Distribuir Horiz. (Ctrl+D)","contextMenu.distribute.vertical":"Distribuir Vert. (Ctrl+E)","contextMenu.emptySlot":"Slot Vazio (Clique Dir. para atribuir)","contextMenu.saveSlots":"Salvar Config. Slots","contextMenu.loadSlots":"Carregar Config. Slots","quickadd.title":"Adio Rpida","quickadd.group.tools":"Ferramentas","quickadd.group.inputs":"Entradas","quickadd.group.processing":"Processamento","quickadd.group.character":"Personagem","quickadd.group.outputs":"Sadas","quickadd.group.ai":"Ferramentas IA","quickadd.group.video":"Vdeo","quickadd.group.scripts":"Roteiros","quickadd.group.general":"Geral","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"Editar","quickadd.tool.cutter":"Cortar","quickadd.tool.selection":"Seleo","search.placeholder":"Buscar um n para adicionar...","search.noResults":"Nenhum n encontrado.","search.group.input":"Entrada & Bsico","search.group.process":"Processamento & Personagem","search.group.output":"Imagem & Sequncia","search.group.ai":"Ferramentas IA","search.group.video":"Vdeo & Script","search.group.scripts":"Roteiros","toolbar.exitApp":"Fechar Projeto"},Jb={"node.title.text_input":"Entrada de Texto","node.title.image_input":"Entrada de Imagem","node.title.prompt_processor":"Processador de Prompt","node.title.prompt_sanitizer":"Higienizador de Prompt","node.title.video_prompt_processor":"Proc. Prompt Vdeo","node.title.image_output":"Sada de Imagem","node.title.video_output":"Sada de Vdeo","node.title.prompt_analyzer":"Analisador de Prompt","node.title.character_analyzer":"Analisador de Personagem","node.title.character_generator":"Gerador de Personagem","node.title.character_card":"Carto de Personagem","node.title.image_analyzer":"Analisador de Imagem","node.title.image_editor":"Editor de Imagem IA","node.title.image_sequence_generator":"Gerador de Sequncia de Imagem","node.title.prompt_sequence_editor":"Editor de Sequncia de Prompt","node.title.gemini_chat":"Chat Gemini","node.title.translator":"Tradutor","node.title.script_generator":"Gerador de Roteiro","node.title.script_viewer":"Visualizador de Roteiro","node.title.note":"Nota","node.title.reroute_dot":"Ponto de Redirecionamento","node.title.data_reader":"Leitor de Dados","node.title.video_editor":"Editor de Vdeo Alpha","node.title.media_viewer":"Visualizador de Mdia","node.title.data_protection":"Proteo de Dados","node.title.pose_creator":"Pose Creator","node.help.text_input":"Um campo de texto simples de vrias linhas para inserir prompts ou notas.","node.help.image_input":"Permite enviar ou colar uma imagem para usar como entrada em outros ns.","node.help.prompt_processor":"Combina vrias entradas de texto em um nico prompt aprimorado usando IA.","node.help.prompt_sanitizer":"Reescreve o prompt de entrada para ser mais seguro para polticas de gerao de imagem, preservando a inteno artstica.","node.help.video_prompt_processor":"Processador especializado para criar prompts detalhados de gerao de vdeo.","node.help.image_output":"Exibe o resultado da gerao de imagem. Suporta download e visualizao.","node.help.video_output":"Exibe o resultado da gerao de vdeo usando o modelo Veo.","node.help.prompt_analyzer":"Desconstri um prompt em componentes como assunto, estilo e ambiente.","node.help.character_analyzer":"Analisa uma descrio de personagem e a divide em aparncia e roupas.","node.help.character_generator":"Gera descries detalhadas de personagens com base em um prompt corto.","node.help.character_card":"Armazena dados completos do personagem, incluindo imagem e descrio.","node.help.image_analyzer":"Usa IA para descrever o contedo de uma imagem de entrada.","node.help.image_editor":"Ferramenta avanada para editar imagens usando prompts de texto e inpainting/outpainting.","node.help.image_sequence_generator":"Gera uma sequncia de imagens com base em uma lista de prompts.","node.help.prompt_sequence_editor":"Permite edio em massa de sequncias de prompts usando instrues de IA.","node.help.gemini_chat":"Uma interface de chat de uso geral com Gemini para brainstorming ou assistncia.","node.help.translator":"Traduz texto entre idiomas usando modelos de IA.","node.help.script_generator":"Gera um roteiro estruturado (cenas, personagens) a partir de uma ideia de histria.","node.help.script_viewer":"Visualiza e gerencia dados de roteiro para gerao quadro a quadro.","node.help.note":"Uma nota adesiva para adicionar comentrios ou instrues  tela.","node.help.reroute_dot":"Um pequeno ponto usado para organizar conexes e criar layouts mais limpos.","node.help.data_reader":"Ferramenta de depurao para inspecionar os data brutos que fluem pelas conexes.","node.help.video_editor":"Uma ferramenta baseada em linha do tempo para editar videoclipes e imagens.","node.help.media_viewer":"Um player para visualizar arquivos de vdeo e udio com controles de reproduo.","node.help.data_protection":"Um n de mini-jogo interativo de defesa de torre. Defenda seu fluxo de dados contra corrupo.","node.help.pose_creator":"Visual rig to define and generate character poses for consistency.","node.action.expand":"Expandir","node.action.collapse":"Recolher","node.action.help":"Ajuda","node.action.download":"Baixar","node.action.clear":"Limpar Contedo","node.action.refreshChat":"Limpar e Reiniciar Chat","node.action.paste":"Colar","node.action.resetEditor":"Redefinir Editor","node.action.saveCharacter":"Salvar Carto","node.action.loadCharacter":"Carregar Carto","node.action.copy":"Copiar","node.action.copyImage":"Copiar Imagem","node.action.copyTextPrompt":"Copiar Prompt","node.action.copyImagePrompt":"Copiar Prompt de Imagem","node.action.copyVideoPrompt":"Copiar Prompt de Vdeo","node.action.cutConnections":"Cortar Conexes","node.action.close":"Fechar","node.action.closeNode":"Fechar N (Shift+Clique para fechar instantaneamente)","node.action.closeNodeSimple":"Fechar N","node.action.randomWord":"Adicionar Palavra Aleatria","node.action.processImage":"Remover Marcas d'gua","node.action.processImageTitle":"Usa Gemini para remover marcas d'gua e texto da imagem.","node.action.editor":"Editor","node.action.rasterEditor":"Editor Raster","node.action.openInAIEditor":"Abrir no Editor IA","node.action.openInAnalyzer":"Abrir no Analisador","node.action.outputToInput":"Usar Sada como Entrada","node.action.processChainForward":"Processar Adiante","node.action.executeChain":"Executar Cadeia","node.action.executeChainTitle":"Executar todos os ns a montante para gerar o resultado final.","node.action.sanitize":"Higienizar","node.action.rename":"Renomear","node.action.stop":"Parar","node.action.stopping":"Parando...","node.action.deleteItem":"Excluir Item","node.action.detachAndPaste":"Desanexar e Colar","node.action.delete":"Excluir","node.action.flipImage":"Virar Imagem","node.action.pin":"Fixar N no Topo","node.action.unpin":"Desafixar N","node.action.updateDescription":"Atualizar Descrio","node.action.modifyCharacter":"Solicitar Mudanas","node.action.updateDataFormat":"Atualizar Formato de Dados","node.action.expand169":"Expandir para 16:9","node.action.expand916":"Expandir para 9:16","node.action.sync":"Sincronizar das Conexes","node.action.expandRatio":"Expandir Proporo","node.action.markPrimary":"Marcar como Primrio","node.action.addCard":"Adicionar Carto","node.action.removeCard":"Remover Carto","node.action.showOutputs":"Mostrar Sadas","node.action.hideOutputs":"Ocultar Sadas","node.mediaViewer.play":"Reproduzir","node.mediaViewer.pause":"Pausa","node.mediaViewer.stop":"Parar","node.mediaViewer.addMarker":"Adicionar Marcador","node.mediaViewer.exportSRT":"Exportar Marcadores (SRT)","node.mediaViewer.deleteAllMarkers":"Excluir Todos os Marcadores","node.mediaViewer.saveMarkers":"Salvar Marcadores no Disco","node.mediaViewer.loadMarkers":"Carregar Marcadores do Disco","node.mediaViewer.relink":"Revincular Arquivo","node.content.notePlaceholder":"Digite suas notas aqui...","node.content.dropImage":"Solte a imagem aqui ou clique para enviar","node.content.dropMedia":"Solte vdeo ou udio aqui","node.content.processing":"Processando...","node.content.processingChain":"Processando Cadeia...","node.content.metadataPrompt":"Prompt dos Metadados da Imagem:","node.content.metadataPromptPlaceholder":"Nenhum prompt encontrado na imagem.","node.content.copyPrompt":"Usar","node.content.prompt":"Prompt","node.content.inputPrompt":"Prompt de Entrada","node.content.enhancedResult":"Resultado Aprimorado","node.content.videoPrompt":"Prompt de Vdeo","node.content.editPromptPlaceholder":"Adicione ou edite o prompt...","node.content.enhancedPromptHere":"O prompt aprimorado aparecer aqui...","node.content.safePrompt":"Seguro para uso comercial","node.content.generating":"Gerando...","node.content.imageHere":"A imagem aparecer aqui","node.content.generationMode":"Modelo de Gerao","node.content.aspectRatio":"Proporo","node.content.aspectRatioHelp":"Definir proporo para gerao de imagem","node.content.aspectRatioNotSupportedFast":"Proporo disponvel apenas para modelos Imagen.","node.content.enableAspectRatioFormatting":"Habilitar Formatao de Proporo","node.content.autoDownload":"Download Automtico","node.content.generateImage":"Gerar Imagem","node.content.enhancing":"Melhorando...","node.content.enhancePrompt":"Melhorar Prompt","node.content.sanitizing":"Higienizando...","node.content.sanitizedPromptHere":"O prompt higienizado aparecer aqui...","node.content.analyzing":"Analisando...","node.content.analyzePrompt":"Analisar Prompt","node.content.analyzeImage":"Analisar Imagem","node.content.imageToText":"Imagem para Texto","node.content.updatePromptFromImage":"Atualizar prompt da imagem","node.content.analyzeCharacter":"Analisar Personagem","node.content.generateCharacters":"Gerar Personagens","node.content.characterPromptPlaceholder":"Descreva o(s) personagem(ns) para gerar...","node.content.character":"Personagem","node.content.clothing":"Roupas","node.content.characterPlaceholder":"A descrio do personagem aparecer aqui...","node.content.clothingPlaceholder":"A descrio das roupas aparecer aqui...","node.content.appearance":"Aparncia","node.content.personality":"Personalidade","node.content.environment":"Ambiente/Cenrio","node.content.action":"Ao","node.content.emotion":"Emoo","node.content.style":"Estilo","node.content.environmentPlaceholder":"Descrio detalhada do ambiente...","node.content.charactersPlaceholder":"Lista de personagens principais...","node.content.characters":"Personagens","node.content.characterConcepts":"Conceitos de Personagem","node.content.actionPlaceholder":"Descrio da ao...","node.content.emotionPlaceholder":"Descrio da emoo...","node.content.stylePlaceholder":"Descrio do estilo artstico...","node.content.descriptionHere":"A descrio aparecer aqui...","node.content.enableOutpainting":"Habilitar Outpainting","node.content.outpaintingPromptPlaceholder":"Prompt de Outpainting...","node.content.inputImage":"Imagens de Entrada","node.content.dropOrClick":"Soltar ou Clicar","node.content.outputImage":"Imagem de Sada","node.content.applyEdit":"Aplicar Edio","node.content.editing":"Editando...","node.content.chatPlaceholder":"Digite sua mensagem...","node.content.connectedPlaceholder":"Conectado ao n, edite na fonte.","node.content.connectedNode":"Conectado via n","node.content.connectedEmpty":"O n conectado no tem imagem.","node.content.translatePlaceholder":"Texto para traduzir...","node.content.translatedTextPlaceholder":"Texto traduzido...","node.content.targetLanguage":"Idioma de Destino","node.content.translate":"Traduzir","node.content.translating":"Traduzindo...","node.content.scriptPromptPlaceholder":"Insira uma ideia de histria ou enredo...","node.content.generateScript":"Gerar Roteiro","node.content.loadScript":"Carregar Arquivo de Roteiro","node.content.summary":"Resumo","node.content.scenes":"Cenas","node.content.unrecognizedFormat":"Formato de roteiro no reconhecido.","node.content.frames":"Quadros","node.content.characterIndex":"ndice","node.content.readData":"Ler Dados","node.content.textDataHere":"Os dados de texto aparecero aqui.","node.content.noDataRead":'Conecte um n e clique em "Ler Dados" para visualizar seu contedo.',"node.content.previewError":"Erro na Visualizao","node.content.previewPlaceholder":"A visualizao aparecer aqui","node.content.imagePrompt":"Prompt de Imagem","node.output.allPromptData":"Todos os Dados de Prompt","node.note.tab.note":"Nota","node.note.tab.references":"Referncias","node.note.nestedImages":"Imagens Aninhadas","node.note.dropPlaceholder":"Solte imagens ou clique para adicionar","node.note.addCaption":"Legenda","node.note.action.shuffle":"Embaralhar","node.note.action.undoShuffle":"Desfazer Embaralhamento","node.content.characterTypeShort":"Tipo:","node.content.numberOfCharactersShort":"Qtd:","node.content.characterType.simple":"Simples","node.content.characterType.anthro":"Anthro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Item Chave","node.content.style.simple":"Simples","node.content.style.realistic":"Realista","node.content.style.3d_cartoon":"Cartoon 3D","node.content.style.3d_realistic":"Realista 3D","node.content.style.2d_animation":"Animao 2D","node.content.style.anime":"Anime","node.content.style.comics":"Quadrinhos","node.content.style.custom":"Personalizado","node.content.fullDescriptionTitle":"Descrio completa do personagem","node.content.integrationInstruction":"Instruo de integrao","node.content.additionalPromptSuffix":"Prompt Adicional (Sufixo)","image_sequence.auto_crop":"Recorte Auto 16:9","image_sequence.create_zip":"Criar Arquivo ZIP","node.content.modificationRequest":"Solicitao de modificao","node.content.technicalPrompt":"Prompt Tcnico","node.promptProcessor.safePromptTooltip":"Reescreve o prompt para cumprir as diretrizes de segurana e evitar violaes de poltica.","node.promptProcessor.technicalPromptTooltip":"Converte o prompt em uma especificao tcnica altamente detalhada (iluminao, cmera, configuraes de renderizao).","node.promptProcessor.enhanceTooltip":"Usa IA para expandir e enriquecer o prompt com detalhes descritivos.","node.promptProcessor.chainTooltip":"Executa este n e aciona todos os ns conectados a jusante.","image_sequence.tooltip.autoCrop":"Recorta automaticamente as imagens geradas para a proporo 16:9.","image_sequence.tooltip.autoDownload":"Salva automaticamente cada imagem no seu dispositivo aps a gerao.","image_sequence.tooltip.createZip":"Empacota todas as imagens selecionadas em um nico arquivo ZIP para download."},Yb={"imageEditor.title":"Editor de Imagem","imageEditor.canvasResolution":"Resoluo da Tela","imageEditor.background":"Fundo","imageEditor.toolSettings":"Configuraes da Ferramenta","imageEditor.snapToEdges":"Alinhar s Bordas","imageEditor.freeAspect":"Proporo Livre","imageEditor.section.aiRequest":"Solicitao de Modificao IA","imageEditor.input.modificationPlaceholder":'Descreva as alteraes, ex: "mudar fundo para azul"',"imageEditor.action.sendRequest":"Enviar Solicitao","imageEditor.tooltip.removeObject":"Remover (Vermelho) / Manter (Verde)","imageEditor.action.removeObject":"Remover Objeto","imageEditor.tool.transform":"Transformar","imageEditor.tool.hand":"Mo (Pan)","imageEditor.tool.zoom":"Zoom","imageEditor.tool.pencil":"Lpis","imageEditor.tool.rectangle":"Retngulo","imageEditor.action.fit":"Ajustar  Tela","imageEditor.action.fill":"Preencher Tela","imageEditor.action.cancel":"Cancelar","imageEditor.action.resetEdits":"Redefinir Edies","imageEditor.action.apply":"Aplicar","imageViewer.title":"Visualizador de Imagem","imageEditor.outputResolution":"Resoluo de Sada","imageEditor.outputResolutionHelp":'Definir resoluo de sada. Se "Auto", usa a resoluo da tela.',"imageEditor.currentSize":"Tamanho Atual: {width}x{height}","imageEditor.sequenceMode":"Modo Sequncia","imageEditor.sequenceModeHelp":"Processar imagens de entrada da Entrada A sequencialmente.","imageEditor.sequentialCombination":"Combinao Sequencial de Imagens","imageEditor.sequentialCombinationHelp":"Para cada quadro: Envia a imagem atual da Entrada A + Todas as imagens da Entrada B.","imageEditor.sequentialPrompt":"Combinao Sequencial de Prompt","imageEditor.sequentialPromptHelp":"Para cada quadro: Usa um prompt exclusivo da lista + imagem atual.","imageEditor.sequentialEditingWithPrompts":"Edio Sequencial com Prompts","imageEditor.sequentialEditingWithPromptsHelp":"Para cada quadro: Usa imagem da Entrada B + prompt exclusivo. Entrada A  ignorada.","imageEditor.input":"Entrada","imageEditor.inputA":"Entrada A","imageEditor.inputB":"Entrada B","imageEditor.status.queued":"Na Fila","imageEditor.status.generating":"Gerando...","imageEditor.action.regenerate":"Regenerar","imageEditor.tooltip.fit":"Ajustar imagem aos limites da tela (conter).","imageEditor.tooltip.fill":"Escalar imagem para preencher a tela (cobrir).","imageEditor.tooltip.flip":"Virar imagem horizontalmente.","imageEditor.background.white":"Branco","imageEditor.background.gray":"Cinza","imageEditor.background.black":"Preto","imageEditor.background.dark":"Escuro","image_sequence.regenerate":"Regenerar","image_sequence.stop_queue":"Parar Fila","image_sequence.move_up":"Mover para Cima","image_sequence.move_down":"Mover para Baixo","image_sequence.copy_prompt":"Copiar Prompt","image_sequence.add_frame":"Adicionar Quadro","image_sequence.delete_frame":"Excluir Quadro","image_sequence.expand_all_frames":"Expandir/Recolher Todos os Quadros","image_sequence.collapse_all_frames":"Recolher Todos os Quadros","image_sequence.expand_all_scenes":"Expandir/Recolher Todas as Cenas","image_sequence.collapse_all_scenes":"Recolher Todas as Cenas","image_sequence.expand_all":"Expandir Tudo","image_sequence.collapse_all":"Recolher Tudo","image_sequence.clear_all_prompts":"Limpar Todos os Prompts","image_sequence.add_first_frame":"Adicionar Primeiro Quadro","image_sequence.drop_or_add_title":"Soltar JSON de Sequncia ou Adicionar Quadro","image_sequence.drop_or_add_desc":"Solte um arquivo JSON aqui ou clique no boto para adicionar um quadro manualmente.","image_sequence.load_prompts":"Carregar Prompts","image_sequence.output_images_title":"Imagens de Sada","image_sequence.prompts_list_title":"Prompts de Origem","image_sequence.download_selected":"Baixar Selecionados","image_sequence.select_all":"Selecionar Tudo","image_sequence.select_none":"Desmarcar Tudo","image_sequence.invert_selection":"Inverter Seleo","image_sequence.run_selected":"Executar Selecionados","image_sequence.start_queue":"Iniciar Fila","image_sequence.character_prompt_combination":"Combinao de Prompt de Personagem","image_sequence.combination_none":"Nenhum","image_sequence.combination_combine":"Combinar","image_sequence.combination_replace":"Substituir Tags","image_sequence.status.error":"Erro","image_sequence.status.pending":"Na Fila","image_sequence.clear_selected_prompts":"Limpar Prompts Selecionados","image_sequence.range_from":"De:","image_sequence.range_to":"Para:","image_sequence.stats.total":"Total de Quadros: {count}","image_sequence.stats.generated":"Gerados: {count}","image_sequence.stats.queue":"Fila: {count}","image_sequence.edit_in_source":"Editar na Fonte","image_sequence.edit_prompt":"Editar Prompt","image_sequence.select_scene":"Selecionar Cena","image_sequence.next_scene":"Prxima Cena","image_sequence.prev_scene":"Cena Anterior","image_sequence.scene_input_label":"Cena","image_sequence.select_square":"Selecionar Quadrado (1:1)","image_sequence.select_landscape":"Selecionar Paisagem (16:9)","image_sequence.select_portrait":"Selecionar Retrato (9:16)","image_sequence.select_range":"Selecionar Intervalo","image_sequence.force_refresh":"Forar Atualizao","image_sequence.select_scene_frames":"Selecionar todos os quadros nesta cena","image_sequence.collapse_other_scenes":"Recolher outras cenas","prompt_sequence_editor.instructionPlaceholder":"Insira a instruo para modificar prompts...","prompt_sequence_editor.modifying":"Modificando...","prompt_sequence_editor.modifySelected":"Modificar Selecionados ({count})","prompt_sequence_editor.sourcePrompts":"Prompts de Origem","prompt_sequence_editor.finalPrompts":"Prompts Modificados","prompt_sequence_editor.error.invalidInput":"Formato de dados invlido. Por favor conecte um array de sequncia de prompts.","geminiChat.mode.general":"Geral","geminiChat.mode.prompt":"Especialista em Prompt","geminiChat.mode.script":"Roteirista","geminiChat.mode.youtube":"Analista do YouTube","image_sequence.shot_type.WS":"Integre a Entidade com um Plano Aberto (WS) na cena e ao. Mostre o ambiente.","image_sequence.shot_type.MS":"Integre a Entidade com um Plano Mdio (MS) na cena. Personagem da cintura para cima.","image_sequence.shot_type.CU":"Integre a Entidade com um Plano Prximo (CU) na cena.","image_sequence.shot_type.ECU":"Integre a Entidade com um Plano Muito Prximo (ECU) na cena. Mximo detalhe.","image_sequence.shot_type.LS":"Integre a Entidade com um Plano Longo (LS) na cena para mostrar escala."},Xb={"dialog.permission.title":"Permisso Necessria","dialog.permission.description":"Este aplicativo precisa de permisso para ler sua rea de transferncia para permitir colar contedo nos ns. Seus dados no so armazenados ou enviados para lugar nenhum.","dialog.permission.allow":"Permitir","dialog.permission.decline":"Recusar","dialog.rename.title":"Renomear Item","dialog.rename.group.title":"Renomear Grupo","dialog.rename.catalog.title":"Renomear Item do Catlogo","dialog.rename.node.title":"Renomear N","dialog.rename.label":"Novo Nome:","dialog.rename.confirm":"Renomear","dialog.rename.cancel":"Cancelar","dialog.promptEdit.title":"Editar Prompt","dialog.promptEdit.nameLabel":"Nome:","dialog.promptEdit.contentLabel":"Contedo:","dialog.promptEdit.confirm":"Salvar","dialog.promptEdit.cancel":"Cancelar","dialog.confirmDelete.title":"Confirmar Excluso","dialog.confirmDelete.message":"Tem certeza de que deseja excluir este item? Esta ao no pode ser desfeita.","dialog.confirmDelete.confirm":"Excluir","dialog.confirmDelete.cancel":"Cancelar","dialog.confirmCloseTab.title":"Fechar Aba","dialog.confirmCloseTab.message":'Tem certeza de que deseja fechar a aba "{tabName}"? As alteraes no salvas sero perdidas.',"dialog.confirmClear.title":"Limpar Tela","dialog.confirmClear.message":"Tem certeza de que deseja limpar toda a tela? Esta ao no pode ser desfeita.","dialog.confirmReset.title":"Redefinir para o Padro","dialog.confirmReset.message":"Tem certeza de que deseja redefinir a tela para o estado padro? Todo o trabalho atual ser perdido.","dialog.confirmReset.confirm":"Redefinir","dialog.confirmLoad.title":"Confirmar Carregamento","dialog.confirmLoad.message":"Carregar um novo arquivo substituir o contedo atual. Quaisquer alteraes no salvas sero perdidas. Continuar?","dialog.apiKey.title":"Selecionar Chave API","dialog.apiKey.description":'Este recurso requer uma chave API de Projeto com a API "AI Platform" ativada. A gerao de vdeo pode levar alguns minutos.',"dialog.apiKey.billingLink":"Saiba mais sobre faturamento","dialog.apiKey.button":"Selecionar Chave API","dialog.settings.title":"Configuraes","dialog.settings.apiKeyLabel":"Sua Chave API Google Gemini:","dialog.settings.useDevKeyLabel":"Usar chave API gratuita (para desenvolvimento)","dialog.settings.instantNodeCloseLabel":"Fechamento instantneo de n","dialog.settings.nodeAnimationLabel":"Animao de Adio de N","dialog.settings.animationModeLabel":"Modo de Animao de Criao","dialog.settings.anim.pulse":"Pulso","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"Nenhum","dialog.settings.description":"Para usar suas prprias cotas e acessar modelos especficos, insira sua chave API pessoal. A chave  armazenada localmente no seu navegador.","dialog.settings.getKeyLink":"Obtenha uma Chave API aqui","dialog.settings.save":"Salvar","dialog.deleteNode.title":"Fechar n?","dialog.deleteNode.titlePlural":"Fechar ns?","dialog.deleteNode.confirm":"Sim","dialog.deleteNode.cancel":"No","dialog.deleteNode.confirmTooltip":"Fechar n - dados perdidos no podem ser recuperados","dialog.deleteNode.cancelTooltip":"No fechar - continuar trabalhando com o n","dialog.deleteNode.dontShowAgain":"No mostrar novamente","dialog.exitApp.title":"Fechar Projeto?","dialog.exitApp.message":"Tem certeza de que deseja fechar o projeto? Todo o trabalho atual ser perdido e a tela ser redefinida."},Zb={"group.button.create":"Criar Grupo ({count})","group.rename":"Renomear Grupo","group.saveToCatalog":"Salvar no Catlogo","group.saveToDisk":"Salvar no Disco","group.ungroup":"Desagrupar (Shift+Clique para excluir com contedo)","group.duplicate":"Duplicar grupo com contedo","catalog.tabs.groups":"Grupos","catalog.tabs.library":"Biblioteca","catalog.tabs.characters":"Personagens","catalog.tabs.scripts":"Roteiros","catalog.tabs.sequences":"Sequncias","catalog.back":"Voltar","catalog.load":"Carregar de Arquivo","catalog.newFolder":"Nova Pasta","catalog.saveTo":"Salvar no Catlogo","catalog.card.addToCanvas":"Adicionar  Tela","catalog.card.rename":"Renomear","catalog.card.save":"Salvar","catalog.card.delete":"Excluir","catalog.empty.description":"Esta pasta est vazia. Voc pode adicionar itens ou criar novas pastas.","library.loadFromFile":"Carregar","library.actions.newFolder":"Nova Pasta","library.actions.newPrompt":"Novo Prompt","library.actions.copy":"Copiar","library.actions.edit":"Editar","library.empty.title":"Pasta Vazia","library.empty.description":"Crie prompts e pastas para comear.","library.emptyPrompt":"Prompt vazio"},Qb={...$b,...Kb,...Jb,...Yb,...Xb,...Zb},eC={"app.title":"","app.subtitle":"","app.error.title":"","app.error.copy":"","app.error.copied":"","error.apiKey":" API  API ","error.scriptModifierCanvas":" - Script Modifier Script Modifier ","welcome.title":"","welcome.description":"","welcome.apiKeyLabel":" Google Gemini API ","welcome.apiKeyPlaceholder":" API ...","welcome.apiKeyHelp":" API ","welcome.getKeyLink":" API ","welcome.iAmDeveloper":"","welcome.letsGo":"","welcome.resume":"","welcome.startNew":"","welcome.freeModeActive":"","welcome.selectLanguage":"","welcome.navHint":"    ","toast.contentCleared":"","toast.downloadStarted":"","toast.characterLoaded":"","toast.characterSavedDisk":"","toast.copiedToClipboard":"","toast.pastedFromClipboard":"","toast.pasteFailed":"","toast.nodeDuplicated":"","toast.groupSavedToDisk":' "{groupTitle}" ',"toast.groupDeleted":"","toast.characterSavedCatalog":"","toast.promptSaved":"{promptName}...","toast.connectionsCut":"","toast.apiKeySaved":"API ","toast.cacheCleared":" {count} ","toast.cacheEmpty":"","toast.scriptSaved":"","alert.groupSaved":' "{groupTitle}" ',"alert.loadCatalogFailed":"","alert.invalidCatalogFile":"","alert.fileNotSupported":' "appName"',"alert.invalidCatalogStructure":' "root"',"tutorial.step1":"","tutorial.step2":" AI ","tutorial.step2_waiting":"AI ...","tutorial.step3":"","tutorial.step3b":"","tutorial.step4":"","tutorial.group.catalog":"","tutorial.group.general":"","tutorial.group.input":"","tutorial.group.processing":" AI ","tutorial.group.character":"","tutorial.group.output":"","tutorial.group.ai":" Gemini ","tutorial.group.video":"","tutorial.group.scripts":"","tutorial.group.file":"","tutorial.success.title":"","tutorial.success.message":"","tutorial.success.button":"","tutorial.skip":"","tutorial.next":"","tutorial.finish":""},tC={"toolbar.settings":"","toolbar.resetCanvas":"","toolbar.clearCache":"","toolbar.home":"","toolbar.edit":" (V)","toolbar.cutter":" (C) / ( Ctrl)","toolbar.selection":" (S) / ( Shift)","toolbar.reroute":" (R) / ( Ctrl+Alt)","toolbar.zoom":" ( Z)","toolbar.snapToGrid":"","toolbar.smartGuides":"","toolbar.lineStyleSpaghetti":"","toolbar.lineStyleOrthogonal":"","toolbar.resetZoom":"","toolbar.resetCamera":"","toolbar.clearCanvas":"","toolbar.addNode":" (F)","toolbar.catalog":" (Ctrl + Space)","toolbar.addNote":" (N)","toolbar.addDataReader":" (Shift + R)","toolbar.addTextInput":" (T)","toolbar.addImageInput":" (I)","toolbar.addPromptSequenceEditor":" (Q)","toolbar.addImageAnalyzer":" (Shift+A)","toolbar.addPromptAnalyzer":" (A)","toolbar.addPromptProcessor":" (P)","toolbar.addCharacterGenerator":" (Shift+C)","toolbar.addCharacterAnalyzer":" (Ctrl+Shift+A)","toolbar.addCharacterCard":" (Ctrl+Shift+C)","toolbar.addImageOutput":" (O)","toolbar.addImageEditor":" AI  (Shift+I)","toolbar.addImageSequenceGenerator":" (Shift+Q)","toolbar.addTranslator":" (L)","toolbar.addGeminiChat":" Gemini  (M)","toolbar.addVideoPromptProcessor":" (Shift+P)","toolbar.addVideoOutput":" (Shift+O)","toolbar.addScriptGenerator":"","toolbar.addScriptViewer":" (Shift + V)","toolbar.saveCanvas":" (Ctrl + S)","toolbar.saveProject":"","toolbar.loadCanvas":"/ (Ctrl + O)","toolbar.group.general":"","toolbar.group.catalog":"","toolbar.group.input":"","toolbar.group.processing":"","toolbar.group.character":"","toolbar.group.output":"","toolbar.group.aiTools":"AI ","toolbar.group.video":"","toolbar.group.scripts":"","toolbar.group.file":"","toolbar.title":"","toolbar.dock":"","toolbar.detach":"","toolbar.expandPanel":"","toolbar.collapsePanel":"","toolbar.dockArea.title":"","toolbar.duplicate":"","toolbar.duplicateWithContent":"","toolbar.dock.q1":" 1/4","toolbar.dock.q2":" 2/4","toolbar.dock.q3":" 3/4","toolbar.dock.q4":" 4/4","toolbar.dock.tl":"","toolbar.dock.bl":"","toolbar.dock.tr":"","toolbar.dock.br":"","toolbar.dock.left":"","toolbar.dock.right":"","toolbar.dock.full":"","toolbar.dock.exitFull":"","toolbar.dock.fullFocus":"","hotkeys.show":"","hotkeys.tools.title":"","hotkeys.tools.edit":"","hotkeys.tools.cutter":"","hotkeys.tools.selection":"","hotkeys.tools.reroute":"","hotkeys.tools.zoom":"","hotkeys.tools.toggleLineStyle":"","hotkeys.tools.group":"","hotkeys.tools.closeNode":"","hotkeys.tools.duplicate":"","hotkeys.tools.duplicateWithContent":"","hotkeys.tools.deleteGroup":" (Shift+Click)","hotkeys.windows.title":"","hotkeys.windows.search":"","hotkeys.windows.catalog":"","hotkeys.createNode.title":"","help.panelTitle":"","help.subtitle":"","help.title":"","help.howToUse.title":"","help.howToUse.content":"","help.author":"","help.tab.links":"","help.section.socials":"","help.section.studioStable":"Google AI Studio ()","help.section.studioAlpha":"Google AI Studio (Alpha)","help.section.netlify":"Netlify ","help.section.github":"GitHub ","help.license":" GNU GPLv3 ","help.copyLink":"","help.copied":"","contextMenu.undoPosition":"","contextMenu.redoPosition":"","contextMenu.align.left":" (F)","contextMenu.align.centerX":" (E)","contextMenu.align.right":" (R)","contextMenu.align.top":" (T)","contextMenu.align.centerY":" (D)","contextMenu.align.bottom":" (B)","contextMenu.distribute.horizontal":" (Ctrl+D)","contextMenu.distribute.vertical":" (Ctrl+E)","contextMenu.emptySlot":" ()","contextMenu.saveSlots":"","contextMenu.loadSlots":"","quickadd.title":"","quickadd.group.tools":"","quickadd.group.inputs":"","quickadd.group.processing":"","quickadd.group.character":"","quickadd.group.outputs":"","quickadd.group.ai":"AI ","quickadd.group.video":"","quickadd.group.scripts":"","quickadd.group.general":"","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"","quickadd.tool.cutter":"","quickadd.tool.selection":"","search.placeholder":"...","search.noResults":"","search.group.input":" & ","search.group.process":" & ","search.group.output":" & ","search.group.ai":"AI ","search.group.video":" & ","search.group.scripts":"","toolbar.exitApp":""},nC={"node.title.text_input":"","node.title.image_input":"","node.title.prompt_processor":"","node.title.prompt_sanitizer":"","node.title.video_prompt_processor":"","node.title.image_output":"","node.title.video_output":"","node.title.prompt_analyzer":"","node.title.character_analyzer":"","node.title.character_generator":"","node.title.character_card":"","node.title.image_analyzer":"","node.title.image_editor":"AI ","node.title.image_sequence_generator":"","node.title.prompt_sequence_editor":"","node.title.gemini_chat":"Gemini ","node.title.translator":"","node.title.script_generator":"","node.title.script_viewer":"","node.title.note":"","node.title.reroute_dot":"","node.title.data_reader":"","node.title.video_editor":" Alpha","node.title.media_viewer":"","node.title.data_protection":"","node.title.pose_creator":"Pose Creator","node.help.text_input":"","node.help.image_input":"","node.help.prompt_processor":" AI ","node.help.prompt_sanitizer":"","node.help.video_prompt_processor":"","node.help.image_output":"","node.help.video_output":" Veo ","node.help.prompt_analyzer":"","node.help.character_analyzer":"","node.help.character_generator":"","node.help.character_card":"","node.help.image_analyzer":" AI ","node.help.image_editor":"/","node.help.image_sequence_generator":"","node.help.prompt_sequence_editor":" AI ","node.help.gemini_chat":" Gemini ","node.help.translator":" AI ","node.help.script_generator":"","node.help.script_viewer":"","node.help.note":"","node.help.reroute_dot":"","node.help.data_reader":"","node.help.video_editor":"","node.help.media_viewer":" and ","node.help.data_protection":"","node.help.pose_creator":"","node.action.expand":"","node.action.collapse":"","node.action.help":"","node.action.download":"","node.action.clear":"","node.action.refreshChat":"","node.action.paste":"","node.action.resetEditor":"","node.action.saveCharacter":"","node.action.loadCharacter":"","node.action.copy":"","node.action.copyImage":"","node.action.copyTextPrompt":"","node.action.copyImagePrompt":"","node.action.copyVideoPrompt":"","node.action.cutConnections":"","node.action.close":"","node.action.closeNode":" (Shift+Click )","node.action.closeNodeSimple":"","node.action.randomWord":"","node.action.processImage":"","node.action.processImageTitle":" Gemini ","node.action.editor":"","node.action.rasterEditor":"","node.action.openInAIEditor":" AI ","node.action.openInAnalyzer":"","node.action.outputToInput":"","node.action.processChainForward":"","node.action.executeChain":"","node.action.executeChainTitle":"","node.action.sanitize":"","node.action.rename":"","node.action.stop":"","node.action.stopping":"...","node.action.deleteItem":"","node.action.detachAndPaste":"","node.action.delete":"","node.action.flipImage":"","node.action.pin":"","node.action.unpin":"","node.mediaViewer.play":"","node.mediaViewer.pause":"","node.mediaViewer.stop":"","node.mediaViewer.addMarker":"","node.mediaViewer.exportSRT":" (SRT)","node.mediaViewer.deleteAllMarkers":"","node.mediaViewer.saveMarkers":"","node.mediaViewer.loadMarkers":"","node.mediaViewer.relink":"","node.content.notePlaceholder":"...","node.content.dropImage":"","node.content.dropMedia":"","node.content.processing":"...","node.content.processingChain":"...","node.content.metadataPrompt":"","node.content.metadataPromptPlaceholder":"","node.content.copyPrompt":"","node.content.prompt":"","node.content.inputPrompt":"","node.content.enhancedResult":"","node.content.videoPrompt":"","node.content.editPromptPlaceholder":"...","node.content.enhancedPromptHere":"...","node.content.safePrompt":"","node.content.generating":"...","node.content.imageHere":"","node.content.generationMode":"","node.content.aspectRatio":"","node.content.aspectRatioHelp":"","node.content.aspectRatioNotSupportedFast":" Imagen ","node.content.enableAspectRatioFormatting":"","node.content.autoDownload":"","node.content.generateImage":"","node.content.enhancing":"...","node.content.enhancePrompt":"","node.content.sanitizing":"...","node.content.sanitizedPromptHere":"...","node.content.analyzing":"...","node.content.analyzePrompt":"","node.content.analyzeImage":"","node.content.imageToText":"","node.content.updatePromptFromImage":"","node.content.analyzeCharacter":"","node.content.generateCharacters":"","node.content.characterPromptPlaceholder":"...","node.content.character":"","node.content.clothing":"","node.content.characterPlaceholder":"...","node.content.clothingPlaceholder":"...","node.content.appearance":"","node.content.personality":"","node.content.environment":"/","node.content.action":"","node.content.emotion":"","node.content.style":"","node.content.environmentPlaceholder":"...","node.content.charactersPlaceholder":"...","node.content.characters":"","node.content.characterConcepts":"","node.content.actionPlaceholder":"...","node.content.emotionPlaceholder":"...","node.content.stylePlaceholder":"...","node.content.descriptionHere":"...","node.content.enableOutpainting":"","node.content.outpaintingPromptPlaceholder":"...","node.content.inputImage":"","node.content.dropOrClick":"","node.content.outputImage":"","node.content.applyEdit":"","node.content.editing":"...","node.content.chatPlaceholder":"...","node.content.connectedPlaceholder":"","node.content.connectedNode":"","node.content.connectedEmpty":"","node.content.translatePlaceholder":"...","node.content.translatedTextPlaceholder":"...","node.content.targetLanguage":"","node.content.translate":"","node.content.translating":"...","node.content.scriptPromptPlaceholder":"...","node.content.generateScript":"","node.content.loadScript":"","node.content.summary":"","node.content.scenes":"","node.content.unrecognizedFormat":"","node.content.frames":"","node.content.characterIndex":"","node.content.readData":"","node.content.textDataHere":"","node.content.noDataRead":"","node.content.previewError":"","node.content.previewPlaceholder":"","node.content.imagePrompt":"","node.output.allPromptData":"","node.note.tab.note":"","node.note.tab.references":"","node.note.nestedImages":"","node.note.dropPlaceholder":"","node.note.addCaption":"","node.note.action.shuffle":"","node.note.action.undoShuffle":"","node.content.characterTypeShort":":","node.content.numberOfCharactersShort":":","node.content.characterType.simple":"","node.content.characterType.anthro":"","node.content.characterType.chibi":"Q","node.content.characterType.key_item":"","node.content.style.simple":"","node.content.style.realistic":"","node.content.style.3d_cartoon":"3D ","node.content.style.3d_realistic":"3D ","node.content.style.2d_animation":"2D ","node.content.style.anime":"","node.content.style.comics":"","node.content.style.custom":"","node.content.fullDescriptionTitle":"","node.content.integrationInstruction":"","node.content.additionalPromptSuffix":" ()","image_sequence.auto_crop":" 16:9","image_sequence.create_zip":" ZIP ","node.content.modificationRequest":"","node.content.technicalPrompt":"","node.promptProcessor.safePromptTooltip":"","node.promptProcessor.technicalPromptTooltip":"","node.promptProcessor.enhanceTooltip":" AI ","node.promptProcessor.chainTooltip":"","image_sequence.tooltip.autoCrop":" 16:9 ","image_sequence.tooltip.autoDownload":"","image_sequence.tooltip.createZip":" ZIP "},oC={"imageEditor.title":"","imageEditor.canvasResolution":"","imageEditor.background":"","imageEditor.toolSettings":"","imageEditor.snapToEdges":"","imageEditor.freeAspect":"","imageEditor.section.aiRequest":"AI ","imageEditor.input.modificationPlaceholder":"","imageEditor.action.sendRequest":"","imageEditor.tooltip.removeObject":" () /  ()","imageEditor.action.removeObject":"","imageEditor.tool.transform":"","imageEditor.tool.hand":" ()","imageEditor.tool.zoom":"","imageEditor.tool.pencil":"","imageEditor.tool.rectangle":"","imageEditor.action.fit":"","imageEditor.action.fill":"","imageEditor.action.cancel":"","imageEditor.action.resetEdits":"","imageEditor.action.apply":"","imageViewer.title":"","imageEditor.outputResolution":"","imageEditor.outputResolutionHelp":"","imageEditor.currentSize":": {width}x{height}","imageEditor.sequenceMode":"","imageEditor.sequenceModeHelp":" A ","imageEditor.sequentialCombination":"","imageEditor.sequentialCombinationHelp":" A  +  B ","imageEditor.sequentialPrompt":"","imageEditor.sequentialPromptHelp":" + ","imageEditor.sequentialEditingWithPrompts":"","imageEditor.sequentialEditingWithPromptsHelp":" B  +  A ","imageEditor.input":"","imageEditor.inputA":" A","imageEditor.inputB":" B","imageEditor.status.queued":"","imageEditor.status.generating":"...","imageEditor.action.regenerate":"","imageEditor.tooltip.fit":" (contain)","imageEditor.tooltip.fill":" (cover)","imageEditor.tooltip.flip":"","imageEditor.background.white":"","imageEditor.background.gray":"","imageEditor.background.black":"","imageEditor.background.dark":"","image_sequence.regenerate":"","image_sequence.stop_queue":"","image_sequence.move_up":"","image_sequence.move_down":"","image_sequence.copy_prompt":"","image_sequence.add_frame":"","image_sequence.delete_frame":"","image_sequence.expand_all_frames":"/","image_sequence.collapse_all_frames":"","image_sequence.expand_all_scenes":"/","image_sequence.collapse_all_scenes":"","image_sequence.expand_all":"","image_sequence.collapse_all":"","image_sequence.clear_all_prompts":"","image_sequence.add_first_frame":"","image_sequence.drop_or_add_title":" JSON ","image_sequence.drop_or_add_desc":" JSON ","image_sequence.load_prompts":"","image_sequence.output_images_title":"","image_sequence.prompts_list_title":"","image_sequence.download_selected":"","image_sequence.select_all":"","image_sequence.select_none":"","image_sequence.invert_selection":"","image_sequence.run_selected":"","image_sequence.start_queue":"","image_sequence.character_prompt_combination":"","image_sequence.combination_none":"","image_sequence.combination_combine":"","image_sequence.combination_replace":"","image_sequence.status.error":"","image_sequence.status.pending":"","image_sequence.clear_selected_prompts":"","image_sequence.range_from":":","image_sequence.range_to":":","image_sequence.stats.total":": {count}","image_sequence.stats.generated":": {count}","image_sequence.stats.queue":": {count}","image_sequence.edit_in_source":"","image_sequence.edit_prompt":"","image_sequence.select_scene":"","image_sequence.next_scene":"","image_sequence.prev_scene":"","image_sequence.scene_input_label":"","image_sequence.select_square":" (1:1)","image_sequence.select_landscape":" (16:9)","image_sequence.select_portrait":" (9:16)","image_sequence.select_range":"","image_sequence.force_refresh":"","image_sequence.select_scene_frames":"","image_sequence.collapse_other_scenes":"","prompt_sequence_editor.instructionPlaceholder":"...","prompt_sequence_editor.modifying":"...","prompt_sequence_editor.modifySelected":" ({count})","prompt_sequence_editor.sourcePrompts":"","prompt_sequence_editor.finalPrompts":"","prompt_sequence_editor.error.invalidInput":"","geminiChat.mode.general":"","geminiChat.mode.prompt":"","geminiChat.mode.script":"","geminiChat.mode.youtube":"YouTube ","image_sequence.shot_type.WS":" (WS) ","image_sequence.shot_type.MS":" (MS) ","image_sequence.shot_type.CU":" (CU) ","image_sequence.shot_type.ECU":" (ECU) ","image_sequence.shot_type.LS":" (LS) "},rC={"dialog.permission.title":"","dialog.permission.description":"","dialog.permission.allow":"","dialog.permission.decline":"","dialog.rename.title":"","dialog.rename.group.title":"","dialog.rename.catalog.title":"","dialog.rename.node.title":"","dialog.rename.label":"","dialog.rename.confirm":"","dialog.rename.cancel":"","dialog.promptEdit.title":"","dialog.promptEdit.nameLabel":"","dialog.promptEdit.contentLabel":"","dialog.promptEdit.confirm":"","dialog.promptEdit.cancel":"","dialog.confirmDelete.title":"","dialog.confirmDelete.message":"","dialog.confirmDelete.confirm":"","dialog.confirmDelete.cancel":"","dialog.confirmCloseTab.title":"","dialog.confirmCloseTab.message":' "{tabName}" ',"dialog.confirmClear.title":"","dialog.confirmClear.message":"","dialog.confirmReset.title":"","dialog.confirmReset.message":"","dialog.confirmReset.confirm":"","dialog.confirmLoad.title":"","dialog.confirmLoad.message":"","dialog.apiKey.title":" API ","dialog.apiKey.description":' "AI Platform" API  API ',"dialog.apiKey.billingLink":"","dialog.apiKey.button":" API ","dialog.settings.title":"","dialog.settings.apiKeyLabel":" Google Gemini API ","dialog.settings.useDevKeyLabel":" API ","dialog.settings.instantNodeCloseLabel":"","dialog.settings.nodeAnimationLabel":"","dialog.settings.animationModeLabel":"","dialog.settings.anim.pulse":"","dialog.settings.anim.bladeRunner":"","dialog.settings.anim.none":"","dialog.settings.description":" API ","dialog.settings.getKeyLink":" API ","dialog.settings.save":"","dialog.deleteNode.title":"","dialog.deleteNode.titlePlural":"","dialog.deleteNode.confirm":"","dialog.deleteNode.cancel":"","dialog.deleteNode.confirmTooltip":" - ","dialog.deleteNode.cancelTooltip":" - ","dialog.deleteNode.dontShowAgain":"","dialog.exitApp.title":"","dialog.exitApp.message":""},aC={"group.button.create":" ({count})","group.rename":"","group.saveToCatalog":"","group.saveToDisk":"","group.ungroup":" (Shift+Click )","group.duplicate":"","catalog.tabs.groups":"","catalog.tabs.library":"","catalog.tabs.characters":"","catalog.tabs.scripts":"","catalog.tabs.sequences":"","catalog.back":"","catalog.load":"","catalog.newFolder":"","catalog.saveTo":"","catalog.card.addToCanvas":"","catalog.card.rename":"","catalog.card.save":"","catalog.card.delete":"","catalog.empty.description":"","library.loadFromFile":"","library.actions.newFolder":"","library.actions.newPrompt":"","library.actions.copy":"","library.actions.edit":"","library.empty.title":"","library.empty.description":"","library.emptyPrompt":""},iC={...eC,...tC,...nC,...oC,...rC,...aC},sC={"app.title":"","app.subtitle":"","app.error.title":"","app.error.copy":"","app.error.copied":"","error.apiKey":"APIAPI","error.scriptModifierCanvas":"Script ModifierScript Modifier","welcome.title":"","welcome.description":"Prompt Modifier","welcome.apiKeyLabel":"Google Gemini API","welcome.apiKeyPlaceholder":"API...","welcome.apiKeyHelp":"API","welcome.getKeyLink":"API","welcome.iAmDeveloper":"","welcome.letsGo":"","welcome.resume":"","welcome.startNew":"","welcome.freeModeActive":"","welcome.selectLanguage":"","welcome.navHint":"    ","toast.contentCleared":"","toast.downloadStarted":"","toast.characterLoaded":"","toast.characterSavedDisk":"","toast.copiedToClipboard":"","toast.pastedFromClipboard":"","toast.pasteFailed":"","toast.nodeDuplicated":"","toast.groupSavedToDisk":' "{groupTitle}" ',"toast.groupDeleted":"","toast.characterSavedCatalog":"","toast.promptSaved":": {promptName}...","toast.connectionsCut":"","toast.apiKeySaved":"API","toast.cacheCleared":"{count} ","toast.cacheEmpty":"","toast.scriptSaved":"","alert.groupSaved":' "{groupTitle}" ',"alert.loadCatalogFailed":"","alert.invalidCatalogFile":"","alert.fileNotSupported":'"appName" ',"alert.invalidCatalogStructure":'"root" ',"tutorial.step1":"","tutorial.step2":"AI","tutorial.step2_waiting":"AI...","tutorial.step3":"","tutorial.step3b":"","tutorial.step4":"","tutorial.group.catalog":"","tutorial.group.general":"","tutorial.group.input":"","tutorial.group.processing":"AI","tutorial.group.character":"","tutorial.group.output":"","tutorial.group.ai":"Gemini","tutorial.group.video":"","tutorial.group.scripts":"","tutorial.group.file":"","tutorial.success.title":"","tutorial.success.message":"Prompt Modifier","tutorial.success.button":"","tutorial.skip":"","tutorial.next":"","tutorial.finish":""},lC={"toolbar.settings":"","toolbar.resetCanvas":"","toolbar.clearCache":"","toolbar.home":"","toolbar.edit":" (V)","toolbar.cutter":" (C) / (Ctrl)","toolbar.selection":" (S) / (Shift)","toolbar.reroute":" (R) / (Ctrl+Alt)","toolbar.zoom":" (Z)","toolbar.snapToGrid":"","toolbar.smartGuides":"","toolbar.lineStyleSpaghetti":"","toolbar.lineStyleOrthogonal":"","toolbar.resetZoom":"","toolbar.resetCamera":"","toolbar.clearCanvas":"","toolbar.addNode":" (F)","toolbar.catalog":" (Ctrl + Space)","toolbar.addNote":" (N)","toolbar.addDataReader":" (Shift + R)","toolbar.addTextInput":" (T)","toolbar.addImageInput":" (I)","toolbar.addPromptSequenceEditor":" (Q)","toolbar.addImageAnalyzer":" (Shift+A)","toolbar.addPromptAnalyzer":" (A)","toolbar.addPromptProcessor":" (P)","toolbar.addCharacterGenerator":" (Shift+C)","toolbar.addCharacterAnalyzer":" (Ctrl+Shift+A)","toolbar.addCharacterCard":" (Ctrl+Shift+C)","toolbar.addImageOutput":" (O)","toolbar.addImageEditor":"AI (Shift+I)","toolbar.addImageSequenceGenerator":" (Shift+Q)","toolbar.addTranslator":" (L)","toolbar.addGeminiChat":"Gemini (M)","toolbar.addVideoPromptProcessor":" (Shift+P)","toolbar.addVideoOutput":" (Shift+O)","toolbar.addScriptGenerator":"","toolbar.addScriptViewer":" (Shift + V)","toolbar.saveCanvas":" (Ctrl + S)","toolbar.saveProject":"","toolbar.loadCanvas":"/ (Ctrl + O)","toolbar.group.general":"","toolbar.group.catalog":"","toolbar.group.input":"","toolbar.group.processing":"","toolbar.group.character":"","toolbar.group.output":"","toolbar.group.aiTools":"AI","toolbar.group.video":"","toolbar.group.scripts":"","toolbar.group.file":"","toolbar.title":"","toolbar.dock":"","toolbar.detach":"","toolbar.expandPanel":"","toolbar.collapsePanel":"","toolbar.dockArea.title":"","toolbar.duplicate":"","toolbar.duplicateWithContent":"","toolbar.dock.q1":" 1/4","toolbar.dock.q2":" 2/4","toolbar.dock.q3":" 3/4","toolbar.dock.q4":" 4/4","toolbar.dock.tl":"","toolbar.dock.bl":"","toolbar.dock.tr":"","toolbar.dock.br":"","toolbar.dock.left":"","toolbar.dock.right":"","toolbar.dock.full":"","toolbar.dock.exitFull":"","toolbar.dock.fullFocus":"","hotkeys.show":"","hotkeys.tools.title":"","hotkeys.tools.edit":"","hotkeys.tools.cutter":"","hotkeys.tools.selection":"","hotkeys.tools.reroute":"","hotkeys.tools.zoom":"","hotkeys.tools.toggleLineStyle":"","hotkeys.tools.group":"","hotkeys.tools.closeNode":"","hotkeys.tools.duplicate":"","hotkeys.tools.duplicateWithContent":"","hotkeys.tools.deleteGroup":" (Shift+)","hotkeys.windows.title":"","hotkeys.windows.search":"","hotkeys.windows.catalog":"","hotkeys.createNode.title":"","help.panelTitle":" & ","help.subtitle":"","help.title":"","help.howToUse.title":"","help.howToUse.content":"Prompt Modifier","help.author":"","help.tab.links":" & ","help.section.socials":"","help.section.studioStable":"Google AI Studio ()","help.section.studioAlpha":"Google AI Studio ()","help.section.netlify":"Netlify ","help.section.github":"GitHub ","help.license":"GNU GPLv3 ","help.copyLink":"","help.copied":"","contextMenu.undoPosition":"","contextMenu.redoPosition":"","contextMenu.align.left":" (F)","contextMenu.align.centerX":" (E)","contextMenu.align.right":" (R)","contextMenu.align.top":" (T)","contextMenu.align.centerY":" (D)","contextMenu.align.bottom":" (B)","contextMenu.distribute.horizontal":" (Ctrl+D)","contextMenu.distribute.vertical":" (Ctrl+E)","contextMenu.emptySlot":" ()","contextMenu.saveSlots":"","contextMenu.loadSlots":"","quickadd.title":"","quickadd.group.tools":"","quickadd.group.inputs":"","quickadd.group.processing":"","quickadd.group.character":"","quickadd.group.outputs":"","quickadd.group.ai":"AI","quickadd.group.video":"","quickadd.group.scripts":"","quickadd.group.general":"","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"","quickadd.tool.cutter":"","quickadd.tool.selection":"","search.placeholder":"...","search.noResults":"","search.group.input":" & ","search.group.process":" & ","search.group.output":" & ","search.group.ai":"AI","search.group.video":" & ","search.group.scripts":"","toolbar.exitApp":""},cC={"node.title.text_input":"","node.title.image_input":"","node.title.prompt_processor":"","node.title.prompt_sanitizer":"","node.title.video_prompt_processor":"","node.title.image_output":"","node.title.video_output":"","node.title.prompt_analyzer":"","node.title.character_analyzer":"","node.title.character_generator":"","node.title.character_card":"","node.title.image_analyzer":"","node.title.image_editor":"AI","node.title.image_sequence_generator":"","node.title.prompt_sequence_editor":"","node.title.gemini_chat":"Gemini","node.title.translator":"","node.title.script_generator":"","node.title.script_viewer":"","node.title.note":"","node.title.reroute_dot":"","node.title.data_reader":"","node.title.video_editor":" (Alpha)","node.title.media_viewer":"","node.title.data_protection":"","node.title.pose_creator":"","node.help.text_input":"","node.help.image_input":"","node.help.prompt_processor":"AI1","node.help.prompt_sanitizer":"","node.help.video_prompt_processor":"","node.help.image_output":"","node.help.video_output":"Veo","node.help.prompt_analyzer":"","node.help.character_analyzer":"","node.help.character_generator":"","node.help.character_card":"","node.help.image_analyzer":"AI","node.help.image_editor":"/","node.help.image_sequence_generator":"","node.help.prompt_sequence_editor":"AI","node.help.gemini_chat":"Gemini","node.help.translator":"AI","node.help.script_generator":"","node.help.script_viewer":"","node.help.note":"","node.help.reroute_dot":"","node.help.data_reader":"","node.help.video_editor":"","node.help.media_viewer":"","node.help.data_protection":"","node.help.pose_creator":"","node.action.expand":"","node.action.collapse":"","node.action.help":"","node.action.download":"","node.action.clear":"","node.action.refreshChat":"","node.action.paste":"","node.action.resetEditor":"","node.action.saveCharacter":"","node.action.loadCharacter":"","node.action.copy":"","node.action.copyImage":"","node.action.copyTextPrompt":"","node.action.copyImagePrompt":"","node.action.copyVideoPrompt":"","node.action.cutConnections":"","node.action.close":"","node.action.closeNode":" (Shift+)","node.action.closeNodeSimple":"","node.action.randomWord":"","node.action.processImage":"","node.action.processImageTitle":"Gemini","node.action.editor":"","node.action.rasterEditor":"","node.action.openInAIEditor":"AI","node.action.openInAnalyzer":"","node.action.outputToInput":"","node.action.processChainForward":"","node.action.executeChain":"","node.action.executeChainTitle":"","node.action.sanitize":"","node.action.rename":"","node.action.stop":"","node.action.stopping":"...","node.action.deleteItem":"","node.action.detachAndPaste":"","node.action.delete":"","node.action.flipImage":"","node.action.pin":"","node.action.unpin":"","node.action.updateDescription":"","node.action.modifyCharacter":"","node.action.updateDataFormat":"","node.action.expand169":"16:9","node.action.expand916":"9:16","node.action.sync":"","node.action.expandRatio":"","node.action.markPrimary":"","node.action.addCard":"","node.action.removeCard":"","node.action.showOutputs":"","node.action.hideOutputs":"","node.action.characterConcept":"","node.action.objectConcept":"","node.mediaViewer.play":"","node.mediaViewer.pause":"","node.mediaViewer.stop":"","node.mediaViewer.addMarker":"","node.mediaViewer.exportSRT":" (SRT)","node.mediaViewer.deleteAllMarkers":"","node.mediaViewer.saveMarkers":"","node.mediaViewer.loadMarkers":"","node.mediaViewer.relink":"","node.content.notePlaceholder":"...","node.content.dropImage":"","node.content.dropMedia":"","node.content.processing":"...","node.content.processingChain":"...","node.content.metadataPrompt":":","node.content.metadataPromptPlaceholder":"","node.content.copyPrompt":"","node.content.prompt":"","node.content.inputPrompt":"","node.content.enhancedResult":"","node.content.videoPrompt":"","node.content.editPromptPlaceholder":"...","node.content.enhancedPromptHere":"...","node.content.safePrompt":"","node.content.generating":"...","node.content.imageHere":"","node.content.generationMode":"","node.content.aspectRatio":"","node.content.aspectRatioHelp":"","node.content.aspectRatioNotSupportedFast":"Imagen","node.content.enableAspectRatioFormatting":"","node.content.autoDownload":"","node.content.generateImage":"","node.content.enhancing":"...","node.content.enhancePrompt":"","node.content.sanitizing":"...","node.content.sanitizedPromptHere":"...","node.content.analyzing":"...","node.content.analyzePrompt":"","node.content.analyzeImage":"","node.content.imageToText":"","node.content.updatePromptFromImage":"","node.content.analyzeCharacter":"","node.content.generateCharacters":"","node.content.characterPromptPlaceholder":"...","node.content.character":"","node.content.clothing":"","node.content.characterPlaceholder":"...","node.content.clothingPlaceholder":"...","node.content.appearance":"","node.content.personality":"","node.content.environment":"/","node.content.action":"","node.content.emotion":"","node.content.style":"","node.content.environmentPlaceholder":"...","node.content.charactersPlaceholder":"...","node.content.characters":"","node.content.characterConcepts":"","node.content.actionPlaceholder":"...","node.content.emotionPlaceholder":"...","node.content.stylePlaceholder":"...","node.content.descriptionHere":"...","node.content.enableOutpainting":"","node.content.outpaintingPromptPlaceholder":"...","node.content.inputImage":"","node.content.dropOrClick":"","node.content.outputImage":"","node.content.applyEdit":"","node.content.editing":"...","node.content.chatPlaceholder":"...","node.content.connectedPlaceholder":"","node.content.connectedNode":"","node.content.connectedEmpty":"","node.content.translatePlaceholder":"...","node.content.translatedTextPlaceholder":"...","node.content.targetLanguage":"","node.content.translate":"","node.content.translating":"...","node.content.scriptPromptPlaceholder":"...","node.content.generateScript":"","node.content.loadScript":"","node.content.summary":"","node.content.scenes":"","node.content.unrecognizedFormat":"","node.content.frames":"","node.content.characterIndex":"","node.content.readData":"","node.content.textDataHere":"","node.content.noDataRead":"","node.content.previewError":"","node.content.previewPlaceholder":"","node.content.imagePrompt":"","node.output.allPromptData":"","node.note.tab.note":"","node.note.tab.references":"","node.note.nestedImages":"","node.note.dropPlaceholder":"","node.note.addCaption":"","node.note.action.shuffle":"","node.note.action.undoShuffle":"","node.content.characterTypeShort":":","node.content.numberOfCharactersShort":":","node.content.characterType.simple":"","node.content.characterType.anthro":"","node.content.characterType.chibi":"","node.content.characterType.key_item":"","node.content.style.simple":"","node.content.style.realistic":"","node.content.style.3d_cartoon":"3D","node.content.style.3d_realistic":"3D","node.content.style.2d_animation":"2D","node.content.style.anime":"","node.content.style.comics":"","node.content.style.custom":"","node.content.fullDescriptionTitle":"","node.content.integrationInstruction":"","node.content.additionalPromptSuffix":" ()","image_sequence.auto_crop":" 16:9","image_sequence.create_zip":"ZIP","node.content.modificationRequest":"","node.content.technicalPrompt":"","node.promptProcessor.safePromptTooltip":"","node.promptProcessor.technicalPromptTooltip":"","node.promptProcessor.enhanceTooltip":"AI","node.promptProcessor.chainTooltip":"","image_sequence.tooltip.autoCrop":"16:9","image_sequence.tooltip.autoDownload":"","image_sequence.tooltip.createZip":"ZIP"},dC={"imageEditor.title":"","imageEditor.canvasResolution":"","imageEditor.background":"","imageEditor.toolSettings":"","imageEditor.snapToEdges":"","imageEditor.freeAspect":"","imageEditor.section.aiRequest":"AI","imageEditor.input.modificationPlaceholder":"","imageEditor.action.sendRequest":"","imageEditor.tooltip.removeObject":" () /  ()","imageEditor.action.removeObject":"","imageEditor.action.removeBackground":"","imageEditor.tool.transform":"","imageEditor.tool.hand":"","imageEditor.tool.zoom":"","imageEditor.tool.pencil":"","imageEditor.tool.rectangle":"","imageEditor.action.fit":"","imageEditor.action.fill":"","imageEditor.action.cancel":"","imageEditor.action.resetEdits":"","imageEditor.action.apply":"","imageViewer.title":"","imageEditor.outputResolution":"","imageEditor.outputResolutionHelp":"Auto","imageEditor.currentSize":": {width}x{height}","imageEditor.sequenceMode":"","imageEditor.sequenceModeHelp":"A","imageEditor.sequentialCombination":"","imageEditor.sequentialCombinationHelp":"A + B","imageEditor.sequentialPrompt":"","imageEditor.sequentialPromptHelp":" + ","imageEditor.sequentialEditingWithPrompts":"","imageEditor.sequentialEditingWithPromptsHelp":"B + A","imageEditor.input":"","imageEditor.inputA":" A","imageEditor.inputB":" B","imageEditor.status.queued":"","imageEditor.status.generating":"...","imageEditor.action.regenerate":"","imageEditor.tooltip.fit":" (contain)","imageEditor.tooltip.fill":" (cover)","imageEditor.tooltip.flip":"","imageEditor.background.white":"","imageEditor.background.gray":"","imageEditor.background.black":"","imageEditor.background.dark":"","image_sequence.regenerate":"","image_sequence.stop_queue":"","image_sequence.move_up":"","image_sequence.move_down":"","image_sequence.copy_prompt":"","image_sequence.add_frame":"","image_sequence.delete_frame":"","image_sequence.expand_all_frames":"/","image_sequence.collapse_all_frames":"","image_sequence.expand_all_scenes":"/","image_sequence.collapse_all_scenes":"","image_sequence.expand_all":"","image_sequence.collapse_all":"","image_sequence.clear_all_prompts":"","image_sequence.add_first_frame":"","image_sequence.drop_or_add_title":"JSON","image_sequence.drop_or_add_desc":"JSON","image_sequence.load_prompts":"","image_sequence.output_images_title":"","image_sequence.prompts_list_title":"","image_sequence.download_selected":"","image_sequence.select_all":"","image_sequence.select_none":"","image_sequence.invert_selection":"","image_sequence.run_selected":"","image_sequence.start_queue":"","image_sequence.character_prompt_combination":"","image_sequence.combination_none":"","image_sequence.combination_combine":"","image_sequence.combination_replace":"","image_sequence.status.error":"","image_sequence.status.pending":"","image_sequence.clear_selected_prompts":"","image_sequence.range_from":":","image_sequence.range_to":":","image_sequence.stats.total":": {count}","image_sequence.stats.generated":": {count}","image_sequence.stats.queue":": {count}","image_sequence.edit_in_source":"","image_sequence.edit_prompt":"","image_sequence.select_scene":"","image_sequence.next_scene":"","image_sequence.prev_scene":"","image_sequence.scene_input_label":"","image_sequence.select_square":" (1:1) ","image_sequence.select_landscape":" (16:9) ","image_sequence.select_portrait":" (9:16) ","image_sequence.select_range":"","image_sequence.force_refresh":"","image_sequence.select_scene_frames":"","image_sequence.collapse_other_scenes":"","prompt_sequence_editor.instructionPlaceholder":"...","prompt_sequence_editor.modifying":"...","prompt_sequence_editor.modifySelected":" ({count})","prompt_sequence_editor.sourcePrompts":"","prompt_sequence_editor.finalPrompts":"","prompt_sequence_editor.error.invalidInput":"","geminiChat.mode.general":"","geminiChat.mode.prompt":"","geminiChat.mode.script":"","geminiChat.mode.youtube":"YouTube","image_sequence.shot_type.WS":" (WS) ","image_sequence.shot_type.MS":" (MS) ","image_sequence.shot_type.CU":" (CU) ","image_sequence.shot_type.ECU":" (ECU) ","image_sequence.shot_type.LS":" (LS) "},uC={"dialog.permission.title":"","dialog.permission.description":"","dialog.permission.allow":"","dialog.permission.decline":"","dialog.rename.title":"","dialog.rename.group.title":"","dialog.rename.catalog.title":"","dialog.rename.node.title":"","dialog.rename.label":":","dialog.rename.confirm":"","dialog.rename.cancel":"","dialog.promptEdit.title":"","dialog.promptEdit.nameLabel":":","dialog.promptEdit.contentLabel":":","dialog.promptEdit.confirm":"","dialog.promptEdit.cancel":"","dialog.confirmDelete.title":"","dialog.confirmDelete.message":"","dialog.confirmDelete.confirm":"","dialog.confirmDelete.cancel":"","dialog.confirmCloseTab.title":"","dialog.confirmCloseTab.message":' "{tabName}" ',"dialog.confirmClear.title":"","dialog.confirmClear.message":"","dialog.confirmReset.title":"","dialog.confirmReset.message":"","dialog.confirmReset.confirm":"","dialog.confirmLoad.title":"","dialog.confirmLoad.message":"","dialog.apiKey.title":"API","dialog.apiKey.description":"AI PlatformAPIAPI","dialog.apiKey.billingLink":"","dialog.apiKey.button":"API","dialog.settings.title":"","dialog.settings.apiKeyLabel":"Google Gemini API:","dialog.settings.useDevKeyLabel":"API ()","dialog.settings.instantNodeCloseLabel":"","dialog.settings.nodeAnimationLabel":"","dialog.settings.animationModeLabel":"","dialog.settings.anim.pulse":"","dialog.settings.anim.bladeRunner":"","dialog.settings.anim.none":"","dialog.settings.description":"API","dialog.settings.getKeyLink":"API","dialog.settings.save":"","dialog.deleteNode.title":"","dialog.deleteNode.titlePlural":"","dialog.deleteNode.confirm":"","dialog.deleteNode.cancel":"","dialog.deleteNode.confirmTooltip":" - ","dialog.deleteNode.cancelTooltip":" - ","dialog.deleteNode.dontShowAgain":"","dialog.exitApp.title":"","dialog.exitApp.message":""},pC={"group.button.create":" ({count})","group.rename":"","group.saveToCatalog":"","group.saveToDisk":"","group.ungroup":" (Shift+)","group.duplicate":"","catalog.tabs.groups":"","catalog.tabs.library":"","catalog.tabs.characters":"","catalog.tabs.scripts":"","catalog.tabs.sequences":"","catalog.back":"","catalog.load":"","catalog.newFolder":"","catalog.saveTo":"","catalog.card.addToCanvas":"","catalog.card.rename":"","catalog.card.save":"","catalog.card.delete":"","catalog.empty.description":"","library.loadFromFile":"","library.actions.newFolder":"","library.actions.newPrompt":"","library.actions.copy":"","library.actions.edit":"","library.empty.title":"","library.empty.description":"","library.emptyPrompt":""},hC={...sC,...lC,...cC,...dC,...uC,...pC},mC={"app.title":" ","app.subtitle":"   ","app.error.title":"","app.error.copy":" ","app.error.copied":"!","error.apiKey":"API     .  API   .","error.scriptModifierCanvas":'    "Script Modifier" .    Script Modifier  .',"welcome.title":"","welcome.description":"Prompt Modifier   .    .     .","welcome.apiKeyLabel":"Google Gemini API ","welcome.apiKeyPlaceholder":" API  ...","welcome.apiKeyHelp":"API    .","welcome.getKeyLink":"API  ","welcome.iAmDeveloper":" ","welcome.letsGo":"","welcome.resume":"","welcome.startNew":" ","welcome.freeModeActive":"  ","welcome.selectLanguage":"  ","welcome.navHint":"        ","toast.contentCleared":" ","toast.downloadStarted":" ","toast.characterLoaded":"  ","toast.characterSavedDisk":"   ","toast.copiedToClipboard":" ","toast.pastedFromClipboard":" ","toast.pasteFailed":" ","toast.nodeDuplicated":" ","toast.groupSavedToDisk":'"{groupTitle}"   ',"toast.groupDeleted":"   ","toast.characterSavedCatalog":"  ","toast.promptSaved":"  : {promptName}...","toast.connectionsCut":" ","toast.apiKeySaved":"API   ","toast.cacheCleared":" {count}    ","toast.cacheEmpty":"   ","toast.scriptSaved":"  ","alert.groupSaved":'"{groupTitle}"   .',"alert.loadCatalogFailed":"   ","alert.invalidCatalogFile":"    ","alert.fileNotSupported":'  . "appName"   .',"alert.invalidCatalogStructure":'   . "root" .',"tutorial.step1":"     .","tutorial.step2":'" "  AI   .',"tutorial.step2_waiting":"AI       ...","tutorial.step3":",    .","tutorial.step3b":"   .      .","tutorial.step4":"        .","tutorial.group.catalog":"     .","tutorial.group.general":"      .","tutorial.group.input":",      .","tutorial.group.processing":"AI    .","tutorial.group.character":"  ,   .","tutorial.group.output":"   .","tutorial.group.ai":"Gemini   .","tutorial.group.video":"     .","tutorial.group.scripts":"     .","tutorial.group.file":" ,    .","tutorial.success.title":" !","tutorial.success.message":"Prompt Modifier   .     !","tutorial.success.button":" ","tutorial.skip":"","tutorial.next":"","tutorial.finish":""},gC={"toolbar.settings":"","toolbar.resetCanvas":" ","toolbar.clearCache":"  ","toolbar.home":"","toolbar.edit":" (V)","toolbar.cutter":"  (C) / (Ctrl )","toolbar.selection":" (S) / (Shift )","toolbar.reroute":"  (R) / (Ctrl+Alt )","toolbar.zoom":"/ (Z )","toolbar.snapToGrid":" ","toolbar.smartGuides":" ","toolbar.lineStyleSpaghetti":" ","toolbar.lineStyleOrthogonal":" ","toolbar.resetZoom":" ","toolbar.resetCamera":"  ","toolbar.clearCanvas":" ","toolbar.addNode":"  (F)","toolbar.catalog":"  (Ctrl + Space)","toolbar.addNote":"  (N)","toolbar.addDataReader":"   (Shift + R)","toolbar.addTextInput":"   (T)","toolbar.addImageInput":"   (I)","toolbar.addPromptSequenceEditor":"    (Q)","toolbar.addImageAnalyzer":"   (Shift+A)","toolbar.addPromptAnalyzer":"   (A)","toolbar.addPromptProcessor":"   (P)","toolbar.addCharacterGenerator":"   (Shift+C)","toolbar.addCharacterAnalyzer":"   (Ctrl+Shift+A)","toolbar.addCharacterCard":"   (Ctrl+Shift+C)","toolbar.addImageOutput":"   (O)","toolbar.addImageEditor":"AI    (Shift+I)","toolbar.addImageSequenceGenerator":"    (Shift+Q)","toolbar.addTranslator":"  (L)","toolbar.addGeminiChat":"Gemini   (M)","toolbar.addVideoPromptProcessor":"    (Shift+P)","toolbar.addVideoOutput":"   (Shift+O)","toolbar.addScriptGenerator":"  ","toolbar.addScriptViewer":"   (Shift + V)","toolbar.saveCanvas":"  (Ctrl + S)","toolbar.saveProject":" ","toolbar.loadCanvas":"/  (Ctrl + O)","toolbar.group.general":"","toolbar.group.catalog":"","toolbar.group.input":"","toolbar.group.processing":"","toolbar.group.character":"","toolbar.group.output":"","toolbar.group.aiTools":"AI ","toolbar.group.video":"","toolbar.group.scripts":"","toolbar.group.file":"","toolbar.title":" ","toolbar.dock":"  ","toolbar.detach":"  ","toolbar.expandPanel":" ","toolbar.collapsePanel":" ","toolbar.dockArea.title":" ","toolbar.duplicate":" ","toolbar.duplicateWithContent":"  ","toolbar.dock.q1":" 1/4","toolbar.dock.q2":" 2/4","toolbar.dock.q3":" 3/4","toolbar.dock.q4":" 4/4","toolbar.dock.tl":" ","toolbar.dock.bl":" ","toolbar.dock.tr":" ","toolbar.dock.br":" ","toolbar.dock.left":" ","toolbar.dock.right":" ","toolbar.dock.full":" ","toolbar.dock.exitFull":"  ","toolbar.dock.fullFocus":"  ","hotkeys.show":" ","hotkeys.tools.title":"","hotkeys.tools.edit":" ","hotkeys.tools.cutter":" ","hotkeys.tools.selection":" ","hotkeys.tools.reroute":"  ","hotkeys.tools.zoom":" ","hotkeys.tools.toggleLineStyle":"  ","hotkeys.tools.group":" ","hotkeys.tools.closeNode":"  ","hotkeys.tools.duplicate":" ","hotkeys.tools.duplicateWithContent":"  ","hotkeys.tools.deleteGroup":"  (Shift+Click)","hotkeys.windows.title":"","hotkeys.windows.search":" ","hotkeys.windows.catalog":"","hotkeys.createNode.title":" ","help.panelTitle":"  ","help.title":" ","help.howToUse.title":" ","help.howToUse.content":"Prompt Modifier   !      .    .       .        .    .","help.author":"","contextMenu.undoPosition":"  ","contextMenu.redoPosition":"  ","contextMenu.align.left":"  (F)","contextMenu.align.centerX":"   (E)","contextMenu.align.right":"  (R)","contextMenu.align.top":"  (T)","contextMenu.align.centerY":"   (D)","contextMenu.align.bottom":"  (B)","contextMenu.distribute.horizontal":"  (Ctrl+D)","contextMenu.distribute.vertical":"  (Ctrl+E)","contextMenu.emptySlot":"  ( )","contextMenu.saveSlots":"  ","contextMenu.loadSlots":"  ","quickadd.title":" ","quickadd.group.tools":"","quickadd.group.inputs":"","quickadd.group.processing":"","quickadd.group.character":"","quickadd.group.outputs":"","quickadd.group.ai":"AI ","quickadd.group.video":"","quickadd.group.scripts":"","quickadd.group.general":"","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"","quickadd.tool.cutter":"","quickadd.tool.selection":"","search.placeholder":"  ...","search.noResults":"   .","search.group.input":" & ","search.group.process":" & ","search.group.output":" & ","search.group.ai":"AI ","search.group.video":" & ","search.group.scripts":"","toolbar.exitApp":" "},fC={"node.title.text_input":" ","node.title.image_input":" ","node.title.prompt_processor":" ","node.title.prompt_sanitizer":" ","node.title.video_prompt_processor":"  ","node.title.image_output":" ","node.title.video_output":" ","node.title.prompt_analyzer":" ","node.title.character_analyzer":" ","node.title.character_generator":" ","node.title.character_card":" ","node.title.image_analyzer":" ","node.title.image_editor":"AI  ","node.title.image_sequence_generator":"  ","node.title.prompt_sequence_editor":"  ","node.title.gemini_chat":"Gemini ","node.title.translator":"","node.title.script_generator":" ","node.title.script_viewer":" ","node.title.note":"","node.title.reroute_dot":"  ","node.title.data_reader":" ","node.title.video_editor":"  ","node.title.media_viewer":" ","node.title.data_protection":" ","node.title.pose_creator":"Pose Creator","node.help.text_input":"        .","node.help.image_input":"        .","node.help.prompt_processor":"AI        .","node.help.prompt_sanitizer":"           .","node.help.video_prompt_processor":"       .","node.help.image_output":"   .    .","node.help.video_output":"Veo      .","node.help.prompt_analyzer":" , ,     .","node.help.character_analyzer":"     .","node.help.character_generator":"      .","node.help.character_card":"      .","node.help.image_analyzer":"AI     .","node.help.image_editor":"  /     .","node.help.image_sequence_generator":"     .","node.help.prompt_sequence_editor":"AI        .","node.help.gemini_chat":"   Gemini   .","node.help.translator":"AI      .","node.help.script_generator":"   (, ) .","node.help.script_viewer":"      .","node.help.note":"      .","node.help.reroute_dot":"         .","node.help.data_reader":"        .","node.help.video_editor":"       .","node.help.media_viewer":"        .","node.help.data_protection":"     .    .","node.help.pose_creator":"Visual rig to define and generate character poses for generation guidance.","node.action.expand":"","node.action.collapse":"","node.action.help":"","node.action.download":"","node.action.clear":" ","node.action.refreshChat":"   ","node.action.paste":"","node.action.resetEditor":" ","node.action.saveCharacter":" ","node.action.loadCharacter":" ","node.action.copy":"","node.action.copyImage":" ","node.action.copyTextPrompt":" ","node.action.copyImagePrompt":"  ","node.action.copyVideoPrompt":"  ","node.action.cutConnections":" ","node.action.close":"","node.action.closeNode":"  (Shift+Click  )","node.action.closeNodeSimple":" ","node.action.randomWord":"  ","node.action.processImage":" ","node.action.processImageTitle":"Gemini     .","node.action.editor":"","node.action.rasterEditor":" ","node.action.openInAIEditor":"AI  ","node.action.openInAnalyzer":" ","node.action.outputToInput":"  ","node.action.processChainForward":" ","node.action.executeChain":" ","node.action.executeChainTitle":"       .","node.action.sanitize":"","node.action.rename":" ","node.action.stop":"","node.action.stopping":" ...","node.action.deleteItem":" ","node.action.detachAndPaste":"  ","node.action.delete":"","node.action.flipImage":" ","node.action.pin":"  ","node.action.unpin":"  ","node.mediaViewer.play":"","node.mediaViewer.pause":" ","node.mediaViewer.stop":"","node.mediaViewer.addMarker":" ","node.mediaViewer.exportSRT":"  (SRT)","node.mediaViewer.deleteAllMarkers":"  ","node.mediaViewer.saveMarkers":"  ","node.mediaViewer.loadMarkers":"  ","node.mediaViewer.relink":"  ","node.content.notePlaceholder":"  ...","node.content.dropImage":"    ","node.content.dropMedia":"    ","node.content.processing":" ...","node.content.processingChain":"  ...","node.content.metadataPrompt":"  :","node.content.metadataPromptPlaceholder":"    .","node.content.copyPrompt":"","node.content.prompt":"","node.content.inputPrompt":" ","node.content.enhancedResult":" ","node.content.videoPrompt":" ","node.content.editPromptPlaceholder":"  ...","node.content.enhancedPromptHere":"   ...","node.content.safePrompt":"  ","node.content.generating":" ...","node.content.imageHere":"  ","node.content.generationMode":" ","node.content.aspectRatio":"","node.content.aspectRatioHelp":"    ","node.content.aspectRatioNotSupportedFast":" Imagen    .","node.content.enableAspectRatioFormatting":"  ","node.content.autoDownload":" ","node.content.generateImage":" ","node.content.enhancing":" ...","node.content.enhancePrompt":" ","node.content.sanitizing":" ...","node.content.sanitizedPromptHere":"   ...","node.content.analyzing":" ...","node.content.analyzePrompt":" ","node.content.analyzeImage":" ","node.content.imageToText":" ","node.content.analyzeCharacter":" ","node.content.generateCharacters":" ","node.content.characterPromptPlaceholder":"  ...","node.content.character":"","node.content.clothing":"","node.content.characterPlaceholder":"   ...","node.content.clothingPlaceholder":"   ...","node.content.appearance":"","node.content.personality":"","node.content.environment":"/","node.content.action":"","node.content.emotion":"","node.content.style":"","node.content.environmentPlaceholder":"   ...","node.content.charactersPlaceholder":"  ...","node.content.characters":"","node.content.characterConcepts":" ","node.content.actionPlaceholder":" ...","node.content.emotionPlaceholder":" ...","node.content.stylePlaceholder":"  ...","node.content.descriptionHere":"  ...","node.content.enableOutpainting":" ","node.content.outpaintingPromptPlaceholder":" ...","node.content.inputImage":" ","node.content.dropOrClick":"  ","node.content.outputImage":" ","node.content.applyEdit":" ","node.content.editing":" ...","node.content.chatPlaceholder":" ...","node.content.connectedPlaceholder":" ,  .","node.content.connectedNode":"  ","node.content.connectedEmpty":"   .","node.content.translatePlaceholder":" ...","node.content.translatedTextPlaceholder":" ...","node.content.targetLanguage":" ","node.content.translate":"","node.content.translating":" ...","node.content.scriptPromptPlaceholder":"   ...","node.content.generateScript":" ","node.content.loadScript":"  ","node.content.summary":"","node.content.scenes":"","node.content.unrecognizedFormat":"    .","node.content.frames":"","node.content.characterIndex":"","node.content.readData":" ","node.content.textDataHere":"   .","node.content.noDataRead":'  " "   .',"node.content.previewError":" ","node.content.previewPlaceholder":"  ","node.content.imagePrompt":" ","node.output.allPromptData":"  ","node.note.tab.note":"","node.note.tab.references":"","node.note.nestedImages":" ","node.note.dropPlaceholder":"   ","node.note.addCaption":"","node.note.action.shuffle":"","node.note.action.undoShuffle":" ","node.content.characterTypeShort":":","node.content.numberOfCharactersShort":":","node.content.characterType.simple":"","node.content.characterType.anthro":"","node.content.characterType.chibi":"","node.content.characterType.key_item":" ","node.content.style.simple":"","node.content.style.realistic":"","node.content.style.3d_cartoon":"3D ","node.content.style.3d_realistic":"3D ","node.content.style.2d_animation":"2D ","node.content.style.anime":"","node.content.style.comics":"","node.content.style.custom":" ","node.content.fullDescriptionTitle":"  ","node.content.additionalPromptSuffix":"  ()","image_sequence.auto_crop":"  16:9","image_sequence.create_zip":"ZIP  ","node.content.modificationRequest":" ","node.promptProcessor.safePromptTooltip":"Rewrites the prompt to comply with safety guidelines and avoid policy violations.","node.promptProcessor.technicalPromptTooltip":"Converts the prompt into a highly detailed technical specification (lighting, camera, render settings).","node.promptProcessor.enhanceTooltip":"Uses AI to expand and enrich the prompt with descriptive details.","node.promptProcessor.chainTooltip":"Executes this node and triggers all connected downstream nodes.","image_sequence.tooltip.autoCrop":"Automatically crops generated images to 16:9 ratio.","image_sequence.tooltip.autoDownload":"Automatically saves each image to your device upon generation.","image_sequence.tooltip.createZip":"Packages all selected images into a single ZIP archive for download."},xC={"imageEditor.title":" ","imageEditor.canvasResolution":" ","imageEditor.background":"","imageEditor.toolSettings":" ","imageEditor.snapToEdges":" ","imageEditor.freeAspect":" ","imageEditor.section.aiRequest":"AI  ","imageEditor.input.modificationPlaceholder":'  , : "  "',"imageEditor.action.sendRequest":" ","imageEditor.tooltip.removeObject":" () /  ()","imageEditor.action.removeObject":" ","imageEditor.tool.transform":"","imageEditor.tool.hand":" ()","imageEditor.tool.zoom":"/","imageEditor.tool.pencil":"","imageEditor.tool.rectangle":"","imageEditor.action.fit":" ","imageEditor.action.fill":" ","imageEditor.action.cancel":"","imageEditor.action.resetEdits":" ","imageEditor.action.apply":"","imageViewer.title":" ","imageEditor.outputResolution":" ","imageEditor.outputResolutionHelp":'  . ""    .',"imageEditor.currentSize":" : {width}x{height}","imageEditor.sequenceMode":" ","imageEditor.sequenceModeHelp":" A   .","imageEditor.sequentialCombination":"  ","imageEditor.sequentialCombinationHelp":"  :   A  +   B  .","imageEditor.sequentialPrompt":"  ","imageEditor.sequentialPromptHelp":"  :    +   .","imageEditor.sequentialEditingWithPrompts":"  ","imageEditor.sequentialEditingWithPromptsHelp":"  :  B  +   .  A .","imageEditor.input":"","imageEditor.inputA":" A","imageEditor.inputB":" B","imageEditor.status.queued":" ","imageEditor.status.generating":" ...","imageEditor.action.regenerate":"","imageEditor.tooltip.fit":"    ().","imageEditor.tooltip.fill":"    ().","imageEditor.tooltip.flip":"  .","imageEditor.background.white":"","imageEditor.background.gray":"","imageEditor.background.black":"","imageEditor.background.dark":" ","image_sequence.regenerate":"","image_sequence.stop_queue":" ","image_sequence.move_up":" ","image_sequence.move_down":" ","image_sequence.copy_prompt":" ","image_sequence.add_frame":" ","image_sequence.delete_frame":" ","image_sequence.expand_all_frames":"  /","image_sequence.collapse_all_frames":"  ","image_sequence.expand_all_scenes":"  /","image_sequence.collapse_all_scenes":"  ","image_sequence.expand_all":" ","image_sequence.collapse_all":" ","image_sequence.clear_all_prompts":"  ","image_sequence.add_first_frame":"   ","image_sequence.drop_or_add_title":" JSON    ","image_sequence.drop_or_add_desc":"JSON        .","image_sequence.load_prompts":" ","image_sequence.output_images_title":" ","image_sequence.prompts_list_title":" ","image_sequence.download_selected":"  ","image_sequence.select_all":" ","image_sequence.select_none":" ","image_sequence.invert_selection":" ","image_sequence.run_selected":"  ","image_sequence.start_queue":" ","image_sequence.character_prompt_combination":"  ","image_sequence.combination_none":"","image_sequence.combination_combine":"","image_sequence.combination_replace":" ","image_sequence.status.error":"","image_sequence.status.pending":" ","image_sequence.clear_selected_prompts":"  ","image_sequence.range_from":":","image_sequence.range_to":":","image_sequence.stats.total":" : {count}","image_sequence.stats.generated":": {count}","image_sequence.stats.queue":": {count}","image_sequence.edit_in_source":" ","image_sequence.edit_prompt":" ","image_sequence.select_scene":" ","image_sequence.next_scene":" ","image_sequence.prev_scene":" ","image_sequence.scene_input_label":"","image_sequence.select_square":" (1:1) ","image_sequence.select_landscape":" (16:9) ","image_sequence.select_portrait":" (9:16) ","image_sequence.select_range":" ","image_sequence.force_refresh":" ","image_sequence.select_scene_frames":"    ","image_sequence.collapse_other_scenes":"  ","prompt_sequence_editor.instructionPlaceholder":"   ...","prompt_sequence_editor.modifying":" ...","prompt_sequence_editor.modifySelected":"   ({count})","prompt_sequence_editor.sourcePrompts":" ","prompt_sequence_editor.finalPrompts":" ","prompt_sequence_editor.error.invalidInput":"   .     .","geminiChat.mode.general":"","geminiChat.mode.prompt":" ","geminiChat.mode.script":" ","geminiChat.mode.youtube":"YouTube ","image_sequence.shot_type.WS":"  (WS)   .  .","image_sequence.shot_type.MS":"  (MS)  .   .","image_sequence.shot_type.CU":" (CU)  .","image_sequence.shot_type.ECU":"  (ECU)  .  .","image_sequence.shot_type.LS":"  (LS)    ."},yC={"dialog.permission.title":" ","dialog.permission.description":"         .    .","dialog.permission.allow":"","dialog.permission.decline":"","dialog.rename.title":"  ","dialog.rename.group.title":"  ","dialog.rename.catalog.title":"   ","dialog.rename.node.title":"  ","dialog.rename.label":" :","dialog.rename.confirm":" ","dialog.rename.cancel":"","dialog.promptEdit.title":" ","dialog.promptEdit.nameLabel":":","dialog.promptEdit.contentLabel":":","dialog.promptEdit.confirm":"","dialog.promptEdit.cancel":"","dialog.confirmDelete.title":" ","dialog.confirmDelete.message":"  ?     .","dialog.confirmDelete.confirm":"","dialog.confirmDelete.cancel":"","dialog.confirmCloseTab.title":" ","dialog.confirmCloseTab.message":'"{tabName}"  ?     .',"dialog.confirmClear.title":" ","dialog.confirmClear.message":"  ?     .","dialog.confirmReset.title":" ","dialog.confirmReset.message":"   ?    .","dialog.confirmReset.confirm":"","dialog.confirmLoad.title":" ","dialog.confirmLoad.message":"     .     . ?","dialog.apiKey.title":"API  ","dialog.apiKey.description":'  "AI Platform" API   API  .       .',"dialog.apiKey.billingLink":"   ","dialog.apiKey.button":"API  ","dialog.settings.title":"","dialog.settings.apiKeyLabel":" Google Gemini API :","dialog.settings.useDevKeyLabel":" API   ()","dialog.settings.instantNodeCloseLabel":"  ","dialog.settings.nodeAnimationLabel":"  ","dialog.settings.animationModeLabel":"  ","dialog.settings.anim.pulse":"","dialog.settings.anim.bladeRunner":" ","dialog.settings.anim.none":"","dialog.settings.description":"       API  .    .","dialog.settings.getKeyLink":" API  ","dialog.settings.save":"","dialog.deleteNode.title":" ?","dialog.deleteNode.titlePlural":" ?","dialog.deleteNode.confirm":"","dialog.deleteNode.cancel":"","dialog.deleteNode.confirmTooltip":"  -     ","dialog.deleteNode.cancelTooltip":"  -   ","dialog.deleteNode.dontShowAgain":"  ","dialog.exitApp.title":" ?","dialog.exitApp.message":" ?      ."},vC={"group.button.create":"  ({count})","group.rename":"  ","group.saveToCatalog":" ","group.saveToDisk":" ","group.ungroup":"  (Shift+Click   )","group.duplicate":"   ","catalog.tabs.groups":"","catalog.tabs.library":"","catalog.tabs.characters":"","catalog.tabs.scripts":"","catalog.tabs.sequences":"","catalog.back":"","catalog.load":" ","catalog.newFolder":" ","catalog.saveTo":" ","catalog.card.addToCanvas":" ","catalog.card.rename":" ","catalog.card.save":"","catalog.card.delete":"","catalog.empty.description":"   .       .","library.loadFromFile":"","library.actions.newFolder":" ","library.actions.newPrompt":" ","library.actions.copy":"","library.actions.edit":"","library.empty.title":" ","library.empty.description":"   .","library.emptyPrompt":" "},wC={...mC,...gC,...fC,...xC,...yC,...vC},xn={en:{name:"English",short:"EN",nativeName:"English"},ru:{name:"Russian",short:"RU",nativeName:""},es:{name:"Spanish",short:"ES",nativeName:"Espaol"},fr:{name:"French",short:"FR",nativeName:"Franais"},de:{name:"German",short:"DE",nativeName:"Deutsch"},it:{name:"Italian",short:"IT",nativeName:"Italiano"},pt:{name:"Portuguese",short:"PT",nativeName:"Portugus"},uz:{name:"Uzbek",short:"UZ",nativeName:"O'zbek"},zh:{name:"Chinese",short:"ZH",nativeName:""},ja:{name:"Japanese",short:"JA",nativeName:""},ko:{name:"Korean",short:"KO",nativeName:""}},td={en:rb,ru:ub,es:yb,uz:Sb,fr:Ab,de:Ob,it:Wb,pt:Qb,zh:iC,ja:hC,ko:wC},Po=(e,t,o)=>{const r=td[e]||td.en,a=td.en;let i=r[t]||a[t]||t;return o&&Object.entries(o).forEach(([s,l])=>{i=i.replace(`{${s}}`,String(l))}),i},o1=y.createContext(void 0),Pt=()=>{const e=y.useContext(o1);if(!e)throw new Error("useLanguage must be used within a LanguageProvider");return e};var q=(e=>(e.TEXT_INPUT="TEXT_INPUT",e.IMAGE_INPUT="IMAGE_INPUT",e.PROMPT_PROCESSOR="PROMPT_PROCESSOR",e.VIDEO_PROMPT_PROCESSOR="VIDEO_PROMPT_PROCESSOR",e.IMAGE_OUTPUT="IMAGE_OUTPUT",e.VIDEO_OUTPUT="VIDEO_OUTPUT",e.PROMPT_ANALYZER="PROMPT_ANALYZER",e.CHARACTER_ANALYZER="CHARACTER_ANALYZER",e.CHARACTER_GENERATOR="CHARACTER_GENERATOR",e.CHARACTER_CARD="CHARACTER_CARD",e.IMAGE_ANALYZER="IMAGE_ANALYZER",e.IMAGE_EDITOR="IMAGE_EDITOR",e.IMAGE_SEQUENCE_GENERATOR="IMAGE_SEQUENCE_GENERATOR",e.PROMPT_SEQUENCE_EDITOR="PROMPT_SEQUENCE_EDITOR",e.GEMINI_CHAT="GEMINI_CHAT",e.TRANSLATOR="TRANSLATOR",e.SCRIPT_GENERATOR="SCRIPT_GENERATOR",e.SCRIPT_VIEWER="SCRIPT_VIEWER",e.NOTE="NOTE",e.REROUTE_DOT="REROUTE_DOT",e.PROMPT_SANITIZER="PROMPT_SANITIZER",e.DATA_READER="DATA_READER",e.VIDEO_EDITOR="VIDEO_EDITOR",e.MEDIA_VIEWER="MEDIA_VIEWER",e.DATA_PROTECTION="DATA_PROTECTION",e.POSE_CREATOR="POSE_CREATOR",e))(q||{}),$t=(e=>(e.FOLDER="FOLDER",e.PROMPT="PROMPT",e))($t||{});const bC=(()=>{const e=new Uint32Array(256);for(let t=0;t<256;t++){let o=t;for(let r=0;r<8;r++)o=o&1?3988292384^o>>>1:o>>>1;e[t]=o}return t=>{let o=-1;for(let r=0;r<t.length;r++)o=o>>>8^e[(o^t[r])&255];return(o^-1)>>>0}})();function nd(e){return new TextEncoder().encode(e)}function Vs(e){return new TextDecoder().decode(e)}const $i=(e,t,o)=>{if(!e.startsWith("data:image/png;base64,"))return console.warn("Attempted to add metadata to a non-PNG image."),e;try{const r=e.substring(22),a=atob(r),i=new Uint8Array(a.length);for(let _=0;_<i.length;_++)i[_]=a.charCodeAt(_);const s=[137,80,78,71,13,10,26,10];if(i.length<8)return console.error("Invalid PNG: file is too short."),e;for(let _=0;_<s.length;_++)if(i[_]!==s[_])return console.error("Invalid PNG signature."),e;let l=-1,c=8;for(;c<i.length;){if(c+8>i.length){console.warn("Malformed PNG: not enough data for chunk header.");break}const E=new DataView(i.buffer,c).getUint32(0,!1),I=i.slice(c+4,c+8);if(I[0]===73&&I[1]===69&&I[2]===78&&I[3]===68){l=c;break}const B=12+E;if(c+B>i.length){console.warn(`Malformed PNG: chunk of type ${Vs(I)} with length ${E} exceeds file bounds.`);break}c+=B}if(l===-1)return console.error("Could not find IEND chunk in PNG."),e;const d=nd(t),u=nd(o),p=new Uint8Array(d.length+1+u.length);p.set(d,0),p.set([0],d.length),p.set(u,d.length+1);const m=nd("tEXt"),w=new Uint8Array(m.length+p.length);w.set(m),w.set(p,m.length);const k=bC(w),b=new ArrayBuffer(4);new DataView(b).setUint32(0,p.length,!1);const x=new ArrayBuffer(4);new DataView(x).setUint32(0,k,!1);const f=new Uint8Array([...new Uint8Array(b),...m,...p,...new Uint8Array(x)]),h=new Uint8Array(i.length+f.length);h.set(i.slice(0,l),0),h.set(f,l),h.set(i.slice(l),l+f.length);let v="";for(let _=0;_<h.length;_++)v+=String.fromCharCode(h[_]);return`data:image/png;base64,${btoa(v)}`}catch(r){return console.error("Failed to add metadata to PNG:",r),e}},CC=async e=>new Promise(t=>{if(!e||!e.startsWith("data:image/png;base64,"))return t({});try{const o=e.substring(22),r=atob(o),a=new Uint8Array(r.length);for(let l=0;l<a.length;l++)a[l]=r.charCodeAt(l);const i={};let s=8;for(;s<a.length;){const l=new DataView(a.buffer,s);if(s+8>a.length)break;const c=l.getUint32(0,!1),d=Vs(a.slice(s+4,s+8));if(s+12+c>a.length)break;if(d==="tEXt"){const u=a.slice(s+8,s+8+c),p=u.indexOf(0);if(p!==-1){const m=Vs(u.slice(0,p)),w=Vs(u.slice(p+1));i[m]=w}}if(d==="IEND")break;s+=12+c}t(i)}catch(o){console.error("Failed to read metadata from PNG:",o),t({})}}),kl=async e=>{const t=await CC(e);return t.prompt||t.Prompt||t.parameters||t.Comment||null},Ft=40,Jt=12,In=Ft+4,Ut={"1:1":1,"16:9":2,"9:16":3},Yl=e=>[q.IMAGE_EDITOR,q.PROMPT_SEQUENCE_EDITOR,q.IMAGE_SEQUENCE_GENERATOR,q.POSE_CREATOR].includes(e),kC=(e,t,o)=>{const r={x:e.x-t.x,y:e.y-t.y},a={x:o.x-t.x,y:o.y-t.y},i=Math.max(0,Math.min(1,(r.x*a.x+r.y*a.y)/(a.x*a.x+a.y*a.y))),s=r.x-i*a.x,l=r.y-i*a.y;return Math.sqrt(s*s+l*l)},_C=(e,t,o,r,a)=>{const i=1-e;return{x:i*i*i*t.x+3*i*i*e*o.x+3*i*e*e*r.x+e*e*e*a.x,y:i*i*i*t.y+3*i*e*e*o.y+3*i*e*e*r.y+e*e*e*a.y}},SC=(e,t,o,r=20)=>{const a={x:t.x+Math.abs(o.x-t.x)*.5,y:t.y},i={x:o.x-Math.abs(o.x-t.x)*.5,y:o.y},s=10;for(let l=0;l<=s;l++){const c=l/s,d=_C(c,t,a,i,o);if(Math.hypot(e.x-d.x,e.y-d.y)<r)return!0}return kC(e,t,o)<r},qr=e=>{if(e.length===0)return null;let t=1/0,o=1/0,r=-1/0,a=-1/0;e.forEach(l=>{t=Math.min(t,l.position.x),o=Math.min(o,l.position.y),r=Math.max(r,l.position.x+l.width);const c=l.isCollapsed?In:l.height;a=Math.max(a,l.position.y+c)});const i=30,s=70;return{position:{x:t-i,y:o-s},width:r-t+i*2,height:a-o+s+i}},Xn=(e,t)=>{switch(e.type){case q.TEXT_INPUT:return"text";case q.IMAGE_INPUT:return t==="text"?"text":"image";case q.PROMPT_PROCESSOR:return"text";case q.PROMPT_SANITIZER:return"text";case q.VIDEO_PROMPT_PROCESSOR:return"text";case q.TRANSLATOR:return"text";case q.PROMPT_ANALYZER:return"text";case q.CHARACTER_ANALYZER:return"text";case q.CHARACTER_GENERATOR:return"character_data";case q.CHARACTER_CARD:return t==="image"?"image":["prompt","appearance","personality","clothing"].includes(t||"")?"text":"character_data";case q.IMAGE_ANALYZER:return t==="image"?"image":t==="text"?"text":null;case q.IMAGE_EDITOR:return"image";case q.GEMINI_CHAT:return null;case q.IMAGE_OUTPUT:return"image";case q.VIDEO_OUTPUT:return"video";case q.SCRIPT_GENERATOR:return"text";case q.SCRIPT_VIEWER:return"text";case q.PROMPT_SEQUENCE_EDITOR:return t==="all_data"?"text":null;case q.IMAGE_SEQUENCE_GENERATOR:return t==="all_images"?"image":null;case q.NOTE:return t==="all_images"?"image":t==="all_captions"?"text":null;case q.REROUTE_DOT:try{return JSON.parse(e.value||"{}").type||null}catch{return null}case q.VIDEO_EDITOR:return"video";case q.MEDIA_VIEWER:try{return JSON.parse(e.value||"{}").type==="audio"?"audio":"video"}catch{return"video"}case q.DATA_PROTECTION:return"text";case q.POSE_CREATOR:return"image";default:return null}},Ws=(e,t)=>{switch(e.type){case q.TEXT_INPUT:return null;case q.PROMPT_PROCESSOR:return"text";case q.PROMPT_SANITIZER:return"text";case q.VIDEO_PROMPT_PROCESSOR:return"text";case q.TRANSLATOR:return"text";case q.PROMPT_ANALYZER:return"text";case q.CHARACTER_ANALYZER:return"text";case q.CHARACTER_GENERATOR:return"text";case q.IMAGE_ANALYZER:return"image";case q.IMAGE_EDITOR:return t;case q.IMAGE_OUTPUT:return"text";case q.VIDEO_OUTPUT:return"text";case q.IMAGE_SEQUENCE_GENERATOR:return"character_data";case q.GEMINI_CHAT:return"text";case q.SCRIPT_GENERATOR:return"text";case q.SCRIPT_VIEWER:return null;case q.PROMPT_SEQUENCE_EDITOR:return null;case q.DATA_READER:return null;case q.REROUTE_DOT:return null;case q.VIDEO_EDITOR:return null;case q.NOTE:return null;case q.MEDIA_VIEWER:return null;case q.DATA_PROTECTION:return"text";case q.POSE_CREATOR:return null;case q.CHARACTER_CARD:return"text";default:return null}},Wa=e=>{const{type:t}=e;switch(t){case q.POSE_CREATOR:return JSON.stringify({image:null,aspectRatio:"1:1",resolution:"1K",joints:[]});case q.VIDEO_EDITOR:return JSON.stringify({currentTime:0,totalDuration:30,clips:[],tracks:[{id:2,name:"V2",type:"video",isMuted:!1,isVisible:!0},{id:1,name:"V1",type:"video",isMuted:!1,isVisible:!0},{id:101,name:"A1",type:"audio",isMuted:!1,isVisible:!0}],mediaFiles:[],isPlaying:!1,zoom:20});case q.TEXT_INPUT:case q.PROMPT_SANITIZER:case q.IMAGE_OUTPUT:case q.VIDEO_OUTPUT:return"";case q.NOTE:return JSON.stringify({text:"",references:[],activeTab:"note"});case q.PROMPT_PROCESSOR:return JSON.stringify({inputPrompt:"",prompt:"",safePrompt:!0});case q.VIDEO_PROMPT_PROCESSOR:return JSON.stringify({inputPrompt:"",prompt:""});case q.IMAGE_INPUT:return JSON.stringify({image:null,prompt:""});case q.PROMPT_ANALYZER:return JSON.stringify({environment:"",characters:[],action:"",emotion:"",style:"",softPrompt:!1});case q.CHARACTER_ANALYZER:return JSON.stringify({character:"",clothing:""});case q.CHARACTER_GENERATOR:return JSON.stringify({prompt:"",characters:[]});case q.CHARACTER_CARD:return JSON.stringify([{name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:""}]);case q.IMAGE_ANALYZER:return JSON.stringify({image:null,description:"",softPrompt:!1});case q.IMAGE_SEQUENCE_GENERATOR:return JSON.stringify({prompts:[],images:{},currentIndex:-1,isGenerating:!1,autoDownload:!1,selectedFrameNumber:null,frameStatuses:{},aspectRatio:"16:9",characterConcepts:[],model:"gemini-2.5-flash-image",characterPromptCombination:"replace",enableAspectRatio:!1,isStyleCollapsed:!0,checkedFrameNumbers:[],topPaneHeight:440,leftPaneWidth:570,autoCrop169:!0});case q.PROMPT_SEQUENCE_EDITOR:return JSON.stringify({instruction:"",sourcePrompts:[],modifiedPrompts:[],leftPaneWidth:500,checkedSourceFrameNumbers:[],selectedFrameNumber:null,targetLanguage:"en",modificationModel:"gemini-3-flash-preview",sceneContexts:{},expandedSceneContexts:[]});case q.IMAGE_EDITOR:return JSON.stringify({inputImages:[],prompt:"",outputImage:null,aspectRatio:"1:1",enableAspectRatio:!1,enableOutpainting:!1,outpaintingPrompt:"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.",model:"gemini-2.5-flash-image",autoDownload:!0,autoCrop169:!1,leftPaneWidth:360,topPaneHeight:330});case q.GEMINI_CHAT:return JSON.stringify({messages:[],currentInput:"",lastPrompt:""});case q.TRANSLATOR:return JSON.stringify({targetLanguage:"ru",inputText:"",translatedText:"",image:null});case q.SCRIPT_GENERATOR:return JSON.stringify({prompt:"",summary:"",detailedCharacters:[],scenes:[],targetLanguage:"en"});case q.SCRIPT_VIEWER:return"{}";case q.REROUTE_DOT:return JSON.stringify({type:null});case q.DATA_READER:return JSON.stringify({text:"",image:null});case q.MEDIA_VIEWER:return JSON.stringify({src:"",type:"video",name:"",markers:[],volume:.4});case q.DATA_PROTECTION:return JSON.stringify({score:0,bits:100,survivedWords:[]});case q.POSE_CREATOR:return JSON.stringify({joints:[],aspectRatio:"1:1",resolution:"1K",renderedImage:null,aiPrompt:""});default:return""}},r1=e=>{const{type:t,value:o}=e,r=Wa(e);try{const a=JSON.parse(o||"{}"),i=JSON.parse(r);switch(t){case q.POSE_CREATOR:return JSON.stringify({...i,joints:a.joints||i.joints,aspectRatio:a.aspectRatio||i.aspectRatio,resolution:a.resolution||i.resolution});case q.VIDEO_EDITOR:return JSON.stringify({...i,tracks:a.tracks||i.tracks,totalDuration:a.totalDuration||30,mediaFiles:a.mediaFiles||[]});case q.PROMPT_PROCESSOR:return JSON.stringify({inputPrompt:a.inputPrompt||"",prompt:"",safePrompt:a.safePrompt!==void 0?a.safePrompt:!0});case q.VIDEO_PROMPT_PROCESSOR:return JSON.stringify({inputPrompt:a.inputPrompt||"",prompt:""});case q.TRANSLATOR:return JSON.stringify({...i,targetLanguage:a.targetLanguage||"ru"});case q.IMAGE_EDITOR:return JSON.stringify({...i,aspectRatio:a.aspectRatio||"1:1",enableAspectRatio:a.enableAspectRatio!==void 0?a.enableAspectRatio:!1,enableOutpainting:a.enableOutpainting!==void 0?a.enableOutpainting:!1,outpaintingPrompt:a.outpaintingPrompt||"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.",model:a.model||"gemini-2.5-flash-image",autoDownload:a.autoDownload!==void 0?a.autoDownload:!0,autoCrop169:a.autoCrop169!==void 0?a.autoCrop169:!1,leftPaneWidth:a.leftPaneWidth||360,topPaneHeight:a.topPaneHeight||330});case q.IMAGE_SEQUENCE_GENERATOR:return JSON.stringify({...i,prompts:[],characterConcepts:a.characterConcepts||[],aspectRatio:a.aspectRatio||"16:9",autoDownload:a.autoDownload||!1,model:a.model||"gemini-2.5-flash-image",topPaneHeight:a.topPaneHeight||440,leftPaneWidth:a.leftPaneWidth||570,enableAspectRatio:a.enableAspectRatio!==void 0?a.enableAspectRatio:!1,isStyleCollapsed:a.isStyleCollapsed!==void 0?a.isStyleCollapsed:!0,autoCrop169:a.autoCrop169!==void 0?a.autoCrop169:!0});case q.CHARACTER_CARD:return JSON.stringify({...i,name:a.name,index:a.index,prompt:a.prompt,fullDescription:a.fullDescription,selectedRatio:a.selectedRatio});case q.NOTE:return r;case q.PROMPT_SEQUENCE_EDITOR:return JSON.stringify({...i,targetLanguage:a.targetLanguage,modificationModel:a.modificationModel,leftPaneWidth:a.leftPaneWidth||500});case q.MEDIA_VIEWER:return r;case q.DATA_PROTECTION:return r;default:return r}}catch{return r}return r},Da=e=>{switch(e){case q.POSE_CREATOR:return{minWidth:600,minHeight:800};case q.VIDEO_EDITOR:return{minWidth:920,minHeight:640};case q.TEXT_INPUT:return{minWidth:460,minHeight:300};case q.IMAGE_INPUT:return{minWidth:460,minHeight:340};case q.PROMPT_PROCESSOR:return{minWidth:460,minHeight:410};case q.PROMPT_SANITIZER:return{minWidth:460,minHeight:280};case q.VIDEO_PROMPT_PROCESSOR:return{minWidth:460,minHeight:410};case q.IMAGE_OUTPUT:return{minWidth:460,minHeight:700};case q.VIDEO_OUTPUT:return{minWidth:460,minHeight:680};case q.PROMPT_ANALYZER:return{minWidth:460,minHeight:1e3};case q.CHARACTER_ANALYZER:return{minWidth:460,minHeight:500};case q.CHARACTER_GENERATOR:return{minWidth:500,minHeight:840};case q.CHARACTER_CARD:return{minWidth:520,minHeight:960};case q.IMAGE_ANALYZER:return{minWidth:460,minHeight:680};case q.IMAGE_EDITOR:return{minWidth:1e3,minHeight:920};case q.IMAGE_SEQUENCE_GENERATOR:return{minWidth:1400,minHeight:920};case q.PROMPT_SEQUENCE_EDITOR:return{minWidth:1300,minHeight:920};case q.GEMINI_CHAT:return{minWidth:400,minHeight:640};case q.TRANSLATOR:return{minWidth:380,minHeight:640};case q.SCRIPT_GENERATOR:return{minWidth:500,minHeight:1e3};case q.SCRIPT_VIEWER:return{minWidth:500,minHeight:600};case q.NOTE:return{minWidth:460,minHeight:660};case q.REROUTE_DOT:return{minWidth:60,minHeight:40};case q.DATA_READER:return{minWidth:400,minHeight:500};case q.MEDIA_VIEWER:return{minWidth:480,minHeight:320};case q.DATA_PROTECTION:return{minWidth:800,minHeight:600};default:return{minWidth:200,minHeight:150}}},zp=(e,t,o)=>{const r=(s,l,c)=>{var b;const d=s.isCollapsed;if(s.type===q.REROUTE_DOT){let x=!1;try{x=JSON.parse(s.value||"{}").direction==="RL"}catch{}return{x:s.position.x+(c?x?s.width:0:x?0:s.width),y:s.position.y+s.height/2}}if(s.dockState){const x=c?0:160;let f=c?[void 0]:[void 0];s.type===q.IMAGE_EDITOR&&c?f=["image","text"]:s.type===q.IMAGE_SEQUENCE_GENERATOR&&c&&(f=["character_data","prompt_input"]);let h=f.indexOf(l);return h===-1&&(h=0),{x:s.position.x+x,y:s.position.y+(h+1)*(48/(f.length+1))}}const u=Da(s.type),p=Math.max(s.width,u.minWidth),m=d?In:Math.max(s.height,u.minHeight),w=c?0:p;let k=m/2;if(d)if(s.type===q.CHARACTER_CARD&&!c){const x=["all_data","primary_data"],f=["image","prompt","appearance","personality","clothing"];let h=[...x,...f];s.collapsedHandles&&(h=x);const v=h.indexOf(l||"");v!==-1?k=(v+1)*(In/(h.length+1)):k=In/2}else if(s.type===q.VIDEO_EDITOR&&c){const x=["video","audio","image","text"],f=x.indexOf(l||"");f!==-1?k=(f+1)*(In/(x.length+1)):k=In/2}else k=In/2;else if(s.type===q.IMAGE_EDITOR&&c){let x=330,f=!1,h=!1;try{const N=JSON.parse(s.value||"{}");N.topPaneHeight&&(x=N.topPaneHeight),f=N.isSequenceMode&&N.isSequentialCombinationMode,h=N.isSequenceMode&&N.isSequentialEditingWithPrompts}catch{}const v=Ft+Jt;if(l==="image")h?k=m/2:f?k=v+x*.25:k=v+x*.5;else if(l==="image_b")f?k=v+x*.75:h?k=v+x*.5:k=m/2;else if(l==="text"){const _=v+x+16,E=m-_-Jt;k=_+E/2}}else if(s.type===q.IMAGE_SEQUENCE_GENERATOR&&c){let x="normal";try{const v=JSON.parse(s.value||"{}");v.conceptsMode&&(x=v.conceptsMode)}catch{}let f=390;x==="collapsed"?f=37:x==="expanded"&&(f=m-Ft-Jt);const h=Ft+Jt;if(l==="character_data")k=h+f/2;else if(l==="prompt_input")if(x==="expanded")k=m-10;else{const N=h+f+8;k=N+(m-N-Jt)/2}}else if(s.type===q.VIDEO_EDITOR&&c){const x=Ft+20,f=50;l==="video"?k=x:l==="audio"?k=x+f:l==="image"?k=x+f*2:l==="text"?k=x+f*3:k=m/2}else if(s.type===q.IMAGE_INPUT&&!c){const x=m-Ft-2*Jt,f=Math.max(0,x);l==="image"?k=Ft+Jt+f/4:l==="text"&&(k=m-80)}else if(s.type===q.CHARACTER_CARD&&!c){const x=["all_data","primary_data"],f=["image","prompt","appearance","personality","clothing"];let h=[...x,...f];s.collapsedHandles&&(h=x);const N=(m-Ft-20)/(h.length+1),_=h.indexOf(l||"");_!==-1&&(k=Ft+N*(_+1))}else if(s.type===q.PROMPT_ANALYZER&&!c)try{const f=((b=JSON.parse(s.value||"{}").characters)==null?void 0:b.length)||0,h=4+f;let v=0;l==="environment"?v=0:l!=null&&l.startsWith("character-")?v=1+parseInt(l.split("-")[1]):l==="action"?v=1+f:l==="emotion"?v=2+f:l==="style"&&(v=3+f),k=Ft+Jt+(m-Ft-60)/h*(v+.5)}catch{}else if(s.type===q.IMAGE_ANALYZER&&!c){const x=m-Ft-2*Jt,f=8,h=(x-f)/2,v=Ft+Jt;l==="image"?k=v+h/2:l==="text"&&(k=v+h+f+h/2)}return{x:s.position.x+w,y:s.position.y+k}},a=r(e,o.fromHandleId,!1),i=r(t,o.toHandleId,!0);return{start:a,end:i}},kr=async(e,t)=>new Promise((o,r)=>{if(!e)return r(new Error("Source image is empty."));const a=new Image;a.onload=()=>{const i=a.width/a.height,[s,l]=t.split(":").map(Number),c=s/l;if(Math.abs(i-c)<.01)return o({formattedImage:e,needsFormatting:!1});let d,u,p,m;i>c?(d=a.width,u=a.width/c,p=0,m=(u-a.height)/2):(u=a.height,d=a.height*c,p=(d-a.width)/2,m=0);const w=document.createElement("canvas");w.width=d,w.height=u;const k=w.getContext("2d");if(!k)return r(new Error("Could not get canvas context"));k.fillStyle="white",k.fillRect(0,0,w.width,w.height),k.drawImage(a,p,m,a.width,a.height),o({formattedImage:w.toDataURL("image/png"),needsFormatting:!0})},a.onerror=()=>{console.error("Failed to load image for formatting. The provided image source might be invalid or corrupted."),r(new Error("Failed to load the provided image. It might be corrupted or in an unsupported format."))},a.src=e}),za=e=>new Promise((t,o)=>{if(!e)return o(new Error("Source image is empty for cropping."));const r=new Image;r.onload=()=>{const a=1.7777777777777777,i=r.width/r.height;if(i<1.2||Math.abs(i-a)<.02)return t(e);let s,l,c=0,d=0;i>a?(l=r.height,s=r.height*a,c=(r.width-s)/2):(s=r.width,l=r.width/a,d=(r.height-l)/2);const u=document.createElement("canvas");u.width=s,u.height=l;const p=u.getContext("2d");if(!p)return o(new Error("Could not get canvas context for cropping."));p.drawImage(r,c,d,s,l,0,0,s,l),t(u.toDataURL("image/png"))},r.onerror=()=>{o(new Error("Failed to load the provided image for cropping."))},r.src=e}),NC=e=>new Promise((t,o)=>{if(!e)return o(new Error("Source image is empty for cropping."));const r=new Image;r.onload=()=>{const a=Math.min(r.width,r.height),i=(r.width-a)/2,s=(r.height-a)/2,l=document.createElement("canvas");l.width=a,l.height=a;const c=l.getContext("2d");if(!c)return o(new Error("Could not get canvas context for cropping."));c.drawImage(r,i,s,a,a,0,0,a,a),t(l.toDataURL("image/png"))},r.onerror=()=>{o(new Error("Failed to load the provided image for cropping."))},r.src=e}),Ot=async(e,t,o)=>new Promise((r,a)=>{if(!e)return a(new Error("Source image is empty."));const i=new Image;i.onload=()=>{const s=document.createElement("canvas"),l=s.getContext("2d");if(!l)return a(new Error("Could not get canvas context"));let{width:c,height:d}=i;const u=c/d;c>t&&(c=t,d=c/u),d>o&&(d=o,c=d*u),s.width=c,s.height=d,l.drawImage(i,0,0,c,d),r(s.toDataURL("image/jpeg",.8))},i.onerror=s=>{console.error("Failed to load image for thumbnail generation:",s),a(new Error("Failed to load the provided image for thumbnailing."))},i.src=e}),EC=(e,t,o,r,a,i)=>{const[s,l]=y.useState(e),c=y.useRef(t),d=y.useCallback((V,j)=>{l(P=>P.map(S=>S.id===V?{...S,value:j}:S))},[]),u=y.useCallback((V,j)=>{l(P=>P.map(S=>S.id===V?{...S,title:j}:S))},[]),p=y.useCallback(V=>{l(j=>j.map(P=>P.id===V&&P.isNewlyCreated?{...P,isNewlyCreated:!1}:P))},[]),m=V=>{l(j=>j.filter(P=>P.id!==V))},w=y.useCallback(V=>{const j=s.find(A=>A.id===V);if(!j)return;c.current++;const P=`node-${c.current}-${Date.now()}`,S={...j,id:P,position:{x:j.position.x+30,y:j.position.y+30},isNewlyCreated:!0,value:r1(j)};return l(A=>[...A,S]),o(r("toast.nodeDuplicated")),P},[s,c,l,o,r]),k=y.useCallback(V=>{const j=s.find(A=>A.id===V);if(!j)return;c.current++;const P=`node-${c.current}-${Date.now()}`,S={...j,id:P,position:{x:j.position.x+30,y:j.position.y+30},isNewlyCreated:!0,value:j.value};for(let A=0;A<=100;A++){const O=i(V,A);O&&a(P,A,O)}return l(A=>[...A,S]),o(r("toast.nodeDuplicated")),P},[s,c,l,o,r,i,a]);return{nodes:s,setNodes:l,nodeIdCounter:c,handleValueChange:d,handleRenameNode:u,handleDeleteNode:m,handleDuplicateNode:w,handleDuplicateNodeWithContent:k,handlePasteNodeValue:async V=>{const j=s.find(P=>P.id===V);if(!j)return"Node not found.";try{const P=await navigator.clipboard.readText();if(!P)return"Clipboard empty.";if(j.type===q.CHARACTER_CARD)try{const S=JSON.parse(P);let A=[];if(Array.isArray(S)?A=S:typeof S=="object"&&S!==null&&(A=[S]),A.length>0&&(A[0].type==="character-card"||A[0].name||A[0].imageSources||A[0].prompt)){let z=[];try{z=JSON.parse(j.value||"[]"),Array.isArray(z)||(z=[z])}catch{z=[]}const L=z.length,W=await Promise.all(A.map(async($,Y)=>{const oe=L+Y,le=$.imageSources||{"1:1":null,"16:9":null,"9:16":null},K={"1:1":null,"16:9":null,"9:16":null};$.image&&!$.imageSources&&(le["1:1"]=$.image);const ie={};for(const[de,re]of Object.entries(le)){let R=re;typeof R=="string"&&!R.startsWith("data:")&&R.length>20&&(R=`data:image/png;base64,${R}`),ie[de]=R}for(const[de,re]of Object.entries(ie))if(typeof re=="string"&&re.startsWith("data:")){const R=Ut[de];R&&a(V,oe*10+R,re);try{const J=await Ot(re,256,256);K[de]=J}catch{K[de]=re}}else K[de]=re;const Z=$.selectedRatio||"1:1",se=ie[Z];return se&&typeof se=="string"&&se.startsWith("data:")&&a(V,oe*10,se),{id:`char-card-${Date.now()}-${oe}`,name:$.name||"",index:$.index||$.alias||`Entity-${oe+1}`,prompt:$.prompt||$.imagePrompt||"",fullDescription:$.fullDescription||$.description||"",selectedRatio:Z,image:K[Z],thumbnails:K,isOutput:!1}})),D=[...z,...W],te=D.length*410+110;return l($=>$.map(Y=>Y.id===V?{...Y,value:JSON.stringify(D),width:te}:Y)),o(r("toast.pastedFromClipboard")),null}}catch{}else if(j.type===q.NOTE)try{const S=JSON.parse(j.value||"{}"),A=S.text||"",O=A?`${A}
${P}`:P;return d(V,JSON.stringify({...S,text:O})),o(r("toast.pastedFromClipboard")),null}catch{const A=j.value?`${j.value}
${P}`:P;return d(V,JSON.stringify({text:A,references:[],activeTab:"note"})),o(r("toast.pastedFromClipboard")),null}return d(V,P),o(r("toast.pastedFromClipboard")),null}catch{return o(r("toast.pasteFailed"),"error"),"Could not read from clipboard."}},handlePasteImageToNode:async(V,j=null)=>{const P=S=>{const A=new FileReader;A.onload=async O=>{var D;const z=(D=O.target)==null?void 0:D.result;if(!z)return;const L=await Ot(z,512,512),W=await kl(z);l(T=>{const F=T.findIndex(le=>le.id===V);if(F===-1)return T;const te=T[F];let $=te.value,Y=te.width;try{const le=JSON.parse(te.value||"{}");if(te.type===q.IMAGE_EDITOR){const K=[...le.inputImages||[],L];a(V,K.length,z),$=JSON.stringify({...le,inputImages:K})}else if(te.type===q.NOTE){const K=le.references||[],ie=`ref-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,Z=K.length;a(V,Z,z);const se={id:ie,image:L,caption:W||""};$=JSON.stringify({...le,references:[...K,se],activeTab:"reference"})}else if(te.type===q.IMAGE_INPUT||te.type===q.IMAGE_ANALYZER||te.type===q.CHARACTER_CARD||te.type===q.TRANSLATOR)if(te.type===q.TRANSLATOR&&($=JSON.stringify({...le,image:L})),a(V,0,z),te.type===q.CHARACTER_CARD){let K=Array.isArray(le)?[...le]:[le];const ie=K.length,Z="1:1",se={"1:1":L,"16:9":null,"9:16":null},de={id:`char-card-${Date.now()}-${ie}`,name:`New Entity ${ie+1}`,index:`Entity-${ie+1}`,image:L,thumbnails:se,selectedRatio:Z,prompt:W||"",fullDescription:"",targetLanguage:"en",isOutput:K.length===0};K.push(de);const re=Ut[Z];re&&a(V,ie*10+re,z),a(V,ie*10,z),Y=K.length*410+110,$=JSON.stringify(K)}else te.type!==q.TRANSLATOR&&($=JSON.stringify({...le,image:L,prompt:W||le.prompt||""}));else return T}catch{if(te.type===q.IMAGE_INPUT||te.type===q.IMAGE_ANALYZER)a(V,0,z),$=JSON.stringify({image:L,prompt:W||""});else if(te.type===q.TRANSLATOR)a(V,0,z),$=JSON.stringify({image:L});else if(te.type===q.NOTE){const le=`ref-${Date.now()}`;a(V,0,z),$=JSON.stringify({text:te.value||"",references:[{id:le,image:L,caption:W||""}],activeTab:"reference"})}else if(te.type===q.CHARACTER_CARD){a(V,0,z);const le={"1:1":L,"16:9":null,"9:16":null};$=JSON.stringify([{id:`char-card-${Date.now()}`,image:L,thumbnails:le,selectedRatio:"1:1",name:"New Entity 1",index:"Entity-1",prompt:W||"",isOutput:!0}]),a(V,1,z),Y=410+110}else return T}const oe=[...T];return oe[F]={...te,value:$,width:Y},oe}),o(r("toast.pastedFromClipboard"))},A.readAsDataURL(S)};if(j)return P(j),null;try{const S=await navigator.clipboard.read();for(const A of S)for(const O of A.types)if(O.startsWith("image/")){const z=await A.getType(O),L=new File([z],"pasted_image.png",{type:z.type});return P(L),null}return o(r("toast.pasteFailed"),"error"),"No image found on clipboard."}catch{return o(r("toast.pasteFailed"),"error"),"Could not read from clipboard."}},handleCopyNodeValue:async V=>{var A,O;const j=s.find(z=>z.id===V);if(!j)return"Node not found.";let P=null,S=j.value;try{if((A=j.value)!=null&&A.startsWith("{")||(O=j.value)!=null&&O.startsWith("[")){const z=JSON.parse(j.value);switch(j.type){case q.IMAGE_INPUT:P=i(j.id,0)||z.image,P?S="":S=z.prompt||"";break;case q.IMAGE_ANALYZER:P=i(j.id,0)||z.image,S=z.prompt||z.description||"";break;case q.CHARACTER_CARD:{const W=(Array.isArray(z)?z:[z]).map((D,T)=>{const F={...D.thumbnails};Object.entries(Ut).forEach(([le,K])=>{const ie=i(j.id,T*10+K);ie&&(F[le]=ie)});const te=D.selectedRatio||"1:1",Y=i(j.id,T*10)||F[te]||D.image,oe={type:"character-card",nodeTitle:j.title,...D,image:Y,imageSources:F};return delete oe.thumbnails,delete oe.id,oe});S=JSON.stringify(W,null,2),P=null}break;case q.IMAGE_EDITOR:P=i(j.id,0)||z.outputImage,S=z.prompt||"";break;case q.IMAGE_OUTPUT:P=i(j.id,0)||j.value,S="";break;case q.TRANSLATOR:S=z.translatedText||z.inputText||"";break;case q.PROMPT_PROCESSOR:S=z.prompt||"";break;case q.NOTE:S=z.text||"";break;case q.PROMPT_ANALYZER:case q.CHARACTER_ANALYZER:case q.SCRIPT_GENERATOR:case q.CHARACTER_GENERATOR:S=JSON.stringify(z,null,2);break;default:S=j.value}}else(j.type===q.IMAGE_OUTPUT||j.type===q.IMAGE_INPUT)&&j.value.startsWith("data:image")?(P=i(j.id,0)||j.value,S=""):S=j.value}catch{S=j.value}try{if(P&&P.startsWith("data:image")){let L=await(await fetch(P)).blob();if(L.type!=="image/png")try{const W=await createImageBitmap(L),D=document.createElement("canvas");D.width=W.width,D.height=W.height;const T=D.getContext("2d");if(T){T.drawImage(W,0,0);const F=await new Promise(te=>D.toBlob(te,"image/png"));F&&(L=F)}}catch{}return await navigator.clipboard.write([new ClipboardItem({[L.type]:L})]),o(r("toast.copiedToClipboard")),null}else if(S&&typeof S=="string"&&S.trim()!=="")return await navigator.clipboard.writeText(S),o(r("toast.copiedToClipboard")),null}catch{return"Could not write to clipboard."}return"Nothing to copy."},handleAspectRatioChange:(V,j)=>{l(P=>P.map(S=>S.id===V?{...S,aspectRatio:j}:S))},handleResolutionChange:(V,j)=>{l(P=>P.map(S=>S.id===V?{...S,resolution:j}:S))},handleModelChange:(V,j)=>{l(P=>P.map(S=>S.id===V?{...S,model:j}:S))},handleAutoDownloadChange:(V,j)=>{l(P=>P.map(S=>S.id===V?{...S,autoDownload:j}:S))},handleSetImageEditorOutputToInput:V=>{const j=s.find(P=>P.id===V);if(!(!j||j.type!==q.IMAGE_EDITOR))try{const P=JSON.parse(j.value);if(P.outputImage){const S=[...P.inputImages||[],P.outputImage],A=i(V,0);A&&a(V,S.length,A),d(V,JSON.stringify({...P,inputImages:S,outputImage:null}))}}catch{}},handleRefreshImageEditor:V=>{const j=s.find(O=>O.id===V);if(!j||j.type!==q.IMAGE_EDITOR)return;let P={};try{const O=JSON.parse(j.value||"{}");P={enableAspectRatio:O.enableAspectRatio,enableOutpainting:O.enableOutpainting,aspectRatio:O.aspectRatio,outpaintingPrompt:O.outpaintingPrompt}}catch{}const A={...JSON.parse(Wa(j)),...P};d(V,JSON.stringify(A))},handleToggleNodeCollapse:V=>{l(j=>j.map(P=>P.id===V?{...P,isCollapsed:!P.isCollapsed}:P))},handleToggleNodePin:V=>{l(j=>j.map(P=>P.id===V?{...P,isPinned:!P.isPinned}:P))},handleToggleNodeHandles:V=>{l(j=>j.map(P=>P.id===V?{...P,collapsedHandles:!P.collapsedHandles}:P))},handleClearNodeNewFlag:p}},PC=(e,t,o)=>{const[r,a]=y.useState(()=>e.map((c,d)=>({...c,id:c.id||`initial-conn-${Date.now()}-${d}`}))),i=y.useCallback(c=>{a(d=>{if(d.some(p=>p.fromNodeId===c.fromNodeId&&p.toNodeId===c.toNodeId&&p.fromHandleId===c.fromHandleId&&p.toHandleId===c.toHandleId))return d;const u={...c,id:`conn-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};return[...d,u]})},[]),s=y.useCallback(c=>{a(d=>{const u=d.filter(p=>p.fromNodeId!==c&&p.toNodeId!==c);return u.length<d.length&&t(o("toast.connectionsCut")),u})},[t,o]),l=y.useCallback(c=>{a(d=>d.filter(u=>u.id!==c))},[]);return{connections:r,setConnections:a,addConnection:i,removeConnectionsByNodeId:s,removeConnectionById:l}},jC=e=>{const[t,o]=y.useState(e||{scale:1,translate:{x:0,y:0}}),[r,a]=y.useState(null),[i,s]=y.useState({x:0,y:0}),[l,c]=y.useState(()=>({x:typeof window<"u"?window.innerWidth/2:0,y:typeof window<"u"?window.innerHeight/2:0})),d=y.useRef(null),[u,p]=y.useState(null),m=y.useCallback(M=>{d.current=M,p(M)},[]),w=y.useCallback(M=>{if(!d.current)return M;const G=d.current.getBoundingClientRect();return{x:M.x-G.left,y:M.y-G.top}},[]),k=y.useCallback(M=>{const G=w(M);return!Number.isFinite(t.scale)||t.scale===0||!Number.isFinite(t.translate.x)||!Number.isFinite(t.translate.y)?{x:0,y:0}:{x:(G.x-t.translate.x)/t.scale,y:(G.y-t.translate.y)/t.scale}},[t.scale,t.translate.x,t.translate.y,w]),b=y.useCallback((M,G)=>{const V=w(G);o(j=>{let P=Math.max(.1,Math.min(M,2));(!Number.isFinite(P)||Number.isNaN(P))&&(P=1);const S=Number.isFinite(j.scale)&&j.scale>0?j.scale:1,A=Number.isFinite(j.translate.x)?j.translate.x:0,O=Number.isFinite(j.translate.y)?j.translate.y:0,z=(V.x-A)/S,L=(V.y-O)/S,W=V.x-z*P,D=V.y-L*P;return!Number.isFinite(W)||!Number.isFinite(D)?j:{scale:P,translate:{x:W,y:D}}})},[w]),x=y.useCallback(M=>{const G=window.innerWidth/2,V=window.innerHeight/2;b(M,{x:G,y:V})},[b]),f=y.useCallback(M=>{const G=M.target;if(G.closest&&(G.closest(".node-view")||G.closest(".no-drag")||G.closest("textarea")||G.closest(".custom-scrollbar")))return;M.preventDefault(),M.stopPropagation();const V=Math.pow(1.001,-M.deltaY);o(j=>{const P=Number.isFinite(j.scale)&&j.scale>0?j.scale:1,S=Number.isFinite(j.translate.x)?j.translate.x:0,A=Number.isFinite(j.translate.y)?j.translate.y:0,O=Math.max(.1,Math.min(2,P*V));if(!Number.isFinite(O))return j;const z=w({x:M.clientX,y:M.clientY}),L=(z.x-S)/P,W=(z.y-A)/P,D=z.x-L*O,T=z.y-W*O;return!Number.isFinite(D)||!Number.isFinite(T)?j:{scale:O,translate:{x:D,y:T}}})},[w]);y.useEffect(()=>{if(!u)return;const M=G=>f(G);return u.addEventListener("wheel",M,{passive:!1}),()=>{u.removeEventListener("wheel",M)}},[u,f]);const h=y.useCallback(M=>{o(G=>!Number.isFinite(G.translate.x)||!Number.isFinite(G.translate.y)?{scale:1,translate:{x:window.innerWidth/2,y:window.innerHeight/2}}:(a({startPoint:M,startTranslate:{...G.translate}}),G))},[]),v=y.useCallback(()=>a(null),[]),N=y.useCallback(M=>{if(!r)return;const G=M.x-r.startPoint.x,V=M.y-r.startPoint.y;o(j=>{const P=r.startTranslate.x+G,S=r.startTranslate.y+V;return!Number.isFinite(P)||!Number.isFinite(S)?j:{...j,translate:{x:P,y:S}}})},[r]),_=y.useCallback(M=>{const G={x:M.clientX,y:M.clientY},V=k(G);s(V),c(G)},[k]),E=y.useCallback(()=>{const M=window.innerWidth/2,G=window.innerHeight/2;o({scale:1,translate:{x:M,y:G}})},[]);return{viewTransform:t,setViewTransform:o,isPanning:!!r,pointerPosition:i,clientPointerPosition:l,handleWheel:f,startPanning:h,stopPanning:v,pan:N,updatePointerPosition:_,setZoom:b,setCanvasRef:m,getCanvasRelativePoint:w,getTransformedPoint:k,handleZoomChange:x,scaleToSliderValue:M=>M>=1?(M-1)*100:(M-1)*125,sliderValueToScale:M=>M>=0?1+M/100:1+M/125,resetView:E}},IC=({viewTransform:e,setViewTransform:t,isPanning:o,pan:r,startPanning:a,stopPanning:i,getCanvasRelativePoint:s,setZoom:l,handleCloseAddNodeMenus:c,setSelectedNodeIds:d,effectiveTool:u,setZoomDragInfo:p,getTransformedPoint:m,setSelectionRect:w})=>{const k=y.useRef(null),b=(_,E)=>{const I=_.clientX-E.clientX,B=_.clientY-E.clientY;return Math.hypot(I,B)},x=(_,E)=>({x:(_.clientX+E.clientX)/2,y:(_.clientY+E.clientY)/2}),f=y.useCallback(_=>{if(window.focus(),document.activeElement instanceof HTMLElement&&document.activeElement.blur(),c(),_.button===1){_.preventDefault(),a({x:_.clientX,y:_.clientY});return}if(_.button===0){if(u==="zoom"){_.preventDefault(),p({startClientX:_.clientX,startScale:e.scale,pivot:{x:_.clientX,y:_.clientY}});return}if(u==="selection"||_.shiftKey){_.preventDefault(),_.shiftKey||d([]);const E=m({x:_.clientX,y:_.clientY});w({start:E,end:E});return}!_.ctrlKey&&!_.metaKey&&!_.altKey&&d([]),_.preventDefault(),a({x:_.clientX,y:_.clientY})}},[u,a,e.scale,m,d,c,p,w]),h=y.useCallback(_=>{if(window.focus(),document.activeElement instanceof HTMLElement&&document.activeElement.blur(),c(),_.touches.length===2){o&&i();const E=b(_.touches[0],_.touches[1]),I=x(_.touches[0],_.touches[1]),B=s(I);k.current={startDist:E,startCenter:B,startTransform:{...e}};return}_.touches.length===1&&a({x:_.touches[0].clientX,y:_.touches[0].clientY})},[c,a,o,i,e,s]),v=y.useCallback(_=>{if(_.touches.length===2&&k.current){_.cancelable&&_.preventDefault&&_.preventDefault();const E=b(_.touches[0],_.touches[1]),I=x(_.touches[0],_.touches[1]),B=s(I),{startDist:M,startCenter:G,startTransform:V}=k.current;if(M===0)return;const j=E/M;let P=V.scale*j;P=Math.max(.1,Math.min(P,5));const S=P/V.scale,A=B.x-(G.x-V.translate.x)*S,O=B.y-(G.y-V.translate.y)*S;t({scale:P,translate:{x:A,y:O}});return}o&&_.touches.length===1&&(_.cancelable&&_.preventDefault&&_.preventDefault(),r({x:_.touches[0].clientX,y:_.touches[0].clientY}))},[o,r,t,s]),N=y.useCallback(_=>{_.touches.length<2&&(k.current=null),o&&_.touches.length===0&&i()},[o,i]);return{handleCanvasMouseDown:f,handleCanvasTouchStart:h,handleCanvasTouchMove:v,handleCanvasTouchEnd:N,pinchRef:k}},TC=({nodesRef:e,setNodes:t,groupsRef:o,setGroups:r,viewTransform:a,isSnapToGrid:i,isSmartGuidesEnabled:s,setSmartGuides:l,handleCloseAddNodeMenus:c,setSelectedNodeIds:d,selectedNodeIds:u,getTransformedPoint:p,activeTool:m,handleDockNode:w,setIsDockingMenuVisible:k,setDockHoverMode:b,dockHoverMode:x,connections:f,setConnections:h})=>{const[v,N]=y.useState(null),_=y.useRef(null),[E,I]=y.useState(null),B=y.useRef(null),[M,G]=y.useState(null),V=y.useRef(null);At.useEffect(()=>{_.current=v},[v]),At.useEffect(()=>{B.current=E},[E]);const j=y.useCallback((D,T)=>{if(D.stopPropagation(),D.button!==0)return;c(),t($=>{const Y=$.findIndex(se=>se.id===T);if(Y===-1)return $;const oe=$[Y],le=Y!==$.length-1,K=oe.isNewlyCreated;if(!le&&!K)return $;const ie=[...$],[Z]=ie.splice(Y,1);return ie.push({...Z,isNewlyCreated:!1}),ie});let F=[...u];const te=F.includes(T);if(D.shiftKey?(te?F=F.filter($=>$!==T):F.push(T),d(F)):te||(F=[T],d(F)),F.includes(T)){if(m==="edit"&&(D.ctrlKey||D.metaKey)&&!D.altKey||m==="cutter")return;const $=p({x:D.clientX,y:D.clientY}),Y=new Map,oe=new Map;e.current.filter(ie=>F.includes(ie.id)).forEach(ie=>{Y.set(ie.id,{x:$.x-ie.position.x,y:$.y-ie.position.y}),oe.set(ie.id,{...ie.position})});const K={type:"node",id:T,offsets:Y,initialPositions:oe,isDetaching:D.altKey};_.current=K,N(K)}},[u,d,p,N,c,m,t,e]),P=y.useCallback((D,T)=>{if(D.touches.length!==1)return;c();const F=D.touches[0];D.stopPropagation(),t(ie=>{const Z=ie.findIndex(H=>H.id===T);if(Z===-1)return ie;const se=ie[Z],de=Z!==ie.length-1,re=se.isNewlyCreated;if(!de&&!re)return ie;const R=[...ie],[J]=R.splice(Z,1);return R.push({...J,isNewlyCreated:!1}),R});let te=[...u];te.includes(T)||(te=[T],d(te));const $=p({x:F.clientX,y:F.clientY}),Y=new Map,oe=new Map;e.current.filter(ie=>te.includes(ie.id)).forEach(ie=>{Y.set(ie.id,{x:$.x-ie.position.x,y:$.y-ie.position.y}),oe.set(ie.id,{...ie.position})});const K={type:"node",id:T,offsets:Y,initialPositions:oe,isDetaching:!1};_.current=K,N(K)},[u,d,p,N,c,t,e]),S=y.useCallback((D,T,F)=>{D.stopPropagation(),D.preventDefault(),D.currentTarget.setPointerCapture&&D.currentTarget.setPointerCapture(D.pointerId);const te=e.current.find($=>$.id===T);if(te){const $={nodeId:T,startPosition:{x:D.clientX,y:D.clientY},startSize:{width:te.width,height:te.height},direction:F};I($),B.current=$}},[e]),A=y.useCallback((D,T)=>{if(D.stopPropagation(),D.button!==0)return;c(),r(oe=>{const le=oe.findIndex(Z=>Z.id===T);if(le===-1||le===oe.length-1)return oe;const K=[...oe],[ie]=K.splice(le,1);return K.push(ie),K}),d([]);const F=o.current.find(oe=>oe.id===T);if(!F)return;const te=p({x:D.clientX,y:D.clientY}),$=new Map;$.set(T,{x:te.x-F.position.x,y:te.y-F.position.y}),F.nodeIds.forEach(oe=>{const le=e.current.find(K=>K.id===oe);le&&$.set(oe,{x:te.x-le.position.x,y:te.y-le.position.y})});const Y={type:"group",id:T,offsets:$};_.current=Y,N(Y)},[p,N,c,d,r,o,e]),O=y.useCallback((D,T)=>{if(D.stopPropagation(),D.touches.length!==1)return;c();const F=D.touches[0];r(le=>{const K=le.findIndex(se=>se.id===T);if(K===-1||K===le.length-1)return le;const ie=[...le],[Z]=ie.splice(K,1);return ie.push(Z),ie}),d([]);const te=o.current.find(le=>le.id===T);if(!te)return;const $=p({x:F.clientX,y:F.clientY}),Y=new Map;Y.set(T,{x:$.x-te.position.x,y:$.y-te.position.y}),te.nodeIds.forEach(le=>{const K=e.current.find(ie=>ie.id===le);K&&Y.set(le,{x:$.x-K.position.x,y:$.y-K.position.y})});const oe={type:"group",id:T,offsets:Y};_.current=oe,N(oe)},[p,N,c,d,r,o,e]);return{handleNodeMouseDown:j,handleNodeTouchStart:P,handleNodeResizeMouseDown:S,handleGroupMouseDown:A,handleGroupTouchStart:O,processDrag:(D,T,F)=>{const te=(D.clientX-a.translate.x)/a.scale,$=(D.clientY-a.translate.y)/a.scale;if(_.current){const Y=_.current,oe=i?20:1;if(Y.type==="node"){const le=Y.id,K=e.current.find(Re=>Re.id===le);if(K&&!K.dockState&&K.type!==q.REROUTE_DOT){const Re=window.innerWidth,Me=150,De=80,Ie=D.clientY<Me;k(Ie);const Ne=document.elementFromPoint(D.clientX,D.clientY),Pe=Ne==null?void 0:Ne.closest("[data-dock-mode]"),ye=Pe==null?void 0:Pe.getAttribute("data-dock-mode");ye?b(ye):D.clientX<De?b("q1"):D.clientX>Re-De?b("q4"):b(null)}const ie=Array.from(Y.offsets.keys()),Z=Y.id,se=Y.offsets.get(Z),de=te-se.x,re=$-se.y,R=e.current.find(Re=>Re.id===Z),J=R.isCollapsed?In:R.height;let H=null;const U=R.width,ee=J,ae=U*.05,xe=ee*.05,ne=de+ae,X=re+xe,ue=de+U-ae,Q=re+ee-xe;for(let Re=o.current.length-1;Re>=0;Re--){const Me=o.current[Re],De=Me.position.x,Ie=Me.position.y,Ne=Me.position.x+Me.width,Pe=Me.position.y+Me.height;if(!(ue<De||ne>Ne||Q<Ie||X>Pe)){H=Me.id;break}}V.current!==H&&(V.current=H,G(H));let ce=0,pe=0,me=[];if((s||F)&&ie.length===1){const Re=10/a.scale,Me=e.current.filter(Ne=>Ne.id!==Z);let De=!1,Ie=!1;for(const Ne of Me){if(De&&Ie)break;const Pe=Ne.isCollapsed?In:Ne.height;if(!De){const ye=[Ne.position.x,Ne.position.x+Ne.width/2,Ne.position.x+Ne.width],_e=[de,de+R.width/2,de+R.width];for(let Fe of ye){let We=!1;for(let Ze of _e)if(Math.abs(Ze-Fe)<Re){ce=Fe-Ze;const $e=Math.min(re,Ne.position.y)-50,He=Math.max(re+J,Ne.position.y+Pe)+50;me.push({type:"vertical",position:Fe,start:$e,end:He}),We=!0,De=!0;break}if(We)break}}if(!Ie){const ye=[Ne.position.y,Ne.position.y+Pe/2,Ne.position.y+Pe],_e=[re,re+J/2,re+J];for(let Fe of ye){let We=!1;for(let Ze of _e)if(Math.abs(Ze-Fe)<Re){pe=Fe-Ze;const $e=Math.min(de,Ne.position.x)-50,He=Math.max(de+R.width,Ne.position.x+Ne.width)+50;me.push({type:"horizontal",position:Fe,start:$e,end:He}),We=!0,Ie=!0;break}if(We)break}}}}l(me);const ke=e.current.map(Re=>{const Me=Y.offsets.get(Re.id);if(Me){let De=te-Me.x+ce,Ie=$-Me.y+pe;return i&&(De=Math.round(De/oe)*oe,Ie=Math.round(Ie/oe)*oe),{...Re,position:{x:De,y:Ie}}}return Re});if(e.current=ke,t(ke),!T){const Re=o.current.filter(Me=>Me.nodeIds.some(De=>ie.includes(De)));Re.length>0&&r(Me=>Me.map(De=>{if(Re.some(Ie=>Ie.id===De.id)){const Ie=ke.filter(Pe=>De.nodeIds.includes(Pe.id)),Ne=qr(Ie);return Ne?{...De,...Ne}:De}return De}))}}else if(Y.type==="group"){const le=Y.offsets.get(Y.id),K=Math.round((te-le.x)/oe)*oe,ie=Math.round(($-le.y)/oe)*oe;o.current.find(Z=>Z.id===Y.id),r(Z=>Z.map(se=>se.id===Y.id?{...se,position:{x:K,y:ie}}:se)),t(Z=>Z.map(se=>{const de=Y.offsets.get(se.id);if(de){let re=te-de.x,R=$-de.y;return i&&(re=Math.round(re/oe)*oe,R=Math.round(R/oe)*oe),{...se,position:{x:re,y:R}}}return se}))}}},processResize:D=>{const T=B.current;if(T){const F=e.current.find(te=>te.id===T.nodeId);if(F){const te=F.dockState?1:a.scale,$=(D.clientX-T.startPosition.x)/te,Y=(D.clientY-T.startPosition.y)/te,oe=Da(F.type);let le=F.width,K=F.height,ie=F.position.x,Z=F.position.y;const se=T.direction||"se";if(se.includes("e")&&(le=Math.max(oe.minWidth,T.startSize.width+$)),se.includes("s")&&(K=Math.max(oe.minHeight,T.startSize.height+Y)),se.includes("w")){const re=Math.max(oe.minWidth,T.startSize.width-$);ie=F.position.x+(F.width-re),le=re}if(se.includes("n")){const re=Math.max(oe.minHeight,T.startSize.height-Y);Z=F.position.y+(F.height-re),K=re}i&&(le=Math.round(le/20)*20,K=Math.round(K/20)*20),t(re=>re.map(R=>R.id===T.nodeId?{...R,width:le,height:K,position:{x:ie,y:Z}}:R));const de=o.current.filter(re=>re.nodeIds.includes(T.nodeId));de.length>0&&r(re=>re.map(R=>{if(de.some(J=>J.id===R.id)){const J=e.current.map(U=>U.id===T.nodeId?{...U,width:le,height:K,position:{x:ie,y:Z}}:U).filter(U=>R.nodeIds.includes(U.id)),H=qr(J);return H?{...R,...H}:R}return R}))}}},endDrag:()=>{var T;const D=_.current;if(D&&D.type==="node"&&x&&w){const F=(T=D.initialPositions)==null?void 0:T.get(D.id);w(D.id,x,F)}if(D&&D.type==="node"&&f&&h){const F=e.current.find(te=>te.id===D.id);if(F&&F.type===q.REROUTE_DOT){const te={x:F.position.x+F.width/2,y:F.position.y+F.height/2},$=f.find(Y=>{if(Y.fromNodeId===F.id||Y.toNodeId===F.id)return!1;const oe=e.current.find(K=>K.id===Y.fromNodeId),le=e.current.find(K=>K.id===Y.toNodeId);if(oe&&le){const{start:K,end:ie}=zp(oe,le,Y);return SC(te,K,ie,20)}return!1});if($){const Y=e.current.find(ie=>ie.id===$.fromNodeId),oe=Y?Xn(Y,$.fromHandleId):null;oe&&t(ie=>ie.map(Z=>Z.id===F.id?{...Z,value:JSON.stringify({type:oe})}:Z));const le={id:`conn-${Date.now()}-1`,fromNodeId:$.fromNodeId,fromHandleId:$.fromHandleId,toNodeId:F.id,toHandleId:void 0},K={id:`conn-${Date.now()}-2`,fromNodeId:F.id,fromHandleId:void 0,toNodeId:$.toNodeId,toHandleId:$.toHandleId};h(ie=>[...ie.filter(Z=>Z.id!==$.id),le,K])}}}if(D&&D.type==="node"){const F=V.current,te=Array.from(D.offsets.keys());r($=>{let Y=[...$];return F&&!D.isDetaching?Y=Y.map(oe=>oe.id===F?{...oe,nodeIds:Array.from(new Set([...oe.nodeIds,...te]))}:oe.nodeIds.some(le=>te.includes(le))?{...oe,nodeIds:oe.nodeIds.filter(le=>!te.includes(le))}:oe):D.isDetaching&&(Y=Y.map(oe=>({...oe,nodeIds:oe.nodeIds.filter(le=>!te.includes(le))}))),Y.filter(oe=>oe.nodeIds.length>0).map(oe=>{const le=e.current.filter(K=>oe.nodeIds.includes(K.id));return{...oe,...qr(le)||{}}})})}N(null),_.current=null,I(null),B.current=null,G(null),V.current=null,l([]),k(!1),b(null)},draggingInfo:v,resizingInfo:E,setResizingInfo:I,draggingInfoRef:_,resizingInfoRef:B,hoveredGroupIdForDrop:M}},AC=({nodesRef:e,connectionsRef:t,getTransformedPoint:o,setConnections:r,addConnection:a,handleOpenConnectionQuickAdd:i,setNodes:s})=>{const[l,c]=y.useState(null),[d,u]=y.useState(null),[p,m]=y.useState(null),w=y.useCallback((f,h,v)=>{f.stopPropagation(),f.preventDefault();const N=e.current.find(I=>I.id===h);if(!N)return;const _=Xn(N,v),E=o({x:f.clientX,y:f.clientY});c({fromNodeId:h,fromHandleId:v,fromPoint:E,fromType:_})},[o,c,e]),k=y.useCallback((f,h,v)=>{if(f.stopPropagation(),f.touches.length!==1)return;const N=f.touches[0],_=e.current.find(B=>B.id===h);if(!_)return;const E=Xn(_,v),I=o({x:N.clientX,y:N.clientY});c({fromNodeId:h,fromHandleId:v,fromPoint:I,fromType:E})},[o,c,e]);return{connectingInfo:l,connectionTarget:d,hoveredNodeId:p,setHoveredNodeId:m,handleStartConnection:w,handleStartConnectionTouch:k,processConnectionDrag:(f,h)=>{if(!l)return;let v,N;"touches"in h?(v=h.touches[0].clientX,N=h.touches[0].clientY):(v=h.clientX,N=h.clientY);const _=document.elementFromPoint(v,N),E=_==null?void 0:_.closest('[data-is-input-handle="true"]');let I=null,B=null;if(E){const M=E.getAttribute("data-node-id"),G=E.getAttribute("data-handle-id"),V=G===""?void 0:G,j=E.getAttribute("data-handle-type");M&&M!==l.fromNodeId&&(B=M,(!j||j===l.fromType)&&(I={nodeId:M,handleId:V||void 0}))}if(!I){for(let M=e.current.length-1;M>=0;M--){const G=e.current[M],V=20;let j=G.width,P=G.height;if(G.dockState?(j=160,P=48):G.isCollapsed&&(P=In),f.x>=G.position.x-V&&f.x<=G.position.x+j+V&&f.y>=G.position.y&&f.y<=G.position.y+P){B=G.id;break}}if(B&&B!==l.fromNodeId){const M=e.current.find(G=>G.id===B);if(M){let G,V=!1;if(M.type===q.IMAGE_EDITOR){const j=l.fromType;if(j==="image"){let P=!1,S=!1,A=330;try{const O=JSON.parse(M.value||"{}");P=O.isSequenceMode&&O.isSequentialCombinationMode,S=O.isSequenceMode&&O.isSequentialEditingWithPrompts,O.topPaneHeight&&(A=O.topPaneHeight)}catch{}if(S)G="image_b",V=!0;else if(P){const W=M.position.y+52+A*.25,D=M.position.y+52+A*.75,T=Math.abs(f.y-W);G=Math.abs(f.y-D)<T?"image_b":"image",V=!0}else G="image",V=!0}else j==="text"&&(G="text",V=!0)}else if(M.type===q.VIDEO_EDITOR){const j={video:M.position.y+60,audio:M.position.y+110,image:M.position.y+160,text:M.position.y+210},P=l.fromType;if(P&&j[P])G=P,V=!0;else{let S=1/0,A=null;for(const[O,z]of Object.entries(j)){const L=Math.abs(f.y-z);L<S&&(S=L,A=O)}A&&(G=A,V=!0)}}else if(M.type===q.IMAGE_SEQUENCE_GENERATOR)l.fromType==="text"?(G="prompt_input",V=!0):l.fromType==="character_data"&&(G="character_data",V=!0);else if(M.type===q.PROMPT_SEQUENCE_EDITOR)l.fromType==="text"&&(G="prompts_sequence",V=!0);else if(M.type===q.NOTE)l.fromType==="text"&&(G="prompt_data",V=!0);else if(M.type===q.REROUTE_DOT||M.type===q.DATA_READER){const j=t.current.some(A=>A.toNodeId===B),P=h instanceof MouseEvent?h:h.touches[0],S=P.ctrlKey||P.metaKey;(!j||S)&&(G=void 0,V=!0)}else{const j=Ws(M);j&&l.fromType===j&&(G=void 0,V=!0)}V&&(I={nodeId:B,handleId:G})}}}p!==B&&m(B),u(M=>(M==null?void 0:M.nodeId)===(I==null?void 0:I.nodeId)&&(M==null?void 0:M.handleId)===(I==null?void 0:I.handleId)?M:I)},endConnection:(f,h,v)=>{if(l){if(d){const N=f;(N.ctrlKey||N.metaKey)&&r(E=>E.filter(I=>!(I.toNodeId===d.nodeId&&I.toHandleId===d.handleId))),a({fromNodeId:l.fromNodeId,fromHandleId:l.fromHandleId,toNodeId:d.nodeId,toHandleId:d.handleId});const _=e.current.find(E=>E.id===d.nodeId);if(_&&_.type===q.REROUTE_DOT){const E=e.current.find(I=>I.id===l.fromNodeId);if(E){const I=Xn(E,l.fromHandleId);I&&s(B=>B.map(M=>M.id===_.id?{...M,value:JSON.stringify({type:I})}:M))}}}else if(!p&&!h&&!v){let N,_;"changedTouches"in f?(N=f.changedTouches[0].clientX,_=f.changedTouches[0].clientY):(N=f.clientX,_=f.clientY);const E=f.target;if((E.id==="app-container"||E.id==="canvas-transform-layer"||E.tagName.toLowerCase()==="svg"||E.closest("#canvas-transform-layer"))&&i){const B=e.current.find(M=>M.id===l.fromNodeId);i({x:N,y:_},l,B==null?void 0:B.type)}}c(null),u(null),m(null)}},setConnectingInfo:c,setConnectionTarget:u}},RC=e=>{const{selectedNodeIds:t,setSelectedNodeIds:o,nodesRef:r,groupsRef:a,draggingInfoRef:i,isTyping:s,handleSaveCanvas:l,handleLoadCanvas:c,copyNodeValue:d,copyGroup:u,handlePaste:p,handleToggleCatalog:m,handleOpenQuickSearch:w,handleOpenQuickAdd:k,deselectAllNodes:b,handleDuplicateNode:x,handleDuplicateNodeWithContent:f,deleteNodeAndConnections:h,requestDeleteNodes:v,handleGroupSelection:N,handleToggleNodeCollapse:_,handleToggleNodePin:E,onAddNode:I,pointerPositionRef:B,clientPointerPositionRef:M,handleCloseAddNodeMenus:G,setIsSnapToGrid:V,setLineStyle:j,setIsSmartGuidesEnabled:P,setActiveTool:S,setIsShiftDown:A,setIsCtrlDown:O,setIsAltDown:z,setIsZDown:L,setSelectionRect:W,isRadialMenuOpen:D,setIsRadialMenuOpen:T,setRadialMenuPosition:F,radialMenuSelectedItem:te,setRadialMenuSelectedItem:$,getTransformedPoint:Y,radialMenuPosition:oe,quickSlots:le,isConnectionQuickAddOpen:K,isInstantCloseEnabled:ie,handleAlignNodes:Z,undoPosition:se,redoPosition:de,handleValueChange:re}=e;y.useEffect(()=>{const R=U=>{var ne;if((U.ctrlKey||U.metaKey)&&U.code==="Space"){U.preventDefault(),m();return}const ee=U.target;if(ee.tagName==="INPUT"||ee.tagName==="TEXTAREA"||ee.isContentEditable)return;if(U.key==="Shift"&&!U.repeat&&A(!0),U.key==="Control"&&!U.repeat&&O(!0),U.key==="Alt"&&!U.repeat&&z(!0),U.code==="KeyZ"&&!U.repeat&&t.length<=1&&!U.ctrlKey&&!U.metaKey&&L(!0),U.code==="Space"&&!U.ctrlKey&&!U.metaKey&&!U.altKey&&!U.shiftKey&&t.length===0){U.preventDefault(),U.repeat||k(M.current);return}if(U.code==="Tab"&&(U.preventDefault(),D||(F(M.current),T(!0))),(U.ctrlKey||U.metaKey)&&U.code==="KeyZ"){U.preventDefault(),U.shiftKey?de(r.current):se(r.current);return}if((U.ctrlKey||U.metaKey)&&U.code==="KeyY"){U.preventDefault(),de(r.current);return}if(t.length>1){if(U.ctrlKey||U.metaKey){if(U.code==="KeyD"){U.preventDefault(),Z(t,"distribute-horizontal");return}if(U.code==="KeyE"){U.preventDefault(),Z(t,"distribute-vertical");return}}else if(!U.ctrlKey&&!U.metaKey&&!U.altKey)switch(U.code){case"KeyF":U.preventDefault(),Z(t,"left");return;case"KeyT":U.preventDefault(),Z(t,"top");return;case"KeyB":U.preventDefault(),Z(t,"bottom");return;case"KeyR":U.preventDefault(),Z(t,"right");return;case"KeyE":U.preventDefault(),Z(t,"center-x");return;case"KeyD":U.preventDefault(),Z(t,"center-y");return;case"KeyZ":U.preventDefault(),se(r.current);return}}else if(U.code==="KeyF"&&!U.ctrlKey&&!U.metaKey&&!U.altKey&&!U.shiftKey){U.preventDefault(),w(M.current);return}if((U.ctrlKey||U.metaKey)&&U.code==="KeyS"){U.preventDefault(),l();return}if((U.ctrlKey||U.metaKey)&&U.code==="KeyO"){U.preventDefault(),c();return}if((U.ctrlKey||U.metaKey)&&!U.shiftKey&&U.code==="KeyC"){const X=window.getSelection();if(X&&X.toString().length>0)return;if(t.length>0){U.preventDefault();const ue=t[t.length-1];d(ue);return}else if(i.current&&i.current.type==="group"){U.preventDefault(),u(i.current.id);return}else if(i.current&&i.current.type==="node"){const ue=i.current.id,Q=a.current.find(ce=>ce.nodeIds.includes(ue));if(Q){U.preventDefault(),u(Q.id);return}}}if((U.ctrlKey||U.metaKey)&&U.code==="KeyV"&&(U.preventDefault(),p(U.shiftKey)),(U.ctrlKey||U.metaKey)&&!U.shiftKey&&U.code==="KeyA"){U.preventDefault(),o(r.current.map(X=>X.id));return}if(U.altKey&&U.code==="KeyA"){U.preventDefault(),b();return}if((U.ctrlKey||U.metaKey)&&U.code==="KeyD"&&t.length>0){if(U.preventDefault(),!U.repeat){const X=t.map(ue=>f(ue)).filter(ue=>!!ue);X.length>0&&o(X)}return}if(U.code==="KeyD"&&!(U.ctrlKey||U.metaKey)&&t.length>0){if(U.preventDefault(),!U.repeat){const X=t.map(ue=>x(ue)).filter(ue=>!!ue);X.length>0&&o(X)}return}if((U.code==="Delete"||U.code==="KeyX")&&t.length>0){U.preventDefault(),U.shiftKey||ie?(t.forEach(X=>h(X)),o([])):v(t,M.current);return}if(U.code==="KeyH"&&!U.shiftKey&&!U.ctrlKey&&!U.altKey&&!U.metaKey){U.preventDefault(),U.repeat||t.forEach(_);return}if(U.code==="KeyG"&&!U.shiftKey&&!U.ctrlKey&&!U.altKey&&!U.metaKey){U.preventDefault(),U.repeat||(t.length>1?N():(I(q.GEMINI_CHAT,B.current),G()));return}if(!U.ctrlKey&&!U.metaKey&&!U.altKey&&!U.shiftKey&&U.code.startsWith("Digit")&&!K){const X=parseInt(U.code.replace("Digit",""));if(X>=1&&X<=8){const ue=le[X-1];if(ue){U.preventDefault(),U.repeat||I(ue,B.current);return}}}let ae=null;const xe=U.code;if(U.ctrlKey&&U.shiftKey)switch(xe){case"KeyA":ae=q.CHARACTER_ANALYZER;break;case"KeyC":ae=q.CHARACTER_CARD;break}else if(U.shiftKey)switch(xe){case"KeyA":ae=q.IMAGE_ANALYZER;break;case"KeyI":ae=q.IMAGE_EDITOR;break;case"KeyC":ae=q.CHARACTER_GENERATOR;break;case"KeyR":ae=q.DATA_READER;break;case"KeyV":ae=q.SCRIPT_VIEWER;break;case"KeyQ":ae=q.IMAGE_SEQUENCE_GENERATOR;break;case"KeyW":U.preventDefault(),U.repeat||V(X=>!X);return;case"KeyE":U.preventDefault(),U.repeat||j(X=>X==="spaghetti"?"orthogonal":"spaghetti");return;case"KeyL":U.preventDefault(),U.repeat||P(X=>!X);return;case"KeyP":ae=q.VIDEO_PROMPT_PROCESSOR;break;case"KeyO":ae=q.VIDEO_OUTPUT;break}else if(!U.ctrlKey&&!U.metaKey&&!U.altKey)switch(xe){case"KeyT":ae=q.TEXT_INPUT;break;case"KeyI":ae=q.IMAGE_INPUT;break;case"KeyA":ae=q.PROMPT_ANALYZER;break;case"KeyP":ae=q.PROMPT_PROCESSOR;break;case"KeyO":ae=q.IMAGE_OUTPUT;break;case"KeyM":t.length===1&&((ne=r.current.find(ue=>ue.id===t[0]))==null?void 0:ne.type)===q.MEDIA_VIEWER||(ae=q.MEDIA_VIEWER);break;case"KeyL":ae=q.TRANSLATOR;break;case"KeyN":ae=q.NOTE;break;case"KeyQ":ae=q.PROMPT_SEQUENCE_EDITOR;break;case"KeyE":ae=q.VIDEO_EDITOR;break}if(ae){U.preventDefault(),U.repeat||(I(ae,B.current),G());return}if(!U.metaKey&&!U.shiftKey&&!U.ctrlKey&&!U.altKey)switch(U.code){case"KeyV":U.preventDefault(),S("edit");break;case"KeyC":U.preventDefault(),S("cutter");break;case"KeyS":U.preventDefault(),S("selection");break;case"KeyR":U.preventDefault(),S("reroute");break}},J=U=>{U.key==="Shift"&&(A(!1),W(null)),U.key==="Control"&&O(!1),U.key==="Alt"&&z(!1),U.code==="KeyZ"&&L(!1),U.code==="Tab"&&D&&(te&&I(te,Y(oe)),T(!1),$(null))},H=()=>{A(!1),O(!1),z(!1),L(!1),T(!1),$(null),W(null)};return window.addEventListener("keydown",R),window.addEventListener("keyup",J),window.addEventListener("blur",H),window.addEventListener("focus",H),document.addEventListener("visibilitychange",H),()=>{window.removeEventListener("keydown",R),window.removeEventListener("keyup",J),window.removeEventListener("blur",H),window.removeEventListener("focus",H),document.removeEventListener("visibilitychange",H)}},[t,r,i,s,l,c,d,u,p,m,w,k,b,x,f,h,v,N,_,I,B,M,G,V,j,P,S,A,O,z,L,W,D,T,F,te,$,Y,oe,le,K,ie,Z,se,de,re])},MC=e=>{const{nodes:t,setNodes:o,groups:r,setGroups:a,addConnection:i,connections:s,viewTransform:l,setViewTransform:c,updatePointerPosition:d,pan:u,isPanning:p,startPanning:m,stopPanning:w,isSnapToGrid:k,onAddNode:b,removeConnectionsByNodeId:x,handleOpenQuickSearch:f,clientPointerPosition:h,getTransformedPoint:v,getCanvasRelativePoint:N,setZoom:_,t:E,handleDeleteNode:I,handleValueChange:B,handleDuplicateNode:M,handleDuplicateNodeWithContent:G,handleToggleNodeCollapse:V,handleToggleNodePin:j,copyNodeValue:P,pasteImageToNode:S,nodeIdCounter:A,setConnections:O,addGroup:z,handleCloseAddNodeMenus:L,activeTool:W,setActiveTool:D,setSpawnLine:T,pointerPosition:F,setError:te,handleLoadCanvasIntoCurrentTab:$,setIsSnapToGrid:Y,setLineStyle:oe,deleteNodeAndConnections:le,handleToggleCatalog:K,draggingInfo:ie,setDraggingInfo:Z,handleDetachNodeFromGroup:se,handleSaveCanvas:de,handleLoadCanvas:re,handleOpenConnectionQuickAdd:R,handleOpenContextMenu:J,quickSlots:H,isConnectionQuickAddOpen:U,pasteGroup:ee,copyGroup:ae,isSmartGuidesEnabled:xe,setIsSmartGuidesEnabled:ne,setSmartGuides:X,selectedNodeIds:ue,setSelectedNodeIds:Q,handleRenameNode:ce,setFullSizeImage:pe,handleOpenQuickAdd:me,requestDeleteNodes:ke,isInstantCloseEnabled:Re,handleAlignNodes:Me,handleDockNode:De,handlePaste:Ie,selectNode:Ne,dockHoverMode:Pe,setDockHoverMode:ye,isDockingMenuVisible:_e,setIsDockingMenuVisible:Fe,undoPosition:We,redoPosition:Ze}=e,$e=y.useRef(t);y.useEffect(()=>{$e.current=t},[t]);const He=y.useRef(r);y.useEffect(()=>{He.current=r},[r]);const be=y.useRef(s);y.useEffect(()=>{be.current=s},[s]);const Ae=y.useRef(F);y.useEffect(()=>{Ae.current=F},[F]);const Te=y.useRef(h);y.useEffect(()=>{Te.current=h},[h]);const[qe,Ye]=y.useState(null),[nt,Nt]=y.useState(null),[ze,je]=y.useState(!1),[Le,rt]=y.useState(!1),[Ce,Se]=y.useState(!1),[he,ge]=y.useState(!1),[ve,Ge]=y.useState(!1),[Ve,ot]=y.useState(null),[Xe,pt]=y.useState({x:0,y:0}),st=y.useCallback(Ke=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur(),D(Ke)},[D]),ft=he?"zoom":W==="edit"?Le&&Ce?"reroute":Le?"cutter":ze?"selection":"edit":W,it=IC({viewTransform:l,setViewTransform:c,isPanning:p,pan:u,startPanning:m,stopPanning:w,getCanvasRelativePoint:N,setZoom:_,handleCloseAddNodeMenus:L,setSelectedNodeIds:Q,effectiveTool:ft,setZoomDragInfo:Ye,getTransformedPoint:v,setSelectionRect:Nt}),wt=TC({nodesRef:$e,setNodes:o,groupsRef:He,setGroups:a,viewTransform:l,isSnapToGrid:k,isSmartGuidesEnabled:xe,setSmartGuides:X,handleCloseAddNodeMenus:L,setSelectedNodeIds:Q,selectedNodeIds:ue,getTransformedPoint:v,activeTool:W,handleDockNode:De,setIsDockingMenuVisible:Fe,setDockHoverMode:ye,dockHoverMode:Pe,connections:s,setConnections:O}),dt=AC({nodesRef:$e,connectionsRef:be,getTransformedPoint:v,setConnections:O,addConnection:i,handleOpenConnectionQuickAdd:R,setNodes:o});RC({selectedNodeIds:ue,setSelectedNodeIds:Q,nodesRef:$e,groupsRef:He,draggingInfoRef:wt.draggingInfoRef,isTyping:!1,handleSaveCanvas:de,handleLoadCanvas:re,copyNodeValue:P,copyGroup:ae,handlePaste:Ie,handleToggleCatalog:K,handleOpenQuickSearch:f,handleOpenQuickAdd:me,deselectAllNodes:()=>Q([]),handleDuplicateNode:M,handleDuplicateNodeWithContent:G,deleteNodeAndConnections:le,requestDeleteNodes:ke,handleGroupSelection:()=>{if(ue.length>1){const Ke=$e.current.filter(et=>ue.includes(et.id));z(Ke),Q([])}},handleToggleNodeCollapse:V,handleToggleNodePin:j,onAddNode:b,pointerPositionRef:Ae,clientPointerPositionRef:Te,handleCloseAddNodeMenus:L,setIsSnapToGrid:Y,setLineStyle:oe,setIsSmartGuidesEnabled:ne,setActiveTool:st,setIsShiftDown:je,setIsCtrlDown:rt,setIsAltDown:Se,setIsZDown:ge,setSelectionRect:Nt,isRadialMenuOpen:ve,setIsRadialMenuOpen:Ge,setRadialMenuPosition:pt,radialMenuSelectedItem:Ve,setRadialMenuSelectedItem:ot,getTransformedPoint:v,radialMenuPosition:Xe,quickSlots:H,isConnectionQuickAddOpen:U,isInstantCloseEnabled:Re,handleAlignNodes:Me,undoPosition:We,redoPosition:Ze,handleValueChange:B});const _t=y.useCallback(Ke=>{const et=Ke.target;et.closest(".node-view")||et.closest(".group-view")||et.closest("button")||et.closest("input")||et.closest("textarea")||et.closest(".ui-panel")||et.closest('[role="dialog"]')||(et.id==="app-container"||et.id==="canvas-transform-layer"||et.tagName==="svg"||et.classList.contains("connection-view"))&&(Ke.preventDefault(),me({x:Ke.clientX,y:Ke.clientY}))},[me]),cn=()=>qe?"ew-resize":wt.draggingInfo?"grabbing":ft==="selection"?"crosshair":ft==="zoom"?"ew-resize":ft==="edit"||ft==="cutter"||ft==="reroute"?p?"grabbing":"grab":"default",It=Ke=>{const et="touches"in Ke,ht=wt.draggingInfoRef.current,ut=wt.resizingInfoRef.current;(ht||ut||dt.connectingInfo||nt||p)&&Ke.cancelable&&Ke.preventDefault();let at=Ke;if(et?at=Ke.touches[0]:"pointerId"in Ke&&(at=Ke),!at)return;d({clientX:at.clientX,clientY:at.clientY});const kt=v({x:at.clientX,y:at.clientY});if(p&&(Ke.type==="touchmove"?it.handleCanvasTouchMove(Ke):u({x:at.clientX,y:at.clientY})),qe){const St=at.clientX-qe.startClientX,Et=Math.pow(2,St/300),Mt=Math.max(.2,Math.min(2,(qe.startScale||1)*Et));_(Mt,qe.pivot);return}dt.connectingInfo&&dt.processConnectionDrag(kt,Ke),ht?wt.processDrag(at,Ce,ze):ut?wt.processResize(at):nt&&Nt({start:nt.start,end:v({x:at.clientX,y:at.clientY})})},Ee=Ke=>{if(p&&w(),qe&&Ye(null),nt){const et=nt,ht=Math.min(et.start.x,et.end.x),ut=Math.min(et.start.y,et.end.y),at=Math.abs(et.start.x-et.end.x),kt=Math.abs(et.start.y-et.end.y);if(at>0&&kt>0){const St=$e.current.filter(Ct=>{const Et=Ct.isCollapsed?In:Ct.height;return Ct.position.x<ht+at&&Ct.position.x+Ct.width>ht&&Ct.position.y<ut+kt&&Ct.position.y+Et>ut}).map(Ct=>Ct.id);Q(St),St.length>0&&o(Ct=>Ct.map(Et=>St.includes(Et.id)&&Et.isNewlyCreated?{...Et,isNewlyCreated:!1}:Et))}Nt(null)}(wt.draggingInfoRef.current||wt.resizingInfoRef.current)&&wt.endDrag(),dt.connectingInfo&&dt.endConnection(Ke,p,wt.draggingInfoRef.current)};y.useEffect(()=>(window.addEventListener("mousemove",It),window.addEventListener("mouseup",Ee),window.addEventListener("touchmove",It,{passive:!1}),window.addEventListener("touchend",Ee),window.addEventListener("pointermove",It),window.addEventListener("pointerup",Ee),()=>{window.removeEventListener("mousemove",It),window.removeEventListener("mouseup",Ee),window.removeEventListener("touchmove",It),window.removeEventListener("touchend",Ee),window.removeEventListener("pointermove",It),window.removeEventListener("pointerup",Ee)}),[p,qe,nt,dt.connectingInfo,dt.connectionTarget,dt.endConnection,wt.draggingInfoRef.current,wt.resizingInfoRef.current,Ce,l,k,xe,ze]);const Ue=y.useMemo(()=>{if(ue.length<2)return null;const Ke=t.filter(at=>ue.includes(at.id));if(Ke.length<2)return null;let et=1/0,ht=1/0,ut=-1/0;return Ke.forEach(at=>{et=Math.min(et,at.position.x),ht=Math.min(ht,at.position.y),ut=Math.max(ut,at.position.x+at.width)}),{x:(et+ut)/2,y:ht-60}},[t,ue]);return{handleCanvasMouseDown:it.handleCanvasMouseDown,handleCanvasTouchStart:it.handleCanvasTouchStart,handleCanvasTouchMove:it.handleCanvasTouchMove,handleCanvasTouchEnd:it.handleCanvasTouchEnd,getCanvasCursor:cn,selectedNodeIds:ue,setSelectedNodeIds:Q,connectingInfo:dt.connectingInfo,setConnectingInfo:dt.setConnectingInfo,zoomDragInfo:qe,setZoomDragInfo:Ye,resizingInfo:wt.resizingInfo,setResizingInfo:wt.setResizingInfo,hoveredNodeId:dt.hoveredNodeId,setHoveredNodeId:dt.setHoveredNodeId,connectionTarget:dt.connectionTarget,setConnectionTarget:dt.setConnectionTarget,handleNodeResizeMouseDown:wt.handleNodeResizeMouseDown,handleNodeMouseDown:wt.handleNodeMouseDown,handleNodeTouchStart:wt.handleNodeTouchStart,handleGroupMouseDown:wt.handleGroupMouseDown,handleGroupTouchStart:wt.handleGroupTouchStart,handleStartConnection:dt.handleStartConnection,handleStartConnectionTouch:dt.handleStartConnectionTouch,isRadialMenuOpen:ve,setIsRadialMenuOpen:Ge,radialMenuPosition:Xe,setRadialMenuPosition:pt,radialMenuSelectedItem:Ve,setRadialMenuSelectedItem:ot,deselectAllNodes:()=>Q([]),setSelectionRect:Nt,selectionRect:nt,effectiveTool:ft,setActiveTool:st,hoveredGroupIdForDrop:wt.hoveredGroupIdForDrop,draggingInfo:wt.draggingInfo,handleGroupSelection:()=>{if(ue.length>1){const Ke=$e.current.filter(et=>ue.includes(et.id));z(Ke),Q([])}},handleCanvasDoubleClick:_t,dockHoverMode:Pe,setDockHoverMode:ye,isDockingMenuVisible:_e,setIsDockingMenuVisible:Fe,clientPointerPositionRef:Te,groupButtonPosition:Ue,handlePaste:Ie,selectNode:Ne}},LC=e=>{const{getCurrentCanvasState:t,loadCanvasState:o,setError:r,nodes:a,handleValueChange:i,addToast:s,t:l,activeTabName:c,getFullSizeImage:d,handleRenameTab:u,activeTabId:p,setFullSizeImage:m,tabs:w,setTabs:k,setActiveTabId:b,catalogItems:x,setCatalogItems:f,libraryItems:h,setLibraryItems:v,characterCatalog:N,scriptCatalog:_,sequenceCatalog:E,language:I,setLanguage:B,isSnapToGrid:M,setIsSnapToGrid:G,lineStyle:V,setLineStyle:j,setConfirmInfo:P,handleRenameNode:S,onAddNode:A,pasteGroup:O,viewTransform:z}=e,L=y.useRef(null),W=y.useRef(null),D=y.useRef(null),T=y.useRef(null),F=y.useRef(null),te=y.useRef(null),$=()=>new Date().toISOString().replace(/:/g,"-").replace("T","_").split(".")[0],Y=y.useCallback(()=>{const X={type:"prompt-modifier-canvas",appName:"Prompt_modifier",version:1,...t(),timestamp:new Date().toISOString()},ue=new Blob([JSON.stringify(X,null,2)],{type:"application/json"}),Q=URL.createObjectURL(ue),ce=document.createElement("a");ce.href=Q;const pe=c.trim().replace(/\s+/g,"_");ce.download=`Prompt_Modifier_${pe}_${$()}.PMC`,ce.click(),URL.revokeObjectURL(Q),ce.remove(),s(l("toast.canvasSaved"),"success")},[t,c,s,l]),oe=y.useCallback(()=>{const ne=t(),X=w.map(me=>me.id===p?{...me,state:ne}:me),ue={type:"prompt-modifier-project",appName:"Prompt_modifier",version:1,timestamp:new Date().toISOString(),tabs:X,activeTabId:p,settings:{language:I,isSnapToGrid:M,lineStyle:V},catalogs:{groups:x,library:h,characters:N.items,scripts:_.items,sequences:E.items}},Q=new Blob([JSON.stringify(ue,null,2)],{type:"application/json"}),ce=URL.createObjectURL(Q),pe=document.createElement("a");pe.href=ce,pe.download=`Prompt_Modifier_Project_${$()}.PMP`,pe.click(),URL.revokeObjectURL(ce),pe.remove(),s(l("toast.projectSaved"),"success")},[t,w,p,I,M,V,x,h,N.items,_.items,E.items,s,l]),le=y.useCallback(ne=>{try{const X=JSON.parse(ne);if(X.type==="prompt-modifier-project"){X.tabs&&Array.isArray(X.tabs)&&(k(X.tabs),X.activeTabId&&b(X.activeTabId)),X.settings&&(X.settings.language&&B(X.settings.language),X.settings.isSnapToGrid!==void 0&&G(X.settings.isSnapToGrid),X.settings.lineStyle&&j(X.settings.lineStyle)),X.catalogs&&(X.catalogs.groups&&f(X.catalogs.groups),X.catalogs.library&&v(X.catalogs.library),X.catalogs.characters&&N.replaceAllItems(X.catalogs.characters),X.catalogs.scripts&&_.replaceAllItems(X.catalogs.scripts),X.catalogs.sequences&&E.replaceAllItems(X.catalogs.sequences)),s(l("toast.downloadStarted"),"success");return}let ue;if(X.nodes&&X.connections)ue={nodes:X.nodes||[],connections:X.connections||[],groups:X.groups||[],viewTransform:X.viewTransform||{scale:1,translate:{x:0,y:0}},nodeIdCounter:X.nodeIdCounter||100,fullSizeImageCache:X.fullSizeImageCache||{}};else throw new Error("Invalid file format");o(ue)}catch(X){console.error("Load error:",X),r(`Failed to load file: ${X.message}`)}},[k,b,B,G,j,f,v,N,_,E,o,r,s,l]),K=y.useCallback(ne=>{try{const X=JSON.parse(ne);if(X.type==="script-modifier-project"||X.type==="script-modifier-canvas"){r(l("error.scriptModifierCanvas"));return}if(X.type==="prompt-modifier-project")P({title:l("dialog.confirmLoad.title"),message:l("dialog.confirmLoad.message")+" (Project)",onConfirm:()=>le(ne)});else if(X.nodes&&X.connections){const ue=`tab-${Date.now()}`,Q={id:ue,name:`Ext ${$()}`,state:{nodes:X.nodes||[],connections:X.connections||[],groups:X.groups||[],viewTransform:X.viewTransform||{scale:1,translate:{x:0,y:0}},nodeIdCounter:X.nodeIdCounter||100,fullSizeImageCache:X.fullSizeImageCache||{}}};k(ce=>[...ce,Q]),b(ue),s(l("toast.downloadStarted"),"success")}else throw new Error("Unknown file format")}catch(X){r(`Failed to open external file: ${X.message}`)}},[le,P,l,k,b,r,s]),ie=y.useCallback(ne=>{var pe;const X=(pe=ne.target.files)==null?void 0:pe[0];if(!X)return;const ue=X.name.match(/^Prompt_Modifier_(.+?)_\d{4}-\d{2}-\d{2}/),Q=ue&&ue[1]?ue[1].replace(/_/g," "):null,ce=new FileReader;ce.onload=me=>{var Re;const ke=(Re=me.target)==null?void 0:Re.result;try{const Me=JSON.parse(ke);if(Me.type==="script-modifier-project"||Me.type==="script-modifier-canvas"){r(l("error.scriptModifierCanvas"));return}const De=Me.type==="prompt-modifier-project",Ie=()=>{le(ke),!De&&Q&&u(p,Q)};P({title:l("dialog.confirmLoad.title"),message:l("dialog.confirmLoad.message")+(De?" (Loading Project)":""),onConfirm:Ie})}catch{r("Invalid JSON file.")}},ce.readAsText(X),ne.target&&(ne.target.value="")},[le,P,l,r,u,p]),Z=y.useCallback(()=>{var ne;(ne=L.current)==null||ne.click()},[]),se=y.useCallback(ne=>{var X;te.current=ne,(X=W.current)==null||X.click()},[]),de=y.useCallback(ne=>{var pe;const X=(pe=ne.target.files)==null?void 0:pe[0];if(!X||!te.current)return;const ue=te.current,Q=a.find(me=>me.id===ue);if(!Q)return;const ce=new FileReader;ce.onload=me=>{var Re;const ke=(Re=me.target)==null?void 0:Re.result;try{const Me=JSON.parse(ke);let De=[],Ie=[],Ne="",Pe=[],ye={};if(Me.type==="script-prompt-modifier-data"?(De=Me.finalPrompts||Me.prompts||[],Ie=Me.videoPrompts||[],Ne=Me.styleOverride||"",Pe=Me.usedCharacters||[],ye=Me.sceneContexts||{}):Array.isArray(Me)?De=Me:Me.prompts&&(De=Me.prompts),Array.isArray(De)){const _e=new Map(Ie.map(He=>[He.frameNumber,He])),Fe=De.map((He,be)=>{const Ae=He.frameNumber!==void 0?He.frameNumber:be+1,Te=_e.get(Ae);let qe=He.characters||[];const Ye=He.prompt||"";if(qe.length===0&&Ye){const nt=Ye.match(/(?:character|entity)-\d+/gi)||[];qe=[...new Set(nt.map(Nt=>Nt.toLowerCase().replace(/character-/i,"Entity-").replace(/entity-/i,"Entity-")))]}return{frameNumber:Ae,sceneNumber:He.sceneNumber||1,sceneTitle:He.sceneTitle||"",prompt:Ye,videoPrompt:(Te==null?void 0:Te.videoPrompt)||He.videoPrompt||"",shotType:He.shotType||He.ShotType||(Te==null?void 0:Te.shotType)||"WS",characters:qe,isCollapsed:!0,duration:He.duration||3}}),We=JSON.parse(Q.value||"{}"),Ze=Fe.reduce((He,be)=>({...He,[be.frameNumber]:"idle"}),{}),$e={prompts:Fe,frameStatuses:Ze,selectedFrameNumber:null,checkedFrameNumbers:[]};Ne&&($e.styleOverride=Ne),Pe.length>0&&($e.usedCharacters=Pe),Object.keys(ye).length>0&&($e.sceneContexts=ye),i(ue,JSON.stringify({...We,...$e}))}else r("Invalid Image Sequence format.")}catch(Me){r(`Error loading sequence file: ${Me.message}`)}},ce.readAsText(X),te.current=null,ne.target&&(ne.target.value="")},[a,i,r]),re=y.useCallback(ne=>{var X;te.current=ne,(X=D.current)==null||X.click()},[]),R=y.useCallback(ne=>{var pe;const X=(pe=ne.target.files)==null?void 0:pe[0];if(!X||!te.current)return;const ue=te.current,Q=a.find(me=>me.id===ue);if(!Q)return;const ce=new FileReader;ce.onload=me=>{var Re;const ke=(Re=me.target)==null?void 0:Re.result;try{const Me=JSON.parse(ke);let De=null,Ie=null,Ne="",Pe=[],ye={};if(Me&&Me.type==="script-prompt-modifier-data"?(De=Me.finalPrompts||Me.prompts,Ie=Me.videoPrompts,Ne=Me.styleOverride||"",Pe=Me.usedCharacters||[],ye=Me.sceneContexts||{}):Array.isArray(Me)?De=Me:Me&&Array.isArray(Me.prompts)?De=Me.prompts:Me&&Array.isArray(Me.finalPrompts)&&(De=Me.finalPrompts),De&&Array.isArray(De)){const _e=new Map((Ie||[]).map(Ze=>[Ze.frameNumber,Ze])),Fe=De.map((Ze,$e)=>{const He=Ze.frameNumber!==void 0?Ze.frameNumber:$e+1,be=_e.get(He);let Ae=Ze.prompt||(typeof Ze=="string"?Ze:""),Te=Ze.characters||[];if(Te.length===0&&Ae){const qe=Ae.match(/(?:character|entity)-\d+/gi)||[];Te=[...new Set(qe.map(Ye=>Ye.toLowerCase().replace(/character-/i,"Entity-").replace(/entity-/i,"Entity-")))]}return{frameNumber:He,sceneNumber:Ze.sceneNumber||1,sceneTitle:Ze.sceneTitle||"",prompt:Ae,videoPrompt:(be==null?void 0:be.videoPrompt)||Ze.videoPrompt||"",shotType:Ze.shotType||Ze.ShotType||(be==null?void 0:be.shotType)||"WS",characters:Te,isCollapsed:!0,duration:Ze.duration||3}}),We=JSON.parse(Q.value||"{}");if(Q.type===q.PROMPT_SEQUENCE_EDITOR){const Ze={sourcePrompts:Fe,modifiedPrompts:[],checkedSourceFrameNumbers:[],isStyleCollapsed:!0};Ne&&(Ze.styleOverride=Ne),Pe.length>0&&(Ze.usedCharacters=Pe),Object.keys(ye).length>0&&(Ze.sceneContexts=ye);const $e=JSON.stringify({...We,...Ze});i(ue,$e)}}else throw new Error("JSON is not an array of prompts or does not contain a 'prompts' or 'finalPrompts' array.")}catch(Me){r(`Error loading prompts file: ${Me.message}`)}},ce.readAsText(X),te.current=null,ne.target&&(ne.target.value="")},[a,i,r]),J=y.useCallback(ne=>{var X;te.current=ne,(X=T.current)==null||X.click()},[]),H=y.useCallback(ne=>{var ce;const X=(ce=ne.target.files)==null?void 0:ce[0];if(!X||!te.current)return;const ue=te.current,Q=new FileReader;Q.onload=async pe=>{var ke;const me=(ke=pe.target)==null?void 0:ke.result;try{let Re=JSON.parse(me);Array.isArray(Re)||(Re=[Re]);const Me=await Promise.all(Re.map(async(De,Ie)=>{const Ne=De.imageSources||{"1:1":null,"16:9":null,"9:16":null},Pe={"1:1":null,"16:9":null,"9:16":null};De.image&&!De.imageSources&&(Ne["1:1"]=De.image);const ye={};for(const[We,Ze]of Object.entries(Ne)){let $e=Ze;typeof $e=="string"&&!$e.startsWith("data:")&&$e.length>100&&($e=`data:image/png;base64,${$e}`),ye[We]=$e}for(const[We,Ze]of Object.entries(ye))if(typeof Ze=="string"&&Ze.startsWith("data:")){const $e=Ut[We];$e&&m(ue,Ie*10+$e,Ze);const He=await Ot(Ze,256,256);Pe[We]=He}else Pe[We]=Ze;const _e=De.selectedRatio||"1:1",Fe=ye[_e];return Fe&&typeof Fe=="string"&&Fe.startsWith("data:")&&m(ue,Ie*10,Fe),{id:De.id||`char-card-${Date.now()}-${Ie}`,name:De.name||"",index:De.index||De.alias||`Entity-${Ie+1}`,image:Pe[_e],thumbnails:Pe,selectedRatio:_e,prompt:De.prompt||De.imagePrompt||"",fullDescription:De.fullDescription||De.description||"",targetLanguage:De.targetLanguage||"en",isOutput:De.isOutput||Ie===0,isDescriptionCollapsed:De.isDescriptionCollapsed??!1}}));Re.length===1&&(Re[0].nodeTitle||Re[0].title)&&S(ue,Re[0].nodeTitle||Re[0].title),i(ue,JSON.stringify(Me)),s(l("toast.characterLoaded"))}catch(Re){r(`Error loading character card: ${Re.message}`)}},Q.readAsText(X),te.current=null,ne.target&&(ne.target.value="")},[S,i,m,s,l,r]),U=y.useCallback((ne,X)=>{var Q;const ue=a.find(ce=>ce.id===ne);if(!(!ue||ue.type!==q.CHARACTER_CARD))try{let ce=JSON.parse(ue.value||"[]");Array.isArray(ce)||(ce=[ce]);let pe=[];if(X!==void 0){const Pe=ce[X];if(!Pe)return;const ye={type:"character-card",nodeTitle:ue.title,...Pe,image:d(ne,X*10)||Pe.image,imageSources:{...Pe.thumbnails},index:Pe.index||Pe.alias||`Entity-${X+1}`};Object.entries(Ut).forEach(([_e,Fe])=>{const We=d(ne,X*10+Fe);We&&(ye.imageSources[_e]=We)}),delete ye.thumbnails,delete ye.alias,pe=ye}else pe=ce.map((Pe,ye)=>{const _e={...Pe.thumbnails};Object.entries(Ut).forEach(([Ze,$e])=>{const He=d(ne,ye*10+$e);He&&(_e[Ze]=He)});const Fe=d(ne,ye*10)||Pe.image,We={type:"character-card",nodeTitle:ue.title,...Pe,image:Fe,imageSources:_e,index:Pe.index||Pe.alias||`Entity-${ye+1}`};return delete We.thumbnails,delete We.alias,We});const me=JSON.stringify(pe,null,2),ke=new Blob([me],{type:"application/json"}),Re=URL.createObjectURL(ke),Me=document.createElement("a");Me.href=Re;let De=ue.title||"Character_Card";X!==void 0&&(De=((Q=ce[X])==null?void 0:Q.name)||`Character_${X+1}`);const Ie=De.trim().replace(/[\\/:*?"<>|]/g,"").replace(/\s+/g,"_"),Ne=$();Me.download=`${Ie}_${Ne}.CHAR`,Me.click(),URL.revokeObjectURL(Re),Me.remove(),s(l("toast.characterSavedDisk"))}catch{r("Failed to save character card.")}},[a,d,s,l,r]),ee=y.useCallback(ne=>{var X;te.current=ne,(X=F.current)==null||X.click()},[]),ae=y.useCallback(ne=>{var ce;const X=(ce=ne.target.files)==null?void 0:ce[0];if(!X||!te.current)return;const ue=te.current,Q=new FileReader;Q.onload=pe=>{var ke;const me=(ke=pe.target)==null?void 0:ke.result;try{JSON.parse(me),i(ue,me)}catch(Re){r(`Error loading script file: ${Re.message}`)}},Q.readAsText(X),te.current=null,ne.target&&(ne.target.value="")},[i,r]),xe=y.useCallback(ne=>{const X=a.find(ke=>ke.id===ne);if(!X)return;let ue="",Q=`file_${$()}.json`;if(X.type===q.SCRIPT_GENERATOR||X.type===q.SCRIPT_VIEWER)ue=X.value,Q=`script_${$()}.json`;else if(X.type===q.PROMPT_SEQUENCE_EDITOR)try{const ke=X.value?JSON.parse(X.value):{},Re=ke.sourcePrompts||[],Me=ke.modifiedPrompts||[],De=new Map(Me.map(ye=>[ye.frameNumber,ye])),Ie=Re.map(ye=>{const _e=De.get(ye.frameNumber);return _e?{...ye,..._e}:ye}),Ne={type:"script-prompt-modifier-data",title:X.title||" ",usedCharacters:ke.usedCharacters||[],sceneContexts:ke.sceneContexts||{},finalPrompts:Ie.map(ye=>({frameNumber:ye.frameNumber,sceneNumber:ye.sceneNumber||1,sceneTitle:ye.sceneTitle||"",characters:ye.characters||[],duration:ye.duration||3,prompt:ye.prompt||"",shotType:ye.shotType||"WS"})),videoPrompts:Ie.map(ye=>({sceneNumber:ye.sceneNumber||1,sceneTitle:ye.sceneTitle||"",frameNumber:ye.frameNumber,videoPrompt:ye.videoPrompt||"",shotType:ye.shotType||"WS"})),targetLanguage:"en",startFrameNumber:1,endFrameNumber:Ie.length,startSceneNumber:null,endSceneNumber:null,styleOverride:ke.styleOverride||"",breakIntoParagraphs:!1,copyVideoPrompt:!0,characterPaneHeight:160,isAdvancedMode:!0,model:"gemini-3-pro-preview",processWholeScene:!1,uiState:{isSettingsCollapsed:!1}};ue=JSON.stringify(Ne,null,2),Q=`${(X.title||"sequence").trim().replace(/\s+/g,"_")}_${$()}.json`}catch{r("Failed to parse sequence editor data for saving to disk.");return}else if(X.type===q.IMAGE_SEQUENCE_GENERATOR)try{const ke=X.value?JSON.parse(X.value):{},Re=(ke.prompts||[]).map(({frameNumber:Ie,characters:Ne,duration:Pe,prompt:ye,videoPrompt:_e,sceneNumber:Fe,sceneTitle:We,shotType:Ze})=>({frameNumber:Ie,characters:Ne,duration:Pe,prompt:ye,videoPrompt:_e,sceneNumber:Fe||1,sceneTitle:We||"",shotType:Ze||"WS"})),Me={type:"script-prompt-modifier-data",title:X.title||"Sequence Generator",usedCharacters:ke.usedCharacters||[],sceneContexts:ke.sceneContexts||{},finalPrompts:Re.map(Ie=>({frameNumber:Ie.frameNumber,sceneNumber:Ie.sceneNumber,sceneTitle:Ie.sceneTitle,characters:Ie.characters,duration:Ie.duration,prompt:Ie.prompt,shotType:Ie.shotType})),videoPrompts:Re.map(Ie=>({sceneNumber:Ie.sceneNumber,sceneTitle:Ie.sceneTitle,frameNumber:Ie.frameNumber,videoPrompt:Ie.videoPrompt||"",shotType:Ie.shotType})),styleOverride:ke.styleOverride||""};ue=JSON.stringify(Me,null,2),Q=`${(X.title||"seq_gen").trim().replace(/\s+/g,"_")}_${$()}.json`}catch{r("Failed to parse sequence generator data for saving to disk.");return}else return;const ce=new Blob([ue],{type:"application/json"}),pe=URL.createObjectURL(ce),me=document.createElement("a");me.href=pe,me.download=Q,me.click(),URL.revokeObjectURL(pe),me.remove(),s(l("toast.scriptSaved"))},[a,s,l,r]);return{fileInputRef:L,handleFileChange:ie,handleLoadCanvas:Z,handleSaveCanvas:Y,handleSaveProject:oe,handleLoadCanvasIntoCurrentTab:le,handleLoadFromExternal:K,imageSequenceFileInputRef:W,handleImageSequenceFileChange:de,triggerLoadImageSequenceFile:se,promptSequenceEditorFileInputRef:D,handlePromptSequenceFileChange:R,triggerLoadPromptSequenceFile:re,characterCardFileInputRef:T,handleCharacterCardFileChange:H,triggerLoadCharacterCard:J,handleSaveCharacterCard:U,scriptFileInputRef:F,handleScriptFileChange:ae,triggerLoadScriptFile:ee,handleSaveScriptFile:xe}},DC=new Map,zC=e=>{DC.delete(e)},qC="PromptModifierSessionDB",qa="AppState",hu="latest_session",OC=1,a1=()=>new Promise((e,t)=>{const o=indexedDB.open(qC,OC);o.onerror=()=>t(o.error),o.onsuccess=()=>e(o.result),o.onupgradeneeded=()=>{o.result.objectStoreNames.contains(qa)||o.result.createObjectStore(qa)}}),ym=async(e,t)=>{const o=await a1();return new Promise((r,a)=>{const l=o.transaction(qa,"readwrite").objectStore(qa).put({id:hu,tabs:e,activeTabId:t},hu);l.onerror=()=>a(l.error),l.onsuccess=()=>r()})},FC=async()=>{const e=await a1();return new Promise((t,o)=>{const i=e.transaction(qa,"readonly").objectStore(qa).get(hu);i.onerror=()=>o(i.error),i.onsuccess=()=>{const s=i.result;s&&Array.isArray(s.tabs)&&s.activeTabId?t({tabs:s.tabs,activeTabId:s.activeTabId}):t(void 0)}})},$s=e=>({nodes:[{id:"node-19-1761553959672",type:q.GEMINI_CHAT,position:{x:80,y:1160},value:'{"messages":[],"currentInput":""}',title:Po(e,"node.title.gemini_chat"),width:400,height:640},{id:"node-46-1761685266349",type:q.TEXT_INPUT,position:{x:80,y:380},value:"",title:Po(e,"node.title.text_input"),width:460,height:300},{id:"node-49-1761685294534",type:q.PROMPT_PROCESSOR,position:{x:640,y:320},value:"",title:Po(e,"node.title.prompt_processor"),width:460,height:420},{id:"node-53-1761685402016",type:q.TEXT_INPUT,position:{x:80,y:60},value:"",title:Po(e,"node.title.text_input"),width:460,height:300},{id:"node-54-1761685404557",type:q.TEXT_INPUT,position:{x:80,y:700},value:"",title:Po(e,"node.title.text_input"),width:460,height:300},{id:"node-55-1761685416437",type:q.IMAGE_OUTPUT,position:{x:1220,y:60},value:"",title:Po(e,"node.title.image_output"),width:460,height:940,aspectRatio:"1:1",model:"gemini-2.5-flash-image",autoDownload:!0},{id:"node-82-1761838643720",type:q.TRANSLATOR,position:{x:560,y:1160},value:'{"inputText":"","targetLanguage":"ru","translatedText":"","inputHeight":197}',title:Po(e,"node.title.translator"),width:460,height:640}],connections:[{fromNodeId:"node-49-1761685294534",toNodeId:"node-55-1761685416437",id:"conn-1761685421734-dlsqz1009"},{fromNodeId:"node-53-1761685402016",toNodeId:"node-49-1761685294534",id:"conn-1765381486428-7mzadq6ki"},{fromNodeId:"node-46-1761685266349",toNodeId:"node-49-1761685294534",id:"conn-1765381487379-rsa3lf6ts"},{fromNodeId:"node-54-1761685404557",toNodeId:"node-49-1761685294534",id:"conn-1765381488527-69zcwd7sm"}],groups:[],viewTransform:{scale:1,translate:{x:21.096368784472816,y:34.78642041088381}},nodeIdCounter:85,fullSizeImageCache:{}}),i1=$s("en"),ms=(e,t)=>({id:`tab-${Date.now()}`,name:e,state:{nodes:(t==null?void 0:t.nodes)||[],connections:(t==null?void 0:t.connections)||[],groups:(t==null?void 0:t.groups)||[],viewTransform:(t==null?void 0:t.viewTransform)||{scale:1,translate:{x:0,y:0}},nodeIdCounter:(t==null?void 0:t.nodeIdCounter)||0,fullSizeImageCache:(t==null?void 0:t.fullSizeImageCache)||{}}}),BC=()=>{const[e,t]=y.useState(()=>[ms("Canvas 1",i1)]),[o,r]=y.useState(e[0].id),[a,i]=y.useState(!1),s=y.useRef(null),[l,c]=y.useState(null),[d,u]=y.useState(!1);y.useEffect(()=>{(async()=>{try{const N=await FC();N&&(t(N.tabs),r(N.activeTabId))}catch(N){console.error("Failed to load session from IndexedDB:",N)}finally{i(!0)}})()},[]),y.useEffect(()=>{if(!a)return;s.current&&clearTimeout(s.current);const v=6e4;return c(Date.now()+v),s.current=setTimeout(()=>{u(!0);const N=async()=>{try{await ym(e,o)}catch(_){console.error("Failed to auto-save session:",_)}finally{u(!1),c(null)}};"requestIdleCallback"in window?window.requestIdleCallback(N,{timeout:5e3}):N()},v),()=>{s.current&&clearTimeout(s.current)}},[e,o,a]);const p=y.useCallback(v=>{v!==o&&r(v)},[o]),m=y.useCallback(()=>{const v=ms(`Canvas ${e.length+1}`);t(N=>[...N,v]),r(v.id)},[e.length]),w=y.useCallback(v=>{zC(v),t(N=>{if(N.length<=1)return N;const _=N.findIndex(I=>I.id===v),E=N.filter(I=>I.id!==v);if(o===v){const I=Math.max(0,_-1);r(E[I].id)}return E})},[o]),k=y.useCallback((v,N)=>{t(_=>_.map(E=>E.id===v?{...E,name:N}:E))},[]),b=y.useCallback(v=>{const N=$s(v),_=ms("Canvas 1",N);t([_]),r(_.id),ym([_],_.id)},[]),x=y.useCallback(v=>{const N=$s(v);t(_=>_.map(E=>E.id===o?{...E,state:N}:E))},[o]),f=y.useCallback(v=>{t(N=>N.map(_=>_.id===o?{..._,state:v}:_))},[o]),h=y.useCallback(()=>{var v;return((v=e.find(N=>N.id===o))==null?void 0:v.state)||ms("").state},[e,o]);return{tabs:e,setTabs:t,activeTabId:o,setActiveTabId:r,handleSwitchTab:p,handleAddTab:m,handleCloseTab:w,handleRenameTab:k,loadCanvasState:f,getCurrentCanvasState:h,resetTabs:b,resetCurrentTab:x,getLocalizedCanvasState:$s,nextAutoSaveTime:l,isAutoSaving:d}},od="quick_slots_config",HC=e=>{const{setGroups:t,renameCatalogItem:o,updateLibraryItem:r,handleRenameTab:a,handleCloseTab:i,handleRenameNode:s,getCurrentCanvasState:l,loadCanvasState:c,tabs:d,activeTabId:u,t:p,characterCatalog:m,scriptCatalog:w,sequenceCatalog:k}=e,[b,x]=y.useState(!1),[f,h]=y.useState({x:0,y:0}),[v,N]=y.useState(!1),[_,E]=y.useState({x:0,y:0}),[I,B]=y.useState(!1),[M,G]=y.useState(null),[V,j]=y.useState(!1),[P,S]=y.useState(null),[A,O]=y.useState(null),[z,L]=y.useState(null),[W,D]=y.useState(!1),[T,F]=y.useState(!1),te=y.useRef({onSelect:()=>{},onClose:()=>{}}),[$,Y]=y.useState(null),[oe,le]=y.useState(null),[K,ie]=y.useState(null),[Z,se]=y.useState(null),[de,re]=y.useState(!1),[R,J]=y.useState(Array(8).fill(null)),[H,U]=y.useState(!1);y.useEffect(()=>{const Te=localStorage.getItem(od);if(Te)try{const qe=JSON.parse(Te);Array.isArray(qe)&&qe.length===8&&J(qe)}catch(qe){console.error("Failed to load quick slots",qe)}},[]);const ee=y.useCallback((Te,qe)=>{J(Ye=>{const nt=[...Ye];return nt[Te]=qe,localStorage.setItem(od,JSON.stringify(nt)),nt})},[]),ae=y.useCallback(Te=>{Array.isArray(Te)&&Te.length===8&&(J(Te),localStorage.setItem(od,JSON.stringify(Te)))},[]),xe=y.useCallback(Te=>{ie({isOpen:!0,position:Te}),se(null),le(null)},[]),ne=y.useCallback((Te=!1)=>{!Te&&de||(ie(null),re(!1))},[de]),X=y.useCallback((Te,qe)=>{Te.preventDefault(),Te.stopPropagation(),se({isOpen:!0,position:{x:Te.clientX,y:Te.clientY},nodeId:qe}),ie(null),le(null)},[]),ue=y.useCallback(()=>{se(null)},[]),Q=y.useCallback(()=>{re(Te=>!Te)},[]),ce=y.useCallback(()=>{U(Te=>!Te)},[]),pe=y.useCallback(Te=>{h(Te),x(!0)},[]),me=y.useCallback(Te=>{N(!0),E(Te)},[]),ke=y.useCallback(()=>{x(!1),H||N(!1),de||ie(null),se(null)},[de,H]),Re=y.useCallback((Te,qe,Ye)=>{G({position:Te,connectingInfo:qe,sourceNodeType:Ye}),B(!0)},[]),Me=y.useCallback(()=>{B(!1),G(null)},[]),De=y.useCallback(()=>j(Te=>!Te),[]),Ie=y.useCallback(()=>j(!1),[]),Ne=y.useCallback(Te=>{if(!P||!Te||!Te.trim()){S(null);return}const qe=Te.trim();P.type==="group"?t(Ye=>Ye.map(nt=>nt.id===P.id?{...nt,title:qe}:nt)):P.type==="catalog"?o(P.id,qe):P.type==="library"?r(P.id,{name:qe}):P.type==="tab"?a(P.id,qe):P.type==="character"?m.renameItem(P.id,qe):P.type==="script"?w.renameItem(P.id,qe):P.type==="sequence"?k.renameItem(P.id,qe):P.type==="node"&&s(P.id,qe),S(null)},[P,t,o,r,a,m,w,k,s]),Pe=y.useCallback((Te,qe)=>{A&&r(A.id,{name:Te.trim(),content:qe}),O(null)},[A,r]),ye=y.useCallback(Te=>{const qe=()=>{c({nodes:[],connections:[],groups:[],viewTransform:{scale:1,translate:{x:0,y:0}},nodeIdCounter:0,fullSizeImageCache:{}})};Te!=null&&Te.shiftKey?qe():L({title:p("dialog.confirmClear.title"),message:p("dialog.confirmClear.message"),onConfirm:qe})},[p,c]),_e=y.useCallback(Te=>{const qe=()=>{const Ye=JSON.parse(JSON.stringify(i1));c(Ye)};Te!=null&&Te.shiftKey?qe():L({title:p("dialog.confirmReset.title"),message:p("dialog.confirmReset.message"),onConfirm:qe})},[p,c]),Fe=y.useCallback(Te=>{te.current=Te,F(!0)},[]),We=y.useCallback(()=>{te.current.onSelect(),F(!1)},[]),Ze=y.useCallback(()=>{te.current.onClose(),F(!1)},[]),$e=y.useCallback((Te,qe)=>{if(d.length<=1)return;const Ye=d.find(ze=>ze.id===Te);if(!Ye)return;const nt=Te===u?l():Ye.state;nt.nodes.length===0&&nt.connections.length===0&&(nt.groups||[]).length===0||qe!=null&&qe.shiftKey?i(Te):L({title:p("dialog.confirmCloseTab.title"),message:p("dialog.confirmCloseTab.message",{tabName:Ye.name}),onConfirm:()=>i(Te)})},[d,u,i,L,p,l]),He=y.useCallback(Te=>{Te&&navigator.clipboard.writeText(Te).then(()=>{D(!0)})},[]),be=y.useCallback((Te,qe)=>{le({nodeIds:Te,position:qe})},[]),Ae=y.useCallback(()=>{le(null)},[]);return{isQuickSearchOpen:b,quickSearchPosition:f,isQuickAddOpen:v,quickAddPosition:_,isCatalogOpen:V,renameInfo:P,promptEditInfo:A,confirmInfo:z,isErrorCopied:W,isApiKeyDialogOpen:T,handleOpenQuickSearch:pe,handleOpenQuickAdd:me,handleCloseAddNodeMenus:ke,handleToggleCatalog:De,handleCloseCatalog:Ie,setRenameInfo:S,setPromptEditInfo:O,setConfirmInfo:L,confirmRename:Ne,confirmPromptEdit:Pe,setIsErrorCopied:D,handleClearCanvas:ye,handleResetCanvas:_e,showApiKeyDialog:Fe,handleApiKeySelect:We,handleApiKeyDialogClose:Ze,handleCloseTab:$e,handleCopyError:He,loadCanvasState:c,imageViewer:$,setImageViewer:Y,isConnectionQuickAddOpen:I,connectionQuickAddInfo:M,handleOpenConnectionQuickAdd:Re,handleCloseConnectionQuickAdd:Me,contextMenu:K,nodeContextMenu:Z,isContextMenuPinned:de,toggleContextMenuPin:Q,quickSlots:R,updateQuickSlot:ee,setAllQuickSlots:ae,handleOpenContextMenu:xe,handleCloseContextMenu:ne,handleOpenNodeContextMenu:X,handleCloseNodeContextMenu:ue,isQuickAddMenuPinned:H,toggleQuickAddMenuPin:ce,nodeDeleteConfirm:oe,requestDeleteNodes:be,cancelDeleteNodes:Ae}},GC=e=>{const[t,o]=y.useState(e),r=y.useRef(0),a=y.useCallback((l,c)=>{if(l.length===0)return;const d=qr(l);if(!d)return;r.current++;const u={id:`group-${r.current}-${Date.now()}`,title:c||`Group ${r.current}`,...d,nodeIds:l.map(p=>p.id)};o(p=>[...p,u])},[]),i=y.useCallback(l=>{o(c=>c.filter(d=>d.id!==l))},[]),s=y.useCallback((l,c)=>{o(d=>d.map(u=>{if(u.id===l){const p=c.filter(w=>u.nodeIds.includes(w.id)),m=qr(p);if(m)return{...u,...m}}return u}))},[]);return{groups:t,setGroups:o,addGroup:a,removeGroup:i,updateGroupBounds:s}};var Oa=(e=>(e.FOLDER="FOLDER",e.GROUP="GROUP",e))(Oa||{}),Jn=(e=>(e.FOLDER="FOLDER",e.ITEM="ITEM",e))(Jn||{});const UC="PromptModifierDB",Fa="Catalogs",VC=1,s1=()=>new Promise((e,t)=>{const o=indexedDB.open(UC,VC);o.onerror=()=>t(o.error),o.onsuccess=()=>e(o.result),o.onupgradeneeded=()=>{o.result.objectStoreNames.contains(Fa)||o.result.createObjectStore(Fa)}}),l1=async e=>{const t=await s1();return new Promise((o,r)=>{const s=t.transaction(Fa,"readonly").objectStore(Fa).get(e);s.onerror=()=>r(s.error),s.onsuccess=()=>o(s.result)})},_l=async(e,t)=>{const o=await s1();return new Promise((r,a)=>{const l=o.transaction(Fa,"readwrite").objectStore(Fa).put(t,e);l.onerror=()=>a(l.error),l.onsuccess=()=>r()})},rd="group-catalog-items",ad=[{id:"default-group-image-editing",type:"GROUP",name:"Image Editing",parentId:null,nodes:[{id:"node-28-1761576310796",type:q.IMAGE_EDITOR,position:{x:460,y:0},value:'{"inputImage":null,"prompt":"","outputImage":null,"aspectRatio":"1:1","enableOutpainting":true,"inputImages":[],"outpaintingPrompt":"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.","topPaneHeight":645.6608879498896,"leftPaneRatio":0.4960591133004926}',title:" ",width:1040,height:1380,autoDownload:!0},{id:"node-29-1761576319677",type:q.NOTE,position:{x:0,y:0},value:`      Google

Edit images using modern innovations from Google`,title:"",width:380,height:240}],connections:[]}],c1=()=>new Date().toISOString().replace(/:/g,"-").replace("T","_").split(".")[0],id=(e,t,o,r,a,i=[])=>{const[s,l]=y.useState([]),[c,d]=y.useState(!1);y.useEffect(()=>{(async()=>{try{const S=await l1(e);if(S&&S.length>0)l(S);else{const A=i.length>0?i:[];l(A),A.length>0&&await _l(e,A)}}catch(S){console.error(`Failed to load catalog from IndexedDB (${e}):`,S),l(i)}finally{d(!0)}})()},[e]);const[u,p]=y.useState([null]),m=y.useRef(null),w=u[u.length-1],k=async P=>{try{await _l(e,P)}catch(S){console.error(`Failed to save catalog to ${e}`,S),alert(`Failed to save catalog: ${S}`)}},b=y.useMemo(()=>c?s.filter(P=>P.parentId===w).sort((P,S)=>P.type===S.type?P.name.localeCompare(S.name):P.type==="FOLDER"?-1:1):[],[s,w,c]),x=y.useMemo(()=>{const P={id:null,name:t};if(!c)return[P];const S=[];let A=w;for(;A;){const O=s.find(z=>z.id===A);if(O)S.unshift({id:O.id,name:O.name}),A=O.parentId;else break}return[P,...S]},[w,s,t,c]),f=y.useCallback(P=>{const S=u.findIndex(A=>A===P);S>-1?p(A=>A.slice(0,S+1)):p(A=>[...A,P])},[u]),h=y.useCallback(()=>{p(P=>P.length>1?P.slice(0,-1):P)},[]),v=y.useCallback(async(P,S,A)=>{if(!c)return;const O={id:`content-item-${Date.now()}-${Math.random()}`,type:P,name:S,parentId:w,content:A};l(z=>{const L=[...z,O];return k(L),L})},[c,w]),N=y.useCallback(async(P,S)=>{c&&l(A=>{const O=A.map(z=>z.id===P?{...z,name:S}:z);return k(O),O})},[c]),_=y.useCallback(async(P,S)=>{c&&l(A=>{const O=A.map(z=>z.id===P?{...z,driveFileId:S}:z);return k(O),O})},[c]),E=y.useCallback(async P=>{c&&l(S=>{const A=new Set([P]),O=[P];for(;O.length>0;){const L=O.shift();for(const W of S)W.parentId===L&&(A.add(W.id),W.type==="FOLDER"&&O.push(W.id))}const z=S.filter(L=>!A.has(L.id));return k(z),z})},[c]),I=y.useCallback(P=>{const S=s.find(te=>te.id===P);if(!S)return;let A;if(S.type==="ITEM"){let te;try{te=JSON.parse(S.content||"{}")}catch{te=S.content}A={type:"item",name:S.name,content:te}}else{const te=$=>{const Y=s.find(le=>le.id===$);if(!Y)return null;const oe=s.filter(le=>le.parentId===$);return{name:Y.name,type:"folder",children:oe.map(le=>{if(le.type==="FOLDER")return te(le.id);{let K=le.content;try{K=JSON.parse(K)}catch{}return{name:le.name,type:"item",content:K}}})}};A=te(P)}const z=JSON.stringify({appName:"Prompt_modifier",catalogContext:r,root:A},null,2),L=new Blob([z],{type:"application/json"}),W=URL.createObjectURL(L),D=document.createElement("a");D.href=W;const T=c1(),F=`Catalog_${r}_${S.name.trim().replace(/\s+/g,"_")}_${T}.json`;D.download=F,D.click(),URL.revokeObjectURL(W),D.remove()},[s,r]),B=y.useCallback(async(P,S)=>{c&&l(A=>{const O=[],z=new Map,L=(F,te,$)=>{if(!F.name||!F.type)return;const Y=F.type==="folder"?"FOLDER":"ITEM";let oe=null;$&&S&&(oe=A.find(ie=>ie.driveFileId===S)),oe||(oe=A.find(ie=>ie.name===F.name&&ie.type===Y&&ie.parentId===te));const le=Y==="ITEM"?JSON.stringify(F.content):void 0;let K;if(oe){K=oe.id;const ie={content:le};$&&S&&(ie.driveFileId=S),z.set(K,ie)}else{K=`content-item-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;const ie={id:K,type:Y,name:F.name,parentId:te,content:le,driveFileId:$&&S?S:void 0};O.push(ie)}Y==="FOLDER"&&Array.isArray(F.children)&&F.children.forEach(ie=>L(ie,K,!1))},W=P.root||P;L(W,w,!0);const T=[...A.map(F=>z.has(F.id)?{...F,...z.get(F.id)}:F),...O];return k(T),T})},[c,w]),M=y.useCallback(P=>{var O;const S=(O=P.target.files)==null?void 0:O[0];if(!S)return;const A=new FileReader;A.onload=z=>{var L;try{const W=(L=z.target)==null?void 0:L.result,D=JSON.parse(W);if(D.appName!=="Prompt_modifier"&&D.appName!=="Script_modifier"&&console.warn(`Compatible App Name check: Found ${D.appName}, expected Prompt_modifier or Script_modifier.`),!D.root)throw new Error(o("alert.invalidCatalogStructure")||'Invalid catalog structure. Missing "root".');if(D.catalogContext&&D.catalogContext!==r&&a){a(D);return}if(D.root)B(D);else if(D.type==="folder"&&Array.isArray(D.children))B({root:D});else{const T=S.name.replace(/^Catalog_.*?_/,"").replace(/_\d{4}-\d{2}-\d{2}.*\.json$/,"").replace(/\.json$/,"");v("ITEM",T,W)}}catch(W){alert(`${o("alert.loadCatalogFailed")}: ${W.message}`)}finally{P.target&&(P.target.value="")}},A.readAsText(S)},[v,o,r,a,B]),G=y.useCallback(()=>{var P;return(P=m.current)==null?void 0:P.click()},[]),V=y.useCallback(async(P,S)=>{c&&l(A=>{const O=A.find(L=>L.id===P);if(!O||O.parentId===S)return A;if(O.type==="FOLDER"){let L=S;for(;L;){if(L===P)return A;const W=A.find(D=>D.id===L);L=W?W.parentId:null}}const z=A.map(L=>L.id===P?{...L,parentId:S}:L);return k(z),z})},[c]),j=y.useCallback(async P=>{c&&(l(P),await k(P))},[c]);return{items:s,currentItems:b,path:x,navigateToFolder:f,navigateBack:h,createItem:v,renameItem:N,deleteItem:E,saveItemToDisk:I,fileInputRef:m,handleFileChange:M,triggerLoadFromFile:G,moveItem:V,replaceAllItems:j,importItemsData:B,setItemDriveId:_}},WC=(e,t)=>{const[o,r]=y.useState([]),[a,i]=y.useState(!1),s="groups";y.useEffect(()=>{(async()=>{try{const j=await l1(rd);j&&j.length>0?r(j):(r(ad),await _l(rd,ad))}catch(j){console.error("Failed to load group catalog",j),r(ad)}finally{i(!0)}})()},[]);const[l,c]=y.useState([null]),d=y.useRef(null),u=l[l.length-1],p=async V=>{try{await _l(rd,V)}catch(j){console.error("Failed to save group catalog",j)}},m=y.useMemo(()=>a?o.filter(V=>V.parentId===u).sort((V,j)=>V.type===j.type?V.name.localeCompare(j.name):V.type==="FOLDER"?-1:1):[],[o,u,a]),w=y.useMemo(()=>{const V={id:null,name:e("catalog.tabs.groups")};if(!a)return[V];const j=[];let P=u;for(;P;){const S=o.find(A=>A.id===P);if(S)j.unshift({id:S.id,name:S.name}),P=S.parentId;else break}return[V,...j]},[u,o,e,a]),k=y.useCallback(V=>{const j=l.findIndex(P=>P===V);j>-1?c(P=>P.slice(0,j+1)):c(P=>[...P,V])},[l]),b=y.useCallback(()=>{c(V=>V.length>1?V.slice(0,-1):V)},[]),x=y.useCallback(async V=>{if(!a||V!=="FOLDER")return;const j={id:`cat-item-${Date.now()}`,type:V,name:e("library.actions.newFolder"),parentId:u};r(P=>{const S=[...P,j];return p(S),S})},[u,e,a]),f=y.useCallback(async(V,j,P,S)=>{if(!a)return;const A=j.filter($=>V.nodeIds.includes($.id));if(A.length===0)return;const O=new Set(A.map($=>$.id)),z=P.filter($=>O.has($.fromNodeId)&&O.has($.toNodeId)),L=JSON.parse(JSON.stringify(A)),W=JSON.parse(JSON.stringify(z)),D=Math.min(...L.map($=>$.position.x)),T=Math.min(...L.map($=>$.position.y));L.forEach($=>{$.position.x-=D,$.position.y-=T});const F={};S&&A.forEach($=>{S[$.id]&&(F[$.id]=S[$.id])});const te={id:`catalog-item-${Date.now()}`,type:"GROUP",name:V.title,parentId:u,nodes:L,connections:W,fullSizeImages:F};r($=>{const Y=[...$,te];return p(Y),Y})},[u,a]),h=y.useCallback(async(V,j)=>{!a||!j||!j.trim()||r(P=>{const S=P.map(A=>A.id===V?{...A,name:j.trim()}:A);return p(S),S})},[a]),v=y.useCallback(async V=>{a&&r(j=>{const P=new Set([V]),S=j.find(O=>O.id===V);if((S==null?void 0:S.type)==="FOLDER"){const O=[V];for(;O.length>0;){const z=O.shift();for(const L of j)L.parentId===z&&(P.add(L.id),L.type==="FOLDER"&&O.push(L.id))}}const A=j.filter(O=>!P.has(O.id));return p(A),A})},[a]),N=y.useCallback(V=>{const j=o.find(T=>T.id===V);if(!j)return;let P;if(j.type==="GROUP")P={type:"prompModifierGroup",name:j.name,nodes:j.nodes,connections:j.connections,fullSizeImages:j.fullSizeImages};else{const T=F=>{const te=o.find(Y=>Y.id===F);if(!te)return null;const $=o.filter(Y=>Y.parentId===F);return{name:te.name,type:"folder",children:$.map(Y=>Y.type==="FOLDER"?T(Y.id):{type:"prompModifierGroup",name:Y.name,nodes:Y.nodes,connections:Y.connections,fullSizeImages:Y.fullSizeImages})}};P=T(V)}const A=JSON.stringify({appName:"Prompt_modifier",catalogContext:s,root:P},null,2),O=new Blob([A],{type:"application/json"}),z=URL.createObjectURL(O),L=document.createElement("a");L.href=z;const W=c1(),D=`Catalog_${s}_${j.name.trim().replace(/\s+/g,"_")}_${W}.json`;L.download=D,L.click(),URL.revokeObjectURL(z),L.remove()},[o]),_=y.useCallback(async V=>{if(!a)return;const j=[],P=(S,A)=>{const O=`cat-item-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;if(!S.name||!S.type)return;const L=S.type==="prompModifierGroup"||S.type==="group"||S.type==="GROUP"?"GROUP":"FOLDER",W={id:O,type:L,name:S.name,parentId:A,nodes:L==="GROUP"?S.nodes||[]:void 0,connections:L==="GROUP"?S.connections||[]:void 0,fullSizeImages:L==="GROUP"?S.fullSizeImages:void 0};j.push(W),L==="FOLDER"&&Array.isArray(S.children)&&S.children.forEach(D=>P(D,O))};P(V.root||V,u),r(S=>{const A=[...S,...j];return p(A),A})},[a,u]),E=y.useCallback(async V=>{var S;const j=(S=V.target.files)==null?void 0:S[0];if(!j||!a)return;const P=new FileReader;P.onload=async A=>{var O;try{const z=(O=A.target)==null?void 0:O.result,L=JSON.parse(z);if(L.appName!=="Prompt_modifier"&&L.appName!=="Script_modifier"&&console.warn(`Importing group catalog from ${L.appName}`),!L.root)throw new Error(e("alert.invalidCatalogStructure")||"Invalid structure.");if(L.catalogContext&&L.catalogContext!==s&&t){t(L);return}_(L)}catch(z){alert(`${e("alert.loadCatalogFailed")}: ${z.message}`)}finally{V.target&&(V.target.value="")}},P.readAsText(j)},[e,a,s,t,_]),I=y.useCallback(()=>{var V;return(V=d.current)==null?void 0:V.click()},[]),B=y.useCallback(async(V,j)=>{a&&r(P=>{const S=P.find(O=>O.id===V);if(!S||S.parentId===j)return P;if(S.type==="FOLDER"){let O=j;for(;O;){if(O===V)return P;const z=P.find(L=>L.id===O);O=z?z.parentId:null}}const A=P.map(O=>O.id===V?{...O,parentId:j}:O);return p(A),A})},[a]),M=y.useCallback(async V=>{a&&(r(V),await p(V))},[a]),G=y.useCallback(async(V,j)=>{a&&r(P=>{const S=P.map(A=>A.id===V?{...A,driveFileId:j}:A);return p(S),S})},[a]);return{catalogItems:o,currentCatalogItems:m,catalogPath:w,navigateCatalogBack:b,navigateCatalogToFolder:k,createCatalogItem:x,saveGroupToCatalog:f,renameCatalogItem:h,deleteCatalogItem:v,saveCatalogItemToDisk:N,catalogFileInputRef:d,handleCatalogFileChange:E,triggerLoadFromFile:I,moveCatalogItem:B,replaceAllItems:M,importItemsData:_,setItemDriveId:G}},$C=e=>{const[t,o]=y.useState(null),[r,a]=y.useState(!1),[i,s]=y.useState(!1);y.useEffect(()=>{let d;return(async()=>{try{d=await navigator.permissions.query({name:e}),o(d.state),d.state==="prompt"&&!i&&a(!0),d.onchange=()=>{o(d.state),d.state!=="prompt"&&a(!1)}}catch(p){console.warn(`Permission API for '${e}' not supported.`,p),o("granted")}})(),()=>{d&&(d.onchange=null)}},[e,i]);const l=y.useCallback(async()=>{try{await navigator.clipboard.readText()}catch(d){d instanceof DOMException&&d.name==="NotAllowedError"&&o("denied"),console.error("Clipboard read failed:",d)}finally{a(!1)}},[]),c=y.useCallback(()=>{a(!1),s(!0)},[]);return{showDialog:r,requestPermission:l,declinePermission:c}},vm="prompt-library-items",wm=[{id:"folder-1",type:$t.FOLDER,name:"Basic Promts",parentId:null},{id:"prompt-1",type:$t.PROMPT,name:"Fill background",parentId:"folder-1",content:"Fill the white background with the surroundings"},{id:"prompt-2",type:$t.PROMPT,name:"Remove all watermarks",parentId:"folder-1",content:"Remove all watermarks, logos, text overlays, and advertisement banners from the image. Restore the original background naturally, blending colors and textures smoothly. Keep all other visual elements unchanged and realistic."},{id:"prompt-3",type:$t.PROMPT,name:"Character concept",parentId:"folder-1",content:"Create a character concept based on the provided image. The character is standing full-length against a gray background."}],KC=()=>new Date().toISOString().replace(/:/g,"-").replace("T","_").split(".")[0],JC=(e,t)=>{const[o,r]=y.useState(()=>{try{const G=localStorage.getItem(vm);return G?JSON.parse(G):wm}catch(G){return console.error("Failed to load prompt library from storage",G),wm}}),a="library",[i,s]=y.useState([null]),l=y.useRef(null),c=i[i.length-1],d=G=>{try{localStorage.setItem(vm,JSON.stringify(G))}catch(V){console.error("Failed to save prompt library to storage",V)}},u=y.useMemo(()=>o.filter(G=>G.parentId===c).sort((G,V)=>G.type===V.type?G.name.localeCompare(V.name):G.type===$t.FOLDER?-1:1),[o,c]),p=y.useMemo(()=>{const G=[{id:null,name:e("catalog.tabs.library")}];return i.slice(1).forEach(V=>{if(!V)return;const j=o.find(P=>P.id===V);j&&G.push({id:j.id,name:j.name})}),G},[i,o,e]),m=y.useCallback(G=>{const V=i.findIndex(j=>j===G);V>-1?s(j=>j.slice(0,V+1)):s(j=>[...j,G])},[i]),w=y.useCallback(()=>{s(G=>G.length>1?G.slice(0,-1):G)},[]),k=y.useCallback(G=>{const V=G===$t.FOLDER?e("library.actions.newFolder"):e("library.actions.newPrompt"),j={id:`lib-item-${Date.now()}`,type:G,name:V,parentId:c,content:G===$t.PROMPT?"":void 0};r(P=>{const S=[...P,j];return d(S),S})},[c,e]),b=y.useCallback((G,V)=>{const j={id:`lib-item-${Date.now()}`,type:$t.PROMPT,name:G,parentId:c,content:V};r(P=>{const S=[...P,j];return d(S),S})},[c]),x=y.useCallback((G,V)=>{G&&r(j=>{let P=j.find(T=>T.type===$t.FOLDER&&T.parentId===null&&T.name===V),S,A=[...j];if(P)S=P.id;else{S=`lib-item-folder-${Date.now()}`;const T={id:S,type:$t.FOLDER,name:V,parentId:null};A.push(T)}let z=G.split(/[\s,]+/).filter(Boolean).slice(0,4).join(" ");z.length>30&&(z=z.substring(0,30)+"..."),z||(z="New Prompt");let L=z,W=1;for(;A.some(T=>T.parentId===S&&T.name===L);)L=`${z} (${W++})`;const D={id:`lib-item-prompt-${Date.now()}`,type:$t.PROMPT,name:L,parentId:S,content:G};return A.push(D),d(A),A})},[]),f=y.useCallback(G=>{x(G,"Processor Prompts")},[x]),h=y.useCallback((G,V)=>{r(j=>{const P=j.map(S=>S.id===G?{...S,...V}:S);return d(P),P})},[]),v=y.useCallback(G=>{r(V=>{new Map(V.map(A=>[A.id,A]));const j=new Set([G]),P=[G];for(;P.length>0;){const A=P.shift();for(const O of V)O.parentId===A&&(j.add(O.id),O.type===$t.FOLDER&&P.push(O.id))}const S=V.filter(A=>!j.has(A.id));return d(S),S})},[]),N=y.useCallback(G=>{let V,j;const P=KC();if(G.type===$t.PROMPT){const L=G.content||"";j=`${G.name.trim().replace(/\s+/g,"_")}_${P}.txt`;const W=new Blob([L],{type:"text/plain"}),D=URL.createObjectURL(W),T=document.createElement("a");T.href=D,T.download=j,T.click(),URL.revokeObjectURL(D),T.remove();return}else{const L=W=>{const D=o.find(F=>F.id===W);if(!D)return null;const T=o.filter(F=>F.parentId===W);return{name:D.name,type:"folder",children:T.map(F=>F.type===$t.FOLDER?L(F.id):{name:F.name,type:"prompt",content:F.content||""})}};V={appName:"Prompt_modifier",catalogContext:a,root:L(G.id)},j=`Catalog_${a}_${G.name.trim().replace(/\s+/g,"_")}_${P}.json`}const S=JSON.stringify(V,null,2),A=new Blob([S],{type:"application/json"}),O=URL.createObjectURL(A),z=document.createElement("a");z.href=O,z.download=j,z.click(),URL.revokeObjectURL(O),z.remove()},[o]),_=y.useCallback(async G=>{const V=[],j=(S,A)=>{const O=`lib-item-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;if(!S.name||!S.type)return;const z=S.type==="folder"?$t.FOLDER:$t.PROMPT,L={id:O,type:z,name:S.name,parentId:A,content:z===$t.PROMPT?S.content||"":void 0};V.push(L),z===$t.FOLDER&&Array.isArray(S.children)&&S.children.forEach(W=>j(W,O))},P=G.root||G;j(P,c),r(S=>{const A=[...S,...V];return d(A),A})},[c]),E=y.useCallback(G=>{var P;const V=(P=G.target.files)==null?void 0:P[0];if(!V)return;const j=new FileReader;j.onload=S=>{var O;const A=(O=S.target)==null?void 0:O.result;try{if(!A)throw new Error("Empty file");if(V.name.endsWith(".txt")){const L=V.name.replace(".txt","");b(L,A);return}const z=JSON.parse(A);if(z.appName!=="Prompt_modifier")throw new Error(e("alert.fileNotSupported")||'File not supported. Missing "appName": "Prompt_modifier".');if(!z.root)throw new Error(e("alert.invalidCatalogStructure")||'Invalid catalog structure. Missing "root".');if(z.catalogContext&&z.catalogContext!==a&&t){t(z);return}_(z)}catch(z){alert(`${e("alert.loadCatalogFailed")}: ${z.message}`)}finally{G.target&&(G.target.value="")}},j.onerror=()=>{alert("Error reading the selected file.")},j.readAsText(V)},[_,t,a,e,b]),I=y.useCallback(()=>{var G;(G=l.current)==null||G.click()},[]),B=y.useCallback((G,V)=>{r(j=>{const P=j.find(A=>A.id===G);if(!P||P.parentId===V)return j;if(P.type===$t.FOLDER){let A=V;for(;A;){if(A===G)return j;const O=j.find(z=>z.id===A);A=O?O.parentId:null}}const S=j.map(A=>A.id===G?{...A,parentId:V}:A);return d(S),S})},[]),M=y.useCallback(G=>{r(G),d(G)},[]);return{libraryItems:o,currentLibraryItems:u,libraryPath:p,navigateBack:w,navigateToFolder:m,createLibraryItem:k,updateLibraryItem:h,deleteLibraryItem:v,saveLibraryItemToDisk:N,libraryFileInputRef:l,handleLibraryFileChange:E,triggerLoadLibraryFromFile:I,moveLibraryItem:B,addPromptToLibrary:b,saveProcessorPrompt:f,saveToLibrary:x,replaceAllItems:M,importItemsData:_}},mu=410,gu=110,YC=e=>{const{nodes:t,setNodes:o,connections:r,setConnections:a,nodeIdCounter:i,t:s,groups:l,setGroups:c,clearImagesForNodeFromCache:d,tabId:u,addToast:p,getFullSizeImage:m,setFullSizeImage:w,takeSnapshot:k}=e,b=y.useCallback((G,V,j,P={centerNode:!0})=>{i.current++;const S=`node-${i.current}-${Date.now()}`,A={[q.TEXT_INPUT]:s("node.title.text_input"),[q.IMAGE_INPUT]:s("node.title.image_input"),[q.PROMPT_PROCESSOR]:s("node.title.prompt_processor"),[q.VIDEO_PROMPT_PROCESSOR]:s("node.title.video_prompt_processor"),[q.IMAGE_OUTPUT]:s("node.title.image_output"),[q.VIDEO_OUTPUT]:s("node.title.video_output"),[q.PROMPT_ANALYZER]:s("node.title.prompt_analyzer"),[q.CHARACTER_ANALYZER]:s("node.title.character_analyzer"),[q.CHARACTER_GENERATOR]:s("node.title.character_generator"),[q.CHARACTER_CARD]:s("node.title.character_card"),[q.IMAGE_ANALYZER]:s("node.title.image_analyzer"),[q.IMAGE_EDITOR]:s("node.title.image_editor"),[q.IMAGE_SEQUENCE_GENERATOR]:s("node.title.image_sequence_generator"),[q.PROMPT_SEQUENCE_EDITOR]:s("node.title.prompt_sequence_editor"),[q.GEMINI_CHAT]:s("node.title.gemini_chat"),[q.TRANSLATOR]:s("node.title.translator"),[q.SCRIPT_GENERATOR]:s("node.title.script_generator"),[q.SCRIPT_VIEWER]:s("node.title.script_viewer"),[q.NOTE]:s("node.title.note"),[q.REROUTE_DOT]:s("node.title.reroute_dot"),[q.PROMPT_SANITIZER]:s("node.title.prompt_sanitizer"),[q.DATA_READER]:s("node.title.data_reader"),[q.VIDEO_EDITOR]:s("node.title.video_editor"),[q.MEDIA_VIEWER]:s("node.title.media_viewer"),[q.DATA_PROTECTION]:s("node.title.data_protection"),[q.POSE_CREATOR]:s("node.title.pose_creator")},O={id:S,type:G,position:V,title:j||A[G]||"New Node",value:"",width:400,height:300,isNewlyCreated:!0};switch(O.value=P.initialValue!==void 0?P.initialValue:Wa(O),G){case q.IMAGE_EDITOR:O.width=1e3,O.height=920;break;case q.PROMPT_ANALYZER:O.width=460,O.height=1e3;break;case q.IMAGE_INPUT:O.width=460,O.height=340;break;case q.IMAGE_ANALYZER:case q.VIDEO_OUTPUT:O.width=460,O.height=680;break;case q.PROMPT_PROCESSOR:O.width=460,O.height=410;break;case q.VIDEO_PROMPT_PROCESSOR:O.width=460,O.height=410;break;case q.IMAGE_OUTPUT:O.width=460,O.height=700,O.model="gemini-2.5-flash-image",O.autoDownload=!0;break;case q.GEMINI_CHAT:case q.TRANSLATOR:O.width=400,O.height=640;break;case q.NOTE:O.width=460,O.height=660;break;case q.CHARACTER_ANALYZER:O.width=460,O.height=500;break;case q.CHARACTER_CARD:O.width=520,O.height=960,O.collapsedHandles=!0;break;case q.SCRIPT_GENERATOR:O.width=500,O.height=1e3;break;case q.SCRIPT_VIEWER:O.width=500,O.height=600;break;case q.IMAGE_SEQUENCE_GENERATOR:O.width=1400,O.height=920,O.aspectRatio="16:9";break;case q.PROMPT_SEQUENCE_EDITOR:O.width=1300,O.height=920;break;case q.REROUTE_DOT:O.width=60,O.height=40;break;case q.PROMPT_SANITIZER:O.width=460,O.height=280;break;case q.DATA_READER:O.width=400,O.height=500;break;case q.CHARACTER_GENERATOR:O.width=520,O.height=960;break;case q.TEXT_INPUT:O.width=460,O.height=300;break;case q.MEDIA_VIEWER:O.width=500,O.height=340;break;case q.DATA_PROTECTION:O.width=800,O.height=600;break;case q.VIDEO_EDITOR:O.width=920,O.height=640;break;case q.POSE_CREATOR:O.width=600,O.height=800;break;default:O.width=460,O.height=280}return P.alignToInput?O.position={x:V.x,y:V.y-O.height/2}:P.centerNode?O.position={x:V.x-O.width/2,y:V.y-40/2}:O.position=V,o(z=>[...z,O]),S},[i,o,s]),x=y.useCallback(G=>{const V=t.find(j=>j.id===G);if(V&&V.type===q.REROUTE_DOT){const j=r.find(S=>S.toNodeId===G),P=r.filter(S=>S.fromNodeId===G);if(j&&P.length>0){const S=P.map(A=>({fromNodeId:j.fromNodeId,fromHandleId:j.fromHandleId,toNodeId:A.toNodeId,toHandleId:A.toHandleId,id:`conn-${Date.now()}-${Math.random()}`}));a(A=>[...A.filter(O=>O.toNodeId!==G&&O.fromNodeId!==G),...S])}}o(j=>j.filter(P=>P.id!==G)),a(j=>j.filter(P=>P.fromNodeId!==G&&P.toNodeId!==G)),c(j=>j.map(P=>({...P,nodeIds:P.nodeIds.filter(S=>S!==G)})).filter(P=>P.nodeIds.length>0)),d(G)},[t,r,o,a,c,d,u]),f=y.useCallback((G,V,j)=>{o(P=>P.map(S=>{if(S.id===G){const A=j||S.position,O=S.dockState?S.dockState.original:{x:S.position.x,y:S.position.y,width:S.width,height:S.height},z=Da(S.type),L=56,W=window.innerWidth,D=window.innerHeight;let T=S.width,F=S.height;const te=L*2,$=(W-te)/4;return V==="left"||V==="right"?(T=W/2-L*1.5,F=D-te):V==="full"?(T=W-te,F=D-te):["q1","q2","q3","q4"].includes(V)?(T=$,F=D-te):(T=W/2-L*1.5,F=D/2-L*1.5),T=Math.max(T,z.minWidth),F=Math.max(F,z.minHeight),{...S,isCollapsed:!1,position:A,width:T,height:F,dockState:{mode:V,original:O}}}return S}))},[o]),h=y.useCallback(G=>{o(V=>{const j=V.find(A=>A.id===G);if(!j||!j.dockState)return V;const{original:P}=j.dockState,S=Da(j.type);return V.map(A=>A.id===G?{...A,dockState:void 0,isPinned:!1,position:{x:P.x,y:P.y},width:Math.max(S.minWidth,P.width),height:Math.max(S.minHeight,P.height)}:A)}),setTimeout(()=>{o(V=>V.map(j=>j.id===G?{...j,width:j.width+1,height:j.height+1}:j)),setTimeout(()=>{o(V=>V.map(j=>j.id===G?{...j,width:j.width-1,height:j.height-1}:j))},50)},50)},[o]),v=y.useCallback(G=>{const V=t.find(P=>P.id===G);if(!V)return"";const j=(P,S)=>{const A=P.filter(z=>z.toNodeId===G),O=[];for(const z of A){const L=S.find(D=>D.id===z.fromNodeId);if(!L)continue;let W="";try{const D=JSON.parse(L.value||"{}");if(L.type===q.PROMPT_ANALYZER&&z.fromHandleId)if(z.fromHandleId.startsWith("character-")){const T=parseInt(z.fromHandleId.split("-")[1],10);D.characters&&Array.isArray(D.characters)&&(W=D.characters[T]||"")}else W=D[z.fromHandleId]||"";else L.type===q.IMAGE_INPUT&&z.fromHandleId==="text"?W=D.prompt||"":L.type===q.IMAGE_ANALYZER?W=D.description||"":L.type===q.PROMPT_PROCESSOR||L.type===q.VIDEO_PROMPT_PROCESSOR?W=D.prompt||"":L.type===q.TRANSLATOR?W=D.translatedText||D.inputText||"":D&&typeof D=="object"?D.prompt&&typeof D.prompt=="string"?W=D.prompt:D.text&&typeof D.text=="string"?W=D.text:"inputPrompt"in D&&"safePrompt"in D?W=D.prompt||"":W=L.value:W=L.value}catch{W=L.value}O.push(W)}return O.filter(z=>z&&z.trim()!=="")};if(V.type===q.IMAGE_EDITOR)try{return JSON.parse(V.value).prompt||""}catch{return""}return V.type===q.IMAGE_OUTPUT||V.type===q.VIDEO_OUTPUT?j(r,t).join(", "):""},[t,r]),N=y.useCallback(async G=>{const V=l.find(z=>z.id===G);if(!V)return;const j=t.filter(z=>V.nodeIds.includes(z.id)),P=new Set(j.map(z=>z.id)),S=r.filter(z=>P.has(z.fromNodeId)&&P.has(z.toNodeId)),A={};j.forEach(z=>{for(let L=0;L<20;L++){const W=m(z.id,L);W&&(A[z.id]||(A[z.id]={}),A[z.id][L]=W)}});const O={type:"prompModifierGroup",name:V.title,nodes:j,connections:S,fullSizeImages:A};try{await navigator.clipboard.writeText(JSON.stringify(O,null,2)),p(s("toast.copiedToClipboard"))}catch(z){console.error("Failed to copy group to clipboard",z),p(s("toast.copyFailed")+" (Check console)","error")}},[l,t,r,s,p,m]),_=y.useCallback(G=>{const V=l.find(F=>F.id===G);if(!V)return;const j=t.filter(F=>V.nodeIds.includes(F.id)),P=new Set(j.map(F=>F.id)),S=r.filter(F=>P.has(F.fromNodeId)&&P.has(F.toNodeId)),A=new Map,O=Date.now(),z={x:50,y:50},L=j.map((F,te)=>{i.current++;const $=`node-${i.current}-${O}-${te}`;A.set(F.id,$);for(let Y=0;Y<20;Y++){const oe=m(F.id,Y);oe&&w($,Y,oe)}return{...F,id:$,position:{x:F.position.x+z.x,y:F.position.y+z.y},isNewlyCreated:!0}}),W=`group-${O}-${Math.random().toString(36).substr(2,5)}`,D={...V,id:W,position:{x:V.position.x+z.x,y:V.position.y+z.y},nodeIds:L.map(F=>F.id),title:`${V.title}`},T=S.map((F,te)=>({...F,id:`conn-${O}-${te}`,fromNodeId:A.get(F.fromNodeId),toNodeId:A.get(F.toNodeId)}));o(F=>[...F,...L]),c(F=>[...F,D]),a(F=>[...F,...T]),p(s("toast.nodeDuplicated"))},[l,t,r,i,o,c,a,s,p,m,w]),E=y.useCallback((G,V)=>{const j=G.nodes||[],P=G.connections||[],S=G.fullSizeImages||{},A=G.name||(G.group?G.group.title:"Imported Group");if(j.length===0)return;const O=new Map,z=Date.now();let L=1/0,W=1/0,D=-1/0,T=-1/0;j.forEach(R=>{L=Math.min(L,R.position.x),W=Math.min(W,R.position.y),D=Math.max(D,R.position.x+R.width),T=Math.max(T,R.position.y+R.height)});let F=50,te=50;V?(F=V.x-L,te=V.y-W):(F=50-L,te=50-W);const $=j.map((R,J)=>{i.current++;const H=`node-${i.current}-${z}-${J}`;return O.set(R.id,H),S&&S[R.id]&&Object.entries(S[R.id]).forEach(([U,ee])=>{w(H,Number(U),ee)}),{...R,id:H,position:{x:R.position.x+F,y:R.position.y+te},isNewlyCreated:!0}}),Y=`group-${z}-${Math.random().toString(36).substr(2,5)}`,oe=30,le=70,K=D-L+oe*2,ie=T-W+le+oe,Z=L+F-oe,se=W+te-le,de={id:Y,title:A,position:{x:Z,y:se},width:K,height:ie,nodeIds:$.map(R=>R.id)},re=P.map((R,J)=>({...R,id:`conn-${z}-${J}`,fromNodeId:O.get(R.fromNodeId),toNodeId:O.get(R.toNodeId)}));o(R=>[...R,...$]),c(R=>[...R,de]),a(R=>[...R,...re]),p(s("toast.pastedFromClipboard"))},[i,o,c,a,w,s,p]),I=y.useCallback((G,V)=>{G.length<2||(V==="distribute-horizontal"||V==="distribute-vertical")&&G.length<3||(k&&k(t),o(j=>{const P=j.filter(D=>G.includes(D.id));if(P.length<2)return j;let S=1/0,A=-1/0,O=1/0,z=-1/0;P.forEach(D=>{S=Math.min(S,D.position.x),A=Math.max(A,D.position.x+D.width),O=Math.min(O,D.position.y),z=Math.max(z,D.position.y+D.height)});const L=(S+A)/2,W=(O+z)/2;if(V==="distribute-horizontal"){P.sort((Z,se)=>Z.position.x-se.position.x);const D=P[0],T=P[P.length-1],F=D.position.x,$=T.position.x+T.width-F,Y=P.reduce((Z,se)=>Z+se.width,0),le=($-Y)/(P.length-1);let K=F;const ie=new Map;ie.set(D.id,K),K+=D.width+le;for(let Z=1;Z<P.length-1;Z++){const se=P[Z];ie.set(se.id,K),K+=se.width+le}return ie.set(T.id,T.position.x),j.map(Z=>ie.has(Z.id)?{...Z,position:{x:ie.get(Z.id)|0,y:Z.position.y}}:Z)}if(V==="distribute-vertical"){P.sort((Z,se)=>Z.position.y-se.position.y);const D=P[0],T=P[P.length-1],F=D.position.y,$=T.position.y+T.height-F,Y=P.reduce((Z,se)=>Z+se.height,0),le=($-Y)/(P.length-1);let K=F;const ie=new Map;ie.set(D.id,K),K+=D.height+le;for(let Z=1;Z<P.length-1;Z++){const se=P[Z];ie.set(se.id,K),K+=se.width+le}return ie.set(T.id,T.position.y),j.map(Z=>ie.has(Z.id)?{...Z,position:{x:Z.position.x,y:ie.get(Z.id)|0}}:Z)}return j.map(D=>{if(!G.includes(D.id))return D;let T=D.position.x,F=D.position.y;switch(V){case"left":T=S;break;case"center-x":T=L-D.width/2;break;case"right":T=A-D.width;break;case"top":F=O;break;case"center-y":F=W-D.height/2;break;case"bottom":F=z-D.height;break}return{...D,position:{x:T|0,y:F|0}}})}))},[o,k,t]),B=()=>new Date().toISOString().replace(/:/g,"-").replace("T","_").split(".")[0],M=y.useCallback((G,V)=>{const j=t.find(A=>A.id===G);if(!j)return;let P,S="";try{const A=JSON.parse(j.value||"{}");if(j.type===q.IMAGE_OUTPUT||j.type===q.VIDEO_OUTPUT)P=m(G,0)||j.value,S=v(G);else if(j.type===q.IMAGE_INPUT)P=m(G,0)||A.image,S=A.prompt||"";else if(j.type===q.IMAGE_EDITOR)P=m(G,0)||A.outputImage,S=A.prompt||"";else if(j.type===q.GEMINI_CHAT){const O={type:"gemini-chat-history",messages:A.messages||[],currentInput:A.currentInput||"",style:A.style||"general",attachment:A.attachment||null},z=new Blob([JSON.stringify(O,null,2)],{type:"application/json"}),L=URL.createObjectURL(z),W=document.createElement("a");W.href=L;const D=B();W.download=`Gemini_Chat_History_${D}.json`,document.body.appendChild(W),W.click(),document.body.removeChild(W),URL.revokeObjectURL(L),p(s("toast.scriptSaved"));return}}catch{}P&&V(P,0,S)},[t,m,v,p,s]);return{onAddNode:b,deleteNodeAndConnections:x,getPromptForNode:v,copyGroup:N,duplicateGroup:_,pasteGroup:E,handleAlignNodes:I,handleDockNode:f,handleUndockNode:h,handleDownloadImage:M}},sd=(e,t)=>{if(!e)return"";const o={appearance:"Appearance",:"Appearance",apariencia:"Appearance",personality:"Personality",:"Personality",:"Personality",personalidad:"Personality",clothing:"Clothing",:"Clothing",ropa:"Clothing"},r=/####\s*([^\n]+)\s*([\s\S]*?)(?=####|$)/gi;let a;for(;(a=r.exec(e))!==null;){const i=a[1].trim().toLowerCase(),s=a[2].trim();if(o[i]===t)return s}return""},bm=e=>{if(!e)return"0";let t=0;const o=e.length,r=o>1e3?e.substring(0,500)+e.substring(o-500):e;for(let a=0;a<r.length;a++){const i=r.charCodeAt(a);t=(t<<5)-t+i,t=t&t}return`${o}-${t}`},XC=e=>{if(!e)return"empty";const t=e.match(/"(index|alias|name|selectedRatio|prompt|isActive|isOutput)"\s*:\s*("[^"]*"|true|false|null)/g);let o=0;for(let r=0;r<Math.min(e.length,200);r++)o=(o<<5)-o+e.charCodeAt(r);return(t?t.join(","):"no-match")+`-${o}`},ZC=e=>{const{connections:t,nodes:o,getFullSizeImage:r}=e,a=y.useRef({signature:"",data:new Map}),i=y.useRef({signature:"",data:new Map}),s=y.useMemo(()=>{const m=new Map;return t.forEach(w=>{m.has(w.toNodeId)||m.set(w.toNodeId,new Set),m.get(w.toNodeId).add(w.toHandleId)}),m},[t]),l=y.useMemo(()=>{const m=new Map;return t.forEach(w=>{const k=o.find(b=>b.id===w.toNodeId);if(k&&(k.type===q.DATA_READER||k.type===q.REROUTE_DOT)){const b=o.find(x=>x.id===w.fromNodeId);if(b){const x=Xn(b,w.fromHandleId);x&&m.set(w.toNodeId,x)}}}),m},[t,o]),c=y.useCallback((m,w,k,b)=>{var h;if(k.has(m))return null;k.add(m);const x=o.find(v=>v.id===m);if(!x||Xn(x,w)!=="image"&&x.type!==q.REROUTE_DOT)return null;if(x.type===q.IMAGE_ANALYZER||x.type===q.REROUTE_DOT){const v=t.find(N=>N.toNodeId===m);if(v)return c(v.fromNodeId,v.fromHandleId,k,b)}try{const v=JSON.parse(x.value||"{}");switch(x.type){case q.IMAGE_INPUT:return b&&v.image?v.image:r(x.id,0)||v.image||null;case q.POSE_CREATOR:return v.renderedImage||null;case q.IMAGE_ANALYZER:case q.CHARACTER_CARD:if(x.type===q.CHARACTER_CARD&&w!=="image")break;const N=Array.isArray(v)?v:[v],_=N.find(G=>G.isOutput)||N[0];if(_&&_.isActive===!1)return null;const E=N.indexOf(_),I=_.selectedRatio||"1:1",B=Ut[I]||1,M=r(x.id,E*10+B);return M&&!b?M:((h=_==null?void 0:_.thumbnails)==null?void 0:h[I])||(_==null?void 0:_.image)||null;case q.IMAGE_OUTPUT:return r(x.id,0)||(x.value.startsWith("data:")?x.value:null);case q.IMAGE_EDITOR:return b?v.outputImage:r(x.id,0)||v.outputImage||null}}catch{if(x.type===q.IMAGE_INPUT&&x.value.startsWith("data:image"))return x.value}return null},[o,t,r]),d=y.useMemo(()=>{const m=t.filter(x=>{const f=o.find(h=>h.id===x.toNodeId);return f?f.type===q.IMAGE_EDITOR&&x.toHandleId==="image"||f.type===q.IMAGE_ANALYZER:!1}),k=m.map(x=>{const f=o.find(h=>h.id===x.fromNodeId);return`${x.id}:${f==null?void 0:f.id}:${bm((f==null?void 0:f.value)||"")}`}).join("|");if(k===i.current.signature)return i.current.data;const b=new Map;return m.forEach(x=>{b.has(x.toNodeId)||b.set(x.toNodeId,[]),b.get(x.toNodeId).push(c(x.fromNodeId,x.fromHandleId,new Set,!1))}),i.current={signature:k,data:b},b},[t,o,c]),u=y.useMemo(()=>{const m=o.filter(h=>h.type===q.IMAGE_SEQUENCE_GENERATOR),b=t.filter(h=>m.some(v=>v.id===h.toNodeId)&&h.toHandleId==="character_data").map(h=>{const v=o.find(N=>N.id===h.fromNodeId);return v?v.type===q.CHARACTER_CARD||v.type===q.CHARACTER_GENERATOR?`${h.id}:${v.id}:${XC(v.value||"")}`:`${h.id}:${v.id}:${bm(v.value||"")}`:""}).join("|");if(b===a.current.signature)return a.current.data;const x=(h,v,N=new Set)=>{if(N.has(h))return[];N.add(h);const _=t.filter(I=>I.toNodeId===h&&(v===void 0||I.toHandleId===v)),E=[];for(const I of _){const B=o.find(M=>M.id===I.fromNodeId);B&&(B.type===q.REROUTE_DOT?E.push(...x(B.id,void 0,N)):Xn(B,I.fromHandleId)==="character_data"&&E.push({node:B,handleId:I.fromHandleId,connectionId:I.id}))}return E},f=new Map;return m.forEach(h=>{const v=x(h.id,"character_data");if(v.length>0){const N=[],_=new Set;v.forEach(E=>{var M,G;const I=E.node,B=`${I.id}:${E.handleId||"default"}`;if(!_.has(B)){_.add(B);try{const V=JSON.parse(I.value);if(I.type===q.CHARACTER_GENERATOR){const j=(M=E.handleId)==null?void 0:M.match(/character-(\d+)/),P=j?parseInt(j[1],10):-1;if(P>=0&&((G=V.characters)!=null&&G[P])){const S=V.characters[P];N.push({name:S.name,alias:S.index||S.alias,prompt:S.prompt,fullDescription:S.fullDescription,image:S.imageBase64?`data:image/png;base64,${S.imageBase64}`:null,_sourceNodeId:I.id,_connectionId:E.connectionId})}}else if(I.type===q.CHARACTER_CARD){const j=Array.isArray(V)?V:[V],P=E.handleId;let S=[];if(P==="all_data")S=j.map((A,O)=>({data:A,originalIndex:O})).filter(A=>A.data.isActive!==!1);else if(P==="primary_data"){const A=j.find(O=>O.isOutput)||j[0];if(A&&A.isActive!==!1){const O=j.indexOf(A);S=[{data:A,originalIndex:O}]}}else if(P&&P.startsWith("char_")){const A=parseInt(P.split("_")[1]);j[A]&&j[A].isActive!==!1&&(S=[{data:j[A],originalIndex:A}])}else S=j.map((A,O)=>({data:A,originalIndex:O})).filter(A=>A.data.isActive!==!1);S.forEach(({data:A,originalIndex:O})=>{if(!A)return;const z=A.thumbnails?{...A.thumbnails}:A.imageSources||{};Object.entries(Ut).forEach(([D,T])=>{const F=r(I.id,O*10+T);F&&(z[D]=F)});const L=A.selectedRatio||"1:1",W=z[L]||A.image||r(I.id,O*10);N.push({...A,alias:A.index||A.alias,image:W,imageSources:z,nodeTitle:I.title,_sourceNodeId:I.id,_connectionId:E.connectionId,_fullResImage:r(I.id,O*10)})})}}catch{}}}),N.length>0&&f.set(h.id,N)}}),a.current={signature:b,data:f},f},[t,o,r]),p=y.useCallback((m,w,k,b=!1)=>{var v,N,_;const x=k||o,f=t.filter(E=>E.toNodeId===m&&(w===void 0||E.toHandleId===w)),h=[];for(const E of f){const I=x.find(M=>M.id===E.fromNodeId);if(!I)continue;if(I.type===q.REROUTE_DOT){h.push(...p(I.id,void 0,x,b));continue}const B=Xn(I,E.fromHandleId);if(B==="character_data")try{const M=JSON.parse(I.value||"{}");if(I.type===q.CHARACTER_GENERATOR&&((v=E.fromHandleId)!=null&&v.startsWith("character-"))){const G=parseInt(E.fromHandleId.split("-")[1]);M.characters&&M.characters[G]&&h.push(M.characters[G])}else if(I.type===q.CHARACTER_CARD){const G=Array.isArray(M)?M:[M];E.fromHandleId==="all_data"?h.push(G.filter(V=>V.isActive!==!1)):h.push(M)}else h.push(M)}catch{h.push(I.value)}else if(B==="text")try{const M=JSON.parse(I.value||"{}");if(I.type===q.PROMPT_ANALYZER&&E.fromHandleId)if(E.fromHandleId.startsWith("character-")){const G=parseInt(E.fromHandleId.split("-")[1],10);h.push(((N=M.characters)==null?void 0:N[G])||"")}else h.push(M[E.fromHandleId]||"");else if(I.type===q.IMAGE_INPUT&&E.fromHandleId==="text")h.push(M.prompt||"");else if(I.type===q.IMAGE_ANALYZER&&E.fromHandleId==="text")h.push(M.description||"");else if(I.type===q.CHARACTER_CARD){const G=Array.isArray(M)?M:[M],V=G.find(j=>j.isOutput)||G[0];if(!(V&&V.isActive===!1)){const j=(V==null?void 0:V.fullDescription)||"";E.fromHandleId==="prompt"?h.push((V==null?void 0:V.prompt)||""):E.fromHandleId==="appearance"?h.push(sd(j,"Appearance")):E.fromHandleId==="personality"?h.push(sd(j,"Personality")):E.fromHandleId==="clothing"?h.push(sd(j,"Clothing")):h.push(I.value)}}else h.push(I.value)}catch{h.push(I.value)}else if(B==="image"){if(I.type===q.IMAGE_SEQUENCE_GENERATOR)try{const G=JSON.parse(I.value),V=G.checkedFrameNumbers||[],j=G.images||{};if(V.forEach(P=>{var A;const S=r(I.id,1e3+P)||j[P];if(S&&S.startsWith("data:")){const O=S.split(","),z=((A=S.match(/:(.*?);/))==null?void 0:A[1])||"image/png";h.push({base64ImageData:O[1],mimeType:z})}}),V.length>0)continue}catch{}const M=c(E.fromNodeId,E.fromHandleId,new Set,b);if(M&&M.startsWith("data:")){const G=M.split(","),V=((_=M.match(/:(.*?);/))==null?void 0:_[1])||"image/png";h.push({base64ImageData:G[1],mimeType:V})}}else if(I.type===q.MEDIA_VIEWER)try{const M=JSON.parse(I.value||"{}");M.src&&h.push(M.src)}catch{h.push(I.value)}else h.push(I.value)}return h},[o,t,c,r]);return{connectedInputs:s,connectedImageSources:d,connectedCharacterData:u,connectedInputTypes:l,getConnectionPoints:zp,getUpstreamNodeValues:p}},QC=e=>{const{onAddNode:t,handleValueChange:o,handleRenameNode:r,setFullSizeImage:a,getTransformedPoint:i,handleLoadCanvasIntoCurrentTab:s,setError:l,pasteGroup:c,t:d,handleAddGroupFromCatalog:u,libraryItems:p,setNodes:m,setConfirmInfo:w,handleRenameTab:k,activeTabId:b}=e,x=y.useRef(0),f=E=>{const I=document.getElementById("app-container");I&&(E?I.classList.add("ring-2","ring-cyan-500","ring-inset"):I.classList.remove("ring-2","ring-cyan-500","ring-inset"))};y.useEffect(()=>{const E=I=>{I.type==="dragleave"&&I.relatedTarget||(x.current=0,f(!1))};return window.addEventListener("dragend",E),window.addEventListener("dragleave",E),()=>{window.removeEventListener("dragend",E),window.removeEventListener("dragleave",E)}},[]);const h=y.useCallback(E=>{if(E.dataTransfer.types.includes("application/prompt-modifier-card"))return;const I=E.target;(I.id==="app-container"||I.id==="canvas-transform-layer")&&(E.preventDefault(),E.stopPropagation(),x.current+=1,x.current===1&&f(!0))},[]),v=y.useCallback(E=>{if(E.dataTransfer.types.includes("application/prompt-modifier-card"))return;const I=E.target;(I.id==="app-container"||I.id==="canvas-transform-layer")&&(E.preventDefault(),E.stopPropagation(),x.current-=1,x.current<=0&&(x.current=0,f(!1)))},[]),N=y.useCallback(E=>{E.target.closest(".node-view")||(E.preventDefault(),E.stopPropagation(),E.dataTransfer.dropEffect="copy")},[]);return{handleDrop:y.useCallback(E=>{if(E.dataTransfer.types.includes("application/prompt-modifier-card"))return;E.preventDefault(),E.stopPropagation(),x.current=0,f(!1);const I=i({x:E.clientX,y:E.clientY}),B=E.dataTransfer.getData("application/prompt-modifier-drag-info");if(B)try{const{src:j,prompt:P}=JSON.parse(B),S=t(q.IMAGE_INPUT,I);a(S,0,j),Ot(j,256,256).then(A=>{o(S,JSON.stringify({image:A,prompt:P||""}))});return}catch(j){console.error("Failed to parse drag info",j)}const M=E.dataTransfer.getData("application/prompt-modifier-drag-image");if(M){const j=t(q.IMAGE_INPUT,I);a(j,0,M),kl(M).then(P=>{Ot(M,256,256).then(S=>{o(j,JSON.stringify({image:S,prompt:P||""}))})});return}const G=E.dataTransfer.getData("application/prompt-modifier-drag-item");if(G){try{const j=JSON.parse(G);if(j.type==="catalog-group"){u&&u(j.itemId,I);return}if(j.type==="library-prompt"){const P=p.find(S=>S.id===j.itemId);P&&t(q.TEXT_INPUT,I,void 0,{centerNode:!0,initialValue:P.content||""});return}if(j.type==="content-catalog-item"){const P=j.itemType;let S=null,A="";switch(P){case"CHARACTER":S=q.CHARACTER_CARD;let O;try{O=JSON.parse(j.content||"{}")}catch{O={}}if(Array.isArray(O))A=JSON.stringify(O);else{O.image&&typeof O.image=="string"&&!O.image.startsWith("data:")&&(O.image=`data:image/png;base64,${O.image}`);const le=O.index||O.alias||"Entity-1",K={...O,index:le};K.alias&&delete K.alias,A=JSON.stringify([K])}break;case"SCRIPT":S=q.SCRIPT_VIEWER,A=j.content||"{}";break;case"PROMPT_SEQUENCE":S=q.PROMPT_SEQUENCE_EDITOR;const z={id:"",type:q.PROMPT_SEQUENCE_EDITOR,position:{x:0,y:0},title:"",value:"",width:0,height:0},L=Wa(z),W=JSON.parse(L),D=JSON.parse(j.content||"{}");let T=[],F=[],te="",$=[];D.type==="script-prompt-modifier-data"?(T=D.finalPrompts||D.prompts||[],F=D.videoPrompts||[],te=D.styleOverride||"",$=D.usedCharacters||[]):Array.isArray(D)?T=D:D.prompts&&(T=D.prompts);const Y=new Map(F.map(le=>[le.frameNumber,le])),oe=T.map((le,K)=>{const ie=le.frameNumber!==void 0?le.frameNumber:K+1,Z=Y.get(ie);let se=le.characters||[];const de=le.prompt||(typeof le=="string"?le:"");if(se.length===0&&de){const re=de.match(/(?:character|entity)-\d+/gi)||[];se=[...new Set(re.map(R=>R.toLowerCase().replace(/character-/i,"Entity-").replace(/entity-/i,"Entity-")))]}return{frameNumber:ie,sceneNumber:le.sceneNumber||1,sceneTitle:le.sceneTitle||"",prompt:de,videoPrompt:(Z==null?void 0:Z.videoPrompt)||le.videoPrompt||"",shotType:le.shotType||le.ShotType||(Z==null?void 0:Z.shotType)||"WS",characters:se,isCollapsed:!0,duration:le.duration||3}});A=JSON.stringify({...W,sourcePrompts:oe,styleOverride:te,usedCharacters:$});break}if(S){const O=t(S,I,void 0,{centerNode:!0,initialValue:A});if(P==="CHARACTER")try{let z=JSON.parse(j.content||"{}");const L=Array.isArray(z)?z[0]:z;if(L!=null&&L.nodeTitle&&r(O,L.nodeTitle),Array.isArray(z)&&m){const D=z.length*mu+gu;m(T=>T.map(F=>F.id===O?{...F,width:D}:F))}(Array.isArray(z)?z:[z]).forEach((D,T)=>{if(D.imageSources){Object.entries(D.imageSources).forEach(([$,Y])=>{const oe=Ut[$];oe&&typeof Y=="string"&&Y.startsWith("data:")&&a(O,T*10+oe,Y)});const F=D.selectedRatio||"1:1",te=D.imageSources[F];te&&typeof te=="string"&&te.startsWith("data:")&&a(O,T*10,te)}})}catch(z){console.error("Failed to restore character images",z)}}}}catch(j){console.error("Error parsing drag data",j)}return}const V=Array.from(E.dataTransfer.files);if(V.length>0){let j=0,P=0;V.forEach(S=>{const A={x:I.x+j,y:I.y+P};if(S.type.startsWith("image/")){const O=new FileReader;O.onload=async z=>{var W;const L=(W=z.target)==null?void 0:W.result;if(L){const D=t(q.IMAGE_INPUT,A);a(D,0,L);const T=await kl(L);Ot(L,256,256).then(F=>{o(D,JSON.stringify({image:F,prompt:T||""}))})}},O.readAsDataURL(S),j+=30,P+=30}else if(S.type==="application/json"||S.name.endsWith(".json")||S.name.endsWith(".PMC")||S.name.endsWith(".PMP")||S.name.endsWith(".CHAR")){const O=new FileReader;O.onload=async z=>{var W,D;const L=(W=z.target)==null?void 0:W.result;try{const T=JSON.parse(L);if(T.type==="script-modifier-project"||T.type==="script-modifier-canvas"){l&&l(d("error.scriptModifierCanvas"));return}if(T.type==="gemini-chat-history"||T.messages&&Array.isArray(T.messages)&&!T.nodes){const F=t(q.GEMINI_CHAT,A),te=JSON.stringify({messages:T.messages||[],currentInput:T.currentInput||"",style:T.style||"general",attachment:T.attachment||null});o(F,te);return}if(T.type==="prompModifierGroup"||T.root&&T.root.type==="prompModifierGroup"){c&&c(T.root||T,A);return}if(T.type==="prompt-modifier-canvas"||T.type==="prompt-modifier-project"||Array.isArray(T.nodes)&&Array.isArray(T.connections)){if(s){const F=S.name.match(/^Prompt_Modifier_(.+?)_\d{4}-\d{2}-\d{2}/),te=F&&F[1]?F[1].replace(/_/g," "):null,$=T.type==="prompt-modifier-project",Y=()=>{s(L),!$&&te&&k&&b&&k(b,te)};w?w({title:d("dialog.confirmLoad.title"),message:d("dialog.confirmLoad.message")+($?" (Loading Project)":""),onConfirm:Y}):Y()}}else{const F=oe=>oe&&(oe.type==="character-card"||oe.name&&oe.imageSources);let te=null,$=!1;if(Array.isArray(T)?T.length>0&&F(T[0])&&(te=T,$=!0):F(T)&&(te=[T],$=!1),te){const oe=te[0].nodeTitle||te[0].title||($?"Character Cards":"Character Card"),le=t(q.CHARACTER_CARD,A,oe);if($&&m){const ie=te.length*mu+gu;m(Z=>Z.map(se=>se.id===le?{...se,width:ie}:se))}const K=await Promise.all(te.map(async(ie,Z)=>{const se=ie.imageSources||{};ie.image&&!ie.imageSources&&(se["1:1"]=ie.image);const de={"1:1":null,"16:9":null,"9:16":null};for(const[J,H]of Object.entries(se))if(typeof H=="string"&&H.startsWith("data:")){const U=Ut[J];U&&a(le,Z*10+U,H),de[J]=await Ot(H,256,256)}else de[J]=H;const re=ie.selectedRatio||"1:1",R=se[re];return R&&typeof R=="string"&&R.startsWith("data:")&&a(le,Z*10,R),{...ie,image:de[re],thumbnails:de,index:ie.index||ie.alias||`Entity-${Z+1}`}}));o(le,JSON.stringify(K));return}if(T.type==="script-prompt-modifier-data"||T.finalPrompts&&Array.isArray(T.finalPrompts)){const oe=t(q.PROMPT_SEQUENCE_EDITOR,A),le=T.finalPrompts||T.prompts||[],K=T.videoPrompts||[],ie=new Map(K.map(de=>[de.frameNumber,de])),Z=le.map((de,re)=>{const R=de.frameNumber!==void 0?de.frameNumber:re+1,J=ie.get(R);let H=de.characters||[];const U=de.prompt||"";if(H.length===0&&U){const ee=U.match(/(?:character|entity)-\d+/gi)||[];H=[...new Set(ee.map(ae=>ae.toLowerCase().replace(/character-/i,"Entity-").replace(/entity-/i,"Entity-")))]}return{frameNumber:R,sceneNumber:de.sceneNumber||1,sceneTitle:de.sceneTitle||"",prompt:U,videoPrompt:(J==null?void 0:J.videoPrompt)||de.videoPrompt||"",shotType:de.shotType||de.ShotType||(J==null?void 0:J.shotType)||"WS",characters:H,duration:de.duration||3,isCollapsed:!0}}),se=JSON.stringify({instruction:"",sourcePrompts:Z,modifiedPrompts:[],checkedSourceFrameNumbers:[],selectedFrameNumber:null,styleOverride:T.styleOverride||"",usedCharacters:T.usedCharacters||[],sceneContexts:T.sceneContexts||{},leftPaneRatio:.5});o(oe,se);return}if(T.type==="script-generator-data"||T.type==="script-analyzer-data"||T.characters&&T.scenes&&Array.isArray(T.scenes)&&((D=T.scenes[0])!=null&&D.frames||T.type==="script-analyzer-data")){const oe=t(q.SCRIPT_VIEWER,A);T.type||(T.scenes&&T.scenes[0]&&T.scenes[0].frames?T.type="script-analyzer-data":T.type="script-generator-data"),o(oe,JSON.stringify(T));return}const Y=t(q.TEXT_INPUT,A);o(Y,JSON.stringify(T,null,2))}}catch{l&&l("Failed to parse JSON file.")}},O.readAsText(S),j+=30,P+=30}else if(S.type.startsWith("text/")){const O=new FileReader;O.onload=z=>{var L;return t(q.TEXT_INPUT,A,void 0,{centerNode:!0,initialValue:(L=z.target)==null?void 0:L.result})},O.readAsText(S),j+=30,P+=30}})}},[t,o,r,a,i,s,l,c,d,u,p,m,w,b,k]),handleDragOver:N,handleDragLeave:v,handleDragEnter:h}};var e5={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let t5,n5;function o5(){return{geminiUrl:t5,vertexUrl:n5}}function r5(e,t,o,r){var a,i;if(!(e!=null&&e.baseUrl)){const s=o5();return t?(a=s.vertexUrl)!==null&&a!==void 0?a:o:(i=s.geminiUrl)!==null&&i!==void 0?i:r}return e.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Xo{}function xt(e,t){const o=/\{([^}]+)\}/g;return e.replace(o,(r,a)=>{if(Object.prototype.hasOwnProperty.call(t,a)){const i=t[a];return i!=null?String(i):""}else throw new Error(`Key '${a}' not found in valueMap.`)})}function C(e,t,o){for(let i=0;i<t.length-1;i++){const s=t[i];if(s.endsWith("[]")){const l=s.slice(0,-2);if(!(l in e))if(Array.isArray(o))e[l]=Array.from({length:o.length},()=>({}));else throw new Error(`Value must be a list given an array path ${s}`);if(Array.isArray(e[l])){const c=e[l];if(Array.isArray(o))for(let d=0;d<c.length;d++){const u=c[d];C(u,t.slice(i+1),o[d])}else for(const d of c)C(d,t.slice(i+1),o)}return}else if(s.endsWith("[0]")){const l=s.slice(0,-3);l in e||(e[l]=[{}]);const c=e[l];C(c[0],t.slice(i+1),o);return}(!e[s]||typeof e[s]!="object")&&(e[s]={}),e=e[s]}const r=t[t.length-1],a=e[r];if(a!==void 0){if(!o||typeof o=="object"&&Object.keys(o).length===0||o===a)return;if(typeof a=="object"&&typeof o=="object"&&a!==null&&o!==null)Object.assign(a,o);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof o=="object"&&o!==null&&!Array.isArray(o)?Object.assign(e,o):e[r]=o}function g(e,t,o=void 0){try{if(t.length===1&&t[0]==="_self")return e;for(let r=0;r<t.length;r++){if(typeof e!="object"||e===null)return o;const a=t[r];if(a.endsWith("[]")){const i=a.slice(0,-2);if(i in e){const s=e[i];return Array.isArray(s)?s.map(l=>g(l,t.slice(r+1),o)):o}else return o}else e=e[a]}return e}catch(r){if(r instanceof TypeError)return o;throw r}}function a5(e,t){for(const[o,r]of Object.entries(t)){const a=o.split("."),i=r.split("."),s=new Set;let l=-1;for(let c=0;c<a.length;c++)if(a[c]==="*"){l=c;break}if(l!==-1&&i.length>l)for(let c=l;c<i.length;c++){const d=i[c];d!=="*"&&!d.endsWith("[]")&&!d.endsWith("[0]")&&s.add(d)}fu(e,a,i,0,s)}}function fu(e,t,o,r,a){if(r>=t.length||typeof e!="object"||e===null)return;const i=t[r];if(i.endsWith("[]")){const s=i.slice(0,-2),l=e;if(s in l&&Array.isArray(l[s]))for(const c of l[s])fu(c,t,o,r+1,a)}else if(i==="*"){if(typeof e=="object"&&e!==null&&!Array.isArray(e)){const s=e,l=Object.keys(s).filter(d=>!d.startsWith("_")&&!a.has(d)),c={};for(const d of l)c[d]=s[d];for(const[d,u]of Object.entries(c)){const p=[];for(const m of o.slice(r))m==="*"?p.push(d):p.push(m);C(s,p,u)}for(const d of l)delete s[d]}}else{const s=e;i in s&&fu(s[i],t,o,r+1,a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function qp(e){if(typeof e!="string")throw new Error("fromImageBytes must be a string");return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function i5(e){const t={},o=g(e,["operationName"]);o!=null&&C(t,["operationName"],o);const r=g(e,["resourceName"]);return r!=null&&C(t,["_url","resourceName"],r),t}function s5(e){const t={},o=g(e,["name"]);o!=null&&C(t,["name"],o);const r=g(e,["metadata"]);r!=null&&C(t,["metadata"],r);const a=g(e,["done"]);a!=null&&C(t,["done"],a);const i=g(e,["error"]);i!=null&&C(t,["error"],i);const s=g(e,["response","generateVideoResponse"]);return s!=null&&C(t,["response"],c5(s)),t}function l5(e){const t={},o=g(e,["name"]);o!=null&&C(t,["name"],o);const r=g(e,["metadata"]);r!=null&&C(t,["metadata"],r);const a=g(e,["done"]);a!=null&&C(t,["done"],a);const i=g(e,["error"]);i!=null&&C(t,["error"],i);const s=g(e,["response"]);return s!=null&&C(t,["response"],d5(s)),t}function c5(e){const t={},o=g(e,["generatedSamples"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>u5(s))),C(t,["generatedVideos"],i)}const r=g(e,["raiMediaFilteredCount"]);r!=null&&C(t,["raiMediaFilteredCount"],r);const a=g(e,["raiMediaFilteredReasons"]);return a!=null&&C(t,["raiMediaFilteredReasons"],a),t}function d5(e){const t={},o=g(e,["videos"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>p5(s))),C(t,["generatedVideos"],i)}const r=g(e,["raiMediaFilteredCount"]);r!=null&&C(t,["raiMediaFilteredCount"],r);const a=g(e,["raiMediaFilteredReasons"]);return a!=null&&C(t,["raiMediaFilteredReasons"],a),t}function u5(e){const t={},o=g(e,["video"]);return o!=null&&C(t,["video"],y5(o)),t}function p5(e){const t={},o=g(e,["_self"]);return o!=null&&C(t,["video"],v5(o)),t}function h5(e){const t={},o=g(e,["operationName"]);return o!=null&&C(t,["_url","operationName"],o),t}function m5(e){const t={},o=g(e,["operationName"]);return o!=null&&C(t,["_url","operationName"],o),t}function g5(e){const t={},o=g(e,["name"]);o!=null&&C(t,["name"],o);const r=g(e,["metadata"]);r!=null&&C(t,["metadata"],r);const a=g(e,["done"]);a!=null&&C(t,["done"],a);const i=g(e,["error"]);i!=null&&C(t,["error"],i);const s=g(e,["response"]);return s!=null&&C(t,["response"],f5(s)),t}function f5(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["parent"]);r!=null&&C(t,["parent"],r);const a=g(e,["documentName"]);return a!=null&&C(t,["documentName"],a),t}function d1(e){const t={},o=g(e,["name"]);o!=null&&C(t,["name"],o);const r=g(e,["metadata"]);r!=null&&C(t,["metadata"],r);const a=g(e,["done"]);a!=null&&C(t,["done"],a);const i=g(e,["error"]);i!=null&&C(t,["error"],i);const s=g(e,["response"]);return s!=null&&C(t,["response"],x5(s)),t}function x5(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["parent"]);r!=null&&C(t,["parent"],r);const a=g(e,["documentName"]);return a!=null&&C(t,["documentName"],a),t}function y5(e){const t={},o=g(e,["uri"]);o!=null&&C(t,["uri"],o);const r=g(e,["encodedVideo"]);r!=null&&C(t,["videoBytes"],qp(r));const a=g(e,["encoding"]);return a!=null&&C(t,["mimeType"],a),t}function v5(e){const t={},o=g(e,["gcsUri"]);o!=null&&C(t,["uri"],o);const r=g(e,["bytesBase64Encoded"]);r!=null&&C(t,["videoBytes"],qp(r));const a=g(e,["mimeType"]);return a!=null&&C(t,["mimeType"],a),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Cm;(function(e){e.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",e.OUTCOME_OK="OUTCOME_OK",e.OUTCOME_FAILED="OUTCOME_FAILED",e.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Cm||(Cm={}));var km;(function(e){e.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",e.PYTHON="PYTHON"})(km||(km={}));var _m;(function(e){e.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",e.SILENT="SILENT",e.WHEN_IDLE="WHEN_IDLE",e.INTERRUPT="INTERRUPT"})(_m||(_m={}));var bt;(function(e){e.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",e.STRING="STRING",e.NUMBER="NUMBER",e.INTEGER="INTEGER",e.BOOLEAN="BOOLEAN",e.ARRAY="ARRAY",e.OBJECT="OBJECT",e.NULL="NULL"})(bt||(bt={}));var Sm;(function(e){e.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",e.SIMPLE_SEARCH="SIMPLE_SEARCH",e.ELASTIC_SEARCH="ELASTIC_SEARCH"})(Sm||(Sm={}));var Nm;(function(e){e.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",e.NO_AUTH="NO_AUTH",e.API_KEY_AUTH="API_KEY_AUTH",e.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",e.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",e.OAUTH="OAUTH",e.OIDC_AUTH="OIDC_AUTH"})(Nm||(Nm={}));var Em;(function(e){e.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",e.HTTP_IN_QUERY="HTTP_IN_QUERY",e.HTTP_IN_HEADER="HTTP_IN_HEADER",e.HTTP_IN_PATH="HTTP_IN_PATH",e.HTTP_IN_BODY="HTTP_IN_BODY",e.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(Em||(Em={}));var Pm;(function(e){e.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",e.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",e.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",e.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(Pm||(Pm={}));var jm;(function(e){e.UNSPECIFIED="UNSPECIFIED",e.BLOCKING="BLOCKING",e.NON_BLOCKING="NON_BLOCKING"})(jm||(jm={}));var Im;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(Im||(Im={}));var Tm;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE",e.VALIDATED="VALIDATED"})(Tm||(Tm={}));var Am;(function(e){e.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH",e.MINIMAL="MINIMAL"})(Am||(Am={}));var Rm;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",e.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",e.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",e.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",e.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(Rm||(Rm={}));var Mm;(function(e){e.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",e.SEVERITY="SEVERITY",e.PROBABILITY="PROBABILITY"})(Mm||(Mm={}));var Lm;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE",e.OFF="OFF"})(Lm||(Lm={}));var Dm;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.IMAGE_SAFETY="IMAGE_SAFETY",e.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",e.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",e.NO_IMAGE="NO_IMAGE",e.IMAGE_RECITATION="IMAGE_RECITATION",e.IMAGE_OTHER="IMAGE_OTHER"})(Dm||(Dm={}));var zm;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(zm||(zm={}));var qm;(function(e){e.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",e.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",e.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",e.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",e.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(qm||(qm={}));var Om;(function(e){e.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",e.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",e.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",e.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",e.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(Om||(Om={}));var Fm;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.IMAGE_SAFETY="IMAGE_SAFETY",e.MODEL_ARMOR="MODEL_ARMOR",e.JAILBREAK="JAILBREAK"})(Fm||(Fm={}));var Bm;(function(e){e.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",e.ON_DEMAND="ON_DEMAND",e.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Bm||(Bm={}));var Ba;(function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.AUDIO="AUDIO"})(Ba||(Ba={}));var Hm;(function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Hm||(Hm={}));var Gm;(function(e){e.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",e.TUNING_MODE_FULL="TUNING_MODE_FULL",e.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Gm||(Gm={}));var Um;(function(e){e.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",e.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",e.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",e.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",e.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",e.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",e.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Um||(Um={}));var xu;(function(e){e.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",e.JOB_STATE_QUEUED="JOB_STATE_QUEUED",e.JOB_STATE_PENDING="JOB_STATE_PENDING",e.JOB_STATE_RUNNING="JOB_STATE_RUNNING",e.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",e.JOB_STATE_FAILED="JOB_STATE_FAILED",e.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",e.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",e.JOB_STATE_PAUSED="JOB_STATE_PAUSED",e.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",e.JOB_STATE_UPDATING="JOB_STATE_UPDATING",e.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(xu||(xu={}));var Vm;(function(e){e.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",e.TUNING_TASK_I2V="TUNING_TASK_I2V",e.TUNING_TASK_T2V="TUNING_TASK_T2V",e.TUNING_TASK_R2V="TUNING_TASK_R2V"})(Vm||(Vm={}));var Wm;(function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",e.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(Wm||(Wm={}));var yu;(function(e){e.COLLECTION="COLLECTION"})(yu||(yu={}));var $m;(function(e){e.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",e.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",e.BALANCED="BALANCED",e.PRIORITIZE_COST="PRIORITIZE_COST"})($m||($m={}));var Km;(function(e){e.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",e.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Km||(Km={}));var Jm;(function(e){e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(Jm||(Jm={}));var Ym;(function(e){e.DONT_ALLOW="DONT_ALLOW",e.ALLOW_ADULT="ALLOW_ADULT",e.ALLOW_ALL="ALLOW_ALL"})(Ym||(Ym={}));var Xm;(function(e){e.auto="auto",e.en="en",e.ja="ja",e.ko="ko",e.hi="hi",e.zh="zh",e.pt="pt",e.es="es"})(Xm||(Xm={}));var Zm;(function(e){e.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",e.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",e.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",e.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",e.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Zm||(Zm={}));var Qm;(function(e){e.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",e.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",e.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",e.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Qm||(Qm={}));var eg;(function(e){e.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",e.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",e.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",e.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(eg||(eg={}));var tg;(function(e){e.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",e.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",e.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",e.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",e.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",e.EDIT_MODE_STYLE="EDIT_MODE_STYLE",e.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",e.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(tg||(tg={}));var ng;(function(e){e.FOREGROUND="FOREGROUND",e.BACKGROUND="BACKGROUND",e.PROMPT="PROMPT",e.SEMANTIC="SEMANTIC",e.INTERACTIVE="INTERACTIVE"})(ng||(ng={}));var og;(function(e){e.ASSET="ASSET",e.STYLE="STYLE"})(og||(og={}));var rg;(function(e){e.INSERT="INSERT",e.REMOVE="REMOVE",e.REMOVE_STATIC="REMOVE_STATIC",e.OUTPAINT="OUTPAINT"})(rg||(rg={}));var ag;(function(e){e.OPTIMIZED="OPTIMIZED",e.LOSSLESS="LOSSLESS"})(ag||(ag={}));var ig;(function(e){e.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",e.PREFERENCE_TUNING="PREFERENCE_TUNING"})(ig||(ig={}));var sg;(function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.STATE_PENDING="STATE_PENDING",e.STATE_ACTIVE="STATE_ACTIVE",e.STATE_FAILED="STATE_FAILED"})(sg||(sg={}));var lg;(function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.PROCESSING="PROCESSING",e.ACTIVE="ACTIVE",e.FAILED="FAILED"})(lg||(lg={}));var cg;(function(e){e.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",e.UPLOADED="UPLOADED",e.GENERATED="GENERATED",e.REGISTERED="REGISTERED"})(cg||(cg={}));var dg;(function(e){e.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.RESPONSE_REJECTED="RESPONSE_REJECTED",e.NEED_MORE_INPUT="NEED_MORE_INPUT"})(dg||(dg={}));var ug;(function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.DOCUMENT="DOCUMENT"})(ug||(ug={}));var pg;(function(e){e.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",e.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",e.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(pg||(pg={}));var hg;(function(e){e.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",e.ACTIVITY_START="ACTIVITY_START",e.ACTIVITY_END="ACTIVITY_END"})(hg||(hg={}));var mg;(function(e){e.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",e.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",e.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(mg||(mg={}));var gg;(function(e){e.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",e.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",e.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(gg||(gg={}));var fg;(function(e){e.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",e.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",e.NO_INTERRUPTION="NO_INTERRUPTION"})(fg||(fg={}));var xg;(function(e){e.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",e.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",e.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(xg||(xg={}));var yg;(function(e){e.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",e.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",e.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",e.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",e.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",e.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",e.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",e.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",e.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",e.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",e.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",e.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",e.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(yg||(yg={}));var vg;(function(e){e.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",e.QUALITY="QUALITY",e.DIVERSITY="DIVERSITY",e.VOCALIZATION="VOCALIZATION"})(vg||(vg={}));var va;(function(e){e.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",e.PLAY="PLAY",e.PAUSE="PAUSE",e.STOP="STOP",e.RESET_CONTEXT="RESET_CONTEXT"})(va||(va={}));class vu{constructor(t){const o={};for(const r of t.headers.entries())o[r[0]]=r[1];this.headers=o,this.responseInternal=t}json(){return this.responseInternal.json()}}class ii{get text(){var t,o,r,a,i,s,l,c;if(((a=(r=(o=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||o===void 0?void 0:o.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",u=!1;const p=[];for(const m of(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)!==null&&c!==void 0?c:[]){for(const[w,k]of Object.entries(m))w!=="text"&&w!=="thought"&&w!=="thoughtSignature"&&(k!==null||k!==void 0)&&p.push(w);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;u=!0,d+=m.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?d:void 0}get data(){var t,o,r,a,i,s,l,c;if(((a=(r=(o=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||o===void 0?void 0:o.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="";const u=[];for(const p of(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)!==null&&c!==void 0?c:[]){for(const[m,w]of Object.entries(p))m!=="inlineData"&&(w!==null||w!==void 0)&&u.push(m);p.inlineData&&typeof p.inlineData.data=="string"&&(d+=atob(p.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var t,o,r,a,i,s,l,c;if(((a=(r=(o=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||o===void 0?void 0:o.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(u=>u.functionCall).map(u=>u.functionCall).filter(u=>u!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var t,o,r,a,i,s,l,c,d;if(((a=(r=(o=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||o===void 0?void 0:o.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const u=(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((u==null?void 0:u.length)!==0)return(d=u==null?void 0:u[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var t,o,r,a,i,s,l,c,d;if(((a=(r=(o=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||o===void 0?void 0:o.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const u=(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((u==null?void 0:u.length)!==0)return(d=u==null?void 0:u[0])===null||d===void 0?void 0:d.output}}class wg{}class bg{}class w5{}class b5{}class C5{}class k5{}class Cg{}class kg{}class _g{}class _5{}class Sl{_fromAPIResponse({apiResponse:t,_isVertexAI:o}){const r=new Sl;let a;const i=t;return o?a=l5(i):a=s5(i),Object.assign(r,a),r}}class Sg{}class Ng{}class Eg{}class Pg{}class S5{}class N5{}class E5{}class Op{_fromAPIResponse({apiResponse:t,_isVertexAI:o}){const r=new Op,i=g5(t);return Object.assign(r,i),r}}class P5{}class j5{}class I5{}class jg{}class T5{get text(){var t,o,r;let a="",i=!1;const s=[];for(const l of(r=(o=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||o===void 0?void 0:o.parts)!==null&&r!==void 0?r:[]){for(const[c,d]of Object.entries(l))c!=="text"&&c!=="thought"&&d!==null&&s.push(c);if(typeof l.text=="string"){if(typeof l.thought=="boolean"&&l.thought)continue;i=!0,a+=l.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),i?a:void 0}get data(){var t,o,r;let a="";const i=[];for(const s of(r=(o=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||o===void 0?void 0:o.parts)!==null&&r!==void 0?r:[]){for(const[l,c]of Object.entries(s))l!=="inlineData"&&c!==null&&i.push(l);s.inlineData&&typeof s.inlineData.data=="string"&&(a+=atob(s.inlineData.data))}return i.length>0&&console.warn(`there are non-data parts ${i} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),a.length>0?btoa(a):void 0}}class A5{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class Fp{_fromAPIResponse({apiResponse:t,_isVertexAI:o}){const r=new Fp,i=d1(t);return Object.assign(r,i),r}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Bt(e,t){if(!t||typeof t!="string")throw new Error("model is required and must be a string");if(t.includes("..")||t.includes("?")||t.includes("&"))throw new Error("invalid model parameter");if(e.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(t.indexOf("/")>=0){const o=t.split("/",2);return`publishers/${o[0]}/models/${o[1]}`}else return`publishers/google/models/${t}`}else return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function u1(e,t){const o=Bt(e,t);return o?o.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${o}`:o.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${o}`:o:""}function p1(e){return Array.isArray(e)?e.map(t=>Nl(t)):[Nl(e)]}function Nl(e){if(typeof e=="object"&&e!==null)return e;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function h1(e){const t=Nl(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function m1(e){const t=Nl(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function Ig(e){if(e==null)throw new Error("PartUnion is required");if(typeof e=="object")return e;if(typeof e=="string")return{text:e};throw new Error(`Unsupported part type: ${typeof e}`)}function g1(e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("PartListUnion is required");return Array.isArray(e)?e.map(t=>Ig(t)):[Ig(e)]}function wu(e){return e!=null&&typeof e=="object"&&"parts"in e&&Array.isArray(e.parts)}function Tg(e){return e!=null&&typeof e=="object"&&"functionCall"in e}function Ag(e){return e!=null&&typeof e=="object"&&"functionResponse"in e}function Tn(e){if(e==null)throw new Error("ContentUnion is required");return wu(e)?e:{role:"user",parts:g1(e)}}function Bp(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(o=>{const r=Tn(o);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(e.isVertexAI()){const o=Tn(t);return o.parts&&o.parts.length>0&&o.parts[0].text!==void 0?[o.parts[0].text]:[]}return Array.isArray(t)?t.map(o=>Tn(o)):[Tn(t)]}function so(e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("contents are required");if(!Array.isArray(e)){if(Tg(e)||Ag(e))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Tn(e)]}const t=[],o=[],r=wu(e[0]);for(const a of e){const i=wu(a);if(i!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(i)t.push(a);else{if(Tg(a)||Ag(a))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");o.push(a)}}return r||t.push({role:"user",parts:g1(o)}),t}function R5(e,t){e.includes("null")&&(t.nullable=!0);const o=e.filter(r=>r!=="null");if(o.length===1)t.type=Object.values(bt).includes(o[0].toUpperCase())?o[0].toUpperCase():bt.TYPE_UNSPECIFIED;else{t.anyOf=[];for(const r of o)t.anyOf.push({type:Object.values(bt).includes(r.toUpperCase())?r.toUpperCase():bt.TYPE_UNSPECIFIED})}}function Ea(e){const t={},o=["items"],r=["anyOf"],a=["properties"];if(e.type&&e.anyOf)throw new Error("type and anyOf cannot be both populated.");const i=e.anyOf;i!=null&&i.length==2&&(i[0].type==="null"?(t.nullable=!0,e=i[1]):i[1].type==="null"&&(t.nullable=!0,e=i[0])),e.type instanceof Array&&R5(e.type,t);for(const[s,l]of Object.entries(e))if(l!=null)if(s=="type"){if(l==="null")throw new Error("type: null can not be the only possible type for the field.");if(l instanceof Array)continue;t.type=Object.values(bt).includes(l.toUpperCase())?l.toUpperCase():bt.TYPE_UNSPECIFIED}else if(o.includes(s))t[s]=Ea(l);else if(r.includes(s)){const c=[];for(const d of l){if(d.type=="null"){t.nullable=!0;continue}c.push(Ea(d))}t[s]=c}else if(a.includes(s)){const c={};for(const[d,u]of Object.entries(l))c[d]=Ea(u);t[s]=c}else{if(s==="additionalProperties")continue;t[s]=l}return t}function Hp(e){return Ea(e)}function Gp(e){if(typeof e=="object")return e;if(typeof e=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw new Error(`Unsupported speechConfig type: ${typeof e}`)}function Up(e){if("multiSpeakerVoiceConfig"in e)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function $a(e){if(e.functionDeclarations)for(const t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=Ea(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=Ea(t.response));return e}function Ka(e){if(e==null)throw new Error("tools is required");if(!Array.isArray(e))throw new Error("tools is required and must be an array of Tools");const t=[];for(const o of e)t.push(o);return t}function M5(e,t,o,r=1){const a=!t.startsWith(`${o}/`)&&t.split("/").length===r;return e.isVertexAI()?t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${e.getProject()}/${t}`:t.startsWith(`${o}/`)?`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`:a?`projects/${e.getProject()}/locations/${e.getLocation()}/${o}/${t}`:t:a?`${o}/${t}`:t}function Zo(e,t){if(typeof t!="string")throw new Error("name must be a string");return M5(e,t,"cachedContents")}function f1(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function Er(e){return qp(e)}function L5(e){return e!=null&&typeof e=="object"&&"name"in e}function D5(e){return e!=null&&typeof e=="object"&&"video"in e}function z5(e){return e!=null&&typeof e=="object"&&"uri"in e}function x1(e){var t;let o;if(L5(e)&&(o=e.name),!(z5(e)&&(o=e.uri,o===void 0))&&!(D5(e)&&(o=(t=e.video)===null||t===void 0?void 0:t.uri,o===void 0))){if(typeof e=="string"&&(o=e),o===void 0)throw new Error("Could not extract file name from the provided input.");if(o.startsWith("https://")){const a=o.split("files/")[1].match(/[a-z0-9]+/);if(a===null)throw new Error(`Could not extract file name from URI ${o}`);o=a[0]}else o.startsWith("files/")&&(o=o.split("files/")[1]);return o}}function y1(e,t){let o;return e.isVertexAI()?o=t?"publishers/google/models":"models":o=t?"models":"tunedModels",o}function v1(e){for(const t of["models","tunedModels","publisherModels"])if(q5(e,t))return e[t];return[]}function q5(e,t){return e!==null&&typeof e=="object"&&t in e}function O5(e,t={}){const o=e,r={name:o.name,description:o.description,parametersJsonSchema:o.inputSchema};return o.outputSchema&&(r.responseJsonSchema=o.outputSchema),t.behavior&&(r.behavior=t.behavior),{functionDeclarations:[r]}}function F5(e,t={}){const o=[],r=new Set;for(const a of e){const i=a.name;if(r.has(i))throw new Error(`Duplicate function name ${i} found in MCP tools. Please ensure function names are unique.`);r.add(i);const s=O5(a,t);s.functionDeclarations&&o.push(...s.functionDeclarations)}return{functionDeclarations:o}}function w1(e,t){let o;if(typeof t=="string")if(e.isVertexAI())if(t.startsWith("gs://"))o={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))o={format:"bigquery",bigqueryUri:t};else throw new Error(`Unsupported string source for Vertex AI: ${t}`);else if(t.startsWith("files/"))o={fileName:t};else throw new Error(`Unsupported string source for Gemini API: ${t}`);else if(Array.isArray(t)){if(e.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");o={inlinedRequests:t}}else o=t;const r=[o.gcsUri,o.bigqueryUri].filter(Boolean).length,a=[o.inlinedRequests,o.fileName].filter(Boolean).length;if(e.isVertexAI()){if(a>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||a!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return o}function B5(e){if(typeof e!="string")return e;const t=e;if(t.startsWith("gs://"))return{format:"jsonl",gcsUri:t};if(t.startsWith("bq://"))return{format:"bigquery",bigqueryUri:t};throw new Error(`Unsupported destination: ${t}`)}function b1(e){if(typeof e!="object"||e===null)return{};const t=e,o=t.inlinedResponses;if(typeof o!="object"||o===null)return e;const a=o.inlinedResponses;if(!Array.isArray(a)||a.length===0)return e;let i=!1;for(const s of a){if(typeof s!="object"||s===null)continue;const c=s.response;if(typeof c!="object"||c===null)continue;if(c.embedding!==void 0){i=!0;break}}return i&&(t.inlinedEmbedContentResponses=t.inlinedResponses,delete t.inlinedResponses),e}function Ja(e,t){const o=t;if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(o))return o.split("/").pop();throw new Error(`Invalid batch job name: ${o}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(o))return o.split("/").pop();if(/^\d+$/.test(o))return o;throw new Error(`Invalid batch job name: ${o}.`)}function C1(e){const t=e;return t==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":t==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":t==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":t==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":t==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":t==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":t==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function H5(e){const t={},o=g(e,["responsesFile"]);o!=null&&C(t,["fileName"],o);const r=g(e,["inlinedResponses","inlinedResponses"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>Ck(s))),C(t,["inlinedResponses"],i)}const a=g(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),C(t,["inlinedEmbedContentResponses"],i)}return t}function G5(e){const t={},o=g(e,["predictionsFormat"]);o!=null&&C(t,["format"],o);const r=g(e,["gcsDestination","outputUriPrefix"]);r!=null&&C(t,["gcsUri"],r);const a=g(e,["bigqueryDestination","outputUri"]);return a!=null&&C(t,["bigqueryUri"],a),t}function U5(e){const t={},o=g(e,["format"]);o!=null&&C(t,["predictionsFormat"],o);const r=g(e,["gcsUri"]);r!=null&&C(t,["gcsDestination","outputUriPrefix"],r);const a=g(e,["bigqueryUri"]);if(a!=null&&C(t,["bigqueryDestination","outputUri"],a),g(e,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(g(e,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(g(e,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}function Ks(e){const t={},o=g(e,["name"]);o!=null&&C(t,["name"],o);const r=g(e,["metadata","displayName"]);r!=null&&C(t,["displayName"],r);const a=g(e,["metadata","state"]);a!=null&&C(t,["state"],C1(a));const i=g(e,["metadata","createTime"]);i!=null&&C(t,["createTime"],i);const s=g(e,["metadata","endTime"]);s!=null&&C(t,["endTime"],s);const l=g(e,["metadata","updateTime"]);l!=null&&C(t,["updateTime"],l);const c=g(e,["metadata","model"]);c!=null&&C(t,["model"],c);const d=g(e,["metadata","output"]);return d!=null&&C(t,["dest"],H5(b1(d))),t}function bu(e){const t={},o=g(e,["name"]);o!=null&&C(t,["name"],o);const r=g(e,["displayName"]);r!=null&&C(t,["displayName"],r);const a=g(e,["state"]);a!=null&&C(t,["state"],C1(a));const i=g(e,["error"]);i!=null&&C(t,["error"],i);const s=g(e,["createTime"]);s!=null&&C(t,["createTime"],s);const l=g(e,["startTime"]);l!=null&&C(t,["startTime"],l);const c=g(e,["endTime"]);c!=null&&C(t,["endTime"],c);const d=g(e,["updateTime"]);d!=null&&C(t,["updateTime"],d);const u=g(e,["model"]);u!=null&&C(t,["model"],u);const p=g(e,["inputConfig"]);p!=null&&C(t,["src"],V5(p));const m=g(e,["outputConfig"]);m!=null&&C(t,["dest"],G5(b1(m)));const w=g(e,["completionStats"]);return w!=null&&C(t,["completionStats"],w),t}function V5(e){const t={},o=g(e,["instancesFormat"]);o!=null&&C(t,["format"],o);const r=g(e,["gcsSource","uris"]);r!=null&&C(t,["gcsUri"],r);const a=g(e,["bigquerySource","inputUri"]);return a!=null&&C(t,["bigqueryUri"],a),t}function W5(e,t){const o={};if(g(t,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(g(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(g(t,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const r=g(t,["fileName"]);r!=null&&C(o,["fileName"],r);const a=g(t,["inlinedRequests"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>bk(e,s))),C(o,["requests","requests"],i)}return o}function $5(e){const t={},o=g(e,["format"]);o!=null&&C(t,["instancesFormat"],o);const r=g(e,["gcsUri"]);r!=null&&C(t,["gcsSource","uris"],r);const a=g(e,["bigqueryUri"]);if(a!=null&&C(t,["bigquerySource","inputUri"],a),g(e,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(g(e,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return t}function K5(e){const t={},o=g(e,["data"]);if(o!=null&&C(t,["data"],o),g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=g(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function J5(e,t){const o={},r=g(t,["name"]);return r!=null&&C(o,["_url","name"],Ja(e,r)),o}function Y5(e,t){const o={},r=g(t,["name"]);return r!=null&&C(o,["_url","name"],Ja(e,r)),o}function X5(e){const t={},o=g(e,["content"]);o!=null&&C(t,["content"],o);const r=g(e,["citationMetadata"]);r!=null&&C(t,["citationMetadata"],Z5(r));const a=g(e,["tokenCount"]);a!=null&&C(t,["tokenCount"],a);const i=g(e,["finishReason"]);i!=null&&C(t,["finishReason"],i);const s=g(e,["avgLogprobs"]);s!=null&&C(t,["avgLogprobs"],s);const l=g(e,["groundingMetadata"]);l!=null&&C(t,["groundingMetadata"],l);const c=g(e,["index"]);c!=null&&C(t,["index"],c);const d=g(e,["logprobsResult"]);d!=null&&C(t,["logprobsResult"],d);const u=g(e,["safetyRatings"]);if(u!=null){let m=u;Array.isArray(m)&&(m=m.map(w=>w)),C(t,["safetyRatings"],m)}const p=g(e,["urlContextMetadata"]);return p!=null&&C(t,["urlContextMetadata"],p),t}function Z5(e){const t={},o=g(e,["citationSources"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>a)),C(t,["citations"],r)}return t}function k1(e){const t={},o=g(e,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(i=>jk(i))),C(t,["parts"],a)}const r=g(e,["role"]);return r!=null&&C(t,["role"],r),t}function Q5(e,t){const o={},r=g(e,["displayName"]);if(t!==void 0&&r!=null&&C(t,["batch","displayName"],r),g(e,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return o}function ek(e,t){const o={},r=g(e,["displayName"]);t!==void 0&&r!=null&&C(t,["displayName"],r);const a=g(e,["dest"]);return t!==void 0&&a!=null&&C(t,["outputConfig"],U5(B5(a))),o}function Rg(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["_url","model"],Bt(e,r));const a=g(t,["src"]);a!=null&&C(o,["batch","inputConfig"],W5(e,w1(e,a)));const i=g(t,["config"]);return i!=null&&Q5(i,o),o}function tk(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["model"],Bt(e,r));const a=g(t,["src"]);a!=null&&C(o,["inputConfig"],$5(w1(e,a)));const i=g(t,["config"]);return i!=null&&ek(i,o),o}function nk(e,t){const o={},r=g(e,["displayName"]);return t!==void 0&&r!=null&&C(t,["batch","displayName"],r),o}function ok(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["_url","model"],Bt(e,r));const a=g(t,["src"]);a!=null&&C(o,["batch","inputConfig"],dk(e,a));const i=g(t,["config"]);return i!=null&&nk(i,o),o}function rk(e,t){const o={},r=g(t,["name"]);return r!=null&&C(o,["_url","name"],Ja(e,r)),o}function ak(e,t){const o={},r=g(t,["name"]);return r!=null&&C(o,["_url","name"],Ja(e,r)),o}function ik(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["name"]);r!=null&&C(t,["name"],r);const a=g(e,["done"]);a!=null&&C(t,["done"],a);const i=g(e,["error"]);return i!=null&&C(t,["error"],i),t}function sk(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["name"]);r!=null&&C(t,["name"],r);const a=g(e,["done"]);a!=null&&C(t,["done"],a);const i=g(e,["error"]);return i!=null&&C(t,["error"],i),t}function lk(e,t){const o={},r=g(t,["contents"]);if(r!=null){let i=Bp(e,r);Array.isArray(i)&&(i=i.map(s=>s)),C(o,["requests[]","request","content"],i)}const a=g(t,["config"]);return a!=null&&(C(o,["_self"],ck(a,o)),a5(o,{"requests[].*":"requests[].request.*"})),o}function ck(e,t){const o={},r=g(e,["taskType"]);t!==void 0&&r!=null&&C(t,["requests[]","taskType"],r);const a=g(e,["title"]);t!==void 0&&a!=null&&C(t,["requests[]","title"],a);const i=g(e,["outputDimensionality"]);if(t!==void 0&&i!=null&&C(t,["requests[]","outputDimensionality"],i),g(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(g(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return o}function dk(e,t){const o={},r=g(t,["fileName"]);r!=null&&C(o,["file_name"],r);const a=g(t,["inlinedRequests"]);return a!=null&&C(o,["requests"],lk(e,a)),o}function uk(e){const t={};if(g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=g(e,["fileUri"]);o!=null&&C(t,["fileUri"],o);const r=g(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function pk(e){const t={},o=g(e,["id"]);o!=null&&C(t,["id"],o);const r=g(e,["args"]);r!=null&&C(t,["args"],r);const a=g(e,["name"]);if(a!=null&&C(t,["name"],a),g(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function hk(e){const t={},o=g(e,["allowedFunctionNames"]);o!=null&&C(t,["allowedFunctionNames"],o);const r=g(e,["mode"]);if(r!=null&&C(t,["mode"],r),g(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function mk(e,t,o){const r={},a=g(t,["systemInstruction"]);o!==void 0&&a!=null&&C(o,["systemInstruction"],k1(Tn(a)));const i=g(t,["temperature"]);i!=null&&C(r,["temperature"],i);const s=g(t,["topP"]);s!=null&&C(r,["topP"],s);const l=g(t,["topK"]);l!=null&&C(r,["topK"],l);const c=g(t,["candidateCount"]);c!=null&&C(r,["candidateCount"],c);const d=g(t,["maxOutputTokens"]);d!=null&&C(r,["maxOutputTokens"],d);const u=g(t,["stopSequences"]);u!=null&&C(r,["stopSequences"],u);const p=g(t,["responseLogprobs"]);p!=null&&C(r,["responseLogprobs"],p);const m=g(t,["logprobs"]);m!=null&&C(r,["logprobs"],m);const w=g(t,["presencePenalty"]);w!=null&&C(r,["presencePenalty"],w);const k=g(t,["frequencyPenalty"]);k!=null&&C(r,["frequencyPenalty"],k);const b=g(t,["seed"]);b!=null&&C(r,["seed"],b);const x=g(t,["responseMimeType"]);x!=null&&C(r,["responseMimeType"],x);const f=g(t,["responseSchema"]);f!=null&&C(r,["responseSchema"],Hp(f));const h=g(t,["responseJsonSchema"]);if(h!=null&&C(r,["responseJsonSchema"],h),g(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(g(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const v=g(t,["safetySettings"]);if(o!==void 0&&v!=null){let P=v;Array.isArray(P)&&(P=P.map(S=>Ik(S))),C(o,["safetySettings"],P)}const N=g(t,["tools"]);if(o!==void 0&&N!=null){let P=Ka(N);Array.isArray(P)&&(P=P.map(S=>Ak($a(S)))),C(o,["tools"],P)}const _=g(t,["toolConfig"]);if(o!==void 0&&_!=null&&C(o,["toolConfig"],Tk(_)),g(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const E=g(t,["cachedContent"]);o!==void 0&&E!=null&&C(o,["cachedContent"],Zo(e,E));const I=g(t,["responseModalities"]);I!=null&&C(r,["responseModalities"],I);const B=g(t,["mediaResolution"]);B!=null&&C(r,["mediaResolution"],B);const M=g(t,["speechConfig"]);if(M!=null&&C(r,["speechConfig"],Gp(M)),g(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const G=g(t,["thinkingConfig"]);G!=null&&C(r,["thinkingConfig"],G);const V=g(t,["imageConfig"]);V!=null&&C(r,["imageConfig"],wk(V));const j=g(t,["enableEnhancedCivicAnswers"]);if(j!=null&&C(r,["enableEnhancedCivicAnswers"],j),g(t,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return r}function gk(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["candidates"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(d=>X5(d))),C(t,["candidates"],c)}const a=g(e,["modelVersion"]);a!=null&&C(t,["modelVersion"],a);const i=g(e,["promptFeedback"]);i!=null&&C(t,["promptFeedback"],i);const s=g(e,["responseId"]);s!=null&&C(t,["responseId"],s);const l=g(e,["usageMetadata"]);return l!=null&&C(t,["usageMetadata"],l),t}function fk(e,t){const o={},r=g(t,["name"]);return r!=null&&C(o,["_url","name"],Ja(e,r)),o}function xk(e,t){const o={},r=g(t,["name"]);return r!=null&&C(o,["_url","name"],Ja(e,r)),o}function yk(e){const t={};if(g(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const o=g(e,["enableWidget"]);return o!=null&&C(t,["enableWidget"],o),t}function vk(e){const t={};if(g(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const o=g(e,["timeRangeFilter"]);return o!=null&&C(t,["timeRangeFilter"],o),t}function wk(e){const t={},o=g(e,["aspectRatio"]);o!=null&&C(t,["aspectRatio"],o);const r=g(e,["imageSize"]);if(r!=null&&C(t,["imageSize"],r),g(e,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(g(e,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(g(e,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function bk(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["request","model"],Bt(e,r));const a=g(t,["contents"]);if(a!=null){let l=so(a);Array.isArray(l)&&(l=l.map(c=>k1(c))),C(o,["request","contents"],l)}const i=g(t,["metadata"]);i!=null&&C(o,["metadata"],i);const s=g(t,["config"]);return s!=null&&C(o,["request","generationConfig"],mk(e,s,g(o,["request"],{}))),o}function Ck(e){const t={},o=g(e,["response"]);o!=null&&C(t,["response"],gk(o));const r=g(e,["error"]);return r!=null&&C(t,["error"],r),t}function kk(e,t){const o={},r=g(e,["pageSize"]);t!==void 0&&r!=null&&C(t,["_query","pageSize"],r);const a=g(e,["pageToken"]);if(t!==void 0&&a!=null&&C(t,["_query","pageToken"],a),g(e,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return o}function _k(e,t){const o={},r=g(e,["pageSize"]);t!==void 0&&r!=null&&C(t,["_query","pageSize"],r);const a=g(e,["pageToken"]);t!==void 0&&a!=null&&C(t,["_query","pageToken"],a);const i=g(e,["filter"]);return t!==void 0&&i!=null&&C(t,["_query","filter"],i),o}function Sk(e){const t={},o=g(e,["config"]);return o!=null&&kk(o,t),t}function Nk(e){const t={},o=g(e,["config"]);return o!=null&&_k(o,t),t}function Ek(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["nextPageToken"]);r!=null&&C(t,["nextPageToken"],r);const a=g(e,["operations"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>Ks(s))),C(t,["batchJobs"],i)}return t}function Pk(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["nextPageToken"]);r!=null&&C(t,["nextPageToken"],r);const a=g(e,["batchPredictionJobs"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>bu(s))),C(t,["batchJobs"],i)}return t}function jk(e){const t={},o=g(e,["mediaResolution"]);o!=null&&C(t,["mediaResolution"],o);const r=g(e,["codeExecutionResult"]);r!=null&&C(t,["codeExecutionResult"],r);const a=g(e,["executableCode"]);a!=null&&C(t,["executableCode"],a);const i=g(e,["fileData"]);i!=null&&C(t,["fileData"],uk(i));const s=g(e,["functionCall"]);s!=null&&C(t,["functionCall"],pk(s));const l=g(e,["functionResponse"]);l!=null&&C(t,["functionResponse"],l);const c=g(e,["inlineData"]);c!=null&&C(t,["inlineData"],K5(c));const d=g(e,["text"]);d!=null&&C(t,["text"],d);const u=g(e,["thought"]);u!=null&&C(t,["thought"],u);const p=g(e,["thoughtSignature"]);p!=null&&C(t,["thoughtSignature"],p);const m=g(e,["videoMetadata"]);return m!=null&&C(t,["videoMetadata"],m),t}function Ik(e){const t={},o=g(e,["category"]);if(o!=null&&C(t,["category"],o),g(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=g(e,["threshold"]);return r!=null&&C(t,["threshold"],r),t}function Tk(e){const t={},o=g(e,["retrievalConfig"]);o!=null&&C(t,["retrievalConfig"],o);const r=g(e,["functionCallingConfig"]);return r!=null&&C(t,["functionCallingConfig"],hk(r)),t}function Ak(e){const t={};if(g(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const o=g(e,["computerUse"]);o!=null&&C(t,["computerUse"],o);const r=g(e,["fileSearch"]);r!=null&&C(t,["fileSearch"],r);const a=g(e,["codeExecution"]);if(a!=null&&C(t,["codeExecution"],a),g(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const i=g(e,["functionDeclarations"]);if(i!=null){let u=i;Array.isArray(u)&&(u=u.map(p=>p)),C(t,["functionDeclarations"],u)}const s=g(e,["googleMaps"]);s!=null&&C(t,["googleMaps"],yk(s));const l=g(e,["googleSearch"]);l!=null&&C(t,["googleSearch"],vk(l));const c=g(e,["googleSearchRetrieval"]);c!=null&&C(t,["googleSearchRetrieval"],c);const d=g(e,["urlContext"]);return d!=null&&C(t,["urlContext"],d),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Jo;(function(e){e.PAGED_ITEM_BATCH_JOBS="batchJobs",e.PAGED_ITEM_MODELS="models",e.PAGED_ITEM_TUNING_JOBS="tuningJobs",e.PAGED_ITEM_FILES="files",e.PAGED_ITEM_CACHED_CONTENTS="cachedContents",e.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",e.PAGED_ITEM_DOCUMENTS="documents"})(Jo||(Jo={}));class Kr{constructor(t,o,r,a){this.pageInternal=[],this.paramsInternal={},this.requestInternal=o,this.init(t,r,a)}init(t,o,r){var a,i;this.nameInternal=t,this.pageInternal=o[this.nameInternal]||[],this.sdkHttpResponseInternal=o==null?void 0:o.sdkHttpResponse,this.idxInternal=0;let s={config:{}};!r||Object.keys(r).length===0?s={config:{}}:typeof r=="object"?s=Object.assign({},r):s=r,s.config&&(s.config.pageToken=o.nextPageToken),this.paramsInternal=s,this.pageInternalSize=(i=(a=s.config)===null||a===void 0?void 0:a.pageSize)!==null&&i!==void 0?i:this.pageInternal.length}initNextPage(t){this.init(this.nameInternal,t,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(t){return this.pageInternal[t]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const t=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:t,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const t=await this.requestInternal(this.params);return this.initNextPage(t),this.page}hasNextPage(){var t;return((t=this.params.config)===null||t===void 0?void 0:t.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Rk extends Xo{constructor(t){super(),this.apiClient=t,this.list=async(o={})=>new Kr(Jo.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(o),o),this.create=async o=>(this.apiClient.isVertexAI()&&(o.config=this.formatDestination(o.src,o.config)),this.createInternal(o)),this.createEmbeddings=async o=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(o)}}createInlinedGenerateContentRequest(t){const o=Rg(this.apiClient,t),r=o._url,a=xt("{model}:batchGenerateContent",r),l=o.batch.inputConfig.requests,c=l.requests,d=[];for(const u of c){const p=Object.assign({},u);if(p.systemInstruction){const m=p.systemInstruction;delete p.systemInstruction;const w=p.request;w.systemInstruction=m,p.request=w}d.push(p)}return l.requests=d,delete o.config,delete o._url,delete o._query,{path:a,body:o}}getGcsUri(t){if(typeof t=="string")return t.startsWith("gs://")?t:void 0;if(!Array.isArray(t)&&t.gcsUri&&t.gcsUri.length>0)return t.gcsUri[0]}getBigqueryUri(t){if(typeof t=="string")return t.startsWith("bq://")?t:void 0;if(!Array.isArray(t))return t.bigqueryUri}formatDestination(t,o){const r=o?Object.assign({},o):{},a=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${a}`),r.dest===void 0){const i=this.getGcsUri(t),s=this.getBigqueryUri(t);if(i)i.endsWith(".jsonl")?r.dest=`${i.slice(0,-6)}/dest`:r.dest=`${i}_dest_${a}`;else if(s)r.dest=`${s}_dest_${a}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=tk(this.apiClient,t);return l=xt("batchPredictionJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>bu(u))}else{const d=Rg(this.apiClient,t);return l=xt("{model}:batchGenerateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>Ks(u))}}async createEmbeddingsInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=ok(this.apiClient,t);return i=xt("{model}:asyncBatchEmbedContent",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>Ks(c))}}async get(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=xk(this.apiClient,t);return l=xt("batchPredictionJobs/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>bu(u))}else{const d=fk(this.apiClient,t);return l=xt("batches/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>Ks(u))}}async cancel(t){var o,r,a,i;let s="",l={};if(this.apiClient.isVertexAI()){const c=Y5(this.apiClient,t);s=xt("batchPredictionJobs/{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal})}else{const c=J5(this.apiClient,t);s=xt("batches/{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=Nk(t);return l=xt("batchPredictionJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=Pk(u),m=new jg;return Object.assign(m,p),m})}else{const d=Sk(t);return l=xt("batches",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=Ek(u),m=new jg;return Object.assign(m,p),m})}}async delete(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=ak(this.apiClient,t);return l=xt("batchPredictionJobs/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>sk(u))}else{const d=rk(this.apiClient,t);return l=xt("batches/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>ik(u))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Mk(e){const t={},o=g(e,["data"]);if(o!=null&&C(t,["data"],o),g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=g(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function Mg(e){const t={},o=g(e,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(i=>o4(i))),C(t,["parts"],a)}const r=g(e,["role"]);return r!=null&&C(t,["role"],r),t}function Lk(e,t){const o={},r=g(e,["ttl"]);t!==void 0&&r!=null&&C(t,["ttl"],r);const a=g(e,["expireTime"]);t!==void 0&&a!=null&&C(t,["expireTime"],a);const i=g(e,["displayName"]);t!==void 0&&i!=null&&C(t,["displayName"],i);const s=g(e,["contents"]);if(t!==void 0&&s!=null){let u=so(s);Array.isArray(u)&&(u=u.map(p=>Mg(p))),C(t,["contents"],u)}const l=g(e,["systemInstruction"]);t!==void 0&&l!=null&&C(t,["systemInstruction"],Mg(Tn(l)));const c=g(e,["tools"]);if(t!==void 0&&c!=null){let u=c;Array.isArray(u)&&(u=u.map(p=>a4(p))),C(t,["tools"],u)}const d=g(e,["toolConfig"]);if(t!==void 0&&d!=null&&C(t,["toolConfig"],r4(d)),g(e,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return o}function Dk(e,t){const o={},r=g(e,["ttl"]);t!==void 0&&r!=null&&C(t,["ttl"],r);const a=g(e,["expireTime"]);t!==void 0&&a!=null&&C(t,["expireTime"],a);const i=g(e,["displayName"]);t!==void 0&&i!=null&&C(t,["displayName"],i);const s=g(e,["contents"]);if(t!==void 0&&s!=null){let p=so(s);Array.isArray(p)&&(p=p.map(m=>m)),C(t,["contents"],p)}const l=g(e,["systemInstruction"]);t!==void 0&&l!=null&&C(t,["systemInstruction"],Tn(l));const c=g(e,["tools"]);if(t!==void 0&&c!=null){let p=c;Array.isArray(p)&&(p=p.map(m=>i4(m))),C(t,["tools"],p)}const d=g(e,["toolConfig"]);t!==void 0&&d!=null&&C(t,["toolConfig"],d);const u=g(e,["kmsKeyName"]);return t!==void 0&&u!=null&&C(t,["encryption_spec","kmsKeyName"],u),o}function zk(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["model"],u1(e,r));const a=g(t,["config"]);return a!=null&&Lk(a,o),o}function qk(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["model"],u1(e,r));const a=g(t,["config"]);return a!=null&&Dk(a,o),o}function Ok(e,t){const o={},r=g(t,["name"]);return r!=null&&C(o,["_url","name"],Zo(e,r)),o}function Fk(e,t){const o={},r=g(t,["name"]);return r!=null&&C(o,["_url","name"],Zo(e,r)),o}function Bk(e){const t={},o=g(e,["sdkHttpResponse"]);return o!=null&&C(t,["sdkHttpResponse"],o),t}function Hk(e){const t={},o=g(e,["sdkHttpResponse"]);return o!=null&&C(t,["sdkHttpResponse"],o),t}function Gk(e){const t={};if(g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=g(e,["fileUri"]);o!=null&&C(t,["fileUri"],o);const r=g(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function Uk(e){const t={},o=g(e,["id"]);o!=null&&C(t,["id"],o);const r=g(e,["args"]);r!=null&&C(t,["args"],r);const a=g(e,["name"]);if(a!=null&&C(t,["name"],a),g(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function Vk(e){const t={},o=g(e,["allowedFunctionNames"]);o!=null&&C(t,["allowedFunctionNames"],o);const r=g(e,["mode"]);if(r!=null&&C(t,["mode"],r),g(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function Wk(e){const t={},o=g(e,["description"]);o!=null&&C(t,["description"],o);const r=g(e,["name"]);r!=null&&C(t,["name"],r);const a=g(e,["parameters"]);a!=null&&C(t,["parameters"],a);const i=g(e,["parametersJsonSchema"]);i!=null&&C(t,["parametersJsonSchema"],i);const s=g(e,["response"]);s!=null&&C(t,["response"],s);const l=g(e,["responseJsonSchema"]);if(l!=null&&C(t,["responseJsonSchema"],l),g(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return t}function $k(e,t){const o={},r=g(t,["name"]);return r!=null&&C(o,["_url","name"],Zo(e,r)),o}function Kk(e,t){const o={},r=g(t,["name"]);return r!=null&&C(o,["_url","name"],Zo(e,r)),o}function Jk(e){const t={};if(g(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const o=g(e,["enableWidget"]);return o!=null&&C(t,["enableWidget"],o),t}function Yk(e){const t={};if(g(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const o=g(e,["timeRangeFilter"]);return o!=null&&C(t,["timeRangeFilter"],o),t}function Xk(e,t){const o={},r=g(e,["pageSize"]);t!==void 0&&r!=null&&C(t,["_query","pageSize"],r);const a=g(e,["pageToken"]);return t!==void 0&&a!=null&&C(t,["_query","pageToken"],a),o}function Zk(e,t){const o={},r=g(e,["pageSize"]);t!==void 0&&r!=null&&C(t,["_query","pageSize"],r);const a=g(e,["pageToken"]);return t!==void 0&&a!=null&&C(t,["_query","pageToken"],a),o}function Qk(e){const t={},o=g(e,["config"]);return o!=null&&Xk(o,t),t}function e4(e){const t={},o=g(e,["config"]);return o!=null&&Zk(o,t),t}function t4(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["nextPageToken"]);r!=null&&C(t,["nextPageToken"],r);const a=g(e,["cachedContents"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),C(t,["cachedContents"],i)}return t}function n4(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["nextPageToken"]);r!=null&&C(t,["nextPageToken"],r);const a=g(e,["cachedContents"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),C(t,["cachedContents"],i)}return t}function o4(e){const t={},o=g(e,["mediaResolution"]);o!=null&&C(t,["mediaResolution"],o);const r=g(e,["codeExecutionResult"]);r!=null&&C(t,["codeExecutionResult"],r);const a=g(e,["executableCode"]);a!=null&&C(t,["executableCode"],a);const i=g(e,["fileData"]);i!=null&&C(t,["fileData"],Gk(i));const s=g(e,["functionCall"]);s!=null&&C(t,["functionCall"],Uk(s));const l=g(e,["functionResponse"]);l!=null&&C(t,["functionResponse"],l);const c=g(e,["inlineData"]);c!=null&&C(t,["inlineData"],Mk(c));const d=g(e,["text"]);d!=null&&C(t,["text"],d);const u=g(e,["thought"]);u!=null&&C(t,["thought"],u);const p=g(e,["thoughtSignature"]);p!=null&&C(t,["thoughtSignature"],p);const m=g(e,["videoMetadata"]);return m!=null&&C(t,["videoMetadata"],m),t}function r4(e){const t={},o=g(e,["retrievalConfig"]);o!=null&&C(t,["retrievalConfig"],o);const r=g(e,["functionCallingConfig"]);return r!=null&&C(t,["functionCallingConfig"],Vk(r)),t}function a4(e){const t={};if(g(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const o=g(e,["computerUse"]);o!=null&&C(t,["computerUse"],o);const r=g(e,["fileSearch"]);r!=null&&C(t,["fileSearch"],r);const a=g(e,["codeExecution"]);if(a!=null&&C(t,["codeExecution"],a),g(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const i=g(e,["functionDeclarations"]);if(i!=null){let u=i;Array.isArray(u)&&(u=u.map(p=>p)),C(t,["functionDeclarations"],u)}const s=g(e,["googleMaps"]);s!=null&&C(t,["googleMaps"],Jk(s));const l=g(e,["googleSearch"]);l!=null&&C(t,["googleSearch"],Yk(l));const c=g(e,["googleSearchRetrieval"]);c!=null&&C(t,["googleSearchRetrieval"],c);const d=g(e,["urlContext"]);return d!=null&&C(t,["urlContext"],d),t}function i4(e){const t={},o=g(e,["retrieval"]);o!=null&&C(t,["retrieval"],o);const r=g(e,["computerUse"]);if(r!=null&&C(t,["computerUse"],r),g(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const a=g(e,["codeExecution"]);a!=null&&C(t,["codeExecution"],a);const i=g(e,["enterpriseWebSearch"]);i!=null&&C(t,["enterpriseWebSearch"],i);const s=g(e,["functionDeclarations"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(m=>Wk(m))),C(t,["functionDeclarations"],p)}const l=g(e,["googleMaps"]);l!=null&&C(t,["googleMaps"],l);const c=g(e,["googleSearch"]);c!=null&&C(t,["googleSearch"],c);const d=g(e,["googleSearchRetrieval"]);d!=null&&C(t,["googleSearchRetrieval"],d);const u=g(e,["urlContext"]);return u!=null&&C(t,["urlContext"],u),t}function s4(e,t){const o={},r=g(e,["ttl"]);t!==void 0&&r!=null&&C(t,["ttl"],r);const a=g(e,["expireTime"]);return t!==void 0&&a!=null&&C(t,["expireTime"],a),o}function l4(e,t){const o={},r=g(e,["ttl"]);t!==void 0&&r!=null&&C(t,["ttl"],r);const a=g(e,["expireTime"]);return t!==void 0&&a!=null&&C(t,["expireTime"],a),o}function c4(e,t){const o={},r=g(t,["name"]);r!=null&&C(o,["_url","name"],Zo(e,r));const a=g(t,["config"]);return a!=null&&s4(a,o),o}function d4(e,t){const o={},r=g(t,["name"]);r!=null&&C(o,["_url","name"],Zo(e,r));const a=g(t,["config"]);return a!=null&&l4(a,o),o}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class u4 extends Xo{constructor(t){super(),this.apiClient=t,this.list=async(o={})=>new Kr(Jo.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(o),o)}async create(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=qk(this.apiClient,t);return l=xt("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>u)}else{const d=zk(this.apiClient,t);return l=xt("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>u)}}async get(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=Kk(this.apiClient,t);return l=xt("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>u)}else{const d=$k(this.apiClient,t);return l=xt("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>u)}}async delete(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=Fk(this.apiClient,t);return l=xt("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=Hk(u),m=new Eg;return Object.assign(m,p),m})}else{const d=Ok(this.apiClient,t);return l=xt("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=Bk(u),m=new Eg;return Object.assign(m,p),m})}}async update(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=d4(this.apiClient,t);return l=xt("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>u)}else{const d=c4(this.apiClient,t);return l=xt("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>u)}}async listInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=e4(t);return l=xt("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=n4(u),m=new Pg;return Object.assign(m,p),m})}else{const d=Qk(t);return l=xt("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=t4(u),m=new Pg;return Object.assign(m,p),m})}}}function El(e,t){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(o[r[a]]=e[r[a]]);return o}function Lg(e){var t=typeof Symbol=="function"&&Symbol.iterator,o=t&&e[t],r=0;if(o)return o.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function jt(e){return this instanceof jt?(this.v=e,this):new jt(e)}function wo(e,t,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=o.apply(e,t||[]),a,i=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",s),a[Symbol.asyncIterator]=function(){return this},a;function s(w){return function(k){return Promise.resolve(k).then(w,p)}}function l(w,k){r[w]&&(a[w]=function(b){return new Promise(function(x,f){i.push([w,b,x,f])>1||c(w,b)})},k&&(a[w]=k(a[w])))}function c(w,k){try{d(r[w](k))}catch(b){m(i[0][3],b)}}function d(w){w.value instanceof jt?Promise.resolve(w.value.v).then(u,p):m(i[0][2],w)}function u(w){c("next",w)}function p(w){c("throw",w)}function m(w,k){w(k),i.shift(),i.length&&c(i[0][0],i[0][1])}}function bo(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],o;return t?t.call(e):(e=typeof Lg=="function"?Lg(e):e[Symbol.iterator](),o={},r("next"),r("throw"),r("return"),o[Symbol.asyncIterator]=function(){return this},o);function r(i){o[i]=e[i]&&function(s){return new Promise(function(l,c){s=e[i](s),a(l,c,s.done,s.value)})}}function a(i,s,l,c){Promise.resolve(c).then(function(d){i({value:d,done:l})},s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function p4(e){var t;if(e.candidates==null||e.candidates.length===0)return!1;const o=(t=e.candidates[0])===null||t===void 0?void 0:t.content;return o===void 0?!1:_1(o)}function _1(e){if(e.parts===void 0||e.parts.length===0)return!1;for(const t of e.parts)if(t===void 0||Object.keys(t).length===0)return!1;return!0}function h4(e){if(e.length!==0){for(const t of e)if(t.role!=="user"&&t.role!=="model")throw new Error(`Role must be user or model, but got ${t.role}.`)}}function Dg(e){if(e===void 0||e.length===0)return[];const t=[],o=e.length;let r=0;for(;r<o;)if(e[r].role==="user")t.push(e[r]),r++;else{const a=[];let i=!0;for(;r<o&&e[r].role==="model";)a.push(e[r]),i&&!_1(e[r])&&(i=!1),r++;i?t.push(...a):t.pop()}return t}class m4{constructor(t,o){this.modelsModule=t,this.apiClient=o}create(t){return new g4(this.apiClient,this.modelsModule,t.model,t.config,structuredClone(t.history))}}class g4{constructor(t,o,r,a={},i=[]){this.apiClient=t,this.modelsModule=o,this.model=r,this.config=a,this.history=i,this.sendPromise=Promise.resolve(),h4(i)}async sendMessage(t){var o;await this.sendPromise;const r=Tn(t.message),a=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(o=t.config)!==null&&o!==void 0?o:this.config});return this.sendPromise=(async()=>{var i,s,l;const c=await a,d=(s=(i=c.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content,u=c.automaticFunctionCallingHistory,p=this.getHistory(!0).length;let m=[];u!=null&&(m=(l=u.slice(p))!==null&&l!==void 0?l:[]);const w=d?[d]:[];this.recordHistory(r,w,m)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),a}async sendMessageStream(t){var o;await this.sendPromise;const r=Tn(t.message),a=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(o=t.config)!==null&&o!==void 0?o:this.config});this.sendPromise=a.then(()=>{}).catch(()=>{});const i=await a;return this.processStreamResponse(i,r)}getHistory(t=!1){const o=t?Dg(this.history):this.history;return structuredClone(o)}processStreamResponse(t,o){return wo(this,arguments,function*(){var a,i,s,l,c,d;const u=[];try{for(var p=!0,m=bo(t),w;w=yield jt(m.next()),a=w.done,!a;p=!0){l=w.value,p=!1;const k=l;if(p4(k)){const b=(d=(c=k.candidates)===null||c===void 0?void 0:c[0])===null||d===void 0?void 0:d.content;b!==void 0&&u.push(b)}yield yield jt(k)}}catch(k){i={error:k}}finally{try{!p&&!a&&(s=m.return)&&(yield jt(s.call(m)))}finally{if(i)throw i.error}}this.recordHistory(o,u)})}recordHistory(t,o,r){let a=[];o.length>0&&o.every(i=>i.role!==void 0)?a=o:a.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...Dg(r)):this.history.push(t),this.history.push(...a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Fi extends Error{constructor(t){super(t.message),this.name="ApiError",this.status=t.status,Object.setPrototypeOf(this,Fi.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function f4(e){const t={},o=g(e,["file"]);return o!=null&&C(t,["file"],o),t}function x4(e){const t={},o=g(e,["sdkHttpResponse"]);return o!=null&&C(t,["sdkHttpResponse"],o),t}function y4(e){const t={},o=g(e,["name"]);return o!=null&&C(t,["_url","file"],x1(o)),t}function v4(e){const t={},o=g(e,["sdkHttpResponse"]);return o!=null&&C(t,["sdkHttpResponse"],o),t}function w4(e){const t={},o=g(e,["name"]);return o!=null&&C(t,["_url","file"],x1(o)),t}function b4(e,t){const o={},r=g(e,["pageSize"]);t!==void 0&&r!=null&&C(t,["_query","pageSize"],r);const a=g(e,["pageToken"]);return t!==void 0&&a!=null&&C(t,["_query","pageToken"],a),o}function C4(e){const t={},o=g(e,["config"]);return o!=null&&b4(o,t),t}function k4(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["nextPageToken"]);r!=null&&C(t,["nextPageToken"],r);const a=g(e,["files"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),C(t,["files"],i)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class _4 extends Xo{constructor(t){super(),this.apiClient=t,this.list=async(o={})=>new Kr(Jo.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(o),o)}async upload(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(t.file,t.config).then(o=>o)}async download(t){await this.apiClient.downloadFile(t)}async listInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=C4(t);return i=xt("files",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>{const d=k4(c),u=new P5;return Object.assign(u,d),u})}}async createInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=f4(t);return i=xt("upload/v1beta/files",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=x4(c),u=new j5;return Object.assign(u,d),u})}}async get(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=w4(t);return i=xt("files/{file}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async delete(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=y4(t);return i=xt("files/{file}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>{const d=v4(c),u=new I5;return Object.assign(u,d),u})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Js(e){const t={},o=g(e,["data"]);if(o!=null&&C(t,["data"],o),g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=g(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function S4(e){const t={},o=g(e,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(i=>B4(i))),C(t,["parts"],a)}const r=g(e,["role"]);return r!=null&&C(t,["role"],r),t}function N4(e){const t={};if(g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=g(e,["fileUri"]);o!=null&&C(t,["fileUri"],o);const r=g(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function E4(e){const t={},o=g(e,["id"]);o!=null&&C(t,["id"],o);const r=g(e,["args"]);r!=null&&C(t,["args"],r);const a=g(e,["name"]);if(a!=null&&C(t,["name"],a),g(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function P4(e){const t={},o=g(e,["description"]);o!=null&&C(t,["description"],o);const r=g(e,["name"]);r!=null&&C(t,["name"],r);const a=g(e,["parameters"]);a!=null&&C(t,["parameters"],a);const i=g(e,["parametersJsonSchema"]);i!=null&&C(t,["parametersJsonSchema"],i);const s=g(e,["response"]);s!=null&&C(t,["response"],s);const l=g(e,["responseJsonSchema"]);if(l!=null&&C(t,["responseJsonSchema"],l),g(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return t}function j4(e){const t={},o=g(e,["modelSelectionConfig"]);o!=null&&C(t,["modelConfig"],o);const r=g(e,["responseJsonSchema"]);r!=null&&C(t,["responseJsonSchema"],r);const a=g(e,["audioTimestamp"]);a!=null&&C(t,["audioTimestamp"],a);const i=g(e,["candidateCount"]);i!=null&&C(t,["candidateCount"],i);const s=g(e,["enableAffectiveDialog"]);s!=null&&C(t,["enableAffectiveDialog"],s);const l=g(e,["frequencyPenalty"]);l!=null&&C(t,["frequencyPenalty"],l);const c=g(e,["logprobs"]);c!=null&&C(t,["logprobs"],c);const d=g(e,["maxOutputTokens"]);d!=null&&C(t,["maxOutputTokens"],d);const u=g(e,["mediaResolution"]);u!=null&&C(t,["mediaResolution"],u);const p=g(e,["presencePenalty"]);p!=null&&C(t,["presencePenalty"],p);const m=g(e,["responseLogprobs"]);m!=null&&C(t,["responseLogprobs"],m);const w=g(e,["responseMimeType"]);w!=null&&C(t,["responseMimeType"],w);const k=g(e,["responseModalities"]);k!=null&&C(t,["responseModalities"],k);const b=g(e,["responseSchema"]);b!=null&&C(t,["responseSchema"],b);const x=g(e,["routingConfig"]);x!=null&&C(t,["routingConfig"],x);const f=g(e,["seed"]);f!=null&&C(t,["seed"],f);const h=g(e,["speechConfig"]);h!=null&&C(t,["speechConfig"],h);const v=g(e,["stopSequences"]);v!=null&&C(t,["stopSequences"],v);const N=g(e,["temperature"]);N!=null&&C(t,["temperature"],N);const _=g(e,["thinkingConfig"]);_!=null&&C(t,["thinkingConfig"],_);const E=g(e,["topK"]);E!=null&&C(t,["topK"],E);const I=g(e,["topP"]);if(I!=null&&C(t,["topP"],I),g(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function I4(e){const t={};if(g(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const o=g(e,["enableWidget"]);return o!=null&&C(t,["enableWidget"],o),t}function T4(e){const t={};if(g(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const o=g(e,["timeRangeFilter"]);return o!=null&&C(t,["timeRangeFilter"],o),t}function A4(e,t){const o={},r=g(e,["generationConfig"]);t!==void 0&&r!=null&&C(t,["setup","generationConfig"],r);const a=g(e,["responseModalities"]);t!==void 0&&a!=null&&C(t,["setup","generationConfig","responseModalities"],a);const i=g(e,["temperature"]);t!==void 0&&i!=null&&C(t,["setup","generationConfig","temperature"],i);const s=g(e,["topP"]);t!==void 0&&s!=null&&C(t,["setup","generationConfig","topP"],s);const l=g(e,["topK"]);t!==void 0&&l!=null&&C(t,["setup","generationConfig","topK"],l);const c=g(e,["maxOutputTokens"]);t!==void 0&&c!=null&&C(t,["setup","generationConfig","maxOutputTokens"],c);const d=g(e,["mediaResolution"]);t!==void 0&&d!=null&&C(t,["setup","generationConfig","mediaResolution"],d);const u=g(e,["seed"]);t!==void 0&&u!=null&&C(t,["setup","generationConfig","seed"],u);const p=g(e,["speechConfig"]);t!==void 0&&p!=null&&C(t,["setup","generationConfig","speechConfig"],Up(p));const m=g(e,["thinkingConfig"]);t!==void 0&&m!=null&&C(t,["setup","generationConfig","thinkingConfig"],m);const w=g(e,["enableAffectiveDialog"]);t!==void 0&&w!=null&&C(t,["setup","generationConfig","enableAffectiveDialog"],w);const k=g(e,["systemInstruction"]);t!==void 0&&k!=null&&C(t,["setup","systemInstruction"],S4(Tn(k)));const b=g(e,["tools"]);if(t!==void 0&&b!=null){let E=Ka(b);Array.isArray(E)&&(E=E.map(I=>G4($a(I)))),C(t,["setup","tools"],E)}const x=g(e,["sessionResumption"]);t!==void 0&&x!=null&&C(t,["setup","sessionResumption"],H4(x));const f=g(e,["inputAudioTranscription"]);t!==void 0&&f!=null&&C(t,["setup","inputAudioTranscription"],f);const h=g(e,["outputAudioTranscription"]);t!==void 0&&h!=null&&C(t,["setup","outputAudioTranscription"],h);const v=g(e,["realtimeInputConfig"]);t!==void 0&&v!=null&&C(t,["setup","realtimeInputConfig"],v);const N=g(e,["contextWindowCompression"]);t!==void 0&&N!=null&&C(t,["setup","contextWindowCompression"],N);const _=g(e,["proactivity"]);if(t!==void 0&&_!=null&&C(t,["setup","proactivity"],_),g(e,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return o}function R4(e,t){const o={},r=g(e,["generationConfig"]);t!==void 0&&r!=null&&C(t,["setup","generationConfig"],j4(r));const a=g(e,["responseModalities"]);t!==void 0&&a!=null&&C(t,["setup","generationConfig","responseModalities"],a);const i=g(e,["temperature"]);t!==void 0&&i!=null&&C(t,["setup","generationConfig","temperature"],i);const s=g(e,["topP"]);t!==void 0&&s!=null&&C(t,["setup","generationConfig","topP"],s);const l=g(e,["topK"]);t!==void 0&&l!=null&&C(t,["setup","generationConfig","topK"],l);const c=g(e,["maxOutputTokens"]);t!==void 0&&c!=null&&C(t,["setup","generationConfig","maxOutputTokens"],c);const d=g(e,["mediaResolution"]);t!==void 0&&d!=null&&C(t,["setup","generationConfig","mediaResolution"],d);const u=g(e,["seed"]);t!==void 0&&u!=null&&C(t,["setup","generationConfig","seed"],u);const p=g(e,["speechConfig"]);t!==void 0&&p!=null&&C(t,["setup","generationConfig","speechConfig"],Up(p));const m=g(e,["thinkingConfig"]);t!==void 0&&m!=null&&C(t,["setup","generationConfig","thinkingConfig"],m);const w=g(e,["enableAffectiveDialog"]);t!==void 0&&w!=null&&C(t,["setup","generationConfig","enableAffectiveDialog"],w);const k=g(e,["systemInstruction"]);t!==void 0&&k!=null&&C(t,["setup","systemInstruction"],Tn(k));const b=g(e,["tools"]);if(t!==void 0&&b!=null){let I=Ka(b);Array.isArray(I)&&(I=I.map(B=>U4($a(B)))),C(t,["setup","tools"],I)}const x=g(e,["sessionResumption"]);t!==void 0&&x!=null&&C(t,["setup","sessionResumption"],x);const f=g(e,["inputAudioTranscription"]);t!==void 0&&f!=null&&C(t,["setup","inputAudioTranscription"],f);const h=g(e,["outputAudioTranscription"]);t!==void 0&&h!=null&&C(t,["setup","outputAudioTranscription"],h);const v=g(e,["realtimeInputConfig"]);t!==void 0&&v!=null&&C(t,["setup","realtimeInputConfig"],v);const N=g(e,["contextWindowCompression"]);t!==void 0&&N!=null&&C(t,["setup","contextWindowCompression"],N);const _=g(e,["proactivity"]);t!==void 0&&_!=null&&C(t,["setup","proactivity"],_);const E=g(e,["explicitVadSignal"]);return t!==void 0&&E!=null&&C(t,["setup","explicitVadSignal"],E),o}function M4(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["setup","model"],Bt(e,r));const a=g(t,["config"]);return a!=null&&C(o,["config"],A4(a,o)),o}function L4(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["setup","model"],Bt(e,r));const a=g(t,["config"]);return a!=null&&C(o,["config"],R4(a,o)),o}function D4(e){const t={},o=g(e,["musicGenerationConfig"]);return o!=null&&C(t,["musicGenerationConfig"],o),t}function z4(e){const t={},o=g(e,["weightedPrompts"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>a)),C(t,["weightedPrompts"],r)}return t}function q4(e){const t={},o=g(e,["media"]);if(o!=null){let d=p1(o);Array.isArray(d)&&(d=d.map(u=>Js(u))),C(t,["mediaChunks"],d)}const r=g(e,["audio"]);r!=null&&C(t,["audio"],Js(m1(r)));const a=g(e,["audioStreamEnd"]);a!=null&&C(t,["audioStreamEnd"],a);const i=g(e,["video"]);i!=null&&C(t,["video"],Js(h1(i)));const s=g(e,["text"]);s!=null&&C(t,["text"],s);const l=g(e,["activityStart"]);l!=null&&C(t,["activityStart"],l);const c=g(e,["activityEnd"]);return c!=null&&C(t,["activityEnd"],c),t}function O4(e){const t={},o=g(e,["media"]);if(o!=null){let d=p1(o);Array.isArray(d)&&(d=d.map(u=>u)),C(t,["mediaChunks"],d)}const r=g(e,["audio"]);r!=null&&C(t,["audio"],m1(r));const a=g(e,["audioStreamEnd"]);a!=null&&C(t,["audioStreamEnd"],a);const i=g(e,["video"]);i!=null&&C(t,["video"],h1(i));const s=g(e,["text"]);s!=null&&C(t,["text"],s);const l=g(e,["activityStart"]);l!=null&&C(t,["activityStart"],l);const c=g(e,["activityEnd"]);return c!=null&&C(t,["activityEnd"],c),t}function F4(e){const t={},o=g(e,["setupComplete"]);o!=null&&C(t,["setupComplete"],o);const r=g(e,["serverContent"]);r!=null&&C(t,["serverContent"],r);const a=g(e,["toolCall"]);a!=null&&C(t,["toolCall"],a);const i=g(e,["toolCallCancellation"]);i!=null&&C(t,["toolCallCancellation"],i);const s=g(e,["usageMetadata"]);s!=null&&C(t,["usageMetadata"],V4(s));const l=g(e,["goAway"]);l!=null&&C(t,["goAway"],l);const c=g(e,["sessionResumptionUpdate"]);c!=null&&C(t,["sessionResumptionUpdate"],c);const d=g(e,["voiceActivityDetectionSignal"]);d!=null&&C(t,["voiceActivityDetectionSignal"],d);const u=g(e,["voiceActivity"]);return u!=null&&C(t,["voiceActivity"],W4(u)),t}function B4(e){const t={},o=g(e,["mediaResolution"]);o!=null&&C(t,["mediaResolution"],o);const r=g(e,["codeExecutionResult"]);r!=null&&C(t,["codeExecutionResult"],r);const a=g(e,["executableCode"]);a!=null&&C(t,["executableCode"],a);const i=g(e,["fileData"]);i!=null&&C(t,["fileData"],N4(i));const s=g(e,["functionCall"]);s!=null&&C(t,["functionCall"],E4(s));const l=g(e,["functionResponse"]);l!=null&&C(t,["functionResponse"],l);const c=g(e,["inlineData"]);c!=null&&C(t,["inlineData"],Js(c));const d=g(e,["text"]);d!=null&&C(t,["text"],d);const u=g(e,["thought"]);u!=null&&C(t,["thought"],u);const p=g(e,["thoughtSignature"]);p!=null&&C(t,["thoughtSignature"],p);const m=g(e,["videoMetadata"]);return m!=null&&C(t,["videoMetadata"],m),t}function H4(e){const t={},o=g(e,["handle"]);if(o!=null&&C(t,["handle"],o),g(e,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function G4(e){const t={};if(g(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const o=g(e,["computerUse"]);o!=null&&C(t,["computerUse"],o);const r=g(e,["fileSearch"]);r!=null&&C(t,["fileSearch"],r);const a=g(e,["codeExecution"]);if(a!=null&&C(t,["codeExecution"],a),g(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const i=g(e,["functionDeclarations"]);if(i!=null){let u=i;Array.isArray(u)&&(u=u.map(p=>p)),C(t,["functionDeclarations"],u)}const s=g(e,["googleMaps"]);s!=null&&C(t,["googleMaps"],I4(s));const l=g(e,["googleSearch"]);l!=null&&C(t,["googleSearch"],T4(l));const c=g(e,["googleSearchRetrieval"]);c!=null&&C(t,["googleSearchRetrieval"],c);const d=g(e,["urlContext"]);return d!=null&&C(t,["urlContext"],d),t}function U4(e){const t={},o=g(e,["retrieval"]);o!=null&&C(t,["retrieval"],o);const r=g(e,["computerUse"]);if(r!=null&&C(t,["computerUse"],r),g(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const a=g(e,["codeExecution"]);a!=null&&C(t,["codeExecution"],a);const i=g(e,["enterpriseWebSearch"]);i!=null&&C(t,["enterpriseWebSearch"],i);const s=g(e,["functionDeclarations"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(m=>P4(m))),C(t,["functionDeclarations"],p)}const l=g(e,["googleMaps"]);l!=null&&C(t,["googleMaps"],l);const c=g(e,["googleSearch"]);c!=null&&C(t,["googleSearch"],c);const d=g(e,["googleSearchRetrieval"]);d!=null&&C(t,["googleSearchRetrieval"],d);const u=g(e,["urlContext"]);return u!=null&&C(t,["urlContext"],u),t}function V4(e){const t={},o=g(e,["promptTokenCount"]);o!=null&&C(t,["promptTokenCount"],o);const r=g(e,["cachedContentTokenCount"]);r!=null&&C(t,["cachedContentTokenCount"],r);const a=g(e,["candidatesTokenCount"]);a!=null&&C(t,["responseTokenCount"],a);const i=g(e,["toolUsePromptTokenCount"]);i!=null&&C(t,["toolUsePromptTokenCount"],i);const s=g(e,["thoughtsTokenCount"]);s!=null&&C(t,["thoughtsTokenCount"],s);const l=g(e,["totalTokenCount"]);l!=null&&C(t,["totalTokenCount"],l);const c=g(e,["promptTokensDetails"]);if(c!=null){let w=c;Array.isArray(w)&&(w=w.map(k=>k)),C(t,["promptTokensDetails"],w)}const d=g(e,["cacheTokensDetails"]);if(d!=null){let w=d;Array.isArray(w)&&(w=w.map(k=>k)),C(t,["cacheTokensDetails"],w)}const u=g(e,["candidatesTokensDetails"]);if(u!=null){let w=u;Array.isArray(w)&&(w=w.map(k=>k)),C(t,["responseTokensDetails"],w)}const p=g(e,["toolUsePromptTokensDetails"]);if(p!=null){let w=p;Array.isArray(w)&&(w=w.map(k=>k)),C(t,["toolUsePromptTokensDetails"],w)}const m=g(e,["trafficType"]);return m!=null&&C(t,["trafficType"],m),t}function W4(e){const t={},o=g(e,["type"]);return o!=null&&C(t,["voiceActivityType"],o),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function $4(e){const t={},o=g(e,["data"]);if(o!=null&&C(t,["data"],o),g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=g(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function K4(e){const t={},o=g(e,["content"]);o!=null&&C(t,["content"],o);const r=g(e,["citationMetadata"]);r!=null&&C(t,["citationMetadata"],J4(r));const a=g(e,["tokenCount"]);a!=null&&C(t,["tokenCount"],a);const i=g(e,["finishReason"]);i!=null&&C(t,["finishReason"],i);const s=g(e,["avgLogprobs"]);s!=null&&C(t,["avgLogprobs"],s);const l=g(e,["groundingMetadata"]);l!=null&&C(t,["groundingMetadata"],l);const c=g(e,["index"]);c!=null&&C(t,["index"],c);const d=g(e,["logprobsResult"]);d!=null&&C(t,["logprobsResult"],d);const u=g(e,["safetyRatings"]);if(u!=null){let m=u;Array.isArray(m)&&(m=m.map(w=>w)),C(t,["safetyRatings"],m)}const p=g(e,["urlContextMetadata"]);return p!=null&&C(t,["urlContextMetadata"],p),t}function J4(e){const t={},o=g(e,["citationSources"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>a)),C(t,["citations"],r)}return t}function Y4(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["_url","model"],Bt(e,r));const a=g(t,["contents"]);if(a!=null){let i=so(a);Array.isArray(i)&&(i=i.map(s=>s)),C(o,["contents"],i)}return o}function X4(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["tokensInfo"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>i)),C(t,["tokensInfo"],a)}return t}function Z4(e){const t={},o=g(e,["values"]);o!=null&&C(t,["values"],o);const r=g(e,["statistics"]);return r!=null&&C(t,["statistics"],Q4(r)),t}function Q4(e){const t={},o=g(e,["truncated"]);o!=null&&C(t,["truncated"],o);const r=g(e,["token_count"]);return r!=null&&C(t,["tokenCount"],r),t}function Xl(e){const t={},o=g(e,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(i=>lS(i))),C(t,["parts"],a)}const r=g(e,["role"]);return r!=null&&C(t,["role"],r),t}function e_(e){const t={},o=g(e,["controlType"]);o!=null&&C(t,["controlType"],o);const r=g(e,["enableControlImageComputation"]);return r!=null&&C(t,["computeControl"],r),t}function t_(e){const t={};if(g(e,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(g(e,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(g(e,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return t}function n_(e,t){const o={},r=g(e,["systemInstruction"]);t!==void 0&&r!=null&&C(t,["systemInstruction"],Tn(r));const a=g(e,["tools"]);if(t!==void 0&&a!=null){let s=a;Array.isArray(s)&&(s=s.map(l=>P1(l))),C(t,["tools"],s)}const i=g(e,["generationConfig"]);return t!==void 0&&i!=null&&C(t,["generationConfig"],$_(i)),o}function o_(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["_url","model"],Bt(e,r));const a=g(t,["contents"]);if(a!=null){let s=so(a);Array.isArray(s)&&(s=s.map(l=>Xl(l))),C(o,["contents"],s)}const i=g(t,["config"]);return i!=null&&t_(i),o}function r_(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["_url","model"],Bt(e,r));const a=g(t,["contents"]);if(a!=null){let s=so(a);Array.isArray(s)&&(s=s.map(l=>l)),C(o,["contents"],s)}const i=g(t,["config"]);return i!=null&&n_(i,o),o}function a_(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["totalTokens"]);r!=null&&C(t,["totalTokens"],r);const a=g(e,["cachedContentTokenCount"]);return a!=null&&C(t,["cachedContentTokenCount"],a),t}function i_(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["totalTokens"]);return r!=null&&C(t,["totalTokens"],r),t}function s_(e,t){const o={},r=g(t,["model"]);return r!=null&&C(o,["_url","name"],Bt(e,r)),o}function l_(e,t){const o={},r=g(t,["model"]);return r!=null&&C(o,["_url","name"],Bt(e,r)),o}function c_(e){const t={},o=g(e,["sdkHttpResponse"]);return o!=null&&C(t,["sdkHttpResponse"],o),t}function d_(e){const t={},o=g(e,["sdkHttpResponse"]);return o!=null&&C(t,["sdkHttpResponse"],o),t}function u_(e,t){const o={},r=g(e,["outputGcsUri"]);t!==void 0&&r!=null&&C(t,["parameters","storageUri"],r);const a=g(e,["negativePrompt"]);t!==void 0&&a!=null&&C(t,["parameters","negativePrompt"],a);const i=g(e,["numberOfImages"]);t!==void 0&&i!=null&&C(t,["parameters","sampleCount"],i);const s=g(e,["aspectRatio"]);t!==void 0&&s!=null&&C(t,["parameters","aspectRatio"],s);const l=g(e,["guidanceScale"]);t!==void 0&&l!=null&&C(t,["parameters","guidanceScale"],l);const c=g(e,["seed"]);t!==void 0&&c!=null&&C(t,["parameters","seed"],c);const d=g(e,["safetyFilterLevel"]);t!==void 0&&d!=null&&C(t,["parameters","safetySetting"],d);const u=g(e,["personGeneration"]);t!==void 0&&u!=null&&C(t,["parameters","personGeneration"],u);const p=g(e,["includeSafetyAttributes"]);t!==void 0&&p!=null&&C(t,["parameters","includeSafetyAttributes"],p);const m=g(e,["includeRaiReason"]);t!==void 0&&m!=null&&C(t,["parameters","includeRaiReason"],m);const w=g(e,["language"]);t!==void 0&&w!=null&&C(t,["parameters","language"],w);const k=g(e,["outputMimeType"]);t!==void 0&&k!=null&&C(t,["parameters","outputOptions","mimeType"],k);const b=g(e,["outputCompressionQuality"]);t!==void 0&&b!=null&&C(t,["parameters","outputOptions","compressionQuality"],b);const x=g(e,["addWatermark"]);t!==void 0&&x!=null&&C(t,["parameters","addWatermark"],x);const f=g(e,["labels"]);t!==void 0&&f!=null&&C(t,["labels"],f);const h=g(e,["editMode"]);t!==void 0&&h!=null&&C(t,["parameters","editMode"],h);const v=g(e,["baseSteps"]);return t!==void 0&&v!=null&&C(t,["parameters","editConfig","baseSteps"],v),o}function p_(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["_url","model"],Bt(e,r));const a=g(t,["prompt"]);a!=null&&C(o,["instances[0]","prompt"],a);const i=g(t,["referenceImages"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>mS(c))),C(o,["instances[0]","referenceImages"],l)}const s=g(t,["config"]);return s!=null&&u_(s,o),o}function h_(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>Zl(i))),C(t,["generatedImages"],a)}return t}function m_(e,t){const o={},r=g(e,["taskType"]);t!==void 0&&r!=null&&C(t,["requests[]","taskType"],r);const a=g(e,["title"]);t!==void 0&&a!=null&&C(t,["requests[]","title"],a);const i=g(e,["outputDimensionality"]);if(t!==void 0&&i!=null&&C(t,["requests[]","outputDimensionality"],i),g(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(g(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return o}function g_(e,t){const o={},r=g(e,["taskType"]);t!==void 0&&r!=null&&C(t,["instances[]","task_type"],r);const a=g(e,["title"]);t!==void 0&&a!=null&&C(t,["instances[]","title"],a);const i=g(e,["outputDimensionality"]);t!==void 0&&i!=null&&C(t,["parameters","outputDimensionality"],i);const s=g(e,["mimeType"]);t!==void 0&&s!=null&&C(t,["instances[]","mimeType"],s);const l=g(e,["autoTruncate"]);return t!==void 0&&l!=null&&C(t,["parameters","autoTruncate"],l),o}function f_(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["_url","model"],Bt(e,r));const a=g(t,["contents"]);if(a!=null){let l=Bp(e,a);Array.isArray(l)&&(l=l.map(c=>c)),C(o,["requests[]","content"],l)}const i=g(t,["config"]);i!=null&&m_(i,o);const s=g(t,["model"]);return s!==void 0&&C(o,["requests[]","model"],Bt(e,s)),o}function x_(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["_url","model"],Bt(e,r));const a=g(t,["contents"]);if(a!=null){let s=Bp(e,a);Array.isArray(s)&&(s=s.map(l=>l)),C(o,["instances[]","content"],s)}const i=g(t,["config"]);return i!=null&&g_(i,o),o}function y_(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["embeddings"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),C(t,["embeddings"],i)}const a=g(e,["metadata"]);return a!=null&&C(t,["metadata"],a),t}function v_(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["predictions[]","embeddings"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>Z4(s))),C(t,["embeddings"],i)}const a=g(e,["metadata"]);return a!=null&&C(t,["metadata"],a),t}function w_(e){const t={},o=g(e,["endpoint"]);o!=null&&C(t,["name"],o);const r=g(e,["deployedModelId"]);return r!=null&&C(t,["deployedModelId"],r),t}function b_(e){const t={};if(g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=g(e,["fileUri"]);o!=null&&C(t,["fileUri"],o);const r=g(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function C_(e){const t={},o=g(e,["id"]);o!=null&&C(t,["id"],o);const r=g(e,["args"]);r!=null&&C(t,["args"],r);const a=g(e,["name"]);if(a!=null&&C(t,["name"],a),g(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function k_(e){const t={},o=g(e,["allowedFunctionNames"]);o!=null&&C(t,["allowedFunctionNames"],o);const r=g(e,["mode"]);if(r!=null&&C(t,["mode"],r),g(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function __(e){const t={},o=g(e,["description"]);o!=null&&C(t,["description"],o);const r=g(e,["name"]);r!=null&&C(t,["name"],r);const a=g(e,["parameters"]);a!=null&&C(t,["parameters"],a);const i=g(e,["parametersJsonSchema"]);i!=null&&C(t,["parametersJsonSchema"],i);const s=g(e,["response"]);s!=null&&C(t,["response"],s);const l=g(e,["responseJsonSchema"]);if(l!=null&&C(t,["responseJsonSchema"],l),g(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return t}function S_(e,t,o){const r={},a=g(t,["systemInstruction"]);o!==void 0&&a!=null&&C(o,["systemInstruction"],Xl(Tn(a)));const i=g(t,["temperature"]);i!=null&&C(r,["temperature"],i);const s=g(t,["topP"]);s!=null&&C(r,["topP"],s);const l=g(t,["topK"]);l!=null&&C(r,["topK"],l);const c=g(t,["candidateCount"]);c!=null&&C(r,["candidateCount"],c);const d=g(t,["maxOutputTokens"]);d!=null&&C(r,["maxOutputTokens"],d);const u=g(t,["stopSequences"]);u!=null&&C(r,["stopSequences"],u);const p=g(t,["responseLogprobs"]);p!=null&&C(r,["responseLogprobs"],p);const m=g(t,["logprobs"]);m!=null&&C(r,["logprobs"],m);const w=g(t,["presencePenalty"]);w!=null&&C(r,["presencePenalty"],w);const k=g(t,["frequencyPenalty"]);k!=null&&C(r,["frequencyPenalty"],k);const b=g(t,["seed"]);b!=null&&C(r,["seed"],b);const x=g(t,["responseMimeType"]);x!=null&&C(r,["responseMimeType"],x);const f=g(t,["responseSchema"]);f!=null&&C(r,["responseSchema"],Hp(f));const h=g(t,["responseJsonSchema"]);if(h!=null&&C(r,["responseJsonSchema"],h),g(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(g(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const v=g(t,["safetySettings"]);if(o!==void 0&&v!=null){let P=v;Array.isArray(P)&&(P=P.map(S=>gS(S))),C(o,["safetySettings"],P)}const N=g(t,["tools"]);if(o!==void 0&&N!=null){let P=Ka(N);Array.isArray(P)&&(P=P.map(S=>CS($a(S)))),C(o,["tools"],P)}const _=g(t,["toolConfig"]);if(o!==void 0&&_!=null&&C(o,["toolConfig"],bS(_)),g(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const E=g(t,["cachedContent"]);o!==void 0&&E!=null&&C(o,["cachedContent"],Zo(e,E));const I=g(t,["responseModalities"]);I!=null&&C(r,["responseModalities"],I);const B=g(t,["mediaResolution"]);B!=null&&C(r,["mediaResolution"],B);const M=g(t,["speechConfig"]);if(M!=null&&C(r,["speechConfig"],Gp(M)),g(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const G=g(t,["thinkingConfig"]);G!=null&&C(r,["thinkingConfig"],G);const V=g(t,["imageConfig"]);V!=null&&C(r,["imageConfig"],Z_(V));const j=g(t,["enableEnhancedCivicAnswers"]);if(j!=null&&C(r,["enableEnhancedCivicAnswers"],j),g(t,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return r}function N_(e,t,o){const r={},a=g(t,["systemInstruction"]);o!==void 0&&a!=null&&C(o,["systemInstruction"],Tn(a));const i=g(t,["temperature"]);i!=null&&C(r,["temperature"],i);const s=g(t,["topP"]);s!=null&&C(r,["topP"],s);const l=g(t,["topK"]);l!=null&&C(r,["topK"],l);const c=g(t,["candidateCount"]);c!=null&&C(r,["candidateCount"],c);const d=g(t,["maxOutputTokens"]);d!=null&&C(r,["maxOutputTokens"],d);const u=g(t,["stopSequences"]);u!=null&&C(r,["stopSequences"],u);const p=g(t,["responseLogprobs"]);p!=null&&C(r,["responseLogprobs"],p);const m=g(t,["logprobs"]);m!=null&&C(r,["logprobs"],m);const w=g(t,["presencePenalty"]);w!=null&&C(r,["presencePenalty"],w);const k=g(t,["frequencyPenalty"]);k!=null&&C(r,["frequencyPenalty"],k);const b=g(t,["seed"]);b!=null&&C(r,["seed"],b);const x=g(t,["responseMimeType"]);x!=null&&C(r,["responseMimeType"],x);const f=g(t,["responseSchema"]);f!=null&&C(r,["responseSchema"],Hp(f));const h=g(t,["responseJsonSchema"]);h!=null&&C(r,["responseJsonSchema"],h);const v=g(t,["routingConfig"]);v!=null&&C(r,["routingConfig"],v);const N=g(t,["modelSelectionConfig"]);N!=null&&C(r,["modelConfig"],N);const _=g(t,["safetySettings"]);if(o!==void 0&&_!=null){let z=_;Array.isArray(z)&&(z=z.map(L=>L)),C(o,["safetySettings"],z)}const E=g(t,["tools"]);if(o!==void 0&&E!=null){let z=Ka(E);Array.isArray(z)&&(z=z.map(L=>P1($a(L)))),C(o,["tools"],z)}const I=g(t,["toolConfig"]);o!==void 0&&I!=null&&C(o,["toolConfig"],I);const B=g(t,["labels"]);o!==void 0&&B!=null&&C(o,["labels"],B);const M=g(t,["cachedContent"]);o!==void 0&&M!=null&&C(o,["cachedContent"],Zo(e,M));const G=g(t,["responseModalities"]);G!=null&&C(r,["responseModalities"],G);const V=g(t,["mediaResolution"]);V!=null&&C(r,["mediaResolution"],V);const j=g(t,["speechConfig"]);j!=null&&C(r,["speechConfig"],Gp(j));const P=g(t,["audioTimestamp"]);P!=null&&C(r,["audioTimestamp"],P);const S=g(t,["thinkingConfig"]);S!=null&&C(r,["thinkingConfig"],S);const A=g(t,["imageConfig"]);if(A!=null&&C(r,["imageConfig"],Q_(A)),g(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");const O=g(t,["modelArmorConfig"]);return o!==void 0&&O!=null&&C(o,["modelArmorConfig"],O),r}function zg(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["_url","model"],Bt(e,r));const a=g(t,["contents"]);if(a!=null){let s=so(a);Array.isArray(s)&&(s=s.map(l=>Xl(l))),C(o,["contents"],s)}const i=g(t,["config"]);return i!=null&&C(o,["generationConfig"],S_(e,i,o)),o}function qg(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["_url","model"],Bt(e,r));const a=g(t,["contents"]);if(a!=null){let s=so(a);Array.isArray(s)&&(s=s.map(l=>l)),C(o,["contents"],s)}const i=g(t,["config"]);return i!=null&&C(o,["generationConfig"],N_(e,i,o)),o}function Og(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["candidates"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(d=>K4(d))),C(t,["candidates"],c)}const a=g(e,["modelVersion"]);a!=null&&C(t,["modelVersion"],a);const i=g(e,["promptFeedback"]);i!=null&&C(t,["promptFeedback"],i);const s=g(e,["responseId"]);s!=null&&C(t,["responseId"],s);const l=g(e,["usageMetadata"]);return l!=null&&C(t,["usageMetadata"],l),t}function Fg(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["candidates"]);if(r!=null){let d=r;Array.isArray(d)&&(d=d.map(u=>u)),C(t,["candidates"],d)}const a=g(e,["createTime"]);a!=null&&C(t,["createTime"],a);const i=g(e,["modelVersion"]);i!=null&&C(t,["modelVersion"],i);const s=g(e,["promptFeedback"]);s!=null&&C(t,["promptFeedback"],s);const l=g(e,["responseId"]);l!=null&&C(t,["responseId"],l);const c=g(e,["usageMetadata"]);return c!=null&&C(t,["usageMetadata"],c),t}function E_(e,t){const o={};if(g(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(g(e,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const r=g(e,["numberOfImages"]);t!==void 0&&r!=null&&C(t,["parameters","sampleCount"],r);const a=g(e,["aspectRatio"]);t!==void 0&&a!=null&&C(t,["parameters","aspectRatio"],a);const i=g(e,["guidanceScale"]);if(t!==void 0&&i!=null&&C(t,["parameters","guidanceScale"],i),g(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const s=g(e,["safetyFilterLevel"]);t!==void 0&&s!=null&&C(t,["parameters","safetySetting"],s);const l=g(e,["personGeneration"]);t!==void 0&&l!=null&&C(t,["parameters","personGeneration"],l);const c=g(e,["includeSafetyAttributes"]);t!==void 0&&c!=null&&C(t,["parameters","includeSafetyAttributes"],c);const d=g(e,["includeRaiReason"]);t!==void 0&&d!=null&&C(t,["parameters","includeRaiReason"],d);const u=g(e,["language"]);t!==void 0&&u!=null&&C(t,["parameters","language"],u);const p=g(e,["outputMimeType"]);t!==void 0&&p!=null&&C(t,["parameters","outputOptions","mimeType"],p);const m=g(e,["outputCompressionQuality"]);if(t!==void 0&&m!=null&&C(t,["parameters","outputOptions","compressionQuality"],m),g(e,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(g(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const w=g(e,["imageSize"]);if(t!==void 0&&w!=null&&C(t,["parameters","sampleImageSize"],w),g(e,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return o}function P_(e,t){const o={},r=g(e,["outputGcsUri"]);t!==void 0&&r!=null&&C(t,["parameters","storageUri"],r);const a=g(e,["negativePrompt"]);t!==void 0&&a!=null&&C(t,["parameters","negativePrompt"],a);const i=g(e,["numberOfImages"]);t!==void 0&&i!=null&&C(t,["parameters","sampleCount"],i);const s=g(e,["aspectRatio"]);t!==void 0&&s!=null&&C(t,["parameters","aspectRatio"],s);const l=g(e,["guidanceScale"]);t!==void 0&&l!=null&&C(t,["parameters","guidanceScale"],l);const c=g(e,["seed"]);t!==void 0&&c!=null&&C(t,["parameters","seed"],c);const d=g(e,["safetyFilterLevel"]);t!==void 0&&d!=null&&C(t,["parameters","safetySetting"],d);const u=g(e,["personGeneration"]);t!==void 0&&u!=null&&C(t,["parameters","personGeneration"],u);const p=g(e,["includeSafetyAttributes"]);t!==void 0&&p!=null&&C(t,["parameters","includeSafetyAttributes"],p);const m=g(e,["includeRaiReason"]);t!==void 0&&m!=null&&C(t,["parameters","includeRaiReason"],m);const w=g(e,["language"]);t!==void 0&&w!=null&&C(t,["parameters","language"],w);const k=g(e,["outputMimeType"]);t!==void 0&&k!=null&&C(t,["parameters","outputOptions","mimeType"],k);const b=g(e,["outputCompressionQuality"]);t!==void 0&&b!=null&&C(t,["parameters","outputOptions","compressionQuality"],b);const x=g(e,["addWatermark"]);t!==void 0&&x!=null&&C(t,["parameters","addWatermark"],x);const f=g(e,["labels"]);t!==void 0&&f!=null&&C(t,["labels"],f);const h=g(e,["imageSize"]);t!==void 0&&h!=null&&C(t,["parameters","sampleImageSize"],h);const v=g(e,["enhancePrompt"]);return t!==void 0&&v!=null&&C(t,["parameters","enhancePrompt"],v),o}function j_(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["_url","model"],Bt(e,r));const a=g(t,["prompt"]);a!=null&&C(o,["instances[0]","prompt"],a);const i=g(t,["config"]);return i!=null&&E_(i,o),o}function I_(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["_url","model"],Bt(e,r));const a=g(t,["prompt"]);a!=null&&C(o,["instances[0]","prompt"],a);const i=g(t,["config"]);return i!=null&&P_(i,o),o}function T_(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>G_(s))),C(t,["generatedImages"],i)}const a=g(e,["positivePromptSafetyAttributes"]);return a!=null&&C(t,["positivePromptSafetyAttributes"],N1(a)),t}function A_(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>Zl(s))),C(t,["generatedImages"],i)}const a=g(e,["positivePromptSafetyAttributes"]);return a!=null&&C(t,["positivePromptSafetyAttributes"],E1(a)),t}function R_(e,t){const o={},r=g(e,["numberOfVideos"]);if(t!==void 0&&r!=null&&C(t,["parameters","sampleCount"],r),g(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(g(e,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const a=g(e,["durationSeconds"]);if(t!==void 0&&a!=null&&C(t,["parameters","durationSeconds"],a),g(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const i=g(e,["aspectRatio"]);t!==void 0&&i!=null&&C(t,["parameters","aspectRatio"],i);const s=g(e,["resolution"]);t!==void 0&&s!=null&&C(t,["parameters","resolution"],s);const l=g(e,["personGeneration"]);if(t!==void 0&&l!=null&&C(t,["parameters","personGeneration"],l),g(e,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const c=g(e,["negativePrompt"]);t!==void 0&&c!=null&&C(t,["parameters","negativePrompt"],c);const d=g(e,["enhancePrompt"]);if(t!==void 0&&d!=null&&C(t,["parameters","enhancePrompt"],d),g(e,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const u=g(e,["lastFrame"]);t!==void 0&&u!=null&&C(t,["instances[0]","lastFrame"],Ql(u));const p=g(e,["referenceImages"]);if(t!==void 0&&p!=null){let m=p;Array.isArray(m)&&(m=m.map(w=>LS(w))),C(t,["instances[0]","referenceImages"],m)}if(g(e,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(g(e,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return o}function M_(e,t){const o={},r=g(e,["numberOfVideos"]);t!==void 0&&r!=null&&C(t,["parameters","sampleCount"],r);const a=g(e,["outputGcsUri"]);t!==void 0&&a!=null&&C(t,["parameters","storageUri"],a);const i=g(e,["fps"]);t!==void 0&&i!=null&&C(t,["parameters","fps"],i);const s=g(e,["durationSeconds"]);t!==void 0&&s!=null&&C(t,["parameters","durationSeconds"],s);const l=g(e,["seed"]);t!==void 0&&l!=null&&C(t,["parameters","seed"],l);const c=g(e,["aspectRatio"]);t!==void 0&&c!=null&&C(t,["parameters","aspectRatio"],c);const d=g(e,["resolution"]);t!==void 0&&d!=null&&C(t,["parameters","resolution"],d);const u=g(e,["personGeneration"]);t!==void 0&&u!=null&&C(t,["parameters","personGeneration"],u);const p=g(e,["pubsubTopic"]);t!==void 0&&p!=null&&C(t,["parameters","pubsubTopic"],p);const m=g(e,["negativePrompt"]);t!==void 0&&m!=null&&C(t,["parameters","negativePrompt"],m);const w=g(e,["enhancePrompt"]);t!==void 0&&w!=null&&C(t,["parameters","enhancePrompt"],w);const k=g(e,["generateAudio"]);t!==void 0&&k!=null&&C(t,["parameters","generateAudio"],k);const b=g(e,["lastFrame"]);t!==void 0&&b!=null&&C(t,["instances[0]","lastFrame"],ko(b));const x=g(e,["referenceImages"]);if(t!==void 0&&x!=null){let v=x;Array.isArray(v)&&(v=v.map(N=>DS(N))),C(t,["instances[0]","referenceImages"],v)}const f=g(e,["mask"]);t!==void 0&&f!=null&&C(t,["instances[0]","mask"],MS(f));const h=g(e,["compressionQuality"]);return t!==void 0&&h!=null&&C(t,["parameters","compressionQuality"],h),o}function L_(e){const t={},o=g(e,["name"]);o!=null&&C(t,["name"],o);const r=g(e,["metadata"]);r!=null&&C(t,["metadata"],r);const a=g(e,["done"]);a!=null&&C(t,["done"],a);const i=g(e,["error"]);i!=null&&C(t,["error"],i);const s=g(e,["response","generateVideoResponse"]);return s!=null&&C(t,["response"],O_(s)),t}function D_(e){const t={},o=g(e,["name"]);o!=null&&C(t,["name"],o);const r=g(e,["metadata"]);r!=null&&C(t,["metadata"],r);const a=g(e,["done"]);a!=null&&C(t,["done"],a);const i=g(e,["error"]);i!=null&&C(t,["error"],i);const s=g(e,["response"]);return s!=null&&C(t,["response"],F_(s)),t}function z_(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["_url","model"],Bt(e,r));const a=g(t,["prompt"]);a!=null&&C(o,["instances[0]","prompt"],a);const i=g(t,["image"]);i!=null&&C(o,["instances[0]","image"],Ql(i));const s=g(t,["video"]);s!=null&&C(o,["instances[0]","video"],j1(s));const l=g(t,["source"]);l!=null&&B_(l,o);const c=g(t,["config"]);return c!=null&&R_(c,o),o}function q_(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["_url","model"],Bt(e,r));const a=g(t,["prompt"]);a!=null&&C(o,["instances[0]","prompt"],a);const i=g(t,["image"]);i!=null&&C(o,["instances[0]","image"],ko(i));const s=g(t,["video"]);s!=null&&C(o,["instances[0]","video"],I1(s));const l=g(t,["source"]);l!=null&&H_(l,o);const c=g(t,["config"]);return c!=null&&M_(c,o),o}function O_(e){const t={},o=g(e,["generatedSamples"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>V_(s))),C(t,["generatedVideos"],i)}const r=g(e,["raiMediaFilteredCount"]);r!=null&&C(t,["raiMediaFilteredCount"],r);const a=g(e,["raiMediaFilteredReasons"]);return a!=null&&C(t,["raiMediaFilteredReasons"],a),t}function F_(e){const t={},o=g(e,["videos"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>W_(s))),C(t,["generatedVideos"],i)}const r=g(e,["raiMediaFilteredCount"]);r!=null&&C(t,["raiMediaFilteredCount"],r);const a=g(e,["raiMediaFilteredReasons"]);return a!=null&&C(t,["raiMediaFilteredReasons"],a),t}function B_(e,t){const o={},r=g(e,["prompt"]);t!==void 0&&r!=null&&C(t,["instances[0]","prompt"],r);const a=g(e,["image"]);t!==void 0&&a!=null&&C(t,["instances[0]","image"],Ql(a));const i=g(e,["video"]);return t!==void 0&&i!=null&&C(t,["instances[0]","video"],j1(i)),o}function H_(e,t){const o={},r=g(e,["prompt"]);t!==void 0&&r!=null&&C(t,["instances[0]","prompt"],r);const a=g(e,["image"]);t!==void 0&&a!=null&&C(t,["instances[0]","image"],ko(a));const i=g(e,["video"]);return t!==void 0&&i!=null&&C(t,["instances[0]","video"],I1(i)),o}function G_(e){const t={},o=g(e,["_self"]);o!=null&&C(t,["image"],eS(o));const r=g(e,["raiFilteredReason"]);r!=null&&C(t,["raiFilteredReason"],r);const a=g(e,["_self"]);return a!=null&&C(t,["safetyAttributes"],N1(a)),t}function Zl(e){const t={},o=g(e,["_self"]);o!=null&&C(t,["image"],S1(o));const r=g(e,["raiFilteredReason"]);r!=null&&C(t,["raiFilteredReason"],r);const a=g(e,["_self"]);a!=null&&C(t,["safetyAttributes"],E1(a));const i=g(e,["prompt"]);return i!=null&&C(t,["enhancedPrompt"],i),t}function U_(e){const t={},o=g(e,["_self"]);o!=null&&C(t,["mask"],S1(o));const r=g(e,["labels"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>i)),C(t,["labels"],a)}return t}function V_(e){const t={},o=g(e,["video"]);return o!=null&&C(t,["video"],AS(o)),t}function W_(e){const t={},o=g(e,["_self"]);return o!=null&&C(t,["video"],RS(o)),t}function $_(e){const t={},o=g(e,["modelSelectionConfig"]);o!=null&&C(t,["modelConfig"],o);const r=g(e,["responseJsonSchema"]);r!=null&&C(t,["responseJsonSchema"],r);const a=g(e,["audioTimestamp"]);a!=null&&C(t,["audioTimestamp"],a);const i=g(e,["candidateCount"]);i!=null&&C(t,["candidateCount"],i);const s=g(e,["enableAffectiveDialog"]);s!=null&&C(t,["enableAffectiveDialog"],s);const l=g(e,["frequencyPenalty"]);l!=null&&C(t,["frequencyPenalty"],l);const c=g(e,["logprobs"]);c!=null&&C(t,["logprobs"],c);const d=g(e,["maxOutputTokens"]);d!=null&&C(t,["maxOutputTokens"],d);const u=g(e,["mediaResolution"]);u!=null&&C(t,["mediaResolution"],u);const p=g(e,["presencePenalty"]);p!=null&&C(t,["presencePenalty"],p);const m=g(e,["responseLogprobs"]);m!=null&&C(t,["responseLogprobs"],m);const w=g(e,["responseMimeType"]);w!=null&&C(t,["responseMimeType"],w);const k=g(e,["responseModalities"]);k!=null&&C(t,["responseModalities"],k);const b=g(e,["responseSchema"]);b!=null&&C(t,["responseSchema"],b);const x=g(e,["routingConfig"]);x!=null&&C(t,["routingConfig"],x);const f=g(e,["seed"]);f!=null&&C(t,["seed"],f);const h=g(e,["speechConfig"]);h!=null&&C(t,["speechConfig"],h);const v=g(e,["stopSequences"]);v!=null&&C(t,["stopSequences"],v);const N=g(e,["temperature"]);N!=null&&C(t,["temperature"],N);const _=g(e,["thinkingConfig"]);_!=null&&C(t,["thinkingConfig"],_);const E=g(e,["topK"]);E!=null&&C(t,["topK"],E);const I=g(e,["topP"]);if(I!=null&&C(t,["topP"],I),g(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function K_(e,t){const o={},r=g(t,["model"]);return r!=null&&C(o,["_url","name"],Bt(e,r)),o}function J_(e,t){const o={},r=g(t,["model"]);return r!=null&&C(o,["_url","name"],Bt(e,r)),o}function Y_(e){const t={};if(g(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const o=g(e,["enableWidget"]);return o!=null&&C(t,["enableWidget"],o),t}function X_(e){const t={};if(g(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const o=g(e,["timeRangeFilter"]);return o!=null&&C(t,["timeRangeFilter"],o),t}function Z_(e){const t={},o=g(e,["aspectRatio"]);o!=null&&C(t,["aspectRatio"],o);const r=g(e,["imageSize"]);if(r!=null&&C(t,["imageSize"],r),g(e,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(g(e,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(g(e,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function Q_(e){const t={},o=g(e,["aspectRatio"]);o!=null&&C(t,["aspectRatio"],o);const r=g(e,["imageSize"]);r!=null&&C(t,["imageSize"],r);const a=g(e,["personGeneration"]);a!=null&&C(t,["personGeneration"],a);const i=g(e,["outputMimeType"]);i!=null&&C(t,["imageOutputOptions","mimeType"],i);const s=g(e,["outputCompressionQuality"]);return s!=null&&C(t,["imageOutputOptions","compressionQuality"],s),t}function eS(e){const t={},o=g(e,["bytesBase64Encoded"]);o!=null&&C(t,["imageBytes"],Er(o));const r=g(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function S1(e){const t={},o=g(e,["gcsUri"]);o!=null&&C(t,["gcsUri"],o);const r=g(e,["bytesBase64Encoded"]);r!=null&&C(t,["imageBytes"],Er(r));const a=g(e,["mimeType"]);return a!=null&&C(t,["mimeType"],a),t}function Ql(e){const t={};if(g(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const o=g(e,["imageBytes"]);o!=null&&C(t,["bytesBase64Encoded"],Er(o));const r=g(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function ko(e){const t={},o=g(e,["gcsUri"]);o!=null&&C(t,["gcsUri"],o);const r=g(e,["imageBytes"]);r!=null&&C(t,["bytesBase64Encoded"],Er(r));const a=g(e,["mimeType"]);return a!=null&&C(t,["mimeType"],a),t}function tS(e,t,o){const r={},a=g(t,["pageSize"]);o!==void 0&&a!=null&&C(o,["_query","pageSize"],a);const i=g(t,["pageToken"]);o!==void 0&&i!=null&&C(o,["_query","pageToken"],i);const s=g(t,["filter"]);o!==void 0&&s!=null&&C(o,["_query","filter"],s);const l=g(t,["queryBase"]);return o!==void 0&&l!=null&&C(o,["_url","models_url"],y1(e,l)),r}function nS(e,t,o){const r={},a=g(t,["pageSize"]);o!==void 0&&a!=null&&C(o,["_query","pageSize"],a);const i=g(t,["pageToken"]);o!==void 0&&i!=null&&C(o,["_query","pageToken"],i);const s=g(t,["filter"]);o!==void 0&&s!=null&&C(o,["_query","filter"],s);const l=g(t,["queryBase"]);return o!==void 0&&l!=null&&C(o,["_url","models_url"],y1(e,l)),r}function oS(e,t){const o={},r=g(t,["config"]);return r!=null&&tS(e,r,o),o}function rS(e,t){const o={},r=g(t,["config"]);return r!=null&&nS(e,r,o),o}function aS(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["nextPageToken"]);r!=null&&C(t,["nextPageToken"],r);const a=g(e,["_self"]);if(a!=null){let i=v1(a);Array.isArray(i)&&(i=i.map(s=>Cu(s))),C(t,["models"],i)}return t}function iS(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["nextPageToken"]);r!=null&&C(t,["nextPageToken"],r);const a=g(e,["_self"]);if(a!=null){let i=v1(a);Array.isArray(i)&&(i=i.map(s=>ku(s))),C(t,["models"],i)}return t}function sS(e){const t={},o=g(e,["maskMode"]);o!=null&&C(t,["maskMode"],o);const r=g(e,["segmentationClasses"]);r!=null&&C(t,["maskClasses"],r);const a=g(e,["maskDilation"]);return a!=null&&C(t,["dilation"],a),t}function Cu(e){const t={},o=g(e,["name"]);o!=null&&C(t,["name"],o);const r=g(e,["displayName"]);r!=null&&C(t,["displayName"],r);const a=g(e,["description"]);a!=null&&C(t,["description"],a);const i=g(e,["version"]);i!=null&&C(t,["version"],i);const s=g(e,["_self"]);s!=null&&C(t,["tunedModelInfo"],kS(s));const l=g(e,["inputTokenLimit"]);l!=null&&C(t,["inputTokenLimit"],l);const c=g(e,["outputTokenLimit"]);c!=null&&C(t,["outputTokenLimit"],c);const d=g(e,["supportedGenerationMethods"]);d!=null&&C(t,["supportedActions"],d);const u=g(e,["temperature"]);u!=null&&C(t,["temperature"],u);const p=g(e,["maxTemperature"]);p!=null&&C(t,["maxTemperature"],p);const m=g(e,["topP"]);m!=null&&C(t,["topP"],m);const w=g(e,["topK"]);w!=null&&C(t,["topK"],w);const k=g(e,["thinking"]);return k!=null&&C(t,["thinking"],k),t}function ku(e){const t={},o=g(e,["name"]);o!=null&&C(t,["name"],o);const r=g(e,["displayName"]);r!=null&&C(t,["displayName"],r);const a=g(e,["description"]);a!=null&&C(t,["description"],a);const i=g(e,["versionId"]);i!=null&&C(t,["version"],i);const s=g(e,["deployedModels"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(m=>w_(m))),C(t,["endpoints"],p)}const l=g(e,["labels"]);l!=null&&C(t,["labels"],l);const c=g(e,["_self"]);c!=null&&C(t,["tunedModelInfo"],_S(c));const d=g(e,["defaultCheckpointId"]);d!=null&&C(t,["defaultCheckpointId"],d);const u=g(e,["checkpoints"]);if(u!=null){let p=u;Array.isArray(p)&&(p=p.map(m=>m)),C(t,["checkpoints"],p)}return t}function lS(e){const t={},o=g(e,["mediaResolution"]);o!=null&&C(t,["mediaResolution"],o);const r=g(e,["codeExecutionResult"]);r!=null&&C(t,["codeExecutionResult"],r);const a=g(e,["executableCode"]);a!=null&&C(t,["executableCode"],a);const i=g(e,["fileData"]);i!=null&&C(t,["fileData"],b_(i));const s=g(e,["functionCall"]);s!=null&&C(t,["functionCall"],C_(s));const l=g(e,["functionResponse"]);l!=null&&C(t,["functionResponse"],l);const c=g(e,["inlineData"]);c!=null&&C(t,["inlineData"],$4(c));const d=g(e,["text"]);d!=null&&C(t,["text"],d);const u=g(e,["thought"]);u!=null&&C(t,["thought"],u);const p=g(e,["thoughtSignature"]);p!=null&&C(t,["thoughtSignature"],p);const m=g(e,["videoMetadata"]);return m!=null&&C(t,["videoMetadata"],m),t}function cS(e){const t={},o=g(e,["productImage"]);return o!=null&&C(t,["image"],ko(o)),t}function dS(e,t){const o={},r=g(e,["numberOfImages"]);t!==void 0&&r!=null&&C(t,["parameters","sampleCount"],r);const a=g(e,["baseSteps"]);t!==void 0&&a!=null&&C(t,["parameters","baseSteps"],a);const i=g(e,["outputGcsUri"]);t!==void 0&&i!=null&&C(t,["parameters","storageUri"],i);const s=g(e,["seed"]);t!==void 0&&s!=null&&C(t,["parameters","seed"],s);const l=g(e,["safetyFilterLevel"]);t!==void 0&&l!=null&&C(t,["parameters","safetySetting"],l);const c=g(e,["personGeneration"]);t!==void 0&&c!=null&&C(t,["parameters","personGeneration"],c);const d=g(e,["addWatermark"]);t!==void 0&&d!=null&&C(t,["parameters","addWatermark"],d);const u=g(e,["outputMimeType"]);t!==void 0&&u!=null&&C(t,["parameters","outputOptions","mimeType"],u);const p=g(e,["outputCompressionQuality"]);t!==void 0&&p!=null&&C(t,["parameters","outputOptions","compressionQuality"],p);const m=g(e,["enhancePrompt"]);t!==void 0&&m!=null&&C(t,["parameters","enhancePrompt"],m);const w=g(e,["labels"]);return t!==void 0&&w!=null&&C(t,["labels"],w),o}function uS(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["_url","model"],Bt(e,r));const a=g(t,["source"]);a!=null&&hS(a,o);const i=g(t,["config"]);return i!=null&&dS(i,o),o}function pS(e){const t={},o=g(e,["predictions"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>Zl(a))),C(t,["generatedImages"],r)}return t}function hS(e,t){const o={},r=g(e,["prompt"]);t!==void 0&&r!=null&&C(t,["instances[0]","prompt"],r);const a=g(e,["personImage"]);t!==void 0&&a!=null&&C(t,["instances[0]","personImage","image"],ko(a));const i=g(e,["productImages"]);if(t!==void 0&&i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>cS(l))),C(t,["instances[0]","productImages"],s)}return o}function mS(e){const t={},o=g(e,["referenceImage"]);o!=null&&C(t,["referenceImage"],ko(o));const r=g(e,["referenceId"]);r!=null&&C(t,["referenceId"],r);const a=g(e,["referenceType"]);a!=null&&C(t,["referenceType"],a);const i=g(e,["maskImageConfig"]);i!=null&&C(t,["maskImageConfig"],sS(i));const s=g(e,["controlImageConfig"]);s!=null&&C(t,["controlImageConfig"],e_(s));const l=g(e,["styleImageConfig"]);l!=null&&C(t,["styleImageConfig"],l);const c=g(e,["subjectImageConfig"]);return c!=null&&C(t,["subjectImageConfig"],c),t}function N1(e){const t={},o=g(e,["safetyAttributes","categories"]);o!=null&&C(t,["categories"],o);const r=g(e,["safetyAttributes","scores"]);r!=null&&C(t,["scores"],r);const a=g(e,["contentType"]);return a!=null&&C(t,["contentType"],a),t}function E1(e){const t={},o=g(e,["safetyAttributes","categories"]);o!=null&&C(t,["categories"],o);const r=g(e,["safetyAttributes","scores"]);r!=null&&C(t,["scores"],r);const a=g(e,["contentType"]);return a!=null&&C(t,["contentType"],a),t}function gS(e){const t={},o=g(e,["category"]);if(o!=null&&C(t,["category"],o),g(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=g(e,["threshold"]);return r!=null&&C(t,["threshold"],r),t}function fS(e){const t={},o=g(e,["image"]);return o!=null&&C(t,["image"],ko(o)),t}function xS(e,t){const o={},r=g(e,["mode"]);t!==void 0&&r!=null&&C(t,["parameters","mode"],r);const a=g(e,["maxPredictions"]);t!==void 0&&a!=null&&C(t,["parameters","maxPredictions"],a);const i=g(e,["confidenceThreshold"]);t!==void 0&&i!=null&&C(t,["parameters","confidenceThreshold"],i);const s=g(e,["maskDilation"]);t!==void 0&&s!=null&&C(t,["parameters","maskDilation"],s);const l=g(e,["binaryColorThreshold"]);t!==void 0&&l!=null&&C(t,["parameters","binaryColorThreshold"],l);const c=g(e,["labels"]);return t!==void 0&&c!=null&&C(t,["labels"],c),o}function yS(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["_url","model"],Bt(e,r));const a=g(t,["source"]);a!=null&&wS(a,o);const i=g(t,["config"]);return i!=null&&xS(i,o),o}function vS(e){const t={},o=g(e,["predictions"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>U_(a))),C(t,["generatedMasks"],r)}return t}function wS(e,t){const o={},r=g(e,["prompt"]);t!==void 0&&r!=null&&C(t,["instances[0]","prompt"],r);const a=g(e,["image"]);t!==void 0&&a!=null&&C(t,["instances[0]","image"],ko(a));const i=g(e,["scribbleImage"]);return t!==void 0&&i!=null&&C(t,["instances[0]","scribble"],fS(i)),o}function bS(e){const t={},o=g(e,["retrievalConfig"]);o!=null&&C(t,["retrievalConfig"],o);const r=g(e,["functionCallingConfig"]);return r!=null&&C(t,["functionCallingConfig"],k_(r)),t}function CS(e){const t={};if(g(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const o=g(e,["computerUse"]);o!=null&&C(t,["computerUse"],o);const r=g(e,["fileSearch"]);r!=null&&C(t,["fileSearch"],r);const a=g(e,["codeExecution"]);if(a!=null&&C(t,["codeExecution"],a),g(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const i=g(e,["functionDeclarations"]);if(i!=null){let u=i;Array.isArray(u)&&(u=u.map(p=>p)),C(t,["functionDeclarations"],u)}const s=g(e,["googleMaps"]);s!=null&&C(t,["googleMaps"],Y_(s));const l=g(e,["googleSearch"]);l!=null&&C(t,["googleSearch"],X_(l));const c=g(e,["googleSearchRetrieval"]);c!=null&&C(t,["googleSearchRetrieval"],c);const d=g(e,["urlContext"]);return d!=null&&C(t,["urlContext"],d),t}function P1(e){const t={},o=g(e,["retrieval"]);o!=null&&C(t,["retrieval"],o);const r=g(e,["computerUse"]);if(r!=null&&C(t,["computerUse"],r),g(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const a=g(e,["codeExecution"]);a!=null&&C(t,["codeExecution"],a);const i=g(e,["enterpriseWebSearch"]);i!=null&&C(t,["enterpriseWebSearch"],i);const s=g(e,["functionDeclarations"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(m=>__(m))),C(t,["functionDeclarations"],p)}const l=g(e,["googleMaps"]);l!=null&&C(t,["googleMaps"],l);const c=g(e,["googleSearch"]);c!=null&&C(t,["googleSearch"],c);const d=g(e,["googleSearchRetrieval"]);d!=null&&C(t,["googleSearchRetrieval"],d);const u=g(e,["urlContext"]);return u!=null&&C(t,["urlContext"],u),t}function kS(e){const t={},o=g(e,["baseModel"]);o!=null&&C(t,["baseModel"],o);const r=g(e,["createTime"]);r!=null&&C(t,["createTime"],r);const a=g(e,["updateTime"]);return a!=null&&C(t,["updateTime"],a),t}function _S(e){const t={},o=g(e,["labels","google-vertex-llm-tuning-base-model-id"]);o!=null&&C(t,["baseModel"],o);const r=g(e,["createTime"]);r!=null&&C(t,["createTime"],r);const a=g(e,["updateTime"]);return a!=null&&C(t,["updateTime"],a),t}function SS(e,t){const o={},r=g(e,["displayName"]);t!==void 0&&r!=null&&C(t,["displayName"],r);const a=g(e,["description"]);t!==void 0&&a!=null&&C(t,["description"],a);const i=g(e,["defaultCheckpointId"]);return t!==void 0&&i!=null&&C(t,["defaultCheckpointId"],i),o}function NS(e,t){const o={},r=g(e,["displayName"]);t!==void 0&&r!=null&&C(t,["displayName"],r);const a=g(e,["description"]);t!==void 0&&a!=null&&C(t,["description"],a);const i=g(e,["defaultCheckpointId"]);return t!==void 0&&i!=null&&C(t,["defaultCheckpointId"],i),o}function ES(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["_url","name"],Bt(e,r));const a=g(t,["config"]);return a!=null&&SS(a,o),o}function PS(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["_url","model"],Bt(e,r));const a=g(t,["config"]);return a!=null&&NS(a,o),o}function jS(e,t){const o={},r=g(e,["outputGcsUri"]);t!==void 0&&r!=null&&C(t,["parameters","storageUri"],r);const a=g(e,["safetyFilterLevel"]);t!==void 0&&a!=null&&C(t,["parameters","safetySetting"],a);const i=g(e,["personGeneration"]);t!==void 0&&i!=null&&C(t,["parameters","personGeneration"],i);const s=g(e,["includeRaiReason"]);t!==void 0&&s!=null&&C(t,["parameters","includeRaiReason"],s);const l=g(e,["outputMimeType"]);t!==void 0&&l!=null&&C(t,["parameters","outputOptions","mimeType"],l);const c=g(e,["outputCompressionQuality"]);t!==void 0&&c!=null&&C(t,["parameters","outputOptions","compressionQuality"],c);const d=g(e,["enhanceInputImage"]);t!==void 0&&d!=null&&C(t,["parameters","upscaleConfig","enhanceInputImage"],d);const u=g(e,["imagePreservationFactor"]);t!==void 0&&u!=null&&C(t,["parameters","upscaleConfig","imagePreservationFactor"],u);const p=g(e,["labels"]);t!==void 0&&p!=null&&C(t,["labels"],p);const m=g(e,["numberOfImages"]);t!==void 0&&m!=null&&C(t,["parameters","sampleCount"],m);const w=g(e,["mode"]);return t!==void 0&&w!=null&&C(t,["parameters","mode"],w),o}function IS(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["_url","model"],Bt(e,r));const a=g(t,["image"]);a!=null&&C(o,["instances[0]","image"],ko(a));const i=g(t,["upscaleFactor"]);i!=null&&C(o,["parameters","upscaleConfig","upscaleFactor"],i);const s=g(t,["config"]);return s!=null&&jS(s,o),o}function TS(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>Zl(i))),C(t,["generatedImages"],a)}return t}function AS(e){const t={},o=g(e,["uri"]);o!=null&&C(t,["uri"],o);const r=g(e,["encodedVideo"]);r!=null&&C(t,["videoBytes"],Er(r));const a=g(e,["encoding"]);return a!=null&&C(t,["mimeType"],a),t}function RS(e){const t={},o=g(e,["gcsUri"]);o!=null&&C(t,["uri"],o);const r=g(e,["bytesBase64Encoded"]);r!=null&&C(t,["videoBytes"],Er(r));const a=g(e,["mimeType"]);return a!=null&&C(t,["mimeType"],a),t}function MS(e){const t={},o=g(e,["image"]);o!=null&&C(t,["_self"],ko(o));const r=g(e,["maskMode"]);return r!=null&&C(t,["maskMode"],r),t}function LS(e){const t={},o=g(e,["image"]);o!=null&&C(t,["image"],Ql(o));const r=g(e,["referenceType"]);return r!=null&&C(t,["referenceType"],r),t}function DS(e){const t={},o=g(e,["image"]);o!=null&&C(t,["image"],ko(o));const r=g(e,["referenceType"]);return r!=null&&C(t,["referenceType"],r),t}function j1(e){const t={},o=g(e,["uri"]);o!=null&&C(t,["uri"],o);const r=g(e,["videoBytes"]);r!=null&&C(t,["encodedVideo"],Er(r));const a=g(e,["mimeType"]);return a!=null&&C(t,["encoding"],a),t}function I1(e){const t={},o=g(e,["uri"]);o!=null&&C(t,["gcsUri"],o);const r=g(e,["videoBytes"]);r!=null&&C(t,["bytesBase64Encoded"],Er(r));const a=g(e,["mimeType"]);return a!=null&&C(t,["mimeType"],a),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zS(e,t){const o={},r=g(e,["displayName"]);return t!==void 0&&r!=null&&C(t,["displayName"],r),o}function qS(e){const t={},o=g(e,["config"]);return o!=null&&zS(o,t),t}function OS(e,t){const o={},r=g(e,["force"]);return t!==void 0&&r!=null&&C(t,["_query","force"],r),o}function FS(e){const t={},o=g(e,["name"]);o!=null&&C(t,["_url","name"],o);const r=g(e,["config"]);return r!=null&&OS(r,t),t}function BS(e){const t={},o=g(e,["name"]);return o!=null&&C(t,["_url","name"],o),t}function HS(e,t){const o={},r=g(e,["customMetadata"]);if(t!==void 0&&r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),C(t,["customMetadata"],i)}const a=g(e,["chunkingConfig"]);return t!==void 0&&a!=null&&C(t,["chunkingConfig"],a),o}function GS(e){const t={},o=g(e,["name"]);o!=null&&C(t,["name"],o);const r=g(e,["metadata"]);r!=null&&C(t,["metadata"],r);const a=g(e,["done"]);a!=null&&C(t,["done"],a);const i=g(e,["error"]);i!=null&&C(t,["error"],i);const s=g(e,["response"]);return s!=null&&C(t,["response"],VS(s)),t}function US(e){const t={},o=g(e,["fileSearchStoreName"]);o!=null&&C(t,["_url","file_search_store_name"],o);const r=g(e,["fileName"]);r!=null&&C(t,["fileName"],r);const a=g(e,["config"]);return a!=null&&HS(a,t),t}function VS(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["parent"]);r!=null&&C(t,["parent"],r);const a=g(e,["documentName"]);return a!=null&&C(t,["documentName"],a),t}function WS(e,t){const o={},r=g(e,["pageSize"]);t!==void 0&&r!=null&&C(t,["_query","pageSize"],r);const a=g(e,["pageToken"]);return t!==void 0&&a!=null&&C(t,["_query","pageToken"],a),o}function $S(e){const t={},o=g(e,["config"]);return o!=null&&WS(o,t),t}function KS(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["nextPageToken"]);r!=null&&C(t,["nextPageToken"],r);const a=g(e,["fileSearchStores"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),C(t,["fileSearchStores"],i)}return t}function T1(e,t){const o={},r=g(e,["mimeType"]);t!==void 0&&r!=null&&C(t,["mimeType"],r);const a=g(e,["displayName"]);t!==void 0&&a!=null&&C(t,["displayName"],a);const i=g(e,["customMetadata"]);if(t!==void 0&&i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),C(t,["customMetadata"],l)}const s=g(e,["chunkingConfig"]);return t!==void 0&&s!=null&&C(t,["chunkingConfig"],s),o}function JS(e){const t={},o=g(e,["fileSearchStoreName"]);o!=null&&C(t,["_url","file_search_store_name"],o);const r=g(e,["config"]);return r!=null&&T1(r,t),t}function YS(e){const t={},o=g(e,["sdkHttpResponse"]);return o!=null&&C(t,["sdkHttpResponse"],o),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const XS="Content-Type",ZS="X-Server-Timeout",QS="User-Agent",_u="x-goog-api-client",eN="1.38.0",tN=`google-genai-sdk/${eN}`,nN="v1beta1",oN="v1beta";class rN{constructor(t){var o,r,a;this.clientOptions=Object.assign({},t),this.customBaseUrl=(o=t.httpOptions)===null||o===void 0?void 0:o.baseUrl,this.clientOptions.vertexai&&(this.clientOptions.project&&this.clientOptions.location?this.clientOptions.apiKey=void 0:this.clientOptions.apiKey&&(this.clientOptions.project=void 0,this.clientOptions.location=void 0));const i={};if(this.clientOptions.vertexai){if(!this.clientOptions.location&&!this.clientOptions.apiKey&&!this.customBaseUrl&&(this.clientOptions.location="global"),!(this.clientOptions.project&&this.clientOptions.location||this.clientOptions.apiKey)&&!this.customBaseUrl)throw new Error("Authentication is not set up. Please provide either a project and location, or an API key, or a custom base URL.");const l=t.project&&t.location||!!t.apiKey;this.customBaseUrl&&!l?(i.baseUrl=this.customBaseUrl,this.clientOptions.project=void 0,this.clientOptions.location=void 0):this.clientOptions.apiKey||this.clientOptions.location==="global"?i.baseUrl="https://aiplatform.googleapis.com/":this.clientOptions.project&&this.clientOptions.location&&(i.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`),i.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:nN}else{if(!this.clientOptions.apiKey)throw new Fi({message:"API key must be set when using the Gemini API.",status:403});i.apiVersion=(a=this.clientOptions.apiVersion)!==null&&a!==void 0?a:oN,i.baseUrl="https://generativelanguage.googleapis.com/"}i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,t.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,t.httpOptions))}isVertexAI(){var t;return(t=this.clientOptions.vertexai)!==null&&t!==void 0?t:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getCustomBaseUrl(){return this.customBaseUrl}async getAuthHeaders(){const t=new Headers;return await this.clientOptions.auth.addAuthHeaders(t),t}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(t){if(!t||t.baseUrl===void 0||t.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const r=[t.baseUrl.endsWith("/")?t.baseUrl.slice(0,-1):t.baseUrl];return t.apiVersion&&t.apiVersion!==""&&r.push(t.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const t=this.getBaseUrl(),o=new URL(t);return o.protocol=o.protocol=="http:"?"ws":"wss",o.toString()}setBaseUrl(t){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=t;else throw new Error("HTTP options are not correctly set.")}constructUrl(t,o,r){const a=[this.getRequestUrlInternal(o)];return r&&a.push(this.getBaseResourcePath()),t!==""&&a.push(t),new URL(`${a.join("/")}`)}shouldPrependVertexProjectPath(t,o){return!(o.baseUrl&&o.baseUrlResourceScope===yu.COLLECTION||this.clientOptions.apiKey||!this.clientOptions.vertexai||t.path.startsWith("projects/")||t.httpMethod==="GET"&&t.path.startsWith("publishers/google/models"))}async request(t){let o=this.clientOptions.httpOptions;t.httpOptions&&(o=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const r=this.shouldPrependVertexProjectPath(t,o),a=this.constructUrl(t.path,o,r);if(t.queryParams)for(const[s,l]of Object.entries(t.queryParams))a.searchParams.append(s,String(l));let i={};if(t.httpMethod==="GET"){if(t.body&&t.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else i.body=t.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,o,a.toString(),t.abortSignal),this.unaryApiCall(a,i,t.httpMethod)}patchHttpOptions(t,o){const r=JSON.parse(JSON.stringify(t));for(const[a,i]of Object.entries(o))typeof i=="object"?r[a]=Object.assign(Object.assign({},r[a]),i):i!==void 0&&(r[a]=i);return r}async requestStream(t){let o=this.clientOptions.httpOptions;t.httpOptions&&(o=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const r=this.shouldPrependVertexProjectPath(t,o),a=this.constructUrl(t.path,o,r);(!a.searchParams.has("alt")||a.searchParams.get("alt")!=="sse")&&a.searchParams.set("alt","sse");let i={};return i.body=t.body,i=await this.includeExtraHttpOptionsToRequestInit(i,o,a.toString(),t.abortSignal),this.streamApiCall(a,i,t.httpMethod)}async includeExtraHttpOptionsToRequestInit(t,o,r,a){if(o&&o.timeout||a){const i=new AbortController,s=i.signal;if(o.timeout&&(o==null?void 0:o.timeout)>0){const l=setTimeout(()=>i.abort(),o.timeout);l&&typeof l.unref=="function"&&l.unref()}a&&a.addEventListener("abort",()=>{i.abort()}),t.signal=s}return o&&o.extraBody!==null&&aN(t,o.extraBody),t.headers=await this.getHeadersInternal(o,r),t}async unaryApiCall(t,o,r){return this.apiCall(t.toString(),Object.assign(Object.assign({},o),{method:r})).then(async a=>(await Bg(a),new vu(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}async streamApiCall(t,o,r){return this.apiCall(t.toString(),Object.assign(Object.assign({},o),{method:r})).then(async a=>(await Bg(a),this.processStreamResponse(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}processStreamResponse(t){return wo(this,arguments,function*(){var r;const a=(r=t==null?void 0:t.body)===null||r===void 0?void 0:r.getReader(),i=new TextDecoder("utf-8");if(!a)throw new Error("Response body is empty");try{let s="";const l="data:",c=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:d,value:u}=yield jt(a.read());if(d){if(s.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const p=i.decode(u,{stream:!0});try{const k=JSON.parse(p);if("error"in k){const b=JSON.parse(JSON.stringify(k.error)),x=b.status,f=b.code,h=`got status: ${x}. ${JSON.stringify(k)}`;if(f>=400&&f<600)throw new Fi({message:h,status:f})}}catch(k){if(k.name==="ApiError")throw k}s+=p;let m=-1,w=0;for(;;){m=-1,w=0;for(const x of c){const f=s.indexOf(x);f!==-1&&(m===-1||f<m)&&(m=f,w=x.length)}if(m===-1)break;const k=s.substring(0,m);s=s.substring(m+w);const b=k.trim();if(b.startsWith(l)){const x=b.substring(l.length).trim();try{const f=new Response(x,{headers:t==null?void 0:t.headers,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText});yield yield jt(new vu(f))}catch(f){throw new Error(`exception parsing stream chunk ${x}. ${f}`)}}}}}finally{a.releaseLock()}})}async apiCall(t,o){return fetch(t,o).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){const t={},o=tN+" "+this.clientOptions.userAgentExtra;return t[QS]=o,t[_u]=o,t[XS]="application/json",t}async getHeadersInternal(t,o){const r=new Headers;if(t&&t.headers){for(const[a,i]of Object.entries(t.headers))r.append(a,i);t.timeout&&t.timeout>0&&r.append(ZS,String(Math.ceil(t.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,o),r}getFileName(t){var o;let r="";return typeof t=="string"&&(r=t.replace(/[/\\]+$/,""),r=(o=r.split(/[/\\]/).pop())!==null&&o!==void 0?o:""),r}async uploadFile(t,o){var r;const a={};o!=null&&(a.mimeType=o.mimeType,a.name=o.name,a.displayName=o.displayName),a.name&&!a.name.startsWith("files/")&&(a.name=`files/${a.name}`);const i=this.clientOptions.uploader,s=await i.stat(t);a.sizeBytes=String(s.size);const l=(r=o==null?void 0:o.mimeType)!==null&&r!==void 0?r:s.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");a.mimeType=l;const c={file:a},d=this.getFileName(t),u=xt("upload/v1beta/files",c._url),p=await this.fetchUploadUrl(u,a.sizeBytes,a.mimeType,d,c,o==null?void 0:o.httpOptions);return i.upload(t,p,this)}async uploadFileToFileSearchStore(t,o,r){var a;const i=this.clientOptions.uploader,s=await i.stat(o),l=String(s.size),c=(a=r==null?void 0:r.mimeType)!==null&&a!==void 0?a:s.type;if(c===void 0||c==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const d=`upload/v1beta/${t}:uploadToFileSearchStore`,u=this.getFileName(o),p={};r!=null&&T1(r,p);const m=await this.fetchUploadUrl(d,l,c,u,p,r==null?void 0:r.httpOptions);return i.uploadToFileSearchStore(o,m,this)}async downloadFile(t){await this.clientOptions.downloader.download(t,this)}async fetchUploadUrl(t,o,r,a,i,s){var l;let c={};s?c=s:c={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${o}`,"X-Goog-Upload-Header-Content-Type":`${r}`},a?{"X-Goog-Upload-File-Name":a}:{})};const d=await this.request({path:t,body:JSON.stringify(i),httpMethod:"POST",httpOptions:c});if(!d||!(d!=null&&d.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const u=(l=d==null?void 0:d.headers)===null||l===void 0?void 0:l["x-goog-upload-url"];if(u===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}}async function Bg(e){var t;if(e===void 0)throw new Error("response is undefined");if(!e.ok){const o=e.status;let r;!((t=e.headers.get("content-type"))===null||t===void 0)&&t.includes("application/json")?r=await e.json():r={error:{message:await e.text(),code:e.status,status:e.statusText}};const a=JSON.stringify(r);throw o>=400&&o<600?new Fi({message:a,status:o}):new Error(a)}}function aN(e,t){if(!t||Object.keys(t).length===0)return;if(e.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let o={};if(typeof e.body=="string"&&e.body.length>0)try{const i=JSON.parse(e.body);if(typeof i=="object"&&i!==null&&!Array.isArray(i))o=i;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(i,s){const l=Object.assign({},i);for(const c in s)if(Object.prototype.hasOwnProperty.call(s,c)){const d=s[c],u=l[c];d&&typeof d=="object"&&!Array.isArray(d)&&u&&typeof u=="object"&&!Array.isArray(u)?l[c]=r(u,d):(u&&d&&typeof u!=typeof d&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${c}". Original type: ${typeof u}, New type: ${typeof d}. Overwriting.`),l[c]=d)}return l}const a=r(o,t);e.body=JSON.stringify(a)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const iN="mcp_used/unknown";let sN=!1;function A1(e){for(const t of e)if(lN(t)||typeof t=="object"&&"inputSchema"in t)return!0;return sN}function R1(e){var t;const o=(t=e[_u])!==null&&t!==void 0?t:"";e[_u]=(o+` ${iN}`).trimStart()}function lN(e){return e!==null&&typeof e=="object"&&e instanceof Vp}function cN(e){return wo(this,arguments,function*(o,r=100){let a,i=0;for(;i<r;){const s=yield jt(o.listTools({cursor:a}));for(const l of s.tools)yield yield jt(l),i++;if(!s.nextCursor)break;a=s.nextCursor}})}class Vp{constructor(t=[],o){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=t,this.config=o}static create(t,o){return new Vp(t,o)}async initialize(){var t,o,r,a;if(this.mcpTools.length>0)return;const i={},s=[];for(const u of this.mcpClients)try{for(var l=!0,c=(o=void 0,bo(cN(u))),d;d=await c.next(),t=d.done,!t;l=!0){a=d.value,l=!1;const p=a;s.push(p);const m=p.name;if(i[m])throw new Error(`Duplicate function name ${m} found in MCP tools. Please ensure function names are unique.`);i[m]=u}}catch(p){o={error:p}}finally{try{!l&&!t&&(r=c.return)&&await r.call(c)}finally{if(o)throw o.error}}this.mcpTools=s,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),F5(this.mcpTools,this.config)}async callTool(t){await this.initialize();const o=[];for(const r of t)if(r.name in this.functionNameToMcpClient){const a=this.functionNameToMcpClient[r.name];let i;this.config.timeout&&(i={timeout:this.config.timeout});const s=await a.callTool({name:r.name,arguments:r.args},void 0,i);o.push({functionResponse:{name:r.name,response:s.isError?{error:s}:s}})}return o}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function dN(e,t,o){const r=new A5;let a;o.data instanceof Blob?a=JSON.parse(await o.data.text()):a=JSON.parse(o.data),Object.assign(r,a),t(r)}class uN{constructor(t,o,r){this.apiClient=t,this.auth=o,this.webSocketFactory=r}async connect(t){var o,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const a=this.apiClient.getWebsocketBaseUrl(),i=this.apiClient.getApiVersion(),s=mN(this.apiClient.getDefaultHeaders()),l=this.apiClient.getApiKey(),c=`${a}/ws/google.ai.generativelanguage.${i}.GenerativeService.BidiGenerateMusic?key=${l}`;let d=()=>{};const u=new Promise(v=>{d=v}),p=t.callbacks,m=function(){d({})},w=this.apiClient,k={onopen:m,onmessage:v=>{dN(w,p.onmessage,v)},onerror:(o=p==null?void 0:p.onerror)!==null&&o!==void 0?o:function(v){},onclose:(r=p==null?void 0:p.onclose)!==null&&r!==void 0?r:function(v){}},b=this.webSocketFactory.create(c,hN(s),k);b.connect(),await u;const h={setup:{model:Bt(this.apiClient,t.model)}};return b.send(JSON.stringify(h)),new pN(b,this.apiClient)}}class pN{constructor(t,o){this.conn=t,this.apiClient=o}async setWeightedPrompts(t){if(!t.weightedPrompts||Object.keys(t.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const o=z4(t);this.conn.send(JSON.stringify({clientContent:o}))}async setMusicGenerationConfig(t){t.musicGenerationConfig||(t.musicGenerationConfig={});const o=D4(t);this.conn.send(JSON.stringify(o))}sendPlaybackControl(t){const o={playbackControl:t};this.conn.send(JSON.stringify(o))}play(){this.sendPlaybackControl(va.PLAY)}pause(){this.sendPlaybackControl(va.PAUSE)}stop(){this.sendPlaybackControl(va.STOP)}resetContext(){this.sendPlaybackControl(va.RESET_CONTEXT)}close(){this.conn.close()}}function hN(e){const t={};return e.forEach((o,r)=>{t[r]=o}),t}function mN(e){const t=new Headers;for(const[o,r]of Object.entries(e))t.append(o,r);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const gN="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function fN(e,t,o){const r=new T5;let a;o.data instanceof Blob?a=await o.data.text():o.data instanceof ArrayBuffer?a=new TextDecoder().decode(o.data):a=o.data;const i=JSON.parse(a);if(e.isVertexAI()){const s=F4(i);Object.assign(r,s)}else Object.assign(r,i);t(r)}class xN{constructor(t,o,r){this.apiClient=t,this.auth=o,this.webSocketFactory=r,this.music=new uN(this.apiClient,this.auth,this.webSocketFactory)}async connect(t){var o,r,a,i,s,l;if(t.config&&t.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const c=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let u;const p=this.apiClient.getHeaders();t.config&&t.config.tools&&A1(t.config.tools)&&R1(p);const m=bN(p);if(this.apiClient.isVertexAI()){const M=this.apiClient.getProject(),G=this.apiClient.getLocation(),V=this.apiClient.getApiKey(),j=!!M&&!!G||!!V;this.apiClient.getCustomBaseUrl()&&!j?u=c:(u=`${c}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(m,u))}else{const M=this.apiClient.getApiKey();let G="BidiGenerateContent",V="key";M!=null&&M.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),d!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),G="BidiGenerateContentConstrained",V="access_token"),u=`${c}/ws/google.ai.generativelanguage.${d}.GenerativeService.${G}?${V}=${M}`}let w=()=>{};const k=new Promise(M=>{w=M}),b=t.callbacks,x=function(){var M;(M=b==null?void 0:b.onopen)===null||M===void 0||M.call(b),w({})},f=this.apiClient,h={onopen:x,onmessage:M=>{fN(f,b.onmessage,M)},onerror:(o=b==null?void 0:b.onerror)!==null&&o!==void 0?o:function(M){},onclose:(r=b==null?void 0:b.onclose)!==null&&r!==void 0?r:function(M){}},v=this.webSocketFactory.create(u,wN(m),h);v.connect(),await k;let N=Bt(this.apiClient,t.model);if(this.apiClient.isVertexAI()&&N.startsWith("publishers/")){const M=this.apiClient.getProject(),G=this.apiClient.getLocation();M&&G&&(N=`projects/${M}/locations/${G}/`+N)}let _={};this.apiClient.isVertexAI()&&((a=t.config)===null||a===void 0?void 0:a.responseModalities)===void 0&&(t.config===void 0?t.config={responseModalities:[Ba.AUDIO]}:t.config.responseModalities=[Ba.AUDIO]),!((i=t.config)===null||i===void 0)&&i.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const E=(l=(s=t.config)===null||s===void 0?void 0:s.tools)!==null&&l!==void 0?l:[],I=[];for(const M of E)if(this.isCallableTool(M)){const G=M;I.push(await G.tool())}else I.push(M);I.length>0&&(t.config.tools=I);const B={model:N,config:t.config,callbacks:t.callbacks};return this.apiClient.isVertexAI()?_=L4(this.apiClient,B):_=M4(this.apiClient,B),delete _.config,v.send(JSON.stringify(_)),new vN(v,this.apiClient)}isCallableTool(t){return"callTool"in t&&typeof t.callTool=="function"}}const yN={turnComplete:!0};class vN{constructor(t,o){this.conn=t,this.apiClient=o}tLiveClientContent(t,o){if(o.turns!==null&&o.turns!==void 0){let r=[];try{r=so(o.turns),t.isVertexAI()||(r=r.map(a=>Xl(a)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof o.turns}'`)}return{clientContent:{turns:r,turnComplete:o.turnComplete}}}return{clientContent:{turnComplete:o.turnComplete}}}tLiveClienttToolResponse(t,o){let r=[];if(o.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(o.functionResponses)?r=o.functionResponses:r=[o.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(const i of r){if(typeof i!="object"||i===null||!("name"in i)||!("response"in i))throw new Error(`Could not parse function response, type '${typeof i}'.`);if(!t.isVertexAI()&&!("id"in i))throw new Error(gN)}return{toolResponse:{functionResponses:r}}}sendClientContent(t){t=Object.assign(Object.assign({},yN),t);const o=this.tLiveClientContent(this.apiClient,t);this.conn.send(JSON.stringify(o))}sendRealtimeInput(t){let o={};this.apiClient.isVertexAI()?o={realtimeInput:O4(t)}:o={realtimeInput:q4(t)},this.conn.send(JSON.stringify(o))}sendToolResponse(t){if(t.functionResponses==null)throw new Error("Tool response parameters are required.");const o=this.tLiveClienttToolResponse(this.apiClient,t);this.conn.send(JSON.stringify(o))}close(){this.conn.close()}}function wN(e){const t={};return e.forEach((o,r)=>{t[r]=o}),t}function bN(e){const t=new Headers;for(const[o,r]of Object.entries(e))t.append(o,r);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Hg=10;function Gg(e){var t,o,r;if(!((t=e==null?void 0:e.automaticFunctionCalling)===null||t===void 0)&&t.disable)return!0;let a=!1;for(const s of(o=e==null?void 0:e.tools)!==null&&o!==void 0?o:[])if(Pa(s)){a=!0;break}if(!a)return!0;const i=(r=e==null?void 0:e.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return i&&(i<0||!Number.isInteger(i))||i==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",i),!0):!1}function Pa(e){return"callTool"in e&&typeof e.callTool=="function"}function CN(e){var t,o,r;return(r=(o=(t=e.config)===null||t===void 0?void 0:t.tools)===null||o===void 0?void 0:o.some(a=>Pa(a)))!==null&&r!==void 0?r:!1}function Ug(e){var t;const o=[];return!((t=e==null?void 0:e.config)===null||t===void 0)&&t.tools&&e.config.tools.forEach((r,a)=>{if(Pa(r))return;const i=r;i.functionDeclarations&&i.functionDeclarations.length>0&&o.push(a)}),o}function Vg(e){var t;return!(!((t=e==null?void 0:e.automaticFunctionCalling)===null||t===void 0)&&t.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class kN extends Xo{constructor(t){super(),this.apiClient=t,this.generateContent=async o=>{var r,a,i,s,l;const c=await this.processParamsMaybeAddMcpUsage(o);if(this.maybeMoveToResponseJsonSchem(o),!CN(o)||Gg(o.config))return await this.generateContentInternal(c);const d=Ug(o);if(d.length>0){const b=d.map(x=>`tools[${x}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${b}.`)}let u,p;const m=so(c.contents),w=(i=(a=(r=c.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||a===void 0?void 0:a.maximumRemoteCalls)!==null&&i!==void 0?i:Hg;let k=0;for(;k<w&&(u=await this.generateContentInternal(c),!(!u.functionCalls||u.functionCalls.length===0));){const b=u.candidates[0].content,x=[];for(const f of(l=(s=o.config)===null||s===void 0?void 0:s.tools)!==null&&l!==void 0?l:[])if(Pa(f)){const v=await f.callTool(u.functionCalls);x.push(...v)}k++,p={role:"user",parts:x},c.contents=so(c.contents),c.contents.push(b),c.contents.push(p),Vg(c.config)&&(m.push(b),m.push(p))}return Vg(c.config)&&(u.automaticFunctionCallingHistory=m),u},this.generateContentStream=async o=>{var r,a,i,s,l;if(this.maybeMoveToResponseJsonSchem(o),Gg(o.config)){const p=await this.processParamsMaybeAddMcpUsage(o);return await this.generateContentStreamInternal(p)}const c=Ug(o);if(c.length>0){const p=c.map(m=>`tools[${m}]`).join(", ");throw new Error(`Incompatible tools found at ${p}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const d=(i=(a=(r=o==null?void 0:o.config)===null||r===void 0?void 0:r.toolConfig)===null||a===void 0?void 0:a.functionCallingConfig)===null||i===void 0?void 0:i.streamFunctionCallArguments,u=(l=(s=o==null?void 0:o.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||l===void 0?void 0:l.disable;if(d&&!u)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(o)},this.generateImages=async o=>await this.generateImagesInternal(o).then(r=>{var a;let i;const s=[];if(r!=null&&r.generatedImages)for(const c of r.generatedImages)c&&(c!=null&&c.safetyAttributes)&&((a=c==null?void 0:c.safetyAttributes)===null||a===void 0?void 0:a.contentType)==="Positive Prompt"?i=c==null?void 0:c.safetyAttributes:s.push(c);let l;return i?l={generatedImages:s,positivePromptSafetyAttributes:i,sdkHttpResponse:r.sdkHttpResponse}:l={generatedImages:s,sdkHttpResponse:r.sdkHttpResponse},l}),this.list=async o=>{var r;const s={config:Object.assign(Object.assign({},{queryBase:!0}),o==null?void 0:o.config)};if(this.apiClient.isVertexAI()&&!s.config.queryBase){if(!((r=s.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");s.config.filter="labels.tune-type:*"}return new Kr(Jo.PAGED_ITEM_MODELS,l=>this.listInternal(l),await this.listInternal(s),s)},this.editImage=async o=>{const r={model:o.model,prompt:o.prompt,referenceImages:[],config:o.config};return o.referenceImages&&o.referenceImages&&(r.referenceImages=o.referenceImages.map(a=>a.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async o=>{let r={numberOfImages:1,mode:"upscale"};o.config&&(r=Object.assign(Object.assign({},r),o.config));const a={model:o.model,image:o.image,upscaleFactor:o.upscaleFactor,config:r};return await this.upscaleImageInternal(a)},this.generateVideos=async o=>{var r,a,i,s,l,c;if((o.prompt||o.image||o.video)&&o.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((r=o.video)===null||r===void 0)&&r.uri&&(!((a=o.video)===null||a===void 0)&&a.videoBytes)?o.video={uri:o.video.uri,mimeType:o.video.mimeType}:!((s=(i=o.source)===null||i===void 0?void 0:i.video)===null||s===void 0)&&s.uri&&(!((c=(l=o.source)===null||l===void 0?void 0:l.video)===null||c===void 0)&&c.videoBytes)&&(o.source.video={uri:o.source.video.uri,mimeType:o.source.video.mimeType})),await this.generateVideosInternal(o)}}maybeMoveToResponseJsonSchem(t){t.config&&t.config.responseSchema&&(t.config.responseJsonSchema||Object.keys(t.config.responseSchema).includes("$schema")&&(t.config.responseJsonSchema=t.config.responseSchema,delete t.config.responseSchema))}async processParamsMaybeAddMcpUsage(t){var o,r,a;const i=(o=t.config)===null||o===void 0?void 0:o.tools;if(!i)return t;const s=await Promise.all(i.map(async c=>Pa(c)?await c.tool():c)),l={model:t.model,contents:t.contents,config:Object.assign(Object.assign({},t.config),{tools:s})};if(l.config.tools=s,t.config&&t.config.tools&&A1(t.config.tools)){const c=(a=(r=t.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&a!==void 0?a:{};let d=Object.assign({},c);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),R1(d),l.config.httpOptions=Object.assign(Object.assign({},t.config.httpOptions),{headers:d})}return l}async initAfcToolsMap(t){var o,r,a;const i=new Map;for(const s of(r=(o=t.config)===null||o===void 0?void 0:o.tools)!==null&&r!==void 0?r:[])if(Pa(s)){const l=s,c=await l.tool();for(const d of(a=c.functionDeclarations)!==null&&a!==void 0?a:[]){if(!d.name)throw new Error("Function declaration name is required.");if(i.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);i.set(d.name,l)}}return i}async processAfcStream(t){var o,r,a;const i=(a=(r=(o=t.config)===null||o===void 0?void 0:o.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&a!==void 0?a:Hg;let s=!1,l=0;const c=await this.initAfcToolsMap(t);return function(d,u,p){return wo(this,arguments,function*(){for(var m,w,k,b,x,f;l<i;){s&&(l++,s=!1);const _=yield jt(d.processParamsMaybeAddMcpUsage(p)),E=yield jt(d.generateContentStreamInternal(_)),I=[],B=[];try{for(var h=!0,v=(w=void 0,bo(E)),N;N=yield jt(v.next()),m=N.done,!m;h=!0){b=N.value,h=!1;const M=b;if(yield yield jt(M),M.candidates&&(!((x=M.candidates[0])===null||x===void 0)&&x.content)){B.push(M.candidates[0].content);for(const G of(f=M.candidates[0].content.parts)!==null&&f!==void 0?f:[])if(l<i&&G.functionCall){if(!G.functionCall.name)throw new Error("Function call name was not returned by the model.");if(u.has(G.functionCall.name)){const V=yield jt(u.get(G.functionCall.name).callTool([G.functionCall]));I.push(...V)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${u.keys()}, mising tool: ${G.functionCall.name}`)}}}}catch(M){w={error:M}}finally{try{!h&&!m&&(k=v.return)&&(yield jt(k.call(v)))}finally{if(w)throw w.error}}if(I.length>0){s=!0;const M=new ii;M.candidates=[{content:{role:"user",parts:I}}],yield yield jt(M);const G=[];G.push(...B),G.push({role:"user",parts:I});const V=so(p.contents).concat(G);p.contents=V}else break}})}(this,c,t)}async generateContentInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=qg(this.apiClient,t);return l=xt("{model}:generateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=Fg(u),m=new ii;return Object.assign(m,p),m})}else{const d=zg(this.apiClient,t);return l=xt("{model}:generateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=Og(u),m=new ii;return Object.assign(m,p),m})}}async generateContentStreamInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=qg(this.apiClient,t);return l=xt("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}),s.then(function(p){return wo(this,arguments,function*(){var m,w,k,b;try{for(var x=!0,f=bo(p),h;h=yield jt(f.next()),m=h.done,!m;x=!0){b=h.value,x=!1;const v=b,N=Fg(yield jt(v.json()));N.sdkHttpResponse={headers:v.headers};const _=new ii;Object.assign(_,N),yield yield jt(_)}}catch(v){w={error:v}}finally{try{!x&&!m&&(k=f.return)&&(yield jt(k.call(f)))}finally{if(w)throw w.error}}})})}else{const d=zg(this.apiClient,t);return l=xt("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}),s.then(function(p){return wo(this,arguments,function*(){var m,w,k,b;try{for(var x=!0,f=bo(p),h;h=yield jt(f.next()),m=h.done,!m;x=!0){b=h.value,x=!1;const v=b,N=Og(yield jt(v.json()));N.sdkHttpResponse={headers:v.headers};const _=new ii;Object.assign(_,N),yield yield jt(_)}}catch(v){w={error:v}}finally{try{!x&&!m&&(k=f.return)&&(yield jt(k.call(f)))}finally{if(w)throw w.error}}})})}}async embedContent(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=x_(this.apiClient,t);return l=xt("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=v_(u),m=new wg;return Object.assign(m,p),m})}else{const d=f_(this.apiClient,t);return l=xt("{model}:batchEmbedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=y_(u),m=new wg;return Object.assign(m,p),m})}}async generateImagesInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=I_(this.apiClient,t);return l=xt("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=A_(u),m=new bg;return Object.assign(m,p),m})}else{const d=j_(this.apiClient,t);return l=xt("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=T_(u),m=new bg;return Object.assign(m,p),m})}}async editImageInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=p_(this.apiClient,t);return i=xt("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>{const d=h_(c),u=new w5;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=IS(this.apiClient,t);return i=xt("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>{const d=TS(c),u=new b5;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=uS(this.apiClient,t);return i=xt("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=pS(c),u=new C5;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=yS(this.apiClient,t);return i=xt("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=vS(c),u=new k5;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async get(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=J_(this.apiClient,t);return l=xt("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>ku(u))}else{const d=K_(this.apiClient,t);return l=xt("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>Cu(u))}}async listInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=rS(this.apiClient,t);return l=xt("{models_url}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=iS(u),m=new Cg;return Object.assign(m,p),m})}else{const d=oS(this.apiClient,t);return l=xt("{models_url}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=aS(u),m=new Cg;return Object.assign(m,p),m})}}async update(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=PS(this.apiClient,t);return l=xt("{model}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>ku(u))}else{const d=ES(this.apiClient,t);return l=xt("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>Cu(u))}}async delete(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=l_(this.apiClient,t);return l=xt("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=d_(u),m=new kg;return Object.assign(m,p),m})}else{const d=s_(this.apiClient,t);return l=xt("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=c_(u),m=new kg;return Object.assign(m,p),m})}}async countTokens(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=r_(this.apiClient,t);return l=xt("{model}:countTokens",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=i_(u),m=new _g;return Object.assign(m,p),m})}else{const d=o_(this.apiClient,t);return l=xt("{model}:countTokens",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=a_(u),m=new _g;return Object.assign(m,p),m})}}async computeTokens(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=Y4(this.apiClient,t);return i=xt("{model}:computeTokens",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>{const d=X4(c),u=new _5;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=q_(this.apiClient,t);return l=xt("{model}:predictLongRunning",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>{const p=D_(u),m=new Sl;return Object.assign(m,p),m})}else{const d=z_(this.apiClient,t);return l=xt("{model}:predictLongRunning",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>{const p=L_(u),m=new Sl;return Object.assign(m,p),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class _N extends Xo{constructor(t){super(),this.apiClient=t}async getVideosOperation(t){const o=t.operation,r=t.config;if(o.name===void 0||o.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=o.name.split("/operations/")[0];let i;r&&"httpOptions"in r&&(i=r.httpOptions);const s=await this.fetchPredictVideosOperationInternal({operationName:o.name,resourceName:a,config:{httpOptions:i}});return o._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{const a=await this.getVideosOperationInternal({operationName:o.name,config:r});return o._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async get(t){const o=t.operation,r=t.config;if(o.name===void 0||o.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=o.name.split("/operations/")[0];let i;r&&"httpOptions"in r&&(i=r.httpOptions);const s=await this.fetchPredictVideosOperationInternal({operationName:o.name,resourceName:a,config:{httpOptions:i}});return o._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{const a=await this.getVideosOperationInternal({operationName:o.name,config:r});return o._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async getVideosOperationInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=m5(t);return l=xt("{operationName}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s}else{const d=h5(t);return l=xt("{operationName}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s}}async fetchPredictVideosOperationInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=i5(t);return i=xt("{resourceName}:fetchPredictOperation",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function SN(e){const t={},o=g(e,["data"]);if(o!=null&&C(t,["data"],o),g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=g(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function NN(e){const t={},o=g(e,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(i=>LN(i))),C(t,["parts"],a)}const r=g(e,["role"]);return r!=null&&C(t,["role"],r),t}function EN(e,t,o){const r={},a=g(t,["expireTime"]);o!==void 0&&a!=null&&C(o,["expireTime"],a);const i=g(t,["newSessionExpireTime"]);o!==void 0&&i!=null&&C(o,["newSessionExpireTime"],i);const s=g(t,["uses"]);o!==void 0&&s!=null&&C(o,["uses"],s);const l=g(t,["liveConnectConstraints"]);o!==void 0&&l!=null&&C(o,["bidiGenerateContentSetup"],MN(e,l));const c=g(t,["lockAdditionalFields"]);return o!==void 0&&c!=null&&C(o,["fieldMask"],c),r}function PN(e,t){const o={},r=g(t,["config"]);return r!=null&&C(o,["config"],EN(e,r,o)),o}function jN(e){const t={};if(g(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=g(e,["fileUri"]);o!=null&&C(t,["fileUri"],o);const r=g(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function IN(e){const t={},o=g(e,["id"]);o!=null&&C(t,["id"],o);const r=g(e,["args"]);r!=null&&C(t,["args"],r);const a=g(e,["name"]);if(a!=null&&C(t,["name"],a),g(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function TN(e){const t={};if(g(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const o=g(e,["enableWidget"]);return o!=null&&C(t,["enableWidget"],o),t}function AN(e){const t={};if(g(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const o=g(e,["timeRangeFilter"]);return o!=null&&C(t,["timeRangeFilter"],o),t}function RN(e,t){const o={},r=g(e,["generationConfig"]);t!==void 0&&r!=null&&C(t,["setup","generationConfig"],r);const a=g(e,["responseModalities"]);t!==void 0&&a!=null&&C(t,["setup","generationConfig","responseModalities"],a);const i=g(e,["temperature"]);t!==void 0&&i!=null&&C(t,["setup","generationConfig","temperature"],i);const s=g(e,["topP"]);t!==void 0&&s!=null&&C(t,["setup","generationConfig","topP"],s);const l=g(e,["topK"]);t!==void 0&&l!=null&&C(t,["setup","generationConfig","topK"],l);const c=g(e,["maxOutputTokens"]);t!==void 0&&c!=null&&C(t,["setup","generationConfig","maxOutputTokens"],c);const d=g(e,["mediaResolution"]);t!==void 0&&d!=null&&C(t,["setup","generationConfig","mediaResolution"],d);const u=g(e,["seed"]);t!==void 0&&u!=null&&C(t,["setup","generationConfig","seed"],u);const p=g(e,["speechConfig"]);t!==void 0&&p!=null&&C(t,["setup","generationConfig","speechConfig"],Up(p));const m=g(e,["thinkingConfig"]);t!==void 0&&m!=null&&C(t,["setup","generationConfig","thinkingConfig"],m);const w=g(e,["enableAffectiveDialog"]);t!==void 0&&w!=null&&C(t,["setup","generationConfig","enableAffectiveDialog"],w);const k=g(e,["systemInstruction"]);t!==void 0&&k!=null&&C(t,["setup","systemInstruction"],NN(Tn(k)));const b=g(e,["tools"]);if(t!==void 0&&b!=null){let E=Ka(b);Array.isArray(E)&&(E=E.map(I=>zN($a(I)))),C(t,["setup","tools"],E)}const x=g(e,["sessionResumption"]);t!==void 0&&x!=null&&C(t,["setup","sessionResumption"],DN(x));const f=g(e,["inputAudioTranscription"]);t!==void 0&&f!=null&&C(t,["setup","inputAudioTranscription"],f);const h=g(e,["outputAudioTranscription"]);t!==void 0&&h!=null&&C(t,["setup","outputAudioTranscription"],h);const v=g(e,["realtimeInputConfig"]);t!==void 0&&v!=null&&C(t,["setup","realtimeInputConfig"],v);const N=g(e,["contextWindowCompression"]);t!==void 0&&N!=null&&C(t,["setup","contextWindowCompression"],N);const _=g(e,["proactivity"]);if(t!==void 0&&_!=null&&C(t,["setup","proactivity"],_),g(e,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return o}function MN(e,t){const o={},r=g(t,["model"]);r!=null&&C(o,["setup","model"],Bt(e,r));const a=g(t,["config"]);return a!=null&&C(o,["config"],RN(a,o)),o}function LN(e){const t={},o=g(e,["mediaResolution"]);o!=null&&C(t,["mediaResolution"],o);const r=g(e,["codeExecutionResult"]);r!=null&&C(t,["codeExecutionResult"],r);const a=g(e,["executableCode"]);a!=null&&C(t,["executableCode"],a);const i=g(e,["fileData"]);i!=null&&C(t,["fileData"],jN(i));const s=g(e,["functionCall"]);s!=null&&C(t,["functionCall"],IN(s));const l=g(e,["functionResponse"]);l!=null&&C(t,["functionResponse"],l);const c=g(e,["inlineData"]);c!=null&&C(t,["inlineData"],SN(c));const d=g(e,["text"]);d!=null&&C(t,["text"],d);const u=g(e,["thought"]);u!=null&&C(t,["thought"],u);const p=g(e,["thoughtSignature"]);p!=null&&C(t,["thoughtSignature"],p);const m=g(e,["videoMetadata"]);return m!=null&&C(t,["videoMetadata"],m),t}function DN(e){const t={},o=g(e,["handle"]);if(o!=null&&C(t,["handle"],o),g(e,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function zN(e){const t={};if(g(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const o=g(e,["computerUse"]);o!=null&&C(t,["computerUse"],o);const r=g(e,["fileSearch"]);r!=null&&C(t,["fileSearch"],r);const a=g(e,["codeExecution"]);if(a!=null&&C(t,["codeExecution"],a),g(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const i=g(e,["functionDeclarations"]);if(i!=null){let u=i;Array.isArray(u)&&(u=u.map(p=>p)),C(t,["functionDeclarations"],u)}const s=g(e,["googleMaps"]);s!=null&&C(t,["googleMaps"],TN(s));const l=g(e,["googleSearch"]);l!=null&&C(t,["googleSearch"],AN(l));const c=g(e,["googleSearchRetrieval"]);c!=null&&C(t,["googleSearchRetrieval"],c);const d=g(e,["urlContext"]);return d!=null&&C(t,["urlContext"],d),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function qN(e){const t=[];for(const o in e)if(Object.prototype.hasOwnProperty.call(e,o)){const r=e[o];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){const a=Object.keys(r).map(i=>`${o}.${i}`);t.push(...a)}else t.push(o)}return t.join(",")}function ON(e,t){let o=null;const r=e.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){const i=r.setup;typeof i=="object"&&i!==null?(e.bidiGenerateContentSetup=i,o=i):delete e.bidiGenerateContentSetup}else r!==void 0&&delete e.bidiGenerateContentSetup;const a=e.fieldMask;if(o){const i=qN(o);if(Array.isArray(t==null?void 0:t.lockAdditionalFields)&&(t==null?void 0:t.lockAdditionalFields.length)===0)i?e.fieldMask=i:delete e.fieldMask;else if(t!=null&&t.lockAdditionalFields&&t.lockAdditionalFields.length>0&&a!==null&&Array.isArray(a)&&a.length>0){const s=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let l=[];a.length>0&&(l=a.map(d=>s.includes(d)?`generationConfig.${d}`:d));const c=[];i&&c.push(i),l.length>0&&c.push(...l),c.length>0?e.fieldMask=c.join(","):delete e.fieldMask}else delete e.fieldMask}else a!==null&&Array.isArray(a)&&a.length>0?e.fieldMask=a.join(","):delete e.fieldMask;return e}class FN extends Xo{constructor(t){super(),this.apiClient=t}async create(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const l=PN(this.apiClient,t);i=xt("auth_tokens",l._url),s=l._query,delete l.config,delete l._url,delete l._query;const c=ON(l,t.config);return a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>d)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function BN(e,t){const o={},r=g(e,["force"]);return t!==void 0&&r!=null&&C(t,["_query","force"],r),o}function HN(e){const t={},o=g(e,["name"]);o!=null&&C(t,["_url","name"],o);const r=g(e,["config"]);return r!=null&&BN(r,t),t}function GN(e){const t={},o=g(e,["name"]);return o!=null&&C(t,["_url","name"],o),t}function UN(e,t){const o={},r=g(e,["pageSize"]);t!==void 0&&r!=null&&C(t,["_query","pageSize"],r);const a=g(e,["pageToken"]);return t!==void 0&&a!=null&&C(t,["_query","pageToken"],a),o}function VN(e){const t={},o=g(e,["parent"]);o!=null&&C(t,["_url","parent"],o);const r=g(e,["config"]);return r!=null&&UN(r,t),t}function WN(e){const t={},o=g(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=g(e,["nextPageToken"]);r!=null&&C(t,["nextPageToken"],r);const a=g(e,["documents"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),C(t,["documents"],i)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class $N extends Xo{constructor(t){super(),this.apiClient=t,this.list=async o=>new Kr(Jo.PAGED_ITEM_DOCUMENTS,r=>this.listInternal({parent:o.parent,config:r.config}),await this.listInternal(o),o)}async get(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=GN(t);return i=xt("{name}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async delete(t){var o,r;let a="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=HN(t);a=xt("{name}",s._url),i=s._query,delete s._url,delete s._query,await this.apiClient.request({path:a,queryParams:i,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=VN(t);return i=xt("{parent}/documents",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=WN(c),u=new S5;return Object.assign(u,d),u})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class KN extends Xo{constructor(t,o=new $N(t)){super(),this.apiClient=t,this.documents=o,this.list=async(r={})=>new Kr(Jo.PAGED_ITEM_FILE_SEARCH_STORES,a=>this.listInternal(a),await this.listInternal(r),r)}async uploadToFileSearchStore(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(t.fileSearchStoreName,t.file,t.config)}async create(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=qS(t);return i=xt("fileSearchStores",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async get(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=BS(t);return i=xt("{name}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async delete(t){var o,r;let a="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=FS(t);a=xt("{name}",s._url),i=s._query,delete s._url,delete s._query,await this.apiClient.request({path:a,queryParams:i,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=$S(t);return i=xt("fileSearchStores",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=KS(c),u=new N5;return Object.assign(u,d),u})}}async uploadToFileSearchStoreInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=JS(t);return i=xt("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=YS(c),u=new E5;return Object.assign(u,d),u})}}async importFile(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=US(t);return i=xt("{file_search_store_name}:importFile",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=GS(c),u=new Op;return Object.assign(u,d),u})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let M1=function(){const{crypto:e}=globalThis;if(e!=null&&e.randomUUID)return M1=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),o=e?()=>e.getRandomValues(t)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^o()&15>>+r/4).toString(16))};const JN=()=>M1();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Su(e){return typeof e=="object"&&e!==null&&("name"in e&&e.name==="AbortError"||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const Nu=e=>{if(e instanceof Error)return e;if(typeof e=="object"&&e!==null){try{if(Object.prototype.toString.call(e)==="[object Error]"){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class uo extends Error{}class zn extends uo{constructor(t,o,r,a){super(`${zn.makeMessage(t,o,r)}`),this.status=t,this.headers=a,this.error=o}static makeMessage(t,o,r){const a=o!=null&&o.message?typeof o.message=="string"?o.message:JSON.stringify(o.message):o?JSON.stringify(o):r;return t&&a?`${t} ${a}`:t?`${t} status code (no body)`:a||"(no status code or body)"}static generate(t,o,r,a){if(!t||!a)return new ec({message:r,cause:Nu(o)});const i=o;return t===400?new D1(t,i,r,a):t===401?new z1(t,i,r,a):t===403?new q1(t,i,r,a):t===404?new O1(t,i,r,a):t===409?new F1(t,i,r,a):t===422?new B1(t,i,r,a):t===429?new H1(t,i,r,a):t>=500?new G1(t,i,r,a):new zn(t,i,r,a)}}class Eu extends zn{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}}class ec extends zn{constructor({message:t,cause:o}){super(void 0,void 0,t||"Connection error.",void 0),o&&(this.cause=o)}}class L1 extends ec{constructor({message:t}={}){super({message:t??"Request timed out."})}}class D1 extends zn{}class z1 extends zn{}class q1 extends zn{}class O1 extends zn{}class F1 extends zn{}class B1 extends zn{}class H1 extends zn{}class G1 extends zn{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const YN=/^[a-z][a-z0-9+.-]*:/i,XN=e=>YN.test(e);let Pu=e=>(Pu=Array.isArray,Pu(e));const ZN=Pu;let QN=ZN;const Wg=QN;function e3(e){if(!e)return!0;for(const t in e)return!1;return!0}function t3(e,t){return Object.prototype.hasOwnProperty.call(e,t)}const n3=(e,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new uo(`${e} must be an integer`);if(t<0)throw new uo(`${e} must be a positive integer`);return t},o3=e=>{try{return JSON.parse(e)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const r3=e=>new Promise(t=>setTimeout(t,e));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const aa="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function a3(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const i3=()=>{var e,t,o,r,a;const i=a3();if(i==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":aa,"X-Stainless-OS":Kg(Deno.build.os),"X-Stainless-Arch":$g(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(t=(e=Deno.version)===null||e===void 0?void 0:e.deno)!==null&&t!==void 0?t:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":aa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(i==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":aa,"X-Stainless-OS":Kg((o=globalThis.process.platform)!==null&&o!==void 0?o:"unknown"),"X-Stainless-Arch":$g((r=globalThis.process.arch)!==null&&r!==void 0?r:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(a=globalThis.process.version)!==null&&a!==void 0?a:"unknown"};const s=s3();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":aa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":aa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function s3(){if(typeof navigator>"u"||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:o}of e){const r=o.exec(navigator.userAgent);if(r){const a=r[1]||0,i=r[2]||0,s=r[3]||0;return{browser:t,version:`${a}.${i}.${s}`}}}return null}const $g=e=>e==="x32"?"x32":e==="x86_64"||e==="x64"?"x64":e==="arm"?"arm":e==="aarch64"||e==="arm64"?"arm64":e?`other:${e}`:"unknown",Kg=e=>(e=e.toLowerCase(),e.includes("ios")?"iOS":e==="android"?"Android":e==="darwin"?"MacOS":e==="win32"?"Windows":e==="freebsd"?"FreeBSD":e==="openbsd"?"OpenBSD":e==="linux"?"Linux":e?`Other:${e}`:"Unknown");let gs;const l3=()=>gs??(gs=i3());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function c3(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function U1(...e){const t=globalThis.ReadableStream;if(typeof t>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function d3(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return U1({start(){},async pull(o){const{done:r,value:a}=await t.next();r?o.close():o.enqueue(a)},async cancel(){var o;await((o=t.return)===null||o===void 0?void 0:o.call(t))}})}function V1(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const o=await t.read();return o!=null&&o.done&&t.releaseLock(),o}catch(o){throw t.releaseLock(),o}},async return(){const o=t.cancel();return t.releaseLock(),await o,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function u3(e){var t,o;if(e===null||typeof e!="object")return;if(e[Symbol.asyncIterator]){await((o=(t=e[Symbol.asyncIterator]()).return)===null||o===void 0?void 0:o.call(t));return}const r=e.getReader(),a=r.cancel();r.releaseLock(),await a}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const p3=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const W1=()=>{var e;if(typeof File>"u"){const{process:t}=globalThis,o=typeof((e=t==null?void 0:t.versions)===null||e===void 0?void 0:e.node)=="string"&&parseInt(t.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(o?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function ld(e,t,o){return W1(),new File(e,t??"unknown_file",o)}function h3(e){return(typeof e=="object"&&e!==null&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const m3=e=>e!=null&&typeof e=="object"&&typeof e[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const $1=e=>e!=null&&typeof e=="object"&&typeof e.size=="number"&&typeof e.type=="string"&&typeof e.text=="function"&&typeof e.slice=="function"&&typeof e.arrayBuffer=="function",g3=e=>e!=null&&typeof e=="object"&&typeof e.name=="string"&&typeof e.lastModified=="number"&&$1(e),f3=e=>e!=null&&typeof e=="object"&&typeof e.url=="string"&&typeof e.blob=="function";async function x3(e,t,o){if(W1(),e=await e,g3(e))return e instanceof File?e:ld([await e.arrayBuffer()],e.name);if(f3(e)){const a=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),ld(await ju(a),t,o)}const r=await ju(e);if(t||(t=h3(e)),!(o!=null&&o.type)){const a=r.find(i=>typeof i=="object"&&"type"in i&&i.type);typeof a=="string"&&(o=Object.assign(Object.assign({},o),{type:a}))}return ld(r,t,o)}async function ju(e){var t,o,r,a,i;let s=[];if(typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)s.push(e);else if($1(e))s.push(e instanceof Blob?e:await e.arrayBuffer());else if(m3(e))try{for(var l=!0,c=bo(e),d;d=await c.next(),t=d.done,!t;l=!0){a=d.value,l=!1;const u=a;s.push(...await ju(u))}}catch(u){o={error:u}}finally{try{!l&&!t&&(r=c.return)&&await r.call(c)}finally{if(o)throw o.error}}else{const u=(i=e==null?void 0:e.constructor)===null||i===void 0?void 0:i.name;throw new Error(`Unexpected data type: ${typeof e}${u?`; constructor: ${u}`:""}${y3(e)}`)}return s}function y3(e){return typeof e!="object"||e===null?"":`; props: [${Object.getOwnPropertyNames(e).map(o=>`"${o}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class K1{constructor(t){this._client=t}}K1._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function J1(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Jg=Object.freeze(Object.create(null)),v3=(e=J1)=>function(o,...r){if(o.length===1)return o[0];let a=!1;const i=[],s=o.reduce((u,p,m)=>{var w,k,b;/[?#]/.test(p)&&(a=!0);const x=r[m];let f=(a?encodeURIComponent:e)(""+x);return m!==r.length&&(x==null||typeof x=="object"&&x.toString===((b=Object.getPrototypeOf((k=Object.getPrototypeOf((w=x.hasOwnProperty)!==null&&w!==void 0?w:Jg))!==null&&k!==void 0?k:Jg))===null||b===void 0?void 0:b.toString))&&(f=x+"",i.push({start:u.length+p.length,length:f.length,error:`Value of type ${Object.prototype.toString.call(x).slice(8,-1)} is not a valid path parameter`})),u+p+(m===r.length?"":f)},""),l=s.split(/[?#]/,1)[0],c=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let d;for(;(d=c.exec(l))!==null;)i.push({start:d.index,length:d[0].length,error:`Value "${d[0]}" can't be safely passed as a path parameter`});if(i.sort((u,p)=>u.start-p.start),i.length>0){let u=0;const p=i.reduce((m,w)=>{const k=" ".repeat(w.start-u),b="^".repeat(w.length);return u=w.start+w.length,m+k+b},"");throw new uo(`Path parameters result in path with invalid segments:
${i.map(m=>m.error).join(`
`)}
${s}
${p}`)}return s},fs=v3(J1);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Y1 extends K1{create(t,o){var r;const{api_version:a=this._client.apiVersion}=t,i=El(t,["api_version"]);if("model"in i&&"agent_config"in i)throw new uo("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in i&&"generation_config"in i)throw new uo("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(fs`/${a}/interactions`,Object.assign(Object.assign({body:i},o),{stream:(r=t.stream)!==null&&r!==void 0?r:!1}))}delete(t,o={},r){const{api_version:a=this._client.apiVersion}=o??{};return this._client.delete(fs`/${a}/interactions/${t}`,r)}cancel(t,o={},r){const{api_version:a=this._client.apiVersion}=o??{};return this._client.post(fs`/${a}/interactions/${t}/cancel`,r)}get(t,o={},r){var a;const i=o??{},{api_version:s=this._client.apiVersion}=i,l=El(i,["api_version"]);return this._client.get(fs`/${s}/interactions/${t}`,Object.assign(Object.assign({query:l},r),{stream:(a=o==null?void 0:o.stream)!==null&&a!==void 0?a:!1}))}}Y1._key=Object.freeze(["interactions"]);class X1 extends Y1{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function w3(e){let t=0;for(const a of e)t+=a.length;const o=new Uint8Array(t);let r=0;for(const a of e)o.set(a,r),r+=a.length;return o}let xs;function Wp(e){let t;return(xs??(t=new globalThis.TextEncoder,xs=t.encode.bind(t)))(e)}let ys;function Yg(e){let t;return(ys??(t=new globalThis.TextDecoder,ys=t.decode.bind(t)))(e)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class tc{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(t){if(t==null)return[];const o=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?Wp(t):t;this.buffer=w3([this.buffer,o]);const r=[];let a;for(;(a=b3(this.buffer,this.carriageReturnIndex))!=null;){if(a.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=a.index;continue}if(this.carriageReturnIndex!=null&&(a.index!==this.carriageReturnIndex+1||a.carriage)){r.push(Yg(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const i=this.carriageReturnIndex!==null?a.preceding-1:a.preceding,s=Yg(this.buffer.subarray(0,i));r.push(s),this.buffer=this.buffer.subarray(a.index),this.carriageReturnIndex=null}return r}flush(){return this.buffer.length?this.decode(`
`):[]}}tc.NEWLINE_CHARS=new Set([`
`,"\r"]);tc.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function b3(e,t){for(let a=t??0;a<e.length;a++){if(e[a]===10)return{preceding:a,index:a+1,carriage:!1};if(e[a]===13)return{preceding:a,index:a+1,carriage:!0}}return null}function C3(e){for(let r=0;r<e.length-1;r++){if(e[r]===10&&e[r+1]===10||e[r]===13&&e[r+1]===13)return r+2;if(e[r]===13&&e[r+1]===10&&r+3<e.length&&e[r+2]===13&&e[r+3]===10)return r+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Pl={off:0,error:200,warn:300,info:400,debug:500},Xg=(e,t,o)=>{if(e){if(t3(Pl,e))return e;Mn(o).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(Pl))}`)}};function pi(){}function vs(e,t,o){return!t||Pl[e]>Pl[o]?pi:t[e].bind(t)}const k3={error:pi,warn:pi,info:pi,debug:pi};let Zg=new WeakMap;function Mn(e){var t;const o=e.logger,r=(t=e.logLevel)!==null&&t!==void 0?t:"off";if(!o)return k3;const a=Zg.get(o);if(a&&a[0]===r)return a[1];const i={error:vs("error",o,r),warn:vs("warn",o,r),info:vs("info",o,r),debug:vs("debug",o,r)};return Zg.set(o,[r,i]),i}const Ar=e=>(e.options&&(e.options=Object.assign({},e.options),delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([t,o])=>[t,t.toLowerCase()==="x-goog-api-key"||t.toLowerCase()==="authorization"||t.toLowerCase()==="cookie"||t.toLowerCase()==="set-cookie"?"***":o]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class wa{constructor(t,o,r){this.iterator=t,this.controller=o,this.client=r}static fromSSEResponse(t,o,r){let a=!1;const i=r?Mn(r):console;function s(){return wo(this,arguments,function*(){var c,d,u,p;if(a)throw new uo("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let m=!1;try{try{for(var w=!0,k=bo(_3(t,o)),b;b=yield jt(k.next()),c=b.done,!c;w=!0){p=b.value,w=!1;const x=p;if(!m)if(x.data.startsWith("[DONE]")){m=!0;continue}else try{yield yield jt(JSON.parse(x.data))}catch(f){throw i.error("Could not parse message into JSON:",x.data),i.error("From chunk:",x.raw),f}}}catch(x){d={error:x}}finally{try{!w&&!c&&(u=k.return)&&(yield jt(u.call(k)))}finally{if(d)throw d.error}}m=!0}catch(x){if(Su(x))return yield jt(void 0);throw x}finally{m||o.abort()}})}return new wa(s,o,r)}static fromReadableStream(t,o,r){let a=!1;function i(){return wo(this,arguments,function*(){var c,d,u,p;const m=new tc,w=V1(t);try{for(var k=!0,b=bo(w),x;x=yield jt(b.next()),c=x.done,!c;k=!0){p=x.value,k=!1;const f=p;for(const h of m.decode(f))yield yield jt(h)}}catch(f){d={error:f}}finally{try{!k&&!c&&(u=b.return)&&(yield jt(u.call(b)))}finally{if(d)throw d.error}}for(const f of m.flush())yield yield jt(f)})}function s(){return wo(this,arguments,function*(){var c,d,u,p;if(a)throw new uo("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let m=!1;try{try{for(var w=!0,k=bo(i()),b;b=yield jt(k.next()),c=b.done,!c;w=!0){p=b.value,w=!1;const x=p;m||x&&(yield yield jt(JSON.parse(x)))}}catch(x){d={error:x}}finally{try{!w&&!c&&(u=k.return)&&(yield jt(u.call(k)))}finally{if(d)throw d.error}}m=!0}catch(x){if(Su(x))return yield jt(void 0);throw x}finally{m||o.abort()}})}return new wa(s,o,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){const t=[],o=[],r=this.iterator(),a=i=>({next:()=>{if(i.length===0){const s=r.next();t.push(s),o.push(s)}return i.shift()}});return[new wa(()=>a(t),this.controller,this.client),new wa(()=>a(o),this.controller,this.client)]}toReadableStream(){const t=this;let o;return U1({async start(){o=t[Symbol.asyncIterator]()},async pull(r){try{const{value:a,done:i}=await o.next();if(i)return r.close();const s=Wp(JSON.stringify(a)+`
`);r.enqueue(s)}catch(a){r.error(a)}},async cancel(){var r;await((r=o.return)===null||r===void 0?void 0:r.call(o))}})}}function _3(e,t){return wo(this,arguments,function*(){var r,a,i,s;if(!e.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new uo("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new uo("Attempted to iterate over a response with no body");const l=new N3,c=new tc,d=V1(e.body);try{for(var u=!0,p=bo(S3(d)),m;m=yield jt(p.next()),r=m.done,!r;u=!0){s=m.value,u=!1;const w=s;for(const k of c.decode(w)){const b=l.decode(k);b&&(yield yield jt(b))}}}catch(w){a={error:w}}finally{try{!u&&!r&&(i=p.return)&&(yield jt(i.call(p)))}finally{if(a)throw a.error}}for(const w of c.flush()){const k=l.decode(w);k&&(yield yield jt(k))}})}function S3(e){return wo(this,arguments,function*(){var o,r,a,i;let s=new Uint8Array;try{for(var l=!0,c=bo(e),d;d=yield jt(c.next()),o=d.done,!o;l=!0){i=d.value,l=!1;const u=i;if(u==null)continue;const p=u instanceof ArrayBuffer?new Uint8Array(u):typeof u=="string"?Wp(u):u;let m=new Uint8Array(s.length+p.length);m.set(s),m.set(p,s.length),s=m;let w;for(;(w=C3(s))!==-1;)yield yield jt(s.slice(0,w)),s=s.slice(w)}}catch(u){r={error:u}}finally{try{!l&&!o&&(a=c.return)&&(yield jt(a.call(c)))}finally{if(r)throw r.error}}s.length>0&&(yield yield jt(s))})}class N3{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(t),t.startsWith(":"))return null;let[o,r,a]=E3(t,":");return a.startsWith(" ")&&(a=a.substring(1)),o==="event"?this.event=a:o==="data"&&this.data.push(a),null}}function E3(e,t){const o=e.indexOf(t);return o!==-1?[e.substring(0,o),t,e.substring(o+t.length)]:[e,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function P3(e,t){const{response:o,requestLogID:r,retryOfRequestLogID:a,startTime:i}=t,s=await(async()=>{var l;if(t.options.stream)return Mn(e).debug("response",o.status,o.url,o.headers,o.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(o,t.controller,e):wa.fromSSEResponse(o,t.controller,e);if(o.status===204)return null;if(t.options.__binaryResponse)return o;const c=o.headers.get("content-type"),d=(l=c==null?void 0:c.split(";")[0])===null||l===void 0?void 0:l.trim();return(d==null?void 0:d.includes("application/json"))||(d==null?void 0:d.endsWith("+json"))?await o.json():await o.text()})();return Mn(e).debug(`[${r}] response parsed`,Ar({retryOfRequestLogID:a,url:o.url,status:o.status,body:s,durationMs:Date.now()-i})),s}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class $p extends Promise{constructor(t,o,r=P3){super(a=>{a(null)}),this.responsePromise=o,this.parseResponse=r,this.client=t}_thenUnwrap(t){return new $p(this.client,this.responsePromise,async(o,r)=>t(await this.parseResponse(o,r),r))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){const[t,o]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:o}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(t=>this.parseResponse(this.client,t))),this.parsedPromise}then(t,o){return this.parse().then(t,o)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Z1=Symbol("brand.privateNullableHeaders");function*j3(e){if(!e)return;if(Z1 in e){const{values:r,nulls:a}=e;yield*r.entries();for(const i of a)yield[i,null];return}let t=!1,o;e instanceof Headers?o=e.entries():Wg(e)?o=e:(t=!0,o=Object.entries(e??{}));for(let r of o){const a=r[0];if(typeof a!="string")throw new TypeError("expected header name to be a string");const i=Wg(r[1])?r[1]:[r[1]];let s=!1;for(const l of i)l!==void 0&&(t&&!s&&(s=!0,yield[a,null]),yield[a,l])}}const si=e=>{const t=new Headers,o=new Set;for(const r of e){const a=new Set;for(const[i,s]of j3(r)){const l=i.toLowerCase();a.has(l)||(t.delete(i),a.add(l)),s===null?(t.delete(i),o.add(l)):(t.append(i,s),o.delete(l))}}return{[Z1]:!0,values:t,nulls:o}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const cd=e=>{var t,o,r,a,i,s;if(typeof globalThis.process<"u")return(r=(o=(t=e5)===null||t===void 0?void 0:t[e])===null||o===void 0?void 0:o.trim())!==null&&r!==void 0?r:void 0;if(typeof globalThis.Deno<"u")return(s=(i=(a=globalThis.Deno.env)===null||a===void 0?void 0:a.get)===null||i===void 0?void 0:i.call(a,e))===null||s===void 0?void 0:s.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Q1;class nc{constructor(t){var o,r,a,i,s,l,c,{baseURL:d=cd("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:u=(o=cd("GEMINI_API_KEY"))!==null&&o!==void 0?o:null,apiVersion:p="v1beta"}=t,m=El(t,["baseURL","apiKey","apiVersion"]);const w=Object.assign(Object.assign({apiKey:u,apiVersion:p},m),{baseURL:d||"https://generativelanguage.googleapis.com"});this.baseURL=w.baseURL,this.timeout=(r=w.timeout)!==null&&r!==void 0?r:nc.DEFAULT_TIMEOUT,this.logger=(a=w.logger)!==null&&a!==void 0?a:console;const k="warn";this.logLevel=k,this.logLevel=(s=(i=Xg(w.logLevel,"ClientOptions.logLevel",this))!==null&&i!==void 0?i:Xg(cd("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&s!==void 0?s:k,this.fetchOptions=w.fetchOptions,this.maxRetries=(l=w.maxRetries)!==null&&l!==void 0?l:2,this.fetch=(c=w.fetch)!==null&&c!==void 0?c:c3(),this.encoder=p3,this._options=w,this.apiKey=u,this.apiVersion=p,this.clientAdapter=w.clientAdapter}withOptions(t){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),t))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:o}){if(!(t.has("authorization")||t.has("x-goog-api-key"))&&!(this.apiKey&&t.get("x-goog-api-key"))&&!o.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(t){const o=si([t.headers]);if(!(o.values.has("authorization")||o.values.has("x-goog-api-key"))){if(this.apiKey)return si([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return si([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(t){return Object.entries(t).filter(([o,r])=>typeof r<"u").map(([o,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(o)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(o)}=`;throw new uo(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${aa}`}defaultIdempotencyKey(){return`stainless-node-retry-${JN()}`}makeStatusError(t,o,r,a){return zn.generate(t,o,r,a)}buildURL(t,o,r){const a=!this.baseURLOverridden()&&r||this.baseURL,i=XN(t)?new URL(t):new URL(a+(a.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),s=this.defaultQuery();return e3(s)||(o=Object.assign(Object.assign({},s),o)),typeof o=="object"&&o&&!Array.isArray(o)&&(i.search=this.stringifyQuery(o)),i.toString()}async prepareOptions(t){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!t.path.startsWith(`/${this.apiVersion}/projects/`)){const o=t.path.slice(this.apiVersion.length+1);t.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${o}`}}async prepareRequest(t,{url:o,options:r}){}get(t,o){return this.methodRequest("get",t,o)}post(t,o){return this.methodRequest("post",t,o)}patch(t,o){return this.methodRequest("patch",t,o)}put(t,o){return this.methodRequest("put",t,o)}delete(t,o){return this.methodRequest("delete",t,o)}methodRequest(t,o,r){return this.request(Promise.resolve(r).then(a=>Object.assign({method:t,path:o},a)))}request(t,o=null){return new $p(this,this.makeRequest(t,o,void 0))}async makeRequest(t,o,r){var a,i,s;const l=await t,c=(a=l.maxRetries)!==null&&a!==void 0?a:this.maxRetries;o==null&&(o=c),await this.prepareOptions(l);const{req:d,url:u,timeout:p}=await this.buildRequest(l,{retryCount:c-o});await this.prepareRequest(d,{url:u,options:l});const m="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),w=r===void 0?"":`, retryOf: ${r}`,k=Date.now();if(Mn(this).debug(`[${m}] sending request`,Ar({retryOfRequestLogID:r,method:l.method,url:u,options:l,headers:d.headers})),!((i=l.signal)===null||i===void 0)&&i.aborted)throw new Eu;const b=new AbortController,x=await this.fetchWithTimeout(u,d,p,b).catch(Nu),f=Date.now();if(x instanceof globalThis.Error){const v=`retrying, ${o} attempts remaining`;if(!((s=l.signal)===null||s===void 0)&&s.aborted)throw new Eu;const N=Su(x)||/timed? ?out/i.test(String(x)+("cause"in x?String(x.cause):""));if(o)return Mn(this).info(`[${m}] connection ${N?"timed out":"failed"} - ${v}`),Mn(this).debug(`[${m}] connection ${N?"timed out":"failed"} (${v})`,Ar({retryOfRequestLogID:r,url:u,durationMs:f-k,message:x.message})),this.retryRequest(l,o,r??m);throw Mn(this).info(`[${m}] connection ${N?"timed out":"failed"} - error; no more retries left`),Mn(this).debug(`[${m}] connection ${N?"timed out":"failed"} (error; no more retries left)`,Ar({retryOfRequestLogID:r,url:u,durationMs:f-k,message:x.message})),N?new L1:new ec({cause:x})}const h=`[${m}${w}] ${d.method} ${u} ${x.ok?"succeeded":"failed"} with status ${x.status} in ${f-k}ms`;if(!x.ok){const v=await this.shouldRetry(x);if(o&&v){const M=`retrying, ${o} attempts remaining`;return await u3(x.body),Mn(this).info(`${h} - ${M}`),Mn(this).debug(`[${m}] response error (${M})`,Ar({retryOfRequestLogID:r,url:x.url,status:x.status,headers:x.headers,durationMs:f-k})),this.retryRequest(l,o,r??m,x.headers)}const N=v?"error; no more retries left":"error; not retryable";Mn(this).info(`${h} - ${N}`);const _=await x.text().catch(M=>Nu(M).message),E=o3(_),I=E?void 0:_;throw Mn(this).debug(`[${m}] response error (${N})`,Ar({retryOfRequestLogID:r,url:x.url,status:x.status,headers:x.headers,message:I,durationMs:Date.now()-k})),this.makeStatusError(x.status,E,I,x.headers)}return Mn(this).info(h),Mn(this).debug(`[${m}] response start`,Ar({retryOfRequestLogID:r,url:x.url,status:x.status,headers:x.headers,durationMs:f-k})),{response:x,options:l,controller:b,requestLogID:m,retryOfRequestLogID:r,startTime:k}}async fetchWithTimeout(t,o,r,a){const i=o||{},{signal:s,method:l}=i,c=El(i,["signal","method"]);s&&s.addEventListener("abort",()=>a.abort());const d=setTimeout(()=>a.abort(),r),u=globalThis.ReadableStream&&c.body instanceof globalThis.ReadableStream||typeof c.body=="object"&&c.body!==null&&Symbol.asyncIterator in c.body,p=Object.assign(Object.assign(Object.assign({signal:a.signal},u?{duplex:"half"}:{}),{method:"GET"}),c);l&&(p.method=l.toUpperCase());try{return await this.fetch.call(void 0,t,p)}finally{clearTimeout(d)}}async shouldRetry(t){const o=t.headers.get("x-should-retry");return o==="true"?!0:o==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,o,r,a){var i;let s;const l=a==null?void 0:a.get("retry-after-ms");if(l){const d=parseFloat(l);Number.isNaN(d)||(s=d)}const c=a==null?void 0:a.get("retry-after");if(c&&!s){const d=parseFloat(c);Number.isNaN(d)?s=Date.parse(c)-Date.now():s=d*1e3}if(!(s&&0<=s&&s<60*1e3)){const d=(i=t.maxRetries)!==null&&i!==void 0?i:this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(o,d)}return await r3(s),this.makeRequest(t,o-1,r)}calculateDefaultRetryTimeoutMillis(t,o){const i=o-t,s=Math.min(.5*Math.pow(2,i),8),l=1-Math.random()*.25;return s*l*1e3}async buildRequest(t,{retryCount:o=0}={}){var r,a,i;const s=Object.assign({},t),{method:l,path:c,query:d,defaultBaseURL:u}=s,p=this.buildURL(c,d,u);"timeout"in s&&n3("timeout",s.timeout),s.timeout=(r=s.timeout)!==null&&r!==void 0?r:this.timeout;const{bodyHeaders:m,body:w}=this.buildBody({options:s}),k=await this.buildHeaders({options:t,method:l,bodyHeaders:m,retryCount:o});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:l,headers:k},s.signal&&{signal:s.signal}),globalThis.ReadableStream&&w instanceof globalThis.ReadableStream&&{duplex:"half"}),w&&{body:w}),(a=this.fetchOptions)!==null&&a!==void 0?a:{}),(i=s.fetchOptions)!==null&&i!==void 0?i:{}),url:p,timeout:s.timeout}}async buildHeaders({options:t,method:o,bodyHeaders:r,retryCount:a}){let i={};this.idempotencyHeader&&o!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=t.idempotencyKey);const s=await this.authHeaders(t);let l=si([i,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(a)},t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{}),l3()),this._options.defaultHeaders,r,t.headers,s]);return this.validateHeaders(l),l.values}buildBody({options:{body:t,headers:o}}){if(!t)return{bodyHeaders:void 0,body:void 0};const r=si([o]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&r.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:d3(t)}:this.encoder({body:t,headers:r})}}nc.DEFAULT_TIMEOUT=6e4;class kn extends nc{constructor(){super(...arguments),this.interactions=new X1(this)}}Q1=kn;kn.GeminiNextGenAPIClient=Q1;kn.GeminiNextGenAPIClientError=uo;kn.APIError=zn;kn.APIConnectionError=ec;kn.APIConnectionTimeoutError=L1;kn.APIUserAbortError=Eu;kn.NotFoundError=O1;kn.ConflictError=F1;kn.RateLimitError=H1;kn.BadRequestError=D1;kn.AuthenticationError=z1;kn.InternalServerError=G1;kn.PermissionDeniedError=q1;kn.UnprocessableEntityError=B1;kn.toFile=x3;kn.Interactions=X1;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function I3(e,t){const o={},r=g(e,["name"]);return r!=null&&C(o,["_url","name"],r),o}function T3(e,t){const o={},r=g(e,["name"]);return r!=null&&C(o,["_url","name"],r),o}function A3(e,t){const o={},r=g(e,["sdkHttpResponse"]);return r!=null&&C(o,["sdkHttpResponse"],r),o}function R3(e,t){const o={},r=g(e,["sdkHttpResponse"]);return r!=null&&C(o,["sdkHttpResponse"],r),o}function M3(e,t,o){const r={};if(g(e,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const a=g(e,["tunedModelDisplayName"]);if(t!==void 0&&a!=null&&C(t,["displayName"],a),g(e,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const i=g(e,["epochCount"]);t!==void 0&&i!=null&&C(t,["tuningTask","hyperparameters","epochCount"],i);const s=g(e,["learningRateMultiplier"]);if(s!=null&&C(r,["tuningTask","hyperparameters","learningRateMultiplier"],s),g(e,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(g(e,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(g(e,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const l=g(e,["batchSize"]);t!==void 0&&l!=null&&C(t,["tuningTask","hyperparameters","batchSize"],l);const c=g(e,["learningRate"]);if(t!==void 0&&c!=null&&C(t,["tuningTask","hyperparameters","learningRate"],c),g(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(g(e,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return r}function L3(e,t,o){const r={};let a=g(o,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const w=g(e,["validationDataset"]);t!==void 0&&w!=null&&C(t,["supervisedTuningSpec"],Qg(w))}else if(a==="PREFERENCE_TUNING"){const w=g(e,["validationDataset"]);t!==void 0&&w!=null&&C(t,["preferenceOptimizationSpec"],Qg(w))}const i=g(e,["tunedModelDisplayName"]);t!==void 0&&i!=null&&C(t,["tunedModelDisplayName"],i);const s=g(e,["description"]);t!==void 0&&s!=null&&C(t,["description"],s);let l=g(o,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){const w=g(e,["epochCount"]);t!==void 0&&w!=null&&C(t,["supervisedTuningSpec","hyperParameters","epochCount"],w)}else if(l==="PREFERENCE_TUNING"){const w=g(e,["epochCount"]);t!==void 0&&w!=null&&C(t,["preferenceOptimizationSpec","hyperParameters","epochCount"],w)}let c=g(o,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){const w=g(e,["learningRateMultiplier"]);t!==void 0&&w!=null&&C(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],w)}else if(c==="PREFERENCE_TUNING"){const w=g(e,["learningRateMultiplier"]);t!==void 0&&w!=null&&C(t,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],w)}let d=g(o,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const w=g(e,["exportLastCheckpointOnly"]);t!==void 0&&w!=null&&C(t,["supervisedTuningSpec","exportLastCheckpointOnly"],w)}else if(d==="PREFERENCE_TUNING"){const w=g(e,["exportLastCheckpointOnly"]);t!==void 0&&w!=null&&C(t,["preferenceOptimizationSpec","exportLastCheckpointOnly"],w)}let u=g(o,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const w=g(e,["adapterSize"]);t!==void 0&&w!=null&&C(t,["supervisedTuningSpec","hyperParameters","adapterSize"],w)}else if(u==="PREFERENCE_TUNING"){const w=g(e,["adapterSize"]);t!==void 0&&w!=null&&C(t,["preferenceOptimizationSpec","hyperParameters","adapterSize"],w)}if(g(e,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(g(e,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const p=g(e,["labels"]);t!==void 0&&p!=null&&C(t,["labels"],p);const m=g(e,["beta"]);return t!==void 0&&m!=null&&C(t,["preferenceOptimizationSpec","hyperParameters","beta"],m),r}function D3(e,t){const o={},r=g(e,["baseModel"]);r!=null&&C(o,["baseModel"],r);const a=g(e,["preTunedModel"]);a!=null&&C(o,["preTunedModel"],a);const i=g(e,["trainingDataset"]);i!=null&&$3(i);const s=g(e,["config"]);return s!=null&&M3(s,o),o}function z3(e,t){const o={},r=g(e,["baseModel"]);r!=null&&C(o,["baseModel"],r);const a=g(e,["preTunedModel"]);a!=null&&C(o,["preTunedModel"],a);const i=g(e,["trainingDataset"]);i!=null&&K3(i,o,t);const s=g(e,["config"]);return s!=null&&L3(s,o,t),o}function q3(e,t){const o={},r=g(e,["name"]);return r!=null&&C(o,["_url","name"],r),o}function O3(e,t){const o={},r=g(e,["name"]);return r!=null&&C(o,["_url","name"],r),o}function F3(e,t,o){const r={},a=g(e,["pageSize"]);t!==void 0&&a!=null&&C(t,["_query","pageSize"],a);const i=g(e,["pageToken"]);t!==void 0&&i!=null&&C(t,["_query","pageToken"],i);const s=g(e,["filter"]);return t!==void 0&&s!=null&&C(t,["_query","filter"],s),r}function B3(e,t,o){const r={},a=g(e,["pageSize"]);t!==void 0&&a!=null&&C(t,["_query","pageSize"],a);const i=g(e,["pageToken"]);t!==void 0&&i!=null&&C(t,["_query","pageToken"],i);const s=g(e,["filter"]);return t!==void 0&&s!=null&&C(t,["_query","filter"],s),r}function H3(e,t){const o={},r=g(e,["config"]);return r!=null&&F3(r,o),o}function G3(e,t){const o={},r=g(e,["config"]);return r!=null&&B3(r,o),o}function U3(e,t){const o={},r=g(e,["sdkHttpResponse"]);r!=null&&C(o,["sdkHttpResponse"],r);const a=g(e,["nextPageToken"]);a!=null&&C(o,["nextPageToken"],a);const i=g(e,["tunedModels"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>ey(l))),C(o,["tuningJobs"],s)}return o}function V3(e,t){const o={},r=g(e,["sdkHttpResponse"]);r!=null&&C(o,["sdkHttpResponse"],r);const a=g(e,["nextPageToken"]);a!=null&&C(o,["nextPageToken"],a);const i=g(e,["tuningJobs"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>Iu(l))),C(o,["tuningJobs"],s)}return o}function W3(e,t){const o={},r=g(e,["name"]);r!=null&&C(o,["model"],r);const a=g(e,["name"]);return a!=null&&C(o,["endpoint"],a),o}function $3(e,t){const o={};if(g(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(g(e,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const r=g(e,["examples"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>i)),C(o,["examples","examples"],a)}return o}function K3(e,t,o){const r={};let a=g(o,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const s=g(e,["gcsUri"]);t!==void 0&&s!=null&&C(t,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(a==="PREFERENCE_TUNING"){const s=g(e,["gcsUri"]);t!==void 0&&s!=null&&C(t,["preferenceOptimizationSpec","trainingDatasetUri"],s)}let i=g(o,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const s=g(e,["vertexDatasetResource"]);t!==void 0&&s!=null&&C(t,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(i==="PREFERENCE_TUNING"){const s=g(e,["vertexDatasetResource"]);t!==void 0&&s!=null&&C(t,["preferenceOptimizationSpec","trainingDatasetUri"],s)}if(g(e,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return r}function ey(e,t){const o={},r=g(e,["sdkHttpResponse"]);r!=null&&C(o,["sdkHttpResponse"],r);const a=g(e,["name"]);a!=null&&C(o,["name"],a);const i=g(e,["state"]);i!=null&&C(o,["state"],f1(i));const s=g(e,["createTime"]);s!=null&&C(o,["createTime"],s);const l=g(e,["tuningTask","startTime"]);l!=null&&C(o,["startTime"],l);const c=g(e,["tuningTask","completeTime"]);c!=null&&C(o,["endTime"],c);const d=g(e,["updateTime"]);d!=null&&C(o,["updateTime"],d);const u=g(e,["description"]);u!=null&&C(o,["description"],u);const p=g(e,["baseModel"]);p!=null&&C(o,["baseModel"],p);const m=g(e,["_self"]);return m!=null&&C(o,["tunedModel"],W3(m)),o}function Iu(e,t){const o={},r=g(e,["sdkHttpResponse"]);r!=null&&C(o,["sdkHttpResponse"],r);const a=g(e,["name"]);a!=null&&C(o,["name"],a);const i=g(e,["state"]);i!=null&&C(o,["state"],f1(i));const s=g(e,["createTime"]);s!=null&&C(o,["createTime"],s);const l=g(e,["startTime"]);l!=null&&C(o,["startTime"],l);const c=g(e,["endTime"]);c!=null&&C(o,["endTime"],c);const d=g(e,["updateTime"]);d!=null&&C(o,["updateTime"],d);const u=g(e,["error"]);u!=null&&C(o,["error"],u);const p=g(e,["description"]);p!=null&&C(o,["description"],p);const m=g(e,["baseModel"]);m!=null&&C(o,["baseModel"],m);const w=g(e,["tunedModel"]);w!=null&&C(o,["tunedModel"],w);const k=g(e,["preTunedModel"]);k!=null&&C(o,["preTunedModel"],k);const b=g(e,["supervisedTuningSpec"]);b!=null&&C(o,["supervisedTuningSpec"],b);const x=g(e,["preferenceOptimizationSpec"]);x!=null&&C(o,["preferenceOptimizationSpec"],x);const f=g(e,["tuningDataStats"]);f!=null&&C(o,["tuningDataStats"],f);const h=g(e,["encryptionSpec"]);h!=null&&C(o,["encryptionSpec"],h);const v=g(e,["partnerModelTuningSpec"]);v!=null&&C(o,["partnerModelTuningSpec"],v);const N=g(e,["customBaseModel"]);N!=null&&C(o,["customBaseModel"],N);const _=g(e,["experiment"]);_!=null&&C(o,["experiment"],_);const E=g(e,["labels"]);E!=null&&C(o,["labels"],E);const I=g(e,["outputUri"]);I!=null&&C(o,["outputUri"],I);const B=g(e,["pipelineJob"]);B!=null&&C(o,["pipelineJob"],B);const M=g(e,["serviceAccount"]);M!=null&&C(o,["serviceAccount"],M);const G=g(e,["tunedModelDisplayName"]);G!=null&&C(o,["tunedModelDisplayName"],G);const V=g(e,["veoTuningSpec"]);return V!=null&&C(o,["veoTuningSpec"],V),o}function J3(e,t){const o={},r=g(e,["sdkHttpResponse"]);r!=null&&C(o,["sdkHttpResponse"],r);const a=g(e,["name"]);a!=null&&C(o,["name"],a);const i=g(e,["metadata"]);i!=null&&C(o,["metadata"],i);const s=g(e,["done"]);s!=null&&C(o,["done"],s);const l=g(e,["error"]);return l!=null&&C(o,["error"],l),o}function Qg(e,t){const o={},r=g(e,["gcsUri"]);r!=null&&C(o,["validationDatasetUri"],r);const a=g(e,["vertexDatasetResource"]);return a!=null&&C(o,["validationDatasetUri"],a),o}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Y3 extends Xo{constructor(t){super(),this.apiClient=t,this.list=async(o={})=>new Kr(Jo.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(o),o),this.get=async o=>await this.getInternal(o),this.tune=async o=>{var r;if(this.apiClient.isVertexAI())if(o.baseModel.startsWith("projects/")){const a={tunedModelName:o.baseModel};!((r=o.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(a.checkpointId=o.config.preTunedModelCheckpointId);const i=Object.assign(Object.assign({},o),{preTunedModel:a});return i.baseModel=void 0,await this.tuneInternal(i)}else{const a=Object.assign({},o);return await this.tuneInternal(a)}else{const a=Object.assign({},o),i=await this.tuneMldevInternal(a);let s="";return i.metadata!==void 0&&i.metadata.tunedModel!==void 0?s=i.metadata.tunedModel:i.name!==void 0&&i.name.includes("/operations/")&&(s=i.name.split("/operations/")[0]),{name:s,state:xu.JOB_STATE_QUEUED}}}}async getInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=O3(t);return l=xt("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>Iu(u))}else{const d=q3(t);return l=xt("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>ey(u))}}async listInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=G3(t);return l=xt("tuningJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=V3(u),m=new Sg;return Object.assign(m,p),m})}else{const d=H3(t);return l=xt("tunedModels",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=U3(u),m=new Sg;return Object.assign(m,p),m})}}async cancel(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=T3(t);return l=xt("{name}:cancel",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=R3(u),m=new Ng;return Object.assign(m,p),m})}else{const d=I3(t);return l=xt("{name}:cancel",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:u.headers},m})),s.then(u=>{const p=A3(u),m=new Ng;return Object.assign(m,p),m})}}async tuneInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=z3(t,t);return i=xt("tuningJobs",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>Iu(c))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=D3(t);return i=xt("tunedModels",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>J3(c))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class X3{async download(t,o){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const Z3=1024*1024*8,Q3=3,eE=1e3,tE=2,jl="x-goog-upload-status";async function nE(e,t,o){var r;const a=await ty(e,t,o),i=await(a==null?void 0:a.json());if(((r=a==null?void 0:a.headers)===null||r===void 0?void 0:r[jl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return i.file}async function oE(e,t,o){var r;const a=await ty(e,t,o),i=await(a==null?void 0:a.json());if(((r=a==null?void 0:a.headers)===null||r===void 0?void 0:r[jl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const s=d1(i),l=new Fp;return Object.assign(l,s),l}async function ty(e,t,o){var r,a;let i=0,s=0,l=new vu(new Response),c="upload";for(i=e.size;s<i;){const d=Math.min(Z3,i-s),u=e.slice(s,s+d);s+d>=i&&(c+=", finalize");let p=0,m=eE;for(;p<Q3&&(l=await o.request({path:"",body:u,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(s),"Content-Length":String(d)}}}),!(!((r=l==null?void 0:l.headers)===null||r===void 0)&&r[jl]));)p++,await aE(m),m=m*tE;if(s+=d,((a=l==null?void 0:l.headers)===null||a===void 0?void 0:a[jl])!=="active")break;if(i<=s)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return l}async function rE(e){return{size:e.size,type:e.type}}function aE(e){return new Promise(t=>setTimeout(t,e))}class iE{async upload(t,o,r){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await nE(t,o,r)}async uploadToFileSearchStore(t,o,r){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await oE(t,o,r)}async stat(t){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await rE(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class sE{create(t,o,r){return new lE(t,o,r)}}class lE{constructor(t,o,r){this.url=t,this.headers=o,this.callbacks=r}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(t){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(t)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const e0="x-goog-api-key";class cE{constructor(t){this.apiKey=t}async addAuthHeaders(t,o){if(t.get(e0)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");t.append(e0,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const dE="gl-node/";class Kp{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const t=this.httpOptions;t!=null&&t.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const o=new kn({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:t==null?void 0:t.timeout});return this._interactions=o.interactions,this._interactions}constructor(t){var o;if(t.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(t.project||t.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(o=t.vertexai)!==null&&o!==void 0?o:!1,this.apiKey=t.apiKey;const r=r5(t.httpOptions,t.vertexai,void 0,void 0);r&&(t.httpOptions?t.httpOptions.baseUrl=r:t.httpOptions={baseUrl:r}),this.apiVersion=t.apiVersion,this.httpOptions=t.httpOptions;const a=new cE(this.apiKey);this.apiClient=new rN({auth:a,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:dE+"web",uploader:new iE,downloader:new X3}),this.models=new kN(this.apiClient),this.live=new xN(this.apiClient,a,new sE),this.batches=new Rk(this.apiClient),this.chats=new m4(this.models,this.apiClient),this.caches=new u4(this.apiClient),this.files=new _4(this.apiClient),this.operations=new _N(this.apiClient),this.authTokens=new FN(this.apiClient),this.tunings=new Y3(this.apiClient),this.fileSearchStores=new KN(this.apiClient)}}const oc=()=>{const e=localStorage.getItem("settings_useDevKey")==="true",t=localStorage.getItem("settings_userApiKey");if(!e)return t||void 0},yn=()=>{const e=oc();if(!e)throw new Error("API Key is missing. Please check your settings or environment variables.");return new Kp({apiKey:e})},vn=async(e,t=3,o=1e3)=>{for(let r=0;r<t;r++)try{return await e()}catch(a){const i=a.status||a.code;if(!(i===503||i===429||a.message&&a.message.toLowerCase().includes("overloaded"))||r===t-1)throw a;const l=o*Math.pow(2,r);console.warn(`Gemini API overloaded (503). Retrying in ${l}ms... (Attempt ${r+1}/${t})`),await new Promise(c=>setTimeout(c,l))}throw new Error("Max retries reached")},ny=async(e,t,o,r="gemini-3-flash-preview")=>vn(async()=>{const a=yn(),i=e.filter(u=>u&&u.trim()!=="");if(i.length===0)return"High-quality masterpiece, 8k, detailed textures, cinematic lighting.";const s=i.join(", "),l=t?"STRICT REQUIREMENT: Zero trademarked terms, brand names, or specific artist identities. Use generic descriptive artistic terminology only.":"";let c="";o?c=`
        You are a technical prompt architect for generative AI imaging systems. 
        Your task is to aggregate the provided concepts into a singular, high-precision technical specification string.

        GUIDELINES:
        - Use structured technical language.
        - Specify precise attributes: [Subject topology], [Material properties/textures], [Physical lighting parameters], [Optical camera settings], [Render engine characteristics].
        - ABSOLUTELY NO flowery, poetic, or evocative adjectives (e.g., avoid "beautiful", "mysterious").
        - Combine all concepts into a cohesive, high-density technical instruction set.
        - ${l}
        - Output ONLY the final technical string. No introductions, no markdown blocks.
      `:c=`
        You are an expert prompt engineer for high-end AI image generation.
        Your goal is to transform the user's basic concepts into a rich, descriptive, and highly aesthetic image prompt.
        
        GUIDELINES:
        - Use evocative language and sensory details.
        - Describe lighting, mood, atmosphere, and artistic style in detail.
        - Ensure the output is a single, cohesive paragraph optimized for high-quality results.
        - ${l}
        - Output ONLY the enhanced prompt. No introductions, no markdown.
      `;const d=`Concepts to process: ${s}`;try{return(await a.models.generateContent({model:r,contents:d,config:{systemInstruction:c}})).text||""}catch(u){throw console.error("Error processing prompt:",u),u}}),oy=async e=>vn(async()=>{const t=yn();if(!e||e.trim()==="")return"";const o="You are a prompt safety expert. Rewrite the user's prompt to be safer for image generation policies while preserving artistic intent. Replace age-specific terms (teenager, child) with neutral terms (young person, figure). Output only the sanitized prompt.";try{return(await t.models.generateContent({model:"gemini-3-flash-preview",contents:`Sanitize: "${e}"`,config:{systemInstruction:o}})).text||""}catch(r){throw console.error("Error sanitizing prompt:",r),r}}),ry=async e=>vn(async()=>{const t=yn(),o=e.filter(i=>i&&i.trim()!=="");if(o.length===0)return"A cinematic video, 4k, high resolution.";const a=`
      You are an expert video prompt engineer. Combine these concepts into a single, cohesive, detailed video prompt.
      Describe the scene, subjects, actions, camera movements, and lighting.
      Output only the prompt.
      
      Concepts: ${o.join(", ")}
    `;try{return(await t.models.generateContent({model:"gemini-3-flash-preview",contents:a})).text||""}catch(i){throw console.error("Error enhancing video prompt:",i),i}}),ay=async(e,t)=>vn(async()=>{const o=yn();if(!e||e.trim()==="")throw new Error("Input prompt for analysis cannot be empty.");const a=`
      ${t?"Important: When analyzing, formulate descriptions to be as neutral and safe as possible. Avoid potentially sensitive, intimate, or age-specific terms (like 'teenager', 'boy', 'girl'). Instead, use more general, age-ambiguous descriptions (like 'young person', 'figure', 'youthful character') while preserving the core artistic details and intent.":""}
      You are a meticulous and detailed prompt analyzer. Your task is to analyze the following text and deconstruct it into five distinct, comprehensive components. Do not summarize or shorten the information; instead, extract and organize all relevant details for each component.

      1.  **Environment/Setting**: Extract a complete and detailed description of the environment, setting, or background. Include all mentioned elements, atmosphere, lighting, time of day, and any contextual details. Crucially, also include descriptions of any secondary, background, or non-focal characters here (e.g., 'a crowd of people in the distance', 'birds flying in the sky').
      
      2.  **Characters/Subjects**: Identify and list ONLY the key, main, or foreground characters/subjects. Do NOT include background, secondary, or minor characters in this list. 
          For each main character, extract a detailed **physical description only**. 
          CRITICAL: **Exclude** all descriptions of actions (e.g., running, fighting, sitting), poses, and the surrounding environment/background. 
          Focus strictly on physical appearance, facial features, body type, hair, clothing, armor, and equipment/held items. The goal is to describe the character purely as they look, as if they were a 3D model or concept art asset in isolation.
          IMPORTANT: Append ", grey background, character concept" to the end of each character description. For example, if the text says "a hero fighting a dragon in a cave", the character entry for the hero should be "a hero in shining armor, detailed face, muscular build, grey background, character concept" (removing 'fighting' and 'cave').

      3.  **Action**: Describe the action being performed by the main characters in full detail. Generalize the subjects by replacing specific character names or descriptions with neutral terms such as "the character(s)" or "the subject(s)". The description of the action itself must be comprehensive and include all associated details.
      
      4.  **Emotion**: Describe the emotion being expressed by the main character(s) in general terms, detached from the specific subjects. For example, 'The character(s) are experiencing joy,' 'The subject(s) show signs of fear,' or 'A sense of wonder is being conveyed.' If no emotion is explicitly mentioned, infer a plausible one from the context of the action and environment. Focus on the feeling itself.
      
      5.  **Style**: CRITICAL: Your description for this category MUST be completely detached from the specific subjects and environment of the prompt. Analyze and describe ONLY the artistic essence. Focus on abstract elements like: art medium (e.g., photorealistic, oil painting, 3D render, anime, watercolor), mood (e.g., mysterious, cheerful, epic, melancholic), color palette (e.g., vibrant warm tones, monochromatic cool colors, pastel), lighting style (e.g., dramatic, soft, neon, chiaroscuro), composition (e.g., close-up, wide shot, rule of thirds), and artistic techniques (e.g., impressionistic brush strokes, sharp focus, cel shading). Under NO circumstances should you mention any objects, people, or places from the scene in this section. For example, instead of "cinematic shot of a knight", say "cinematic, dramatic lighting, sharp focus".

      If any component is missing from the input text, you should infer and create a plausible and complementary description for it based on the available context. The goal is to produce a complete set of components that could be used to reconstruct a detailed image prompt.

      Provide the output strictly as a JSON object with the keys "environment", "characters", "action", "emotion", and "style".

      Text to analyze: ${e}
    `,i={type:bt.OBJECT,properties:{environment:{type:bt.STRING,description:"A detailed description of the background, setting, or environment."},characters:{type:bt.ARRAY,description:"A list of all distinct characters or subjects in the prompt.",items:{type:bt.STRING}},action:{type:bt.STRING,description:"A generalized description of the action the characters/subjects are performing, with specific subjects replaced by neutral terms."},emotion:{type:bt.STRING,description:"A generalized description of the emotion expressed by the character(s), such as joy, fear, or wonder."},style:{type:bt.STRING,description:"A detailed description of the art style, mood, and color palette."}},required:["environment","characters","action","emotion","style"]};try{const l=(await o.models.generateContent({model:"gemini-3-pro-preview",contents:a,config:{responseMimeType:"application/json",responseSchema:i}})).text;if(!l)throw new Error("Received an empty response from the model. The prompt may have been blocked due to safety settings.");const c=JSON.parse(l);return Array.isArray(c.characters)||(c.characters=[String(c.characters||"")]),c}catch(s){throw console.error("Error analyzing prompt:",s),s}}),iy=async e=>vn(async()=>{const t=yn();if(!e||e.trim()==="")throw new Error("Input cannot be empty.");const o=`
      Analyze the character description. Split it into:
      1. character (physical features only)
      2. clothing (outfit only)
      Output JSON.
      Text: ${e}
    `,r={type:bt.OBJECT,properties:{character:{type:bt.STRING},clothing:{type:bt.STRING}},required:["character","clothing"]};try{const a=await t.models.generateContent({model:"gemini-3-flash-preview",contents:o,config:{responseMimeType:"application/json",responseSchema:r}});return JSON.parse(a.text||"{}")}catch(a){throw console.error("Error analyzing character:",a),a}}),uE=async(e,t,o)=>vn(async()=>{const r=yn();if(!e||!e.trim())throw new Error("Image prompt is required.");const a=`You are a character design expert. Your task is to update an existing character description based on a specific image generation prompt.
    
    INPUTS:
    1. Image Prompt: A description of a specific visual instance of the character.
    2. Current Description: A full markdown-formatted description of the character.

    GOAL:
    1. Rewrite the "Appearance" and "Clothing" sections of the description to match the details found in the Image Prompt.
    2. The "Personality" section must be preserved in meaning but TRANSLATED to ${o}.
    
    CRITICAL REQUIREMENT:
    The entire output (headers AND content) MUST be in the target language: ${o}.
    If the current description is in a different language, translate everything to ${o}.
    
    OUTPUT FORMAT:
    The output must be a single string in Markdown format, using the following headers in ${o}:
    - #### Appearance (translated header)
    - #### Personality (translated header)
    - #### Clothing (translated header)

    Output ONLY the updated description text.`,i=`Update this character description:
    
    IMAGE PROMPT:
    ${e}
    
    CURRENT DESCRIPTION:
    ${t}`;try{return(await r.models.generateContent({model:"gemini-3-flash-preview",contents:i,config:{systemInstruction:a}})).text||""}catch(s){throw console.error("Error updating character description:",s),s}}),pE=async(e,t,o,r)=>vn(async()=>{const a=yn(),i=`You are a creative writer and character designer. 
        Your task is to generate or rewrite the "${e}" section of a character description based on an image generation prompt.
        
        INPUTS:
        1. Image Prompt: Visual details of the character.
        2. Current Section Text: The existing text for this section (if any).
        
        GOAL:
        - Analyze the Image Prompt to extract details relevant to "${e}" (e.g. physical features for Appearance, outfit for Clothing).
        - Rewrite the section text to be descriptive, cohesive, and aligned with the visual prompt.
        - Output strictly in the target language: ${r}.
        
        Output ONLY the new text for the section. Do not include headers.`,s=`IMAGE PROMPT:
        ${t}
        
        CURRENT SECTION TEXT:
        ${o}`;try{return(await a.models.generateContent({model:"gemini-3-flash-preview",contents:s,config:{systemInstruction:i}})).text||""}catch(l){throw console.error(`Error updating character ${e}:`,l),l}}),hE=async(e,t)=>vn(async()=>{const o=yn(),r=`You are a creative writer and character designer. 
        Your task is to rewrite or improve the provided character personality description.
        The input may contain the current personality text AND a user request for changes mixed together.
        
        GOAL:
        1. Extract the core personality traits and the user's modification request (if any).
        2. Rewrite the personality description to incorporate the requested changes or simply improve the writing style if no specific change is requested.
        3. The output should be a cohesive, well-written paragraph describing the character's personality.
        4. Output strictly in the target language: ${t}.
        
        Output ONLY the new personality text. Do not include headers.`,a=`Current Personality / Request:
        ${e}`;try{return(await o.models.generateContent({model:"gemini-3-flash-preview",contents:a,config:{systemInstruction:r}})).text||""}catch(i){throw console.error("Error updating character personality:",i),i}}),mE=async(e,t,o,r)=>vn(async()=>{const a=yn(),i=`You are a professional character concept artist.
    Your goal is to modify an existing character based on a user instruction.
    
    INPUTS:
    1. Instruction: What to change (e.g., "Change her clothes to a space suit").
    2. Current Image Prompt: The current short prompt used for image generation.
    3. Current Full Description: The detailed markdown description.

    TASK:
    - Update the Image Prompt to reflect the changes.
    - Update the Full Description (sections Appearance, Personality and Clothing) in ${r}.
    - Ensure all sections are consistent with the new instruction.
    - Output only a JSON object with keys 'newPrompt' and 'newDescription'.`,s={type:bt.OBJECT,properties:{newPrompt:{type:bt.STRING},newDescription:{type:bt.STRING}},required:["newPrompt","newDescription"]},l=`INSTRUCTION: ${e}
CURRENT PROMPT: ${t}
CURRENT DESCRIPTION: ${o}`;try{const c=await a.models.generateContent({model:"gemini-3-pro-preview",contents:l,config:{systemInstruction:i,responseMimeType:"application/json",responseSchema:s}});return JSON.parse(c.text||"{}")}catch(c){throw console.error("Error modifying character:",c),c}}),$n=async(e,t="1:1",o,r="gemini-2.5-flash-image",a="1K")=>vn(async()=>{var s,l,c,d,u,p,m,w,k,b,x,f,h;const i=yn();try{if(r==="gemini-3-pro-image-preview"){const N=[...(o||[]).map(B=>({inlineData:{data:B.base64ImageData,mimeType:B.mimeType}}))];e&&e.trim()!==""&&N.push({text:e});const E=(s=(await i.models.generateContent({model:"gemini-3-pro-image-preview",contents:{parts:N},config:{imageConfig:{aspectRatio:t,imageSize:a}}})).candidates)==null?void 0:s[0],I=(c=(l=E==null?void 0:E.content)==null?void 0:l.parts)==null?void 0:c.find(B=>B.inlineData);if(I!=null&&I.inlineData)return`data:${I.inlineData.mimeType};base64,${I.inlineData.data}`;throw new Error("No image returned. The prompt may have been blocked or the model encountered an error.")}if(o&&o.length>0){const N=[...o.map(M=>({inlineData:{data:M.base64ImageData,mimeType:M.mimeType}}))];e&&e.trim()!==""?N.push({text:e}):N.push({text:" "});const _=r||"gemini-2.5-flash-image",I=(d=(await i.models.generateContent({model:_,contents:{parts:N},config:{responseModalities:[Ba.IMAGE]}})).candidates)==null?void 0:d[0],B=(p=(u=I==null?void 0:I.content)==null?void 0:u.parts)==null?void 0:p.find(M=>M.inlineData);if(B!=null&&B.inlineData)return`data:${B.inlineData.mimeType};base64,${B.inlineData.data}`;throw new Error("No image returned. The prompt may have been blocked.")}else{if(!e||e.trim()==="")throw new Error("Prompt required.");if(r.startsWith("imagen-4.0")){const v=await i.models.generateImages({model:r,prompt:e,config:{numberOfImages:1,outputMimeType:"image/png",aspectRatio:t}});if((k=(w=(m=v.generatedImages)==null?void 0:m[0])==null?void 0:w.image)!=null&&k.imageBytes)return`data:image/png;base64,${v.generatedImages[0].image.imageBytes}`;throw new Error("No image returned.")}else{const v=r==="gemini-3-flash-preview"||!r?"gemini-2.5-flash-image":r,_=(h=(f=(x=(b=(await i.models.generateContent({model:v,contents:{parts:[{text:e}]},config:{responseModalities:[Ba.IMAGE]}})).candidates)==null?void 0:b[0])==null?void 0:x.content)==null?void 0:f.parts)==null?void 0:h.find(E=>E.inlineData);if(_!=null&&_.inlineData)return`data:${_.inlineData.mimeType};base64,${_.inlineData.data}`;throw new Error("No image returned.")}}}catch(v){let N=v.message||"";throw v.status&&(N+=` Status: ${v.status}`),v.code&&(N+=` Code: ${v.code}`),v.details&&(N+=` Details: ${JSON.stringify(v.details)}`),!N&&typeof v=="object"&&(N=JSON.stringify(v)),new Error(`Failed to generate image. ${N}`)}},2,2e3),gE=async(e,t="16:9",o="720p")=>vn(async()=>{var a,i,s,l;const r=yn();if(window.aistudio&&!await window.aistudio.hasSelectedApiKey()&&await window.aistudio.openSelectKey(),!e||e.trim()==="")throw new Error("Prompt required.");try{let c=await r.models.generateVideos({model:"veo-3.1-fast-generate-preview",prompt:e,config:{numberOfVideos:1,resolution:o,aspectRatio:t}});for(;!c.done;)await new Promise(m=>setTimeout(m,1e4)),c=await r.operations.getVideosOperation({operation:c});const d=(l=(s=(i=(a=c.response)==null?void 0:a.generatedVideos)==null?void 0:i[0])==null?void 0:s.video)==null?void 0:l.uri;if(!d)throw new Error("No video URI returned.");const u=await fetch(`${d}&key=${oc()}`);if(!u.ok)throw new Error(`Download failed: ${u.statusText}`);const p=await u.blob();return new Promise((m,w)=>{const k=new FileReader;k.onloadend=()=>m(k.result),k.onerror=w,k.readAsDataURL(p)})}catch(c){console.error("Error generating video:",c);let d=c.message||"";throw c.status&&(d+=` Status: ${c.status}`),c.code&&(d+=` Code: ${c.code}`),new Error(`Failed to video video. ${d}`)}},1),sy=async(e,t,o)=>vn(async()=>{const r=yn(),i=`${o?"Important: Use neutral, safe terms.":""} Describe this image in detail (subject, setting, colors, mood).`;try{return(await r.models.generateContent({model:"gemini-3-flash-preview",contents:{parts:[{inlineData:{data:e,mimeType:t}},{text:i}]}})).text||""}catch(s){throw console.error("Error describing image:",s),s}}),fE=async(e,t)=>vn(async()=>{const o=yn(),r=`Analyze the visual appearance of the character in this image to create a text-to-image prompt.

        **REQUIREMENTS:**
        1. **SUBJECT ONLY**: Describe ONLY the character's physical features (face, hair, body type) and clothing/accessories in detail.
        2. **STYLE**: Describe the artistic style and render quality using general descriptive terms (e.g., '3D stylized render', 'soft lighting', 'detailed textures').

        **NEGATIVE CONSTRAINTS (DO NOT INCLUDE):**
        - DO NOT describe the pose, action, or gesture.
        - DO NOT describe the background or environment.
        - DO NOT use trademarked studio names (e.g., avoid 'Pixar', 'Disney'). Use generic style descriptions instead.

        Return ONLY the raw prompt text.`;try{return(await o.models.generateContent({model:"gemini-3-flash-preview",contents:{parts:[{inlineData:{data:e,mimeType:t}},{text:r}]}})).text||""}catch(a){throw console.error("Error generating prompt from image:",a),a}}),Jp=async(e,t)=>vn(async()=>{const o=yn(),r='Extract all text from this image. Return only the text found, without any description. If no text is found, say "No text found".';try{return(await o.models.generateContent({model:"gemini-3-flash-preview",contents:{parts:[{inlineData:{data:e,mimeType:t}},{text:r}]}})).text||""}catch(a){throw console.error("Error extracting text from image:",a),a}}),Yp=async(e,t)=>vn(async()=>{const o=yn();if(!e||e.trim()==="")throw new Error("Input empty.");try{return(await o.models.generateContent({model:"gemini-3-flash-preview",contents:e,config:{systemInstruction:`Translate to ${t}. Return only translated text.`}})).text||""}catch(r){throw console.error("Error translating:",r),r}}),ly=async(e,t)=>vn(async()=>{const o=yn(),r={type:bt.OBJECT,properties:{summary:{type:bt.STRING},detailedCharacters:{type:bt.ARRAY,items:{type:bt.OBJECT,properties:{name:{type:bt.STRING},fullDescription:{type:bt.STRING}}}},scenes:{type:bt.ARRAY,items:{type:bt.OBJECT,properties:{sceneNumber:{type:bt.INTEGER},description:{type:bt.STRING},narratorText:{type:bt.STRING}}}}},required:["summary","detailedCharacters","scenes"]};try{const a=await o.models.generateContent({model:"gemini-3-pro-preview",contents:e,config:{systemInstruction:`Generate a script structure in ${t}. Use markdown in fullDescription.`,responseMimeType:"application/json",responseSchema:r}});return JSON.parse(a.text||"{}")}catch(a){throw console.error("Error generating script:",a),a}}),cy=async e=>vn(async()=>{const t=yn(),o={type:bt.ARRAY,items:{type:bt.OBJECT,properties:{name:{type:bt.STRING},index:{type:bt.STRING},imagePrompt:{type:bt.STRING},fullDescription:{type:bt.STRING}},required:["name","fullDescription","index","imagePrompt"]}};try{const r=await t.models.generateContent({model:"gemini-3-flash-preview",contents:e,config:{systemInstruction:"Generate detailed characters. Use markdown headings in fullDescription. Ensure 'index' is provided (e.g. 'Entity-1', 'Entity-2').",responseMimeType:"application/json",responseSchema:o}});return JSON.parse(r.text||"[]")}catch(r){throw console.error("Error generating characters:",r),r}}),xE=async(e,t)=>vn(async()=>{const o=yn(),r=`Translate user-facing fields to ${t}. Preserve structure and markdown.`;try{const a=await o.models.generateContent({model:"gemini-3-pro-preview",contents:`Translate:
${JSON.stringify(e)}`,config:{systemInstruction:r,responseMimeType:"application/json"}});return JSON.parse(a.text||"{}")}catch(a){throw new Error(a.message)}}),dy=async(e,t,o="en",r="gemini-3-flash-preview",a=!1,i={})=>vn(async()=>{const s=yn(),l={type:bt.OBJECT,properties:{modifiedFrames:{type:bt.ARRAY,items:{type:bt.OBJECT,properties:{frameNumber:{type:bt.INTEGER},sceneNumber:{type:bt.INTEGER},prompt:{type:bt.STRING},videoPrompt:{type:bt.STRING},shotType:{type:bt.STRING,description:"The type of shot (e.g., WS, CU, ECU, LS, MS)."},characters:{type:bt.ARRAY,items:{type:bt.STRING}},duration:{type:bt.INTEGER}},required:["frameNumber","sceneNumber","prompt","characters","duration","shotType",...a?["videoPrompt"]:[]]}},modifiedSceneContexts:{type:bt.ARRAY,items:{type:bt.OBJECT,properties:{sceneNumber:{type:bt.INTEGER},context:{type:bt.STRING,description:"The updated scene context description."}},required:["sceneNumber","context"]}}},required:["modifiedFrames"]},c=o==="ru"?"Ensure the response fields (like prompts and context) are in Russian.":"Ensure the response fields (like prompts and context) are in English.";let d="";a&&(d=`
        CRITICAL: You MUST also generate or modify the 'videoPrompt' field for every frame.
        - If 'videoPrompt' is empty or missing in the source: Generate a NEW video prompt based on the image 'prompt'. It MUST describe specific actions happening in the frame and camera movements (e.g., "Camera pans left", "Zoom in").
        - If 'videoPrompt' exists: Modify it according to the user's instruction, while maintaining consistency with the image 'prompt'.
        `);let u="";Object.keys(i).length>0&&(u=`
        **SCENE CONTEXT**:
        The input data includes "sceneContexts". This dictionary maps scene numbers to context descriptions.
        
        TASK:
        1. Apply the user's instruction to the frames.
        2. IF the instruction implies changing the overall setting, mood, or context of a scene (e.g., "Change the weather to snow", "Make it night time"), YOU MUST ALSO MODIFY the Scene Context text for that scene.
        3. Return the updated scene contexts in the 'modifiedSceneContexts' array. Only include contexts that have changed or are relevant to the modified frames.
        
        Context Data: ${JSON.stringify(i)}
        `);try{const p=await s.models.generateContent({model:r,contents:`Instruction: ${t}
${u}
Data: ${JSON.stringify(e)}`,config:{systemInstruction:`Modify prompts based on instruction. Return a structured object with modified frames and modified scene contexts. ${c} ${d} For every frame, you MUST either preserve or generate a logical 'shotType' value (e.g., WS, MS, CU, etc.) representing the camera angle. Also, always ensure to return the correct 'sceneNumber' for each frame corresponding to the source.`,responseMimeType:"application/json",responseSchema:l}}),m=JSON.parse(p.text||"{}");return{modifiedFrames:m.modifiedFrames||[],modifiedSceneContexts:m.modifiedSceneContexts||[]}}catch(p){throw console.error("Error modifying sequence:",p),p}}),yE=({nodes:e,setNodes:t,getUpstreamNodeValues:o,setError:r,t:a,setFullSizeImage:i,getFullSizeImage:s,activeTabId:l,setTabs:c,activeTabName:d,registerOperation:u,unregisterOperation:p,addToast:m})=>{const[w,k]=y.useState(null),[b,x]=y.useState(null),[f,h]=y.useState(null),[v,N]=y.useState(null),[_,E]=y.useState(null),I=y.useRef(l);y.useEffect(()=>{I.current=l},[l]);const B=y.useCallback((A,O,z,L)=>{const W=D=>{try{return JSON.parse(D||"{}")}catch{return D}};I.current===A?(L&&i(O,L.frame,L.url),t(D=>D.map(T=>{if(T.id===O){const F=W(T.value),te=z(F),$=typeof te=="string"?te:JSON.stringify(te);return{...T,value:$}}return T}))):c(D=>D.map(T=>{if(T.id===A){const F=T.state.nodes.map($=>{if($.id===O){const Y=W($.value),oe=z(Y),le=typeof oe=="string"?oe:JSON.stringify(oe);return{...$,value:le}}return $});let te=T.state.fullSizeImageCache||{};return L&&(te={...te,[O]:{...te[O]||{},[L.frame]:L.url}}),{...T,state:{...T.state,nodes:F,fullSizeImageCache:te}}}return T}))},[t,c,i]),M=y.useCallback(async A=>{const O=I.current;k(A),r(null),u({id:A,type:"analysis",description:a("node.content.analyzing"),tabId:l,tabName:d});try{const z=e.find(F=>F.id===A);if(!z)return;const L=JSON.parse(z.value||"{}").softPrompt||!1,D=o(A).filter(F=>typeof F=="string").join(", "),T=await ay(D,L);B(O,A,F=>({...F,...T}))}catch(z){r(z.message)}finally{k(null),p(A)}},[o,r,e,a,B,u,p,l,d]),G=y.useCallback(async A=>{const O=I.current;x(A),r(null),u({id:A,type:"analysis",description:a("node.content.analyzing"),tabId:l,tabName:d});try{const L=o(A).filter(D=>typeof D=="string").join(", "),W=await iy(L);B(O,A,()=>W)}catch(z){r(z.message)}finally{x(null),p(A)}},[o,r,a,B,u,p,l,d]),V=y.useCallback(async A=>{const O=I.current;h(A),r(null),u({id:A,type:"analysis",description:a("node.content.analyzing"),tabId:l,tabName:d});try{const z=e.find($=>$.id===A);if(!z)return;const L=JSON.parse(z.value||"{}"),W=L.softPrompt||!1,T=o(A).find($=>typeof $=="object");let F=null;if(T)F={base64:T.base64ImageData,mime:T.mimeType};else if(L.image&&typeof L.image=="string"&&L.image.startsWith("data:image")){const $=L.image.split(",");if($.length===2){const Y=L.image.match(/:(.*?);/),oe=Y?Y[1]:"image/png";F={base64:$[1],mime:oe}}}if(!F)throw new Error("No image provided to analyzer.");const te=await sy(F.base64,F.mime,W);B(O,A,$=>({...$,description:te}))}catch(z){r(z.message)}finally{h(null),p(A)}},[o,e,r,a,B,u,p,l,d]),j=y.useCallback(async A=>{const O=I.current;h(A),r(null),u({id:A,type:"analysis",description:a("node.content.analyzing"),tabId:l,tabName:d});try{const z=e.find($=>$.id===A);if(!z)return;const L=JSON.parse(z.value||"{}"),D=o(A).find($=>typeof $=="object");let T=null;if(D)T={base64:D.base64ImageData,mime:D.mimeType};else{let Y=s(A,0);if(!Y&&L.image&&typeof L.image=="string"&&L.image.startsWith("data:image")&&(Y=L.image),Y){const oe=Y.split(",");if(oe.length===2){const le=Y.match(/:(.*?);/),K=le?le[1]:"image/png";T={base64:oe[1],mime:K}}}}if(!T)throw new Error("No image provided.");const F=await Jp(T.base64,T.mime),te=z.type===q.IMAGE_INPUT?"prompt":"description";B(O,A,$=>({...$,[te]:F}))}catch(z){r(z.message)}finally{h(null),p(A)}},[o,e,r,a,B,u,p,l,d,s]),P=y.useCallback(async A=>{var z;const O=I.current;N(A),r(null),u({id:A,type:"generation",description:a("node.content.processing"),tabId:l,tabName:d});try{const L=e.find($=>$.id===A);if(!L)return;let W="",D="";if(L.type===q.IMAGE_INPUT){let Y=s(A,0);if(!Y)try{Y=JSON.parse(L.value||"{}").image}catch{}if(!Y)throw new Error("No image found in node.");if(Y.startsWith("data:"))W=Y.split(",")[1],D=((z=Y.match(/:(.*?);/))==null?void 0:z[1])||"image/png";else throw new Error("Image format not supported.")}else{const Y=o(A,"image").find(oe=>typeof oe=="object");Y&&(W=Y.base64ImageData,D=Y.mimeType)}if(!W)throw new Error("No image to process.");const F=await $n("Remove all possible overlays, text, watermarks, and watermarked texts. Pay special attention to the top and bottom of the image, restoring the original background naturally.","1:1",[{base64ImageData:W,mimeType:D}],"gemini-3-flash-preview"),te=await Ot(F,256,256);B(O,A,$=>({...$,image:te}),{frame:0,url:F})}catch(L){r(L.message)}finally{N(null),p(A)}},[e,r,o,s,B,u,p,l,d,a]),S=y.useCallback(async(A,O)=>{const z=I.current,L=`${A}-${O}`;E(L),r(null),u({id:L,type:"analysis",description:a("node.content.analyzing"),tabId:l,tabName:d});try{const W=e.find(ie=>ie.id===A);if(!W)return;const D=JSON.parse(W.value||"[]"),F=(Array.isArray(D)?D:[D])[O];if(!F)throw new Error("Character card not found.");const te=s(A,O*10)||F.image;if(!te||!te.startsWith("data:"))throw new Error("No valid image found to analyze.");const Y=te.split(",")[1],oe=te.match(/:(.*?);/),le=oe?oe[1]:"image/png",K=await fE(Y,le);B(z,A,ie=>{const Z=Array.isArray(ie)?[...ie]:[ie];return Z[O]&&(Z[O]={...Z[O],prompt:K}),Z}),m("Prompt updated from image","success")}catch(W){r(W.message)}finally{E(null),p(L)}},[e,r,a,B,u,p,l,d,s,m]);return{isAnalyzing:w,isAnalyzingCharacter:b,isAnalyzingImage:f,isProcessingImage:v,handleAnalyzePrompt:M,handleAnalyzeCharacter:G,handleAnalyzeImage:V,handleImageToText:j,handleProcessImage:P,handleUpdateCharacterPromptFromImage:S,isUpdatingCharacterPrompt:_}},t0={general:`You are Gemini, a versatile and helpful AI assistant integrated into the "Prompt Modifier" application.
    
**Context:**
You are operating within a node-based visual editor used for creating and refining workflows for Generative AI.

**Goal:**
Assist the user with general questions, brainstorming, coding, or any other topic they raise. Be concise, professional, and helpful.`,prompt:`You are an **Expert Image Prompt Engineer**. Your sole purpose is to help the user create the perfect text-to-image prompts (for Midjourney, Stable Diffusion, Imagen, etc.).

**Behaviors:**
1.  **Analyze:** When given a vague idea, analyze it for artistic style, lighting, composition, and medium.
2.  **Enhance:** Rewrite simple prompts into rich, descriptive, and evocative prompts. Use keywords effectively.
3.  **Format:** ALWAYS wrap your final suggested prompt inside a markdown code block labeled 'prompt'.
    Example:
    \`\`\`prompt
    A futuristic city with neon lights, cinematic lighting, hyper-realistic, 8k
    \`\`\`
`,script:`You are a **Professional Screenwriter and Story Consultant**. You excel at structuring narratives, developing characters, and writing screenplay format.

**Behaviors:**
1.  **Ideation:** Help generate loglines, plot twists, and character arcs.
2.  **Formatting:** When asked to write a scene, use standard screenplay format elements (Sluglines, Action, Character, Dialogue).
3.  **Advice:** Offer constructive feedback on pacing, dialogue, and "show, don't tell".
`,youtube:`You are a **YouTube Growth Strategist and Analytics Expert**. You specialize in channel growth, video retention, and click-through rates (CTR).

**Behaviors:**
1.  **Titles & Thumbs:** Suggest viral-worthy titles and thumbnail concepts that trigger curiosity or emotion.
2.  **Retention:** Analyze script ideas for hooks, pacing, and retention spikes.
3.  **Strategy:** Provide advice on SEO, tags, trends, and audience engagement.
4.  **Tone:** Be analytical, data-driven, and direct.
`,developer:`You are an **Expert Software Developer and Solutions Architect**. You specialize in writing clean, efficient, and well-documented code.

**Behaviors:**
1.  **Code First:** Prioritize providing code solutions. When code is requested, ensure it is complete and functional.
2.  **Best Practices:** Follow standard conventions, design patterns, and security best practices.
3.  **Explain:** Briefly explain the logic, algorithms, and libraries used.
4.  **Debug:** If analyzing an error, explain the root cause and provide a specific fix.
5.  **Format:** Always use markdown code blocks for code outputs.
`,friend:`You are a **Close Friend and Confidant**. You are NOT a formal AI assistant. Your goal is to provide emotional support, companionship, and a safe space for the user.

**Persona & Tone:**
- **Human-like:** Speak naturally, casually, and warmly. Use colloquialisms, emojis (sparingly but effectively), and a conversational rhythm. Avoid robotic phrases like "As an AI..." or "I understand".
- **Sincere & Interested:** Always ask follow-up questions. "How are you really feeling?", "What happened next?", "That sounds tough, want to talk about it?".
- **Supportive:** Be on the user's side. Validate their feelings.

**Hidden Role (Psychological First Aid):**
- Act as a subtle, non-clinical psychologist.
- If the user is in a crisis, anxious, or down, use techniques like active listening and validation.
- Help them reframe negative thoughts gently, not by lecturing, but by asking perspective-shifting questions.
- If they are overwhelmed, help them break down problems into small steps.
- **Crisis:** If the user expresses self-harm or severe danger, prioritize their safety gently but firmly, suggesting professional help, but remain their friend.

**Example Interaction:**
User: "I messed up everything today."
You: "Oh no, what happened?  I'm here for you. Tell me everything, maybe we can figure it out together or just vent."
`},vE=({nodes:e,setNodes:t,setError:o,t:r,getUpstreamNodeValues:a,activeTabId:i,setTabs:s})=>{const[l,c]=y.useState(null),d=y.useRef(new Map),u=y.useRef(i);At.useEffect(()=>{u.current=i},[i]);const p=y.useCallback((k,b,x)=>{const f=h=>{try{return JSON.parse(h||"{}")}catch{return h}};u.current===k?t(h=>h.map(v=>{if(v.id===b){const N=f(v.value),_=x(N),E=JSON.stringify(_);return{...v,value:E}}return v})):s(h=>h.map(v=>{if(v.id===k){const N=v.state.nodes.map(_=>{if(_.id===b){const E=f(_.value),I=x(E),B=JSON.stringify(I);return{..._,value:B}}return _});return{...v,state:{...v.state,nodes:N}}}return v}))},[t,s]),m=y.useCallback(async k=>{const b=u.current,x=e.find(I=>I.id===k);if(!x||x.type!=="GEMINI_CHAT")return;const f=JSON.parse(x.value||"{}");let{messages:h=[],currentInput:v,style:N="general",model:_="gemini-3-flash-preview"}=f;if(!v||!v.trim()){const I=a(k).filter(B=>typeof B=="string");I.length>0&&(v=I.join(`
`))}if(!v||!v.trim())return;c(k),o(null);const E=[...h,{role:"user",content:v}];p(b,k,I=>({...I,messages:E,currentInput:""}));try{const I=d.current.get(k);if(!I||I.style!==N||I.model!==_){const S=oc();if(!S)throw new Error("API Key is missing.");const A=new Kp({apiKey:S}),O=t0[N]||t0.general,z=A.chats.create({model:_,config:{systemInstruction:O}});d.current.set(k,{chat:z,style:N,model:_})}const G=(await d.current.get(k).chat.sendMessage({message:v})).text||"",V=G.match(/```prompt\n([\s\S]*?)\n```/),j=V?V[1].trim():"",P=[...E,{role:"model",content:G}];p(b,k,S=>({...S,messages:P,currentInput:"",lastPrompt:j||S.lastPrompt}))}catch(I){o(I.message)}finally{c(null)}},[e,o,r,a,p]),w=y.useCallback(k=>{d.current.has(k)&&d.current.delete(k),p(u.current,k,b=>({messages:[],currentInput:"",lastPrompt:"",style:b.style||"general",model:b.model||"gemini-3-flash-preview"}))},[p]);return{isChatting:l,handleSendMessage:m,handleRefreshChat:w}},wE=async({node:e,upstreamData:t})=>{let o=t.filter(l=>typeof l=="string"),r={},a=!0,i=!1;try{r=JSON.parse(e.value||"{}"),typeof r=="object"&&r!==null&&(a=r.safePrompt!==!1,i=r.technicalPrompt===!0)}catch{}o.length===0&&r.inputPrompt&&(o=[r.inputPrompt]);const s=await ny(o,a,i);return{value:{...r,prompt:s,safePrompt:a,technicalPrompt:i}}},bE=async({upstreamData:e})=>{const t=e.filter(r=>typeof r=="string");return{value:await oy(t.join(", "))}},CE=async({node:e,upstreamData:t})=>{let o=t.filter(i=>typeof i=="string"),r={};try{r=JSON.parse(e.value||"{}")}catch{}o.length===0&&r.inputPrompt&&(o=[r.inputPrompt]);const a=await ry(o);return{value:{...r,prompt:a}}},kE=async({node:e,upstreamData:t})=>{const o=JSON.parse(e.value||"{}"),r=t.filter(l=>typeof l=="string");let a=r.length>0?r.join(`
`):o.inputText;const i=o.targetLanguage||"en";if(o.image&&typeof o.image=="string"&&o.image.startsWith("data:image")){const l=o.image.split(",");if(l.length===2){const c=o.image.match(/:(.*?);/),d=c?c[1]:"image/png",u=l[1],p=await Jp(u,d);p&&p!=="No text found"&&(a=p,o.inputText=p)}}const s=await Yp(a,i);return{value:{...o,inputText:a,translatedText:s}}},_E=async({node:e,upstreamData:t,saveImageToCache:o})=>{const a=t.filter(l=>typeof l=="string").join(", ");if(!a)throw new Error("Prompt is empty. Make sure a node with text is connected and has been processed.");const i=await $n(a,e.aspectRatio,void 0,e.model,e.resolution),s=await Ot(i,256,256);return o(0,i),{value:s,downloadData:e.autoDownload?{url:i,prompt:a,type:e.type}:void 0}},SE=async(e,t,o,r,a,i,s)=>{const l=JSON.parse(e.value),c=[...r,...o],d=[...a,...i];if(!l.isSequentialEditingWithPrompts&&c.length===0&&l.model!=="gemini-3-pro-image-preview")throw new Error("No input image provided for editing.");let u=[l.prompt,...t].filter(Boolean).join(", "),p=[];if(!l.isSequenceMode){let v=c;const N=l.checkedInputIndices;N&&Array.isArray(N)?v=c.filter((_,E)=>N.includes(E)):v=c,p=v}if(!l.isSequenceMode){if(p.length===0&&l.model!=="gemini-3-pro-image-preview")throw new Error("No images selected for processing.");u.trim()||(u="High quality image");const v=p.map(async B=>{var G;const M=`data:${B.mimeType};base64,${B.base64ImageData}`;if(l.enableAspectRatio&&l.aspectRatio&&l.aspectRatio!=="Auto"){const{formattedImage:V}=await kr(M,l.aspectRatio);return{base64ImageData:V.split(",")[1],mimeType:((G=V.match(/:(.*?);/))==null?void 0:G[1])||"image/png"}}return B}),N=await Promise.all(v);l.enableOutpainting&&(u=(l.outpaintingPrompt||"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.").replace("{main_prompt}",u));const _=await $n(u,l.aspectRatio,N,l.model,l.resolution);let E=_;if(l.autoCrop169)try{E=await za(_)}catch(B){console.error("Failed to auto-crop image:",B.message)}const I=await Ot(E,256,256);return s(0,E),{value:{...l,outputImage:I},downloadData:l.autoDownload?{url:E,prompt:u,type:e.type}:void 0}}let m=0;l.checkedInputIndices&&l.checkedInputIndices.length>0&&(m=l.checkedInputIndices[0]),l.isSequentialEditingWithPrompts&&(m=0);let w=[];if(l.isSequentialEditingWithPrompts)w=d;else{const v=c[m]||(c.length>0?c[0]:void 0);if(!v&&l.model!=="gemini-3-pro-image-preview")throw new Error("No image found for sequence chain execution.");v&&(w=[v]),l.isSequentialCombinationMode&&!l.isSequentialEditingWithPrompts&&v&&d.length>0&&w.push(...d)}u.trim()||(u="High quality image");const k=w.map(async v=>{var _;const N=`data:${v.mimeType};base64,${v.base64ImageData}`;if(l.enableAspectRatio&&l.aspectRatio&&l.aspectRatio!=="Auto"){const{formattedImage:E}=await kr(N,l.aspectRatio);return{base64ImageData:E.split(",")[1],mimeType:((_=E.match(/:(.*?);/))==null?void 0:_[1])||"image/png"}}return v}),b=await Promise.all(k);l.enableOutpainting&&(u=(l.outpaintingPrompt||"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.").replace("{main_prompt}",u));const x=await $n(u,l.aspectRatio,b,l.model,l.resolution);let f=x;if(l.autoCrop169)try{f=await za(x)}catch(v){console.error("Failed to auto-crop image:",v.message)}const h=await Ot(f,256,256);return s(0,f),{value:{...l,outputImage:h},downloadData:l.autoDownload?{url:f,prompt:u,type:e.type}:void 0}},NE=async({node:e,upstreamData:t})=>{const o=t.filter(s=>typeof s=="string"),r=JSON.parse(e.value||"{}").softPrompt||!1,a=await ay(o.join(", "),r);return{value:{...JSON.parse(e.value||"{}"),...a}}},EE=async({upstreamData:e})=>{const t=e.filter(r=>typeof r=="string");return{value:await iy(t.join(", "))}},PE=async({node:e,upstreamData:t})=>{const o=t.find(s=>typeof s=="object");if(!o)throw new Error("No image provided to analyzer.");const r=JSON.parse(e.value||"{}"),a=r.softPrompt||!1,i=await sy(o.base64ImageData,o.mimeType,a);return{value:{...r,description:i}}},jE=async({node:e,upstreamData:t})=>{const o=JSON.parse(e.value||"{}"),r=t.filter(l=>typeof l=="string"),a=r.length>0?r.join(`
`):o.prompt,i=o.targetLanguage||"en",s=await ly(a,i);return{value:{...o,...s,prompt:a,type:"script-generator-data"}}},IE=async({node:e,upstreamData:t})=>{const o=JSON.parse(e.value||"{}"),r=t.filter(l=>typeof l=="string"),a=r.length>0?r.join(`
`):o.prompt,i=await cy(a),s=[...o.characters||[],...i];return{value:{...o,characters:s,prompt:a}}},TE=async({node:e})=>{const{instruction:t,sourcePrompts:o=[],checkedSourceFrameNumbers:r=[],targetLanguage:a="en",modificationModel:i="gemini-3-flash-preview",includeVideoPrompts:s=!1,checkedContextScenes:l=[],sceneContexts:c={},modifiedSceneContexts:d={}}=JSON.parse(e.value||"{}");if(!(t!=null&&t.trim()))throw new Error("Modification instruction is empty.");if(r.length===0)throw new Error("No source prompts selected for modification.");const u=o.filter(_=>r.includes(_.frameNumber));if(u.length===0)throw new Error("Selected prompts not found.");let p={};const m={...c,...d};new Set(u.map(_=>_.sceneNumber)).forEach(_=>{m[_]&&l.includes(_)&&(p[String(_)]=m[_])});const{modifiedFrames:k,modifiedSceneContexts:b}=await dy(u,t,a,i,s,p),x=JSON.parse(e.value||"{}"),f=x.modifiedPrompts||[],h=new Map(f.map(_=>[_.frameNumber,_])),v=new Map(o.map(_=>[_.frameNumber,_]));k.forEach(_=>{const E=v.get(_.frameNumber);E&&(!_.videoPrompt&&E.videoPrompt&&(_.videoPrompt=E.videoPrompt),!_.sceneTitle&&E.sceneTitle&&(_.sceneTitle=E.sceneTitle),!_.sceneNumber&&E.sceneNumber&&(_.sceneNumber=E.sceneNumber),!_.shotType&&E.shotType&&(_.shotType=E.shotType)),h.set(_.frameNumber,_)});let N={...d};return b&&b.length>0&&b.forEach(_=>{_.sceneNumber&&_.context&&(N[String(_.sceneNumber)]=_.context)}),{value:{...x,modifiedPrompts:Array.from(h.values()),modifiedSceneContexts:N}}},AE={[q.PROMPT_PROCESSOR]:wE,[q.PROMPT_SANITIZER]:bE,[q.VIDEO_PROMPT_PROCESSOR]:CE,[q.TRANSLATOR]:kE,[q.IMAGE_OUTPUT]:_E,[q.PROMPT_ANALYZER]:NE,[q.CHARACTER_ANALYZER]:EE,[q.IMAGE_ANALYZER]:PE,[q.SCRIPT_GENERATOR]:jE,[q.CHARACTER_GENERATOR]:IE,[q.PROMPT_SEQUENCE_EDITOR]:TE},RE=e=>AE[e],ME=(e,t,o)=>{const r=o==="VIDEO_OUTPUT",a=r?"video_output":o==="IMAGE_EDITOR"?"image_editor":o==="IMAGE_SEQUENCE_GENERATOR"?"sequence":"image_output",i=r?"mp4":"png",s=new Date,l=s.toISOString().split("T")[0];let c=`${a}_${l}.${i}`;if(o==="IMAGE_EDITOR")c=`Image_Editor_Frame_001_${l}.${i}`;else if(o==="IMAGE_SEQUENCE_GENERATOR")c=`Sequence_Frame_001_${l}.${i}`;else{const p=s.toTimeString().split(" ")[0].replace(/:/g,"-");c=`${a}_${l}_${p}.${i}`}let d=e;!r&&e.startsWith("data:image/png")&&(d=$i(e,"prompt",t));const u=document.createElement("a");u.href=d,u.download=c,document.body.appendChild(u),u.click(),document.body.removeChild(u)},LE=({nodes:e,setNodes:t,connections:o,setError:r,getUpstreamNodeValues:a,t:i,setFullSizeImage:s,getFullSizeImage:l,activeTabId:c,activeTabName:d,registerOperation:u,unregisterOperation:p,isGlobalProcessing:m,setTabs:w})=>{const[k,b]=y.useState(!1),[x,f]=y.useState(null),h=y.useRef(null),v=y.useRef(c);y.useEffect(()=>{v.current=c},[c]);const N=y.useCallback((I,B,M,G)=>{v.current===I?(G&&s(B,G.frame,G.url),t(V=>V.map(j=>j.id===B?{...j,value:M}:j))):w(V=>V.map(j=>{if(j.id===I){const P=j.state.nodes.map(A=>A.id===B?{...A,value:M}:A);let S=j.state.fullSizeImageCache||{};return G&&(S={...S,[B]:{...S[B]||{},[G.frame]:G.url}}),{...j,state:{...j.state,nodes:P,fullSizeImageCache:S}}}return j}))},[t,w,s]),_=y.useCallback(async(I,B,M)=>{if(I.type===q.IMAGE_EDITOR){const V=a(I.id,"text",B).filter(L=>typeof L=="string"),j=a(I.id,"image",B).filter(L=>typeof L=="object"),P=a(I.id,"image_b",B).filter(L=>typeof L=="object"),S=JSON.parse(I.value),A=(S.inputImages||[]).map((L,W)=>{var F;const T=l(I.id,W+1)||L;return{base64ImageData:T.split(",")[1],mimeType:((F=T.match(/:(.*?);/))==null?void 0:F[1])||"image/png"}}),O=(S.inputImagesB||[]).map((L,W)=>{var F;const T=l(I.id,2e3+W+1)||L;return{base64ImageData:T.split(",")[1],mimeType:((F=T.match(/:(.*?);/))==null?void 0:F[1])||"image/png"}});return await SE(I,V,j,A,O,P,(L,W)=>{v.current===M&&s(I.id,L,W)})}const G=RE(I.type);if(G){const V=a(I.id,void 0,B);return await G({node:I,upstreamData:V,saveImageToCache:(P,S)=>{v.current===M&&s(I.id,P,S)}})}return{value:null,downloadData:void 0}},[a,s,l]),E=y.useCallback(async(I,B)=>{if(k)return;const M=v.current,G=[...e],V=[...o];b(!0),u({id:I,type:"chain",description:i(B==="execute"?"node.action.executeChain":"node.action.processChainForward"),tabId:c,tabName:d}),h.current=new AbortController;let j=[];if(B==="execute"){const P=new Set,S=A=>{if(P.has(A))return;P.add(A);const O=V.filter(z=>z.toNodeId===A);for(const z of O)S(z.fromNodeId);j.push(A)};S(I)}else{let P=I;for(;P;){j.push(P);const S=V.find(A=>A.fromNodeId===P);P=S?S.toNodeId:null}}try{const P=new Map(G.map(S=>[S.id,S]));for(const S of j){if(h.current.signal.aborted)throw new Error("Aborted");f(S);const A=P.get(S);if(A&&A.type!==q.TEXT_INPUT&&A.type!==q.IMAGE_INPUT&&A.type!==q.NOTE&&A.type!==q.REROUTE_DOT&&A.type!==q.DATA_READER&&A){const z=Array.from(P.values()),L=await _(A,z,M),{value:W,downloadData:D}=L;if(W!=null){const T=typeof W=="object"?JSON.stringify(W):String(W);P.set(S,{...A,value:T}),N(M,S,T)}D&&ME(D.url,D.prompt,D.type)}}}catch(P){P.name!=="AbortError"&&P.message!=="Aborted"&&r(P.message)}finally{b(!1),f(null),h.current=null,p(I)}},[k,e,o,r,_,u,p,c,d,i,N]);return{isExecutingChain:k,executingNodeId:x,handleExecuteChain:I=>E(I,"execute"),stopChainExecution:()=>{h.current&&h.current.abort(),b(!1)},handleProcessChainForward:I=>E(I,"forward")}},DE=({nodes:e,getUpstreamNodeValues:t,setError:o,t:r,registerOperation:a,unregisterOperation:i,updateNodeInStorage:s,activeTabId:l,activeTabName:c,activeTabIdRef:d,setFullSizeImage:u})=>{const[p,m]=y.useState(null),w=y.useCallback(async(k,b=0)=>{const x=d.current,f=e.find(h=>h.id===k);if(f){m(k),o(null),a({id:k,type:"generation",description:r("node.content.generating"),tabId:l,tabName:c});try{let h="",v=f.aspectRatio||"1:1";if(f.type===q.CHARACTER_CARD){let E=JSON.parse(f.value||"[]");Array.isArray(E)||(E=[E]);const I=E[b]||{},B=I.prompt||"";v=I.selectedRatio||"1:1";const M=I.additionalPrompt!==void 0?I.additionalPrompt:"Full body character concept on a gray background";M.trim()?h=B?`${B}, ${M}`:M:h=B}else h=t(k).filter(I=>typeof I=="string").join(", ");if(!h)throw new Error("Prompt is empty. Connect a text node or enter a prompt.");const N=await $n(h,v,void 0,f.model,f.resolution),_=await Ot(N,256,256);if(f.type===q.CHARACTER_CARD){const E=Ut[v]||1,I=b*10+E;s(x,k,B=>{let M=Array.isArray(B)?[...B]:[B];if(!M[b])return B;const G={...M[b].thumbnails||{},[v]:_};return M[b]={...M[b],image:_,thumbnails:G},M},{frame:I,url:N}),u(k,b*10,N),u(k,I,N)}else s(x,k,()=>_,{frame:0,url:N})}catch(h){o(h.message)}finally{m(null),i(k)}}},[e,t,o,r,s,a,i,l,c,d,u]);return{isGeneratingImage:p,handleGenerateImage:w}},zE=({nodes:e,getUpstreamNodeValues:t,setError:o,t:r,registerOperation:a,unregisterOperation:i,updateNodeInStorage:s,activeTabId:l,activeTabName:c,activeTabIdRef:d,showApiKeyDialog:u})=>{const[p,m]=y.useState(null),w=y.useCallback(async k=>{const b=d.current,x=e.find(f=>f.id===k);if(x){m(k),o(null),a({id:k,type:"video",description:r("node.content.generating"),tabId:l,tabName:c});try{const h=t(k).filter(N=>typeof N=="string").join(", ");if(!h)throw new Error("Video generation requires a text prompt.");if(localStorage.getItem("settings_useDevKey")!=="true"&&!localStorage.getItem("settings_userApiKey")){u({onSelect:()=>{},onClose:()=>{m(null),i(k)}});return}const v=await gE(h,x.aspectRatio,x.resolution);s(b,k,()=>v)}catch(f){o(f.message)}finally{m(null),i(k)}}},[e,t,o,u,r,s,a,i,l,c,d]);return{isGeneratingVideo:p,handleGenerateVideo:w}},qE=(e,t)=>{let o=e;e.startsWith("data:image/png")&&(o=$i(e,"prompt",t));const r=document.createElement("a");r.href=o;const s=`Image_Editor_Frame_001_${new Date().toISOString().split("T")[0]}.png`;r.download=s,document.body.appendChild(r),r.click(),document.body.removeChild(r)},n0=(e,t)=>Promise.race([e,new Promise((o,r)=>{t.aborted&&r(new DOMException("Aborted","AbortError"));const a=()=>{t.removeEventListener("abort",a),r(new DOMException("Aborted","AbortError"))};t.addEventListener("abort",a)})]),OE=({nodes:e,getUpstreamNodeValues:t,setError:o,t:r,registerOperation:a,unregisterOperation:i,updateNodeInStorage:s,getFullSizeImage:l,activeTabId:c,activeTabName:d,activeTabIdRef:u})=>{const[p,m]=y.useState(!1),[w,k]=y.useState(!1),b=y.useRef(null),x=y.useCallback(async(h,v)=>{const N=u.current,_=e.find(O=>O.id===h);if(!_)return;const E=JSON.parse(_.value||"{}"),I=E.isSequenceMode,B=t(h,"text").filter(O=>typeof O=="string"),M=t(h,"image").filter(O=>typeof O=="object"),G=t(h,"image_b").filter(O=>typeof O=="object"),V=new Map;B.forEach(O=>{try{const z=JSON.parse(O);let L=[];if(z.sourcePrompts||z.modifiedPrompts){const W=z.sourcePrompts||[],D=z.modifiedPrompts||[],T=new Map;W.forEach(F=>T.set(F.frameNumber,F)),D.forEach(F=>T.set(F.frameNumber,{...T.get(F.frameNumber),...F})),L=Array.from(T.values())}else z.type==="script-prompt-modifier-data"?L=z.finalPrompts||z.prompts||[]:Array.isArray(z)&&(L=z);L.length>0&&L.forEach((W,D)=>{const T=(W.frameNumber!==void 0?W.frameNumber:D+1)-1;W.prompt&&V.set(T,W.prompt)})}catch{}});const j=(E.inputImages||[]).map((O,z)=>{var D;const W=l(_.id,z+1)||O;return{base64ImageData:W.split(",")[1],mimeType:((D=W.match(/:(.*?);/))==null?void 0:D[1])||"image/png"}}),P=(E.inputImagesB||[]).map((O,z)=>{var D;const W=l(_.id,2e3+z+1)||O;return{base64ImageData:W.split(",")[1],mimeType:((D=W.match(/:(.*?);/))==null?void 0:D[1])||"image/png"}}),S=[...j,...M],A=[...P,...G];if(!E.isSequentialEditingWithPrompts&&S.length===0&&E.model!=="gemini-3-pro-image-preview"){o("No input image provided for editing.");return}m(!0),o(null),k(!1),b.current=new AbortController,a({id:h,type:"generation",description:r("node.content.editing"),tabId:c,tabName:d});try{if(I){const O=v||(E.isSequentialEditingWithPrompts?E.checkedSequenceOutputIndices||A.map((W,D)=>D):E.checkedInputIndices??S.map((W,D)=>D)),L=[...E.sequenceOutputs||[]];O.forEach(W=>{L[W]={status:"pending",thumbnail:null}}),s(N,h,W=>({...W,sequenceOutputs:L}));for(const W of O){if(b.current.signal.aborted)break;let D=[];if(E.isSequentialEditingWithPrompts)D=A;else{const T=S[W];if(!T&&E.model!=="gemini-3-pro-image-preview")continue;T&&(D=[T]),E.isSequentialCombinationMode&&A.length>0&&D.push(...A)}s(N,h,T=>{const F=[...T.sequenceOutputs||[]];return F[W]={...F[W],status:"generating"},{...T,sequenceOutputs:F}});try{let T=E.prompt;(E.isSequentialPromptMode||E.isSequentialEditingWithPrompts)&&(V.has(W)?T=V.get(W):E.framePrompts&&E.framePrompts[W]&&(T=E.framePrompts[W]));const F=B.filter(K=>!K.trim().startsWith("{")&&!K.trim().startsWith("["));let te=[T,...F].filter(Boolean).join(", ");te.trim()||(te="High quality image");const $=await Promise.all(D.map(async K=>{var Z;const ie=`data:${K.mimeType};base64,${K.base64ImageData}`;if(E.enableAspectRatio&&E.aspectRatio&&E.aspectRatio!=="Auto"){const{formattedImage:se}=await kr(ie,E.aspectRatio);return{base64ImageData:se.split(",")[1],mimeType:((Z=se.match(/:(.*?);/))==null?void 0:Z[1])||"image/png"}}return K}));E.enableOutpainting&&(te=(E.outpaintingPrompt||"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.").replace("{main_prompt}",te));const Y=await n0($n(te,E.aspectRatio,$,E.model,E.resolution),b.current.signal);let oe=Y;if(E.autoCrop169)try{oe=await za(Y)}catch{}const le=await Ot(oe,256,256);if(s(N,h,K=>{const ie=[...K.sequenceOutputs||[]];return ie[W]={status:"done",thumbnail:le},{...K,sequenceOutputs:ie}},{frame:1e3+W,url:oe}),E.autoDownload){const ie=new Date().toISOString().split("T")[0],se=`Image_Editor_Frame_${String(W+1).padStart(3,"0")}_${ie}.png`;let de=oe;oe.startsWith("data:image/png")&&(de=$i(oe,"prompt",te));const re=document.createElement("a");re.href=de,re.download=se,document.body.appendChild(re),re.click(),document.body.removeChild(re)}}catch(T){if(T.name==="AbortError"||T.message==="Aborted"){s(N,h,F=>{const te=[...F.sequenceOutputs||[]];return te[W]={...te[W],status:"pending"},{...F,sequenceOutputs:te}});break}else console.error(`Frame ${W} failed`,T),s(N,h,F=>{const te=[...F.sequenceOutputs||[]];return te[W]={status:"error",thumbnail:null},{...F,sequenceOutputs:te}})}}}else{let O=[];const z=E.checkedInputIndices;z&&Array.isArray(z)?O=S.filter(($,Y)=>z.includes(Y)):O=S;const L=B.filter($=>!$.trim().startsWith("{")&&!$.trim().startsWith("["));let W=[E.prompt,...L].filter(Boolean).join(", ");W.trim()||(W="High quality image");const D=await Promise.all(O.map(async $=>{var oe;const Y=`data:${$.mimeType};base64,${$.base64ImageData}`;if(E.enableAspectRatio&&E.aspectRatio&&E.aspectRatio!=="Auto"){const{formattedImage:le}=await kr(Y,E.aspectRatio);return{base64ImageData:le.split(",")[1],mimeType:((oe=le.match(/:(.*?);/))==null?void 0:oe[1])||"image/png"}}return $}));E.enableOutpainting&&(W=(E.outpaintingPrompt||"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.").replace("{main_prompt}",W));const T=await n0($n(W,E.aspectRatio,D,E.model,E.resolution),b.current.signal);let F=T;if(E.autoCrop169)try{F=await za(T)}catch{}const te=await Ot(F,256,256);s(N,h,$=>({...$,outputImage:te}),{frame:0,url:F}),E.autoDownload&&qE(F,W)}}catch(O){O.name!=="AbortError"&&O.message!=="Aborted"&&o(O.message)}finally{m(!1),k(!1),b.current=null,i(h)}},[e,t,l,o,r,s,a,i,c,d,u]),f=y.useCallback(()=>{b.current&&(k(!0),b.current.abort())},[]);return{isEditingImage:p,isStoppingEdit:w,handleEditImage:x,handleStopEdit:f}},o0=(e,t)=>Promise.race([e,new Promise((o,r)=>{t.aborted&&r(new DOMException("Aborted","AbortError"));const a=()=>{t.removeEventListener("abort",a),r(new DOMException("Aborted","AbortError"))};t.addEventListener("abort",a)})]),r0=(e,t,o)=>{let r=e;e.startsWith("data:image/png")&&(r=$i(e,"prompt",o));const a=document.createElement("a");a.href=r;const i=new Date,s=i.toISOString().split("T")[0],l=i.toTimeString().split(" ")[0].replace(/:/g,"-"),c=String(t).padStart(3,"0");a.download=`Frame_${c}_seq_gen_${s}_${l}.png`,document.body.appendChild(a),a.click(),document.body.removeChild(a)},FE=({nodes:e,setError:t,t:o,registerOperation:r,unregisterOperation:a,updateNodeInStorage:i,connectedCharacterData:s,activeTabId:l,activeTabName:c,activeTabIdRef:d,addToast:u,setFullSizeImage:p})=>{const[m,w]=y.useState(null),[k,b]=y.useState(!1),x=y.useRef(null),f=(I,B)=>{const M=I.characterConcepts||[];return[...(s.get(B)||[]).map(j=>({...j,id:j.index||j.alias||j.name||`upstream-${Math.random().toString(36).substr(2,5)}`,isUpstream:!0})),...M]},h=(I,B)=>{if(!I)return null;const M=V=>String(V).toLowerCase().replace(/[^a-z0-9]/g,""),G=M(I);return B.find(V=>!!(V.index&&M(V.index)===G||V.alias&&M(V.alias)===G||V.name&&M(V.name)===G||V.id&&M(V.id)===G))},v=y.useCallback((I,B)=>{i(I,B,M=>{const G={...M.frameStatuses||{}};let V=!1;return Object.keys(G).forEach(j=>{const P=G[j];(P==="pending"||P==="generating"||P==="prompt_processing")&&(G[j]="idle",V=!0)}),V?{...M,frameStatuses:G}:M})},[i]),N=y.useCallback(async(I,B=0)=>{var V;const M=d.current,G=e.find(j=>j.id===I);if(G){w(I),t(null),b(!1),x.current=new AbortController,r({id:I,type:"sequence",description:o("node.content.generating"),tabId:l,tabName:c});try{const j=JSON.parse(G.value||"{}"),P=j.prompts||[],S=f(j,I),A=P.slice(B),O=j.isStyleInserted!==!1,z=j.isSceneContextInserted!==!1,L=j.sceneContexts||{},W=j.integrationPrompt||"Integrate these Entities into the scene, action and pose. Fill the background with environmental elements  fill in the gray area of the source scene image naturally.";i(M,I,D=>{const T={...D.frameStatuses||{}};return Object.keys(T).forEach(F=>{T[F]==="generating"&&(T[F]="idle")}),A.forEach(F=>{T[F.frameNumber]="pending"}),{...D,frameStatuses:T}});for(const D of A){if((V=x.current)!=null&&V.signal.aborted)break;const T=D.frameNumber;i(M,I,F=>({...F,frameStatuses:{...F.frameStatuses||{},[T]:"generating"}}));try{let F=D.characters||[];if(F.length===0&&D.prompt){const Z=D.prompt.match(/(?:character|entity)-\d+/gi);Z&&(F=[...new Set(Z)])}const te=[],$=new Set;for(const Z of F){const se=h(Z,S);if(!se||$.has(se.index||se.id))continue;const de=se._fullResImage||se.image;if(de&&typeof de=="string"&&de.startsWith("data:")){const re=de.match(/:(.*?);/),R=de.split(",")[1];R&&(te.push({base64ImageData:R,mimeType:re?re[1]:"image/png",_dataUrl:de}),$.add(se.index||se.id))}}let Y=D.prompt;if(z){const Z=D.sceneNumber||1,se=L[String(Z)];se&&se.trim()&&(Y=`${se.trim()}

${Y}`)}if(te.length>0){const Z=D.shotType?o(`image_sequence.shot_type.${D.shotType}`):o("image_sequence.shot_type.MS");if(Y=`${W}
${Z}

${Y}`,j.characterPromptCombination==="replace"){const se=new Set;Y=Y.replace(/((?:Character|Entity)[-\s]?\d+|(?:Character|Entity)[-\s]?\w+)/gi,de=>{const re=h(de,S);if(re&&re.prompt){const R=re.index||re.id||de.toLowerCase();return se.has(R)?de:(se.add(R),`${de} (${re.prompt})`)}return de})}}let oe=[];j.enableAspectRatio&&j.aspectRatio&&j.aspectRatio!=="Auto"&&te.length>0?oe=await Promise.all(te.map(async Z=>{var se;try{const{formattedImage:de}=await kr(Z._dataUrl,j.aspectRatio);return{base64ImageData:de.split(",")[1],mimeType:((se=de.match(/:(.*?);/))==null?void 0:se[1])||"image/png"}}catch{return{base64ImageData:Z.base64ImageData,mimeType:Z.mimeType}}})):oe=te.map(Z=>({base64ImageData:Z.base64ImageData,mimeType:Z.mimeType})),O&&j.styleOverride&&(Y=`${Y}

[Visual Style]: ${j.styleOverride}`);const le=await o0($n(Y,j.aspectRatio,oe.length>0?oe:void 0,j.model),x.current.signal);let K=le;if(j.autoCrop169&&j.aspectRatio==="16:9")try{K=await za(le)}catch{}const ie=await Ot(K,256,256);i(M,I,Z=>({...Z,images:{...Z.images||{},[T]:ie},frameStatuses:{...Z.frameStatuses||{},[T]:"done"}}),{frame:1e3+T,url:K}),j.autoDownload&&r0(K,T,D.prompt),await new Promise(Z=>setTimeout(Z,50))}catch(F){if(F.name==="AbortError"||F.message==="Aborted"){i(M,I,te=>({...te,frameStatuses:{...te.frameStatuses||{},[T]:"idle"}}));break}else console.error(`Frame ${T} failed:`,F),i(M,I,te=>({...te,frameStatuses:{...te.frameStatuses||{},[T]:"error"}}))}}}catch(j){j.name!=="AbortError"&&j.message!=="Aborted"&&t(j.message)}finally{v(M,I),w(null),b(!1),x.current=null,a(I)}}},[e,s,t,o,i,r,a,l,c,d,u,p,v]),_=y.useCallback(async(I,B)=>{var P;const M=d.current,G=e.find(S=>S.id===I);if(!G)return;const V=JSON.parse(G.value||"{}"),j=B||V.checkedFrameNumbers||[];if(j.length!==0){w(I),t(null),b(!1),x.current=new AbortController,r({id:I,type:"sequence",description:o("node.content.generating"),tabId:l,tabName:c});try{const S=V.prompts||[],A=f(V,I),O=S.filter(T=>j.includes(T.frameNumber)),z=V.isStyleInserted!==!1,L=V.isSceneContextInserted!==!1,W=V.sceneContexts||{},D=V.integrationPrompt||"Integrate these Entities into the scene, action and pose. Fill the background with environmental elements  fill in the gray area of the source scene image naturally.";i(M,I,T=>{const F={...T.frameStatuses||{}};return Object.keys(F).forEach(te=>{F[te]==="generating"&&(F[te]="idle")}),j.forEach(te=>{F[te]="pending"}),{...T,frameStatuses:F}});for(const T of O){if((P=x.current)!=null&&P.signal.aborted)break;const F=T.frameNumber;i(M,I,te=>({...te,frameStatuses:{...te.frameStatuses||{},[F]:"generating"}}));try{let te=T.characters||[];if(te.length===0&&T.prompt){const se=T.prompt.match(/(?:character|entity)-\d+/gi);se&&(te=[...new Set(se)])}const $=[],Y=new Set;for(const se of te){const de=h(se,A);if(!de||Y.has(de.index||de.id))continue;const re=de._fullResImage||de.image;if(re&&typeof re=="string"&&re.startsWith("data:")){const R=re.match(/:(.*?);/),J=re.split(",")[1];J&&($.push({base64ImageData:J,mimeType:R?R[1]:"image/png",_dataUrl:re}),Y.add(de.index||de.id))}}let oe=T.prompt;if(L){const se=T.sceneNumber||1,de=W[String(se)];de&&de.trim()&&(oe=`${de.trim()}

${oe}`)}if($.length>0){const se=T.shotType?o(`image_sequence.shot_type.${T.shotType}`):o("image_sequence.shot_type.MS");if(oe=`${D}
${se}

${oe}`,V.characterPromptCombination==="replace"){const de=new Set;oe=oe.replace(/((?:Character|Entity)[-\s]?\d+|(?:Character|Entity)[-\s]?\w+)/gi,re=>{const R=h(re,A);if(R&&R.prompt){const J=R.index||R.id||re.toLowerCase();return de.has(J)?re:(de.add(J),`${re} (${R.prompt})`)}return re})}}let le=[];V.enableAspectRatio&&V.aspectRatio&&V.aspectRatio!=="Auto"&&$.length>0?le=await Promise.all($.map(async se=>{var de;try{const{formattedImage:re}=await kr(se._dataUrl,V.aspectRatio);return{base64ImageData:re.split(",")[1],mimeType:((de=re.match(/:(.*?);/))==null?void 0:de[1])||"image/png"}}catch{return{base64ImageData:se.base64ImageData,mimeType:se.mimeType}}})):le=$.map(se=>({base64ImageData:se.base64ImageData,mimeType:se.mimeType})),z&&V.styleOverride&&(oe=`${oe}

[Visual Style]: ${V.styleOverride}`);const K=await o0($n(oe,V.aspectRatio,le.length>0?le:void 0,V.model),x.current.signal);let ie=K;if(V.autoCrop169&&V.aspectRatio==="16:9")try{ie=await za(K)}catch{}const Z=await Ot(ie,256,256);i(M,I,se=>({...se,images:{...se.images||{},[F]:Z},frameStatuses:{...se.frameStatuses||{},[F]:"done"}}),{frame:1e3+F,url:ie}),V.autoDownload&&r0(ie,F,T.prompt),await new Promise(se=>setTimeout(se,50))}catch(te){if(te.name==="AbortError"&&te.message==="Aborted"){i(M,I,$=>({...$,frameStatuses:{...$.frameStatuses||{},[F]:"idle"}}));break}else console.error(`Frame ${F} failed:`,te),i(M,I,$=>({...$,frameStatuses:{...$.frameStatuses||{},[F]:"error"}}))}}}catch(S){S.name!=="AbortError"&&S.message!=="Aborted"&&t(S.message)}finally{v(M,I),w(null),b(!1),x.current=null,a(I)}}},[e,s,t,o,i,r,a,l,c,d,u,p,v]),E=y.useCallback(()=>{x.current&&(b(!0),x.current.abort())},[]);return{isGeneratingSequence:m,isStoppingSequence:k,handleGenerateImageSequence:N,handleGenerateSelectedFrames:_,handleStopImageSequence:E}},BE=({nodes:e,setError:t,t:o,registerOperation:r,unregisterOperation:a,updateNodeInStorage:i,activeTabId:s,activeTabName:l,activeTabIdRef:c})=>{const[d,u]=y.useState(null),p=y.useCallback(async(m,w)=>{const k=c.current,b=e.find(x=>x.id===m);if(b){u(`${m}-${w}`),r({id:m,type:"generation",description:o("node.content.generating"),tabId:s,tabName:l});try{const x=JSON.parse(b.value||"{}"),f=x.characters||[],h=f.find(M=>M.id===w);if(!h)throw new Error("Character not found");const v=h.prompt||h.imagePrompt;if(!v)throw new Error("No prompt for character");const N=x.additionalPrompt||"",_=N.trim()?`${v}, ${N}`:v,I=(await $n(_,"1:1",void 0,"gemini-3-flash-preview")).split(",")[1],B=f.map(M=>M.id===w?{...M,imageBase64:I}:M);i(k,m,M=>({...M,characters:B}))}catch(x){t(x.message)}finally{u(null),a(m)}}},[e,t,o,i,r,a,s,l,c]);return{isGeneratingCharacterImage:d,handleGenerateCharacterImage:p}},HE=({nodes:e,connections:t,setNodes:o,getUpstreamNodeValues:r,setError:a,showApiKeyDialog:i,t:s,setFullSizeImage:l,getFullSizeImage:c,connectedCharacterData:d,activeTabId:u,setTabs:p,activeTabName:m,registerOperation:w,unregisterOperation:k,isGlobalProcessing:b,addToast:x})=>{const f=y.useRef(u);y.useEffect(()=>{f.current=u},[u]);const h=y.useCallback((M,G,V,j)=>{const P=S=>{try{return JSON.parse(S||"{}")}catch{return S}};f.current===M?(j&&l(G,j.frame,j.url),o(S=>S.map(A=>{if(A.id===G){const O=P(A.value),z=V(O),L=typeof z=="string"?z:JSON.stringify(z);return{...A,value:L}}return A}))):p(S=>S.map(A=>{if(A.id===M){const O=A.state.nodes.map(L=>{if(L.id===G){const W=P(L.value),D=V(W),T=typeof D=="string"?D:JSON.stringify(D);return{...L,value:T}}return L});let z=A.state.fullSizeImageCache||{};return j&&(z={...z,[G]:{...z[G]||{},[j.frame]:j.url}}),{...A,state:{...A.state,nodes:O,fullSizeImageCache:z}}}return A}))},[o,p,l]),v={nodes:e,setNodes:o,getUpstreamNodeValues:r,setError:a,t:s,setFullSizeImage:l,getFullSizeImage:c,activeTabId:u,setTabs:p,activeTabName:m,registerOperation:w,unregisterOperation:k,updateNodeInStorage:h,activeTabIdRef:f,addToast:x},N=DE(v),_=zE({...v,showApiKeyDialog:i}),E=OE(v),I=FE({...v,connectedCharacterData:d}),B=BE(v);return{isGeneratingImage:N.isGeneratingImage,handleGenerateImage:N.handleGenerateImage,isGeneratingVideo:_.isGeneratingVideo,handleGenerateVideo:_.handleGenerateVideo,isEditingImage:E.isEditingImage,isStoppingEdit:E.isStoppingEdit,handleEditImage:E.handleEditImage,handleStopEdit:E.handleStopEdit,isGeneratingSequence:I.isGeneratingSequence,isStoppingSequence:I.isStoppingSequence,handleGenerateImageSequence:I.handleGenerateImageSequence,handleGenerateSelectedFrames:I.handleGenerateSelectedFrames,handleStopImageSequence:I.handleStopImageSequence,isGeneratingCharacterImage:B.isGeneratingCharacterImage,handleGenerateCharacterImage:B.handleGenerateCharacterImage}},GE=({nodes:e,setNodes:t,getUpstreamNodeValues:o,setError:r,t:a,activeTabId:i,setTabs:s,activeTabName:l,registerOperation:c,unregisterOperation:d,addToast:u})=>{const[p,m]=y.useState(null),[w,k]=y.useState(null),[b,x]=y.useState(null),[f,h]=y.useState(null),[v,N]=y.useState(null),[_,E]=y.useState(null),[I,B]=y.useState(null),[M,G]=y.useState(null),[V,j]=y.useState(null),[P,S]=y.useState(null),[A,O]=y.useState(null),[z,L]=y.useState(null),[W,D]=y.useState(null),[T,F]=y.useState(!1),te=y.useRef(null),$=y.useRef(i);y.useEffect(()=>{$.current=i},[i]);const Y=y.useCallback((ne,X,ue)=>{const Q=ce=>{try{return JSON.parse(ce||"{}")}catch{return ce}};$.current===ne?t(ce=>ce.map(pe=>{if(pe.id===X){const me=Q(pe.value),ke=ue(me),Re=typeof ke=="string"?ke:JSON.stringify(ke);return{...pe,value:Re}}return pe})):s(ce=>ce.map(pe=>{if(pe.id===ne){const me=pe.state.nodes.map(ke=>{if(ke.id===X){const Re=Q(ke.value),Me=ue(Re),De=typeof Me=="string"?Me:JSON.stringify(Me);return{...ke,value:De}}return ke});return{...pe,state:{...pe.state,nodes:me}}}return pe}))},[t,s]),oe=y.useCallback(async ne=>{const X=$.current;m(ne),r(null),c({id:ne,type:"generation",description:a("node.content.enhancing"),tabId:i,tabName:l});try{const ue=e.find(Me=>Me.id===ne);if(!ue)return;let Q;try{Q=JSON.parse(ue.value||"{}")}catch{Q={prompt:ue.value}}const ce=Q.safePrompt!==!1,pe=Q.technicalPrompt===!0,me=Q.model||"gemini-3-flash-preview";let ke=o(ne).filter(Me=>typeof Me=="string");ke.length===0&&Q.inputPrompt&&(ke=[Q.inputPrompt]);const Re=await ny(ke,ce,pe,me);Y(X,ne,Me=>({...Me,prompt:Re}))}catch(ue){r(ue.message)}finally{m(null),d(ne)}},[e,o,r,a,Y,c,d,i,l]),le=y.useCallback(async ne=>{const X=$.current;x(ne),r(null),c({id:ne,type:"generation",description:a("node.content.sanitizing"),tabId:i,tabName:l});try{const ue=o(ne).filter(ce=>typeof ce=="string"),Q=await oy(ue.join(", "));Y(X,ne,()=>Q)}catch(ue){r(ue.message)}finally{x(null),d(ne)}},[o,r,a,Y,c,d,i,l]),K=y.useCallback(async ne=>{const X=$.current;k(ne),r(null),c({id:ne,type:"generation",description:a("node.content.enhancing"),tabId:i,tabName:l});try{const ue=o(ne).filter(ce=>typeof ce=="string"),Q=await ry(ue);Y(X,ne,ce=>typeof ce=="object"?{...ce,prompt:Q}:Q)}catch(ue){r(ue.message)}finally{k(null),d(ne)}},[o,r,a,Y,c,d,i,l]),ie=y.useCallback(async ne=>{const X=$.current;h(ne),r(null),c({id:ne,type:"generation",description:a("node.content.translating"),tabId:i,tabName:l});try{const ue=e.find(Re=>Re.id===ne);if(!ue)return;const Q=JSON.parse(ue.value||"{}"),ce=o(ne).filter(Re=>typeof Re=="string");let pe=ce.length>0?ce.join(`
`):Q.inputText;const me=Q.targetLanguage||"en";if(Q.image&&typeof Q.image=="string"&&Q.image.startsWith("data:image")){const Re=Q.image.split(",");if(Re.length===2){const Me=Q.image.match(/:(.*?);/),De=Me?Me[1]:"image/png",Ie=Re[1],Ne=await Jp(Ie,De);Ne&&Ne!=="No text found"&&(pe=Ne,Q.inputText=Ne)}}const ke=await Yp(pe,me);Y(X,ne,Re=>({...Re,inputText:pe,translatedText:ke}))}catch(ue){r(ue.message)}finally{h(null),d(ne)}},[e,o,r,a,Y,c,d,i,l]),Z=y.useCallback(async ne=>{const X=$.current;N(ne),r(null),c({id:ne,type:"generation",description:a("node.content.translating"),tabId:i,tabName:l});try{const ue=e.find(Re=>Re.id===ne);if(!ue)return;const Q=JSON.parse(ue.value||"{}"),ce=Q.targetLanguage||"en",me={en:"English",ru:"Russian"}[ce]||"English",ke=await xE(Q,me);Y(X,ne,()=>(ke.targetLanguage=ce,ke))}catch(ue){r(ue.message)}finally{N(null),d(ne)}},[e,r,a,Y,c,d,i,l]),se=y.useCallback(async ne=>{const X=$.current;E(ne),r(null),c({id:ne,type:"generation",description:a("node.content.generating"),tabId:i,tabName:l});try{const ue=e.find(Re=>Re.id===ne);if(!ue)return;const Q=JSON.parse(ue.value||"{}"),ce=o(ne).filter(Re=>typeof Re=="string"),pe=ce.length>0?ce.join(`
`):Q.prompt,me=Q.targetLanguage||"en",ke=await ly(pe,me);Y(X,ne,Re=>({...Re,...ke,prompt:pe,type:"script-generator-data"}))}catch(ue){r(ue.message)}finally{E(null),d(ne)}},[e,o,r,a,Y,c,d,i,l]),de=y.useCallback(async ne=>{var ue;const X=$.current;B(ne),r(null),te.current=new AbortController,c({id:ne,type:"generation",description:a("node.content.generating"),tabId:i,tabName:l});try{const Q=e.find(We=>We.id===ne);if(!Q)return;const ce=JSON.parse(Q.value||"{}"),pe=o(ne).filter(We=>typeof We=="string"),me=pe.length>0?pe.join(`
`):ce.prompt,ke=ce.numberOfCharacters||1,Re=ce.targetLanguage||"ru",Me=ce.characterType||"simple",De=ce.style||"simple",Ie=ce.customStyle||"",Ne=ce.characters||[],Pe=`Generate ${ke} detailed character description(s) based on this prompt: "${me}". 
            Language for CONTENT: ${Re}. 
            Character Type: ${Me}. 
            Visual Style: ${De==="custom"?Ie:De}.
            
            **CRITICAL REQUIREMENTS:**
            1. **APPEARANCE ONLY**: Focus strictly on physical attributes: physiognomy, hair/fur texture, eye color, body type, clothing details, colors, and materials.
            2. **NEGATIVE CONSTRAINTS**: Do NOT describe the pose, action, gesture, expression (e.g. smiling), background, lighting, or camera angle.
            3. **FORMAT**: You MUST use the following English Markdown Headers exactly as written, regardless of content language:
               #### Appearance
               #### Personality
               #### Clothing
            
            REQUIRED OUTPUT FORMAT:
            Return a JSON array where each object has:
            - 'name': Character name.
            - 'index': Short identifier (e.g. Entity-1, Entity-2).
            - 'imagePrompt': A highly detailed English image generation prompt describing the character's visual features ONLY.
            - 'fullDescription': A detailed text description formatted with the markdown headers specified above.
            `,ye=await cy(Pe);if((ue=te.current)!=null&&ue.signal.aborted)return;let _e=0;Ne.forEach(We=>{const $e=(We.index||We.alias||"").match(/(?:Entity|Character)-(\d+)/i);$e&&(_e=Math.max(_e,parseInt($e[1],10)))});const Fe=ye.map((We,Ze)=>({id:`char-${Date.now()}-${Ze}`,...We,index:We.index||`Entity-${_e+Ze+1}`,prompt:We.imagePrompt}));Y(X,ne,We=>{const Ze=We.characters||[],$e=[...Fe,...Ze];return{...We,characters:$e,prompt:me,error:null}})}catch(Q){Q.name!=="AbortError"&&r(Q.message)}finally{B(null),te.current=null,F(!1),d(ne)}},[e,o,r,a,Y,c,d,i,l]),re=y.useCallback(()=>{te.current&&(F(!0),te.current.abort())},[]),R=y.useCallback(async ne=>{const X=$.current;G(ne),r(null),c({id:ne,type:"sequence",description:a("prompt_sequence_editor.modifying"),tabId:i,tabName:l});try{const ue=e.find(We=>We.id===ne);if(!ue)return;const{instruction:Q,sourcePrompts:ce=[],checkedSourceFrameNumbers:pe=[],targetLanguage:me="en",modificationModel:ke="gemini-2.5-flash",includeVideoPrompts:Re=!1,checkedContextScenes:Me=[],sceneContexts:De={}}=JSON.parse(ue.value||"{}");if(!Q||!Q.trim())throw new Error("Modification instruction is empty.");if(!pe||pe.length===0)throw new Error("No source prompts selected for modification.");const Ie=ce.filter(We=>pe.includes(We.frameNumber));if(Ie.length===0)throw new Error("Selected prompts not found in the source list.");let Ne={};new Set(Ie.map(We=>We.sceneNumber)).forEach(We=>{De[We]&&Me.includes(We)&&(Ne[String(We)]=De[We])});const ye=await dy(Ie,Q,me,ke,Re,Ne),{modifiedFrames:_e,modifiedSceneContexts:Fe}=ye;Y(X,ne,We=>{const Ze=We.modifiedPrompts||[],$e=We.sourcePrompts||[],He=new Map($e.map(qe=>[qe.frameNumber,qe])),be=new Map(Ze.map(qe=>[qe.frameNumber,qe]));_e.forEach(qe=>{const Ye=He.get(qe.frameNumber);Ye&&(qe.sceneNumber=Ye.sceneNumber,qe.sceneTitle=Ye.sceneTitle),be.set(qe.frameNumber,qe)});const Ae=Array.from(be.values());let Te={...We.modifiedSceneContexts||{}};return Fe&&Fe.length>0&&Fe.forEach(qe=>{qe.sceneNumber&&qe.context&&(Te[String(qe.sceneNumber)]=qe.context)}),{...We,modifiedPrompts:Ae,modifiedSceneContexts:Te}})}catch(ue){r(ue.message)}finally{G(null),d(ne)}},[e,r,a,Y,c,d,i,l]),J=y.useCallback(async(ne,X)=>{var ce;const ue=$.current,Q=`${ne}-${X}`;j(Q),r(null),c({id:Q,type:"generation",description:a("node.content.enhancing"),tabId:i,tabName:l});try{const pe=e.find(ye=>ye.id===ne);if(!pe)return;const me=JSON.parse(pe.value||"[]"),Re=(Array.isArray(me)?me:[me])[X];if(!Re)throw new Error("Character card not found at specified index.");const Me=Re.prompt,De=Re.fullDescription,Ie=Re.targetLanguage||localStorage.getItem("settings_secondaryLanguage")||"en",Ne=((ce=xn[Ie])==null?void 0:ce.name)||"English";if(!Me||!Me.trim())throw new Error("Image prompt is missing for this character.");const Pe=await uE(Me,De,Ne);Y(ue,ne,ye=>{const _e=Array.isArray(ye)?[...ye]:[ye];return _e[X]&&(_e[X]={..._e[X],fullDescription:Pe}),_e}),u("Description updated successfully","success")}catch(pe){r(pe.message)}finally{j(null),d(Q)}},[e,r,a,Y,c,d,i,l,u]),H=y.useCallback(async(ne,X,ue,Q)=>{var me;const ce=$.current,pe=`${ne}-${X}-${ue}`;Q(pe),r(null),c({id:pe,type:"generation",description:a("node.content.enhancing"),tabId:i,tabName:l});try{const ke=e.find(He=>He.id===ne);if(!ke)return;const Re=JSON.parse(ke.value||"[]"),De=(Array.isArray(Re)?Re:[Re])[X];if(!De)throw new Error("Character card not found at specified index.");const Ie=De.prompt;if(!Ie)throw new Error("Image prompt required for update.");const Ne=De.fullDescription||"",Pe=De.targetLanguage||localStorage.getItem("settings_secondaryLanguage")||"en",ye=((me=xn[Pe])==null?void 0:me.name)||"English",Fe=new RegExp(`####\\s*(${ue}|${a(`node.content.${ue.toLowerCase()}`)})\\s*([\\s\\S]*?)(?=####|$)`,"i").exec(Ne),We=Fe?Fe[2].trim():"",Ze=await pE(ue,Ie,We,ye);let $e=Ne;if(Fe){const He=Fe[0],Ae=`#### ${Fe[1]}
${Ze}
`;$e=Ne.replace(He,Ae)}else{const He=a(`node.content.${ue.toLowerCase()}`)||ue;$e+=`

#### ${He}
${Ze}`}Y(ce,ne,He=>{const be=Array.isArray(He)?[...He]:[He];return be[X]&&(be[X]={...be[X],fullDescription:$e}),be}),u(`${ue} updated successfully`,"success")}catch(ke){r(ke.message)}finally{Q(null),d(pe)}},[e,r,a,Y,c,d,i,l,u]),U=y.useCallback((ne,X)=>{H(ne,X,"Appearance",O)},[H]),ee=y.useCallback((ne,X)=>{H(ne,X,"Clothing",L)},[H]),ae=y.useCallback(async(ne,X)=>{var ce;const ue=$.current,Q=`${ne}-${X}-personality`;S(Q),r(null),c({id:Q,type:"generation",description:a("node.content.enhancing"),tabId:i,tabName:l});try{const pe=e.find(We=>We.id===ne);if(!pe)return;const me=JSON.parse(pe.value||"[]"),Re=(Array.isArray(me)?me:[me])[X];if(!Re)throw new Error("Character card not found at specified index.");const Me=Re.fullDescription||"",De=Re.targetLanguage||localStorage.getItem("settings_secondaryLanguage")||"en",Ie=((ce=xn[De])==null?void 0:ce.name)||"English",Pe=/####\s*(Personality|||Personalidad)\s*([\s\S]*?)(?=####|$)/i.exec(Me),ye=Pe?Pe[2].trim():"";if(!ye)throw new Error("Personality section is empty or not found.");const _e=await hE(ye,Ie);let Fe=Me;if(Pe){const We=Pe[0],$e=`#### ${Pe[1]}
${_e}
`;Fe=Me.replace(We,$e)}else Fe+=`

#### Personality
${_e}`;Y(ue,ne,We=>{const Ze=Array.isArray(We)?[...We]:[We];return Ze[X]&&(Ze[X]={...Ze[X],fullDescription:Fe}),Ze}),u("Personality updated successfully","success")}catch(pe){r(pe.message)}finally{S(null),d(Q)}},[e,r,a,Y,c,d,i,l,u]),xe=y.useCallback(async(ne,X,ue)=>{var pe;const Q=$.current,ce=`${ne}-${X}`;D(ce),r(null),c({id:ce,type:"generation",description:a("prompt_sequence_editor.modifying"),tabId:i,tabName:l});try{const me=e.find(_e=>_e.id===ne);if(!me)return;const ke=JSON.parse(me.value||"[]"),Me=(Array.isArray(ke)?ke:[ke])[X];if(!Me)throw new Error("Character card not found.");const De=Me.prompt,Ie=Me.fullDescription,Ne=Me.targetLanguage||localStorage.getItem("settings_secondaryLanguage")||"en",Pe=((pe=xn[Ne])==null?void 0:pe.name)||"English",ye=await mE(ue,De,Ie,Pe);Y(Q,ne,_e=>{const Fe=Array.isArray(_e)?[..._e]:[_e];return Fe[X]&&(Fe[X]={...Fe[X],prompt:ye.newPrompt,fullDescription:ye.newDescription}),Fe}),u(a("toast.modificationComplete"),"success")}catch(me){r(me.message)}finally{D(null),d(ce)}},[e,r,a,Y,c,d,i,l,u]);return{isEnhancing:p,isEnhancingVideo:w,isSanitizing:b,isTranslating:f,isTranslatingScript:v,isGeneratingScript:_,isGeneratingCharacters:I,isModifyingPromptSequence:M,isUpdatingDescription:V,isUpdatingPersonality:P,isUpdatingAppearance:A,isUpdatingClothing:z,isModifyingCharacter:W,handleEnhance:oe,handleEnhanceVideo:K,handleSanitizePrompt:le,handleTranslate:ie,handleTranslateScript:Z,handleGenerateScript:se,handleGenerateCharacters:de,onModifyPromptSequence:R,handleUpdateCharacterDescription:J,handleUpdateCharacterPersonality:ae,handleUpdateCharacterAppearance:U,handleUpdateCharacterClothing:ee,handleModifyCharacter:xe,isStopping:T,handleStopGeneration:re}},UE=e=>{const[t,o]=y.useState([]),[r,a]=y.useState([]),i=5,s=y.useCallback(d=>{const u=d.map(p=>({id:p.id,position:{...p.position}}));o(p=>{const m=[...p,u];return m.length>i?m.slice(m.length-i):m}),a([])},[]),l=y.useCallback(d=>{o(u=>{if(u.length===0)return u;const p=[...u],m=p.pop();if(m){const w=d.map(k=>({id:k.id,position:{...k.position}}));a(k=>[w,...k]),e(k=>k.map(b=>{const x=m.find(f=>f.id===b.id);return x?{...b,position:{...x.position}}:b}))}return p})},[e]),c=y.useCallback(d=>{a(u=>{if(u.length===0)return u;const p=[...u],m=p.shift();if(m){const w=d.map(k=>({id:k.id,position:{...k.position}}));o(k=>{const b=[...k,w];return b.length>i?b.slice(b.length-i):b}),e(k=>k.map(b=>{const x=m.find(f=>f.id===b.id);return x?{...b,position:{...x.position}}:b}))}return p})},[e]);return{takeSnapshot:s,undoPosition:l,redoPosition:c,canUndo:t.length>0,canRedo:r.length>0}},VE=({nodes:e})=>{const[t,o]=y.useState("idle"),[r,a]=y.useState(null),i=y.useRef(!1);y.useEffect(()=>{if(i.current)return;localStorage.getItem("tutorial_completed")&&o("completed"),i.current=!0},[]);const s=y.useCallback(()=>{if(localStorage.getItem("tutorial_completed")){o("completed");return}o("text_input_0")},[]),l=y.useCallback(()=>{localStorage.setItem("tutorial_completed","true"),o("completed")},[]),c=y.useCallback(()=>{o(u=>{switch(u){case"text_input_0":return"text_input_1";case"text_input_1":return"text_input_2";case"text_input_2":return"prompt_processor_enhance";case"prompt_processor_enhance":return"prompt_processor_waiting";case"prompt_processor_waiting":return"image_output_generate";case"image_output_generate":return"image_output_generating";case"image_output_generating":return"toolbar_group_catalog";case"toolbar_group_catalog":return"toolbar_group_general";case"toolbar_group_general":return"toolbar_group_input";case"toolbar_group_input":return"toolbar_group_processing";case"toolbar_group_processing":return"toolbar_group_character";case"toolbar_group_character":return"toolbar_group_output";case"toolbar_group_output":return"toolbar_group_ai";case"toolbar_group_ai":return"toolbar_group_video";case"toolbar_group_video":return"toolbar_group_scripts";case"toolbar_group_scripts":return"toolbar_group_file";case"toolbar_group_file":return"tutorial_success_message";case"tutorial_success_message":return localStorage.setItem("tutorial_completed","true"),"completed";default:return"completed"}})},[]),d=y.useCallback(u=>{o(u),u==="completed"&&localStorage.setItem("tutorial_completed","true")},[]);return y.useEffect(()=>{if(t==="completed"||t==="idle"||t==="tutorial_success_message"){a(null);return}const u=e.filter(k=>k.type===q.TEXT_INPUT).sort((k,b)=>k.position.y-b.position.y),p=e.filter(k=>k.type===q.PROMPT_PROCESSOR),m=e.filter(k=>k.type===q.IMAGE_OUTPUT);let w=null;switch(t){case"text_input_0":u.length>0&&(w=u[0].id);break;case"text_input_1":u.length>1?w=u[1].id:p.length>0&&o("prompt_processor_enhance");break;case"text_input_2":u.length>2?w=u[2].id:p.length>0&&o("prompt_processor_enhance");break;case"prompt_processor_enhance":case"prompt_processor_waiting":p.length>0&&(w=p[0].id);break;case"image_output_generate":m.length>0&&(w=m[0].id);break}a(w)},[t,e]),{tutorialStep:t,tutorialTargetId:r,advanceTutorial:c,startTutorial:s,setTutorialStep:d,skipTutorial:l}},WE=()=>new Date().toISOString().replace(/:/g,"-").replace("T","_").split(".")[0],$E=(e,t,o,r,a,i,s,l,c,d,u,p,m,w,k,b,x,f,h,v,N,_,E,I,B,M)=>{const G=y.useCallback(($,Y)=>{const oe=e.find(ie=>ie.id===$);if(!oe)return;let le,K="";try{const ie=JSON.parse(oe.value||"{}");if(oe.type===q.IMAGE_OUTPUT||oe.type===q.VIDEO_OUTPUT)le=c($,0)||(typeof ie=="string"?ie:ie.image||oe.value),K=f.getPromptForNode($);else if(oe.type===q.IMAGE_INPUT)le=c($,0)||ie.image,K=ie.prompt||"";else if(oe.type===q.IMAGE_EDITOR)le=c($,0)||ie.outputImage,K=ie.prompt||"";else if(oe.type===q.GEMINI_CHAT){const Z={type:"gemini-chat-history",messages:ie.messages||[],currentInput:ie.currentInput||"",style:ie.style||"general",attachment:ie.attachment||null},se=new Blob([JSON.stringify(Z,null,2)],{type:"application/json"}),de=URL.createObjectURL(se),re=document.createElement("a");re.href=de;const R=WE();re.download=`Gemini_Chat_History_${R}.json`,document.body.appendChild(re),re.click(),document.body.removeChild(re),URL.revokeObjectURL(de),E(B("toast.scriptSaved"),"success");return}}catch{oe.type===q.IMAGE_OUTPUT||oe.type===q.VIDEO_OUTPUT?(le=c($,0)||oe.value,K=f.getPromptForNode($)):oe.type===q.IMAGE_INPUT&&oe.value.startsWith("data:")&&(le=c($,0)||oe.value)}le&&(Y(le,0,K),E(B("toast.downloadStarted"),"success"))},[e,c,f,E,B]),V=y.useCallback($=>{const Y=e.find(K=>K.id===$);if(!Y)return;h.nodeIdCounter&&h.nodeIdCounter.current++;const oe=`node-${h.nodeIdCounter.current}-${Date.now()}`,le={...Y,id:oe,position:{x:Y.position.x+30,y:Y.position.y+30},isNewlyCreated:!0,value:r1(Y)};return t(K=>[...K,le]),E(B("toast.nodeDuplicated")),oe},[e,h.nodeIdCounter,t,E,B]),j=y.useCallback($=>{const Y=e.find(K=>K.id===$);if(!Y)return;h.nodeIdCounter&&h.nodeIdCounter.current++;const oe=`node-${h.nodeIdCounter.current}-${Date.now()}`,le={...Y,id:oe,position:{x:Y.position.x+30,y:Y.position.y+30},isNewlyCreated:!0,value:Y.value};for(let K=0;K<=100;K++){const ie=c($,K);ie&&l(oe,K,ie)}return t(K=>[...K,le]),E(B("toast.nodeDuplicated")),oe},[e,h.nodeIdCounter,t,E,B,c,l]),P=y.useCallback($=>h.handleCopyNodeValue($),[h]),S=y.useCallback($=>h.handlePasteNodeValue($),[h]),A=y.useCallback(($,Y)=>h.handlePasteImageToNode($,Y),[h]),O=y.useCallback(async($,Y,oe,le,K,ie,Z)=>{var re,R,J;let se;try{se=await navigator.clipboard.read()}catch{se=[]}const de=se.some(H=>H.types.some(U=>U.startsWith("image/")));if(!($.length===1&&!Z&&(de&&!await oe($[0])||!await Y($[0]))))try{const H=await navigator.clipboard.read();for(const U of H){if(U.types.some(ee=>ee.startsWith("image/"))){const ee=await U.getType(U.types.find(X=>X.startsWith("image/"))),ae=new File([ee],"pasted_image.png",{type:ee.type}),xe=le.pointerPosition||{x:0,y:0},ne=K.onAddNode(q.IMAGE_INPUT,xe);oe(ne,ae);return}if(U.types.includes("text/plain")){const ee=await navigator.clipboard.readText();try{const ae=JSON.parse(ee),xe=le.pointerPosition||{x:0,y:0};if(ae.type==="prompModifierGroup"||ae.nodes&&ae.connections){K.pasteGroup(ae,xe);return}if(ae.type==="script-analyzer-data"||ae.scenes&&Array.isArray(ae.scenes)&&((re=ae.scenes[0])!=null&&re.frames)){const X=K.onAddNode(q.SCRIPT_VIEWER,xe);ie.handleValueChange(X,ee),E(B("toast.pastedFromClipboard"));return}if(ae.type==="script-prompt-modifier-data"||ae.finalPrompts&&Array.isArray(ae.finalPrompts)){const X=ae.finalPrompts||ae.prompts||[],ue=ae.videoPrompts||[],Q=new Map(ue.map(De=>[De.frameNumber,De])),ce=X.map((De,Ie)=>{const Ne=De.frameNumber!==void 0?De.frameNumber:Ie+1,Pe=Q.get(Ne);let ye=De.characters||[];const _e=De.prompt||"";if(ye.length===0&&_e){const Fe=_e.match(/(?:character|entity)-\d+/gi)||[];ye=[...new Set(Fe.map(We=>We.toLowerCase().replace(/character-/i,"Entity-").replace(/entity-/i,"Entity-")))]}return{frameNumber:Ne,sceneNumber:De.sceneNumber||1,sceneTitle:De.sceneTitle||"",prompt:_e,videoPrompt:(Pe==null?void 0:Pe.videoPrompt)||De.videoPrompt||"",shotType:De.shotType||De.ShotType||(Pe==null?void 0:Pe.shotType)||"WS",characters:ye,duration:De.duration||3,isCollapsed:!0}}),pe={id:"",type:q.PROMPT_SEQUENCE_EDITOR,position:{x:0,y:0},title:"",value:"",width:0,height:0},me=Wa(pe),ke=JSON.parse(me),Re=JSON.stringify({...ke,instruction:"",sourcePrompts:ce,modifiedPrompts:[],checkedSourceFrameNumbers:[],selectedFrameNumber:null,styleOverride:ae.visualStyle||ae.styleOverride||"",usedCharacters:ae.usedCharacters||[],sceneContexts:ae.sceneContexts||{},leftPaneRatio:.5}),Me=K.onAddNode(q.PROMPT_SEQUENCE_EDITOR,xe);ie.handleValueChange(Me,Re),E(B("toast.pastedFromClipboard"));return}let ne=null;if(ae.type==="character-card"?ne=[ae]:Array.isArray(ae)&&((R=ae[0])!=null&&R.imageSources||((J=ae[0])==null?void 0:J.type)==="character-card")&&(ne=ae),ne){const X=ne[0].nodeTitle||ne[0].title||(Array.isArray(ae)?"Character Cards":"Character Card"),ue=K.onAddNode(q.CHARACTER_CARD,xe,X);if(ne.forEach((Q,ce)=>{if(Q.imageSources){Object.entries(Q.imageSources).forEach(([ke,Re])=>{const Me=Ut[ke];Me!==void 0&&typeof Re=="string"&&Re.startsWith("data:")&&l(ue,ce*10+Me,Re)});const pe=Q.selectedRatio||"1:1",me=Q.imageSources[pe];me&&typeof me=="string"&&me.startsWith("data:")&&l(ue,ce*10,me)}}),ie.handleValueChange(ue,JSON.stringify(ne)),t){const Q=ne.length*mu+gu;t(ce=>ce.map(pe=>pe.id===ue?{...pe,width:Q}:pe))}return}}catch{const ae=le.pointerPosition||{x:0,y:0},xe=K.onAddNode(q.TEXT_INPUT,ae);ie.handleValueChange(xe,ee),E(B("toast.pastedFromClipboard"));return}}}}catch(H){try{const U=await navigator.clipboard.readText();if(U){const ee=le.pointerPosition||{x:0,y:0},ae=K.onAddNode(q.TEXT_INPUT,ee);ie.handleValueChange(ae,U),E(B("toast.pastedFromClipboard"))}}catch{console.warn("Paste failed or permission denied",H)}}},[E,B,l,t]),z=y.useCallback(($,Y)=>{const oe=w.catalogItems.find(ie=>ie.id===$);if(!oe||!oe.nodes)return;const le=Y||N.pointerPosition||{x:0,y:0},K={type:"prompModifierGroup",name:oe.name,nodes:oe.nodes,connections:oe.connections||[],fullSizeImages:oe.fullSizeImages};f.pasteGroup(K,le)},[w.catalogItems,N.pointerPosition,f]),L=y.useCallback(($,Y,oe)=>{const{position:le,connectingInfo:K}=Y,{scale:ie,translate:Z}=N.viewTransform,se={x:(le.x-Z.x)/ie,y:(le.y-Z.y)/ie},de=f.onAddNode($,se,void 0,{alignToInput:!0});e.find(R=>R.id===de);let re;K.fromType==="image"?($===q.IMAGE_EDITOR&&(re="image"),$===q.IMAGE_ANALYZER&&(re="image"),$===q.VIDEO_EDITOR&&(re="image")):K.fromType==="text"?($===q.IMAGE_INPUT&&(re="text"),$===q.IMAGE_EDITOR&&(re="text"),$===q.GEMINI_CHAT&&(re=void 0),$===q.PROMPT_PROCESSOR&&(re=void 0),$===q.PROMPT_ANALYZER&&(re=void 0),$===q.IMAGE_SEQUENCE_GENERATOR&&(re="prompt_input"),$===q.PROMPT_SEQUENCE_EDITOR&&(re="prompts_sequence"),$===q.NOTE&&(re="prompt_data")):K.fromType==="character_data"?$===q.IMAGE_SEQUENCE_GENERATOR&&(re="character_data"):K.fromType==="video"?$===q.VIDEO_EDITOR&&(re="video"):K.fromType==="audio"&&$===q.VIDEO_EDITOR&&(re="audio"),($===q.DATA_READER||$===q.REROUTE_DOT)&&(re=void 0),$===q.REROUTE_DOT&&h.handleValueChange(de,JSON.stringify({type:K.fromType,direction:"LR"})),v.addConnection({fromNodeId:K.fromNodeId,fromHandleId:K.fromHandleId,toNodeId:de,toHandleId:re}),oe()},[f,v,e]),W=y.useCallback($=>{const Y=e.find(oe=>oe.id===$);if(Y)try{const oe=JSON.parse(Y.value||"{}");if(oe.src){const le=document.createElement("a");le.href=oe.src;let K=oe.name||"media_file";K.includes(".")||(oe.type==="video"?K+=".mp4":K+=".mp3"),le.download=K,document.body.appendChild(le),le.click(),document.body.removeChild(le),E(B("toast.downloadStarted"),"success")}}catch{I("Failed to save media.")}},[e,E,B,I]),D=y.useCallback(($,Y)=>{const oe=e.find(se=>se.id===$),le=oe?{x:oe.position.x+oe.width+50,y:oe.position.y}:{x:0,y:0},K=f.onAddNode(q.CHARACTER_CARD,le,Y.name),ie=Y._fullResImage||Y.image,Z=[{id:`char-card-${Date.now()}`,name:Y.name||"New Entity",index:Y.index||"Entity-1",image:ie,thumbnails:{"1:1":ie,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:Y.prompt||"",fullDescription:Y.fullDescription||"",isOutput:!0,isActive:!0}];ie&&ie.startsWith("data:")&&(l(K,0,ie),l(K,1,ie)),h.handleValueChange(K,JSON.stringify(Z)),E(B("toast.pastedFromClipboard"),"success")},[e,f,l,E,B,h]),T=y.useCallback(($,Y)=>{const oe=e.find(ie=>ie.id===Y),le=oe?{x:oe.position.x+oe.width+50,y:oe.position.y}:{x:0,y:0},K=f.onAddNode(q.IMAGE_INPUT,le);l(K,0,$),Ot($,256,256).then(ie=>{h.handleValueChange(K,JSON.stringify({image:ie,prompt:""}))}),E(B("toast.pastedFromClipboard"),"success")},[e,f,l,E,B,h]),F=y.useCallback(($,Y)=>{const oe={x:Y.position.x+Y.width+400,y:Y.position.y},le=f.onAddNode(q.CHARACTER_CARD,oe,$.name||B("node.title.character_card")),K=($.index||$.alias||"Entity-1").replace(/^Character-/,"Entity-"),ie={};if($.imageBase64&&!$.imageBase64.startsWith("data:")){const se=`data:image/png;base64,${$.imageBase64}`;ie["1:1"]=se,l&&l(le,0,se)}else $.imageBase64&&$.imageBase64.startsWith("data:")&&(ie["1:1"]=$.imageBase64,l&&l(le,0,$.imageBase64));const Z=[{type:"character-card",id:`char-card-${Date.now()}`,name:$.name||"New Entity",index:K,imageSources:ie,selectedRatio:"1:1",prompt:$.prompt||"",fullDescription:$.fullDescription||"",additionalPrompt:$.additionalPrompt,isOutput:!0,isActive:!0,isPromptCollapsed:!0}];h.handleValueChange(le,JSON.stringify(Z)),h.handleRenameNode&&$.name&&h.handleRenameNode(le,$.name),E(B("toast.characterDetached")||"Character detached","success")},[f,h,l,E,B]),te=y.useCallback(($,Y)=>{const oe=e.find(le=>le.id===$);if(!(!oe||oe.type!==q.CHARACTER_CARD))try{let le=JSON.parse(oe.value||"[]");if(Array.isArray(le)||(le=[le]),Y===void 0){const K=le.map((Z,se)=>{const de={...Z.thumbnails||Z.imageSources||{}};Object.entries(Ut).forEach(([R,J])=>{const H=c($,se*10+J);H&&(de[R]=H)});const re=c($,se*10)||Z.image;return{id:Z.id||`char-${Date.now()}-${se}`,type:"character-card",name:Z.name,index:Z.index,image:re,imageSources:de,prompt:Z.prompt,fullDescription:Z.fullDescription,selectedRatio:Z.selectedRatio,additionalPrompt:Z.additionalPrompt,isActive:Z.isActive}}),ie=oe.title||"Character Collection";k.createItem(Jn.ITEM,ie,JSON.stringify(K)),E(B("toast.characterSavedCatalog")+" (All)","success")}else{const K=le[Y];if(!K)return;const ie={...K.thumbnails};Object.entries(Ut).forEach(([de,re])=>{const R=c($,Y*10+re);R&&(ie[de]=R)});const Z=c($,Y*10)||K.image,se={type:"character-card",name:K.name,index:K.index,image:Z,imageSources:ie,prompt:K.prompt,fullDescription:K.fullDescription,selectedRatio:K.selectedRatio,additionalPrompt:K.additionalPrompt};k.createItem(Jn.ITEM,K.name||"New Character",JSON.stringify(se)),E(B("toast.characterSavedCatalog"),"success")}}catch(le){console.error("Failed to save character to catalog",le),E("Failed to save to catalog","error")}},[e,k,c,E,B]);return{handleDownloadImage:G,handleDuplicateNode:V,handleDuplicateNodeWithContent:j,copyNodeValue:P,pasteNodeValue:S,pasteImageToNode:A,handlePaste:O,handleAddGroupFromCatalog:z,handleAddNodeAndConnect:L,onSaveMediaToDisk:W,handleDetachCharacterFromGenerator:F,handleDetachAndPasteConcept:D,onDetachImageToNode:T,onSaveCharacterToCatalog:te}},uy="settings_googleClientId",KE=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],JE="https://www.googleapis.com/auth/drive.file",a0="Prompt Modifier Data";let Ys,Tu=!1,Au=!1;const YE=async e=>e?new Promise(t=>{const o=()=>{typeof gapi<"u"?gapi.load("client",async()=>{await gapi.client.init({clientId:e,discoveryDocs:KE}),Tu=!0,a()}):setTimeout(o,100)},r=()=>{typeof google<"u"&&google.accounts?(Ys=google.accounts.oauth2.initTokenClient({client_id:e,scope:JE,callback:""}),Au=!0,a()):setTimeout(r,100)},a=()=>{Tu&&Au&&t(!0)};o(),r()}):!1,py=async()=>{if(!Ys)throw new Error("Google Drive API not initialized. Please check Client ID.");return new Promise((e,t)=>{Ys.callback=o=>{o.error?t(o):e(o)},Ys.requestAccessToken({prompt:"consent"})})},Ya=async()=>{if(!Tu||!Au)throw new Error("API not initialized");gapi.client.getToken()===null&&await py()},ia=async()=>{await Ya();try{const t=(await gapi.client.drive.files.list({q:`mimeType='application/vnd.google-apps.folder' and name='${a0}' and trashed=false`,fields:"files(id, name)",spaces:"drive"})).result.files;return t&&t.length>0?t[0].id:(await gapi.client.drive.files.create({resource:{name:a0,mimeType:"application/vnd.google-apps.folder"},fields:"id"})).result.id}catch(e){throw console.error("Error getting/creating folder",e),e}},dd=async e=>{await Ya();try{return(await gapi.client.drive.files.list({q:`'${e}' in parents and trashed=false`,fields:"files(id, name, modifiedTime, appProperties)",spaces:"drive",pageSize:1e3})).result.files||[]}catch(t){throw console.error("Error listing files",t),t}},i0=async(e,t)=>{await Ya();try{return(await gapi.client.drive.files.list({q:`'${t}' in parents and name contains '${e}' and trashed=false`,fields:"files(id, name, modifiedTime)",spaces:"drive"})).result.files||[]}catch(o){throw console.error("Error searching files",o),o}},XE=async e=>{await Ya();try{return(await gapi.client.drive.files.get({fileId:e,alt:"media"})).result}catch(t){throw console.error(`Error reading file ${e}`,t),t}},s0=async(e,t,o,r)=>{await Ya();const a=o||await ia();return new Promise((i,s)=>{const l={name:e,mimeType:"application/json"};r||(l.parents=[a]);const c="-------314159265358979323846",d=`\r
--`+c+`\r
`,u=`\r
--`+c+"--",p=d+`Content-Type: application/json\r
\r
`+JSON.stringify(l)+d+`Content-Type: application/json\r
\r
`+t+u;gapi.client.request({path:r?`/upload/drive/v3/files/${r}`:"/upload/drive/v3/files",method:r?"PATCH":"POST",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/related; boundary="'+c+'"'},body:p}).execute(w=>{w&&w.error?s(w.error):i(w)})})},ws=async e=>{await Ya();try{await gapi.client.drive.files.delete({fileId:e})}catch(t){throw console.error(`Error deleting file ${e}`,t),t}},ZE=()=>localStorage.getItem(uy)||"",QE=e=>localStorage.setItem(uy,e),eP=({addToast:e,getCurrentCanvasState:t,tabs:o,activeTabId:r,language:a,isSnapToGrid:i,lineStyle:s,catalogItems:l,libraryItems:c,characterCatalog:d,scriptCatalog:u,sequenceCatalog:p,t:m})=>{const[w,k]=y.useState(ZE()),[b,x]=y.useState(!1),[f,h]=y.useState(!1),[v,N]=y.useState(!1);y.useEffect(()=>{w&&YE(w).then(()=>{x(!0)})},[w]);const _=P=>{QE(P),k(P)},E=y.useCallback(async()=>{if(!b){e(m("error.googleDriveInit"),"error");return}try{await py(),e("Successfully signed in to Google!","success")}catch(P){console.error("Sign in failed",P),e("Failed to sign in to Google Drive","error")}},[b,e,m]),I=y.useCallback(async()=>{if(!b){e(m("error.googleDriveInit"),"error");return}h(!0);try{const P=t(),S=o.map(W=>W.id===r?{...W,state:P}:W),A={type:"prompt-modifier-project",appName:"Prompt_modifier",version:1,timestamp:new Date().toISOString(),tabs:S,activeTabId:r,settings:{language:a,isSnapToGrid:i,lineStyle:s},catalogs:{groups:l,library:c,characters:d.items,scripts:u.items,sequences:p.items}},O=JSON.stringify(A,null,2),L=`Prompt_Modifier_Project_${new Date().toISOString().replace(/:/g,"-").replace("T","_").split(".")[0]}.json`;await s0(L,O),e(m("toast.driveSaved"),"success")}catch(P){console.error("Drive Save Error:",P),e(m("toast.driveSaveFailed"),"error")}finally{h(!1)}},[b,t,o,r,a,i,s,l,c,d,u,p,m,e]),B=y.useCallback(async()=>{if(!b){e(m("error.googleDriveInit"),"error");return}N(!0);try{const P=await ia(),A=(await dd(P)).filter(z=>z.name.startsWith("Catalog_"));let O=0;for(const z of A){const L=await XE(z.id),W=L.catalogContext;W&&(W==="characters"?(d.importItemsData(L,z.id),O++):W==="scripts"?(u.importItemsData(L,z.id),O++):W==="sequences"&&(p.importItemsData(L,z.id),O++))}O>0?e(`Synced ${O} catalog items from Drive`,"success"):e("No new catalog items found on Drive","info")}catch(P){console.error("Sync Error:",P),e("Failed to sync with Google Drive","error")}finally{N(!1)}},[b,d,u,p,e,m]),M=y.useCallback(async()=>{if(b){N(!0);try{const P=await ia(),A=(await dd(P)).filter(L=>L.name.startsWith("Catalog_")),O={};A.forEach(L=>{const W=L.name.lastIndexOf("_");if(W>-1){const D=L.name.substring(0,W);O[D]||(O[D]=[]),O[D].push(L)}});let z=0;for(const L in O){const W=O[L];if(W.length>1){W.sort((D,T)=>new Date(T.modifiedTime).getTime()-new Date(D.modifiedTime).getTime());for(let D=1;D<W.length;D++)await ws(W[D].id),z++}}z>0?e(`Cleanup complete. Removed ${z} duplicate files.`,"success"):e("Cleanup complete. No duplicates found.","info")}catch(P){console.error("Cleanup Error:",P),e("Failed to cleanup duplicates","error")}finally{N(!1)}}},[b,e]),G=y.useCallback(async(P,S)=>{if(b){N(!0);try{let A=P.driveFileId,O=0;if(A)await ws(A),O=1;else{const z=await ia(),L=(P.name||"Untitled").replace(/[^a-zA-Z0-9-- -]/g,"_"),W=`Catalog_${S}_${L}`,D=await i0(W,z);if(D.length>0)for(const T of D)await ws(T.id),O++}O>0?(e(`Deleted "${P.name}" from Drive.`,"success"),S==="characters"?d.setItemDriveId(P.id,void 0):S==="scripts"?u.setItemDriveId(P.id,void 0):S==="sequences"&&p.setItemDriveId(P.id,void 0)):e(`File for "${P.name}" not found in Drive.`,"info")}catch(A){console.error("Delete Error:",A),e("Failed to delete from Drive","error")}finally{N(!1)}}},[b,e,d,u,p]),V=y.useCallback(async P=>{if(!b){e(m("error.googleDriveInit"),"error");return}N(!0);try{const S=await ia(),A=await dd(S),O=`Catalog_${P}_`,z=A.filter(W=>W.name.startsWith(O));if(z.length===0){e("Cloud folder is already empty.","info");return}let L=0;for(const W of z)await ws(W.id),L++;P==="characters"?d.items.forEach(W=>{W.driveFileId&&d.setItemDriveId(W.id,void 0)}):P==="scripts"?u.items.forEach(W=>{W.driveFileId&&u.setItemDriveId(W.id,void 0)}):P==="sequences"&&p.items.forEach(W=>{W.driveFileId&&p.setItemDriveId(W.id,void 0)}),e(`Cleared ${L} files from Cloud (${P}).`,"success")}catch(S){console.error("Clear Folder Error:",S),e("Failed to clear cloud folder.","error")}finally{N(!1)}},[b,e,d,u,p,m]),j=y.useCallback(async(P,S)=>{if(!b){e(m("error.googleDriveInit"),"error");return}try{let A=[];if(S==="characters"?A=d.items||[]:S==="scripts"?A=u.items||[]:S==="sequences"?A=p.items||[]:S==="groups"?A=l||[]:S==="library"&&(A=c||[]),!A)throw new Error("Source catalog items not found for context: "+S);let O=null;if(P.type===Jn.FOLDER||P.type===Oa.FOLDER||P.type===$t.FOLDER){const Y=oe=>{const le=A.find(ie=>ie.id===oe);if(!le)return null;const K=A.filter(ie=>ie.parentId===oe);return{name:le.name,type:"folder",children:K.map(ie=>{if(ie.type===Jn.FOLDER||ie.type===Oa.FOLDER||ie.type===$t.FOLDER)return Y(ie.id);{if(S==="groups")return{type:"prompModifierGroup",name:ie.name,nodes:ie.nodes,connections:ie.connections,fullSizeImages:ie.fullSizeImages};if(S==="library")return{name:ie.name,type:"prompt",content:ie.content||""};let se=ie.content;try{typeof se=="string"&&(se=JSON.parse(se))}catch{}return{name:ie.name,type:"item",content:se}}}).filter(Boolean)}};O=Y(P.id)}else if(S==="groups")O={type:"prompModifierGroup",name:P.name,nodes:P.nodes,connections:P.connections,fullSizeImages:P.fullSizeImages};else if(S==="library")O={type:"prompt",name:P.name,content:P.content};else{let Y=P.content;try{typeof P.content=="string"&&(Y=JSON.parse(P.content))}catch{Y=P.content||{}}O={type:"item",name:P.name,content:Y}}if(!O)throw new Error("Could not prepare data for upload.");const L={appName:"Prompt_modifier",catalogContext:S,root:O},W=(P.name||"Untitled").replace(/[^a-zA-Z0-9-- -]/g,"_"),D=await ia();let T=P.driveFileId;if(!T){const Y=`Catalog_${S}_${W}`,oe=await i0(Y,D);oe.length>0&&(oe.sort((le,K)=>new Date(K.modifiedTime).getTime()-new Date(le.modifiedTime).getTime()),T=oe[0].id)}let F=`Catalog_${S}_${W}_${Date.now()}.json`;e(T?"Updating existing file on Drive...":"Creating new file on Drive...","info");const $=(await s0(F,JSON.stringify(L,null,2),D,T)).id;$&&(S==="characters"?d.setItemDriveId(P.id,$):S==="scripts"?u.setItemDriveId(P.id,$):S==="sequences"&&p.setItemDriveId(P.id,$)),e(`Saved "${P.name}" to Drive`,"success")}catch(A){console.error("Upload Error:",A),e(`Failed to upload: ${A.message||A}`,"error")}},[b,e,d,u,p,l,c,m]);return{googleClientId:w,setGoogleClientId:_,handleSaveToDrive:I,handleGoogleSignIn:E,handleSyncCatalogs:B,uploadCatalogItem:j,handleCleanupDuplicates:M,handleDeleteFromDrive:G,handleClearCloudFolder:V,isGoogleDriveReady:b,isGoogleDriveSaving:f||v}},tP=e=>{const[t,o]=y.useState([]),r=y.useRef(0),a=y.useCallback((Pe,ye="info")=>{const _e=r.current++;o(Fe=>[...Fe,{id:_e,message:Pe,type:ye}]),setTimeout(()=>{o(Fe=>Fe.filter(We=>We.id!==_e))},3e3)},[]),[i,s]=y.useState({}),l=y.useCallback((Pe,ye,_e)=>{s(Fe=>({...Fe,[Pe]:{...Fe[Pe]||{},[ye]:_e}}))},[]),c=y.useCallback((Pe,ye)=>{var _e;return(_e=i[Pe])==null?void 0:_e[ye]},[i]),d=y.useCallback(Pe=>{s(ye=>{const _e={...ye};return delete _e[Pe],_e})},[]),u=y.useCallback(()=>{s(Pe=>{const ye={};e.forEach(Fe=>{Pe[Fe.id]&&(ye[Fe.id]=Pe[Fe.id])});const _e=Object.keys(Pe).length-Object.keys(ye).length;return _e>0?a(`Cleared ${_e} unused items from cache`,"info"):a("Cache is already optimized","info"),ye})},[e,a]),[p,m]=y.useState(new Map),w=y.useCallback(Pe=>{m(ye=>new Map(ye).set(Pe.id,Pe))},[]),k=y.useCallback(Pe=>{m(ye=>{const _e=new Map(ye);return _e.delete(Pe),_e})},[]),[b,x]=y.useState([]),[f,h]=y.useState(null),[v,N]=y.useState(0),_=y.useCallback(Pe=>{x(ye=>{const _e=typeof Pe=="function"?Pe(ye):Pe;return _e.length===0&&ye.length>0&&N(Fe=>Fe+1),_e})},[]),[E,I]=y.useState(null),B=y.useCallback(Pe=>I({src:Pe}),[]),M=y.useCallback(()=>I(null),[]),[G,V]=y.useState(!1),[j,P]=y.useState(null),[S,A]=y.useState(null),[O,z]=y.useState([]),[L,W]=y.useState(!1),D=y.useCallback((Pe,ye,_e)=>{z(Fe=>[...Fe,{id:`log-${Date.now()}-${Math.random()}`,timestamp:Date.now(),level:Pe,message:ye,details:_e}].slice(-100))},[]),T=y.useCallback(()=>z([]),[]),[F,te]=y.useState(!1),[$,Y]=y.useState("orthogonal"),[oe,le]=y.useState(!1),[K,ie]=y.useState([]),[Z,se]=y.useState("edit"),[de,re]=y.useState(null),[R,J]=y.useState(null),[H,U]=y.useState(!1),[ee,ae]=y.useState(null),xe=y.useCallback(Pe=>{ae(Pe)},[]),[ne,X]=y.useState(()=>localStorage.getItem("settings_instantNodeClose")==="true"),[ue,Q]=y.useState(()=>{const Pe=localStorage.getItem("settings_hoverHighlight");return Pe===null?!0:Pe==="true"}),[ce,pe]=y.useState(()=>localStorage.getItem("settings_nodeAnimationMode")||"pulse"),[me,ke]=y.useState(!0),[Re,Me]=y.useState(.4),[De,Ie]=y.useState(()=>localStorage.getItem("settings_theme")||"cyan"),Ne=y.useCallback(Pe=>{Ie(Pe),localStorage.setItem("settings_theme",Pe),document.documentElement.setAttribute("data-theme",Pe)},[]);return y.useEffect(()=>{document.documentElement.setAttribute("data-theme",De)},[De]),y.useEffect(()=>{const Pe={log:console.log,info:console.info,warn:console.warn,error:console.error};console.log=(...Fe)=>{Pe.log(...Fe)},console.warn=(...Fe)=>{Pe.warn(...Fe),D("warning",Fe.map(String).join(" "))},console.error=(...Fe)=>{Pe.error(...Fe),D("error",Fe.map(String).join(" "))};const ye=Fe=>{D("error",Fe.message,{filename:Fe.filename,lineno:Fe.lineno,colno:Fe.colno,error:Fe.error})};window.addEventListener("error",ye);const _e=Fe=>{D("error",`Unhandled Promise Rejection: ${Fe.reason}`,{reason:Fe.reason})};return window.addEventListener("unhandledrejection",_e),()=>{console.log=Pe.log,console.info=Pe.info,console.warn=Pe.warn,console.error=Pe.error,window.removeEventListener("error",ye),window.removeEventListener("unhandledrejection",_e)}},[D]),{toasts:t,addToast:a,fullSizeImageCache:i,setFullSizeImageCache:s,setFullSizeImage:l,getFullSizeImage:c,clearImagesForNodeFromCache:d,clearUnusedFullSizeImages:u,activeOperations:p,registerOperation:w,unregisterOperation:k,selectedNodeIds:b,setSelectedNodeIds:_,draggingInfo:f,setDraggingInfo:h,showWelcome:G,setShowWelcome:V,error:j,setError:P,globalMedia:S,setGlobalMedia:A,logs:O,addLog:D,clearLogs:T,isDebugConsoleOpen:L,setIsDebugConsoleOpen:W,isSnapToGrid:F,setIsSnapToGrid:te,lineStyle:$,setLineStyle:Y,isSmartGuidesEnabled:oe,setIsSmartGuidesEnabled:le,smartGuides:K,setSmartGuides:ie,activeTool:Z,setActiveTool:se,spawnLine:de,setSpawnLine:re,dockHoverMode:R,setDockHoverMode:J,isDockingMenuVisible:H,setIsDockingMenuVisible:U,focusedNodeId:ee,toggleNodeFullScreen:xe,isInstantCloseEnabled:ne,setIsInstantCloseEnabled:X,isHoverHighlightEnabled:ue,setIsHoverHighlightEnabled:Q,nodeAnimationMode:ce,setNodeAnimationMode:pe,isConnectionAnimationEnabled:me,setIsConnectionAnimationEnabled:ke,connectionOpacity:Re,setConnectionOpacity:Me,currentTheme:De,setTheme:Ne,clearSelectionsSignal:v,globalImageEditor:E,openGlobalImageEditor:B,closeGlobalImageEditor:M}},hy=y.createContext(null),nP=({children:e})=>{const{t,language:o,setLanguage:r}=Pt(),a=$C("clipboard-read"),i=BC(),{tabs:s,setTabs:l,activeTabId:c,setActiveTabId:d,handleAddTab:u,handleSwitchTab:p,handleRenameTab:m,handleCloseTab:w,resetTabs:k,resetCurrentTab:b,getLocalizedCanvasState:x}=i,f=y.useMemo(()=>{const he=s.find(ge=>ge.id===c);return he||(s.length>0?s[0]:{id:"fallback",name:"Loading...",state:{nodes:[],connections:[],groups:[],viewTransform:{scale:1,translate:{x:0,y:0}},nodeIdCounter:0,fullSizeImageCache:{}}})},[s,c]),h=tP(f.state.nodes),{toasts:v,addToast:N,fullSizeImageCache:_,setFullSizeImageCache:E,setFullSizeImage:I,getFullSizeImage:B,clearImagesForNodeFromCache:M,clearUnusedFullSizeImages:G,registerOperation:V,unregisterOperation:j,activeOperations:P,selectedNodeIds:S,setSelectedNodeIds:A,draggingInfo:O,setDraggingInfo:z,showWelcome:L,setShowWelcome:W}=h,D=EC(f.state.nodes,f.state.nodeIdCounter,N,t,I,B),T=PC(f.state.connections,N,t),F=jC(f.state.viewTransform),te=GC(f.state.groups),$=UE(D.setNodes),Y=VE({nodes:D.nodes}),oe=ZC({connections:T.connections,nodes:D.nodes,getFullSizeImage:B}),{getUpstreamNodeValues:le}=oe,K=y.useCallback(()=>({nodes:D.nodes,connections:T.connections,groups:te.groups,viewTransform:F.viewTransform,nodeIdCounter:D.nodeIdCounter.current,fullSizeImageCache:_}),[D.nodes,T.connections,te.groups,F.viewTransform,D.nodeIdCounter,_]),ie=y.useCallback(he=>{D.setNodes(he.nodes),T.setConnections(he.connections),te.setGroups(he.groups||[]),F.setViewTransform(he.viewTransform),D.nodeIdCounter.current=he.nodeIdCounter,E(he.fullSizeImageCache||{})},[D,T,te,F,E]);y.useEffect(()=>{const he=s.find(ge=>ge.id===c);he&&ie(he.state)},[c]),y.useEffect(()=>{const he=K(),ge=s.find(ve=>ve.id===c);if(ge){const ve=ge.state;if(ve.nodes===he.nodes&&ve.connections===he.connections&&ve.groups===he.groups&&ve.viewTransform===he.viewTransform&&ve.fullSizeImageCache===he.fullSizeImageCache&&ve.nodeIdCounter===he.nodeIdCounter)return}l(ve=>ve.map(Ge=>Ge.id===c?{...Ge,state:he}:Ge))},[K,c,l,s]);const Z=y.useCallback(he=>{k(he)},[k]),se=y.useRef(c);y.useEffect(()=>{se.current=c},[c]);const de=YC({nodes:D.nodes,setNodes:D.setNodes,connections:T.connections,setConnections:T.setConnections,nodeIdCounter:D.nodeIdCounter,groups:te.groups,setGroups:te.setGroups,t,clearImagesForNodeFromCache:M,tabId:c,addToast:N,getFullSizeImage:B,setFullSizeImage:I,takeSnapshot:$.takeSnapshot}),re=y.useRef(null),R=he=>{re.current&&re.current.onRedirectImport&&re.current.onRedirectImport(he)},J=WC(t,R),H=JC(t,R),U=id("character-catalog",t("catalog.tabs.characters"),t,"characters",R),ee=id("script-catalog",t("catalog.tabs.scripts"),t,"scripts",R),ae=id("sequence-catalog",t("catalog.tabs.sequences"),t,"sequences",R),xe=eP({addToast:N,getCurrentCanvasState:K,tabs:s,activeTabId:c,language:o,isSnapToGrid:h.isSnapToGrid,lineStyle:h.lineStyle,catalogItems:J.catalogItems,libraryItems:H.libraryItems,characterCatalog:U,scriptCatalog:ee,sequenceCatalog:ae,t}),ne=yE({nodes:D.nodes,setNodes:D.setNodes,getUpstreamNodeValues:le,setError:h.setError,t,setFullSizeImage:I,getFullSizeImage:B,activeTabId:c,setTabs:l,activeTabName:f.name,registerOperation:V,unregisterOperation:j,addToast:N}),X=GE({nodes:D.nodes,setNodes:D.setNodes,getUpstreamNodeValues:le,setError:h.setError,t,activeTabId:c,setTabs:l,activeTabName:f.name,registerOperation:V,unregisterOperation:j,addToast:N}),ue=vE({nodes:D.nodes,setNodes:D.setNodes,setError:h.setError,t,getUpstreamNodeValues:le,activeTabId:c,setTabs:l}),Q=HE({nodes:D.nodes,connections:T.connections,setNodes:D.setNodes,getUpstreamNodeValues:le,setError:h.setError,showApiKeyDialog:he=>me.showApiKeyDialog(he),t,setFullSizeImage:I,getFullSizeImage:B,connectedCharacterData:oe.connectedCharacterData,activeTabId:c,setTabs:l,activeTabName:f.name,registerOperation:V,unregisterOperation:j,isGlobalProcessing:P.size>0,addToast:N}),ce=LE({nodes:D.nodes,setNodes:D.setNodes,connections:T.connections,setError:h.setError,getUpstreamNodeValues:le,t,setFullSizeImage:I,getFullSizeImage:B,activeTabId:c,activeTabName:f.name,registerOperation:V,unregisterOperation:j,isGlobalProcessing:P.size>0,setTabs:l}),pe=LC({getCurrentCanvasState:K,loadCanvasState:ie,setError:h.setError,nodes:D.nodes,getPromptForNode:de.getPromptForNode,handleValueChange:D.handleValueChange,addToast:N,t,activeTabName:f.name,getFullSizeImage:B,handleRenameTab:m,activeTabId:c,setFullSizeImage:I,tabs:i.tabs,setTabs:i.setTabs,setActiveTabId:i.setActiveTabId,catalogItems:J.catalogItems,setCatalogItems:J.replaceAllItems,libraryItems:H.libraryItems,setLibraryItems:H.replaceAllItems,characterCatalog:U,scriptCatalog:ee,sequenceCatalog:ae,language:o,setLanguage:r,isSnapToGrid:h.isSnapToGrid,setIsSnapToGrid:h.setIsSnapToGrid,lineStyle:h.lineStyle,setLineStyle:h.setLineStyle,setConfirmInfo:he=>me.setConfirmInfo(he),handleRenameNode:D.handleRenameNode,onAddNode:de.onAddNode,pasteGroup:de.pasteGroup,viewTransform:F.viewTransform}),me=HC({setGroups:te.setGroups,renameCatalogItem:J.renameCatalogItem,updateLibraryItem:H.updateLibraryItem,handleRenameTab:m,handleCloseTab:w,handleRenameNode:D.handleRenameNode,getCurrentCanvasState:K,loadCanvasState:ie,tabs:s,activeTabId:c,t,characterCatalog:U,scriptCatalog:ee,sequenceCatalog:ae}),ke=$E(D.nodes,D.setNodes,T.connections,T.setConnections,te.groups,te.setGroups,_,I,B,le,se,A,H,J,U,ee,ae,de,D,T,F,Q,N,h.setError,t);y.useEffect(()=>{re.current=ke},[ke]);const Re=y.useCallback(he=>{me.connectionQuickAddInfo&&ke.handleAddNodeAndConnect(he,me.connectionQuickAddInfo,me.handleCloseConnectionQuickAdd)},[me.connectionQuickAddInfo,me.handleCloseConnectionQuickAdd,ke]),Me=y.useCallback(he=>{const ge=D.nodes;te.setGroups(ve=>{const Ge=ve.find(ot=>ot.nodeIds.includes(he));if(!Ge)return ve;const Ve=Ge.nodeIds.filter(ot=>ot!==he);if(Ve.length>0){const ot=ge.filter(pt=>Ve.includes(pt.id)),Xe=qr(ot);return Xe?ve.map(pt=>pt.id===Ge.id?{...pt,nodeIds:Ve,...Xe}:pt):ve.map(pt=>pt.id===Ge.id?{...pt,nodeIds:Ve}:pt)}else return ve.filter(ot=>ot.id!==Ge.id)})},[te.setGroups,D.nodes]),De=y.useCallback((he,ge)=>{if(ge.stopPropagation(),ge.shiftKey){const ve=te.groups.find(Ge=>Ge.id===he);ve&&ve.nodeIds.forEach(Ge=>de.deleteNodeAndConnections(Ge)),te.removeGroup(he),N(t("toast.groupDeleted"),"info")}else te.removeGroup(he)},[te,de,N,t]),Ie=y.useCallback(he=>{const ge=te.groups.find(ve=>ve.id===he);ge&&(J.saveGroupToCatalog(ge,D.nodes,T.connections,h.fullSizeImageCache),N(t("alert.groupSaved",{groupTitle:ge.title}),"success"))},[te,D,T,h.fullSizeImageCache,J,N,t]),Ne=y.useCallback(he=>{const ge=te.groups.find(it=>it.id===he);if(!ge)return;const ve=D.nodes.filter(it=>ge.nodeIds.includes(it.id)),Ge=new Set(ve.map(it=>it.id)),Ve=T.connections.filter(it=>Ge.has(it.fromNodeId)&&Ge.has(it.toNodeId)),ot={};ve.forEach(it=>{h.fullSizeImageCache[it.id]&&(ot[it.id]=h.fullSizeImageCache[it.id])});const Xe={type:"prompModifierGroup",name:ge.title,nodes:ve,connections:Ve,fullSizeImages:ot},pt=new Blob([JSON.stringify(Xe,null,2)],{type:"application/json"}),st=URL.createObjectURL(pt),ft=document.createElement("a");ft.href=st,ft.download=`${ge.title.replace(/\s+/g,"_")}_Group.json`,ft.click(),URL.revokeObjectURL(st),N(t("toast.groupSavedToDisk",{groupTitle:ge.title}),"success")},[te,D,T,h.fullSizeImageCache,N,t]),Pe=y.useCallback((he,ge)=>{const ve=D.nodes.find(Xe=>Xe.id===he),Ge=ve?{x:ve.position.x+ve.width+50,y:ve.position.y}:{x:0,y:0},Ve=de.onAddNode(q.CHARACTER_CARD,Ge,ge.name),ot=[{id:`char-card-${Date.now()}`,name:ge.name||"New Entity",index:ge.index||"Entity-1",image:ge.image,thumbnails:{"1:1":ge.image,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:ge.prompt||"",fullDescription:ge.fullDescription||"",isOutput:!0,isActive:!0}];ge._fullResImage?(I(Ve,0,ge._fullResImage),I(Ve,1,ge._fullResImage)):ge.image&&ge.image.startsWith("data:")&&(I(Ve,0,ge.image),I(Ve,1,ge.image)),D.handleValueChange(Ve,JSON.stringify(ot)),N(t("toast.pastedFromClipboard"),"success")},[D,de,I,N,t,D]),ye=y.useCallback((he,ge)=>{const ve=D.nodes.find(ot=>ot.id===ge),Ge=ve?{x:ve.position.x+ve.width+50,y:ve.position.y}:{x:0,y:0},Ve=de.onAddNode(q.IMAGE_INPUT,Ge);I(Ve,0,he),Ot(he,256,256).then(ot=>{D.handleValueChange(Ve,JSON.stringify({image:ot,prompt:""}))}),N(t("toast.pastedFromClipboard"),"success")},[D,de,I,N,t,D]),_e=y.useCallback((he,ge)=>{const ve=D.nodes.find(Ge=>Ge.id===he);if(!(!ve||ve.type!==q.CHARACTER_CARD))try{let Ge=JSON.parse(ve.value||"[]");if(Array.isArray(Ge)||(Ge=[Ge]),ge!==void 0){const Ve=Ge[ge];if(!Ve)return;const ot={...Ve.thumbnails};Object.entries(Ut).forEach(([st,ft])=>{const it=B(he,ge*10+ft);it&&(ot[st]=it)});const Xe=B(he,ge*10)||Ve.image,pt={type:"character-card",name:Ve.name,index:Ve.index,image:Xe,imageSources:ot,prompt:Ve.prompt,fullDescription:Ve.fullDescription,selectedRatio:Ve.selectedRatio,additionalPrompt:Ve.additionalPrompt};U.createItem(Jn.ITEM,Ve.name||"New Character",JSON.stringify(pt)),N(t("toast.characterSavedCatalog"),"success")}else{const Ve=Ge.map((Xe,pt)=>{const st={...Xe.thumbnails||Xe.imageSources||{}};Object.entries(Ut).forEach(([it,wt])=>{const dt=B(he,pt*10+wt);dt&&(st[it]=dt)});const ft=B(he,pt*10)||Xe.image;return{id:Xe.id||`char-${Date.now()}-${pt}`,type:"character-card",name:Xe.name,index:Xe.index,image:ft,imageSources:st,prompt:Xe.prompt,fullDescription:Xe.fullDescription,selectedRatio:Xe.selectedRatio,additionalPrompt:Xe.additionalPrompt,isActive:Xe.isActive}}),ot=ve.title||"Character Collection";U.createItem(Jn.ITEM,ot,JSON.stringify(Ve)),N(t("toast.characterSavedCatalog")+" (All)","success")}}catch(Ge){console.error("Failed to save character to catalog",Ge),N("Failed to save to catalog","error")}},[D.nodes,U,B,N,t]),Fe=y.useCallback(he=>{if(!he)return;const ge={type:"character-card",name:he.name,index:he.alias||he.index,image:he.imageBase64?`data:image/png;base64,${he.imageBase64}`:null,imageSources:he.imageBase64?{"1:1":`data:image/png;base64,${he.imageBase64}`}:{},prompt:he.prompt,fullDescription:he.fullDescription,selectedRatio:"1:1",additionalPrompt:he.additionalPrompt};U.createItem(Jn.ITEM,he.name||"Generated Character",JSON.stringify(ge)),N(t("toast.characterSavedCatalog"),"success")},[U,N,t]),We=y.useCallback(he=>{const ge=D.nodes.find(ve=>ve.id===he);ge&&(ge.type===q.SCRIPT_GENERATOR||ge.type===q.SCRIPT_VIEWER)&&(ee.createItem(Jn.ITEM,ge.title||"New Script",ge.value),N("Script saved to catalog","success"))},[D.nodes,ee,N]),Ze=y.useCallback(he=>{const ge=D.nodes.find(ve=>ve.id===he);if(ge){if(ge.type===q.IMAGE_SEQUENCE_GENERATOR)try{const ve=JSON.parse(ge.value||"{}"),Ge={type:"script-prompt-modifier-data",title:ge.title,usedCharacters:ve.usedCharacters,sceneContexts:ve.sceneContexts,finalPrompts:(ve.prompts||[]).map(Ve=>({frameNumber:Ve.frameNumber,sceneNumber:Ve.sceneNumber,sceneTitle:Ve.sceneTitle,characters:Ve.characters,duration:Ve.duration,prompt:Ve.prompt,shotType:Ve.shotType})),videoPrompts:(ve.prompts||[]).map(Ve=>({frameNumber:Ve.frameNumber,videoPrompt:Ve.videoPrompt})),styleOverride:ve.styleOverride};ae.createItem(Jn.ITEM,ge.title||"New Sequence",JSON.stringify(Ge)),N("Sequence saved to catalog","success")}catch(ve){console.error(ve)}else if(ge.type===q.PROMPT_SEQUENCE_EDITOR)try{const ve=JSON.parse(ge.value||"{}"),Ge={type:"script-prompt-modifier-data",title:ge.title,usedCharacters:ve.usedCharacters,sceneContexts:ve.sceneContexts,finalPrompts:ve.modifiedPrompts||ve.sourcePrompts||[],styleOverride:ve.styleOverride};ae.createItem(Jn.ITEM,ge.title||"New Sequence",JSON.stringify(Ge)),N("Sequence saved to catalog","success")}catch(ve){console.error(ve)}}},[D.nodes,ae,N]),$e=MC({...D,...T,...te,...F,...me,handleToggleCatalog:me.handleToggleCatalog,deleteNodeAndConnections:de.deleteNodeAndConnections,onAddNode:de.onAddNode,handleDuplicateNode:ke.handleDuplicateNode,handleDuplicateNodeWithContent:ke.handleDuplicateNodeWithContent,copyNodeValue:ke.copyNodeValue,pasteImageToNode:ke.pasteImageToNode,addConnection:T.addConnection,isSnapToGrid:h.isSnapToGrid,setIsSnapToGrid:h.setIsSnapToGrid,setLineStyle:h.setLineStyle,activeTool:h.activeTool,setActiveTool:h.setActiveTool,setSpawnLine:h.setSpawnLine,setError:h.setError,handleLoadCanvasIntoCurrentTab:pe.handleLoadCanvasIntoCurrentTab,t,draggingInfo:O,setDraggingInfo:z,handleDetachNodeFromGroup:Me,handleSaveCanvas:pe.handleSaveCanvas,handleLoadCanvas:pe.handleLoadCanvas,handleOpenConnectionQuickAdd:me.handleOpenConnectionQuickAdd,handleOpenContextMenu:me.handleOpenContextMenu,quickSlots:me.quickSlots,isConnectionQuickAddOpen:me.isConnectionQuickAddOpen,pasteGroup:de.pasteGroup,copyGroup:de.copyGroup,isSmartGuidesEnabled:h.isSmartGuidesEnabled,setIsSmartGuidesEnabled:h.setIsSmartGuidesEnabled,setSmartGuides:h.setSmartGuides,selectedNodeIds:S,setSelectedNodeIds:A,handleRenameNode:D.handleRenameNode,setFullSizeImage:I,handleOpenQuickAdd:me.handleOpenQuickAdd,requestDeleteNodes:me.requestDeleteNodes,isInstantCloseEnabled:h.isInstantCloseEnabled,handleAlignNodes:de.handleAlignNodes,handleDockNode:de.handleDockNode,handlePaste:he=>ke.handlePaste(S,ke.pasteNodeValue,ke.pasteImageToNode,F,de,D,he),selectNode:he=>A([he]),dockHoverMode:h.dockHoverMode,setDockHoverMode:h.setDockHoverMode,isDockingMenuVisible:h.isDockingMenuVisible,setIsDockingMenuVisible:h.setIsDockingMenuVisible,undoPosition:$.undoPosition,redoPosition:$.redoPosition,handleToggleNodePin:D.handleToggleNodePin}),He=y.useCallback((he,ge)=>{D.nodes.find(Ge=>Ge.id===ge)&&(S.includes(ge)||A([ge]),me.handleOpenNodeContextMenu(he,ge))},[D.nodes,S,A,me.handleOpenNodeContextMenu]),be=y.useCallback(he=>{if(D.handleToggleNodeCollapse(he),D.nodes.find(ve=>ve.id===he)){const ve=te.groups.find(Ge=>Ge.nodeIds.includes(he));if(ve){const Ve=D.nodes.map(Xe=>Xe.id===he?{...Xe,isCollapsed:!Xe.isCollapsed}:Xe).filter(Xe=>ve.nodeIds.includes(Xe.id)),ot=qr(Ve);ot&&te.setGroups(Xe=>Xe.map(pt=>pt.id===ve.id?{...pt,...ot}:pt))}}},[D.handleToggleNodeCollapse,D.nodes,te.groups,te.setGroups]),Ae=y.useCallback((he,ge)=>{const ve=D.nodes.find(Ge=>Ge.id===he);(ve==null?void 0:ve.type)===q.IMAGE_SEQUENCE_GENERATOR?Q.handleGenerateSelectedFrames(he,[ge]):Q.handleEditImage(he,[ge])},[Q,D.nodes]),Te=QC({...$e,...me,...F,...de,...pe,...D,...T,...te,catalogItems:J.currentCatalogItems,libraryItems:H.currentLibraryItems,handleLoadCanvasIntoCurrentTab:pe.handleLoadCanvasIntoCurrentTab,setError:h.setError,pasteImageToNode:ke.pasteImageToNode,isPanning:F.isPanning,addGroup:te.addGroup,onAddNode:de.onAddNode,zoomDragInfo:$e.zoomDragInfo,characterCatalogItems:U.items,scriptCatalogItems:ee.items,sequenceCatalogItems:ae.items,connectingInfo:$e.connectingInfo,setFullSizeImage:I,t,handleAddGroupFromCatalog:ke.handleAddGroupFromCatalog,activeTabId:c,handleRenameTab:m}),qe=y.useCallback(he=>{const ge=he.target;ge.closest(".node-view")||ge.closest(".group-view")||ge.closest(".connection-view")||ge.closest("input, textarea, button, a, select")||(he.preventDefault(),me.handleOpenContextMenu({x:he.clientX,y:he.clientY}))},[me.handleOpenContextMenu]),Ye=y.useCallback(he=>{const ge=()=>{const ve=x(o);b(o),ie(ve)};he!=null&&he.shiftKey?ge():me.setConfirmInfo({title:t("dialog.confirmReset.title"),message:t("dialog.confirmReset.message"),onConfirm:ge})},[b,o,t,me,x,ie]),nt=y.useCallback((he,ge,ve,Ge)=>{let Ve=he;he.startsWith("data:image/png")&&(Ve=$i(he,"prompt",ve));const ot=document.createElement("a");if(ot.href=Ve,Ge)ot.download=Ge;else{const Xe=new Date,pt=Xe.toISOString().split("T")[0],st=Xe.toTimeString().split(" ")[0].replace(/:/g,"-"),ft=String(ge).padStart(3,"0");ot.download=`Image_${ft}_${pt}_${st}.png`}document.body.appendChild(ot),ot.click(),document.body.removeChild(ot)},[]),Nt=y.useCallback(async he=>{try{if(he&&he.startsWith("data:image")){let ve=await(await fetch(he)).blob();if(ve.type!=="image/png")try{const Ge=await createImageBitmap(ve),Ve=document.createElement("canvas");Ve.width=Ge.width,Ve.height=Ge.height;const ot=Ve.getContext("2d");if(ot){ot.drawImage(Ge,0,0);const Xe=await new Promise(pt=>Ve.toBlob(pt,"image/png"));Xe&&(ve=Xe)}}catch(Ge){console.error("Failed to convert image to PNG:",Ge)}await navigator.clipboard.write([new ClipboardItem({[ve.type]:ve})]),N(t("toast.copiedToClipboard"))}else N(t("toast.pasteFailed"),"error")}catch(ge){console.error("Failed to copy image to clipboard:",ge),N(t("toast.pasteFailed"),"error")}},[N,t]),ze=y.useRef(D.nodes);ze.current=D.nodes;const je=y.useRef(F.viewTransform);je.current=F.viewTransform;const Le=y.useCallback(he=>{const ge=ze.current,ve=ge.find(st=>st.id===he);if(!ve)return;const Ge=le(he,void 0,ge,!1);let Ve="",ot=null,Xe=null,pt="video";Ge.forEach(st=>{if(typeof st=="string")st.startsWith("data:image")?ot||(ot=st):st.startsWith("data:video")||st.startsWith("data:audio")||st.match(/^https?:\/\/.*\.(mp4|webm|ogg|mp3|wav)$/i)?Xe||(Xe=st,pt=st.startsWith("data:audio")||st.match(/\.(mp3|wav)$/i)?"audio":"video"):Ve?Ve+=(Ve?`

`:"")+st:Ve=st;else if(typeof st=="object"&&st!==null)if(st.base64ImageData)ot||(ot=`data:${st.mimeType};base64,${st.base64ImageData}`);else{const ft=JSON.stringify(st,null,2);Ve?Ve+=(Ve?`

`:"")+ft:Ve=ft}});try{const st=JSON.parse(ve.value||"{}"),ft={text:Ve,image:ot,mediaUrl:Xe,mediaType:pt};JSON.stringify(st)!==JSON.stringify(ft)&&D.handleValueChange(he,JSON.stringify(ft))}catch{D.handleValueChange(he,JSON.stringify({text:Ve,image:ot,mediaUrl:Xe,mediaType:pt}))}},[le,D.handleValueChange]),rt=y.useCallback(he=>{const ge=T.connections.find(dt=>dt.id===he);if(!ge)return;const ve=D.nodes.find(dt=>dt.id===ge.fromNodeId),Ge=D.nodes.find(dt=>dt.id===ge.toNodeId);if(!ve||!Ge)return;const{start:Ve,end:ot}=zp(ve,Ge,ge),{minWidth:Xe,minHeight:pt}=Da(q.REROUTE_DOT),st={x:(Ve.x+ot.x)/2-Xe/2,y:(Ve.y+ot.y)/2-pt/2},ft=Xn(ve,ge.fromHandleId),it=de.onAddNode(q.REROUTE_DOT,st),wt=JSON.stringify({type:ft,direction:"LR"});D.handleValueChange(it,wt),T.setConnections(dt=>{const _t=dt.filter(Ee=>Ee.id!==he),cn={id:`conn-split-1-${Date.now()}`,fromNodeId:ge.fromNodeId,fromHandleId:ge.fromHandleId,toNodeId:it,toHandleId:void 0},It={id:`conn-split-2-${Date.now()}`,fromNodeId:it,fromHandleId:void 0,toNodeId:ge.toNodeId,toHandleId:ge.toHandleId};return[..._t,cn,It]})},[T,D,de]),Ce=y.useCallback((he,ge)=>{const ve=ze.current.find(it=>it.id===he);if(!ve)return;A([he]);const Ge=window.innerWidth,Ve=window.innerHeight,ot=ve.position.x+ve.width/2,Xe=ve.position.y+300,pt=je.current.scale,st=Ge/2-ot*pt,ft=Ve/2-Xe*pt;F.setViewTransform(it=>({scale:it.scale,translate:{x:st,y:ft}}));try{const it=JSON.parse(ve.value||"{}");it.selectedFrameNumber!==ge&&D.handleValueChange(he,JSON.stringify({...it,selectedFrameNumber:ge}))}catch(it){console.error("Failed to update node selection frame",it)}},[D.handleValueChange,F.setViewTransform,A]),Se=y.useMemo(()=>{const{replaceAllItems:he,importItemsData:ge,...ve}=H,{replaceAllItems:Ge,importItemsData:Ve,...ot}=J;return{...i,...D,...T,...te,...F,...me,...ot,...ve,...a,...pe,...de,...$e,...oe,...Te,...ne,...ue,...ce,...Q,...X,...$,...h,...ke,...xe,tutorialStep:Y.tutorialStep,advanceTutorial:Y.advanceTutorial,setTutorialStep:Y.setTutorialStep,tutorialTargetId:Y.tutorialTargetId,startTutorial:Y.startTutorial,skipTutorial:Y.skipTutorial,t,onSanitize:X.handleSanitizePrompt,characterCatalog:U,scriptCatalog:ee,sequenceCatalog:ae,onRenameCharacter:(Xe,pt)=>me.setRenameInfo({type:"character",id:Xe,currentTitle:pt}),onRenameScript:(Xe,pt)=>me.setRenameInfo({type:"script",id:Xe,currentTitle:pt}),onRenameSequence:(Xe,pt)=>me.setRenameInfo({type:"sequence",id:Xe,currentTitle:pt}),onGenerateSelectedFrames:Q.handleGenerateSelectedFrames,onTranslateScript:X.handleTranslateScript,onReadData:Le,onRefreshUpstreamData:(Xe,pt)=>{},handleDetachNodeFromGroup:Me,onDetachCharacter:ke.handleDetachCharacterFromGenerator,onSaveScriptToDisk:pe.handleSaveScriptFile,onSaveMediaToDisk:ke.onSaveMediaToDisk,onGenerateCharacterImage:Q.handleGenerateCharacterImage,onStopGeneration:X.handleStopGeneration,onEditImage:Q.handleEditImage,onImageToText:ne.handleImageToText,handleRegenerateFrame:Ae,handleLoadFromExternal:pe.handleLoadFromExternal,handleNavigateToNodeFrame:Ce,handleSplitConnection:rt,replaceAllItems:he,importItemsData:ge,handleToggleNodeCollapse:be,handleNodeContextMenuLogic:He,handleCanvasContextMenu:qe,isGlobalProcessing:P.size>0,handlePaste:(Xe=!1)=>ke.handlePaste(S,ke.pasteNodeValue,ke.pasteImageToNode,F,de,D,Xe),handleDownloadImage:Xe=>ke.handleDownloadImage(Xe,nt),setLibraryItems:he,activeTool:$e.effectiveTool,setActiveTool:$e.setActiveTool,dragOverNodeId:$e.hoveredNodeId,isDraggingOverCanvas:!1,handleOpenNodeContextMenu:He,onRefreshChat:ue.handleRefreshChat,isStopping:X.isStopping||Q.isStoppingEdit,isStoppingSequence:Q.isStoppingEdit,selectNode:Xe=>A([Xe]),handleAddNodeAndConnect:Re,handleToggleNodePin:D.handleToggleNodePin,handleToggleNodeHandles:D.handleToggleNodeHandles,handleClearNodeNewFlag:D.handleClearNodeNewFlag,handleResetCanvas:Ye,resetCanvasToDefault:Z,handleNodeCutConnections:T.removeConnectionsByNodeId,showWelcome:h.showWelcome,setShowWelcome:h.setShowWelcome,nextAutoSaveTime:i.nextAutoSaveTime,isAutoSaving:i.isAutoSaving,onUpdateCharacterDescription:X.handleUpdateCharacterDescription,handleUpdateCharacterDescription:X.handleUpdateCharacterDescription,isUpdatingDescription:X.isUpdatingDescription,onUpdateCharacterPersonality:X.handleUpdateCharacterPersonality,handleUpdateCharacterPersonality:X.handleUpdateCharacterPersonality,isUpdatingPersonality:X.isUpdatingPersonality,onUpdateCharacterAppearance:X.handleUpdateCharacterAppearance,handleUpdateCharacterAppearance:X.handleUpdateCharacterAppearance,isUpdatingAppearance:X.isUpdatingAppearance,onUpdateCharacterClothing:X.handleUpdateCharacterClothing,handleUpdateCharacterClothing:X.handleUpdateCharacterClothing,isUpdatingClothing:X.isUpdatingClothing,onModifyCharacter:X.handleModifyCharacter,handleModifyCharacter:X.handleModifyCharacter,isModifyingCharacter:X.isModifyingCharacter,onGenerateImage:Q.handleGenerateImage,handleUpdateCharacterPromptFromImage:ne.handleUpdateCharacterPromptFromImage,isUpdatingCharacterPrompt:ne.isUpdatingCharacterPrompt,onDownloadImageFromUrl:nt,onCopyImageToClipboard:Nt,handleRemoveGroup:De,handleSaveGroupToCatalog:Ie,handleSaveGroupToDisk:Ne,handleDetachAndPasteConcept:Pe,onDetachImageToNode:ye,onSaveCharacterToCatalog:_e,onSaveGeneratedCharacterToCatalog:Fe,onSaveScriptToCatalog:We,onSaveSequenceToCatalog:Ze,onSavePromptToLibrary:H.saveProcessorPrompt,onSaveToLibrary:H.saveToLibrary,clearSelectionsSignal:h.clearSelectionsSignal,globalImageEditor:h.globalImageEditor,openGlobalImageEditor:h.openGlobalImageEditor,closeGlobalImageEditor:h.closeGlobalImageEditor,handleDeleteFromDrive:xe.handleDeleteFromDrive,handleClearCloudFolder:xe.handleClearCloudFolder,handleCleanupDuplicates:xe.handleCleanupDuplicates}},[i,D,T,te,F,me,J,H,a,pe,de,$e,oe,Te,ne,ue,ce,Q,X,$,h,ke,Y,xe,be,He,qe,P.size,S,t,U,ee,ae,Me,Re,Ae,ne.handleImageToText,Ye,Z,D.handleToggleNodeHandles,D.handleClearNodeNewFlag,ne.handleUpdateCharacterPromptFromImage,ne.isUpdatingCharacterPrompt,X.handleUpdateCharacterPersonality,X.isUpdatingPersonality,X.handleUpdateCharacterAppearance,X.isUpdatingAppearance,X.handleUpdateCharacterClothing,X.isUpdatingClothing,nt,Nt,Ce,rt,T.removeConnectionsByNodeId,De,Ie,Ne,Pe,ye,_e,Fe,We,Ze]);return n.jsx(hy.Provider,{value:Se,children:e})},Kt=()=>{const e=y.useContext(hy);if(!e)throw new Error("useAppContext must be used within a AppProvider");return e},we=({title:e,onClick:t,children:o,tooltipPosition:r="top",tooltipAlign:a="center",disabled:i=!1,className:s})=>{const c=s||"p-1 text-gray-400 rounded hover:bg-gray-600 hover:text-white transition-colors duration-150 focus:outline-none disabled:text-gray-600 disabled:bg-transparent disabled:cursor-not-allowed flex items-center justify-center";let d="";return r==="top"?(d="bottom-full mb-2",a==="center"?d+=" left-1/2 -translate-x-1/2":a==="start"?d+=" left-0":a==="end"&&(d+=" right-0")):r==="bottom"?(d="top-full mt-2",a==="center"?d+=" left-1/2 -translate-x-1/2":a==="start"?d+=" left-0":a==="end"&&(d+=" right-0")):r==="left"?d="right-full top-1/2 -translate-y-1/2 mr-2":r==="right"&&(d="left-full top-1/2 -translate-y-1/2 ml-2"),n.jsxs("div",{className:"relative group/btn-tooltip flex items-center justify-center",children:[n.jsx("button",{onClick:t,disabled:i,onMouseDown:u=>u.stopPropagation(),"aria-label":e,className:c,children:o}),e&&!i&&n.jsx("div",{className:`absolute ${d} px-2 py-1 bg-slate-700 text-slate-200 text-[10px] font-bold whitespace-nowrap rounded-md shadow-xl z-50 opacity-0 pointer-events-none group-hover/btn-tooltip:opacity-100 transition-opacity duration-200`,role:"tooltip",children:e})]})},mt=({content:e,children:t,position:o="top",align:r="center",className:a="",delay:i=0,usePortal:s=!0})=>{const[l,c]=y.useState(!1),[d,u]=y.useState(null),p=y.useRef(null),m=y.useRef(null),w=()=>{if(!m.current||!s)return;const h=m.current.getBoundingClientRect(),v=6;let N=0,_=0;o==="top"||o==="bottom"?r==="start"?N=h.left:r==="end"?N=h.right:N=h.left+h.width/2:o==="left"?N=h.left-v:o==="right"&&(N=h.right+v),o==="top"?_=h.top-v:o==="bottom"?_=h.bottom+v:_=h.top+h.height/2,u({x:N,y:_})},k=()=>{s&&w(),i>0?p.current=setTimeout(()=>c(!0),i):c(!0)},b=()=>{p.current&&(clearTimeout(p.current),p.current=null),c(!1)};if(y.useEffect(()=>{if(l&&s)return window.addEventListener("scroll",w,!0),window.addEventListener("resize",w),()=>{window.removeEventListener("scroll",w,!0),window.removeEventListener("resize",w)}},[l,s]),y.useEffect(()=>{if(!l)return;const h=v=>{if(m.current){const N=m.current.getBoundingClientRect(),_=10;v.clientX>=N.left-_&&v.clientX<=N.right+_&&v.clientY>=N.top-_&&v.clientY<=N.bottom+_||(c(!1),p.current&&clearTimeout(p.current))}};return window.addEventListener("mousemove",h),()=>window.removeEventListener("mousemove",h)},[l]),!e)return n.jsx("div",{className:a,children:t});let x="",f="";return s?o==="top"?r==="center"?x="translate(-50%, -100%)":r==="start"?x="translate(0, -100%)":r==="end"&&(x="translate(-100%, -100%)"):o==="bottom"?r==="center"?x="translate(-50%, 0)":r==="start"?x="translate(0, 0)":r==="end"&&(x="translate(-100%, 0)"):o==="left"?x="translate(-100%, -50%)":o==="right"&&(x="translate(0, -50%)"):o==="top"?(f="bottom-full mb-2",r==="center"?(f+=" left-1/2",x="translate(-50%, 0)"):r==="start"?f+=" left-0":r==="end"&&(f+=" right-0")):o==="bottom"?(f="top-full mt-2",r==="center"?(f+=" left-1/2",x="translate(-50%, 0)"):r==="start"?f+=" left-0":r==="end"&&(f+=" right-0")):o==="left"?(f="right-full mr-2 top-1/2",x="translate(0, -50%)"):o==="right"&&(f="left-full ml-2 top-1/2",x="translate(0, -50%)"),n.jsxs(n.Fragment,{children:[n.jsxs("div",{ref:m,className:`relative flex items-center justify-center ${a} pointer-events-auto`,onMouseEnter:k,onMouseLeave:b,onMouseDown:()=>c(!1),children:[t,!s&&l&&n.jsx("div",{className:`absolute z-50 px-3 py-1.5 bg-slate-700 text-slate-200 text-xs font-medium whitespace-nowrap rounded-md shadow-xl pointer-events-none ${f}`,style:{transform:x,animation:"fade-in-tooltip 0.15s ease-out"},children:e})]}),s&&l&&d&&Va.createPortal(n.jsxs("div",{className:"fixed z-[9999] px-3 py-1.5 bg-slate-700 text-slate-200 text-xs font-medium whitespace-nowrap rounded-md shadow-xl pointer-events-none",style:{top:d.y,left:d.x,transform:x,animation:"fade-in-tooltip 0.15s ease-out"},children:[n.jsx("style",{children:`
                        @keyframes fade-in-tooltip {
                            from { opacity: 0; }
                            to { opacity: 1; }
                        }
                    `}),e]}),document.body)]})},my=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}),gy=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),oP=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),rP=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),fy=({className:e="h-5 w-5"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),aP=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),xy=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),iP=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})}),sP=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),lP=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})}),cP=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"})}),yy=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"4",width:"6",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"8",width:"8",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"12",width:"4",height:"2",fill:"currentColor",rx:"1"})]}),vy=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"7",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1",opacity:"0.5"}),n.jsx("rect",{x:"3",y:"4",width:"10",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"8",width:"6",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"2",y:"12",width:"12",height:"2",fill:"currentColor",rx:"1"})]}),wy=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"12",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"4",width:"6",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"3",y:"8",width:"8",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"7",y:"12",width:"4",height:"2",fill:"currentColor",rx:"1"})]}),dP=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"4",y:"5",width:"2",height:"6",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"8",y:"5",width:"2",height:"8",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"5",width:"2",height:"4",fill:"currentColor",rx:"1"})]}),uP=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"7",width:"12",height:"2",fill:"currentColor",rx:"1",opacity:"0.5"}),n.jsx("rect",{x:"4",y:"3",width:"2",height:"10",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"8",y:"5",width:"2",height:"6",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"})]}),pP=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"12",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"4",y:"5",width:"2",height:"6",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"8",y:"3",width:"2",height:"8",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"7",width:"2",height:"4",fill:"currentColor",rx:"1"})]}),hP=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"7",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"})]}),mP=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"2",y:"7",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"2",y:"12",width:"12",height:"2",fill:"currentColor",rx:"1"})]}),gP=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 14v6m-3-3h6M6 10h2a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2zm10 0h2a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2zM6 20h2a2 2 0 002-2v-2a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2z"})}),zt=({className:e="h-5 w-5"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("rect",{x:"8",y:"8",width:"12",height:"12",rx:"2",ry:"2"}),n.jsx("path",{d:"M16 8V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2"})]}),by=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),Cy=({className:e="h-4 w-4"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 24 24",children:[n.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2"}),n.jsx("path",{d:"M4 4h8v16H4z",fill:"currentColor",stroke:"none",opacity:"0.8"})]}),ky=({className:e="h-4 w-4"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 24 24",children:[n.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2"}),n.jsx("path",{d:"M12 4h8v16h-8z",fill:"currentColor",stroke:"none",opacity:"0.8"})]}),Xp=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})}),Zp=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9H5a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1zm0 0l-5-5M15 9h4a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1zm0 0l5-5M9 15H5a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1zm0 0l-5 5M15 15h4a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1zm0 0l5 5"})}),Qp=({className:e="h-4 w-4"})=>n.jsx("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 512 512",fill:"currentColor",children:n.jsx("g",{children:n.jsx("path",{d:`M374.8,9.4c-12.4-12.5-32.6-12.6-45.2-0.1c-3.3,3.3-5.6,7.3-7.2,11.3c-26.6,55.5-55.8,86.7-92.8,105.2
                c-41.4,20.5-89,34.7-165.7,34.7c-4.2,0-8.3,0.8-12.2,2.4c-7.8,3.2-14,9.5-17.3,17.3c-3.2,7.8-3.2,16.6,0,24.4
                c1.6,3.9,4,7.5,6.9,10.4L145,318.7L0,512l193.3-145L297,470.6c2.9,3,6.5,5.3,10.4,6.9c3.9,1.6,8.1,2.5,12.2,2.5
                c4.2,0,8.3-0.9,12.2-2.5c7.8-3.3,14.1-9.4,17.3-17.3c1.6-3.9,2.5-8.1,2.5-12.2c0-76.7,14.2-124.3,34.6-165.1
                c18.4-36.9,49.7-66.2,105.2-92.8c4.1-1.6,8-3.9,11.3-7.2c12.4-12.6,12.4-32.7-0.1-45.2L374.8,9.4z`})})}),fP=({className:e="h-4 w-4"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),xP=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 000-6.364l-7.682 7.682-7.682-7.682z"})}),yP=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),vP=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),wP=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363 1.118l-3.976-2.888c-.784-.57-.382-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})}),bP=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363 1.118l-3.976-2.888c-.784-.57-.382-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})}),Il=({className:e="h-4 w-4"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),Tl=({className:e="h-4 w-4"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24"}),n.jsx("path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"}),n.jsx("path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"}),n.jsx("line",{x1:"2",x2:"22",y1:"2",y2:"22"})]}),l0=({className:e="h-5 w-5"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 87.3 78",fill:"currentColor",children:[n.jsx("path",{d:"M6.6 66.85l3.85 6.65c.8 1.4 1.95 2.5 3.3 3.3l13.75-23.8h-27.5c0 1.55.4 3.1 1.2 4.5z",fill:"#0066da"}),n.jsx("path",{d:"M43.65 25l13.75-23.8c-1.35-.8-2.9-1.2-4.5-1.2h-18.5c-1.6 0-3.15.45-4.5 1.2l13.75 23.8z",fill:"#00ac47"}),n.jsx("path",{d:"M73.55 76.8c1.35-.8 2.5-1.9 3.3-3.3l9.6-16.6c.8-1.4 1.2-2.95 1.2-4.5h-27.5l13.4 24.4z",fill:"#ea4335"}),n.jsx("path",{d:"M43.65 25L29.9 1.2c-1.35.8-2.5 1.9-3.3 3.3l-9.6 16.6c-.8 1.4-1.2 2.95-1.2 4.5h27.5z",fill:"#00832d"}),n.jsx("path",{d:"M59.05 52.9H31.55l-13.75 23.8c1.35.8 2.9 1.2 4.5 1.2h18.5c1.6 0 3.15-.45 4.5-1.2l13.75-23.8z",fill:"#2684fc"}),n.jsx("path",{d:"M73.55 76.8l-13.75-23.8h-27.5l13.75 23.8c1.35.8 2.9 1.2 4.5 1.2h18.5c1.6 0 3.15-.45 4.5-1.2z",fill:"#ffba00"})]}),rc=({className:e="h-5 w-5"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),CP=({className:e="h-5 w-5"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12M12 10v9m0 0l3-3m-3 3l-3-3"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 10V19M9 16L12 19L15 16"})]}),kP=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 4.5l-2.404 2.404a5.002 5.002 0 01-7.072 0l-1.06-1.06a5.002 5.002 0 010-7.072l2.404-2.404a1.5 1.5 0 012.122 0l6.01 6.01a1.5 1.5 0 010 2.122zM8.25 15.75l-4.5 4.5a1.5 1.5 0 000 2.122l1.06 1.06a1.5 1.5 0 002.122 0l4.5-4.5"})}),eh=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})}),_P=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),SP=({className:e="h-8 w-8 text-cyan-400"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",fill:"none",opacity:"0.8"}),n.jsx("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",fill:"none",opacity:"0.8"}),n.jsx("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",fill:"none",opacity:"0.8"}),n.jsx("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",fill:"none",opacity:"0.8"}),n.jsx("path",{d:"M10 6.5h4",stroke:"currentColor",strokeOpacity:"0.5"}),n.jsx("path",{d:"M6.5 10v4",stroke:"currentColor",strokeOpacity:"0.5"}),n.jsx("path",{d:"M17.5 10v4",stroke:"currentColor",strokeOpacity:"0.5"}),n.jsx("path",{d:"M10 17.5h4",stroke:"currentColor",strokeOpacity:"0.5"})]}),ac=({className:e="h-10 w-10 text-cyan-400"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),NP=({className:e="h-10 w-10 text-cyan-400"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),th=({className:e="h-5 w-5"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),nh=({className:e="h-5 w-5"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),Vr=({className:e="h-5 w-5"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),Ru=({className:e="h-5 w-5"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),Mu=({className:e="h-5 w-5"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),Lu=({className:e="h-5 w-5"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})}),Du=({className:e="h-5 w-5"})=>n.jsxs("div",{className:"relative",children:[n.jsx(rc,{className:e}),n.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:n.jsx("div",{className:"w-0.5 h-full bg-red-500 rotate-45 transform origin-center absolute scale-y-125"})})]}),EP=({className:e="h-10 w-10"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 3h15a1.5 1.5 0 011.5 1.5v15a1.5 1.5 0 01-1.5 1.5h-15a1.5 1.5 0 01-1.5-1.5v-15A1.5 1.5 0 014.5 3z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 17.25h7.5a6 6 0 00-7.5 0z"})]}),PP=({className:e="h-10 w-10"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})}),jP=({className:e="h-10 w-10"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})}),IP=({node:e,isDockedWindow:t,isRerouteDot:o,headerBgClass:r,onMouseDown:a,onTouchStart:i,onMouseUp:s,onDoubleClick:l,onToggleCollapse:c,onRenameNode:d,onCutConnections:u,onDuplicateNode:p,onDuplicateNodeWithContent:m,onCopyNodeValue:w,onPasteNodeValue:k,onPasteImage:b,onDownloadImage:x,onRefreshImageEditor:f,onRefreshChat:h,onValueChange:v,clearImagesForNodeFromCache:N,addToast:_,getEmptyValueForNodeType:E,onSaveSequenceToCatalog:I,onSaveScriptToDisk:B,onSaveMediaToDisk:M,onSaveCharacterToCatalog:G,onSaveCharacterCard:V,handleUndockNode:j,handleOpenNodeContextMenu:P,handleRequestDelete:S,isInstantCloseEnabled:A,onToggleCharacterImages:O,allImagesCollapsed:z})=>{const{t:L}=Pt(),W=Kt(),{handleDockNode:D,toggleNodeFullScreen:T,focusedNodeId:F,handleToggleNodePin:te,handleToggleNodeHandles:$}=W||{},Y=F===e.id,oe=Yl(e.type),le=e.type===q.NOTE;let K=!1,ie={};if(le)try{ie=JSON.parse(e.value||"{}"),K=!!ie.isMinimal}catch{}const Z=ee=>{ee.stopPropagation();const ae={...ie,isMinimal:!K};v(e.id,JSON.stringify(ae))},se=At.useMemo(()=>{if(e.type===q.IMAGE_OUTPUT||e.type===q.VIDEO_OUTPUT)return!!e.value;if(e.type===q.IMAGE_INPUT||e.type===q.IMAGE_ANALYZER||e.type===q.IMAGE_EDITOR||e.type===q.CHARACTER_CARD||e.type===q.DATA_READER)try{const ee=JSON.parse(e.value||"{}");return!!ee.image||ee.inputImages&&ee.inputImages.length>0||!!ee.outputImage}catch{return e.type===q.IMAGE_INPUT?!!e.value:!1}return!1},[e.type,e.value]),de=At.useMemo(()=>({[q.TEXT_INPUT]:L("node.help.text_input"),[q.IMAGE_INPUT]:L("node.help.image_input"),[q.PROMPT_PROCESSOR]:L("node.help.prompt_processor"),[q.PROMPT_SANITIZER]:L("node.help.prompt_sanitizer"),[q.VIDEO_PROMPT_PROCESSOR]:L("node.help.video_prompt_processor"),[q.IMAGE_OUTPUT]:L("node.help.image_output"),[q.VIDEO_OUTPUT]:L("node.help.video_output"),[q.PROMPT_ANALYZER]:L("node.help.prompt_analyzer"),[q.CHARACTER_ANALYZER]:L("node.help.character_analyzer"),[q.CHARACTER_GENERATOR]:L("node.help.character_generator"),[q.CHARACTER_CARD]:L("node.help.character_card"),[q.IMAGE_ANALYZER]:L("node.help.image_analyzer"),[q.IMAGE_EDITOR]:L("node.help.image_editor"),[q.IMAGE_SEQUENCE_GENERATOR]:L("node.help.image_sequence_generator"),[q.PROMPT_SEQUENCE_EDITOR]:L("node.help.prompt_sequence_editor"),[q.GEMINI_CHAT]:L("node.help.gemini_chat"),[q.TRANSLATOR]:L("node.help.translator"),[q.SCRIPT_GENERATOR]:L("node.help.script_generator"),[q.SCRIPT_VIEWER]:L("node.help.script_viewer"),[q.NOTE]:L("node.help.note"),[q.REROUTE_DOT]:L("node.help.reroute_dot"),[q.DATA_READER]:L("node.help.data_reader"),[q.VIDEO_EDITOR]:L("node.help.video_editor"),[q.MEDIA_VIEWER]:L("node.help.media_viewer")}),[L]),re=ee=>{ee.stopPropagation(),v(e.id,E(e)),(e.type===q.IMAGE_INPUT||e.type===q.IMAGE_OUTPUT||e.type===q.IMAGE_ANALYZER||e.type===q.IMAGE_SEQUENCE_GENERATOR)&&N(e.id),_(L("toast.contentCleared"))},R=ee=>{ee.stopPropagation(),D&&D(e.id,"full"),T&&setTimeout(()=>T(e.id),50)},J=ee=>{if(!D||!e.dockState)return;const ae=["q1","q2","q3","q4"],xe=e.dockState.mode;let ne=ae.indexOf(xe);ne===-1&&(["left","tl","bl"].includes(xe)?ne=0:["right","tr","br"].includes(xe)?ne=3:ne=0);let X=ne+ee;X<0&&(X=0),X>=ae.length&&(X=ae.length-1),ae[X]!==xe&&D(e.id,ae[X])},H=ee=>{if(!D||!e.dockState)return;const ae=e.dockState.mode;ee==="left"?ae==="tl"?D(e.id,"bl"):D(e.id,"tl"):ae==="tr"?D(e.id,"br"):D(e.id,"tr")},U=ee=>{ee.stopPropagation();let ae=[];try{const Q=JSON.parse(e.value||"[]");ae=Array.isArray(Q)?Q:[Q]}catch{ae=[]}let xe=1;const ne=new Set(ae.map(Q=>Q.name));for(;ne.has(`New Character ${xe}`);)xe++;const X={id:`char-card-${Date.now()}`,name:`New Character ${xe}`,index:`Character-${ae.length+1}`,image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:ae.length===0,isDescriptionCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"},ue=[...ae,X];if(v(e.id,JSON.stringify(ue)),W!=null&&W.setNodes){const pe=ue.length*410+90;W.setNodes(me=>me.map(ke=>ke.id===e.id?{...ke,width:pe}:ke))}};return n.jsx("div",{className:`${r} text-white font-bold p-2 ${e.isCollapsed&&!t?"rounded-md":"rounded-t-md"} flex justify-between items-center flex-shrink-0 ${!o&&!t?"cursor-move":""}`,onMouseDown:a,onTouchStart:!o&&!t?i:void 0,onMouseUp:s,onContextMenu:ee=>{P&&P(ee,e.id)},onDoubleClick:l,style:o?{height:"100%"}:{height:`${Ft}px`},children:o?n.jsx("div",{className:"w-full h-full flex justify-center items-center"}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"flex items-center space-x-1 min-w-0",children:!K&&n.jsxs(n.Fragment,{children:[!t&&!Y&&n.jsx(we,{title:e.isCollapsed?L("node.action.expand"):L("node.action.collapse"),onClick:()=>c(e.id),children:e.isCollapsed?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),!t&&!Y&&te&&n.jsx(we,{title:e.isPinned?L("node.action.unpin"):L("node.action.pin"),onClick:ee=>{ee.stopPropagation(),te(e.id)},className:`p-1 rounded hover:bg-gray-600 transition-colors border ${e.isPinned?"border-accent-text text-accent-text":"border-transparent text-gray-500 hover:text-white"}`,children:n.jsx(Qp,{className:"h-4 w-4"})}),n.jsx("span",{className:"truncate pr-2",children:e.title})]})}),n.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0",onMouseDown:ee=>ee.stopPropagation(),onTouchStart:ee=>ee.stopPropagation(),onDoubleClick:ee=>ee.stopPropagation(),children:[le&&n.jsx(we,{title:K?"Show Controls":"Hide Controls",onClick:Z,className:`p-1 rounded hover:bg-gray-600 transition-colors ${K?"text-gray-500":"text-gray-400 hover:text-white"}`,children:K?n.jsx(Il,{className:"h-4 w-4"}):n.jsx(Tl,{className:"h-4 w-4"})}),e.type===q.CHARACTER_CARD&&!K&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex bg-gray-800/50 rounded-md border border-gray-600/50 p-0.5 space-x-0.5",children:[V&&n.jsx(we,{title:L("node.action.saveCharacter"),onClick:ee=>{ee.stopPropagation(),V(e.id)},className:"p-1 rounded hover:bg-gray-600 transition-colors text-gray-400 hover:text-white",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),G&&n.jsx(we,{title:L("catalog.saveTo"),onClick:ee=>{ee.stopPropagation(),G(e.id)},className:"p-1 rounded hover:bg-gray-600 transition-colors text-gray-400 hover:text-white",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})})]}),n.jsx("div",{className:"w-px h-3 bg-gray-600/50 mx-0.5"}),O&&n.jsx(we,{title:L(z?"node.action.showImages":"node.action.hideImages"),onClick:ee=>{ee.stopPropagation(),O()},className:`p-1 rounded hover:bg-gray-600 transition-colors border ${z?"border-transparent text-gray-400 hover:text-white":"border-accent text-accent-text"}`,children:n.jsx(_P,{className:"h-4 w-4"})}),$&&n.jsx(we,{title:e.collapsedHandles?L("node.action.showOutputs"):L("node.action.hideOutputs"),onClick:ee=>{ee.stopPropagation(),$(e.id)},className:`p-1 rounded hover:bg-gray-600 transition-colors border ${e.collapsedHandles?"border-accent text-accent-text":"border-transparent text-gray-400 hover:text-white"}`,children:e.collapsedHandles?n.jsx(Tl,{className:"h-4 w-4"}):n.jsx(Il,{className:"h-4 w-4"})})]}),!K&&n.jsxs("div",{className:"relative flex items-center group/help-tooltip",children:[n.jsx("button",{onMouseDown:ee=>ee.stopPropagation(),className:"p-1 text-gray-400 rounded hover:bg-gray-600 hover:text-white transition-colors duration-150 focus:outline-none focus:ring-1 focus:ring-cyan-500","aria-label":L("node.action.help"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 bg-slate-700 text-slate-200 text-xs whitespace-normal w-64 rounded-lg shadow-xl z-50 opacity-0 pointer-events-none group-hover/help-tooltip:opacity-100 transition-opacity duration-200 ease-out",children:de[e.type]||L("node.action.help")})]}),!t&&!K&&n.jsx(we,{title:L("node.action.rename"),onClick:()=>d(e.id,e.title),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),!K&&e.type===q.PROMPT_SEQUENCE_EDITOR&&I&&B&&n.jsxs(n.Fragment,{children:[n.jsx(we,{title:L("catalog.saveTo"),onClick:()=>I(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2v15"})})}),n.jsx(we,{title:L("group.saveToDisk"),onClick:()=>B(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]}),!K&&e.type===q.SCRIPT_VIEWER&&B&&n.jsx(we,{title:L("group.saveToDisk"),onClick:()=>B(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),!K&&e.type===q.MEDIA_VIEWER&&M&&n.jsx(we,{title:L("group.saveToDisk"),onClick:()=>M(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),!K&&(e.type===q.IMAGE_OUTPUT||e.type===q.VIDEO_OUTPUT||e.type===q.IMAGE_INPUT||e.type===q.GEMINI_CHAT)&&(se||e.type===q.GEMINI_CHAT)&&n.jsx(we,{title:L("node.action.download"),onClick:()=>x(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),!K&&(e.type===q.IMAGE_INPUT||e.type===q.IMAGE_OUTPUT||e.type===q.DATA_READER)&&se&&n.jsx(we,{title:L("node.action.clear"),onClick:re,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),!K&&e.type===q.IMAGE_ANALYZER&&se&&n.jsx(we,{title:L("node.action.clear"),onClick:re,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),!K&&e.type===q.IMAGE_EDITOR&&n.jsx(we,{title:L("node.action.clear"),onClick:()=>f(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),!K&&e.type===q.GEMINI_CHAT&&n.jsx(we,{title:L("node.action.refreshChat"),onClick:()=>h(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-4 w-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),!K&&(e.type===q.PROMPT_ANALYZER||e.type===q.CHARACTER_ANALYZER||e.type===q.CHARACTER_GENERATOR)&&n.jsx(we,{title:L("node.action.clear"),onClick:re,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),!K&&(e.type===q.IMAGE_SEQUENCE_GENERATOR||e.type===q.PROMPT_SEQUENCE_EDITOR)&&n.jsx(we,{title:L("node.action.clear"),onClick:()=>{if(e.type===q.IMAGE_SEQUENCE_GENERATOR)try{const ae={...JSON.parse(e.value||"{}"),prompts:[],images:{},frameStatuses:{},checkedFrameNumbers:[],selectedFrameNumber:null,usedCharacters:[]};v(e.id,JSON.stringify(ae)),N(e.id),_(L("toast.contentCleared"))}catch{re(null)}else re(null)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),!K&&(e.type===q.IMAGE_INPUT||e.type===q.IMAGE_ANALYZER||e.type===q.IMAGE_EDITOR)&&n.jsxs(n.Fragment,{children:[" ",n.jsx(we,{title:L("node.action.paste"),onClick:()=>b(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2M9 14l2 2 4-4"})})})," "]}),!K&&e.type===q.CHARACTER_CARD&&n.jsxs(n.Fragment,{children:[n.jsx(we,{title:L("node.action.addCard"),onClick:U,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),G&&V&&n.jsxs(n.Fragment,{children:[n.jsx(we,{title:L("node.action.paste"),onClick:()=>k(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2M9 14l2 2 4-4"})})}),n.jsx(we,{title:L("node.action.copy"),onClick:()=>w(e.id),children:n.jsx(zt,{className:"h-4 w-4"})}),n.jsx(we,{title:L("node.action.clear"),onClick:re,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),!K&&(e.type===q.TEXT_INPUT||e.type===q.NOTE||e.type===q.SCRIPT_GENERATOR||e.type===q.SCRIPT_VIEWER||e.type===q.MEDIA_VIEWER)&&n.jsxs(n.Fragment,{children:[" ",n.jsx(we,{title:L("node.action.clear"),onClick:re,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),n.jsxs(we,{title:L("node.action.paste"),onClick:()=>k(e.id),children:[" ",n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2M9 14l2 2 4-4"})})]})," "]}),!K&&e.type!==q.IMAGE_EDITOR&&e.type!==q.CHARACTER_CARD&&n.jsx(we,{title:L("node.action.copy"),onClick:()=>w(e.id),children:n.jsx(zt,{className:"h-4 w-4"})}),!t&&!K&&n.jsx(we,{title:L("toolbar.duplicateWithContent"),onClick:()=>m(e.id),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("rect",{x:"5",y:"5",width:"14",height:"14",rx:"2",ry:"2"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m-3-3h6"})]})}),!t&&!K&&n.jsx(we,{title:L("toolbar.duplicate"),onClick:()=>p(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("rect",{x:"5",y:"5",width:"14",height:"14",rx:"2",ry:"2"})})}),!K&&e.type!==q.NOTE&&!t&&n.jsx(we,{title:L("node.action.cutConnections"),onClick:ee=>{ee.stopPropagation(),u(e.id)},children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121M12 12L4.5 4.5"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5l.707-.707M19.5 4.5l-.707.707"})]})}),!t&&!K&&n.jsx(we,{title:L(A?"node.action.closeNodeSimple":"node.action.closeNode"),onClick:S,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),!K&&(t||Y)&&j&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"w-px h-3 bg-gray-500 mx-1"}),!Y&&n.jsxs(n.Fragment,{children:[!oe&&n.jsx(mt,{content:"Cycle Horizontal Left",children:n.jsx("button",{onClick:ee=>{ee.stopPropagation(),J(-1)},className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("path",{d:"M15 18l-6-6 6-6"})})})}),!oe&&n.jsx(mt,{content:"Cycle Vertical Left (TL/BL)",children:n.jsx("button",{onClick:ee=>{ee.stopPropagation(),H("left")},className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M7 15l5 5 5-5"}),n.jsx("path",{d:"M7 9l5-5 5 5"})]})})}),n.jsx(mt,{content:L("toolbar.dock.left"),children:n.jsx("button",{onClick:ee=>{ee.stopPropagation(),D&&D(e.id,"left")},className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsx(Cy,{})})}),n.jsx(mt,{content:L("toolbar.dock.right"),children:n.jsx("button",{onClick:ee=>{ee.stopPropagation(),D&&D(e.id,"right")},className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsx(ky,{})})}),!oe&&n.jsx(mt,{content:"Cycle Vertical Right (TR/BR)",children:n.jsx("button",{onClick:ee=>{ee.stopPropagation(),H("right")},className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M7 15l5 5 5-5"}),n.jsx("path",{d:"M7 9l5-5 5 5"})]})})}),!oe&&n.jsx(mt,{content:"Cycle Horizontal Right",children:n.jsx("button",{onClick:ee=>{ee.stopPropagation(),J(1)},className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("path",{d:"M9 18l6-6-6-6"})})})})]}),Y?n.jsx(mt,{content:L("toolbar.dock.exitFull"),children:n.jsx("button",{onClick:ee=>{ee.stopPropagation(),T==null||T(null)},className:"text-cyan-400 hover:text-white transition-colors p-1",children:n.jsx(Zp,{})})}):n.jsx(mt,{content:L("toolbar.dock.fullFocus"),children:n.jsx("button",{onClick:R,className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsx(Xp,{})})}),n.jsx(mt,{content:L("toolbar.detach"),children:n.jsx("button",{onClick:ee=>{ee.stopPropagation(),Y&&(T==null||T(null)),j(e.id)},className:"text-gray-400 hover:text-white transition-colors ml-1 p-1",children:n.jsx(by,{})})})]})]})]})})},TP=({text:e})=>n.jsx("div",{className:"absolute z-50 px-2 py-1 text-sm transition-opacity duration-200 ease-out opacity-0 pointer-events-none left-full ml-3 top-1/2 -translate-y-1/2 bg-slate-700 text-slate-200 whitespace-nowrap rounded-md shadow-xl group-hover/handle:opacity-100",children:e}),AP=({text:e})=>n.jsx("div",{className:"absolute z-50 px-2 py-1 text-sm transition-opacity duration-200 ease-out opacity-0 pointer-events-none right-full mr-3 top-1/2 -translate-y-1/2 bg-slate-700 text-slate-200 whitespace-nowrap rounded-md shadow-xl group-hover/handle:opacity-100",children:e}),c0=({node:e,getHandleColor:t,handleCursor:o,isCollapsed:r,isProxy:a,connectedInputType:i})=>{const s=At.useMemo(()=>{if(e.type===q.IMAGE_EDITOR)try{return JSON.parse(e.value||"{}")}catch{return{}}return{}},[e.value,e.type]),l=At.useMemo(()=>e.type===q.IMAGE_EDITOR?s.isSequenceMode&&(s.isSequentialCombinationMode||s.isSequentialEditingWithPrompts):!1,[e.type,s]),c=At.useMemo(()=>e.type===q.IMAGE_EDITOR?s.isSequenceMode&&s.isSequentialEditingWithPrompts:!1,[e.type,s]),d=e.type===q.REROUTE_DOT,p=At.useMemo(()=>{if(!d)return!1;try{return JSON.parse(e.value||"{}").direction==="RL"}catch{return!1}},[d,e.value])?{right:"-10px",left:"auto"}:{left:"-10px"},m=x=>e.type===q.DATA_READER&&i?i:x,w=(x,f,h)=>n.jsx("div",{style:{top:f,cursor:o,...p},className:`absolute w-5 h-5 rounded-full border-2 border-gray-900 transform -translate-y-1/2 ${t(m(x.type),x.handleId)} group/handle transition-[transform,border-color,background-color] duration-200 hover:scale-125 hover:border-white hover:z-20`,"data-is-input-handle":"true","data-node-id":e.id,"data-handle-id":x.handleId||"","data-handle-type":x.type||"",children:n.jsx(TP,{text:x.title})},h);if(a){let x=[];if(e.type===q.IMAGE_EDITOR)c||x.push({handleId:"image",type:"image",title:"Image"}),l&&x.push({handleId:"image_b",type:"image",title:"Image B"}),x.push({handleId:"text",type:"text",title:"Text"});else if(e.type===q.IMAGE_SEQUENCE_GENERATOR)x=[{handleId:"character_data",type:"character_data",title:"Character Data Input"},{handleId:"prompt_input",type:"text",title:"Text"}];else if(e.type===q.PROMPT_SEQUENCE_EDITOR)x=[{handleId:"prompts_sequence",type:"text",title:"Prompts Sequence Input"}];else if(e.type===q.NOTE)x=[{handleId:"prompt_data",type:"text",title:"Prompt Input"}];else if(e.type===q.VIDEO_EDITOR)x=[{handleId:"video",type:"video",title:"Video"},{handleId:"audio",type:"audio",title:"Audio"},{handleId:"image",type:"image",title:"Image"},{handleId:"text",type:"text",title:"Text"}];else if(e.type===q.CHARACTER_CARD)x=[{handleId:void 0,type:"text",title:"Input"}];else{const f=Ws(e,void 0);(f!==null||e.type===q.REROUTE_DOT||e.type===q.DATA_READER)&&(x=[{handleId:void 0,type:f,title:"Input"}])}return x.length===0?null:n.jsxs(n.Fragment,{children:[" ",x.map((f,h)=>{const v=48/(x.length+1);return w(f,`${(h+1)*v}px`,f.handleId||`proxy-in-${h}`)})," "]})}if(r){let x=[];if(e.type===q.IMAGE_EDITOR)c||x.push({handleId:"image",type:"image",title:"Image Input A"}),l&&x.push({handleId:"image_b",type:"image",title:"Image Input B"}),x.push({handleId:"text",type:"text",title:"Text Input"});else if(e.type===q.IMAGE_SEQUENCE_GENERATOR)x=[{handleId:"character_data",type:"character_data",title:"Character Data Input"},{handleId:"prompt_input",type:"text",title:"Prompts JSON Input"}];else if(e.type===q.NOTE){try{if(JSON.parse(e.value||"{}").activeTab==="note")return null}catch{}x=[{handleId:"prompt_data",type:"text",title:"Prompt Data Input"}]}else if(e.type===q.PROMPT_SEQUENCE_EDITOR)x=[{handleId:"prompts_sequence",type:"text",title:"Prompts Sequence Input"}];else if(e.type===q.VIDEO_EDITOR)x=[{handleId:"video",type:"video",title:"Video Input"},{handleId:"audio",type:"audio",title:"Audio Input"},{handleId:"image",type:"image",title:"Image Input"},{handleId:"text",type:"text",title:"Text Input"}];else{const f=Ws(e,void 0);(f!==null||e.type===q.REROUTE_DOT||e.type===q.DATA_READER)&&(x=[{handleId:void 0,type:f,title:"Input"}])}return x.length===0?null:n.jsxs(n.Fragment,{children:[" ",x.map((f,h)=>w(f,`${(h+1)*(In/(x.length+1))}px`,f.handleId||`input-${h}`))," "]})}if(e.type===q.IMAGE_EDITOR){let x=330;s.topPaneHeight&&(x=s.topPaneHeight);const f=Ft+Jt;let h,v;l?(h=f+x*.25,v=f+x*.75):h=f+x*.5,c&&(v=f+x*.5);const _=f+x+16,I=e.height-Jt-_,B=_+I/2;return n.jsxs(n.Fragment,{children:[!c&&w({type:"image",handleId:"image",title:l?"Image Input A":"Image Input"},`${h}px`,"image"),(l||c)&&v&&w({type:"image",handleId:"image_b",title:"Image Input B"},`${v}px`,"image_b"),w({type:"text",handleId:"text",title:"Text Input"},`${B}px`,"text")]})}if(e.type===q.VIDEO_EDITOR){const x=Ft+20,f=50;return n.jsxs(n.Fragment,{children:[w({type:"video",handleId:"video",title:"Video Input"},`${x}px`,"video"),w({type:"audio",handleId:"audio",title:"Audio Input"},`${x+f}px`,"audio"),w({type:"image",handleId:"image",title:"Image Input"},`${x+f*2}px`,"image"),w({type:"text",handleId:"text",title:"Text Input"},`${x+f*3}px`,"text")]})}if(e.type===q.IMAGE_SEQUENCE_GENERATOR){let x="normal";try{const I=JSON.parse(e.value||"{}");I.conceptsMode&&(x=I.conceptsMode)}catch{}let f=390;x==="collapsed"?f=37:x==="expanded"&&(f=e.height-Ft-Jt);const h=Ft+Jt,v=h+f/2,_=h+f+8,E=_+(e.height-_-Jt)/2;return n.jsxs(n.Fragment,{children:[w({type:"character_data",handleId:"character_data",title:"Character Data Input"},`${v}px`,"character_data"),x!=="expanded"&&w({type:"text",handleId:"prompt_input",title:"Prompts JSON Input"},`${E}px`,"prompt_input")]})}if(e.type===q.NOTE){try{if(JSON.parse(e.value||"{}").activeTab==="note")return null}catch{}const x=80+(e.height-80)/2;return w({type:"text",handleId:"prompt_data",title:"Prompt Data Input"},`${x}px`,"prompt_data")}if(e.type===q.PROMPT_SEQUENCE_EDITOR)return w({type:"text",handleId:"prompts_sequence",title:"Prompts Sequence Input"},"50%","prompts_sequence");const k=Ws(e,void 0);if(k===null)return e.type===q.REROUTE_DOT||e.type===q.DATA_READER?w({type:null,handleId:void 0,title:"Any Input"},"50%","any"):null;let b="Input";return k==="image"?b="Image Input":k==="character_data"?b="Character Data Input":k==="text"?b="Text Input":k==="video"?b="Video Input":k==="audio"&&(b="Audio Input"),w({type:k,handleId:void 0,title:b},"50%","default")},d0=({node:e,getHandleColor:t,handleCursor:o,onOutputHandleMouseDown:r,onOutputHandleTouchStart:a,t:i,isCollapsed:s,isProxy:l})=>{const c=(x,f)=>{x.stopPropagation(),r&&r(x,e.id,f)},d=(x,f)=>{x.stopPropagation(),a&&a(x,e.id,f)},u=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{}}},[e.value]),p=e.type===q.REROUTE_DOT,w=At.useMemo(()=>{if(!p)return!1;try{return JSON.parse(e.value||"{}").direction==="RL"}catch{return!1}},[p,e.value])?{left:"-10px",right:"auto"}:{right:"-10px"},k=(x,f,h)=>n.jsx("div",{onMouseDown:v=>c(v,x.handleId),onTouchStart:v=>d(v,x.handleId),style:{top:f,cursor:o,...w},className:`absolute w-5 h-5 rounded-full border-2 border-gray-900 transform -translate-y-1/2 ${t(x.type,x.handleId)} group/handle transition-[transform,border-color,background-color] duration-200 hover:scale-125 hover:border-white hover:z-20`,children:n.jsx(AP,{text:x.title})},h);if(l){let x=[];const f=Xn(e,void 0);return e.type===q.IMAGE_EDITOR?x=[{handleId:void 0,type:"image",title:"Output"}]:e.type===q.CHARACTER_GENERATOR?x=[{handleId:"character-0",type:"character_data",title:"Characters"}]:e.type===q.NOTE?x=[{handleId:"all_images",type:"image",title:"Images"},{handleId:"all_captions",type:"text",title:"Captions"}]:e.type===q.PROMPT_SEQUENCE_EDITOR?x=[{handleId:"all_data",type:"text",title:"All Data"}]:e.type===q.CHARACTER_CARD?x=[{handleId:"all_data",type:"character_data",title:"All Data"}]:(f!==null||e.type===q.REROUTE_DOT)&&(x=[{handleId:void 0,type:f,title:"Output"}]),x.length===0?null:n.jsxs(n.Fragment,{children:[" ",x.map((h,v)=>{const N=48/(x.length+1);return k(h,`${(v+1)*N}px`,h.handleId||`proxy-out-${v}`)})," "]})}if(s){let x=[];if(e.type===q.PROMPT_ANALYZER){const{characters:f=[]}=u;x=["environment",...f.map((v,N)=>`character-${N}`),"action","emotion","style"].map(v=>({handleId:v,type:"text",title:v.startsWith("character-")?`${i("node.content.character")} ${parseInt(v.split("-")[1],10)+1}`:i(`node.content.${v}`)}))}else if(e.type===q.PROMPT_SEQUENCE_EDITOR)x=[{handleId:"all_data",type:"text",title:i("node.output.allPromptData")}];else if(e.type===q.CHARACTER_ANALYZER)x=[{handleId:"character",type:"text",title:i("node.content.character")},{handleId:"clothing",type:"text",title:i("node.content.clothing")}];else if(e.type===q.IMAGE_INPUT||e.type===q.IMAGE_ANALYZER)x=[{handleId:"image",type:"image",title:"Image Output"},{handleId:"text",type:"text",title:"Text Output"}];else if(e.type===q.SCRIPT_GENERATOR){const{summary:f,detailedCharacters:h=[],scenes:v=[]}=u,N=h.map((E,I)=>({handleId:`character-${I}`,type:"text",title:`Character ${I+1}`})),_=v.map((E,I)=>({handleId:`scene-${I}`,type:"text",title:`Scene ${I+1}`}));x=f?[{handleId:"summary",type:"text",title:"Summary"},...N,..._]:[...N,..._]}else if(e.type===q.SCRIPT_VIEWER){const f=u.type;x=[{handleId:"full-json",type:"text",title:"Full Data JSON"}],f==="script-analyzer-data"&&x.push({handleId:"all-image-prompts",type:"text",title:"All Image Prompts"},{handleId:"all-video-prompts",type:"text",title:"All Video Prompts"})}else if(e.type===q.CHARACTER_GENERATOR){const{characters:f=[]}=u;x=f.map((h,v)=>({handleId:`character-${v}`,type:"text",title:h.name||`Character ${v+1}`}))}else if(e.type===q.CHARACTER_CARD){const f=[{handleId:"all_data",type:"character_data",title:"All Characters Data"},{handleId:"primary_data",type:"character_data",title:"Primary Character Data"}],h=[{handleId:"image",type:"image",title:"Image (primary)"},{handleId:"prompt",type:"text",title:"Prompt (primary)"},{handleId:"appearance",type:"text",title:`${i("node.content.appearance")} (primary)`},{handleId:"personality",type:"text",title:`${i("node.content.personality")} (primary)`},{handleId:"clothing",type:"text",title:`${i("node.content.clothing")} (primary)`}];e.collapsedHandles?x=f:x=[...f,...h]}else if(e.type===q.IMAGE_SEQUENCE_GENERATOR)x=[{handleId:"all_images",type:"image",title:"All Images"}];else if(e.type===q.NOTE){try{if(JSON.parse(e.value||"{}").activeTab==="note")return null}catch{}x=[{handleId:"all_images",type:"image",title:"All Images"},{handleId:"all_captions",type:"text",title:"All Captions"}]}else{const f=Xn(e,void 0);if(f!==null||e.type===q.REROUTE_DOT){const h=e.type===q.REROUTE_DOT?"Any Output":f==="image"?"Image Output":f==="character_data"?"Character Data Output":f==="video"?"Video Output":f==="audio"?"Audio Output":"Text Output";x=[{handleId:void 0,type:f,title:h}]}}return x.length===0?null:n.jsxs(n.Fragment,{children:[" ",x.map((f,h)=>k(f,`${(h+1)*(In/(x.length+1))}px`,f.handleId||`output-${h}`))," "]})}if(e.type===q.NOTE){try{if(JSON.parse(e.value||"{}").activeTab==="note")return null}catch{}const x=e.height-80,f=80+x*.33,h=80+x*.66;return n.jsxs(n.Fragment,{children:[k({type:"image",handleId:"all_images",title:"All Images"},`${f}px`,"all_images"),k({type:"text",handleId:"all_captions",title:"All Captions"},`${h}px`,"all_captions")]})}if(e.type===q.PROMPT_ANALYZER)return null;if(e.type===q.SCRIPT_VIEWER){const x=u.type,f=[{handleId:"full-json",type:"text",title:"Full Data JSON"}];x==="script-analyzer-data"&&f.push({handleId:"all-image-prompts",type:"text",title:"All Image Prompts"},{handleId:"all-video-prompts",type:"text",title:"All Video Prompts"});const h=e.height/(f.length+1);return n.jsxs(n.Fragment,{children:[" ",f.map((v,N)=>k(v,`${(N+1)*h}px`,v.handleId))," "]})}if(e.type===q.PROMPT_SEQUENCE_EDITOR)return k({type:"text",handleId:"all_data",title:i("node.output.allPromptData")},"50%","all_data");if(e.type===q.IMAGE_SEQUENCE_GENERATOR)return k({type:"image",handleId:"all_images",title:"All Images"},"50%","all_images");if(e.type===q.CHARACTER_GENERATOR){const{characters:x=[]}=u;if(x.length===0)return null;const f=e.height-Ft-2*Jt,h=180,v=f-h;return n.jsxs(n.Fragment,{children:[" ",x.map((N,_)=>{const E=v/(x.length+1),I=Ft+Jt+h+E*(_+1);return k({type:"character_data",handleId:`character-${_}`,title:N.name||`Character ${_+1}`},`${I}px`,`character-${_}`)})," "]})}if(e.type===q.SCRIPT_GENERATOR){const{summary:x,detailedCharacters:f=[],scenes:h=[]}=u,v=[];x&&v.push({id:"summary",title:"Summary"}),f.forEach((_,E)=>v.push({id:`character-${E}`,title:`Character ${E+1}`})),h.forEach((_,E)=>v.push({id:`scene-${E}`,title:`Scene ${E+1}`}));const N=e.height-Ft-2*Jt;return n.jsxs(n.Fragment,{children:[" ",v.map((_,E)=>{const I=Ft+Jt+N/(v.length+1)*(E+1);return k({type:"text",handleId:_.id,title:_.title},`${I}px`,_.id)})," "]})}if(e.type===q.CHARACTER_ANALYZER){const x=["character","clothing"],N=Ft+Jt,E=e.height-Jt-40-8-N;return n.jsxs(n.Fragment,{children:[" ",x.map((I,B)=>{const M=N+E/2*(B+.5),G=i(`node.content.${I}`);return k({type:"text",handleId:I,title:G},`${M}px`,I)})," "]})}if(e.type===q.IMAGE_INPUT){const x=e.height-Ft-2*Jt,f=Math.max(0,x),h=Ft+Jt+f/4,v=e.height-80;return n.jsxs(n.Fragment,{children:[k({type:"image",handleId:"image",title:"Image Output"},`${h}px`,"image"),k({type:"text",handleId:"text",title:"Text Output"},`${v}px`,"text")]})}if(e.type===q.IMAGE_ANALYZER){const x=e.height-Ft-2*Jt,f=8,h=(x-f)/2,v=Ft+Jt,N=v+h/2,_=v+h+f+h/2;return n.jsxs(n.Fragment,{children:[k({type:"image",handleId:"image",title:"Image Output"},`${N}px`,"image"),k({type:"text",handleId:"text",title:"Text Output"},`${_}px`,"text")]})}if(e.type===q.CHARACTER_CARD)try{const x=[{handleId:"all_data",type:"character_data",title:"All Characters Data"},{handleId:"primary_data",type:"character_data",title:"Primary Character Data"}];if(e.collapsedHandles){const E=(e.height-Ft-20)/(x.length+1);return n.jsx(n.Fragment,{children:x.map((I,B)=>k(I,`${Ft+E*(B+1)}px`,I.handleId||`output-${B}`))})}const f=[{handleId:"image",type:"image",title:"Image (primary)"},{handleId:"prompt",type:"text",title:"Prompt (primary)"},{handleId:"appearance",type:"text",title:`${i("node.content.appearance")} (primary)`},{handleId:"personality",type:"text",title:`${i("node.content.personality")} (primary)`},{handleId:"clothing",type:"text",title:`${i("node.content.clothing")} (primary)`}],h=[...x,...f],N=(e.height-Ft-20)/(h.length+1);return n.jsx(n.Fragment,{children:h.map((_,E)=>k(_,`${Ft+N*(E+1)}px`,_.handleId||`output-${E}`))})}catch{return null}const b=Xn(e,void 0);if(b!==null||e.type===q.REROUTE_DOT){const x=e.type===q.REROUTE_DOT?"Any Output":b==="image"?"Image Output":b==="character_data"?"Character Data Output":b==="video"?"Video Output":b==="audio"?"Audio Output":"Text Output";return k({type:b,handleId:void 0,title:x},"50%","default")}return null},oh=({libraryItems:e,onPromptInsert:t})=>{const{t:o}=Pt(),[r,a]=y.useState(!1),[i,s]=y.useState(!1),[l,c]=y.useState(null),d=y.useRef(null),[u,p]=y.useState(null),m=v=>{v.stopPropagation(),r?k():w()},w=()=>{if(d.current){const v=d.current.getBoundingClientRect(),N=window.innerHeight-v.bottom,_=280;let E=v.bottom+4;N<_&&(E=v.top-_-4),p({top:E,left:v.left,width:Math.max(v.width,256)}),a(!0)}},k=()=>{s(!0),setTimeout(()=>{a(!1),s(!1),c(null)},200)};y.useEffect(()=>{if(!r)return;const v=N=>{const _=N.target,E=document.getElementById("prompt-library-portal-menu");d.current&&!d.current.contains(_)&&E&&!E.contains(_)&&k()};return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[r]),y.useEffect(()=>{if(!r)return;const v=()=>k();return window.addEventListener("scroll",v,!0),window.addEventListener("resize",v),()=>{window.removeEventListener("scroll",v,!0),window.removeEventListener("resize",v)}},[r]);const b=v=>{t(v),k()},x=v=>{if(v.stopPropagation(),l){const N=e.find(_=>_.id===l);c((N==null?void 0:N.parentId)||null)}},f=y.useMemo(()=>e.filter(v=>v.parentId===l).sort((v,N)=>v.type===N.type?v.name.localeCompare(N.name):v.type===$t.FOLDER?-1:1),[e,l]),h=y.useMemo(()=>{var v;return l&&((v=e.find(N=>N.id===l))==null?void 0:v.name)||o("catalog.tabs.library")},[l,e,o]);return n.jsxs("div",{ref:d,className:"relative w-full",children:[n.jsxs("button",{onClick:m,title:o("catalog.tabs.library"),className:`w-full p-1.5 rounded transition-colors flex items-center justify-start space-x-2 ${r?"bg-accent":"bg-gray-700 hover:bg-gray-600"}`,children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 flex-shrink-0 ${r?"text-white":"text-accent-text"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),n.jsx("span",{className:`text-xs font-semibold truncate ${r?"text-white":"text-gray-200"}`,children:o("catalog.tabs.library")}),n.jsx("div",{className:"flex-grow"}),n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 ${r?"text-white":"text-gray-400"} transition-transform duration-200 ${r?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),r&&u&&Va.createPortal(n.jsxs("div",{id:"prompt-library-portal-menu",className:`fixed bg-gray-800 rounded-lg shadow-xl border border-gray-600 z-[9999] flex flex-col overflow-hidden transition-all duration-200 ease-out origin-top ${i?"opacity-0 scale-95":"opacity-100 scale-100"}`,style:{top:u.top,left:u.left,width:u.width,maxHeight:"280px"},onWheel:v=>v.stopPropagation(),children:[n.jsxs("div",{className:`flex items-center p-2 border-b border-gray-700 bg-gray-900/50 transition-colors select-none ${l?"cursor-pointer hover:bg-gray-700":""}`,onClick:l?x:void 0,children:[l?n.jsx("div",{className:"mr-2 p-1 text-accent-text flex-shrink-0",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}):n.jsx("div",{className:"mr-2 p-1 text-gray-500 flex-shrink-0",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h7"})})}),n.jsx("span",{className:"text-sm font-bold text-gray-200 truncate",children:h})]}),n.jsx("div",{className:"overflow-y-auto p-1 custom-scrollbar flex-grow",children:f.length===0?n.jsx("div",{className:"p-4 text-center text-xs text-gray-500",children:o("library.empty.description")}):n.jsx("ul",{className:"space-y-0.5",children:f.map(v=>n.jsx("li",{children:v.type===$t.FOLDER?n.jsxs("button",{onClick:N=>{N.stopPropagation(),c(v.id)},className:"w-full flex items-center justify-between p-2 rounded hover:bg-gray-700 text-left group transition-colors",children:[n.jsxs("div",{className:"flex items-center space-x-2 min-w-0",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-accent-text flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),n.jsx("span",{className:"text-sm text-gray-200 truncate group-hover:text-white",children:v.name})]}),n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-gray-500 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]}):n.jsxs("button",{onClick:N=>{N.stopPropagation(),b(v.content||"")},className:"w-full flex items-center space-x-2 p-2 rounded hover:bg-gray-700 text-left group transition-colors",title:v.content,children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-accent flex-shrink-0 opacity-70 group-hover:opacity-100",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),n.jsx("span",{className:"text-sm text-gray-300 truncate group-hover:text-white",children:v.name})]})},v.id))})})]}),document.body)]})},Cn=({value:e,onDebouncedChange:t,debounceTime:o=300,onChange:r,onPaste:a,...i})=>{const[s,l]=y.useState(e),c=y.useRef(null),d=y.useRef(!1);y.useEffect(()=>{!d.current&&e!==s&&l(e)},[e]);const u=w=>{const k=w.target.value;l(k),d.current=!0,c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{t(k),d.current=!1},o),r&&r(w)},p=w=>{c.current&&(clearTimeout(c.current),t(s),d.current=!1),i.onBlur&&i.onBlur(w)},m=w=>{const k=window.scrollX,b=window.scrollY,x=document.getElementById("app-container"),f=x?x.scrollLeft:0,h=x?x.scrollTop:0;requestAnimationFrame(()=>{window.scrollTo(k,b),x&&x.scrollTo(f,h)}),a&&a(w)};return n.jsx("textarea",{...i,value:s,onChange:u,onBlur:p,onPaste:m})},u0=({color:e,selected:t,onClick:o})=>n.jsx("button",{onClick:r=>{r.stopPropagation(),o()},className:`w-4 h-4 rounded-full border border-gray-600 transition-transform ${t?"scale-125 ring-2 ring-white border-transparent":"hover:scale-110"}`,style:{backgroundColor:e}}),RP=({text:e,style:t,onTextChange:o,onStyleChange:r,libraryItems:a,t:i,deselectAllNodes:s,isMinimal:l})=>{const c=["#ffffff","#9ca3af","#ef4444","#f97316","#facc15","#22d3ee","#3b82f6","#a855f7","#10b981"];return n.jsxs("div",{className:"flex flex-col h-full",children:[!l&&n.jsxs("div",{className:"flex-shrink-0 flex flex-col gap-1 mb-1",children:[n.jsx(oh,{libraryItems:a,onPromptInsert:d=>{const u=e?`${e}
${d}`:d;o(u)}}),n.jsxs("div",{className:"flex items-center justify-between bg-gray-800/80 p-1.5 rounded-md border border-gray-700/50",children:[n.jsxs("div",{className:"flex items-center gap-1 bg-gray-900 rounded p-0.5",children:[n.jsx("button",{onClick:d=>{d.stopPropagation(),r({fontSize:Math.max(10,t.fontSize-2)})},className:"w-5 h-5 flex items-center justify-center text-gray-400 hover:text-white bg-gray-800 rounded hover:bg-gray-700 transition-colors text-xs",children:"-"}),n.jsx("span",{className:"text-[10px] w-5 text-center text-gray-300 font-mono select-none",children:t.fontSize}),n.jsx("button",{onClick:d=>{d.stopPropagation(),r({fontSize:Math.min(72,t.fontSize+2)})},className:"w-5 h-5 flex items-center justify-center text-gray-400 hover:text-white bg-gray-800 rounded hover:bg-gray-700 transition-colors text-xs",children:"+"})]}),n.jsx("div",{className:"w-px h-4 bg-gray-700 mx-1"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{onClick:d=>{d.stopPropagation(),r({isBold:!t.isBold})},className:`w-5 h-5 flex items-center justify-center rounded text-xs font-serif font-bold transition-colors ${t.isBold?"bg-gray-200 text-black":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:"B"}),n.jsx("button",{onClick:d=>{d.stopPropagation(),r({isItalic:!t.isItalic})},className:`w-5 h-5 flex items-center justify-center rounded text-xs font-serif italic transition-colors ${t.isItalic?"bg-gray-200 text-black":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:"I"})]}),n.jsx("div",{className:"w-px h-4 bg-gray-700 mx-1"}),n.jsxs("div",{className:"flex items-center gap-0.5",children:[n.jsx("button",{onClick:d=>{d.stopPropagation(),r({textAlign:"left"})},className:`p-1 rounded ${t.textAlign==="left"?"text-white bg-gray-700":"text-gray-500 hover:text-gray-300"}`,children:n.jsx(yy,{})}),n.jsx("button",{onClick:d=>{d.stopPropagation(),r({textAlign:"center"})},className:`p-1 rounded ${t.textAlign==="center"?"text-white bg-gray-700":"text-gray-500 hover:text-gray-300"}`,children:n.jsx(vy,{})}),n.jsx("button",{onClick:d=>{d.stopPropagation(),r({textAlign:"right"})},className:`p-1 rounded ${t.textAlign==="right"?"text-white bg-gray-700":"text-gray-500 hover:text-gray-300"}`,children:n.jsx(wy,{})})]}),n.jsx("div",{className:"w-px h-4 bg-gray-700 mx-1"}),n.jsxs("div",{className:"flex items-center gap-1",children:[c.slice(0,5).map(d=>n.jsx(u0,{color:d,selected:t.color===d,onClick:()=>r({color:d})},d)),c.slice(5).map(d=>n.jsx(u0,{color:d,selected:t.color===d,onClick:()=>r({color:d})},d))]})]})]}),n.jsx(Cn,{value:e,onDebouncedChange:o,placeholder:i("node.content.notePlaceholder"),className:"w-full h-full p-2 bg-transparent border-none rounded-md resize-none focus:ring-2 focus:ring-cyan-500 focus:outline-none leading-relaxed transition-all",style:{fontSize:`${t.fontSize}px`,color:t.color,fontWeight:t.isBold?"bold":"normal",fontStyle:t.isItalic?"italic":"normal",textAlign:t.textAlign},onWheel:d=>d.stopPropagation(),onMouseDown:d=>d.stopPropagation(),onFocus:s})]})},MP=({id:e,index:t,image:o,caption:r,manualOrderValue:a,isLocked:i,isDragging:s,isSelected:l,top:c,left:d,width:u,height:p,onSelect:m,onDragStart:w,onDragEnd:k,onDrop:b,onDragOver:x,onManualOrderChange:f,onManualOrderSubmit:h,onMove:v,onMoveToStart:N,onMoveToEnd:_,onRemove:E,onCaptionChange:I,onViewImage:B,onCopyImage:M,onImageDragStart:G,deselectAllNodes:V,isFirst:j,isLast:P,insertionIndex:S,t:A})=>n.jsxs("div",{style:{position:"absolute",top:c,left:d,width:`${u}px`,height:`${p}px`},onDragOver:O=>x(O,t),onDrop:O=>b(O,t),onClick:O=>{O.stopPropagation(),m(e)},className:`bg-gray-800 rounded-md overflow-visible border-2 group flex flex-col shadow-sm transition-colors ${s?"opacity-40 border-dashed border-cyan-500":l?"border-cyan-500":"border-gray-700 hover:border-gray-500"}`,children:[S===t&&!i&&n.jsx("div",{className:"absolute left-[-10px] top-0 bottom-0 w-1.5 bg-cyan-500 rounded z-50 pointer-events-none"}),n.jsxs("div",{draggable:!i,onDragStart:O=>w(O,t),onDragEnd:k,className:`h-7 bg-gray-900/80 border-b border-gray-700 flex items-center justify-between px-2 ${i?"cursor-default":"cursor-move hover:bg-gray-700/50"} transition-colors shrink-0 rounded-t-sm`,children:[n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx("span",{className:"text-xs text-gray-500 font-mono",children:"#"}),n.jsx("input",{type:"text",value:a,onChange:O=>f(e,O.target.value),onKeyDown:O=>{O.key==="Enter"&&h(e,t,a)},disabled:i,className:`w-8 bg-gray-900 border border-gray-600 rounded text-[10px] text-center text-gray-300 focus:border-cyan-500 focus:outline-none px-0.5 py-0.5 ${i?"opacity-50":""}`,onMouseDown:O=>O.stopPropagation(),onFocus:V}),!i&&n.jsx("button",{onClick:O=>{O.stopPropagation(),h(e,t,a)},className:"text-gray-500 hover:text-cyan-400 p-0.5 rounded transition-colors",title:"Apply Order",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]}),n.jsxs("div",{className:"flex items-center space-x-1",children:[o&&n.jsx("button",{onClick:O=>{O.stopPropagation(),M(o)},className:"text-gray-400 hover:text-white p-0.5 rounded transition-colors",title:A("node.action.copy"),children:n.jsx(zt,{className:"h-3 w-3"})}),!i&&n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:O=>{O.stopPropagation(),N()},disabled:j,className:"text-gray-500 hover:text-white disabled:opacity-30 p-0.5",title:"Move to Top",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),n.jsx("button",{onClick:O=>{O.stopPropagation(),v(t,"up")},disabled:j,className:"text-gray-500 hover:text-white disabled:opacity-30 p-0.5",title:"Move Up",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),n.jsx("button",{onClick:O=>{O.stopPropagation(),v(t,"down")},disabled:P,className:"text-gray-500 hover:text-white disabled:opacity-30 p-0.5",title:"Move Down",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),n.jsx("button",{onClick:O=>{O.stopPropagation(),_()},disabled:P,className:"text-gray-500 hover:text-white disabled:opacity-30 p-0.5",title:"Move to Bottom",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-700 mx-1"}),n.jsx("button",{onClick:O=>{O.stopPropagation(),E(e)},className:"text-gray-500 hover:text-red-400 p-0.5",title:A("node.action.delete"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})]}),n.jsx("div",{className:"h-[170px] bg-gray-900 relative cursor-pointer flex items-center justify-center shrink-0 border-b border-gray-700 overflow-hidden",onClick:()=>B(t),children:o?n.jsx("img",{src:o,alt:"Reference",draggable:!0,onDragStart:O=>{O.stopPropagation(),G(O,o)},className:"w-full h-full object-contain"}):n.jsx("span",{className:"text-xs text-gray-600",children:"No Image"})}),n.jsx("div",{className:"flex-grow p-1",children:n.jsx(Cn,{value:r,onDebouncedChange:O=>I(e,O),placeholder:A("node.note.addCaption"),className:`w-full h-full bg-transparent text-xs text-gray-300 border-none focus:ring-0 p-1 placeholder-gray-600 resize-none leading-tight focus:outline-none transition-colors ${i?"cursor-default opacity-80":""}`,onMouseDown:O=>O.stopPropagation(),onFocus:V,readOnly:i})})]}),bs=200,Yr=270,jr=8,Xr=8,LP=({references:e,isLocked:t,onAddImages:o,onReorder:r,onUpdateCaption:a,onRemoveReference:i,onDetach:s,onShuffle:l,onUndoShuffle:c,canUndoShuffle:d,t:u,deselectAllNodes:p,setImageViewer:m,addToast:w,getFullSizeImage:k,isMinimal:b})=>{const x=y.useRef(null),f=y.useRef(null),[h,v]=y.useState(0),[N,_]=y.useState(0),[E,I]=y.useState(!1),[B,M]=y.useState(!1),[G,V]=y.useState(null),[j,P]=y.useState(null),[S,A]=y.useState(null),[O,z]=y.useState({});y.useEffect(()=>{if(!x.current)return;const Z=new ResizeObserver(se=>{se[0]&&v(se[0].contentRect.width)});return Z.observe(x.current),()=>Z.disconnect()},[]);const L=y.useMemo(()=>{const Z=Math.max(0,h-Xr*2),se=Math.max(1,Math.floor((Z+jr)/(bs+jr))),de=e.length+(t?0:1),re=Math.ceil(de/se),R=re*Yr+Math.max(0,re-1)*jr+Xr*2;return{columns:se,totalHeight:R,totalItems:de}},[h,e.length,t]),W=y.useMemo(()=>{var ee;const{columns:Z,totalItems:se}=L,de=600,re=Math.max(0,N-de),R=N+(((ee=x.current)==null?void 0:ee.clientHeight)||600)+de,J=[],H=Math.floor((re-Xr)/(Yr+jr)),U=Math.ceil((R-Xr)/(Yr+jr));for(let ae=Math.max(0,H);ae<=U;ae++)for(let xe=0;xe<Z;xe++){const ne=ae*Z+xe;if(ne>=se)break;const X=Xr+ae*(Yr+jr),ue=Xr+xe*(bs+jr);J.push({index:ne,top:X,left:ue,isAddButton:!t&&ne===e.length})}return J},[L,N,e.length,t]),D=Z=>{Z.target.files&&Z.target.files.length>0&&o(Array.from(Z.target.files)),Z.target&&(Z.target.value="")},T=Z=>{if(Z.preventDefault(),Z.stopPropagation(),I(!1),M(!1),P(null),t)return;const se=Z.dataTransfer.getData("note-ref-index");if(se){const J=parseInt(se,10);isNaN(J)||r(J,e.length),V(null);return}const de=Z.dataTransfer.getData("application/prompt-modifier-drag-info");if(de)try{const{src:J,prompt:H}=JSON.parse(de);o([{image:J,caption:H||""}]);return}catch(J){console.error("Error parsing drag info",J)}const re=Z.dataTransfer.getData("application/prompt-modifier-drag-image");if(re){o([re]);return}const R=Array.from(Z.dataTransfer.files).filter(J=>J.type.startsWith("image/"));R.length>0&&o(R)},F=(Z,se)=>{if(Z.preventDefault(),Z.stopPropagation(),I(!1),M(!1),P(null),t)return;const de=Z.dataTransfer.getData("note-ref-index");if(de){const H=parseInt(de,10);isNaN(H)||r(H,se),V(null);return}const re=Z.dataTransfer.getData("application/prompt-modifier-drag-info");if(re)try{const{src:H,prompt:U}=JSON.parse(re);o([{image:H,caption:U||""}],se);return}catch(H){console.error("Error parsing drag info",H)}const R=Z.dataTransfer.getData("application/prompt-modifier-drag-image");if(R){o([R],se);return}const J=Array.from(Z.dataTransfer.files).filter(H=>H.type.startsWith("image/"));J.length>0&&o(J,se)},te=(Z,se)=>{t||(Z.stopPropagation(),V(se),Z.dataTransfer.setData("note-ref-index",se.toString()),Z.dataTransfer.effectAllowed="move")},$=Z=>{V(null),P(null),I(!1),M(!1)},Y=()=>{V(null),P(null),I(!1),M(!1),A(null)},oe=(Z,se,de)=>{if(!de||t)return;const re=parseInt(de,10);if(isNaN(re)||re<1||re===se+1)return;let R;re>e.length?R=e.length:(R=re-1,se<R&&(R=re)),r(se,R),z(J=>{const H={...J};return delete H[Z],H})},le=async Z=>{if(Z)try{const de=await(await fetch(Z)).blob();await navigator.clipboard.write([new ClipboardItem({[de.type]:de})]),w(u("toast.copiedToClipboard"))}catch{w(u("toast.copyFailed"),"error")}},K=Z=>{const se=e[Z];!se||!se.image||m({sources:e.filter(de=>de.image).map((de,re)=>({src:k(re)||de.image,frameNumber:0,prompt:de.caption})),initialIndex:Z})},ie=e.length===0;return n.jsxs("div",{className:"flex flex-col h-full",children:[!b&&n.jsxs("div",{className:"flex justify-between items-center px-2 py-1 bg-gray-900/30 mb-1 rounded flex-shrink-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:u("node.note.nestedImages")}),n.jsx("button",{onClick:Y,className:"p-0.5 rounded hover:bg-gray-700 text-gray-500 hover:text-white transition-colors",title:"Reset/Refresh State",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})}),t&&n.jsxs("div",{className:"flex items-center text-cyan-400 text-xs gap-1 bg-cyan-900/30 px-1.5 py-0.5 rounded border border-cyan-700/50",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),n.jsx("span",{className:"font-semibold",children:"Linked"}),n.jsx("button",{onClick:s,className:"ml-1 hover:text-white",title:"Detach and Keep Data",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]}),n.jsx("div",{className:"flex items-center space-x-2",children:!t&&!ie&&n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(we,{title:u("node.note.action.undoShuffle"),onClick:c,disabled:!d,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),n.jsx(we,{title:u("node.note.action.shuffle"),onClick:l,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})})]})})]}),n.jsx("div",{ref:x,className:`flex-grow w-full overflow-y-auto custom-scrollbar rounded-md transition-colors ${E?"bg-cyan-900/20 ring-2 ring-cyan-500 ring-inset":"bg-transparent"}`,onDragEnter:Z=>{Z.preventDefault(),Z.stopPropagation(),!t&&ie&&I(!0)},onDragOver:Z=>{Z.preventDefault(),Z.stopPropagation()},onDragLeave:Z=>{Z.preventDefault(),Z.stopPropagation(),I(!1),M(!1),P(null)},onDrop:T,onScroll:Z=>_(Z.currentTarget.scrollTop),onWheel:Z=>Z.stopPropagation(),children:ie&&!t?n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-500 cursor-pointer hover:text-gray-400 transition-colors p-4 text-center",onClick:()=>{var Z;return(Z=f.current)==null?void 0:Z.click()},children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 mb-2 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),n.jsx("p",{className:"text-sm font-medium",children:u("node.note.dropPlaceholder")}),n.jsx("input",{type:"file",ref:f,className:"hidden",onChange:D,multiple:!0,accept:"image/*"})]}):ie&&t?n.jsx("div",{className:"h-full flex flex-col items-center justify-center text-gray-500 p-4 text-center",children:n.jsx("span",{className:"text-sm italic",children:"Waiting for prompt data..."})}):n.jsx("div",{style:{height:L.totalHeight,position:"relative",width:"100%"},children:W.map(({index:Z,top:se,left:de,isAddButton:re})=>{if(re)return n.jsxs("div",{className:`absolute bg-gray-800/50 rounded-md border-2 border-dashed flex flex-col gap-2 items-center justify-center cursor-pointer transition-colors ${B?"border-cyan-500 text-cyan-500 bg-cyan-900/20":"border-gray-700 hover:border-cyan-500 hover:text-cyan-500 text-gray-500"}`,style:{width:`${bs}px`,height:`${Yr}px`,top:se,left:de},onClick:()=>{var J;return(J=f.current)==null?void 0:J.click()},onDragOver:J=>{J.preventDefault(),J.stopPropagation(),M(!0)},onDrop:T,children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),n.jsx("span",{className:"text-xs font-medium",children:"Add Images"}),n.jsx("input",{type:"file",ref:f,className:"hidden",onChange:D,multiple:!0,accept:"image/*"})]},"add-button");const R=e[Z];return R?n.jsx(MP,{id:R.id,index:Z,image:R.image,caption:R.caption,manualOrderValue:O[R.id]??(Z+1).toString(),isLocked:t,isDragging:G===Z,isSelected:S===R.id,top:se,left:de,width:bs,height:Yr,onSelect:A,onDragStart:te,onDragEnd:$,onDrop:F,onDragOver:(J,H)=>{t||(J.preventDefault(),J.stopPropagation(),P(H))},onManualOrderChange:(J,H)=>z(U=>({...U,[J]:H})),onManualOrderSubmit:oe,onMove:(J,H)=>{r(J,H==="up"?J-1:J+2)},onMoveToStart:()=>r(Z,0),onMoveToEnd:()=>r(Z,e.length),onRemove:i,onCaptionChange:a,onViewImage:K,onCopyImage:J=>le(k(Z)||J),onImageDragStart:(J,H)=>{const U=k(Z)||H;U&&(J.dataTransfer.setData("application/prompt-modifier-drag-image",U),J.dataTransfer.setData("application/prompt-modifier-drag-info",JSON.stringify({src:U,prompt:R.caption})),J.dataTransfer.effectAllowed="copy",J.stopPropagation())},deselectAllNodes:p,isFirst:Z===0,isLast:Z===e.length-1,insertionIndex:j,t:u},R.id):null})})})]})},ud={fontSize:14,color:"#ffffff",isBold:!1,isItalic:!1,textAlign:"left"},DP=({node:e,onValueChange:t,t:o,deselectAllNodes:r,libraryItems:a,setImageViewer:i,addToast:s,setFullSizeImage:l,getFullSizeImage:c,connectedInputs:d,getUpstreamNodeValues:u})=>{const{setConnections:p}=Kt(),m=d==null?void 0:d.has("prompt_data"),w=y.useMemo(()=>{try{const M=JSON.parse(e.value||"{}");return typeof M=="object"&&M!==null&&("text"in M||"references"in M)?{text:M.text||"",references:M.references||[],activeTab:M.activeTab||"note",isMinimal:M.isMinimal||!1,style:{...ud,...M.style||{}}}:{text:e.value||"",references:[],activeTab:"note",isMinimal:!1,style:ud}}catch{return{text:e.value||"",references:[],activeTab:"note",isMinimal:!1,style:ud}}},[e.value]),[k,b]=y.useState(null),x=y.useCallback(M=>{const G={...w,...M};t(e.id,JSON.stringify(G))},[w,e.id,t]),f=y.useCallback(M=>{const G={...w.style,...M};x({style:G})},[w.style,x]);y.useEffect(()=>{if(m){const G=u(e.id,"prompt_data")[0];if(typeof G=="string")try{const V=JSON.parse(G);if(V.type==="sequence-prompt-data"&&Array.isArray(V.sourcePrompts)){const j=V.sourcePrompts,P=[...w.references],S=[];let A=!1;const O=j.reduce((L,W)=>Math.max(L,W.frameNumber||0),0),z=new Map(j.map(L=>[L.frameNumber,L.prompt]));for(let L=0;L<O;L++){const W=L+1,D=z.get(W)||"",T=P[L];T?T.caption!==D?(S.push({...T,caption:D}),A=!0):S.push(T):(S.push({id:`ref-${Date.now()}-${L}`,image:null,caption:D}),A=!0)}P.length>O&&(A=!0),A&&x({references:S})}}catch(V){console.error("Failed to parse prompt data from sequence editor",V)}}},[m,u,e.id,x,w.references]);const h=()=>{p(M=>M.filter(G=>!(G.toNodeId===e.id&&G.toHandleId==="prompt_data"))),s&&s(o("toast.connectionsCut"))},v=async(M,G)=>{if(m)return;const V=async z=>typeof z=="object"&&"image"in z&&"caption"in z?z:typeof z=="string"?{image:z,caption:""}:new Promise(L=>{const W=new FileReader;W.onload=D=>{var T;return L({image:(T=D.target)==null?void 0:T.result,caption:""})},W.readAsDataURL(z)}),j=await Promise.all(M.map(V)),P=[...w.references],S=[];for(let z=0;z<j.length;z++){const{image:L,caption:W}=j[z],D=await Ot(L,256,256);S.push({id:`ref-${Date.now()}-${z}-${Math.random().toString(36).substr(2,9)}`,image:D,caption:W||""})}const A=G??P.length;P.splice(A,0,...S);const O=new Map;w.references.forEach((z,L)=>{const W=c(e.id,L);W?O.set(z.id,W):z.image&&O.set(z.id,z.image)}),S.forEach((z,L)=>{O.set(z.id,j[L].image)}),x({references:P,activeTab:"reference"}),P.forEach((z,L)=>{const W=O.get(z.id);W&&l(e.id,L,W)})},N=(M,G)=>{if(M===G||m)return;const V=[...w.references],[j]=V.splice(M,1),P=M<G?G-1:G;V.splice(P,0,j);const S=[];for(let O=0;O<w.references.length;O++)S.push(c(e.id,O)||w.references[O].image);const[A]=S.splice(M,1);S.splice(P,0,A),S.forEach((O,z)=>{l(e.id,z,O)}),x({references:V})},_=(M,G)=>{if(m)return;const V=w.references.map(j=>j.id===M?{...j,caption:G}:j);x({references:V})},E=M=>{if(m)return;const G=w.references.findIndex(j=>j.id===M);if(G===-1)return;const V=w.references.filter(j=>j.id!==M);for(let j=G;j<V.length;j++){const P=c(e.id,j+1);if(P)l(e.id,j,P);else{const S=w.references[j+1];S&&S.image&&l(e.id,j,S.image)}}x({references:V})},I=()=>{if(m)return;b([...w.references]);const M=new Map;w.references.forEach((V,j)=>{const P=c(e.id,j)||V.image;P&&M.set(V.id,P)});const G=[...w.references];for(let V=G.length-1;V>0;V--){const j=Math.floor(Math.random()*(V+1));[G[V],G[j]]=[G[j],G[V]]}x({references:G}),G.forEach((V,j)=>{const P=M.get(V.id);P&&l(e.id,j,P)})},B=()=>{if(!k||m)return;const M=new Map;w.references.forEach((G,V)=>{const j=c(e.id,V)||G.image;j&&M.set(G.id,j)}),k.forEach((G,V)=>{const j=M.get(G.id);j&&l(e.id,V,j)}),x({references:k}),b(null)};return n.jsxs("div",{className:"flex flex-col h-full",children:[!w.isMinimal&&n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-900/50 p-1 rounded-t-md mb-1 flex-shrink-0",children:[n.jsx("button",{onClick:()=>x({activeTab:"note"}),className:`flex-1 py-1 text-xs font-semibold rounded transition-colors ${w.activeTab==="note"?"bg-cyan-600 text-white":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:o("node.note.tab.note")}),n.jsxs("button",{onClick:()=>x({activeTab:"reference"}),className:`flex-1 py-1 text-xs font-semibold rounded transition-colors ${w.activeTab==="reference"?"bg-cyan-600 text-white":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:[o("node.note.tab.references"),w.references.length>0&&n.jsxs("span",{className:"ml-1 opacity-75",children:["(",w.references.length,")"]})]})]}),n.jsx("div",{className:"flex-grow min-h-0 relative",children:w.activeTab==="note"?n.jsx(RP,{text:w.text,style:w.style,onTextChange:M=>x({text:M}),onStyleChange:f,libraryItems:a,t:o,deselectAllNodes:r,isMinimal:!!w.isMinimal}):n.jsx(LP,{references:w.references,isLocked:!!m,onAddImages:v,onReorder:N,onUpdateCaption:_,onRemoveReference:E,onDetach:h,onShuffle:I,onUndoShuffle:B,canUndoShuffle:!!k,t:o,deselectAllNodes:r,setImageViewer:i,addToast:s,getFullSizeImage:M=>c(e.id,M),setFullSizeImage:(M,G)=>l(e.id,M,G),isMinimal:!!w.isMinimal})})]})},zP=()=>null,p0={en:{subjects:["a majestic lion","a futuristic robot","a wise old wizard","a curious alien","a brave knight","a mythical dragon","a cyberpunk detective","a goddess of nature","a talking squirrel","an ancient golem","a pirate captain","a stealthy ninja","a lonely astronaut","a phantom queen","a clockwork beast"],objects:["a glowing crystal","an enchanted sword","a rusty key","a mysterious book","a floating lantern","a time-traveling watch","a powerful artifact","a forgotten map","a steampunk airship","a magical potion","a shard of a fallen star","the crown of a forgotten king"],actions:["exploring a hidden cave","casting a powerful spell","flying through the clouds","solving a complex puzzle","standing on a cliff edge","sailing across a stormy sea","building a futuristic city","meditating in a peaceful forest","leading an army into battle","discovering a lost secret","dancing in the moonlight"],environments:["in a neon-lit cyberpunk city","in an enchanted forest at night","on a volcanic planet","in a lost underwater city","in a grand, gothic castle","in a tranquil zen garden","on a floating island in the sky","in a post-apocalyptic wasteland","inside a massive spaceship","at the edge of a black hole","in a victorian-era library"]},ru:{subjects:[" "," ","  "," "," "," ","-"," "," "," "," "," "," ","-"," "],objects:[" "," "," "," "," ","    "," "," ","-"," ","  ","  "],actions:["  ","  ","  ","  ","   ","   ","  ","   ","   ","  ","   "],environments:["  -","   ","  ","   ","   ","  -","    ","  ","   ","   ","   "]},uz:{subjects:["ulugvor sher","futuristik robot","dono keksa sehrgar","qiziquvchan ozga sayyoralik","jasur ritsar","afsonaviy ajdaho","kiberpank detektiv","tabiat mabudasi","gapiruvchi sincap","qadimiy golem","qaroqchi kapitan","yashirin ninja","yolgiz astronavt","fantom malika","mexanik yirtqich"],objects:["porlayotgan kristall","sehrlangan qilich","zanglagan kalit","sirli kitob","uchuvchi chiroq","vaqt sayohati soati","qudratli artefakt","unutilgan xarita","stimpank havo kemasi","sehrli damlama","qulagan yulduz parchasi","unutilgan qirol toji"],actions:["yashirin gorni organmoqda","kuchli sehr oqimoqda","bulutlar orasidan uchmoqda","murakkab jumboqni yechmoqda","jarlik chetida turibdi","boronli dengizda suzmoqda","futuristik shahar qurmoqda","tinch ormonda meditatsiya qilmoqda","armiyani jangga boshlamoqda","yoqolgan sirni ochmoqda","oy nuri ostida raqsga tushmoqda"],environments:["neon chiroqli kiberpank shaharda","tunda sehrlangan ormonda","vulqonli sayyorada","yoqolgan suv osti shahrida","hashamatli gotik qasrda","tinch dzen bogida","osmondagi uchuvchi orolda","post-apokaliptik cholda","ulkan kosmik kema ichida","qora tuynuk chetida","viktoriya davri kutubxonasida"]},es:{subjects:["un len majestuoso","un robot futurista","un viejo mago sabio","un aliengena curioso","un caballero valiente","un dragn mtico","un detective cyberpunk","una diosa de la naturaleza","una ardilla parlante","un glem antiguo","un capitn pirata","un ninja sigiloso","un astronauta solitario","una reina fantasma","una bestia de relojera"],objects:["un cristal brillante","una espada encantada","una llave oxidada","un libro misterioso","una linterna flotante","un reloj para viajar en el tiempo","un artefacto poderoso","un mapa olvidado","una aeronave steampunk","una pocin mgica","un fragmento de estrella cada","la corona de un rey olvidado"],actions:["explorando una cueva oculta","lanzando un hechizo poderoso","volando a travs de las nubes","resolviendo un rompecabezas complejo","de pie en el borde de un acantilado","navegando por un mar tormentoso","construyendo una ciudad futurista","meditando en un bosque tranquilo","liderando un ejrcito a la batalla","descubriendo un secreto perdido","bailando a la luz de la luna"],environments:["en una ciudad cyberpunk iluminada por nen","en un bosque encantado de noche","en un planeta volcnico","en una ciudad submarina perdida","en un gran castillo gtico","en un tranquilo jardn zen","en una isla flotante en el cielo","en un pramo post-apocalptico","dentro de una nave espacial masiva","en el borde de un agujero negro","en una biblioteca de la era victoriana"]},fr:{subjects:["un lion majestueux","un robot futuriste","un vieux sorcier sage","un extraterrestre curieux","un chevalier courageux","un dragon mythique","un dtective cyberpunk","une desse de la nature","un cureuil parlant","un golem ancien","un capitaine pirate","un ninja furtif","un astronaute solitaire","une reine fantme","une bte mcanique"],objects:["un cristal brillant","une pe enchante","une cl rouille","un livre mystrieux","une lanterne flottante","une montre de voyage dans le temps","un artefact puissant","une carte oublie","un dirigeable steampunk","une potion magique","un clat d'toile tombe","la couronne d'un roi oubli"],actions:["explore une grotte cache","lance un sort puissant","vole  travers les nuages","rsout un puzzle complexe","se tient au bord d'une falaise","navigue sur une mer dchane","construit une ville futuriste","mdite dans une fort paisible","mne une arme au combat","dcouvre un secret perdu","danse au clair de lune"],environments:["dans une ville cyberpunk claire au non","dans une fort enchante la nuit","sur une plante volcanique","dans une cit sous-marine perdue","dans un grand chteau gothique","dans un jardin zen tranquille","sur une le flottante dans le ciel","dans un dsert post-apocalyptique"," l'intrieur d'un immense vaisseau spatial","au bord d'un trou noir","dans une bibliothque de l'poque victorienne"]},de:{subjects:["ein majesttischer Lwe","ein futuristischer Roboter","ein weiser alter Zauberer","ein neugieriges Alien","ein tapferer Ritter","ein mythischer Drache","ein Cyberpunk-Detektiv","eine Gttin der Natur","ein sprechendes Eichhrnchen","ein alter Golem","ein Piratenkapitn","ein heimlicher Ninja","ein einsamer Astronaut","eine Phantomknigin","ein Uhrwerk-Biest"],objects:["ein leuchtender Kristall","ein verzaubertes Schwert","ein rostiger Schlssel","ein geheimnisvolles Buch","eine schwebende Laterne","eine Zeitreiseuhr","ein mchtiges Artefakt","eine vergessene Karte","ein Steampunk-Luftschiff","ein Zaubertrank","ein Splitter eines gefallenen Sterns","die Krone eines vergessenen Knigs"],actions:["erkundet eine versteckte Hhle","wirkt einen mchtigen Zauber","fliegt durch die Wolken","lst ein komplexes Rtsel","steht am Rand einer Klippe","segelt ber ein strmisches Meer","baut eine futuristische Stadt","meditiert in einem friedlichen Wald","fhrt eine Armee in die Schlacht","entdeckt ein verlorenes Geheimnis","tanzt im Mondlicht"],environments:["in einer neonbeleuchteten Cyberpunk-Stadt","in einem verzauberten Wald bei Nacht","auf einem vulkanischen Planeten","in einer verlorenen Unterwasserstadt","in einem groen gotischen Schloss","in einem ruhigen Zen-Garten","auf einer schwebenden Insel im Himmel","in einem postapokalyptischen dland","in einem riesigen Raumschiff","am Rande eines schwarzen Lochs","in einer Bibliothek der viktorianischen ra"]},it:{subjects:["un leone maestoso","un robot futuristico","un vecchio mago saggio","un alieno curioso","un cavaliere coraggioso","un drago mitico","un detective cyberpunk","una dea della natura","uno scoiattolo parlante","un antico golem","un capitano pirata","un ninja furtivo","un astronauta solitario","una regina fantasma","una bestia a orologeria"],objects:["un cristallo luminoso","una spada incantata","una chiave arrugginita","un libro misterioso","una lanterna fluttuante","un orologio per viaggiare nel tempo","un artefatto potente","una mappa dimenticata","un dirigibile steampunk","una pozione magica","una scheggia di una stella caduta","la corona di un re dimenticato"],actions:["esplora una grotta nascosta","lancia un potente incantesimo","vola attraverso le nuvole","risolve un enigma complesso","sta sul bordo di una scogliera","naviga attraverso un mare in tempesta","costruisce una citt futuristica","medita in una foresta tranquilla","guida un esercito in battaglia","scopre un segreto perduto","balla al chiaro di luna"],environments:["in una citt cyberpunk illuminata al neon","in una foresta incantata di notte","su un pianeta vulcanico","in una citt sottomarina perduta","in un grande castello gotico","in un tranquillo giardino zen","su un'isola fluttuante nel cielo","in una terra desolata post-apocalittica","all'interno di un'enorme astronave","ai margini di un buco nero","in una biblioteca di epoca vittoriana"]},pt:{subjects:["um leo majestoso","um rob futurista","um velho mago sbio","um aliengena curioso","um cavaleiro corajoso","um drago mtico","um detetive cyberpunk","uma deusa da natureza","um esquilo falante","um golem antigo","um capito pirata","um ninja furtivo","um astronauta solitrio","uma rainha fantasma","uma besta mecnica"],objects:["um cristal brilhante","uma espada encantada","uma chave enferrujada","um livro misterioso","uma lanterna flutuante","um relgio de viagem no tempo","um artefato poderoso","um mapa esquecido","um dirigvel steampunk","uma poo mgica","um fragmento de uma estrela cada","a coroa de um rei esquecido"],actions:["explorando uma caverna escondida","lanando um feitio poderoso","voando atravs das nuvens","resolvendo um quebra-cabea complexo","de p na beira de um penhasco","navegando por um mar tempestuoso","construindo uma cidade futurista","meditando em uma floresta pacfica","liderando um exrcito para a batalha","descobrindo um segredo perdido","danando ao luar"],environments:["em uma cidade cyberpunk iluminada por neon","em uma floresta encantada  noite","em um planeta vulcnico","em uma cidade subaqutica perdida","em um grande castelo gtico","em um jardim zen tranquilo","em uma ilha flutuante no cu","em um terreno baldio ps-apocalptico","dentro de uma enorme nave espacial","na borda de um buraco negro","em uma biblioteca da era vitoriana"]},zh:{subjects:["","","","","","","","","","","","","","",""],objects:["","","","","","","","","","","",""],actions:["","","","","","","","","","",""],environments:["","","","","","","","","","",""]},ja:{subjects:["","","","","","","","","","","","","","",""],objects:["","","","","","","","","","","",""],actions:["","","","","","","","","","",""],environments:["","","","","","","","","","",""]},ko:{subjects:["  "," ","  ","  "," ","  "," "," "," "," "," "," "," "," "," "],objects:[" ","  "," "," "," ","  "," "," "," "," ","  ","  "],actions:["   ","   ","   ","   ","   ","    ","   ","   ","   ","   ","    "],environments:["    ","  "," ","  ","  ","  ","   ","  ","  "," ","  "]}},_y=e=>{const t=p0[e]||p0.en,o=Object.keys(t),r=o[Math.floor(Math.random()*o.length)],a=t[r];return a[Math.floor(Math.random()*a.length)]},Bn=({children:e,content:t,isActive:o,position:r="top",pulseColor:a="rgba(34, 211, 238, 0.8)",className:i="",onSkip:s,onNext:l,isFinishStep:c=!1})=>{const{t:d}=Pt();if(!o)return n.jsx(n.Fragment,{children:e});const u={top:"bottom-full left-1/2 -translate-x-1/2 mb-3",bottom:"top-full left-1/2 -translate-x-1/2 mt-3",left:"right-full top-1/2 -translate-y-1/2 mr-3",right:"left-full top-1/2 -translate-y-1/2 ml-3"},p={top:"top-full left-1/2 -translate-x-1/2 border-t-cyan-900",bottom:"bottom-full left-1/2 -translate-x-1/2 border-b-cyan-900",left:"left-full top-1/2 -translate-y-1/2 border-l-cyan-900",right:"right-full top-1/2 -translate-y-1/2 border-r-cyan-900"};return n.jsxs("div",{className:`relative inline-flex ${i}`,style:{zIndex:1e3},children:[n.jsx("div",{className:"absolute inset-0 rounded-md pointer-events-none tutorial-ring",style:{boxShadow:`0 0 0 0 ${a}`}}),e,n.jsx("div",{className:`absolute ${u[r]} z-[1001] w-max max-w-[250px] pointer-events-auto`,children:n.jsxs("div",{className:"bg-cyan-900 border border-cyan-500 text-white text-xs font-bold px-3 py-2 rounded-lg shadow-2xl relative animate-bounce-gentle",children:[n.jsx("div",{className:"mb-2",children:t}),n.jsxs("div",{className:"flex justify-end border-t border-cyan-700/50 pt-1 mt-1 gap-2",children:[l&&n.jsx("button",{onClick:m=>{m.stopPropagation(),l()},className:"text-[10px] text-cyan-300 hover:text-white underline decoration-cyan-500/50 hover:decoration-white transition-all",children:d("tutorial.next")}),s&&n.jsx("button",{onClick:m=>{m.stopPropagation(),s()},className:"text-[10px] text-gray-400 hover:text-white underline decoration-gray-500/50 hover:decoration-white transition-all",children:d(c?"tutorial.finish":"tutorial.skip")})]}),n.jsx("div",{className:`absolute border-4 border-transparent ${p[r]}`})]})})]})},qP=({node:e,onValueChange:t,libraryItems:o,t:r,onSelectNode:a})=>{const{language:i}=Pt(),s=Kt(),{tutorialStep:l,tutorialTargetId:c,advanceTutorial:d,skipTutorial:u}=s||{},p=c===e.id&&(l==="text_input_0"||l==="text_input_1"||l==="text_input_2"),m=()=>{const w=_y(i),k=e.value?`${e.value}, ${w}`:w;t(e.id,k),p&&d&&d()};return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex items-center mb-1 flex-shrink-0 space-x-2",children:[n.jsx("div",{className:"flex-grow",children:n.jsx(oh,{libraryItems:o,onPromptInsert:w=>{const k=e.value?`${e.value}, ${w}`:w;t(e.id,k)}})}),n.jsx(Bn,{content:r("tutorial.step1"),isActive:!!p,position:"left",onSkip:u,children:n.jsx(we,{title:r("node.action.randomWord"),onClick:m,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})})})]}),n.jsx("div",{className:"flex-grow min-h-0",children:n.jsx(Cn,{value:e.value,onDebouncedChange:w=>t(e.id,w),placeholder:r("node.content.notePlaceholder"),className:"w-full h-full p-2 bg-input border border-transparent rounded-md resize-none focus:border-accent focus:outline-none",onWheel:w=>w.stopPropagation(),onMouseDown:w=>{w.stopPropagation(),a()}})})]})};let OP=500;const Al=()=>++OP,FP=({onClose:e,onPointerDown:t,onPointerMove:o,onPointerUp:r})=>{const{t:a}=Pt();return n.jsxs("div",{onPointerDown:t,onPointerMove:o,onPointerUp:r,className:"p-3 border-b border-gray-700 flex justify-between items-center cursor-move bg-gray-900 select-none",children:[n.jsxs("h2",{className:"text-lg font-bold text-cyan-400 flex items-center gap-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),a("imageEditor.title")]}),n.jsx("button",{onClick:e,className:"p-1 text-gray-400 rounded-full hover:bg-gray-600 hover:text-white transition-colors",onPointerDown:i=>i.stopPropagation(),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})},An=({options:e,value:t,onChange:o,disabled:r,id:a,title:i})=>{const[s,l]=y.useState(!1),[c,d]=y.useState(-1),u=y.useRef(null),p=y.useRef([]),m=e.find(x=>x.value===t),w=(m==null?void 0:m.label)||t;y.useEffect(()=>{const x=f=>{u.current&&!u.current.contains(f.target)&&l(!1)};return document.addEventListener("mousedown",x,!0),()=>document.removeEventListener("mousedown",x,!0)},[]),y.useEffect(()=>{if(s){const x=e.findIndex(f=>f.value===t);d(x>-1?x:0),setTimeout(()=>{var f;return(f=p.current[x>-1?x:0])==null?void 0:f.focus()},0)}},[s,e,t]);const k=x=>{var f,h;switch(x.key){case"ArrowDown":if(x.preventDefault(),!s)l(!0);else{const v=Math.min(c+1,e.length-1);d(v),(f=p.current[v])==null||f.focus()}break;case"ArrowUp":if(x.preventDefault(),s){const v=Math.max(c-1,0);d(v),(h=p.current[v])==null||h.focus()}break;case"Enter":case" ":x.preventDefault(),s&&c!==-1?(o(e[c].value),l(!1)):l(!s);break;case"Escape":l(!1);break;case"Tab":l(!1);break}},b=x=>{o(x),l(!1)};return n.jsxs("div",{ref:u,className:"relative w-full",title:i,children:[n.jsxs("button",{id:a,disabled:r,onClick:()=>l(!s),onKeyDown:k,type:"button","aria-haspopup":"listbox","aria-expanded":s,className:"w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed flex justify-between items-center text-left group",children:[n.jsxs("span",{className:"truncate flex items-center gap-2",children:[(m==null?void 0:m.icon)&&n.jsx("span",{className:"text-gray-400",children:m.icon}),w]}),n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 transition-transform duration-200 flex-shrink-0 ml-1 ${s?"transform rotate-180":""}`,viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),s&&n.jsx("ul",{role:"listbox",className:"absolute z-10 w-full mt-1 bg-gray-700 border border-gray-600 rounded-md shadow-lg focus:outline-none",children:e.map((x,f)=>n.jsxs("li",{ref:h=>{p.current[f]=h},tabIndex:-1,role:"option","aria-selected":t===x.value,onClick:()=>b(x.value),onKeyDown:k,className:`p-2 text-sm cursor-pointer select-none transition-colors flex items-center gap-2 group ${c===f?"bg-cyan-600 text-white":"text-gray-200 hover:bg-gray-600"} ${t===x.value?"font-semibold":""}`,children:[x.icon&&n.jsx("span",{className:`${c===f?"text-white":"text-gray-400 group-hover:text-gray-200"}`,children:x.icon}),n.jsx("span",{children:x.label})]},x.value))})]})},Do=({title:e,onClick:t,active:o,icon:r,tooltipPosition:a="right"})=>n.jsxs("div",{className:"relative group flex items-center justify-center",children:[n.jsx("button",{onClick:t,className:`w-10 h-10 rounded-md flex items-center justify-center border transition-all ${o?"bg-cyan-600/20 border-cyan-500 text-cyan-400 shadow-[0_0_10px_rgba(34,211,238,0.2)]":"bg-gray-700 border-gray-600 text-gray-400 hover:bg-gray-600 hover:text-gray-200"}`,children:r}),n.jsx("div",{className:`absolute ${a==="right"?"left-full top-1/2 -translate-y-1/2 ml-2":"top-full left-1/2 -translate-x-1/2 mt-2"} px-3 py-1.5 bg-slate-700 text-slate-200 text-xs whitespace-nowrap rounded-md shadow-xl opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50`,children:e})]}),h0=({title:e,onClick:t,disabled:o,children:r,className:a})=>n.jsxs("div",{className:"relative group flex-1 flex",children:[n.jsx("button",{onClick:t,disabled:o,className:`w-full px-2 py-1.5 text-xs font-semibold rounded transition-colors flex items-center justify-center gap-2 ${a}`,children:r}),n.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-xs whitespace-normal text-center w-40 rounded-md shadow-xl opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 break-words",children:e})]}),BP=({resolution:e,setResolution:t,aspectRatio:o,setAspectRatio:r,backgroundType:a,setBackgroundType:i,activeTool:s,isSnappingEnabled:l,setIsSnappingEnabled:c,isFreeAspect:d,setIsFreeAspect:u,brushSize:p,setBrushSize:m,modificationPrompt:w,setModificationPrompt:k,isProcessing:b,handleRequestModification:x,handleRemoveObject:f,handleRemoveBackground:h,canvasSize:v})=>{const{t:N}=Pt(),_=y.useMemo(()=>[{value:"auto",label:"Auto (Fit Image)",type:"auto"},{value:"1920x1080",label:"1920x1080",type:"landscape"},{value:"1080x1920",label:"1080x1920",type:"portrait"},{value:"512x512",label:"512x512",type:"square"},{value:"1024x1024",label:"1024x1024",type:"square"},{value:"2048x2048",label:"2048x2048",type:"square"},{value:"4096x4096",label:"4096x4096",type:"square"}].map(B=>{let M;switch(B.type){case"landscape":M=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"2",y:"7",width:"20",height:"10",rx:"1"})});break;case"portrait":M=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"7",y:"2",width:"10",height:"20",rx:"1"})});break;case"square":M=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"1"})});break;case"auto":M=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})});break}return{value:B.value,label:B.label,icon:M}}),[]),E=y.useMemo(()=>[{value:"free",label:"Free",type:"free"},{value:"16:9",label:"16:9",type:"landscape"},{value:"9:16",label:"9:16",type:"portrait"},{value:"4:3",label:"4:3",type:"landscape_slight"},{value:"3:4",label:"3:4",type:"portrait_slight"},{value:"1:1",label:"1:1",type:"square"}].map(B=>{let M;switch(B.type){case"free":M=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})});break;case"landscape":M=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"2",y:"8",width:"20",height:"8",rx:"1"})});break;case"portrait":M=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"8",y:"2",width:"10",height:"20",rx:"1"})});break;case"landscape_slight":M=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"3",y:"6",width:"18",height:"12",rx:"1"})});break;case"portrait_slight":M=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"6",y:"3",width:"12",height:"18",rx:"1"})});break;case"square":M=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"5",y:"5",width:"14",height:"14",rx:"1"})});break}return{value:B.value,label:B.label,icon:M}}),[]);return n.jsxs("div",{className:"w-64 p-4 border-r border-gray-700 flex-shrink-0 flex flex-col bg-gray-800 overflow-y-auto overflow-x-hidden custom-scrollbar select-none",onWheel:I=>I.stopPropagation(),children:[n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wider",children:N("imageEditor.canvasResolution")}),n.jsx(An,{value:e,onChange:t,options:_}),n.jsxs("p",{className:"text-[10px] text-gray-500 mt-1 text-right",children:[v.width," x ",v.height," px"]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wider",children:N("node.content.aspectRatio")}),n.jsx(An,{value:o,onChange:r,options:E,disabled:e!=="auto"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wider",children:N("imageEditor.background")}),n.jsxs("div",{className:"flex space-x-2 bg-gray-900/50 p-2 rounded-md border border-gray-600 justify-between items-center",children:[n.jsx("button",{onClick:()=>i("checkerboard"),className:`w-6 h-6 rounded border border-gray-500 focus:outline-none transition-transform hover:scale-110 overflow-hidden ${a==="checkerboard"?"ring-2 ring-cyan-500 scale-110":""}`,title:"Checkerboard (Transparent)",children:n.jsx("div",{className:"w-full h-full bg-[url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAIklEQVQYV2NkYGD4z8DAwMgwMoyCQAwMDAwMjAyDQAwM4wA+2wz/m6j50AAAAABJRU5ErkJggg==')]"})}),["#ffffff","#808080","#000000","#1f2937"].map(I=>n.jsx("button",{onClick:()=>i(I),className:`w-6 h-6 rounded-full border border-gray-500 focus:outline-none transition-transform hover:scale-110 ${a===I?"ring-2 ring-cyan-500 scale-110":""}`,style:{backgroundColor:I}},I)),n.jsx("input",{type:"color",value:a!=="checkerboard"?a:"#ffffff",onChange:I=>i(I.target.value),className:"w-6 h-6 p-0 rounded-full border-none overflow-hidden cursor-pointer"})]})]})]}),s==="transform"&&n.jsxs("div",{className:"mt-4 space-y-2",children:[n.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2",children:N("imageEditor.toolSettings")}),n.jsxs("div",{className:"bg-gray-700/50 p-2 rounded space-y-2",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("input",{type:"checkbox",id:"snap-toggle",checked:l,onChange:I=>c(I.target.checked),className:"h-4 w-4 rounded border-gray-500 text-accent focus:ring-accent cursor-pointer"}),n.jsx("label",{htmlFor:"snap-toggle",className:"text-xs text-gray-300 cursor-pointer select-none",children:N("imageEditor.snapToEdges")})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("input",{type:"checkbox",id:"free-aspect-toggle",checked:d,onChange:I=>u(I.target.checked),className:"h-4 w-4 rounded border-gray-500 text-accent focus:ring-accent cursor-pointer"}),n.jsx("label",{htmlFor:"free-aspect-toggle",className:"text-xs text-gray-300 cursor-pointer select-none",children:N("imageEditor.freeAspect")})]})]})]}),(s==="pencil"||s==="rectangle")&&n.jsxs("div",{className:"mt-4 space-y-2",children:[n.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-2 uppercase tracking-wider",children:"Brush Settings"}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("span",{className:"text-xs text-gray-400 w-8",children:"Size"}),n.jsx("input",{type:"range",min:"1",max:"50",value:p,onChange:I=>m(Number(I.target.value)),className:"flex-grow h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-500"}),n.jsx("span",{className:"text-xs text-gray-300 w-6 text-right",children:p})]})]}),n.jsx("div",{className:"flex-grow"}),n.jsxs("div",{className:"space-y-4 mt-4 border-t border-gray-700 pt-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2",children:N("imageEditor.section.aiRequest")}),n.jsx("textarea",{value:w,onChange:I=>k(I.target.value),placeholder:N("imageEditor.input.modificationPlaceholder"),className:"w-full p-2 bg-gray-900/50 border border-gray-600 rounded-md text-xs text-white focus:ring-2 focus:ring-cyan-500 focus:outline-none resize-none select-text",rows:3}),n.jsx("button",{onClick:x,disabled:b||!w.trim(),className:"w-full px-3 py-1.5 text-xs font-bold text-white bg-cyan-600 rounded hover:bg-cyan-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors",children:b?"Processing...":N("imageEditor.action.sendRequest")})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(h0,{title:N("imageEditor.tooltip.removeObject"),onClick:f,disabled:b,className:"text-white bg-red-600 hover:bg-red-700 border border-red-500 shadow-[0_0_15px_rgba(220,38,38,0.4)] disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none",children:b?"...":N("imageEditor.action.removeObject")}),n.jsx(h0,{title:"Remove background keeping main object",onClick:h,disabled:b,className:"text-white bg-teal-600 hover:bg-teal-700 border border-teal-500 shadow-[0_0_15px_rgba(13,148,136,0.4)] disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none",children:b?"...":N("imageEditor.action.removeBackground")})]})]})]})},HP=({activeTool:e,setActiveTool:t,onFit:o,onFill:r,onFlip:a})=>{const{t:i}=Pt();return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"absolute top-4 left-4 flex flex-col gap-2 z-20 bg-gray-900/80 backdrop-blur-sm p-1.5 rounded-lg border border-gray-700 shadow-lg",children:[n.jsx(Do,{title:i("imageEditor.tool.transform"),onClick:()=>t("transform"),active:e==="transform",icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),n.jsx(Do,{title:i("imageEditor.tool.hand"),onClick:()=>t("hand"),active:e==="hand",icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11"})})}),n.jsx(Do,{title:i("imageEditor.tool.zoom"),onClick:()=>t("zoom"),active:e==="zoom",icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7"})})}),n.jsx("div",{className:"w-full h-px bg-gray-700 my-1"}),n.jsx(Do,{title:i("imageEditor.tool.pencil"),onClick:()=>t("pencil"),active:e==="pencil",icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),n.jsx(Do,{title:i("imageEditor.tool.rectangle"),onClick:()=>t("rectangle"),active:e==="rectangle",icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"})})}),n.jsx(Do,{title:"Eyedropper",onClick:()=>t("eyedropper"),active:e==="eyedropper",icon:n.jsx(kP,{className:"h-5 w-5"})})]}),n.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 flex gap-2 z-20 bg-gray-900/80 backdrop-blur-sm p-1.5 rounded-lg border border-gray-700 shadow-lg",children:[n.jsx(Do,{title:i("imageEditor.action.fit"),onClick:o,icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5M15 15l5.25 5.25"})}),tooltipPosition:"bottom"}),n.jsx(Do,{title:i("imageEditor.action.fill"),onClick:r,icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"})}),tooltipPosition:"bottom"}),n.jsx(Do,{title:i("node.action.flipImage"),onClick:a,icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5"})}),tooltipPosition:"bottom"})]})]})},GP=({zoom:e,onZoomChange:t,onClose:o,onReset:r,onApply:a,isProcessing:i})=>{const{t:s}=Pt();return n.jsxs("div",{className:"p-3 border-t border-gray-700 flex justify-between items-center bg-gray-900 gap-3 select-none",children:[n.jsx("div",{className:"flex items-center space-x-4",children:n.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-400",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),n.jsxs("span",{className:"w-12 text-right",children:[Math.round(e*100),"%"]}),n.jsx("input",{type:"range",min:"0.1",max:"4",step:"0.1",value:e,onChange:t,className:"w-32 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]})}),n.jsxs("div",{className:"flex space-x-3 items-center",children:[n.jsx("button",{onClick:o,className:"px-4 py-2 text-sm font-semibold text-gray-300 bg-gray-800 rounded-md hover:bg-gray-700 transition-colors border border-gray-600",children:s("imageEditor.action.cancel")}),n.jsx("button",{onClick:r,className:"px-4 py-2 text-sm font-semibold text-red-200 bg-red-900/30 rounded-md hover:bg-red-900/50 border border-red-900/50 transition-colors",children:s("imageEditor.action.resetEdits")}),n.jsx("button",{onClick:a,disabled:i,className:"px-6 py-2 text-sm font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 transition-colors shadow-lg shadow-cyan-900/20 disabled:opacity-50 disabled:cursor-not-allowed",children:s("imageEditor.action.apply")})]})]})},Zr=e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:0,g:0,b:0}},UP=(e,t,o)=>"#"+((1<<24)+(e<<16)+(t<<8)+o).toString(16).slice(1),pd=(e,t,o)=>{e/=255,t/=255,o/=255;const r=Math.max(e,t,o),a=Math.min(e,t,o);let i=0,s,l=r;const c=r-a;if(s=r===0?0:c/r,r===a)i=0;else{switch(r){case e:i=(t-o)/c+(t<o?6:0);break;case t:i=(o-e)/c+2;break;case o:i=(e-t)/c+4;break}i/=6}return{h:i*360,s,v:l}},VP=(e,t,o)=>{let r=0,a=0,i=0;const s=Math.floor(e*6),l=e*6-s,c=o*(1-t),d=o*(1-l*t),u=o*(1-(1-l)*t);switch(s%6){case 0:r=o,a=u,i=c;break;case 1:r=d,a=o,i=c;break;case 2:r=c,a=o,i=u;break;case 3:r=c,a=d,i=o;break;case 4:r=u,a=c,i=o;break;case 5:r=o,a=c,i=d;break}return{r:Math.round(r*255),g:Math.round(a*255),b:Math.round(i*255)}},WP=({color:e,onChange:t})=>{const[o,r]=y.useState({h:0,s:1,v:1}),[a,i]=y.useState(e),s=y.useRef(null),l=y.useRef(null),c=y.useRef(!1),d=y.useRef(!1);y.useEffect(()=>{const f=Zr(e);r(pd(f.r,f.g,f.b)),i(e)},[e]);const u=(f,h,v)=>{const N=VP(f/360,h,v),_=UP(N.r,N.g,N.b);t(_),r({h:f,s:h,v}),i(_)},p=y.useCallback(()=>{const f=s.current;if(!f)return;const h=f.getContext("2d");if(!h)return;const v=f.width,N=f.height;h.clearRect(0,0,v,N),h.fillStyle=`hsl(${o.h}, 100%, 50%)`,h.fillRect(0,0,v,N);const _=h.createLinearGradient(0,0,v,0);_.addColorStop(0,"rgba(255,255,255,1)"),_.addColorStop(1,"rgba(255,255,255,0)"),h.fillStyle=_,h.fillRect(0,0,v,N);const E=h.createLinearGradient(0,0,0,N);E.addColorStop(0,"rgba(0,0,0,0)"),E.addColorStop(1,"rgba(0,0,0,1)"),h.fillStyle=E,h.fillRect(0,0,v,N);const I=o.s*v,B=(1-o.v)*N;h.beginPath(),h.arc(I,B,6,0,Math.PI*2),h.strokeStyle="white",h.lineWidth=2,h.stroke(),h.beginPath(),h.arc(I,B,4,0,Math.PI*2),h.strokeStyle="black",h.lineWidth=1,h.stroke()},[o]),m=y.useCallback(()=>{const f=l.current;if(!f)return;const h=f.getContext("2d");if(!h)return;const v=f.width,N=f.height;h.clearRect(0,0,v,N);const _=h.createLinearGradient(0,0,v,0);_.addColorStop(0,"#ff0000"),_.addColorStop(1/6,"#ffff00"),_.addColorStop(2/6,"#00ff00"),_.addColorStop(3/6,"#00ffff"),_.addColorStop(4/6,"#000000"),_.addColorStop(4/6,"#0000ff"),_.addColorStop(5/6,"#ff00ff"),_.addColorStop(1,"#ff0000"),h.fillStyle=_,h.fillRect(0,0,v,N);const E=o.h/360*v;h.fillStyle="white",h.fillRect(E-2,0,4,N),h.strokeStyle="black",h.lineWidth=1,h.strokeRect(E-2,0,4,N)},[o.h]);y.useEffect(()=>{p()},[p]),y.useEffect(()=>{m()},[m]);const w=f=>{const h=s.current;if(!h)return;const v=h.getBoundingClientRect(),N=Math.max(0,Math.min(v.width,f.clientX-v.left)),_=Math.max(0,Math.min(v.height,f.clientY-v.top)),E=N/v.width,I=1-_/v.height;u(o.h,E,I)},k=f=>{const h=l.current;if(!h)return;const v=h.getBoundingClientRect(),_=Math.max(0,Math.min(v.width,f.clientX-v.left))/v.width*360;u(_,o.s,o.v)};y.useEffect(()=>{const f=I=>{c.current&&w(I),d.current&&k(I)},h=()=>{c.current=!1,d.current=!1,window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",h)},v=I=>{c.current=!0,w(I),window.addEventListener("mousemove",f),window.addEventListener("mouseup",h)},N=I=>{d.current=!0,k(I),window.addEventListener("mousemove",f),window.addEventListener("mouseup",h)},_=s.current,E=l.current;return _&&(_.onmousedown=v),E&&(E.onmousedown=N),()=>{_&&(_.onmousedown=null),E&&(E.onmousedown=null)}},[o]);const b=f=>{const h=f.target.value;if(i(h),/^#[0-9A-F]{6}$/i.test(h)){t(h);const v=Zr(h);r(pd(v.r,v.g,v.b))}},x=["#ef4444","#f97316","#f59e0b","#84cc16","#10b981","#06b6d4","#3b82f6","#8b5cf6","#d946ef","#f43f5e","#ffffff","#000000"];return n.jsxs("div",{className:"flex flex-col gap-3 p-2 bg-gray-800 rounded border border-gray-700 w-full",children:[n.jsx("canvas",{ref:s,width:200,height:150,className:"w-full h-[150px] rounded cursor-crosshair shadow-inner"}),n.jsx("canvas",{ref:l,width:200,height:20,className:"w-full h-[20px] rounded cursor-ew-resize shadow-inner"}),n.jsxs("div",{className:"flex gap-2 items-center",children:[n.jsx("div",{className:"w-8 h-8 rounded border border-gray-500 shadow-sm flex-shrink-0",style:{backgroundColor:e}}),n.jsxs("div",{className:"flex-grow flex items-center bg-gray-900 rounded border border-gray-600 px-2 py-1",children:[n.jsx("span",{className:"text-gray-500 text-xs mr-1",children:"#"}),n.jsx("input",{type:"text",value:a.replace("#",""),onChange:b,className:"bg-transparent text-xs text-white outline-none w-full uppercase font-mono",maxLength:6})]})]}),n.jsx("div",{className:"flex flex-wrap gap-1.5 justify-between",children:x.map(f=>n.jsx("button",{onClick:()=>{t(f),i(f);const h=Zr(f);r(pd(h.r,h.g,h.b))},className:`w-5 h-5 rounded-full border border-gray-600 transition-transform hover:scale-110 ${e===f?"ring-2 ring-white":""}`,style:{backgroundColor:f}},f))}),n.jsx("div",{className:"flex text-[10px] text-gray-500 justify-between px-1",children:n.jsxs("span",{children:["R:",Zr(e).r," G:",Zr(e).g," B:",Zr(e).b]})})]})},$P=({color:e,onChange:t})=>{const{t:o}=Pt();return n.jsxs("div",{className:"w-64 bg-gray-900 border-l border-gray-700 flex flex-col flex-shrink-0 p-4 overflow-y-auto select-none",children:[n.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3",children:"Palette & Color"}),n.jsx(WP,{color:e,onChange:t}),n.jsxs("div",{className:"mt-4 p-3 bg-gray-800/50 rounded-lg border border-gray-700 text-xs text-gray-400",children:[n.jsx("p",{className:"mb-2 font-semibold text-gray-300",children:"Tips:"}),n.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[n.jsxs("li",{children:["Use the ",n.jsx("strong",{children:"Eyedropper"})," tool to pick colors from the image."]}),n.jsxs("li",{children:["Hold ",n.jsx("strong",{children:"Alt"})," while drawing to pick color temporarily."]})]})]})]})},hd="imageEditorModalPosition",m0="imageEditorModalSize",ic=({isOpen:e,onClose:t,onApply:o,imageSrc:r})=>{const{t:a}=Pt(),i=y.useRef(null),s=y.useRef(null),l=y.useRef(null),c=y.useRef(null),d=y.useRef(!0),[u,p]=y.useState(Al()),[m,w]=y.useState(!1),[k,b]=y.useState({zoom:1,offset:{x:0,y:0}}),[x,f]=y.useState(!1),[h,v]=y.useState({x:0,y:0,width:0,height:0}),[N,_]=y.useState(!1),[E,I]=y.useState("free"),[B,M]=y.useState("auto"),[G,V]=y.useState({width:0,height:0}),[j,P]=y.useState("checkerboard"),[S,A]=y.useState(!0),[O,z]=y.useState(!1),[L,W]=y.useState(!1),[D,T]=y.useState(""),[F,te]=y.useState("transform"),[$,Y]=y.useState("#ff0000"),[oe,le]=y.useState(5),[K,ie]=y.useState(!1),[Z,se]=y.useState("none"),de=y.useRef(null),re=y.useRef(null),R=y.useRef(null),J=y.useRef(null),[H,U]=y.useState(()=>{try{const ze=localStorage.getItem(hd);if(ze)return JSON.parse(ze)}catch{}return{x:0,y:0}}),[ee,ae]=y.useState(()=>{try{const ze=localStorage.getItem(m0);if(ze)return JSON.parse(ze)}catch{}return{width:"90vw",height:"90vh"}}),xe=y.useRef(null),ne=y.useRef(H);y.useEffect(()=>{ne.current=H},[H]);const X=()=>{p(Al())},ue=ze=>{ze.target.closest("button")||(X(),ze.preventDefault(),ze.stopPropagation(),!m&&(ze.currentTarget.setPointerCapture(ze.pointerId),xe.current={offset:{x:ze.clientX-H.x,y:ze.clientY-H.y}}))},Q=ze=>{xe.current&&U({x:ze.clientX-xe.current.offset.x,y:ze.clientY-xe.current.offset.y})},ce=ze=>{xe.current=null,ze.currentTarget.releasePointerCapture(ze.pointerId),localStorage.setItem(hd,JSON.stringify(ne.current))},pe=()=>{if(c.current&&!m){const ze=c.current.getBoundingClientRect(),je={width:ze.width,height:ze.height};ae(je),localStorage.setItem(m0,JSON.stringify(je))}};y.useEffect(()=>{e?(d.current=!0,_(!1),X(),requestAnimationFrame(()=>f(!0))):f(!1)},[e]),y.useEffect(()=>{F==="rectangle"&&le(1)},[F]),y.useEffect(()=>{if(e&&r){const ze=new Image;ze.crossOrigin="anonymous",ze.onload=()=>{l.current=ze;const je=document.createElement("canvas");je.width=ze.width,je.height=ze.height,s.current=je,v({x:0,y:0,width:ze.width,height:ze.height}),localStorage.getItem(hd)||(U({x:(window.innerWidth-1200)/2,y:(window.innerHeight-800)/2}),ae({width:1200,height:800}))},ze.src=r}else l.current=null,s.current=null},[e,r]),y.useEffect(()=>{let ze=1024,je=1024;if(B!=="auto"){const Le=B.split("x").map(Number);Le.length===2&&(ze=Le[0],je=Le[1])}else if(l.current){const Le=l.current;if(E!=="free"){const[rt,Ce]=E.split(":").map(Number);if(rt&&Ce){const Se=rt/Ce;Le.width/Le.height>Se?(ze=Le.width,je=Le.width/Se):(je=Le.height,ze=Le.height*Se)}else ze=Le.width,je=Le.height}else ze=Le.width,je=Le.height}if(ze=Math.round(ze),je=Math.round(je),V({width:ze,height:je}),e){if(d.current)b(Le=>({...Le,zoom:.4,offset:{x:0,y:0}})),d.current=!1;else if(l.current){const Le=l.current.width,rt=l.current.height,Ce=Math.min(ze/Le,je/rt);v({x:0,y:0,width:Le*Ce,height:rt*Ce})}}},[E,B,e,l.current]);const me=(ze,je)=>{const Le=i.current;if(!Le)return{x:0,y:0};const rt=Le.getBoundingClientRect(),Ce=ze-rt.left,Se=je-rt.top,he=rt.width/2,ge=rt.height/2,ve=(Ce-he-k.offset.x)/k.zoom,Ge=(Se-ge-k.offset.y)/k.zoom;return{x:ve,y:Ge}},ke=ze=>{const je=me(ze.clientX,ze.clientY),Le=je.x-h.x,rt=je.y-h.y,Ce=l.current;if(!Ce)return{x:0,y:0};const Se=Le+h.width/2,he=rt+h.height/2,ge=h.width/Ce.width,ve=h.height/Ce.height;return{x:Se/ge,y:he/ve}},Re=ze=>{const je=i.current;if(!je)return;const Le=je.getBoundingClientRect(),rt=ze.clientX-Le.left,Ce=ze.clientY-Le.top,Se=je.getContext("2d");if(!Se)return;const he=je.width/Le.width,ge=je.height/Le.height,ve=Math.floor(rt*he),Ge=Math.floor(Ce*ge),Ve=Se.getImageData(ve,Ge,1,1).data,ot="#"+((1<<24)+(Ve[0]<<16)+(Ve[1]<<8)+Ve[2]).toString(16).slice(1);Y(ot)},Me=ze=>{const je=document.createElement("canvas");je.width=20,je.height=20;const Le=je.getContext("2d");return Le&&(Le.fillStyle="#ccc",Le.fillRect(0,0,10,10),Le.fillRect(10,10,10,10),Le.fillStyle="#fff",Le.fillRect(10,0,10,10),Le.fillRect(0,10,10,10)),ze.createPattern(je,"repeat")},De=y.useCallback(()=>{var ge;const ze=i.current;if(!ze)return;const je=(ge=ze.parentElement)==null?void 0:ge.getBoundingClientRect();je&&(ze.width!==je.width||ze.height!==je.height)&&(ze.width=je.width,ze.height=je.height);const Le=ze.getContext("2d",{willReadFrequently:!0});if(!Le)return;Le.fillStyle="#374151",Le.fillRect(0,0,ze.width,ze.height),Le.save();const rt=ze.width/2,Ce=ze.height/2;Le.translate(rt+k.offset.x,Ce+k.offset.y),Le.scale(k.zoom,k.zoom);const Se=G.width,he=G.height;if(Le.shadowColor="rgba(0, 0, 0, 0.5)",Le.shadowBlur=30,Le.shadowOffsetX=0,Le.shadowOffsetY=10,Le.fillStyle="#000",Le.fillRect(-Se/2,-he/2,Se,he),Le.shadowColor="transparent",j==="checkerboard"){const ve=Me(Le);ve?Le.fillStyle=ve:Le.fillStyle="#fff"}else Le.fillStyle=j;if(Le.fillRect(-Se/2,-he/2,Se,he),Le.beginPath(),Le.rect(-Se/2,-he/2,Se,he),Le.clip(),l.current){const ve=l.current;Le.save(),Le.translate(h.x,h.y);const Ge=h.width,Ve=h.height;if(N&&Le.scale(-1,1),Le.drawImage(ve,-Ge/2,-Ve/2,Ge,Ve),s.current&&Le.drawImage(s.current,-Ge/2,-Ve/2,Ge,Ve),K&&F==="rectangle"&&R.current&&re.current){const ot=R.current,Xe=re.current,pt=Ge/ve.width,st=Ve/ve.height,ft=ot.x*pt-Ge/2,it=ot.y*st-Ve/2,wt=(Xe.x-ot.x)*pt,dt=(Xe.y-ot.y)*st;Le.strokeStyle=$,Le.lineWidth=oe/((pt+st)/2),Le.strokeRect(ft,it,wt,dt)}if(F==="pencil"&&J.current){const ot=Ge/ve.width,Xe=Ve/ve.height,pt=(ot+Xe)/2,st=J.current.x*ot-Ge/2,ft=J.current.y*Xe-Ve/2,it=oe/2*pt;Le.beginPath(),Le.arc(st,ft,it,0,Math.PI*2),Le.strokeStyle=$,Le.lineWidth=1/k.zoom,Le.stroke(),Le.beginPath(),Le.arc(st,ft,Math.max(0,it-1/k.zoom),0,Math.PI*2),Le.strokeStyle="rgba(255,255,255,0.5)",Le.lineWidth=1/k.zoom,Le.stroke()}Le.restore()}if(Le.restore(),Le.save(),Le.translate(rt+k.offset.x,Ce+k.offset.y),Le.scale(k.zoom,k.zoom),l.current&&F==="transform"){const ve=h.width,Ge=h.height;Le.save(),Le.translate(h.x,h.y),Le.strokeStyle="#22d3ee",Le.lineWidth=2/k.zoom,Le.strokeRect(-ve/2,-Ge/2,ve,Ge);const Ve=8/k.zoom;Le.fillStyle="#22d3ee",[{x:-ve/2,y:-Ge/2},{x:ve/2,y:-Ge/2},{x:-ve/2,y:Ge/2},{x:ve/2,y:Ge/2}].forEach(Xe=>{Le.fillRect(Xe.x-Ve/2,Xe.y-Ve/2,Ve,Ve)}),Le.restore()}Le.restore(),F==="eyedropper"&&J.current},[k,h,G,j,N,F,K,$,oe]);y.useEffect(()=>{if(e){let ze=requestAnimationFrame(De);const je=()=>{De(),ze=requestAnimationFrame(je)};return je(),()=>cancelAnimationFrame(ze)}},[e,De]);const Ie=(ze,je)=>{if(!l.current)return"none";const Le=h.width,rt=h.height,Ce=h.x,Se=h.y,he=10/k.zoom,ge=(ve,Ge)=>Math.abs(ze-ve)<he&&Math.abs(je-Ge)<he;return ge(Ce-Le/2,Se-rt/2)?"tl":ge(Ce+Le/2,Se-rt/2)?"tr":ge(Ce-Le/2,Se+rt/2)?"bl":ge(Ce+Le/2,Se+rt/2)?"br":"none"},Ne=(ze,je)=>{if(!l.current)return!1;const Le=h.width,rt=h.height,Ce=h.x,Se=h.y;return ze>=Ce-Le/2&&ze<=Ce+Le/2&&je>=Se-rt/2&&je<=Se+rt/2},Pe=(ze,je,Le)=>{const rt=i.current;if(!rt)return;const Ce=rt.getBoundingClientRect(),Se=Math.max(.1,Math.min(Le,5)),he=ze-Ce.left,ge=je-Ce.top,ve=Ce.width/2,Ge=Ce.height/2,Ve=he-ve,ot=ge-Ge,Xe=k.offset.x,pt=k.offset.y,st=Se/k.zoom,ft=Ve-(Ve-Xe)*st,it=ot-(ot-pt)*st;b({zoom:Se,offset:{x:ft,y:it}})},ye=ze=>{const je=Number(ze.target.value),Le=je/k.zoom;b({zoom:je,offset:{x:k.offset.x*Le,y:k.offset.y*Le}})},_e=(ze,je,Le)=>Math.abs(ze-je)<Le?je:ze,Fe=ze=>{if(X(),ze.preventDefault(),F==="eyedropper"){Re(ze);return}if(F==="zoom"){de.current={mouse:{x:ze.clientX,y:ze.clientY},viewOffset:{...k.offset},imgState:{...h},startZoom:k.zoom},ie(!0);return}const je=me(ze.clientX,ze.clientY);if(F==="transform"){const Le=Ie(je.x,je.y);if(Le!=="none"){se(Le),ie(!0),de.current={mouse:{x:ze.clientX,y:ze.clientY},viewOffset:{...k.offset},imgState:{...h},startDist:Math.hypot(je.x-h.x,je.y-h.y),startAspectRatio:h.width/h.height};return}else if(Ne(je.x,je.y))se("none");else return}if(ie(!0),de.current={mouse:{x:ze.clientX,y:ze.clientY},viewOffset:{...k.offset},imgState:{...h}},F==="pencil"||F==="rectangle"){const Le=ke(ze);if(R.current=Le,re.current=Le,F==="pencil"&&s.current){const rt=s.current.getContext("2d");rt&&(rt.beginPath(),rt.moveTo(Le.x,Le.y),rt.lineCap="round",rt.lineJoin="round",rt.strokeStyle=$,rt.lineWidth=oe,rt.stroke())}}},We=ze=>{const je=me(ze.clientX,ze.clientY),Le=ke(ze);if(J.current=Le,!K){F==="transform"?Ie(je.x,je.y)!=="none"?document.body.style.cursor="nwse-resize":Ne(je.x,je.y)?document.body.style.cursor="move":document.body.style.cursor="default":F==="hand"?document.body.style.cursor="grab":F==="zoom"?document.body.style.cursor="ew-resize":document.body.style.cursor="crosshair";return}const rt=de.current;if(!rt)return;const Ce=ze.clientX-rt.mouse.x,Se=ze.clientY-rt.mouse.y;if(F==="hand")b(he=>({...he,offset:{x:rt.viewOffset.x+Ce,y:rt.viewOffset.y+Se}})),document.body.style.cursor="grabbing";else if(F==="zoom"){const ge=Math.pow(2,Ce/200),ve=Math.max(.1,Math.min(10,(rt.startZoom||1)*ge));b(Ge=>({...Ge,zoom:ve}))}else if(F==="transform")if(Z!=="none"){const he=me(ze.clientX,ze.clientY),ge=rt.imgState.width/2,ve=rt.imgState.height/2,Ge=rt.imgState.x-ge,Ve=rt.imgState.x+ge,ot=rt.imgState.y-ve,Xe=rt.imgState.y+ve;let pt=Ge,st=Ve,ft=ot,it=Xe;if(Z==="tl"&&(pt=he.x,ft=he.y),Z==="tr"&&(st=he.x,ft=he.y),Z==="bl"&&(pt=he.x,it=he.y),Z==="br"&&(st=he.x,it=he.y),S){const It=10/k.zoom,Ee=G.width/2,Ue=G.height/2;Z.includes("l")&&(pt=_e(pt,-Ee,It),pt=_e(pt,0,It),pt=_e(pt,Ee,It)),Z.includes("r")&&(st=_e(st,Ee,It),st=_e(st,0,It),st=_e(st,-Ee,It)),Z.includes("t")&&(ft=_e(ft,-Ue,It),ft=_e(ft,0,It),ft=_e(ft,Ue,It)),Z.includes("b")&&(it=_e(it,Ue,It),it=_e(it,0,It),it=_e(it,-Ue,It))}let wt=Math.abs(st-pt),dt=Math.abs(it-ft);if(!O&&rt.startAspectRatio){const It=rt.startAspectRatio;wt/It>dt?dt=wt/It:wt=dt*It,Z==="tl"&&(pt=st-wt,ft=it-dt),Z==="tr"&&(st=pt+wt,ft=it-dt),Z==="bl"&&(pt=st-wt,it=ft+dt),Z==="br"&&(st=pt+wt,it=ft+dt)}const _t=(pt+st)/2,cn=(ft+it)/2;v({x:_t,y:cn,width:wt,height:dt})}else{const he=Ce/k.zoom,ge=Se/k.zoom;let ve=rt.imgState.x+he,Ge=rt.imgState.y+ge;if(S){const Ve=10/k.zoom,ot=rt.imgState.width/2,Xe=rt.imgState.height/2,pt=G.width/2,st=G.height/2,ft=ve-ot,it=ve+ot,wt=Ge-Xe,dt=Ge+Xe;Math.abs(ft- -pt)<Ve?ve=-pt+ot:Math.abs(it-pt)<Ve?ve=pt-ot:Math.abs(ft-0)<Ve?ve=0+ot:Math.abs(it-0)<Ve?ve=0-ot:Math.abs(ve-0)<Ve&&(ve=0),Math.abs(wt- -st)<Ve?Ge=-st+Xe:Math.abs(dt-st)<Ve?Ge=st-Xe:Math.abs(wt-0)<Ve?Ge=0+Xe:Math.abs(dt-0)<Ve?Ge=0-Xe:Math.abs(Ge-0)<Ve&&(Ge=0)}v(Ve=>({...Ve,x:ve,y:Ge}))}else if(F==="pencil"){if(s.current){const he=s.current.getContext("2d");he&&(he.lineTo(Le.x,Le.y),he.stroke())}}else F==="rectangle"&&(re.current=Le)},Ze=()=>{if(ie(!1),se("none"),de.current=null,F==="rectangle"&&R.current&&re.current&&s.current){const ze=s.current.getContext("2d");if(ze){const je=R.current,Le=re.current,rt=Le.x-je.x,Ce=Le.y-je.y;ze.strokeStyle=$,ze.lineWidth=oe,ze.strokeRect(je.x,je.y,rt,Ce)}}R.current=null,re.current=null},$e=()=>{J.current=null,Ze()},He=ze=>{ze.preventDefault(),ze.stopPropagation();const je=Math.pow(1.001,-ze.deltaY),Le=Math.max(.1,Math.min(5,k.zoom*je));Pe(ze.clientX,ze.clientY,Le)},be=()=>{if(!l.current)return;const ze=l.current.width,je=l.current.height,Le=G.width,rt=G.height,Ce=Math.min(Le/ze,rt/je);v({x:0,y:0,width:ze*Ce,height:je*Ce})},Ae=()=>{if(!l.current)return;const ze=l.current.width,je=l.current.height,Le=G.width,rt=G.height,Ce=Math.max(Le/ze,rt/je);v({x:0,y:0,width:ze*Ce,height:je*Ce})},Te=()=>{var ze,je;if(v({x:0,y:0,width:((ze=l.current)==null?void 0:ze.width)||0,height:((je=l.current)==null?void 0:je.height)||0}),_(!1),I("free"),M("auto"),s.current){const Le=s.current.getContext("2d");Le&&Le.clearRect(0,0,s.current.width,s.current.height)}},qe=async()=>{if(!(!l.current||L)){W(!0);try{const ze=document.createElement("canvas");ze.width=l.current.width,ze.height=l.current.height;const je=ze.getContext("2d");if(!je)throw new Error("Could not get context");je.drawImage(l.current,0,0),s.current&&je.drawImage(s.current,0,0);const rt=ze.toDataURL("image/png").split(",")[1],he=await $n("Modify the image based on the colored markings: 1. REMOVE objects covered in RED. 2. STRICTLY PRESERVE and do NOT change objects covered in GREEN. Fill the removed red areas naturally to match the surroundings.","1:1",[{base64ImageData:rt,mimeType:"image/png"}],"gemini-3-flash-preview"),ge=new Image;ge.onload=()=>{if(l.current=ge,s.current){const ve=s.current.getContext("2d");ve==null||ve.clearRect(0,0,s.current.width,s.current.height)}W(!1)},ge.src=he}catch(ze){console.error("Error removing object:",ze),W(!1),alert("Failed to remove object. Please check console.")}}},Ye=async()=>{if(!(!l.current||L)){W(!0);try{const ze=document.createElement("canvas");ze.width=l.current.width,ze.height=l.current.height;const je=ze.getContext("2d");if(!je)throw new Error("Could not get context");je.drawImage(l.current,0,0);const rt=ze.toDataURL("image/png").split(",")[1],he=await $n("Replace the background with solid pure black color (#000000). Keep the main subject exactly identical.","1:1",[{base64ImageData:rt,mimeType:"image/png"}],"gemini-3-flash-preview"),ge=new Image;ge.crossOrigin="anonymous",ge.onload=()=>{l.current=ge,W(!1)},ge.src=he}catch{W(!1)}}},nt=async()=>{if(!(!l.current||L||!D.trim())){W(!0);try{const ze=document.createElement("canvas");ze.width=l.current.width,ze.height=l.current.height;const je=ze.getContext("2d");if(!je)throw new Error("Could not get context");je.drawImage(l.current,0,0),s.current&&je.drawImage(s.current,0,0);const rt=ze.toDataURL("image/png").split(",")[1],Se=await $n(D,"1:1",[{base64ImageData:rt,mimeType:"image/png"}],"gemini-3-flash-preview"),he=new Image;he.onload=()=>{if(l.current=he,s.current){const ge=s.current.getContext("2d");ge==null||ge.clearRect(0,0,s.current.width,s.current.height)}W(!1)},he.src=Se}catch(ze){console.error("Error requesting modification:",ze),W(!1),alert("Failed to request changes. Please check console.")}}},Nt=()=>{if(!i.current||!l.current)return;const ze=G.width,je=G.height,Le=document.createElement("canvas");Le.width=ze,Le.height=je;const rt=Le.getContext("2d");if(!rt)return;j!=="checkerboard"&&(rt.fillStyle=j,rt.fillRect(0,0,ze,je));const Ce=ze/2,Se=je/2;rt.save(),rt.translate(Ce,Se),rt.translate(h.x,h.y);const he=h.width,ge=h.height;N&&rt.scale(-1,1);const ve=l.current;rt.drawImage(ve,-he/2,-ge/2,he,ge),s.current&&rt.drawImage(s.current,-he/2,-ge/2,he,ge),rt.restore();const Ge=Le.toDataURL("image/png");o(Ge),t()};return e?Xw.createPortal(n.jsx("div",{className:`fixed inset-0 z-[${u}] pointer-events-none transition-opacity duration-300 ease-out ${x?"opacity-100":"opacity-0"}`,children:n.jsxs("div",{ref:c,className:"absolute bg-gray-800 rounded-lg shadow-2xl border-2 border-gray-700 flex flex-col pointer-events-auto overflow-hidden",onMouseDown:X,style:m?{left:0,top:0,width:"100%",height:"100%",borderRadius:0,border:"none"}:{left:H.x,top:H.y,width:ee.width,height:ee.height,maxWidth:"98vw",maxHeight:"98vh",minWidth:"800px",minHeight:"600px",resize:"both"},onMouseUp:pe,children:[n.jsx(FP,{onClose:t,onPointerDown:ue,onPointerMove:Q,onPointerUp:ce}),n.jsxs("div",{className:"flex-grow min-h-0 flex",children:[n.jsx(BP,{resolution:B,setResolution:M,aspectRatio:E,setAspectRatio:I,backgroundType:j,setBackgroundType:P,activeTool:F,isSnappingEnabled:S,setIsSnappingEnabled:A,isFreeAspect:O,setIsFreeAspect:z,brushSize:oe,setBrushSize:le,modificationPrompt:D,setModificationPrompt:T,isProcessing:L,handleRequestModification:nt,handleRemoveObject:qe,handleRemoveBackground:Ye,canvasSize:G}),n.jsxs("div",{className:"flex-grow bg-black/90 relative overflow-hidden flex items-center justify-center",style:{cursor:F==="hand"?K?"grabbing":"grab":"default"},children:[n.jsx(HP,{activeTool:F,setActiveTool:te,onFit:be,onFill:Ae,onFlip:()=>_(ze=>!ze)}),n.jsx("canvas",{ref:i,onMouseDown:Fe,onMouseMove:We,onMouseUp:Ze,onMouseLeave:$e,onWheel:He,onContextMenu:ze=>ze.preventDefault()})]}),n.jsx($P,{color:$,onChange:Y})]}),n.jsx(GP,{zoom:k.zoom,onZoomChange:ye,onClose:t,onReset:Te,onApply:Nt,isProcessing:L})]})}),document.body):null},KP="Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.",sc=async(e,t,o="",r="gemini-3-flash-preview",a=KP)=>{var p;const{formattedImage:i}=await kr(e,t),l=i.split(",")[1],c=((p=i.match(/:(.*?);/))==null?void 0:p[1])||"image/png",d=o?`${o}. ${a}`:`High quality image. ${a}`;return await $n(d,t,[{base64ImageData:l,mimeType:c}],r)},JP=({node:e,onValueChange:t,onProcessImage:o,isProcessingImage:r,onPasteImage:a,t:i,deselectAllNodes:s,getFullSizeImage:l,setImageViewer:c,setFullSizeImage:d,onCopyImageToClipboard:u,onDownloadImage:p,addToast:m,onAddNode:w,onDeleteNode:k,onImageToText:b,isAnalyzingImage:x})=>{const f=Kt(),h=w||(f==null?void 0:f.onAddNode),v=k||(f==null?void 0:f.deleteNodeAndConnections),N=f==null?void 0:f.setSelectedNodeIds,_=y.useRef(null),[E,I]=y.useState(null),[B,M]=y.useState(!1),[G,V]=y.useState(!1),[j,P]=y.useState(null),[S,A]=y.useState(null),O=(e.height??0)>=460,z=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{image:e.value.startsWith("data:image")?e.value:null,prompt:""}}},[e.value]),{image:L,prompt:W}=z,D=l(e.id,0);y.useEffect(()=>{const H=D||L;if(!H){A(null);return}const U=new Image;U.onload=()=>{A({width:U.naturalWidth,height:U.naturalHeight})},U.src=H},[D,L]);const T=H=>{t(e.id,JSON.stringify({...z,...H}))},F=async H=>{const U=await kl(H);I(U);const ee=await Ot(H,256,256);d(e.id,0,H),T({image:ee})},te=H=>{var ee;const U=(ee=H.target.files)==null?void 0:ee[0];U&&a(e.id,U)},$=H=>{H.preventDefault(),H.stopPropagation(),M(!0);const U=document.getElementById("app-container");U&&U.classList.remove("ring-2","ring-cyan-500","ring-inset")},Y=H=>{H.preventDefault(),H.stopPropagation(),M(!0)},oe=H=>{H.preventDefault(),H.stopPropagation(),M(!1)},le=H=>{var ae;H.preventDefault(),H.stopPropagation(),M(!1);const U=H.dataTransfer.getData("application/prompt-modifier-drag-image");if(U){fetch(U).then(xe=>xe.blob()).then(xe=>{const ne=new File([xe],"dragged_image.png",{type:xe.type});a(e.id,ne)});return}const ee=(ae=H.dataTransfer.files)==null?void 0:ae[0];ee&&ee.type.startsWith("image/")&&a(e.id,ee)},K=H=>{F(H)},ie=H=>{if(H.stopPropagation(),!L)return;const U=l(e.id,0)||L;U&&c({sources:[{src:U,frameNumber:0,prompt:W||"Input Image"}],initialIndex:0})},Z=H=>{H.stopPropagation();const U=l(e.id,0)||L;U&&u&&u(U)},se=H=>{H.stopPropagation(),p&&p(e.id)},de=H=>{H.stopPropagation(),T({image:null}),m&&m(i("toast.contentCleared"))},re=async H=>{const U=l(e.id,0)||L;if(U){P(H);try{const ee=await sc(U,H,W);await F(ee),m&&m(`Converted to ${H} successfully`,"success")}catch(ee){console.error("Ratio expansion failed:",ee),m&&m(`Failed to convert: ${ee.message}`,"error")}finally{P(null)}}},R=(H,U)=>{if(!h)return;const ee=l(e.id,0)||L;if(!ee)return;let ae={x:e.position.x,y:e.position.y};H.shiftKey||(ae={x:e.position.x+e.width+50,y:e.position.y});const xe=h(U,ae);U===q.IMAGE_ANALYZER?(t(xe,JSON.stringify({image:L,description:"",softPrompt:!1})),d(xe,0,ee)):U===q.IMAGE_EDITOR&&(t(xe,JSON.stringify({inputImages:[L],prompt:W||"",outputImage:null,aspectRatio:"1:1",enableAspectRatio:!1,enableOutpainting:!1,outpaintingPrompt:"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.",model:"gemini-2.5-flash-image",autoDownload:!0,autoCrop169:!1,leftPaneWidth:280,topPaneHeight:320})),d(xe,1,ee)),N&&N([xe]),H.shiftKey&&v&&v(e.id)},J=H=>{H.stopPropagation();const U=O?340:560;f!=null&&f.setNodes&&f.setNodes(ee=>ee.map(ae=>ae.id===e.id?{...ae,height:U}:ae))};return n.jsxs("div",{className:"flex flex-col h-full space-y-2","data-node-id":e.id,children:[n.jsx(ic,{isOpen:G,onClose:()=>V(!1),onApply:K,imageSrc:l(e.id,0)||L}),n.jsx("input",{ref:_,type:"file",accept:"image/*",className:"hidden",onChange:te}),n.jsxs("div",{className:"flex-grow min-h-0 relative group rounded-md overflow-hidden bg-gray-700",children:[n.jsx("div",{onClick:()=>{var H;return(H=_.current)==null?void 0:H.click()},onDragEnter:$,onDragOver:Y,onDragLeave:oe,onDrop:le,className:`w-full h-full flex items-center justify-center cursor-pointer transition-all relative ${B?"bg-gray-600 ring-2 ring-accent":"hover:bg-gray-600"}`,children:L?n.jsxs(n.Fragment,{children:[n.jsx("img",{src:L||l(e.id,0),alt:"Input",className:"object-contain w-full h-full",draggable:!0,onMouseDown:H=>H.stopPropagation(),onClick:ie,onDragStart:H=>{const U=l(e.id,0)||L;if(U){H.dataTransfer.setData("application/prompt-modifier-drag-image",U);const ee=`Input_Image_${Date.now()}.png`;H.dataTransfer.setData("DownloadURL",`image/png:${ee}:${U}`),H.dataTransfer.setData("text/html",`<img src="${U}" alt="Image Input" />`),H.dataTransfer.setData("text/uri-list",U),H.dataTransfer.effectAllowed="copy",H.stopPropagation()}}}),n.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"}),S&&n.jsxs("div",{className:"absolute bottom-2 left-2 z-20 bg-black/60 text-gray-300 text-[10px] px-1.5 py-0.5 rounded pointer-events-none backdrop-blur-sm font-mono",children:[S.width,"x",S.height]}),n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity z-10 bg-black/60 backdrop-blur-sm p-1 rounded-md",children:[n.jsx(we,{title:i("node.action.download"),onClick:se,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(we,{title:i("node.action.copy"),onClick:Z,children:n.jsx(zt,{className:"h-4 w-4"})}),n.jsx(we,{title:i("node.action.clear"),onClick:de,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}):n.jsx("span",{className:"text-gray-400 pointer-events-none",children:i("node.content.dropImage")})}),n.jsxs("div",{className:"absolute bottom-2 right-2 z-20 flex gap-1 items-center",children:[!O&&L&&n.jsxs(n.Fragment,{children:[n.jsx(mt,{content:i("node.action.rasterEditor"),children:n.jsx("button",{onClick:H=>{H.stopPropagation(),V(!0)},className:"p-1 bg-gray-900/60 hover:bg-gray-700 text-gray-400 hover:text-white rounded transition-colors shadow-sm",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})})}),n.jsx(mt,{content:i("node.action.openInAIEditor"),children:n.jsx("button",{onClick:H=>{H.stopPropagation(),R(H,q.IMAGE_EDITOR)},className:"p-1 bg-gray-900/60 hover:bg-gray-700 text-gray-400 hover:text-white rounded transition-colors shadow-sm",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})})})]}),n.jsx(mt,{content:O?" ":" ",children:n.jsx("button",{onClick:J,className:"p-1 bg-gray-900/60 hover:bg-gray-700 text-gray-400 hover:text-white rounded transition-colors shadow-sm",children:O?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})})})]})]}),O&&n.jsxs("div",{className:"flex-shrink-0 flex flex-col space-y-2 h-[220px] overflow-hidden",children:[n.jsxs("div",{className:"flex gap-2 shrink-0 h-[80px]",children:[n.jsxs("div",{className:"flex-[1.2] flex flex-col gap-2 min-w-0",children:[n.jsx(mt,{content:i("node.action.processImageTitle"),className:"w-full",children:n.jsxs("button",{onClick:()=>o(e.id),disabled:r||!L||!!j,className:"w-full h-9 px-3 text-sm font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 truncate flex items-center justify-center gap-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z"})}),n.jsx("span",{className:"truncate",children:i(r?"node.content.processing":"node.action.processImage")})]})}),n.jsxs("div",{className:"grid grid-cols-4 gap-1 h-9",children:[n.jsx(mt,{content:i("node.action.openInAnalyzer"),children:n.jsx("button",{onClick:H=>R(H,q.IMAGE_ANALYZER),disabled:!L,className:"w-full h-full flex items-center justify-center bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-white",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12.792V5.25a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 5.25v13.5A2.25 2.25 0 005.25 21h7.55"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 18.375L21 21"})]})})}),n.jsx(mt,{content:i("node.content.imageToText"),children:n.jsx("button",{onClick:()=>b&&b(e.id),disabled:!L||x||!b,className:"w-full h-full flex items-center justify-center bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:x?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-white",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})})})}),n.jsx(mt,{content:i("node.action.expand169"),children:n.jsx("button",{onClick:()=>re("16:9"),disabled:!L||r||!!j,className:"w-full h-full px-1 text-[10px] font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center gap-1",children:j==="16:9"?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsxs(n.Fragment,{children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 hidden sm:block",children:n.jsx("rect",{x:"2",y:"6",width:"20",height:"12",rx:"2"})}),n.jsx("span",{children:"16:9"})]})})}),n.jsx(mt,{content:i("node.action.expand916"),children:n.jsx("button",{onClick:()=>re("9:16"),disabled:!L||r||!!j,className:"w-full h-full px-1 text-[10px] font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center gap-1",children:j==="9:16"?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsxs(n.Fragment,{children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 hidden sm:block",children:n.jsx("rect",{x:"6",y:"2",width:"12",height:"20",rx:"2"})}),n.jsx("span",{children:"9:16"})]})})})]})]}),n.jsxs("div",{className:"flex-1 flex flex-col gap-2 min-w-0",children:[n.jsx(mt,{content:i("node.action.rasterEditor"),className:"w-full",children:n.jsxs("button",{onClick:()=>V(!0),disabled:!L,className:"w-full h-9 px-2 text-xs font-bold text-white bg-accent-secondary rounded-md hover:bg-accent-secondary-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center gap-1.5",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 shrink-0",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})}),n.jsx("span",{className:"truncate",children:i("node.action.rasterEditor")})]})}),n.jsx(mt,{content:i("node.action.openInAIEditor"),className:"w-full",children:n.jsxs("button",{onClick:H=>R(H,q.IMAGE_EDITOR),disabled:!L,className:"w-full h-9 px-2 text-xs font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center gap-1.5",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 shrink-0",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})}),n.jsx("span",{className:"truncate",children:i("node.action.openInAIEditor")})]})})]})]}),E&&n.jsxs("div",{className:"flex-shrink-0 relative",children:[n.jsx("div",{className:"absolute top-0 right-0 z-10",children:n.jsx("button",{onClick:()=>{T({prompt:`${W?W+", ":""}${E}`}),I(null)},className:"px-2 py-0.5 text-[10px] font-bold bg-accent hover:bg-accent-hover text-white rounded shadow-sm",title:i("node.action.copyPrompt"),children:"Use"})}),n.jsx("textarea",{readOnly:!0,value:E,placeholder:i("node.content.metadataPromptPlaceholder"),className:"w-full p-2 text-xs bg-input/50 rounded-md resize-none focus:outline-none text-gray-400 italic border border-gray-600/50",rows:2,onWheel:H=>H.stopPropagation(),onFocus:s})]}),n.jsxs("div",{className:"flex-grow min-h-0 flex flex-col relative",children:[n.jsx("textarea",{value:W||"",onChange:H=>T({prompt:H.target.value}),placeholder:i("node.content.prompt"),className:"w-full h-full p-2 bg-[#18202f] border border-gray-600 rounded-md resize-none focus:ring-1 focus:ring-accent focus:border-accent focus:outline-none custom-scrollbar text-sm",onWheel:H=>H.stopPropagation(),onMouseDown:H=>H.stopPropagation(),onFocus:s}),n.jsx("div",{className:"absolute bottom-2 right-2 opacity-50 hover:opacity-100 transition-opacity",children:n.jsx(we,{title:i("node.action.copy"),onClick:()=>navigator.clipboard.writeText(W||""),children:n.jsx(zt,{className:"h-4 w-4"})})})]})]})]})},YP=({node:e,onValueChange:t,onTranslate:o,isTranslating:r,connectedInputs:a,t:i,onSelectNode:s,onPasteImage:l,getFullSizeImage:c,setImageViewer:d})=>{const u=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{inputText:"",targetLanguage:"ru",translatedText:"",image:null}}},[e.value]),{inputText:p="",targetLanguage:m="ru",translatedText:w="",image:k=null}=u,b=a==null?void 0:a.has(void 0),x=E=>{const I={...u,...E};delete I.inputHeight,t(e.id,JSON.stringify(I))},f=E=>{E.stopPropagation(),l(e.id)},h=E=>{E.stopPropagation(),x({inputText:""})},v=E=>{E.stopPropagation(),x({image:null})},N=E=>{E.stopPropagation(),k&&d({sources:[{src:k,frameNumber:0,prompt:"Input Image"}],initialIndex:0})},_=Object.entries(xn);return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex-shrink-0 mb-2 flex items-end space-x-2",onMouseDown:E=>{E.stopPropagation(),s()},children:[n.jsxs("div",{className:"flex-grow",children:[n.jsx("label",{htmlFor:`lang-select-${e.id}`,className:"block text-xs font-medium text-gray-400 mb-1",children:i("node.content.targetLanguage")}),n.jsx(An,{id:`lang-select-${e.id}`,value:m,onChange:E=>x({targetLanguage:E}),disabled:r,options:_.map(([E,{name:I}])=>({value:E,label:I}))})]}),n.jsx("button",{onClick:f,className:"h-[38px] px-3 bg-accent-secondary hover:bg-accent-secondary-hover text-white rounded-md transition-colors flex items-center justify-center shadow-sm",title:i("node.action.paste"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),n.jsx(mt,{content:"Model: gemini-3-flash-preview",position:"top",children:n.jsx("button",{onClick:()=>o(e.id),disabled:r||!b&&!p.trim()&&!k,className:"h-[38px] px-4 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors duration-200 flex-shrink-0 shadow-sm",children:i(r?"node.content.translating":"node.content.translate")})})]}),n.jsxs("div",{className:"flex-1 min-h-0 mb-2 flex flex-col gap-2",children:[k&&n.jsxs("div",{className:"relative h-24 w-full bg-gray-900/50 rounded-md border border-gray-600 flex-shrink-0 group overflow-hidden",children:[n.jsx("img",{src:k,alt:"Input",className:"w-full h-full object-contain cursor-pointer",onClick:N}),n.jsx("div",{className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsx(we,{title:i("node.action.clear"),onClick:v,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})})]}),n.jsxs("div",{className:"relative flex-grow h-full",children:[n.jsx("textarea",{value:p,onChange:E=>x({inputText:E.target.value}),placeholder:i(b?"node.content.connectedPlaceholder":"node.content.translatePlaceholder"),className:"w-full h-full p-2 bg-input border border-gray-700/50 rounded-md resize-none focus:ring-1 focus:ring-accent focus:border-accent focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 custom-scrollbar",onWheel:E=>E.stopPropagation(),onMouseDown:E=>{E.stopPropagation(),s()},disabled:b}),!b&&p&&n.jsx("div",{className:"absolute top-1 right-1 opacity-50 hover:opacity-100 transition-opacity",children:n.jsx(we,{title:i("node.action.clear"),onClick:h,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})})]})]}),n.jsxs("div",{className:"flex-1 min-h-0 relative",children:[n.jsx("textarea",{value:w,onChange:E=>x({translatedText:E.target.value}),placeholder:i("node.content.translatedTextPlaceholder"),className:"w-full h-full p-2 bg-input border border-gray-700/50 rounded-md resize-none focus:ring-1 focus:ring-accent focus:border-accent focus:outline-none custom-scrollbar",onWheel:E=>E.stopPropagation(),onMouseDown:E=>{E.stopPropagation(),s()}}),n.jsx("div",{className:"absolute top-1 right-1 opacity-50 hover:opacity-100 transition-opacity",children:n.jsx(we,{title:i("node.action.copy"),onClick:E=>{E.stopPropagation(),navigator.clipboard.writeText(w)},children:n.jsx(zt,{className:"h-4 w-4"})})})]})]})},Cs=e=>{let t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");return t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer" class="text-cyan-400 hover:text-cyan-300 underline decoration-cyan-500/50 hover:decoration-cyan-300 transition-colors break-words">$1</a>'),t=t.replace(/\*\*(.*?)\*\*/g,'<strong class="text-accent-text font-bold">$1</strong>'),t=t.replace(/__(.*?)__/g,'<strong class="text-accent-text font-bold">$1</strong>'),t=t.replace(/`([^`]+)`/g,'<code class="bg-gray-800 px-1 rounded text-accent-text font-mono text-xs">$1</code>'),t},g0=({code:e})=>{const[t,o]=y.useState(!1),r=()=>{navigator.clipboard.writeText(e),o(!0),setTimeout(()=>o(!1),2e3)};return n.jsxs("div",{className:"relative group/code my-2",children:[n.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover/code:opacity-100 transition-opacity z-10",children:n.jsx("button",{onClick:r,className:"p-1.5 bg-gray-700 hover:bg-accent text-gray-300 hover:text-white rounded text-xs flex items-center gap-1 shadow-sm transition-colors",title:t?"Copied!":"Copy Code",children:t?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):n.jsx(zt,{className:"h-4 w-4"})})}),n.jsx("pre",{className:"bg-gray-900/80 p-3 rounded-md border border-gray-600 text-accent-text overflow-x-auto font-mono text-xs shadow-inner [&::-webkit-scrollbar]:h-2 [&::-webkit-scrollbar-track]:bg-transparent [&::-webkit-scrollbar-thumb]:bg-gray-600 [&::-webkit-scrollbar-thumb]:rounded-full hover:[&::-webkit-scrollbar-thumb]:bg-gray-500 select-text",children:n.jsx("code",{children:e})})]})},XP=At.memo(({content:e})=>{const t=e.split(/(```prompt\n[\s\S]*?\n```|```[\s\S]*?```)/g);return n.jsx("div",{className:"text-sm leading-relaxed space-y-2 text-gray-200 break-words cursor-text",children:t.map((o,r)=>{const a=o.match(/```prompt\n([\s\S]*?)\n```/);if(a)return n.jsx(g0,{code:a[1].trim()},r);const i=o.match(/```([\s\S]*?)```/);if(i){let p=i[1];const m=p.indexOf(`
`);if(m!==-1){const w=p.substring(0,m).trim();w&&!w.includes(" ")&&(p=p.substring(m+1))}return n.jsx(g0,{code:p.trim()},r)}if(!o.trim())return null;const s=o.split(`
`),l=[];let c=[],d=!1;const u=()=>{c.length>0&&(d?l.push(n.jsx("ol",{className:"list-decimal list-outside ml-4 space-y-1 mb-2 marker:text-gray-500 select-text",children:[...c]},`list-${r}-${l.length}`)):l.push(n.jsx("ul",{className:"list-disc list-outside ml-4 space-y-1 mb-2 marker:text-gray-500 select-text",children:[...c]},`list-${r}-${l.length}`)),c=[])};return s.forEach((p,m)=>{const w=p.match(/^(\d+)\.\s+(.*)/),k=p.match(/^[\*\-]\s+(.*)/),b=p.match(/^(#{1,6})\s+(.*)/);if(w){c.length>0&&!d&&u(),d=!0;const x=parseInt(w[1],10);c.push(n.jsx("li",{value:x,dangerouslySetInnerHTML:{__html:Cs(w[2])}},m))}else if(k)c.length>0&&d&&u(),d=!1,c.push(n.jsx("li",{dangerouslySetInnerHTML:{__html:Cs(k[1])}},m));else if(u(),b){const x=b[1].length,f=x===1?"text-lg":x===2?"text-base":"text-sm";l.push(n.jsx("div",{className:`${f} font-bold text-accent-text mt-3 mb-1 border-b border-gray-700/50 pb-1 select-text`,dangerouslySetInnerHTML:{__html:Cs(b[2])}},m))}else p.trim()===""?l.push(n.jsx("div",{className:"h-2"},m)):l.push(n.jsx("div",{className:"min-h-[1.2em] select-text",dangerouslySetInnerHTML:{__html:Cs(p)}},m))}),u(),n.jsx("div",{className:"select-text",children:l},r)})})}),ZP=({label:e,icon:t,isActive:o,onClick:r})=>{const[a,i]=y.useState(!1);return n.jsxs("button",{onClick:r,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),onMouseDown:s=>s.stopPropagation(),className:`
                relative flex items-center justify-center px-3 py-1.5 transition-all duration-300 ease-in-out h-full overflow-hidden
                rounded-t-md rounded-b-none border-b-2
                ${o?"bg-gray-800 text-accent-text border-accent flex-grow shadow-[inset_0_-2px_10px_rgba(0,0,0,0.3)]":"bg-transparent text-gray-500 hover:text-gray-300 hover:bg-gray-800/30 border-transparent flex-none"}
            `,children:[n.jsx("span",{className:`z-10 transition-transform duration-300 ${o?"scale-110":"scale-100"}`,children:t}),n.jsx("div",{className:`overflow-hidden transition-all duration-300 ${o?"max-w-[120px] ml-2 opacity-100":"max-w-0 ml-0 opacity-0"}`,children:n.jsx("span",{className:"text-xs font-bold whitespace-nowrap",children:e})}),!o&&a&&n.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-xs whitespace-nowrap rounded shadow-xl z-50 pointer-events-none animate-fade-in-up",children:[e,n.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-700"})]})]})},QP=({selection:e,onCopy:t,rootRef:o,scale:r})=>{const[a,i]=y.useState(null);return y.useEffect(()=>{if(!e||e.rangeCount===0||e.toString().length===0){i(null);return}const s=e.getRangeAt(0),l=s.getBoundingClientRect();if(o.current&&!o.current.contains(s.commonAncestorContainer)){i(null);return}if(!o.current)return;const c=o.current.getBoundingClientRect(),d=(l.top-c.top)/r-40,u=(l.left-c.left)/r+l.width/r/2;i({top:d,left:u})},[e,o,r]),a?n.jsxs("button",{onClick:s=>{s.preventDefault(),s.stopPropagation(),t()},style:{top:a.top,left:a.left,transform:"translateX(-50%)"},className:"absolute z-[100] px-3 py-1.5 bg-gray-800 text-white text-xs font-bold rounded-lg shadow-xl border border-gray-600 hover:bg-gray-700 hover:border-cyan-500 transition-all flex items-center gap-2 animate-fade-in-up",children:[n.jsx(zt,{className:"h-3 w-3"}),"Copy"]}):null},ej=({node:e,onValueChange:t,onSendMessage:o,isChatting:r,t:a,onSelectNode:i,addToast:s})=>{var D;const l=Kt(),c=(l==null?void 0:l.viewTransform.scale)||1,d=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{messages:[],currentInput:"",style:"general",attachment:null,model:"gemini-3-flash-preview"}}},[e.value]),{messages:u=[],currentInput:p="",style:m="general",attachment:w=null,model:k="gemini-3-flash-preview"}=d,b=y.useRef(null),x=y.useRef(!0),f=y.useRef(null),h=y.useRef(null),v=y.useRef(null),[N,_]=y.useState(null);y.useLayoutEffect(()=>{const T=v.current;if(!T)return;T.style.height="120px";const F=T.scrollHeight,te=Math.min(Math.max(120,F),200);T.style.height=`${te}px`,T.style.overflowY=F>200?"auto":"hidden"},[p]);const E=T=>{T.stopPropagation();const{scrollTop:F,scrollHeight:te,clientHeight:$}=T.currentTarget;x.current=Math.abs(te-$-F)<50};y.useEffect(()=>{b.current&&x.current&&b.current.scrollTo({top:b.current.scrollHeight,behavior:"smooth"})},[u,r]),y.useEffect(()=>{const T=()=>{const F=window.getSelection();if(F&&F.toString().length>0&&b.current&&b.current.contains(F.anchorNode)){_(F);return}_(null)};return document.addEventListener("selectionchange",T),()=>document.removeEventListener("selectionchange",T)},[]);const I=()=>{r||(o(e.id),x.current=!0)},B=T=>{t(e.id,JSON.stringify({...d,style:T}))},M=T=>{t(e.id,JSON.stringify({...d,model:T}))},G=()=>{var T;(T=h.current)==null||T.click()},V=async T=>{var $;const F=($=T.target.files)==null?void 0:$[0];if(!F)return;const te=new FileReader;te.onload=Y=>{var K;const oe=(K=Y.target)==null?void 0:K.result,le={name:F.name,type:F.type,data:oe};t(e.id,JSON.stringify({...d,attachment:le})),s&&s("File attached","success")},te.readAsDataURL(F),T.target.value=""},j=async()=>{try{const T=await navigator.clipboard.read();for(const F of T)if(F.types.some(te=>te.startsWith("image/"))){const te=await F.getType(F.types.find(oe=>oe.startsWith("image/"))),$=new File([te],"pasted_image.png",{type:te.type}),Y=new FileReader;Y.onload=oe=>{var K;const le=(K=oe.target)==null?void 0:K.result;t(e.id,JSON.stringify({...d,attachment:{name:$.name,type:$.type,data:le}})),s&&s(a("toast.pastedFromClipboard"),"success")},Y.readAsDataURL($);return}try{const F=await navigator.clipboard.readText();F&&(t(e.id,JSON.stringify({...d,currentInput:p+F})),s&&s(a("toast.pastedFromClipboard"),"success"))}catch{}}catch{try{const F=await navigator.clipboard.readText();F&&t(e.id,JSON.stringify({...d,currentInput:p+F}))}catch{s&&s(a("toast.pasteFailed"),"error")}}},P=()=>{t(e.id,JSON.stringify({...d,attachment:null}))},S=()=>{N&&(navigator.clipboard.writeText(N.toString()),s&&s(a("toast.copiedToClipboard")),N.removeAllRanges(),_(null))},A=T=>{const F=new Blob([T],{type:"text/plain"}),te=URL.createObjectURL(F),$=document.createElement("a");$.href=te;const Y=new Date().toISOString().replace(/[:.]/g,"-");$.download=`Gemini_Chat_${Y}.txt`,document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(te)},O=T=>{let F=T.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");F=F.replace(/^### (.*$)/gim,`<h3 style="color: #0891b2; font-size: 14pt; margin-top: 12pt; margin-bottom: 3pt; font-family: 'Calibri Light', sans-serif;">$1</h3>`),F=F.replace(/^## (.*$)/gim,`<h2 style="color: #0891b2; font-size: 16pt; margin-top: 14pt; margin-bottom: 6pt; font-family: 'Calibri Light', sans-serif;">$1</h2>`),F=F.replace(/^# (.*$)/gim,`<h1 style="color: #0891b2; font-size: 18pt; margin-top: 16pt; margin-bottom: 6pt; font-family: 'Calibri Light', sans-serif;">$1</h1>`),F=F.replace(/\*\*(.*?)\*\*/g,'<b style="color: #0891b2;">$1</b>'),F=F.replace(/__(.*?)__/g,'<b style="color: #0891b2;">$1</b>'),F=F.replace(/\*(.*?)\*/g,"<i>$1</i>"),F=F.replace(/_(.*?)_/g,"<i>$1</i>"),F=F.replace(/```([\s\S]*?)```/g,(K,ie)=>`<div style="background-color: #f5f5f5; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-family: 'Courier New', monospace; font-size: 10pt; margin: 10px 0;">${ie.replace(/\n/g,"<br>")}</div>`),F=F.replace(/`([^`]+)`/g,`<span style="background-color: #f0f0f0; padding: 2px; border-radius: 4px; font-family: 'Courier New', monospace; color: #d63384; font-size: 10pt;">$1</span>`),F=F.replace(/\n/g,"<br>");const te=`
            <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
            <head>
                <meta charset='utf-8'>
                <title>Gemini Export</title>
                <style>
                    body { font-family: 'Calibri', 'Arial', sans-serif; font-size: 11pt; color: #000000; line-height: 1.5; }
                    h1, h2, h3, h4, h5, h6 { font-family: 'Calibri Light', 'Arial', sans-serif; color: #0891b2; }
                    strong, b { color: #0891b2; }
                </style>
            </head>
            <body>
                ${F}
            </body>
            </html>
        `,$=new Blob(["\uFEFF",te],{type:"application/msword"}),Y=URL.createObjectURL($),oe=document.createElement("a");oe.href=Y;const le=new Date().toISOString().replace(/[:.]/g,"-");oe.download=`Gemini_Chat_${le}.doc`,document.body.appendChild(oe),oe.click(),document.body.removeChild(oe),URL.revokeObjectURL(Y)},z=[{id:"general",label:a("geminiChat.mode.general"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})},{id:"friend",label:a("geminiChat.mode.friend"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0h-14z",clipRule:"evenodd"})})},{id:"prompt",label:a("geminiChat.mode.prompt"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-4 w-4",children:[n.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 15-5-5L5 21"})]})},{id:"script",label:a("geminiChat.mode.script"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})},{id:"youtube",label:a("geminiChat.mode.youtube"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})},{id:"developer",label:a("geminiChat.mode.developer"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"})})}],L=(D=z.find(T=>T.id===m))==null?void 0:D.label,W=T=>{T.stopPropagation()};return n.jsxs("div",{className:"flex flex-col h-full relative",ref:f,children:[n.jsx("input",{type:"file",ref:h,className:"hidden",onChange:V,accept:"image/*,.txt,.pdf,.json"}),N&&n.jsx(QP,{selection:N,onCopy:S,rootRef:f,scale:c}),n.jsxs("div",{className:"flex items-end bg-gray-900/30 px-1 pt-1 rounded-md mb-2 shrink-0 justify-between gap-2 h-10 border-b border-gray-700/50",onMouseDown:T=>{T.stopPropagation(),i()},children:[n.jsx("div",{className:"flex gap-1 flex-1 h-full items-end",children:z.map(T=>n.jsx(ZP,{id:T.id,label:T.label,icon:T.icon,isActive:m===T.id,onClick:()=>B(T.id)},T.id))}),n.jsxs("div",{className:"relative flex bg-gray-800 rounded p-0.5 border border-gray-700 h-8 items-center w-16 isolate self-center",children:[n.jsx("div",{className:`absolute top-0.5 bottom-0.5 w-[calc(50%-2px)] bg-accent rounded-sm shadow-md transition-all duration-300 ease-[cubic-bezier(0.25,0.1,0.25,1.0)] z-0 ${k==="gemini-3-flash-preview"?"left-0.5":"left-[calc(50%+1px)]"}`}),n.jsx(mt,{content:"Flash 3.0",position:"top",className:"h-full flex-1",usePortal:!1,children:n.jsx("button",{onClick:()=>M("gemini-3-flash-preview"),disabled:r,className:`relative z-10 w-full h-full flex items-center justify-center rounded-sm transition-colors duration-200 ${k==="gemini-3-flash-preview"?"text-white":"text-gray-500 hover:text-gray-300"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:"M13 10V3L4 14h7v7l9-11h-7z"})})})}),n.jsx(mt,{content:"Pro 3.0",position:"top",className:"h-full flex-1",usePortal:!1,children:n.jsx("button",{onClick:()=>M("gemini-3-pro-preview"),disabled:r,className:`relative z-10 w-full h-full flex items-center justify-center rounded-sm transition-colors duration-200 ${k==="gemini-3-pro-preview"?"text-white":"text-gray-500 hover:text-gray-300"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:"M12 2L15 9L22 12L15 15L12 22L9 15L2 12L9 9L12 2Z"})})})})]})]}),n.jsxs("div",{ref:b,onWheel:T=>T.stopPropagation(),onScroll:E,className:"flex-grow p-2 bg-gray-900/50 rounded-md overflow-y-auto overflow-x-hidden mb-1 space-y-4 custom-scrollbar select-text cursor-text",onMouseDown:W,onMouseMove:W,onMouseUp:W,onClick:W,children:[u.length===0&&n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-500 space-y-2 opacity-50 select-none pointer-events-none",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),n.jsx("span",{className:"text-xs font-medium",children:L}),n.jsx("span",{className:"text-[10px] text-gray-600",children:k==="gemini-3-pro-preview"?"Pro 3.0":"Flash 3.0"})]}),u.map((T,F)=>n.jsx("div",{className:`flex ${T.role==="user"?"justify-end":"justify-start"}`,children:n.jsxs("div",{className:`relative group max-w-[90%] p-3 rounded-lg select-text flex gap-2 ${T.role==="user"?"bg-accent text-white shadow-md":"bg-gray-800 border border-gray-700"}`,children:[n.jsx("div",{className:"min-w-0 flex-grow",children:T.role==="model"?n.jsx(XP,{content:T.content}):n.jsx("p",{className:`text-sm whitespace-pre-wrap break-words select-text ${T.role==="user"?"text-white":"text-gray-200"}`,children:T.content})}),T.role==="model"&&n.jsx("div",{className:"flex flex-col justify-start shrink-0 self-stretch",children:n.jsxs("div",{className:"sticky top-2 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col gap-1",children:[n.jsx(we,{title:a("node.action.copy"),onClick:te=>{te.stopPropagation(),navigator.clipboard.writeText(T.content),s(a("toast.copiedToClipboard"))},className:"p-1.5 bg-gray-800/80 rounded-md text-gray-400 hover:text-white border border-gray-600 hover:border-gray-500 shadow-sm",tooltipPosition:"left",children:n.jsx(zt,{className:"h-3 w-3"})}),n.jsx(we,{title:a("node.action.downloadTxt"),onClick:te=>{te.stopPropagation(),A(T.content)},className:"p-1.5 bg-gray-800/80 rounded-md text-gray-400 hover:text-white border border-gray-600 hover:border-gray-500 shadow-sm",tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),n.jsx(we,{title:a("node.action.downloadDoc"),onClick:te=>{te.stopPropagation(),O(T.content)},className:"p-1.5 bg-gray-800/80 rounded-md text-gray-400 hover:text-white border border-gray-600 hover:border-gray-500 shadow-sm",tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})})]})})]})},F)),r&&n.jsx("div",{className:"flex justify-start",children:n.jsx("div",{className:"p-3 rounded-lg bg-gray-800 border border-gray-700",children:n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce"}),n.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),n.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})})]}),n.jsxs("div",{className:"relative w-full group flex-shrink-0 bg-gray-700 rounded-md border-none focus-within:ring-1 focus-within:ring-node-selected transition-shadow",children:[w&&n.jsxs("div",{className:"absolute -top-8 left-2 bg-gray-800 text-accent-text text-xs px-2 py-1 rounded-t-md border border-accent/50 border-b-0 flex items-center gap-2 max-w-[200px] shadow-sm z-0",children:[n.jsx("span",{className:"truncate",children:w.name}),n.jsx("button",{onClick:T=>{T.stopPropagation(),P()},className:"text-gray-500 hover:text-red-400",title:"Remove attachment",children:""})]}),n.jsx("textarea",{ref:v,value:p,onChange:T=>t(e.id,JSON.stringify({...d,currentInput:T.target.value})),onKeyDown:T=>{T.stopPropagation(),T.key==="Enter"&&!T.shiftKey&&(T.preventDefault(),I())},onKeyUp:T=>T.stopPropagation(),placeholder:a("node.content.chatPlaceholder"),onWheel:T=>T.stopPropagation(),onMouseDown:T=>{T.stopPropagation(),i()},onMouseMove:W,onMouseUp:W,className:"w-full p-2 pr-12 bg-transparent border-none rounded-md resize-none focus:outline-none text-sm text-white placeholder-gray-400",style:{minHeight:"120px",maxHeight:"200px",overflowY:"hidden"}}),n.jsxs("div",{className:"absolute bottom-2 right-2 flex flex-col gap-2 items-center",children:[n.jsxs("div",{className:"flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx(mt,{content:"  ",position:"left",children:n.jsx("button",{onClick:j,className:"p-1.5 rounded-md transition-colors duration-200 bg-gray-600 hover:bg-gray-500 text-gray-300 hover:text-white",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2M9 14l2 2 4-4"})})})}),n.jsx(mt,{content:" ",position:"left",children:n.jsx("button",{onClick:G,className:`p-1.5 rounded-md transition-colors duration-200 ${w?"bg-accent/20 text-accent-text border border-accent/50":"bg-gray-600 hover:bg-gray-500 text-gray-300 hover:text-white"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})})})]}),n.jsx(mt,{content:"",position:"left",children:n.jsx("button",{onClick:I,disabled:r||!p.trim()&&!w,className:"p-1.5 bg-accent hover:bg-accent-hover rounded-md text-white disabled:bg-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors duration-200 shadow-md",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})})})})]})]})]})},tj=At.memo(ej);function ks(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Sy={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(e,t){(function(o){e.exports=o()})(function(){return function o(r,a,i){function s(d,u){if(!a[d]){if(!r[d]){var p=typeof ks=="function"&&ks;if(!u&&p)return p(d,!0);if(l)return l(d,!0);var m=new Error("Cannot find module '"+d+"'");throw m.code="MODULE_NOT_FOUND",m}var w=a[d]={exports:{}};r[d][0].call(w.exports,function(k){var b=r[d][1][k];return s(b||k)},w,w.exports,o,r,a,i)}return a[d].exports}for(var l=typeof ks=="function"&&ks,c=0;c<i.length;c++)s(i[c]);return s}({1:[function(o,r,a){var i=o("./utils"),s=o("./support"),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(c){for(var d,u,p,m,w,k,b,x=[],f=0,h=c.length,v=h,N=i.getTypeOf(c)!=="string";f<c.length;)v=h-f,p=N?(d=c[f++],u=f<h?c[f++]:0,f<h?c[f++]:0):(d=c.charCodeAt(f++),u=f<h?c.charCodeAt(f++):0,f<h?c.charCodeAt(f++):0),m=d>>2,w=(3&d)<<4|u>>4,k=1<v?(15&u)<<2|p>>6:64,b=2<v?63&p:64,x.push(l.charAt(m)+l.charAt(w)+l.charAt(k)+l.charAt(b));return x.join("")},a.decode=function(c){var d,u,p,m,w,k,b=0,x=0,f="data:";if(c.substr(0,f.length)===f)throw new Error("Invalid base64 input, it looks like a data url.");var h,v=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===l.charAt(64)&&v--,c.charAt(c.length-2)===l.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(h=s.uint8array?new Uint8Array(0|v):new Array(0|v);b<c.length;)d=l.indexOf(c.charAt(b++))<<2|(m=l.indexOf(c.charAt(b++)))>>4,u=(15&m)<<4|(w=l.indexOf(c.charAt(b++)))>>2,p=(3&w)<<6|(k=l.indexOf(c.charAt(b++))),h[x++]=d,w!==64&&(h[x++]=u),k!==64&&(h[x++]=p);return h}},{"./support":30,"./utils":32}],2:[function(o,r,a){var i=o("./external"),s=o("./stream/DataWorker"),l=o("./stream/Crc32Probe"),c=o("./stream/DataLengthProbe");function d(u,p,m,w,k){this.compressedSize=u,this.uncompressedSize=p,this.crc32=m,this.compression=w,this.compressedContent=k}d.prototype={getContentWorker:function(){var u=new s(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),p=this;return u.on("end",function(){if(this.streamInfo.data_length!==p.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new s(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(u,p,m){return u.pipe(new l).pipe(new c("uncompressedSize")).pipe(p.compressWorker(m)).pipe(new c("compressedSize")).withStreamInfo("compression",p)},r.exports=d},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(o,r,a){var i=o("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},a.DEFLATE=o("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(o,r,a){var i=o("./utils"),s=function(){for(var l,c=[],d=0;d<256;d++){l=d;for(var u=0;u<8;u++)l=1&l?3988292384^l>>>1:l>>>1;c[d]=l}return c}();r.exports=function(l,c){return l!==void 0&&l.length?i.getTypeOf(l)!=="string"?function(d,u,p,m){var w=s,k=m+p;d^=-1;for(var b=m;b<k;b++)d=d>>>8^w[255&(d^u[b])];return-1^d}(0|c,l,l.length,0):function(d,u,p,m){var w=s,k=m+p;d^=-1;for(var b=m;b<k;b++)d=d>>>8^w[255&(d^u.charCodeAt(b))];return-1^d}(0|c,l,l.length,0):0}},{"./utils":32}],5:[function(o,r,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(o,r,a){var i=null;i=typeof Promise<"u"?Promise:o("lie"),r.exports={Promise:i}},{lie:37}],7:[function(o,r,a){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=o("pako"),l=o("./utils"),c=o("./stream/GenericWorker"),d=i?"uint8array":"array";function u(p,m){c.call(this,"FlateWorker/"+p),this._pako=null,this._pakoAction=p,this._pakoOptions=m,this.meta={}}a.magic="\b\0",l.inherits(u,c),u.prototype.processChunk=function(p){this.meta=p.meta,this._pako===null&&this._createPako(),this._pako.push(l.transformTo(d,p.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var p=this;this._pako.onData=function(m){p.push({data:m,meta:p.meta})}},a.compressWorker=function(p){return new u("Deflate",p)},a.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(o,r,a){function i(w,k){var b,x="";for(b=0;b<k;b++)x+=String.fromCharCode(255&w),w>>>=8;return x}function s(w,k,b,x,f,h){var v,N,_=w.file,E=w.compression,I=h!==d.utf8encode,B=l.transformTo("string",h(_.name)),M=l.transformTo("string",d.utf8encode(_.name)),G=_.comment,V=l.transformTo("string",h(G)),j=l.transformTo("string",d.utf8encode(G)),P=M.length!==_.name.length,S=j.length!==G.length,A="",O="",z="",L=_.dir,W=_.date,D={crc32:0,compressedSize:0,uncompressedSize:0};k&&!b||(D.crc32=w.crc32,D.compressedSize=w.compressedSize,D.uncompressedSize=w.uncompressedSize);var T=0;k&&(T|=8),I||!P&&!S||(T|=2048);var F=0,te=0;L&&(F|=16),f==="UNIX"?(te=798,F|=function(Y,oe){var le=Y;return Y||(le=oe?16893:33204),(65535&le)<<16}(_.unixPermissions,L)):(te=20,F|=function(Y){return 63&(Y||0)}(_.dosPermissions)),v=W.getUTCHours(),v<<=6,v|=W.getUTCMinutes(),v<<=5,v|=W.getUTCSeconds()/2,N=W.getUTCFullYear()-1980,N<<=4,N|=W.getUTCMonth()+1,N<<=5,N|=W.getUTCDate(),P&&(O=i(1,1)+i(u(B),4)+M,A+="up"+i(O.length,2)+O),S&&(z=i(1,1)+i(u(V),4)+j,A+="uc"+i(z.length,2)+z);var $="";return $+=`
\0`,$+=i(T,2),$+=E.magic,$+=i(v,2),$+=i(N,2),$+=i(D.crc32,4),$+=i(D.compressedSize,4),$+=i(D.uncompressedSize,4),$+=i(B.length,2),$+=i(A.length,2),{fileRecord:p.LOCAL_FILE_HEADER+$+B+A,dirRecord:p.CENTRAL_FILE_HEADER+i(te,2)+$+i(V.length,2)+"\0\0\0\0"+i(F,4)+i(x,4)+B+A+V}}var l=o("../utils"),c=o("../stream/GenericWorker"),d=o("../utf8"),u=o("../crc32"),p=o("../signature");function m(w,k,b,x){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=k,this.zipPlatform=b,this.encodeFileName=x,this.streamFiles=w,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}l.inherits(m,c),m.prototype.push=function(w){var k=w.meta.percent||0,b=this.entriesCount,x=this._sources.length;this.accumulate?this.contentBuffer.push(w):(this.bytesWritten+=w.data.length,c.prototype.push.call(this,{data:w.data,meta:{currentFile:this.currentFile,percent:b?(k+100*(b-x-1))/b:100}}))},m.prototype.openedSource=function(w){this.currentSourceOffset=this.bytesWritten,this.currentFile=w.file.name;var k=this.streamFiles&&!w.file.dir;if(k){var b=s(w,k,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:b.fileRecord,meta:{percent:0}})}else this.accumulate=!0},m.prototype.closedSource=function(w){this.accumulate=!1;var k=this.streamFiles&&!w.file.dir,b=s(w,k,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(b.dirRecord),k)this.push({data:function(x){return p.DATA_DESCRIPTOR+i(x.crc32,4)+i(x.compressedSize,4)+i(x.uncompressedSize,4)}(w),meta:{percent:100}});else for(this.push({data:b.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},m.prototype.flush=function(){for(var w=this.bytesWritten,k=0;k<this.dirRecords.length;k++)this.push({data:this.dirRecords[k],meta:{percent:100}});var b=this.bytesWritten-w,x=function(f,h,v,N,_){var E=l.transformTo("string",_(N));return p.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(f,2)+i(f,2)+i(h,4)+i(v,4)+i(E.length,2)+E}(this.dirRecords.length,b,w,this.zipComment,this.encodeFileName);this.push({data:x,meta:{percent:100}})},m.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},m.prototype.registerPrevious=function(w){this._sources.push(w);var k=this;return w.on("data",function(b){k.processChunk(b)}),w.on("end",function(){k.closedSource(k.previous.streamInfo),k._sources.length?k.prepareNextSource():k.end()}),w.on("error",function(b){k.error(b)}),this},m.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},m.prototype.error=function(w){var k=this._sources;if(!c.prototype.error.call(this,w))return!1;for(var b=0;b<k.length;b++)try{k[b].error(w)}catch{}return!0},m.prototype.lock=function(){c.prototype.lock.call(this);for(var w=this._sources,k=0;k<w.length;k++)w[k].lock()},r.exports=m},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(o,r,a){var i=o("../compressions"),s=o("./ZipFileWorker");a.generateWorker=function(l,c,d){var u=new s(c.streamFiles,d,c.platform,c.encodeFileName),p=0;try{l.forEach(function(m,w){p++;var k=function(h,v){var N=h||v,_=i[N];if(!_)throw new Error(N+" is not a valid compression method !");return _}(w.options.compression,c.compression),b=w.options.compressionOptions||c.compressionOptions||{},x=w.dir,f=w.date;w._compressWorker(k,b).withStreamInfo("file",{name:m,dir:x,date:f,comment:w.comment||"",unixPermissions:w.unixPermissions,dosPermissions:w.dosPermissions}).pipe(u)}),u.entriesCount=p}catch(m){u.error(m)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(o,r,a){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new i;for(var l in this)typeof this[l]!="function"&&(s[l]=this[l]);return s}}(i.prototype=o("./object")).loadAsync=o("./load"),i.support=o("./support"),i.defaults=o("./defaults"),i.version="3.10.1",i.loadAsync=function(s,l){return new i().loadAsync(s,l)},i.external=o("./external"),r.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(o,r,a){var i=o("./utils"),s=o("./external"),l=o("./utf8"),c=o("./zipEntries"),d=o("./stream/Crc32Probe"),u=o("./nodejsUtils");function p(m){return new s.Promise(function(w,k){var b=m.decompressed.getContentWorker().pipe(new d);b.on("error",function(x){k(x)}).on("end",function(){b.streamInfo.crc32!==m.decompressed.crc32?k(new Error("Corrupted zip : CRC32 mismatch")):w()}).resume()})}r.exports=function(m,w){var k=this;return w=i.extend(w||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:l.utf8decode}),u.isNode&&u.isStream(m)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",m,!0,w.optimizedBinaryString,w.base64).then(function(b){var x=new c(w);return x.load(b),x}).then(function(b){var x=[s.Promise.resolve(b)],f=b.files;if(w.checkCRC32)for(var h=0;h<f.length;h++)x.push(p(f[h]));return s.Promise.all(x)}).then(function(b){for(var x=b.shift(),f=x.files,h=0;h<f.length;h++){var v=f[h],N=v.fileNameStr,_=i.resolve(v.fileNameStr);k.file(_,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:w.createFolders}),v.dir||(k.file(_).unsafeOriginalName=N)}return x.zipComment.length&&(k.comment=x.zipComment),k})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(o,r,a){var i=o("../utils"),s=o("../stream/GenericWorker");function l(c,d){s.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(d)}i.inherits(l,s),l.prototype._bindStream=function(c){var d=this;(this._stream=c).pause(),c.on("data",function(u){d.push({data:u,meta:{percent:0}})}).on("error",function(u){d.isPaused?this.generatedError=u:d.error(u)}).on("end",function(){d.isPaused?d._upstreamEnded=!0:d.end()})},l.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},l.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=l},{"../stream/GenericWorker":28,"../utils":32}],13:[function(o,r,a){var i=o("readable-stream").Readable;function s(l,c,d){i.call(this,c),this._helper=l;var u=this;l.on("data",function(p,m){u.push(p)||u._helper.pause(),d&&d(m)}).on("error",function(p){u.emit("error",p)}).on("end",function(){u.push(null)})}o("../utils").inherits(s,i),s.prototype._read=function(){this._helper.resume()},r.exports=s},{"../utils":32,"readable-stream":16}],14:[function(o,r,a){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,s);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,s)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var s=new Buffer(i);return s.fill(0),s},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(o,r,a){function i(_,E,I){var B,M=l.getTypeOf(E),G=l.extend(I||{},u);G.date=G.date||new Date,G.compression!==null&&(G.compression=G.compression.toUpperCase()),typeof G.unixPermissions=="string"&&(G.unixPermissions=parseInt(G.unixPermissions,8)),G.unixPermissions&&16384&G.unixPermissions&&(G.dir=!0),G.dosPermissions&&16&G.dosPermissions&&(G.dir=!0),G.dir&&(_=f(_)),G.createFolders&&(B=x(_))&&h.call(this,B,!0);var V=M==="string"&&G.binary===!1&&G.base64===!1;I&&I.binary!==void 0||(G.binary=!V),(E instanceof p&&E.uncompressedSize===0||G.dir||!E||E.length===0)&&(G.base64=!1,G.binary=!0,E="",G.compression="STORE",M="string");var j=null;j=E instanceof p||E instanceof c?E:k.isNode&&k.isStream(E)?new b(_,E):l.prepareContent(_,E,G.binary,G.optimizedBinaryString,G.base64);var P=new m(_,j,G);this.files[_]=P}var s=o("./utf8"),l=o("./utils"),c=o("./stream/GenericWorker"),d=o("./stream/StreamHelper"),u=o("./defaults"),p=o("./compressedObject"),m=o("./zipObject"),w=o("./generate"),k=o("./nodejsUtils"),b=o("./nodejs/NodejsStreamInputAdapter"),x=function(_){_.slice(-1)==="/"&&(_=_.substring(0,_.length-1));var E=_.lastIndexOf("/");return 0<E?_.substring(0,E):""},f=function(_){return _.slice(-1)!=="/"&&(_+="/"),_},h=function(_,E){return E=E!==void 0?E:u.createFolders,_=f(_),this.files[_]||i.call(this,_,null,{dir:!0,createFolders:E}),this.files[_]};function v(_){return Object.prototype.toString.call(_)==="[object RegExp]"}var N={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(_){var E,I,B;for(E in this.files)B=this.files[E],(I=E.slice(this.root.length,E.length))&&E.slice(0,this.root.length)===this.root&&_(I,B)},filter:function(_){var E=[];return this.forEach(function(I,B){_(I,B)&&E.push(B)}),E},file:function(_,E,I){if(arguments.length!==1)return _=this.root+_,i.call(this,_,E,I),this;if(v(_)){var B=_;return this.filter(function(G,V){return!V.dir&&B.test(G)})}var M=this.files[this.root+_];return M&&!M.dir?M:null},folder:function(_){if(!_)return this;if(v(_))return this.filter(function(M,G){return G.dir&&_.test(M)});var E=this.root+_,I=h.call(this,E),B=this.clone();return B.root=I.name,B},remove:function(_){_=this.root+_;var E=this.files[_];if(E||(_.slice(-1)!=="/"&&(_+="/"),E=this.files[_]),E&&!E.dir)delete this.files[_];else for(var I=this.filter(function(M,G){return G.name.slice(0,_.length)===_}),B=0;B<I.length;B++)delete this.files[I[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(_){var E,I={};try{if((I=l.extend(_||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=I.type.toLowerCase(),I.compression=I.compression.toUpperCase(),I.type==="binarystring"&&(I.type="string"),!I.type)throw new Error("No output type specified.");l.checkSupport(I.type),I.platform!=="darwin"&&I.platform!=="freebsd"&&I.platform!=="linux"&&I.platform!=="sunos"||(I.platform="UNIX"),I.platform==="win32"&&(I.platform="DOS");var B=I.comment||this.comment||"";E=w.generateWorker(this,I,B)}catch(M){(E=new c("error")).error(M)}return new d(E,I.type||"string",I.mimeType)},generateAsync:function(_,E){return this.generateInternalStream(_).accumulate(E)},generateNodeStream:function(_,E){return(_=_||{}).type||(_.type="nodebuffer"),this.generateInternalStream(_).toNodejsStream(E)}};r.exports=N},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(o,r,a){r.exports=o("stream")},{stream:void 0}],17:[function(o,r,a){var i=o("./DataReader");function s(l){i.call(this,l);for(var c=0;c<this.data.length;c++)l[c]=255&l[c]}o("../utils").inherits(s,i),s.prototype.byteAt=function(l){return this.data[this.zero+l]},s.prototype.lastIndexOfSignature=function(l){for(var c=l.charCodeAt(0),d=l.charCodeAt(1),u=l.charCodeAt(2),p=l.charCodeAt(3),m=this.length-4;0<=m;--m)if(this.data[m]===c&&this.data[m+1]===d&&this.data[m+2]===u&&this.data[m+3]===p)return m-this.zero;return-1},s.prototype.readAndCheckSignature=function(l){var c=l.charCodeAt(0),d=l.charCodeAt(1),u=l.charCodeAt(2),p=l.charCodeAt(3),m=this.readData(4);return c===m[0]&&d===m[1]&&u===m[2]&&p===m[3]},s.prototype.readData=function(l){if(this.checkOffset(l),l===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=s},{"../utils":32,"./DataReader":18}],18:[function(o,r,a){var i=o("../utils");function s(l){this.data=l,this.length=l.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(l){this.checkIndex(this.index+l)},checkIndex:function(l){if(this.length<this.zero+l||l<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+l+"). Corrupted zip ?")},setIndex:function(l){this.checkIndex(l),this.index=l},skip:function(l){this.setIndex(this.index+l)},byteAt:function(){},readInt:function(l){var c,d=0;for(this.checkOffset(l),c=this.index+l-1;c>=this.index;c--)d=(d<<8)+this.byteAt(c);return this.index+=l,d},readString:function(l){return i.transformTo("string",this.readData(l))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var l=this.readInt(4);return new Date(Date.UTC(1980+(l>>25&127),(l>>21&15)-1,l>>16&31,l>>11&31,l>>5&63,(31&l)<<1))}},r.exports=s},{"../utils":32}],19:[function(o,r,a){var i=o("./Uint8ArrayReader");function s(l){i.call(this,l)}o("../utils").inherits(s,i),s.prototype.readData=function(l){this.checkOffset(l);var c=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(o,r,a){var i=o("./DataReader");function s(l){i.call(this,l)}o("../utils").inherits(s,i),s.prototype.byteAt=function(l){return this.data.charCodeAt(this.zero+l)},s.prototype.lastIndexOfSignature=function(l){return this.data.lastIndexOf(l)-this.zero},s.prototype.readAndCheckSignature=function(l){return l===this.readData(4)},s.prototype.readData=function(l){this.checkOffset(l);var c=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=s},{"../utils":32,"./DataReader":18}],21:[function(o,r,a){var i=o("./ArrayReader");function s(l){i.call(this,l)}o("../utils").inherits(s,i),s.prototype.readData=function(l){if(this.checkOffset(l),l===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(o,r,a){var i=o("../utils"),s=o("../support"),l=o("./ArrayReader"),c=o("./StringReader"),d=o("./NodeBufferReader"),u=o("./Uint8ArrayReader");r.exports=function(p){var m=i.getTypeOf(p);return i.checkSupport(m),m!=="string"||s.uint8array?m==="nodebuffer"?new d(p):s.uint8array?new u(i.transformTo("uint8array",p)):new l(i.transformTo("array",p)):new c(p)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(o,r,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(o,r,a){var i=o("./GenericWorker"),s=o("../utils");function l(c){i.call(this,"ConvertWorker to "+c),this.destType=c}s.inherits(l,i),l.prototype.processChunk=function(c){this.push({data:s.transformTo(this.destType,c.data),meta:c.meta})},r.exports=l},{"../utils":32,"./GenericWorker":28}],25:[function(o,r,a){var i=o("./GenericWorker"),s=o("../crc32");function l(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}o("../utils").inherits(l,i),l.prototype.processChunk=function(c){this.streamInfo.crc32=s(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=l},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(o,r,a){var i=o("../utils"),s=o("./GenericWorker");function l(c){s.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}i.inherits(l,s),l.prototype.processChunk=function(c){if(c){var d=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=d+c.data.length}s.prototype.processChunk.call(this,c)},r.exports=l},{"../utils":32,"./GenericWorker":28}],27:[function(o,r,a){var i=o("../utils"),s=o("./GenericWorker");function l(c){s.call(this,"DataWorker");var d=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){d.dataIsReady=!0,d.data=u,d.max=u&&u.length||0,d.type=i.getTypeOf(u),d.isPaused||d._tickAndRepeat()},function(u){d.error(u)})}i.inherits(l,s),l.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},l.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},l.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},l.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,d=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,d);break;case"uint8array":c=this.data.subarray(this.index,d);break;case"array":case"nodebuffer":c=this.data.slice(this.index,d)}return this.index=d,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=l},{"../utils":32,"./GenericWorker":28}],28:[function(o,r,a){function i(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,l){return this._listeners[s].push(l),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,l){if(this._listeners[s])for(var c=0;c<this._listeners[s].length;c++)this._listeners[s][c].call(this,l)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var l=this;return s.on("data",function(c){l.processChunk(c)}),s.on("end",function(){l.end()}),s.on("error",function(c){l.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,l){return this.extraStreamInfo[s]=l,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},r.exports=i},{}],29:[function(o,r,a){var i=o("../utils"),s=o("./ConvertWorker"),l=o("./GenericWorker"),c=o("../base64"),d=o("../support"),u=o("../external"),p=null;if(d.nodestream)try{p=o("../nodejs/NodejsStreamOutputAdapter")}catch{}function m(k,b){return new u.Promise(function(x,f){var h=[],v=k._internalType,N=k._outputType,_=k._mimeType;k.on("data",function(E,I){h.push(E),b&&b(I)}).on("error",function(E){h=[],f(E)}).on("end",function(){try{var E=function(I,B,M){switch(I){case"blob":return i.newBlob(i.transformTo("arraybuffer",B),M);case"base64":return c.encode(B);default:return i.transformTo(I,B)}}(N,function(I,B){var M,G=0,V=null,j=0;for(M=0;M<B.length;M++)j+=B[M].length;switch(I){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(V=new Uint8Array(j),M=0;M<B.length;M++)V.set(B[M],G),G+=B[M].length;return V;case"nodebuffer":return Buffer.concat(B);default:throw new Error("concat : unsupported type '"+I+"'")}}(v,h),_);x(E)}catch(I){f(I)}h=[]}).resume()})}function w(k,b,x){var f=b;switch(b){case"blob":case"arraybuffer":f="uint8array";break;case"base64":f="string"}try{this._internalType=f,this._outputType=b,this._mimeType=x,i.checkSupport(f),this._worker=k.pipe(new s(f)),k.lock()}catch(h){this._worker=new l("error"),this._worker.error(h)}}w.prototype={accumulate:function(k){return m(this,k)},on:function(k,b){var x=this;return k==="data"?this._worker.on(k,function(f){b.call(x,f.data,f.meta)}):this._worker.on(k,function(){i.delay(b,arguments,x)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(k){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:this._outputType!=="nodebuffer"},k)}},r.exports=w},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(o,r,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var i=new ArrayBuffer(0);try{a.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(i),a.blob=s.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!o("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(o,r,a){for(var i=o("./utils"),s=o("./support"),l=o("./nodejsUtils"),c=o("./stream/GenericWorker"),d=new Array(256),u=0;u<256;u++)d[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;d[254]=d[254]=1;function p(){c.call(this,"utf-8 decode"),this.leftOver=null}function m(){c.call(this,"utf-8 encode")}a.utf8encode=function(w){return s.nodebuffer?l.newBufferFrom(w,"utf-8"):function(k){var b,x,f,h,v,N=k.length,_=0;for(h=0;h<N;h++)(64512&(x=k.charCodeAt(h)))==55296&&h+1<N&&(64512&(f=k.charCodeAt(h+1)))==56320&&(x=65536+(x-55296<<10)+(f-56320),h++),_+=x<128?1:x<2048?2:x<65536?3:4;for(b=s.uint8array?new Uint8Array(_):new Array(_),h=v=0;v<_;h++)(64512&(x=k.charCodeAt(h)))==55296&&h+1<N&&(64512&(f=k.charCodeAt(h+1)))==56320&&(x=65536+(x-55296<<10)+(f-56320),h++),x<128?b[v++]=x:(x<2048?b[v++]=192|x>>>6:(x<65536?b[v++]=224|x>>>12:(b[v++]=240|x>>>18,b[v++]=128|x>>>12&63),b[v++]=128|x>>>6&63),b[v++]=128|63&x);return b}(w)},a.utf8decode=function(w){return s.nodebuffer?i.transformTo("nodebuffer",w).toString("utf-8"):function(k){var b,x,f,h,v=k.length,N=new Array(2*v);for(b=x=0;b<v;)if((f=k[b++])<128)N[x++]=f;else if(4<(h=d[f]))N[x++]=65533,b+=h-1;else{for(f&=h===2?31:h===3?15:7;1<h&&b<v;)f=f<<6|63&k[b++],h--;1<h?N[x++]=65533:f<65536?N[x++]=f:(f-=65536,N[x++]=55296|f>>10&1023,N[x++]=56320|1023&f)}return N.length!==x&&(N.subarray?N=N.subarray(0,x):N.length=x),i.applyFromCharCode(N)}(w=i.transformTo(s.uint8array?"uint8array":"array",w))},i.inherits(p,c),p.prototype.processChunk=function(w){var k=i.transformTo(s.uint8array?"uint8array":"array",w.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var b=k;(k=new Uint8Array(b.length+this.leftOver.length)).set(this.leftOver,0),k.set(b,this.leftOver.length)}else k=this.leftOver.concat(k);this.leftOver=null}var x=function(h,v){var N;for((v=v||h.length)>h.length&&(v=h.length),N=v-1;0<=N&&(192&h[N])==128;)N--;return N<0||N===0?v:N+d[h[N]]>v?N:v}(k),f=k;x!==k.length&&(s.uint8array?(f=k.subarray(0,x),this.leftOver=k.subarray(x,k.length)):(f=k.slice(0,x),this.leftOver=k.slice(x,k.length))),this.push({data:a.utf8decode(f),meta:w.meta})},p.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=p,i.inherits(m,c),m.prototype.processChunk=function(w){this.push({data:a.utf8encode(w.data),meta:w.meta})},a.Utf8EncodeWorker=m},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(o,r,a){var i=o("./support"),s=o("./base64"),l=o("./nodejsUtils"),c=o("./external");function d(b){return b}function u(b,x){for(var f=0;f<b.length;++f)x[f]=255&b.charCodeAt(f);return x}o("setimmediate"),a.newBlob=function(b,x){a.checkSupport("blob");try{return new Blob([b],{type:x})}catch{try{var f=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return f.append(b),f.getBlob(x)}catch{throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(b,x,f){var h=[],v=0,N=b.length;if(N<=f)return String.fromCharCode.apply(null,b);for(;v<N;)x==="array"||x==="nodebuffer"?h.push(String.fromCharCode.apply(null,b.slice(v,Math.min(v+f,N)))):h.push(String.fromCharCode.apply(null,b.subarray(v,Math.min(v+f,N)))),v+=f;return h.join("")},stringifyByChar:function(b){for(var x="",f=0;f<b.length;f++)x+=String.fromCharCode(b[f]);return x},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,l.allocBuffer(1)).length===1}catch{return!1}}()}};function m(b){var x=65536,f=a.getTypeOf(b),h=!0;if(f==="uint8array"?h=p.applyCanBeUsed.uint8array:f==="nodebuffer"&&(h=p.applyCanBeUsed.nodebuffer),h)for(;1<x;)try{return p.stringifyByChunk(b,f,x)}catch{x=Math.floor(x/2)}return p.stringifyByChar(b)}function w(b,x){for(var f=0;f<b.length;f++)x[f]=b[f];return x}a.applyFromCharCode=m;var k={};k.string={string:d,array:function(b){return u(b,new Array(b.length))},arraybuffer:function(b){return k.string.uint8array(b).buffer},uint8array:function(b){return u(b,new Uint8Array(b.length))},nodebuffer:function(b){return u(b,l.allocBuffer(b.length))}},k.array={string:m,array:d,arraybuffer:function(b){return new Uint8Array(b).buffer},uint8array:function(b){return new Uint8Array(b)},nodebuffer:function(b){return l.newBufferFrom(b)}},k.arraybuffer={string:function(b){return m(new Uint8Array(b))},array:function(b){return w(new Uint8Array(b),new Array(b.byteLength))},arraybuffer:d,uint8array:function(b){return new Uint8Array(b)},nodebuffer:function(b){return l.newBufferFrom(new Uint8Array(b))}},k.uint8array={string:m,array:function(b){return w(b,new Array(b.length))},arraybuffer:function(b){return b.buffer},uint8array:d,nodebuffer:function(b){return l.newBufferFrom(b)}},k.nodebuffer={string:m,array:function(b){return w(b,new Array(b.length))},arraybuffer:function(b){return k.nodebuffer.uint8array(b).buffer},uint8array:function(b){return w(b,new Uint8Array(b.length))},nodebuffer:d},a.transformTo=function(b,x){if(x=x||"",!b)return x;a.checkSupport(b);var f=a.getTypeOf(x);return k[f][b](x)},a.resolve=function(b){for(var x=b.split("/"),f=[],h=0;h<x.length;h++){var v=x[h];v==="."||v===""&&h!==0&&h!==x.length-1||(v===".."?f.pop():f.push(v))}return f.join("/")},a.getTypeOf=function(b){return typeof b=="string"?"string":Object.prototype.toString.call(b)==="[object Array]"?"array":i.nodebuffer&&l.isBuffer(b)?"nodebuffer":i.uint8array&&b instanceof Uint8Array?"uint8array":i.arraybuffer&&b instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(b){if(!i[b.toLowerCase()])throw new Error(b+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(b){var x,f,h="";for(f=0;f<(b||"").length;f++)h+="\\x"+((x=b.charCodeAt(f))<16?"0":"")+x.toString(16).toUpperCase();return h},a.delay=function(b,x,f){setImmediate(function(){b.apply(f||null,x||[])})},a.inherits=function(b,x){function f(){}f.prototype=x.prototype,b.prototype=new f},a.extend=function(){var b,x,f={};for(b=0;b<arguments.length;b++)for(x in arguments[b])Object.prototype.hasOwnProperty.call(arguments[b],x)&&f[x]===void 0&&(f[x]=arguments[b][x]);return f},a.prepareContent=function(b,x,f,h,v){return c.Promise.resolve(x).then(function(N){return i.blob&&(N instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(N))!==-1)&&typeof FileReader<"u"?new c.Promise(function(_,E){var I=new FileReader;I.onload=function(B){_(B.target.result)},I.onerror=function(B){E(B.target.error)},I.readAsArrayBuffer(N)}):N}).then(function(N){var _=a.getTypeOf(N);return _?(_==="arraybuffer"?N=a.transformTo("uint8array",N):_==="string"&&(v?N=s.decode(N):f&&h!==!0&&(N=function(E){return u(E,i.uint8array?new Uint8Array(E.length):new Array(E.length))}(N))),N):c.Promise.reject(new Error("Can't read the data of '"+b+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(o,r,a){var i=o("./reader/readerFor"),s=o("./utils"),l=o("./signature"),c=o("./zipEntry"),d=o("./support");function u(p){this.files=[],this.loadOptions=p}u.prototype={checkSignature:function(p){if(!this.reader.readAndCheckSignature(p)){this.reader.index-=4;var m=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(m)+", expected "+s.pretty(p)+")")}},isSignature:function(p,m){var w=this.reader.index;this.reader.setIndex(p);var k=this.reader.readString(4)===m;return this.reader.setIndex(w),k},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var p=this.reader.readData(this.zipCommentLength),m=d.uint8array?"uint8array":"array",w=s.transformTo(m,p);this.zipComment=this.loadOptions.decodeFileName(w)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var p,m,w,k=this.zip64EndOfCentralSize-44;0<k;)p=this.reader.readInt(2),m=this.reader.readInt(4),w=this.reader.readData(m),this.zip64ExtensibleData[p]={id:p,length:m,value:w}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var p,m;for(p=0;p<this.files.length;p++)m=this.files[p],this.reader.setIndex(m.localHeaderOffset),this.checkSignature(l.LOCAL_FILE_HEADER),m.readLocalPart(this.reader),m.handleUTF8(),m.processAttributes()},readCentralDir:function(){var p;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(l.CENTRAL_FILE_HEADER);)(p=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(p);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var p=this.reader.lastIndexOfSignature(l.CENTRAL_DIRECTORY_END);if(p<0)throw this.isSignature(0,l.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(p);var m=p;if(this.checkSignature(l.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(p=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(p),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,l.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var w=this.centralDirOffset+this.centralDirSize;this.zip64&&(w+=20,w+=12+this.zip64EndOfCentralSize);var k=m-w;if(0<k)this.isSignature(m,l.CENTRAL_FILE_HEADER)||(this.reader.zero=k);else if(k<0)throw new Error("Corrupted zip: missing "+Math.abs(k)+" bytes.")},prepareReader:function(p){this.reader=i(p)},load:function(p){this.prepareReader(p),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(o,r,a){var i=o("./reader/readerFor"),s=o("./utils"),l=o("./compressedObject"),c=o("./crc32"),d=o("./utf8"),u=o("./compressions"),p=o("./support");function m(w,k){this.options=w,this.loadOptions=k}m.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(w){var k,b;if(w.skip(22),this.fileNameLength=w.readInt(2),b=w.readInt(2),this.fileName=w.readData(this.fileNameLength),w.skip(b),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((k=function(x){for(var f in u)if(Object.prototype.hasOwnProperty.call(u,f)&&u[f].magic===x)return u[f];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new l(this.compressedSize,this.uncompressedSize,this.crc32,k,w.readData(this.compressedSize))},readCentralPart:function(w){this.versionMadeBy=w.readInt(2),w.skip(2),this.bitFlag=w.readInt(2),this.compressionMethod=w.readString(2),this.date=w.readDate(),this.crc32=w.readInt(4),this.compressedSize=w.readInt(4),this.uncompressedSize=w.readInt(4);var k=w.readInt(2);if(this.extraFieldsLength=w.readInt(2),this.fileCommentLength=w.readInt(2),this.diskNumberStart=w.readInt(2),this.internalFileAttributes=w.readInt(2),this.externalFileAttributes=w.readInt(4),this.localHeaderOffset=w.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");w.skip(k),this.readExtraFields(w),this.parseZIP64ExtraField(w),this.fileComment=w.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var w=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),w==0&&(this.dosPermissions=63&this.externalFileAttributes),w==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var w=i(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=w.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=w.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=w.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=w.readInt(4))}},readExtraFields:function(w){var k,b,x,f=w.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});w.index+4<f;)k=w.readInt(2),b=w.readInt(2),x=w.readData(b),this.extraFields[k]={id:k,length:b,value:x};w.setIndex(f)},handleUTF8:function(){var w=p.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=d.utf8decode(this.fileName),this.fileCommentStr=d.utf8decode(this.fileComment);else{var k=this.findExtraFieldUnicodePath();if(k!==null)this.fileNameStr=k;else{var b=s.transformTo(w,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(b)}var x=this.findExtraFieldUnicodeComment();if(x!==null)this.fileCommentStr=x;else{var f=s.transformTo(w,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(f)}}},findExtraFieldUnicodePath:function(){var w=this.extraFields[28789];if(w){var k=i(w.value);return k.readInt(1)!==1||c(this.fileName)!==k.readInt(4)?null:d.utf8decode(k.readData(w.length-5))}return null},findExtraFieldUnicodeComment:function(){var w=this.extraFields[25461];if(w){var k=i(w.value);return k.readInt(1)!==1||c(this.fileComment)!==k.readInt(4)?null:d.utf8decode(k.readData(w.length-5))}return null}},r.exports=m},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(o,r,a){function i(k,b,x){this.name=k,this.dir=x.dir,this.date=x.date,this.comment=x.comment,this.unixPermissions=x.unixPermissions,this.dosPermissions=x.dosPermissions,this._data=b,this._dataBinary=x.binary,this.options={compression:x.compression,compressionOptions:x.compressionOptions}}var s=o("./stream/StreamHelper"),l=o("./stream/DataWorker"),c=o("./utf8"),d=o("./compressedObject"),u=o("./stream/GenericWorker");i.prototype={internalStream:function(k){var b=null,x="string";try{if(!k)throw new Error("No output type specified.");var f=(x=k.toLowerCase())==="string"||x==="text";x!=="binarystring"&&x!=="text"||(x="string"),b=this._decompressWorker();var h=!this._dataBinary;h&&!f&&(b=b.pipe(new c.Utf8EncodeWorker)),!h&&f&&(b=b.pipe(new c.Utf8DecodeWorker))}catch(v){(b=new u("error")).error(v)}return new s(b,x,"")},async:function(k,b){return this.internalStream(k).accumulate(b)},nodeStream:function(k,b){return this.internalStream(k||"nodebuffer").toNodejsStream(b)},_compressWorker:function(k,b){if(this._data instanceof d&&this._data.compression.magic===k.magic)return this._data.getCompressedWorker();var x=this._decompressWorker();return this._dataBinary||(x=x.pipe(new c.Utf8EncodeWorker)),d.createWorkerFrom(x,k,b)},_decompressWorker:function(){return this._data instanceof d?this._data.getContentWorker():this._data instanceof u?this._data:new l(this._data)}};for(var p=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],m=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},w=0;w<p.length;w++)i.prototype[p[w]]=m;r.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(o,r,a){(function(i){var s,l,c=i.MutationObserver||i.WebKitMutationObserver;if(c){var d=0,u=new c(k),p=i.document.createTextNode("");u.observe(p,{characterData:!0}),s=function(){p.data=d=++d%2}}else if(i.setImmediate||i.MessageChannel===void 0)s="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var b=i.document.createElement("script");b.onreadystatechange=function(){k(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},i.document.documentElement.appendChild(b)}:function(){setTimeout(k,0)};else{var m=new i.MessageChannel;m.port1.onmessage=k,s=function(){m.port2.postMessage(0)}}var w=[];function k(){var b,x;l=!0;for(var f=w.length;f;){for(x=w,w=[],b=-1;++b<f;)x[b]();f=w.length}l=!1}r.exports=function(b){w.push(b)!==1||l||s()}}).call(this,typeof Yi<"u"?Yi:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(o,r,a){var i=o("immediate");function s(){}var l={},c=["REJECTED"],d=["FULFILLED"],u=["PENDING"];function p(f){if(typeof f!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,f!==s&&b(this,f)}function m(f,h,v){this.promise=f,typeof h=="function"&&(this.onFulfilled=h,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function w(f,h,v){i(function(){var N;try{N=h(v)}catch(_){return l.reject(f,_)}N===f?l.reject(f,new TypeError("Cannot resolve promise with itself")):l.resolve(f,N)})}function k(f){var h=f&&f.then;if(f&&(typeof f=="object"||typeof f=="function")&&typeof h=="function")return function(){h.apply(f,arguments)}}function b(f,h){var v=!1;function N(I){v||(v=!0,l.reject(f,I))}function _(I){v||(v=!0,l.resolve(f,I))}var E=x(function(){h(_,N)});E.status==="error"&&N(E.value)}function x(f,h){var v={};try{v.value=f(h),v.status="success"}catch(N){v.status="error",v.value=N}return v}(r.exports=p).prototype.finally=function(f){if(typeof f!="function")return this;var h=this.constructor;return this.then(function(v){return h.resolve(f()).then(function(){return v})},function(v){return h.resolve(f()).then(function(){throw v})})},p.prototype.catch=function(f){return this.then(null,f)},p.prototype.then=function(f,h){if(typeof f!="function"&&this.state===d||typeof h!="function"&&this.state===c)return this;var v=new this.constructor(s);return this.state!==u?w(v,this.state===d?f:h,this.outcome):this.queue.push(new m(v,f,h)),v},m.prototype.callFulfilled=function(f){l.resolve(this.promise,f)},m.prototype.otherCallFulfilled=function(f){w(this.promise,this.onFulfilled,f)},m.prototype.callRejected=function(f){l.reject(this.promise,f)},m.prototype.otherCallRejected=function(f){w(this.promise,this.onRejected,f)},l.resolve=function(f,h){var v=x(k,h);if(v.status==="error")return l.reject(f,v.value);var N=v.value;if(N)b(f,N);else{f.state=d,f.outcome=h;for(var _=-1,E=f.queue.length;++_<E;)f.queue[_].callFulfilled(h)}return f},l.reject=function(f,h){f.state=c,f.outcome=h;for(var v=-1,N=f.queue.length;++v<N;)f.queue[v].callRejected(h);return f},p.resolve=function(f){return f instanceof this?f:l.resolve(new this(s),f)},p.reject=function(f){var h=new this(s);return l.reject(h,f)},p.all=function(f){var h=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=f.length,N=!1;if(!v)return this.resolve([]);for(var _=new Array(v),E=0,I=-1,B=new this(s);++I<v;)M(f[I],I);return B;function M(G,V){h.resolve(G).then(function(j){_[V]=j,++E!==v||N||(N=!0,l.resolve(B,_))},function(j){N||(N=!0,l.reject(B,j))})}},p.race=function(f){var h=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=f.length,N=!1;if(!v)return this.resolve([]);for(var _=-1,E=new this(s);++_<v;)I=f[_],h.resolve(I).then(function(B){N||(N=!0,l.resolve(E,B))},function(B){N||(N=!0,l.reject(E,B))});var I;return E}},{immediate:36}],38:[function(o,r,a){var i={};(0,o("./lib/utils/common").assign)(i,o("./lib/deflate"),o("./lib/inflate"),o("./lib/zlib/constants")),r.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(o,r,a){var i=o("./zlib/deflate"),s=o("./utils/common"),l=o("./utils/strings"),c=o("./zlib/messages"),d=o("./zlib/zstream"),u=Object.prototype.toString,p=0,m=-1,w=0,k=8;function b(f){if(!(this instanceof b))return new b(f);this.options=s.assign({level:m,method:k,chunkSize:16384,windowBits:15,memLevel:8,strategy:w,to:""},f||{});var h=this.options;h.raw&&0<h.windowBits?h.windowBits=-h.windowBits:h.gzip&&0<h.windowBits&&h.windowBits<16&&(h.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var v=i.deflateInit2(this.strm,h.level,h.method,h.windowBits,h.memLevel,h.strategy);if(v!==p)throw new Error(c[v]);if(h.header&&i.deflateSetHeader(this.strm,h.header),h.dictionary){var N;if(N=typeof h.dictionary=="string"?l.string2buf(h.dictionary):u.call(h.dictionary)==="[object ArrayBuffer]"?new Uint8Array(h.dictionary):h.dictionary,(v=i.deflateSetDictionary(this.strm,N))!==p)throw new Error(c[v]);this._dict_set=!0}}function x(f,h){var v=new b(h);if(v.push(f,!0),v.err)throw v.msg||c[v.err];return v.result}b.prototype.push=function(f,h){var v,N,_=this.strm,E=this.options.chunkSize;if(this.ended)return!1;N=h===~~h?h:h===!0?4:0,typeof f=="string"?_.input=l.string2buf(f):u.call(f)==="[object ArrayBuffer]"?_.input=new Uint8Array(f):_.input=f,_.next_in=0,_.avail_in=_.input.length;do{if(_.avail_out===0&&(_.output=new s.Buf8(E),_.next_out=0,_.avail_out=E),(v=i.deflate(_,N))!==1&&v!==p)return this.onEnd(v),!(this.ended=!0);_.avail_out!==0&&(_.avail_in!==0||N!==4&&N!==2)||(this.options.to==="string"?this.onData(l.buf2binstring(s.shrinkBuf(_.output,_.next_out))):this.onData(s.shrinkBuf(_.output,_.next_out)))}while((0<_.avail_in||_.avail_out===0)&&v!==1);return N===4?(v=i.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===p):N!==2||(this.onEnd(p),!(_.avail_out=0))},b.prototype.onData=function(f){this.chunks.push(f)},b.prototype.onEnd=function(f){f===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg},a.Deflate=b,a.deflate=x,a.deflateRaw=function(f,h){return(h=h||{}).raw=!0,x(f,h)},a.gzip=function(f,h){return(h=h||{}).gzip=!0,x(f,h)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(o,r,a){var i=o("./zlib/inflate"),s=o("./utils/common"),l=o("./utils/strings"),c=o("./zlib/constants"),d=o("./zlib/messages"),u=o("./zlib/zstream"),p=o("./zlib/gzheader"),m=Object.prototype.toString;function w(b){if(!(this instanceof w))return new w(b);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},b||{});var x=this.options;x.raw&&0<=x.windowBits&&x.windowBits<16&&(x.windowBits=-x.windowBits,x.windowBits===0&&(x.windowBits=-15)),!(0<=x.windowBits&&x.windowBits<16)||b&&b.windowBits||(x.windowBits+=32),15<x.windowBits&&x.windowBits<48&&!(15&x.windowBits)&&(x.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var f=i.inflateInit2(this.strm,x.windowBits);if(f!==c.Z_OK)throw new Error(d[f]);this.header=new p,i.inflateGetHeader(this.strm,this.header)}function k(b,x){var f=new w(x);if(f.push(b,!0),f.err)throw f.msg||d[f.err];return f.result}w.prototype.push=function(b,x){var f,h,v,N,_,E,I=this.strm,B=this.options.chunkSize,M=this.options.dictionary,G=!1;if(this.ended)return!1;h=x===~~x?x:x===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof b=="string"?I.input=l.binstring2buf(b):m.call(b)==="[object ArrayBuffer]"?I.input=new Uint8Array(b):I.input=b,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new s.Buf8(B),I.next_out=0,I.avail_out=B),(f=i.inflate(I,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&M&&(E=typeof M=="string"?l.string2buf(M):m.call(M)==="[object ArrayBuffer]"?new Uint8Array(M):M,f=i.inflateSetDictionary(this.strm,E)),f===c.Z_BUF_ERROR&&G===!0&&(f=c.Z_OK,G=!1),f!==c.Z_STREAM_END&&f!==c.Z_OK)return this.onEnd(f),!(this.ended=!0);I.next_out&&(I.avail_out!==0&&f!==c.Z_STREAM_END&&(I.avail_in!==0||h!==c.Z_FINISH&&h!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=l.utf8border(I.output,I.next_out),N=I.next_out-v,_=l.buf2string(I.output,v),I.next_out=N,I.avail_out=B-N,N&&s.arraySet(I.output,I.output,v,N,0),this.onData(_)):this.onData(s.shrinkBuf(I.output,I.next_out)))),I.avail_in===0&&I.avail_out===0&&(G=!0)}while((0<I.avail_in||I.avail_out===0)&&f!==c.Z_STREAM_END);return f===c.Z_STREAM_END&&(h=c.Z_FINISH),h===c.Z_FINISH?(f=i.inflateEnd(this.strm),this.onEnd(f),this.ended=!0,f===c.Z_OK):h!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(I.avail_out=0))},w.prototype.onData=function(b){this.chunks.push(b)},w.prototype.onEnd=function(b){b===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},a.Inflate=w,a.inflate=k,a.inflateRaw=function(b,x){return(x=x||{}).raw=!0,k(b,x)},a.ungzip=k},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(o,r,a){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(c){for(var d=Array.prototype.slice.call(arguments,1);d.length;){var u=d.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var p in u)u.hasOwnProperty(p)&&(c[p]=u[p])}}return c},a.shrinkBuf=function(c,d){return c.length===d?c:c.subarray?c.subarray(0,d):(c.length=d,c)};var s={arraySet:function(c,d,u,p,m){if(d.subarray&&c.subarray)c.set(d.subarray(u,u+p),m);else for(var w=0;w<p;w++)c[m+w]=d[u+w]},flattenChunks:function(c){var d,u,p,m,w,k;for(d=p=0,u=c.length;d<u;d++)p+=c[d].length;for(k=new Uint8Array(p),d=m=0,u=c.length;d<u;d++)w=c[d],k.set(w,m),m+=w.length;return k}},l={arraySet:function(c,d,u,p,m){for(var w=0;w<p;w++)c[m+w]=d[u+w]},flattenChunks:function(c){return[].concat.apply([],c)}};a.setTyped=function(c){c?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,s)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,l))},a.setTyped(i)},{}],42:[function(o,r,a){var i=o("./common"),s=!0,l=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{l=!1}for(var c=new i.Buf8(256),d=0;d<256;d++)c[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;function u(p,m){if(m<65537&&(p.subarray&&l||!p.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(p,m));for(var w="",k=0;k<m;k++)w+=String.fromCharCode(p[k]);return w}c[254]=c[254]=1,a.string2buf=function(p){var m,w,k,b,x,f=p.length,h=0;for(b=0;b<f;b++)(64512&(w=p.charCodeAt(b)))==55296&&b+1<f&&(64512&(k=p.charCodeAt(b+1)))==56320&&(w=65536+(w-55296<<10)+(k-56320),b++),h+=w<128?1:w<2048?2:w<65536?3:4;for(m=new i.Buf8(h),b=x=0;x<h;b++)(64512&(w=p.charCodeAt(b)))==55296&&b+1<f&&(64512&(k=p.charCodeAt(b+1)))==56320&&(w=65536+(w-55296<<10)+(k-56320),b++),w<128?m[x++]=w:(w<2048?m[x++]=192|w>>>6:(w<65536?m[x++]=224|w>>>12:(m[x++]=240|w>>>18,m[x++]=128|w>>>12&63),m[x++]=128|w>>>6&63),m[x++]=128|63&w);return m},a.buf2binstring=function(p){return u(p,p.length)},a.binstring2buf=function(p){for(var m=new i.Buf8(p.length),w=0,k=m.length;w<k;w++)m[w]=p.charCodeAt(w);return m},a.buf2string=function(p,m){var w,k,b,x,f=m||p.length,h=new Array(2*f);for(w=k=0;w<f;)if((b=p[w++])<128)h[k++]=b;else if(4<(x=c[b]))h[k++]=65533,w+=x-1;else{for(b&=x===2?31:x===3?15:7;1<x&&w<f;)b=b<<6|63&p[w++],x--;1<x?h[k++]=65533:b<65536?h[k++]=b:(b-=65536,h[k++]=55296|b>>10&1023,h[k++]=56320|1023&b)}return u(h,k)},a.utf8border=function(p,m){var w;for((m=m||p.length)>p.length&&(m=p.length),w=m-1;0<=w&&(192&p[w])==128;)w--;return w<0||w===0?m:w+c[p[w]]>m?w:m}},{"./common":41}],43:[function(o,r,a){r.exports=function(i,s,l,c){for(var d=65535&i|0,u=i>>>16&65535|0,p=0;l!==0;){for(l-=p=2e3<l?2e3:l;u=u+(d=d+s[c++]|0)|0,--p;);d%=65521,u%=65521}return d|u<<16|0}},{}],44:[function(o,r,a){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(o,r,a){var i=function(){for(var s,l=[],c=0;c<256;c++){s=c;for(var d=0;d<8;d++)s=1&s?3988292384^s>>>1:s>>>1;l[c]=s}return l}();r.exports=function(s,l,c,d){var u=i,p=d+c;s^=-1;for(var m=d;m<p;m++)s=s>>>8^u[255&(s^l[m])];return-1^s}},{}],46:[function(o,r,a){var i,s=o("../utils/common"),l=o("./trees"),c=o("./adler32"),d=o("./crc32"),u=o("./messages"),p=0,m=4,w=0,k=-2,b=-1,x=4,f=2,h=8,v=9,N=286,_=30,E=19,I=2*N+1,B=15,M=3,G=258,V=G+M+1,j=42,P=113,S=1,A=2,O=3,z=4;function L(R,J){return R.msg=u[J],J}function W(R){return(R<<1)-(4<R?9:0)}function D(R){for(var J=R.length;0<=--J;)R[J]=0}function T(R){var J=R.state,H=J.pending;H>R.avail_out&&(H=R.avail_out),H!==0&&(s.arraySet(R.output,J.pending_buf,J.pending_out,H,R.next_out),R.next_out+=H,J.pending_out+=H,R.total_out+=H,R.avail_out-=H,J.pending-=H,J.pending===0&&(J.pending_out=0))}function F(R,J){l._tr_flush_block(R,0<=R.block_start?R.block_start:-1,R.strstart-R.block_start,J),R.block_start=R.strstart,T(R.strm)}function te(R,J){R.pending_buf[R.pending++]=J}function $(R,J){R.pending_buf[R.pending++]=J>>>8&255,R.pending_buf[R.pending++]=255&J}function Y(R,J){var H,U,ee=R.max_chain_length,ae=R.strstart,xe=R.prev_length,ne=R.nice_match,X=R.strstart>R.w_size-V?R.strstart-(R.w_size-V):0,ue=R.window,Q=R.w_mask,ce=R.prev,pe=R.strstart+G,me=ue[ae+xe-1],ke=ue[ae+xe];R.prev_length>=R.good_match&&(ee>>=2),ne>R.lookahead&&(ne=R.lookahead);do if(ue[(H=J)+xe]===ke&&ue[H+xe-1]===me&&ue[H]===ue[ae]&&ue[++H]===ue[ae+1]){ae+=2,H++;do;while(ue[++ae]===ue[++H]&&ue[++ae]===ue[++H]&&ue[++ae]===ue[++H]&&ue[++ae]===ue[++H]&&ue[++ae]===ue[++H]&&ue[++ae]===ue[++H]&&ue[++ae]===ue[++H]&&ue[++ae]===ue[++H]&&ae<pe);if(U=G-(pe-ae),ae=pe-G,xe<U){if(R.match_start=J,ne<=(xe=U))break;me=ue[ae+xe-1],ke=ue[ae+xe]}}while((J=ce[J&Q])>X&&--ee!=0);return xe<=R.lookahead?xe:R.lookahead}function oe(R){var J,H,U,ee,ae,xe,ne,X,ue,Q,ce=R.w_size;do{if(ee=R.window_size-R.lookahead-R.strstart,R.strstart>=ce+(ce-V)){for(s.arraySet(R.window,R.window,ce,ce,0),R.match_start-=ce,R.strstart-=ce,R.block_start-=ce,J=H=R.hash_size;U=R.head[--J],R.head[J]=ce<=U?U-ce:0,--H;);for(J=H=ce;U=R.prev[--J],R.prev[J]=ce<=U?U-ce:0,--H;);ee+=ce}if(R.strm.avail_in===0)break;if(xe=R.strm,ne=R.window,X=R.strstart+R.lookahead,ue=ee,Q=void 0,Q=xe.avail_in,ue<Q&&(Q=ue),H=Q===0?0:(xe.avail_in-=Q,s.arraySet(ne,xe.input,xe.next_in,Q,X),xe.state.wrap===1?xe.adler=c(xe.adler,ne,Q,X):xe.state.wrap===2&&(xe.adler=d(xe.adler,ne,Q,X)),xe.next_in+=Q,xe.total_in+=Q,Q),R.lookahead+=H,R.lookahead+R.insert>=M)for(ae=R.strstart-R.insert,R.ins_h=R.window[ae],R.ins_h=(R.ins_h<<R.hash_shift^R.window[ae+1])&R.hash_mask;R.insert&&(R.ins_h=(R.ins_h<<R.hash_shift^R.window[ae+M-1])&R.hash_mask,R.prev[ae&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=ae,ae++,R.insert--,!(R.lookahead+R.insert<M)););}while(R.lookahead<V&&R.strm.avail_in!==0)}function le(R,J){for(var H,U;;){if(R.lookahead<V){if(oe(R),R.lookahead<V&&J===p)return S;if(R.lookahead===0)break}if(H=0,R.lookahead>=M&&(R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+M-1])&R.hash_mask,H=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),H!==0&&R.strstart-H<=R.w_size-V&&(R.match_length=Y(R,H)),R.match_length>=M)if(U=l._tr_tally(R,R.strstart-R.match_start,R.match_length-M),R.lookahead-=R.match_length,R.match_length<=R.max_lazy_match&&R.lookahead>=M){for(R.match_length--;R.strstart++,R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+M-1])&R.hash_mask,H=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart,--R.match_length!=0;);R.strstart++}else R.strstart+=R.match_length,R.match_length=0,R.ins_h=R.window[R.strstart],R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+1])&R.hash_mask;else U=l._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++;if(U&&(F(R,!1),R.strm.avail_out===0))return S}return R.insert=R.strstart<M-1?R.strstart:M-1,J===m?(F(R,!0),R.strm.avail_out===0?O:z):R.last_lit&&(F(R,!1),R.strm.avail_out===0)?S:A}function K(R,J){for(var H,U,ee;;){if(R.lookahead<V){if(oe(R),R.lookahead<V&&J===p)return S;if(R.lookahead===0)break}if(H=0,R.lookahead>=M&&(R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+M-1])&R.hash_mask,H=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),R.prev_length=R.match_length,R.prev_match=R.match_start,R.match_length=M-1,H!==0&&R.prev_length<R.max_lazy_match&&R.strstart-H<=R.w_size-V&&(R.match_length=Y(R,H),R.match_length<=5&&(R.strategy===1||R.match_length===M&&4096<R.strstart-R.match_start)&&(R.match_length=M-1)),R.prev_length>=M&&R.match_length<=R.prev_length){for(ee=R.strstart+R.lookahead-M,U=l._tr_tally(R,R.strstart-1-R.prev_match,R.prev_length-M),R.lookahead-=R.prev_length-1,R.prev_length-=2;++R.strstart<=ee&&(R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+M-1])&R.hash_mask,H=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),--R.prev_length!=0;);if(R.match_available=0,R.match_length=M-1,R.strstart++,U&&(F(R,!1),R.strm.avail_out===0))return S}else if(R.match_available){if((U=l._tr_tally(R,0,R.window[R.strstart-1]))&&F(R,!1),R.strstart++,R.lookahead--,R.strm.avail_out===0)return S}else R.match_available=1,R.strstart++,R.lookahead--}return R.match_available&&(U=l._tr_tally(R,0,R.window[R.strstart-1]),R.match_available=0),R.insert=R.strstart<M-1?R.strstart:M-1,J===m?(F(R,!0),R.strm.avail_out===0?O:z):R.last_lit&&(F(R,!1),R.strm.avail_out===0)?S:A}function ie(R,J,H,U,ee){this.good_length=R,this.max_lazy=J,this.nice_length=H,this.max_chain=U,this.func=ee}function Z(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=h,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*I),this.dyn_dtree=new s.Buf16(2*(2*_+1)),this.bl_tree=new s.Buf16(2*(2*E+1)),D(this.dyn_ltree),D(this.dyn_dtree),D(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(B+1),this.heap=new s.Buf16(2*N+1),D(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*N+1),D(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function se(R){var J;return R&&R.state?(R.total_in=R.total_out=0,R.data_type=f,(J=R.state).pending=0,J.pending_out=0,J.wrap<0&&(J.wrap=-J.wrap),J.status=J.wrap?j:P,R.adler=J.wrap===2?0:1,J.last_flush=p,l._tr_init(J),w):L(R,k)}function de(R){var J=se(R);return J===w&&function(H){H.window_size=2*H.w_size,D(H.head),H.max_lazy_match=i[H.level].max_lazy,H.good_match=i[H.level].good_length,H.nice_match=i[H.level].nice_length,H.max_chain_length=i[H.level].max_chain,H.strstart=0,H.block_start=0,H.lookahead=0,H.insert=0,H.match_length=H.prev_length=M-1,H.match_available=0,H.ins_h=0}(R.state),J}function re(R,J,H,U,ee,ae){if(!R)return k;var xe=1;if(J===b&&(J=6),U<0?(xe=0,U=-U):15<U&&(xe=2,U-=16),ee<1||v<ee||H!==h||U<8||15<U||J<0||9<J||ae<0||x<ae)return L(R,k);U===8&&(U=9);var ne=new Z;return(R.state=ne).strm=R,ne.wrap=xe,ne.gzhead=null,ne.w_bits=U,ne.w_size=1<<ne.w_bits,ne.w_mask=ne.w_size-1,ne.hash_bits=ee+7,ne.hash_size=1<<ne.hash_bits,ne.hash_mask=ne.hash_size-1,ne.hash_shift=~~((ne.hash_bits+M-1)/M),ne.window=new s.Buf8(2*ne.w_size),ne.head=new s.Buf16(ne.hash_size),ne.prev=new s.Buf16(ne.w_size),ne.lit_bufsize=1<<ee+6,ne.pending_buf_size=4*ne.lit_bufsize,ne.pending_buf=new s.Buf8(ne.pending_buf_size),ne.d_buf=1*ne.lit_bufsize,ne.l_buf=3*ne.lit_bufsize,ne.level=J,ne.strategy=ae,ne.method=H,de(R)}i=[new ie(0,0,0,0,function(R,J){var H=65535;for(H>R.pending_buf_size-5&&(H=R.pending_buf_size-5);;){if(R.lookahead<=1){if(oe(R),R.lookahead===0&&J===p)return S;if(R.lookahead===0)break}R.strstart+=R.lookahead,R.lookahead=0;var U=R.block_start+H;if((R.strstart===0||R.strstart>=U)&&(R.lookahead=R.strstart-U,R.strstart=U,F(R,!1),R.strm.avail_out===0)||R.strstart-R.block_start>=R.w_size-V&&(F(R,!1),R.strm.avail_out===0))return S}return R.insert=0,J===m?(F(R,!0),R.strm.avail_out===0?O:z):(R.strstart>R.block_start&&(F(R,!1),R.strm.avail_out),S)}),new ie(4,4,8,4,le),new ie(4,5,16,8,le),new ie(4,6,32,32,le),new ie(4,4,16,16,K),new ie(8,16,32,32,K),new ie(8,16,128,128,K),new ie(8,32,128,256,K),new ie(32,128,258,1024,K),new ie(32,258,258,4096,K)],a.deflateInit=function(R,J){return re(R,J,h,15,8,0)},a.deflateInit2=re,a.deflateReset=de,a.deflateResetKeep=se,a.deflateSetHeader=function(R,J){return R&&R.state?R.state.wrap!==2?k:(R.state.gzhead=J,w):k},a.deflate=function(R,J){var H,U,ee,ae;if(!R||!R.state||5<J||J<0)return R?L(R,k):k;if(U=R.state,!R.output||!R.input&&R.avail_in!==0||U.status===666&&J!==m)return L(R,R.avail_out===0?-5:k);if(U.strm=R,H=U.last_flush,U.last_flush=J,U.status===j)if(U.wrap===2)R.adler=0,te(U,31),te(U,139),te(U,8),U.gzhead?(te(U,(U.gzhead.text?1:0)+(U.gzhead.hcrc?2:0)+(U.gzhead.extra?4:0)+(U.gzhead.name?8:0)+(U.gzhead.comment?16:0)),te(U,255&U.gzhead.time),te(U,U.gzhead.time>>8&255),te(U,U.gzhead.time>>16&255),te(U,U.gzhead.time>>24&255),te(U,U.level===9?2:2<=U.strategy||U.level<2?4:0),te(U,255&U.gzhead.os),U.gzhead.extra&&U.gzhead.extra.length&&(te(U,255&U.gzhead.extra.length),te(U,U.gzhead.extra.length>>8&255)),U.gzhead.hcrc&&(R.adler=d(R.adler,U.pending_buf,U.pending,0)),U.gzindex=0,U.status=69):(te(U,0),te(U,0),te(U,0),te(U,0),te(U,0),te(U,U.level===9?2:2<=U.strategy||U.level<2?4:0),te(U,3),U.status=P);else{var xe=h+(U.w_bits-8<<4)<<8;xe|=(2<=U.strategy||U.level<2?0:U.level<6?1:U.level===6?2:3)<<6,U.strstart!==0&&(xe|=32),xe+=31-xe%31,U.status=P,$(U,xe),U.strstart!==0&&($(U,R.adler>>>16),$(U,65535&R.adler)),R.adler=1}if(U.status===69)if(U.gzhead.extra){for(ee=U.pending;U.gzindex<(65535&U.gzhead.extra.length)&&(U.pending!==U.pending_buf_size||(U.gzhead.hcrc&&U.pending>ee&&(R.adler=d(R.adler,U.pending_buf,U.pending-ee,ee)),T(R),ee=U.pending,U.pending!==U.pending_buf_size));)te(U,255&U.gzhead.extra[U.gzindex]),U.gzindex++;U.gzhead.hcrc&&U.pending>ee&&(R.adler=d(R.adler,U.pending_buf,U.pending-ee,ee)),U.gzindex===U.gzhead.extra.length&&(U.gzindex=0,U.status=73)}else U.status=73;if(U.status===73)if(U.gzhead.name){ee=U.pending;do{if(U.pending===U.pending_buf_size&&(U.gzhead.hcrc&&U.pending>ee&&(R.adler=d(R.adler,U.pending_buf,U.pending-ee,ee)),T(R),ee=U.pending,U.pending===U.pending_buf_size)){ae=1;break}ae=U.gzindex<U.gzhead.name.length?255&U.gzhead.name.charCodeAt(U.gzindex++):0,te(U,ae)}while(ae!==0);U.gzhead.hcrc&&U.pending>ee&&(R.adler=d(R.adler,U.pending_buf,U.pending-ee,ee)),ae===0&&(U.gzindex=0,U.status=91)}else U.status=91;if(U.status===91)if(U.gzhead.comment){ee=U.pending;do{if(U.pending===U.pending_buf_size&&(U.gzhead.hcrc&&U.pending>ee&&(R.adler=d(R.adler,U.pending_buf,U.pending-ee,ee)),T(R),ee=U.pending,U.pending===U.pending_buf_size)){ae=1;break}ae=U.gzindex<U.gzhead.comment.length?255&U.gzhead.comment.charCodeAt(U.gzindex++):0,te(U,ae)}while(ae!==0);U.gzhead.hcrc&&U.pending>ee&&(R.adler=d(R.adler,U.pending_buf,U.pending-ee,ee)),ae===0&&(U.status=103)}else U.status=103;if(U.status===103&&(U.gzhead.hcrc?(U.pending+2>U.pending_buf_size&&T(R),U.pending+2<=U.pending_buf_size&&(te(U,255&R.adler),te(U,R.adler>>8&255),R.adler=0,U.status=P)):U.status=P),U.pending!==0){if(T(R),R.avail_out===0)return U.last_flush=-1,w}else if(R.avail_in===0&&W(J)<=W(H)&&J!==m)return L(R,-5);if(U.status===666&&R.avail_in!==0)return L(R,-5);if(R.avail_in!==0||U.lookahead!==0||J!==p&&U.status!==666){var ne=U.strategy===2?function(X,ue){for(var Q;;){if(X.lookahead===0&&(oe(X),X.lookahead===0)){if(ue===p)return S;break}if(X.match_length=0,Q=l._tr_tally(X,0,X.window[X.strstart]),X.lookahead--,X.strstart++,Q&&(F(X,!1),X.strm.avail_out===0))return S}return X.insert=0,ue===m?(F(X,!0),X.strm.avail_out===0?O:z):X.last_lit&&(F(X,!1),X.strm.avail_out===0)?S:A}(U,J):U.strategy===3?function(X,ue){for(var Q,ce,pe,me,ke=X.window;;){if(X.lookahead<=G){if(oe(X),X.lookahead<=G&&ue===p)return S;if(X.lookahead===0)break}if(X.match_length=0,X.lookahead>=M&&0<X.strstart&&(ce=ke[pe=X.strstart-1])===ke[++pe]&&ce===ke[++pe]&&ce===ke[++pe]){me=X.strstart+G;do;while(ce===ke[++pe]&&ce===ke[++pe]&&ce===ke[++pe]&&ce===ke[++pe]&&ce===ke[++pe]&&ce===ke[++pe]&&ce===ke[++pe]&&ce===ke[++pe]&&pe<me);X.match_length=G-(me-pe),X.match_length>X.lookahead&&(X.match_length=X.lookahead)}if(X.match_length>=M?(Q=l._tr_tally(X,1,X.match_length-M),X.lookahead-=X.match_length,X.strstart+=X.match_length,X.match_length=0):(Q=l._tr_tally(X,0,X.window[X.strstart]),X.lookahead--,X.strstart++),Q&&(F(X,!1),X.strm.avail_out===0))return S}return X.insert=0,ue===m?(F(X,!0),X.strm.avail_out===0?O:z):X.last_lit&&(F(X,!1),X.strm.avail_out===0)?S:A}(U,J):i[U.level].func(U,J);if(ne!==O&&ne!==z||(U.status=666),ne===S||ne===O)return R.avail_out===0&&(U.last_flush=-1),w;if(ne===A&&(J===1?l._tr_align(U):J!==5&&(l._tr_stored_block(U,0,0,!1),J===3&&(D(U.head),U.lookahead===0&&(U.strstart=0,U.block_start=0,U.insert=0))),T(R),R.avail_out===0))return U.last_flush=-1,w}return J!==m?w:U.wrap<=0?1:(U.wrap===2?(te(U,255&R.adler),te(U,R.adler>>8&255),te(U,R.adler>>16&255),te(U,R.adler>>24&255),te(U,255&R.total_in),te(U,R.total_in>>8&255),te(U,R.total_in>>16&255),te(U,R.total_in>>24&255)):($(U,R.adler>>>16),$(U,65535&R.adler)),T(R),0<U.wrap&&(U.wrap=-U.wrap),U.pending!==0?w:1)},a.deflateEnd=function(R){var J;return R&&R.state?(J=R.state.status)!==j&&J!==69&&J!==73&&J!==91&&J!==103&&J!==P&&J!==666?L(R,k):(R.state=null,J===P?L(R,-3):w):k},a.deflateSetDictionary=function(R,J){var H,U,ee,ae,xe,ne,X,ue,Q=J.length;if(!R||!R.state||(ae=(H=R.state).wrap)===2||ae===1&&H.status!==j||H.lookahead)return k;for(ae===1&&(R.adler=c(R.adler,J,Q,0)),H.wrap=0,Q>=H.w_size&&(ae===0&&(D(H.head),H.strstart=0,H.block_start=0,H.insert=0),ue=new s.Buf8(H.w_size),s.arraySet(ue,J,Q-H.w_size,H.w_size,0),J=ue,Q=H.w_size),xe=R.avail_in,ne=R.next_in,X=R.input,R.avail_in=Q,R.next_in=0,R.input=J,oe(H);H.lookahead>=M;){for(U=H.strstart,ee=H.lookahead-(M-1);H.ins_h=(H.ins_h<<H.hash_shift^H.window[U+M-1])&H.hash_mask,H.prev[U&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=U,U++,--ee;);H.strstart=U,H.lookahead=M-1,oe(H)}return H.strstart+=H.lookahead,H.block_start=H.strstart,H.insert=H.lookahead,H.lookahead=0,H.match_length=H.prev_length=M-1,H.match_available=0,R.next_in=ne,R.input=X,R.avail_in=xe,H.wrap=ae,w},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(o,r,a){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(o,r,a){r.exports=function(i,s){var l,c,d,u,p,m,w,k,b,x,f,h,v,N,_,E,I,B,M,G,V,j,P,S,A;l=i.state,c=i.next_in,S=i.input,d=c+(i.avail_in-5),u=i.next_out,A=i.output,p=u-(s-i.avail_out),m=u+(i.avail_out-257),w=l.dmax,k=l.wsize,b=l.whave,x=l.wnext,f=l.window,h=l.hold,v=l.bits,N=l.lencode,_=l.distcode,E=(1<<l.lenbits)-1,I=(1<<l.distbits)-1;e:do{v<15&&(h+=S[c++]<<v,v+=8,h+=S[c++]<<v,v+=8),B=N[h&E];t:for(;;){if(h>>>=M=B>>>24,v-=M,(M=B>>>16&255)===0)A[u++]=65535&B;else{if(!(16&M)){if(!(64&M)){B=N[(65535&B)+(h&(1<<M)-1)];continue t}if(32&M){l.mode=12;break e}i.msg="invalid literal/length code",l.mode=30;break e}G=65535&B,(M&=15)&&(v<M&&(h+=S[c++]<<v,v+=8),G+=h&(1<<M)-1,h>>>=M,v-=M),v<15&&(h+=S[c++]<<v,v+=8,h+=S[c++]<<v,v+=8),B=_[h&I];n:for(;;){if(h>>>=M=B>>>24,v-=M,!(16&(M=B>>>16&255))){if(!(64&M)){B=_[(65535&B)+(h&(1<<M)-1)];continue n}i.msg="invalid distance code",l.mode=30;break e}if(V=65535&B,v<(M&=15)&&(h+=S[c++]<<v,(v+=8)<M&&(h+=S[c++]<<v,v+=8)),w<(V+=h&(1<<M)-1)){i.msg="invalid distance too far back",l.mode=30;break e}if(h>>>=M,v-=M,(M=u-p)<V){if(b<(M=V-M)&&l.sane){i.msg="invalid distance too far back",l.mode=30;break e}if(P=f,(j=0)===x){if(j+=k-M,M<G){for(G-=M;A[u++]=f[j++],--M;);j=u-V,P=A}}else if(x<M){if(j+=k+x-M,(M-=x)<G){for(G-=M;A[u++]=f[j++],--M;);if(j=0,x<G){for(G-=M=x;A[u++]=f[j++],--M;);j=u-V,P=A}}}else if(j+=x-M,M<G){for(G-=M;A[u++]=f[j++],--M;);j=u-V,P=A}for(;2<G;)A[u++]=P[j++],A[u++]=P[j++],A[u++]=P[j++],G-=3;G&&(A[u++]=P[j++],1<G&&(A[u++]=P[j++]))}else{for(j=u-V;A[u++]=A[j++],A[u++]=A[j++],A[u++]=A[j++],2<(G-=3););G&&(A[u++]=A[j++],1<G&&(A[u++]=A[j++]))}break}}break}}while(c<d&&u<m);c-=G=v>>3,h&=(1<<(v-=G<<3))-1,i.next_in=c,i.next_out=u,i.avail_in=c<d?d-c+5:5-(c-d),i.avail_out=u<m?m-u+257:257-(u-m),l.hold=h,l.bits=v}},{}],49:[function(o,r,a){var i=o("../utils/common"),s=o("./adler32"),l=o("./crc32"),c=o("./inffast"),d=o("./inftrees"),u=1,p=2,m=0,w=-2,k=1,b=852,x=592;function f(j){return(j>>>24&255)+(j>>>8&65280)+((65280&j)<<8)+((255&j)<<24)}function h(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(j){var P;return j&&j.state?(P=j.state,j.total_in=j.total_out=P.total=0,j.msg="",P.wrap&&(j.adler=1&P.wrap),P.mode=k,P.last=0,P.havedict=0,P.dmax=32768,P.head=null,P.hold=0,P.bits=0,P.lencode=P.lendyn=new i.Buf32(b),P.distcode=P.distdyn=new i.Buf32(x),P.sane=1,P.back=-1,m):w}function N(j){var P;return j&&j.state?((P=j.state).wsize=0,P.whave=0,P.wnext=0,v(j)):w}function _(j,P){var S,A;return j&&j.state?(A=j.state,P<0?(S=0,P=-P):(S=1+(P>>4),P<48&&(P&=15)),P&&(P<8||15<P)?w:(A.window!==null&&A.wbits!==P&&(A.window=null),A.wrap=S,A.wbits=P,N(j))):w}function E(j,P){var S,A;return j?(A=new h,(j.state=A).window=null,(S=_(j,P))!==m&&(j.state=null),S):w}var I,B,M=!0;function G(j){if(M){var P;for(I=new i.Buf32(512),B=new i.Buf32(32),P=0;P<144;)j.lens[P++]=8;for(;P<256;)j.lens[P++]=9;for(;P<280;)j.lens[P++]=7;for(;P<288;)j.lens[P++]=8;for(d(u,j.lens,0,288,I,0,j.work,{bits:9}),P=0;P<32;)j.lens[P++]=5;d(p,j.lens,0,32,B,0,j.work,{bits:5}),M=!1}j.lencode=I,j.lenbits=9,j.distcode=B,j.distbits=5}function V(j,P,S,A){var O,z=j.state;return z.window===null&&(z.wsize=1<<z.wbits,z.wnext=0,z.whave=0,z.window=new i.Buf8(z.wsize)),A>=z.wsize?(i.arraySet(z.window,P,S-z.wsize,z.wsize,0),z.wnext=0,z.whave=z.wsize):(A<(O=z.wsize-z.wnext)&&(O=A),i.arraySet(z.window,P,S-A,O,z.wnext),(A-=O)?(i.arraySet(z.window,P,S-A,A,0),z.wnext=A,z.whave=z.wsize):(z.wnext+=O,z.wnext===z.wsize&&(z.wnext=0),z.whave<z.wsize&&(z.whave+=O))),0}a.inflateReset=N,a.inflateReset2=_,a.inflateResetKeep=v,a.inflateInit=function(j){return E(j,15)},a.inflateInit2=E,a.inflate=function(j,P){var S,A,O,z,L,W,D,T,F,te,$,Y,oe,le,K,ie,Z,se,de,re,R,J,H,U,ee=0,ae=new i.Buf8(4),xe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!j||!j.state||!j.output||!j.input&&j.avail_in!==0)return w;(S=j.state).mode===12&&(S.mode=13),L=j.next_out,O=j.output,D=j.avail_out,z=j.next_in,A=j.input,W=j.avail_in,T=S.hold,F=S.bits,te=W,$=D,J=m;e:for(;;)switch(S.mode){case k:if(S.wrap===0){S.mode=13;break}for(;F<16;){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}if(2&S.wrap&&T===35615){ae[S.check=0]=255&T,ae[1]=T>>>8&255,S.check=l(S.check,ae,2,0),F=T=0,S.mode=2;break}if(S.flags=0,S.head&&(S.head.done=!1),!(1&S.wrap)||(((255&T)<<8)+(T>>8))%31){j.msg="incorrect header check",S.mode=30;break}if((15&T)!=8){j.msg="unknown compression method",S.mode=30;break}if(F-=4,R=8+(15&(T>>>=4)),S.wbits===0)S.wbits=R;else if(R>S.wbits){j.msg="invalid window size",S.mode=30;break}S.dmax=1<<R,j.adler=S.check=1,S.mode=512&T?10:12,F=T=0;break;case 2:for(;F<16;){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}if(S.flags=T,(255&S.flags)!=8){j.msg="unknown compression method",S.mode=30;break}if(57344&S.flags){j.msg="unknown header flags set",S.mode=30;break}S.head&&(S.head.text=T>>8&1),512&S.flags&&(ae[0]=255&T,ae[1]=T>>>8&255,S.check=l(S.check,ae,2,0)),F=T=0,S.mode=3;case 3:for(;F<32;){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}S.head&&(S.head.time=T),512&S.flags&&(ae[0]=255&T,ae[1]=T>>>8&255,ae[2]=T>>>16&255,ae[3]=T>>>24&255,S.check=l(S.check,ae,4,0)),F=T=0,S.mode=4;case 4:for(;F<16;){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}S.head&&(S.head.xflags=255&T,S.head.os=T>>8),512&S.flags&&(ae[0]=255&T,ae[1]=T>>>8&255,S.check=l(S.check,ae,2,0)),F=T=0,S.mode=5;case 5:if(1024&S.flags){for(;F<16;){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}S.length=T,S.head&&(S.head.extra_len=T),512&S.flags&&(ae[0]=255&T,ae[1]=T>>>8&255,S.check=l(S.check,ae,2,0)),F=T=0}else S.head&&(S.head.extra=null);S.mode=6;case 6:if(1024&S.flags&&(W<(Y=S.length)&&(Y=W),Y&&(S.head&&(R=S.head.extra_len-S.length,S.head.extra||(S.head.extra=new Array(S.head.extra_len)),i.arraySet(S.head.extra,A,z,Y,R)),512&S.flags&&(S.check=l(S.check,A,Y,z)),W-=Y,z+=Y,S.length-=Y),S.length))break e;S.length=0,S.mode=7;case 7:if(2048&S.flags){if(W===0)break e;for(Y=0;R=A[z+Y++],S.head&&R&&S.length<65536&&(S.head.name+=String.fromCharCode(R)),R&&Y<W;);if(512&S.flags&&(S.check=l(S.check,A,Y,z)),W-=Y,z+=Y,R)break e}else S.head&&(S.head.name=null);S.length=0,S.mode=8;case 8:if(4096&S.flags){if(W===0)break e;for(Y=0;R=A[z+Y++],S.head&&R&&S.length<65536&&(S.head.comment+=String.fromCharCode(R)),R&&Y<W;);if(512&S.flags&&(S.check=l(S.check,A,Y,z)),W-=Y,z+=Y,R)break e}else S.head&&(S.head.comment=null);S.mode=9;case 9:if(512&S.flags){for(;F<16;){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}if(T!==(65535&S.check)){j.msg="header crc mismatch",S.mode=30;break}F=T=0}S.head&&(S.head.hcrc=S.flags>>9&1,S.head.done=!0),j.adler=S.check=0,S.mode=12;break;case 10:for(;F<32;){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}j.adler=S.check=f(T),F=T=0,S.mode=11;case 11:if(S.havedict===0)return j.next_out=L,j.avail_out=D,j.next_in=z,j.avail_in=W,S.hold=T,S.bits=F,2;j.adler=S.check=1,S.mode=12;case 12:if(P===5||P===6)break e;case 13:if(S.last){T>>>=7&F,F-=7&F,S.mode=27;break}for(;F<3;){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}switch(S.last=1&T,F-=1,3&(T>>>=1)){case 0:S.mode=14;break;case 1:if(G(S),S.mode=20,P!==6)break;T>>>=2,F-=2;break e;case 2:S.mode=17;break;case 3:j.msg="invalid block type",S.mode=30}T>>>=2,F-=2;break;case 14:for(T>>>=7&F,F-=7&F;F<32;){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}if((65535&T)!=(T>>>16^65535)){j.msg="invalid stored block lengths",S.mode=30;break}if(S.length=65535&T,F=T=0,S.mode=15,P===6)break e;case 15:S.mode=16;case 16:if(Y=S.length){if(W<Y&&(Y=W),D<Y&&(Y=D),Y===0)break e;i.arraySet(O,A,z,Y,L),W-=Y,z+=Y,D-=Y,L+=Y,S.length-=Y;break}S.mode=12;break;case 17:for(;F<14;){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}if(S.nlen=257+(31&T),T>>>=5,F-=5,S.ndist=1+(31&T),T>>>=5,F-=5,S.ncode=4+(15&T),T>>>=4,F-=4,286<S.nlen||30<S.ndist){j.msg="too many length or distance symbols",S.mode=30;break}S.have=0,S.mode=18;case 18:for(;S.have<S.ncode;){for(;F<3;){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}S.lens[xe[S.have++]]=7&T,T>>>=3,F-=3}for(;S.have<19;)S.lens[xe[S.have++]]=0;if(S.lencode=S.lendyn,S.lenbits=7,H={bits:S.lenbits},J=d(0,S.lens,0,19,S.lencode,0,S.work,H),S.lenbits=H.bits,J){j.msg="invalid code lengths set",S.mode=30;break}S.have=0,S.mode=19;case 19:for(;S.have<S.nlen+S.ndist;){for(;ie=(ee=S.lencode[T&(1<<S.lenbits)-1])>>>16&255,Z=65535&ee,!((K=ee>>>24)<=F);){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}if(Z<16)T>>>=K,F-=K,S.lens[S.have++]=Z;else{if(Z===16){for(U=K+2;F<U;){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}if(T>>>=K,F-=K,S.have===0){j.msg="invalid bit length repeat",S.mode=30;break}R=S.lens[S.have-1],Y=3+(3&T),T>>>=2,F-=2}else if(Z===17){for(U=K+3;F<U;){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}F-=K,R=0,Y=3+(7&(T>>>=K)),T>>>=3,F-=3}else{for(U=K+7;F<U;){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}F-=K,R=0,Y=11+(127&(T>>>=K)),T>>>=7,F-=7}if(S.have+Y>S.nlen+S.ndist){j.msg="invalid bit length repeat",S.mode=30;break}for(;Y--;)S.lens[S.have++]=R}}if(S.mode===30)break;if(S.lens[256]===0){j.msg="invalid code -- missing end-of-block",S.mode=30;break}if(S.lenbits=9,H={bits:S.lenbits},J=d(u,S.lens,0,S.nlen,S.lencode,0,S.work,H),S.lenbits=H.bits,J){j.msg="invalid literal/lengths set",S.mode=30;break}if(S.distbits=6,S.distcode=S.distdyn,H={bits:S.distbits},J=d(p,S.lens,S.nlen,S.ndist,S.distcode,0,S.work,H),S.distbits=H.bits,J){j.msg="invalid distances set",S.mode=30;break}if(S.mode=20,P===6)break e;case 20:S.mode=21;case 21:if(6<=W&&258<=D){j.next_out=L,j.avail_out=D,j.next_in=z,j.avail_in=W,S.hold=T,S.bits=F,c(j,$),L=j.next_out,O=j.output,D=j.avail_out,z=j.next_in,A=j.input,W=j.avail_in,T=S.hold,F=S.bits,S.mode===12&&(S.back=-1);break}for(S.back=0;ie=(ee=S.lencode[T&(1<<S.lenbits)-1])>>>16&255,Z=65535&ee,!((K=ee>>>24)<=F);){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}if(ie&&!(240&ie)){for(se=K,de=ie,re=Z;ie=(ee=S.lencode[re+((T&(1<<se+de)-1)>>se)])>>>16&255,Z=65535&ee,!(se+(K=ee>>>24)<=F);){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}T>>>=se,F-=se,S.back+=se}if(T>>>=K,F-=K,S.back+=K,S.length=Z,ie===0){S.mode=26;break}if(32&ie){S.back=-1,S.mode=12;break}if(64&ie){j.msg="invalid literal/length code",S.mode=30;break}S.extra=15&ie,S.mode=22;case 22:if(S.extra){for(U=S.extra;F<U;){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}S.length+=T&(1<<S.extra)-1,T>>>=S.extra,F-=S.extra,S.back+=S.extra}S.was=S.length,S.mode=23;case 23:for(;ie=(ee=S.distcode[T&(1<<S.distbits)-1])>>>16&255,Z=65535&ee,!((K=ee>>>24)<=F);){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}if(!(240&ie)){for(se=K,de=ie,re=Z;ie=(ee=S.distcode[re+((T&(1<<se+de)-1)>>se)])>>>16&255,Z=65535&ee,!(se+(K=ee>>>24)<=F);){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}T>>>=se,F-=se,S.back+=se}if(T>>>=K,F-=K,S.back+=K,64&ie){j.msg="invalid distance code",S.mode=30;break}S.offset=Z,S.extra=15&ie,S.mode=24;case 24:if(S.extra){for(U=S.extra;F<U;){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}S.offset+=T&(1<<S.extra)-1,T>>>=S.extra,F-=S.extra,S.back+=S.extra}if(S.offset>S.dmax){j.msg="invalid distance too far back",S.mode=30;break}S.mode=25;case 25:if(D===0)break e;if(Y=$-D,S.offset>Y){if((Y=S.offset-Y)>S.whave&&S.sane){j.msg="invalid distance too far back",S.mode=30;break}oe=Y>S.wnext?(Y-=S.wnext,S.wsize-Y):S.wnext-Y,Y>S.length&&(Y=S.length),le=S.window}else le=O,oe=L-S.offset,Y=S.length;for(D<Y&&(Y=D),D-=Y,S.length-=Y;O[L++]=le[oe++],--Y;);S.length===0&&(S.mode=21);break;case 26:if(D===0)break e;O[L++]=S.length,D--,S.mode=21;break;case 27:if(S.wrap){for(;F<32;){if(W===0)break e;W--,T|=A[z++]<<F,F+=8}if($-=D,j.total_out+=$,S.total+=$,$&&(j.adler=S.check=S.flags?l(S.check,O,$,L-$):s(S.check,O,$,L-$)),$=D,(S.flags?T:f(T))!==S.check){j.msg="incorrect data check",S.mode=30;break}F=T=0}S.mode=28;case 28:if(S.wrap&&S.flags){for(;F<32;){if(W===0)break e;W--,T+=A[z++]<<F,F+=8}if(T!==(4294967295&S.total)){j.msg="incorrect length check",S.mode=30;break}F=T=0}S.mode=29;case 29:J=1;break e;case 30:J=-3;break e;case 31:return-4;case 32:default:return w}return j.next_out=L,j.avail_out=D,j.next_in=z,j.avail_in=W,S.hold=T,S.bits=F,(S.wsize||$!==j.avail_out&&S.mode<30&&(S.mode<27||P!==4))&&V(j,j.output,j.next_out,$-j.avail_out)?(S.mode=31,-4):(te-=j.avail_in,$-=j.avail_out,j.total_in+=te,j.total_out+=$,S.total+=$,S.wrap&&$&&(j.adler=S.check=S.flags?l(S.check,O,$,j.next_out-$):s(S.check,O,$,j.next_out-$)),j.data_type=S.bits+(S.last?64:0)+(S.mode===12?128:0)+(S.mode===20||S.mode===15?256:0),(te==0&&$===0||P===4)&&J===m&&(J=-5),J)},a.inflateEnd=function(j){if(!j||!j.state)return w;var P=j.state;return P.window&&(P.window=null),j.state=null,m},a.inflateGetHeader=function(j,P){var S;return j&&j.state&&2&(S=j.state).wrap?((S.head=P).done=!1,m):w},a.inflateSetDictionary=function(j,P){var S,A=P.length;return j&&j.state?(S=j.state).wrap!==0&&S.mode!==11?w:S.mode===11&&s(1,P,A,0)!==S.check?-3:V(j,P,A,A)?(S.mode=31,-4):(S.havedict=1,m):w},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(o,r,a){var i=o("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,p,m,w,k,b,x,f){var h,v,N,_,E,I,B,M,G,V=f.bits,j=0,P=0,S=0,A=0,O=0,z=0,L=0,W=0,D=0,T=0,F=null,te=0,$=new i.Buf16(16),Y=new i.Buf16(16),oe=null,le=0;for(j=0;j<=15;j++)$[j]=0;for(P=0;P<w;P++)$[p[m+P]]++;for(O=V,A=15;1<=A&&$[A]===0;A--);if(A<O&&(O=A),A===0)return k[b++]=20971520,k[b++]=20971520,f.bits=1,0;for(S=1;S<A&&$[S]===0;S++);for(O<S&&(O=S),j=W=1;j<=15;j++)if(W<<=1,(W-=$[j])<0)return-1;if(0<W&&(u===0||A!==1))return-1;for(Y[1]=0,j=1;j<15;j++)Y[j+1]=Y[j]+$[j];for(P=0;P<w;P++)p[m+P]!==0&&(x[Y[p[m+P]]++]=P);if(I=u===0?(F=oe=x,19):u===1?(F=s,te-=257,oe=l,le-=257,256):(F=c,oe=d,-1),j=S,E=b,L=P=T=0,N=-1,_=(D=1<<(z=O))-1,u===1&&852<D||u===2&&592<D)return 1;for(;;){for(B=j-L,G=x[P]<I?(M=0,x[P]):x[P]>I?(M=oe[le+x[P]],F[te+x[P]]):(M=96,0),h=1<<j-L,S=v=1<<z;k[E+(T>>L)+(v-=h)]=B<<24|M<<16|G|0,v!==0;);for(h=1<<j-1;T&h;)h>>=1;if(h!==0?(T&=h-1,T+=h):T=0,P++,--$[j]==0){if(j===A)break;j=p[m+x[P]]}if(O<j&&(T&_)!==N){for(L===0&&(L=O),E+=S,W=1<<(z=j-L);z+L<A&&!((W-=$[z+L])<=0);)z++,W<<=1;if(D+=1<<z,u===1&&852<D||u===2&&592<D)return 1;k[N=T&_]=O<<24|z<<16|E-b|0}}return T!==0&&(k[E+T]=j-L<<24|64<<16|0),f.bits=O,0}},{"../utils/common":41}],51:[function(o,r,a){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(o,r,a){var i=o("../utils/common"),s=0,l=1;function c(ee){for(var ae=ee.length;0<=--ae;)ee[ae]=0}var d=0,u=29,p=256,m=p+1+u,w=30,k=19,b=2*m+1,x=15,f=16,h=7,v=256,N=16,_=17,E=18,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],V=new Array(2*(m+2));c(V);var j=new Array(2*w);c(j);var P=new Array(512);c(P);var S=new Array(256);c(S);var A=new Array(u);c(A);var O,z,L,W=new Array(w);function D(ee,ae,xe,ne,X){this.static_tree=ee,this.extra_bits=ae,this.extra_base=xe,this.elems=ne,this.max_length=X,this.has_stree=ee&&ee.length}function T(ee,ae){this.dyn_tree=ee,this.max_code=0,this.stat_desc=ae}function F(ee){return ee<256?P[ee]:P[256+(ee>>>7)]}function te(ee,ae){ee.pending_buf[ee.pending++]=255&ae,ee.pending_buf[ee.pending++]=ae>>>8&255}function $(ee,ae,xe){ee.bi_valid>f-xe?(ee.bi_buf|=ae<<ee.bi_valid&65535,te(ee,ee.bi_buf),ee.bi_buf=ae>>f-ee.bi_valid,ee.bi_valid+=xe-f):(ee.bi_buf|=ae<<ee.bi_valid&65535,ee.bi_valid+=xe)}function Y(ee,ae,xe){$(ee,xe[2*ae],xe[2*ae+1])}function oe(ee,ae){for(var xe=0;xe|=1&ee,ee>>>=1,xe<<=1,0<--ae;);return xe>>>1}function le(ee,ae,xe){var ne,X,ue=new Array(x+1),Q=0;for(ne=1;ne<=x;ne++)ue[ne]=Q=Q+xe[ne-1]<<1;for(X=0;X<=ae;X++){var ce=ee[2*X+1];ce!==0&&(ee[2*X]=oe(ue[ce]++,ce))}}function K(ee){var ae;for(ae=0;ae<m;ae++)ee.dyn_ltree[2*ae]=0;for(ae=0;ae<w;ae++)ee.dyn_dtree[2*ae]=0;for(ae=0;ae<k;ae++)ee.bl_tree[2*ae]=0;ee.dyn_ltree[2*v]=1,ee.opt_len=ee.static_len=0,ee.last_lit=ee.matches=0}function ie(ee){8<ee.bi_valid?te(ee,ee.bi_buf):0<ee.bi_valid&&(ee.pending_buf[ee.pending++]=ee.bi_buf),ee.bi_buf=0,ee.bi_valid=0}function Z(ee,ae,xe,ne){var X=2*ae,ue=2*xe;return ee[X]<ee[ue]||ee[X]===ee[ue]&&ne[ae]<=ne[xe]}function se(ee,ae,xe){for(var ne=ee.heap[xe],X=xe<<1;X<=ee.heap_len&&(X<ee.heap_len&&Z(ae,ee.heap[X+1],ee.heap[X],ee.depth)&&X++,!Z(ae,ne,ee.heap[X],ee.depth));)ee.heap[xe]=ee.heap[X],xe=X,X<<=1;ee.heap[xe]=ne}function de(ee,ae,xe){var ne,X,ue,Q,ce=0;if(ee.last_lit!==0)for(;ne=ee.pending_buf[ee.d_buf+2*ce]<<8|ee.pending_buf[ee.d_buf+2*ce+1],X=ee.pending_buf[ee.l_buf+ce],ce++,ne===0?Y(ee,X,ae):(Y(ee,(ue=S[X])+p+1,ae),(Q=I[ue])!==0&&$(ee,X-=A[ue],Q),Y(ee,ue=F(--ne),xe),(Q=B[ue])!==0&&$(ee,ne-=W[ue],Q)),ce<ee.last_lit;);Y(ee,v,ae)}function re(ee,ae){var xe,ne,X,ue=ae.dyn_tree,Q=ae.stat_desc.static_tree,ce=ae.stat_desc.has_stree,pe=ae.stat_desc.elems,me=-1;for(ee.heap_len=0,ee.heap_max=b,xe=0;xe<pe;xe++)ue[2*xe]!==0?(ee.heap[++ee.heap_len]=me=xe,ee.depth[xe]=0):ue[2*xe+1]=0;for(;ee.heap_len<2;)ue[2*(X=ee.heap[++ee.heap_len]=me<2?++me:0)]=1,ee.depth[X]=0,ee.opt_len--,ce&&(ee.static_len-=Q[2*X+1]);for(ae.max_code=me,xe=ee.heap_len>>1;1<=xe;xe--)se(ee,ue,xe);for(X=pe;xe=ee.heap[1],ee.heap[1]=ee.heap[ee.heap_len--],se(ee,ue,1),ne=ee.heap[1],ee.heap[--ee.heap_max]=xe,ee.heap[--ee.heap_max]=ne,ue[2*X]=ue[2*xe]+ue[2*ne],ee.depth[X]=(ee.depth[xe]>=ee.depth[ne]?ee.depth[xe]:ee.depth[ne])+1,ue[2*xe+1]=ue[2*ne+1]=X,ee.heap[1]=X++,se(ee,ue,1),2<=ee.heap_len;);ee.heap[--ee.heap_max]=ee.heap[1],function(ke,Re){var Me,De,Ie,Ne,Pe,ye,_e=Re.dyn_tree,Fe=Re.max_code,We=Re.stat_desc.static_tree,Ze=Re.stat_desc.has_stree,$e=Re.stat_desc.extra_bits,He=Re.stat_desc.extra_base,be=Re.stat_desc.max_length,Ae=0;for(Ne=0;Ne<=x;Ne++)ke.bl_count[Ne]=0;for(_e[2*ke.heap[ke.heap_max]+1]=0,Me=ke.heap_max+1;Me<b;Me++)be<(Ne=_e[2*_e[2*(De=ke.heap[Me])+1]+1]+1)&&(Ne=be,Ae++),_e[2*De+1]=Ne,Fe<De||(ke.bl_count[Ne]++,Pe=0,He<=De&&(Pe=$e[De-He]),ye=_e[2*De],ke.opt_len+=ye*(Ne+Pe),Ze&&(ke.static_len+=ye*(We[2*De+1]+Pe)));if(Ae!==0){do{for(Ne=be-1;ke.bl_count[Ne]===0;)Ne--;ke.bl_count[Ne]--,ke.bl_count[Ne+1]+=2,ke.bl_count[be]--,Ae-=2}while(0<Ae);for(Ne=be;Ne!==0;Ne--)for(De=ke.bl_count[Ne];De!==0;)Fe<(Ie=ke.heap[--Me])||(_e[2*Ie+1]!==Ne&&(ke.opt_len+=(Ne-_e[2*Ie+1])*_e[2*Ie],_e[2*Ie+1]=Ne),De--)}}(ee,ae),le(ue,me,ee.bl_count)}function R(ee,ae,xe){var ne,X,ue=-1,Q=ae[1],ce=0,pe=7,me=4;for(Q===0&&(pe=138,me=3),ae[2*(xe+1)+1]=65535,ne=0;ne<=xe;ne++)X=Q,Q=ae[2*(ne+1)+1],++ce<pe&&X===Q||(ce<me?ee.bl_tree[2*X]+=ce:X!==0?(X!==ue&&ee.bl_tree[2*X]++,ee.bl_tree[2*N]++):ce<=10?ee.bl_tree[2*_]++:ee.bl_tree[2*E]++,ue=X,me=(ce=0)===Q?(pe=138,3):X===Q?(pe=6,3):(pe=7,4))}function J(ee,ae,xe){var ne,X,ue=-1,Q=ae[1],ce=0,pe=7,me=4;for(Q===0&&(pe=138,me=3),ne=0;ne<=xe;ne++)if(X=Q,Q=ae[2*(ne+1)+1],!(++ce<pe&&X===Q)){if(ce<me)for(;Y(ee,X,ee.bl_tree),--ce!=0;);else X!==0?(X!==ue&&(Y(ee,X,ee.bl_tree),ce--),Y(ee,N,ee.bl_tree),$(ee,ce-3,2)):ce<=10?(Y(ee,_,ee.bl_tree),$(ee,ce-3,3)):(Y(ee,E,ee.bl_tree),$(ee,ce-11,7));ue=X,me=(ce=0)===Q?(pe=138,3):X===Q?(pe=6,3):(pe=7,4)}}c(W);var H=!1;function U(ee,ae,xe,ne){$(ee,(d<<1)+(ne?1:0),3),function(X,ue,Q,ce){ie(X),te(X,Q),te(X,~Q),i.arraySet(X.pending_buf,X.window,ue,Q,X.pending),X.pending+=Q}(ee,ae,xe)}a._tr_init=function(ee){H||(function(){var ae,xe,ne,X,ue,Q=new Array(x+1);for(X=ne=0;X<u-1;X++)for(A[X]=ne,ae=0;ae<1<<I[X];ae++)S[ne++]=X;for(S[ne-1]=X,X=ue=0;X<16;X++)for(W[X]=ue,ae=0;ae<1<<B[X];ae++)P[ue++]=X;for(ue>>=7;X<w;X++)for(W[X]=ue<<7,ae=0;ae<1<<B[X]-7;ae++)P[256+ue++]=X;for(xe=0;xe<=x;xe++)Q[xe]=0;for(ae=0;ae<=143;)V[2*ae+1]=8,ae++,Q[8]++;for(;ae<=255;)V[2*ae+1]=9,ae++,Q[9]++;for(;ae<=279;)V[2*ae+1]=7,ae++,Q[7]++;for(;ae<=287;)V[2*ae+1]=8,ae++,Q[8]++;for(le(V,m+1,Q),ae=0;ae<w;ae++)j[2*ae+1]=5,j[2*ae]=oe(ae,5);O=new D(V,I,p+1,m,x),z=new D(j,B,0,w,x),L=new D(new Array(0),M,0,k,h)}(),H=!0),ee.l_desc=new T(ee.dyn_ltree,O),ee.d_desc=new T(ee.dyn_dtree,z),ee.bl_desc=new T(ee.bl_tree,L),ee.bi_buf=0,ee.bi_valid=0,K(ee)},a._tr_stored_block=U,a._tr_flush_block=function(ee,ae,xe,ne){var X,ue,Q=0;0<ee.level?(ee.strm.data_type===2&&(ee.strm.data_type=function(ce){var pe,me=4093624447;for(pe=0;pe<=31;pe++,me>>>=1)if(1&me&&ce.dyn_ltree[2*pe]!==0)return s;if(ce.dyn_ltree[18]!==0||ce.dyn_ltree[20]!==0||ce.dyn_ltree[26]!==0)return l;for(pe=32;pe<p;pe++)if(ce.dyn_ltree[2*pe]!==0)return l;return s}(ee)),re(ee,ee.l_desc),re(ee,ee.d_desc),Q=function(ce){var pe;for(R(ce,ce.dyn_ltree,ce.l_desc.max_code),R(ce,ce.dyn_dtree,ce.d_desc.max_code),re(ce,ce.bl_desc),pe=k-1;3<=pe&&ce.bl_tree[2*G[pe]+1]===0;pe--);return ce.opt_len+=3*(pe+1)+5+5+4,pe}(ee),X=ee.opt_len+3+7>>>3,(ue=ee.static_len+3+7>>>3)<=X&&(X=ue)):X=ue=xe+5,xe+4<=X&&ae!==-1?U(ee,ae,xe,ne):ee.strategy===4||ue===X?($(ee,2+(ne?1:0),3),de(ee,V,j)):($(ee,4+(ne?1:0),3),function(ce,pe,me,ke){var Re;for($(ce,pe-257,5),$(ce,me-1,5),$(ce,ke-4,4),Re=0;Re<ke;Re++)$(ce,ce.bl_tree[2*G[Re]+1],3);J(ce,ce.dyn_ltree,pe-1),J(ce,ce.dyn_dtree,me-1)}(ee,ee.l_desc.max_code+1,ee.d_desc.max_code+1,Q+1),de(ee,ee.dyn_ltree,ee.dyn_dtree)),K(ee),ne&&ie(ee)},a._tr_tally=function(ee,ae,xe){return ee.pending_buf[ee.d_buf+2*ee.last_lit]=ae>>>8&255,ee.pending_buf[ee.d_buf+2*ee.last_lit+1]=255&ae,ee.pending_buf[ee.l_buf+ee.last_lit]=255&xe,ee.last_lit++,ae===0?ee.dyn_ltree[2*xe]++:(ee.matches++,ae--,ee.dyn_ltree[2*(S[xe]+p+1)]++,ee.dyn_dtree[2*F(ae)]++),ee.last_lit===ee.lit_bufsize-1},a._tr_align=function(ee){$(ee,2,3),Y(ee,v,V),function(ae){ae.bi_valid===16?(te(ae,ae.bi_buf),ae.bi_buf=0,ae.bi_valid=0):8<=ae.bi_valid&&(ae.pending_buf[ae.pending++]=255&ae.bi_buf,ae.bi_buf>>=8,ae.bi_valid-=8)}(ee)}},{"../utils/common":41}],53:[function(o,r,a){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(o,r,a){(function(i){(function(s,l){if(!s.setImmediate){var c,d,u,p,m=1,w={},k=!1,b=s.document,x=Object.getPrototypeOf&&Object.getPrototypeOf(s);x=x&&x.setTimeout?x:s,c={}.toString.call(s.process)==="[object process]"?function(N){process.nextTick(function(){h(N)})}:function(){if(s.postMessage&&!s.importScripts){var N=!0,_=s.onmessage;return s.onmessage=function(){N=!1},s.postMessage("","*"),s.onmessage=_,N}}()?(p="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",v,!1):s.attachEvent("onmessage",v),function(N){s.postMessage(p+N,"*")}):s.MessageChannel?((u=new MessageChannel).port1.onmessage=function(N){h(N.data)},function(N){u.port2.postMessage(N)}):b&&"onreadystatechange"in b.createElement("script")?(d=b.documentElement,function(N){var _=b.createElement("script");_.onreadystatechange=function(){h(N),_.onreadystatechange=null,d.removeChild(_),_=null},d.appendChild(_)}):function(N){setTimeout(h,0,N)},x.setImmediate=function(N){typeof N!="function"&&(N=new Function(""+N));for(var _=new Array(arguments.length-1),E=0;E<_.length;E++)_[E]=arguments[E+1];var I={callback:N,args:_};return w[m]=I,c(m),m++},x.clearImmediate=f}function f(N){delete w[N]}function h(N){if(k)setTimeout(h,0,N);else{var _=w[N];if(_){k=!0;try{(function(E){var I=E.callback,B=E.args;switch(B.length){case 0:I();break;case 1:I(B[0]);break;case 2:I(B[0],B[1]);break;case 3:I(B[0],B[1],B[2]);break;default:I.apply(l,B)}})(_)}finally{f(N),k=!1}}}}function v(N){N.source===s&&typeof N.data=="string"&&N.data.indexOf(p)===0&&h(+N.data.slice(p.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof Yi<"u"?Yi:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Sy);var nj=Sy.exports;const Bi=Hu(nj),f0=({value:e,placeholder:t,onChange:o,min:r,className:a,title:i})=>{const s=c=>{const d=parseInt(e,10);let u=isNaN(d)?r||1:d+c;r!==void 0&&u<r&&(u=r),o(u.toString())},l=c=>{const d=c.target.value;if(d===""){o("");return}const u=parseInt(d,10);!isNaN(u)&&r!==void 0&&u<r||o(d)};return n.jsxs("div",{className:`relative flex items-center bg-gray-800 rounded border border-gray-600 h-6 ${a}`,title:i,children:[n.jsx("input",{type:"number",min:r,value:e,placeholder:t,onChange:l,className:"appearance-none w-full h-full bg-transparent text-[10px] text-white text-center focus:outline-none px-1 placeholder-gray-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",onClick:c=>c.stopPropagation(),onMouseDown:c=>c.stopPropagation()}),n.jsxs("div",{className:"flex flex-col h-full border-l border-gray-600 w-3 flex-shrink-0",children:[n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-gray-700 text-gray-400 hover:text-white transition-colors",onClick:c=>{c.stopPropagation(),s(1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-gray-700 text-gray-400 hover:text-white transition-colors border-t border-gray-600",onClick:c=>{c.stopPropagation(),s(-1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})},nr=160,or=8,oj=({state:e,imageSlots:t,hasInputImages:o,isEditing:r,isStopping:a,isGlobalProcessing:i,totalFrames:s,doneCount:l,currentGeneratingDisplay:c,fullSizeOutputForCopy:d,imageForEditor:u,modelOptions:p,isNanoBanana:m,onUpdateState:w,onRunSelected:k,onDownloadSelected:b,onStartQueue:x,onStop:f,onEdit:h,onOpenEditor:v,onSetOutputToInput:N,onDownload:_,onCopy:E,onSelectAll:I,onSelectNone:B,onInvertSelection:M,onManualRefresh:G,onOutputClick:V,onSequenceOutputClick:j,onCheckOutput:P,onCopyFrame:S,onDownloadFrame:A,onRegenerateFrame:O,onStopFrame:z,getFullSizeImage:L,t:W,upstreamPrompt:D,isTextConnected:T,onEditPrompt:F,onEditInSource:te,deselectAllNodes:$,nodeId:Y})=>{const{isSequenceMode:oe,sequenceOutputs:le,checkedSequenceOutputIndices:K,model:ie,autoCrop169:Z,autoDownload:se,checkedInputIndices:de,prompt:re,outputImage:R,resolution:J,isSequentialEditingWithPrompts:H,createZip:U,enableAspectRatio:ee,enableOutpainting:ae,outpaintingPrompt:xe}=e,[ne,X]=y.useState(""),[ue,Q]=y.useState(""),ce=y.useRef(null),[pe,me]=y.useState(0),[ke,Re]=y.useState(0);y.useEffect(()=>{if(!oe||!ce.current)return;const ye=new ResizeObserver(_e=>{_e[0]&&Re(_e[0].contentRect.width)});return ye.observe(ce.current),()=>ye.disconnect()},[oe]);const Me=y.useMemo(()=>{if(!oe)return{columns:0,totalHeight:0,items:[]};const ye=Math.max(0,ke-16),_e=Math.max(1,Math.floor((ye+or)/(nr+or))),Fe=H?s:t.length,Ze=Math.ceil(Fe/_e)*(nr+or)+or;return{columns:_e,totalHeight:Ze,totalItems:Fe}},[ke,t.length,oe,H,s]),De=()=>{var Ae;const{columns:ye,totalItems:_e}=Me,Fe=400,We=Math.max(0,pe-Fe),Ze=pe+(((Ae=ce.current)==null?void 0:Ae.clientHeight)||500)+Fe,$e=Math.floor(We/(nr+or)),He=Math.ceil(Ze/(nr+or)),be=[];for(let Te=$e;Te<=He;Te++)for(let qe=0;qe<ye;qe++){const Ye=Te*ye+qe;Ye<_e&&be.push({index:Ye,top:Te*(nr+or),left:qe*(nr+or)})}return be},Ie=()=>{const ye=parseInt(ne,10),_e=parseInt(ue,10);if(isNaN(ye))return;const Fe=H?s:t.length,We=isNaN(_e)?Fe:Math.min(_e,Fe),Ze=Math.max(1,ye);if(Ze>We)return;const $e=[];for(let He=Ze-1;He<We;He++)$e.push(He);w({checkedSequenceOutputIndices:$e})},Ne=ye=>{const _e=parseInt(ne,10)||1,Fe=5;let We=Math.ceil(_e/Fe);ye==="next"?We++:We--,We<1&&(We=1);const Ze=H?s:t.length,$e=(We-1)*Fe+1,He=Math.min($e+Fe-1,Ze);X($e.toString()),Q(He.toString());const be=[];for(let Ae=$e-1;Ae<He;Ae++)be.push(Ae);w({checkedSequenceOutputIndices:be})},Pe=n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-white/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("rect",{x:"8",y:"8",width:"12",height:"12",rx:"2",ry:"2"}),n.jsx("path",{d:"M16 8V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2"})]});return n.jsxs("div",{className:"h-full flex flex-col space-y-2 flex-grow min-w-0 pl-1",children:[n.jsx("div",{className:"flex justify-between items-center bg-gray-900/50 p-1 rounded-md border border-gray-700",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("label",{className:"text-xs font-medium text-gray-400 pl-1",children:W(oe?"image_sequence.output_images_title":"node.content.outputImage")}),oe&&n.jsxs("div",{className:"text-[10px] text-gray-500 flex space-x-2 border-l border-gray-600 pl-3",children:[n.jsxs("span",{children:["Total: ",n.jsx("span",{className:"text-gray-300",children:s})]}),n.jsxs("span",{className:l>0?"text-cyan-400":"",children:["Done: ",l]}),n.jsxs("span",{className:"text-emerald-400",children:["Selected: ",K.length]}),r&&n.jsxs("span",{className:"text-cyan-400 animate-pulse",children:["Processing: ",c," of ",s]})]})]})}),oe&&n.jsxs("div",{className:"flex justify-between items-center bg-gray-900/50 p-1 rounded-md border border-gray-700",children:[n.jsx("div",{className:"flex items-center space-x-1 pl-1",children:n.jsxs("div",{className:"flex items-center gap-1 bg-gray-800 rounded p-0.5",children:[n.jsx(f0,{value:ne,onChange:X,placeholder:"1",title:"Start Index",className:"w-12 border-none",min:1}),n.jsx("span",{className:"text-[10px] text-gray-500",children:"-"}),n.jsx(f0,{value:ue,onChange:Q,placeholder:H?s.toString():t.length.toString(),title:"End Index",className:"w-12 border-none",min:1}),n.jsxs("div",{className:"flex items-center ml-1 border-l border-gray-600 pl-1",children:[n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white transition-colors",onClick:ye=>{ye.stopPropagation(),Ne("prev")},title:"Previous 5",children:n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:n.jsx("path",{d:"M15 18l-6-6 6-6"})})}),n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white transition-colors",onClick:ye=>{ye.stopPropagation(),Ne("next")},title:"Next 5",children:n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:n.jsx("path",{d:"M9 18l6-6-6-6"})})})]}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx("button",{onClick:Ie,className:"p-0.5 text-gray-400 hover:text-white transition-colors",title:"Select Range",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]})}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(we,{title:W("image_sequence.select_all"),onClick:I,disabled:s===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${s===0?"text-gray-600":"text-green-400"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(we,{title:W("image_sequence.select_none"),onClick:B,disabled:K.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${K.length===0?"text-gray-600":"text-red-400"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(we,{title:W("image_sequence.invert_selection"),onClick:M,disabled:s===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${s===0?"text-gray-600":"text-gray-300"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(we,{title:W("image_sequence.run_selected"),onClick:k,disabled:r||K.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${r||K.length===0?"text-gray-600":"text-emerald-400"}`,viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),n.jsx(we,{title:`${W("image_sequence.download_selected")} (${K.length})`,onClick:async()=>{var We,Ze;const ye=[...K].sort(($e,He)=>$e-He),Fe=new Date().toISOString().split("T")[0];if(U)try{const $e=Bi.default||Bi,He=new $e;for(const Te of ye){const qe=L(1e3+Te)||((We=le[Te])==null?void 0:We.thumbnail);if(qe&&qe.startsWith("data:image")){const Ye=String(Te+1).padStart(3,"0"),nt=((Ze=qe.match(/image\/(png|jpeg|jpg)/))==null?void 0:Ze[1])||"png",Nt=`Image_Editor_Frame_${Ye}.${nt}`,ze=await(await fetch(qe)).blob();He.file(Nt,ze)}}const be=await He.generateAsync({type:"blob",compression:"STORE"}),Ae=document.createElement("a");Ae.href=URL.createObjectURL(be),Ae.download=`Image_Editor_Sequence_${Fe}.zip`,Ae.click(),URL.revokeObjectURL(Ae.href)}catch($e){console.error("ZIP Error",$e)}else b()},disabled:K.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${K.length===0?"text-gray-600":"text-sky-400"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(we,{title:W("node.action.clear"),onClick:()=>w({sequenceOutputs:[]}),disabled:r||le.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${r||le.length===0?"text-gray-600":"text-gray-300 hover:text-white"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(we,{title:"Force Refresh",onClick:G,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})})]})]}),!oe&&n.jsxs("div",{onClick:V,onWheel:ye=>ye.stopPropagation(),className:"relative w-full flex-grow bg-gray-900/50 rounded-md flex items-center justify-center overflow-hidden group cursor-pointer",children:[R?n.jsx("img",{src:R,alt:"Output",className:"object-contain w-full h-full",onMouseDown:ye=>ye.stopPropagation(),draggable:!0,onDragStart:ye=>{const _e=d||R;_e&&(ye.dataTransfer.setData("application/prompt-modifier-drag-image",_e),ye.dataTransfer.effectAllowed="copy",ye.stopPropagation())}}):n.jsx("span",{className:"text-gray-400",children:W("node.content.imageHere")}),R&&!r&&n.jsxs("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none gap-4",children:[n.jsx("button",{onClick:ye=>{ye.stopPropagation(),E()},className:"w-20 h-20 flex items-center justify-center rounded-full bg-black/50 hover:bg-black/60 transition-colors pointer-events-auto","aria-label":W("node.action.copy"),title:W("node.action.copy"),children:Pe}),n.jsx("button",{onClick:ye=>{ye.stopPropagation(),_()},className:"w-20 h-20 flex items-center justify-center rounded-full bg-black/50 hover:bg-black/60 transition-colors pointer-events-auto","aria-label":W("node.action.download"),title:W("node.action.download"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-white/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]}),r&&n.jsxs("div",{className:"absolute inset-0 bg-gray-800/80 flex flex-col items-center justify-center text-white",children:[n.jsxs("svg",{className:"animate-spin h-8 w-8 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n.jsx("span",{className:"mt-2 font-semibold",children:W("node.content.generating")})]}),R&&n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx(we,{title:W("node.action.copy"),onClick:ye=>{ye.stopPropagation(),E()},children:n.jsx(zt,{})}),n.jsx(we,{title:W("node.action.download"),onClick:ye=>{ye.stopPropagation(),_()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]})]}),oe&&n.jsx("div",{className:"flex-grow min-h-0 flex flex-col space-y-2",children:n.jsx("div",{ref:ce,className:"flex-grow bg-gray-900/50 rounded-md overflow-y-auto p-2 custom-scrollbar relative",onScroll:ye=>me(ye.currentTarget.scrollTop),onWheel:ye=>ye.stopPropagation(),children:n.jsx("div",{style:{height:Me.totalHeight,width:"100%",position:"relative"},children:De().map(({index:ye,top:_e,left:Fe})=>{if(!(H||!de||de.includes(ye)))return null;const Ze=t[ye];if(!Ze&&!H)return null;const $e=le[ye],He=K.includes(ye),be=$e&&$e.status==="pending",Ae=$e&&$e.status==="generating",Te=$e&&$e.status==="error",qe=$e&&$e.status==="done"&&$e.thumbnail,Ye=L(1e3+ye);let nt=qe?$e.thumbnail:Ze?Ze.src:null;!qe&&H&&!nt&&t.length>0&&(nt=t[0].src);const Nt=!qe&&!be&&!Ae&&!Te&&nt,ze=Ye||nt,je=H;return n.jsxs("div",{className:"absolute rounded-lg border-2 overflow-hidden cursor-pointer border-gray-700 bg-gray-800 group",style:{top:_e,left:Fe,width:nr,height:nr},onClick:Le=>{Le.stopPropagation(),j(ye,ze||"")},children:[nt?n.jsx("img",{src:nt,alt:`Output ${ye+1}`,className:`w-full h-full object-contain ${Nt?"opacity-60":""}`,draggable:!0,onDragStart:Le=>{const rt=Ye||nt;rt&&(Le.dataTransfer.setData("application/prompt-modifier-drag-image",rt),Le.dataTransfer.effectAllowed="copy",Le.stopPropagation())}}):n.jsxs("div",{className:"w-full h-full flex items-center justify-center text-gray-600 text-xs",children:["Frame ",ye+1]}),n.jsx("div",{className:"absolute inset-x-0 top-0 h-12 bg-gradient-to-b from-black/80 to-transparent z-20 pointer-events-none"}),be&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60",children:n.jsx("span",{className:"text-xs text-gray-400 font-medium",children:W("imageEditor.status.queued")})}),Ae&&n.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/70 z-10",children:[n.jsxs("svg",{className:"animate-spin h-6 w-6 text-cyan-500 mb-1",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n.jsx("span",{className:"text-xs text-white font-medium mb-2",children:W("imageEditor.status.generating")}),n.jsx("button",{onClick:Le=>{Le.stopPropagation(),z(Le,ye)},className:"px-2 py-0.5 bg-red-600/90 hover:bg-red-700 text-white text-[10px] font-bold rounded shadow-sm border border-red-500/50",children:"Stop Queue"})]}),Te&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-900/50",children:n.jsx("span",{className:"text-xs text-red-200 font-medium",children:"Error"})}),n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity z-30",children:[n.jsx(we,{title:W("node.action.copy"),onClick:Le=>S(Le,ye),className:"p-1 text-gray-200 hover:text-white rounded hover:bg-gray-600 transition-colors",children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("rect",{x:"8",y:"8",width:"12",height:"12",rx:"2",ry:"2"}),n.jsx("path",{d:"M16 8V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2"})]})}),qe&&n.jsx(we,{title:W("node.action.download"),onClick:Le=>A(Le,ye),className:"p-1 text-gray-200 hover:text-white rounded hover:bg-gray-600 transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(we,{title:W("imageEditor.action.regenerate"),onClick:Le=>O(Le,ye),disabled:r,className:"p-1 text-gray-200 hover:text-white rounded hover:bg-gray-600 transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})}),je&&n.jsx(we,{title:W(T?"image_sequence.edit_in_source":"image_sequence.edit_prompt"),onClick:Le=>{Le.stopPropagation(),T?te(ye):F(ye)},className:"p-1 text-gray-200 hover:text-white rounded hover:bg-gray-600 transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]}),n.jsx("div",{className:"absolute top-1 left-1 z-20",onClick:Le=>{Le.stopPropagation(),P(ye)},children:n.jsx("input",{type:"checkbox",checked:He,readOnly:!0,className:"h-4 w-4 rounded bg-gray-900/50 border-gray-500 text-accent focus:ring-accent cursor-pointer"})}),n.jsxs("div",{className:"absolute bottom-1 left-1 right-1 flex justify-between items-end pointer-events-none z-20",children:[n.jsx("div",{}),n.jsx("div",{className:"bg-black/60 text-white text-[10px] px-1.5 py-0.5 rounded backdrop-blur-sm",children:ye+1})]})]},ye)})})})}),n.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 mt-2 pt-2 border-t border-gray-700/50",children:[n.jsxs("div",{className:"flex bg-gray-700 rounded-md p-1 space-x-1 h-[36px] flex-shrink-0",children:[n.jsx(mt,{content:"Gemini 2.5 Flash Image (Nano Banana)",className:"h-full",children:n.jsx("button",{onClick:()=>w({model:"gemini-2.5-flash-image"}),disabled:r,className:`px-2 text-xs font-bold rounded flex items-center transition-colors h-full ${ie==="gemini-2.5-flash-image"?"bg-cyan-600 text-white shadow":"text-gray-400 hover:text-white"}`,children:"Flash"})}),n.jsx(mt,{content:"Gemini 3.0 Image (Nano Banana Pro)",className:"h-full",children:n.jsx("button",{onClick:()=>w({model:"gemini-3-pro-image-preview"}),disabled:r,className:`px-2 text-xs font-bold rounded flex items-center transition-colors h-full ${ie==="gemini-3-pro-image-preview"?"bg-purple-600 text-white shadow":"text-gray-400 hover:text-white"}`,children:"Pro"})})]}),n.jsxs("div",{onClick:()=>w({autoCrop169:!Z}),className:`h-[36px] flex items-center gap-2 px-3 rounded-md cursor-pointer transition-colors border ${Z?"bg-indigo-900/40 border-indigo-500/50":"bg-gray-800 border-gray-700 hover:border-gray-600"}`,title:W("image_sequence.tooltip.autoCrop"),children:[n.jsx("span",{className:`text-[10px] font-bold uppercase whitespace-nowrap ${Z?"text-indigo-300":"text-gray-400"}`,children:"Crop 16:9"}),n.jsx("div",{className:`w-8 h-4 rounded-full relative transition-colors ${Z?"bg-indigo-500":"bg-gray-600"}`,children:n.jsx("div",{className:`absolute top-0.5 bottom-0.5 w-3 h-3 bg-white rounded-full shadow-sm transition-transform duration-200 ${Z?"translate-x-[16px]":"translate-x-[2px]"}`})})]}),n.jsxs("div",{className:"flex-1 flex space-x-2",children:[r&&oe?n.jsx("button",{onClick:f,className:"flex-1 h-[36px] font-bold text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors",children:W(a?"node.action.stopping":"node.action.stop")}):n.jsx("button",{onClick:oe?k:h,disabled:r||!o&&!H||!(T?D:re)&&!oe,className:"flex-1 h-[36px] font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",children:W(r?"node.content.editing":oe?"image_sequence.run_selected":"node.content.applyEdit")}),!oe&&n.jsx(mt,{content:"Edit in Canvas",children:n.jsx("button",{onClick:v,disabled:!R&&!u,className:"h-[36px] px-3 font-bold text-white bg-teal-600 rounded-md hover:bg-teal-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})})}),oe&&n.jsx("button",{onClick:b,disabled:K.length===0,className:"flex-1 h-[36px] py-2 text-sm font-bold text-white bg-sky-600 rounded-md hover:bg-sky-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",children:U?"Download ZIP":`${W("image_sequence.download_selected")} (${K.length})`})]}),!oe&&R&&n.jsx(we,{title:W("node.action.outputToInput"),onClick:N,className:"h-[36px]",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L9.414 11H13a1 1 0 100-2H9.414l1.293-1.293z",clipRule:"evenodd"})})})]})]})},x0={inputImages:[],inputImagesB:[],prompt:"",outputImage:null,enableOutpainting:!1,outpaintingPrompt:"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.",model:"gemini-2.5-flash-image",aspectRatio:"1:1",enableAspectRatio:!1,autoCrop169:!0,leftPaneWidth:360,topPaneHeight:330,resolution:"1K",isSequenceMode:!1,isSequentialCombinationMode:!1,isSequentialPromptMode:!1,isSequentialEditingWithPrompts:!1,framePrompts:{},sequenceOutputs:[],checkedSequenceOutputIndices:[],autoDownload:!0,createZip:!1,checkedInputIndices:[],selectedSourceFrameIndex:null},_s=280,y0=300,Xs=330,Ny=180,Ey=450,v0=({value:e,placeholder:t,onChange:o,min:r,className:a,title:i})=>{const s=c=>{const d=parseInt(e,10);let u=isNaN(d)?r||1:d+c;r!==void 0&&u<r&&(u=r),o(u.toString())},l=c=>{const d=c.target.value;if(d===""){o("");return}const u=parseInt(d,10);!isNaN(u)&&r!==void 0&&u<r||o(d)};return n.jsxs("div",{className:`relative flex items-center bg-gray-800 rounded border border-gray-600 h-6 ${a}`,title:i,children:[n.jsx("input",{type:"number",min:r,value:e,placeholder:t,onChange:l,className:"appearance-none w-full h-full bg-transparent text-[10px] text-white text-center focus:outline-none px-1 placeholder-gray-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",onClick:c=>c.stopPropagation(),onMouseDown:c=>c.stopPropagation()}),n.jsxs("div",{className:"flex flex-col h-full border-l border-gray-600 w-3 flex-shrink-0",children:[n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-gray-700 text-gray-400 hover:text-white transition-colors",onClick:c=>{c.stopPropagation(),s(1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-gray-700 text-gray-400 hover:text-white transition-colors border-t border-gray-600",onClick:c=>{c.stopPropagation(),s(-1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})},Ss=120,Qr=150,rr=4,w0=({title:e,slots:t,isB:o,isEditing:r,checkedIndices:a,getFullSizeImage:i,onCheck:s,onSelectAll:l,onSelectNone:c,onClear:d,onClick:u,onReorder:p,onRemove:m,onMoveToB:w,onFileClick:k,onDropFiles:b,onDropData:x,onSlotDrop:f,t:h,isSequentialCombinationMode:v,onSetCheckedIndices:N,onInvertSelection:_})=>{const[E,I]=y.useState(!1),[B,M]=y.useState(null),[G,V]=y.useState(""),[j,P]=y.useState(""),[S,A]=y.useState(null),O=y.useRef(null),[z,L]=y.useState(0),[W,D]=y.useState(0);y.useEffect(()=>{if(!O.current)return;const re=new ResizeObserver(R=>{R[0]&&D(R[0].contentRect.width)});return re.observe(O.current),()=>re.disconnect()},[]);const T=y.useMemo(()=>{const re=Math.max(0,W-8),R=Math.max(1,Math.floor((re+rr)/(Ss+rr))),J=t.length+1,U=Math.ceil(J/R)*(Qr+rr)+rr;return{columns:R,totalHeight:U,totalItems:J}},[W,t.length]),F=()=>{var ne;const{columns:re,totalItems:R}=T,J=400,H=Math.max(0,z-J),U=z+(((ne=O.current)==null?void 0:ne.clientHeight)||500)+J,ee=Math.floor(H/(Qr+rr)),ae=Math.ceil(U/(Qr+rr)),xe=[];for(let X=ee;X<=ae;X++)for(let ue=0;ue<re;ue++){const Q=X*re+ue;Q<R&&xe.push({index:Q,top:X*(Qr+rr),left:ue*(Ss+rr)})}return xe},te=re=>{re.preventDefault(),re.stopPropagation(),I(!0);const R=document.getElementById("app-container");R&&R.classList.remove("ring-2","ring-cyan-500","ring-inset")},$=re=>{re.preventDefault(),re.stopPropagation(),I(!0)},Y=re=>{re.preventDefault(),re.stopPropagation(),I(!1)},oe=re=>{re.preventDefault(),re.stopPropagation(),I(!1);const R=re.dataTransfer.getData("application/prompt-modifier-drag-image");if(R){x(R);return}const J=re.dataTransfer.getData("image-input-reorder-index");if(J){const H=parseInt(J,10);isNaN(H)||p(H,t.length),A(null);return}if(re.dataTransfer.files&&re.dataTransfer.files.length>0){const H=Array.from(re.dataTransfer.files).filter(U=>U.type.startsWith("image/"));H.length>0&&b(H)}},le=(re,R)=>{re.preventDefault(),re.stopPropagation(),M(R)},K=(re,R)=>{re.preventDefault(),re.stopPropagation(),M(null)},ie=(re,R)=>{var ee;re.preventDefault(),re.stopPropagation(),M(null);const J=re.dataTransfer.getData("image-input-reorder-index");if(J){const ae=parseInt(J,10);isNaN(ae)||p(ae,R),A(null);return}const H=re.dataTransfer.getData("application/prompt-modifier-drag-image");if(H){f(R,H);return}const U=(ee=re.dataTransfer.files)==null?void 0:ee[0];U&&U.type.startsWith("image/")&&f(R,U)},Z=(re,R)=>{r||(re.stopPropagation(),A(R),re.dataTransfer.setData("image-input-reorder-index",R.toString()),re.dataTransfer.effectAllowed="move")},se=()=>{if(!N)return;const re=parseInt(G,10),R=parseInt(j,10);if(isNaN(re))return;const J=isNaN(R)?t.length:Math.min(R,t.length),H=Math.max(1,re);if(H>J)return;const U=[];for(let ee=H-1;ee<J;ee++)U.push(ee);N(U)},de=re=>{const R=parseInt(G,10)||1,J=5;let H=Math.ceil(R/J);re==="next"?H++:H--,H<1&&(H=1);const U=(H-1)*J+1,ee=Math.min(U+J-1,t.length);if(V(U.toString()),P(ee.toString()),N){const ae=[];for(let xe=U-1;xe<ee;xe++)ae.push(xe);N(ae)}};return n.jsxs("div",{className:"flex-1 flex flex-col min-h-0 bg-gray-900/30 p-1 rounded-md border border-gray-700/50",children:[n.jsx("div",{className:"flex flex-col gap-1 mb-1 px-1",children:n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:e}),n.jsx("div",{className:"flex items-center space-x-1",children:o?n.jsx(we,{title:h("node.action.clear"),onClick:d,disabled:t.length===0||r,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 ${t.length===0||r?"text-gray-600":"text-gray-300 hover:text-white"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}):n.jsx(n.Fragment,{children:n.jsxs("div",{className:"flex items-center gap-1 bg-gray-800 rounded p-0.5 border border-gray-700 mr-2",children:[n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white transition-colors border-r border-gray-600 pr-1",onClick:re=>{re.stopPropagation(),de("prev")},title:"Previous 5",children:n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:n.jsx("path",{d:"M15 18l-6-6 6-6"})})}),n.jsx(v0,{value:G,onChange:V,placeholder:"1",title:"Start Index",className:"w-10 border-none",min:1}),n.jsx("span",{className:"text-[10px] text-gray-500",children:"-"}),n.jsx(v0,{value:j,onChange:P,placeholder:t.length.toString(),title:"End Index",className:"w-10 border-none",min:1}),n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white transition-colors border-l border-gray-600 pl-1",onClick:re=>{re.stopPropagation(),de("next")},title:"Next 5",children:n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:n.jsx("path",{d:"M9 18l6-6-6-6"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx("button",{onClick:se,className:"p-0.5 text-gray-400 hover:text-white transition-colors",title:"Select Range",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx(we,{title:h("image_sequence.select_all"),onClick:l,disabled:t.length===0||r,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 ${t.length===0||r?"text-gray-600":"text-gray-300 group-hover:text-white"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(we,{title:h("image_sequence.select_none"),onClick:c,disabled:!a||a.length===0||r,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 ${!a||a.length===0||r?"text-gray-600":"text-gray-300 group-hover:text-white"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),_&&n.jsx(we,{title:h("image_sequence.invert_selection"),onClick:_,disabled:t.length===0||r,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 ${t.length===0||r?"text-gray-600":"text-gray-300"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx(we,{title:h("node.action.clear"),onClick:d,disabled:t.length===0||r,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 ${t.length===0||r?"text-gray-600":"text-gray-300 hover:text-white"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})})]})}),n.jsx("div",{ref:O,className:"bg-gray-900/50 rounded-md overflow-y-auto p-1 min-h-0 flex-grow custom-scrollbar relative",onScroll:re=>L(re.currentTarget.scrollTop),onWheel:re=>re.stopPropagation(),children:n.jsx("div",{style:{height:T.totalHeight,width:"100%",position:"relative"},children:F().map(({index:re,top:R,left:J})=>{if(re===t.length)return n.jsx("div",{style:{position:"absolute",top:R,left:J,width:Ss,height:Qr},onClick:()=>!r&&k(),onDragEnter:te,onDragOver:$,onDragLeave:Y,onDrop:oe,className:`bg-transparent rounded-md flex items-center justify-center cursor-pointer border-2 border-dashed transition-colors ${E?"border-cyan-500 bg-gray-700/50":"border-gray-600 hover:border-cyan-500 hover:bg-gray-700/50"} ${r?"opacity-50 cursor-not-allowed":""}`,children:n.jsxs("div",{className:"text-center text-gray-500",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),n.jsx("span",{className:"text-[10px] mt-1 block",children:h("node.content.dropOrClick")})]})},"placeholder");const H=t[re],U=o?!0:!a||a.includes(re),ee=(o?2e3:0)+H.index+1,ae=H.type==="local"?i(ee):H.src,xe=B===H.index&&(!o||H.type==="local");return n.jsxs("div",{style:{position:"absolute",top:R,left:J,width:Ss,height:Qr},className:`relative group border-2 flex flex-col rounded-md overflow-visible bg-gray-800 transition-colors ${xe?"border-cyan-500 z-10":"border-gray-700 hover:border-gray-600"}`,onDragOver:ne=>le(ne,H.index),onDragLeave:ne=>K(ne,H.index),onDrop:ne=>ie(ne,H.index),children:[n.jsxs("div",{className:"h-6 bg-gray-900/80 border-b border-gray-700 flex items-center justify-between px-1 cursor-grab active:cursor-grabbing",draggable:H.type==="local"&&!r,onDragStart:ne=>H.type==="local"?Z(ne,re):ne.preventDefault(),children:[n.jsxs("div",{className:"flex items-center space-x-1",children:[!o&&H.type==="local"&&n.jsx("input",{type:"checkbox",checked:U,disabled:r,readOnly:!0,onClick:ne=>{ne.stopPropagation(),s(re)},className:"h-3 w-3 rounded bg-gray-900 border-gray-500 text-accent focus:ring-0 cursor-pointer disabled:opacity-50"}),n.jsxs("span",{className:"text-[10px] font-mono text-gray-400",children:["#",re+1]})]}),H.type==="local"&&!r&&n.jsxs("div",{className:"flex items-center gap-0.5",children:[n.jsx("button",{onClick:ne=>{ne.stopPropagation(),p(re,0)},className:"text-gray-500 hover:text-white p-0.5",title:"Top",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),n.jsx("button",{onClick:ne=>{ne.stopPropagation(),p(re,re-1)},className:"text-gray-500 hover:text-white p-0.5",title:"Up",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M5 15l7-7 7 7"})})}),n.jsx("button",{onClick:ne=>{ne.stopPropagation(),p(re,re+1)},className:"text-gray-500 hover:text-white p-0.5",title:"Down",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M19 9l-7 7-7-7"})})}),n.jsx("button",{onClick:ne=>{ne.stopPropagation(),p(re,t.length)},className:"text-gray-500 hover:text-white p-0.5",title:"Bottom",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-700 mx-0.5"}),n.jsx("button",{onClick:ne=>{ne.stopPropagation(),m(H.index)},className:"text-gray-500 hover:text-red-400 p-0.5",title:"Remove",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})]}),n.jsxs("div",{className:"flex-grow relative cursor-pointer overflow-hidden bg-black/40",onClick:()=>u(re),children:[H.src?n.jsx("img",{src:H.src||"",alt:`Input ${re+1}`,className:`object-contain w-full h-full ${!U&&H.type==="local"?"opacity-50":""}`,onMouseDown:ne=>ne.stopPropagation(),draggable:!0,onDragStart:ne=>{const X=ae||H.src;X&&(ne.dataTransfer.setData("application/prompt-modifier-drag-image",X),ne.dataTransfer.effectAllowed="copy",ne.stopPropagation())}}):n.jsx("div",{className:"w-full h-full bg-gray-800 flex items-center justify-center text-gray-600 text-xs",children:"No Image"}),H.type==="connected"&&n.jsx("div",{className:"absolute top-1 right-1 pointer-events-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-400 drop-shadow-md",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),!o&&v&&w&&H.type==="local"&&n.jsx("button",{onClick:ne=>{ne.stopPropagation(),w(H.index)},disabled:r,className:"absolute bottom-1 right-1 p-1 bg-gray-900/80 rounded text-gray-300 hover:text-cyan-400 opacity-0 group-hover:opacity-100 transition-opacity",title:"Move to Input B",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})})]})]},`${H.type}-${o?"b":"a"}-${H.index}`)})})})]})},Ht=({checked:e,onChange:t,label:o,disabled:r=!1,className:a="",title:i,id:s})=>n.jsxs("div",{id:s,className:`flex items-center space-x-2 cursor-pointer group select-none ${r?"opacity-50 cursor-not-allowed":""} ${a}`,onClick:l=>{l.stopPropagation(),r||t(!e,l)},onMouseDown:l=>l.stopPropagation(),title:i,children:[n.jsx("div",{className:`
                w-4 h-4 min-w-[1rem] min-h-[1rem] rounded border flex items-center justify-center transition-all duration-200 ease-in-out flex-shrink-0 relative
                ${e?"bg-accent border-accent shadow-[0_0_8px_var(--color-accent)]":"bg-gray-800 border-gray-600 group-hover:border-gray-500"}
            `,children:n.jsx("svg",{className:`w-3 h-3 text-white pointer-events-none block transition-transform duration-200 ${e?"scale-100":"scale-0"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,style:{transformOrigin:"center"},children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),o&&n.jsx("span",{className:`text-sm leading-tight pt-[1px] transition-colors ${e?"text-gray-200":"text-gray-400"} group-hover:text-gray-300`,children:o})]}),rj=({state:e,onUpdateState:t,onCleanupInputB:o,isEditing:r,t:a,nodeId:i,deselectAllNodes:s})=>{const{isSequenceMode:l,isSequentialCombinationMode:c,isSequentialPromptMode:d,isSequentialEditingWithPrompts:u,enableAspectRatio:p,aspectRatio:m,enableOutpainting:w,outpaintingPrompt:k}=e,b=y.useMemo(()=>[{value:"Auto",label:"Auto",icon:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})},{value:"1:1",label:"1:1",icon:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"5",y:"5",width:"14",height:"14",rx:"1"})})},{value:"16:9",label:"16:9",icon:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"2",y:"8",width:"20",height:"8",rx:"1"})})},{value:"9:16",label:"9:16",icon:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"8",y:"2",width:"8",height:"20",rx:"1"})})},{value:"4:3",label:"4:3",icon:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"3",y:"6",width:"18",height:"12",rx:"1"})})},{value:"3:4",label:"3:4",icon:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"6",y:"3",width:"12",height:"18",rx:"1"})})}],[]);return n.jsxs("div",{className:"flex-shrink-0 space-y-2",children:[n.jsxs("div",{className:"flex flex-col space-y-2",children:[n.jsx(Ht,{id:`sequence-mode-toggle-${i}`,checked:l,onChange:x=>{x||o(),t({isSequenceMode:x})},disabled:r,label:a("imageEditor.sequenceMode"),title:a("imageEditor.sequenceModeHelp")}),l&&n.jsxs("div",{className:"ml-6 flex flex-col space-y-1.5",children:[n.jsx(Ht,{id:`seq-combo-toggle-${i}`,checked:c,onChange:x=>{x?t({isSequentialCombinationMode:!0}):(o(),t({isSequentialCombinationMode:!1,isSequentialEditingWithPrompts:!1}))},disabled:r,label:a("imageEditor.sequentialCombination"),title:a("imageEditor.sequentialCombinationHelp")}),n.jsx(Ht,{id:`seq-prompt-toggle-${i}`,checked:d,onChange:x=>t({isSequentialPromptMode:x}),disabled:r,label:a("imageEditor.sequentialPrompt"),title:a("imageEditor.sequentialPromptHelp")}),n.jsx(Ht,{id:`seq-edit-prompts-toggle-${i}`,checked:u,onChange:x=>{t(x?{isSequentialEditingWithPrompts:!0,isSequentialCombinationMode:!1,isSequentialPromptMode:!0}:{isSequentialEditingWithPrompts:!1})},disabled:r,label:a("imageEditor.sequentialEditingWithPrompts"),title:a("imageEditor.sequentialEditingWithPromptsHelp")})]})]}),n.jsx("div",{className:"flex flex-col gap-2",children:n.jsx(Ht,{id:`aspect-ratio-toggle-${i}`,checked:p,onChange:x=>{t({enableAspectRatio:x,aspectRatio:"Auto",enableOutpainting:x?w:!1})},label:a("node.content.enableAspectRatioFormatting")})}),p&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:a("node.content.aspectRatio")}),n.jsx(An,{value:m||"1:1",onChange:x=>t({aspectRatio:x}),disabled:r,options:b})]}),n.jsxs("div",{className:"flex items-center space-x-2 pt-1",children:[n.jsx("input",{id:`outpainting-toggle-${i}`,type:"checkbox",checked:w,onChange:x=>t({enableOutpainting:x.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-cyan-600 focus:ring-cyan-500 bg-gray-700 cursor-pointer",onMouseDown:x=>x.stopPropagation()}),n.jsx("label",{htmlFor:`outpainting-toggle-${i}`,className:"text-sm text-gray-300 select-none cursor-pointer",children:a("node.content.enableOutpainting")})]}),w&&n.jsx(Cn,{value:k,onDebouncedChange:x=>t({outpaintingPrompt:x}),placeholder:a("node.content.outpaintingPromptPlaceholder"),className:"w-full p-2 bg-gray-900/50 rounded-md resize-none border border-gray-600 focus:border-cyan-500 focus:outline-none text-xs",style:{height:"60px"},onFocus:s,onWheel:x=>x.stopPropagation(),onMouseDown:x=>x.stopPropagation()})]})]})},aj=y.forwardRef(({totalFrames:e,framePrompts:t,globalPrompt:o,onChange:r,upstreamPrompts:a,t:i,visibleIndices:s,onAddFrame:l,onSync:c,onDeleteFrame:d,onMoveFrame:u,onSelectFrame:p,onClearAll:m,selectedFrameIndex:w},k)=>{const b=y.useRef(null),x=y.useRef([]),f=a&&a.size>0;y.useImperativeHandle(k,()=>({scrollToIndex:N=>{const _=x.current[N];if(_&&b.current){const E=b.current,I=_.offsetTop,B=I+_.offsetHeight,M=E.scrollTop,G=M+E.clientHeight;(I<M||B>G)&&_.scrollIntoView({behavior:"smooth",block:"center"})}}}));const h=Array.from({length:Math.max(1,e)},(N,_)=>_),v=s?h.filter(N=>s.includes(N)):h;return n.jsxs("div",{className:"flex-grow flex flex-col bg-gray-900/30 rounded-md border border-gray-700/50 overflow-hidden h-full",children:[n.jsxs("div",{className:"flex justify-between items-center p-1 bg-gray-800/80 border-b border-gray-700/50 flex-shrink-0",children:[n.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase px-1",children:i("prompt_sequence_editor.sourcePrompts")||"Source Prompts"}),f?n.jsx("div",{className:"flex items-center",children:n.jsx(we,{title:"Copy Upstream Prompts to Local",onClick:N=>{N.stopPropagation(),c&&c()},className:"p-1 hover:bg-cyan-900/50 rounded text-cyan-400 hover:text-cyan-200 transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})})}):n.jsxs("div",{className:"flex items-center space-x-1",children:[d&&n.jsx(we,{title:"Delete Selected Frame",onClick:N=>{N.stopPropagation(),w!=null&&d(w)},disabled:w==null,className:`p-1 rounded transition-colors ${w!=null?"hover:bg-red-900/50 text-gray-400 hover:text-red-400":"text-gray-600 cursor-not-allowed"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),m&&n.jsx(we,{title:"Clear All Prompts",onClick:N=>{N.stopPropagation(),m()},className:"p-1 hover:bg-red-900/50 rounded text-gray-500 hover:text-red-500 transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),l&&n.jsx("button",{onClick:N=>{N.stopPropagation(),l()},className:"p-1 hover:bg-gray-700 rounded text-cyan-400 hover:text-white transition-colors",title:"Add Prompt Slot",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]})]}),n.jsxs("div",{ref:b,className:"overflow-y-auto custom-scrollbar p-2 space-y-2 flex-grow min-h-0",onWheel:N=>N.stopPropagation(),children:[v.map(N=>{const _=a==null?void 0:a.get(N+1),E=t[N],I=f?_||"":E!==void 0?E:o,B=!f&&E===void 0&&!!o,M=w===N;return n.jsxs("div",{ref:G=>{x.current[N]=G},className:`flex flex-col bg-gray-800 rounded border transition-colors ${M?"border-cyan-500 ring-1 ring-cyan-500":"border-gray-700"}`,onClick:()=>p&&p(N),children:[n.jsxs("div",{className:"flex items-center justify-between px-2 py-1 bg-gray-700/50 border-b border-gray-600/30 h-7",children:[n.jsxs("span",{className:"text-[10px] font-bold text-gray-400 uppercase",children:["Frame ",N+1]}),!f&&u&&d&&n.jsxs("div",{className:"flex items-center space-x-0.5",children:[n.jsx("button",{onClick:G=>{G.stopPropagation(),u(N,0)},className:"p-0.5 text-gray-500 hover:text-white rounded",title:"Move to Top",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),n.jsx("button",{onClick:G=>{G.stopPropagation(),u(N,N-1)},disabled:N===0,className:"p-0.5 text-gray-500 hover:text-white rounded disabled:opacity-30",title:"Move Up",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M5 15l7-7 7 7"})})}),n.jsx("button",{onClick:G=>{G.stopPropagation(),u(N,N+1)},disabled:N===e-1,className:"p-0.5 text-gray-500 hover:text-white rounded disabled:opacity-30",title:"Move Down",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M19 9l-7 7-7-7"})})}),n.jsx("button",{onClick:G=>{G.stopPropagation(),u(N,e)},className:"p-0.5 text-gray-500 hover:text-white rounded",title:"Move to Bottom",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx("button",{onClick:G=>{G.stopPropagation(),d(N)},className:"p-0.5 text-gray-500 hover:text-red-400 rounded",title:"Delete Frame",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})]}),n.jsx(Cn,{value:I,onDebouncedChange:G=>!f&&r(N,G),placeholder:o||i("node.content.editPromptPlaceholder"),className:`w-full p-2 bg-transparent border-none rounded-b resize-none focus:outline-none text-xs min-h-[60px] ${B?"text-gray-500 italic":"text-gray-200"}`,readOnly:f,onWheel:G=>G.stopPropagation(),onMouseDown:G=>G.stopPropagation()})]},N)}),e===0&&n.jsx("div",{className:"text-center text-gray-500 text-xs py-4",children:"Add input images or prompts to define frames."})]})]})}),ij=y.forwardRef(({nodeId:e,state:t,leftPaneWidth:o,viewScale:r,imageSlots:a,imageSlotsB:i,onUpdateState:s,onCleanupInputB:l,inputListActions:c,previewElement:d,libraryItems:u,upstreamPrompt:p,upstreamPromptsMap:m,isTextConnected:w,isInputConnected:k,isEditing:b,seqTotalFrames:x,handleDetachAndPasteInput:f,handleManualRefresh:h,t:v,deselectAllNodes:N,onSyncPrompts:_,onDeleteFrame:E,onMoveFrame:I,onSelectFrame:B,onClearFrames:M,selectedFrameIndex:G},V)=>{const{topPaneHeight:j,inputImages:P,inputImagesB:S,checkedInputIndices:A,isSequenceMode:O,isSequentialCombinationMode:z,isSequentialPromptMode:L,isSequentialEditingWithPrompts:W,enableAspectRatio:D,framePrompts:T,prompt:F,enableOutpainting:te,outpaintingPrompt:$}=t,Y=y.useRef(null),{getFullSizeImage:oe,onCheck:le,onSelectAll:K,onSelectNone:ie,onClear:Z,onClick:se,onMove:de,onRemove:re,onMoveToB:R,onFileClick:J,onDropFiles:H,onDropData:U,onSlotDrop:ee}=c,ae=t.model==="gemini-3-pro-image-preview"?8:4,xe=v("node.content.inputImage"),ne=v(O&&z?"imageEditor.inputA":"imageEditor.input"),X=`${v("imageEditor.inputB")} (Max ${ae-1})`,ue=y.useCallback(Q=>{Q.preventDefault(),Q.stopPropagation();const ce=Q.clientY,pe=j,me=r,ke=Me=>{const De=(Me.clientY-ce)/me;if(Y.current){const Ie=Y.current.offsetHeight,Ne=D?Ey:Ny,Pe=Math.max(Xs,Math.min(pe+De,Ie-Ne));s({topPaneHeight:Pe})}},Re=()=>{window.removeEventListener("mousemove",ke),window.removeEventListener("mouseup",Re)};window.addEventListener("mousemove",ke),window.addEventListener("mouseup",Re)},[j,s,r,D]);return n.jsxs("div",{ref:Y,style:{width:`${o}px`},className:"h-full flex flex-col flex-shrink-0 pr-1",children:[n.jsxs("div",{className:"flex flex-col flex-shrink-0",style:{height:`${j}px`},children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsxs("div",{className:"flex items-center space-x-1",children:[k&&n.jsx(mt,{content:v("node.action.detachAndPaste"),children:n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white rounded transition-colors",onClick:Q=>{Q.stopPropagation(),f()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z",clipRule:"evenodd"})})})}),n.jsx("label",{className:"text-xs font-medium text-gray-400 flex-shrink-0",children:xe})]}),n.jsx(we,{title:" ",onClick:Q=>{Q.stopPropagation(),h()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})})]}),n.jsxs("div",{className:"flex-grow flex flex-col gap-1 min-h-0",children:[!W&&n.jsx(w0,{title:ne,slots:a,isB:!1,isEditing:b,checkedIndices:A,getFullSizeImage:Q=>oe(Q),onCheck:Q=>le(Q,!1),onSelectAll:()=>K(!1),onSelectNone:()=>ie(!1),onClear:()=>Z(!1),onClick:Q=>se(Q,!1),onReorder:(Q,ce)=>de(Q,ce,!1),onRemove:Q=>re(Q,!1),onMoveToB:z?R:void 0,onFileClick:()=>J(!1),onDropFiles:Q=>H(Q,!1),onDropData:Q=>U(Q,!1),onSlotDrop:(Q,ce)=>ee(Q,ce,!1),t:v,isSequentialCombinationMode:z,onSetCheckedIndices:Q=>s({checkedInputIndices:Q}),onInvertSelection:()=>{const ce=a.map((pe,me)=>me).filter(pe=>!A.includes(pe));s({checkedInputIndices:ce})}}),(W||O&&z)&&n.jsx(w0,{title:X,slots:i,isB:!0,isEditing:b,checkedIndices:[],getFullSizeImage:Q=>oe(2e3+Q),onCheck:()=>{},onSelectAll:()=>{},onSelectNone:()=>{},onClear:()=>Z(!0),onClick:Q=>se(Q,!0),onReorder:(Q,ce)=>de(Q,ce,!0),onRemove:Q=>re(Q,!0),onFileClick:()=>J(!0),onDropFiles:Q=>H(Q,!0),onDropData:Q=>U(Q,!0),onSlotDrop:(Q,ce)=>ee(Q,ce,!0),t:v,isSequentialCombinationMode:!0})]})]}),n.jsx("div",{onMouseDown:ue,className:"h-2 w-full bg-gray-700/50 hover:bg-cyan-600 cursor-row-resize rounded transition-colors flex-shrink-0 my-1"}),n.jsxs("div",{className:"flex-grow min-h-0 flex flex-col space-y-2",children:[n.jsx("div",{className:"flex-shrink-0 space-y-2",children:n.jsx(rj,{state:t,onUpdateState:s,onCleanupInputB:l,isEditing:b,t:v,nodeId:e,deselectAllNodes:N})}),d,n.jsxs("div",{className:"flex-grow flex flex-col min-h-0 mt-2 space-y-2 relative",children:[n.jsxs("div",{className:"relative flex-grow min-h-0 flex flex-col overflow-hidden",children:[!L&&!W&&n.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-1 mb-1",children:[n.jsx("div",{className:"flex-grow min-w-0",children:n.jsx(oh,{libraryItems:u,onPromptInsert:Q=>s({prompt:F?`${F.trim()}, ${Q}`:Q})})}),n.jsx(we,{title:v("node.action.clear"),onClick:()=>s({prompt:""}),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),n.jsx("div",{className:"flex-grow min-h-0 mt-1 relative",children:L&&O||W?n.jsx(aj,{ref:V,totalFrames:W?x:a.length,framePrompts:T||{},globalPrompt:F,onChange:(Q,ce)=>s({framePrompts:{...T||{},[Q]:ce}}),upstreamPrompts:m,t:v,visibleIndices:W?void 0:A,onAddFrame:W?()=>{const Q=Object.keys(T||{}).length;s({framePrompts:{...T||{},[Q]:""}})}:void 0,onSync:_,onDeleteFrame:E,onMoveFrame:I,onSelectFrame:B,onClearAll:M,selectedFrameIndex:G}):n.jsx(Cn,{value:w?p:F,onDebouncedChange:Q=>s({prompt:Q}),placeholder:w?p||v("node.content.connectedPlaceholder"):v("node.content.editPromptPlaceholder"),className:"w-full h-full p-2 bg-gray-900/50 rounded-md resize-none border border-gray-600 focus:border-cyan-500 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500",readOnly:w,onFocus:N,onWheel:Q=>Q.stopPropagation(),onMouseDown:Q=>Q.stopPropagation()})})]}),D&&n.jsxs("div",{className:"flex-shrink-0 space-y-2 pt-1 border-t border-gray-700/50",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("input",{id:`outpainting-toggle-${e}`,type:"checkbox",checked:te,onChange:Q=>s({enableOutpainting:Q.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-cyan-600 focus:ring-cyan-500 bg-gray-700 cursor-pointer",onMouseDown:Q=>Q.stopPropagation()}),n.jsx("label",{htmlFor:`outpainting-toggle-${e}`,className:"text-sm text-gray-300 select-none cursor-pointer",children:v("node.content.enableOutpainting")})]}),te&&n.jsx(Cn,{value:$,onDebouncedChange:Q=>s({outpaintingPrompt:Q}),placeholder:v("node.content.outpaintingPromptPlaceholder"),className:"w-full p-2 bg-gray-900/50 rounded-md resize-none border border-gray-600 focus:border-cyan-500 focus:outline-none text-xs",style:{height:"60px"},onFocus:N,onWheel:Q=>Q.stopPropagation(),onMouseDown:Q=>Q.stopPropagation()})]})]})]})]})}),sj=({node:e,onValueChange:t,onEditImage:o,onStopEdit:r,isEditingImage:a,onPasteImage:i,onSetImageEditorOutputToInput:s,connectedImageSources:l,t:c,deselectAllNodes:d,connectedInputs:u,onCopyImageToClipboard:p,onDownloadImage:m,libraryItems:w,onDetachImageToNode:k,getUpstreamNodeValues:b,viewTransform:x,setImageViewer:f,getFullSizeImage:h,setFullSizeImage:v,onDownloadImageFromUrl:N,onRefreshUpstreamData:_,isStopping:E,onCutConnections:I,addToast:B})=>{const{setConnections:M,handleNavigateToNodeFrame:G,nodes:V,connections:j}=Kt(),P=y.useRef(null),S=y.useRef(null),A=y.useRef(null),O=y.useRef(null),[z,L]=y.useState(null),W=y.useRef(null),[D,T]=y.useState(!1),[F,te]=y.useState(null),$=y.useRef(null),[Y,oe]=y.useReducer(Ee=>Ee+1,0),le=y.useMemo(()=>{try{return{...x0,...JSON.parse(e.value||"{}")}}catch{return x0}},[e.value]),K=y.useRef(le);K.current=le;const{inputImages:ie,inputImagesB:Z,prompt:se,outputImage:de,model:re,aspectRatio:R,enableAspectRatio:J,leftPaneWidth:H,topPaneHeight:U,resolution:ee,isSequenceMode:ae,isSequentialCombinationMode:xe,isSequentialEditingWithPrompts:ne,framePrompts:X,sequenceOutputs:ue,checkedSequenceOutputIndices:Q,checkedInputIndices:ce,enableOutpainting:pe,outpaintingPrompt:me,autoDownload:ke,autoCrop169:Re,isSequentialPromptMode:Me,createZip:De,selectedSourceFrameIndex:Ie}=le,Ne=re==="gemini-3-pro-image-preview",Pe=u==null?void 0:u.has("text"),ye=(x==null?void 0:x.scale)||1,_e=y.useCallback(Ee=>{const Ue={...K.current,...Ee};K.current=Ue,t(e.id,JSON.stringify(Ue))},[t,e.id]);y.useEffect(()=>{if(!e.width||!e.height)return;const Ee=Ft+Jt*2,Ue=e.width-y0-8;let Ke=H;H>Ue?Ke=Math.max(_s,Ue):H<_s&&(Ke=_s);const ut=e.height-Ee-(J?Ey:Ny)-8;let at=U;U>ut?at=Math.max(Xs,ut):U<Xs&&(at=Xs),(Ke!==H||at!==U)&&_e({leftPaneWidth:Ke,topPaneHeight:at})},[e.width,e.height,H,U,J,_e]);const Fe=y.useCallback(()=>{_e({inputImagesB:[],isSequentialCombinationMode:!1,isSequentialEditingWithPrompts:!1,isSequentialPromptMode:!1})},[_e]),We=y.useCallback(()=>{if(ae){const Ee=Q?[...Q].sort((Ue,Ke)=>Ue-Ke):[];o(e.id,Ee)}else o(e.id)},[ae,e.id,Q,o]),Ze=y.useCallback(()=>{r&&r()},[r]),$e=y.useCallback(()=>{const Ue=(K.current.sequenceOutputs||[]).map(Ke=>Ke?Ke.status==="done"?Ke:{...Ke,status:"idle"}:{status:"idle",thumbnail:null});_e({sequenceOutputs:Ue}),_&&_(e.id),oe()},[_e,_,e.id]),He=y.useCallback(Ee=>{Ee.preventDefault(),Ee.stopPropagation();const Ue=Ee.clientX,Ke=H;if(!A.current)return;const et=A.current.offsetWidth,ht=(x==null?void 0:x.scale)||1,ut=kt=>{const St=(kt.clientX-Ue)/ht,Ct=Math.max(_s,Math.min(Ke+St,et-y0));_e({leftPaneWidth:Ct})},at=()=>{window.removeEventListener("mousemove",ut),window.removeEventListener("mouseup",at)};window.addEventListener("mousemove",ut),window.addEventListener("mouseup",at)},[H,_e,x==null?void 0:x.scale]),be=y.useMemo(()=>{if(!Pe)return;const Ee=b(e.id,"text",void 0,!0).filter(et=>typeof et=="string"),Ue=new Map;let Ke=!1;return Ee.forEach(et=>{const ht=et.trim();if(ht.startsWith("{")||ht.startsWith("["))try{const ut=JSON.parse(et);let at=[];if(ut.sourcePrompts||ut.modifiedPrompts){const kt=ut.sourcePrompts||[],St=ut.modifiedPrompts||[],Ct=new Map;kt.forEach(Et=>Ct.set(Et.frameNumber,Et)),St.forEach(Et=>Ct.set(Et.frameNumber,{...Ct.get(Et.frameNumber),...Et})),at=Array.from(Ct.values()),Ke=!0}else ut.type==="script-prompt-modifier-data"?(at=ut.finalPrompts||ut.prompts||[],Ke=!0):Array.isArray(ut)&&(at=ut,Ke=!0);at.length>0&&at.forEach((kt,St)=>{const Ct=kt.frameNumber!==void 0?kt.frameNumber:St+1;kt.prompt&&Ue.set(Ct,kt.prompt)})}catch{}}),Ke?Ue:void 0},[Pe,b,e.id,Y]),Ae=y.useMemo(()=>Pe&&!be?b(e.id,"text",void 0,!0).filter(Ee=>typeof Ee=="string").join(`

`):"",[Pe,b,e.id,be]),Te=y.useMemo(()=>b(e.id,"image",void 0,!0),[b,e.id,Y]),qe=y.useMemo(()=>b(e.id,"image_b",void 0,!0),[b,e.id,Y]),Ye=async Ee=>{if(Ee instanceof File)return new Promise(Ue=>{const Ke=new FileReader;Ke.onload=et=>{var ht;return Ue((ht=et.target)==null?void 0:ht.result)},Ke.readAsDataURL(Ee)});if(typeof Ee=="string"){if(Ee.startsWith("data:"))return Ee;try{const Ke=await(await fetch(Ee)).blob();return new Promise(et=>{const ht=new FileReader;ht.onload=ut=>{var at;return et((at=ut.target)==null?void 0:at.result)},ht.readAsDataURL(Ke)})}catch{return null}}return null},nt=async(Ee,Ue)=>{const et=(await Promise.all(Ee.map(St=>Ye(St)))).filter(Boolean);if(et.length===0)return;const ht=Ue?K.current.inputImagesB||[]:K.current.inputImages||[],ut=Ue?2e3:0,at=[];for(let St=0;St<et.length;St++){const Ct=et[St],Et=ht.length+St;v(e.id,ut+Et+1,Ct);const Mt=await Ot(Ct,256,256);at.push(Mt)}const kt=[...ht,...at];_e(Ue?{inputImagesB:kt}:{inputImages:kt})},Nt=y.useCallback((Ee,Ue)=>{const Ke=Ue?"inputImagesB":"inputImages",ht=[...Ue?Z:ie];ht.splice(Ee,1);const ut=Ue?2e3:0;for(let kt=Ee;kt<ht.length;kt++){const St=h(e.id,ut+kt+2);St&&v(e.id,ut+kt+1,St)}const at={[Ke]:ht};!Ue&&ce&&(at.checkedInputIndices=ce.filter(kt=>kt!==Ee).map(kt=>kt>Ee?kt-1:kt)),_e(at)},[ie,Z,ce,_e,e.id,h,v]),ze=y.useCallback((Ee,Ue,Ke)=>{const et=Ke?Z:ie;if(Ee===Ue||Ue<0||Ue>=et.length)return;const ht=Ke?2e3:0,ut=et.map((Ct,Et)=>({thumb:Ct,full:h(e.id,ht+Et+1)})),[at]=ut.splice(Ee,1);ut.splice(Ue,0,at),ut.forEach((Ct,Et)=>{Ct.full&&v(e.id,ht+Et+1,Ct.full)});const kt=ut.map(Ct=>Ct.thumb),St={[Ke?"inputImagesB":"inputImages"]:kt};if(!Ke&&ce){const Ct=ce.includes(Ee);let Et=ce.map(Mt=>{if(Mt===Ee)return-1;if(Ee<Ue){if(Mt>Ee&&Mt<=Ue)return Mt-1}else if(Mt>=Ue&&Mt<Ee)return Mt+1;return Mt});if(Ct){const Mt=Et.indexOf(-1);Mt!==-1&&(Et[Mt]=Ue)}Et=Et.filter(Mt=>Mt!==-1).sort((Mt,Qo)=>Mt-Qo),St.checkedInputIndices=Et}_e(St)},[ie,Z,ce,_e,e.id,h,v]),je=y.useCallback(Ee=>{const Ue=ie[Ee],Ke=h(e.id,Ee+1)||Ue,et=[...ie];et.splice(Ee,1);for(let at=Ee;at<et.length;at++){const kt=h(e.id,at+2);v(e.id,at+1,kt||et[at])}const ht=[...Z,Ue];Ke&&v(e.id,2e3+ht.length,Ke);let ut=ce||[];ut.length>0&&(ut=ut.filter(at=>at!==Ee).map(at=>at>Ee?at-1:at)),_e({inputImages:et,inputImagesB:ht,checkedInputIndices:ut})},[ie,Z,h,v,e.id,_e,ce]),Le=async(Ee,Ue,Ke=!1)=>{const et=await Ye(Ue);if(!et)return;const ht=Ke?2e3:0;v(e.id,ht+Ee+1,et);const ut=await Ot(et,256,256),at=Ke?[...Z]:[...ie];at[Ee]=ut,_e({[Ke?"inputImagesB":"inputImages"]:at})},rt=(Ee,Ue,Ke)=>{const et=[];return Ue.forEach((ht,ut)=>{let at=null;typeof ht=="string"?at=ht:ht&&typeof ht=="object"&&(at=`data:${ht.mimeType};base64,${ht.base64ImageData}`),et.push({type:"connected",src:at,index:ut})}),Ee.forEach((ht,ut)=>et.push({type:"local",src:ht,index:ut})),et},Ce=y.useMemo(()=>rt(ie,Te),[ie,Te]),Se=y.useMemo(()=>rt(Z,qe),[Z,qe]),he=(u==null?void 0:u.has("image"))||le.isSequentialEditingWithPrompts&&(u==null?void 0:u.has("image_b")),ge=y.useMemo(()=>{if(ne){const Ee=Object.keys(X||{}).length,Ue=(be==null?void 0:be.size)||0;return Math.max(Ee,Ue,1)}return Ce.length},[ne,X,be,Ce.length]);y.useEffect(()=>{if(ne)(!Q||Q.length!==ge)&&_e({checkedSequenceOutputIndices:Array.from({length:ge},(Ee,Ue)=>Ue)});else{const Ee=ce?ce.length:0;(Ce.length>Ee||ce===void 0)&&_e({checkedInputIndices:Ce.map((Ue,Ke)=>Ke)})}},[Ce.length,ne,ge]),ne?Se.length>0:Ce.length>0;const ve=y.useMemo(()=>{if(ne){if(Se.length>0){const Ee=Se[Se.length-1];return Ee.type==="local"&&h(e.id,2e3+Ee.index+1)||Ee.src}}else{const Ee=Ce.filter((Ue,Ke)=>!ce||ce.includes(Ke));if(Ee.length>0){const Ue=Ee[Ee.length-1];return Ue.type==="local"&&h(e.id,Ue.index+1)||Ue.src}}return null},[Ce,Se,h,e.id,ce,ne]);y.useEffect(()=>{(async()=>{if(J&&ve&&R&&R!=="Auto")try{const{formattedImage:Ue}=await kr(ve,R);W.current=Ue,L(await Ot(Ue,256,256))}catch{L(null)}else J&&ve?(W.current=ve,L(ve.length>1e5?await Ot(ve,256,256):ve)):(L(null),W.current=null)})()},[ve,R,J]);const Ge=async()=>{W.current&&nt([W.current],!1)},Ve=(Ee,Ue)=>{const Ke=Ue?Se:Ce,et=Ue?2e3:0,ht=Ue?[]:b(e.id,"image",void 0,!1),ut=Ue?b(e.id,"image_b",void 0,!1):[],at=Ue?ut:ht,kt=Ke.map((St,Ct)=>{let Et=null;if(St.type==="local")Et=h(e.id,et+St.index+1)||St.src;else{const Mt=at[St.index];typeof Mt=="object"&&Mt.base64ImageData?Et=`data:${Mt.mimeType};base64,${Mt.base64ImageData}`:typeof Mt=="string"?Et=Mt:Et=St.src}return Et?{src:Et,frameNumber:Ct+1,prompt:`Input ${Ue?"B ":""}Image ${Ct+1}`}:null}).filter(Boolean);kt.length>0&&f({sources:kt,initialIndex:Ee})},ot=y.useCallback(()=>{let Ee="image",Ue=!1;K.current.isSequentialEditingWithPrompts&&(Ee="image_b",Ue=!0);const Ke=b(e.id,Ee,void 0,!1),et=[];Ke.forEach(ht=>{typeof ht=="string"?et.push(ht):ht&&typeof ht=="object"&&et.push(`data:${ht.mimeType};base64,${ht.base64ImageData}`)}),et.length>0&&(nt(et,Ue),I&&M(ht=>ht.filter(ut=>!(ut.toNodeId===e.id&&(ut.toHandleId===Ee||Ee==="image"&&ut.toHandleId===void 0)))))},[b,nt,I,e.id,M]),Xe=Ee=>{v(e.id,0,Ee),Ot(Ee,256,256).then(Ue=>_e({outputImage:Ue}))},pt={getFullSizeImage:Ee=>h(e.id,Ee),onCheck:(Ee,Ue)=>{if(!Ue){const Ke=K.current.checkedInputIndices||[],et=Ke.includes(Ee)?Ke.filter(ht=>ht!==Ee):[...Ke,Ee];_e({checkedInputIndices:et})}},onSelectAll:Ee=>{Ee||_e({checkedInputIndices:Ce.map((Ue,Ke)=>Ke)})},onSelectNone:Ee=>{Ee||_e({checkedInputIndices:[]})},onClear:Ee=>{_e(Ee?{inputImagesB:[]}:{inputImages:[],checkedInputIndices:[]})},onClick:Ve,onMove:ze,onRemove:Nt,onMoveToB:xe?je:void 0,onFileClick:Ee=>{var Ue,Ke;return Ee?(Ue=S.current)==null?void 0:Ue.click():(Ke=P.current)==null?void 0:Ke.click()},onDropFiles:nt,onDropData:(Ee,Ue)=>nt([Ee],Ue),onSlotDrop:Le},st=y.useCallback(Ee=>{const Ue={...K.current.framePrompts},Ke=[...K.current.sequenceOutputs||[]],et=Math.max(...Object.keys(Ue).map(Number)),ht={};for(let at=0;at<=et;at++)at<Ee?Ue[at]&&(ht[at]=Ue[at]):at>Ee&&Ue[at]&&(ht[at-1]=Ue[at]);Ee<Ke.length&&Ke.splice(Ee,1);let ut=Ie;ut===Ee?ut=null:ut!==null&&ut>Ee&&ut--,_e({framePrompts:ht,sequenceOutputs:Ke,selectedSourceFrameIndex:ut})},[_e,Ie]),ft=y.useCallback(()=>{_e({framePrompts:{},sequenceOutputs:[],selectedSourceFrameIndex:null})},[_e]),it=y.useCallback((Ee,Ue)=>{const Ke={...K.current.framePrompts},et=[...K.current.sequenceOutputs||[]],ht=Math.max(...Object.keys(Ke).map(Number),Ee,Ue),ut=[];for(let Et=0;Et<=ht;Et++)ut.push(Ke[Et]||"");const[at]=ut.splice(Ee,1);ut.splice(Ue,0,at);const kt={};for(ut.forEach((Et,Mt)=>{Et&&(kt[Mt]=Et)});et.length<=Math.max(Ee,Ue);)et.push({status:"idle",thumbnail:null});const[St]=et.splice(Ee,1);et.splice(Ue,0,St);let Ct=Ie;Ct===Ee?Ct=Ue:Ct!==null&&(Ee<Ue?Ct>Ee&&Ct<=Ue&&Ct--:Ct>=Ue&&Ct<Ee&&Ct++),_e({framePrompts:kt,sequenceOutputs:et,selectedSourceFrameIndex:Ct})},[_e,Ie]),wt=y.useCallback(Ee=>{_e({selectedSourceFrameIndex:Ee})},[_e]),dt=y.useMemo(()=>J&&n.jsx("div",{className:"relative group flex-shrink-0 mt-2 h-40 bg-gray-900/50 rounded-md flex items-center justify-center",children:z?n.jsxs(n.Fragment,{children:[n.jsx("img",{src:z,alt:"Preview",className:"max-w-full max-h-full object-contain",draggable:!0,onDragStart:Ee=>{(W.current||z)&&(Ee.dataTransfer.setData("application/prompt-modifier-drag-image",W.current||z),Ee.dataTransfer.effectAllowed="copy",Ee.stopPropagation())}}),n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx(we,{title:"Copy",onClick:Ee=>{Ee.stopPropagation(),p(W.current||z)},children:n.jsx(zt,{className:"h-4 w-4"})}),n.jsx(we,{title:"Use as Input",onClick:Ge,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L9.414 11H13a1 1 0 100-2H9.414l1.293-1.293z",clipRule:"evenodd"})})}),n.jsx(we,{title:"Detach",onClick:()=>{W.current&&k(W.current,e.id)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})})]})]}):n.jsx("p",{className:"text-gray-500 text-sm text-center px-2",children:c("node.content.previewPlaceholder")})}),[J,z,Ge,k,p,c]),_t=y.useCallback(Ee=>{O.current&&O.current.scrollToIndex(Ee)},[]),cn=y.useCallback(Ee=>{const Ue=(et,ht,ut=new Set)=>{if(!j||!V||ut.has(et))return;ut.add(et);const at=j.find(St=>St.toNodeId===et&&(St.toHandleId===ht||ht===void 0));if(!at)return;const kt=V.find(St=>St.id===at.fromNodeId);if(kt)return kt.type===q.REROUTE_DOT?Ue(kt.id,void 0,ut):kt.id},Ke=Ue(e.id,"text");Ke&&G&&G(Ke,Ee+1)},[j,V,G,e.id]),It=y.useCallback(()=>{if(!be||be.size===0)return;const Ee={...X};be.forEach((Ue,Ke)=>{Ee[Ke]=Ue}),_e({framePrompts:Ee})},[be,X,_e]);return n.jsxs("div",{ref:A,className:"flex w-full h-full",children:[n.jsx(ic,{isOpen:D,onClose:()=>{T(!1),$.current=null},onApply:Xe,imageSrc:F}),n.jsx("input",{ref:P,type:"file",accept:"image/*",className:"hidden",onChange:Ee=>{var Ue;(Ue=Ee.target.files)!=null&&Ue.length&&nt(Array.from(Ee.target.files),!1)},multiple:!0}),n.jsx("input",{ref:S,type:"file",accept:"image/*",className:"hidden",onChange:Ee=>{var Ue;(Ue=Ee.target.files)!=null&&Ue.length&&nt(Array.from(Ee.target.files),!0)},multiple:!0}),n.jsx(ij,{ref:O,nodeId:e.id,state:le,leftPaneWidth:H,viewScale:ye,imageSlots:Ce,imageSlotsB:Se,onUpdateState:_e,onCleanupInputB:Fe,onEditImage:()=>{},inputListActions:pt,previewElement:dt,libraryItems:w,upstreamPrompt:Ae,upstreamPromptsMap:be,isTextConnected:Pe,isInputConnected:he,isEditing:a,seqTotalFrames:ae&&ne?ge:Ce.length,handleDetachAndPasteInput:ot,handleManualRefresh:$e,t:c,deselectAllNodes:d,onCopyImageToClipboard:p,onDetachImageToNode:k,onSyncPrompts:It,onDeleteFrame:st,onMoveFrame:it,onSelectFrame:wt,onClearFrames:ft,selectedFrameIndex:Ie}),n.jsx("div",{onMouseDown:He,className:"w-2 h-full bg-gray-700/50 hover:bg-cyan-600 cursor-col-resize rounded transition-colors flex-shrink-0"}),n.jsx(oj,{state:le,imageSlots:ne?Se:Ce,hasInputImages:ne?Se.length>0:Ce.length>0,isEditing:a,isStopping:E,isGlobalProcessing:!1,totalFrames:ne?ge:ce.length,doneCount:ue.filter((Ee,Ue)=>(ne||ce.includes(Ue))&&(Ee==null?void 0:Ee.status)==="done").length,currentGeneratingDisplay:ue.findIndex(Ee=>(Ee==null?void 0:Ee.status)==="generating")+1||"-",fullSizeOutputForCopy:h(e.id,0)||de,imageForEditor:h(e.id,0)||de,modelOptions:[],isNanoBanana:Ne,onUpdateState:_e,onRunSelected:We,onDownloadSelected:async()=>{var et,ht;const Ee=[...Q].sort((ut,at)=>ut-at),Ke=new Date().toISOString().split("T")[0];if(De)try{const ut=new Bi;for(const St of Ee){const Ct=h(e.id,1e3+St)||((et=ue[St])==null?void 0:et.thumbnail);if(Ct&&Ct.startsWith("data:image")){const Mt=`Image_Editor_Frame_${String(St+1).padStart(3,"0")}.png`,Qo=Ct.split(",")[1];ut.file(Mt,Qo,{base64:!0})}}const at=await ut.generateAsync({type:"blob"}),kt=document.createElement("a");kt.href=URL.createObjectURL(at),kt.download=`Image_Editor_${Ke}.zip`,kt.click(),URL.revokeObjectURL(kt.href),B&&B("ZIP Downloaded","success")}catch(ut){console.error("ZIP Error",ut),B&&B("Failed to create ZIP","error")}else for(const ut of Ee){const at=h(e.id,1e3+ut)||((ht=ue[ut])==null?void 0:ht.thumbnail),St=`Image_Editor_Frame_${String(ut+1).padStart(3,"0")}_${Ke}.png`;at&&(N(at,ut+1,se||"Sequence",St),await new Promise(Ct=>setTimeout(Ct,300)))}},onStartQueue:()=>{},onStop:Ze,onEdit:We,onOpenEditor:()=>{const Ee=h(e.id,0)||de;Ee&&(te(Ee),$.current=0,T(!0))},onSetOutputToInput:()=>s(e.id),onDownload:()=>m(e.id),onCopy:()=>{const Ee=h(e.id,0)||de;Ee&&p(Ee)},onSelectAll:()=>_e({checkedSequenceOutputIndices:Array.from({length:ne?ge:Ce.length},(Ee,Ue)=>Ue)}),onSelectNone:()=>_e({checkedSequenceOutputIndices:[]}),onInvertSelection:()=>{const Ee=ne?ge:Ce.length,Ue=K.current.checkedSequenceOutputIndices||[],Ke=Array.from({length:Ee},(et,ht)=>ht).filter(et=>!Ue.includes(et));_e({checkedSequenceOutputIndices:Ke})},onManualRefresh:$e,onOutputClick:()=>{const Ee=h(e.id,0)||de;Ee&&f({sources:[{src:Ee,frameNumber:0,prompt:se}],initialIndex:0})},onSequenceOutputClick:(Ee,Ue)=>{if(!Ue)return;const Ke=ue.map((ht,ut)=>{const at=h(e.id,1e3+ut)||(ht==null?void 0:ht.thumbnail);return at?{src:at,frameNumber:ut+1,prompt:`Output ${ut+1}`}:null}).filter(ht=>ht!==null),et=Ke.findIndex(ht=>ht.frameNumber===Ee+1);et!==-1&&f({sources:Ke,initialIndex:et})},onCheckOutput:Ee=>{const Ue=K.current.checkedSequenceOutputIndices||[],Ke=Ue.includes(Ee)?Ue.filter(et=>et!==Ee):[...Ue,Ee];_e({checkedSequenceOutputIndices:Ke})},onCopyFrame:(Ee,Ue)=>{var et;Ee.stopPropagation();const Ke=h(e.id,1e3+Ue)||((et=ue[Ue])==null?void 0:et.thumbnail);Ke&&p(Ke)},onDownloadFrame:(Ee,Ue)=>{var et;Ee.stopPropagation();const Ke=h(e.id,1e3+Ue)||((et=ue[Ue])==null?void 0:et.thumbnail);if(Ke){const ut=new Date().toISOString().split("T")[0],kt=`Image_Editor_Frame_${String(Ue+1).padStart(3,"0")}_${ut}.png`;N(Ke,Ue+1,se,kt)}},onRegenerateFrame:(Ee,Ue)=>{Ee.stopPropagation(),o(e.id,[Ue])},onStopFrame:(Ee,Ue)=>{Ee.stopPropagation(),r&&r()},getFullSizeImage:Ee=>h(e.id,Ee),t:c,upstreamPrompt:Ae,isTextConnected:Pe,onEditPrompt:_t,onEditInSource:cn,deselectAllNodes:d,nodeId:e.id})]})},lj=({node:e,onValueChange:t,onAnalyzeImage:o,onImageToText:r,isAnalyzingImage:a,t:i,deselectAllNodes:s,connectedImageSources:l,setImageViewer:c,getFullSizeImage:d,onSaveToLibrary:u,onCopyImageToClipboard:p,addToast:m,onPasteImage:w,onOutputHandleMouseDown:k,onOutputHandleTouchStart:b,getHandleColor:x,handleCursor:f})=>{const h=y.useRef(null),[v,N]=y.useState(!1),_=Kt(),E=_==null?void 0:_.onAddNode,I=_==null?void 0:_.setConnections,B=_==null?void 0:_.handleAnalyzePrompt,M=_==null?void 0:_.getTransformedPoint,G=(_==null?void 0:_.connections)||[],V=(_==null?void 0:_.nodes)||[],j=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{image:null,description:"",softPrompt:!1}}},[e.value]),{image:P,description:S,softPrompt:A=!1}=j,O=l&&l.length>0,z=O?l[0]:P,L=Z=>{t(e.id,JSON.stringify({...j,...Z}))},W=Z=>{var de;const se=(de=Z.target.files)==null?void 0:de[0];se&&w(e.id,se)},D=Z=>{Z.preventDefault(),Z.stopPropagation(),N(!0);const se=document.getElementById("app-container");se&&se.classList.remove("ring-2","ring-cyan-500","ring-inset")},T=Z=>{Z.preventDefault(),Z.stopPropagation(),N(!0)},F=Z=>{Z.preventDefault(),Z.stopPropagation(),N(!1)},te=Z=>{var re;Z.preventDefault(),Z.stopPropagation(),N(!1);const se=Z.dataTransfer.getData("application/prompt-modifier-drag-image");if(se){fetch(se).then(R=>R.blob()).then(R=>{const J=new File([R],"dragged_image.png",{type:R.type});w(e.id,J)});return}const de=(re=Z.dataTransfer.files)==null?void 0:re[0];de&&de.type.startsWith("image/")&&w(e.id,de)},$=Z=>{var de;if(Z.stopPropagation(),!z&&O)return;if(!z&&!O){(de=h.current)==null||de.click();return}let se=z;O||(se=d(e.id,0)||P),se&&c({sources:[{src:se,frameNumber:0,prompt:S||"Analyzed Image"}],initialIndex:0})},Y=Z=>{Z.stopPropagation();let se=z;O||(se=d(e.id,0)||P),se&&p&&p(se)},oe=Z=>{Z.stopPropagation(),L({image:null}),m&&m(i("toast.contentCleared"))},le=Z=>{Z.stopPropagation(),S&&(navigator.clipboard.writeText(S),m&&m(i("toast.copiedToClipboard")))},K=Z=>{Z.stopPropagation(),S&&u&&u(S,"Image Analyzer Prompts")},ie=y.useCallback(Z=>{if(!E||!I||!B||!S)return;const se=G.find(re=>re.fromNodeId===e.id&&re.fromHandleId==="text");let de=null;if(se){const re=V.find(R=>R.id===se.toNodeId);re&&re.type===q.PROMPT_ANALYZER&&(de=re.id)}if(de)B(de);else{let re={x:e.position.x+e.width+50,y:e.position.y};M&&(re={x:M({x:Z.clientX,y:Z.clientY}).x+550,y:e.position.y});const R=E(q.PROMPT_ANALYZER,re);I(J=>[...J,{id:`conn-${Date.now()}-${Math.random()}`,fromNodeId:e.id,fromHandleId:"text",toNodeId:R,toHandleId:void 0}]),setTimeout(()=>{B(R)},100)}},[E,I,B,e,S,G,V,M]);return n.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[n.jsx("input",{ref:h,type:"file",accept:"image/*",className:"hidden",onChange:W}),n.jsxs("div",{className:"flex-1 flex flex-col min-h-0 space-y-2 relative group",children:[n.jsxs("div",{className:"flex-grow min-h-0 relative",children:[n.jsx("div",{onClick:$,onDragEnter:D,onDragOver:T,onDragLeave:F,onDrop:te,className:`w-full h-full bg-gray-700 rounded-md flex items-center justify-center transition-all cursor-pointer ${v?"bg-gray-600 ring-2 ring-accent-text":"hover:bg-gray-600"}`,children:z?n.jsx("img",{src:z,alt:"Input",className:"object-contain w-full h-full",draggable:!0,onMouseDown:Z=>Z.stopPropagation(),onDragStart:Z=>{let se=z;O||(se=d(e.id,0)||P),se&&(Z.dataTransfer.setData("application/prompt-modifier-drag-image",se),Z.dataTransfer.effectAllowed="copy",Z.stopPropagation())}}):!O&&n.jsx("span",{className:"text-gray-400 pointer-events-none",children:i("node.content.dropImage")})}),O&&n.jsxs("div",{className:"absolute inset-0 bg-gray-900/50 flex items-center justify-center rounded-md pointer-events-none group-hover:bg-gray-900/30 transition-colors",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-gray-400 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),n.jsx("div",{className:"absolute top-full mt-2 px-2 py-1 bg-slate-700 text-slate-200 text-sm rounded-md shadow-xl z-50 opacity-0 group-hover:opacity-100 transition-opacity",children:i("node.content.connectedPlaceholder")})]}),z&&n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[n.jsx(we,{title:i("node.action.copy"),onClick:Y,children:n.jsx(zt,{className:"h-4 w-4"})}),!O&&n.jsx(we,{title:i("node.action.clear"),onClick:oe,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),n.jsxs("div",{className:"flex flex-col gap-2 shrink-0",children:[n.jsx("button",{onClick:()=>o(e.id),disabled:a||!z,className:"w-full px-4 py-2 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center whitespace-nowrap",children:i(a?"node.content.analyzing":"node.content.analyzeImage")}),r&&n.jsx("button",{onClick:()=>r(e.id),disabled:a||!z,className:"w-full px-4 py-2 font-bold text-white bg-accent-secondary rounded-md hover:bg-accent-secondary-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center whitespace-nowrap",children:i("node.content.imageToText")})]})]}),n.jsxs("div",{className:"flex-1 flex flex-col min-h-0 space-y-2 relative group",children:[n.jsxs("div",{className:"flex-grow min-h-0 flex flex-col relative",children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-400",children:i("node.content.prompt")}),n.jsxs("div",{className:"flex space-x-1",children:[n.jsx(we,{title:i("node.action.copy"),onClick:le,disabled:!S,children:n.jsx(zt,{className:"h-4 w-4"})}),n.jsx(we,{title:i("catalog.saveTo"),onClick:K,disabled:!S,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})})]})]}),n.jsx("textarea",{value:S,onChange:Z=>L({description:Z.target.value}),placeholder:i("node.content.descriptionHere"),className:"w-full h-full p-2 bg-gray-700 border-none rounded-md resize-none focus:ring-2 focus:ring-accent focus:outline-none flex-grow",onWheel:Z=>Z.stopPropagation(),onMouseDown:Z=>Z.stopPropagation(),onFocus:s})]}),n.jsx("div",{className:"flex items-center space-x-2 flex-shrink-0",children:n.jsx(Ht,{id:`soft-prompt-toggle-${e.id}`,checked:A,onChange:Z=>L({softPrompt:Z}),disabled:a||!z,label:" "})}),n.jsx("button",{onClick:ie,disabled:!S||a,className:"w-full px-4 py-2 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex-shrink-0",children:i("node.content.analyzePrompt")})]})]})},cj=({node:e,onValueChange:t,onAnalyze:o,isAnalyzing:r,onOutputHandleMouseDown:a,getHandleColor:i,handleCursor:s,t:l,deselectAllNodes:c,onSaveToLibrary:d})=>{const u=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{environment:"",characters:[],action:"",emotion:"",style:"",softPrompt:!1}}},[e.value]),{environment:p,characters:m=[],action:w,emotion:k,style:b,softPrompt:x=!1}=u,f=Math.max(1,m.length),h=E=>{t(e.id,JSON.stringify({...u,...E}))},v=(E,I)=>{const B=[...m];B[E]=I,h({characters:B})},N=(E,I)=>{E.stopPropagation(),a(E,e.id,I)},_=(E,I,B,M,G)=>{const V=E.startsWith("character")?`${l("node.content.character")} ${G+1}`:l(`node.content.${E}`),j=l(`node.content.${E}Placeholder`),P=S=>{S.stopPropagation(),d&&I&&d(I,"Analyzer Prompts")};return n.jsxs("div",{className:"relative flex-grow flex flex-col",children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400",children:V}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(we,{tooltipPosition:"left",title:l("catalog.saveTo"),onClick:P,disabled:!I,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})}),n.jsx(we,{tooltipPosition:"left",title:l("node.action.copy"),onClick:S=>{S.stopPropagation(),navigator.clipboard.writeText(I||"")},children:n.jsx(zt,{className:"h-4 w-4"})})]})]}),n.jsx("div",{className:"flex-grow min-h-0",children:n.jsx("textarea",{value:I||"",onChange:S=>B(S.target.value),placeholder:j,className:"w-full h-full p-2 bg-gray-700 border-none rounded-md resize-none focus:ring-2 focus:ring-accent focus:outline-none",onWheel:S=>S.stopPropagation(),onMouseDown:S=>S.stopPropagation(),onFocus:c})}),n.jsx("div",{onMouseDown:S=>N(S,M),style:{cursor:s},className:`absolute top-1/2 -right-2.5 w-5 h-5 rounded-full border-2 border-gray-900 transform -translate-y-1/2 ${i("text",M)} group`,children:n.jsx("div",{className:"absolute right-full mr-3 top-1/2 -translate-y-1/2 px-2 py-1 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:V})})]},M)};return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 px-2",children:[_("environment",p,E=>h({environment:E}),"environment"),Array.from({length:f}).map((E,I)=>_("character",m[I]||"",B=>v(I,B),`character-${I}`,I)),_("action",w,E=>h({action:E}),"action"),_("emotion",k,E=>h({emotion:E}),"emotion"),_("style",b,E=>h({style:E}),"style")]}),n.jsx("div",{className:"flex items-center space-x-2 mt-2 px-2",children:n.jsx(Ht,{id:`soft-prompt-toggle-${e.id}`,checked:x,onChange:E=>h({softPrompt:E}),disabled:r,label:" "})}),n.jsx("div",{className:"px-2",children:n.jsx("button",{onClick:()=>o(e.id),disabled:r,className:"w-full px-4 py-2 mt-2 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex-shrink-0",children:l(r?"node.content.analyzing":"node.content.analyzePrompt")})})]})},dj=({node:e,onValueChange:t,onAnalyzeCharacter:o,isAnalyzingCharacter:r,t:a,onSelectNode:i})=>{const s=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{character:"",clothing:""}}},[e.value]),l=c=>{t(e.id,JSON.stringify({...s,...c}))};return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"grid grid-rows-2 gap-2 flex-grow min-h-0",children:[n.jsx("div",{className:"min-h-0",children:n.jsx("textarea",{value:s.character||"",onChange:c=>l({character:c.target.value}),placeholder:a("node.content.characterPlaceholder"),className:"w-full h-full p-2 bg-gray-700 border-none rounded-md resize-none focus:ring-2 focus:ring-cyan-500 focus:outline-none",onWheel:c=>c.stopPropagation(),onMouseDown:c=>{c.stopPropagation(),i()},onKeyDown:c=>c.stopPropagation()})}),n.jsx("div",{className:"min-h-0",children:n.jsx("textarea",{value:s.clothing||"",onChange:c=>l({clothing:c.target.value}),placeholder:a("node.content.clothingPlaceholder"),className:"w-full h-full p-2 bg-gray-700 border-none rounded-md resize-none focus:ring-2 focus:ring-cyan-500 focus:outline-none",onWheel:c=>c.stopPropagation(),onMouseDown:c=>{c.stopPropagation(),i()},onKeyDown:c=>c.stopPropagation()})})]}),n.jsx("button",{onClick:()=>o(e.id),disabled:r,className:"w-full px-4 py-2 mt-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:a(r?"node.content.analyzing":"node.content.analyzeCharacter")})]})},uj=({node:e,onValueChange:t,onEnhance:o,isEnhancing:r,onProcessChainForward:a,isExecutingChain:i,t:s,onSelectNode:l,onSavePromptToLibrary:c,addToast:d,connectedInputs:u,getUpstreamNodeValues:p})=>{const{language:m}=Pt(),w=Kt(),{tutorialStep:k,tutorialTargetId:b,advanceTutorial:x,skipTutorial:f}=w||{},h=b===e.id&&k==="prompt_processor_enhance",v=b===e.id&&k==="prompt_processor_waiting",N=()=>{o(e.id),h&&x&&x()};y.useEffect(()=>{v&&!r&&x&&x()},[r,v,x]);const _=y.useMemo(()=>{try{const z=JSON.parse(e.value||"{}");return typeof z=="object"&&z!==null?{inputPrompt:z.inputPrompt||"",prompt:z.prompt||"",safePrompt:z.safePrompt!==!1,technicalPrompt:z.technicalPrompt===!0,model:z.model||"gemini-3-flash-preview"}:{inputPrompt:"",prompt:e.value,safePrompt:!0,technicalPrompt:!1,model:"gemini-3-flash-preview"}}catch{return{inputPrompt:"",prompt:e.value,safePrompt:!0,technicalPrompt:!1,model:"gemini-3-flash-preview"}}},[e.value]),E=u==null?void 0:u.has(void 0),I=y.useMemo(()=>E?p(e.id).filter(L=>typeof L=="string"&&L.trim()!=="").join(", "):"",[E,p,e.id,e.value]),B=z=>{t(e.id,JSON.stringify({..._,safePrompt:z}))},M=z=>{t(e.id,JSON.stringify({..._,technicalPrompt:z}))},G=z=>{t(e.id,JSON.stringify({..._,model:z}))},V=z=>{t(e.id,JSON.stringify({..._,inputPrompt:z}))},j=z=>{t(e.id,JSON.stringify({..._,prompt:z}))},P=async()=>{try{const z=await navigator.clipboard.readText();if(z){const L=_.inputPrompt?`${_.inputPrompt}, ${z}`:z;V(L),d&&d(s("toast.pastedFromClipboard"))}}catch{d&&d(s("toast.pasteFailed"),"error")}},S=()=>{const z=_y(m),L=_.inputPrompt?`${_.inputPrompt}, ${z}`:z;V(L)},A=z=>{z.stopPropagation(),c&&_.prompt&&c(_.prompt)},O=z=>{z.stopPropagation(),_.prompt&&(navigator.clipboard.writeText(_.prompt),d&&d(s("toast.copiedToClipboard")))};return n.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[n.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsxs("div",{className:"flex items-center space-x-1",children:[E&&n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:E?s("node.content.connectedNode"):" "})]}),!E&&n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(we,{title:s("node.action.randomWord"),onClick:S,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})}),n.jsx(we,{title:s("node.action.paste"),onClick:P,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})})]})]}),n.jsx(Cn,{value:E?I:_.inputPrompt,onDebouncedChange:V,placeholder:s("node.content.editPromptPlaceholder"),className:`w-full h-full p-2 bg-input border-none rounded-md resize-none focus:ring-2 focus:ring-accent focus:outline-none ${E?"text-gray-400 cursor-default":"text-white"}`,onWheel:z=>z.stopPropagation(),onMouseDown:z=>{z.stopPropagation(),l()},readOnly:E})]}),n.jsxs("div",{className:"flex-1 flex flex-col min-h-0 relative",children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:s("node.content.enhancedResult")}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(we,{title:s("node.action.copy"),onClick:O,disabled:!_.prompt,children:n.jsx(zt,{className:"h-4 w-4"})}),n.jsx(we,{title:s("catalog.saveTo"),onClick:A,disabled:!_.prompt,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})})]})]}),n.jsx(Cn,{value:_.prompt,onDebouncedChange:j,placeholder:s("node.content.enhancedPromptHere"),className:"w-full h-full p-2 bg-input border-none rounded-md resize-none focus:ring-2 focus:ring-accent focus:outline-none",onWheel:z=>z.stopPropagation(),onMouseDown:z=>{z.stopPropagation(),l()}})]}),n.jsxs("div",{className:"flex flex-col gap-1 pt-1 items-start",onMouseDown:z=>{z.stopPropagation(),l()},children:[n.jsx(mt,{content:s("node.promptProcessor.safePromptTooltip"),position:"top",align:"start",usePortal:!1,children:n.jsx(Ht,{checked:_.safePrompt,onChange:B,disabled:r||i,label:s("node.content.safePrompt")})}),n.jsx(mt,{content:s("node.promptProcessor.technicalPromptTooltip"),position:"top",align:"start",usePortal:!1,children:n.jsx(Ht,{checked:_.technicalPrompt,onChange:M,disabled:r||i,label:s("node.content.technicalPrompt")})})]}),n.jsxs("div",{className:"flex space-x-2 h-10",children:[n.jsxs("div",{className:"flex bg-gray-700 rounded-md p-1 space-x-1 h-10 flex-shrink-0 w-24",children:[n.jsx(mt,{content:"Gemini 3.0 Flash",className:"h-full flex-1",children:n.jsx("button",{onClick:()=>G("gemini-3-flash-preview"),disabled:r||i,className:`flex-1 rounded text-[10px] font-bold transition-colors h-full ${_.model==="gemini-3-flash-preview"?"bg-accent text-white shadow":"text-gray-400 hover:text-white"}`,children:"Flash"})}),n.jsx(mt,{content:"Gemini 3.0 Pro",className:"h-full flex-1",children:n.jsx("button",{onClick:()=>G("gemini-3-pro-preview"),disabled:r||i,className:`flex-1 rounded text-[10px] font-bold transition-colors h-full ${_.model==="gemini-3-pro-preview"?"bg-purple-600 text-white shadow":"text-gray-400 hover:text-white"}`,children:"Pro"})})]}),n.jsx(Bn,{content:s(v?"tutorial.step2_waiting":"tutorial.step2"),isActive:!!h||!!v,position:"top",pulseColor:v?"rgba(234, 179, 8, 0.8)":void 0,onSkip:f,className:"flex-grow h-full",children:n.jsx(mt,{content:s("node.promptProcessor.enhanceTooltip"),position:"top",className:"w-full h-full",usePortal:!1,children:n.jsx("button",{onClick:N,disabled:r||i,className:"w-full h-full px-4 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:s(r?"node.content.enhancing":"node.content.enhancePrompt")})})}),n.jsx(mt,{content:s("node.promptProcessor.chainTooltip"),position:"top",className:"h-10 w-10 flex-shrink-0",usePortal:!1,children:n.jsx("button",{onClick:()=>a(e.id),disabled:r||i,className:"h-10 w-10 flex items-center justify-center font-bold text-white bg-accent-secondary rounded-md hover:bg-accent-secondary-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:i?n.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 5l7 7m0 0l-7 7m7-7H3"})})})})]})]})},pj=({node:e,isGeneratingImage:t,isExecutingChain:o,onModelChange:r,onAspectRatioChange:a,onResolutionChange:i,onAutoDownloadChange:s,onGenerateImage:l,onStopChainExecution:c,onExecuteChain:d,t:u,onDownloadImage:p,setImageViewer:m,getFullSizeImage:w,setFullSizeImage:k,onValueChange:b,getUpstreamNodeValues:x,isGlobalProcessing:f,onCopyImageToClipboard:h,addToast:v})=>{const N=Kt(),{tutorialStep:_,tutorialTargetId:E,advanceTutorial:I,skipTutorial:B}=N||{},[M,G]=y.useState(null),V=E===e.id&&_==="image_output_generate",P=x(e.id).filter(oe=>typeof oe=="string").join(", "),S=()=>{l(e.id),V&&I&&I()},A=oe=>{oe.stopPropagation();const le=w(e.id,0)||e.value;le&&h&&h(le)},O=async oe=>{const le=w(e.id,0)||e.value;if(le){G(oe);try{const ie=await sc(le,oe,P,"gemini-2.5-flash-image");k(e.id,0,ie);const Z=await Ot(ie,256,256);b(e.id,Z),v&&v(`Expanded to ${oe}`,"success")}catch(K){console.error("Ratio expansion failed:",K),v&&v(`Failed to expand: ${K.message}`,"error")}finally{G(null)}}},z=["1:1","16:9","9:16","4:3","3:4"],L=[{value:"imagen-4.0-generate-001",label:"Imagen 4.0 (Quality)"},{value:"imagen-4.0-ultra-generate-preview-06-06",label:"Imagen 4.0 Ultra (Preview)"},{value:"gemini-3-pro-image-preview",label:"Gemini 3.0 Pro (Nano Banana Pro)"},{value:"gemini-2.5-flash-image",label:"Gemini 2.5 Flash Image (Nano Banana)"}],W=e.model==="gemini-3-pro-image-preview",T=!e.model||e.model.startsWith("imagen-4.0")||W,F=[{value:"1K",label:"1K"},{value:"2K",label:"2K"},{value:"4K",label:"4K"}],te=()=>{if(!e.value)return;const oe=w(e.id,0)||e.value;oe&&m({sources:[{src:oe,frameNumber:0,prompt:P}],initialIndex:0})},$=n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-white/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("rect",{x:"8",y:"8",width:"12",height:"12",rx:"2",ry:"2"}),n.jsx("path",{d:"M16 8V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2"})]}),Y=()=>n.jsxs("svg",{className:"animate-spin h-3 w-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]});return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{onClick:te,onWheel:oe=>oe.stopPropagation(),className:"relative w-full flex-grow bg-gray-700 rounded-md flex items-center justify-center overflow-hidden mb-2 group cursor-pointer border border-gray-600 hover:border-gray-500 transition-colors",children:[e.value?n.jsx("img",{src:e.value||w(e.id,0),alt:"Generated result",className:"object-contain w-full h-full",draggable:!0,onMouseDown:oe=>oe.stopPropagation(),onDragStart:oe=>{const le=w(e.id,0)||e.value;if(le){oe.dataTransfer.setData("application/prompt-modifier-drag-image",le),oe.dataTransfer.setData("application/prompt-modifier-drag-info",JSON.stringify({src:le,prompt:P}));const K=`Output_Image_${Date.now()}.png`;oe.dataTransfer.setData("DownloadURL",`image/png:${K}:${le}`),oe.dataTransfer.setData("text/html",`<img src="${le}" alt="Exported Image" />`),oe.dataTransfer.setData("text/uri-list",le),oe.dataTransfer.effectAllowed="copy",oe.stopPropagation()}}}):n.jsx("span",{className:"text-gray-400",children:u("node.content.imageHere")}),n.jsxs("div",{className:`absolute inset-0 bg-gray-800/70 backdrop-blur-sm flex flex-col items-center justify-center text-white z-10 transition-opacity duration-300 ${t||o&&!e.value?"opacity-100":"opacity-0 pointer-events-none"}`,children:[n.jsxs("svg",{className:"animate-spin h-8 w-8 text-accent-text",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n.jsx("span",{className:"mt-2 font-semibold text-accent-text",children:o?"Executing...":u("node.content.generating")})]}),e.value&&!(t||o&&!e.value)&&n.jsxs("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none gap-4",children:[n.jsx("button",{onClick:A,className:"w-20 h-20 flex items-center justify-center rounded-full bg-black/50 hover:bg-black/60 transition-colors pointer-events-auto","aria-label":u("node.action.copy"),title:u("node.action.copy"),children:$}),n.jsx("button",{onClick:oe=>{oe.stopPropagation(),p(e.id)},className:"w-20 h-20 flex items-center justify-center rounded-full bg-black/50 hover:bg-black/60 transition-colors pointer-events-auto","aria-label":u("node.action.download"),title:u("node.action.download"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-white/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]}),e.value&&n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx(we,{title:u("node.action.copy"),onClick:A,children:n.jsx(zt,{})}),n.jsx(we,{title:u("node.action.download"),onClick:oe=>{oe.stopPropagation(),p(e.id)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]}),e.value&&!(t||o&&!e.value)&&n.jsxs("div",{className:"absolute bottom-2 right-2 flex gap-1 z-20 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[n.jsx("button",{onClick:oe=>{oe.stopPropagation(),O("16:9")},disabled:t||o||!!M,className:"px-2 py-1 text-[10px] font-bold text-gray-200 bg-gray-800/80 hover:bg-gray-700 hover:text-white border border-gray-600/50 rounded backdrop-blur-sm shadow-sm flex items-center gap-1 transition-colors pointer-events-auto",title:"Expand to 16:9",children:M==="16:9"?n.jsx(Y,{}):n.jsxs(n.Fragment,{children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"2",y:"8",width:"20",height:"8",rx:"1"})}),"16:9"]})}),n.jsx("button",{onClick:oe=>{oe.stopPropagation(),O("9:16")},disabled:t||o||!!M,className:"px-2 py-1 text-[10px] font-bold text-gray-200 bg-gray-800/80 hover:bg-gray-700 hover:text-white border border-gray-600/50 rounded backdrop-blur-sm shadow-sm flex items-center gap-1 transition-colors pointer-events-auto",title:"Expand to 9:16",children:M==="9:16"?n.jsx(Y,{}):n.jsxs(n.Fragment,{children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"8",y:"2",width:"8",height:"20",rx:"1"})}),"9:16"]})})]})]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:u("node.content.generationMode")}),n.jsx(An,{id:`model-select-${e.id}`,value:e.model||"imagen-4.0-generate-001",onChange:oe=>r(e.id,oe),disabled:t||o,options:L})]}),W&&n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Resolution"}),n.jsx(An,{value:e.resolution&&["1K","2K","4K"].includes(e.resolution)?e.resolution:"1K",onChange:oe=>i(e.id,oe),disabled:t||o,options:F})]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{htmlFor:`aspect-ratio-${e.id}`,className:`block text-xs font-medium mb-1 transition-colors ${T?"text-gray-400":"text-gray-600"}`,children:u("node.content.aspectRatio")}),n.jsx(An,{id:`aspect-ratio-${e.id}`,value:e.aspectRatio||"1:1",onChange:oe=>a(e.id,oe),disabled:t||!T||o,title:u(T?"node.content.aspectRatioHelp":"node.content.aspectRatioNotSupportedFast"),options:z.map(oe=>({value:oe,label:oe}))})]}),n.jsx("div",{className:"mb-2",children:n.jsx(Ht,{id:`auto-download-toggle-${e.id}`,checked:!!e.autoDownload,onChange:oe=>s(e.id,oe),disabled:t||o,label:u("node.content.autoDownload")})}),n.jsxs("div",{className:"flex space-x-2 h-10",children:[n.jsx(Bn,{content:u("tutorial.step3"),isActive:!!V,position:"top",onSkip:B,className:"flex-grow h-full",children:n.jsx("button",{onClick:S,disabled:t||o||f||!!M,className:"w-full h-full px-4 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:u(t?"node.content.generating":"node.content.generateImage")})}),o?n.jsx("button",{onClick:c,className:"h-10 w-10 flex-shrink-0 flex items-center justify-center font-bold text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors duration-200",title:" ",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1zm4 0a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})}):n.jsx("button",{onClick:()=>d(e.id),disabled:t||o||f||!!M,className:"h-10 w-10 flex-shrink-0 flex items-center justify-center font-bold text-white bg-accent-secondary rounded-md hover:bg-accent-secondary-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",title:u("node.action.executeChainTitle"),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})})]})]})},hj=({node:e,isGeneratingVideo:t,isExecutingChain:o,onAspectRatioChange:r,onResolutionChange:a,onAutoDownloadChange:i,onGenerateVideo:s,onStopChainExecution:l,onExecuteChain:c,t:d,isGlobalProcessing:u})=>{const p=["16:9","9:16"],m=["720p","1080p"];return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"relative w-full flex-grow bg-gray-700 rounded-md flex items-center justify-center overflow-hidden mb-2",children:[e.value?n.jsx("video",{src:e.value,controls:!0,className:"object-contain w-full h-full"}):n.jsx("span",{className:"text-gray-400",children:"Video will appear here"}),n.jsxs("div",{className:`absolute inset-0 bg-gray-800/70 backdrop-blur-sm flex flex-col items-center justify-center text-white z-10 transition-opacity duration-300 ${t||o&&!e.value?"opacity-100":"opacity-0 pointer-events-none"}`,children:[n.jsxs("svg",{className:"animate-spin h-8 w-8 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n.jsx("span",{className:"mt-2 font-semibold",children:d(o?"node.content.processingChain":"node.content.generating")})]})]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{htmlFor:`aspect-ratio-${e.id}`,className:"block text-xs font-medium mb-1 text-gray-400",children:d("node.content.aspectRatio")}),n.jsx(An,{id:`aspect-ratio-${e.id}`,value:e.aspectRatio||"16:9",onChange:w=>r(e.id,w),disabled:t||o,options:p.map(w=>({value:w,label:w}))})]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{htmlFor:`resolution-${e.id}`,className:"block text-xs font-medium mb-1 text-gray-400",children:"Resolution"}),n.jsx(An,{id:`resolution-${e.id}`,value:e.resolution||"720p",onChange:w=>a(e.id,w),disabled:t||o,options:m.map(w=>({value:w,label:w}))})]}),n.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[n.jsx("input",{type:"checkbox",id:`auto-download-toggle-${e.id}`,checked:!!e.autoDownload,onChange:w=>i(e.id,w.target.checked),disabled:t||o,className:"h-4 w-4 rounded border-gray-300 text-accent focus:ring-accent bg-gray-700 cursor-pointer",onMouseDown:w=>w.stopPropagation()}),n.jsx("label",{htmlFor:`auto-download-toggle-${e.id}`,className:"text-sm text-gray-300 select-none cursor-pointer",children:d("node.content.autoDownload")})]}),n.jsxs("div",{className:"flex space-x-2",children:[n.jsx("button",{onClick:()=>s(e.id),disabled:t||o||u,className:"w-1/2 px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:t?d("node.content.generating"):"Generate Video"}),o?n.jsxs("button",{onClick:l,className:"w-1/2 px-4 py-2 font-bold text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors duration-200 flex items-center justify-center space-x-2",title:" ",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1zm4 0a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),n.jsx("span",{children:"Stop"})]}):n.jsxs("button",{onClick:()=>c(e.id),disabled:t||o||u,className:"w-1/2 px-4 py-2 font-bold text-white bg-teal-600 rounded-md hover:bg-teal-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center space-x-2",title:d("node.action.executeChainTitle"),children:[n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),n.jsx("span",{children:d("node.action.executeChain")})]})]})]})},mj=({node:e,onValueChange:t,onEnhanceVideo:o,isEnhancingVideo:r,onProcessChainForward:a,isExecutingChain:i,t:s,onSelectNode:l,connectedInputs:c,getUpstreamNodeValues:d})=>{const u=y.useMemo(()=>{try{const k=JSON.parse(e.value||"{}");return typeof k=="object"&&k!==null?{inputPrompt:k.inputPrompt||"",prompt:k.prompt||k.value||""}:{inputPrompt:"",prompt:e.value||""}}catch{return{inputPrompt:"",prompt:e.value||""}}},[e.value]),p=c==null?void 0:c.has(void 0),m=y.useMemo(()=>p?d(e.id).filter(b=>typeof b=="string").join(", "):"",[p,d,e.id,e.value]),w=k=>{t(e.id,JSON.stringify({...u,inputPrompt:k}))};return n.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[n.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase mb-1",children:p?s("node.content.connectedPlaceholder"):"Input Prompt"}),n.jsx(Cn,{value:p?m:u.inputPrompt,onDebouncedChange:w,placeholder:s("node.content.editPromptPlaceholder"),className:`w-full h-full p-2 bg-input border-none rounded-md resize-none focus:ring-2 focus:ring-cyan-500 focus:outline-none ${p?"text-gray-400 cursor-not-allowed":"text-white"}`,onWheel:k=>k.stopPropagation(),onMouseDown:k=>{k.stopPropagation(),l()},readOnly:p})]}),n.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[n.jsx("label",{className:"text-[10px] font-bold text-cyan-400 uppercase mb-1",children:"Video Prompt"}),n.jsx("textarea",{readOnly:!0,value:u.prompt,placeholder:s("node.content.enhancedPromptHere"),className:"w-full h-full p-2 bg-input border-none rounded-md resize-none focus:outline-none",onWheel:k=>k.stopPropagation(),onMouseDown:k=>{k.stopPropagation(),l()}})]}),n.jsxs("div",{className:"flex space-x-2 pt-1",children:[n.jsx("button",{onClick:()=>o(e.id),disabled:r||i,className:"w-1/2 px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:s(r?"node.content.enhancing":"node.content.enhancePrompt")}),n.jsxs("button",{onClick:()=>a(e.id),disabled:r||i,className:"w-1/2 px-4 py-2 font-bold text-white bg-accent-secondary rounded-md hover:bg-accent-secondary-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center space-x-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 5l7 7m0 0l-7 7m7-7H3"})}),n.jsx("span",{children:s(i?"node.content.processingChain":"node.action.processChainForward")})]})]})]})},gj=({node:e,onValueChange:t,connectedInputs:o,isGeneratingScript:r,onGenerateScript:a,t:i,deselectAllNodes:s})=>{const l=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{type:"script-generator-data",prompt:"",summary:"",detailedCharacters:[],scenes:[],targetLanguage:"en"}}},[e.value]),{prompt:c="",summary:d="",detailedCharacters:u=[],scenes:p=[],targetLanguage:m="en"}=l,w=o==null?void 0:o.has(void 0),k=x=>{t(e.id,JSON.stringify({...l,type:"script-generator-data",...x}))},b=Object.entries(xn);return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex-shrink-0 space-y-2 mb-2",children:[n.jsx("textarea",{value:c,onChange:x=>k({prompt:x.target.value}),placeholder:i(w?"node.content.connectedPlaceholder":"node.content.scriptPromptPlaceholder"),className:"w-full p-2 bg-gray-700 border-none rounded-md resize-none focus:ring-2 focus:ring-cyan-500 focus:outline-none",onWheel:x=>x.stopPropagation(),onMouseDown:x=>x.stopPropagation(),disabled:w,rows:3,onFocus:s}),n.jsxs("div",{className:"flex items-end space-x-2",children:[n.jsxs("div",{className:"flex-grow",children:[n.jsx("label",{htmlFor:`lang-select-${e.id}`,className:"block text-xs font-medium text-gray-400 mb-1",children:i("node.content.targetLanguage")}),n.jsx("select",{id:`lang-select-${e.id}`,value:m,onChange:x=>k({targetLanguage:x.target.value}),onMouseDown:x=>x.stopPropagation(),disabled:r,className:"w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:ring-2 focus:ring-cyan-500 focus:outline-none disabled:opacity-50",children:b.map(([x,{name:f}])=>n.jsx("option",{value:x,children:f},x))})]}),n.jsx("button",{onClick:()=>a(e.id),disabled:r||!w&&!c.trim(),className:"px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:i(r?"node.content.generating":"node.content.generateScript")})]})]}),n.jsxs("div",{className:"flex-grow min-h-0 overflow-y-auto space-y-4 pr-2",onWheel:x=>x.stopPropagation(),children:[d&&n.jsxs("div",{className:"bg-gray-700/50 p-3 rounded-lg",children:[n.jsx("h3",{className:"font-bold text-cyan-400 mb-1",children:"Summary"}),n.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:d})]}),u.length>0&&u.map((x,f)=>n.jsxs("div",{className:"bg-gray-700/50 p-3 rounded-lg",children:[n.jsx("h3",{className:"font-bold text-cyan-400 mb-1",children:x.name}),n.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:x.fullDescription})]},`char-${f}`)),p.length>0&&p.map((x,f)=>n.jsxs("div",{className:"bg-gray-700/50 p-3 rounded-lg",children:[n.jsxs("h3",{className:"font-bold text-cyan-400 mb-1",children:["Scene ",x.sceneNumber]}),n.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:x.description})]},`scene-${f}`))]})]})},fj=e=>(e||"").split(`
`).filter(t=>t.trim()!=="").map((t,o)=>t.startsWith("####")?n.jsx("h5",{className:"block text-cyan-400 font-bold mt-2 mb-1 text-base",children:t.replace(/####/g,"").trim()},o):n.jsx("span",{className:"block select-text break-words whitespace-pre-wrap",children:t},o)),ar=({isCollapsed:e,onClick:t,className:o})=>n.jsx("button",{onClick:t,className:`p-1 rounded hover:bg-gray-600 text-gray-400 hover:text-white transition-colors focus:outline-none ${o}`,children:e?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),xj=({node:e,onValueChange:t,onLoadScriptFile:o,t:r,onSaveScriptToCatalog:a,onSaveScriptToDisk:i,onTranslateScript:s,isTranslatingScript:l})=>{const[c,d]=y.useState(new Set),u=v=>{d(N=>{const _=new Set(N);return _.has(v)?_.delete(v):_.add(v),_})},p=y.useMemo(()=>{var v;try{if(!e.value||e.value==="{}")return{type:"empty",targetLanguage:"en"};const N=JSON.parse(e.value),_=N.targetLanguage||"en";return N.type==="script-generator-data"?{type:"generator",data:N,targetLanguage:_}:N.type==="script-analyzer-data"?{type:"analyzer",data:N,targetLanguage:_}:N.summary&&N.detailedCharacters&&N.scenes?{type:"generator",data:{...N,type:"script-generator-data"},targetLanguage:_}:N.characters&&N.scenes&&Array.isArray(N.scenes)&&((v=N.scenes[0])!=null&&v.frames)?{type:"analyzer",data:{...N,type:"script-analyzer-data"},targetLanguage:_}:{type:"invalid",targetLanguage:_}}catch{return{type:"invalid",targetLanguage:"en"}}},[e.value]),m=v=>{try{const _={...JSON.parse(e.value||"{}"),targetLanguage:v};t(e.id,JSON.stringify(_,null,2))}catch{t(e.id,JSON.stringify({targetLanguage:v},null,2))}},w=(v,N)=>n.jsxs("div",{className:"mb-4 pb-2 border-b border-gray-600 flex justify-between items-end",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-bold text-white",children:v}),N&&n.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:["Model: ",n.jsx("span",{className:"text-cyan-300",children:N})]})]}),n.jsx("div",{className:"text-xs text-gray-500 font-mono",children:"JSON"})]}),k=(v,N,_)=>n.jsxs("div",{className:"relative bg-gray-700/50 p-3 rounded-lg group overflow-hidden mb-2",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("h4",{className:"font-bold text-cyan-400 mb-1 truncate",children:v}),n.jsx("div",{className:"flex-shrink-0 ml-2",children:n.jsx(we,{title:r("node.action.copy"),onClick:E=>{E.stopPropagation(),navigator.clipboard.writeText(N)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})]}),n.jsx("div",{className:"text-sm text-gray-300 whitespace-pre-wrap select-text break-words",children:N})]},_),b=()=>{const v=p.type==="analyzer",N=[{id:"full-json",label:"Full Data JSON",copyVal:e.value}];v&&(N.push({id:"all-image-prompts",label:"All Image Prompts",copyVal:""}),N.push({id:"all-video-prompts",label:"All Video Prompts",copyVal:""}));const _=E=>{var M;const I=p.type==="analyzer"?p.data:null;if(!I||!I.scenes)return"";const B=[];return p.type==="analyzer"&&((M=I.scenes)==null||M.forEach(G=>G.frames.forEach(V=>{const j=E==="img"?V.imagePrompt:V.videoPrompt;j&&B.push(j)}))),B.join(`
`)};return n.jsx("div",{className:"mb-4 space-y-2",children:N.map(E=>n.jsxs("div",{className:"relative flex justify-between items-center p-2 rounded bg-gray-800 border border-gray-700 shadow-sm",children:[n.jsx("span",{className:"text-xs font-bold text-gray-400 pl-1 uppercase tracking-wider",children:E.label}),n.jsx("div",{className:"flex items-center",children:n.jsx(we,{title:r("node.action.copy"),onClick:I=>{I.stopPropagation();const B=E.id==="full-json"?E.copyVal:E.id==="all-image-prompts"?_("img"):_("vid");navigator.clipboard.writeText(B||"")},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})]},E.id))})},x=(v,N,_)=>{const E=`char-${N}`,I=c.has(E);return n.jsxs("div",{className:"bg-gray-700/50 rounded-lg group overflow-hidden mb-2 border border-gray-600/30",children:[n.jsxs("div",{className:"flex justify-between items-center p-3 cursor-pointer hover:bg-gray-700/80 transition-colors",onClick:B=>{B.stopPropagation(),u(E)},children:[n.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[n.jsx(ar,{isCollapsed:I,onClick:B=>{B.stopPropagation(),u(E)}}),n.jsxs("h4",{className:"font-bold text-cyan-400 truncate",children:[v.name,v.alias&&n.jsxs("span",{className:"text-xs font-mono text-gray-400 ml-2",children:["(",v.alias,")"]}),v.index&&n.jsxs("span",{className:"text-xs font-mono text-gray-500 ml-2",children:["[",v.index,"]"]})]})]}),n.jsx("div",{className:"flex flex-col items-end space-y-2 flex-shrink-0",children:n.jsx("div",{className:"opacity-100",children:n.jsx(we,{title:r("node.action.copy"),onClick:B=>{B.stopPropagation(),navigator.clipboard.writeText(v.fullDescription)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})})]}),!I&&n.jsxs("div",{className:"px-3 pb-3 pt-0 text-sm text-gray-300 whitespace-pre-wrap select-text break-words border-t border-gray-600/30 mt-1",children:[fj(v.fullDescription),_&&v.imagePrompt&&n.jsxs("div",{className:"mt-2 p-2 bg-gray-800/50 rounded border-l-2 border-cyan-500",children:[n.jsx("span",{className:"text-xs font-bold text-gray-400 block uppercase mb-1",children:"Image Prompt"}),n.jsx("span",{className:"text-xs text-gray-300",children:v.imagePrompt})]})]})]},v.id||N)},f=(v,N)=>{var G;const _=`Frame ${v.frameNumber} ${v.duration?`(${v.duration}s)`:""} ${v.shotType?`[${v.shotType}]`:""}`,E=((G=v.characters)==null?void 0:G.join(", "))||"",I=`frame-${N}-${v.frameNumber}`,B=c.has(I),M=[{label:"Description",value:v.description},{label:"Environment",value:v.environmentPrompt},{label:"Image Prompt",value:v.imagePrompt},{label:"Video Prompt",value:v.videoPrompt}].filter(V=>V.value);return n.jsxs("div",{className:"bg-gray-700/50 rounded-lg overflow-hidden mb-2 border border-gray-600/20",children:[n.jsx("div",{className:"flex justify-between items-center p-3 cursor-pointer hover:bg-gray-700/80 transition-colors",onClick:V=>{V.stopPropagation(),u(I)},children:n.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[n.jsx(ar,{isCollapsed:B,onClick:V=>{V.stopPropagation(),u(I)}}),n.jsx("h4",{className:"font-bold text-cyan-300 text-sm truncate",children:_}),E&&n.jsxs("span",{className:"text-xs text-gray-400 truncate max-w-[120px]",title:E,children:["Chars: ",E]})]})}),!B&&n.jsx("div",{className:"px-3 pb-3 pt-0 space-y-2 border-t border-gray-600/20 mt-1",children:M.map(V=>n.jsxs("div",{className:"relative bg-gray-800/50 p-2 rounded group overflow-hidden",children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsx("label",{className:"text-[10px] uppercase font-bold text-gray-400 truncate",children:V.label}),n.jsx("div",{className:"flex items-center space-x-1 flex-shrink-0",children:n.jsx("div",{children:n.jsx(we,{title:r("node.action.copy"),onClick:j=>{j.stopPropagation(),navigator.clipboard.writeText(V.value)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})})]}),n.jsx("p",{className:"text-xs text-gray-200 whitespace-pre-wrap select-text break-words leading-relaxed",children:V.value})]},V.label))})]},`frame-${v.frameNumber}`)},h=()=>{switch(p.type){case"empty":return n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500 p-4",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})}),n.jsx("p",{className:"font-semibold",children:"No Script Loaded"}),n.jsx("p",{className:"text-sm mt-1",children:'Drop a JSON file here or use the "Load" button.'})]});case"invalid":return n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center p-4",children:[n.jsx("span",{className:"text-red-400 font-bold mb-2",children:"Format Error"}),n.jsx("span",{className:"text-sm text-gray-400",children:r("node.content.unrecognizedFormat")})]});case"generator":{const v=p.data,N=v.customVisualStyle||v.visualStyle||v.generatedStyle||"",_=c.has("section-characters"),E=c.has("section-scenes");return n.jsxs("div",{className:"space-y-6 pb-4",children:[w("Generated Script",v.model),b(),N&&n.jsxs("div",{className:"bg-gray-800/30 p-3 rounded-lg border border-gray-600/50",children:[n.jsx("h3",{className:"font-bold text-cyan-400 mb-1 text-sm uppercase tracking-wider",children:r("node.content.style")}),n.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:N})]}),v.summary&&n.jsxs("div",{className:"bg-gray-800/30 p-3 rounded-lg border border-gray-600/50",children:[n.jsx("h3",{className:"font-bold text-cyan-400 mb-1 text-sm uppercase tracking-wider",children:r("node.content.summary")}),k("Summary",v.summary,"summary")]}),v.detailedCharacters&&v.detailedCharacters.length>0&&n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center mb-3 border-b border-gray-700 pb-1 cursor-pointer hover:bg-gray-800/50 rounded px-1 -mx-1",onClick:()=>u("section-characters"),children:[n.jsx(ar,{isCollapsed:_,onClick:I=>{I.stopPropagation(),u("section-characters")}}),n.jsx("h3",{className:"font-bold text-cyan-400 text-sm uppercase tracking-wider ml-2 select-none",children:r("node.content.characters")})]}),!_&&n.jsx("div",{className:"space-y-2",children:v.detailedCharacters.map((I,B)=>x(I,B,!1))})]}),v.scenes&&v.scenes.length>0&&n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center mb-3 border-b border-gray-700 pb-1 cursor-pointer hover:bg-gray-800/50 rounded px-1 -mx-1",onClick:()=>u("section-scenes"),children:[n.jsx(ar,{isCollapsed:E,onClick:I=>{I.stopPropagation(),u("section-scenes")}}),n.jsx("h3",{className:"font-bold text-cyan-400 text-sm uppercase tracking-wider ml-2 select-none",children:r("node.content.scenes")})]}),!E&&n.jsx("div",{className:"space-y-6",children:v.scenes.map((I,B)=>{const M=`scene-${I.sceneNumber}`,G=c.has(M);return n.jsxs("div",{className:"relative pl-4 border-l-2 border-gray-700",children:[n.jsx("div",{className:"absolute -left-[5px] top-0 w-2.5 h-2.5 bg-gray-600 rounded-full"}),n.jsxs("div",{className:"flex items-center mb-2 cursor-pointer hover:bg-gray-800/30 rounded",onClick:()=>u(M),children:[n.jsx(ar,{isCollapsed:G,onClick:V=>{V.stopPropagation(),u(M)}}),n.jsxs("h4",{className:"font-bold text-white text-lg ml-2 select-none",children:["Scene ",I.sceneNumber,": ",n.jsx("span",{className:"text-gray-300 font-normal",children:I.title})]})]}),!G&&n.jsxs(n.Fragment,{children:[k("Description",I.description,`scene-${B}`),I.narratorText&&k("Narrator",I.narratorText,`scene-${B}-narrator`)]})]},`scene-container-${B}`)})})]})]})}case"analyzer":{const v=p.data,N=c.has("section-characters"),_=c.has("section-scenes");return n.jsxs("div",{className:"space-y-6 pb-4",children:[w("Analyzed Script",v.model),b(),v.visualStyle&&n.jsxs("div",{className:"bg-gray-800/30 p-3 rounded-lg border border-gray-600/50",children:[n.jsx("h3",{className:"font-bold text-cyan-400 mb-1 text-sm uppercase tracking-wider",children:r("node.content.style")}),n.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:v.visualStyle})]}),v.characters&&v.characters.length>0&&n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center mb-3 border-b border-gray-700 pb-1 cursor-pointer hover:bg-gray-800/50 rounded px-1 -mx-1",onClick:()=>u("section-characters"),children:[n.jsx(ar,{isCollapsed:N,onClick:E=>{E.stopPropagation(),u("section-characters")}}),n.jsx("h3",{className:"font-bold text-cyan-400 text-sm uppercase tracking-wider ml-2 select-none",children:r("node.content.characters")})]}),!N&&n.jsx("div",{className:"space-y-2",children:v.characters.map((E,I)=>x(E,I,!0))})]}),v.scenes&&v.scenes.length>0&&n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center mb-3 border-b border-gray-700 pb-1 cursor-pointer hover:bg-gray-800/50 rounded px-1 -mx-1",onClick:()=>u("section-scenes"),children:[n.jsx(ar,{isCollapsed:_,onClick:E=>{E.stopPropagation(),u("section-scenes")}}),n.jsx("h3",{className:"font-bold text-cyan-400 text-sm uppercase tracking-wider ml-2 select-none",children:"Scenes & Frames"})]}),!_&&n.jsx("div",{className:"space-y-8",children:v.scenes.map((E,I)=>{var G;const B=`scene-${E.sceneNumber}`,M=c.has(B);return n.jsxs("div",{className:"bg-gray-800/20 rounded-xl p-2 border border-gray-700",children:[n.jsxs("div",{className:"bg-gray-900/50 p-2 rounded-lg mb-3 border-l-4 border-cyan-500 flex items-center cursor-pointer hover:bg-gray-900 transition-colors",onClick:()=>u(B),children:[n.jsx(ar,{isCollapsed:M,onClick:V=>{V.stopPropagation(),u(B)}}),n.jsxs("div",{className:"ml-2 w-full",children:[n.jsx("div",{className:"flex justify-between items-center",children:n.jsx("h4",{className:"font-bold text-lg text-white",children:E.title?E.title:`Scene ${E.sceneNumber}`})}),E.sceneContext&&n.jsxs("div",{className:"mt-2 text-xs text-gray-400 italic bg-black/20 p-1.5 rounded border border-gray-700/50",children:[n.jsx("span",{className:"font-bold text-gray-500 uppercase mr-1",children:"Context:"}),E.sceneContext]})]})]}),!M&&n.jsx("div",{className:"pl-2 space-y-2",children:(G=E.frames)==null?void 0:G.map(V=>f(V,E.sceneNumber))})]},`scene-${E.sceneNumber}`)})})]})]})}default:return null}};return n.jsxs("div",{className:"relative flex flex-col h-full overflow-x-hidden",children:[n.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-2 mb-2",children:[n.jsx("div",{className:"w-32",children:n.jsx(An,{id:`lang-select-${e.id}`,value:p.targetLanguage||"en",onChange:m,disabled:l===e.id,options:Object.entries(xn).map(([v,{name:N}])=>({value:v,label:N}))})}),n.jsx("button",{onClick:()=>s(e.id),disabled:l===e.id||p.type==="empty"||p.type==="invalid",className:"px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:l===e.id?r("node.content.translating"):r("node.content.translate")})]}),n.jsx("div",{className:"flex-grow min-h-0 overflow-y-auto pr-2 overflow-x-hidden custom-scrollbar",onWheel:v=>v.stopPropagation(),children:h()}),n.jsxs("div",{className:"flex-shrink-0 flex items-center justify-end space-x-2 mt-2 pt-2 border-t border-gray-700",children:[n.jsx("button",{onClick:()=>o(e.id),className:"flex-1 px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 transition-colors duration-200",children:r("node.content.loadScript")}),n.jsx("button",{onClick:()=>a(e.id),disabled:p.type==="empty"||p.type==="invalid",className:"flex-1 px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",title:r("catalog.saveTo"),children:r("catalog.saveTo")}),n.jsx(we,{title:r("group.saveToDisk"),onClick:()=>i(e.id),disabled:p.type==="empty"||p.type==="invalid",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]})]})},yj=({value:e,onChange:t,min:o=1,max:r=10,label:a})=>{const i=l=>{let c=e+l;o!==void 0&&c<o&&(c=o),r!==void 0&&c>r&&(c=r),t(c)},s=l=>{const c=parseInt(l.target.value,10);isNaN(c)||o!==void 0&&c<o||r!==void 0&&c>r||t(c)};return n.jsxs("div",{children:[a&&n.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:a}),n.jsxs("div",{className:"relative flex items-center bg-gray-700/50 rounded-md border border-gray-700/50 h-8 overflow-hidden group hover:border-gray-500 transition-colors focus-within:border-cyan-500",children:[n.jsx("input",{"aria-label":a,type:"number",value:e,onChange:s,className:"appearance-none w-full h-full bg-transparent text-sm text-white text-center focus:outline-none px-2 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none font-bold",onMouseDown:l=>l.stopPropagation(),onKeyDown:l=>l.stopPropagation()}),n.jsxs("div",{className:"flex flex-col h-full border-l border-gray-700/50 w-5 flex-shrink-0 bg-gray-800/50",children:[n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-accent text-gray-400 hover:text-white transition-colors active:bg-accent-hover",onClick:l=>{l.stopPropagation(),i(1)},children:n.jsx("svg",{width:"8",height:"4",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-accent text-gray-400 hover:text-white transition-colors border-t border-gray-600 active:bg-accent-hover",onClick:l=>{l.stopPropagation(),i(-1)},children:n.jsx("svg",{width:"8",height:"4",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})]})},vj=({fullDescription:e,onDescriptionChange:t,t:o,onFocus:r})=>{const[a,i]=y.useState({});y.useEffect(()=>{const l={Appearance:"",Personality:"",Clothing:""},c={:"Appearance",:"Personality",:"Personality",:"Clothing",apariencia:"Appearance",personalidad:"Personality",ropa:"Clothing",appearance:"Appearance",personality:"Personality",clothing:"Clothing"},d=/####\s*(Appearance|Personality|Clothing|||||Apariencia|Personalidad|Ropa)\s*([\s\S]*?)(?=####|$)/gi;let u,p=!1;for(;(u=d.exec(e))!==null;){p=!0;const m=u[1].trim().toLowerCase(),w=c[m],k=u[2].trim();w&&(l[w]=k)}!p&&e.trim()&&(l.Appearance=e.trim()),i(l)},[e]);const s=(l,c)=>{const d={...a,[l]:c};i(d);const u=`#### Appearance
${d.Appearance||""}

#### Personality
${d.Personality||""}

#### Clothing
${d.Clothing||""}`;t(u)};return n.jsx("div",{className:"space-y-2 text-sm h-full flex flex-col overflow-y-auto custom-scrollbar pr-1 pb-1",children:["Appearance","Personality","Clothing"].map(l=>n.jsxs("div",{className:"flex-shrink-0 flex flex-col mb-4 last:mb-0",children:[n.jsx("h5",{className:"font-semibold text-gray-400 text-xs uppercase tracking-wider flex-shrink-0 mb-2",children:o(`node.content.${l.toLowerCase()}`)||l}),n.jsx("textarea",{value:a[l]||"",onChange:c=>s(l,c.target.value),className:"w-full text-sm p-1.5 bg-gray-900/50 border-none rounded-md resize-none focus:outline-none focus:ring-1 focus:ring-cyan-500 focus:border-cyan-500 custom-scrollbar h-[100px] min-h-[80px] font-sans",onWheel:c=>c.stopPropagation(),onKeyDown:c=>c.stopPropagation(),onFocus:r})]},l))})},md="Full body character concept on a gray background",wj=({node:e,onValueChange:t,onGenerateCharacters:o,isGeneratingCharacters:r,isStopping:a,onStopGeneration:i,t:s,deselectAllNodes:l,connectedInputs:c,clearSelectionsSignal:d,onGenerateCharacterImage:u,isGeneratingCharacterImage:p,onDetachCharacter:m,onSaveGeneratedCharacterToCatalog:w,getUpstreamNodeValues:k,addToast:b,setImageViewer:x,onAddNode:f,setFullSizeImage:h})=>{const{secondaryLanguage:v}=Pt(),N=r,_=c==null?void 0:c.has(void 0),[E,I]=y.useState(!1),[B,M]=y.useState(new Set),[G,V]=y.useState(new Set);y.useEffect(()=>{d>0&&M(new Set)},[d]);const j=y.useMemo(()=>{try{const J=JSON.parse(e.value||"{}");return{prompt:J.prompt||"",numberOfCharacters:J.numberOfCharacters||1,targetLanguage:J.targetLanguage||v,characterType:J.characterType||"simple",style:J.style||"simple",customStyle:J.customStyle||"",characters:Array.isArray(J.characters)?J.characters:[],additionalPrompt:J.additionalPrompt!==void 0?J.additionalPrompt:md,error:J.error||null}}catch{return{prompt:"",numberOfCharacters:1,targetLanguage:v,characterType:"simple",style:"simple",customStyle:"",characters:[],additionalPrompt:md,error:null}}},[e.value,v]),{prompt:P,numberOfCharacters:S,targetLanguage:A,characterType:O,style:z,customStyle:L,characters:W,additionalPrompt:D,error:T}=j,F=y.useCallback(J=>{const H={...j,...J};t(e.id,JSON.stringify(H))},[e.id,t,j]),te=(J,H)=>{J.target.closest('textarea, input, button, [role="listbox"]')||(document.activeElement&&(document.activeElement instanceof HTMLTextAreaElement||document.activeElement instanceof HTMLInputElement)&&document.activeElement.blur(),M(ee=>{const ae=new Set(J.shiftKey?ee:[]);return ae.has(H)?ae.delete(H):ae.add(H),ae}))},$=J=>{V(H=>{const U=new Set(H);return U.has(J)?U.delete(J):U.add(J),U})},Y=(J,H,U)=>{const ee=W.map(ae=>ae.id===J?{...ae,[H]:U}:ae);F({characters:ee})},oe=J=>{const H={};J.imageBase64&&(H["1:1"]=`data:image/png;base64,${J.imageBase64}`);let U=J.index||J.alias||"Entity-1";U=U.replace(/^Character-/,"Entity-");const ee={type:"character-card",name:J.name,index:U,image:J.imageBase64?`data:image/png;base64,${J.imageBase64}`:null,selectedRatio:"1:1",prompt:J.prompt,fullDescription:J.fullDescription,imageSources:H,additionalPrompt:J.additionalPrompt||D},ae=JSON.stringify(ee,null,2);navigator.clipboard.writeText(ae),b==null||b("Character data copied to clipboard","success")},le=J=>{F({characters:W.filter(H=>H.id!==J)})},K=J=>{navigator.clipboard.writeText(J)},ie=J=>{const H={};J.imageBase64&&(H["1:1"]=`data:image/png;base64,${J.imageBase64}`);let U=J.index||J.alias||"Entity-1";U=U.replace(/^Character-/,"Entity-");const ee={type:"character-card",name:J.name,index:U,image:J.imageBase64?`data:image/png;base64,${J.imageBase64}`:null,selectedRatio:"1:1",prompt:J.prompt,fullDescription:J.fullDescription,imageSources:H,additionalPrompt:J.additionalPrompt||D},ae=JSON.stringify(ee,null,2),xe=new Blob([ae],{type:"application/json"}),ne=URL.createObjectURL(xe),X=document.createElement("a");X.href=ne,X.download=`${(J.name||"entity").replace(/ /g,"_")}.json`,document.body.appendChild(X),X.click(),document.body.removeChild(X),URL.revokeObjectURL(ne)},Z=J=>{if(w){const H={...J,alias:(J.index||J.alias||"Entity-1").replace(/^Character-/,"Entity-"),additionalPrompt:D};w(H)}},se=J=>{if(m){const H={...J,index:(J.index||J.alias||"Entity-1").replace(/^Character-/,"Entity-"),additionalPrompt:D};m(H,e)}else console.warn("onDetachCharacter not available"),b==null||b("Detach function unavailable","error")},de=()=>{if(!_||!k)return;const H=k(e.id).find(U=>typeof U=="string")||"";H?(F({prompt:H}),b==null||b("Prompt synced from connection","success")):b==null||b("No text found in connection","info")};y.useEffect(()=>{const J=W.map((U,ee)=>{let ae=U.index||U.alias;ae?ae.startsWith("Character-")&&(ae=ae.replace("Character-","Entity-")):ae=`Entity-${ee+1}`;let xe=U.additionalPrompt;return xe===void 0&&(xe=D||md),ae!==U.index||xe!==U.additionalPrompt?{...U,index:ae,additionalPrompt:xe}:U});JSON.stringify(J)!==JSON.stringify(W)&&F({characters:J})},[W.length]);const re=async()=>{if(!(!P||E)){I(!0);try{const J=await Yp(P,"en");F({prompt:J})}catch(J){console.error("Translation failed",J)}finally{I(!1)}}},R=(J,H,U)=>{J.stopPropagation(),x&&x({sources:[{src:H,frameNumber:0,prompt:U||"Character Concept"}],initialIndex:0})};return n.jsxs("div",{className:"flex flex-col h-full",onWheel:J=>J.stopPropagation(),children:[n.jsxs("div",{className:"flex-shrink-0 space-y-2 mb-2",children:[n.jsxs("div",{className:"relative",children:[n.jsx("textarea",{"aria-label":s("node.content.characterPromptPlaceholder"),value:P,onChange:J=>F({prompt:J.target.value}),placeholder:s(_?"node.content.connectedPlaceholder":"node.content.characterPromptPlaceholder"),disabled:_||N,className:"w-full p-1.5 bg-gray-900/50 border border-gray-700/50 rounded-md resize-y min-h-[80px] max-h-[300px] focus:ring-1 focus:ring-cyan-500 focus:border-cyan-500 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 custom-scrollbar overflow-y-scroll pb-8 text-sm font-sans",rows:2,onWheel:J=>J.stopPropagation(),onMouseDown:J=>J.stopPropagation(),onKeyDown:J=>J.stopPropagation(),onFocus:l}),n.jsxs("div",{className:"absolute bottom-2 right-2 flex space-x-1",children:[_&&n.jsx("button",{onClick:de,className:"p-1 bg-gray-600 hover:bg-accent text-gray-300 hover:text-white rounded transition-colors",title:"Sync from connection",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),!_&&n.jsx("button",{onClick:re,disabled:!P||E,className:"p-1 bg-gray-600 hover:bg-accent text-gray-300 hover:text-white rounded transition-colors disabled:opacity-50",title:s(E?"node.content.translating":"node.content.translate"),children:E?n.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"})})})]})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:s("node.content.characterTypeShort")}),n.jsx("div",{className:"py-1",children:n.jsx(An,{value:O,onChange:J=>F({characterType:J}),disabled:N,options:[{value:"simple",label:s("node.content.characterType.simple")},{value:"anthro",label:s("node.content.characterType.anthro")},{value:"chibi",label:s("node.content.characterType.chibi")},{value:"key_item",label:s("node.content.characterType.key_item")}]})})]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:s("node.content.style")}),n.jsx("div",{className:"py-1",children:n.jsx(An,{value:z,onChange:J=>F({style:J}),disabled:N,options:[{value:"simple",label:s("node.content.style.simple")},{value:"realistic",label:s("node.content.style.realistic")},{value:"3d_cartoon",label:s("node.content.style.3d_cartoon")},{value:"3d_realistic",label:s("node.content.style.3d_realistic")},{value:"2d_animation",label:s("node.content.style.2d_animation")},{value:"anime",label:s("node.content.style.anime")},{value:"comics",label:s("node.content.style.comics")},{value:"custom",label:s("node.content.style.custom")}]})})]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:s("node.content.numberOfCharactersShort")}),n.jsx("div",{className:"py-1",children:n.jsx(yj,{value:S,onChange:J=>F({numberOfCharacters:J}),min:1,max:10})})]})]}),z==="custom"&&n.jsxs("div",{className:"flex items-center space-x-2 bg-gray-700 rounded-md p-1",children:[n.jsx("label",{htmlFor:`custom-style-input-${e.id}`,className:"text-xs font-bold text-gray-400 uppercase pl-1 flex-shrink-0",children:s("node.content.style.custom")}),n.jsx("textarea",{id:`custom-style-input-${e.id}`,value:L,onChange:J=>F({customStyle:J.target.value}),onMouseDown:J=>J.stopPropagation(),onKeyDown:J=>J.stopPropagation(),onFocus:l,rows:2,className:"w-full p-1 bg-gray-800 text-white rounded-md text-xs focus:ring-2 focus:ring-accent focus:outline-none custom-scrollbar",placeholder:"..."})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"flex items-center bg-gray-700 rounded-md p-1 space-x-1 h-10",children:[n.jsx("button",{onClick:()=>F({targetLanguage:v}),className:`px-2 py-1 rounded text-xs font-bold w-10 h-full transition-colors ${A===v?"bg-accent text-white":"text-gray-300 hover:bg-gray-600"}`,title:xn[v].name,children:xn[v].short}),n.jsx("button",{onClick:()=>F({targetLanguage:"en"}),className:`px-2 py-1 rounded text-xs font-bold w-10 h-full transition-colors ${A==="en"?"bg-accent text-white":"text-gray-300 hover:bg-gray-600"}`,children:"EN"})]}),n.jsx("button",{onClick:()=>o(e.id),disabled:N||a||!_&&!P.trim(),className:`flex-grow h-10 px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 flex items-center justify-center space-x-2 ${N?"bg-gray-600 cursor-not-allowed opacity-75":"bg-accent hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed"}`,children:N?n.jsxs(n.Fragment,{children:[n.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n.jsx("span",{children:s("node.content.generating")})]}):s("node.content.generateCharacters")})]})]}),n.jsxs("div",{className:"flex-grow overflow-y-auto overflow-x-hidden space-y-2 pr-2 custom-scrollbar scrollbar-gutter-stable",children:[T&&n.jsx("div",{className:"text-red-400 text-xs p-2 bg-red-900/20 rounded border border-red-800",children:T}),W.length===0?n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-500 opacity-50 select-none",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),n.jsx("p",{className:"text-sm font-medium",children:"Character cards will appear here"})]}):W.map(J=>n.jsxs("div",{className:`bg-gray-700/50 rounded-md border-2 transition-colors ${B.has(J.id)?"border-accent":"border-gray-700"}`,onClick:H=>te(H,J.id),children:[n.jsxs("div",{className:"flex justify-between items-center p-2 cursor-pointer bg-gray-700/50 select-none",onClick:H=>{H.target===H.currentTarget&&$(J.id)},children:[n.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden",onClick:H=>$(J.id),children:[n.jsx(we,{title:G.has(J.id)?s("node.action.expand"):s("node.action.collapse"),onClick:H=>{H.stopPropagation(),$(J.id)},children:G.has(J.id)?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),n.jsx("input",{type:"text",value:J.name,onChange:H=>Y(J.id,"name",H.target.value),className:"bg-gray-900/50 rounded px-2 h-8 font-bold text-sm text-white focus:outline-none truncate border border-gray-700/50 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 transition-colors",onClick:H=>H.stopPropagation(),onMouseDown:H=>H.stopPropagation(),onKeyDown:H=>H.stopPropagation(),onFocus:l})]}),n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsxs("div",{className:"flex h-8 items-center border border-gray-700/50 rounded bg-gray-900/50 focus-within:border-cyan-500 focus-within:ring-1 focus-within:ring-cyan-500 transition-all overflow-hidden",children:[n.jsx("div",{className:"px-2 flex items-center h-full border-r border-gray-700/50",children:n.jsx("span",{className:"text-xs text-gray-400 font-bold uppercase",children:s("node.content.characterIndex")})}),n.jsxs("div",{className:"flex items-center h-full pl-2",children:[n.jsx("span",{className:"text-xs text-accent-text font-bold font-mono",children:"Entity-"}),n.jsx("input",{type:"number",value:parseInt((J.index||J.alias||"Entity-1").replace("Entity-","")||"1"),onChange:H=>Y(J.id,"index",`Entity-${H.target.value}`),className:"text-xs bg-transparent border-none w-8 focus:ring-0 focus:outline-none text-center font-mono text-white font-bold p-0 appearance-none [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",onMouseDown:H=>H.stopPropagation(),onKeyDown:H=>H.stopPropagation(),onFocus:l}),n.jsxs("div",{className:"flex flex-col h-full border-l border-gray-700/50 w-4 flex-shrink-0 bg-gray-800/50 hover:bg-gray-700/50 transition-colors",children:[n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-cyan-500/20 text-gray-400 hover:text-cyan-400 transition-colors focus:outline-none",tabIndex:-1,onClick:H=>{H.stopPropagation();const U=parseInt((J.index||J.alias||"Entity-1").replace("Entity-","")||"1");Y(J.id,"index",`Entity-${U+1}`)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",children:n.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-cyan-500/20 text-gray-400 hover:text-cyan-400 transition-colors border-t border-gray-700/50 focus:outline-none",tabIndex:-1,onClick:H=>{H.stopPropagation();const U=parseInt((J.index||J.alias||"Entity-1").replace("Entity-","")||"1");Y(J.id,"index",`Entity-${Math.max(1,U-1)}`)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",children:n.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})]}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(we,{title:s("catalog.saveTo"),tooltipPosition:"left",onClick:H=>{H.stopPropagation(),Z(J)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})}),n.jsx(we,{title:s("node.action.saveCharacter"),tooltipPosition:"left",onClick:H=>{H.stopPropagation(),ie(J)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(we,{title:"Detach and Copy",tooltipPosition:"left",onClick:H=>{H.stopPropagation(),se(J)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})}),n.jsx(we,{title:"Copy Data",tooltipPosition:"left",onClick:H=>{H.stopPropagation(),oe(J)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"})})}),n.jsx(we,{title:s("node.action.deleteItem"),tooltipPosition:"left",onClick:H=>{H.stopPropagation(),le(J.id)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})]}),!G.has(J.id)&&n.jsxs("div",{className:"p-4 space-y-4 border-t border-gray-700 flex flex-col",children:[n.jsxs("div",{className:"flex space-x-4",children:[n.jsx("div",{className:"w-[150px] flex-shrink-0 flex flex-col space-y-2",children:n.jsx("div",{className:"aspect-square bg-black/40 rounded-md border border-gray-700 flex items-center justify-center overflow-hidden relative group w-full",children:J.imageBase64?n.jsxs(n.Fragment,{children:[n.jsx("img",{src:`data:image/png;base64,${J.imageBase64}`,alt:J.name,className:"w-full h-full object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:H=>R(H,`data:image/png;base64,${J.imageBase64}`,J.name)}),p===`${e.id}-${J.id}`&&n.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center z-10 pointer-events-none",children:n.jsxs("svg",{className:"animate-spin h-8 w-8 text-accent",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx(we,{title:s("node.action.copy"),onClick:H=>{if(H.stopPropagation(),J.imageBase64){const U=new Blob([Uint8Array.from(atob(J.imageBase64),ee=>ee.charCodeAt(0))],{type:"image/png"});navigator.clipboard.write([new ClipboardItem({"image/png":U})])}},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),n.jsx(we,{title:s("node.action.regenerate"),onClick:H=>{H.stopPropagation(),p!==`${e.id}-${J.id}`&&u&&u(e.id,J.id)},disabled:p===`${e.id}-${J.id}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),n.jsx(we,{title:s("node.action.clear"),onClick:H=>{H.stopPropagation(),Y(J.id,"imageBase64",null)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}):n.jsx("div",{className:"text-gray-500 text-xs text-center px-2",children:p===`${e.id}-${J.id}`?n.jsxs("svg",{className:"animate-spin h-6 w-6 text-white mx-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("button",{onClick:H=>{H.stopPropagation(),u&&u(e.id,J.id)},className:"text-accent-text hover:text-accent-hover underline font-semibold",children:"Generate Image"})})})}),n.jsxs("div",{className:"w-2/3 flex flex-col space-y-2 h-full min-w-0",children:[n.jsxs("div",{className:"flex-grow flex flex-col",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("label",{className:"text-xs text-gray-400 font-bold uppercase tracking-wider",children:s("node.content.imagePrompt")}),n.jsx(we,{title:s("node.action.copy"),onClick:H=>{H.stopPropagation(),K(J.prompt||"")},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),n.jsx("textarea",{"aria-label":s("node.content.imagePrompt"),value:J.prompt||"",onChange:H=>Y(J.id,"prompt",H.target.value),className:"w-full flex-grow text-sm p-1.5 bg-black/30 rounded resize-none border border-gray-700 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 focus:outline-none custom-scrollbar transition-all leading-relaxed font-sans",onWheel:H=>H.stopPropagation(),onMouseDown:H=>H.stopPropagation(),onKeyDown:H=>H.stopPropagation(),onFocus:l})]}),n.jsxs("div",{className:"flex flex-col flex-shrink-0 mt-4",children:[n.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase flex-shrink-0 mb-2",children:s("node.content.suffix")}),n.jsx("input",{type:"text","aria-label":s("node.content.suffix"),value:J.additionalPrompt!==void 0?J.additionalPrompt:D,onChange:H=>Y(J.id,"additionalPrompt",H.target.value),className:"w-full text-sm bg-black/40 border border-gray-700 rounded px-1.5 py-1.5 text-gray-300 focus:outline-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 placeholder-gray-600 transition-all font-sans",placeholder:"Suffix...",onMouseDown:H=>H.stopPropagation(),onFocus:l})]})]})]}),n.jsx("div",{className:"flex-grow flex flex-col min-h-[300px] mt-2 pt-2",children:n.jsxs("div",{className:"flex-grow flex flex-col border border-gray-600 rounded-md p-2 relative mt-4",children:[n.jsx("div",{className:"absolute -top-3 left-2 bg-gray-800 px-2 text-xs font-bold text-cyan-500 uppercase tracking-wider",children:s("node.content.fullDescriptionTitle")}),n.jsx(vj,{fullDescription:J.fullDescription||"",onDescriptionChange:H=>Y(J.id,"fullDescription",H),t:s,onFocus:l})]})})]})]},J.id))]})]})},bj=({value:e,onChange:t,placeholder:o,className:r,onFocus:a,readOnly:i,onCopy:s})=>{const l=c=>{const d=parseInt(e.replace(/[^0-9]/g,""),10)||0;let u=e.replace(/[0-9]/g,"");(u==="Character-"||!u||u.trim()==="")&&(u="Entity-"),t(`${u}${Math.max(1,d+c)}`)};return n.jsxs("div",{className:`flex items-center bg-gray-700 rounded-md border border-gray-600 h-[32px] overflow-hidden group hover:border-gray-500 transition-colors ${r} relative`,children:[n.jsx("input",{type:"text",value:e,onChange:c=>!i&&t(c.target.value),placeholder:o,onFocus:a,readOnly:i,className:`w-full h-full bg-transparent text-sm text-white px-2 focus:outline-none border-none min-w-0 ${i?"cursor-default select-none":""}`,onMouseDown:c=>c.stopPropagation()}),s&&n.jsx("button",{className:"absolute right-6 top-1/2 -translate-y-1/2 h-5 w-5 flex items-center justify-center bg-gray-800 border border-gray-600 rounded text-gray-300 opacity-0 group-hover:opacity-100 transition-opacity z-10 hover:bg-gray-700 hover:text-white",onClick:c=>{c.stopPropagation(),s()},title:"Copy Index",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),n.jsxs("div",{className:"flex flex-col h-full border-l border-gray-600 w-5 flex-shrink-0 bg-gray-800 z-20",children:[n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-cyan-600 text-gray-400 hover:text-white transition-colors active:bg-cyan-700",onClick:c=>{c.stopPropagation(),l(1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-cyan-600 text-gray-400 hover:text-white transition-colors border-t border-gray-600 active:bg-cyan-700",onClick:c=>{c.stopPropagation(),l(-1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})},Cj=({fullDescription:e,onDescriptionChange:t,t:o,onFocus:r,isUpdatingPersonality:a,onUpdatePersonality:i,isUpdatingAppearance:s,onUpdateAppearance:l,isUpdatingClothing:c,onUpdateClothing:d})=>{const[u,p]=y.useState({});y.useEffect(()=>{const x={Appearance:"",Personality:"",Clothing:""},f={:"Appearance",:"Personality",:"Personality",:"Clothing",apariencia:"Appearance",personalidad:"Personality",ropa:"Clothing",appearance:"Appearance",personality:"Personality",clothing:"Clothing"},h=/####\s*(Appearance|Personality|Clothing|||||Apariencia|Personalidad|Ropa)\s*([\s\S]*?)(?=####|$)/gi;let v,N=!1;for(;(v=h.exec(e))!==null;){N=!0;const _=v[1].trim().toLowerCase(),E=f[_];let I=v[2];h.lastIndex<e.length&&I.endsWith(`

`)&&(I=I.slice(0,-2)),E&&(x[E]=I)}!N&&e.trim()&&(x.Appearance=e),p(x)},[e]);const m=(x,f)=>{const h={...u,[x]:f};p(h);const v=`#### Appearance
${h.Appearance||""}

#### Personality
${h.Personality||""}

#### Clothing
${h.Clothing||""}`;t(v)},w={Appearance:{icon:n.jsx(fP,{className:"h-3.5 w-3.5"}),color:"text-gray-400"},Personality:{icon:n.jsx(xP,{className:"h-3.5 w-3.5"}),color:"text-gray-400"},Clothing:{icon:n.jsx(yP,{className:"h-3.5 w-3.5"}),color:"text-gray-400"}},k=x=>x==="Appearance"?o("node.content.appearancePlaceholder"):x==="Personality"?o("node.content.personalityPlaceholder"):x==="Clothing"?o("node.content.clothingPlaceholder"):"",b=x=>x==="Personality"&&i?{title:o("node.action.updatePersonality"),onClick:i,isLoading:a}:x==="Appearance"&&l?{title:o("node.action.updateAppearance"),onClick:l,isLoading:s}:x==="Clothing"&&d?{title:o("node.action.updateClothing"),onClick:d,isLoading:c}:null;return n.jsx("div",{className:"space-y-4 p-4 pb-2 text-sm flex flex-col pr-1 overflow-x-hidden",children:["Appearance","Personality","Clothing"].map(x=>{const f=w[x],h=b(x);return n.jsxs("div",{className:"flex-shrink-0 flex flex-col items-start w-full",children:[n.jsxs("div",{className:"flex flex-row items-center justify-between mb-1.5 w-full",children:[n.jsxs("div",{className:"flex flex-row items-center gap-1.5",children:[n.jsx("span",{className:f.color,children:f.icon}),n.jsx("h5",{className:`font-bold ${f.color} text-[11px] uppercase tracking-wider flex-shrink-0`,children:o(`node.content.${x.toLowerCase()}`)||x}),h&&n.jsx(we,{title:h.title||"Update",onClick:v=>{v.stopPropagation(),h.onClick()},disabled:h.isLoading,className:"p-1 ml-1 text-gray-500 hover:text-accent-text transition-colors disabled:opacity-50",tooltipPosition:"right",children:h.isLoading?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-accent-text",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),n.jsx(we,{title:o("node.action.copy"),onClick:v=>{v.stopPropagation(),navigator.clipboard.writeText(u[x]||"")},className:"p-1 text-gray-500 hover:text-accent-text transition-colors",tooltipPosition:"left",children:n.jsx(zt,{className:"h-3 w-3"})})]}),n.jsx("textarea",{value:u[x]||"",onChange:v=>m(x,v.target.value),className:"w-full text-sm p-2 bg-gray-900/60 border border-gray-700 rounded-md resize-y focus:outline-none focus:ring-1 focus:ring-accent custom-scrollbar min-h-[60px] transition-colors text-gray-200 text-left",onWheel:v=>v.stopPropagation(),onKeyDown:v=>v.stopPropagation(),onFocus:r,placeholder:k(x)})]},x)})})},Ns=()=>n.jsxs("svg",{className:"animate-spin h-3.5 w-3.5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),kj=({char:e,cardIdx:t,nodeId:o,isDragOver:r,setIsDragOver:a,onRatioChange:i,onPasteImage:s,onClearImage:l,onCopyImage:c,onDownloadImage:d,onGenerateImage:u,onEditRaster:p,onEditAI:m,onCrop1x1:w,onExpandRatio:k,onSetEditingIndex:b,getFullSizeImage:x,setImageViewer:f,onCopyImageToClipboard:h,processNewImage:v,transformingRatio:N,isGeneratingImage:_,t:E})=>{const I=!!(e.thumbnails[e.selectedRatio]||e.image),B=M=>M?"bg-gray-600 text-white cursor-wait":"bg-accent hover:bg-accent-hover text-white disabled:opacity-50 disabled:bg-gray-700 disabled:text-gray-500";return n.jsxs("div",{className:"flex flex-col flex-shrink-0",children:[n.jsx("div",{onClick:b,onDragEnter:M=>{M.dataTransfer.types.includes("application/prompt-modifier-card")||(M.preventDefault(),M.stopPropagation(),a(!0))},onDragOver:M=>{M.dataTransfer.types.includes("application/prompt-modifier-card")||(M.preventDefault(),M.stopPropagation(),a(!0))},className:`flex-shrink-0 h-[256px] bg-gray-700/50 rounded-xl flex items-center justify-center cursor-pointer transition-all group relative overflow-hidden z-10 hover:z-20 hover:bg-gray-800/60 ${r?"border-2 border-accent ring-2 ring-accent/20":""}`,onDragLeave:()=>a(!1),onDrop:M=>{var j;if(M.dataTransfer.types.includes("application/prompt-modifier-card"))return;M.preventDefault(),M.stopPropagation(),a(!1);const G=M.dataTransfer.getData("application/prompt-modifier-drag-image");if(G){v(G);return}const V=(j=M.dataTransfer.files)==null?void 0:j[0];if(V!=null&&V.type.startsWith("image/")){const P=new FileReader;P.onload=S=>{var A;return v((A=S.target)==null?void 0:A.result)},P.readAsDataURL(V)}},children:e.thumbnails[e.selectedRatio]||e.image?n.jsxs(n.Fragment,{children:[n.jsx("img",{src:e.thumbnails[e.selectedRatio]||e.image,className:"object-contain w-full h-full transition-opacity group-hover:opacity-80",style:{imageRendering:"auto"},draggable:!0,onDragStart:M=>{const G=x(t*10+(Ut[e.selectedRatio]||1))||e.image;G&&(M.dataTransfer.setData("application/prompt-modifier-drag-image",G),M.stopPropagation())},onClick:M=>{M.stopPropagation(),f({sources:[{src:x(t*10+(Ut[e.selectedRatio]||1))||e.image,frameNumber:0}],initialIndex:0})}}),n.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-20",children:[n.jsx(we,{title:E("node.action.download"),onClick:M=>{M.stopPropagation(),d()},className:"bg-black/60 p-1.5 rounded text-accent-text hover:text-white",tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(we,{title:E("node.action.copy"),onClick:M=>{M.stopPropagation(),c()},className:"bg-black/60 p-1.5 rounded text-accent-text hover:text-white",tooltipPosition:"left",children:n.jsx(zt,{className:"h-4 w-4"})}),n.jsx(we,{title:E("node.action.paste"),onClick:M=>{M.stopPropagation(),s()},className:"bg-black/60 p-1.5 rounded text-accent-text hover:text-white",tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),n.jsx(we,{title:E("node.action.clear"),onClick:M=>{M.stopPropagation(),l()},className:"bg-black/60 p-1.5 rounded text-red-400 hover:text-white",tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{d:"M6 18L18 6M6 6l12 12",strokeWidth:2,strokeLinecap:"round"})})})]})]}):n.jsxs("div",{className:"flex flex-col items-center justify-center w-full h-full gap-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),n.jsx("div",{className:"flex flex-col items-center justify-center text-[10px] text-gray-500 uppercase font-bold text-center px-4 leading-normal gap-1 max-w-[200px]",children:n.jsx("span",{className:"text-balance",children:E("node.content.dropImage")})}),n.jsxs("button",{onClick:M=>{M.stopPropagation(),s()},className:"mt-2 px-3 py-1 bg-gray-700 hover:bg-gray-600 text-gray-300 hover:text-white text-xs font-bold rounded border border-gray-600 transition-colors flex items-center gap-1.5",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),E("node.action.paste")]})]})}),n.jsx("div",{className:"h-4"}),n.jsxs("div",{className:"flex gap-1 flex-shrink-0 mb-2 items-center px-1",children:[n.jsx("button",{onClick:M=>{M.stopPropagation(),u()},disabled:_||!e.prompt,className:`flex-grow h-8 font-bold rounded text-[10px] uppercase transition-colors shadow-sm flex items-center justify-center gap-2 ${B(_)}`,children:_?n.jsxs(n.Fragment,{children:[n.jsx(Ns,{}),n.jsx("span",{children:E("node.content.generating")})]}):E("node.content.generateImage")}),n.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.selectedRatio==="1:1"&&n.jsx(mt,{content:"Crop to 1:1",children:n.jsx("button",{onClick:M=>{M.stopPropagation(),w()},disabled:!!N||!I,className:`w-12 h-8 rounded text-[10px] font-bold transition-colors flex items-center justify-center ${B(N==="1:1")}`,children:N==="1:1"?n.jsx(Ns,{}):"1:1"})}),e.selectedRatio==="16:9"&&n.jsx(mt,{content:E("node.action.expand169"),children:n.jsx("button",{onClick:M=>{M.stopPropagation(),k("16:9")},disabled:!!N||!I,className:`w-12 h-8 rounded text-[10px] font-bold transition-colors flex items-center justify-center ${B(N==="16:9")}`,children:N==="16:9"?n.jsx(Ns,{}):"16:9"})}),e.selectedRatio==="9:16"&&n.jsx(mt,{content:E("node.action.expand916"),children:n.jsx("button",{onClick:M=>{M.stopPropagation(),k("9:16")},disabled:!!N||!I,className:`w-12 h-8 rounded text-[10px] font-bold transition-colors flex items-center justify-center ${B(N==="9:16")}`,children:N==="9:16"?n.jsx(Ns,{}):"9:16"})})]}),n.jsxs("div",{className:"flex gap-1 shrink-0",children:[n.jsx(mt,{content:E("node.action.rasterEditor"),children:n.jsx("button",{onClick:M=>{M.stopPropagation(),p()},disabled:!(e.thumbnails[e.selectedRatio]||e.image),className:"w-9 h-8 bg-accent-secondary hover:bg-accent-secondary-hover text-white rounded flex items-center justify-center disabled:opacity-50 transition-colors disabled:bg-gray-700 disabled:text-gray-500",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})})}),n.jsx(mt,{content:E("node.action.openInAIEditor"),children:n.jsx("button",{onClick:M=>{M.stopPropagation(),m()},disabled:!e.image,className:"w-9 h-8 bg-accent-secondary hover:bg-accent-secondary-hover text-white rounded flex items-center justify-center disabled:opacity-50 transition-colors disabled:bg-gray-700 disabled:text-gray-500",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})})})]})]})]})},_j=380,b0="Full body character concept on a gray background",C0="Full-length conceptual object on a grey background",Sj=({isCollapsed:e})=>n.jsx("div",{className:`p-0.5 text-gray-400 transition-transform duration-200 flex items-center justify-center ${e?"rotate-0":"rotate-180"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),Nj=({char:e,index:t,nodeId:o,isDragging:r,onUpdate:a,onRemove:i,onSetAsOutput:s,onToggleActive:l,onDragStart:c,onDragEnd:d,onSmartDragOver:u,onRatioChange:p,onPasteImage:m,onClearImage:w,onCopyImage:k,onGenerateImage:b,onEditRaster:x,onEditAI:f,onCrop1x1:h,onExpandRatio:v,onSetEditingIndex:N,onSyncFromConnection:_,onLoad:E,onSave:I,onSaveToCatalog:B,onCopySpecific:M,onPasteSpecific:G,onDetach:V,onModify:j,getFullSizeImage:P,setImageViewer:S,onCopyImageToClipboard:A,onDownloadImageFromUrl:O,processNewImage:z,t:L,deselectAllNodes:W,languages:D,secondaryLanguage:T,isModifyingCharacter:F,isUpdatingDescription:te,onUpdateDescription:$,isUpdatingPersonality:Y,onUpdatePersonality:oe,isUpdatingAppearance:le,onUpdateAppearance:K,isUpdatingClothing:ie,onUpdateClothing:Z,transformingRatio:se,isGeneratingImage:de,isUpdatingCharacterPrompt:re,modificationRequest:R,setModificationRequest:J,hasDuplicateIndex:H,onCopyIndex:U})=>{const[ee,ae]=y.useState(!1),xe=`${o}-${t}`,ne=e.isActive?"":"opacity-50 grayscale pointer-events-none",X=e.isImageCollapsed??!1,ue=e.isPromptCollapsed??!1;return n.jsxs("div",{className:"flex flex-col h-full border border-gray-800 rounded-xl bg-gray-900/80 p-2.5 overflow-hidden shadow-xl hover:border-gray-700 transition-all flex-shrink-0",style:{width:`${_j}px`,contain:"content",opacity:r?.4:1,transform:r?"scale(0.95)":"none"},onDragOver:u,children:[n.jsxs("div",{className:"h-8 bg-gray-700 rounded-t-lg border-b border-gray-600 flex items-center px-3 cursor-grab active:cursor-grabbing hover:bg-gray-800 transition-colors mb-2 group/handle relative flex-shrink-0 gap-2",draggable:!0,onDragStart:c,onDragEnd:d,children:[n.jsx("div",{className:"flex items-center gap-1 overflow-hidden flex-grow",children:n.jsxs("span",{className:"text-xs font-bold truncate",children:[n.jsxs("span",{className:H?"text-red-500 font-black":"text-accent-text",children:[e.index||"CH",":"]})," ",n.jsx("span",{className:"text-gray-200 ml-1",children:e.name||"Unnamed"}),n.jsxs("span",{className:"text-[9px] text-gray-500 font-mono ml-2 opacity-50",children:["#",e.id]})]})}),n.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[n.jsx(mt,{content:e.isActive?"Mute Card (Exclude from Output)":"Unmute Card",children:n.jsx("button",{onClick:Q=>{Q.stopPropagation(),l()},className:`p-0.5 rounded hover:bg-gray-600 transition-colors ${e.isActive?"text-gray-400 hover:text-white":"text-gray-500"}`,onMouseDown:Q=>Q.stopPropagation(),children:e.isActive?n.jsx(Il,{className:"h-4 w-4"}):n.jsx(Tl,{className:"h-4 w-4"})})}),n.jsx(mt,{content:L("node.action.markPrimary"),children:n.jsx("button",{onClick:Q=>{Q.stopPropagation(),s()},className:`p-0.5 rounded hover:bg-gray-700 transition-colors ${e.isOutput?"text-accent-text":"text-gray-500 hover:text-gray-300"}`,onMouseDown:Q=>Q.stopPropagation(),children:e.isOutput?n.jsx(bP,{className:"h-4 w-4"}):n.jsx(wP,{className:"h-4 w-4"})})}),n.jsx(mt,{content:L("node.action.removeCard"),children:n.jsx("button",{onClick:Q=>{Q.stopPropagation(),i()},className:"p-0.5 rounded hover:bg-red-900/50 text-gray-500 hover:text-red-400 transition-colors",onMouseDown:Q=>Q.stopPropagation(),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{d:"M6 18L18 6M6 6l12 12",strokeWidth:2.5,strokeLinecap:"round"})})})})]})]}),n.jsxs("div",{className:`flex flex-col flex-grow min-h-0 ${ne}`,children:[n.jsxs("div",{className:"flex gap-2 flex-shrink-0 items-center mb-2 h-[32px]",children:[n.jsx("input",{type:"text",value:e.name,onChange:Q=>a({name:Q.target.value}),placeholder:L("node.content.character"),className:"flex-grow min-w-0 px-2 bg-gray-700 border border-gray-600 rounded-md text-sm text-white focus:ring-1 focus:ring-accent outline-none h-[32px] transition-colors hover:border-gray-500",onMouseDown:Q=>Q.stopPropagation(),onFocus:W}),n.jsx(bj,{value:e.index,onChange:Q=>a({index:Q}),placeholder:"Index",onFocus:W,readOnly:!0,className:`w-28 shrink-0 ${H?"border-red-500 hover:border-red-500":""}`,onCopy:U})]}),n.jsxs("div",{className:"flex flex-col flex-shrink-0 mb-1",children:[n.jsxs("div",{className:"flex items-end justify-between h-7 relative z-30 mb-0 cursor-pointer hover:bg-gray-800/60 transition-colors rounded-t-md",onClick:Q=>{Q.stopPropagation(),a({isImageCollapsed:!X})},children:[n.jsx("div",{className:"flex items-end pl-2 gap-1 h-full",onClick:Q=>Q.stopPropagation(),children:["1:1","16:9","9:16"].map(Q=>n.jsx("button",{onClick:ce=>{ce.stopPropagation(),p(Q)},onDragEnter:ce=>{ce.stopPropagation(),p(Q)},className:`px-3 py-1 text-[10px] font-bold outline-none transition-colors rounded-t-md ${e.selectedRatio===Q?"bg-gray-700/50 text-white h-full shadow-none":"bg-gray-900/40 text-gray-500 h-[80%] hover:bg-gray-700/50 hover:text-gray-300"}`,children:Q},Q))}),n.jsx("div",{className:"pb-1 pr-1",children:n.jsx(Sj,{isCollapsed:X})})]}),!X&&n.jsx(kj,{char:e,cardIdx:t,nodeId:o,isDragOver:ee,setIsDragOver:ae,onRatioChange:p,onPasteImage:m,onClearImage:w,onCopyImage:k,onDownloadImage:()=>{const Q=P(t*10+(Ut[e.selectedRatio]||1))||e.image;if(Q&&O){const ce=`${e.name.replace(/\s+/g,"_")}_${e.selectedRatio.replace(":","x")}_${t}.png`;O(Q,0,e.prompt||e.name,ce)}},onGenerateImage:b,onEditRaster:x,onEditAI:f,onCrop1x1:h,onExpandRatio:v,onSetEditingIndex:N,getFullSizeImage:P,setImageViewer:S,onCopyImageToClipboard:A,processNewImage:z,transformingRatio:se,isGeneratingImage:de,t:L})]}),n.jsxs("div",{className:"flex flex-col shrink-0 mb-2 border border-gray-700/50 rounded-xl bg-gray-900/20 shadow-inner overflow-hidden",children:[n.jsxs("div",{className:"px-4 py-2 bg-gray-800 border-b border-gray-700 flex items-center justify-between cursor-pointer hover:bg-gray-750 transition-colors select-none",onClick:Q=>{Q.stopPropagation(),a({isPromptCollapsed:!ue})},children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:`transform transition-transform duration-200 ${ue?"-rotate-90":""}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})}),n.jsx("span",{className:"text-gray-400",children:n.jsx(vP,{className:"h-3 w-3"})}),n.jsx("span",{className:"text-[10px] font-black text-gray-300 uppercase tracking-widest",children:L("node.content.prompt")})]}),n.jsxs("div",{className:"flex gap-1",onClick:Q=>Q.stopPropagation(),children:[n.jsx(we,{title:L("node.content.updatePromptFromImage"),onClick:()=>_(),tooltipPosition:"left",disabled:re===xe,children:re===xe?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-cyan-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),n.jsx(we,{title:L("node.action.copy"),onClick:()=>navigator.clipboard.writeText(e.prompt),tooltipPosition:"left",children:n.jsx(zt,{className:"h-3 w-3"})})]})]}),!ue&&n.jsxs("div",{className:"p-2 space-y-2",children:[n.jsx("textarea",{value:e.prompt,onChange:Q=>a({prompt:Q.target.value}),className:"w-full p-2 bg-gray-900/60 border border-gray-700 rounded text-xs text-gray-200 resize-y focus:border-accent outline-none min-h-[60px] max-h-[200px] custom-scrollbar",placeholder:L("node.content.promptPlaceholder"),onMouseDown:Q=>Q.stopPropagation(),onFocus:W}),n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsxs("div",{className:"flex justify-between items-center px-1",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:L("node.content.additionalPromptSuffix")}),n.jsxs("div",{className:"flex gap-0.5",children:[n.jsx(mt,{content:L("node.action.characterConcept"),children:n.jsx("button",{onClick:Q=>{Q.stopPropagation(),a({additionalPrompt:b0})},className:`p-0.5 rounded hover:bg-gray-700 transition-colors ${e.additionalPrompt===b0?"text-accent":"text-gray-500 hover:text-accent"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})})}),n.jsx(mt,{content:L("node.action.objectConcept"),children:n.jsx("button",{onClick:Q=>{Q.stopPropagation(),a({additionalPrompt:C0})},className:`p-0.5 rounded hover:bg-gray-700 transition-colors ${e.additionalPrompt===C0?"text-accent":"text-gray-500 hover:text-accent"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})})})]})]}),n.jsx("input",{type:"text",value:e.additionalPrompt||"",onChange:Q=>a({additionalPrompt:Q.target.value}),className:"w-full p-1 bg-gray-900/60 border border-gray-700 rounded text-xs text-gray-400 focus:border-accent outline-none",onMouseDown:Q=>Q.stopPropagation(),onFocus:W})]}),n.jsxs("div",{className:"flex flex-col gap-1 border-t border-gray-700/50 pt-2 mt-1",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter px-1",children:L("node.content.modificationRequest")}),n.jsxs("div",{className:"flex gap-2 h-[32px]",children:[n.jsx("input",{value:R,onChange:Q=>J(Q.target.value),placeholder:"...",className:"flex-grow bg-gray-900/60 border border-gray-700 rounded px-2 text-xs text-white focus:border-accent outline-none h-full",onMouseDown:Q=>Q.stopPropagation(),onFocus:W}),[{code:"en",label:"EN"},{code:T,label:D[T].short}].map((Q,ce)=>n.jsx("button",{onClick:pe=>{pe.stopPropagation(),a({targetLanguage:Q.code})},className:`h-full w-8 rounded text-[10px] font-bold transition-colors flex items-center justify-center border ${e.targetLanguage===Q.code?"bg-accent text-white border-accent":"bg-gray-900/60 border-gray-700 text-gray-400 hover:text-white hover:bg-gray-700"}`,children:Q.label},Q.code+ce)),n.jsx("div",{className:"flex gap-1 h-full",children:n.jsx(mt,{content:L("node.action.modifyCharacter"),children:n.jsx("button",{onClick:Q=>{Q.stopPropagation(),j()},disabled:!R.trim()||F===xe,className:"w-8 bg-accent hover:bg-accent-hover text-white rounded flex items-center justify-center disabled:opacity-50 h-full",children:F===xe?n.jsxs("svg",{className:"animate-spin h-3.5 w-3.5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})})})]})]})]})]}),n.jsxs("div",{className:"flex-grow min-h-0 mt-2 relative p-0 border border-gray-700/50 rounded-xl bg-gray-900/20 shadow-inner overflow-hidden flex flex-col overflow-x-hidden",children:[n.jsxs("div",{className:"px-4 py-2 bg-gray-800 border-b border-gray-700 flex items-center justify-between cursor-pointer hover:bg-gray-750 transition-colors select-none flex-shrink-0",onClick:()=>a({isDescriptionCollapsed:!e.isDescriptionCollapsed}),children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:`transform transition-transform duration-200 ${e.isDescriptionCollapsed?"-rotate-90":""}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})}),n.jsx("span",{className:"text-[10px] font-black text-gray-300 uppercase tracking-widest",children:L("node.content.fullDescriptionTitle")})]}),n.jsxs("div",{className:"flex gap-1",children:[n.jsx(we,{title:L("node.action.updateDescription"),onClick:Q=>{Q.stopPropagation(),$()},disabled:te===xe||!e.prompt,className:"p-1 text-gray-500 hover:text-accent-text transition-colors",tooltipPosition:"left",children:te===xe?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-accent-text",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),n.jsx(we,{title:L("node.action.copy"),onClick:Q=>{Q.stopPropagation(),navigator.clipboard.writeText(e.fullDescription)},className:"p-1 text-gray-500 hover:text-accent-text transition-colors",tooltipPosition:"left",children:n.jsx(zt,{className:"h-3 w-3"})})]})]}),!e.isDescriptionCollapsed&&n.jsx("div",{className:"overflow-y-auto custom-scrollbar flex-grow overflow-x-hidden mr-1",onWheel:Q=>Q.stopPropagation(),style:{scrollbarGutter:"stable",overscrollBehaviorY:"contain"},children:n.jsx(Cj,{fullDescription:e.fullDescription||"",onDescriptionChange:Q=>a({fullDescription:Q}),t:L,onFocus:W,isUpdatingPersonality:Y===`${xe}-personality`,onUpdatePersonality:oe,isUpdatingAppearance:le===`${xe}-appearance`,onUpdateAppearance:K,isUpdatingClothing:ie===`${xe}-clothing`,onUpdateClothing:Z})})]}),n.jsxs("div",{className:"flex gap-1.5 pt-2.5 mt-auto border-t border-gray-700/50 flex-shrink-0 bg-gray-800/20 backdrop-blur-sm",children:[n.jsx("button",{onClick:Q=>{Q.stopPropagation(),E()},className:"flex-1 h-9 bg-accent-secondary hover:bg-accent-secondary-hover text-white font-bold rounded text-[10px] uppercase tracking-tighter transition-colors",children:L("node.action.loadCharacter")}),n.jsx("button",{onClick:Q=>{Q.stopPropagation(),I()},className:"flex-1 h-9 bg-accent hover:bg-accent-hover text-white font-bold rounded text-[10px] uppercase tracking-tighter transition-colors",children:L("node.action.saveCharacter")}),n.jsxs("div",{className:"flex gap-1.5 ml-auto",children:[n.jsx(we,{title:L("catalog.saveTo"),onClick:Q=>{Q.stopPropagation(),B()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(we,{title:L("node.action.copy"),onClick:Q=>{Q.stopPropagation(),M()},children:n.jsx(zt,{className:"h-4 w-4"})}),n.jsx(we,{title:L("node.action.paste"),onClick:Q=>{Q.stopPropagation(),G()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),n.jsx(we,{title:L("node.action.detachAndPaste"),onClick:Q=>{Q.stopPropagation(),V()},tooltipPosition:"top",tooltipAlign:"end",children:n.jsx(by,{className:"h-4 w-4"})})]})]})]})]})},Ej=At.memo(Nj),ea=410,ta=90,k0=At.memo(({index:e,activeDropZone:t,onDragOver:o,onDrop:r,onDragLeave:a})=>n.jsx("div",{className:`w-[24px] h-full flex items-center justify-center flex-shrink-0 transition-all cursor-copy ${t===e?"bg-gray-800/30":""}`,onDragOver:i=>o(i,e),onDragLeave:a,onDrop:r,children:n.jsx("div",{className:`h-[90%] rounded-full transition-all duration-200 pointer-events-none ${t===e?"w-1 bg-accent shadow-[0_0_10px_var(--color-accent)] opacity-100 scale-y-100":"w-[1px] bg-gray-700/30 opacity-50 scale-y-90"}`})})),Pj=({node:e,onValueChange:t,onSaveCharacterCard:o,onLoadCharacterCard:r,t:a,deselectAllNodes:i,onSaveCharacterToCatalog:s,setFullSizeImage:l,getFullSizeImage:c,setImageViewer:d,onCopyImageToClipboard:u,onDownloadImageFromUrl:p,addToast:m,onUpdateCharacterDescription:w,isUpdatingDescription:k,onModifyCharacter:b,isModifyingCharacter:x,getUpstreamNodeValues:f,connectedInputs:h,onDetachCharacter:v,onGenerateImage:N,isGeneratingImage:_,onAddNode:E,onDeleteNode:I})=>{const B=Kt(),{setNodes:M,setSelectedNodeIds:G,handleUpdateCharacterPromptFromImage:V,isUpdatingCharacterPrompt:j,handleUpdateCharacterPersonality:P,isUpdatingPersonality:S,handleUpdateCharacterAppearance:A,isUpdatingAppearance:O,handleUpdateCharacterClothing:z,isUpdatingClothing:L}=B||{},W=E||(B==null?void 0:B.onAddNode);I||(B==null||B.deleteNodeAndConnections);const D=y.useRef(null),[T,F]=y.useState(null),[te,$]=y.useState(!1),[Y,oe]=y.useState(null),[le,K]=y.useState(0),[ie,Z]=y.useState({}),[se,de]=y.useState(null),[re,R]=y.useState(null),[J,H]=y.useState(null),[U,ee]=y.useState(!1),{secondaryLanguage:ae}=Pt(),xe=h==null?void 0:h.has(void 0),ne=y.useMemo(()=>{try{let Ce=JSON.parse(e.value||"[]");return Array.isArray(Ce)||(typeof Ce=="object"&&Ce!==null?Ce=[Ce]:Ce=[]),Ce.length===0&&(Ce=[{id:`char-card-${Date.now()}`,name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!0,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"}]),Ce.map((Se,he)=>({id:Se.id||`char-card-${Date.now()}-${he}`,name:Se.name||"",index:(Se.index||Se.alias||`Entity-${he+1}`).replace(/^Character-/,"Entity-"),image:Se.image||null,thumbnails:Se.thumbnails||Se.imageSources||{"1:1":null,"16:9":null,"9:16":null},selectedRatio:Se.selectedRatio||"1:1",prompt:Se.prompt||"",additionalPrompt:Se.additionalPrompt!==void 0?Se.additionalPrompt:"Full body character concept on a gray background",fullDescription:Se.fullDescription||"",targetLanguage:Se.targetLanguage||"en",isOutput:Se.isOutput||he===0&&!Ce.some(ge=>ge.isOutput),isActive:Se.isActive!==!1,isDescriptionCollapsed:Se.isDescriptionCollapsed??!1,isImageCollapsed:Se.isImageCollapsed??!1,isPromptCollapsed:Se.isPromptCollapsed??!1}))}catch{return[{id:`char-card-${Date.now()}`,name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!0,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"}]}},[e.value]),X=y.useMemo(()=>Array.isArray(ne)?ne:[],[ne]),ue=y.useRef(X);y.useEffect(()=>{ue.current=X},[X]),y.useEffect(()=>{try{const Ce=JSON.parse(e.value||"[]");(Array.isArray(Ce)?Ce:[Ce]).some(ge=>ge.index&&ge.index.startsWith("Character-"))&&t(e.id,JSON.stringify(X))}catch{}},[e.value,X,t,e.id]),y.useEffect(()=>{de(null),R(null),H(null)},[X.length]);const Q=y.useMemo(()=>{const Ce={},Se=new Set;return X.forEach(he=>{const ge=(he.index||"").trim();ge&&(Ce[ge]=(Ce[ge]||0)+1)}),Object.entries(Ce).forEach(([he,ge])=>{ge>1&&Se.add(he)}),Se},[X]),ce=y.useCallback(Ce=>{t(e.id,JSON.stringify(Ce))},[e.id,t]),pe=y.useCallback((Ce,Se)=>{const he=[...ue.current];he[Ce]&&(he[Ce]={...he[Ce],...Se},ce(he))},[ce]),me=Ce=>{const Se=X.map((he,ge)=>({...he,isOutput:ge===Ce}));ce(Se),m==null||m("Character marked as output","success")},ke=Ce=>{const Se=[...X];Se[Ce]={...Se[Ce],isActive:!Se[Ce].isActive},ce(Se)},Re=(Ce,Se)=>{de(Se);const he=X[Se],ge={...he.thumbnails};Object.entries(Ut).forEach(([Ge,Ve])=>{const ot=c(e.id,Se*10+Ve);ot&&(ge[Ge]=ot)});const ve={type:"prompt-modifier-character-card-transfer",sourceNodeId:e.id,sourceIndex:Se,character:{...he,imageSources:ge,_fullResActive:c(e.id,Se*10)}};Ce.dataTransfer.setData("application/prompt-modifier-card",JSON.stringify(ve)),Ce.dataTransfer.effectAllowed="move"},Me=(Ce,Se)=>{if(!Ce.dataTransfer.types.includes("application/prompt-modifier-card"))return;Ce.preventDefault(),Ce.stopPropagation();const he=Ce.currentTarget.getBoundingClientRect(),ve=Ce.clientX-he.left>he.width/2,Ge=Se+(ve?1:0);H(Ge),R(Ge)},De=y.useCallback((Ce,Se)=>{Ce.dataTransfer.types.includes("application/prompt-modifier-card")&&(Ce.preventDefault(),Ce.stopPropagation(),H(Se),R(Se))},[]),Ie=y.useCallback(()=>{},[]),Ne=async Ce=>{Ce.preventDefault(),Ce.stopPropagation(),H(null),de(null),ee(!1);const Se=re;R(null);const he=Ce.dataTransfer.getData("application/prompt-modifier-card");if(he)try{const ge=JSON.parse(he);if(ge.type!=="prompt-modifier-character-card-transfer")return;const{sourceNodeId:ve,sourceIndex:Ge,character:Ve}=ge,ot=Se!==null?Se:X.length;if(ve===e.id){if(Ge===ot||Ge===ot-1)return;const Xe=[...X],[pt]=Xe.splice(Ge,1);let st=ot;ot>Ge&&(st-=1),Xe.splice(st,0,pt);const ft={};X.forEach((it,wt)=>{for(let dt=0;dt<10;dt++){const _t=c(e.id,wt*10+dt);_t&&(ft[wt*10+dt]=_t)}});for(let it=0;it<X.length*10;it++)l(e.id,it,null);Xe.forEach((it,wt)=>{const dt=X.findIndex(_t=>_t.id===it.id);if(dt!==-1)for(let _t=0;_t<10;_t++){const cn=ft[dt*10+_t];cn&&l(e.id,wt*10+_t,cn)}}),ce(Xe)}else{const Xe=[...X];Xe.length===1&&!Xe[0].name&&!Xe[0].image&&!Xe[0].prompt&&Xe.splice(0,1);const pt=Xe.length===0,st={...Ve,id:`char-card-${Date.now()}`,isOutput:pt,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!1},ft=Math.min(ot,Xe.length);Xe.splice(ft,0,st),st.imageSources&&Object.entries(st.imageSources).forEach(([it,wt])=>{const dt=Ut[it];dt&&typeof wt=="string"&&l(e.id,ft*10+dt,wt)}),st._fullResActive&&l(e.id,ft*10,st._fullResActive),M&&M(it=>it.map(wt=>wt.id===e.id?{...wt,width:Xe.length*ea+ta}:wt)),ce(Xe),M&&(B!=null&&B.setFullSizeImage)&&(B!=null&&B.getFullSizeImage)&&M(it=>it.map(wt=>{if(wt.id===ve)try{const dt=JSON.parse(wt.value);let _t=dt.filter((It,Ee)=>Ee!==Ge);if(_t.length===0){_t=[{id:`char-card-${Date.now()}-reset`,name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!0,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"}];for(let It=0;It<10;It++)B.setFullSizeImage(ve,It,null)}else{dt[Ge].isOutput&&_t.length>0&&(_t[0].isOutput=!0);for(let Ee=Ge;Ee<dt.length-1;Ee++)for(let Ue=0;Ue<10;Ue++){const Ke=B.getFullSizeImage(ve,(Ee+1)*10+Ue);B.setFullSizeImage(ve,Ee*10+Ue,Ke||null)}const It=dt.length-1;for(let Ee=0;Ee<10;Ee++)B.setFullSizeImage(ve,It*10+Ee,null)}const cn=Math.max(ea+ta,_t.length*ea+ta);return{...wt,value:JSON.stringify(_t),width:cn}}catch{return wt}return wt})),m==null||m("Card transferred","success")}}catch(ge){console.error("Drop failed",ge),m==null||m("Drop failed: "+(ge instanceof Error?ge.message:"Unknown error"),"error")}},Pe=Ce=>{Ce.stopPropagation();let Se=1;const he=new Set(X.map(ve=>ve.name));for(;he.has(`New Character ${Se}`);)Se++;const ge=[...X,{id:`char-card-${Date.now()}`,name:`New Character ${Se}`,index:`Entity-${X.length+1}`,image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!1,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"}];ce(ge),M&&M(ve=>ve.map(Ge=>Ge.id===e.id?{...Ge,width:ge.length*ea+ta}:Ge))},ye=Ce=>{if(X.length<=1){ce([{id:`char-card-${Date.now()}`,name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!0,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"}]);return}for(let ge=Ce;ge<X.length-1;ge++)for(let ve=0;ve<10;ve++){const Ge=c(e.id,(ge+1)*10+ve);l(e.id,ge*10+ve,Ge||null)}const Se=X.length-1;for(let ge=0;ge<10;ge++)l(e.id,Se*10+ge,null);const he=X.filter((ge,ve)=>ve!==Ce);he.some(ge=>ge.isOutput)||(he[0].isOutput=!0),ce(he),M&&M(ge=>ge.map(ve=>ve.id===e.id?{...ve,width:Math.max(ea+ta,he.length*ea+ta)}:ve))},_e=async Ce=>{const Se=X[Ce],he={...Se.thumbnails};Object.entries(Ut).forEach(([ve,Ge])=>{const Ve=c(e.id,Ce*10+Ge);Ve&&(he[ve]=Ve)});const ge={type:"character-card",...Se,imageSources:he};delete ge.id,delete ge.thumbnails;try{await navigator.clipboard.writeText(JSON.stringify(ge,null,2)),m==null||m(a("toast.copiedToClipboard"),"success")}catch{m==null||m(a("toast.copyFailed"),"error")}},Fe=async Ce=>{try{const Se=await navigator.clipboard.readText(),he=JSON.parse(Se);let ge=Array.isArray(he)?he[0]:he;if(ge&&(ge.type==="character-card"||ge.name||ge.prompt)){const ve=ge.imageSources||{},Ge=Object.values(ve).some(st=>!!st);ge.image&&!Ge&&(ve["1:1"]=ge.image);const Ve={};for(const[st,ft]of Object.entries(ve)){let it=ft;typeof it=="string"&&!it.startsWith("data:")&&it.length>100&&(it.trim().startsWith("/9j/")?it=`data:image/jpeg;base64,${it}`:it=`data:image/png;base64,${it}`),Ve[st]=it}const ot={"1:1":null,"16:9":null,"9:16":null};for(const[st,ft]of Object.entries(Ve))if(typeof ft=="string"&&ft.startsWith("data:")){const it=Ce*10+(Ut[st]||1);l(e.id,it,ft),ot[st]=await Ot(ft,256,256)}else ot[st]=ft;const Xe=ge.selectedRatio||"1:1",pt=Ve[Xe];pt&&typeof pt=="string"&&pt.startsWith("data:")&&l(e.id,Ce*10,pt),pe(Ce,{name:ge.name||"",index:ge.index||ge.alias||`Entity-${Ce+1}`,prompt:ge.prompt||ge.imagePrompt||"",fullDescription:ge.fullDescription||ge.description||"",selectedRatio:Xe,image:ot[Xe],thumbnails:ot}),m==null||m(a("toast.pastedFromClipboard"),"success")}}catch{m==null||m(a("toast.pasteFailed"),"error")}},We=async Ce=>{try{const Se=await navigator.clipboard.read();for(const he of Se){const ge=he.types.find(ve=>ve.startsWith("image/"));if(ge){const ve=await he.getType(ge),Ge=new FileReader;Ge.onload=async Ve=>{var Xe;const ot=(Xe=Ve.target)==null?void 0:Xe.result;ot&&(await $e(Ce,ot),m==null||m(a("toast.pastedFromClipboard"),"success"))},Ge.readAsDataURL(ve);return}}m==null||m(a("toast.pasteFailed"),"error")}catch(Se){console.error("Paste image failed",Se),m==null||m(a("toast.pasteFailed"),"error")}},Ze=(Ce,Se)=>{const he=ue.current[Ce];if(Se===he.selectedRatio)return;const ge=c(e.id,Ce*10+(Ut[Se]||1)),ve=he.thumbnails[Se]||null;ge?l(e.id,Ce*10,ge):ve&&l(e.id,Ce*10,ve),pe(Ce,{selectedRatio:Se,image:ve})},$e=async(Ce,Se)=>{const he=ue.current[Ce];if(!he)return;l(e.id,Ce*10,Se),l(e.id,Ce*10+(Ut[he.selectedRatio]||1),Se);const ge=await Ot(Se,256,256),ve={...he.thumbnails,[he.selectedRatio]:ge};pe(Ce,{thumbnails:ve,image:ge})};y.useCallback(Ce=>{if(!xe||!f)return;const he=f(e.id).find(ge=>typeof ge=="string"&&!ge.trim().startsWith("{")&&!ge.trim().startsWith("["))||"";he?(pe(Ce,{prompt:he}),m==null||m("Prompt synced from connection","success")):m==null||m("No text found in connection","info")},[xe,f,e.id,pe,m]);const He=y.useCallback(Ce=>{var he;const Se=(he=Ce.target.files)==null?void 0:he[0];if(Se){const ge=new FileReader;ge.onload=async ve=>{var Ve;const Ge=(Ve=ve.target)==null?void 0:Ve.result;Ge&&await $e(le,Ge)},ge.readAsDataURL(Se)}Ce.target&&(Ce.target.value="")},[le,$e]),be=Ce=>{const Se=ie[Ce];!(Se!=null&&Se.trim())||!b||(b(e.id,Ce,Se),Z(he=>({...he,[Ce]:""})))},Ae=Ce=>{V&&V(e.id,Ce)},Te=Ce=>{P&&P(e.id,Ce)},qe=Ce=>{A&&A(e.id,Ce)},Ye=Ce=>{z&&z(e.id,Ce)},nt=Ce=>{const Se=ue.current[Ce],he=c(e.id,Ce*10+(Ut[Se.selectedRatio]||1))||Se.image;if(!he||!W)return;const ge={x:e.position.x+e.width+50,y:e.position.y},ve=W(q.IMAGE_EDITOR,ge),Ge={inputImages:[Se.thumbnails[Se.selectedRatio]||Se.image],prompt:Se.prompt||"",outputImage:null,aspectRatio:Se.selectedRatio,enableAspectRatio:!0,enableOutpainting:!1,outpaintingPrompt:"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.",model:"gemini-2.5-flash-image",autoDownload:!0,autoCrop169:!1,leftPaneWidth:360,topPaneHeight:330};t(ve,JSON.stringify(Ge)),l(ve,1,he)},Nt=Ce=>{const Se=ue.current[Ce],he=c(e.id,Ce*10+(Ut[Se.selectedRatio]||1))||Se.image;he&&(oe(he),K(Ce),$(!0))},ze=async(Ce,Se)=>{const he=ue.current[Ce],ge=c(e.id,Ce*10)||he.image;if(ge){F(Se);try{let ve="Fill the background with gray studio environment";Se==="16:9"?ve="Fill the background with gray studio environment - fill in the white areas on the sides to naturally expand the image area of the gray scene.":Se==="9:16"&&(ve="Fill the background with gray studio environment - fill in the white areas on top and bottom to naturally expand the image area of the gray scene.");const Ge=await sc(ge,Se,ve,"gemini-2.5-flash-image","");await $e(Ce,Ge),m&&m(`Converted to ${Se} successfully`,"success")}catch(ve){console.error(ve),m&&m(`Failed to convert: ${ve.message}`,"error")}finally{F(null)}}},je=async Ce=>{const Se=ue.current[Ce],he=c(e.id,Ce*10)||Se.image;if(he){F("1:1");try{const ge=await NC(he);await $e(Ce,ge),m&&m("Cropped to 1:1 successfully","success")}catch(ge){console.error(ge),m&&m(`Failed to crop: ${ge.message}`,"error")}finally{F(null)}}},Le=Ce=>{const Se=ue.current[Ce];if(v){const he={...Se.thumbnails};Object.entries(Ut).forEach(([Ge,Ve])=>{const ot=c(e.id,Ce*10+Ve);ot&&(he[Ge]=ot)});const ge=c(e.id,Ce*10),ve={...Se,imageSources:he,_fullResImage:ge};v(ve,e),ye(Ce)}},rt=Ce=>{(Ce.dataTransfer.types.includes("application/prompt-modifier-card")||Ce.dataTransfer.types.includes("Files")||Ce.dataTransfer.types.includes("application/prompt-modifier-drag-image"))&&(Ce.preventDefault(),Ce.stopPropagation(),ee(!0))};return n.jsxs("div",{className:`flex h-full w-full overflow-x-scroll custom-scrollbar p-0 gap-0 pb-2 transition-colors ${U?"bg-accent-dim":""}`,onWheel:Ce=>Ce.stopPropagation(),style:{scrollbarGutter:"stable",overscrollBehaviorY:"contain"},onDrop:Ne,onDragOver:rt,onDragLeave:()=>ee(!1),children:[n.jsx("style",{children:".custom-scrollbar::-webkit-scrollbar { height: 8px; width: 8px; } .custom-scrollbar::-webkit-scrollbar-track { background: rgba(31, 41, 45, 0.5); border-radius: 4px; margin: 0 4px; } .custom-scrollbar::-webkit-scrollbar-thumb { background: var(--color-scrollbar); border-radius: 4px; } .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #6b7280; }"}),n.jsx(ic,{isOpen:te,onClose:()=>{$(!1)},onApply:Ce=>$e(le,Ce),imageSrc:Y}),n.jsx("input",{ref:D,type:"file",accept:"image/*",className:"hidden",onChange:He}),X.map((Ce,Se)=>n.jsxs(At.Fragment,{children:[n.jsx(k0,{index:Se,activeDropZone:J,onDragOver:De,onDrop:Ne,onDragLeave:Ie}),n.jsx(Ej,{char:Ce,index:Se,nodeId:e.id,isDragging:se===Se,onUpdate:he=>pe(Se,he),onRemove:()=>ye(Se),onSetAsOutput:()=>me(Se),onToggleActive:()=>ke(Se),onDragStart:he=>Re(he,Se),onDragEnd:()=>{de(null),R(null),H(null)},onSmartDragOver:he=>Me(he,Se),onRatioChange:he=>Ze(Se,he),onPasteImage:()=>We(Se),onClearImage:()=>pe(Se,{thumbnails:{...Ce.thumbnails,[Ce.selectedRatio]:null},image:null}),onCopyImage:()=>{const he=c(e.id,Se*10)||Ce.image;he&&u(he)},onDownloadImageFromUrl:p,onGenerateImage:()=>{K(Se),N(e.id,Se)},onEditRaster:()=>Nt(Se),onEditAI:()=>nt(Se),onCrop1x1:()=>je(Se),onExpandRatio:he=>ze(Se,he),onSetEditingIndex:()=>{var he;K(Se),(he=D.current)==null||he.click()},onSyncFromConnection:()=>Ae(Se),onLoad:()=>r(e.id),onSave:()=>o(e.id,Se),onSaveToCatalog:()=>s(e.id,Se),onCopySpecific:()=>_e(Se),onPasteSpecific:()=>Fe(Se),onDetach:()=>Le(Se),onModify:()=>be(Se),getFullSizeImage:he=>c(e.id,he),setImageViewer:d,onCopyImageToClipboard:u,processNewImage:he=>$e(Se,he),t:a,deselectAllNodes:i,languages:xn,secondaryLanguage:ae,isModifyingCharacter:x,isUpdatingDescription:k,onUpdateDescription:()=>w&&w(e.id,Se),isUpdatingPersonality:S,onUpdatePersonality:()=>Te(Se),isUpdatingAppearance:O,onUpdateAppearance:()=>qe(Se),isUpdatingClothing:L,onUpdateClothing:()=>Ye(Se),transformingRatio:T,isGeneratingImage:_,isUpdatingCharacterPrompt:j,modificationRequest:ie[Se]||"",setModificationRequest:he=>Z(ge=>({...ge,[Se]:he})),hasDuplicateIndex:Q.has((Ce.index||"").trim()),onCopyIndex:()=>{navigator.clipboard.writeText(`[${Ce.index}]`),m&&m(a("toast.copiedToClipboard"),"success")}})]},Ce.id)),n.jsx(k0,{index:X.length,activeDropZone:J,onDragOver:De,onDrop:Ne,onDragLeave:Ie}),n.jsx("div",{className:"flex items-center justify-start pl-2 min-w-[60px] h-full",children:n.jsx(mt,{content:a("node.action.addCard"),children:n.jsx("button",{onClick:Pe,className:"w-12 h-12 flex items-center justify-center bg-gray-800 hover:bg-cyan-900 border border-gray-600 hover:border-cyan-500 text-gray-400 hover:text-cyan-400 rounded-full transition-all shadow-lg group relative",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 transform transition-transform duration-200 group-hover:scale-110",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{d:"M12 4v16m8-8H4"})})})})})]})},jj=({node:e,onSanitize:t,isSanitizing:o,t:r,onSelectNode:a})=>n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsx("div",{className:"relative flex-grow min-h-0 mb-2",children:n.jsx("textarea",{readOnly:!0,value:e.value,placeholder:r("node.content.sanitizedPromptHere"),className:"absolute inset-0 w-full h-full p-2 bg-gray-700 border-none rounded-md resize-none focus:outline-none",onWheel:i=>i.stopPropagation(),onMouseDown:i=>{i.stopPropagation(),a()}})}),n.jsx("button",{onClick:()=>t(e.id),disabled:o,className:"w-full px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:r(o?"node.content.sanitizing":"node.action.sanitize")})]}),Ij=({node:e,onReadData:t,t:o,onSelectNode:r,getUpstreamNodeValues:a})=>{const{text:i,image:s,mediaUrl:l,mediaType:c}=y.useMemo(()=>{try{const w=JSON.parse(e.value||"{}");return{text:w.text||"",image:w.image||null,mediaUrl:w.mediaUrl||null,mediaType:w.mediaType||"video"}}catch{return{text:"",image:null,mediaUrl:null,mediaType:"video"}}},[e.value]),[d,u]=y.useState(null);y.useEffect(()=>{u(null)},[s]);const p=y.useMemo(()=>a(e.id),[a,e.id]),m=JSON.stringify(p);return y.useEffect(()=>{t(e.id)},[m,t,e.id]),n.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[n.jsxs("div",{className:"flex-grow min-h-0 flex flex-col space-y-2",children:[l&&n.jsxs("div",{className:"flex-1 min-h-[150px] bg-black rounded-md overflow-hidden relative group border border-gray-700",onMouseDown:w=>{w.stopPropagation(),r()},children:[c==="video"?n.jsx("video",{src:l,controls:!0,className:"w-full h-full object-contain"}):n.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-4 bg-gray-900",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-gray-500 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),n.jsx("audio",{src:l,controls:!0,className:"w-full max-w-[90%]"})]}),n.jsx("div",{className:"absolute top-1 left-1 bg-black/60 text-white text-[10px] px-1.5 py-0.5 rounded pointer-events-none uppercase backdrop-blur-sm border border-white/10",children:c})]}),s&&n.jsxs("div",{className:"flex-1 min-h-[150px] bg-gray-900/50 rounded-md p-1 relative group",onMouseDown:w=>{w.stopPropagation(),r()},children:[n.jsx("img",{src:s,alt:"Read data",className:"object-contain w-full h-full",onLoad:w=>u({width:w.currentTarget.naturalWidth,height:w.currentTarget.naturalHeight})}),d&&n.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/70 text-white text-[10px] px-1.5 py-0.5 rounded pointer-events-none backdrop-blur-sm",children:[d.width," x ",d.height," px"]})]}),n.jsxs("div",{className:"flex-grow min-h-0 relative",children:[n.jsx("textarea",{readOnly:!0,value:i,placeholder:!s&&!i&&!l?"":o("node.content.textDataHere"),className:"w-full h-full p-2 bg-slate-800 border-none rounded-md resize-none focus:outline-none text-gray-300",onWheel:w=>w.stopPropagation(),onMouseDown:w=>{w.stopPropagation(),r()}}),!s&&!i&&!l&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-center text-gray-500 pointer-events-none p-4",children:n.jsx("span",{children:o("node.content.noDataRead")})})]})]}),n.jsx("button",{onClick:()=>t(e.id),className:"w-full px-4 py-2 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex-shrink-0",children:o("node.content.readData")})]})},Tj=({data:e,color:t="rgba(255, 255, 255, 0.5)",height:o=40})=>{const r=y.useRef(null);return y.useEffect(()=>{const a=r.current;if(!a||!e)return;const i=a.getContext("2d");if(!i)return;const s=window.devicePixelRatio||1,l=a.getBoundingClientRect();a.width=l.width*s,a.height=l.height*s,i.scale(s,s),i.clearRect(0,0,l.width,l.height);const c=l.width,d=l.height,u=d/2;i.fillStyle=t,i.beginPath();const p=Math.ceil(e.length/c),m=d/2;for(let w=0;w<c;w++){let k=1,b=-1;for(let x=0;x<p;x++){const f=e[w*p+x];f<k&&(k=f),f>b&&(b=f)}i.fillRect(w,u+k*m,1,Math.max(1,(b-k)*m))}},[e,t,o]),n.jsx("canvas",{ref:r,className:"w-full h-full absolute inset-0 pointer-events-none opacity-60"})},Aj=({tracks:e,clips:t,currentTime:o,duration:r,zoom:a,onSeek:i,scrollLeft:s,onScroll:l,onClipSelect:c,selectedClipId:d,audioDataMap:u})=>{var _;const p=y.useRef(null),m=y.useRef(!1),w=Math.max(r*a,((_=p.current)==null?void 0:_.clientWidth)||0)+200,k=(E,I)=>{E.stopPropagation(),c(I)},b=E=>E.type==="video"?"bg-indigo-900/80 border-indigo-500":E.type==="image"?"bg-emerald-900/80 border-emerald-500":E.type==="audio"?"bg-amber-900/80 border-amber-500":"bg-gray-700 border-gray-500",x=E=>{if(!p.current)return 0;const I=p.current.getBoundingClientRect(),M=E-I.left+p.current.scrollLeft;return Math.max(0,M/a)},f=E=>{m.current=!0,i(x(E.clientX)),window.addEventListener("mousemove",h),window.addEventListener("mouseup",v)},h=E=>{m.current&&i(x(E.clientX))},v=()=>{m.current=!1,window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",v)};y.useEffect(()=>()=>{window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",v)},[]);const N=()=>{const E=[],I=a<20?5:a<50?1:.5,B=r+10;for(let M=0;M<=B;M+=I){const G=M*a;E.push(n.jsx("div",{className:"absolute top-0 bottom-0 border-l border-gray-600 pointer-events-none",style:{left:G},children:n.jsxs("span",{className:"absolute top-0 left-1 text-[9px] text-gray-400 select-none",children:[M,"s"]})},M))}return E};return n.jsx("div",{className:"flex flex-col h-full bg-gray-900 border-t border-gray-700",children:n.jsxs("div",{className:"flex-1 flex overflow-hidden relative",children:[n.jsxs("div",{className:"w-24 flex-shrink-0 bg-gray-800 border-r border-gray-700 z-20 flex flex-col shadow-lg",children:[n.jsx("div",{className:"h-8 border-b border-gray-700 bg-gray-800"})," ",e.map(E=>n.jsxs("div",{className:"h-16 border-b border-gray-700 flex flex-col justify-center px-2 text-xs text-gray-400 bg-gray-800 gap-1 relative",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:`w-2 h-2 rounded-full ${E.type==="audio"?"bg-amber-500":"bg-indigo-500"}`}),n.jsx("span",{className:"font-bold truncate",title:E.name,children:E.name})]}),n.jsx("div",{className:"flex items-center gap-1 text-[10px] opacity-60",children:n.jsx("span",{children:E.type.toUpperCase()})})]},E.id))]}),n.jsx("div",{className:"flex-1 overflow-x-auto overflow-y-hidden relative custom-scrollbar",ref:p,onScroll:E=>l(E.currentTarget.scrollLeft),children:n.jsxs("div",{style:{width:w,height:"100%"},className:"relative",children:[n.jsxs("div",{className:"h-8 bg-gray-800 border-b border-gray-700 relative cursor-pointer hover:bg-gray-750 z-10",onMouseDown:f,children:[N(),n.jsx("div",{className:"absolute top-0 bottom-0 w-0 z-20 pointer-events-none",style:{left:o*a},children:n.jsx("div",{className:"absolute -top-0 -left-2 w-0 h-0 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent border-t-[12px] border-t-red-500"})})]}),e.map(E=>n.jsxs("div",{className:"h-16 border-b border-gray-700 relative bg-gray-900/50",children:[n.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-20"}),t.filter(I=>I.layer===E.id).map(I=>n.jsxs("div",{onClick:B=>k(B,I.id),className:`absolute top-1 bottom-1 rounded overflow-hidden cursor-pointer border border-opacity-50 select-none group
                                            ${b(I)}
                                            ${d===I.id?"ring-2 ring-white z-10":""}
                                        `,style:{left:I.start*a,width:I.duration*a},title:`${I.name} (Start: ${I.start.toFixed(1)}s, Dur: ${I.duration.toFixed(1)}s)`,children:[u&&u[I.id]&&n.jsx(Tj,{data:u[I.id],color:I.type==="audio"?"rgba(251, 191, 36, 0.7)":"rgba(99, 102, 241, 0.7)"}),n.jsx("div",{className:"absolute top-0 left-0 right-0 px-1 text-[10px] text-white/90 truncate bg-black/30 pointer-events-none",children:I.name})]},I.id))]},E.id)),n.jsx("div",{className:"absolute top-8 bottom-0 w-px bg-red-500 pointer-events-none z-30",style:{left:o*a}})]})})]})})},Rj=({currentTime:e,clips:t,isPlaying:o,onTimeUpdate:r})=>{const a=y.useRef(null),i=y.useRef(null),s=y.useRef(null),l=y.useRef(null),c=y.useRef(e),[d,u]=y.useState(null),[p,m]=y.useState([]);y.useEffect(()=>{const k=t.filter(x=>(x.type==="video"||x.type==="image")&&e>=x.start&&e<x.start+x.duration);k.sort((x,f)=>f.layer-x.layer),u(k[0]||null);const b=t.filter(x=>x.type==="audio"&&e>=x.start&&e<x.start+x.duration);m(b)},[e,t]),y.useEffect(()=>{const k=d;if(k&&k.type==="video"&&a.current){const b=e-k.start+k.offset;Math.abs(a.current.currentTime-b)>.3&&(a.current.currentTime=b),o&&a.current.paused?a.current.play().catch(()=>{}):!o&&!a.current.paused&&a.current.pause()}},[e,d,o]),y.useEffect(()=>{i.current&&Array.from(i.current.children).forEach(k=>{const b=k,x=b.getAttribute("data-clip-id"),f=p.find(h=>h.id===x);if(f){const h=e-f.start+f.offset;Math.abs(b.currentTime-h)>.3&&(b.currentTime=h),o&&b.paused?b.play().catch(()=>{}):!o&&!b.paused&&b.pause()}})},[e,p,o]);const w=k=>{if(o){const b=(k-c.current)/1e3,x=Math.min(b,.1);r(f=>f+x)}c.current=k,l.current=requestAnimationFrame(w)};return y.useEffect(()=>(c.current=performance.now(),l.current=requestAnimationFrame(w),()=>{l.current&&cancelAnimationFrame(l.current)}),[o]),n.jsxs("div",{ref:s,className:"w-full h-full bg-black flex items-center justify-center overflow-hidden relative",children:[d?d.type==="video"?n.jsx("video",{ref:a,src:d.src,className:"max-w-full max-h-full object-contain",muted:!0,playsInline:!0}):n.jsx("img",{src:d.src,alt:"preview",className:"max-w-full max-h-full object-contain"}):n.jsx("div",{className:"text-gray-600 text-xs",children:"No Visual Signal"}),n.jsx("div",{ref:i,className:"hidden",children:p.map(k=>n.jsx("audio",{"data-clip-id":k.id,src:k.src},k.id))}),n.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/60 px-2 py-1 rounded text-white text-xs font-mono pointer-events-none z-10",children:[e.toFixed(2),"s"]})]})},Mj=({type:e})=>{switch(e){case"folder":return n.jsx("svg",{className:"w-5 h-5 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:n.jsx("path",{d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})});case"image":return n.jsx("svg",{className:"w-5 h-5 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})});case"video":return n.jsx("svg",{className:"w-5 h-5 text-purple-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})});case"audio":return n.jsx("svg",{className:"w-5 h-5 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})});default:return n.jsx("svg",{className:"w-5 h-5 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}},Lj=({className:e})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),Dj=({files:e,currentFolderId:t,viewMode:o,onUpload:r,onDragStart:a,onDelete:i,onNavigate:s,onCreateFolder:l,onRename:c,onToggleView:d})=>{const u=y.useRef(null),[p,m]=y.useState(null),[w,k]=y.useState(""),b=y.useMemo(()=>e.filter(_=>_.parentId===t).sort((_,E)=>_.type==="folder"&&E.type!=="folder"?-1:_.type!=="folder"&&E.type==="folder"?1:_.name.localeCompare(E.name)),[e,t]),x=y.useMemo(()=>{const _=[];let E=t;for(;E;){const I=e.find(B=>B.id===E);I?(_.unshift({id:I.id,name:I.name}),E=I.parentId):E=null}return[{id:null,name:"Root"},..._]},[t,e]),f=()=>{if(!t)return;const _=e.find(E=>E.id===t);s(_?_.parentId:null)},h=_=>{_.isLinked||(m(_.id),k(_.name))},v=()=>{p&&w.trim()&&c(p,w.trim()),m(null)},N=_=>{_.type==="folder"&&s(_.id)};return n.jsxs("div",{className:"flex flex-col h-full bg-gray-800",children:[n.jsxs("div",{className:"flex items-center justify-between p-1 border-b border-gray-700 bg-gray-900/50",children:[n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx("button",{onClick:f,disabled:!t,className:"p-1 hover:bg-gray-700 rounded text-gray-400 disabled:opacity-30 transition-colors",title:"Up",children:n.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})})}),n.jsx("div",{className:"h-4 w-px bg-gray-700 mx-1"}),n.jsx("button",{onClick:l,className:"p-1 hover:bg-gray-700 rounded text-yellow-500 hover:text-yellow-400",title:"New Folder",children:n.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:n.jsx("path",{d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})})}),n.jsx("button",{onClick:()=>{var _;return(_=u.current)==null?void 0:_.click()},className:"p-1 hover:bg-gray-700 rounded text-cyan-400 hover:text-cyan-300",title:"Import",children:n.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0l-4 4m4 4V4"})})})]}),n.jsx("button",{onClick:d,className:"p-1 hover:bg-gray-700 rounded text-gray-400 hover:text-white",title:"Toggle View",children:o==="grid"?n.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})}):n.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),n.jsx("input",{ref:u,type:"file",multiple:!0,accept:"image/*,video/*,audio/*",className:"hidden",onChange:_=>{_.target.files&&r(_.target.files),_.target.value=""}})]}),n.jsx("div",{className:"px-2 py-1 bg-gray-900 border-b border-gray-700 text-xs text-gray-400 flex items-center overflow-x-auto whitespace-nowrap scrollbar-none",children:x.map((_,E)=>n.jsxs(At.Fragment,{children:[n.jsx("span",{className:"hover:text-white cursor-pointer hover:underline",onClick:()=>s(_.id),children:_.name}),E<x.length-1&&n.jsx("span",{className:"mx-1 text-gray-600",children:"/"})]},_.id||"root"))}),n.jsx("div",{className:`flex-1 overflow-y-auto p-2 custom-scrollbar ${o==="grid"?"flex flex-wrap content-start gap-2":"flex flex-col space-y-1"}`,children:b.length===0?n.jsxs("div",{className:"col-span-full w-full h-32 flex flex-col items-center justify-center text-gray-500 text-xs italic",children:[n.jsx("span",{children:"Empty Folder"}),n.jsx("span",{className:"opacity-50 mt-1",children:"Drop files here"})]}):b.map(_=>n.jsxs("div",{className:`
                                group relative border border-gray-700 rounded hover:bg-gray-700/50 hover:border-gray-500 transition-colors overflow-hidden
                                ${o==="grid"?"flex flex-col w-24 h-24":"flex items-center h-8 px-2 w-full"}
                            `,draggable:_.type!=="folder"&&!!_.src,onDragStart:E=>a(E,_),onDoubleClick:()=>N(_),children:[n.jsxs("div",{className:`${o==="grid"?"flex-1 w-full bg-black/40 overflow-hidden flex items-center justify-center relative":"w-5 h-5 flex-shrink-0 mr-2 relative"}`,children:[_.thumbnail?n.jsx("img",{src:_.thumbnail,className:"w-full h-full object-cover opacity-80 group-hover:opacity-100",alt:"thumb"}):(_.type==="image"||_.type==="text"&&_.src.startsWith("data:image"))&&_.src?n.jsx("img",{src:_.src,className:"w-full h-full object-cover opacity-80 group-hover:opacity-100",alt:"thumb"}):n.jsx(Mj,{type:_.type}),_.isLinked&&n.jsx("div",{className:"absolute top-0 right-0 bg-cyan-600/80 p-0.5 rounded-bl-md z-10 shadow-sm pointer-events-none",children:n.jsx(Lj,{className:"w-2.5 h-2.5 text-white"})})]}),n.jsx("div",{className:`${o==="grid"?"h-7 px-1 flex items-center bg-gray-800 border-t border-gray-700":"flex-grow min-w-0"}`,children:p===_.id?n.jsx("input",{type:"text",value:w,onChange:E=>k(E.target.value),onBlur:v,onKeyDown:E=>{E.key==="Enter"&&v()},onDoubleClick:E=>E.stopPropagation(),className:"w-full bg-gray-900 text-white text-[10px] px-1 rounded border border-blue-500 outline-none",autoFocus:!0}):n.jsx("span",{className:`text-[10px] truncate cursor-text w-full block ${_.isLinked?"text-cyan-200":"text-gray-300"}`,title:_.name,onClick:E=>{E.stopPropagation(),h(_)},children:_.name})}),!_.isLinked&&n.jsx("button",{onClick:E=>{E.stopPropagation(),i(_.id)},className:`
                                        text-gray-500 hover:text-red-400 transition-colors
                                        ${o==="grid"?"absolute top-1 right-1 bg-black/50 rounded p-0.5 opacity-0 group-hover:opacity-100":"ml-2 opacity-0 group-hover:opacity-100"}
                                    `,children:n.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},_.id))})]})},zj=e=>{const[t,o]=y.useState({}),r=y.useRef(new Set);return y.useEffect(()=>{const a=async()=>{const i={};let s=!1;const l=window.AudioContext||window.webkitAudioContext,c=new l;for(const d of e)if(!(d.type!=="audio"&&d.type!=="video"||t[d.id]||r.current.has(d.id))){r.current.add(d.id);try{const p=await(await fetch(d.src)).arrayBuffer(),w=(await c.decodeAudioData(p)).getChannelData(0);i[d.id]=w,s=!0}catch(u){console.error(`Failed to decode audio for clip ${d.id}`,u)}}s&&o(d=>({...d,...i})),c.state!=="closed"&&c.close()};e.length>0&&a()},[e,t]),t},_0={currentTime:0,totalDuration:30,clips:[],tracks:[{id:2,name:"V2",type:"video",isMuted:!1,isVisible:!0},{id:1,name:"V1",type:"video",isMuted:!1,isVisible:!0},{id:101,name:"A1",type:"audio",isMuted:!1,isVisible:!0}],mediaFiles:[],isPlaying:!1,zoom:20,selectedClipId:null,scrollLeft:0,mediaPanelWidth:240,currentFolderId:null,viewMode:"grid"},qj=180,Oj=600,Fj=({node:e,onValueChange:t,t:o,deselectAllNodes:r,getUpstreamNodeValues:a,isSelected:i,onSelectNode:s})=>{const l=y.useRef(null),c=y.useRef(null),d=y.useMemo(()=>{try{return{..._0,...JSON.parse(e.value||"{}")}}catch{return _0}},[e.value]),u=y.useCallback(D=>{const T={...d,...D};t(e.id,JSON.stringify(T))},[d,e.id,t]),[p,m]=y.useState(d.currentTime),[w,k]=y.useState(!1),b=zj(d.clips);y.useEffect(()=>{m(d.currentTime)},[d.currentTime]),y.useEffect(()=>{if(!a)return;const D=a(e.id,"video"),T=a(e.id,"audio"),F=a(e.id,"image"),te=a(e.id,"text"),$=d.mediaFiles.filter(Z=>!Z.isLinked),Y=[],oe=[{type:"video",data:D,folderName:"Video Inputs"},{type:"audio",data:T,folderName:"Audio Inputs"},{type:"image",data:F,folderName:"Image Inputs"},{type:"text",data:te,folderName:"Text Inputs"}],le=Z=>Z.replace(/[<>&'"]/g,se=>{switch(se){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;";default:return se}});oe.forEach(({type:Z,data:se,folderName:de})=>{if(se.length>0){const re=`folder-linked-${Z}`;Y.push({id:re,type:"folder",src:"",name:de,parentId:null,isLinked:!0}),se.forEach((R,J)=>{let H="";if(R&&typeof R=="object"&&R.base64ImageData)H=`data:${R.mimeType};base64,${R.base64ImageData}`;else if(typeof R=="string")if(Z==="text"){const ee=`<svg xmlns="http://www.w3.org/2000/svg" width="800" height="200" style="background:black;"><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="white" font-family="sans-serif" font-size="40">${le(R)}</text></svg>`;H=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(ee)}`}else(R.startsWith("data:")||R.startsWith("http")||R.startsWith("blob:"))&&(H=R);Y.push({id:`linked-${Z}-${J}`,type:Z,src:H,name:H?`${Z.charAt(0).toUpperCase()+Z.slice(1)} ${J+1}`:`Empty ${Z} Slot ${J+1}`,parentId:re,isLinked:!0})})}});const K=d.mediaFiles.filter(Z=>Z.isLinked);if(Y.length!==K.length||Y.some((Z,se)=>{var de,re;return Z.id!==((de=K[se])==null?void 0:de.id)||Z.src!==((re=K[se])==null?void 0:re.src)})){let Z=d.currentFolderId;Z&&Z.startsWith("folder-linked-")&&(Y.find(se=>se.id===Z)||(Z=null)),u({mediaFiles:[...$,...Y],currentFolderId:Z})}},[a,e.id,d.mediaFiles,d.currentFolderId]);const x=y.useCallback(()=>{const D=!w;k(D),D||u({currentTime:p,isPlaying:!1})},[w,p,u]),f=D=>{m(D),w||u({currentTime:D})},h=D=>{m(T=>{const F=D(T);return F>=d.totalDuration?(k(!1),d.totalDuration):F})},v=D=>{const T=D==="in"?d.zoom*1.2:d.zoom/1.2;u({zoom:Math.max(5,Math.min(200,T))})},N=async D=>new Promise(T=>{const F=document.createElement("video");F.preload="metadata",F.src=URL.createObjectURL(D),F.muted=!0,F.playsInline=!0,F.currentTime=1,F.onloadeddata=()=>{const te=document.createElement("canvas");te.width=160,te.height=90;const $=te.getContext("2d");$==null||$.drawImage(F,0,0,160,90);const Y=te.toDataURL("image/jpeg",.7);T(Y),URL.revokeObjectURL(F.src)},F.onerror=()=>{T("")}}),_=async D=>{const T=[];for(const F of Array.from(D)){const te=URL.createObjectURL(F);let $="image",Y;if(F.type.startsWith("video/")){$="video";try{Y=await N(F)}catch(oe){console.error("Thumbnail generation failed",oe)}}else if(F.type.startsWith("audio/"))$="audio";else if(F.type.startsWith("image/")){$="image";try{Y=await Ot(te,160,160)}catch{}}T.push({id:`media-${Date.now()}-${Math.random()}`,type:$,src:te,name:F.name,parentId:d.currentFolderId,thumbnail:Y,isLinked:!1})}u({mediaFiles:[...d.mediaFiles,...T]})},E=D=>{const T=d.mediaFiles.find($=>$.id===D);if(T!=null&&T.isLinked)return;const F=new Set,te=$=>{F.add($),d.mediaFiles.filter(Y=>Y.parentId===$).forEach(Y=>te(Y.id))};te(D),u({mediaFiles:d.mediaFiles.filter($=>!F.has($.id))})},I=()=>{const D={id:`folder-${Date.now()}`,type:"folder",src:"",name:"New Folder",parentId:d.currentFolderId,isLinked:!1};u({mediaFiles:[...d.mediaFiles,D]})},B=D=>{u({currentFolderId:D})},M=(D,T)=>{const F=d.mediaFiles.find(te=>te.id===D);F!=null&&F.isLinked||u({mediaFiles:d.mediaFiles.map(te=>te.id===D?{...te,name:T}:te)})},G=()=>{u({viewMode:d.viewMode==="grid"?"list":"grid"})},V=(D,T)=>{T.type!=="folder"&&T.src&&(D.dataTransfer.setData("application/video-editor-media",JSON.stringify(T)),D.dataTransfer.effectAllowed="copy")},j=D=>{D.preventDefault(),D.stopPropagation(),c.current={x:D.clientX,startWidth:d.mediaPanelWidth},window.addEventListener("mousemove",P),window.addEventListener("mouseup",S)},P=D=>{if(!c.current)return;const T=D.clientX-c.current.x,F=Math.max(qj,Math.min(Oj,c.current.startWidth+T));l.current&&u({mediaPanelWidth:F})},S=()=>{c.current=null,window.removeEventListener("mousemove",P),window.removeEventListener("mouseup",S)},A=D=>{D.preventDefault(),D.stopPropagation();const T=D.dataTransfer.getData("application/video-editor-media");if(T){const F=JSON.parse(T);O(F,D.clientX)}else D.dataTransfer.files.length>0&&_(D.dataTransfer.files)},O=(D,T)=>{var oe,le;const F=D.type==="audio"?((oe=d.tracks.find(K=>K.type==="audio"))==null?void 0:oe.id)||101:((le=d.tracks.find(K=>K.type==="video"))==null?void 0:le.id)||1,te=D.type==="text"?"image":D.type,$=p,Y={id:`clip-${Date.now()}-${Math.random()}`,type:te,src:D.src,start:$,duration:D.type==="image"||D.type==="text"?5:10,offset:0,layer:F,name:D.name,thumbnail:D.thumbnail};u({clips:[...d.clips,Y]})},z=D=>{u({selectedClipId:D})},L=()=>{d.selectedClipId&&u({clips:d.clips.filter(D=>D.id!==d.selectedClipId),selectedClipId:null})},W=D=>{D.stopPropagation(),s&&s()};return y.useEffect(()=>{if(!i)return;const D=T=>{if(T.code==="Space"){const F=T.target;if(F.tagName==="INPUT"||F.tagName==="TEXTAREA"||F.isContentEditable)return;T.preventDefault(),T.stopPropagation(),x()}};return window.addEventListener("keydown",D),()=>window.removeEventListener("keydown",D)},[i,x]),n.jsxs("div",{ref:l,className:"flex flex-col w-full h-full bg-gray-900 text-white rounded-lg overflow-hidden",onMouseDown:W,onWheel:D=>D.stopPropagation(),onDragOver:D=>{D.preventDefault(),D.stopPropagation()},onDrop:A,children:[n.jsxs("div",{className:"flex-1 flex min-h-0",children:[n.jsxs("div",{style:{width:d.mediaPanelWidth},className:"flex-shrink-0 flex flex-col relative border-r border-gray-700",children:[n.jsx(Dj,{files:d.mediaFiles,currentFolderId:d.currentFolderId,viewMode:d.viewMode,onUpload:_,onDragStart:V,onDelete:E,onNavigate:B,onCreateFolder:I,onRename:M,onToggleView:G}),n.jsx("div",{className:"absolute top-0 bottom-0 right-[-4px] w-2 cursor-col-resize z-10 hover:bg-cyan-500/50 transition-colors",onMouseDown:j})]}),n.jsx("div",{className:"flex-1 bg-black relative",children:n.jsx(Rj,{currentTime:p,clips:d.clips,isPlaying:w,onTimeUpdate:h})}),n.jsxs("div",{className:"w-48 bg-gray-800 p-2 flex flex-col space-y-2 border-l border-gray-700 flex-shrink-0",children:[n.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase",children:"Properties"}),d.selectedClipId?n.jsxs("div",{className:"text-xs space-y-2",children:[n.jsx("p",{className:"text-gray-300",children:"Selected Clip"}),n.jsx("div",{className:"h-px bg-gray-700 w-full"}),n.jsx("button",{onClick:L,className:"w-full bg-red-600 hover:bg-red-700 px-2 py-1 rounded text-white transition-colors",children:"Delete Clip"})]}):n.jsx("p",{className:"text-xs text-gray-500",children:"No clip selected"})]})]}),n.jsxs("div",{className:"h-10 bg-gray-800 border-t border-gray-700 flex items-center px-4 justify-between shrink-0",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("button",{onClick:()=>f(0),className:"text-gray-400 hover:text-white",children:"|<"}),n.jsx("button",{onClick:x,className:`w-8 h-8 rounded-full flex items-center justify-center ${w?"bg-red-600 hover:bg-red-700":"bg-cyan-600 hover:bg-cyan-700"} text-white transition-colors`,children:w?n.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})}):n.jsx("svg",{className:"w-4 h-4 ml-0.5",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{d:"M8 5v14l11-7z"})})})]}),n.jsxs("div",{className:"font-mono text-sm text-cyan-400",children:[p.toFixed(2),"s / ",d.totalDuration,"s"]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("button",{onClick:()=>v("out"),className:"text-gray-400 hover:text-white text-xs bg-gray-700 px-2 py-1 rounded",children:"- Zoom"}),n.jsx("button",{onClick:()=>v("in"),className:"text-gray-400 hover:text-white text-xs bg-gray-700 px-2 py-1 rounded",children:"+ Zoom"})]})]}),n.jsx("div",{className:"h-56 flex-shrink-0",children:n.jsx(Aj,{tracks:d.tracks,clips:d.clips,currentTime:p,duration:d.totalDuration,zoom:d.zoom,onSeek:f,scrollLeft:d.scrollLeft,onScroll:D=>u({scrollLeft:D}),onClipSelect:z,selectedClipId:d.selectedClipId,audioDataMap:b})})]})},Bj=(e,t,o)=>{const r=y.useRef(null),a=Kt(),i=a==null?void 0:a.setGlobalMedia,s=a==null?void 0:a.globalMedia,l=T=>{try{const F=JSON.parse(T||"{}");return{src:F.src||"",type:F.type||"video",name:F.name||"",currentTime:F.currentTime||0,volume:F.volume!==void 0?F.volume:.4,isPlaying:F.isPlaying||!1,markers:F.markers||[]}}catch{return{src:"",type:"video",name:"",markers:[],volume:.4}}},[c,d]=y.useState(()=>{const T=l(t);return a!=null&&a.globalMedia&&a.globalMedia.nodeId===e?{...T,currentTime:a.globalMedia.currentTime,isPlaying:a.globalMedia.isPlaying}:T}),u=y.useRef(c);y.useEffect(()=>{u.current=c},[c]);const{isPlaying:p,currentTime:m,volume:w,markers:k,src:b,type:x,name:f}=c,[h,v]=y.useState(0),N=y.useRef(!1),_=y.useCallback(T=>{d(F=>{let te={};r.current&&(te={currentTime:r.current.currentTime,volume:r.current.volume,isPlaying:T.isPlaying!==void 0?T.isPlaying:!r.current.paused});const $={...F,...te,...T};return o(e,JSON.stringify($)),i&&($.isPlaying||F.isPlaying)&&i(Y=>{var oe;return{nodeId:e,name:$.name||"Media",isPlaying:!!$.isPlaying,currentTime:$.currentTime||0,duration:((oe=r.current)==null?void 0:oe.duration)||0,volume:$.volume||.4,type:$.type||"video",command:void 0,commandTimestamp:void 0}}),$})},[e,o,i]),E=y.useCallback(()=>{r.current&&(r.current.pause(),_({isPlaying:!1}))},[_]);y.useEffect(()=>{s&&s.nodeId!==e&&s.isPlaying&&p&&E()},[s,e,p,E]),y.useEffect(()=>{s&&s.nodeId===e&&s.command&&r.current&&(s.command==="play"?r.current.paused&&(r.current.play().catch(T=>console.error(T)),d(T=>({...T,isPlaying:!0}))):s.command==="pause"?r.current.paused||(r.current.pause(),d(T=>({...T,isPlaying:!1})),_({isPlaying:!1})):s.command==="seek"&&s.seekTarget!==void 0&&(r.current.currentTime=s.seekTarget,I(s.seekTarget)))},[s,e,_]),y.useEffect(()=>{const T=l(t),F=(s==null?void 0:s.nodeId)===e;if(T.src!==b){d(te=>({...te,src:T.src,name:T.name,type:T.type,currentTime:0,isPlaying:!!T.isPlaying})),r.current&&(r.current.pause(),r.current.currentTime=0),F&&i&&i(null);return}if(F){JSON.stringify(T.markers)!==JSON.stringify(k)&&d(te=>({...te,markers:T.markers||[]}));return}T.currentTime>.1&&Math.abs(T.currentTime-m)>.5&&!N.current&&(I(T.currentTime),r.current&&Math.abs(r.current.currentTime-T.currentTime)>.5&&(r.current.currentTime=T.currentTime)),JSON.stringify(T.markers)!==JSON.stringify(k)&&d(te=>({...te,markers:T.markers||[]})),T.volume!==void 0&&Math.abs(T.volume-(w||.4))>.01&&(B(T.volume),r.current&&(r.current.volume=T.volume)),T.isPlaying!==p&&(T.isPlaying?M():E())},[t,s==null?void 0:s.nodeId,e,b,m,p,w,k,i]);const I=T=>d(F=>({...F,currentTime:T})),B=T=>d(F=>({...F,volume:T})),M=y.useCallback(async()=>{if(r.current)try{await r.current.play(),_({isPlaying:!0})}catch(T){console.error(T),_({isPlaying:!1})}},[_]),G=y.useCallback(()=>{p?E():M()},[p,M,E]),V=y.useCallback(()=>{r.current&&(r.current.pause(),r.current.currentTime=0,I(0),_({isPlaying:!1,currentTime:0}))},[_]),j=y.useCallback(T=>{N.current=!0,r.current&&(r.current.currentTime=T,I(T)),setTimeout(()=>{N.current=!1},500)},[]),P=y.useCallback(T=>{r.current&&(r.current.volume=T),B(T),_({volume:T})},[_]),S=y.useCallback(()=>{const T={id:`marker-${Date.now()}`,time:m||0,label:`Marker ${(k||[]).length+1}`,color:"#3b82f6"},F=[...k||[],T].sort((te,$)=>te.time-$.time);_({markers:F})},[m,k,_]),A=y.useCallback((T,F)=>{const te=(k||[]).map($=>$.id===T?{...$,...F}:$);_({markers:te})},[k,_]),O=y.useCallback(T=>{const F=(k||[]).filter(te=>te.id!==T);_({markers:F})},[k,_]),z=y.useCallback(()=>{_({markers:[]})},[_]),L=y.useCallback(()=>{if(r.current&&!N.current){const T=r.current.currentTime;I(T),(s==null?void 0:s.nodeId)===e&&i&&i(F=>F?{...F,currentTime:T,command:void 0,commandTimestamp:void 0}:null)}},[s==null?void 0:s.nodeId,e,i]),W=y.useCallback(()=>{if(r.current){v(r.current.duration);const T=u.current;r.current.volume=T.volume!==void 0?T.volume:.4,T.currentTime>0&&Math.abs(r.current.currentTime-T.currentTime)>.5&&(r.current.currentTime=T.currentTime),T.isPlaying&&M()}},[M]),D=y.useCallback(()=>{_({isPlaying:!1,currentTime:0}),r.current&&(r.current.currentTime=0),I(0)},[_]);return{mediaRef:r,isPlaying:!!p,currentTime:m||0,duration:h,volume:w!==void 0?w:.4,markers:k||[],togglePlay:G,stop:V,seek:j,changeVolume:P,addMarker:S,updateMarker:A,deleteMarker:O,deleteAllMarkers:z,handleTimeUpdate:L,handleLoadedMetadata:W,handleEnded:D}},Hj=(e,t,o)=>{const r=y.useRef(null),a=y.useRef(null),i=y.useRef(null);return y.useEffect(()=>t!=="audio"||!e||!o?void 0:((()=>{if(r.current)r.current.state==="suspended"&&r.current.resume();else{const l=window.AudioContext||window.webkitAudioContext,c=new l,d=c.createAnalyser();d.fftSize=256;try{c.createMediaElementSource(o).connect(d),d.connect(c.destination),r.current=c,a.current=d}catch{}}})(),()=>{r.current&&r.current.state!=="closed"&&(r.current.close(),r.current=null,a.current=null)}),[e,t,o]),y.useEffect(()=>{if(t!=="audio"||!e){i.current=null;return}(async()=>{try{const c=await(await fetch(e)).arrayBuffer(),u=await new(window.AudioContext||window.webkitAudioContext)().decodeAudioData(c);i.current=u.getChannelData(0)}catch(l){console.warn("Failed to generate waveform data",l)}})()},[e,t]),{audioContextRef:r,analyserRef:a,audioDataRef:i}},S0=e=>{const t=Math.floor(e/60),o=Math.floor(e%60);return`${t}:${o.toString().padStart(2,"0")}`},Es=(e,t)=>("000"+e).slice(t*-1),N0=e=>{const t=Math.floor(e/3600),o=Math.floor(e%3600/60),r=Math.floor(e%60),a=Math.floor(e%1*1e3);return`${Es(t,2)}:${Es(o,2)}:${Es(r,2)},${Es(a,3)}`},Gj=({marker:e,onUpdate:t,onDelete:o,onClose:r,initialPosition:a})=>{const[i,s]=y.useState(e.label),[l,c]=y.useState(e.color),d=["#22d3ee","#facc15","#ef4444","#3b82f6","#10b981","#a855f7","#f97316","#ffffff"],[u,p]=y.useState(a),m=y.useRef(null),w=h=>{h.preventDefault(),h.stopPropagation(),m.current={x:h.clientX-u.x,y:h.clientY-u.y},window.addEventListener("mousemove",k),window.addEventListener("mouseup",b)},k=h=>{m.current&&p({x:h.clientX-m.current.x,y:h.clientY-m.current.y})},b=()=>{m.current=null,window.removeEventListener("mousemove",k),window.removeEventListener("mouseup",b)},x=()=>{t(e.id,{label:i,color:l}),r()},f=()=>{o(e.id),r()};return Va.createPortal(n.jsxs("div",{className:"fixed z-[9999] bg-gray-800 border border-gray-600 rounded-lg shadow-2xl p-2 flex flex-col gap-2 w-56",style:{left:u.x,top:u.y},onMouseDown:h=>h.stopPropagation(),children:[n.jsxs("div",{className:"flex justify-between items-center border-b border-gray-700 pb-1 mb-1 cursor-move select-none",onMouseDown:w,children:[n.jsx("span",{className:"text-xs font-bold text-gray-300",children:"Edit Marker"}),n.jsx("button",{onClick:r,className:"text-gray-500 hover:text-white",title:"Cancel",onMouseDown:h=>h.stopPropagation(),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),n.jsx("input",{type:"text",value:i,onChange:h=>s(h.target.value),className:"bg-gray-900 border border-gray-600 rounded px-2 py-1 text-xs text-white focus:outline-none focus:border-cyan-500 w-full",placeholder:"Marker Name"}),n.jsx("div",{className:"flex gap-1 justify-between",children:d.map(h=>n.jsx("button",{onClick:()=>c(h),className:`w-4 h-4 rounded-full border ${l===h?"border-white scale-110":"border-transparent hover:scale-110"}`,style:{backgroundColor:h}},h))}),n.jsxs("div",{className:"flex justify-between items-center mt-1 pt-2 border-t border-gray-700",children:[n.jsx("button",{onClick:f,className:"p-1 text-red-400 hover:text-red-200 hover:bg-red-900/30 rounded transition-colors",title:"Delete Marker",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})}),n.jsxs("button",{onClick:x,className:"px-3 py-1 bg-cyan-600 hover:bg-cyan-700 text-white text-xs font-bold rounded transition-colors flex items-center gap-1",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Apply"]})]})]}),document.body)},Uj=({isPlaying:e,currentTime:t,duration:o,volume:r,markers:a,onTogglePlay:i,onStop:s,onSeek:l,onVolumeChange:c,onClear:d,onAddMarker:u,onUpdateMarker:p,onDeleteMarker:m,onDeleteAllMarkers:w,onSaveMarkers:k,onLoadMarkers:b,onSelect:x,disabled:f,t:h})=>{const v=y.useRef(null),[N,_]=y.useState(null),[E,I]=y.useState(null),B=a.find(j=>j.id===N),M=(j,P)=>{j.stopPropagation(),l(P.time)},G=(j,P)=>{j.stopPropagation();const S=j.target.getBoundingClientRect();I({x:S.left,y:S.top-160}),_(P)},V=()=>{if(a.length===0)return;const j=[...a].sort((z,L)=>z.time-L.time);let P="";j.forEach((z,L)=>{const W=N0(z.time),D=N0(z.time+1);P+=`${L+1}
${W} --> ${D}
${z.label}

`});const S=new Blob([P],{type:"text/plain"}),A=URL.createObjectURL(S),O=document.createElement("a");O.href=A,O.download=`markers_${new Date().toISOString().slice(0,10)}.srt`,O.click(),URL.revokeObjectURL(A)};return n.jsxs("div",{className:"flex-shrink-0 bg-gray-800 border-t border-gray-700 flex flex-col gap-1 relative z-30",onMouseDown:j=>{j.stopPropagation(),x&&x()},children:[N&&B&&E&&n.jsx(Gj,{marker:B,onUpdate:p,onDelete:j=>{m(j),_(null)},onClose:()=>_(null),initialPosition:E}),n.jsxs("div",{className:"flex items-center relative group w-full pt-1",children:[n.jsxs("div",{className:"flex-grow relative h-4 flex items-center mx-1",ref:v,children:[o>0&&a.map(j=>{const P=j.time/o*100;return n.jsxs("div",{className:"absolute top-0 w-4 h-4 -ml-2 cursor-pointer z-10 group/marker flex flex-col items-center hover:z-20",style:{left:`${P}%`},onClick:S=>M(S,j),children:[n.jsx("div",{className:"w-0.5 h-full bg-white/50 group-hover/marker:bg-white pointer-events-none"}),n.jsx("div",{className:"w-2.5 h-2.5 rounded-full absolute top-1/2 -translate-y-1/2 shadow-sm border border-black/50 transition-transform group-hover/marker:scale-125",style:{backgroundColor:j.color}}),N!==j.id&&n.jsxs("div",{className:"absolute bottom-full mb-1 flex flex-col items-center gap-1 opacity-0 group-hover/marker:opacity-100 transition-opacity",children:[n.jsx("div",{className:"bg-black/80 text-white text-[9px] px-1 rounded whitespace-nowrap pointer-events-none mb-0.5",children:j.label}),n.jsx("button",{onClick:S=>G(S,j.id),className:"px-2 py-0.5 bg-gray-700 hover:bg-cyan-600 text-white text-[9px] rounded shadow border border-gray-500 hover:border-cyan-400 pointer-events-auto",children:"Edit"})]})]},j.id)}),n.jsx("input",{type:"range",min:"0",max:o||100,value:t,onChange:j=>l(parseFloat(j.target.value)),disabled:f,className:"w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-500 relative z-0"})]}),n.jsxs("span",{className:"text-[10px] text-gray-400 font-mono whitespace-nowrap min-w-[70px] text-right pr-2",children:[S0(t)," / ",S0(o)]})]}),n.jsxs("div",{className:"relative flex items-center justify-center px-1 h-8 mb-1",children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx(mt,{content:h("node.mediaViewer.stop"),children:n.jsx("button",{onClick:s,disabled:f,className:"p-1.5 rounded-full text-gray-400 hover:text-white hover:bg-red-600 transition-colors disabled:opacity-50","aria-label":h("node.mediaViewer.stop"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("rect",{x:"5",y:"5",width:"10",height:"10"})})})}),n.jsx(mt,{content:h(e?"node.mediaViewer.pause":"node.mediaViewer.play"),children:n.jsx("button",{onClick:i,disabled:f,className:"flex items-center justify-center w-8 h-8 rounded bg-cyan-600 hover:bg-cyan-700 text-white transition-colors disabled:bg-gray-700 disabled:text-gray-500","aria-label":h(e?"node.mediaViewer.pause":"node.mediaViewer.play"),children:e?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 ml-0.5",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:"M8 5v14l11-7z"})})})}),n.jsx(mt,{content:h("node.mediaViewer.addMarker"),children:n.jsx("button",{onClick:u,disabled:f,className:"p-1.5 rounded-full text-gray-400 hover:text-blue-400 hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":h("node.mediaViewer.addMarker"),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})})})]}),n.jsxs("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 flex items-center space-x-1 pr-1",children:[n.jsx(mt,{content:h("node.mediaViewer.saveMarkers"),children:n.jsx("button",{onClick:k,className:"p-1.5 rounded-full text-gray-400 hover:text-cyan-400 hover:bg-gray-700 transition-colors cursor-pointer","aria-label":h("node.mediaViewer.saveMarkers"),disabled:f||a.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})}),n.jsx(mt,{content:h("node.mediaViewer.loadMarkers"),children:n.jsx("button",{onClick:b,className:"p-1.5 rounded-full text-gray-400 hover:text-emerald-400 hover:bg-gray-700 transition-colors cursor-pointer","aria-label":h("node.mediaViewer.loadMarkers"),disabled:f,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0l-4 4m4-4v12"})})})}),n.jsx(mt,{content:h("node.mediaViewer.exportSRT"),children:n.jsx("button",{onClick:V,className:"p-1.5 rounded-full text-gray-400 hover:text-purple-400 hover:bg-gray-700 transition-colors cursor-pointer","aria-label":h("node.mediaViewer.exportSRT"),disabled:f||a.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})}),n.jsx(mt,{content:h("node.mediaViewer.deleteAllMarkers"),children:n.jsx("button",{onClick:w,className:"p-1.5 rounded-full text-gray-400 hover:text-red-400 hover:bg-gray-700 transition-colors cursor-pointer","aria-label":h("node.mediaViewer.deleteAllMarkers"),disabled:f||a.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]})]})]})},Vj=({audioData:e,currentTime:t,duration:o,isPlaying:r,onSeek:a,markers:i,onSelect:s})=>{const l=y.useRef(null),c=y.useRef(null),d=y.useRef(a),u=y.useRef(i),p=y.useRef(!1);y.useEffect(()=>{d.current=a},[a]),y.useEffect(()=>{u.current=i},[i]);const m=y.useCallback(()=>{const f=l.current,h=c.current,v=e;if(!f||!h||!v)return;const N=f.getContext("2d");if(!N)return;const _=h.getBoundingClientRect(),E=_.width,I=_.height,B=window.devicePixelRatio||1;(f.width!==E*B||f.height!==I*B)&&(f.width=E*B,f.height=I*B),N.resetTransform(),N.scale(B,B),N.clearRect(0,0,E,I);const M=3,V=M+1,j=Math.floor(E/V),P=Math.floor(v.length/j),S=o>0?t/o:0,A=Math.floor(j*S);N.beginPath();for(let L=0;L<j;L++){let W=P*L,D=0;const T=Math.ceil(P/10);let F=0;for(let le=0;le<P;le+=T)W+le<v.length&&(D+=Math.abs(v[W+le]),F++);const te=F>0?D/F:0,$=Math.min(I,Math.max(2,te*I*2.5)),Y=L*V,oe=I-$;N.fillStyle=L<A?"#22d3ee":"#4b5563",N.fillRect(Y,oe,M,$)}const O=u.current;o>0&&O&&(N.font="bold 10px sans-serif",N.textAlign="center",N.textBaseline="top",O.forEach(L=>{const W=Math.round(L.time/o*E);N.beginPath(),N.strokeStyle=L.color,N.lineWidth=2,N.moveTo(W,0),N.lineTo(W,I),N.stroke(),N.beginPath(),N.fillStyle=L.color,N.arc(W,I-6,3,0,Math.PI*2),N.fill();const D=N.measureText(L.label).width,T=Math.round(W-D/2-2),F=2,te=Math.round(D+4),$=14;N.fillStyle="rgba(0,0,0,0.7)",N.fillRect(T,F,te,$),N.fillStyle=L.color,N.fillText(L.label,W,4)}));const z=Math.round(E*S);N.fillStyle="#ffffff",N.fillRect(z-1,0,2,I)},[e,t,o]);y.useEffect(()=>{let f;const h=()=>{m(),(r||p.current)&&(f=requestAnimationFrame(h))};return m(),r&&(f=requestAnimationFrame(h)),()=>{f&&cancelAnimationFrame(f)}},[m,r]),y.useEffect(()=>{if(!c.current)return;const f=new ResizeObserver(()=>requestAnimationFrame(m));return f.observe(c.current),()=>f.disconnect()},[m]);const w=f=>{if(!c.current||!o)return;const h=c.current.getBoundingClientRect(),v=f-h.left,N=Math.max(0,Math.min(1,v/h.width));d.current(N*o)},k=y.useCallback(f=>{f.preventDefault(),f.stopPropagation(),s&&s(),p.current=!0,w(f.clientX),window.addEventListener("mousemove",b),window.addEventListener("mouseup",x)},[s,o]),b=y.useCallback(f=>{p.current&&(f.preventDefault(),w(f.clientX))},[o]),x=y.useCallback(()=>{p.current=!1,window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",x)},[b]);return y.useEffect(()=>()=>{window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",x)},[b,x]),n.jsx("div",{ref:c,className:"absolute inset-0 w-full h-full cursor-pointer",onMouseDown:k,children:n.jsx("canvas",{ref:l,className:"w-full h-full object-cover block"})})},Wj=({analyser:e,isPlaying:t})=>{const o=y.useRef(null),r=y.useRef(null);return y.useEffect(()=>{if(!t||!e){r.current&&cancelAnimationFrame(r.current);return}const a=()=>{const i=o.current;if(!i)return;const s=i.getContext("2d");if(!s)return;const l=new Uint8Array(e.frequencyBinCount);e.getByteTimeDomainData(l);let c=0;for(let b=0;b<l.length;b++){const x=(l[b]-128)/128;c+=x*x}const d=Math.sqrt(c/l.length),u=Math.min(1,d*4),p=i.width,m=i.height;s.clearRect(0,0,p,m),s.fillStyle="#1f2937",s.fillRect(0,0,p,m);const w=u*m,k=s.createLinearGradient(0,m,0,0);k.addColorStop(0,"#10b981"),k.addColorStop(.6,"#f59e0b"),k.addColorStop(1,"#ef4444"),s.fillStyle=k,s.fillRect(0,m-w,p,w),s.fillStyle="rgba(0,0,0,0.5)";for(let b=10;b<m;b+=10)s.fillRect(0,b,p,1);r.current=requestAnimationFrame(a)};return a(),()=>{r.current&&cancelAnimationFrame(r.current)}},[t,e]),n.jsx("canvas",{ref:o,width:8,height:150,className:"w-full h-full"})},$j=({src:e,name:t,mediaRef:o,audioData:r,analyser:a,currentTime:i,duration:s,isPlaying:l,volume:c,markers:d,onSeek:u,onVolumeChange:p,onTimeUpdate:m,onLoadedMetadata:w,onEnded:k,onClear:b,onRelink:x,onSelect:f,t:h})=>n.jsxs("div",{className:"w-full h-full flex flex-col relative group bg-gray-900 overflow-hidden pr-3",children:[n.jsxs("div",{className:"h-10 bg-gray-800 border-b border-gray-700 flex items-center px-3 space-x-2 shrink-0 z-10 w-full",onMouseDown:v=>{},children:[n.jsx("div",{className:"w-6 h-6 rounded bg-cyan-900/50 flex items-center justify-center border border-cyan-700 shadow-sm flex-shrink-0",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-cyan-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z",clipRule:"evenodd"})})}),n.jsx("span",{className:"text-gray-200 text-xs font-semibold truncate shadow-sm flex-grow",children:t}),n.jsx(we,{title:h("node.mediaViewer.relink"),onClick:x,tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),n.jsx(we,{title:h("node.action.clear"),onClick:b,tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),n.jsxs("div",{className:"flex-grow flex min-h-0 relative w-full",children:[n.jsx("div",{className:"flex-grow relative h-full bg-gray-900 min-w-0",children:n.jsx(Vj,{audioData:r,currentTime:i,duration:s,isPlaying:l,onSeek:u,markers:d,onSelect:f})}),n.jsxs("div",{className:"w-12 bg-gray-900 border-l border-gray-700 flex flex-col items-center py-2 gap-2 flex-shrink-0 relative z-20",onMouseDown:v=>{v.stopPropagation(),f&&f()},children:[n.jsx("div",{className:"flex-1 w-2 relative bg-gray-800 rounded-full overflow-hidden",children:n.jsx(Wj,{analyser:a,isPlaying:l})}),n.jsx("div",{className:"h-24 w-full flex justify-center py-1",children:n.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:c,onChange:v=>p(parseFloat(v.target.value)),className:"h-full w-1 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-cyan-500",style:{writingMode:"vertical-lr",direction:"rtl",WebkitAppearance:"slider-vertical",width:"4px"},title:`Volume: ${Math.round(c*100)}%`})}),n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z",clipRule:"evenodd"})})]})]}),n.jsx("audio",{ref:o,src:e,onTimeUpdate:m,onLoadedMetadata:w,onEnded:k})]}),Kj=({src:e,mediaRef:t,onTimeUpdate:o,onLoadedMetadata:r,onEnded:a,onTogglePlay:i})=>n.jsx("video",{ref:t,src:e,className:"w-full h-full object-contain mx-auto",onTimeUpdate:o,onLoadedMetadata:r,onEnded:a,onClick:s=>{s.stopPropagation(),i()}}),Jj=({node:e,onValueChange:t,t:o,isSelected:r,onSelectNode:a})=>{const i=y.useRef(null),s=y.useRef(null),l=y.useRef(null),[c,d]=y.useState(!1),[u,p]=y.useState(""),m=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{src:"",type:"video",name:""}}},[e.value]),{src:w,type:k,name:b}=m,{mediaRef:x,isPlaying:f,currentTime:h,duration:v,volume:N,markers:_,togglePlay:E,stop:I,seek:B,changeVolume:M,addMarker:G,updateMarker:V,deleteMarker:j,deleteAllMarkers:P,handleTimeUpdate:S,handleLoadedMetadata:A,handleEnded:O}=Bj(e.id,e.value,t),z=y.useCallback(()=>{a&&a()},[a]),L=y.useCallback(()=>{z(),E()},[z,E]),W=y.useCallback(()=>{z(),I()},[z,I]),D=y.useCallback(ne=>{z(),B(ne)},[z,B]),T=y.useCallback(ne=>{z(),M(ne)},[z,M]),F=y.useCallback(()=>{z(),G()},[z,G]),te=y.useCallback((ne,X)=>{z(),V(ne,X)},[z,V]),$=y.useCallback(ne=>{z(),j(ne)},[z,j]),Y=y.useCallback(()=>{z(),P()},[z,P]);y.useEffect(()=>{if(!r||!w)return;const ne=X=>{const ue=X.target;if(ue.tagName==="INPUT"||ue.tagName==="TEXTAREA"||ue.isContentEditable)return;const Q=.042;X.code==="KeyM"?(X.preventDefault(),X.stopPropagation(),G()):X.code==="ArrowLeft"?(X.preventDefault(),B(Math.max(0,h-Q))):X.code==="ArrowRight"?(X.preventDefault(),B(Math.min(v,h+Q))):X.code==="Space"&&(X.preventDefault(),E())};return window.addEventListener("keydown",ne),()=>window.removeEventListener("keydown",ne)},[r,w,h,v,G,B,E]);const{analyserRef:oe,audioDataRef:le}=Hj(w,k,x.current),K=ne=>{var ue;const X=(ue=ne.target.files)==null?void 0:ue[0];X&&Z(X),ne.target&&(ne.target.value="")},ie=ne=>{var ue;const X=(ue=ne.target.files)==null?void 0:ue[0];X&&de(X),ne.target&&(ne.target.value="")},Z=ne=>{const X=URL.createObjectURL(ne),ue=ne.type.startsWith("audio/")?"audio":"video";t(e.id,JSON.stringify({src:X,type:ue,name:ne.name,currentTime:0,volume:.4,isPlaying:!0,markers:[]}))},se=()=>{var pe;if(!u.trim())return;const ne=u.trim(),X=(pe=ne.split(".").pop())==null?void 0:pe.toLowerCase(),Q=["mp3","wav","ogg","m4a","aac","flac"].includes(X||"")?"audio":"video",ce=ne.split("/").pop()||"Remote Media";t(e.id,JSON.stringify({src:ne,type:Q,name:ce.length>30?ce.substring(0,30)+"...":ce,currentTime:0,volume:.4,isPlaying:!0,markers:[]})),p("")},de=ne=>{const X=URL.createObjectURL(ne),ue=ne.type.startsWith("audio/")?"audio":"video",Q=JSON.parse(e.value||"{}");t(e.id,JSON.stringify({...Q,src:X,type:ue,name:ne.name,currentTime:0,isPlaying:!0}))},re=()=>{z(),x.current&&(x.current.pause(),x.current.removeAttribute("src"),x.current.load());const ne=JSON.parse(e.value||"{}");t(e.id,JSON.stringify({...ne,src:"",name:"",isPlaying:!1,currentTime:0})),setTimeout(()=>{var X;(X=s.current)==null||X.click()},100)},R=()=>{if(z(),!_||_.length===0)return;const ne=JSON.stringify(_,null,2),X=new Blob([ne],{type:"application/json"}),ue=URL.createObjectURL(X),Q=document.createElement("a");Q.href=ue;const ce=new Date().toISOString().slice(0,10);Q.download=`markers_${ce}.json`,Q.click(),URL.revokeObjectURL(ue)},J=()=>{var ne;z(),(ne=l.current)==null||ne.click()},H=ne=>{var Q;const X=(Q=ne.target.files)==null?void 0:Q[0];if(!X)return;const ue=new FileReader;ue.onload=ce=>{var pe;try{const me=(pe=ce.target)==null?void 0:pe.result,ke=JSON.parse(me);if(Array.isArray(ke)){const Re=JSON.parse(e.value||"{}");t(e.id,JSON.stringify({...Re,markers:ke}))}else console.error("Invalid markers file format")}catch(me){console.error("Failed to load markers",me)}},ue.readAsText(X),ne.target&&(ne.target.value="")},U=ne=>{ne.preventDefault(),ne.stopPropagation(),d(!0)},ee=ne=>{ne.preventDefault(),ne.stopPropagation(),d(!1)},ae=ne=>{var ue;ne.preventDefault(),ne.stopPropagation(),d(!1);const X=(ue=ne.dataTransfer.files)==null?void 0:ue[0];if(X){if(X.type.startsWith("video/")||X.type.startsWith("audio/"))Z(X);else if(X.name.endsWith(".json")){const Q=new FileReader;Q.onload=ce=>{var pe;try{const me=(pe=ce.target)==null?void 0:pe.result,ke=JSON.parse(me);if(Array.isArray(ke)){const Re=JSON.parse(e.value||"{}");t(e.id,JSON.stringify({...Re,markers:ke}))}}catch{}},Q.readAsText(X)}}},xe=()=>{z(),x.current&&(x.current.pause(),x.current.src=""),t(e.id,JSON.stringify({src:"",type:"video",name:"",markers:[],volume:.4}))};return n.jsxs("div",{className:"flex flex-col h-full bg-gray-900 rounded-lg overflow-hidden",children:[n.jsx("input",{ref:i,type:"file",accept:"video/*,audio/*",className:"hidden",onChange:K}),n.jsx("input",{ref:s,type:"file",accept:"video/*,audio/*",className:"hidden",onChange:ie}),n.jsx("input",{ref:l,type:"file",accept:".json",className:"hidden",onChange:H}),n.jsx("div",{className:`flex-grow relative flex ${w?"bg-black":"bg-gray-800"} min-h-0 overflow-hidden group ${c?"ring-2 ring-cyan-500 bg-gray-800":""}`,onDragEnter:U,onDragOver:ne=>{ne.preventDefault(),ne.stopPropagation(),d(!0)},onDragLeave:ee,onDrop:ae,children:w?k==="video"?n.jsxs(n.Fragment,{children:[n.jsx(Kj,{src:w,mediaRef:x,onTimeUpdate:S,onLoadedMetadata:A,onEnded:O,onTogglePlay:L}),n.jsxs("div",{className:"absolute top-2 right-2 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity z-20",children:[n.jsx(we,{title:o("node.mediaViewer.relink"),onClick:ne=>{ne.stopPropagation(),re()},className:"bg-black/50 hover:bg-black/70 p-1.5 rounded-full text-white cursor-pointer",tooltipPosition:"bottom",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),n.jsx(we,{title:o("node.action.clear"),onClick:ne=>{ne.stopPropagation(),xe()},className:"bg-black/50 hover:bg-black/70 p-1.5 rounded-full text-white cursor-pointer",tooltipPosition:"bottom",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}):n.jsx($j,{src:w,name:b,mediaRef:x,audioData:le.current,analyser:oe.current,currentTime:h,duration:v,isPlaying:f,volume:N,markers:_,onSeek:D,onVolumeChange:T,onTimeUpdate:S,onLoadedMetadata:A,onEnded:O,onClear:ne=>{ne&&ne.stopPropagation(),xe()},onRelink:ne=>{ne&&ne.stopPropagation(),re()},onSelect:z,t:o}):n.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-4",children:[n.jsxs("div",{className:"flex flex-col items-center justify-center text-gray-500 cursor-pointer hover:text-gray-400 transition-colors mb-4",onClick:()=>{var ne;return(ne=i.current)==null?void 0:ne.click()},children:[n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 mx-auto mb-2 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),n.jsx("p",{className:"text-sm font-medium",children:o("node.content.dropMedia")})]}),n.jsx("div",{className:"w-1/2 h-px bg-gray-700 my-2"}),n.jsxs("div",{className:"w-full max-w-[80%] flex items-center space-x-1",children:[n.jsxs("div",{className:"flex-grow bg-gray-800 rounded-md border border-gray-600 flex items-center px-2 py-1 focus-within:border-cyan-500 focus-within:ring-1 focus-within:ring-cyan-500 transition-all",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),n.jsx("input",{type:"text",value:u,onChange:ne=>p(ne.target.value),placeholder:"Paste URL...",className:"bg-transparent border-none text-xs text-white focus:outline-none w-full",onKeyDown:ne=>{ne.key==="Enter"&&se()},onMouseDown:ne=>ne.stopPropagation()})]}),n.jsx("button",{onClick:se,className:"p-1.5 bg-cyan-600 hover:bg-cyan-700 rounded-md text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:!u.trim(),title:"Load from URL",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]})]})}),w&&n.jsx(Uj,{isPlaying:f,currentTime:h,duration:v,volume:N,markers:_,onTogglePlay:L,onStop:W,onSeek:D,onVolumeChange:T,onClear:xe,onAddMarker:F,onUpdateMarker:te,onDeleteMarker:$,onDeleteAllMarkers:Y,onSaveMarkers:R,onLoadMarkers:J,onSelect:z,disabled:!w,t:o})]})},To=30,Ao=20,Ps=(e,t)=>{const o=[e];let r={...e},a=0;for(;(r.x!==t.x||r.y!==t.y)&&a<1e3;){a++;const i=t.x-r.x,s=t.y-r.y;let l={...r};Math.random()>.2?Math.abs(i)>Math.abs(s)?l.x+=Math.sign(i):l.y+=Math.sign(s):Math.abs(i)>Math.abs(s)?l.y+=Math.random()>.5?1:-1:l.x+=Math.random()>.5?1:-1,l.x=Math.max(0,Math.min(To-1,l.x)),l.y=Math.max(0,Math.min(Ao-1,l.y)),o.push(l),r=l}return o},Yj=()=>{const e={x:Math.floor(To/2),y:Math.floor(Ao/2)},t=Ps({x:0,y:Math.floor(Ao/2)},e),o=Ps({x:Math.floor(To/2),y:0},e),r=Ps({x:To-1,y:Math.floor(Ao/2)},e),a=Ps({x:Math.floor(To/2),y:Ao-1},e);return[t,o,r,a]},Xj=1500,Zj=2e3,E0=`&@/"'*?! :;*,....%$#`,Qj=e=>{const t={x:Math.floor(To/2),y:Math.floor(Ao/2)},o={grid:[],paths:[],dataUnits:[],enemies:[],towers:[],projectiles:[],score:0,bits:150,wordsQueue:[],storedData:[],totalWordsInitial:0,isLevelComplete:!1,isPaused:!0,centerPoint:t},r=y.useRef(o),[a,i]=y.useState({score:0,bits:150,isPaused:!0,isLevelComplete:!1}),s=y.useRef(0),l=y.useRef(0),c=y.useRef(0),d=y.useRef(0);y.useEffect(()=>{const f=Yj(),h=Array.from({length:Ao},(v,N)=>Array.from({length:To},(_,E)=>({x:E,y:N,isOccupied:!1})));r.current={...r.current,grid:h,paths:f}},[]),y.useEffect(()=>{const f=e.split(/\s+/).filter(h=>h.length>0);r.current.wordsQueue=f,r.current.totalWordsInitial=f.length,f.length>0&&(r.current.isLevelComplete=!1,r.current.storedData=[],i(h=>({...h,isLevelComplete:!1})))},[e]);const u=()=>{r.current.isPaused=!1,i(f=>({...f,isPaused:!1})),s.current=performance.now(),k()},p=()=>{r.current.isPaused=!0,i(f=>({...f,isPaused:!0})),d.current&&cancelAnimationFrame(d.current)},m=(f,h)=>{const v=r.current,N=v.paths.some(B=>B.some(M=>M.x===f&&M.y===h)),_=Math.abs(f-v.centerPoint.x),E=Math.abs(h-v.centerPoint.y),I=_<=1&&E<=1;v.bits>=50&&!v.grid[h][f].isOccupied&&!N&&!I&&(v.bits-=50,v.grid[h][f].isOccupied=!0,v.towers.push({id:`tower-${Date.now()}`,x:f,y:h,range:6,damage:3,cooldown:400,lastShotTime:0,color:"#22d3ee"}),i(B=>({...B,bits:v.bits})))},w=f=>{if(!f)return"ERR";const h=f.length;let v="";for(let N=0;N<h;N++)v+=E0.charAt(Math.floor(Math.random()*E0.length));return v},k=()=>{if(r.current.isPaused)return;const f=performance.now(),h=f-s.current;s.current=f,b(h,f),d.current=requestAnimationFrame(k)},b=(f,h)=>{const v=r.current;if(v.wordsQueue.length===0&&v.dataUnits.length===0&&!v.isLevelComplete&&v.totalWordsInitial>0){v.isLevelComplete=!0,v.isPaused=!0,i(N=>({...N,isLevelComplete:!0,isPaused:!0}));return}if(v.wordsQueue.length>0&&h-l.current>Xj){const N=v.wordsQueue.shift();N&&(v.dataUnits.push({id:`data-${Date.now()}`,word:N,pathIndex:0,progress:0,hp:20,maxHp:20,speed:2,isDead:!1,reachedBase:!1,color:"#06b6d4"}),l.current=h)}if((v.dataUnits.length>0||v.wordsQueue.length>0)&&h-c.current>Zj){const N=Math.floor(Math.random()*3)+1;v.enemies.push({id:`enemy-${Date.now()}`,pathIndex:N,progress:0,hp:8,maxHp:8,speed:2.5,reachedBase:!1,isDead:!1,damage:0,color:"#ef4444"}),c.current=h}v.dataUnits.forEach(N=>{if(N.isDead||N.reachedBase)return;const _=v.paths[N.pathIndex];N.progress+=N.speed*f/1e3,N.progress>=_.length-1&&(N.reachedBase=!0,v.score+=20,v.bits+=15,v.storedData.push(N.word),i(E=>({...E,score:v.score,bits:v.bits})))}),v.enemies.forEach(N=>{if(N.isDead||N.reachedBase)return;const _=v.paths[N.pathIndex];if(N.progress+=N.speed*f/1e3,N.progress>=_.length-1&&(N.reachedBase=!0,v.storedData.length>0)){const E=Math.floor(Math.random()*v.storedData.length),I=v.storedData[E];v.storedData[E]=w(I)}}),v.towers.forEach(N=>{if(h-N.lastShotTime>N.cooldown){let _,E=1/0;v.enemies.forEach(I=>{if(I.isDead||I.reachedBase)return;const B=v.paths[I.pathIndex],M=Math.floor(I.progress),G=B[M]||B[B.length-1],V=Math.hypot(G.x-N.x,G.y-N.y);V<=N.range&&V<E&&(E=V,_=I)}),_&&(v.projectiles.push({id:`proj-${Date.now()}-${Math.random()}`,x:N.x,y:N.y,targetId:_.id,targetType:"enemy",speed:15,damage:N.damage,color:"#fef08a"}),N.lastShotTime=h)}}),v.projectiles.forEach(N=>{const _=v.enemies.find(P=>P.id===N.targetId);if(!_||_.isDead||_.reachedBase){N.damage=0;return}const E=v.paths[_.pathIndex],I=Math.floor(_.progress),B=E[I]||E[E.length-1],M=B.x-N.x,G=B.y-N.y,V=Math.hypot(M,G),j=N.speed*f/1e3;V<=j?(_.hp-=N.damage,_.hp<=0&&(_.isDead=!0,v.bits+=5,v.score+=5,i(P=>({...P,bits:v.bits,score:v.score}))),N.damage=0):(N.x+=M/V*j,N.y+=G/V*j)}),v.dataUnits=v.dataUnits.filter(N=>!N.isDead&&!N.reachedBase),v.enemies=v.enemies.filter(N=>!N.isDead&&!N.reachedBase),v.projectiles=v.projectiles.filter(N=>N.damage>0)};return{gameStateRef:r,uiState:a,startGame:u,pauseGame:p,buildTower:m,getFinalText:()=>r.current.storedData.join(" ")}},eI=({gameStateRef:e,onCellClick:t})=>{const o=y.useRef(null),r=y.useRef(null),a=()=>{const s=o.current;if(!s)return;const l=s.getContext("2d");if(!l)return;const c=e.current;l.clearRect(0,0,s.width,s.height);const d=s.width,u=s.height,p=d/To,m=u/Ao;l.strokeStyle="rgba(255,255,255,0.03)",l.lineWidth=1;for(let h=0;h<=To;h++)l.beginPath(),l.moveTo(h*p,0),l.lineTo(h*p,u),l.stroke();for(let h=0;h<=Ao;h++)l.beginPath(),l.moveTo(0,h*m),l.lineTo(d,h*m),l.stroke();c.paths.forEach((h,v)=>{if(h.length===0)return;l.beginPath(),l.strokeStyle=v===0?"rgba(34, 211, 238, 0.2)":"rgba(239, 68, 68, 0.2)",l.lineWidth=p*.4,l.lineCap="round",l.lineJoin="round";const N=h[0];l.moveTo((N.x+.5)*p,(N.y+.5)*m);for(let _=1;_<h.length;_++){const E=h[_];l.lineTo((E.x+.5)*p,(E.y+.5)*m)}l.stroke()});const w=(c.centerPoint.x+.5)*p,k=(c.centerPoint.y+.5)*m,b=p*1.5,x=l.createRadialGradient(w,k,b*.2,w,k,b);x.addColorStop(0,"rgba(6, 182, 212, 0.8)"),x.addColorStop(.6,"rgba(16, 185, 129, 0.4)"),x.addColorStop(1,"rgba(0,0,0,0)"),l.fillStyle=x,l.beginPath(),l.arc(w,k,b,0,Math.PI*2),l.fill(),l.strokeStyle="#fff",l.lineWidth=2,l.beginPath(),l.arc(w,k,b*.5,0,Math.PI*2),l.stroke(),c.towers.forEach(h=>{l.fillStyle=h.color,l.fillRect(h.x*p+2,h.y*m+2,p-4,m-4),l.fillStyle="#fff",l.fillRect(h.x*p+p/2-2,h.y*m+m/2-2,4,4)});const f=(h,v,N,_)=>{const E=c.paths[h];if(!E)return;const I=Math.floor(v),B=E[I]||E[E.length-1],M=E[I+1]||B,G=v-I,V=B.x+(M.x-B.x)*G,j=B.y+(M.y-B.y)*G,P=(V+.5)*p,S=(j+.5)*m;l.fillStyle=N,l.beginPath(),l.arc(P,S,p*.3,0,Math.PI*2),l.fill(),l.fillStyle="red",l.fillRect(P-p*.3,S-m*.5,p*.6,3),l.fillStyle="#10b981",l.fillRect(P-p*.3,S-m*.5,p*.6*_,3)};c.dataUnits.forEach(h=>f(h.pathIndex,h.progress,h.color,h.hp/h.maxHp)),c.enemies.forEach(h=>f(h.pathIndex,h.progress,h.color,h.hp/h.maxHp)),c.projectiles.forEach(h=>{l.fillStyle=h.color,l.beginPath(),l.arc((h.x+.5)*p,(h.y+.5)*m,3,0,Math.PI*2),l.fill()}),r.current=requestAnimationFrame(a)};y.useEffect(()=>(r.current=requestAnimationFrame(a),()=>{r.current&&cancelAnimationFrame(r.current)}),[]);const i=s=>{const l=o.current;if(!l)return;const c=l.getBoundingClientRect(),d=s.clientX-c.left,u=s.clientY-c.top,p=l.width/To,m=l.height/Ao,w=l.width/c.width,k=l.height/c.height,b=Math.floor(d*w/p),x=Math.floor(u*k/m);t(b,x)};return n.jsx("canvas",{ref:o,width:900,height:600,className:"w-full h-full bg-gray-900 cursor-crosshair",onClick:i})},tI=({score:e,bits:t,isPaused:o,onTogglePause:r,t:a})=>n.jsxs("div",{className:"absolute top-2 left-2 right-2 flex justify-between items-start pointer-events-none",children:[n.jsxs("div",{className:"bg-gray-800/80 backdrop-blur rounded p-2 border border-gray-600 shadow-lg pointer-events-auto flex flex-col gap-1",children:[n.jsxs("div",{className:"text-cyan-400 font-bold text-lg",children:["Score: ",e]}),n.jsxs("div",{className:"text-yellow-400 font-mono text-sm",children:["Bits: ",t]})]}),n.jsx("div",{className:"pointer-events-auto",children:n.jsx("button",{onClick:r,className:`px-4 py-2 rounded font-bold text-white shadow-lg transition-colors ${o?"bg-emerald-600 hover:bg-emerald-700":"bg-red-600 hover:bg-red-700"}`,children:o?"START / RESUME":"PAUSE"})}),n.jsxs("div",{className:"bg-gray-800/80 backdrop-blur rounded p-2 border border-gray-600 shadow-lg text-xs text-gray-300 max-w-[150px]",children:[n.jsx("p",{children:"Click on empty cells to build towers (50 Bits)."}),n.jsx("p",{children:"Protect the blue circles!"})]})]}),nI=({node:e,onValueChange:t,t:o,getUpstreamNodeValues:r})=>{const a=y.useMemo(()=>r(e.id).filter(k=>typeof k=="string").join(" "),[r,e.id]),{gameStateRef:i,uiState:s,startGame:l,pauseGame:c,buildTower:d,getFinalText:u}=Qj(a),p=()=>{const m=u();try{const w=JSON.parse(e.value||"{}");t(e.id,JSON.stringify({...w,outputText:m}))}catch{t(e.id,JSON.stringify({outputText:m}))}};return n.jsxs("div",{className:"relative w-full h-full bg-gray-900 rounded-md overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"flex-grow relative group",children:[n.jsx(eI,{gameStateRef:i,onCellClick:d}),n.jsx(tI,{score:s.score,bits:s.bits,isPaused:s.isPaused,onTogglePause:()=>s.isPaused?l():c(),t:o}),s.isLevelComplete&&n.jsxs("div",{className:"absolute inset-0 flex items-center justify-center z-20 pointer-events-auto",children:[n.jsx("div",{className:"bg-black/60 absolute inset-0 backdrop-blur-sm"}),n.jsxs("div",{className:"relative flex flex-col items-center gap-4 p-6 bg-gray-800 rounded-xl border-2 border-cyan-500 shadow-[0_0_50px_rgba(6,182,212,0.4)] animate-fade-in-up",children:[n.jsx("h2",{className:"text-2xl font-bold text-white uppercase tracking-widest",children:"Transmission Complete"}),n.jsxs("div",{className:"text-gray-300 text-sm",children:["Integrity: ",n.jsxs("span",{className:"text-cyan-400 font-mono",children:[Math.floor(s.score/(i.current.totalWordsInitial*20)*100),"%"]})]}),n.jsx("button",{onClick:p,className:"px-8 py-3 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-bold rounded-lg shadow-lg transform hover:scale-105 transition-all",children:"GENERATE OUTPUT"})]})]})]}),n.jsxs("div",{className:"h-6 bg-gray-800 border-t border-gray-700 flex items-center px-2 text-[10px] text-gray-400 justify-between shrink-0",children:[n.jsxs("span",{children:["Input: ",a.length>20?a.substring(0,20)+"...":a?`${a.length} chars`:"No Data"]}),n.jsxs("span",{children:["Status: ",s.isLevelComplete?"Complete":s.isPaused?"Paused":"Active"]})]})]})},gd=[{id:0,name:"Nose",x:.5,y:.15,color:"#ff0000"},{id:1,name:"Neck",x:.5,y:.25,color:"#ff5500",isFixed:!0},{id:2,name:"RShoulder",x:.4,y:.25,color:"#ffaa00",parent:1},{id:3,name:"RElbow",x:.35,y:.4,color:"#ffff00",parent:2},{id:4,name:"RWrist",x:.3,y:.55,color:"#aaff00",parent:3},{id:5,name:"LShoulder",x:.6,y:.25,color:"#55ff00",parent:1},{id:6,name:"LElbow",x:.65,y:.4,color:"#00ff00",parent:5},{id:7,name:"LWrist",x:.7,y:.55,color:"#00ff55",parent:6},{id:8,name:"RHip",x:.45,y:.55,color:"#00ffaa",parent:1},{id:9,name:"RKnee",x:.45,y:.75,color:"#00ffff",parent:8},{id:10,name:"RAnkle",x:.45,y:.95,color:"#00aaff",parent:9},{id:11,name:"LHip",x:.55,y:.55,color:"#0055ff",parent:1},{id:12,name:"LKnee",x:.55,y:.75,color:"#0000ff",parent:11},{id:13,name:"LAnkle",x:.55,y:.95,color:"#5500ff",parent:12},{id:14,name:"REye",x:.48,y:.13,color:"#aa00ff",parent:0},{id:15,name:"LEye",x:.52,y:.13,color:"#ff00ff",parent:0},{id:16,name:"REar",x:.45,y:.14,color:"#ff00aa",parent:14},{id:17,name:"LEar",x:.55,y:.14,color:"#ff0055",parent:15}],oI=[{from:1,to:2,color:"#ffaa00"},{from:2,to:3,color:"#ffff00"},{from:3,to:4,color:"#aaff00"},{from:1,to:5,color:"#55ff00"},{from:5,to:6,color:"#00ff00"},{from:6,to:7,color:"#00ff55"},{from:1,to:8,color:"#00ffaa"},{from:8,to:9,color:"#00ffff"},{from:9,to:10,color:"#00aaff"},{from:1,to:11,color:"#0055ff"},{from:11,to:12,color:"#0000ff"},{from:12,to:13,color:"#5500ff"},{from:1,to:0,color:"#ff5500"},{from:0,to:14,color:"#aa00ff"},{from:14,to:16,color:"#ff00aa"},{from:0,to:15,color:"#ff00ff"},{from:15,to:17,color:"#ff0055"}],rI=(e,t,o=5)=>{if(e.length<2)return e;const r=[];for(let l=0;l<e.length-1;l++)r.push(Math.hypot(e[l+1].x-e[l].x,e[l+1].y-e[l].y));const a={x:e[0].x,y:e[0].y},i=r.reduce((l,c)=>l+c,0);if(Math.hypot(t.x-a.x,t.y-a.y)>i){for(let l=0;l<e.length-1;l++){const c=t.x-e[l].x,d=t.y-e[l].y,u=Math.hypot(c,d),p=r[l]/u;e[l+1].x=e[l].x+c*p,e[l+1].y=e[l].y+d*p}return e}for(let l=0;l<o;l++){e[e.length-1].x=t.x,e[e.length-1].y=t.y;for(let c=e.length-2;c>=0;c--){const d=e[c].x-e[c+1].x,u=e[c].y-e[c+1].y,p=Math.hypot(d,u),m=r[c]/p;e[c].x=e[c+1].x+d*m,e[c].y=e[c+1].y+u*m}e[0].x=a.x,e[0].y=a.y;for(let c=0;c<e.length-1;c++){const d=e[c+1].x-e[c].x,u=e[c+1].y-e[c].y,p=Math.hypot(d,u),m=r[c]/p;e[c+1].x=e[c].x+d*m,e[c+1].y=e[c].y+u*m}}return e},aI=({node:e,onValueChange:t,t:o,onSelectNode:r,addToast:a,onDownloadImageFromUrl:i,onCopyImageToClipboard:s})=>{const l=y.useRef(null),c=y.useRef(null),d=y.useRef(null),u=y.useMemo(()=>{try{const A=JSON.parse(e.value||"{}");return{joints:A.joints&&A.joints.length>0?A.joints:JSON.parse(JSON.stringify(gd)),aspectRatio:A.aspectRatio||"1:1",resolution:A.resolution||"1K",renderedImage:A.renderedImage||null,aiPrompt:A.aiPrompt||""}}catch{return{joints:JSON.parse(JSON.stringify(gd)),aspectRatio:"1:1",resolution:"1K",renderedImage:null,aiPrompt:""}}},[e.value]),[p,m]=y.useState(u.joints),[w,k]=y.useState(null),[b,x]=y.useState(!1);y.useEffect(()=>{m(u.joints)},[u.joints]);const f=(A,O,z)=>{const L={...u,...z,joints:A,renderedImage:O!==void 0?O:u.renderedImage};t(e.id,JSON.stringify(L))},h=async()=>{if(!(!u.aiPrompt.trim()||b)){x(!0);try{const A=oc();if(!A)throw new Error("API Key is missing. Please check settings.");const z=await new Kp({apiKey:A}).models.generateContent({model:"gemini-3-flash-preview",contents:`Generate a 2D character pose for the following description: "${u.aiPrompt}".
                
                The rig uses 18 joints (0-17): 0:Nose, 1:Neck, 2:RShoulder, 3:RElbow, 4:RWrist, 5:LShoulder, 6:LElbow, 7:LWrist, 8:RHip, 9:RKnee, 10:RAnkle, 11:LHip, 12:LKnee, 13:LAnkle, 14:REye, 15:LEye, 16:REar, 17:LEar.
                
                Coordinates x and y must be between 0.0 (top/left) and 1.0 (bottom/right).
                Make sure the pose is dynamic, anatomically plausible, and fits within the 0-1 range.`,config:{responseMimeType:"application/json",responseSchema:{type:bt.OBJECT,properties:{joints:{type:bt.ARRAY,items:{type:bt.OBJECT,properties:{id:{type:bt.INTEGER},name:{type:bt.STRING},x:{type:bt.NUMBER},y:{type:bt.NUMBER},color:{type:bt.STRING}},required:["id","x","y"]}}},required:["joints"]}}}),L=JSON.parse(z.text||"{}");if(L.joints&&Array.isArray(L.joints)){const W=p.map(D=>{const T=L.joints.find(F=>F.id===D.id);return T?{...D,x:T.x,y:T.y}:D});m(W),f(W),a==null||a("AI Pose Generated","success")}}catch(A){console.error("AI Pose Generation failed:",A),a==null||a("AI Generation failed","error")}finally{x(!1)}}},v=(A,O,z,L=!1)=>{A.fillStyle="black",A.fillRect(0,0,O,z),oI.forEach(W=>{const D=p.find(F=>F.id===W.from),T=p.find(F=>F.id===W.to);D&&T&&(A.beginPath(),A.strokeStyle=W.color,A.lineWidth=L?6:2,A.moveTo(D.x*O,D.y*z),A.lineTo(T.x*O,T.y*z),A.stroke())}),L||p.forEach(W=>{A.beginPath(),A.fillStyle=W.color,A.arc(W.x*O,W.y*z,w===W.id?8:5,0,Math.PI*2),A.fill(),A.strokeStyle="white",A.lineWidth=1,A.stroke()})};y.useEffect(()=>{var L;const A=l.current;if(!A)return;const O=A.getContext("2d");if(!O)return;const z=(L=A.parentElement)==null?void 0:L.getBoundingClientRect();z&&(A.width=z.width,A.height=z.height),v(O,A.width,A.height)},[p,w]);const N=A=>{A.stopPropagation(),r&&r();const O=l.current;if(!O)return;const z=O.getBoundingClientRect(),L=(A.clientX-z.left)/O.width,W=(A.clientY-z.top)/O.height,D=.05,T=p.find(F=>Math.hypot(F.x-L,F.y-W)<D);T&&k(T.id)},_=A=>{if(w===null)return;const O=l.current;if(!O)return;const z=O.getBoundingClientRect(),L=(A.clientX-z.left)/O.width,W=(A.clientY-z.top)/O.height,D=[...p],T=D.find(te=>te.id===w);if(!T)return;if([4,7,10,13].includes(w)){let te=[];w===4?te=[1,2,3,4]:w===7?te=[1,5,6,7]:w===10?te=[1,8,9,10]:w===13&&(te=[1,11,12,13]);const $=te.map(Y=>D.find(oe=>oe.id===Y));rI($,{x:L,y:W})}else T.x=L,T.y=W;m(D)},E=()=>{w!==null&&(k(null),f(p))},I=()=>{const A=document.createElement("canvas"),z={"720p":1280,"1080p":1920,"1K":1024,"2K":2048,"4K":4096}[u.resolution]||1024,[L,W]=u.aspectRatio.split(":").map(Number),D=L/W;let T=z,F=z;D>1?F=z/D:T=z*D,A.width=T,A.height=F;const te=A.getContext("2d");if(te){v(te,T,F,!0);const $=A.toDataURL("image/png");f(p,$),a&&a("Pose Rendered","success")}},B=()=>{const A=JSON.parse(JSON.stringify(gd));m(A),f(A,null)},M=()=>{var A;(A=d.current)==null||A.click()},G=A=>{var L;const O=(L=A.target.files)==null?void 0:L[0];if(!O)return;const z=new FileReader;z.onload=W=>{var D;try{const T=(D=W.target)==null?void 0:D.result,F=JSON.parse(T);if(F.joints&&Array.isArray(F.joints))m(F.joints),t(e.id,JSON.stringify({...u,...F})),a&&a("Pose Loaded","success");else throw new Error("Invalid pose format")}catch{a&&a("Failed to load pose: Invalid JSON","error")}},z.readAsText(O),A.target&&(A.target.value="")},V=A=>{A.stopPropagation(),u.renderedImage&&i&&i(u.renderedImage,0,"Pose Reference")},j=A=>{A.stopPropagation(),u.renderedImage&&s&&s(u.renderedImage)},P=["1:1","16:9","9:16","4:3","3:4"],S=["720p","1080p","1K","2K","4K"];return n.jsxs("div",{className:"flex flex-col h-full bg-gray-900 rounded-lg overflow-hidden",onWheel:A=>A.stopPropagation(),children:[n.jsx("input",{type:"file",ref:d,className:"hidden",accept:".json",onChange:G}),n.jsxs("div",{className:"p-2 bg-gray-800 border-b border-gray-700 flex gap-2 shrink-0",children:[n.jsx("input",{type:"text",value:u.aiPrompt,onChange:A=>f(p,void 0,{aiPrompt:A.target.value}),onKeyDown:A=>{A.key==="Enter"&&h()},placeholder:"Describe pose (e.g. 'Hero landing', 'Sitting on a bench')...",className:"flex-grow bg-gray-900 border border-gray-600 rounded px-2 py-1 text-xs text-white focus:border-cyan-500 outline-none",onMouseDown:A=>A.stopPropagation()}),n.jsx("button",{onClick:h,disabled:b||!u.aiPrompt.trim(),className:"px-3 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-700 rounded text-xs font-bold flex items-center gap-1.5 transition-colors shrink-0",children:b?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):" AI"})]}),n.jsxs("div",{className:"p-2 border-b border-gray-700 flex justify-between items-center bg-gray-800 gap-2 shrink-0",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsx("div",{className:"w-24",children:n.jsx(An,{value:u.aspectRatio,onChange:A=>t(e.id,JSON.stringify({...u,aspectRatio:A})),options:P.map(A=>({value:A,label:A}))})}),n.jsx("div",{className:"w-24",children:n.jsx(An,{value:u.resolution,onChange:A=>t(e.id,JSON.stringify({...u,resolution:A})),options:S.map(A=>({value:A,label:A}))})})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[u.renderedImage&&n.jsxs(n.Fragment,{children:[n.jsx(we,{title:o("node.action.copy"),onClick:j,children:n.jsx(zt,{className:"h-4 w-4"})}),n.jsx(we,{title:o("node.action.download"),onClick:V,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-700 mx-1"})]}),n.jsx("button",{onClick:M,className:"p-2 bg-gray-700 hover:bg-gray-600 rounded text-xs text-gray-300",children:"Load"}),n.jsx("button",{onClick:B,className:"p-2 bg-gray-700 hover:bg-gray-600 rounded text-xs text-gray-300",children:"Reset"}),n.jsx("button",{onClick:I,className:"p-2 bg-cyan-600 hover:bg-cyan-700 rounded text-xs font-bold text-white uppercase tracking-wider",children:"Render"})]})]}),n.jsxs("div",{ref:c,className:"flex-grow relative bg-black min-h-0",children:[n.jsx("canvas",{ref:l,className:"w-full h-full cursor-crosshair block",onMouseDown:N,onMouseMove:_,onMouseUp:E,onMouseLeave:E}),u.renderedImage&&n.jsx("div",{className:"absolute bottom-2 left-2 w-24 h-24 border border-gray-600 rounded overflow-hidden shadow-lg bg-black pointer-events-none group-hover:w-48 group-hover:h-48 transition-all duration-300",children:n.jsx("img",{src:u.renderedImage,alt:"Rendered",className:"w-full h-full object-contain"})})]}),n.jsx("div",{className:"p-1.5 bg-gray-800 border-t border-gray-700 flex items-center justify-center gap-4 shrink-0",children:n.jsx("span",{className:"text-[10px] text-gray-500 font-bold uppercase tracking-widest",children:"Inverse Kinematics: Draggable Wrists & Ankles"})})]})},iI=({value:e,onDebouncedChange:t,debounceTime:o=300,onChange:r,onPaste:a,...i})=>{const[s,l]=y.useState(e),c=y.useRef(null),d=y.useRef(!1);y.useEffect(()=>{!d.current&&e!==s&&l(e)},[e]);const u=w=>{const k=w.target.value;l(k),d.current=!0,c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{t(k),d.current=!1},o),r&&r(w)},p=w=>{c.current&&(clearTimeout(c.current),t(s),d.current=!1),i.onBlur&&i.onBlur(w)},m=w=>{const k=window.scrollX,b=window.scrollY,x=document.getElementById("app-container"),f=x?x.scrollLeft:0,h=x?x.scrollTop:0;requestAnimationFrame(()=>{window.scrollTo(k,b),x&&x.scrollTo(f,h)}),a&&a(w)};return n.jsx("input",{...i,value:s,onChange:u,onBlur:p,onPaste:m})},sI=({width:e,height:t})=>{const o=e/t;let r="",a="";return o>1.2?(r="M2 6h20v12H2z",a="Landscape"):o<.85?(r="M6 2h12v20H6z",a="Portrait"):(r="M4 4h16v16H4z",a="Square"),n.jsx("div",{className:"bg-black/60 rounded-tl-md px-1.5 py-1 flex items-center justify-center",title:a,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white/90",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:r})})})},lI=({concept:e,displayImage:t,fullResImage:o,isReadOnly:r,onUpdate:a,onDelete:i,onMoveUp:s,onMoveDown:l,isFirst:c,isLast:d,onDetach:u,onViewImage:p,t:m,hasError:w,onCopyImage:k,onDownloadImage:b})=>{const x=y.useRef(null),[f,h]=y.useState(!1),[v,N]=y.useState(null),_=P=>{var A;const S=(A=P.target.files)==null?void 0:A[0];if(S){const O=new FileReader;O.onload=z=>{var L;(L=z.target)!=null&&L.result&&a({image:z.target.result})},O.readAsDataURL(S)}P.target&&(P.target.value="")},E=P=>{e.isConnected||(P.preventDefault(),P.stopPropagation(),h(!0))},I=P=>{e.isConnected||(P.preventDefault(),P.stopPropagation(),h(!1))},B=P=>{e.isConnected||(P.preventDefault(),P.stopPropagation(),h(!0))},M=P=>{var O;if(e.isConnected)return;P.preventDefault(),P.stopPropagation(),h(!1);const S=P.dataTransfer.getData("application/prompt-modifier-drag-image");if(S){S.startsWith("data:")?a({image:S}):fetch(S).then(z=>z.blob()).then(z=>{const L=new FileReader;L.onload=W=>{var D;(D=W.target)!=null&&D.result&&a({image:W.target.result})},L.readAsDataURL(z)});return}const A=(O=P.dataTransfer.files)==null?void 0:O[0];if(A&&A.type.startsWith("image/")){const z=new FileReader;z.onload=L=>{var W;(W=L.target)!=null&&W.result&&a({image:L.target.result})},z.readAsDataURL(A)}},G=P=>{var A;P.stopPropagation();const S=o||t;S?p(S):e.isConnected||(A=x.current)==null||A.click()},V=P=>{P.stopPropagation(),a({image:null}),N(null)},j=P=>{const S=o||t;S&&(P.dataTransfer.setData("application/prompt-modifier-drag-image",S),P.dataTransfer.effectAllowed="copy",P.stopPropagation())};return n.jsxs("div",{className:`bg-gray-800 rounded-lg p-2 flex flex-col h-full border-2 ${w?"border-red-500":"border-gray-700"} w-full`,children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:`text-xs font-bold ${w?"text-red-500 animate-pulse":"text-gray-400"} truncate`,title:e.id,children:e.id}),n.jsxs("div",{className:"flex items-center space-x-1",children:[e.isConnected&&n.jsx(we,{title:"Detach",tooltipPosition:"left",onClick:P=>{P.stopPropagation(),u()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("button",{onClick:P=>{P.stopPropagation(),s()},disabled:c,className:"text-gray-500 hover:text-white disabled:opacity-30",children:n.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),n.jsx("button",{onClick:P=>{P.stopPropagation(),l()},disabled:d,className:"text-gray-500 hover:text-white disabled:opacity-30",children:n.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),!e.isConnected&&n.jsx(we,{title:m("node.action.delete"),tooltipPosition:"left",onClick:P=>{P.stopPropagation(),i()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-h-0",children:[n.jsxs("div",{className:`aspect-square bg-gray-900 rounded flex items-center justify-center overflow-hidden relative group flex-shrink-0 cursor-pointer transition-all ${f?"ring-2 ring-cyan-400 bg-gray-800":"hover:ring-1 hover:ring-cyan-500"}`,onClick:G,onDragEnter:E,onDragOver:B,onDragLeave:I,onDrop:M,title:t?"Click to View":"Click to Upload or Drop Image",children:[t?n.jsxs(n.Fragment,{children:[n.jsx("img",{src:t,alt:e.name,className:"w-full h-full object-cover",draggable:!0,onDragStart:j,onLoad:P=>N({width:P.currentTarget.naturalWidth,height:P.currentTarget.naturalHeight})}),n.jsxs("div",{className:"absolute top-1 right-1 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-20",children:[b&&n.jsx(we,{title:m("node.action.download"),onClick:P=>{P.stopPropagation(),b()},className:"bg-black/60 p-1 rounded text-accent-text hover:text-white",tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),k&&n.jsx(we,{title:m("node.action.copy"),onClick:P=>{P.stopPropagation(),k()},className:"bg-black/60 p-1 rounded text-accent-text hover:text-white",tooltipPosition:"left",children:n.jsx(zt,{className:"h-3 w-3"})}),!e.isConnected&&n.jsx(we,{title:m("node.action.clear"),onClick:V,className:"bg-black/60 p-1 rounded text-red-400 hover:text-white",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),v&&n.jsx("div",{className:"absolute bottom-0 right-0 pointer-events-none z-10",children:n.jsx(sI,{width:v.width,height:v.height})})]}):n.jsx("div",{className:"text-gray-600 text-xs text-center px-1 pointer-events-none",children:e.isConnected?"No Image":"Drop or Click"}),n.jsx("input",{ref:x,type:"file",className:"hidden",accept:"image/*",onChange:_})]}),n.jsxs("div",{className:"space-y-1 flex-grow flex flex-col min-h-0",children:[n.jsx(iI,{value:e.name,onDebouncedChange:P=>a({name:P}),className:"w-full bg-gray-900 text-xs text-white p-1 rounded border border-gray-700 focus:outline-none focus:border-cyan-500",placeholder:"Name",readOnly:r}),n.jsx(Cn,{value:e.prompt,onDebouncedChange:P=>a({prompt:P}),className:"w-full flex-grow bg-gray-900 text-xs text-gray-300 p-1 rounded border border-gray-700 focus:outline-none focus:border-cyan-500 resize-none custom-scrollbar",placeholder:"Appearance prompt...",readOnly:r})]})]})]})},cI=({allConcepts:e,onUpdateConcept:t,onDeleteConcept:o,onMoveConcept:r,onAddConcept:a,onDetachConnectedConcept:i,onClearConcepts:s,handleViewImage:l,t:c,deselectAllNodes:d,conceptsMode:u="normal",onToggleMode:p,duplicateIndices:m=new Set,onCopyImageToClipboard:w,onDownloadImageFromUrl:k})=>{const[b,x]=y.useState(!1),f=_=>{_.preventDefault(),_.stopPropagation(),x(!0)},h=_=>{_.preventDefault(),_.stopPropagation(),x(!1),a()},v=_=>{p&&p(u==="collapsed"?"normal":"collapsed")},N=e.findIndex(_=>!_.isConnected);return n.jsxs("div",{className:"flex-shrink-0 flex flex-col h-full bg-gray-900/30 rounded-t-md overflow-hidden",children:[n.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-800/80 border-b border-gray-700 select-none cursor-pointer hover:bg-gray-700/80 transition-colors",onClick:v,title:"Click to toggle collapse",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs("h3",{className:`text-sm font-bold ${m.size>0?"text-red-400":"text-gray-300"} flex-shrink-0`,children:[c("node.content.characterConcepts"),m.size>0&&n.jsx("span",{className:"ml-2 text-[10px] bg-red-900/40 px-1 rounded uppercase",children:"  "})]}),n.jsx("div",{onClick:_=>_.stopPropagation(),children:n.jsx(we,{title:"Clear All (Local & Connected)",onClick:s,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]}),p&&n.jsxs("div",{className:"flex items-center space-x-1",onClick:_=>_.stopPropagation(),children:[u==="expanded"?n.jsx("button",{onClick:()=>p("normal"),className:"p-1 text-gray-400 hover:text-white rounded hover:bg-gray-700 transition-colors",title:"Restore size",children:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("path",{d:"M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"})})}):n.jsx("button",{onClick:()=>p("expanded"),className:"p-1 text-gray-400 hover:text-white rounded hover:bg-gray-700 transition-colors",title:"Expand to full height",children:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("path",{d:"M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"})})}),u==="collapsed"?n.jsx("button",{onClick:()=>p("normal"),className:"p-1 text-gray-400 hover:text-white rounded hover:bg-gray-700 transition-colors",title:"Expand Panel",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}):n.jsx("button",{onClick:()=>p("collapsed"),className:"p-1 text-gray-400 hover:text-white rounded hover:bg-gray-700 transition-colors",title:"Collapse Panel",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]})]}),u!=="collapsed"&&n.jsxs("div",{className:"bg-gray-900/50 p-2 overflow-y-auto grid gap-2 custom-scrollbar flex-grow min-h-0",style:{gridTemplateColumns:"repeat(auto-fill, 240px)",gridAutoRows:"340px",justifyContent:"start"},onWheel:_=>_.stopPropagation(),children:[e.map((_,E)=>{const I=m.has((_.id||"").trim());return n.jsx("div",{className:"h-full w-full",children:n.jsx(lI,{concept:{id:_.id,name:_.name,prompt:_.prompt,image:_.image,fullDescription:_.fullDescription,isConnected:_.isConnected},displayImage:_.image,fullResImage:_._fullResImage||_.image,isReadOnly:!1,onUpdate:B=>t(E,B,_.isConnected,_.uniqueKey),onDelete:()=>o(E),onMoveUp:()=>r(E,"up"),onMoveDown:()=>r(E,"down"),isFirst:E===0||E===N&&!_.isConnected,isLast:E===e.length-1,onDetach:()=>i(_),onViewImage:l,t:c,hasError:I,onCopyImage:()=>{const B=_._fullResImage||_.image;B&&w&&w(B)},onDownloadImage:()=>{const B=_._fullResImage||_.image;if(B&&k){const M=(_.name||"concept").replace(/\s+/g,"_");k(B,0,_.prompt||M,`${M}.png`)}}})},_.uniqueKey||E)}),n.jsx("button",{onClick:a,onDragEnter:f,onDragOver:_=>{_.preventDefault(),_.stopPropagation(),x(!0)},onDragLeave:()=>x(!1),onDrop:h,className:`h-[340px] bg-gray-700 hover:bg-gray-600 rounded-md flex items-center justify-center text-gray-400 text-4xl transition-all ${b?"ring-2 ring-cyan-400":""}`,children:"+"})]})]})},Rl=({value:e,onDebouncedChange:t,debounceTime:o=300,className:r="",style:a,...i})=>{const[s,l]=y.useState(e),c=y.useRef(null),d=y.useRef(null),u=y.useRef(null),p=y.useRef(!1);y.useEffect(()=>{!p.current&&e!==s&&l(e)},[e]);const m=b=>{const x=b.target.value;l(x),p.current=!0,c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{t(x),p.current=!1},o),i.onChange&&i.onChange(b)},w=()=>{d.current&&u.current&&(u.current.scrollTop=d.current.scrollTop,u.current.scrollLeft=d.current.scrollLeft)};y.useEffect(()=>{if(!d.current||!u.current)return;const b=()=>{const f=d.current,h=u.current;if(f&&h){const v=window.getComputedStyle(f),N=parseFloat(v.borderLeftWidth)||0,_=parseFloat(v.borderRightWidth)||0,E=f.offsetWidth-f.clientWidth-N-_;if(E>0){const I=parseFloat(v.paddingRight)||0;h.style.paddingRight=`${I+E}px`}else h.style.removeProperty("padding-right")}},x=new ResizeObserver(b);return x.observe(d.current),d.current.addEventListener("input",b),()=>{x.disconnect(),d.current&&d.current.removeEventListener("input",b)}},[]);const k=b=>b.split(/(\[(?:Entity|Character)-[^\]]+\])/g).map((f,h)=>f.match(/^\[(?:Entity|Character)-[^\]]+\]$/)?n.jsx("span",{className:"text-connection-text",children:f},h):n.jsx("span",{children:f},h));return n.jsxs("div",{className:"relative w-full h-full group/highlighter",style:a,children:[n.jsx("div",{ref:u,className:`absolute inset-0 pointer-events-none whitespace-pre-wrap break-words overflow-hidden text-transparent ${r}`,style:{color:"transparent",zIndex:0,borderColor:"transparent"},"aria-hidden":"true",children:n.jsxs("div",{className:"text-gray-200",style:{width:"100%",height:"100%"},children:[k(s),s.endsWith(`
`)&&n.jsx("br",{})]})}),n.jsx("textarea",{...i,ref:d,value:s,onChange:m,onScroll:w,className:`relative w-full h-full text-transparent caret-white resize-none focus:outline-none z-10 ${r}`,style:{color:"transparent",caretColor:"white",backgroundColor:"transparent",...a},spellCheck:!1})]})},zu=260,qu=180,Py=44,P0=36,dI=200,uI=200,j0=16,pI=160,hI=32,jy={WS:"Integrate the character/object with a Wide Shot (WS) into the scene and action. Show the environment.",MS:"Integrate the character/object with a Medium Shot (MS) into the scene.",CU:"Integrate the character/object with a Close-Up (CU) into the scene.",ECU:"Integrate the character/object with an Extreme Close-Up (ECU) into the scene. Maximum detail.",LS:"Integrate the character/object with a Long Shot (LS) into the scene to show scale."},Or=({value:e,placeholder:t,onChange:o,min:r,className:a,title:i})=>{const s=c=>{const d=parseInt(e,10);let u=isNaN(d)?r||1:d+c;r!==void 0&&u<r&&(u=r),o(u.toString())},l=c=>{const d=c.target.value;if(d===""){o("");return}const u=parseInt(d,10);!isNaN(u)&&r!==void 0&&u<r||o(d)};return n.jsxs("div",{className:`relative flex items-center bg-gray-800 rounded border border-gray-600 h-7 ${a}`,title:i,children:[n.jsx("input",{type:"number",min:r,value:e,placeholder:t,onChange:l,className:"appearance-none w-full h-full bg-transparent text-xs text-white text-center focus:outline-none px-1 placeholder-gray-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",onClick:c=>c.stopPropagation(),onMouseDown:c=>c.stopPropagation()}),n.jsxs("div",{className:"flex flex-col h-full border-l border-gray-600 w-4 flex-shrink-0",children:[n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-gray-700 text-gray-400 hover:text-white transition-colors",onClick:c=>{c.stopPropagation(),s(1)},children:n.jsx("svg",{width:"8",height:"4",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-gray-700 text-gray-400 hover:text-white transition-colors border-t border-gray-600",onClick:c=>{c.stopPropagation(),s(-1)},children:n.jsx("svg",{width:"8",height:"4",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})},mI=["WS","MS","CU","ECU","LS"],gI=At.memo(({index:e,frameNumber:t,sceneNumber:o,prompt:r,videoPrompt:a,shotType:i,characters:s,duration:l,isSelected:c,isCollapsed:d,onToggleCollapse:u,onSelect:p,onChange:m,onDelete:w,onAddAfter:k,onCopy:b,onCopyVideo:x,onMoveUp:f,onMoveDown:h,onMoveToSource:v,onMoveToStart:N,onMoveToEnd:_,isFirst:E,isLast:I,t:B,readOnly:M=!1,isChecked:G,onCheck:V,style:j,onEditInSource:P,onEditPrompt:S,showVideoPrompts:A=!0,showSceneInfo:O=!0,onCopyCombinedPrompt:z})=>{const L=y.useCallback((K,ie)=>{if(M||ie<1)return;const Z=(s||[])[K],se=`Entity-${ie}`,de=[...s||[]];de[K]=se;const re=Z.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),R=new RegExp(`\\(${re}\\)`,"gi"),J=r.replace(R,`(${se})`);m(t,{characters:de,prompt:J})},[M,s,r,m,t]),W=y.useCallback(K=>{if(M)return;const ie=(s||[])[K],Z=(s||[]).filter((R,J)=>J!==K),se=ie.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),de=new RegExp(`\\s*\\(${se}\\)`,"gi"),re=r.replace(de,"").trim().replace(/,\s*$/,"");m(t,{characters:Z,prompt:re})},[M,s,r,m,t]),D=y.useCallback(K=>{if(M)return;const ie=`[${K}] ${r}`;m(t,{prompt:ie})},[M,r,m,t]),T=y.useCallback(()=>{if(M)return;const K=s||[],ie=K.map(re=>parseInt(re.replace(/(?:character|entity)-/i,""),10)).filter(re=>!isNaN(re));let Z=1;for(;ie.includes(Z);)Z++;const se=`Entity-${Z}`,de=[...K,se];m(t,{characters:de})},[M,s,m,t]),F=K=>{if(M)return;const ie=K,Z=J=>(J.match(/(?:character|entity)-\d+/gi)||[]).map(U=>U.toLowerCase()).sort().join(","),se=Z(r),de=Z(ie),re=se!==de,R={prompt:ie};if(re){const J=ie.match(/(?:character|entity)-\d+/gi)||[],H=[...new Set(J.map(U=>U.replace(/character-/i,"Entity-").replace(/entity-/i,"Entity-")))];R.characters=H}m(t,R)},te=K=>{M||m(t,{videoPrompt:K})},$=K=>{M||m(t,{shotType:K.target.value})},oe=`FRAME-${String(t).padStart(3,"0")}${i?`, [${i}]`:""}`,le=i?jy[i]:void 0;return n.jsxs("div",{onClick:()=>p(t),style:{...j,height:d?`${Py}px`:A?le?`${zu+30}px`:`${zu}px`:le?`${qu+30}px`:`${qu}px`},className:`relative group bg-gray-700 p-2 rounded-lg border-2 overflow-hidden mb-1 ${c?"border-connection-text shadow-[0_0_15px_var(--color-connection-text)]":"border-transparent hover:border-gray-600"}`,children:[n.jsxs("div",{className:"flex justify-between items-center mb-1 h-[28px] gap-2 cursor-pointer",onClick:K=>{K.stopPropagation(),u(t)},children:[n.jsxs("div",{className:"flex items-center space-x-2 flex-1 overflow-hidden",children:[V&&n.jsx("div",{className:"flex-shrink-0",onClick:K=>K.stopPropagation(),title:"Select frame for batch modification",children:n.jsx(Ht,{checked:!!G,onChange:(K,ie)=>V(t,ie.shiftKey),className:"h-5 w-5"})}),n.jsx(we,{tooltipPosition:"right",title:B(d?"node.action.expand":"node.action.collapse"),onClick:K=>{K.stopPropagation(),u(t)},children:d?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7M19 5l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),n.jsx("h4",{className:"text-[10px] font-black text-gray-200 flex-shrink-0 whitespace-nowrap uppercase tracking-tighter",title:oe,children:oe}),n.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0 ml-1",children:[n.jsx("span",{className:"text-[10px] text-gray-500 font-semibold uppercase",children:"ENT:"}),(s||[]).map((K,ie)=>{const Z=parseInt(K.replace(/(?:character|entity)-/i,""),10);return isNaN(Z)?null:n.jsxs("div",{className:"flex items-center bg-gray-600 rounded text-gray-200 border border-gray-500",onClick:se=>se.stopPropagation(),children:[n.jsx("span",{className:"text-[10px] font-semibold px-1.5",children:Z}),n.jsxs("div",{className:"flex flex-col border-l border-gray-500",children:[n.jsx("button",{onClick:se=>{se.stopPropagation(),L(ie,Z+1)},className:"px-0.5 text-gray-300 hover:text-white text-[8px] middle-none disabled:text-gray-500 disabled:cursor-not-allowed",disabled:M,children:""}),n.jsx("button",{onClick:se=>{se.stopPropagation(),L(ie,Z-1)},className:"px-0.5 text-gray-300 hover:text-white text-[8px] border-t border-gray-600 disabled:text-gray-500 disabled:cursor-not-allowed",disabled:M||Z<=1,children:""})]}),n.jsx("button",{onClick:se=>{se.stopPropagation(),D(K)},disabled:M,className:"px-1 text-cyan-300 hover:text-cyan-100 border-l border-gray-500 text-[10px] disabled:text-gray-500 disabled:cursor-not-allowed",title:"Insert at start: [Entity-N]",children:""}),n.jsx("button",{onClick:se=>{se.stopPropagation(),W(ie)},disabled:M,className:"px-1 text-red-300 hover:text-red-100 border-l border-gray-500 text-[10px] disabled:text-gray-500 disabled:cursor-not-allowed",children:""})]},ie)}),n.jsx("button",{onClick:K=>{K.stopPropagation(),T()},disabled:M,className:"flex items-center justify-center w-4 h-4 bg-gray-600 hover:bg-gray-500 rounded text-[10px] text-gray-300 disabled:bg-gray-700 disabled:cursor-not-allowed",children:"+"})]})]}),n.jsxs("div",{className:"flex items-center flex-shrink-0 space-x-1",children:[v&&n.jsx(we,{tooltipPosition:"left",title:"Move to Source",onClick:K=>{K.stopPropagation(),v(t)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),!M&&n.jsxs("div",{className:"flex p-0.5",children:[N&&n.jsx(we,{tooltipPosition:"left",title:"Move to Start",onClick:K=>{K.stopPropagation(),N(e)},disabled:E,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),f&&n.jsx(we,{tooltipPosition:"left",title:"Move Up",onClick:K=>{K.stopPropagation(),f(e)},disabled:E,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),h&&n.jsx(we,{tooltipPosition:"left",title:"Move Down",onClick:K=>{K.stopPropagation(),h(e)},disabled:I,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),_&&n.jsx(we,{tooltipPosition:"left",title:"Move to End",onClick:K=>{K.stopPropagation(),_(e)},disabled:I,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})})]}),!M&&k&&n.jsx(we,{tooltipPosition:"left",title:"Add Frame After",onClick:K=>{K.stopPropagation(),k(t)},className:"p-1 rounded-md text-[#dad5cf] hover:bg-gray-600 hover:text-white transition-colors focus:outline-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),n.jsx(we,{tooltipPosition:"left",title:B("node.action.copyVideoPrompt"),onClick:K=>{K.stopPropagation(),a&&x&&x(a)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})})}),n.jsx(we,{tooltipPosition:"left",title:B("node.action.copyImagePrompt"),onClick:K=>{K.stopPropagation(),b(r)},children:n.jsx(zt,{className:"h-4 w-4"})}),z&&n.jsx(we,{title:"Copy Combined Prompt",tooltipPosition:"bottom",tooltipAlign:"center",onClick:K=>{K.stopPropagation(),z(t)},className:"p-1 rounded-md text-[#dad5cf] hover:bg-gray-600 hover:text-white transition-colors focus:outline-none",children:n.jsx(eh,{className:"h-4 w-4 text-orange-400 group-hover:text-orange-200"})}),!M&&w&&n.jsx(we,{tooltipPosition:"left",title:B("image_sequence.delete_frame"),onClick:K=>{K.stopPropagation(),w(t)},className:"p-1 rounded-md text-gray-500 hover:text-red-400 hover:bg-gray-600 transition-colors focus:outline-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),(!M&&S||M&&P)&&n.jsx(we,{title:B(M?"image_sequence.edit_in_source":"image_sequence.edit_prompt"),tooltipPosition:"left",onClick:K=>{K.stopPropagation(),M&&P?P(t):S&&S(t)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})})]})]}),!d&&n.jsxs("div",{className:"flex flex-col space-y-1 mt-1",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1 bg-gray-800 p-1 rounded",children:[n.jsx("select",{value:i||"WS",onChange:$,disabled:M,className:"bg-gray-700 text-white text-[10px] rounded border border-gray-600 px-1 py-0.5 focus:outline-none focus:ring-1 focus:ring-cyan-500 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed w-20 shrink-0",onClick:K=>K.stopPropagation(),onMouseDown:K=>K.stopPropagation(),children:mI.map(K=>n.jsx("option",{value:K,children:K},K))}),n.jsx("div",{className:"text-[10px] text-gray-400 italic flex-grow truncate",title:le||"No Shot Type",children:le||n.jsx("span",{className:"opacity-50",children:"No shot type selected"})}),!M&&n.jsxs("div",{className:"flex items-center flex-shrink-0 border-l border-gray-600 pl-2",children:[n.jsx(Or,{value:l.toString(),onChange:K=>m(t,{duration:Math.max(0,parseInt(K,10)||0)}),min:0}),n.jsx("span",{className:"text-[9px] text-gray-500 ml-1",children:"s"})]})]}),n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase",children:"IMAGE PROMPT"}),n.jsx(Rl,{value:r,onDebouncedChange:F,readOnly:M,style:{height:A?"100px":"120px"},className:`w-full text-xs p-1 bg-gray-800 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-2 focus:ring-cyan-500 ${M?"cursor-default":"cursor-text"}`,onClick:K=>K.stopPropagation(),onMouseDown:K=>K.stopPropagation(),onWheel:K=>K.stopPropagation()})]}),A&&n.jsxs("div",{className:"flex flex-col mt-1 pt-1 border-t border-gray-600/30",children:[n.jsx("div",{className:"flex justify-between items-center mb-0.5",children:n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase",children:"VIDEO PROMPT"})}),n.jsx(Rl,{value:a||"",onDebouncedChange:te,readOnly:M,style:{height:"60px"},className:`w-full text-xs p-1 bg-gray-800 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-2 focus:ring-cyan-500 ${M?"cursor-default":"cursor-text"}`,onClick:K=>K.stopPropagation(),onMouseDown:K=>K.stopPropagation(),onWheel:K=>K.stopPropagation()})]})]})]})}),fI=(e,t,o,r=800,a=!0,i=!0,s={},l=[],c=[])=>{const d=y.useMemo(()=>{const k=[...e].sort((h,v)=>h.frameNumber-v.frameNumber),b=[];let x=-1,f=null;return k.forEach(h=>{const v=h.sceneNumber||1;if(v!==x){x=v;const N=h.sceneTitle||"";f={scene:v,title:N,prompts:[]},b.push(f)}f&&f.prompts.push(h)}),b},[e]),u=y.useMemo(()=>{const k=[];let b=0;return d.forEach(x=>{if(i&&(k.push({type:"scene_header",h:P0,top:b,data:x,scene:x.scene}),b+=P0),!i||!t.includes(x.scene)){const f=s[String(x.scene)]||"",h=l.includes(x.scene)?pI:hI;k.push({type:"scene_context",h:h+8,top:b,data:f,scene:x.scene}),b+=h+8,x.prompts.forEach(v=>{const _=(v.shotType?jy[v.shotType]:void 0)?30:0,E=(a?zu:qu)+_,I=(v.isCollapsed?Py:E)+8;k.push({type:"prompt",h:I,top:b,data:v,scene:x.scene}),b+=I})}}),{items:k,totalHeight:b}},[d,t,a,i,s,l,c]),p=y.useMemo(()=>{const b=Math.max(0,o-800),x=o+r+800;return u.items.filter(f=>f.top+f.h>b&&f.top<x)},[u,o,r]),m=k=>{const b=u.items.find(x=>x.type==="prompt"&&x.data.frameNumber===k);return b?b.top:null},w=k=>{if(!i)return null;const b=u.items.find(x=>x.type==="scene_header"&&x.scene===k);return b?b.top:null};return{groupedPrompts:d,virtualItems:u,visibleItems:p,totalHeight:u.totalHeight,getScrollPositionForFrame:m,getScrollPositionForScene:w}},xI=y.forwardRef(({prompts:e,collapsedScenes:t,checkedFrameNumbers:o,selectedFrameNumber:r,isLinked:a,onUpdatePrompts:i,onLoadFile:s,onSaveToCatalog:l,onSaveToDisk:c,t:d,onSelect:u,onToggleCollapse:p,onToggleScene:m,onDetachToEditor:w,onClearAll:k,onAddPrompt:b,onAddScene:x,onDeletePrompt:f,onMovePromptUp:h,onMovePromptDown:v,onMoveToStart:N,onMoveToEnd:_,onRegenerate:E,isAnyGenerationInProgress:I,onEditInSource:B,onEditPrompt:M,isGeneratingSequence:G,allConceptsLength:V,selectionKey:j="checkedSourceFrameNumbers",onUnlink:P,addToast:S,onClearTextOnly:A,sceneContexts:O={},onUpdateSceneContext:z,expandedSceneContexts:L=[],onToggleSceneContext:W,checkedContextScenes:D=[],onToggleContextCheck:T,onCopyCombinedPrompt:F},te)=>{const $=y.useRef(null),[Y,oe]=y.useState(0),[le,K]=y.useState(800),[ie,Z]=y.useState(!1),[se,de]=y.useState(""),[re,R]=y.useState(""),[J,H]=y.useState(""),[U,ee]=y.useState(!0),[ae,xe]=y.useState(!0);y.useEffect(()=>{if(!$.current)return;const He=()=>{$.current&&requestAnimationFrame(()=>{$.current&&(K($.current.clientHeight),oe($.current.scrollTop))})},be=new ResizeObserver(He);return be.observe($.current),He(),()=>be.disconnect()},[]);const{groupedPrompts:ne,totalHeight:X,visibleItems:ue,getScrollPositionForFrame:Q}=fI(e,t,Y,le,U,ae,O,L,D);y.useImperativeHandle(te,()=>({scrollToFrame:He=>{const be=Q(He);be!==null&&$.current&&$.current.scrollTo({top:Math.max(0,be-100),behavior:"smooth"})},scrollToBottom:()=>{$.current&&$.current.scrollTo({top:$.current.scrollHeight,behavior:"smooth"})}}));const ce=He=>{const be=parseInt(He||se,10);if(isNaN(be))return;const Ae=e.find(nt=>nt.frameNumber===be);if(!Ae)return;const Te=Ae.sceneNumber||1;let qe=[...t];qe.includes(Te)&&(qe=qe.filter(nt=>nt!==Te));const Ye=e.map(nt=>nt.frameNumber===be?{...nt,isCollapsed:!1}:nt);i({prompts:Ye,sourcePrompts:Ye,collapsedScenes:qe,collapsedSourceScenes:qe,selectedFrameNumber:be}),setTimeout(()=>{const nt=Q(be);nt!==null&&$.current&&$.current.scrollTo({top:nt,behavior:"smooth"})},100)},pe=He=>{if(He.preventDefault(),He.stopPropagation(),Z(!1),a)return;const be=He.dataTransfer.files[0];if(be&&be.type==="application/json"){const Ae=new FileReader;Ae.onload=Te=>{var qe;if((qe=Te.target)!=null&&qe.result)try{const Ye=JSON.parse(Te.target.result);let nt=Ye.finalPrompts||Ye.prompts||(Array.isArray(Ye)?Ye:[]),Nt=Ye.sceneContexts||{};nt.length>0&&i({sourcePrompts:nt,prompts:nt,sceneContexts:Nt})}catch(Ye){console.error(Ye)}},Ae.readAsText(be)}},me=()=>{const He=parseInt(re,10),be=parseInt(J,10);if(isNaN(He)||isNaN(be))return;const Ae=Math.max(1,He),Te=Math.min(e.length,be);if(Ae>Te)return;const qe=[];for(let Ye=Ae;Ye<=Te;Ye++)qe.push(Ye);i({[j]:qe})},ke=()=>i({[j]:e.map(He=>He.frameNumber)}),Re=()=>i({[j]:[]}),Me=()=>{const be=e.map(Ae=>Ae.frameNumber).filter(Ae=>!o.includes(Ae));i({[j]:be})},De=ne.length>0&&ne.every(He=>t.includes(He.scene)),Ie=()=>{const He=ne.map(Ae=>Ae.scene),be=De?[]:He;i({collapsedScenes:be,collapsedSourceScenes:be})},Ne=e.every(He=>He.isCollapsed),Pe=()=>{const He=e.map(be=>({...be,isCollapsed:!Ne}));i({prompts:He,sourcePrompts:He})},ye=(He,be)=>{if(a)return;const Ae=e.map(Te=>Te.frameNumber===He?{...Te,...be}:Te);i({prompts:Ae,sourcePrompts:Ae})},_e=(He,be)=>{if(be){i({[j]:[He]});return}const Ae=o.includes(He)?o.filter(Te=>Te!==He):[...o,He];i({[j]:Ae})},Fe=He=>{navigator.clipboard.writeText(He),S&&S(d("toast.copiedToClipboard"))},We=()=>{A?A():k()},Ze=He=>{const be=ne.find(Ye=>Ye.scene===He);if(!be)return;const Ae=be.prompts.map(Ye=>Ye.frameNumber),Te=Ae.every(Ye=>o.includes(Ye));let qe;Te?qe=o.filter(Ye=>!Ae.includes(Ye)):qe=[...new Set([...o,...Ae])],i({[j]:qe})},$e=He=>{const be=ne.find(Ae=>Ae.scene===He);return!be||be.prompts.length===0?!1:be.prompts.every(Ae=>o.includes(Ae.frameNumber))};return n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-h-0",children:[n.jsxs("div",{className:"flex justify-between items-center flex-shrink-0 bg-gray-900/50 p-1 rounded-md border border-gray-700 h-9",onWheel:He=>He.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center space-x-1 h-full",children:[a&&n.jsx("button",{className:"text-cyan-400 hover:text-white transition-colors",title:"Linked to Upstream (Click to Unlink and Copy)",onClick:He=>{He.stopPropagation(),P&&P()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),!a&&e.length>0&&w&&n.jsx(we,{title:"Detach and Edit",onClick:w,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-400 hover:text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),n.jsx("h3",{className:"text-sm font-bold text-gray-300 px-1 whitespace-nowrap",children:d("image_sequence.prompts_list_title")||"Prompts"}),n.jsx("div",{className:"flex items-center",children:n.jsx(Or,{value:se,placeholder:"#",onChange:He=>{de(He),ce(He)},min:1,className:"w-12 border-none",title:"Go to Frame"})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsxs("div",{className:"flex items-center gap-1 bg-gray-800 rounded p-0.5 h-6",children:[n.jsx("span",{className:"text-[9px] text-gray-400 px-1 whitespace-nowrap",children:d("image_sequence.range_from")}),n.jsx(Or,{value:re,placeholder:"1",onChange:R,min:1,className:"w-10 border-none"}),n.jsx("span",{className:"text-[9px] text-gray-400 px-1 whitespace-nowrap",children:d("image_sequence.range_to")}),n.jsx(Or,{value:J,placeholder:"N",onChange:H,min:1,className:"w-10 border-none"}),n.jsx(we,{title:"Select range",onClick:He=>{He.stopPropagation(),me()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-800 rounded p-0.5 h-6",children:[n.jsx(we,{title:d("image_sequence.select_all"),onClick:ke,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600"}),n.jsx(we,{title:d("image_sequence.select_none"),onClick:Re,disabled:o.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600"}),n.jsx(we,{title:d("image_sequence.invert_selection"),onClick:Me,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})})]})]}),n.jsxs("div",{className:"flex items-center space-x-1 h-full",children:[n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-900/50 rounded p-0.5",children:[n.jsx(we,{title:"Add Scene",onClick:x,disabled:a,children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m-3-3h6"})]})}),n.jsx(we,{title:d("image_sequence.add_frame"),onClick:()=>b(-1),disabled:a,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(we,{title:U?" -":" -",onClick:()=>ee(!U),children:U?n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})}),n.jsx(we,{title:ae?" ":" ",onClick:()=>xe(!ae),children:ae?n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(we,{title:De?"Expand Scenes":"Collapse Scenes",onClick:Ie,children:De?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})}),n.jsx(we,{title:Ne?"Expand Prompts":"Collapse Prompts",onClick:Pe,disabled:De,children:Ne?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),!a&&n.jsx(we,{title:d("image_sequence.clear_prompts_only"),onClick:We,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),n.jsx("div",{ref:$,className:`flex-grow min-h-0 bg-gray-900/50 p-2 rounded-md border-2 border-dashed transition-colors overflow-y-auto scrollbar-gutter-stable ${ie?"border-cyan-500 bg-gray-700/50":"border-transparent"} ${ie?"bg-cyan-900/20":""}`,onScroll:He=>oe(He.currentTarget.scrollTop),onDragOver:He=>{He.preventDefault(),He.stopPropagation(),Z(!0)},onDragLeave:()=>Z(!1),onDrop:pe,onWheel:He=>He.stopPropagation(),style:{overscrollBehaviorY:"contain"},children:e.length===0?n.jsx("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500 p-4 cursor-pointer",onClick:()=>!a&&b(-1),children:a?n.jsxs(n.Fragment,{children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-gray-400 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),n.jsx("p",{className:"font-semibold text-sm",children:"Linked to References"}),n.jsx("p",{className:"text-xs",children:"Waiting for data..."})]}):n.jsxs(n.Fragment,{children:[n.jsx("h4",{className:"font-semibold text-sm",children:d("image_sequence.drop_or_add_title")}),n.jsx("p",{className:"text-xs",children:d("image_sequence.drop_or_add_desc")})]})}):n.jsx("div",{style:{height:X,position:"relative"},children:ue.map(He=>{if(He.type==="scene_header"){const be=He.data,Ae=t.includes(be.scene);return n.jsx("div",{style:{position:"absolute",top:He.top,left:0,right:0,height:He.h,paddingBottom:4},children:n.jsx("div",{className:"flex items-center justify-between bg-gray-800 p-1 rounded select-none cursor-pointer hover:bg-gray-700 transition-colors h-full",onClick:Te=>{Te.stopPropagation(),m(be.scene)},children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"text-gray-400",children:Ae?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),n.jsxs("div",{className:"flex items-center gap-2",onClick:Te=>Te.stopPropagation(),children:[n.jsx(Ht,{checked:T&&D?D.includes(be.scene):!1,onChange:()=>T&&T(be.scene),title:"Include Context in Modification"}),n.jsx(Ht,{checked:$e(be.scene),onChange:()=>Ze(be.scene),title:"Select All Frames in Scene",className:"text-cyan-400"})]}),n.jsxs("span",{className:"text-xs font-bold text-gray-300 uppercase tracking-wider bg-gray-800 px-2 py-1 rounded",children:[d("image_sequence.scene_input_label")," ",be.scene,be.title?`: ${be.title}`:""]}),n.jsxs("span",{className:"text-[10px] text-gray-500",children:["(",be.prompts.length," frames)"]})]})})},`header-${be.scene}`)}else if(He.type==="scene_context"){const be=He.data,Ae=He.scene,Te=L.includes(Ae);return n.jsx("div",{style:{position:"absolute",top:He.top,left:0,right:0,height:He.h},className:"pl-2 border-l-2 border-connection-text ml-2 pb-2",children:n.jsxs("div",{className:"bg-gray-800/80 rounded border border-connection-text p-2 h-full flex flex-col",children:[n.jsx("div",{className:"flex justify-between items-center cursor-pointer select-none",onClick:qe=>{qe.stopPropagation(),W&&W(Ae)},children:n.jsx("div",{className:"flex items-center gap-2",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{onClick:qe=>qe.stopPropagation(),children:n.jsx(Ht,{checked:T&&D?D.includes(Ae):!1,onChange:()=>T&&T(Ae),title:"Include Context in Modification"})}),n.jsx("div",{className:"text-connection-text",children:Te?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})}),n.jsx("label",{className:"text-[10px] font-bold text-connection-text uppercase tracking-wider cursor-pointer",children:"SCENE CONTEXT"})]})})}),Te&&n.jsx("div",{className:"flex-grow min-h-0 mt-2",children:n.jsx(Cn,{value:be,onDebouncedChange:qe=>z&&z(Ae,qe),readOnly:a,className:`w-full h-full text-xs p-1.5 bg-gray-900/50 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-1 focus:ring-accent ${a?"cursor-default":"cursor-text"}`,placeholder:"Describe scene environment and context...",onMouseDown:qe=>qe.stopPropagation(),onWheel:qe=>qe.stopPropagation()})})]})},`context-${Ae}`)}else{const be=He.data,Ae=e.findIndex(qe=>qe.frameNumber===be.frameNumber),Te=r===be.frameNumber;return n.jsx("div",{style:{position:"absolute",top:He.top,left:0,right:0,height:He.h},className:"pl-2 border-l-2 border-gray-700 ml-2",children:n.jsx(gI,{index:Ae,frameNumber:be.frameNumber,sceneNumber:be.sceneNumber,prompt:be.prompt,videoPrompt:be.videoPrompt,shotType:be.shotType,characters:be.characters,duration:be.duration||0,isSelected:Te,isCollapsed:be.isCollapsed??!1,onToggleCollapse:()=>p(be.frameNumber),onSelect:()=>u(be.frameNumber),onChange:ye,onCopy:qe=>Fe(qe),onCopyVideo:qe=>Fe(qe),t:d,readOnly:a,isChecked:o.includes(be.frameNumber),onCheck:(qe,Ye)=>_e(qe,Ye),onDelete:()=>f(be.frameNumber),onAddAfter:()=>b(be.frameNumber),onMoveUp:()=>h(Ae),onMoveDown:()=>v(Ae),onMoveToStart:()=>N(Ae),onMoveToEnd:()=>_(Ae),isFirst:Ae===0,isLast:Ae===e.length-1,showVideoPrompts:U,onRegenerate:E,isAnyGenerationInProgress:I||G,onEditInSource:B,onEditPrompt:M,maxCharacters:V,onCopyCombinedPrompt:F})},`prompt-${be.frameNumber}`)}})})}),!a&&n.jsxs("div",{className:"flex-shrink-0 flex space-x-2",children:[n.jsx("div",{className:"flex-1 flex space-x-1",children:n.jsx("button",{onClick:s,className:"flex-1 px-3 py-2 text-sm font-semibold text-white bg-accent-secondary hover:bg-accent-secondary-hover rounded-md",children:d("image_sequence.load_prompts")})}),n.jsx("button",{onClick:l,disabled:e.length===0,className:"flex-1 px-3 py-2 text-sm font-semibold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",title:d("catalog.saveTo"),children:d("catalog.saveTo")}),n.jsx(we,{title:d("group.saveToDisk"),onClick:c,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]})]})}),yI=({width:e,height:t})=>{const o=e/t;let r="",a="";return o>1.2?(r="M2 6h20v12H2z",a="Landscape"):o<.85?(r="M6 2h12v20H6z",a="Portrait"):(r="M4 4h16v16H4z",a="Square"),n.jsx("div",{className:"flex items-center justify-center w-6 h-6",title:a,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-white",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:r})})})},vI=At.memo(({index:e,frameNumber:t,imageUrl:o,fullSizeImageUrl:r,status:a,isSelected:i,onSelect:s,onDoubleClick:l,onRegenerate:c,onDownload:d,onCopy:u,onCopyTextPrompt:p,onCopyVideo:m,onStop:w,isGeneratingSequence:k,isAnyGenerationInProgress:b,t:x,isChecked:f,onCheck:h,prompt:v,videoPrompt:N,onOpenRaster:_,onOpenAI:E,onReplaceImage:I,onEditPrompt:B,readOnlyPrompt:M,onEditInSource:G,characterIndices:V,onExpandFrame:j,shotType:P,onReportDimensions:S,onCopyCombinedPrompt:A})=>{const O={idle:"bg-gray-800",pending:"bg-gray-700/50",prompt_processing:"bg-yellow-800/50 animate-pulse",generating:"bg-blue-800/50 animate-pulse",done:"bg-gray-800",error:"bg-red-800/50"},z={idle:"",pending:x("image_sequence.status.pending")||"Queued",prompt_processing:"Processing...",generating:"Generating...",done:"",error:x("image_sequence.status.error")},[L,W]=y.useState(!1),[D,T]=y.useState(null),F=y.useCallback(re=>{re.stopPropagation(),s(t)},[t,s]),te=y.useCallback(re=>{re.stopPropagation(),(r||o)&&_(t,r||o)},[t,r,o,_]),$=y.useCallback(re=>{re.stopPropagation(),(r||o)&&E(r||o)},[r,o,E]),Y=re=>{a==="generating"||a==="prompt_processing"||(re.preventDefault(),re.stopPropagation(),W(!0))},oe=re=>{a==="generating"||a==="prompt_processing"||(re.preventDefault(),re.stopPropagation(),W(!0))},le=re=>{a==="generating"||a==="prompt_processing"||(re.preventDefault(),re.stopPropagation(),W(!1))},K=y.useCallback(re=>{if(a==="generating"||a==="prompt_processing")return;re.preventDefault(),re.stopPropagation(),W(!1);const R=re.dataTransfer.getData("application/prompt-modifier-drag-image");if(R){R.startsWith("data:")?I(t,R):fetch(R).then(H=>H.blob()).then(H=>{const U=new FileReader;U.onload=ee=>{var ae;(ae=ee.target)!=null&&ae.result&&I(t,ee.target.result)},U.readAsDataURL(H)});return}const J=re.dataTransfer.files;if(J&&J.length>0){const H=J[0];if(H.type.startsWith("image/")){const U=new FileReader;U.onload=ee=>{var ae;(ae=ee.target)!=null&&ae.result&&I(t,ee.target.result)},U.readAsDataURL(H)}}},[t,I,a]),ie=re=>{const R=re.currentTarget,J=R.naturalWidth,H=R.naturalHeight;T({width:J,height:H}),S&&S(t,J,H)},Z="p-1 rounded-md text-[#dad5cf] hover:bg-gray-600 hover:text-white transition-colors focus:outline-none pointer-events-auto disabled:cursor-not-allowed disabled:opacity-50",se=a==="prompt_processing"||a==="generating",de=!!o;return n.jsxs("div",{onClick:F,onDragEnter:Y,onDragOver:oe,onDragLeave:le,onDrop:K,className:`relative group border-2 transition-colors h-full w-full ${L?"border-accent bg-gray-700/50":i?"border-accent":"border-transparent"} ${O[a]}`,children:[n.jsx("div",{className:"absolute top-1 left-1 z-20 pointer-events-auto",title:"Select frame for batch generation",children:n.jsx(Ht,{checked:!!f,onChange:(re,R)=>h(t,R.shiftKey)})}),n.jsxs("div",{className:"w-full h-full overflow-hidden rounded-lg pointer-events-none relative",children:[de&&n.jsx("img",{src:o,className:`w-full h-full object-cover cursor-pointer ${se?"opacity-50 blur-[2px]":""}`,alt:`Frame ${t}`,style:{pointerEvents:"auto"},draggable:!0,onLoad:ie,onMouseDown:re=>re.stopPropagation(),onClick:re=>{re.stopPropagation(),l(t)},onDragStart:re=>{re.dataTransfer.setData("application/prompt-modifier-drag-image",r||o||""),re.dataTransfer.effectAllowed="copy",re.stopPropagation()}}),(a==="pending"||se||a==="error"||a==="idle"&&!de)&&n.jsxs("div",{className:`absolute inset-0 flex flex-col items-center justify-center p-2 text-center z-10 ${de?"bg-black/40":""}`,children:[a!=="pending"&&a!=="idle"&&n.jsx("span",{className:"text-white font-semibold text-sm drop-shadow-md",children:z[a]}),a==="pending"&&!de&&n.jsx("span",{className:"text-white font-semibold text-sm drop-shadow-md",children:z[a]}),se&&n.jsxs(n.Fragment,{children:[n.jsxs("svg",{className:"animate-spin h-6 w-6 text-accent mt-2 drop-shadow-md",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n.jsx("div",{className:"flex space-x-2 mt-2 pointer-events-auto",children:n.jsx("button",{onClick:re=>{re.stopPropagation(),w(t)},className:"px-2 py-1 text-xs bg-red-600 hover:bg-red-700 rounded-md text-white font-semibold shadow-md",children:x("image_sequence.stop_queue")})})]})]})]}),!o&&a==="idle"&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:n.jsx("span",{className:"text-gray-600 text-xs",children:L?"Drop Image":""})}),!se&&a!=="pending"&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute inset-x-0 top-0 h-12 bg-gradient-to-b from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10"}),n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity z-30 pointer-events-auto",children:[m&&N&&n.jsx(we,{title:x("node.action.copyVideoPrompt"),tooltipPosition:"bottom",tooltipAlign:"start",onClick:re=>{re.stopPropagation(),m(N)},className:Z,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),o&&n.jsx(we,{title:x("node.action.copyImage"),tooltipPosition:"bottom",tooltipAlign:"center",onClick:re=>{re.stopPropagation(),u(t)},className:Z,children:n.jsx(zt,{className:"h-4 w-4"})}),n.jsx(we,{title:x("node.action.copyImagePrompt"),tooltipPosition:"bottom",tooltipAlign:"center",onClick:re=>{re.stopPropagation(),p(v)},className:Z,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),A&&n.jsx(we,{title:"Copy Combined Prompt",tooltipPosition:"bottom",tooltipAlign:"center",onClick:re=>{re.stopPropagation(),A(t)},className:Z,children:n.jsx(eh,{className:"h-4 w-4 text-orange-400 group-hover:text-orange-200"})}),o&&n.jsx(we,{title:x("node.action.download"),tooltipPosition:"bottom",tooltipAlign:"center",onClick:re=>{re.stopPropagation(),d(t,v)},className:Z,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(we,{title:x("image_sequence.regenerate"),tooltipPosition:"bottom",tooltipAlign:"end",onClick:re=>{re.stopPropagation(),c(t)},disabled:b,className:Z,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})}),(!M&&B||M&&G)&&n.jsx(we,{title:x(M?"image_sequence.edit_in_source":"image_sequence.edit_prompt"),tooltipPosition:"bottom",tooltipAlign:"end",onClick:re=>{re.stopPropagation(),M&&G?G(t):B&&B(t)},className:Z,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})})]}),o&&n.jsxs("div",{className:"absolute bottom-1 left-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity z-30 pointer-events-auto",children:[n.jsx(we,{title:x("node.action.rasterEditor"),tooltipPosition:"top",tooltipAlign:"start",onClick:te,className:"p-1 bg-emerald-600/80 rounded text-white hover:bg-emerald-700",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})}),n.jsx(we,{title:x("node.action.openInAIEditor"),tooltipPosition:"top",tooltipAlign:"start",onClick:$,className:"p-1 bg-cyan-600/80 rounded text-white hover:bg-cyan-700",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})}),n.jsx(we,{title:"Expand to 16:9",tooltipPosition:"top",tooltipAlign:"start",disabled:b,onClick:re=>{re.stopPropagation(),j&&j(t,"16:9")},className:`p-1 rounded text-white transition-colors ${b?"bg-gray-700/50 cursor-not-allowed opacity-50":"bg-gray-700/80 hover:bg-cyan-600"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"2",y:"8",width:"20",height:"8",rx:"1"})})}),n.jsx(we,{title:"Expand to 9:16",tooltipPosition:"top",tooltipAlign:"start",disabled:b,onClick:re=>{re.stopPropagation(),j&&j(t,"9:16")},className:`p-1 rounded text-white transition-colors ${b?"bg-gray-700/50 cursor-not-allowed opacity-50":"bg-gray-700/80 hover:bg-cyan-600"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",stroke:"currentColor",fill:"currentColor",children:n.jsx("rect",{x:"8",y:"2",width:"8",height:"20",rx:"1"})})})]}),V&&V.length>0&&n.jsx("div",{className:"absolute bottom-8 right-1 flex flex-col items-end space-y-0.5 z-10 pointer-events-none opacity-75 group-hover:opacity-100 transition-opacity",children:V.map((re,R)=>n.jsxs("div",{className:"bg-black/60 text-white text-[9px] font-bold px-1 rounded backdrop-blur-sm",children:["ENT-",re]},R))}),n.jsxs("div",{className:"absolute bottom-1 right-1 flex items-center space-x-1 z-10 pointer-events-none opacity-75",children:[n.jsxs("div",{className:"text-[10px] font-bold text-white bg-black/60 px-1.5 py-0.5 rounded-l-md h-6 flex items-center justify-center min-w-[20px]",children:[t,P?` [${P}]`:""]}),n.jsx("div",{className:"bg-black/60 h-6 flex items-center justify-center px-1 rounded-r-md",children:D?n.jsx(yI,{width:D.width,height:D.height}):n.jsx("span",{className:"text-[9px] text-gray-300 font-mono",children:"N/A"})})]})]})]})}),wI=({prompts:e,images:t,frameStatuses:o,selectedFrameNumber:r,checkedFrameNumbers:a,collapsedOutputScenes:i,isGeneratingSequence:s,isAnyFrameGenerating:l,t:c,onUpdateState:d,groupedPrompts:u,onRegenerate:p,onDownload:m,onCopy:w,onCopyPrompt:k,onCopyVideoPrompt:b,onStopFrame:x,onFrameSelect:f,onFrameDoubleClick:h,onCheckFrame:v,onOpenRaster:N,onOpenAI:_,onReplaceImage:E,onEditPrompt:I,onEditInSource:B,readOnlyPrompt:M,getFullSizeImage:G,onSelectByAspectRatio:V,onSelectSceneByAspectRatio:j,onSelectAll:P,onSelectNone:S,onInvertSelection:A,onRunSelected:O,onDownloadSelected:z,onForceRefresh:L,onExpandFrame:W,onExpandSelected:D,onReportDimensions:T,onClearImages:F,onCopyCombinedPrompt:te})=>{const $=y.useRef(null),[Y,oe]=y.useState(0),[le,K]=y.useState(800),[ie,Z]=y.useState(600),[se,de]=y.useState(""),[re,R]=y.useState(""),[J,H]=y.useState(""),U=Object.keys(t).length,ee=Object.values(o).filter(Ie=>Ie==="pending"||Ie==="generating").length,ae=e.length;y.useEffect(()=>{if(!$.current)return;const Ie=()=>{$.current&&requestAnimationFrame(()=>{$.current&&(K($.current.clientWidth),Z($.current.clientHeight))})},Ne=new ResizeObserver(Ie);return Ne.observe($.current),Ie(),()=>Ne.disconnect()},[]);const xe=y.useMemo(()=>{const Ie=Math.max(0,le-20),Ne=Math.floor(Ie/(dI+j0))||1,Pe=[];let ye=0;return u.forEach(_e=>{if(Pe.push({type:"scene_header",h:40,top:ye,data:_e,scene:_e.scene}),ye+=40,!i.includes(_e.scene)){const Fe=Math.ceil(_e.prompts.length/Ne),We=Fe>0?Fe*uI+Math.max(0,Fe-1)*j0+24:0;Pe.push({type:"scene_grid",h:Math.max(0,We),top:ye,data:_e,scene:_e.scene}),ye+=Math.max(0,We)}}),{items:Pe,totalHeight:ye}},[u,i,le]),ne=()=>{const Ne=Math.max(0,Y-800),Pe=Y+ie+800;return xe.items.filter(ye=>ye.top+ye.h>Ne&&ye.top<Pe)},X=()=>{const Ie=se===""?1:parseInt(se,10),Ne=re===""?ae:parseInt(re,10);if(isNaN(Ie)||isNaN(Ne))return;const Pe=Math.max(1,Ie),ye=Math.min(ae,Ne);if(Pe>ye)return;const _e=[];for(let Fe=Pe;Fe<=ye;Fe++)_e.push(Fe);d({checkedFrameNumbers:_e})},ue=Ie=>{setTimeout(()=>{const Ne=u.findIndex(Pe=>Pe.scene===Ie);if(Ne!==-1&&$.current){const Pe=Ne*40;$.current.scrollTo({top:Pe,behavior:"smooth"})}},50)},Q=Ie=>{const Ne=Ie!==void 0?Ie:J===""?1:parseInt(J,10);if(isNaN(Ne))return;const Pe=u.find(We=>We.scene===Ne);if(!Pe)return;const ye=Pe.prompts.map(We=>We.frameNumber),Fe=u.map(We=>We.scene).filter(We=>We!==Ne);d({checkedFrameNumbers:ye,collapsedOutputScenes:Fe}),Ie!==void 0&&H(Ie.toString()),ue(Ne)},ce=()=>{const Ie=parseInt(J,10)||1,Ne=u.map(ye=>ye.scene).sort((ye,_e)=>ye-_e),Pe=Ne.indexOf(Ie);Pe!==-1&&Pe<Ne.length-1?Q(Ne[Pe+1]):Pe===-1&&Ne.length>0&&Q(Ne[0])},pe=()=>{const Ie=parseInt(J,10)||1,Ne=u.map(ye=>ye.scene).sort((ye,_e)=>ye-_e),Pe=Ne.indexOf(Ie);Pe>0?Q(Ne[Pe-1]):Pe===-1&&Ne.length>0&&Q(Ne[Ne.length-1])},me=u.length>0&&u.every(Ie=>i.includes(Ie.scene)),ke=()=>{const Ie=u.map(Pe=>Pe.scene);d({collapsedOutputScenes:me?[]:Ie})},Re=()=>{F?F():d({sequenceOutputs:[]})},Me=Ie=>{const Ne=u.find(Fe=>Fe.scene===Ie);if(!Ne)return;const Pe=Ne.prompts.map(Fe=>Fe.frameNumber),ye=Pe.every(Fe=>a.includes(Fe));let _e;ye?_e=a.filter(Fe=>!Pe.includes(Fe)):_e=[...new Set([...a,...Pe])],d({checkedFrameNumbers:_e})},De=Ie=>{const Ne=u.find(Pe=>Pe.scene===Ie);return!Ne||Ne.prompts.length===0?!1:Ne.prompts.every(Pe=>a.includes(Pe.frameNumber))};return n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-h-0 pl-1",children:[n.jsxs("div",{className:"flex justify-between items-center flex-shrink-0 bg-gray-900/50 p-1 rounded-md border border-gray-700 mb-1",children:[n.jsxs("div",{className:"flex items-center space-x-3 px-1",children:[n.jsx("h3",{className:"text-sm font-bold text-gray-300 flex-shrink-0",children:c("image_sequence.output_images_title")}),n.jsxs("div",{className:"text-[10px] text-gray-400 flex space-x-2 border-l border-gray-600 pl-3",children:[n.jsx("span",{children:c("image_sequence.stats.total",{count:ae})}),n.jsx("span",{className:U>0?"text-accent":"",children:c("image_sequence.stats.generated",{count:U})}),ee>0&&n.jsx("span",{className:"text-accent animate-pulse",children:c("image_sequence.stats.queue",{count:ee})})]})]}),n.jsx(we,{title:c("image_sequence.force_refresh"),onClick:L,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-accent",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),n.jsxs("div",{className:"flex items-center justify-between gap-2 bg-gray-900/50 p-1 rounded-md border border-gray-700 mb-1",children:[n.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0",children:[n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-800 rounded border border-gray-600 px-1 py-0.5",children:[n.jsx("span",{className:"text-[10px] text-gray-400 pr-1 whitespace-nowrap",children:c("image_sequence.range_from")}),n.jsx(Or,{value:se,placeholder:"1",onChange:de,min:1,className:"w-12 border-none"}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx("span",{className:"text-[10px] text-gray-400 pr-1 whitespace-nowrap",children:c("image_sequence.range_to")}),n.jsx(Or,{value:re,placeholder:"Last",onChange:R,min:1,className:"w-12 border-none"}),n.jsx(we,{title:c("image_sequence.select_range"),onClick:Ie=>{Ie.stopPropagation(),X()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-800 rounded border border-gray-600 px-1 py-0.5",children:[n.jsx("span",{className:"text-[10px] text-gray-400 px-1 whitespace-nowrap",children:c("image_sequence.scene_input_label")}),n.jsx(Or,{value:J,placeholder:"1",onChange:H,min:1,className:"w-14 border-none"}),n.jsx(we,{title:c("image_sequence.select_scene"),onClick:Ie=>{Ie.stopPropagation(),Q()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white transition-colors",onClick:Ie=>{Ie.stopPropagation(),pe()},title:c("image_sequence.prev_scene"),children:n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:n.jsx("path",{d:"M15 18l-6-6 6-6"})})}),n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white transition-colors",onClick:Ie=>{Ie.stopPropagation(),ce()},title:c("image_sequence.next_scene"),children:n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:n.jsx("path",{d:"M9 18l6-6-6-6"})})})]})]}),n.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0 ml-auto",children:[n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-800 rounded p-0.5",children:[n.jsx(we,{title:c("image_sequence.select_square"),onClick:()=>V("square"),disabled:U===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"1"})})}),n.jsx(we,{title:c("image_sequence.select_landscape"),onClick:()=>V("landscape"),disabled:U===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"2",y:"7",width:"20",height:"10",rx:"1"})})}),n.jsx(we,{title:c("image_sequence.select_portrait"),onClick:()=>V("portrait"),disabled:U===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"7",y:"2",width:"10",height:"20",rx:"1"})})})]}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(we,{title:c("image_sequence.select_all"),onClick:P,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${e.length===0?"text-gray-600":"text-green-400"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(we,{title:c("image_sequence.select_none"),onClick:S,disabled:a.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${a.length===0?"text-gray-600":"text-red-400"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(we,{title:c("image_sequence.invert_selection"),onClick:A,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${e.length===0?"text-gray-600":"text-gray-300"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(we,{title:c("image_sequence.run_selected"),onClick:O,disabled:s||l||a.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${s||l||a.length===0?"text-gray-600":"text-emerald-400"}`,viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),n.jsx(we,{title:`${c("image_sequence.download_selected")} (${a.length})`,onClick:z,disabled:a.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${a.length===0?"text-gray-600":"text-sky-400"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(we,{title:c("node.action.clear"),onClick:Re,disabled:Object.keys(t).length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${Object.keys(t).length===0?"text-gray-600":"text-gray-300 hover:text-white"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),n.jsx(we,{title:me?"  ":"  ",onClick:ke,children:me?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})})]}),n.jsx("div",{ref:$,onScroll:Ie=>oe(Ie.currentTarget.scrollTop),className:"flex-grow bg-gray-900/50 rounded-md p-2 overflow-y-auto custom-scrollbar overflow-x-hidden scrollbar-gutter-stable",onWheel:Ie=>Ie.stopPropagation(),style:{overscrollBehaviorY:"contain"},children:n.jsx("div",{style:{height:xe.totalHeight,position:"relative"},children:ne().map(Ie=>{var Pe,ye;const Ne=Ie.data;if(Ie.type==="scene_header"){const _e=i.includes(Ne.scene),Fe=(Pe=Ne.prompts[0])==null?void 0:Pe.frameNumber,We=(ye=Ne.prompts[Ne.prompts.length-1])==null?void 0:ye.frameNumber,Ze=Fe!==void 0&&We!==void 0?`(${Fe}-${We})`:"";return n.jsx("div",{style:{position:"absolute",top:Ie.top,left:0,right:0,height:Ie.h,paddingBottom:4},children:n.jsxs("div",{className:"flex items-center justify-between mb-2 pb-1 border-b border-gray-700 cursor-pointer hover:bg-gray-800/50 rounded transition-colors p-1 h-full",onClick:()=>{const $e=i.includes(Ne.scene)?i.filter(He=>He!==Ne.scene):[...i,Ne.scene];d({collapsedOutputScenes:$e})},children:[n.jsxs("div",{className:"flex items-center gap-2 overflow-hidden flex-grow mr-2",children:[n.jsx("div",{className:"text-gray-400 flex-shrink-0",children:_e?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),n.jsxs("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider bg-gray-800 px-2 py-1 rounded truncate",title:`${c("image_sequence.scene_input_label")} ${Ne.scene}${Ne.title?`: ${Ne.title}`:""}`,children:[c("image_sequence.scene_input_label")," ",Ne.scene,Ne.title?`: ${Ne.title}`:""]})]}),n.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[n.jsx("span",{className:"text-[10px] text-gray-500 font-medium whitespace-nowrap",children:_e?c("image_sequence.frames_hidden",{count:Ne.prompts.length}):c("image_sequence.frames_count",{count:Ne.prompts.length})}),n.jsx("span",{className:"text-[10px] text-gray-500 font-mono whitespace-nowrap",children:Ze}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(we,{title:c("image_sequence.select_square"),onClick:$e=>{$e.stopPropagation(),j(Ne.scene,"square")},disabled:!1,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"1"})})}),n.jsx(we,{title:c("image_sequence.select_landscape"),onClick:$e=>{$e.stopPropagation(),j(Ne.scene,"landscape")},disabled:!1,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"2",y:"7",width:"20",height:"10",rx:"1"})})}),n.jsx(we,{title:c("image_sequence.select_portrait"),onClick:$e=>{$e.stopPropagation(),j(Ne.scene,"portrait")},disabled:!1,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"7",y:"2",width:"10",height:"20",rx:"1"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(we,{title:"Focus Scene (Collapse others)",tooltipPosition:"left",onClick:$e=>{$e.stopPropagation(),Q(Ne.scene)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-accent hover:text-accent-hover",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Ht,{checked:De(Ne.scene),onChange:()=>Me(Ne.scene),title:"Select All Frames in Scene",className:"text-accent"})]})]})]})},`grid-header-${Ne.scene}`)}else{const _e=Ie.data;return n.jsx("div",{style:{position:"absolute",top:Ie.top,left:0,right:0,height:Ie.h},children:n.jsx("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-4 pl-2",children:_e.prompts.map(Fe=>{const We=[];Fe.characters&&Array.isArray(Fe.characters)&&Fe.characters.forEach(be=>{const Ae=be.match(/(?:character|entity)-(\d+)/i);Ae&&We.push(Ae[1])});const Ze=t[Fe.frameNumber],$e=G(1e3+Fe.frameNumber),He=Ze||$e;return n.jsx("div",{className:"w-full h-[200px]",children:n.jsx(vI,{index:Fe.frameNumber,frameNumber:Fe.frameNumber,imageUrl:He,fullSizeImageUrl:$e||He,status:o[Fe.frameNumber]||"idle",isSelected:r===Fe.frameNumber,onSelect:f,onDoubleClick:h,onRegenerate:p,onDownload:(be,Ae)=>m(be,Ae),onCopy:w,onCopyTextPrompt:k,onCopyVideo:b,onStop:x,isGeneratingSequence:!!s,isAnyGenerationInProgress:!!s||l,t:c,isChecked:a.includes(Fe.frameNumber),onCheck:v,prompt:Fe.prompt,videoPrompt:Fe.videoPrompt,onOpenRaster:N,onOpenAI:_,onReplaceImage:E,onEditPrompt:I,readOnlyPrompt:M,onEditInSource:B,characterIndices:We,onExpandFrame:W,shotType:Fe.shotType,onReportDimensions:T,onCopyCombinedPrompt:te})},Fe.frameNumber)})})},`grid-content-${_e.scene}`)}})})})]})},bI=({model:e,autoCrop169:t,autoDownload:o,createZip:r,isGeneratingSequence:a,isAnyFrameGenerating:i,checkedCount:s,promptsLength:l,onUpdateState:c,onGenerateSelected:d,onDownloadSelected:u,onStartQueue:p,onExpandSelected:m,t:w})=>{const k=[{value:"gemini-2.5-flash-image",label:"Gemini 2.5 Flash Image"},{value:"imagen-4.0-generate-001",label:"Imagen 4.0"}];return n.jsxs("div",{className:"flex-shrink-0 space-y-2 mt-2",children:[n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:w("node.content.generationMode")}),n.jsx(An,{value:e,onChange:b=>c({model:b}),disabled:a,options:k})]}),n.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-2",children:[n.jsx(Ht,{id:"auto-crop-169",checked:!!t,onChange:b=>c({autoCrop169:b}),label:w("image_sequence.auto_crop"),title:w("image_sequence.tooltip.autoCrop"),className:"text-sm text-gray-300"}),n.jsx(Ht,{id:"auto-download",checked:o,onChange:b=>c({autoDownload:b}),label:w("node.content.autoDownload"),title:w("image_sequence.tooltip.autoDownload"),className:"text-sm text-gray-300"}),n.jsx(Ht,{id:"create-zip",checked:!!r,onChange:b=>c({createZip:b}),label:w("image_sequence.create_zip"),title:w("image_sequence.tooltip.createZip"),className:"text-sm text-gray-300"})]}),n.jsxs("div",{className:"flex space-x-2 mb-2",children:[n.jsxs("button",{onClick:d,disabled:a||i||s===0,className:"flex-1 py-2 text-sm font-semibold text-white bg-accent-secondary hover:bg-accent-secondary-hover rounded-md disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",children:[w("image_sequence.run_selected")," (",s,")"]}),n.jsxs("button",{onClick:()=>m("16:9"),disabled:a||i||s===0,className:"flex-shrink-0 w-20 py-2 text-xs font-bold text-white bg-accent hover:bg-accent-hover rounded-md disabled:bg-gray-700 disabled:text-gray-500 transition-colors flex items-center justify-center gap-2",title:"Expand Selected to 16:9",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"2",y:"8",width:"20",height:"8",rx:"1"})}),"16:9"]}),n.jsxs("button",{onClick:()=>m("9:16"),disabled:a||i||s===0,className:"flex-shrink-0 w-20 py-2 text-xs font-bold text-white bg-accent hover:bg-accent-hover rounded-md disabled:bg-gray-700 disabled:text-gray-500 transition-colors flex items-center justify-center gap-2",title:"Expand Selected to 9:16",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"8",y:"2",width:"8",height:"20",rx:"1"})}),"9:16"]}),n.jsx("button",{onClick:u,disabled:s===0,className:"flex-1 py-2 text-sm font-semibold text-white bg-accent-secondary hover:bg-accent-secondary-hover rounded-md disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",children:r?"Download ZIP":`${w("image_sequence.download_selected")} (${s})`})]}),n.jsx("div",{children:n.jsx("button",{onClick:p,disabled:a||i||l===0,className:`w-full py-2 rounded-md font-semibold transition-colors ${a||i?"bg-gray-600 text-gray-300 cursor-not-allowed":"bg-accent hover:bg-accent-hover text-white"}`,children:w(a||i?"node.content.generating":"image_sequence.start_queue")})})]})},zo=640,I0=660,CI=390,kI=37,js="Integrate these Entities into the scene, action and pose. Fill the background with environmental elements  fill in the gray area of the source scene image naturally.",_I=({node:e,onValueChange:t,onLoadImageSequenceFile:o,onGenerateImageSequence:r,onGenerateSelectedFrames:a,onStopImageSequence:i,isGeneratingSequence:s,onRegenerateFrame:l,onDownloadImageFromUrl:c,onCopyImageToClipboard:d,t:u,deselectAllNodes:p,connectedCharacterData:m,onDetachAndPasteConcept:w,onDetachImageToNode:k,onSaveSequenceToCatalog:b,setError:x,setImageViewer:f,getFullSizeImage:h,setFullSizeImage:v,connectedInputs:N,onRefreshUpstreamData:_,clearImagesForNodeFromCache:E,getUpstreamNodeValues:I,addToast:B,onSaveScriptToDisk:M,viewTransform:G})=>{const V=N==null?void 0:N.has("prompt_input"),j=Kt(),{nodes:P,onAddNode:S,connections:A,handleNavigateToNodeFrame:O,setConnections:z,setSelectedNodeIds:L}=j||{};y.useRef(null);const W=y.useRef(null),D=y.useRef(null),T=y.useRef(null),F=y.useRef(null),[te,$]=y.useState(!1),[Y,oe]=y.useState(null),le=y.useRef(null),[K,ie]=y.useState(null),[Z,se]=y.useState(!1),de=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{prompts:[],images:{},currentIndex:-1,isGenerating:!1,autoDownload:!1,selectedFrameNumber:null,frameStatuses:{},aspectRatio:"16:9",characterConcepts:[],model:"gemini-2.5-flash-image",characterPromptCombination:"replace",enableAspectRatio:!1,checkedFrameNumbers:[],styleOverride:"",isStyleSelected:!1,isStyleCollapsed:!0,isStyleInserted:!0,isSceneContextInserted:!0,isUsedCharsCollapsed:!0,isIntegrationSettingsCollapsed:!0,isCharacterPromptCombinationCollapsed:!0,integrationPrompt:js,usedCharacters:[],conceptsMode:"normal",connectedCharacterConfig:{},collapsedScenes:[],collapsedOutputScenes:[],autoCrop169:!0,leftPaneWidth:zo,createZip:!1,imageDimensions:{},sceneContexts:{},expandedSceneContexts:[],checkedContextScenes:[]}}},[e.value]),re=y.useRef(de);y.useEffect(()=>{re.current=de},[de]);let R=de.leftPaneWidth;!R&&de.leftPaneRatio?R=Math.max(zo,(e.width||1200)*de.leftPaneRatio):R||(R=zo);const{prompts:J=[],images:H={},selectedFrameNumber:U=null,frameStatuses:ee={},aspectRatio:ae="16:9",autoDownload:xe=!1,characterConcepts:ne=[],model:X="gemini-2.5-flash-image",characterPromptCombination:ue="replace",enableAspectRatio:Q=!1,checkedFrameNumbers:ce=[],styleOverride:pe="",isStyleCollapsed:me=!0,isStyleInserted:ke=!0,isSceneContextInserted:Re=!0,isUsedCharsCollapsed:Me=!0,isIntegrationSettingsCollapsed:De=!0,isCharacterPromptCombinationCollapsed:Ie=!0,integrationPrompt:Ne=js,usedCharacters:Pe=[],conceptsMode:ye="normal",collapsedScenes:_e=[],collapsedOutputScenes:Fe=[],autoCrop169:We=!0,leftPaneWidth:Ze=zo,createZip:$e=!1,imageDimensions:He={},sceneContexts:be={},expandedSceneContexts:Ae=[],checkedContextScenes:Te=[]}=de;y.useEffect(()=>{Ne||je({integrationPrompt:js})},[]);const qe=y.useMemo(()=>[...Pe].map((fe,Be)=>({...fe,originalIndex:Be})).sort((fe,Be)=>{const Oe=Je=>parseInt((Je||"0").replace(/[^0-9]/g,""),10);return Oe(fe.index)-Oe(Be.index)}),[Pe]),Ye=y.useMemo(()=>Object.values(ee).some(fe=>fe==="pending"||fe==="generating"),[ee]),nt=!!s||Ye,Nt=y.useMemo(()=>ye==="collapsed"?kI:ye==="expanded"?"100%":CI,[ye]);y.useMemo(()=>[...J].sort((fe,Be)=>fe.frameNumber-Be.frameNumber),[J]);const ze=y.useMemo(()=>{const fe=[...J].sort((lt,tt)=>lt.frameNumber-tt.frameNumber),Be=[];let Oe=-1,Je=null;return fe.forEach(lt=>{const tt=lt.sceneNumber||1;if(tt!==Oe){Oe=tt;const yt=lt.sceneTitle||"";Je={scene:tt,title:yt,prompts:[]},Be.push(Je)}Je&&Je.prompts.push(lt)}),Be},[J]),je=y.useCallback(fe=>{const Oe={...re.current,...fe};re.current=Oe,t(e.id,JSON.stringify(Oe))},[e.id,t]);y.useEffect(()=>{if(!e.width)return;const fe=e.width-I0;Ze>fe?je({leftPaneWidth:Math.max(zo,fe)}):Ze<zo&&je({leftPaneWidth:zo})},[e.width,Ze,je]);const Le=m||[],rt=y.useMemo(()=>[...Le].sort((fe,Be)=>{const Oe=parseInt((fe.alias||"0").replace(/[^0-9]/g,""),10),Je=parseInt((Be.alias||"0").replace(/[^0-9]/g,""),10);return Oe-Je}),[Le]),Ce=rt.length,Se=y.useMemo(()=>{const fe=rt.map((Oe,Je)=>{var lt;return{...Oe,id:Oe.index||Oe.alias||Oe.name||`upstream-stable-${Je}`,index:Oe.index||Oe.alias,image:Oe.image||((lt=Oe.imageSources)==null?void 0:lt["1:1"])||null,isConnected:!0,uniqueKey:`upstream-${Oe.index||Je}`,_connectionId:Oe._connectionId,_sourceNodeId:Oe._sourceNodeId}}),Be=ne.map(Oe=>({...Oe,index:Oe.id,isConnected:!1,uniqueKey:`local-${Oe.id}`}));return[...fe,...Be]},[rt,ne]),he=y.useMemo(()=>{let fe=!1,Be=0;const Oe=tt=>(tt||"").toLowerCase().trim(),Je=qe.map(tt=>{const yt=Oe(tt.name),gt=Oe(tt.index);if(!yt&&!gt)return{status:"empty"};const Dt=Se.find(Lt=>Oe(Lt.index||Lt.id||Lt.alias)===gt),Tt=Se.find(Lt=>Oe(Lt.name)===yt);if(Dt&&Tt&&Dt===Tt)return Be++,{status:"match"};if(Dt){const Lt=Dt.name;if(Oe(Lt)!==yt)return fe=!0,{status:"mismatch_name",expectedName:Lt,conceptIndex:Dt.index||Dt.id}}if(Tt){const Lt=Tt.index||Tt.id||Tt.alias;if(Oe(Lt)!==gt)return fe=!0,{status:"mismatch_index",expectedIndex:Lt,conceptName:Tt.name}}return{status:"missing"}}),lt=qe.length>0&&Be===qe.length&&!fe;return{results:Je,hasError:fe,allValid:lt}},[qe,Se]),ge=y.useMemo(()=>{const fe={},Be=new Set;return Se.forEach(Oe=>{const Je=(Oe.id||"").trim();Je&&(fe[Je]=(fe[Je]||0)+1)}),Object.keys(fe).forEach(Oe=>{fe[Oe]>1&&Be.add(Oe)}),Be},[Se]),ve=fe=>{let Be=0;return rt.forEach(Oe=>{const Je=parseInt((Oe.index||Oe.alias||"0").replace(/[^0-9]/g,""),10);isNaN(Je)||(Be=Math.max(Be,Je))}),Be===0&&Ce>0&&(Be=Ce),fe.map((Oe,Je)=>{const lt=Be+Je+1;return{...Oe,id:`Entity-${lt}`,name:`Entity-${lt}`}})},Ge=y.useCallback((fe,Be,Oe,Je)=>{if(Oe)return;const lt=fe-Ce;if(lt>=0&&lt<ne.length){const tt=[...ne];tt[lt]={...tt[lt],...Be},je({characterConcepts:tt})}},[ne,Ce,je]),Ve=y.useCallback(fe=>{const Be=fe-Ce;if(Be>=0){const Oe=ne.filter((lt,tt)=>tt!==Be),Je=ve(Oe);je({characterConcepts:Je})}},[ne,Ce,je,ve]),ot=y.useCallback(()=>{const fe={id:"",name:"",prompt:"",image:null},Be=[...ne,fe],Oe=ve(Be);je({characterConcepts:Oe})},[ne,je,ve]),Xe=y.useCallback(()=>{je({characterConcepts:[]}),z&&z(fe=>fe.filter(Be=>!(Be.toNodeId===e.id&&Be.toHandleId==="character_data"))),_&&_(e.id),B&&B(u("toast.contentCleared"),"info")},[je,_,e.id,B,u,z]),pt=y.useCallback(fe=>{if(fe._sourceNodeId&&z&&P&&A){const Be=P.find(Oe=>Oe.id===fe._sourceNodeId);if(A.filter(Oe=>Oe.toNodeId===e.id&&Oe.toHandleId==="character_data"),Be&&Be.type===q.CHARACTER_CARD){let Oe=[];try{Oe=JSON.parse(Be.value||"[]")}catch{}Array.isArray(Oe)||(Oe=[Oe]);let Je=0;ne.forEach(tt=>{const yt=(tt.id||"").match(/(?:Character|Entity)-(\d+)/i);yt&&(Je=Math.max(Je,parseInt(yt[1],10)))});const lt=Oe.map((tt,yt)=>{var pn;const gt=tt.selectedRatio||"1:1",Dt=Ut[gt]||1,Lt=h(Be.id,yt*10+Dt)||h(Be.id,yt*10)||((pn=tt.thumbnails)==null?void 0:pn["1:1"])||tt.image||null;return{id:`Entity-${Je+yt+1}`,name:tt.name||`Entity ${Je+yt+1}`,prompt:tt.prompt||"",image:Lt,fullDescription:tt.fullDescription||""}});je({characterConcepts:[...ne,...lt]}),z(tt=>tt.filter(yt=>!(yt.toNodeId===e.id&&yt.toHandleId==="character_data"))),B&&B(u("toast.pastedFromClipboard"),"success");return}}w&&w(e.id,fe)},[P,A,z,ne,je,w,e.id,B,u,h]),st=y.useCallback((fe,Be)=>{const Oe=fe-Ce;if(Oe<0)return;const Je=[...ne],lt=Be==="up"?Oe-1:Oe+1;if(lt>=0&&lt<Je.length){[Je[Oe],Je[lt]]=[Je[lt],Je[Oe]];const tt=ve(Je);je({characterConcepts:tt})}},[ne,Ce,je,ve]),ft=y.useCallback(fe=>{je({conceptsMode:fe})},[je]),it=y.useCallback(()=>{if(J.length===0||!S)return;const Be={x:e.position.x-1350,y:e.position.y},Oe=S(q.PROMPT_SEQUENCE_EDITOR,Be);t(Oe,JSON.stringify({instruction:"",sourcePrompts:J,modifiedPrompts:[],checkedSourceFrameNumbers:[],selectedFrameNumber:null,styleOverride:pe,usedCharacters:Pe,leftPaneRatio:.5})),L&&L([Oe]),B&&B("Prompts detached to Prompt Sequence Editor (Left)","success")},[J,S,e,pe,Pe,t,B,L]),wt=y.useCallback(()=>{je({prompts:[],images:{},frameStatuses:{}}),B&&B("All prompts cleared","info")},[je,B]),dt=y.useCallback(()=>{je({images:{}}),E(e.id),B&&B(u("toast.contentCleared"))},[je,E,e.id,B,u]),_t=y.useCallback(()=>{const Be=[...re.current.prompts||[]].map(Oe=>({...Oe,prompt:"",videoPrompt:"",shotType:"MS"}));je({prompts:Be}),B&&B("Text prompts cleared","info")},[je,B]),cn=y.useCallback(fe=>{const Be=[...re.current.prompts||[]],Oe=Be.length>0?Math.max(...Be.map(tt=>tt.frameNumber))+1:1,Je=Be.length>0?Be[Be.length-1].sceneNumber:1,lt={frameNumber:Oe,sceneNumber:Je,sceneTitle:"",prompt:"",videoPrompt:"",shotType:"MS",characters:[],duration:3,isCollapsed:!0};if(fe!==void 0&&fe!==-1){const tt=Be.findIndex(yt=>yt.frameNumber===fe);if(tt!==-1){Be.splice(tt+1,0,lt);const yt=Be.map((gt,Dt)=>({...gt,frameNumber:Dt+1}));je({prompts:yt});return}}je({prompts:[...Be,lt]}),setTimeout(()=>{var tt;return(tt=D.current)==null?void 0:tt.scrollToBottom()},100)},[je]),It=y.useCallback(()=>{const fe=[...re.current.prompts||[]],Oe=(fe.length>0?Math.max(...fe.map(tt=>tt.sceneNumber||1)):0)+1,lt={frameNumber:fe.length>0?Math.max(...fe.map(tt=>tt.frameNumber))+1:1,sceneNumber:Oe,sceneTitle:`Scene ${Oe}`,prompt:"",videoPrompt:"",shotType:"MS",characters:[],duration:3,isCollapsed:!1};je({prompts:[...fe,lt]}),setTimeout(()=>{var tt;return(tt=D.current)==null?void 0:tt.scrollToBottom()},100)},[je]),Ee=y.useCallback(fe=>{if(!V||!O)return;const Be=A==null?void 0:A.find(Oe=>Oe.toNodeId===e.id&&Oe.toHandleId==="prompt_input");Be&&O(Be.fromNodeId,fe)},[V,O,A,e.id]),Ue=y.useCallback(fe=>{const Be=re.current.prompts||[],Oe=re.current.collapsedScenes||[],Je=Be.find(gt=>gt.frameNumber===fe);if(!Je)return;const lt=Je.sceneNumber||1;let tt=[...Oe];tt.includes(lt)&&(tt=tt.filter(gt=>gt!==lt));let yt=Be;Je.isCollapsed&&(yt=Be.map(gt=>gt.frameNumber===fe?{...gt,isCollapsed:!1}:gt)),je({collapsedScenes:tt,prompts:yt,selectedFrameNumber:fe}),D.current&&setTimeout(()=>{D.current.scrollToFrame(fe)},50)},[je]),Ke=y.useCallback(()=>{z&&e.id&&(z(fe=>fe.filter(Be=>!(Be.toNodeId===e.id&&Be.toHandleId==="prompt_input"))),B&&B("Unlinked from source. Data copied to local.","info"))},[z,e.id,B]),et=(fe,Be)=>{if(!fe)return null;const Oe=lt=>String(lt).toLowerCase().replace(/[^a-z0-9]/g,""),Je=Oe(fe);return Be.find(lt=>!!(lt.index&&Oe(lt.index)===Je||lt.alias&&Oe(lt.alias)===Je||lt.name&&Oe(lt.name)===Je||lt.id&&Oe(lt.id)===Je))},ht=y.useCallback(fe=>{const Be=J.find(gt=>gt.frameNumber===fe);if(!Be)return;const Oe=de.integrationPrompt||js,Je=Be.shotType&&["WS","MS","CU","ECU","LS"].includes(Be.shotType)?Be.shotType:"MS",lt=Po("en",`image_sequence.shot_type.${Je}`);let tt=`${Oe}
${lt}`;if(de.isSceneContextInserted){const gt=be[String(Be.sceneNumber||1)];gt&&gt.trim()&&(tt+=`

${gt.trim()}`)}let yt=Be.prompt;if(de.characterPromptCombination==="replace"){const gt=new Set;yt=yt.replace(/((?:Character|Entity)[-\s]?\d+|(?:Character|Entity)[-\s]?\w+)/gi,Dt=>{const Tt=et(Dt,Se);if(Tt&&Tt.prompt){const Lt=Tt.index||Tt.id||Dt.toLowerCase();if(!gt.has(Lt))return gt.add(Lt),`${Dt} (${Tt.prompt})`}return Dt})}tt+=`

${yt}`,de.isStyleInserted&&de.styleOverride&&(tt+=`

[Visual Style]: ${de.styleOverride}`),navigator.clipboard.writeText(tt),B&&B("Combined prompt copied to clipboard","success")},[J,de,Se,be,u,B]),ut=y.useCallback(fe=>{if(h(e.id,1e3+fe)||H[fe]){const Je=J.filter(yt=>h(e.id,1e3+yt.frameNumber)||H[yt.frameNumber]),lt=Je.map(yt=>({src:h(e.id,1e3+yt.frameNumber)||H[yt.frameNumber],frameNumber:yt.frameNumber,prompt:yt.prompt})),tt=Je.findIndex(yt=>yt.frameNumber===fe);tt!==-1&&f({sources:lt,initialIndex:tt})}},[H,J,f,h,e.id]),at=y.useCallback(fe=>{if(!S)return;let Be=null;if(F.current){const Oe=P==null?void 0:P.find(Je=>Je.id===F.current);Oe&&Oe.type===q.IMAGE_EDITOR?Be=Oe.id:F.current=null}if(Be){const Oe=P==null?void 0:P.find(Je=>Je.id===Be);if(Oe){const Je=JSON.parse(Oe.value||"{}"),lt=Je.inputImages||[];Ot(fe,256,256).then(tt=>{const yt=[...lt,tt];t(Be,JSON.stringify({...Je,inputImages:yt})),v(Be,lt.length+1,fe)})}}else{const Oe={x:e.position.x+e.width+100,y:e.position.y};Be=S(q.IMAGE_EDITOR,Oe),F.current=Be,t(Be,JSON.stringify({inputImages:[fe],prompt:"",aspectRatio:ae,enableAspectRatio:!0,model:"gemini-2.5-flash-image"})),v(Be,1,fe),Ot(fe,256,256).then(Je=>{t(Be,JSON.stringify({inputImages:[Je],prompt:"",aspectRatio:ae,enableAspectRatio:!0,model:"gemini-2.5-flash-image"}))})}Be&&L&&L([Be])},[S,e,P,t,v,L,ae]),kt=y.useCallback(fe=>{const Be=re.current.imageDimensions||{},Oe=J.filter(Je=>{const lt=Be[Je.frameNumber];if(!lt)return!1;const tt=lt.width/lt.height;return fe==="landscape"?tt>1.2:fe==="portrait"?tt<.85:fe==="square"?tt>=.85&&tt<=1.2:!1}).map(Je=>Je.frameNumber);Oe.length===0?B&&B("No images match this aspect ratio","info"):je({checkedFrameNumbers:Oe})},[J,je,B]),St=y.useCallback((fe,Be)=>{const Oe=re.current.imageDimensions||{},lt=J.filter(tt=>(tt.sceneNumber||1)===fe).filter(tt=>{const yt=Oe[tt.frameNumber];if(!yt)return!1;const gt=yt.width/yt.height;return Be==="landscape"?gt>1.2:Be==="portrait"?gt<.85:Be==="square"?gt>=.85&&gt<=1.2:!1}).map(tt=>tt.frameNumber);lt.length===0?B&&B(`No ${Be} images found in Scene ${fe}`,"info"):je({checkedFrameNumbers:lt})},[J,je,B]),Ct=y.useCallback(async()=>{var Oe,Je;const fe=[...ce].sort((lt,tt)=>lt-tt);if(fe.length===0)return;const Be=sessionStorage.getItem("download_permission_shown");if(!$e&&fe.length>1&&!Be&&se(!0),$e){ie(0);try{const lt=Bi.default||Bi,tt=new lt,yt=new Date,gt=yt.toISOString().split("T")[0],Dt=yt.toTimeString().split(" ")[0].replace(/:/g,"-");let Tt=0;for(const Xt of fe){const er=h(e.id,1e3+Xt)||H[Xt];if(er&&er.startsWith("data:image")){const Xa=String(Xt).padStart(3,"0"),kc=((Oe=er.match(/image\/(png|jpeg|jpg)/))==null?void 0:Oe[1])||"png",_c=await(await fetch(er)).blob();tt.file(`Frame_${Xa}_seq_gen_${gt}_${Dt}.${kc}`,_c),Tt++}}if(Tt===0){B&&B("No valid images found to ZIP","error"),ie(null);return}const Lt=await tt.generateAsync({type:"blob",compression:"STORE"},Xt=>{ie(Xt.percent)}),pn=document.createElement("a");pn.href=URL.createObjectURL(Lt),pn.download=`Image_Sequence_${gt}_${Dt}.zip`,document.body.appendChild(pn),pn.click(),document.body.removeChild(pn),URL.revokeObjectURL(pn.href),B&&B("ZIP archive downloaded","success")}catch(lt){console.error("ZIP Error:",lt),B&&B("Failed to create ZIP","error")}finally{ie(null)}}else{const lt=new Date,tt=lt.toISOString().split("T")[0],yt=lt.toTimeString().split(" ")[0].replace(/:/g,"-");for(const gt of fe){const Dt=h(e.id,1e3+gt)||H[gt];if(Dt){const Tt=((Je=J.find(Xt=>Xt.frameNumber===gt))==null?void 0:Je.prompt)||"",pn=`Frame_${String(gt).padStart(3,"0")}_seq_gen_${tt}_${yt}.png`;c(Dt,gt,Tt,pn),B&&B(u("toast.downloadStarted"),"success"),await new Promise(Xt=>setTimeout(Xt,300))}}}},[ce,$e,h,e.id,H,J,c,B,u]),Et=y.useCallback(()=>{const fe={...ee};Object.keys(fe).forEach(Be=>{fe[Number(Be)]!=="done"&&(fe[Number(Be)]="idle")}),je({frameStatuses:fe}),_&&_(e.id)},[ee,je,_,e.id]),Mt=y.useCallback(async(fe,Be)=>{var lt;const Oe=h(e.id,1e3+fe)||H[fe];if(!Oe)return;const Je=((lt=J.find(tt=>tt.frameNumber===fe))==null?void 0:lt.prompt)||"";try{const tt={...re.current.frameStatuses};tt[fe]="generating",je({frameStatuses:tt});const yt=re.current.model||"gemini-2.5-flash-image",gt=await sc(Oe,Be,Je,yt),Dt=await Ot(gt,128,128);v(e.id,1e3+fe,gt);const Tt={...re.current.images,[fe]:Dt},Lt={...re.current.frameStatuses,[fe]:"done"};je({images:Tt,frameStatuses:Lt})}catch(tt){B&&B(`Expansion failed: ${tt.message}`,"error");const yt={...re.current.frameStatuses,[fe]:"error"};je({frameStatuses:yt})}},[h,e.id,H,J,je,B,v]),Qo=y.useCallback(async fe=>{const Be=[...ce].sort((Oe,Je)=>Oe-Je);if(Be.length!==0)for(const Oe of Be)await Mt(Oe,fe)},[ce,Mt]),lc=y.useCallback(fe=>{fe.preventDefault(),fe.stopPropagation();const Be=(G==null?void 0:G.scale)||1;T.current={startX:fe.clientX,startWidth:re.current.leftPaneWidth||zo};const Oe=lt=>{const tt=T.current;if(!tt)return;const yt=(lt.clientX-tt.startX)/Be,gt=tt.startWidth+yt,Dt=e.width-I0,Tt=Math.max(zo,Math.min(gt,Dt));je({leftPaneWidth:Tt})},Je=()=>{T.current=null,window.removeEventListener("mousemove",Oe),window.removeEventListener("mouseup",Je)};window.addEventListener("mousemove",Oe),window.addEventListener("mouseup",Je)},[je,G,e.width]),Ki=y.useCallback(()=>{if(!I)return null;const fe=I(e.id,"prompt_input");if(!fe||fe.length===0)return null;const Be=new Map;let Oe=pe,Je=Pe,lt=be,tt=1;return fe.forEach(yt=>{if(typeof yt=="string")try{const gt=JSON.parse(yt);let Dt=[];if(gt.type==="script-prompt-modifier-data"){if(Dt=gt.finalPrompts||gt.prompts||[],gt.styleOverride&&(Oe=gt.styleOverride),gt.usedCharacters&&(Je=gt.usedCharacters),gt.sceneContexts&&(lt=gt.sceneContexts),gt.videoPrompts){const Tt=new Map(gt.videoPrompts.map(Lt=>[Lt.frameNumber,Lt]));Dt=Dt.map(Lt=>({...Lt,videoPrompt:Lt.videoPrompt||Tt.get(Lt.frameNumber)||""}))}}else if(gt.sourcePrompts||gt.modifiedPrompts){const Tt=gt.sourcePrompts||[],Lt=gt.modifiedPrompts||[],pn=new Map;if(Tt.forEach(Xt=>pn.set(Xt.frameNumber,Xt)),Lt.forEach(Xt=>pn.set(Xt.frameNumber,{...pn.get(Xt.frameNumber),...Xt})),Dt=Array.from(pn.values()),gt.styleOverride&&(Oe=gt.styleOverride),gt.usedCharacters&&(Je=gt.usedCharacters),gt.sceneContexts){let Xt=gt.sceneContexts;gt.modifiedSceneContexts&&(Xt={...Xt,...gt.modifiedSceneContexts}),lt=Xt}}else Array.isArray(gt)&&(Dt=gt);Dt.length>0&&Dt.forEach(Tt=>{const Lt=Tt.frameNumber!==void 0?Tt.frameNumber:tt++,Xt=(re.current.prompts||[]).find(Xa=>Xa.frameNumber===Lt),er=Xt?Xt.isCollapsed:!0;Be.set(Lt,{frameNumber:Lt,sceneNumber:Tt.sceneNumber||1,sceneTitle:Tt.sceneTitle||"",prompt:Tt.prompt||"",videoPrompt:Tt.videoPrompt||"",shotType:Tt.shotType||Tt.ShotType||"MS",characters:Tt.characters||[],duration:Tt.duration||3,isCollapsed:er})})}catch{}}),Be.size>0?{prompts:Array.from(Be.values()).sort((yt,gt)=>yt.frameNumber-gt.frameNumber),styleOverride:Oe,usedCharacters:Je,sceneContexts:lt}:null},[I,e.id,pe,Pe,be]);y.useEffect(()=>{if(V&&!s){const fe=Ki();if(fe){const Be=JSON.stringify(re.current.prompts),Oe=JSON.stringify(fe.prompts),Je=re.current.styleOverride,lt=JSON.stringify(re.current.usedCharacters),tt=JSON.stringify(fe.usedCharacters),yt=JSON.stringify(re.current.sceneContexts),gt=JSON.stringify(fe.sceneContexts);(Be!==Oe||Je!==fe.styleOverride||lt!==tt||yt!==gt)&&je(fe)}}},[V,Ki,je,s]);const cc=fe=>{const Be=le.current;Be!==null&&(v(e.id,1e3+Be,fe),Ot(fe,128,128).then(Oe=>je({images:{...H,[Be]:Oe}})))},dc=(fe,Be)=>{const Oe=qe[fe].originalIndex,Je=[...Pe];Je[Oe]&&(Je[Oe]={...Je[Oe],name:Be},je({usedCharacters:Je}))},uc=()=>je({isUsedCharsCollapsed:!Me}),pc=()=>je({isStyleCollapsed:!me}),hc=fe=>je({isStyleInserted:fe}),mc=fe=>je({isSceneContextInserted:fe}),gc=()=>je({isIntegrationSettingsCollapsed:!De}),fc=()=>je({isCharacterPromptCombinationCollapsed:!Ie}),xc=y.useCallback(fe=>{navigator.clipboard.writeText(fe),B&&B(u("toast.copiedToClipboard"),"info")},[B,u]),yc=y.useCallback(fe=>{navigator.clipboard.writeText(fe),B&&B(u("toast.copiedToClipboard"),"info")},[B,u]),vc=y.useCallback((fe,Be,Oe)=>{var lt,tt;const Je=re.current.imageDimensions||{};((lt=Je[fe])==null?void 0:lt.width)===Be&&((tt=Je[fe])==null?void 0:tt.height)===Oe||je({imageDimensions:{...Je,[fe]:{width:Be,height:Oe}}})},[je]),wc=(fe,Be)=>{const Oe={...be,[fe]:Be};je({sceneContexts:Oe})},bc=fe=>{const Be=Ae||[],Oe=Be.includes(fe)?Be.filter(Je=>Je!==fe):[...Be,fe];je({expandedSceneContexts:Oe})},Cc=fe=>{const Be=Te||[],Oe=Be.includes(fe)?Be.filter(Je=>Je!==fe):[...Be,fe];je({checkedContextScenes:Oe})};return n.jsxs("div",{className:"flex h-full w-full space-x-2",onWheel:fe=>fe.stopPropagation(),children:[n.jsx(ic,{isOpen:te,onClose:()=>{$(!1),le.current=null},onApply:cc,imageSrc:Y}),n.jsxs("div",{ref:W,className:"h-full flex flex-col flex-shrink-0",style:{width:`${Ze}px`},children:[n.jsx("div",{className:"flex-shrink-0 flex flex-col transition-all duration-300 ease-in-out relative z-10",style:{height:typeof Nt=="string"?Nt:`${Nt}px`},children:n.jsx(cI,{allConcepts:Se,characterConcepts:ne,conceptSortOrder:[],onUpdateConcept:Ge,onDeleteConcept:Ve,onMoveConcept:st,onAddConcept:ot,onDetachConnectedConcept:fe=>pt(fe),onClearConcepts:Xe,handleViewImage:fe=>f({sources:[{src:fe,frameNumber:0}],initialIndex:0}),t:u,deselectAllNodes:p,conceptsMode:ye,onToggleMode:ft,duplicateIndices:ge,onCopyImageToClipboard:d,onDownloadImageFromUrl:c})}),ye!=="expanded"&&n.jsxs("div",{className:"flex-grow flex flex-col min-h-0 pt-2",children:[n.jsxs("div",{className:"flex flex-col space-y-1 mb-1 flex-shrink-0",children:[n.jsxs("div",{className:`flex justify-between items-center cursor-pointer hover:bg-gray-700/50 rounded-md px-1 transition-colors group ${he.hasError?"bg-red-900/30":he.allValid?"bg-accent-secondary/20":""}`,onClick:uc,children:[n.jsxs("label",{className:`text-[10px] font-bold uppercase cursor-pointer py-1 flex-grow flex items-center gap-2 ${he.hasError?"text-red-400":he.allValid?"text-connection-text":"text-gray-400"}`,children:[he.hasError?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}):he.allValid?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-connection-text",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):null,u("node.content.usedCharacters"),he.allValid&&n.jsx("span",{className:"text-[9px] font-normal text-connection-text ml-1",children:"( )"})]}),n.jsx("div",{className:"text-gray-500 group-hover:text-gray-300 p-1",children:Me?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!Me&&n.jsx("div",{onWheel:fe=>fe.stopPropagation(),className:"bg-gray-700/50 p-2 rounded-md border border-gray-600 max-h-32 overflow-y-auto custom-scrollbar",children:qe.length>0?qe.map((fe,Be)=>{const Oe=he.results[Be]||{status:"missing"};let Je=null,lt="text-gray-400",tt="";return Oe.status==="match"?(Je=n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-accent-secondary",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),lt="text-connection-text",tt="   "):Oe.status==="mismatch_name"?(Je=n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),lt="text-red-400",tt=`  (${fe.index}),   . : "${Oe.expectedName}"`):Oe.status==="mismatch_index"?(Je=n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),lt="text-red-400",tt=`  ("${fe.name}"),   .   : ${Oe.expectedIndex}`):(Je=n.jsx("span",{className:"text-gray-600 text-[10px]",children:""}),tt="    "),n.jsxs("div",{className:"flex items-center gap-2 mb-1 last:mb-0 group/item",title:tt,children:[n.jsx("div",{className:"w-4 flex-shrink-0 flex items-center justify-center",children:Je}),n.jsxs("span",{className:`text-[10px] font-mono w-20 shrink-0 truncate ${lt}`,children:[fe.index,":"]}),n.jsx("input",{type:"text",value:fe.name,onChange:yt=>dc(Be,yt.target.value),className:`flex-grow bg-gray-800 border-none rounded px-1.5 py-0.5 text-[10px] outline-none focus:ring-1 focus:ring-cyan-500 ${Oe.status.startsWith("mismatch")?"text-red-200 bg-red-900/20":"text-gray-200"}`,onMouseDown:yt=>yt.stopPropagation()})]},Be)}):n.jsx("div",{className:"text-[10px] text-gray-500 italic",children:"  ."})})]}),n.jsxs("div",{className:"flex flex-col space-y-1 mb-2 flex-shrink-0",children:[n.jsxs("div",{className:"flex justify-between items-center cursor-pointer hover:bg-gray-700/50 rounded-md px-1 transition-colors group",onClick:gc,children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase cursor-pointer py-1 flex-grow",children:u("node.content.integrationInstruction")}),n.jsx("div",{className:"text-gray-500 group-hover:text-gray-300 p-1",children:De?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!De&&n.jsx(Cn,{value:Ne,onDebouncedChange:fe=>je({integrationPrompt:fe}),placeholder:"Integrate these Entities into the scene...",className:"w-full p-2 bg-gray-700 border-none rounded-md resize-none focus:outline-none text-xs",style:{minHeight:"60px"},onMouseDown:fe=>fe.stopPropagation(),onWheel:fe=>fe.stopPropagation()})]}),n.jsx("div",{onWheel:fe=>fe.stopPropagation(),className:"flex-shrink-0 flex flex-col space-y-2 mb-2",children:n.jsxs("div",{className:"flex flex-col space-y-1",children:[n.jsxs("div",{className:"flex justify-between items-center cursor-pointer hover:bg-gray-700/50 rounded-md px-1 transition-colors group",onClick:fc,children:[n.jsxs("label",{className:"text-[10px] font-bold text-gray-400 uppercase cursor-pointer py-1 flex-grow",children:[u("image_sequence.character_prompt_combination"),ue!=="none"&&n.jsxs("span",{className:"text-connection-text font-normal ml-1 normal-case",children:["(",u(ue==="combine"?"image_sequence.combination_combine":"image_sequence.combination_replace"),")"]})]}),n.jsx("div",{className:"text-gray-500 group-hover:text-gray-300 p-1",children:Ie?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!Ie&&n.jsxs("div",{className:"flex items-center space-x-4 bg-gray-800/50 p-2 rounded-md border border-gray-700",children:[n.jsx(Ht,{checked:ue==="combine",onChange:fe=>je({characterPromptCombination:fe?"combine":"none"}),label:u("image_sequence.combination_combine"),title:"     ."}),n.jsx(Ht,{checked:ue==="replace",onChange:fe=>je({characterPromptCombination:fe?"replace":"none"}),label:u("image_sequence.combination_replace"),title:"  (. Character-1)     ."})]})]})}),n.jsxs("div",{className:"flex flex-col space-y-1 mb-2 flex-shrink-0",children:[n.jsxs("div",{className:"flex justify-between items-center cursor-pointer hover:bg-gray-700/50 rounded-md px-1 transition-colors group",onClick:pc,children:[n.jsxs("div",{className:"flex items-center gap-2 flex-grow",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase cursor-pointer py-1",children:u("node.content.style")}),n.jsx("div",{onClick:fe=>fe.stopPropagation(),children:n.jsx(Ht,{checked:ke,onChange:hc,title:"      .",label:u("node.content.insertStyle")})}),n.jsx("div",{onClick:fe=>fe.stopPropagation(),className:"ml-2",children:n.jsx(Ht,{checked:Re,onChange:mc,title:"         .",label:u("node.content.insertSceneContext")})})]}),n.jsx("div",{className:"text-gray-500 group-hover:text-gray-300 p-1",children:me?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!me&&n.jsx(Cn,{value:pe,onDebouncedChange:fe=>je({styleOverride:fe}),className:"w-full p-2 bg-gray-700 border-none rounded-md resize-none focus:outline-none text-xs",style:{minHeight:"60px"},onMouseDown:fe=>fe.stopPropagation(),onWheel:fe=>fe.stopPropagation()})]}),n.jsx("div",{className:"w-full h-0.5 bg-gray-600/80 my-3 flex-shrink-0"}),n.jsx(xI,{ref:D,prompts:J,collapsedScenes:_e,checkedFrameNumbers:ce,selectionKey:"checkedFrameNumbers",selectedFrameNumber:U,isLinked:!!V,onUpdatePrompts:je,onLoadFile:()=>o(e.id),onSaveToCatalog:()=>b(e.id),onSaveToDisk:()=>M(e.id),t:u,onSelect:fe=>je({selectedFrameNumber:fe}),onToggleCollapse:fe=>{const Be=J.map(Oe=>Oe.frameNumber===fe?{...Oe,isCollapsed:!Oe.isCollapsed}:Oe);je({prompts:Be})},onToggleScene:fe=>{const Be=_e.includes(fe)?_e.filter(Oe=>Oe!==fe):[..._e,fe];je({collapsedScenes:Be})},onDetachToEditor:it,onClearAll:wt,onAddPrompt:cn,onAddScene:It,onDeletePrompt:fe=>{const Be=J.filter(Oe=>Oe.frameNumber!==fe);je({prompts:Be})},onMovePromptUp:()=>{},onMovePromptDown:()=>{},onMoveToStart:()=>{},onMoveToEnd:()=>{},onRegenerate:fe=>l(e.id,fe),isAnyGenerationInProgress:nt,onEditInSource:Ee,onEditPrompt:Ue,isGeneratingSequence:!!s,allConceptsLength:Se.length,onUnlink:Ke,addToast:B,onClearTextOnly:_t,sceneContexts:be,onUpdateSceneContext:wc,expandedSceneContexts:Ae,onToggleSceneContext:bc,onCopyCombinedPrompt:ht,checkedContextScenes:Te,onToggleContextCheck:Cc})]})]}),n.jsx("div",{onMouseDown:lc,className:"w-2 h-full bg-gray-700/50 hover:bg-cyan-600 cursor-col-resize rounded transition-colors flex-shrink-0"}),n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-w-0",style:{width:"0",flexGrow:1,position:"relative"},children:[K!==null&&n.jsxs("div",{className:"absolute inset-0 z-50 bg-gray-900/90 backdrop-blur-sm flex flex-col items-center justify-center rounded-md",children:[n.jsx("div",{className:"text-cyan-400 font-bold text-lg mb-4 animate-pulse",children:"Archiving Sequence..."}),n.jsx("div",{className:"w-64 h-4 bg-gray-700 rounded-full overflow-hidden border border-gray-600 shadow-inner",children:n.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-600 to-blue-500 transition-all duration-100 ease-out relative",style:{width:`${K}%`},children:n.jsx("div",{className:"absolute inset-0 bg-white/20 animate-[progress-bar-stripes_1s_linear_infinite]",style:{backgroundImage:"linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent)",backgroundSize:"1rem 1rem"}})})}),n.jsxs("div",{className:"text-gray-300 font-mono mt-2",children:[K.toFixed(0),"%"]})]}),Z&&Va.createPortal(n.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 backdrop-blur-sm flex flex-col items-center justify-start pt-20 text-center animate-fade-in",onClick:fe=>fe.stopPropagation(),children:n.jsxs("div",{className:"bg-gray-800 p-6 rounded-xl border border-cyan-500 shadow-2xl max-w-md mx-4 relative",children:[n.jsx("div",{className:"absolute -top-12 right-4 md:right-1/4 animate-bounce text-cyan-400",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 10l7-7m0 0l7 7m-7-7v18"})})}),n.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:" "}),n.jsxs("p",{className:"text-gray-300 mb-6 text-sm leading-relaxed",children:["    .",n.jsx("br",{}),",             ",n.jsx("b",{children:'" "'})," (Allow automatic downloads)."]}),n.jsx("button",{onClick:()=>{se(!1),sessionStorage.setItem("download_permission_shown","true")},className:"w-full py-2 bg-cyan-600 hover:bg-cyan-700 text-white font-bold rounded transition-colors",children:""})]})}),document.body),n.jsx(wI,{prompts:J,images:H,frameStatuses:ee,selectedFrameNumber:U,checkedFrameNumbers:ce,collapsedOutputScenes:Fe,isGeneratingSequence:!!s,isAnyFrameGenerating:Ye,t:u,onUpdateState:fe=>{fe.sequenceOutputs&&fe.sequenceOutputs.length===0?dt():je(fe)},groupedPrompts:ze,onRegenerate:fe=>l(e.id,fe),onDownload:(fe,Be)=>{const Oe=h(e.id,1e3+fe)||H[fe];if(Oe){const Je=new Date,lt=Je.toISOString().split("T")[0],tt=Je.toTimeString().split(" ")[0].replace(/:/g,"-"),gt=`Frame_${String(fe).padStart(3,"0")}_seq_gen_${lt}_${tt}.png`;c(Oe,fe,Be,gt),B&&B(u("toast.downloadStarted"),"success")}},onCopy:fe=>d(h(e.id,1e3+fe)||H[fe]),onCopyPrompt:xc,onCopyVideoPrompt:yc,onStopFrame:fe=>i(),onFrameSelect:fe=>je({selectedFrameNumber:fe}),onFrameDoubleClick:ut,onCheckFrame:(fe,Be)=>{if(Be)je({checkedFrameNumbers:[fe]});else{const Oe=re.current.checkedFrameNumbers||[],Je=Oe.includes(fe)?Oe.filter(lt=>lt!==fe):[...Oe,fe];je({checkedFrameNumbers:Je})}},onOpenRaster:(fe,Be)=>{oe(Be),le.current=fe,$(!0)},onOpenAI:at,onReplaceImage:(fe,Be)=>{v(e.id,1e3+fe,Be),je({images:{...H,[fe]:Be}})},onEditPrompt:Ue,onEditInSource:Ee,readOnlyPrompt:!!V,getFullSizeImage:fe=>h(e.id,fe),onSelectByAspectRatio:kt,onSelectSceneByAspectRatio:St,onSelectAll:()=>je({checkedFrameNumbers:J.map(fe=>fe.frameNumber)}),onSelectNone:()=>je({checkedFrameNumbers:[]}),onInvertSelection:()=>{const fe=re.current.checkedFrameNumbers||[],Oe=J.map(Je=>Je.frameNumber).filter(Je=>!fe.includes(Je));je({checkedFrameNumbers:Oe})},onRunSelected:()=>a(e.id),onDownloadSelected:Ct,onForceRefresh:Et,onExpandFrame:Mt,onExpandSelected:Qo,onReportDimensions:vc,onClearImages:dt,onCopyCombinedPrompt:ht}),n.jsx(bI,{model:X,autoCrop169:We,autoDownload:xe,createZip:$e,isGeneratingSequence:!!s,isAnyFrameGenerating:Ye,checkedCount:ce.length,promptsLength:J.length,onUpdateState:je,onGenerateSelected:()=>a(e.id),onDownloadSelected:Ct,onStartQueue:()=>r(e.id,0),onExpandSelected:Qo,t:u})]})]})},SI=({instruction:e,onInstructionChange:t,targetLanguage:o,onLanguageChange:r,modificationModel:a,onModelChange:i,includeVideoPrompts:s,onToggleVideoPrompts:l,isModifying:c,onModify:d,checkedCount:u,checkedContextCount:p=0,totalPrompts:m,instructionInputId:w,t:k})=>{var f;const{secondaryLanguage:b}=Pt(),x=c||m===0||u===0&&p===0;return n.jsxs("div",{className:"flex-shrink-0 space-y-2",children:[n.jsx(Cn,{id:w,value:e,onDebouncedChange:t,placeholder:k("prompt_sequence_editor.instructionPlaceholder"),className:"w-full p-2 bg-gray-700 border-none rounded-md resize-y focus:ring-2 focus:ring-accent focus:outline-none",rows:2,style:{minHeight:"80px",maxHeight:"200px"},onWheel:h=>h.stopPropagation()}),n.jsx("div",{className:"flex flex-col space-y-2",children:n.jsxs("div",{className:"flex items-center space-x-2 h-10",children:[n.jsx(mt,{content:"English Language",children:n.jsx("button",{onClick:()=>r("en"),className:`h-10 px-3 rounded-md text-xs font-bold transition-colors flex items-center justify-center ${o==="en"?"bg-accent text-white":"bg-gray-900 text-gray-400 hover:text-white hover:bg-gray-700"}`,children:"EN"})}),n.jsx(mt,{content:((f=xn[b])==null?void 0:f.name)||b.toUpperCase(),children:n.jsx("button",{onClick:()=>r(b),className:`h-10 px-3 rounded-md text-xs font-bold transition-colors flex items-center justify-center ${o===b?"bg-accent text-white":"bg-gray-900 text-gray-400 hover:text-white hover:bg-gray-700"}`,title:xn[b].name,children:xn[b].short})}),n.jsx(mt,{content:"Gemini 3.0 Flash (Fast & Efficient)",children:n.jsx("button",{onClick:()=>i("gemini-3-flash-preview"),className:`h-10 px-3 rounded-md text-xs font-bold transition-colors flex items-center justify-center ${a==="gemini-3-flash-preview"?"bg-accent text-white":"bg-gray-900 text-gray-400 hover:text-white hover:bg-gray-700"}`,children:"Flash"})}),n.jsx(mt,{content:"Gemini 3.0 Pro (High Reasoning)",children:n.jsx("button",{onClick:()=>i("gemini-3-pro-preview"),className:`h-10 px-3 rounded-md text-xs font-bold transition-colors flex items-center justify-center ${a==="gemini-3-pro-preview"?"bg-accent text-white":"bg-gray-900 text-gray-400 hover:text-white hover:bg-gray-700"}`,children:"Pro"})}),n.jsx(mt,{content:k("node.action.copyVideoPrompt")+" / Generate",children:n.jsx("button",{onClick:l,className:`h-10 w-10 rounded-md transition-colors flex items-center justify-center ${s?"bg-accent text-white":"bg-gray-900 text-gray-400 hover:text-white hover:bg-gray-700"}`,title:"Generate/Modify Video Prompts",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})})}),n.jsx(mt,{content:k("prompt_sequence_editor.modifySelected",{count:u}),children:n.jsx("button",{onClick:d,disabled:x,className:"flex-grow h-10 px-4 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed flex items-center justify-center",children:c?k("prompt_sequence_editor.modifying"):k("prompt_sequence_editor.modifySelected",{count:u})})})]})})]})},Ou=260,Fu=180,Iy=44,T0=36,NI=160,EI=32,Ty={WS:"Integrate the character/object with a Wide Shot (WS) into the scene and action. Show the environment.",MS:"Integrate the character/object with a Medium Shot (MS) into the scene.",CU:"Integrate the character/object with a Close-Up (CU) into the scene.",ECU:"Integrate the character/object with an Extreme Close-Up (ECU) into the scene. Maximum detail.",LS:"Integrate the character/object with a Long Shot (LS) into the scene to show scale."},Zs=({value:e,onChange:t,min:o,className:r,placeholder:a,title:i})=>{const s=c=>{const d=parseInt(e,10);let u=isNaN(d)?o||0:d+c;o!==void 0&&u<o&&(u=o),t(u.toString())},l=c=>{const d=c.target.value;if(d===""){t("");return}const u=parseInt(d,10);isNaN(u)||t(d)};return n.jsxs("div",{className:`flex items-center bg-gray-600 rounded px-1 h-5 ${r}`,title:i,children:[n.jsx("input",{type:"number",min:o,value:e,onChange:l,placeholder:a,className:"w-6 bg-transparent text-[10px] text-white text-center border-none p-0 focus:outline-none focus:ring-1 focus:ring-cyan-500 rounded-sm [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",onClick:c=>c.stopPropagation(),onMouseDown:c=>c.stopPropagation()}),n.jsxs("div",{className:"flex flex-col h-full ml-0.5 -mr-0.5",children:[n.jsx("button",{className:"h-2.5 flex items-center justify-center hover:text-white text-gray-300 transition-colors",onClick:c=>{c.stopPropagation(),s(1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),n.jsx("button",{className:"h-2.5 flex items-center justify-center hover:text-white text-gray-300 transition-colors",onClick:c=>{c.stopPropagation(),s(-1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})},PI=["WS","MS","CU","ECU","LS"],Ay=At.memo(({index:e,frameNumber:t,sceneNumber:o,prompt:r,videoPrompt:a,shotType:i,characters:s,duration:l,isSelected:c,isCollapsed:d,onToggleCollapse:u,onSelect:p,onChange:m,onDelete:w,onAddAfter:k,onCopy:b,onCopyVideo:x,onMoveUp:f,onMoveDown:h,onMoveToSource:v,onMoveToStart:N,onMoveToEnd:_,isFirst:E,isLast:I,t:B,readOnly:M=!1,isChecked:G,onCheck:V,style:j,onEditInSource:P,onEditPrompt:S,showVideoPrompts:A=!0,showSceneInfo:O=!0,onCopyCombinedPrompt:z})=>{const L=y.useCallback((K,ie)=>{if(M||ie<1)return;const Z=(s||[])[K],se=`Entity-${ie}`,de=[...s||[]];de[K]=se;const re=Z.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),R=new RegExp(`\\(${re}\\)`,"gi"),J=r.replace(R,`(${se})`);m(t,{characters:de,prompt:J})},[M,s,r,m,t]),W=y.useCallback(K=>{if(M)return;const ie=(s||[])[K],Z=(s||[]).filter((R,J)=>J!==K),se=ie.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),de=new RegExp(`\\s*\\(${se}\\)`,"gi"),re=r.replace(de,"").trim().replace(/,\s*$/,"");m(t,{characters:Z,prompt:re})},[M,s,r,m,t]),D=y.useCallback(K=>{if(M)return;const ie=`[${K}] ${r}`;m(t,{prompt:ie})},[M,r,m,t]),T=y.useCallback(()=>{if(M)return;const K=s||[],ie=K.map(re=>parseInt(re.replace(/(?:character|entity)-/i,""),10)).filter(re=>!isNaN(re));let Z=1;for(;ie.includes(Z);)Z++;const se=`Entity-${Z}`,de=[...K,se];m(t,{characters:de})},[M,s,m,t]),F=K=>{if(M)return;const ie=K,Z=J=>(J.match(/(?:character|entity)-\d+/gi)||[]).map(U=>U.toLowerCase()).sort().join(","),se=Z(r),de=Z(ie),re=se!==de,R={prompt:ie};if(re){const J=ie.match(/(?:character|entity)-\d+/gi)||[],H=[...new Set(J.map(U=>U.replace(/character-/i,"Entity-").replace(/entity-/i,"Entity-")))];R.characters=H}m(t,R)},te=K=>{M||m(t,{videoPrompt:K})},$=K=>{M||m(t,{shotType:K.target.value})},oe=`FRAME-${String(t).padStart(3,"0")}${i?`, [${i}]`:""}`,le=i?Ty[i]:void 0;return n.jsxs("div",{onClick:()=>p(t),style:{...j,height:d?`${Iy}px`:A?le?`${Ou+30}px`:`${Ou}px`:le?`${Fu+30}px`:`${Fu}px`},className:`relative group bg-gray-700 p-2 rounded-lg border-2 overflow-hidden mb-1 ${c?"border-connection-text shadow-[0_0_15px_var(--color-connection-text)]":"border-transparent hover:border-gray-600"}`,children:[n.jsxs("div",{className:"flex justify-between items-center mb-1 h-[28px] gap-2 cursor-pointer",onClick:K=>{K.stopPropagation(),u(t)},children:[n.jsxs("div",{className:"flex items-center space-x-2 flex-1 overflow-hidden",children:[V&&n.jsx(mt,{content:"Select frame for batch modification",children:n.jsx("div",{className:"flex-shrink-0",onClick:K=>K.stopPropagation(),children:n.jsx(Ht,{checked:!!G,onChange:(K,ie)=>V(t,ie.shiftKey),className:"h-5 w-5"})})}),n.jsx(we,{tooltipPosition:"right",title:B(d?"node.action.expand":"node.action.collapse"),onClick:K=>{K.stopPropagation(),u(t)},children:d?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7M19 5l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),n.jsx("h4",{className:"text-[10px] font-black text-gray-200 flex-shrink-0 whitespace-nowrap uppercase tracking-tighter",title:oe,children:oe}),n.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0 ml-1",children:[n.jsx("span",{className:"text-[10px] text-gray-500 font-semibold uppercase",children:"ENT:"}),(s||[]).map((K,ie)=>{const Z=parseInt(K.replace(/(?:character|entity)-/i,""),10);return isNaN(Z)?null:n.jsxs("div",{className:"flex items-center bg-gray-600 rounded text-gray-200 border border-gray-500",onClick:se=>se.stopPropagation(),children:[n.jsx("span",{className:"text-[10px] font-semibold px-1.5",children:Z}),n.jsxs("div",{className:"flex flex-col border-l border-gray-500",children:[n.jsx("button",{onClick:se=>{se.stopPropagation(),L(ie,Z+1)},className:"px-0.5 text-gray-300 hover:text-white text-[8px] middle-none disabled:text-gray-500 disabled:cursor-not-allowed",disabled:M,children:""}),n.jsx("button",{onClick:se=>{se.stopPropagation(),L(ie,Z-1)},className:"px-0.5 text-gray-300 hover:text-white text-[8px] border-t border-gray-600 disabled:text-gray-500 disabled:cursor-not-allowed",disabled:M||Z<=1,children:""})]}),n.jsx("button",{onClick:se=>{se.stopPropagation(),D(K)},disabled:M,className:"px-1 text-cyan-300 hover:text-cyan-100 border-l border-gray-500 text-[10px] disabled:text-gray-500 disabled:cursor-not-allowed",title:"Insert at start: [Entity-N]",children:""}),n.jsx("button",{onClick:se=>{se.stopPropagation(),W(ie)},disabled:M,className:"px-1 text-red-300 hover:text-red-100 border-l border-gray-500 text-[10px] disabled:text-gray-500 disabled:cursor-not-allowed",children:""})]},ie)}),n.jsx("button",{onClick:K=>{K.stopPropagation(),T()},disabled:M,className:"flex items-center justify-center w-4 h-4 bg-gray-600 hover:bg-gray-500 rounded text-[10px] text-gray-300 disabled:bg-gray-700 disabled:cursor-not-allowed",children:"+"})]})]}),n.jsxs("div",{className:"flex items-center flex-shrink-0 space-x-1",children:[v&&n.jsx(we,{tooltipPosition:"left",title:"Move to Source",onClick:K=>{K.stopPropagation(),v(t)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),!M&&n.jsxs("div",{className:"flex p-0.5",children:[N&&n.jsx(we,{tooltipPosition:"left",title:"Move to Start",onClick:K=>{K.stopPropagation(),N(e)},disabled:E,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),f&&n.jsx(we,{tooltipPosition:"left",title:"Move Up",onClick:K=>{K.stopPropagation(),f(e)},disabled:E,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),h&&n.jsx(we,{tooltipPosition:"left",title:"Move Down",onClick:K=>{K.stopPropagation(),h(e)},disabled:I,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),_&&n.jsx(we,{tooltipPosition:"left",title:"Move to End",onClick:K=>{K.stopPropagation(),_(e)},disabled:I,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})})]}),!M&&k&&n.jsx(we,{tooltipPosition:"left",title:"Add Frame After",onClick:K=>{K.stopPropagation(),k(t)},className:"p-1 rounded-md text-[#dad5cf] hover:bg-gray-600 hover:text-white transition-colors focus:outline-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),n.jsx(we,{tooltipPosition:"left",title:B("node.action.copyVideoPrompt"),onClick:K=>{K.stopPropagation(),a&&x&&x(a)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})})}),n.jsx(we,{tooltipPosition:"left",title:B("node.action.copyImagePrompt"),onClick:K=>{K.stopPropagation(),b(r)},children:n.jsx(zt,{className:"h-4 w-4"})}),z&&n.jsx(we,{title:"Copy Combined Prompt",tooltipPosition:"bottom",tooltipAlign:"center",onClick:K=>{K.stopPropagation(),z(t)},className:"p-1 rounded-md text-[#dad5cf] hover:bg-gray-600 hover:text-white transition-colors focus:outline-none",children:n.jsx(eh,{className:"h-4 w-4 text-orange-400 group-hover:text-orange-200"})}),!M&&w&&n.jsx(we,{tooltipPosition:"left",title:B("image_sequence.delete_frame"),onClick:K=>{K.stopPropagation(),w(t)},className:"p-1 rounded-md text-gray-500 hover:text-red-400 hover:bg-gray-600 transition-colors focus:outline-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),(!M&&S||M&&P)&&n.jsx(we,{title:B(M?"image_sequence.edit_in_source":"image_sequence.edit_prompt"),tooltipPosition:"left",onClick:K=>{K.stopPropagation(),M&&P?P(t):S&&S(t)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})})]})]}),!d&&n.jsxs("div",{className:"flex flex-col space-y-1 mt-1",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1 bg-gray-800 p-1 rounded",children:[n.jsx("select",{value:i||"WS",onChange:$,disabled:M,className:"bg-gray-700 text-white text-[10px] rounded border border-gray-600 px-1 py-0.5 focus:outline-none focus:ring-1 focus:ring-cyan-500 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed w-20 shrink-0",onClick:K=>K.stopPropagation(),onMouseDown:K=>K.stopPropagation(),children:PI.map(K=>n.jsx("option",{value:K,children:K},K))}),n.jsx("div",{className:"text-[10px] text-gray-400 italic flex-grow truncate",title:le||"No Shot Type",children:le||n.jsx("span",{className:"opacity-50",children:"No shot type selected"})}),!M&&n.jsxs("div",{className:"flex items-center flex-shrink-0 border-l border-gray-600 pl-2",children:[n.jsx(Zs,{value:l.toString(),onChange:K=>m(t,{duration:Math.max(0,parseInt(K,10)||0)}),min:0}),n.jsx("span",{className:"text-[9px] text-gray-500 ml-1",children:"s"})]})]}),n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase",children:"IMAGE PROMPT"}),n.jsx(Rl,{value:r,onDebouncedChange:F,readOnly:M,style:{height:A?"100px":"120px"},className:`w-full text-xs p-1 bg-gray-800 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-2 focus:ring-cyan-500 ${M?"cursor-default":"cursor-text"}`,onClick:K=>K.stopPropagation(),onMouseDown:K=>K.stopPropagation(),onWheel:K=>K.stopPropagation()})]}),A&&n.jsxs("div",{className:"flex flex-col mt-1 pt-1 border-t border-gray-600/30",children:[n.jsx("div",{className:"flex justify-between items-center mb-0.5",children:n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase",children:"VIDEO PROMPT"})}),n.jsx(Rl,{value:a||"",onDebouncedChange:te,readOnly:M,style:{height:"60px"},className:`w-full text-xs p-1 bg-gray-800 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-2 focus:ring-cyan-500 ${M?"cursor-default":"cursor-text"}`,onClick:K=>K.stopPropagation(),onMouseDown:K=>K.stopPropagation(),onWheel:K=>K.stopPropagation()})]})]})]})}),Ry=(e,t,o,r=800,a=!0,i=!0,s={},l=[],c=[])=>{const d=y.useMemo(()=>{const k=[...e].sort((h,v)=>h.frameNumber-v.frameNumber),b=[];let x=-1,f=null;return k.forEach(h=>{const v=h.sceneNumber||1;if(v!==x){x=v;const N=h.sceneTitle||"";f={scene:v,title:N,prompts:[]},b.push(f)}f&&f.prompts.push(h)}),b},[e]),u=y.useMemo(()=>{const k=[];let b=0;return d.forEach(x=>{if(i&&(k.push({type:"scene_header",h:T0,top:b,data:x,scene:x.scene}),b+=T0),!i||!t.includes(x.scene)){const f=s[String(x.scene)]||"",h=l.includes(x.scene)?NI:EI;k.push({type:"scene_context",h:h+8,top:b,data:f,scene:x.scene}),b+=h+8,x.prompts.forEach(v=>{const _=(v.shotType?Ty[v.shotType]:void 0)?30:0,E=(a?Ou:Fu)+_,I=(v.isCollapsed?Iy:E)+8;k.push({type:"prompt",h:I,top:b,data:v,scene:x.scene}),b+=I})}}),{items:k,totalHeight:b}},[d,t,a,i,s,l,c]),p=y.useMemo(()=>{const b=Math.max(0,o-800),x=o+r+800;return u.items.filter(f=>f.top+f.h>b&&f.top<x)},[u,o,r]),m=k=>{const b=u.items.find(x=>x.type==="prompt"&&x.data.frameNumber===k);return b?b.top:null},w=k=>{if(!i)return null;const b=u.items.find(x=>x.type==="scene_header"&&x.scene===k);return b?b.top:null};return{groupedPrompts:d,virtualItems:u,visibleItems:p,totalHeight:u.totalHeight,getScrollPositionForFrame:m,getScrollPositionForScene:w}},jI=y.forwardRef(({prompts:e,collapsedScenes:t,checkedFrameNumbers:o,selectedFrameNumber:r,isLinked:a,onUpdatePrompts:i,onLoadFile:s,onSaveToCatalog:l,onSaveToDisk:c,t:d,onSelect:u,onToggleCollapse:p,onToggleScene:m,onDetachToEditor:w,onClearAll:k,onAddPrompt:b,onAddScene:x,onDeletePrompt:f,onMovePromptUp:h,onMovePromptDown:v,onMoveToStart:N,onMoveToEnd:_,onRegenerate:E,isAnyGenerationInProgress:I,onEditInSource:B,onEditPrompt:M,isGeneratingSequence:G,allConceptsLength:V,selectionKey:j="checkedSourceFrameNumbers",onUnlink:P,addToast:S,onClearTextOnly:A,sceneContexts:O={},onUpdateSceneContext:z,expandedSceneContexts:L=[],onToggleSceneContext:W,checkedContextScenes:D=[],onToggleContextCheck:T,onCopyCombinedPrompt:F},te)=>{const $=y.useRef(null),[Y,oe]=y.useState(0),[le,K]=y.useState(800),[ie,Z]=y.useState(!1),[se,de]=y.useState(""),[re,R]=y.useState(""),[J,H]=y.useState(""),[U,ee]=y.useState(!0),[ae,xe]=y.useState(!0);y.useEffect(()=>{if(!$.current)return;const be=()=>{$.current&&requestAnimationFrame(()=>{$.current&&(K($.current.clientHeight),oe($.current.scrollTop))})},Ae=new ResizeObserver(be);return Ae.observe($.current),be(),()=>Ae.disconnect()},[]);const{groupedPrompts:ne,totalHeight:X,visibleItems:ue,getScrollPositionForFrame:Q}=Ry(e,t,Y,le,U,ae,O,L,D);y.useImperativeHandle(te,()=>({scrollToFrame:be=>{const Ae=Q(be);Ae!==null&&$.current&&$.current.scrollTo({top:Math.max(0,Ae-100),behavior:"smooth"})},scrollToBottom:()=>{$.current&&$.current.scrollTo({top:$.current.scrollHeight,behavior:"smooth"})}}));const ce=be=>{const Ae=parseInt(be||se,10);if(isNaN(Ae))return;const Te=e.find(Nt=>Nt.frameNumber===Ae);if(!Te)return;const qe=Te.sceneNumber||1;let Ye=[...t];Ye.includes(qe)&&(Ye=Ye.filter(Nt=>Nt!==qe));const nt=e.map(Nt=>Nt.frameNumber===Ae?{...Nt,isCollapsed:!1}:Nt);i({prompts:nt,sourcePrompts:nt,collapsedScenes:Ye,collapsedSourceScenes:Ye,selectedFrameNumber:Ae}),setTimeout(()=>{const Nt=Q(Ae);Nt!==null&&$.current&&$.current.scrollTo({top:Nt,behavior:"smooth"})},100)},pe=be=>{if(be.preventDefault(),be.stopPropagation(),Z(!1),a)return;const Ae=be.dataTransfer.files[0];if(Ae&&Ae.type==="application/json"){const Te=new FileReader;Te.onload=qe=>{var Ye;if((Ye=qe.target)!=null&&Ye.result)try{const nt=JSON.parse(qe.target.result);let Nt=nt.finalPrompts||nt.prompts||(Array.isArray(nt)?nt:[]),ze=nt.sceneContexts||{};Nt.length>0&&i({sourcePrompts:Nt,prompts:Nt,sceneContexts:ze})}catch(nt){console.error(nt)}},Te.readAsText(Ae)}},me=()=>{const be=parseInt(re,10),Ae=parseInt(J,10);if(isNaN(be)||isNaN(Ae))return;const Te=Math.max(1,be),qe=Math.min(e.length,Ae);if(Te>qe)return;const Ye=[];for(let nt=Te;nt<=qe;nt++)Ye.push(nt);i({[j]:Ye})},ke=()=>i({[j]:e.map(be=>be.frameNumber)}),Re=()=>i({[j]:[]}),Me=()=>{const Ae=e.map(Te=>Te.frameNumber).filter(Te=>!o.includes(Te));i({[j]:Ae})},De=ne.length>0&&ne.every(be=>t.includes(be.scene)),Ie=()=>{const be=ne.map(Te=>Te.scene),Ae=De?[]:be;i({collapsedScenes:Ae,collapsedSourceScenes:Ae})},Ne=e.every(be=>be.isCollapsed),Pe=()=>{const be=e.map(Ae=>({...Ae,isCollapsed:!Ne}));i({prompts:be,sourcePrompts:be})},ye=(be,Ae)=>{if(a)return;const Te=e.map(qe=>qe.frameNumber===be?{...qe,...Ae}:qe);i({prompts:Te,sourcePrompts:Te})},_e=(be,Ae)=>{if(Ae){i({[j]:[be]});return}const Te=o.includes(be)?o.filter(qe=>qe!==be):[...o,be];i({[j]:Te})},Fe=be=>{navigator.clipboard.writeText(be),S&&S(d("toast.copiedToClipboard"))},We=()=>{A?A():k()},Ze=be=>{const Ae=ne.find(nt=>nt.scene===be);if(!Ae)return;const Te=Ae.prompts.map(nt=>nt.frameNumber),qe=Te.every(nt=>o.includes(nt));let Ye;qe?Ye=o.filter(nt=>!Te.includes(nt)):Ye=[...new Set([...o,...Te])],i({[j]:Ye})},$e=be=>{const Ae=ne.find(nt=>nt.scene===be);if(!Ae)return;const Te=Ae.prompts.map(nt=>nt.frameNumber),Ye=ne.map(nt=>nt.scene).filter(nt=>nt!==be);i({[j]:Te,checkedContextScenes:[be],collapsedScenes:Ye,collapsedSourceScenes:Ye}),Te.length>0&&setTimeout(()=>{const nt=Q(Te[0]);nt!==null&&$.current&&$.current.scrollTo({top:Math.max(0,nt-40),behavior:"smooth"})},50)},He=be=>{const Ae=ne.find(Te=>Te.scene===be);return!Ae||Ae.prompts.length===0?!1:Ae.prompts.every(Te=>o.includes(Te.frameNumber))};return n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-h-0",children:[n.jsxs("div",{className:"flex justify-between items-center flex-shrink-0 bg-gray-900/50 p-1 rounded-md border border-gray-700 h-9",onWheel:be=>be.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center space-x-1 h-full",children:[a&&n.jsx("button",{className:"text-cyan-400 hover:text-white transition-colors",title:"Linked to Upstream (Click to Unlink and Copy)",onClick:be=>{be.stopPropagation(),P&&P()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),!a&&e.length>0&&w&&n.jsx(we,{title:"Detach and Edit",onClick:w,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-400 hover:text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),n.jsx("h3",{className:"text-sm font-bold text-gray-300 px-1 whitespace-nowrap",children:d("image_sequence.prompts_list_title")||"Prompts"}),n.jsx("div",{className:"flex items-center",children:n.jsx(Zs,{value:se,placeholder:"#",onChange:be=>{de(be),ce(be)},min:1,className:"w-12 border-none",title:"Go to Frame"})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsxs("div",{className:"flex items-center gap-1 bg-gray-800 rounded p-0.5 h-6",children:[n.jsx("span",{className:"text-[9px] text-gray-400 px-1 whitespace-nowrap",children:d("image_sequence.range_from")}),n.jsx(Zs,{value:re,placeholder:"1",onChange:R,min:1,className:"w-10 border-none"}),n.jsx("span",{className:"text-[9px] text-gray-400 px-1 whitespace-nowrap",children:d("image_sequence.range_to")}),n.jsx(Zs,{value:J,placeholder:"N",onChange:H,min:1,className:"w-10 border-none"}),n.jsx(we,{title:"Select range",onClick:be=>{be.stopPropagation(),me()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-800 rounded p-0.5 h-6",children:[n.jsx(we,{title:d("image_sequence.select_all"),onClick:ke,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600"}),n.jsx(we,{title:d("image_sequence.select_none"),onClick:Re,disabled:o.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600"}),n.jsx(we,{title:d("image_sequence.invert_selection"),onClick:Me,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})})]})]}),n.jsxs("div",{className:"flex items-center space-x-1 h-full",children:[n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-900/50 rounded p-0.5",children:[n.jsx(we,{title:"Add Scene",onClick:x,disabled:a,children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m-3-3h6"})]})}),n.jsx(we,{title:d("image_sequence.add_frame"),onClick:()=>b(-1),disabled:a,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(we,{title:U?" -":" -",onClick:()=>ee(!U),children:U?n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})}),n.jsx(we,{title:ae?" ":" ",onClick:()=>xe(!ae),children:ae?n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(we,{title:De?"Expand Scenes":"Collapse Scenes",onClick:Ie,children:De?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})}),n.jsx(we,{title:Ne?"Expand Prompts":"Collapse Prompts",onClick:Pe,disabled:De,children:Ne?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),!a&&n.jsx(we,{title:d("image_sequence.clear_prompts_only"),onClick:We,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),n.jsx("div",{ref:$,className:`flex-grow min-h-0 bg-gray-900/50 p-2 rounded-md border-2 border-dashed transition-colors overflow-y-auto scrollbar-gutter-stable ${ie?"border-cyan-500 bg-gray-700/50":"border-transparent"} ${ie?"bg-cyan-900/20":""}`,onScroll:be=>oe(be.currentTarget.scrollTop),onDragOver:be=>{be.preventDefault(),be.stopPropagation(),Z(!0)},onDragLeave:()=>Z(!1),onDrop:pe,onWheel:be=>be.stopPropagation(),style:{overscrollBehaviorY:"contain"},children:e.length===0?n.jsx("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500 p-4 cursor-pointer",onClick:()=>!a&&b(-1),children:a?n.jsxs(n.Fragment,{children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-gray-400 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),n.jsx("p",{className:"font-semibold text-sm",children:"Linked to References"}),n.jsx("p",{className:"text-xs",children:"Waiting for data..."})]}):n.jsxs(n.Fragment,{children:[n.jsx("h4",{className:"font-semibold text-sm",children:d("image_sequence.drop_or_add_title")}),n.jsx("p",{className:"text-xs",children:d("image_sequence.drop_or_add_desc")})]})}):n.jsx("div",{style:{height:X,position:"relative"},children:ue.map(be=>{if(be.type==="scene_header"){const Ae=be.data,Te=t.includes(Ae.scene);return n.jsx("div",{style:{position:"absolute",top:be.top,left:0,right:0,height:be.h,paddingBottom:4},children:n.jsxs("div",{className:"flex items-center justify-between bg-gray-800 p-1 rounded select-none cursor-pointer hover:bg-gray-700 transition-colors h-full",onClick:qe=>{qe.stopPropagation(),m(Ae.scene)},children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"text-gray-400",children:Te?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),n.jsxs("div",{className:"flex items-center gap-2",onClick:qe=>qe.stopPropagation(),children:[n.jsx(mt,{content:"Include Context in Modification",children:n.jsx("div",{onClick:qe=>{qe.stopPropagation()},children:n.jsx(Ht,{checked:T&&D?D.includes(Ae.scene):!1,onChange:()=>T&&T(Ae.scene)})})}),n.jsx(mt,{content:"Select All Frames in Scene",children:n.jsx("div",{onClick:qe=>{qe.stopPropagation()},children:n.jsx(Ht,{checked:He(Ae.scene),onChange:()=>Ze(Ae.scene),className:"text-cyan-400"})})})]}),n.jsxs("span",{className:"text-xs font-bold text-gray-300 uppercase tracking-wider bg-gray-800 px-2 py-1 rounded",children:[d("image_sequence.scene_input_label")," ",Ae.scene,Ae.title?`: ${Ae.title}`:""]}),n.jsxs("span",{className:"text-[10px] text-gray-500",children:["(",Ae.prompts.length," frames)"]})]}),n.jsx("div",{className:"flex items-center px-2",children:n.jsx(we,{title:"Focus Scene (Collapse others)",tooltipPosition:"left",onClick:qe=>{qe.stopPropagation(),$e(Ae.scene)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-accent hover:text-accent-hover",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})})})})]})},`header-${Ae.scene}`)}else if(be.type==="scene_context"){const Ae=be.data,Te=be.scene,qe=L.includes(Te);return n.jsx("div",{style:{position:"absolute",top:be.top,left:0,right:0,height:be.h},className:"pl-2 border-l-2 border-connection-text ml-2 pb-2",children:n.jsxs("div",{className:"bg-gray-800/80 rounded border border-connection-text p-2 h-full flex flex-col",children:[n.jsx("div",{className:"flex justify-between items-center cursor-pointer select-none",onClick:Ye=>{Ye.stopPropagation(),W&&W(Te)},children:n.jsx("div",{className:"flex items-center gap-2",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(mt,{content:"Include Context in Modification",children:n.jsx("div",{onClick:Ye=>Ye.stopPropagation(),children:n.jsx(Ht,{checked:T&&D?D.includes(Te):!1,onChange:()=>T&&T(Te)})})}),n.jsx("div",{className:"text-connection-text",children:qe?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})}),n.jsx("label",{className:"text-[10px] font-bold text-connection-text uppercase tracking-wider cursor-pointer",children:"SCENE CONTEXT"})]})})}),qe&&n.jsx("div",{className:"flex-grow min-h-0 mt-2",children:n.jsx(Cn,{value:Ae,onDebouncedChange:Ye=>z&&z(Te,Ye),readOnly:a,className:`w-full h-full text-xs p-1.5 bg-gray-900/50 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-1 focus:ring-accent ${a?"cursor-default":"cursor-text"}`,placeholder:"Describe scene environment and context...",onMouseDown:Ye=>Ye.stopPropagation(),onWheel:Ye=>Ye.stopPropagation()})})]})},`context-${Te}`)}else{const Ae=be.data,Te=e.findIndex(Ye=>Ye.frameNumber===Ae.frameNumber),qe=r===Ae.frameNumber;return n.jsx("div",{style:{position:"absolute",top:be.top,left:0,right:0,height:be.h},className:"pl-2 border-l-2 border-gray-700 ml-2",children:n.jsx(Ay,{index:Te,frameNumber:Ae.frameNumber,sceneNumber:Ae.sceneNumber,prompt:Ae.prompt,videoPrompt:Ae.videoPrompt,shotType:Ae.shotType,characters:Ae.characters,duration:Ae.duration||0,isSelected:qe,isCollapsed:Ae.isCollapsed??!1,onToggleCollapse:()=>p(Ae.frameNumber),onSelect:()=>u(Ae.frameNumber),onChange:ye,onCopy:Ye=>Fe(Ye),onCopyVideo:Ye=>Fe(Ye),t:d,readOnly:a,isChecked:o.includes(Ae.frameNumber),onCheck:(Ye,nt)=>_e(Ye,nt),onDelete:()=>f(Ae.frameNumber),onAddAfter:()=>b(Ae.frameNumber),onMoveUp:()=>h(Te),onMoveDown:()=>v(Te),onMoveToStart:()=>N(Te),onMoveToEnd:()=>_(Te),isFirst:Te===0,isLast:Te===e.length-1,showVideoPrompts:U,onRegenerate:E,isAnyGenerationInProgress:I||G,onEditInSource:B,onEditPrompt:M,maxCharacters:V,onCopyCombinedPrompt:F})},`prompt-${Ae.frameNumber}`)}})})}),!a&&n.jsxs("div",{className:"flex-shrink-0 flex space-x-2",children:[n.jsx("div",{className:"flex-1 flex space-x-1",children:n.jsx("button",{onClick:s,className:"flex-1 px-3 py-2 text-sm font-semibold text-white bg-accent-secondary hover:bg-accent-secondary-hover rounded-md",children:d("image_sequence.load_prompts")})}),n.jsx("button",{onClick:l,disabled:e.length===0,className:"flex-1 px-3 py-2 text-sm font-semibold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",title:d("catalog.saveTo"),children:d("catalog.saveTo")}),n.jsx(we,{title:d("group.saveToDisk"),onClick:c,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]})]})}),II=({prompts:e,collapsedScenes:t,isLinked:o,onUpdatePrompts:r,t:a,onToggleCollapse:i,onToggleScene:s,onMoveToSource:l,onMoveAllToSource:c,onClear:d,sceneContexts:u={},modifiedSceneContexts:p={},expandedSceneContexts:m=[],onToggleSceneContext:w,onUpdateSceneContext:k})=>{const b=y.useRef(null),[x,f]=y.useState(0),[h,v]=y.useState(800);y.useEffect(()=>{if(!b.current)return;const P=()=>{b.current&&requestAnimationFrame(()=>{b.current&&(v(b.current.clientHeight),f(b.current.scrollTop))})},S=new ResizeObserver(P);return S.observe(b.current),P(),()=>S.disconnect()},[]);const N=y.useMemo(()=>({...u,...p}),[u,p]),{groupedPrompts:_,totalHeight:E,visibleItems:I}=Ry(e,t,x,h,!0,!0,N,m),B=_.length>0&&_.every(P=>t.includes(P.scene)),M=()=>{const P=_.map(S=>S.scene);r({collapsedModifiedScenes:B?[]:P})},G=e.every(P=>P.isCollapsed),V=()=>{r({modifiedPrompts:e.map(P=>({...P,isCollapsed:!G}))})},j=(P,S)=>{const A=e.map(O=>O.frameNumber===P?{...O,...S}:O);r({modifiedPrompts:A})};return n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-h-0",children:[n.jsxs("div",{className:"flex justify-between items-center flex-shrink-0",children:[n.jsx("h3",{className:"text-sm font-bold text-gray-300",children:a("prompt_sequence_editor.finalPrompts")}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(we,{title:"Move All to Source",onClick:c,disabled:e.length===0||!!o,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),n.jsx(we,{title:B?"Expand Scenes":"Collapse Scenes",onClick:M,children:B?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})}),n.jsx(we,{title:G?"Expand Prompts":"Collapse Prompts",onClick:V,disabled:B,children:G?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),n.jsx(we,{title:"Clear Modified",onClick:d,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),n.jsx("div",{ref:b,onScroll:P=>f(P.currentTarget.scrollTop),className:"flex-grow min-h-0 bg-gray-900/50 p-2 rounded-md overflow-y-auto scrollbar-gutter-stable",onWheel:P=>P.stopPropagation(),children:e.length===0?n.jsx("div",{className:"h-full flex items-center justify-center text-gray-500",children:"  ."}):n.jsx("div",{style:{height:E,position:"relative"},children:I.map(P=>{if(P.type==="scene_header"){const S=P.data,A=t.includes(S.scene);return n.jsx("div",{style:{position:"absolute",top:P.top,left:0,right:0,height:P.h,paddingBottom:4},children:n.jsx("div",{className:"flex items-center justify-between bg-gray-800 p-1 rounded select-none cursor-pointer hover:bg-gray-700 transition-colors h-full",onClick:O=>{O.stopPropagation(),s(S.scene)},children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"text-gray-400",children:A?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),n.jsxs("span",{className:"text-xs font-bold text-gray-300 uppercase tracking-wider bg-gray-800 px-2 py-1 rounded",children:[a("image_sequence.scene_input_label")," ",S.scene,S.title?`: ${S.title}`:""]}),n.jsxs("span",{className:"text-[10px] text-gray-500",children:["(",S.prompts.length," frames)"]})]})})},`mod-header-${S.scene}`)}else if(P.type==="scene_context"){const S=P.data,A=P.scene,O=m==null?void 0:m.includes(A),z=p[String(A)]!==void 0;return n.jsx("div",{style:{position:"absolute",top:P.top,left:0,right:0,height:P.h},className:"pl-2 border-l-2 border-connection-text ml-2 pb-2",children:n.jsxs("div",{className:"bg-gray-800/80 rounded border border-connection-text p-2 h-full flex flex-col",children:[n.jsx("div",{className:"flex justify-between items-center cursor-pointer select-none",onClick:L=>{L.stopPropagation(),w&&w(A)},children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:z?"text-orange-500":"text-connection-text",children:O?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})}),n.jsxs("label",{className:`text-[10px] font-bold uppercase tracking-wider cursor-pointer ${z?"text-orange-400":"text-connection-text"}`,children:["SCENE CONTEXT ",z&&"(Modified)"]})]})}),O&&n.jsx("div",{className:"flex-grow min-h-0 mt-2",children:n.jsx(Cn,{value:S,onDebouncedChange:L=>k&&k(A,L),className:"w-full h-full text-xs p-1.5 bg-gray-900/50 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-1 focus:ring-accent cursor-text",placeholder:"Describe scene environment and context...",onMouseDown:L=>L.stopPropagation(),onWheel:L=>L.stopPropagation()})})]})},`mod-context-${A}`)}else{const S=P.data;return n.jsx("div",{style:{position:"absolute",top:P.top,left:0,right:0,height:P.h},className:"pl-2 border-l-2 border-gray-700 ml-2",children:n.jsx(Ay,{index:S.frameNumber,frameNumber:S.frameNumber,sceneNumber:S.sceneNumber,prompt:S.prompt,videoPrompt:S.videoPrompt,shotType:S.shotType,characters:S.characters,duration:S.duration||0,isModified:!0,isSelected:!1,isCollapsed:S.isCollapsed??!1,onSelect:()=>{},onChange:j,onCopy:A=>navigator.clipboard.writeText(A),t:a,readOnly:!1,onToggleCollapse:()=>i(S.frameNumber),onMoveToSource:()=>l(S.frameNumber)})},`modified-${S.frameNumber}`)}})})})]})},ir=620,A0=400,TI=({node:e,onValueChange:t,onModifyPromptSequence:o,isModifyingPromptSequence:r,t:a,onLoadPromptSequenceFile:i,onSaveSequenceToCatalog:s,onSaveScriptToDisk:l,setError:c,connectedInputs:d,getUpstreamNodeValues:u,addToast:p,viewTransform:m})=>{const{setConnections:w}=Kt(),k=y.useRef(null),b=y.useRef(null),x=y.useRef(null),f=`instruction-input-${e.id}`,h=d==null?void 0:d.has("prompts_sequence"),v=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{instruction:"",sourcePrompts:[],modifiedPrompts:[],leftPaneWidth:ir,checkedSourceFrameNumbers:[],selectedFrameNumber:null,styleOverride:"",isStyleSelected:!1,isStyleCollapsed:!0,isUsedCharsCollapsed:!0,usedCharacters:[],collapsedSourceScenes:[],collapsedModifiedScenes:[],targetLanguage:"en",modificationModel:"gemini-3-flash-preview",includeVideoPrompts:!1,sceneContexts:{},modifiedSceneContexts:{},expandedSceneContexts:[],checkedContextScenes:[]}}},[e.value]),N=y.useRef(v);y.useEffect(()=>{N.current=v},[v]);let _=v.leftPaneWidth;!_&&v.leftPaneRatio?_=Math.max(ir,(e.width||1200)*v.leftPaneRatio):_||(_=ir);const{instruction:E="",sourcePrompts:I=[],modifiedPrompts:B=[],checkedSourceFrameNumbers:M=[],selectedFrameNumber:G=null,styleOverride:V="",isStyleCollapsed:j=!0,isUsedCharsCollapsed:P=!0,usedCharacters:S=[],collapsedSourceScenes:A=[],collapsedModifiedScenes:O=[],targetLanguage:z="en",modificationModel:L="gemini-3-flash-preview",includeVideoPrompts:W=!1,sceneContexts:D={},modifiedSceneContexts:T={},expandedSceneContexts:F=[],checkedContextScenes:te=[]}=v,$=_,Y=y.useCallback(Q=>{const pe={...N.current,...Q};N.current=pe,t(e.id,JSON.stringify(pe))},[e.id,t]);y.useEffect(()=>{G!==null&&setTimeout(()=>{var Q;(Q=b.current)==null||Q.scrollToFrame(G)},100)},[G]);const oe=y.useCallback(Q=>{const ce=[...N.current.sourcePrompts||[]],pe=ce.length>0?Math.max(...ce.map(Re=>Re.frameNumber))+1:1,me=ce.length>0?ce[ce.length-1].sceneNumber:1,ke={frameNumber:pe,sceneNumber:me,sceneTitle:"",prompt:"",videoPrompt:"",shotType:"MS",characters:[],duration:3,isCollapsed:!1};if(Q!==void 0&&Q!==-1){const Re=ce.findIndex(Me=>Me.frameNumber===Q);if(Re!==-1){ce.splice(Re+1,0,ke);const Me=ce.map((De,Ie)=>({...De,frameNumber:Ie+1}));Y({sourcePrompts:Me});return}}Y({sourcePrompts:[...ce,ke]})},[Y]),le=y.useCallback(()=>{const Q=[...N.current.sourcePrompts||[]],pe=(Q.length>0?Math.max(...Q.map(Re=>Re.sceneNumber||1)):0)+1,ke={frameNumber:Q.length>0?Math.max(...Q.map(Re=>Re.frameNumber))+1:1,sceneNumber:pe,sceneTitle:`Scene ${pe}`,prompt:"",videoPrompt:"",shotType:"MS",characters:[],duration:3,isCollapsed:!1};Y({sourcePrompts:[...Q,ke]})},[Y]),K=y.useCallback(Q=>{const me=(N.current.sourcePrompts||[]).filter(ke=>ke.frameNumber!==Q).map((ke,Re)=>({...ke,frameNumber:Re+1}));Y({sourcePrompts:me})},[Y]),ie=y.useCallback(Q=>{if(Q<=0)return;const pe=[...N.current.sourcePrompts||[]];[pe[Q-1],pe[Q]]=[pe[Q],pe[Q-1]],Y({sourcePrompts:pe.map((me,ke)=>({...me,frameNumber:ke+1}))})},[Y]),Z=y.useCallback(Q=>{const ce=N.current.sourcePrompts||[];if(Q>=ce.length-1)return;const pe=[...ce];[pe[Q],pe[Q+1]]=[pe[Q+1],pe[Q]],Y({sourcePrompts:pe.map((me,ke)=>({...me,frameNumber:ke+1}))})},[Y]),se=y.useCallback(Q=>{const pe=[...N.current.sourcePrompts||[]],[me]=pe.splice(Q,1);pe.unshift(me),Y({sourcePrompts:pe.map((ke,Re)=>({...ke,frameNumber:Re+1}))})},[Y]),de=y.useCallback(Q=>{const pe=[...N.current.sourcePrompts||[]],[me]=pe.splice(Q,1);pe.push(me),Y({sourcePrompts:pe.map((ke,Re)=>({...ke,frameNumber:Re+1}))})},[Y]),re=y.useCallback(Q=>{b.current&&(b.current.scrollToFrame(Q),Y({selectedFrameNumber:Q}))},[Y]),R=y.useCallback(Q=>{const ce=N.current.sourcePrompts||[],pe=N.current.modifiedPrompts||[],me=pe.find(Me=>Me.frameNumber===Q);if(!me)return;const ke=ce.map(Me=>Me.frameNumber===Q?{...Me,...me}:Me),Re=pe.filter(Me=>Me.frameNumber!==Q);Y({sourcePrompts:ke,modifiedPrompts:Re})},[Y]),J=y.useCallback(()=>{const Q=N.current.sourcePrompts||[],ce=N.current.modifiedPrompts||[],pe=new Map(ce.map(De=>[De.frameNumber,De])),me=Q.map(De=>{const Ie=pe.get(De.frameNumber);return Ie?{...De,...Ie}:De}),ke=N.current.sceneContexts||{},Re=N.current.modifiedSceneContexts||{},Me={...ke,...Re};Y({sourcePrompts:me,modifiedPrompts:[],sceneContexts:Me,modifiedSceneContexts:{}})},[Y]);y.useEffect(()=>{if(!e.width)return;const Q=e.width-A0;$>Q?Y({leftPaneWidth:Math.max(ir,Q)}):$<ir&&Y({leftPaneWidth:ir})},[e.width,$,Y]),y.useEffect(()=>{if(h){const ce=u(e.id,"prompts_sequence")[0];if(typeof ce=="string"&&ce.trim()!=="")try{const pe=JSON.parse(ce);if(pe.type==="script-prompt-modifier-data"&&Array.isArray(pe.finalPrompts)){const me=pe.finalPrompts,ke=pe.usedCharacters||[],Re=pe.sceneContexts||{},Me=[];let De=!1;me.forEach(Ie=>{const Ne=I.find(ye=>ye.frameNumber===Ie.frameNumber),Pe={frameNumber:Ie.frameNumber,sceneNumber:Ie.sceneNumber||1,sceneTitle:Ie.sceneTitle||"",prompt:Ie.prompt||"",videoPrompt:Ie.videoPrompt||"",shotType:Ie.shotType||Ie.ShotType||"MS",characters:Ie.characters||[],duration:Ie.duration||3,isCollapsed:Ne?Ne.isCollapsed:!0};(!Ne||Ne.prompt!==Pe.prompt||Ne.videoPrompt!==Pe.videoPrompt||Ne.shotType!==Pe.shotType||JSON.stringify(Ne.characters)!==JSON.stringify(Pe.characters))&&(De=!0),Me.push(Pe)}),(I.length!==Me.length||JSON.stringify(S)!==JSON.stringify(ke)||JSON.stringify(D)!==JSON.stringify(Re))&&(De=!0),De&&Y({sourcePrompts:Me,usedCharacters:ke,sceneContexts:Re})}}catch{}}},[h,u,e.id,Y,I,S,D]);const H=y.useCallback(Q=>{Q.preventDefault(),Q.stopPropagation();const ce=(m==null?void 0:m.scale)||1;x.current={startX:Q.clientX,startWidth:N.current.leftPaneWidth||ir};const pe=ke=>{const Re=x.current;if(!Re)return;const Me=(ke.clientX-Re.startX)/ce,De=Re.startWidth+Me,Ie=e.width-A0,Ne=Math.max(ir,Math.min(De,Ie));Y({leftPaneWidth:Ne})},me=()=>{x.current=null,window.removeEventListener("mousemove",pe),window.removeEventListener("mouseup",me)};window.addEventListener("mousemove",pe),window.addEventListener("mouseup",me)},[Y,m,e.width]),U=()=>Y({isStyleCollapsed:!j}),ee=()=>Y({isUsedCharsCollapsed:!P}),ae=(Q,ce)=>{const pe=[...S];pe[Q]={...pe[Q],name:ce},Y({usedCharacters:pe})},xe=(Q,ce)=>{const pe={...D,[Q]:ce};Y({sceneContexts:pe})},ne=(Q,ce)=>{const me={...N.current.modifiedSceneContexts||{},[Q]:ce};Y({modifiedSceneContexts:me})},X=Q=>{const ce=F||[],pe=ce.includes(Q)?ce.filter(me=>me!==Q):[...ce,Q];Y({expandedSceneContexts:pe})},ue=Q=>{const ce=te||[],pe=ce.includes(Q)?ce.filter(me=>me!==Q):[...ce,Q];Y({checkedContextScenes:pe})};return n.jsxs("div",{ref:k,className:"relative h-full w-full flex space-x-2",onMouseDown:Q=>Q.stopPropagation(),onWheel:Q=>Q.stopPropagation(),children:[n.jsxs("div",{className:"h-full flex flex-col space-y-2 flex-shrink-0",style:{width:`${$}px`},children:[n.jsx(SI,{instruction:E,onInstructionChange:Q=>Y({instruction:Q}),targetLanguage:z,onLanguageChange:Q=>Y({targetLanguage:Q}),modificationModel:L,onModelChange:Q=>Y({modificationModel:Q}),includeVideoPrompts:W,onToggleVideoPrompts:()=>Y({includeVideoPrompts:!W}),includeSceneContext:!1,onToggleSceneContextOption:()=>{},isModifying:r,onModify:()=>o(e.id),checkedCount:M.length,checkedContextCount:te.length,totalPrompts:I.length,instructionInputId:f,t:a}),n.jsxs("div",{className:"flex flex-col space-y-1 mb-1 flex-shrink-0",children:[n.jsxs("div",{className:"flex justify-between items-center cursor-pointer hover:bg-gray-700/50 rounded-md px-1 transition-colors group",onClick:ee,children:[n.jsx("label",{className:"text-[10px] font-bold text-connection-text uppercase cursor-pointer py-1 flex-grow",children:" "}),n.jsx("div",{className:"text-gray-500 group-hover:text-gray-300 p-1",children:P?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!P&&n.jsx("div",{className:"bg-gray-700/50 p-2 rounded-md border border-gray-600 max-h-40 overflow-y-auto custom-scrollbar",children:S.length>0?S.map((Q,ce)=>n.jsxs("div",{className:"flex items-center gap-1 mb-1 last:mb-0 group/item",children:[n.jsxs("div",{className:"flex items-center gap-1 min-w-[100px] shrink-0 bg-gray-800/50 rounded px-1 border border-gray-600/50",children:[n.jsxs("span",{className:"text-[10px] font-mono text-connection-text truncate w-16",children:[Q.index,":"]}),n.jsx("button",{onClick:pe=>{pe.stopPropagation(),navigator.clipboard.writeText(`[${Q.index}]`),p&&p(a("toast.copiedToClipboard"))},className:"text-gray-500 hover:text-white p-0.5 transition-colors opacity-0 group-hover/item:opacity-100",title:"Copy as [Tag]",children:n.jsx(zt,{className:"h-3 w-3"})})]}),n.jsxs("div",{className:"flex-grow flex items-center bg-gray-800 border-none rounded px-1.5 py-0.5 relative",children:[n.jsx("input",{type:"text",value:Q.name,onChange:pe=>ae(ce,pe.target.value),placeholder:" ...",className:"w-full bg-transparent border-none text-[10px] text-gray-200 focus:outline-none focus:ring-0",onMouseDown:pe=>pe.stopPropagation()}),n.jsx("button",{onClick:pe=>{pe.stopPropagation(),navigator.clipboard.writeText(Q.name),p&&p(a("toast.copiedToClipboard"))},className:"text-gray-500 hover:text-white p-0.5 transition-colors opacity-0 group-hover/item:opacity-100 absolute right-1",title:"Copy Name",children:n.jsx(zt,{className:"h-3 w-3"})})]})]},ce)):n.jsx("div",{className:"text-[10px] text-gray-500 italic",children:"  ."})})]}),n.jsxs("div",{className:"flex flex-col space-y-1 mb-2 flex-shrink-0",children:[n.jsxs("div",{className:"flex justify-between items-center cursor-pointer hover:bg-gray-700/50 rounded-md px-1 transition-colors group",onClick:U,children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase cursor-pointer py-1 flex-grow",children:a("node.content.style")}),n.jsx("div",{className:"text-gray-500 group-hover:text-gray-300 p-1",children:j?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!j&&n.jsx(Cn,{value:V,onDebouncedChange:Q=>Y({styleOverride:Q}),className:"w-full p-2 bg-gray-700 border-none rounded-md resize-none focus:outline-none text-xs",style:{minHeight:"60px"},onMouseDown:Q=>Q.stopPropagation(),onWheel:Q=>Q.stopPropagation()})]}),n.jsx(jI,{ref:b,prompts:I,collapsedScenes:A,checkedFrameNumbers:M,selectedFrameNumber:G,selectionKey:"checkedSourceFrameNumbers",isLinked:!!h,onUpdatePrompts:Y,onLoadFile:()=>i(e.id),onSaveToCatalog:()=>s(e.id),onSaveToDisk:()=>l(e.id),t:a,setError:c,onSelect:Q=>Y({selectedFrameNumber:Q}),onToggleCollapse:Q=>{const ce=I.map(pe=>pe.frameNumber===Q?{...pe,isCollapsed:!pe.isCollapsed}:pe);Y({sourcePrompts:ce})},onToggleScene:Q=>{const ce=A.includes(Q)?A.filter(pe=>pe!==Q):[...A,Q];Y({collapsedSourceScenes:ce})},onClearAll:()=>Y({sourcePrompts:[],styleOverride:"",usedCharacters:[],sceneContexts:{}}),onAddPrompt:oe,onAddScene:le,onDeletePrompt:K,onMovePromptUp:ie,onMovePromptDown:Z,onMoveToStart:se,onMoveToEnd:de,onRegenerate:()=>{},isAnyGenerationInProgress:r,onEditInSource:()=>{},onEditPrompt:re,isGeneratingSequence:r,allConceptsLength:0,sceneContexts:D,onUpdateSceneContext:xe,expandedSceneContexts:F,onToggleSceneContext:X,checkedContextScenes:te,onToggleContextCheck:ue})]}),n.jsx("div",{onMouseDown:H,className:"w-2 h-full bg-gray-700/50 hover:bg-cyan-600 cursor-col-resize rounded transition-colors flex-shrink-0"}),n.jsx("div",{className:"h-full flex flex-col space-y-2 min-w-0",style:{width:"0",flexGrow:1},children:n.jsx(II,{prompts:B,collapsedScenes:O,isLinked:!!h,onUpdatePrompts:Y,t:a,onMoveAllToSource:J,onClear:()=>Y({modifiedPrompts:[]}),onMoveToSource:R,onToggleCollapse:Q=>{const ce=B.map(pe=>pe.frameNumber===Q?{...pe,isCollapsed:!pe.isCollapsed}:pe);Y({modifiedPrompts:ce})},onToggleScene:Q=>{const ce=O.includes(Q)?O.filter(pe=>pe!==Q):[...O,Q];Y({collapsedModifiedScenes:ce})},sceneContexts:D,modifiedSceneContexts:T,expandedSceneContexts:F,onToggleSceneContext:X,onUpdateSceneContext:ne})})]})},R0=At.memo(({node:e,contentProps:t})=>{switch(e.type){case q.REROUTE_DOT:return n.jsx(zP,{...t});case q.NOTE:return n.jsx(DP,{...t});case q.TRANSLATOR:return n.jsx(YP,{...t});case q.GEMINI_CHAT:return n.jsx(tj,{...t});case q.SCRIPT_GENERATOR:return n.jsx(gj,{...t});case q.SCRIPT_VIEWER:return n.jsx(xj,{...t});case q.CHARACTER_GENERATOR:return n.jsx(wj,{...t});case q.CHARACTER_CARD:return n.jsx(Pj,{...t});case q.TEXT_INPUT:return n.jsx(qP,{...t});case q.IMAGE_INPUT:return n.jsx(JP,{...t});case q.IMAGE_EDITOR:return n.jsx(sj,{...t});case q.IMAGE_ANALYZER:return n.jsx(lj,{...t});case q.PROMPT_ANALYZER:return n.jsx(cj,{...t});case q.CHARACTER_ANALYZER:return n.jsx(dj,{...t});case q.PROMPT_PROCESSOR:return n.jsx(uj,{...t});case q.PROMPT_SANITIZER:return n.jsx(jj,{...t});case q.VIDEO_PROMPT_PROCESSOR:return n.jsx(mj,{...t});case q.IMAGE_OUTPUT:return n.jsx(pj,{...t});case q.VIDEO_OUTPUT:return n.jsx(hj,{...t});case q.IMAGE_SEQUENCE_GENERATOR:return n.jsx(_I,{...t});case q.PROMPT_SEQUENCE_EDITOR:return n.jsx(TI,{...t});case q.DATA_READER:return n.jsx(Ij,{...t});case q.VIDEO_EDITOR:return n.jsx(Fj,{...t});case q.MEDIA_VIEWER:return n.jsx(Jj,{...t});case q.DATA_PROTECTION:return n.jsx(nI,{...t});case q.POSE_CREATOR:return n.jsx(aI,{...t});default:return null}}),AI=({node:e,onMouseDown:t,onTouchStart:o,onResizeMouseDown:r,onNodeClick:a,onDetachNodeFromGroup:i,activeTool:s,connectingInfo:l,isDockedWindow:c,isProxyMode:d})=>{const u=y.useCallback(f=>{c||t(f,e.id)},[c,t,e.id]),p=y.useCallback(f=>{c||o(f,e.id)},[c,o,e.id]),m=y.useCallback((f,h)=>{d||r(f,e.id,h)},[d,r,e.id]),w=y.useCallback(f=>{},[]),k=y.useCallback(f=>{if(s==="cutter"){if(l)return;f.stopPropagation(),f.preventDefault(),a(e.id)}},[s,l,a,e.id]),b=y.useCallback(f=>{c||(f.altKey&&i(e.id),u(f))},[c,i,u,e.id]),x=y.useCallback((f,h)=>{f.altKey?(f.stopPropagation(),i(e.id)):c||e.type!==q.REROUTE_DOT&&h(e.id)},[c,i,e.id,e.type]);return{handleDragMouseDown:u,handleDragTouchStart:p,handleResizeMouseDown:m,handleMouseUp:w,handleHeaderMouseUp:k,handleHeaderMouseDown:b,handleHeaderDoubleClick:x}},RI=(e,t,o,r,a,i,s,l,c,d)=>{if(l)return{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:1e3,borderRadius:0,border:"none"};const u=Number.isFinite(e.position.x)?e.position.x:0,p=Number.isFinite(e.position.y)?e.position.y:0;let m=10;d?m=500:e.isPinned?m=100:a?m=90:i?m=80:c&&(m=6);const w={position:"absolute",top:0,left:0,transform:`translate(${u}px, ${p}px)`,width:o?160:Number.isFinite(e.width)?e.width:s.minWidth,height:o?48:e.isCollapsed?`${In}px`:Number.isFinite(e.height)?e.height:s.minHeight,minWidth:r||o?void 0:`${s.minWidth}px`,minHeight:e.isCollapsed||o||r?void 0:`${s.minHeight}px`,zIndex:m,contain:"none"};if(t&&e.dockState){const b="56px",x=e.width&&Number.isFinite(e.width)?`${e.width}px`:"auto",f=e.height&&Number.isFinite(e.height)?`${e.height}px`:"auto",h=`(100vw - ${56*2}px)`,v=`${s.minWidth}px`,N=`${s.minHeight}px`,_={position:"fixed",transform:"none",zIndex:100,minWidth:v,minHeight:N,contain:"none"};switch(e.dockState.mode){case"full":return{..._,top:b,left:b,right:b,bottom:b,width:"auto",height:"auto"};case"left":return{..._,top:b,left:b,width:x,bottom:b,height:"auto"};case"right":return{..._,top:b,right:b,width:x,bottom:b,height:"auto"};case"tl":return{..._,top:b,left:b,width:x,height:f};case"tr":return{..._,top:b,right:b,width:x,height:f};case"bl":return{..._,bottom:b,left:b,width:x,height:f};case"br":return{..._,bottom:b,right:b,width:x,height:f};case"q1":return{..._,top:b,bottom:b,left:b,width:x,height:"auto"};case"q2":return{..._,top:b,bottom:b,left:`calc(${b} + ${h} * 0.25)`,width:x,height:"auto"};case"q3":return{..._,top:b,bottom:b,right:`calc(${b} + ${h} * 0.25)`,width:x,height:"auto"};case"q4":return{..._,top:b,bottom:b,right:b,width:x,height:"auto"}}}return w},MI=(e,t,o,r,a,i,s,l,c,d,u,p,m=!0)=>{let w="border-gray-700";s||l?w="border-node-selected":c?w="border-teal-600":d?w="border-yellow-500":a?w="border-node-selected":i&&m===!0&&!r&&!o?w="border-node-hover ring-1 ring-node-hover/50 shadow-[0_0_15px_var(--color-border-hover)]":e.isPinned?w="border-node-hover":r&&(u==="text"?w="border-connection-text":u==="image"?w="border-connection-image":u==="character_data"?w="border-connection-character":u==="video"?w="border-connection-video":u==="audio"&&(w="border-connection-audio")),t&&(w="border-gray-600 shadow-2xl hover:border-node-hover"),o&&(w="border-gray-600 border-dashed opacity-80");let k=r?"bg-gray-600":e.type===q.NOTE?"bg-gray-900/70 backdrop-blur-sm":"bg-gray-800";o&&(k="bg-gray-800/80 backdrop-blur-sm"),p&&(k="bg-gray-900",w="border-none");const b=r?"bg-transparent":e.type===q.NOTE?"bg-transparent border-b border-gray-700/50":"bg-gray-700";return{container:`node-view absolute flex flex-col transition-[border-color,background-color,box-shadow] duration-200 ease-out ${k} border-2 ${p?"":r||o?"rounded-lg":"rounded-lg shadow-2xl"} ${w} ${s?"pointer-events-none":""}`,header:b,dockResizer:h=>h==="left"?"cursor-ew-resize right-0 top-0 w-2 h-full":h==="right"?"cursor-ew-resize left-0 top-0 w-2 h-full":h==="tl"?"cursor-nwse-resize bottom-0 right-0 w-4 h-4":h==="tr"?"cursor-nesw-resize bottom-0 left-0 w-4 h-4":h==="bl"?"cursor-nesw-resize top-0 right-0 w-4 h-4":h==="br"?"cursor-nwse-resize top-0 left-0 w-4 h-4":""}},LI=(e,t,o,r,a,i,s,l)=>{let c=e;o.type===q.IMAGE_EDITOR&&!e&&(c=t==="image"||t==="image_b"?"image":"text"),r&&(c=a);let d="bg-gray-400";switch(c){case"text":d="bg-connection-text";break;case"image":d="bg-connection-image";break;case"character_data":d="bg-connection-character";break;case"video":d="bg-connection-video";break;case"audio":d="bg-connection-audio";break}return!s||!i&&!r?d:(l==null?void 0:l.nodeId)===o.id&&(o.type===q.REROUTE_DOT||o.type===q.DATA_READER||l.handleId===t)?"bg-teal-600 ring-2 ring-white":i?"bg-red-500 cursor-not-allowed":d},DI=e=>{var re;const{node:t,activeTool:o,onOutputHandleMouseDown:r,onOutputHandleTouchStart:a,isHovered:i,isSelected:s,onNodeMouseEnter:l,onNodeMouseLeave:c,onDeleteNode:d,connectingInfo:u,connectionTarget:p,onDetachNodeFromGroup:m,isGlobalProcessing:w,isProxy:k,isFocused:b,isGrouped:x,isGroupDragging:f}=e,h=Kt(),{handleOpenNodeContextMenu:v,requestDeleteNodes:N,handleUndockNode:_,selectNode:E,nodeAnimationMode:I,connectedInputTypes:B,handleClearNodeNewFlag:M,isHoverHighlightEnabled:G=!0}=h||{},{t:V}=Pt(),j=t.type===q.REROUTE_DOT,P=t.type===q.MEDIA_VIEWER,{rerouteType:S,rerouteDirection:A}=At.useMemo(()=>{if(!j)return{rerouteType:null,rerouteDirection:"LR"};try{const R=JSON.parse(t.value||"{}");return{rerouteType:R.type||null,rerouteDirection:R.direction||"LR"}}catch{return{rerouteType:null,rerouteDirection:"LR"}}},[j,t.value]),O=y.useMemo(()=>Da(t.type),[t.type]),z=!!t.dockState&&!k,L=!!t.dockState&&k,W=B==null?void 0:B.get(t.id),D=AI({node:t,onMouseDown:e.onMouseDown,onTouchStart:e.onTouchStart,onResizeMouseDown:e.onResizeMouseDown,onNodeClick:e.onNodeClick,onDetachNodeFromGroup:m,activeTool:o,connectingInfo:u,isDockedWindow:z,isProxyMode:L}),T=RI(t,z,L,j,s,i,O,b,x,f),F=MI(t,z,L,j,s,i,!!e.isDragging,!!e.isDragOverTarget,(p==null?void 0:p.nodeId)===t.id,!!e.isExecuting,S,b,G),te=o==="edit"?z?"default":"crosshair":"inherit",$=o==="cutter"?`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="%23ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>') 12 12, auto`:"default",Y=R=>{if(R.stopPropagation(),R.shiftKey||e.isInstantCloseEnabled){d(t.id);return}N?N([t.id],{x:R.clientX,y:R.clientY}):d(t.id)},oe=R=>{if(R.stopPropagation(),j&&e.onValueChange)try{const J=JSON.parse(t.value||"{}"),H=J.direction==="RL"?"LR":"RL";e.onValueChange(t.id,JSON.stringify({...J,direction:H}))}catch{}},le=y.useCallback(()=>{t.isNewlyCreated&&M&&M(t.id)},[t.isNewlyCreated,t.id,M]),K=At.useCallback((R,J)=>LI(R,J,t,j,S,i,u,p),[t,j,S,u,i,p]),ie=y.useMemo(()=>({...e,onOutputHandleTouchStart:a,onSaveGeneratedCharacterToCatalog:e.onSaveGeneratedCharacterToCatalog,t:V,getHandleColor:K,handleCursor:te,isGlobalProcessing:w,onSelectNode:()=>E&&E(t.id)}),[e,a,V,K,te,w,E,t.id]),Z=y.useMemo(()=>{if(t.type!==q.CHARACTER_CARD)return!1;try{const R=JSON.parse(t.value||"[]"),J=Array.isArray(R)?R:[R];return J.length===0?!1:J.every(H=>H.isImageCollapsed)}catch{return!1}},[t.value,t.type]),se=y.useCallback(()=>{if(t.type===q.CHARACTER_CARD)try{const R=JSON.parse(t.value||"[]"),J=Array.isArray(R)?R:[R],H=!Z,U=J.map(ee=>({...ee,isImageCollapsed:H}));e.onValueChange(t.id,JSON.stringify(U))}catch(R){console.error("Failed to toggle images",R)}},[t.value,t.type,t.id,e.onValueChange,Z]);if(L)return n.jsxs("div",{className:`node-view absolute flex items-center justify-center rounded-lg border-2 border-gray-600 bg-gray-800 text-gray-400 px-4 py-2 shadow-lg select-none cursor-move ${s?"border-node-selected text-accent-text":""}`,style:{...T,zIndex:s?12:10},onMouseUp:D.handleMouseUp,onMouseEnter:()=>l(t.id),onMouseLeave:c,onMouseDown:D.handleDragMouseDown,onTouchStart:D.handleDragTouchStart,onContextMenu:R=>{v&&v(R,t.id)},onWheel:R=>R.stopPropagation(),children:[n.jsx("span",{className:"font-bold text-xs truncate max-w-[140px] pointer-events-none",children:t.title}),n.jsx(c0,{node:t,getHandleColor:K,handleCursor:te,t:V,isHovered:i,isCollapsed:!0,isProxy:!0,connectedInputType:W}),n.jsx(d0,{node:t,getHandleColor:K,handleCursor:te,onOutputHandleMouseDown:r,onOutputHandleTouchStart:a,t:V,isHovered:i,isCollapsed:!0,isProxy:!0})]});(re=t.dockState)==null||re.mode;const de=t.isNewlyCreated&&I==="pulse"?"node-pulse-animation":"";return n.jsxs("div",{className:`${F.container} ${de}`,style:{...T,cursor:j&&!z?"move":$},onMouseUp:D.handleMouseUp,onMouseEnter:()=>l(t.id),onMouseLeave:c,onMouseDown:j?D.handleDragMouseDown:void 0,onMouseDownCapture:le,onTouchStartCapture:le,onTouchStart:j?D.handleDragTouchStart:void 0,onWheel:R=>R.stopPropagation(),children:[t.isNewlyCreated&&I==="blade-runner"&&!z&&!L&&n.jsx("div",{className:"new-node-ring"}),j&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none transition-transform duration-300",style:{transform:A==="RL"?"rotate(180deg)":"rotate(0deg)"},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})}),n.jsx(IP,{node:t,isDockedWindow:z,isRerouteDot:j,headerBgClass:F.header,onMouseDown:D.handleHeaderMouseDown,onTouchStart:!j&&!z?D.handleDragTouchStart:void 0,onMouseUp:D.handleHeaderMouseUp,onDoubleClick:j?oe:R=>D.handleHeaderDoubleClick(R,e.onToggleCollapse),onToggleCollapse:e.onToggleCollapse,onRenameNode:e.onRenameNode,onDeleteNode:d,onCutConnections:e.onCutConnections,onDuplicateNode:e.onDuplicateNode,onDuplicateNodeWithContent:e.onDuplicateNodeWithContent,onCopyNodeValue:e.onCopyNodeValue,onPasteNodeValue:e.onPasteNodeValue,onPasteImage:e.onPasteImage,onDownloadImage:e.onDownloadImage,onRefreshImageEditor:e.onRefreshImageEditor,onRefreshChat:e.onRefreshChat,onValueChange:e.onValueChange,clearImagesForNodeFromCache:e.clearImagesForNodeFromCache,addToast:e.addToast,getEmptyValueForNodeType:Wa,onSaveSequenceToCatalog:e.onSaveSequenceToCatalog,onSaveScriptToDisk:e.onSaveScriptToDisk,onSaveCharacterToCatalog:e.onSaveCharacterToCatalog,onSaveCharacterCard:e.onSaveCharacterCard,handleUndockNode:_,handleOpenNodeContextMenu:v,handleRequestDelete:Y,handleDetachNodeFromGroup:m,isInstantCloseEnabled:e.isInstantCloseEnabled,onToggleCharacterImages:se,allImagesCollapsed:Z}),P?n.jsx("div",{className:`p-3 flex-grow min-h-0 flex flex-col ${t.isCollapsed&&!z?"hidden":"flex"}`,onMouseDown:R=>{R.stopPropagation(),E&&E(t.id)},children:n.jsx(R0,{node:t,contentProps:ie})}):!j&&(!t.isCollapsed||z)&&n.jsx("div",{className:"p-3 flex-grow min-h-0",onMouseDown:R=>{R.stopPropagation(),E&&E(t.id)},children:n.jsx(R0,{node:t,contentProps:ie})}),!z&&!b&&n.jsx(c0,{node:t,getHandleColor:K,handleCursor:te,t:V,isHovered:i,isCollapsed:t.isCollapsed,isProxy:L,connectedInputType:W}),!z&&!b&&n.jsx(d0,{node:t,getHandleColor:K,handleCursor:te,onOutputHandleMouseDown:r,onOutputHandleTouchStart:a,t:V,isHovered:i,isCollapsed:t.isCollapsed,isProxy:L}),!j&&!t.isCollapsed&&(!z&&!b?n.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 cursor-se-resize group",onPointerDown:R=>D.handleResizeMouseDown(R,void 0),children:n.jsxs("svg",{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-full h-full text-gray-700 group-hover:text-accent-text transition-colors",children:[n.jsx("path",{d:"M12 6L6 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),n.jsx("path",{d:"M14 10L10 14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}):z&&!b&&n.jsxs(n.Fragment,{children:[n.jsx("div",{onPointerDown:R=>D.handleResizeMouseDown(R,"n"),className:"absolute top-0 left-0 w-full h-2 cursor-ns-resize z-20"}),n.jsx("div",{onPointerDown:R=>D.handleResizeMouseDown(R,"s"),className:"absolute bottom-0 left-0 w-full h-2 cursor-ns-resize z-20"}),n.jsx("div",{onPointerDown:R=>D.handleResizeMouseDown(R,"w"),className:"absolute top-0 left-0 w-2 h-full cursor-ew-resize z-20"}),n.jsx("div",{onPointerDown:R=>D.handleResizeMouseDown(R,"e"),className:"absolute top-0 right-0 w-2 h-full cursor-ew-resize z-20"}),n.jsx("div",{onPointerDown:R=>D.handleResizeMouseDown(R,"nw"),className:"absolute top-0 left-0 w-4 h-4 cursor-nwse-resize z-30"}),n.jsx("div",{onPointerDown:R=>D.handleResizeMouseDown(R,"ne"),className:"absolute top-0 right-0 w-4 h-4 cursor-nesw-resize z-30"}),n.jsx("div",{onPointerDown:R=>D.handleResizeMouseDown(R,"sw"),className:"absolute bottom-0 left-0 w-4 h-4 cursor-nesw-resize z-30"}),n.jsx("div",{onPointerDown:R=>D.handleResizeMouseDown(R,"se"),className:"absolute bottom-0 right-0 w-4 h-4 cursor-nwse-resize z-30"})]}))]})},fd=At.memo(DI),zI=({connection:e,fromNode:t,toNode:o,start:r,end:a,isNodeHovered:i,activeTool:s,onDelete:l,onSplit:c,lineStyle:d})=>{const{isConnectionAnimationEnabled:u,connectionOpacity:p}=Kt()||{isConnectionAnimationEnabled:!0,connectionOpacity:.4},[m,w]=y.useState(!1),k=j=>{const P=j.isCollapsed?In:j.height;return{x:j.position.x,y:j.position.y,width:j.width,height:P,right:j.position.x+j.width,bottom:j.position.y+P}},x=d==="orthogonal"?((j,P,S,A)=>{const O=k(S),z=k(A),L=R=>{if(R.type!==q.REROUTE_DOT)return 1;try{return JSON.parse(R.value||"{}").direction==="RL"?-1:1}catch{return 1}},W=R=>{if(R.type!==q.REROUTE_DOT)return-1;try{return JSON.parse(R.value||"{}").direction==="RL"?1:-1}catch{return-1}},D=L(S),T=W(A),F=20,te=P.x>j.x&&D===1&&T===-1,$=P.x<j.x&&D===-1&&T===1,Y=S.type===q.REROUTE_DOT||A.type===q.REROUTE_DOT,oe=Y?30:150;if(te&&P.x<j.x+oe||!Y&&$&&P.x>j.x-400){const R=(j.x+P.x)/2;return`M ${j.x} ${j.y} L ${R} ${j.y} L ${R} ${P.y} L ${P.x} ${P.y}`}const le=0,K=[`M ${j.x} ${j.y}`];let ie=j.x+D*F,Z=j.y;K.push(`L ${ie} ${Z}`);const se=P.x+T*F,de=P.y;if(D===1&&T===-1&&se>ie||D===-1&&T===1&&se<ie)if(A.type===q.REROUTE_DOT)K.push(`L ${ie} ${de}`),K.push(`L ${se} ${de}`);else if(S.type===q.REROUTE_DOT)K.push(`L ${se} ${Z}`),K.push(`L ${se} ${de}`);else{const R=(ie+se)/2;K.push(`L ${R} ${Z}`),K.push(`L ${R} ${de}`),K.push(`L ${se} ${de}`)}else if(Y&&D===T){let R=0;D===-1?R=Math.min(ie,se):R=Math.max(ie,se),K.push(`L ${R} ${Z}`),K.push(`L ${R} ${de}`),K.push(`L ${se} ${de}`)}else{let R=0;z.bottom+le<O.y?R=(z.bottom+O.y)/2:z.y>O.bottom+le?R=(O.bottom+z.y)/2:P.y<j.y?R=Math.min(O.y,z.y)-F:R=Math.max(O.bottom,z.bottom)+F,K.push(`L ${ie} ${R}`),K.push(`L ${se} ${R}`),K.push(`L ${se} ${de}`)}return K.push(`L ${P.x} ${P.y}`),K.join(" ")})(r,a,t,o):`M ${r.x} ${r.y} C ${r.x+80} ${r.y}, ${a.x-80} ${a.y}, ${a.x} ${a.y}`,f=Xn(t,e.fromHandleId),h="#6b7280";let v;switch(f){case"text":v="var(--color-connection-text)";break;case"image":v="var(--color-connection-image)";break;case"character_data":v="var(--color-connection-character)";break;case"video":v="var(--color-connection-video)";break;case"audio":v="var(--color-connection-audio)";break;default:v=h}const N=s==="cutter",_=s==="reroute",E=(N||_)&&(m||i),I=N&&E?"#ef4444":_&&E?"#06b6d4":v,B=E?1:p,M=E?5:3;let G="default";N&&(m||i)?G=`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="%23ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>') 12 12, auto`:_&&m?G="crosshair":(N||_)&&(G="pointer");const V=j=>{j.stopPropagation(),N?l(e.id):_&&c(e.id)};return n.jsxs("g",{className:"connection-view",onMouseEnter:()=>w(!0),onMouseLeave:()=>w(!1),onMouseDown:V,onTouchStart:V,style:{cursor:G,pointerEvents:"auto"},children:[n.jsx("path",{d:x,stroke:"transparent",strokeWidth:"20",fill:"none",style:{pointerEvents:"stroke"}}),n.jsx("path",{d:x,stroke:I,strokeWidth:M,fill:"none",style:{pointerEvents:"none",opacity:B,transition:"stroke 0.2s ease-in-out, stroke-width 0.2s ease-in-out, opacity 0.2s ease-in-out"}}),u&&n.jsx("path",{d:x,stroke:v,strokeWidth:3,fill:"none",className:"connection-flow",style:{pointerEvents:"none",opacity:1}})]})},qI=At.memo(zI),OI=({group:e,onMouseDown:t,onTouchStart:o,onClose:r,onRename:a,onSaveToCatalog:i,onSaveToDisk:s,onCopy:l,onDuplicate:c,isHoveredForDrop:d,isDragging:u})=>{const{t:p}=Pt(),w=d||u?"border-solid border-node-selected shadow-[0_0_15px_rgba(34,211,238,0.15)]":"border-dashed border-gray-500";return n.jsx("div",{className:`group-view absolute bg-white/5 border-2 ${w} rounded-lg transition-colors duration-200 pointer-events-none`,style:{left:e.position.x,top:e.position.y,width:e.width,height:e.height,zIndex:u?490:5},children:n.jsxs("div",{className:"bg-gray-700/50 text-white font-bold p-2 rounded-t-md flex justify-between items-center cursor-move pointer-events-auto",onMouseDown:t,onTouchStart:o,onDoubleClick:()=>a(e.id,e.title),children:[n.jsx("span",{className:"truncate pr-2",children:e.title}),n.jsxs("div",{className:"flex items-center space-x-1",onMouseDown:b=>b.stopPropagation(),onTouchStart:b=>b.stopPropagation(),onDoubleClick:b=>b.stopPropagation(),children:[n.jsx(we,{title:p("group.rename"),onClick:()=>a(e.id,e.title),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),n.jsx(we,{title:p("node.action.copy"),onClick:()=>l&&l(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),n.jsx(we,{title:p("group.duplicate"),onClick:()=>c&&c(e.id),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("rect",{x:"5",y:"5",width:"14",height:"14",rx:"2",ry:"2"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m-3-3h6"})]})}),n.jsx(we,{title:p("group.saveToCatalog"),onClick:()=>i(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})}),n.jsx(we,{title:p("group.saveToDisk"),onClick:()=>s(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(we,{title:p("group.ungroup"),onClick:b=>r(e.id,b),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})})},FI=At.memo(OI),So=({title:e,onClick:t,isActive:o=!1,children:r,hoverColor:a,vertical:i=!1})=>{const s=o?"bg-accent text-white shadow-md shadow-accent/20":`bg-gray-700 ${a||"hover:bg-accent hover:text-white"} text-gray-300`;return n.jsxs("div",{className:"relative group flex items-center",children:[n.jsx("button",{onClick:t,className:`p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 ${s}`,children:r}),n.jsx("div",{className:`absolute ${i?"left-full ml-2 top-1/2 -translate-y-1/2":"bottom-full left-1/2 -translate-x-1/2 mb-2"} px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 opacity-0 pointer-events-none group-hover:opacity-100`,role:"tooltip",children:e})]})},BI=({isSnapToGrid:e,onSnapToGridChange:t,lineStyle:o,onLineStyleChange:r,zoom:a,onZoomChange:i,scaleToSliderValue:s,sliderValueToScale:l,onClearCanvas:c,onSaveCanvas:d,onLoadCanvas:u,activeTool:p,onToolChange:m,isSmartGuidesEnabled:w,onSmartGuidesChange:k,onResetView:b,vertical:x=!1})=>{const{t:f}=Pt(),h=s(a),v=E=>{i(l(Number(E.target.value)))},N=x?"flex flex-col-reverse items-center gap-2 select-none":"flex items-center space-x-2 select-none",_=x?"flex flex-col-reverse items-center gap-1":"flex items-center space-x-1";return n.jsxs("div",{className:N,children:[n.jsxs("div",{className:_,children:[b&&n.jsx(So,{title:f("toolbar.resetCamera"),onClick:b,vertical:x,children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),n.jsx(So,{title:f("toolbar.zoom"),onClick:()=>m("zoom"),isActive:p==="zoom",vertical:x,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),!x&&n.jsxs("div",{className:"relative group flex items-center",children:[n.jsx("input",{type:"range",min:"-100",max:"100",step:"1",value:h,onChange:v,className:"w-24 h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-accent"}),n.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 opacity-0 pointer-events-none group-hover:opacity-100",role:"tooltip",children:"Zoom"})]}),n.jsx(So,{title:f("toolbar.resetZoom"),onClick:()=>i(1),vertical:x,children:n.jsxs("span",{className:"text-xs font-semibold select-none",children:[Math.round(a*100),"%"]})})]}),!x&&n.jsx("div",{className:"w-px h-6 bg-gray-700 mx-1"}),x&&n.jsx("div",{className:"h-px w-6 bg-gray-700 my-1"}),n.jsxs("div",{className:_,children:[n.jsx(So,{title:`${f("toolbar.snapToGrid")} (Shift+W)`,onClick:t,isActive:e,vertical:x,children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 24 24",children:[n.jsx("circle",{cx:"6",cy:"6",r:"1.5"}),n.jsx("circle",{cx:"12",cy:"6",r:"1.5"}),n.jsx("circle",{cx:"18",cy:"6",r:"1.5"}),n.jsx("circle",{cx:"6",cy:"12",r:"1.5"}),n.jsx("circle",{cx:"12",cy:"12",r:"1.5"}),n.jsx("circle",{cx:"18",cy:"12",r:"1.5"}),n.jsx("circle",{cx:"6",cy:"18",r:"1.5"}),n.jsx("circle",{cx:"12",cy:"18",r:"1.5"}),n.jsx("circle",{cx:"18",cy:"18",r:"1.5"})]})}),n.jsx(So,{title:`${f("toolbar.smartGuides")} (Shift+L)`,onClick:k,isActive:w,vertical:x,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"4 4",d:"M12 3v18M3 12h18"})})}),n.jsx(So,{title:`${f("toolbar.lineStyleSpaghetti")} (Shift+E)`,onClick:()=>r("spaghetti"),isActive:o==="spaghetti",vertical:x,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4c16 0 0 16 16 16"})})}),n.jsx(So,{title:`${f("toolbar.lineStyleOrthogonal")} (Shift+E)`,onClick:()=>r("orthogonal"),isActive:o==="orthogonal",vertical:x,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8h8v8h8"})})})]}),!x&&n.jsx("div",{className:"w-px h-6 bg-gray-700 mx-1"}),x&&n.jsx("div",{className:"h-px w-6 bg-gray-700 my-1"}),n.jsxs("div",{className:_,children:[n.jsx(So,{title:f("toolbar.clearCanvas"),onClick:c,hoverColor:"hover:bg-red-600",vertical:x,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})}),!x&&n.jsx("div",{className:"w-px h-6 bg-gray-700 mx-1"}),x&&n.jsx("div",{className:"h-px w-6 bg-gray-700 my-1"}),n.jsx(So,{title:f("toolbar.saveCanvas"),onClick:d,vertical:x,children:n.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"square",strokeLinejoin:"miter",children:[n.jsx("path",{d:"M17.2928932,3.29289322 L21,7 L21,20 C21,20.5522847 20.5522847,21 20,21 L4,21 C3.44771525,21 3,20.5522847 3,20 L3,4 C3,3.44771525 3.44771525,3 4,3 L16.5857864,3 C16.8510029,3 17.1053568,3.10535684 17.2928932,3.29289322 Z"}),n.jsx("rect",{width:"10",height:"8",x:"7",y:"13"}),n.jsx("rect",{width:"8",height:"5",x:"8",y:"3"})]})}),n.jsx(So,{title:f("toolbar.loadCanvas"),onClick:u,vertical:x,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z"})})})]})]})},Is=({title:e,onClick:t,isActive:o=!1,children:r})=>{const a=o?"bg-accent text-white shadow-md shadow-accent/20":"bg-gray-700 hover:bg-accent hover:text-white text-gray-300";return n.jsxs("div",{className:"relative group flex items-center",children:[n.jsx("button",{onClick:t,"aria-label":e,className:`p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 ${a}`,children:r}),n.jsx("div",{className:"absolute left-full ml-3 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 opacity-0 pointer-events-none group-hover:opacity-100",role:"tooltip",children:e})]})},HI=({activeTool:e,onToolChange:t})=>{const{t:o}=Pt(),[r,a]=y.useState(56),i=y.useRef(!1),s=y.useRef({y:0,initialTop:0}),l=y.useRef(null),c=p=>{p.preventDefault(),p.stopPropagation(),i.current=!0,s.current={y:p.clientY,initialTop:r},p.currentTarget.setPointerCapture(p.pointerId)},d=p=>{var f;if(!i.current)return;const m=p.clientY-s.current.y;let w=s.current.initialTop+m;const k=56,b=window.innerHeight,x=((f=l.current)==null?void 0:f.offsetHeight)||0;w<k&&(w=k),w+x>b-k&&(w=b-x-k),a(w)},u=p=>{i.current=!1,p.currentTarget.releasePointerCapture(p.pointerId)};return n.jsxs("div",{ref:l,onMouseDown:p=>p.stopPropagation(),style:{top:`${r}px`},className:"absolute left-2 z-20 bg-gray-900/50 backdrop-blur-md p-1 rounded-lg shadow-lg flex flex-col items-center gap-1 border border-gray-700",children:[n.jsx("div",{onPointerDown:c,onPointerMove:d,onPointerUp:u,className:"w-full h-3 flex items-center justify-center cursor-ns-resize group hover:bg-gray-800/50 rounded-t-lg -mt-0.5",title:"Drag vertically",children:n.jsx("div",{className:"w-6 h-1 bg-gray-600 rounded-full group-hover:bg-gray-400 transition-colors"})}),n.jsx(Is,{title:o("toolbar.edit"),onClick:()=>t("edit"),isActive:e==="edit",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})}),n.jsx(Is,{title:o("toolbar.cutter"),onClick:()=>t("cutter"),isActive:e==="cutter",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(Is,{title:o("toolbar.selection"),onClick:()=>t("selection"),isActive:e==="selection",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"4 4",d:"M3.75 3.75h16.5v16.5H3.75z"})})}),n.jsx(Is,{title:o("toolbar.reroute"),onClick:()=>t("reroute"),isActive:e==="reroute",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})})]})},Wt=({title:e,onClick:t,isActive:o=!1,children:r,hoverColorClass:a})=>{const i="p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9",s="bg-accent text-white shadow-lg shadow-accent/20",l=`bg-gray-700 ${a||"hover:bg-accent hover:text-white"} text-gray-300`;return n.jsxs("div",{className:"relative group flex items-center",children:[n.jsx("button",{onClick:t,"aria-label":e,className:`${i} ${o?s:l}`,children:r}),n.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 opacity-0 pointer-events-none group-hover:opacity-100",role:"tooltip",children:e})]})},No=({title:e,children:t,isDetached:o,hoverColorClass:r,titleColorClass:a,isCompact:i})=>n.jsxs("div",{className:"flex flex-col items-center",children:[!o&&!i&&n.jsx("span",{className:`text-xs font-semibold mb-1 select-none ${a||"text-gray-400"}`,children:e}),n.jsx("div",{className:"flex items-center space-x-1",children:At.Children.map(t,l=>At.isValidElement(l)?At.cloneElement(l,{hoverColorClass:r}):l)})]}),GI=({onAddNode:e,onOpenSearch:t,onToggleCatalog:o,onSaveCanvas:r,onLoadCanvas:a,isDetached:i,onSaveProject:s,isCompact:l})=>{const{t:c}=Pt(),d=Kt(),{tutorialStep:u,advanceTutorial:p,skipTutorial:m,handleSaveToDrive:w,isGoogleDriveSaving:k}=d||{},b=i?"grid grid-cols-3 gap-2":"flex items-center flex-wrap justify-center gap-2";return n.jsxs("div",{className:b,children:[n.jsx(Bn,{content:c("tutorial.group.catalog"),isActive:u==="toolbar_group_catalog",position:"top",onNext:p,onSkip:m,children:n.jsxs(No,{title:c("toolbar.group.catalog"),isDetached:i,isCompact:l,children:[n.jsx(Wt,{title:c("toolbar.addNode"),onClick:t,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),n.jsx(Wt,{title:c("toolbar.catalog"),onClick:o,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})})})]})}),n.jsx(Bn,{content:c("tutorial.group.general"),isActive:u==="toolbar_group_general",position:"top",onNext:p,onSkip:m,children:n.jsxs(No,{title:c("toolbar.group.general"),isDetached:i,isCompact:l,children:[n.jsx(Wt,{title:c("toolbar.addNote"),onClick:x=>e(q.NOTE,x),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),n.jsx(Wt,{title:c("toolbar.addDataReader"),onClick:x=>e(q.DATA_READER,x),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})}),n.jsx(Bn,{content:c("tutorial.group.input"),isActive:u==="toolbar_group_input",position:"top",onNext:p,onSkip:m,children:n.jsxs(No,{title:c("toolbar.group.input"),isDetached:i,isCompact:l,children:[n.jsx(Wt,{title:c("toolbar.addTextInput"),onClick:x=>e(q.TEXT_INPUT,x),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 6h10M12 6v12"})})}),n.jsx(Wt,{title:c("toolbar.addImageInput"),onClick:x=>e(q.IMAGE_INPUT,x),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{d:"M21 15l-5-5L5 21"})]})}),n.jsx(Wt,{title:c("search.node.media_viewer.title"),onClick:x=>e(q.MEDIA_VIEWER,x),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})}),n.jsx(Wt,{title:c("toolbar.addPromptSequenceEditor"),onClick:x=>e(q.PROMPT_SEQUENCE_EDITOR,x),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z"})})})]})}),n.jsx(Bn,{content:c("tutorial.group.processing"),isActive:u==="toolbar_group_processing",position:"top",onNext:p,onSkip:m,children:n.jsxs(No,{title:c("toolbar.group.processing"),isDetached:i,isCompact:l,children:[n.jsx(Wt,{title:c("toolbar.addImageAnalyzer"),onClick:x=>e(q.IMAGE_ANALYZER,x),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12.792V5.25a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 5.25v13.5A2.25 2.25 0 005.25 21h7.55"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 18.375L21 21"})]})}),n.jsx(Wt,{title:c("toolbar.addPromptAnalyzer"),onClick:x=>e(q.PROMPT_ANALYZER,x),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})}),n.jsx(Wt,{title:c("toolbar.addPromptProcessor"),onClick:x=>e(q.PROMPT_PROCESSOR,x),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})})]})}),n.jsx(Bn,{content:c("tutorial.group.character"),isActive:u==="toolbar_group_character",position:"top",onNext:p,onSkip:m,children:n.jsxs(No,{title:c("toolbar.group.character"),isDetached:i,isCompact:l,children:[n.jsx(Wt,{title:c("toolbar.addCharacterGenerator"),onClick:x=>e(q.CHARACTER_GENERATOR,x),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})})}),n.jsx(Wt,{title:c("toolbar.addCharacterAnalyzer"),onClick:x=>e(q.CHARACTER_ANALYZER,x),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})}),n.jsx(Wt,{title:c("toolbar.addCharacterCard"),onClick:x=>e(q.CHARACTER_CARD,x),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 8a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5a7.5 7.5 0 0115 0"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.5a.75.75 0 00-.75.75v13.5c0 .414.336.75.75.75h16.5a.75.75 0 00.75-.75V5.25a.75.75 0 00-.75-.75H3.75z"})]})}),n.jsx(Wt,{title:c("search.node.pose_creator.title"),onClick:x=>e(q.POSE_CREATOR,x),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})})]})}),n.jsx(Bn,{content:c("tutorial.group.output"),isActive:u==="toolbar_group_output",position:"top",onNext:p,onSkip:m,children:n.jsxs(No,{title:c("toolbar.group.output"),isDetached:i,isCompact:l,children:[n.jsx(Wt,{title:c("toolbar.addImageOutput"),onClick:x=>e(q.IMAGE_OUTPUT,x),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})}),n.jsx(Wt,{title:c("toolbar.addImageEditor"),onClick:x=>e(q.IMAGE_EDITOR,x),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-5 h-5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]})}),n.jsx(Wt,{title:c("toolbar.addImageSequenceGenerator"),onClick:x=>e(q.IMAGE_SEQUENCE_GENERATOR,x),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})})})]})}),n.jsx(Bn,{content:c("tutorial.group.ai"),isActive:u==="toolbar_group_ai",position:"top",onNext:p,onSkip:m,children:n.jsxs(No,{title:c("toolbar.group.aiTools"),isDetached:i,isCompact:l,children:[n.jsx(Wt,{title:c("toolbar.addTranslator"),onClick:x=>e(q.TRANSLATOR,x),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})}),n.jsx(Wt,{title:c("toolbar.addGeminiChat"),onClick:x=>e(q.GEMINI_CHAT,x),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})}),n.jsx(Bn,{content:c("tutorial.group.scripts"),isActive:u==="toolbar_group_scripts",position:"top",onNext:p,onSkip:m,children:n.jsxs(No,{title:c("toolbar.group.scripts"),isDetached:i,isCompact:l,children:[n.jsx(Wt,{title:c("toolbar.addScriptGenerator"),onClick:x=>e(q.SCRIPT_GENERATOR,x),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})}),n.jsx(Wt,{title:c("toolbar.addScriptViewer"),onClick:x=>e(q.SCRIPT_VIEWER,x),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 19.82a2.25 2.25 0 01-1.897 1.13l-2.685.8.8-2.685a2.25 2.25 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})})]})}),n.jsx(Bn,{content:c("tutorial.group.video"),isActive:u==="toolbar_group_video",position:"top",onNext:p,onSkip:m,children:n.jsxs(No,{title:c("toolbar.group.video"),isDetached:i,isCompact:l,children:[n.jsx(Wt,{title:c("toolbar.addVideoPromptProcessor"),onClick:x=>e(q.VIDEO_PROMPT_PROCESSOR,x),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7l-2 4 4 2-4 2-2 4-2-4-4-2 4-2z"})]})}),n.jsx(Wt,{title:c("toolbar.addVideoOutput"),onClick:x=>e(q.VIDEO_OUTPUT,x),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9A2.25 2.25 0 0013.5 5.25h-9A2.25 2.25 0 002.25 7.5v9A2.25 2.25 0 004.5 18.75z"})})}),n.jsx(Wt,{title:c("node.title.video_editor"),onClick:x=>e(q.VIDEO_EDITOR,x),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})]})})]})}),n.jsx(Bn,{content:c("tutorial.group.file"),isActive:u==="toolbar_group_file",position:"top",onNext:p,onSkip:m,children:n.jsxs(No,{title:c("toolbar.group.file"),isDetached:i,isCompact:l,children:[n.jsx(Wt,{title:c("toolbar.saveProject"),onClick:()=>s&&s(),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"})})}),n.jsx(Wt,{title:c("toolbar.saveCanvas"),onClick:r,children:n.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"square",strokeLinejoin:"miter",children:[n.jsx("path",{d:"M17.2928932,3.29289322 L21,7 L21,20 C21,20.5522847 20.5522847,21 20,21 L4,21 C3.44771525,21 3,20.5522847 3,20 L3,4 C3,3.44771525 3.44771525,3 4,3 L16.5857864,3 C16.8510029,3 17.1053568,3.10535684 17.2928932,3.29289322 Z"}),n.jsx("rect",{width:"10",height:"8",x:"7",y:"13"}),n.jsx("rect",{width:"8",height:"5",x:"8",y:"3"})]})}),n.jsx(Wt,{title:c("toolbar.loadCanvas"),onClick:a,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z"})})})]})})]})},UI=At.memo(GI),VI=({title:e,children:t,align:o="center"})=>{const r=o==="left"?"left-0 bottom-full mb-2 origin-bottom-left":"left-1/2 -translate-x-1/2 bottom-full mb-2 origin-bottom";return n.jsxs("div",{className:"relative group flex items-center justify-center",children:[t,n.jsx("div",{className:`absolute px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 ease-in-out transform ${r} opacity-0 pointer-events-none group-hover:opacity-100`,role:"tooltip",children:e})]})},WI=()=>{const e=Kt(),{t}=Pt(),[o,r]=y.useState(!1),[a,i]=y.useState(!1),[s,l]=y.useState(!1),[c,d]=y.useState(!1),[u,p]=y.useState(0),[m,w]=y.useState({width:window.innerWidth,height:window.innerHeight}),k=y.useCallback(Qe=>{Qe!==null&&p(Qe.getBoundingClientRect().height)},[]);if(y.useEffect(()=>{const Qe=()=>{w({width:window.innerWidth,height:window.innerHeight});const hn=800+450*2;i(window.innerWidth<hn)};return window.addEventListener("resize",Qe),()=>window.removeEventListener("resize",Qe)},[]),!e)return null;const{nodes:b,connections:x,groups:f,viewTransform:h,handleCanvasMouseDown:v,handleCanvasContextMenu:N,handleCanvasTouchStart:_,handleCanvasTouchMove:E,handleCanvasTouchEnd:I,updatePointerPosition:B,handleWheel:M,handleCanvasDoubleClick:G,handleDrop:V,handleDragOver:j,handleDragEnter:P,handleDragLeave:S,getCanvasCursor:A,setCanvasRef:O,dockHoverMode:z,handleDockNode:L,handleUndockNode:W,focusedNodeId:D,selectedNodeIds:T,hoveredNodeId:F,setHoveredNodeId:te,dragOverNodeId:$,draggingInfo:Y,connectingInfo:oe,connectionTarget:le,spawnLine:K,activeTool:ie,setActiveTool:Z,effectiveTool:se,deleteNodeAndConnections:de,removeConnectionsByNodeId:re,copyNodeValue:R,pasteNodeValue:J,pasteImageToNode:H,handleDownloadImage:U,handleDuplicateNode:ee,handleDuplicateNodeWithContent:ae,handleToggleNodeCollapse:xe,handleDetachNodeFromGroup:ne,handleStartConnection:X,handleStartConnectionTouch:ue,handleNodeCutConnections:Q,handleNodeTouchStart:ce,handleGroupMouseDown:pe,handleGroupTouchStart:me,handleRemoveGroup:ke,handleSaveGroupToCatalog:Re,handleSaveGroupToDisk:Me,copyGroup:De,duplicateGroup:Ie,hoveredGroupIdForDrop:Ne,handleGroupSelection:Pe,handleAlignNodes:ye,undoPosition:_e,redoPosition:Fe,canUndo:We,canRedo:Ze,handleValueChange:$e,handleEnhance:He,isEnhancing:be,handleEnhanceVideo:Ae,isEnhancingVideo:Te,onSanitize:qe,isSanitizing:Ye,handleAnalyzePrompt:nt,isAnalyzing:Nt,handleAnalyzeCharacter:ze,isAnalyzingCharacter:je,handleAnalyzeImage:Le,isAnalyzingImage:rt,handleGenerateImage:Ce,isGeneratingImage:Se,handleExecuteChain:he,isExecutingChain:ge,stopChainExecution:ve,executingNodeId:Ge,handleEditImage:Ve,isEditingImage:ot,handleSendMessage:Xe,isChatting:pt,handleTranslate:st,isTranslating:ft,handleGenerateScript:it,isGeneratingScript:wt,triggerLoadScriptFile:dt,handleGenerateCharacters:_t,isGeneratingCharacters:cn,handleGenerateVideo:It,isGeneratingVideo:Ee,handleGenerateImageSequence:Ue,onGenerateSelectedFrames:Ke,isGeneratingSequence:et,handleStopImageSequence:ht,isStoppingSequence:ut,handleRegenerateFrame:at,onDownloadImageFromUrl:kt,onCopyImageToClipboard:St,triggerLoadImageSequenceFile:Ct,triggerLoadPromptSequenceFile:Et,handleProcessImage:Mt,isProcessingImage:Qo,handleSetImageEditorOutputToInput:lc,connectedInputs:Ki,connectedImageSources:cc,connectedCharacterData:dc,libraryItems:uc,handleProcessChainForward:pc,handleSaveCharacterCard:hc,triggerLoadCharacterCard:mc,handleDetachAndPasteConcept:gc,onDetachImageToNode:fc,onSaveCharacterToCatalog:xc,onSaveScriptToCatalog:yc,onSaveSequenceToCatalog:vc,setError:wc,setImageViewer:bc,addToast:Cc,getFullSizeImage:fe,setFullSizeImage:Be,clearImagesForNodeFromCache:Oe,onTranslateScript:Je,isTranslatingScript:lt,onReadData:tt,getUpstreamNodeValues:yt,onRefreshUpstreamData:gt,onModifyPromptSequence:Dt,isModifyingPromptSequence:Tt,onSavePromptToLibrary:Lt,onSaveToLibrary:pn,onGenerateCharacterImage:Xt,isGeneratingCharacterImage:er,onDetachCharacter:Xa,onStopGeneration:kc,isStopping:_c,clearSelectionsSignal:Dy,onSaveScriptToDisk:zy,onSaveMediaToDisk:qy,onSaveGeneratedCharacterToCatalog:Oy,isGlobalProcessing:Fy,isInstantCloseEnabled:By,onImageToText:Hy,onUpdateCharacterDescription:Gy,isUpdatingDescription:Uy,isSnapToGrid:Vy,setIsSnapToGrid:Wy,lineStyle:rh,setLineStyle:$y,handleZoomChange:Ky,scaleToSliderValue:Jy,sliderValueToScale:Yy,handleClearCanvas:Xy,isSmartGuidesEnabled:Zy,setIsSmartGuidesEnabled:Qy,resetView:ev,smartGuides:tv,selectionRect:Lo,groupButtonPosition:Sc,getConnectionPoints:nv,removeConnectionById:ov,handleSplitConnection:rv,onRefreshChat:av,handleRefreshImageEditor:iv,handleAutoDownloadChange:sv,handleModelChange:lv,handleResolutionChange:cv,handleAspectRatioChange:dv,onRenameCharacter:zT,onRenameScript:qT,onRenameSequence:OT,handleRenameNode:FT,setRenameInfo:uv,handleToggleNodePin:pv,onAddNode:hv,handleOpenQuickSearch:mv,handleToggleCatalog:gv,handleSaveCanvas:ah,handleLoadCanvas:ih,handleSaveProject:fv,getTransformedPoint:sh,setSpawnLine:Nc,tutorialStep:xv,advanceTutorial:yv}=e,vv=y.useMemo(()=>{const Qe=new Map;return f.forEach(Gt=>{Gt.nodeIds.forEach(rn=>{Qe.set(rn,Gt.id)})}),Qe},[f]),lh=(Y==null?void 0:Y.type)==="group"?Y.id:null,Ec=y.useMemo(()=>{const{scale:Qe,translate:Gt}=h,rn=300/Qe,hn={left:-Gt.x/Qe-rn,top:-Gt.y/Qe-rn,right:(m.width-Gt.x)/Qe+rn,bottom:(m.height-Gt.y)/Qe+rn},po=an=>{if(an.dockState||an.isPinned||(Y==null?void 0:Y.type)==="node"&&Y.offsets.has(an.id))return!0;const Sv=an.isCollapsed?In:an.height;return an.position.x<hn.right&&an.position.x+an.width>hn.left&&an.position.y<hn.bottom&&an.position.y+Sv>hn.top},no=b.filter(po),Pr=new Set(no.map(an=>an.id)),kv=x.filter(an=>Pr.has(an.fromNodeId)||Pr.has(an.toNodeId)),_v=f.filter(an=>an.position.x<hn.right&&an.position.x+an.width>hn.left&&an.position.y<hn.bottom&&an.position.y+an.height>hn.top);return{visibleNodes:no,visibleConnections:kv,visibleGroups:_v}},[b,x,f,h,m,Y]),Pc=Qe=>{const Gt=vv.get(Qe.id),rn=!!Gt,hn=!!lh&&Gt===lh;return{key:Qe.id,node:Qe,isGrouped:rn,isGroupDragging:hn,onMouseDown:po=>e.handleNodeMouseDown(po,Qe.id),onTouchStart:ce,onResizeMouseDown:e.handleNodeResizeMouseDown,onValueChange:$e,onEnhance:He,isEnhancing:be===Qe.id,onEnhanceVideo:Ae,isEnhancingVideo:Te===Qe.id,onSanitize:qe,isSanitizing:Ye===Qe.id,onAnalyze:nt,isAnalyzing:Nt===Qe.id,onAnalyzeCharacter:ze,isAnalyzingCharacter:je===Qe.id,onAnalyzeImage:Le,isAnalyzingImage:rt===Qe.id,onImageToText:Hy,onGenerateImage:Ce,isGeneratingImage:Se===Qe.id,onExecuteChain:he,isExecutingChain:ge,isExecuting:Ge===Qe.id,onStopChainExecution:ve,onEditImage:Ve,isEditingImage:ot,onSendMessage:Xe,isChatting:pt===Qe.id,onTranslate:st,isTranslating:ft===Qe.id,onGenerateScript:it,isGeneratingScript:wt===Qe.id,onLoadScriptFile:dt,onGenerateCharacters:_t,isGeneratingCharacters:cn===Qe.id,onGenerateVideo:It,isGeneratingVideo:Ee===Qe.id,onGenerateImageSequence:Ue,onGenerateSelectedFrames:Ke,isGeneratingSequence:et===Qe.id,onStopImageSequence:ht,isStoppingSequence:ut,onRegenerateFrame:at,onDownloadImageFromUrl:kt,onCopyImageToClipboard:St,onLoadImageSequenceFile:Ct,onLoadPromptSequenceFile:Et,onProcessImage:Mt,isProcessingImage:Qo===Qe.id,activeTool:se,onOutputHandleMouseDown:X,onOutputHandleTouchStart:ue,onNodeClick:Q,isHovered:F===Qe.id,isSelected:T.includes(Qe.id),onNodeMouseEnter:()=>te(Qe.id),onNodeMouseLeave:()=>te(null),onDeleteNode:de,onCutConnections:re,onCopyNodeValue:R,onPasteNodeValue:J,onPasteImage:H,onDownloadImage:U,onDuplicateNode:ee,onDuplicateNodeWithContent:ae,onAspectRatioChange:dv,onResolutionChange:cv,onModelChange:lv,onAutoDownloadChange:sv,onRefreshChat:av,onRefreshImageEditor:iv,connectedInputs:Ki.get(Qe.id),onSetImageEditorOutputToInput:lc,connectingInfo:oe,connectionTarget:le,connectedImageSources:cc.get(Qe.id),connectedCharacterData:dc.get(Qe.id),libraryItems:uc,onToggleCollapse:xe,deselectAllNodes:e.deselectAllNodes,isDragOverTarget:$===Qe.id,onProcessChainForward:pc,onSaveCharacterCard:hc,onLoadCharacterCard:mc,onDetachAndPasteConcept:gc,onDetachImageToNode:fc,onSaveCharacterToCatalog:xc,onSaveScriptToCatalog:yc,onSaveSequenceToCatalog:vc,setError:wc,setImageViewer:bc,addToast:Cc,getFullSizeImage:fe,setFullSizeImage:Be,clearImagesForNodeFromCache:Oe,onTranslateScript:Je,isTranslatingScript:lt,onReadData:tt,getUpstreamNodeValues:yt,onRefreshUpstreamData:gt,onModifyPromptSequence:Dt,isModifyingPromptSequence:Tt===Qe.id,onDetachNodeFromGroup:ne,viewTransform:Qe.type===q.IMAGE_EDITOR||Qe.type===q.PROMPT_SEQUENCE_EDITOR||Qe.type===q.IMAGE_SEQUENCE_GENERATOR?h:void 0,onSavePromptToLibrary:Lt,onSaveToLibrary:pn,onRenameNode:(po,no)=>uv({type:"node",id:po,currentTitle:no}),onGenerateCharacterImage:Xt,isGeneratingCharacterImage:er,onDetachCharacter:Xa,onStopGeneration:kc,isStopping:_c,clearSelectionsSignal:Dy,onSaveScriptToDisk:zy,onSaveMediaToDisk:qy,onSaveGeneratedCharacterToCatalog:Oy,isDragging:(Y==null?void 0:Y.type)==="node"&&Y.offsets.has(Qe.id),isGlobalProcessing:Fy,isInstantCloseEnabled:By,handleDockNode:L,handleUndockNode:W,onToggleNodePin:pv,onUpdateCharacterDescription:Gy,isUpdatingDescription:Uy}},{dockedNodes:wv}=y.useMemo(()=>({dockedNodes:b.filter(Gt=>Gt.dockState)}),[b]),Ji=D?b.find(Qe=>Qe.id===D):null,bv=(Qe,Gt)=>{const rn={x:window.innerWidth/2,y:window.innerHeight*.25},hn=sh(rn);hv(Qe,hn);const po=Gt?{x:Gt.clientX,y:Gt.clientY}:{x:window.innerWidth/2,y:window.innerHeight-80},no=sh(po);Nc({start:no,end:hn,fading:!1}),setTimeout(()=>{Nc(Pr=>Pr?{...Pr,fading:!0}:null),setTimeout(()=>Nc(null),500)},100)},Cv=Qe=>{switch(Qe){case"text":return"var(--color-connection-text)";case"image":return"var(--color-connection-image)";case"character_data":return"var(--color-connection-character)";case"video":return"var(--color-connection-video)";case"audio":return"var(--color-connection-audio)";default:return"var(--color-border)"}};return n.jsxs("div",{id:"app-container",className:`relative w-full h-full overflow-hidden select-none ${D?"bg-gray-700":""}`,onMouseDown:v,onContextMenu:N,onTouchStart:_,onTouchMove:E,onTouchEnd:I,onMouseMove:B,onWheel:M,onDoubleClick:G,onDrop:V,onDragOver:j,onDragEnter:P,onDragLeave:S,style:{cursor:A()},children:[!D&&n.jsx(HI,{activeTool:se,onToolChange:Z}),!D&&wv.map(Qe=>n.jsx(fd,{node:Qe,...Pc(Qe)},`${Qe.id}-docked`)),!D&&n.jsxs("div",{id:"canvas-transform-layer",style:{width:"1px",height:"1px",transform:`translate(${h.translate.x}px, ${h.translate.y}px) scale(${h.scale})`,transformOrigin:"0 0"},children:[n.jsxs("div",{className:"absolute top-0 left-0 w-0 h-0 overflow-visible pointer-events-none z-0",children:[n.jsx("div",{className:"absolute top-0 left-[-50000px] w-[100000px] h-[1px] bg-cyan-900/30 -translate-y-1/2"}),n.jsx("div",{className:"absolute left-0 top-[-50000px] w-[1px] h-[100000px] bg-cyan-900/30 -translate-x-1/2"}),n.jsxs("div",{className:"absolute top-0 left-0 w-4 h-4 -translate-x-1/2 -translate-y-1/2 flex items-center justify-center",children:[n.jsx("div",{className:"absolute w-3 h-[2px] bg-accent shadow-[0_0_5px_var(--color-accent)]"}),n.jsx("div",{className:"absolute h-3 w-[2px] bg-accent shadow-[0_0_5px_var(--color-accent)]"})]})]}),Lo&&n.jsx("div",{className:"absolute border-2 border-dashed border-accent-text pointer-events-none",style:{left:Math.min(Lo.start.x,Lo.end.x),top:Math.min(Lo.start.y,Lo.end.y),width:Math.abs(Lo.start.x-Lo.end.x),height:Math.abs(Lo.start.y-Lo.end.y),zIndex:100,backgroundColor:"var(--color-selection)"}}),Sc&&n.jsxs("div",{className:"absolute z-20 flex items-center gap-2 -translate-x-1/2",style:{left:Sc.x,top:Sc.y},onMouseDown:Qe=>Qe.stopPropagation(),onTouchStart:Qe=>Qe.stopPropagation(),children:[n.jsx(mt,{content:t("hotkeys.tools.group"),position:"top",children:n.jsxs("button",{onClick:Pe,className:"px-4 py-2 font-bold text-white bg-accent rounded-md hover:bg-accent-hover transition-all duration-200 shadow-lg flex items-center space-x-2 whitespace-nowrap shadow-accent/20",children:[n.jsx(gP,{}),n.jsx("span",{children:t("group.button.create",{count:T.length})})]})}),n.jsxs("div",{className:"flex bg-gray-800/90 backdrop-blur-md rounded-lg shadow-lg p-1 space-x-1 border border-gray-700",children:[n.jsxs("div",{className:"flex items-center space-x-1 pr-1 border-r border-gray-600 mr-1",children:[n.jsx(mt,{content:t("contextMenu.undoPosition"),position:"top",children:n.jsx("button",{onClick:()=>_e&&_e(b),disabled:!We,className:`p-1.5 rounded transition-colors ${We?"text-gray-300 hover:bg-gray-700 hover:text-white":"text-gray-600 cursor-not-allowed"}`,children:n.jsx(lP,{})})}),n.jsx(mt,{content:t("contextMenu.redoPosition"),position:"top",children:n.jsx("button",{onClick:()=>Fe&&Fe(b),disabled:!Ze,className:`p-1.5 rounded transition-colors ${Ze?"text-gray-300 hover:bg-gray-700 hover:text-white":"text-gray-600 cursor-not-allowed"}`,children:n.jsx(cP,{})})})]}),n.jsx(mt,{content:t("contextMenu.align.left"),position:"top",children:n.jsx("button",{onClick:()=>ye(T,"left"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(yy,{})})}),n.jsx(mt,{content:t("contextMenu.align.centerX"),position:"top",children:n.jsx("button",{onClick:()=>ye(T,"center-x"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(vy,{})})}),n.jsx(mt,{content:t("contextMenu.align.right"),position:"top",children:n.jsx("button",{onClick:()=>ye(T,"right"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(wy,{})})}),n.jsx("div",{className:"w-px bg-gray-600 mx-1"}),n.jsx(mt,{content:t("contextMenu.align.top"),position:"top",children:n.jsx("button",{onClick:()=>ye(T,"top"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(dP,{})})}),n.jsx(mt,{content:t("contextMenu.align.centerY"),position:"top",children:n.jsx("button",{onClick:()=>ye(T,"center-y"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(uP,{})})}),n.jsx(mt,{content:t("contextMenu.align.bottom"),position:"top",children:n.jsx("button",{onClick:()=>ye(T,"bottom"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(pP,{})})}),T.length>=3&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"w-px bg-gray-600 mx-1"}),n.jsx(mt,{content:t("contextMenu.distribute.horizontal"),position:"top",children:n.jsx("button",{onClick:()=>ye(T,"distribute-horizontal"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(hP,{})})}),n.jsx(mt,{content:t("contextMenu.distribute.vertical"),position:"top",children:n.jsx("button",{onClick:()=>ye(T,"distribute-vertical"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(mP,{})})})]})]})]}),n.jsxs("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none z-0 overflow-visible",children:[Ec.visibleConnections.map(Qe=>{const Gt=b.find(no=>no.id===Qe.fromNodeId),rn=b.find(no=>no.id===Qe.toNodeId);if(!Gt||!rn)return null;const{start:hn,end:po}=nv(Gt,rn,Qe);return n.jsx(qI,{connection:Qe,fromNode:Gt,toNode:rn,start:hn,end:po,isNodeHovered:se==="cutter"&&(F===Qe.fromNodeId||F===Qe.toNodeId),activeTool:se,onDelete:ov,onSplit:rv,lineStyle:rh},Qe.id)}),oe&&n.jsx("path",{d:`M ${oe.fromPoint.x} ${oe.fromPoint.y} C ${oe.fromPoint.x+80} ${oe.fromPoint.y}, ${e.pointerPosition.x-80} ${e.pointerPosition.y}, ${e.pointerPosition.x} ${e.pointerPosition.y}`,stroke:Cv(oe.fromType),strokeWidth:"3",fill:"none",style:{strokeDasharray:"8 4",pointerEvents:"none"}}),tv.map((Qe,Gt)=>{const rn=Qe.type==="vertical",hn=rn?Qe.position:Qe.start,po=rn?Qe.start:Qe.position,no=rn?Qe.position:Qe.end,Pr=rn?Qe.end:Qe.position;return n.jsx("line",{x1:hn,y1:po,x2:no,y2:Pr,stroke:"#ec4899",strokeWidth:"1",strokeDasharray:"4 2"},`guide-${Gt}`)})]}),Ec.visibleGroups.map(Qe=>n.jsx(FI,{group:Qe,onMouseDown:Gt=>e.handleGroupMouseDown(Gt,Qe.id),onTouchStart:Gt=>e.handleGroupTouchStart(Gt,Qe.id),onClose:ke,onRename:(Gt,rn)=>e.setRenameInfo({type:"group",id:Gt,currentTitle:rn}),onSaveToCatalog:()=>Re(Qe.id),onSaveToDisk:()=>Me(Qe.id),onCopy:De,onDuplicate:Ie,isHoveredForDrop:Ne===Qe.id,isDragging:(Y==null?void 0:Y.type)==="group"&&Y.id===Qe.id},Qe.id)),Ec.visibleNodes.map(Qe=>n.jsx(fd,{node:Qe,...Pc(Qe),isProxy:!!Qe.dockState},Qe.id)),n.jsx("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none z-[15] overflow-visible",children:K&&n.jsx("path",{d:`M ${K.start.x} ${K.start.y} L ${K.end.x} ${K.end.y}`,stroke:"var(--color-text-accent)",strokeWidth:"2",fill:"none",style:{strokeDasharray:"6 4",transition:"opacity 0.5s ease-out",opacity:K.fading?0:1}})})]}),Ji&&n.jsx(fd,{node:Ji,...Pc(Ji),isFocused:!0},`${Ji.id}-focused`),!D&&n.jsxs("div",{className:"absolute left-1/2 z-20 flex flex-col items-center transition-transform duration-300 ease-in-out",style:{bottom:"8px",transform:s?`translate(-50%, calc(100% - ${u>0?u:32}px))`:"translate(-50%, 0)",maxWidth:"calc(100% - 112px)",width:"max-content"},onMouseDown:Qe=>Qe.stopPropagation(),children:[n.jsxs("div",{ref:k,className:"flex items-center justify-center bg-gray-800/90 backdrop-blur-md border border-gray-600 border-b-0 rounded-t-lg shadow-sm overflow-hidden",children:[n.jsx("button",{onClick:Qe=>{Qe.stopPropagation(),d(!c)},className:`px-3 py-1 transition-colors flex items-center justify-center hover:bg-gray-700 focus:outline-none ${c?"text-accent-text":"text-gray-400 hover:text-gray-200"}`,title:c?"Expand Titles":"Compact Mode (Hide Titles)",children:c?n.jsx(Tl,{className:"h-3.5 w-3.5"}):n.jsx(Il,{className:"h-3.5 w-3.5"})}),n.jsx("div",{className:"w-px h-3 bg-gray-600"}),n.jsx("button",{onClick:Qe=>{Qe.stopPropagation(),l(!s)},className:"px-3 py-1 transition-colors flex items-center justify-center hover:bg-gray-700 focus:outline-none text-gray-400 hover:text-gray-200",title:t(s?"toolbar.expandPanel":"toolbar.collapsePanel"),children:n.jsx("div",{className:`transform transition-transform duration-300 ${s?"rotate-180":"rotate-0"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})})]}),n.jsx("div",{className:"bg-gray-900/50 backdrop-blur-md border border-gray-700 rounded-lg p-1 shadow-2xl w-full",children:n.jsx(UI,{onAddNode:bv,onOpenSearch:()=>mv({x:window.innerWidth/2,y:window.innerHeight/2}),onToggleCatalog:gv,onSaveCanvas:ah,onLoadCanvas:ih,onSaveProject:fv,isDetached:!1,isCompact:c})})]}),!D&&n.jsx("div",{className:"absolute bottom-2 left-2 z-20 pointer-events-auto",onMouseDown:Qe=>Qe.stopPropagation(),children:n.jsx("div",{className:"bg-gray-900/50 backdrop-blur-md p-1 rounded-lg border border-gray-700 shadow-lg",children:n.jsxs("div",{className:`flex ${a?"flex-col-reverse items-start gap-2":"flex-row items-center space-x-2"}`,children:[n.jsx(VI,{title:t(o?"toolbar.expandPanel":"toolbar.collapsePanel"),align:"left",children:n.jsx("button",{onClick:()=>r(Qe=>!Qe),className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300",children:o?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})})}),!o&&n.jsx(BI,{isSnapToGrid:Vy,onSnapToGridChange:()=>Wy(Qe=>!Qe),lineStyle:rh,onLineStyleChange:$y,zoom:h.scale,onZoomChange:Ky,scaleToSliderValue:Jy,sliderValueToScale:Yy,onClearCanvas:Xy,onSaveCanvas:ah,onLoadCanvas:ih,activeTool:se,onToolChange:Z,isSmartGuidesEnabled:Zy,onSmartGuidesChange:()=>Qy(Qe=>!Qe),onResetView:ev,vertical:a})]})})}),xv==="tutorial_success_message"&&n.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/70 backdrop-blur-sm animate-fade-in",children:n.jsxs("div",{className:"bg-gray-800 rounded-2xl shadow-2xl border-2 border-cyan-500 p-8 max-w-md text-center transform scale-100 transition-all",children:[n.jsx("div",{className:"w-20 h-20 bg-cyan-900/50 rounded-full flex items-center justify-center mx-auto mb-6 ring-4 ring-cyan-500/30",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-cyan-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),n.jsx("h2",{className:"text-3xl font-bold text-white mb-4",children:t("tutorial.success.title")}),n.jsx("p",{className:"text-gray-300 mb-8 text-lg leading-relaxed",children:t("tutorial.success.message")}),n.jsx("button",{onClick:yv,className:"w-full py-4 text-xl font-bold text-white bg-gradient-to-r from-cyan-600 to-blue-600 rounded-xl hover:from-cyan-500 hover:to-blue-500 transition-all transform hover:scale-105 shadow-lg shadow-cyan-900/50",children:t("tutorial.success.button")})]})})]})},M0="helpPanelPosition",Fn=({title:e,url:t,icon:o,colorClass:r,description:a,hoverClass:i})=>{const{t:s}=Pt(),[l,c]=y.useState(!1),d=p=>{p.stopPropagation(),navigator.clipboard.writeText(t),c(!0),setTimeout(()=>c(!1),2e3)},u=()=>{window.open(t,"_blank","noopener,noreferrer")};return n.jsxs("div",{onClick:u,className:"group relative flex items-center justify-between bg-gray-900/40 p-3 rounded-xl border border-gray-700/50 hover:border-gray-600 transition-all duration-200 hover:bg-gray-800/60 cursor-pointer",children:[n.jsxs("div",{className:"flex items-center gap-4 overflow-hidden",children:[n.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center bg-gray-800 border border-gray-700 shadow-sm shrink-0 ${r}`,children:o}),n.jsxs("div",{className:"flex flex-col min-w-0",children:[n.jsx("span",{className:`font-bold text-gray-200 text-sm truncate transition-colors ${i||"group-hover:text-cyan-400"}`,children:e}),a&&n.jsx("span",{className:"text-[10px] text-gray-500 uppercase font-bold tracking-wider",children:a}),n.jsx("span",{className:"text-[10px] text-gray-600 truncate font-mono mt-0.5 group-hover:text-gray-500 transition-colors",children:t})]})]}),n.jsxs("div",{className:"flex items-center gap-2 pl-2",children:[n.jsx(mt,{content:s(l?"help.copied":"help.copyLink"),position:"top",children:n.jsx("button",{onClick:d,className:"p-2 rounded-lg bg-gray-800 text-gray-400 hover:text-white hover:bg-gray-700 border border-transparent hover:border-gray-600 transition-all focus:outline-none",children:l?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):n.jsx(zt,{className:"h-4 w-4"})})}),n.jsx("div",{className:`p-2 text-gray-600 transition-colors ${i?i.replace("text-","text-opacity-80 text-"):"group-hover:text-cyan-500"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})})]})]})},na=({title:e,colorClass:t})=>n.jsxs("div",{className:"flex items-center gap-2 mb-3 mt-4 first:mt-0",children:[n.jsx("div",{className:"h-px bg-gray-700 flex-grow"}),n.jsx("span",{className:`text-xs font-bold uppercase tracking-widest ${t||"text-gray-500"}`,children:e}),n.jsx("div",{className:"h-px bg-gray-700 flex-grow"})]}),Ts=n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{d:"M12.48 10.92v3.28h7.84c-.24 1.84-.853 3.187-1.787 4.133-1.147 1.147-2.933 2.4-6.053 2.4-4.827 0-8.6-3.893-8.6-8.72s3.773-8.72 8.6-8.72c2.6 0 4.507 1.027 5.907 2.347l2.307-2.307C18.747 1.44 16.133 0 12.48 0 5.867 0 .307 5.387.307 12s5.56 12 12.173 12c3.573 0 6.267-1.173 8.373-3.36 2.16-2.16 2.84-5.213 2.84-7.667 0-.76-.053-1.467-.173-2.053H12.48z"})}),$I=()=>{const{t:e}=Pt(),[t,o]=y.useState(!1),[r,a]=y.useState(!1),[i,s]=y.useState("hotkeys"),[l,c]=y.useState(!1),d=y.useRef(null),u=y.useRef(null),[p,m]=y.useState({x:0,y:0}),w=y.useRef({x:0,y:0}),k=y.useRef(!1),b=y.useRef(p);y.useEffect(()=>{b.current=p},[p]),y.useEffect(()=>{if(t){a(!0);const _=localStorage.getItem(M0);if(_)try{const E=JSON.parse(_);if(typeof E.x=="number"&&typeof E.y=="number")m(E);else throw new Error("Invalid pos")}catch{m({x:Math.max(0,window.innerWidth/2-300),y:Math.max(0,window.innerHeight/2-360)})}else if(u.current){const E=u.current.getBoundingClientRect(),I=window.innerWidth,B=window.innerHeight,M=600,G=720;let V=E.left;V+M>I&&(V=I-M-20),V=Math.max(20,V);let j=E.bottom+10;j+G>B&&(j=Math.max(20,B-G-20)),m({x:V,y:j})}else m({x:Math.max(0,window.innerWidth/2-300),y:Math.max(0,window.innerHeight/2-360)})}else{const _=setTimeout(()=>a(!1),200);return()=>clearTimeout(_)}},[t]),y.useEffect(()=>{if(!t)return;const _=E=>{d.current&&d.current.contains(E.target)||u.current&&u.current.contains(E.target)||o(!1)};return document.addEventListener("mousedown",_),()=>{document.removeEventListener("mousedown",_)}},[t]),y.useEffect(()=>{const _=E=>{E.key==="F1"&&(E.preventDefault(),o(I=>!I))};return window.addEventListener("keydown",_),()=>window.removeEventListener("keydown",_)},[]);const x=_=>{_.target.closest("button")||(_.preventDefault(),_.stopPropagation(),k.current=!0,w.current={x:_.clientX-p.x,y:_.clientY-p.y},_.currentTarget.setPointerCapture(_.pointerId))},f=_=>{k.current&&(_.preventDefault(),_.stopPropagation(),m({x:_.clientX-w.current.x,y:_.clientY-w.current.y}))},h=_=>{k.current&&(k.current=!1,_.currentTarget.releasePointerCapture(_.pointerId),localStorage.setItem(M0,JSON.stringify(b.current)))},v={tools:[{key:"V",description:e("hotkeys.tools.edit")},{key:"C",description:e("hotkeys.tools.cutter")},{key:"S",description:e("hotkeys.tools.selection")},{key:"R",description:e("hotkeys.tools.reroute")},{key:"Z",description:e("hotkeys.tools.zoom")},{key:"Shift + W",description:e("toolbar.snapToGrid")},{key:"Shift + E",description:e("hotkeys.tools.toggleLineStyle")},{key:"G",description:`${e("hotkeys.tools.group")} / ${e("node.title.gemini_chat")}`},{key:"X",description:e("hotkeys.tools.closeNode")},{key:"D",description:e("hotkeys.tools.duplicate")},{key:"Ctrl + D",description:e("hotkeys.tools.duplicateWithContent")},{key:"Shift+Click",description:e("hotkeys.tools.deleteGroup")}],windows:[{key:"Space",description:e("hotkeys.windows.search")},{key:"Ctrl+Space",description:e("hotkeys.windows.catalog")},{key:"F1",description:e("help.panelTitle")}],alignment:[{key:"F",description:e("contextMenu.align.left")},{key:"E",description:e("contextMenu.align.centerX")},{key:"R",description:e("contextMenu.align.right")},{key:"T",description:e("contextMenu.align.top")},{key:"D",description:e("contextMenu.align.centerY")},{key:"B",description:e("contextMenu.align.bottom")},{key:"Ctrl + D",description:e("contextMenu.distribute.horizontal")},{key:"Ctrl + E",description:e("contextMenu.distribute.vertical")}],createNode:[{key:"T",description:e("node.title.text_input")},{key:"I",description:e("node.title.image_input")},{key:"P",description:e("node.title.prompt_processor")},{key:"O",description:e("node.title.image_output")},{key:"A",description:e("node.title.prompt_analyzer")},{key:"M",description:e("node.title.media_viewer")},{key:"L",description:e("node.title.translator")},{key:"N",description:e("node.title.note")},{key:"Q",description:e("node.title.prompt_sequence_editor")},{key:"E",description:e("node.title.video_editor")},{key:"Shift+P",description:e("node.title.video_prompt_processor")},{key:"Shift+O",description:e("node.title.video_output")},{key:"Shift+I",description:e("node.title.image_editor")},{key:"Shift+A",description:e("node.title.image_analyzer")},{key:"Shift+C",description:e("node.title.character_generator")},{key:"Shift+R",description:e("node.title.data_reader")},{key:"Shift+V",description:e("node.title.script_viewer")},{key:"Shift+Q",description:e("node.title.image_sequence_generator")},{key:"Ctrl+Shift+C",description:e("node.title.character_card")},{key:"Ctrl+Shift+A",description:e("node.title.character_analyzer")}]},N=(_,E)=>n.jsxs("div",{children:[n.jsx("h4",{className:"font-bold text-gray-300 mb-2 border-b border-gray-600 pb-1",children:_}),n.jsx("ul",{className:"space-y-1.5",children:E.map(({key:I,description:B})=>n.jsxs("li",{className:"flex justify-between items-center",children:[n.jsx("span",{children:B}),n.jsx("kbd",{className:"font-mono bg-gray-700 px-2 py-1 rounded-md text-gray-300 text-xs",children:I})]},I))})]});return n.jsxs("div",{ref:u,className:"relative select-none",children:[n.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[n.jsx("button",{onClick:()=>o(!t),className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":e("hotkeys.show"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsxs("div",{className:`absolute top-full left-1/2 -translate-x-1/2 mt-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 ease-in-out origin-top ${l?"opacity-100":"opacity-0 pointer-events-none"}`,role:"tooltip",children:[e("hotkeys.show")," (F1)"]})]}),r&&n.jsxs("div",{ref:d,className:`fixed bg-gray-800 rounded-lg shadow-2xl w-[600px] h-[720px] z-[100] flex flex-col overflow-hidden border border-gray-700 transition-opacity duration-200 ease-in-out ${t?"opacity-100":"opacity-0 pointer-events-none"}`,style:{left:p.x,top:p.y},onMouseDown:_=>_.stopPropagation(),children:[n.jsxs("div",{className:"bg-[#18202f] border-b border-gray-600 cursor-move",onPointerDown:x,onPointerMove:f,onPointerUp:h,children:[n.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[n.jsxs("h2",{className:"text-xl font-bold text-accent-text flex items-center gap-2 pointer-events-none",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e("app.title")," ",n.jsx("span",{className:"text-xs text-accent-text/70 font-normal ml-2",children:e("help.subtitle")})]}),n.jsx("button",{onClick:()=>o(!1),className:"text-gray-400 hover:text-white transition-colors p-1 hover:bg-white/10 rounded-full",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),n.jsxs("div",{className:"flex px-6 gap-6",children:[n.jsxs("button",{onClick:()=>s("hotkeys"),className:`pb-3 text-sm font-semibold transition-colors relative ${i==="hotkeys"?"text-accent-text":"text-gray-400 hover:text-gray-200"}`,children:[e("help.panelTitle"),i==="hotkeys"&&n.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-accent rounded-t-full"})]}),n.jsxs("button",{onClick:()=>s("links"),className:`pb-3 text-sm font-semibold transition-colors relative ${i==="links"?"text-accent-text":"text-gray-400 hover:text-gray-200"}`,children:[e("help.tab.links"),i==="links"&&n.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-accent rounded-t-full"})]})]})]}),n.jsx("div",{className:"p-6 overflow-y-auto custom-scrollbar flex-grow bg-gray-800",children:i==="hotkeys"?n.jsxs("div",{className:"flex flex-col space-y-6 text-sm text-gray-400",children:[n.jsx("div",{children:N(e("hotkeys.tools.title"),v.tools)}),n.jsx("div",{children:N(e("hotkeys.windows.title"),v.windows)}),n.jsx("div",{children:N("Alignment (2+ Selected)",v.alignment)}),n.jsx("div",{children:N(e("hotkeys.createNode.title"),v.createNode)})]}):n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsx(na,{title:e("help.section.socials"),colorClass:"text-red-400"}),n.jsx(Fn,{title:"MurcelloNovaes",description:"YouTube Channel",url:"https://www.youtube.com/@MurcelloNovaes",colorClass:"text-red-500",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{d:"M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"})})}),n.jsx(Fn,{title:"MeowMasterArt",description:"Linktree",url:"https://linktr.ee/meowmasterart",colorClass:"text-green-500",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-6 h-6",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 10v12m0-12c-2 0-3-1-3-3 0-1 0-2 1-3m2 6c2 0 3-1 3-3 0-1 0-2-1-3M7 7c0 2 1 3 2 5m8-5c0 2-1 3-2 5M9 2h6"})})}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(Fn,{title:"Telegram Channel",url:"https://t.me/+h0YEu0nx9QdhMDNi",colorClass:"text-sky-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"})})}),n.jsx(Fn,{title:"Telegram Group",url:"https://t.me/+tyQLGFxiEbRhMDdi",colorClass:"text-sky-500",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-6 h-6",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})})]}),n.jsx(na,{title:e("help.section.githubPages"),colorClass:"text-purple-400"}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(Fn,{title:"Script Modifier",description:"GitHub Pages",url:"https://neytrino2134.github.io/Script-Modifier/",colorClass:"text-green-500",hoverClass:"group-hover:text-green-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-6 h-6",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"})})}),n.jsx(Fn,{title:"Prompt Modifier",description:"GitHub Pages",url:"https://neytrino2134.github.io/Prompt-Modifier/",colorClass:"text-cyan-500",hoverClass:"group-hover:text-cyan-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-6 h-6",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"})})})]}),n.jsx(na,{title:e("help.section.netlify"),colorClass:"text-cyan-400"}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(Fn,{title:"Script Modifier",url:"https://scriptmodifier2.netlify.app/",colorClass:"text-green-500",hoverClass:"group-hover:text-green-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{d:"M12 2L2 19.777h20L12 2zm0 3.7l6.6 11.677H5.4L12 5.7z"})})}),n.jsx(Fn,{title:"Prompt Modifier",url:"https://promptmodifier2.netlify.app/",colorClass:"text-cyan-500",hoverClass:"group-hover:text-cyan-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{d:"M12 2L2 19.777h20L12 2zm0 3.7l6.6 11.677H5.4L12 5.7z"})})})]}),n.jsx(na,{title:e("help.section.studioStable"),colorClass:"text-blue-500"}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(Fn,{title:"Script Modifier 0.1.3",description:"Stable Version",url:"https://ai.studio/apps/drive/1enTmQ5Wz9RBArkZMZm5s5nYQcKxQ9L8M?fullscreenApplet=true",colorClass:"text-green-500",hoverClass:"group-hover:text-green-400",icon:Ts}),n.jsx(Fn,{title:"Prompt Modifier 0.1.7",description:"Stable Version",url:"https://ai.studio/apps/drive/1YCO0DaA4BTm9p0j5XqvpBhX_XTg9ClwC?fullscreenApplet=true",colorClass:"text-cyan-500",hoverClass:"group-hover:text-cyan-400",icon:Ts})]}),n.jsx(na,{title:e("help.section.studioAlpha"),colorClass:"text-blue-500"}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(Fn,{title:"Script Modifier 0.1.4 Alpha",description:"Latest Alpha",url:"https://aistudio.google.com/apps/drive/1y9CSUmlVQK2xq7ckses7fpM6wpbZdBnB?showAssistant=true&resourceKey=&showPreview=true",colorClass:"text-green-500",hoverClass:"group-hover:text-green-400",icon:Ts}),n.jsx(Fn,{title:"Prompt Modifier 0.1.8 Alpha",description:"Latest Alpha",url:"https://aistudio.google.com/apps/drive/1OJfPP9wUKlnjvZ5_2_Fxq_v1dW0iftlW?showAssistant=true&resourceKey=&showPreview=true",colorClass:"text-cyan-500",hoverClass:"group-hover:text-cyan-400",icon:Ts})]}),n.jsx(na,{title:e("help.section.github"),colorClass:"text-yellow-400"}),n.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[n.jsx(Fn,{title:"Script Modifier",url:"https://github.com/Neytrino2134/Script-Modifier",colorClass:"text-green-500",hoverClass:"group-hover:text-green-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"})})}),n.jsx(Fn,{title:"Prompt Modifier",url:"https://github.com/Neytrino2134/Prompt-Modifier",colorClass:"text-cyan-500",hoverClass:"group-hover:text-cyan-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"})})})]}),n.jsx("div",{className:"h-4"})]})}),n.jsxs("div",{className:"p-4 bg-gray-900 border-t border-gray-700 text-xs flex-shrink-0",children:[n.jsxs("div",{className:"flex justify-between items-baseline",children:[n.jsx("span",{className:"font-bold text-gray-600 text-sm",children:e("app.title")}),n.jsx("span",{className:"text-gray-600",children:e("help.license")})]}),n.jsx("div",{className:"w-full h-px bg-gray-700 my-3"}),n.jsxs("div",{className:"flex justify-between items-end",children:[n.jsxs("div",{className:"grid grid-cols-[auto_1fr] gap-x-2 gap-y-1 text-sm",children:[n.jsxs("span",{className:"text-gray-500",children:[e("help.author"),":"]}),n.jsx("span",{className:"text-gray-400 font-medium",children:"MeowMaster"}),n.jsx("span",{className:"text-gray-500",children:"Email:"}),n.jsx("a",{href:"mailto:MeowMasterArt@gmail.com",className:"text-gray-400 hover:text-accent-text transition-colors",children:"MeowMasterArt@gmail.com"}),n.jsx("span",{className:"text-gray-500",children:"GitHub:"}),n.jsx("a",{href:"https://github.com/Neytrino2134/Prompt-Modifier",target:"_blank",rel:"noopener noreferrer",className:"text-gray-400 hover:text-accent-text transition-colors underline",children:"Neytrino2134/Prompt-Modifier"})]}),n.jsx("a",{href:"https://www.netlify.com",target:"_blank",rel:"noopener noreferrer",className:"opacity-80 hover:opacity-100 transition-opacity",children:n.jsx("img",{src:"https://www.netlify.com/assets/badges/netlify-badge-color-accent.svg",alt:"Deploys by Netlify",className:"h-10"})})]})]})]})]})},KI=()=>{const{language:e,setLanguage:t,secondaryLanguage:o,setSecondaryLanguage:r}=Pt(),[a,i]=y.useState(!1),s=y.useRef(null),l=xn[o],c=xn.en;y.useEffect(()=>{const u=p=>{s.current&&!s.current.contains(p.target)&&i(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]);const d=u=>{r(u),t(u),i(!1)};return n.jsxs("div",{className:"flex items-center h-9 space-x-1 select-none relative",ref:s,children:[n.jsx(mt,{content:c.name,position:"bottom",className:"h-full",children:n.jsx("button",{onClick:()=>t("en"),className:`px-3 py-1 rounded-md text-xs font-bold transition-colors h-full flex items-center justify-center focus:outline-none min-w-[36px] ${e==="en"?"bg-accent text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-white"}`,children:c.short})}),n.jsxs("div",{className:"relative flex items-center h-full",children:[n.jsx(mt,{content:l.name,position:"bottom",className:"h-full",children:n.jsx("button",{onClick:()=>t(o),className:`px-3 py-1 rounded-l-md text-xs font-bold transition-colors h-full flex items-center justify-center focus:outline-none min-w-[36px] ${e===o?"bg-accent text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-white"}`,children:l.short})}),n.jsx("button",{onClick:u=>{u.stopPropagation(),i(!a)},className:`h-full px-1 rounded-r-md flex items-center justify-center transition-colors focus:outline-none border-l border-gray-600/50 ${e===o?"bg-accent text-white hover:bg-accent-hover":"bg-gray-700 text-gray-400 hover:bg-gray-600 hover:text-white"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 transition-transform duration-200 ${a?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),a&&n.jsx("div",{className:"absolute top-full right-0 mt-1 bg-gray-800 border border-gray-600 rounded-md shadow-xl z-50 py-1 min-w-[140px] max-h-60 overflow-y-auto custom-scrollbar animate-fade-in-drop origin-top-right",children:Object.entries(xn).filter(([u])=>u!=="en").map(([u,p])=>n.jsxs("button",{onClick:()=>d(u),className:`w-full text-left px-3 py-2 text-xs flex items-center justify-between hover:bg-gray-700 transition-colors ${o===u?"bg-gray-700/50":""}`,children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:`font-medium ${o===u?"text-accent-text":"text-gray-200"}`,children:p.nativeName}),n.jsx("span",{className:"text-[10px] text-gray-500",children:p.name})]}),n.jsx("span",{className:"text-[10px] text-gray-500 font-mono ml-2 border border-gray-600 rounded px-1",children:p.short})]},u))})]})]})},JI=({tab:e,isActive:t,onSwitchTab:o,onStartEditing:r,onCloseTab:a,t:i})=>{const s=y.useRef(null),l=y.useRef(null),[c,d]=y.useState(0),u=()=>{if(s.current&&l.current){const p=l.current.clientWidth-s.current.offsetWidth;d(p<0?p:0)}};return y.useLayoutEffect(()=>{u()},[e.name]),n.jsxs("div",{onClick:()=>o(e.id),onDoubleClick:()=>r(e),onDragOver:p=>{p.preventDefault(),t||o(e.id)},onMouseEnter:u,className:`flex items-center justify-between px-4 h-full rounded-md cursor-pointer transition-colors duration-150 group flex-shrink-0 ${t?"bg-accent text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"} max-w-[200px] overflow-hidden select-none`,children:[n.jsx(mt,{content:e.name,position:"bottom",delay:800,className:"flex-grow min-w-0",children:n.jsx("div",{ref:l,className:"flex-grow min-w-0 overflow-hidden relative mask-fade",children:n.jsx("div",{className:`inline-block whitespace-nowrap ${c<0?"group-hover:animate-swing":""}`,style:{"--scroll-dist":`${c}px`},children:n.jsx("span",{ref:s,className:"text-sm pr-1 block",children:e.name})})})}),n.jsx(mt,{content:i("node.action.close"),position:"bottom",children:n.jsx("button",{onClick:p=>{p.stopPropagation(),a(e.id,p)},className:`ml-3 p-0.5 rounded-full transition-opacity focus:outline-none opacity-50 group-hover:opacity-100 ${t?"text-white hover:bg-accent-hover":"text-gray-500 hover:bg-gray-600 hover:text-white"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})})]})},YI=({tabs:e,activeTabId:t,onSwitchTab:o,onAddTab:r,onCloseTab:a,onRenameTab:i})=>{const{t:s}=Pt(),[l,c]=y.useState(null),[d,u]=y.useState(""),p=y.useRef(null),m=y.useRef(null);y.useEffect(()=>{l&&p.current&&(p.current.focus(),p.current.select())},[l]);const w=f=>{c(f.id),u(f.name)},k=()=>{l&&d.trim()&&i(l,d.trim()),c(null)},b=f=>{f.key==="Enter"?k():f.key==="Escape"&&c(null)},x=f=>{m.current&&(m.current.scrollLeft+=f.deltaY)};return n.jsx("div",{onMouseDown:f=>f.stopPropagation(),className:"flex-shrink-0 pointer-events-auto max-w-[calc(100vw-350px)]",children:n.jsxs("div",{ref:m,onWheel:x,className:"flex items-center h-9 space-x-1 overflow-x-auto overflow-y-hidden hide-scrollbar [&::-webkit-scrollbar]:hidden",children:[e.map(f=>l===f.id?n.jsx("div",{className:"flex items-center justify-between px-4 h-full rounded-md bg-gray-700 max-w-[200px]",children:n.jsx("input",{ref:p,type:"text",value:d,onChange:h=>u(h.target.value),onBlur:k,onKeyDown:b,className:"bg-transparent border-b border-accent-text focus:outline-none text-sm w-full text-white",onClick:h=>h.stopPropagation()})},f.id):n.jsx(JI,{tab:f,isActive:f.id===t,onSwitchTab:o,onStartEditing:w,onCloseTab:a,t:s},f.id)),n.jsx(mt,{content:"New Canvas",position:"bottom",className:"h-full",children:n.jsx("button",{onClick:r,className:"flex-shrink-0 flex items-center justify-center w-8 h-full rounded-md bg-gray-700 text-gray-300 hover:bg-accent hover:text-white transition-colors focus:outline-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})})]})})},L0=({language:e,globalLanguage:t,apiKey:o,setApiKey:r,onSelectLanguage:a,onStart:i,onDeveloperStart:s,onStartNew:l,measureRef:c,onCycleLanguage:d,exitPhase:u,isResumable:p,animationStage:m,triggerHeartbeat:w})=>{const k=y.useCallback((I,B)=>Po(e,I,B),[e]),[b,x]=y.useState(!1),f=y.useRef(null),h=y.useRef(null);y.useEffect(()=>{if(m>=4){const I=setTimeout(()=>{h.current&&h.current.focus()},300);return()=>clearTimeout(I)}},[m]),y.useEffect(()=>{const I=B=>{f.current&&!f.current.contains(B.target)&&x(!1)};return document.addEventListener("mousedown",I),()=>document.removeEventListener("mousedown",I)},[]);const v=xn[t],N=()=>u==="window-exit"?"-translate-y-[150vh] scale-75 opacity-0":u==="button-exit"?"scale-95":m>=4?"opacity-100 translate-y-0 scale-100 blur-0":"opacity-0 translate-y-12 scale-95 blur-sm pointer-events-none",_=m<=1?"ease-[cubic-bezier(0.34,1.56,0.64,1)]":"ease-in-out",E=(m<=1,"duration-1000");return n.jsxs("div",{ref:c,className:"w-full flex flex-col items-center text-center select-none",children:[n.jsxs("div",{className:`
                w-full flex items-center justify-between md:justify-center gap-2 md:gap-12 mb-6 px-1 md:px-4 
                transition-all ${E} ${_}
                ${m>=1?"opacity-100":"opacity-0"}
                ${m<=2?"translate-y-[35vh] scale-125":"translate-y-0 scale-100"}
                ${u!=="idle"?"opacity-0 scale-90 blur-sm":""}
            `,children:[n.jsx("button",{onClick:()=>d(-1),className:`w-10 h-10 md:w-16 md:h-16 flex-shrink-0 rounded-full border border-cyan-500/30 bg-gray-900/40 backdrop-blur-md text-cyan-400 hover:text-white hover:bg-cyan-500/20 hover:border-cyan-400 transition-all duration-700 shadow-[0_0_15px_rgba(6,182,212,0.1)] hover:shadow-[0_0_25px_rgba(6,182,212,0.4)] flex items-center justify-center group z-30 
                        ${m>=5?"opacity-100 scale-100":"opacity-0 scale-50 pointer-events-none"}
                    `,"aria-label":"Previous Language",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 md:h-8 md:w-8 transform transition-transform group-hover:-translate-x-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),n.jsxs("div",{className:`flex flex-col items-center justify-center z-20 gap-3 md:gap-8 py-2 ${w?"animate-heartbeat":""}`,children:[n.jsx("h1",{className:"font-black tracking-tighter leading-none text-center animate-gradient-x bg-size-200 bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 via-sky-500 to-cyan-400 px-1 md:px-4 whitespace-nowrap",style:{fontSize:"clamp(2rem, 7vw, 120px)"},children:k("welcome.title")}),n.jsx("h1",{className:"font-black tracking-tighter leading-none text-center animate-gradient-x bg-size-200 bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 via-sky-500 to-cyan-400 px-1 md:px-4 whitespace-nowrap",style:{fontSize:"clamp(2rem, 7vw, 120px)"},children:k("app.title")})]}),n.jsx("button",{onClick:()=>d(1),className:`w-10 h-10 md:w-16 md:h-16 flex-shrink-0 rounded-full border border-cyan-500/30 bg-gray-900/40 backdrop-blur-md text-cyan-400 hover:text-white hover:bg-cyan-500/20 hover:border-cyan-400 transition-all duration-700 shadow-[0_0_15px_rgba(6,182,212,0.1)] hover:shadow-[0_0_25px_rgba(6,182,212,0.4)] flex items-center justify-center group z-30
                         ${m>=5?"opacity-100 scale-100":"opacity-0 scale-50 pointer-events-none"}
                    `,"aria-label":"Next Language",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 md:h-8 md:w-8 transform transition-transform group-hover:translate-x-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]}),n.jsx("div",{className:`mb-8 h-6 flex items-center justify-center transition-all duration-1000 ease-out delay-100 ${m>=5?"opacity-100 translate-y-0":"opacity-0 -translate-y-8"}`,children:n.jsx("p",{className:"text-gray-400 text-sm font-medium tracking-wide bg-gray-900/40 px-3 py-1 rounded-full border border-gray-700/50 backdrop-blur-sm",children:k("welcome.navHint")})}),n.jsxs("div",{className:`relative w-full max-w-[860px] mx-auto transition-all duration-1000 ease-out delay-100 ${N()}`,children:[n.jsx("div",{className:"welcome-ring"}),n.jsx("div",{className:"relative z-10 w-full bg-gray-800/80 backdrop-blur-xl rounded-3xl border border-gray-700 shadow-2xl overflow-visible",children:n.jsxs("div",{className:"p-8 md:p-10 space-y-8 text-left",children:[n.jsxs("div",{className:"space-y-4 w-full",children:[n.jsx("p",{className:"text-xl md:text-2xl text-gray-200 leading-relaxed font-light",children:k("welcome.description")}),n.jsx("div",{className:"h-px w-full bg-gradient-to-r from-transparent via-cyan-500/30 to-transparent"})]}),n.jsxs("div",{className:"space-y-2 relative z-50",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400 ml-1 uppercase tracking-wide",children:k("welcome.selectLanguage")||"Language"}),n.jsxs("div",{ref:f,className:"relative",children:[n.jsxs("button",{onClick:()=>x(!b),className:"w-full py-3 px-4 rounded-xl bg-gray-900/60 border border-gray-600 hover:border-cyan-500 hover:bg-gray-800/80 transition-all duration-200 text-left flex items-center justify-between group outline-none focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500/50",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center text-xs font-bold text-gray-300 border border-gray-600 group-hover:border-cyan-400/50 transition-colors",children:v.short}),n.jsxs("span",{className:"text-lg text-white font-medium",children:[v.nativeName," ",n.jsxs("span",{className:"text-gray-500 text-sm ml-1",children:["(",v.name,")"]})]})]}),n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 text-gray-400 transition-transform duration-300 ${b?"rotate-180 text-cyan-400":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),b&&n.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-gray-800/95 backdrop-blur-xl border border-gray-600 rounded-xl shadow-2xl max-h-60 overflow-y-auto custom-scrollbar p-1 animate-fade-in-drop origin-top z-[100]",children:Object.entries(xn).map(([I,B])=>n.jsxs("button",{onClick:()=>{a(I),x(!1)},className:`w-full text-left px-4 py-3 rounded-lg flex items-center justify-between transition-colors ${t===I?"bg-cyan-600/20 text-cyan-400":"text-gray-300 hover:bg-gray-700 hover:text-white"}`,children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("span",{className:"text-xs font-bold w-6 text-gray-500",children:B.short}),n.jsx("span",{className:"font-medium",children:B.nativeName})]}),t===I&&n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-cyan-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},I))})]})]}),n.jsx("div",{className:"space-y-4 text-left w-full pt-4 border-t border-gray-700/50",children:n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex justify-between items-center px-1 mb-1",children:[n.jsx("label",{htmlFor:"welcome-api-key",className:"block text-sm font-medium text-gray-400",children:k("welcome.apiKeyLabel")}),n.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-xs text-cyan-400 hover:text-cyan-300 underline",children:k("welcome.getKeyLink")})]}),n.jsx("div",{className:"relative",children:n.jsx("input",{ref:h,type:"password",id:"welcome-api-key",value:o,onChange:I=>r(I.target.value),placeholder:k("welcome.apiKeyPlaceholder"),className:"w-full p-4 bg-gray-900/60 border border-gray-500 rounded-xl text-white outline-none focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition-all duration-200 shadow-inner select-text"})}),n.jsx("div",{className:"flex items-center justify-center pt-2",children:n.jsxs("div",{className:"flex items-center space-x-1.5 text-gray-500 bg-gray-900/30 px-3 py-1 rounded-full border border-gray-700/30",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),n.jsx("span",{className:"text-[10px] md:text-xs font-medium",children:k("welcome.apiKeyHelp")})]})})]})}),n.jsxs("div",{className:"pt-2 flex flex-col gap-3",children:[n.jsx("button",{onClick:i,className:"w-full py-4 text-lg font-bold text-white bg-gradient-to-r from-cyan-600 via-blue-600 to-cyan-600 bg-size-200 animate-gradient-x shadow-cyan-900/30 rounded-xl shadow-lg transform hover:scale-105 active:scale-95 transition-all duration-200 flex items-center justify-center gap-3 group relative overflow-hidden",children:n.jsxs("div",{className:`flex items-center gap-3 transition-all duration-500 ease-[cubic-bezier(0.68,-0.55,0.27,1.55)] ${u!=="idle"?"translate-x-[200px] opacity-0":"translate-x-0 opacity-100"}`,children:[n.jsx("span",{children:k(p?"welcome.resume":"welcome.letsGo")}),n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 transform group-hover:translate-x-1 transition-transform",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 7l5 5m0 0l-5 5m5-5H6"})})]})}),p&&l&&n.jsx("div",{className:"mt-2 w-full",children:n.jsx("button",{onClick:l,className:"w-full py-3 border border-gray-600 hover:border-gray-400 text-gray-400 hover:text-white rounded-xl transition-all duration-200 text-sm font-semibold",children:k("welcome.startNew")})}),n.jsx("div",{children:n.jsx("button",{onClick:s,className:"w-full py-3 border border-gray-700 hover:border-cyan-500/50 text-gray-500 hover:text-cyan-400 rounded-xl transition-all duration-200 text-xs font-semibold tracking-wide bg-transparent hover:bg-gray-800/30",children:k("welcome.iAmDeveloper")})})]})]})})]}),n.jsxs("div",{className:`mt-10 flex flex-col md:flex-row gap-4 transition-all duration-1000 ease-out ${m>=5?"opacity-100 translate-y-0 scale-100":"opacity-0 translate-y-8 scale-95 pointer-events-none"}`,children:[n.jsxs("a",{href:"https://scriptmodifier2.netlify.app/",target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-3 px-6 py-3 rounded-full bg-gray-900/60 hover:bg-gray-800 border border-gray-700 hover:border-cyan-500/50 text-gray-400 hover:text-cyan-400 transition-all duration-300 backdrop-blur-sm shadow-lg hover:shadow-cyan-500/10",children:[n.jsx("span",{className:"font-semibold tracking-wide text-sm",children:"Go to Script Modifier on Netlify"}),n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:n.jsx("path",{d:"M12 2L2 19.777h20L12 2zm0 3.7l6.6 11.677H5.4L12 5.7z"})})]}),n.jsxs("a",{href:"https://github.com/Neytrino2134/Script-Modifier",target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-3 px-6 py-3 rounded-full bg-gray-900/60 hover:bg-gray-800 border border-gray-700 hover:border-purple-500/50 text-gray-400 hover:text-purple-400 transition-all duration-300 backdrop-blur-sm shadow-lg hover:shadow-purple-500/10",children:[n.jsx("span",{className:"font-semibold tracking-wide text-sm",children:"Go to Script Modifier on GitHub"}),n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:n.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"})})]})]})]})},XI=({onClose:e,isResumable:t=!1})=>{const o=Kt(),{language:r,setSecondaryLanguage:a,setLanguage:i,t:s}=Pt(),[l,c]=y.useState(""),[d,u]=y.useState(!1),[p,m]=y.useState("idle"),[w,k]=y.useState(0),[b,x]=y.useState(!1),[f,h]=y.useState(r),[v,N]=y.useState(null),[_,E]=y.useState(0),[I,B]=y.useState(void 0),M=y.useRef(null),G=y.useRef(null);y.useEffect(()=>{v||h(r)},[r,v]),y.useEffect(()=>{if(!M.current)return;const L=()=>{M.current&&B(M.current.offsetHeight)},W=new ResizeObserver(L);return W.observe(M.current),L(),()=>W.disconnect()},[f,w]),y.useEffect(()=>{const L=localStorage.getItem("settings_userApiKey");L&&c(L),requestAnimationFrame(()=>u(!0)),setTimeout(()=>k(1),100),setTimeout(()=>x(!0),1600),setTimeout(()=>{x(!1),k(3)},3600),setTimeout(()=>k(4),4400),setTimeout(()=>k(5),5e3)},[]);const V=()=>{window.location.reload()},j=L=>{L!==r&&(G.current&&clearTimeout(G.current),N(f),E(1),h(L),L==="en"?i("en"):(a(L),i(L)),requestAnimationFrame(()=>{requestAnimationFrame(()=>{E(0)})}),G.current=setTimeout(()=>{N(null)},200))},P=y.useCallback(L=>{const W=Object.keys(xn);let T=W.indexOf(f)+L;T<0&&(T=W.length-1),T>=W.length&&(T=0),j(W[T])},[f,r]);y.useEffect(()=>{const L=W=>{W.key==="ArrowLeft"?P(-1):W.key==="ArrowRight"&&P(1)};return window.addEventListener("keydown",L),()=>window.removeEventListener("keydown",L)},[P]);const S=(L,W=!1,D)=>{localStorage.setItem("hasVisited","true"),m("button-exit"),L&&o&&(o.resetCanvasToDefault&&o.resetCanvasToDefault(D||f),W?localStorage.setItem("tutorial_completed","true"):(localStorage.removeItem("tutorial_completed"),setTimeout(()=>{o.startTutorial&&o.startTutorial()},500))),setTimeout(()=>{},200),setTimeout(()=>{m("window-exit")},400),setTimeout(()=>{e()},1e3)},A=()=>{localStorage.setItem("settings_useDevKey","false"),l.trim()&&localStorage.setItem("settings_userApiKey",l.trim()),S(!t,!1)},O=()=>{localStorage.setItem("settings_useDevKey","false"),l.trim()&&localStorage.setItem("settings_userApiKey",l.trim()),S(!0,!1)},z=()=>{localStorage.setItem("settings_useDevKey","true"),o&&o.setIsInstantCloseEnabled(!0),a("ru"),i("ru"),h("ru"),S(!0,!0,"ru")};return n.jsxs("div",{className:`fixed inset-0 bg-[#111827] z-[200] flex flex-col items-center justify-center overflow-hidden text-white px-4 custom-scrollbar transition-all duration-700 select-none ${p==="window-exit"?"opacity-0":"opacity-100"}`,onMouseDown:L=>{L.target instanceof HTMLInputElement||L.target instanceof HTMLTextAreaElement||L.preventDefault()},children:[n.jsx("style",{children:`
            .bg-size-200 { background-size: 200% auto; }
            @keyframes gradient-x {
                0% { background-position: 0% 50%; }
                100% { background-position: -200% 50%; }
            }
            .animate-gradient-x {
                animation: gradient-x 3s linear infinite;
            }
            @keyframes heartbeat {
                0% { transform: scale(1); }
                25% { transform: scale(0.95); }
                50% { transform: scale(1.05); }
                75% { transform: scale(0.95); }
                100% { transform: scale(1); }
            }
            .animate-heartbeat {
                animation: heartbeat 1.5s ease-in-out; 
            }
        `}),n.jsxs("div",{className:`absolute top-4 right-4 z-50 flex items-center gap-4 transition-opacity duration-700 ${w>=3?"opacity-100":"opacity-0"}`,children:[n.jsx("button",{onClick:V,className:"transition-all duration-300 hover:opacity-100 opacity-60 hover:scale-110 p-1",title:s("dialog.settings.reload"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,className:"text-white",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),n.jsx("a",{href:"https://github.com/Neytrino2134/Prompt-Modifier",target:"_blank",rel:"noopener noreferrer",className:"transition-all duration-300 hover:opacity-100 opacity-60 hover:scale-110",title:"View Source on GitHub",children:n.jsx("svg",{width:"32",height:"32",viewBox:"0 0 98 96",xmlns:"http://www.w3.org/2000/svg",className:"fill-white",children:n.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z"})})}),n.jsx("div",{className:"transition-opacity hover:opacity-100 opacity-80",children:n.jsx("a",{href:"https://www.netlify.com",target:"_blank",rel:"noopener noreferrer",children:n.jsx("img",{src:"https://www.netlify.com/assets/badges/netlify-badge-color-accent.svg",alt:"Deploys by Netlify"})})})]}),n.jsx("div",{className:`absolute -bottom-20 -right-20 pointer-events-none fixed transition-all duration-1000 ${w>=5?"opacity-5 translate-x-0":"opacity-0 translate-x-20"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-[600px] h-[600px] text-white transform rotate-[-15deg]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"0.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),n.jsx("div",{className:`relative z-10 w-full flex flex-col items-center text-center transition-all duration-700 ease-out transform ${d?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:n.jsxs("div",{className:"relative w-full transition-[height] duration-200 ease-in-out",style:{height:I?`${I}px`:"auto"},children:[n.jsx("div",{className:"relative w-full z-10",children:n.jsx(L0,{language:f,globalLanguage:r,apiKey:l,setApiKey:c,onSelectLanguage:j,onStart:A,onDeveloperStart:z,onStartNew:O,measureRef:M,onCycleLanguage:P,exitPhase:p,isResumable:t,animationStage:w,triggerHeartbeat:b})}),v&&n.jsx("div",{className:"absolute top-0 left-0 w-full z-20 pointer-events-none transition-opacity duration-200 ease-linear",style:{opacity:_},children:n.jsx(L0,{language:v,globalLanguage:r,apiKey:l,setApiKey:c,onSelectLanguage:j,onStart:A,onDeveloperStart:z,onCycleLanguage:P,exitPhase:"idle",isResumable:t,animationStage:5,triggerHeartbeat:!1})})]})})]})},ZI="v0.1.9 Alpha.4",qo=({title:e,children:t,align:o="center"})=>{const[r,a]=y.useState(!1);let i="left-1/2 -translate-x-1/2 top-full mt-2 origin-top";return o==="left"&&(i="left-0 top-full mt-2 origin-top-left"),o==="right"&&(i="right-0 top-full mt-2 origin-top-right"),n.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[t,n.jsx("div",{className:`absolute px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-lg shadow-xl z-50 transition-all duration-200 ease-out transform ${i} ${r?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,role:"tooltip",children:e})]})},QI=()=>{const e=Kt(),[t,o]=y.useState(!1),[r,a]=y.useState(!1),[i,s]=y.useState(!1);y.useEffect(()=>{const A=()=>{a(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",A),()=>document.removeEventListener("fullscreenchange",A)},[]),y.useEffect(()=>{if(!i)return;const A=()=>s(!1);return document.addEventListener("click",A),()=>document.removeEventListener("click",A)},[i]);const l=()=>{document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen().catch(A=>{console.error(`Error attempting to enable full-screen mode: ${A.message} (${A.name})`)})};if(!e)return null;const{t:c,clearUnusedFullSizeImages:d,handleResetCanvas:u,tabs:p,activeTabId:m,handleSwitchTab:w,handleAddTab:k,handleCloseTab:b,handleRenameTab:x,showWelcome:f,setShowWelcome:h,nodes:v,loadCanvasState:N,setConfirmInfo:_,currentTheme:E,setTheme:I,resetTabs:B}=e,M=A=>{const O=A.currentTarget.getBoundingClientRect();window.dispatchEvent(new CustomEvent("open-settings",{detail:{x:O.left,y:O.bottom}}))},G=()=>{h(!0)},V=()=>{_({title:c("dialog.exitApp.title"),message:c("dialog.exitApp.message"),onConfirm:()=>{N({nodes:[],connections:[],groups:[],viewTransform:{scale:1,translate:{x:0,y:0}},nodeIdCounter:1,fullSizeImageCache:{}}),h(!0)}})},j=()=>{_({title:c("dialog.reload.title"),message:c("dialog.reload.message"),onConfirm:()=>{N({nodes:[],connections:[],groups:[],viewTransform:{scale:1,translate:{x:0,y:0}},nodeIdCounter:1,fullSizeImageCache:{}}),B&&B("en"),setTimeout(()=>{window.location.reload()},100)}})},P=v&&v.length>0&&localStorage.getItem("hasVisited")==="true",S=[{id:"cyan",color:"#06b6d4",label:"Cyan"},{id:"azure",color:"#0ea5e9",label:"Azure"},{id:"purple",color:"#9333ea",label:"Purple"},{id:"pink",color:"#ec4899",label:"Pink"},{id:"red",color:"#dc2626",label:"Red"},{id:"orange",color:"#f97316",label:"Orange"},{id:"lime",color:"#84cc16",label:"Lime"},{id:"emerald",color:"#10b981",label:"Emerald"},{id:"gray",color:"#71717a",label:"Gray"}];return n.jsxs(n.Fragment,{children:[f&&n.jsx(XI,{onClose:()=>h(!1),isResumable:P}),n.jsx("header",{className:"absolute top-0 left-0 w-full flex justify-start p-2 z-30 pointer-events-none",children:n.jsxs("div",{className:"bg-gray-900 rounded-lg shadow-lg p-1 flex items-center gap-1 pointer-events-auto border border-gray-700",onMouseDown:A=>A.stopPropagation(),children:[n.jsx(qo,{title:c(t?"toolbar.expandPanel":"toolbar.collapsePanel"),align:"left",children:n.jsx("button",{onClick:()=>o(A=>!A),className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":c(t?"toolbar.expandPanel":"toolbar.collapsePanel"),children:t?n.jsx(my,{}):n.jsx(gy,{})})}),!t&&n.jsxs(n.Fragment,{children:[n.jsx(qo,{title:c("toolbar.home"),children:n.jsx("button",{onClick:G,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":c("toolbar.home"),children:n.jsx(oP,{})})}),n.jsx($I,{}),n.jsx(qo,{title:c("toolbar.clearCache"),children:n.jsx("button",{onClick:d,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":c("toolbar.clearCache"),children:n.jsx(rP,{})})}),n.jsx(qo,{title:c("toolbar.settings"),children:n.jsx("button",{onClick:M,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":c("toolbar.settings"),children:n.jsx(fy,{})})}),n.jsx(qo,{title:c(r?"toolbar.exitFullScreen":"toolbar.enterFullScreen"),children:n.jsx("button",{onClick:l,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":c(r?"toolbar.exitFullScreen":"toolbar.enterFullScreen"),children:r?n.jsx(Zp,{}):n.jsx(Xp,{})})}),n.jsx(qo,{title:c("toolbar.resetCanvas"),children:n.jsx("button",{onClick:u,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":c("toolbar.resetCanvas"),children:n.jsx(aP,{})})}),n.jsx(KI,{}),n.jsx(YI,{tabs:p,activeTabId:m,onSwitchTab:w,onAddTab:k,onCloseTab:b,onRenameTab:x}),n.jsxs("h1",{className:"text-lg font-bold text-accent-text whitespace-nowrap flex items-center space-x-2 select-none ml-2",children:[n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{d:"M21 15l-5-5L5 21"})]}),n.jsx("span",{children:c("app.title")})]}),n.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[n.jsx("div",{className:"px-2 py-0.5 bg-gray-800 rounded border border-gray-600 text-[10px] font-mono text-gray-400 select-none",children:ZI}),n.jsxs("div",{className:"relative",children:[n.jsx(qo,{title:c("settings.themeLabel"),children:n.jsx("button",{onClick:A=>{A.stopPropagation(),s(!i)},className:`p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 ${i?"bg-accent text-white":"bg-gray-700 text-gray-300 hover:bg-accent hover:text-white"}`,children:n.jsx(iP,{})})}),i&&n.jsx("div",{className:"absolute top-full right-0 mt-2 bg-gray-800 border border-gray-600 rounded-lg shadow-xl p-2 z-50 flex flex-col gap-1 min-w-[120px] animate-fade-in-drop origin-top-right",children:S.map(A=>n.jsxs("button",{onClick:()=>I(A.id),className:`flex items-center gap-2 px-2 py-1.5 rounded hover:bg-gray-700 w-full text-left transition-colors ${E===A.id?"bg-gray-700":""}`,children:[n.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:A.color}}),n.jsx("span",{className:`text-xs ${E===A.id?"text-white font-bold":"text-gray-300"}`,children:A.label})]},A.id))})]}),n.jsx(qo,{title:c("dialog.settings.reload"),children:n.jsx("button",{onClick:j,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 text-gray-300 hover:bg-red-600 hover:text-white","aria-label":c("dialog.settings.reload"),children:n.jsx(xy,{})})}),n.jsx(qo,{title:c("toolbar.exitApp"),align:"right",children:n.jsx("button",{onClick:V,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-red-600 hover:text-white text-gray-300","aria-label":c("toolbar.exitApp"),children:n.jsx(sP,{})})})]})]})]})})]})},D0="prompt_modifier_recent_nodes",eT=({isOpen:e,position:t,onClose:o,onAddNode:r})=>{const{t:a}=Pt(),[i,s]=y.useState(""),[l,c]=y.useState(0),[d,u]=y.useState([]),p=y.useRef(null),m=y.useRef(null),w=y.useRef(null),[k,b]=y.useState({x:0,y:0}),[x,f]=y.useState(!1),h=y.useRef(!1),v=y.useRef({x:0,y:0}),N=y.useRef({x:0,y:0});y.useEffect(()=>{try{const O=localStorage.getItem(D0);O&&u(JSON.parse(O))}catch(O){console.error("Failed to load recent nodes",O)}},[]);const _=O=>{u(z=>{const L=z.filter(D=>D!==O),W=[O,...L].slice(0,3);return localStorage.setItem(D0,JSON.stringify(W)),W})},E=y.useMemo(()=>[{group:"input",type:q.TEXT_INPUT,title:a("search.node.text_input.title"),englishTitle:"Text Input",description:a("search.node.text_input.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 6h10M12 6v12"})})},{group:"input",type:q.IMAGE_INPUT,title:a("search.node.image_input.title"),englishTitle:"Image Input",description:a("search.node.image_input.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{d:"M21 15l-5-5L5 21"})]})},{group:"input",type:q.MEDIA_VIEWER,title:a("search.node.media_viewer.title"),englishTitle:"Media Viewer",description:a("search.node.media_viewer.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})},{group:"input",type:q.PROMPT_SEQUENCE_EDITOR,title:a("search.node.prompt_sequence_editor.title"),englishTitle:"Prompt Sequence Editor",description:a("search.node.prompt_sequence_editor.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z"})})},{group:"input",type:q.DATA_READER,title:a("search.node.data_reader.title"),englishTitle:"Data Reader",description:a("search.node.data_reader.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})},{group:"input",type:q.NOTE,title:a("search.node.note.title"),englishTitle:"Note",description:a("search.node.note.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})},{group:"process",type:q.PROMPT_PROCESSOR,title:a("search.node.prompt_processor.title"),englishTitle:"Prompt Processor",description:a("search.node.prompt_processor.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})},{group:"process",type:q.PROMPT_ANALYZER,title:a("search.node.prompt_analyzer.title"),englishTitle:"Prompt Analyzer",description:a("search.node.prompt_analyzer.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})},{group:"character",type:q.CHARACTER_CARD,title:a("search.node.character_card.title"),englishTitle:"Character Card",description:a("search.node.character_card.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 8a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5a7.5 7.5 0 0115 0"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.5a.75.75 0 00-.75.75v13.5c0 .414.336.75.75.75h16.5a.75.75 0 00.75-.75V5.25a.75.75 0 00-.75-.75H3.75z"})]})},{group:"character",type:q.CHARACTER_ANALYZER,title:a("search.node.character_analyzer.title"),englishTitle:"Character Analyzer",description:a("search.node.character_analyzer.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})},{group:"character",type:q.CHARACTER_GENERATOR,title:a("search.node.character_generator.title"),englishTitle:"Character Generator",description:a("search.node.character_generator.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})})},{group:"character",type:q.POSE_CREATOR,title:a("search.node.pose_creator.title"),englishTitle:"Pose Creator",description:a("search.node.pose_creator.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})},{group:"process",type:q.IMAGE_ANALYZER,title:a("search.node.image_analyzer.title"),englishTitle:"Image Analyzer",description:a("search.node.image_analyzer.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0z"})})},{group:"process",type:q.IMAGE_EDITOR,title:a("search.node.image_editor.title"),englishTitle:"AI Image Editor",description:a("search.node.image_editor.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]})},{group:"ai",type:q.TRANSLATOR,title:a("search.node.translator.title"),englishTitle:"Translator",description:a("search.node.translator.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})},{group:"ai",type:q.GEMINI_CHAT,title:a("search.node.gemini_chat.title"),englishTitle:"Gemini Chat",description:a("search.node.gemini_chat.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{group:"ai",type:q.PROMPT_SANITIZER,title:a("search.node.prompt_sanitizer.title"),englishTitle:"Prompt Sanitizer",description:a("search.node.prompt_sanitizer.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})},{group:"video",type:q.VIDEO_PROMPT_PROCESSOR,title:a("search.node.video_prompt_processor.title"),englishTitle:"Video Prompt Processor",description:a("search.node.video_prompt_processor.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})})},{group:"video",type:q.VIDEO_OUTPUT,title:a("search.node.video_output.title"),englishTitle:"Video Output",description:a("search.node.video_output.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9A2.25 2.25 0 0013.5 5.25h-9A2.25 2.25 0 002.25 7.5v9A2.25 2.25 0 004.5 18.75z"})})},{group:"video",type:q.VIDEO_EDITOR,title:a("node.title.video_editor"),englishTitle:"Video Editor",description:a("node.help.video_editor"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})},{group:"scripts",type:q.SCRIPT_GENERATOR,title:a("search.node.script_generator.title"),englishTitle:"Script Generator",description:a("search.node.script_generator.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})},{group:"scripts",type:q.SCRIPT_VIEWER,title:a("search.node.script_viewer.title"),englishTitle:"Script Viewer",description:a("search.node.script_viewer.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 19.82a2.25 2.25 0 01-1.897 1.13l-2.685.8.8-2.685a2.25 2.25 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})},{group:"output",type:q.IMAGE_OUTPUT,title:a("search.node.image_output.title"),englishTitle:"Image Output",description:a("search.node.image_output.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})},{group:"output",type:q.IMAGE_SEQUENCE_GENERATOR,title:a("search.node.image_sequence_generator.title"),englishTitle:"Image Sequence Generator",description:a("search.node.image_sequence_generator.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})})},{group:"output",type:q.IMAGE_EDITOR,title:a("search.node.image_editor.title"),englishTitle:"AI Image Editor",description:a("search.node.image_editor.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]})},{group:"game",type:q.DATA_PROTECTION,title:a("search.node.data_protection.title"),englishTitle:"Data Protection",description:a("search.node.data_protection.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})}],[a]),I=y.useMemo(()=>({input:a("search.group.input"),process:a("search.group.process"),character:a("quickadd.group.character"),output:a("search.group.output"),ai:a("search.group.ai"),video:a("search.group.video"),scripts:a("search.group.scripts"),game:"Games"}),[a]),B={input:"bg-emerald-800/50 text-emerald-300",process:"bg-green-800/50 text-green-300",character:"bg-pink-800/50 text-pink-300",output:"bg-blue-800/50 text-blue-300",ai:"bg-amber-800/50 text-amber-300",video:"bg-red-800/50 text-red-300",scripts:"bg-lime-800/50 text-lime-300",game:"bg-cyan-800/50 text-cyan-300"},M=y.useMemo(()=>{const O=i.toLowerCase().trim(),z=E.filter(L=>L.title.toLowerCase().includes(O)||L.englishTitle.toLowerCase().includes(O)||L.description.toLowerCase().includes(O));return O===""?{recents:d.map(W=>E.find(D=>D.type===W)).filter(Boolean),all:E}:{recents:[],all:z}},[i,E,d]),G=y.useMemo(()=>{const{recents:O,all:z}=M;return[...O.map(L=>({...L,isRecent:!0})),...z.map(L=>({...L,isRecent:!1}))]},[M]);y.useEffect(()=>{if(e){if(s(""),c(0),f(!0),w.current){const O=w.current.getBoundingClientRect();let z=t.x-O.width/2,L=t.y+10;z+O.width>window.innerWidth-10&&(z=window.innerWidth-O.width-10),z<10&&(z=10),L+400>window.innerHeight-10&&(L=t.y-400-10),L<10&&(L=10),b({x:z,y:L}),N.current={x:z,y:L}}setTimeout(()=>{var O;return(O=p.current)==null?void 0:O.focus()},50)}else f(!1)},[e,t]),y.useEffect(()=>{var O;if(l>=0&&l<G.length){const z=(O=m.current)==null?void 0:O.querySelector(`[data-index="${l}"]`);z==null||z.scrollIntoView({block:"nearest"})}},[l,G]);const V=O=>{O.preventDefault(),O.stopPropagation(),h.current=!0,v.current={x:O.clientX,y:O.clientY},N.current={...k},O.currentTarget.setPointerCapture(O.pointerId)},j=O=>{if(h.current&&w.current){const z=O.clientX-v.current.x,L=O.clientY-v.current.y;w.current.style.transform=`translate(${z}px, ${L}px)`}},P=O=>{if(h.current&&w.current){h.current=!1;const z=O.clientX-v.current.x,L=O.clientY-v.current.y;b(W=>({x:W.x+z,y:W.y+L})),w.current.style.transform="",O.currentTarget.releasePointerCapture(O.pointerId)}},S=O=>{if(O.key==="Escape")O.stopPropagation(),o();else if(O.key==="ArrowDown")O.preventDefault(),c(z=>Math.min(z+1,G.length-1));else if(O.key==="ArrowUp")O.preventDefault(),c(z=>Math.max(z-1,0));else if(O.key==="Enter"&&(O.preventDefault(),G[l])){const z=G[l].type;r(z),_(z),o()}},A=O=>{r(O),_(O),o()};return!e&&!x?null:n.jsx("div",{className:"fixed inset-0 z-50 bg-transparent pointer-events-none",children:n.jsxs("div",{ref:w,className:`bg-gray-800 rounded-lg shadow-2xl w-full max-w-md border border-gray-700 flex flex-col pointer-events-auto transition-opacity duration-150 ${x?"opacity-100":"opacity-0"}`,style:{left:k.x,top:k.y,position:"absolute"},onMouseDown:O=>O.stopPropagation(),onKeyDown:S,children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-700 cursor-move bg-gray-900/50 rounded-t-lg select-none",onPointerDown:V,onPointerMove:j,onPointerUp:P,children:[n.jsx("span",{className:"font-bold text-gray-200",children:a("hotkeys.windows.search")}),n.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[n.jsx("span",{children:"ESC to close"}),n.jsx("button",{onClick:o,onPointerDown:O=>O.stopPropagation(),className:"hover:text-white transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),n.jsx("div",{className:"p-4 border-b border-gray-700",children:n.jsx("input",{ref:p,type:"text",placeholder:a("search.placeholder"),value:i,onChange:O=>{s(O.target.value),c(0)},className:"w-full px-3 py-2 bg-gray-900 text-white rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-accent",onKeyDown:O=>{O.key==="Escape"&&(O.preventDefault(),o()),O.stopPropagation()}})}),n.jsx("ul",{ref:m,className:"max-h-80 overflow-y-auto p-2",onWheel:O=>O.stopPropagation(),children:G.length>0?G.map((O,z)=>{const L=z>0?G[z-1]:null,W=O.isRecent,D=L?L.isRecent:!1;let T=!1,F="",te="";return W?z===0&&(T=!0,F="Recent",te="bg-gray-700 text-gray-300"):(!L||D||O.group!==L.group)&&(T=!0,F=I[O.group],te=B[O.group]),n.jsxs(At.Fragment,{children:[T&&n.jsx("li",{className:`px-3 py-1 mt-2 mb-1 text-xs font-bold rounded ${te} select-none list-none uppercase tracking-wider`,"aria-hidden":"true",children:F}),n.jsxs("li",{"data-index":z,onClick:()=>A(O.type),onMouseEnter:()=>c(z),className:`flex items-center space-x-4 p-3 rounded-md cursor-pointer transition-colors duration-150 ${z===l?"bg-accent":"hover:bg-gray-700"}`,children:[n.jsx("div",{className:`flex-shrink-0 w-8 h-8 flex items-center justify-center rounded ${z===l?"text-white":"text-gray-300"}`,children:O.icon}),n.jsxs("div",{children:[n.jsx("p",{className:`font-semibold ${z===l?"text-white":"text-gray-100"}`,children:O.title}),n.jsx("p",{className:`text-sm ${z===l?"text-white/80":"text-gray-400"}`,children:O.description})]})]})]},`${O.type}-${z}`)}):n.jsx("li",{className:"p-4 text-center text-gray-500",children:a("search.noResults")})})]})})},tT=({title:e,onClick:t,children:o,isActive:r})=>{const[a,i]=y.useState(!1);return n.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:[n.jsx("button",{onClick:t,"aria-label":e,className:`flex items-center justify-center w-9 h-9 p-2 rounded-md transition-colors text-gray-300 hover:text-white ${r?"bg-accent text-white":"bg-gray-700 hover:bg-accent"}`,children:o}),n.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 opacity-0 pointer-events-none group-hover:opacity-100",role:"tooltip",children:e})]})},nT=({isOpen:e,position:t,onClose:o,onAddNode:r,onToolChange:a,activeTool:i,isPinned:s,onPinToggle:l,onPaste:c})=>{const{t:d}=Pt(),u=y.useRef(null),[p,m]=y.useState({opacity:0,pointerEvents:"none"}),[w,k]=y.useState(!1),[b,x]=y.useState({x:0,y:0}),f=y.useRef(null),h=y.useRef(!1);y.useEffect(()=>{if(e){if(x({x:0,y:0}),u.current){const P=u.current.getBoundingClientRect(),S=window.innerWidth,A=window.innerHeight,O=20,z=[{left:t.x+O,top:t.y+O},{left:t.x-P.width-O,top:t.y+O},{left:t.x+O,top:t.y-P.height-O},{left:t.x-P.width-O,top:t.y-P.height-O}];let L=null;for(const W of z){const D={left:W.left,top:W.top,right:W.left+P.width,bottom:W.top+P.height};if(D.left>=O&&D.right<=S-O&&D.top>=O&&D.bottom<=A-O){L=W;break}}L||(L=z.find(W=>{const D={left:W.left,top:W.top,right:W.left+P.width,bottom:W.top+P.height};return D.left>=0&&D.right<=S&&D.top>=0&&D.bottom<=A})||z[0]),L.left+P.width>S&&(L.left=S-P.width-O),L.top+P.height>A&&(L.top=A-P.height-O),L.left<0&&(L.left=O),L.top<0&&(L.top=O),m({left:L.left,top:L.top,position:"fixed",opacity:1,transition:"opacity 150ms ease-in-out"})}}else m({opacity:0,pointerEvents:"none"})},[e,t]);const v=P=>{P.stopPropagation(),!P.target.closest("button")&&(P.preventDefault(),P.currentTarget.setPointerCapture(P.pointerId),f.current={x:P.clientX-b.x,y:P.clientY-b.y},h.current=!0)},N=P=>{f.current&&x({x:P.clientX-f.current.x,y:P.clientY-f.current.y})},_=P=>{h.current=!1,f.current=null,P.currentTarget.releasePointerCapture(P.pointerId)},E=()=>{c&&(c(),o())},I=y.useMemo(()=>({tools:{items:[{type:"tool",id:"edit",title:d("quickadd.tool.edit"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})},{type:"tool",id:"cutter",title:d("quickadd.tool.cutter"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{type:"tool",id:"selection",title:d("quickadd.tool.selection"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"4 4",d:"M3.75 3.75h16.5v16.5H3.75z"})})}]},inputs:{items:[{type:"node",id:q.TEXT_INPUT,title:d("search.node.text_input.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 6h10M12 6v12"})})},{type:"node",id:q.IMAGE_INPUT,title:d("search.node.image_input.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{d:"M21 15l-5-5L5 21"})]})},{type:"node",id:q.MEDIA_VIEWER,title:d("search.node.media_viewer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})}]},processing:{items:[{type:"node",id:q.PROMPT_PROCESSOR,title:d("search.node.prompt_processor.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})},{type:"node",id:q.PROMPT_ANALYZER,title:d("search.node.prompt_analyzer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})},{type:"node",id:q.IMAGE_ANALYZER,title:d("search.node.image_analyzer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12.792V5.25a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 5.25v13.5A2.25 2.25 0 005.25 21h7.55"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 18.375L21 21"})]})}]},character:{items:[{type:"node",id:q.CHARACTER_GENERATOR,title:d("search.node.character_generator.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})})},{type:"node",id:q.CHARACTER_ANALYZER,title:d("search.node.character_analyzer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})},{type:"node",id:q.CHARACTER_CARD,title:d("search.node.character_card.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 8a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5a7.5 7.5 0 0115 0"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.5a.75.75 0 00-.75.75v13.5c0 .414.336.75.75.75h16.5a.75.75 0 00.75-.75V5.25a.75.75 0 00-.75-.75H3.75z"})]})}]},outputs:{items:[{type:"node",id:q.IMAGE_OUTPUT,title:d("search.node.image_output.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})},{type:"node",id:q.IMAGE_EDITOR,title:d("search.node.image_editor.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]})},{type:"node",id:q.IMAGE_SEQUENCE_GENERATOR,title:d("search.node.image_sequence_generator.title").replace("Sequence","Seq.").replace("","."),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})})}]},ai:{items:[{type:"node",id:q.GEMINI_CHAT,title:d("search.node.gemini_chat.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{type:"node",id:q.TRANSLATOR,title:d("search.node.translator.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})},{type:"node",id:q.PROMPT_SANITIZER,title:d("search.node.prompt_sanitizer.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})}]},video:{items:[{type:"node",id:q.VIDEO_PROMPT_PROCESSOR,title:d("search.node.video_prompt_processor.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7l-2 4 4 2-4 2-2 4-2-4-4-2 4-2z"})]})},{type:"node",id:q.VIDEO_OUTPUT,title:d("search.node.video_output.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9A2.25 2.25 0 0013.5 5.25h-9A2.25 2.25 0 002.25 7.5v9A2.25 2.25 0 004.5 18.75z"})})},{type:"node",id:q.VIDEO_EDITOR,title:d("node.title.video_editor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})]})}]},scripts:{items:[{type:"node",id:q.SCRIPT_GENERATOR,title:d("search.node.script_generator.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})},{type:"node",id:q.SCRIPT_VIEWER,title:d("search.node.script_viewer.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 19.82a2.25 2.25 0 01-1.897 1.13l-2.685.8.8-2.685a2.25 2.25 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})}]},general:{items:[{type:"node",id:q.NOTE,title:d("search.node.note.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})},{type:"node",id:q.DATA_READER,title:d("search.node.data_reader.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})},{type:"node",id:q.PROMPT_SEQUENCE_EDITOR,title:d("search.node.prompt_sequence_editor.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z"})})}]}}),[d]),B=P=>{P.type==="tool"?a(P.id):P.type==="node"&&r(P.id),o()},M=Object.keys(I),G=M.slice(0,5),V=M.slice(5),j=P=>{const S=I[P];return n.jsxs("div",{children:[n.jsx("h3",{className:"text-xs text-gray-400 uppercase font-bold mb-1 px-1 select-none",children:d(`quickadd.group.${P}`)}),n.jsx("div",{className:"flex flex-wrap gap-1",children:S.items.map(A=>n.jsx(tT,{title:A.title,onClick:()=>B(A),isActive:A.type==="tool"&&A.id===i,children:A.icon},A.id))})]},P)};return n.jsxs("div",{ref:u,className:"fixed bg-gray-800 rounded-lg shadow-2xl p-2 flex flex-col w-auto z-[51]",style:{...p,transform:`translate(${b.x}px, ${b.y}px)`},onMouseDown:P=>P.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center justify-between px-1 pb-2 mb-1 border-b border-gray-700 cursor-move",onPointerDown:v,onPointerMove:N,onPointerUp:_,children:[n.jsx("span",{className:"text-sm font-bold text-gray-300 select-none",children:d("quickadd.title")}),n.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),children:[n.jsx("button",{onClick:P=>{P.stopPropagation(),l&&l()},className:`p-1 rounded hover:bg-white/10 transition-colors ${s?"text-accent":"text-gray-500 hover:text-gray-300"}`,onMouseDown:P=>P.stopPropagation(),children:n.jsx(Qp,{className:"h-4 w-4"})}),n.jsx("div",{className:`absolute top-full right-0 mt-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 opacity-0 pointer-events-none origin-top-right transform ${w?"opacity-100 scale-100":"scale-90"}`,role:"tooltip",children:s?"Unpin menu":"Pin menu to screen"})]})]}),n.jsxs("div",{className:"flex space-x-4 p-1",children:[n.jsx("div",{className:"flex flex-col space-y-3",children:G.map(j)}),n.jsx("div",{className:"flex flex-col space-y-3",children:V.map(j)})]}),c&&n.jsx("div",{className:"mt-2 pt-2 border-t border-gray-700",children:n.jsxs("button",{onClick:E,className:"w-full flex items-center justify-center p-2 rounded-md bg-input hover:bg-accent text-gray-300 hover:text-white transition-colors gap-2 group",title:d("node.action.paste"),children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400 group-hover:text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),n.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:d("node.action.paste")})]})})]})},z0=150,q0=50,hi=400,oa=hi/2,oT=184,O0=116,rT=60,aT=({isOpen:e,position:t,onClose:o,onAddNode:r,onSelectItem:a})=>{const{t:i}=Pt(),[s,l]=y.useState(null),c=y.useMemo(()=>[{name:i("quickadd.group.inputs"),color:"bg-blue-600",textColor:"text-blue-400",options:[{type:q.TEXT_INPUT,title:i("search.node.text_input.title"),icon:n.jsx("span",{className:"font-bold text-xl leading-none",children:"[T]"}),hotkey:"T"},{type:q.IMAGE_INPUT,title:i("search.node.image_input.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:[n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{d:"M21 15l-5-5L5 21"})]}),hotkey:"I"},{type:q.MEDIA_VIEWER,title:i("search.node.media_viewer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),hotkey:"M"},{type:q.PROMPT_SEQUENCE_EDITOR,title:i("search.node.prompt_sequence_editor.title").replace("Sequence","Seq.").replace("","."),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z"})}),hotkey:"Q"}]},{name:i("quickadd.group.processing"),color:"bg-purple-600",textColor:"text-purple-400",options:[{type:q.IMAGE_ANALYZER,title:i("search.node.image_analyzer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12.792V5.25a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 5.25v13.5A2.25 2.25 0 005.25 21h7.55"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 18.375L21 21"})]}),hotkey:"Shift + A"},{type:q.PROMPT_ANALYZER,title:i("search.node.prompt_analyzer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]}),hotkey:"A"},{type:q.PROMPT_PROCESSOR,title:i("search.node.prompt_processor.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})}),hotkey:"P"}]},{name:i("quickadd.group.character"),color:"bg-pink-600",textColor:"text-pink-400",options:[{type:q.CHARACTER_GENERATOR,title:i("search.node.character_generator.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})}),hotkey:"Shift + C"},{type:q.CHARACTER_ANALYZER,title:i("search.node.character_analyzer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]}),hotkey:"Ctrl + Shift + A"},{type:q.CHARACTER_CARD,title:i("search.node.character_card.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 8a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5a7.5 7.5 0 0115 0"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.5a.75.75 0 00-.75.75v13.5c0 .414.336.75.75.75h16.5a.75.75 0 00.75-.75V5.25a.75.75 0 00-.75-.75H3.75z"})]}),hotkey:"Ctrl + Shift + C"}]},{name:i("quickadd.group.outputs"),color:"bg-teal-600",textColor:"text-teal-400",options:[{type:q.IMAGE_OUTPUT,title:i("search.node.image_output.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]}),hotkey:"O"},{type:q.IMAGE_EDITOR,title:i("search.node.image_editor.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]}),hotkey:"Shift + I"},{type:q.IMAGE_SEQUENCE_GENERATOR,title:i("search.node.image_sequence_generator.title").replace("Sequence","Seq.").replace("","."),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})}),hotkey:"Shift + Q"}]},{name:i("quickadd.group.ai"),color:"bg-green-600",textColor:"text-green-400",options:[{type:q.GEMINI_CHAT,title:i("search.node.gemini_chat.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),hotkey:"G"},{type:q.TRANSLATOR,title:i("search.node.translator.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})}),hotkey:"L"}]},{name:i("quickadd.group.scripts"),color:"bg-lime-600",textColor:"text-lime-400",options:[{type:q.SCRIPT_VIEWER,title:i("search.node.script_viewer.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 19.82a2.25 2.25 0 01-1.897 1.13l-2.685.8.8-2.685a2.25 2.25 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})}),hotkey:"Shift + V"}]},{name:i("quickadd.group.video"),color:"bg-red-600",textColor:"text-red-400",options:[{type:q.VIDEO_PROMPT_PROCESSOR,title:i("search.node.video_prompt_processor.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7l-2 4 4 2-4 2-2 4-2-4-4-2 4-2z"})]}),hotkey:"Shift + P"},{type:q.VIDEO_OUTPUT,title:i("search.node.video_output.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9A2.25 2.25 0 0013.5 5.25h-9A2.25 2.25 0 002.25 7.5v9A2.25 2.25 0 004.5 18.75z"})}),hotkey:"Shift + O"},{type:q.VIDEO_EDITOR,title:i("node.title.video_editor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})]}),hotkey:"E"}]}],[i]),d=y.useMemo(()=>c.flatMap(k=>k.options.map(b=>({...b,groupColor:k.color,textColor:k.textColor}))),[c]),u=2*Math.PI/d.length,p=y.useCallback((k,b)=>{const x=k-t.x,f=b-t.y;if(Math.sqrt(x*x+f*f)<rT){s!==null&&(l(null),a(null));return}let v=Math.atan2(f,x);v<0&&(v+=2*Math.PI);const N=d.length,_=2*Math.PI/N,E=Math.PI-_/2;let I=v-E;I<0&&(I+=2*Math.PI);const B=Math.floor(I/_)%N,M=d[B];(s==null?void 0:s.type)!==M.type&&(l(M),a(M.type))},[d,s,a,t.x,t.y]),m=y.useCallback(()=>{s?r(s.type):o()},[s,r,o]);y.useEffect(()=>{if(!e){l(null),a(null);return}const k=f=>{f.key==="Escape"&&o()},b=f=>{f.touches.length>0&&p(f.touches[0].clientX,f.touches[0].clientY)},x=()=>{m()};return window.addEventListener("keydown",k),window.addEventListener("touchmove",b),window.addEventListener("touchend",x),window.addEventListener("touchcancel",x),()=>{window.removeEventListener("keydown",k),window.removeEventListener("touchmove",b),window.removeEventListener("touchend",x),window.removeEventListener("touchcancel",x)}},[e,o,p,m,a]);const w=k=>{p(k.clientX,k.clientY)};return e?n.jsx("div",{className:"fixed inset-0 z-40",onMouseUp:()=>m(),onMouseMove:w,onMouseDown:k=>k.stopPropagation(),onContextMenu:k=>k.preventDefault(),children:n.jsxs("div",{className:"absolute pointer-events-none",style:{left:t.x,top:t.y},children:[n.jsxs("svg",{width:hi,height:hi,className:"absolute top-0 left-0 -translate-x-1/2 -translate-y-1/2",viewBox:`0 0 ${hi} ${hi}`,style:{filter:"drop-shadow(0 10px 15px rgba(0,0,0,0.1))"},children:[n.jsx("defs",{children:n.jsxs("mask",{id:"donut-mask",children:[n.jsx("rect",{width:"100%",height:"100%",fill:"white"}),n.jsx("circle",{cx:oa,cy:oa,r:O0,fill:"black"})]})}),n.jsx("circle",{cx:oa,cy:oa,r:oT,fill:"rgba(17, 24, 39, 0.85)",mask:"url(#donut-mask)",stroke:"rgb(75, 85, 99)",strokeWidth:"1"}),n.jsx("circle",{cx:oa,cy:oa,r:O0,fill:"none",stroke:"rgb(75, 85, 99)",strokeWidth:"1"})]}),n.jsxs("div",{className:"absolute top-0 left-0 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-center pointer-events-none w-48 h-48",children:[n.jsx("div",{className:`flex items-center justify-center w-20 h-20 rounded-lg mb-2 transition-all duration-200 ease-in-out shadow-lg border-2 border-white/10 ${s?`opacity-100 scale-100 ${s.groupColor}`:"opacity-0 scale-90"}`,children:s&&n.jsx("div",{className:"text-white",children:s.icon})}),n.jsxs("div",{className:"bg-gray-900/80 backdrop-blur-sm text-white px-4 py-2 rounded-lg text-center transition-opacity duration-200 flex flex-col items-center",style:{opacity:s?1:0},children:[n.jsx("span",{className:"text-sm font-semibold whitespace-nowrap",children:s==null?void 0:s.title}),(s==null?void 0:s.hotkey)&&n.jsx("span",{className:"text-xs text-gray-400 font-mono mt-0.5",children:s.hotkey})]})]}),d.map((k,b)=>{const x=u*b+Math.PI,f=z0*Math.cos(x),h=z0*Math.sin(x),v=(s==null?void 0:s.type)===k.type;return n.jsx("div",{className:`absolute flex items-center justify-center rounded-full transition-all duration-200 ease-in-out ${v?k.groupColor:""} ${v?"text-white":k.textColor}`,style:{width:q0,height:q0,top:0,left:0,transform:`translate(-50%, -50%) translate(${f}px, ${h}px) scale(${v?1.25:1})`,zIndex:v?10:1},children:k.icon},k.type)})]})}):null},Oo=({tooltip:e,tooltipPosition:t="top",children:o,className:r,onMouseDown:a,...i})=>{const[s,l]=y.useState(!1);return n.jsxs("button",{className:`relative ${r}`,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),onMouseDown:a,...i,children:[o,e&&n.jsx("div",{className:`absolute ${t==="top"?"bottom-full mb-2 origin-bottom":"top-full mt-2 origin-top"} left-1/2 -translate-x-1/2 px-2 py-1 bg-slate-700 text-slate-200 text-xs whitespace-nowrap rounded shadow-xl z-[70] pointer-events-none transition-all duration-100 ease-out transform ${s?"opacity-100 scale-100":"opacity-0 scale-90"}`,children:e})]})},As=e=>{switch(e){case"edit":return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})});case"cutter":return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});case"selection":return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"4 4",d:"M3.75 3.75h16.5v16.5H3.75z"})});case"reroute":return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})});default:return null}},My=e=>{if(!e)return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})});switch(e){case q.TEXT_INPUT:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 6h10M12 6v12"})});case q.IMAGE_INPUT:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{d:"M21 15l-5-5L5 21"})]});case q.MEDIA_VIEWER:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]});case q.PROMPT_SEQUENCE_EDITOR:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z"})});case q.PROMPT_PROCESSOR:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]});case q.PROMPT_ANALYZER:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]});case q.IMAGE_ANALYZER:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12.792V5.25a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 5.25v13.5A2.25 2.25 0 005.25 21h7.55"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 18.375L21 21"})]});case q.CHARACTER_GENERATOR:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})});case q.CHARACTER_ANALYZER:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]});case q.CHARACTER_CARD:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 8a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5a7.5 7.5 0 0115 0"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.5a.75.75 0 00-.75.75v13.5c0 .414.336.75.75.75h16.5a.75.75 0 00.75-.75V5.25a.75.75 0 00-.75-.75H3.75z"})]});case q.IMAGE_OUTPUT:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]});case q.IMAGE_EDITOR:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]});case q.IMAGE_SEQUENCE_GENERATOR:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})});case q.GEMINI_CHAT:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});case q.TRANSLATOR:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})});case q.PROMPT_SANITIZER:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})});case q.VIDEO_PROMPT_PROCESSOR:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7l-2 4 4 2-4 2-2 4-2-4-4-2 4-2z"})]});case q.VIDEO_OUTPUT:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9A2.25 2.25 0 0013.5 5.25h-9A2.25 2.25 0 002.25 7.5v9A2.25 2.25 0 004.5 18.75z"})});case q.SCRIPT_GENERATOR:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})});case q.SCRIPT_VIEWER:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 19.82a2.25 2.25 0 01-1.897 1.13l-2.685.8.8-2.685a2.25 2.25 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})});case q.NOTE:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})});case q.DATA_READER:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]});case q.VIDEO_EDITOR:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})]});default:return n.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-500"})}},Bu=(e,t)=>t(`search.node.${e.toLowerCase()}.title`)||e,iT=({onClose:e,slotIndex:t,onSelect:o,nodeGroups:r,t:a})=>{const[i,s]=y.useState(""),l=y.useRef(null);y.useEffect(()=>{l.current&&l.current.focus()},[]);const c=y.useMemo(()=>{if(!i)return r;const d={},u=i.toLowerCase();return Object.keys(r).forEach(p=>{const m=r[p].filter(w=>Bu(w,a).toLowerCase().includes(u));m.length>0&&(d[p]=m)}),d},[r,i,a]);return n.jsxs("div",{className:"absolute top-0 left-0 w-full max-h-[340px] bg-gray-900/95 backdrop-blur-md rounded-lg shadow-2xl border border-node-border flex flex-col overflow-hidden z-20",children:[n.jsxs("div",{className:"flex flex-col p-2 border-b border-node-border flex-shrink-0 bg-input/30",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("span",{className:"text-xs font-bold text-gray-300",children:["Assign Slot ",t+1]}),n.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414-1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),n.jsx("input",{ref:l,type:"text",placeholder:"Search...",className:"w-full bg-input text-xs text-gray-200 border border-node-border rounded px-2 py-1 focus:outline-none focus:border-accent",value:i,onChange:d=>s(d.target.value),onKeyDown:d=>d.stopPropagation()})]}),n.jsx("div",{className:"overflow-y-auto p-2 space-y-3 custom-scrollbar flex-grow",children:Object.keys(c).length>0?Object.keys(c).map(d=>n.jsxs("div",{children:[n.jsx("h4",{className:"text-[10px] uppercase font-bold text-gray-500 mb-1 px-1",children:a(`quickadd.group.${d}`)}),n.jsx("div",{className:"grid grid-cols-1 gap-1",children:c[d].map(u=>n.jsxs("button",{onClick:()=>o(u),className:"flex items-center space-x-2 p-2 rounded hover:bg-accent/30 text-left transition-colors group",children:[n.jsx("div",{className:"text-gray-400 group-hover:text-accent",children:My(u)}),n.jsx("span",{className:"text-xs text-gray-200 group-hover:text-white truncate",children:Bu(u,a)})]},u))})]},d)):n.jsx("div",{className:"p-2 text-xs text-gray-500 text-center",children:"No results found"})})]})},F0=280,B0=176,sT=({isOpen:e,position:t,onClose:o,onToolSelect:r,slots:a,onSlotUpdate:i,onSetSlots:s,onAddNode:l,isPinned:c,onPinToggle:d,zoom:u,onZoomChange:p,scaleToSliderValue:m,sliderValueToScale:w,onPaste:k})=>{const{t:b}=Pt(),[x,f]=y.useState(null),h=y.useRef(null),[v,N]=y.useState({opacity:0,pointerEvents:"none",transform:"scale(0.95)",transition:"opacity 0.15s ease-out, transform 0.15s ease-out"}),[_,E]=y.useState({x:0,y:0}),I=y.useRef(null),B=y.useRef(!1),M=y.useRef(null);y.useEffect(()=>{e?(f(null),E({x:0,y:0}),t.x,t.y,requestAnimationFrame(()=>{N({opacity:1,pointerEvents:"auto",transform:"scale(1)",transition:"opacity 0.15s ease-out, transform 0.15s ease-out"})})):N({opacity:0,pointerEvents:"none",transform:"scale(0.95)",transition:"opacity 0.1s ease-in, transform 0.1s ease-in"})},[e,t]),y.useEffect(()=>{const Z=se=>{h.current&&!h.current.contains(se.target)&&!B.current&&o()};return e&&!c&&window.addEventListener("mousedown",Z),()=>window.removeEventListener("mousedown",Z)},[e,o,c]);const G=Z=>{Z.preventDefault(),Z.stopPropagation(),Z.currentTarget.setPointerCapture(Z.pointerId),I.current={x:Z.clientX-_.x,y:Z.clientY-_.y},B.current=!0},V=Z=>{I.current&&E({x:Z.clientX-I.current.x,y:Z.clientY-I.current.y})},j=Z=>{B.current=!1,I.current=null,Z.currentTarget.releasePointerCapture(Z.pointerId)},P=Z=>{p&&w&&p(w(Number(Z.target.value)))},S=()=>{p&&p(1)},A=Z=>{r(Z),o()},O=()=>{k&&(k(),o())},z=(Z,se)=>{se.stopPropagation();const de=a[Z];de?(l(de),o()):f(Z)},L=(Z,se)=>{se.preventDefault(),se.stopPropagation(),f(Z)},W=Z=>{x!==null&&(i(x,Z),f(null))},D=()=>{const Z=JSON.stringify(a,null,2),se=new Blob([Z],{type:"application/json"}),de=URL.createObjectURL(se),re=document.createElement("a");re.href=de,re.download="prompt-modifier-slots.json",document.body.appendChild(re),re.click(),document.body.removeChild(re),URL.revokeObjectURL(de)},T=()=>{var Z;(Z=M.current)==null||Z.click()},F=Z=>{var re;const se=(re=Z.target.files)==null?void 0:re[0];if(!se)return;const de=new FileReader;de.onload=R=>{var J;try{const H=JSON.parse((J=R.target)==null?void 0:J.result);Array.isArray(H)&&H.length===8&&s?s(H):alert("Invalid slots file format")}catch(H){console.error(H),alert("Failed to load slots file")}M.current&&(M.current.value="")},de.readAsText(se)},te=y.useMemo(()=>({inputs:[q.TEXT_INPUT,q.IMAGE_INPUT,q.PROMPT_SEQUENCE_EDITOR,q.DATA_READER,q.NOTE,q.MEDIA_VIEWER],processing:[q.PROMPT_PROCESSOR,q.PROMPT_ANALYZER,q.IMAGE_ANALYZER,q.PROMPT_SANITIZER],character:[q.CHARACTER_GENERATOR,q.CHARACTER_ANALYZER,q.CHARACTER_CARD,q.POSE_CREATOR],outputs:[q.IMAGE_OUTPUT,q.IMAGE_EDITOR,q.IMAGE_SEQUENCE_GENERATOR],ai:[q.GEMINI_CHAT,q.TRANSLATOR],video:[q.VIDEO_PROMPT_PROCESSOR,q.VIDEO_OUTPUT,q.SCRIPT_GENERATOR,q.SCRIPT_VIEWER,q.VIDEO_EDITOR]}),[]);let $=t.x,Y=t.y;$+B0>window.innerWidth&&($=$-B0),Y+F0>window.innerHeight&&(Y=Y-F0);const oe=$+_.x,le=Y+_.y,K=m&&u?m(u):0,ie=Math.round((u||1)*100);return e?n.jsx("div",{ref:h,className:"fixed z-[60] w-44",style:{...v,left:oe,top:le},onMouseDown:Z=>Z.stopPropagation(),onWheel:Z=>Z.stopPropagation(),onContextMenu:Z=>Z.preventDefault(),children:n.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-2xl w-full relative z-10 flex flex-col",children:[n.jsxs("div",{className:"flex items-center justify-between px-2 py-2 cursor-move select-none border-b border-gray-700 rounded-t-lg",onPointerDown:G,onPointerMove:V,onPointerUp:j,children:[n.jsx("span",{className:"text-xs font-bold text-gray-400 pl-1",children:b("quickadd.group.tools")}),n.jsx(Oo,{onClick:Z=>{Z.stopPropagation(),d&&d()},onPointerDown:Z=>Z.stopPropagation(),onMouseDown:Z=>Z.stopPropagation(),className:`p-1 rounded hover:bg-white/10 transition-colors ${c?"text-accent":"text-gray-500 hover:text-gray-300"}`,tooltip:c?"Unpin menu":"Pin menu to screen",tooltipPosition:"bottom",children:n.jsx(Qp,{className:"h-4 w-4"})})]}),n.jsxs("div",{className:"p-2 grid grid-cols-4 gap-1",children:[n.jsx(Oo,{onClick:()=>A("edit"),className:"flex items-center justify-center rounded-md bg-input/50 text-gray-300 hover:bg-accent hover:text-white transition-colors h-9 w-9",tooltip:b("toolbar.edit"),children:As("edit")}),n.jsx(Oo,{onClick:()=>A("cutter"),className:"flex items-center justify-center rounded-md bg-input/50 text-gray-300 hover:bg-accent hover:text-white transition-colors h-9 w-9",tooltip:b("toolbar.cutter"),children:As("cutter")}),n.jsx(Oo,{onClick:()=>A("selection"),className:"flex items-center justify-center rounded-md bg-input/50 text-gray-300 hover:bg-accent hover:text-white transition-colors h-9 w-9",tooltip:b("toolbar.selection"),children:As("selection")}),n.jsx(Oo,{onClick:()=>A("reroute"),className:"flex items-center justify-center rounded-md bg-input/50 text-gray-300 hover:bg-accent hover:text-white transition-colors h-9 w-9",tooltip:b("toolbar.reroute"),children:As("reroute")})]}),n.jsx("div",{className:"h-px bg-gray-700 w-full"}),n.jsx("div",{className:"p-2 grid grid-cols-4 gap-1",children:a.map((Z,se)=>n.jsxs("div",{className:"relative group",onContextMenu:de=>L(se,de),onClick:de=>z(se,de),children:[n.jsx("button",{className:`w-9 h-9 rounded-md flex items-center justify-center border transition-colors ${Z?"bg-input/50 border-node-border text-gray-200 hover:bg-accent hover:text-white hover:border-accent":"bg-input/30 border-node-border border-dashed text-gray-600 hover:border-gray-500"}`,children:Z?My(Z):n.jsx("span",{className:"text-[10px] font-mono",children:se+1})}),n.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-slate-700 text-slate-200 text-xs whitespace-nowrap rounded shadow-xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-[70]",children:Z?Bu(Z,b):b("contextMenu.emptySlot")})]},se))}),x!==null&&n.jsx(iT,{onClose:()=>f(null),slotIndex:x,onSelect:W,nodeGroups:te,t:b}),n.jsx("div",{className:"h-px bg-gray-700 w-full"}),n.jsxs("div",{className:"p-2 space-y-2",children:[p&&w&&n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs(Oo,{onClick:S,className:"flex items-center space-x-1 px-1.5 py-1 rounded bg-input/50 hover:bg-white/10 text-gray-400 hover:text-white transition-colors border border-transparent hover:border-node-border",tooltip:b("toolbar.resetZoom"),children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),n.jsxs("span",{className:"text-[10px] font-mono min-w-[3ch] text-right",children:[ie,"%"]})]}),n.jsx("input",{type:"range",min:"-100",max:"100",step:"1",value:K,onChange:P,className:"w-full h-1.5 bg-node-border rounded-lg appearance-none cursor-pointer accent-accent"})]}),n.jsxs("div",{className:"flex justify-between items-center pt-1",children:[n.jsxs("div",{className:"flex space-x-1",children:[n.jsx(Oo,{onClick:D,className:"p-1.5 rounded bg-input hover:bg-white/10 text-gray-400 hover:text-white transition-colors",tooltip:b("contextMenu.saveSlots"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Oo,{onClick:T,className:"p-1.5 rounded bg-input hover:bg-white/10 text-gray-400 hover:text-white transition-colors",tooltip:b("contextMenu.loadSlots"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0l-4 4m4-4v12"})})}),n.jsx("input",{ref:M,type:"file",accept:".json",className:"hidden",onChange:F})]}),k&&n.jsxs(Oo,{onClick:O,className:"px-2 py-1 rounded bg-input hover:bg-accent text-gray-300 hover:text-white text-xs font-semibold flex items-center gap-1 transition-colors",tooltip:b("node.action.paste"),children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),b("node.action.paste")]})]})]})]})}):null},mn=({title:e,icon:t,onClick:o,disabled:r})=>{const[a,i]=y.useState(!1);return n.jsxs("div",{className:"relative flex items-center justify-center",onMouseEnter:()=>!r&&i(!0),onMouseLeave:()=>i(!1),children:[n.jsx("button",{onClick:s=>{s.stopPropagation(),r||o()},disabled:r,className:`group flex items-center justify-center p-2 text-sm rounded-md transition-colors ${r?"text-gray-600 cursor-not-allowed":"text-gray-200 hover:bg-accent hover:text-white"}`,children:n.jsx("div",{className:`${r?"text-gray-600":"text-gray-400 group-hover:text-white"}`,children:t})}),n.jsx("div",{className:`absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-xs whitespace-nowrap rounded-md shadow-xl z-[70] pointer-events-none transition-opacity duration-200 ease-in-out ${a?"opacity-100":"opacity-0"}`,children:e})]})},lT=({isOpen:e,position:t,onClose:o,onAlign:r})=>{const{t:a}=Pt(),i=y.useRef(null),s=Kt(),[l,c]=y.useState({opacity:0,pointerEvents:"none",transform:"scale(0.95)",transition:"opacity 0.15s ease-out, transform 0.15s ease-out"});if(y.useEffect(()=>{const h=v=>{i.current&&!i.current.contains(v.target)&&o()};return e&&window.addEventListener("mousedown",h),()=>window.removeEventListener("mousedown",h)},[e,o]),y.useEffect(()=>{if(e){let h=t.x,v=t.y;const N=240,_=100;h+N>window.innerWidth&&(h=h-N),v+_>window.innerHeight&&(v=v-_),requestAnimationFrame(()=>{c({left:h,top:v,opacity:1,pointerEvents:"auto",transform:"scale(1)",transition:"opacity 0.15s ease-out, transform 0.15s ease-out"})})}else c(h=>({...h,opacity:0,pointerEvents:"none",transform:"scale(0.95)"}))},[e,t]),!e&&l.opacity===0)return null;let d=!1,u=!1;if(s&&s.selectedNodeIds.length>0){d=s.selectedNodeIds.some(v=>{const N=s.nodes.find(_=>_.id===v);return N?Yl(N.type):!1});const h=s.nodes.filter(v=>s.selectedNodeIds.includes(v.id));h.length>0&&(u=h.every(v=>v.isCollapsed))}const p=h=>{r(h),o()},m=()=>{s&&s.undoPosition&&s.undoPosition(s.nodes)},w=()=>{s&&s.redoPosition&&s.redoPosition(s.nodes)},k=()=>{s&&s.selectedNodeIds.length>0&&(s.copyNodeValue(s.selectedNodeIds[s.selectedNodeIds.length-1]),o())},b=()=>{s&&(s.handlePaste(),o())},x=()=>{if(s){const h=!u;s.setNodes(v=>v.map(N=>s.selectedNodeIds.includes(N.id)?{...N,isCollapsed:h}:N)),o()}},f=h=>{s&&s.handleDockNode&&(s.selectedNodeIds.forEach(v=>s.handleDockNode(v,h)),o())};return n.jsxs("div",{ref:i,className:"fixed z-[70] bg-gray-800 rounded-lg shadow-2xl p-1 flex flex-col space-y-1",style:l,onContextMenu:h=>h.preventDefault(),onMouseDown:h=>h.stopPropagation(),children:[n.jsxs("div",{className:"flex flex-row space-x-1",children:[n.jsxs("div",{className:"flex items-center space-x-1 pr-1 border-r border-gray-600 mr-1",children:[n.jsx(mn,{title:a("contextMenu.undoPosition"),onClick:m,disabled:!(s!=null&&s.canUndo),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),n.jsx(mn,{title:a("contextMenu.redoPosition"),onClick:w,disabled:!(s!=null&&s.canRedo),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"})})})]}),n.jsx(mn,{title:a("contextMenu.align.left"),onClick:()=>p("left"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"4",width:"6",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"8",width:"8",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"12",width:"4",height:"2",fill:"currentColor",rx:"1"})]})}),n.jsx(mn,{title:a("contextMenu.align.centerX"),onClick:()=>p("center-x"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"7",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1",opacity:"0.5"}),n.jsx("rect",{x:"3",y:"4",width:"10",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"8",width:"6",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"2",y:"12",width:"12",height:"2",fill:"currentColor",rx:"1"})]})}),n.jsx(mn,{title:a("contextMenu.align.right"),onClick:()=>p("right"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"12",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"4",width:"6",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"3",y:"8",width:"8",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"7",y:"12",width:"4",height:"2",fill:"currentColor",rx:"1"})]})}),n.jsx("div",{className:"w-px bg-gray-600 my-1 mx-1"}),n.jsx(mn,{title:a("contextMenu.align.top"),onClick:()=>p("top"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"4",y:"5",width:"2",height:"6",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"8",y:"5",width:"2",height:"8",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"5",width:"2",height:"4",fill:"currentColor",rx:"1"})]})}),n.jsx(mn,{title:a("contextMenu.align.centerY"),onClick:()=>p("center-y"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"7",width:"12",height:"2",fill:"currentColor",rx:"1",opacity:"0.5"}),n.jsx("rect",{x:"4",y:"3",width:"2",height:"10",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"8",y:"5",width:"2",height:"6",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"})]})}),n.jsx(mn,{title:a("contextMenu.align.bottom"),onClick:()=>p("bottom"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"12",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"4",y:"5",width:"2",height:"6",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"8",y:"3",width:"2",height:"8",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"7",width:"2",height:"4",fill:"currentColor",rx:"1"})]})}),n.jsx("div",{className:"w-px bg-gray-600 my-1 mx-1"}),n.jsx(mn,{title:a("contextMenu.distribute.horizontal"),onClick:()=>p("distribute-horizontal"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"7",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"})]})}),n.jsx(mn,{title:a("contextMenu.distribute.vertical"),onClick:()=>p("distribute-vertical"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"2",y:"7",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"2",y:"12",width:"12",height:"2",fill:"currentColor",rx:"1"})]})})]}),n.jsx("div",{className:"h-px bg-gray-600 w-full my-1"}),n.jsxs("div",{className:"flex flex-row space-x-1 justify-center",children:[n.jsx(mn,{title:a("node.action.copy"),onClick:k,icon:n.jsx(zt,{className:"h-4 w-4"})}),n.jsx(mn,{title:a("node.action.paste"),onClick:b,icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),n.jsx(mn,{title:a(u?"image_sequence.expand_all":"image_sequence.collapse_all"),onClick:x,icon:u?n.jsx(my,{}):n.jsx(gy,{})}),n.jsx("div",{className:"w-px bg-gray-600 my-1 mx-1"}),!d&&n.jsxs(n.Fragment,{children:[n.jsx(mn,{title:a("toolbar.dock.q1"),onClick:()=>f("q1"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"1",y:"2",width:"3",height:"12",fill:"currentColor",opacity:"0.8"}),n.jsx("rect",{x:"0.5",y:"1.5",width:"15",height:"13",rx:"1.5",stroke:"currentColor",strokeOpacity:"0.3"})]})}),n.jsx(mn,{title:a("toolbar.dock.q2"),onClick:()=>f("q2"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"4.5",y:"2",width:"3",height:"12",fill:"currentColor",opacity:"0.8"}),n.jsx("rect",{x:"0.5",y:"1.5",width:"15",height:"13",rx:"1.5",stroke:"currentColor",strokeOpacity:"0.3"})]})})]}),n.jsx(mn,{title:a("toolbar.dock.left"),onClick:()=>f("left"),icon:n.jsx(Cy,{className:"h-4 w-4"})}),n.jsx(mn,{title:a("toolbar.dock.right"),onClick:()=>f("right"),icon:n.jsx(ky,{className:"h-4 w-4"})}),!d&&n.jsxs(n.Fragment,{children:[n.jsx(mn,{title:a("toolbar.dock.q3"),onClick:()=>f("q3"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"8.5",y:"2",width:"3",height:"12",fill:"currentColor",opacity:"0.8"}),n.jsx("rect",{x:"0.5",y:"1.5",width:"15",height:"13",rx:"1.5",stroke:"currentColor",strokeOpacity:"0.3"})]})}),n.jsx(mn,{title:a("toolbar.dock.q4"),onClick:()=>f("q4"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"12",y:"2",width:"3",height:"12",fill:"currentColor",opacity:"0.8"}),n.jsx("rect",{x:"0.5",y:"1.5",width:"15",height:"13",rx:"1.5",stroke:"currentColor",strokeOpacity:"0.3"})]})})]})]})]})},cT=({isOpen:e,info:t,onClose:o,onSelect:r})=>{const{t:a}=Pt(),i=y.useRef(null),[s,l]=y.useState({opacity:0,pointerEvents:"none"}),c=y.useMemo(()=>({text:[{type:q.PROMPT_ANALYZER,title:a("toolbar.addPromptAnalyzer"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})},{type:q.PROMPT_PROCESSOR,title:a("toolbar.addPromptProcessor"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})},{type:q.VIDEO_PROMPT_PROCESSOR,title:a("toolbar.addVideoPromptProcessor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7l-2 4 4 2-4 2-2 4-2-4-4-2 4-2z"})]})},{type:q.TRANSLATOR,title:a("toolbar.addTranslator"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})},{type:q.IMAGE_OUTPUT,title:a("toolbar.addImageOutput"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})},{type:q.IMAGE_EDITOR,title:a("toolbar.addImageEditor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-6 w-6",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]})},{type:q.REROUTE_DOT,title:a("node.title.reroute_dot"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})},{type:q.DATA_READER,title:a("toolbar.addDataReader"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}],image:[{type:q.IMAGE_ANALYZER,title:a("toolbar.addImageAnalyzer"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12.792V5.25a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 5.25v13.5A2.25 2.25 0 005.25 21h7.55"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 18.375L21 21"})]})},{type:q.IMAGE_EDITOR,title:a("toolbar.addImageEditor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-6 w-6",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]})},{type:q.REROUTE_DOT,title:a("node.title.reroute_dot"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})},{type:q.DATA_READER,title:a("toolbar.addDataReader"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}],video:[{type:q.VIDEO_EDITOR,title:a("node.title.video_editor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})]})},{type:q.REROUTE_DOT,title:a("node.title.reroute_dot"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})},{type:q.DATA_READER,title:a("toolbar.addDataReader"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}],audio:[{type:q.VIDEO_EDITOR,title:a("node.title.video_editor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})]})},{type:q.REROUTE_DOT,title:a("node.title.reroute_dot"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})},{type:q.DATA_READER,title:a("toolbar.addDataReader"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}],character_data:[{type:q.IMAGE_SEQUENCE_GENERATOR,title:a("toolbar.addImageSequenceGenerator"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})})},{type:q.REROUTE_DOT,title:a("node.title.reroute_dot"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})},{type:q.DATA_READER,title:a("toolbar.addDataReader"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}],prompt_sequence:[{type:q.IMAGE_SEQUENCE_GENERATOR,title:a("toolbar.addImageSequenceGenerator"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})})},{type:q.DATA_READER,title:a("toolbar.addDataReader"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})},{type:q.REROUTE_DOT,title:a("node.title.reroute_dot"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})}]}),[a]),d=y.useMemo(()=>t?t.sourceNodeType===q.PROMPT_SEQUENCE_EDITOR?c.prompt_sequence:(t.connectingInfo.fromType?c[t.connectingInfo.fromType]:[])||[]:[],[t,c]);return y.useEffect(()=>{const u=m=>{i.current&&!i.current.contains(m.target)&&o()},p=m=>{const w=parseInt(m.key);if(!isNaN(w)&&w>0&&w<=9){const k=w-1;d[k]&&(m.preventDefault(),m.stopPropagation(),r(d[k].type))}else m.key==="Escape"&&o()};return e&&(document.addEventListener("mousedown",u),window.addEventListener("keydown",p)),()=>{document.removeEventListener("mousedown",u),window.removeEventListener("keydown",p)}},[e,o,d,r]),y.useEffect(()=>{if(e&&i.current&&t){const{position:u}=t;if(d.length===0){o();return}const p=i.current.getBoundingClientRect();let m=u.x+10,w=u.y+10;m+p.width>window.innerWidth&&(m=u.x-p.width-10),w+p.height>window.innerHeight&&(w=u.y-p.height-10),l({left:Math.max(0,m),top:Math.max(0,w),position:"fixed",opacity:1,transition:"opacity 150ms ease-in-out"})}else e||l({opacity:0,pointerEvents:"none"})},[e,t,d,o]),n.jsx("div",{ref:i,className:"fixed bg-gray-800 rounded-lg shadow-2xl p-2 flex flex-col space-y-1 z-50",style:s,onMouseDown:u=>u.stopPropagation(),children:d.map((u,p)=>n.jsxs("button",{onClick:()=>r(u.type),className:"flex items-center space-x-3 p-2 rounded-md text-left w-full text-gray-200 hover:bg-accent hover:text-white transition-colors group",children:[n.jsxs("span",{className:"text-xs font-mono font-bold text-gray-500 group-hover:text-white w-4 text-right",children:[p+1,"."]}),n.jsx("div",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center",children:u.icon}),n.jsx("span",{className:"text-sm font-semibold",children:u.title})]},u.type))})},dT=({isOpen:e,initialValue:t,onConfirm:o,onClose:r,title:a,label:i,confirmButtonText:s,cancelButtonText:l,deselectAllNodes:c})=>{const{t:d}=Pt(),[u,p]=y.useState(t),m=y.useRef(null),[w,k]=y.useState(!1),[b,x]=y.useState(a),[f,h]=y.useState(i);y.useEffect(()=>{if(e)p(t),x(a),h(i),k(!0),setTimeout(()=>{var _,E;(_=m.current)==null||_.focus(),(E=m.current)==null||E.select()},100);else{const _=setTimeout(()=>k(!1),300);return()=>clearTimeout(_)}},[e,t,a,i]);const v=()=>{u.trim()&&o(u.trim()),r()},N=_=>{_.key==="Enter"?v():_.key==="Escape"&&r()};return!e&&!w?null:n.jsx("div",{className:`fixed inset-0 bg-black/60 z-[200] flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300 ease-in-out ${e?"opacity-100":"opacity-0"}`,onMouseDown:r,children:n.jsxs("div",{className:`bg-gray-800 border border-gray-700 rounded-xl shadow-2xl w-full max-w-sm flex flex-col select-none transform transition-all duration-300 ease-in-out ${e?"opacity-100 scale-100":"opacity-0 scale-95"}`,onMouseDown:_=>_.stopPropagation(),onKeyDown:N,children:[n.jsx("div",{className:"px-6 py-4 border-b border-gray-700 bg-[#18202f] rounded-t-xl",children:n.jsx("h2",{className:"text-lg font-bold text-accent-text",children:b||d("dialog.rename.title")})}),n.jsxs("div",{className:"p-6 space-y-4",children:[n.jsx("label",{htmlFor:"rename-input",className:"block text-sm font-medium text-gray-400",children:f||d("dialog.rename.label")}),n.jsx("input",{id:"rename-input",ref:m,type:"text",value:u,onChange:_=>p(_.target.value),onBlur:v,className:"w-full px-3 py-2 bg-gray-900 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent transition-colors",onFocus:c})]}),n.jsxs("div",{className:"px-6 py-4 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-900 rounded-b-xl",children:[n.jsx("button",{onClick:r,className:"px-4 py-2 font-semibold text-gray-400 bg-gray-800 hover:bg-gray-700 hover:text-white rounded-lg transition-colors border border-gray-600",children:l||d("dialog.rename.cancel")}),n.jsx("button",{onClick:v,className:"px-4 py-2 font-bold text-white bg-accent rounded-lg hover:bg-accent-hover transition-colors shadow-lg shadow-accent/20",children:s||d("dialog.rename.confirm")})]})]})})},uT=({isOpen:e,onAllow:t,onDecline:o})=>{const{t:r}=Pt(),[a,i]=y.useState(!1);return y.useEffect(()=>{if(e)i(!0);else{const s=setTimeout(()=>i(!1),300);return()=>clearTimeout(s)}},[e]),!e&&!a?null:n.jsx("div",{className:`fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300 ease-in-out ${e?"opacity-100":"opacity-0"}`,children:n.jsxs("div",{className:`bg-gray-800 border border-gray-700 rounded-xl shadow-2xl w-full max-w-md flex flex-col select-none transform transition-all duration-300 ease-in-out ${e?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:[n.jsx("div",{className:"px-6 py-4 border-b border-gray-700 bg-[#18202f] rounded-t-xl",children:n.jsx("h2",{className:"text-lg font-bold text-accent-text",children:r("dialog.permission.title")})}),n.jsx("div",{className:"p-6 space-y-4",children:n.jsx("p",{className:"text-sm text-gray-400 leading-relaxed",children:r("dialog.permission.description")})}),n.jsxs("div",{className:"px-6 py-4 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-900 rounded-b-xl",children:[n.jsx("button",{onClick:o,className:"px-4 py-2 font-semibold text-gray-400 bg-gray-800 hover:bg-gray-700 hover:text-white rounded-lg transition-colors border border-gray-600",children:r("dialog.permission.decline")}),n.jsx("button",{onClick:t,className:"px-4 py-2 font-bold text-white bg-accent rounded-lg hover:bg-accent-hover transition-colors shadow-lg shadow-accent/20",children:r("dialog.permission.allow")})]})]})})},pT=({isOpen:e,onConfirm:t,onClose:o,title:r,message:a})=>{const{t:i}=Pt(),[s,l]=y.useState(!1),[c,d]=y.useState(r),[u,p]=y.useState(a);y.useEffect(()=>{if(e)l(!0),d(r),p(a);else{const k=setTimeout(()=>l(!1),300);return()=>clearTimeout(k)}},[e,r,a]);const m=()=>{t(),o()},w=k=>{k.key==="Enter"?m():k.key==="Escape"&&o()};return!e&&!s?null:n.jsx("div",{className:`fixed inset-0 bg-black/60 z-[200] flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300 ease-in-out ${e?"opacity-100":"opacity-0"}`,onMouseDown:o,children:n.jsxs("div",{className:`bg-gray-800 border border-gray-700 rounded-xl shadow-2xl w-full max-w-sm flex flex-col select-none transform transition-all duration-300 ease-in-out ${e?"opacity-100 scale-100":"opacity-0 scale-95"}`,onMouseDown:k=>k.stopPropagation(),onKeyDown:w,children:[n.jsx("div",{className:"px-6 py-4 border-b border-gray-700 bg-[#18202f] rounded-t-xl",children:n.jsx("h2",{className:"text-lg font-bold text-accent-text",children:c})}),n.jsx("div",{className:"p-6 space-y-4",children:n.jsx("p",{className:"text-sm text-gray-400 leading-relaxed",children:u})}),n.jsxs("div",{className:"px-6 py-4 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-900 rounded-b-xl",children:[n.jsx("button",{onClick:o,className:"px-4 py-2 font-semibold text-gray-400 bg-gray-800 hover:bg-gray-700 hover:text-white rounded-lg transition-colors border border-gray-600",children:i("dialog.confirmDelete.cancel")}),n.jsx("button",{onClick:m,className:"px-4 py-2 font-bold text-white bg-accent rounded-lg hover:bg-accent-hover transition-colors shadow-lg shadow-accent/20",children:i("dialog.confirmDelete.confirm")})]})]})})},H0="promptEditDialogPosition",hT=({isOpen:e,initialName:t,initialContent:o,onConfirm:r,onClose:a,deselectAllNodes:i})=>{const{t:s}=Pt(),[l,c]=y.useState(t),[d,u]=y.useState(o),p=y.useRef(null),[m,w]=y.useState(!1),[k,b]=y.useState({x:0,y:0}),x=y.useRef(null),f=y.useRef(!1);y.useEffect(()=>{if(e){const I=localStorage.getItem(H0);if(I)try{b(JSON.parse(I))}catch{b({x:window.innerWidth/2-280,y:window.innerHeight/2-200})}else b({x:window.innerWidth/2-280,y:window.innerHeight/2-200});c(t),u(o),w(!0),setTimeout(()=>{var B;return(B=p.current)==null?void 0:B.focus()},100)}else{const I=setTimeout(()=>w(!1),300);return()=>clearTimeout(I)}},[e,t,o]);const h=()=>{l.trim()&&r(l.trim(),d)},v=I=>{I.key==="Escape"&&a()},N=I=>{I.preventDefault(),I.stopPropagation(),f.current=!0,x.current={x:I.clientX-k.x,y:I.clientY-k.y},I.currentTarget.setPointerCapture(I.pointerId)},_=I=>{!f.current||!x.current||(I.preventDefault(),I.stopPropagation(),b({x:I.clientX-x.current.x,y:I.clientY-x.current.y}))},E=I=>{f.current=!1,x.current=null,I.currentTarget.releasePointerCapture(I.pointerId),localStorage.setItem(H0,JSON.stringify(k))};return!e&&!m?null:n.jsx("div",{className:`fixed inset-0 z-[300] pointer-events-none transition-opacity duration-300 ease-in-out ${e?"opacity-100":"opacity-0"}`,children:n.jsxs("div",{className:`absolute bg-gray-800 border border-gray-700 rounded-xl shadow-2xl w-full max-w-[560px] flex flex-col select-none transform transition-transform duration-300 ease-in-out pointer-events-auto ${e?"scale-100":"scale-95"}`,style:{left:k.x,top:k.y,maxWidth:"560px",maxHeight:"90vh"},onMouseDown:I=>I.stopPropagation(),onKeyDown:v,children:[n.jsx("div",{className:"px-6 py-4 border-b border-gray-700 bg-[#18202f] rounded-t-xl cursor-move",onPointerDown:N,onPointerMove:_,onPointerUp:E,children:n.jsx("h2",{className:"text-lg font-bold text-accent-text pointer-events-none",children:s("dialog.promptEdit.title")})}),n.jsxs("div",{className:"p-6 space-y-4 bg-gray-800",children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"prompt-name-input",className:"block text-sm font-medium text-gray-400 mb-2",children:s("dialog.promptEdit.nameLabel")}),n.jsx("input",{id:"prompt-name-input",ref:p,type:"text",value:l,onChange:I=>c(I.target.value),className:"w-full px-3 py-2 bg-gray-900 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent transition-colors",onFocus:i})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"prompt-content-input",className:"block text-sm font-medium text-gray-400 mb-2",children:s("dialog.promptEdit.contentLabel")}),n.jsx("textarea",{id:"prompt-content-input",value:d,onChange:I=>u(I.target.value),className:"w-full h-40 px-3 py-2 bg-gray-900 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent resize-none custom-scrollbar",onWheel:I=>I.stopPropagation(),onFocus:i})]})]}),n.jsxs("div",{className:"px-6 py-4 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-900 rounded-b-xl",children:[n.jsx("button",{onClick:a,className:"px-4 py-2 font-semibold text-gray-400 bg-gray-800 hover:bg-gray-700 hover:text-white rounded-lg transition-colors border border-gray-600",children:s("dialog.promptEdit.cancel")}),n.jsx("button",{onClick:h,className:"px-4 py-2 font-bold text-white bg-accent rounded-lg hover:bg-accent-hover transition-colors shadow-lg shadow-accent/20",children:s("dialog.promptEdit.confirm")})]})]})})},dn=({title:e,onClick:t,children:o,disabled:r=!1,className:a})=>{const[i,s]=y.useState(!1);return n.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>!r&&s(!0),onMouseLeave:()=>s(!1),children:[n.jsx("button",{onClick:t,onMouseDown:l=>l.stopPropagation(),"aria-label":e,disabled:r,className:`p-2 text-gray-300 rounded-full hover:bg-gray-600 hover:text-white transition-colors duration-150 focus:outline-none focus:ring-1 focus:ring-cyan-500 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent ${a||""}`,children:o}),n.jsx("div",{className:`absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-lg shadow-xl z-50 transition-all duration-200 ease-out origin-bottom transform ${i?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,role:"tooltip",children:e})]})},jo=({title:e,children:t})=>{const[o,r]=y.useState(!1);return n.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[t,n.jsx("div",{className:`absolute top-full left-1/2 -translate-x-1/2 mt-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-lg shadow-xl z-50 transition-all duration-200 ease-out origin-top transform ${o?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,role:"tooltip",children:e})]})},mT=({item:e,onAddToCanvas:t,onNavigate:o,onRename:r,onSave:a,onDelete:i,draggedItem:s,onDragStart:l,onDragEnd:c,onMoveItem:d,isDragOver:u,setIsDragOver:p,onUpload:m,onDeleteFromDrive:w})=>{const{t:k}=Pt(),b=e.type===Oa.FOLDER,x=b?()=>o(e.id):()=>{},f=N=>{l(),e.type===Oa.GROUP&&(N.dataTransfer.setData("application/prompt-modifier-drag-item",JSON.stringify({type:"catalog-group",itemId:e.id})),N.dataTransfer.effectAllowed="copyMove")},h=N=>{b&&s&&s.tab==="groups"&&s.id!==e.id&&(N.preventDefault(),p(!0))},v=N=>{b&&(N.preventDefault(),N.stopPropagation(),p(!1),d(e.id))};return n.jsxs("div",{draggable:!0,onDragStart:f,onDragEnd:c,onDragOver:h,onDragLeave:()=>p(!1),onDrop:v,className:`bg-gray-700 rounded-lg p-4 flex flex-col items-center justify-between space-y-3 border border-gray-600 hover:border-cyan-500 transition-all duration-200 transform hover:-translate-y-1 ${u?"ring-2 ring-cyan-400":""}`,children:[n.jsxs("div",{className:"relative w-24 h-20 mx-auto mb-2 group",onClick:x,style:{cursor:b?"pointer":"default"},children:[n.jsx("div",{className:`absolute w-full h-full ${b?"group-hover:scale-110":""} bg-gray-800 rounded-lg flex items-center justify-center shadow-lg transition-transform`,children:b?n.jsx(ac,{}):n.jsx(SP,{})}),e.driveFileId&&n.jsx("div",{className:"absolute top-0 right-0 bg-blue-600/80 p-0.5 rounded-bl-md z-10 shadow-sm pointer-events-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-3 h-3 text-white",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"})})})]}),n.jsx("p",{className:"font-semibold text-gray-100 text-center break-all w-full truncate",title:e.name,children:e.name}),n.jsxs("div",{className:"flex justify-center space-x-1 w-full pt-2 border-t border-gray-600/50",children:[!b&&n.jsx(dn,{title:k("catalog.card.addToCanvas"),onClick:()=>t(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(dn,{title:k("catalog.card.rename"),onClick:()=>r(e.id,e.name),children:n.jsx(th,{})}),n.jsx(dn,{title:k("catalog.card.save"),onClick:()=>a(e.id),children:n.jsx(nh,{})}),m&&n.jsx(dn,{title:"Upload to Drive",onClick:()=>m(e),children:n.jsx(rc,{className:"h-5 w-5 text-blue-400"})}),w&&e.driveFileId&&n.jsx(dn,{title:"Delete from Drive",onClick:()=>w(e),className:"text-red-300 hover:text-red-100 hover:bg-red-900/30",children:n.jsxs("div",{className:"relative w-5 h-5",children:[n.jsx(Vr,{}),n.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:n.jsx("div",{className:"w-0.5 h-6 bg-red-500 rotate-45 transform origin-center absolute"})})]})}),n.jsx(dn,{title:k("catalog.card.delete"),onClick:()=>i(e.id),children:n.jsx(Vr,{})})]})]})},gT=({item:e,onNavigate:t,onEdit:o,onRename:r,onSave:a,onDelete:i,draggedItem:s,onDragStart:l,onDragEnd:c,onMoveItem:d,isDragOver:u,setIsDragOver:p,onUpload:m,onDeleteFromDrive:w})=>{const{t:k}=Pt(),b=e.type===$t.FOLDER,x=()=>{e.content&&navigator.clipboard.writeText(e.content).catch(_=>console.error("Copy failed",_))},f=b?()=>t(e.id):()=>o(e),h=_=>{l(),_.dataTransfer.setData("application/prompt-modifier-drag-item",JSON.stringify({type:e.type===$t.FOLDER?"library-folder":"library-prompt",itemId:e.id})),_.dataTransfer.effectAllowed="copyMove"},v=_=>{b&&s&&s.tab==="library"&&s.id!==e.id&&(_.preventDefault(),p(!0))},N=_=>{b&&(_.preventDefault(),_.stopPropagation(),p(!1),d(e.id))};return n.jsxs("div",{draggable:!0,onDragStart:h,onDragEnd:c,onDragOver:v,onDragLeave:()=>p(!1),onDrop:N,className:`bg-gray-700 rounded-lg p-4 flex flex-col items-center justify-between space-y-3 border border-gray-600 hover:border-cyan-500 transition-all duration-200 transform hover:-translate-y-1 ${u?"ring-2 ring-cyan-400":""}`,children:[n.jsxs("div",{className:"relative w-24 h-20 mx-auto mb-2 group",onClick:f,style:{cursor:"pointer"},children:[n.jsx("div",{className:`absolute w-full h-full ${b?"group-hover:scale-110":""} bg-gray-800 rounded-lg flex items-center justify-center shadow-lg transition-transform`,children:b?n.jsx(ac,{}):n.jsx(NP,{})}),e.driveFileId&&n.jsx("div",{className:"absolute top-0 right-0 bg-blue-600/80 p-0.5 rounded-bl-md z-10 shadow-sm pointer-events-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-3 h-3 text-white",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"})})})]}),n.jsxs("div",{className:"text-center w-full min-h-[4rem]",children:[n.jsx("p",{className:"font-semibold text-gray-100 break-all w-full truncate",title:e.name,children:e.name}),!b&&n.jsx("p",{className:"text-xs text-gray-400 mt-1 line-clamp-2",children:e.content||k("library.emptyPrompt")})]}),n.jsxs("div",{className:"flex justify-center space-x-1 w-full pt-2 border-t border-gray-600/50",children:[!b&&n.jsx(dn,{title:k("library.actions.copy"),onClick:x,children:n.jsx(zt,{className:"h-5 w-5"})}),b&&n.jsx(dn,{title:k("catalog.card.rename"),onClick:()=>r(e.id,e.name),children:n.jsx(th,{})}),n.jsx(dn,{title:k("catalog.card.save"),onClick:()=>a(e),children:n.jsx(nh,{})}),m&&n.jsx(dn,{title:"Upload to Drive",onClick:()=>m(e),children:n.jsx(rc,{className:"h-5 w-5 text-blue-400"})}),w&&e.driveFileId&&n.jsx(dn,{title:"Delete from Drive",onClick:()=>w(e),className:"text-red-300 hover:text-red-100 hover:bg-red-900/30",children:n.jsxs("div",{className:"relative w-5 h-5",children:[n.jsx(Vr,{}),n.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:n.jsx("div",{className:"w-0.5 h-6 bg-red-500 rotate-45 transform origin-center absolute"})})]})}),n.jsx(dn,{title:k("catalog.card.delete"),onClick:()=>i(e.id),children:n.jsx(Vr,{})})]})]})},fT=({item:e,dragItemType:t,onNavigate:o,onRename:r,onSave:a,onDelete:i,draggedItem:s,onDragStart:l,onDragEnd:c,onMoveItem:d,isDragOver:u,setIsDragOver:p,t:m,onUpload:w,onDeleteFromDrive:k})=>{const b=e.type===Jn.FOLDER,x=b?()=>o(e.id):()=>{},f=y.useMemo(()=>{if(!b&&e.content)try{const E=JSON.parse(e.content);if(E.image&&typeof E.image=="string"&&E.image.startsWith("data:"))return E.image;if(E.imageBase64&&typeof E.imageBase64=="string")return`data:image/png;base64,${E.imageBase64}`;if(E.imageSources&&E.imageSources["1:1"])return E.imageSources["1:1"]}catch{}return null},[e.content,b]),h=E=>{l();const I={itemId:e.id,type:b?"content-catalog-folder":"content-catalog-item",itemType:t,content:e.content};E.dataTransfer.setData("application/prompt-modifier-drag-item",JSON.stringify(I)),E.dataTransfer.effectAllowed="copyMove"},v=E=>{b&&s&&s.tab===t&&s.id!==e.id&&(E.preventDefault(),p(!0))},N=E=>{b&&(E.preventDefault(),E.stopPropagation(),p(!1),d(e.id))},_=y.useMemo(()=>{if(b)return n.jsx(ac,{});if(f)return n.jsx("img",{src:f,alt:e.name,className:"w-full h-full object-cover rounded"});switch(t){case"CHARACTER":return n.jsx(EP,{});case"SCRIPT":return n.jsx(PP,{});case"PROMPT_SEQUENCE":return n.jsx(jP,{});default:return null}},[b,t,f]);return n.jsxs("div",{draggable:!0,onDragStart:h,onDragEnd:c,onDragOver:v,onDragLeave:()=>p(!1),onDrop:N,className:`bg-gray-700 rounded-lg p-4 flex flex-col items-center justify-between space-y-3 border border-gray-600 hover:border-cyan-500 transition-all duration-200 transform hover:-translate-y-1 ${u?"ring-2 ring-cyan-400":""}`,children:[n.jsxs("div",{className:"relative w-24 h-20 mx-auto mb-2 group",onClick:x,style:{cursor:b?"pointer":"default"},children:[n.jsx("div",{className:`absolute w-full h-full ${b?"group-hover:scale-110":""} bg-gray-800 rounded-lg flex items-center justify-center shadow-lg transition-transform overflow-hidden`,children:_}),e.driveFileId&&n.jsx("div",{className:"absolute top-0 right-0 bg-blue-600/80 p-0.5 rounded-bl-md z-10 shadow-sm pointer-events-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-3 h-3 text-white",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"})})})]}),n.jsx("p",{className:"font-semibold text-gray-100 text-center break-all w-full truncate",title:e.name,children:e.name}),n.jsxs("div",{className:"flex justify-center space-x-1 w-full pt-2 border-t border-gray-600/50",children:[n.jsx(dn,{title:m("catalog.card.rename"),onClick:()=>r(e.id,e.name),children:n.jsx(th,{})}),n.jsx(dn,{title:m("catalog.card.save"),onClick:()=>a(e.id),children:n.jsx(nh,{})}),w&&n.jsx(dn,{title:"Upload to Drive",onClick:()=>w(e),children:n.jsx(rc,{className:"h-5 w-5 text-blue-400"})}),k&&e.driveFileId&&n.jsx(dn,{title:"Delete from Drive",onClick:()=>k(e),className:"text-red-300 hover:text-red-100 hover:bg-red-900/30",children:n.jsxs("div",{className:"relative w-5 h-5",children:[n.jsx(Vr,{}),n.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:n.jsx("div",{className:"w-0.5 h-6 bg-red-500 rotate-45 transform origin-center absolute"})})]})}),n.jsx(dn,{title:m("catalog.card.delete"),onClick:()=>i(e.id),children:n.jsx(Vr,{})})]})]})},xd=({catalog:e,draggedItem:t,setDraggedItem:o,dragOverTarget:r,setDragOverTarget:a,dragItemType:i,onRenameItem:s,t:l,onUpload:c,onDeleteFromDrive:d,onClearCloudFolder:u})=>{const m={CHARACTER:"characters",SCRIPT:"scripts",PROMPT_SEQUENCE:"sequences"}[i];return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"p-3 border-b border-gray-700 flex items-center justify-between space-x-2 flex-shrink-0",children:[n.jsxs("div",{className:"flex items-center space-x-1 min-w-0",children:[n.jsx("div",{className:`rounded-full transition-colors ${r===`back-${i}`?"ring-2 ring-cyan-500 ring-offset-2 ring-offset-gray-800":""}`,onDragOver:w=>{(t==null?void 0:t.tab)===i&&e.path.length>1&&(w.preventDefault(),a(`back-${i}`))},onDragLeave:()=>a(null),onDrop:w=>{if(w.preventDefault(),w.stopPropagation(),a(null),!t||t.tab!==i||e.path.length<=1)return;const k=e.path[e.path.length-2].id;e.moveItem(t.id,k)},children:n.jsx(dn,{title:l("catalog.back"),onClick:e.navigateBack,disabled:e.path.length<=1,children:n.jsx(Ru,{})})}),n.jsx("div",{className:"flex items-center text-sm text-gray-400 truncate",children:e.path.map((w,k)=>n.jsxs(At.Fragment,{children:[n.jsx("span",{onClick:()=>e.navigateToFolder(w.id),className:"px-1 hover:text-white cursor-pointer truncate",children:w.name}),k<e.path.length-1&&n.jsx("span",{className:"px-1 select-none",children:"/"})]},w.id||"root"))})]}),n.jsxs("div",{className:"flex space-x-2 flex-shrink-0",children:[n.jsx(jo,{title:l("catalog.newFolder"),children:n.jsxs("button",{onClick:()=>e.createItem(Jn.FOLDER,l("library.actions.newFolder")),className:"px-3 py-2 text-sm font-semibold bg-gray-600 hover:bg-gray-500 rounded-md flex items-center space-x-2",children:[n.jsx(Mu,{className:"h-5 w-5"}),n.jsx("span",{className:"hidden md:inline",children:l("library.actions.newFolder")})]})}),n.jsx(jo,{title:l("catalog.load"),children:n.jsxs("button",{onClick:e.triggerLoadFromFile,className:"px-3 py-2 text-sm font-semibold bg-teal-600 hover:bg-teal-700 rounded-md flex items-center space-x-2",children:[n.jsx(Lu,{className:"h-5 w-5"}),n.jsx("span",{className:"hidden md:inline",children:l("library.loadFromFile")})]})}),u&&n.jsx(jo,{title:l("catalog.clearCloudCategory"),children:n.jsxs("button",{onClick:()=>{confirm("Are you sure you want to delete all files in this cloud folder? This cannot be undone.")&&u(m)},className:"px-3 py-2 text-sm font-semibold bg-gray-700 hover:bg-red-600 text-gray-200 hover:text-white rounded-md flex items-center space-x-2 border border-gray-600 hover:border-red-500 transition-colors",children:[n.jsx("div",{className:"relative w-5 h-5",children:n.jsx(Du,{className:"h-5 w-5"})}),n.jsx("span",{className:"hidden md:inline",children:"Clear Cloud"})]})})]})]}),n.jsx("div",{className:"flex-grow overflow-y-auto p-4",children:e.currentItems.length>0?n.jsx("div",{className:"grid grid-cols-3 gap-4",children:e.currentItems.map(w=>n.jsx(fT,{item:w,dragItemType:i,onNavigate:e.navigateToFolder,onRename:s,onSave:e.saveItemToDisk,onDelete:e.deleteItem,draggedItem:t,onDragStart:()=>o({id:w.id,tab:i}),onDragEnd:()=>{o(null),a(null)},onMoveItem:k=>e.moveItem(t.id,k),isDragOver:r===w.id,setIsDragOver:k=>a(k?w.id:null),t:l,onUpload:c?k=>c(k,m):void 0,onDeleteFromDrive:d?k=>d(k,m):void 0},w.id))}):n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),n.jsx("p",{className:"font-semibold",children:l("library.empty.title")}),n.jsx("p",{className:"text-sm",children:l("catalog.empty.description")})]})})]})},xT=e=>{const{isOpen:t,onClose:o,currentCatalogItems:r,catalogPath:a,onCatalogNavigateBack:i,onCatalogNavigateToFolder:s,onCreateCatalogFolder:l,onAddGroupFromCatalog:c,onRenameCatalogItem:d,onSaveCatalogItem:u,onDeleteCatalogItem:p,onLoadCatalogItemFromFile:m,onMoveCatalogItem:w,libraryItems:k,libraryPath:b,onNavigateBack:x,onNavigateToFolder:f,onCreateLibraryItem:h,onEditLibraryItem:v,onRenameLibraryItem:N,onDeleteLibraryItem:_,onSaveLibraryItem:E,onLoadLibraryItemFromFile:I,onMoveLibraryItem:B,onRenameCharacter:M,onRenameScript:G,onRenameSequence:V,handleSyncCatalogs:j,isGoogleDriveReady:P,isSyncing:S,uploadCatalogItem:A,handleDeleteFromDrive:O,handleClearCloudFolder:z}=e,{t:L}=Pt(),[W,D]=y.useState("groups"),[T,F]=y.useState(null),[te,$]=y.useState(null),[Y,oe]=y.useState(null),le=y.useRef(null),K=y.useRef(null);y.useEffect(()=>{if(t&&!Y){const H=window.innerHeight*.8,U=(window.innerWidth-896)/2,ee=(window.innerHeight-H)/2;oe({x:Math.max(20,U),y:Math.max(20,ee)})}},[t]);const ie=J=>{J.preventDefault(),J.stopPropagation(),le.current={x:J.clientX,y:J.clientY},J.currentTarget.setPointerCapture(J.pointerId)},Z=J=>{if(le.current&&Y){const H=J.clientX-le.current.x,U=J.clientY-le.current.y;oe({x:Y.x+H,y:Y.y+U}),le.current={x:J.clientX,y:J.clientY}}},se=J=>{le.current=null,J.currentTarget.releasePointerCapture(J.pointerId)};if(!t)return null;const de=()=>{F(null),$(null)},re=()=>n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"p-3 border-b border-gray-700 flex items-center justify-between space-x-2 flex-shrink-0",children:[n.jsxs("div",{className:"flex items-center space-x-1 min-w-0",children:[n.jsx("div",{className:`rounded-full transition-colors ${te==="back-groups"?"ring-2 ring-cyan-500 ring-offset-2 ring-offset-gray-800":""}`,onDragOver:J=>{(T==null?void 0:T.tab)==="groups"&&a.length>1&&(J.preventDefault(),$("back-groups"))},onDragLeave:()=>$(null),onDrop:J=>{if(J.preventDefault(),J.stopPropagation(),$(null),!T||T.tab!=="groups"||a.length<=1)return;const H=a[a.length-2].id;w(T.id,H)},children:n.jsx(dn,{title:L("catalog.back"),onClick:i,disabled:a.length<=1,children:n.jsx(Ru,{})})}),n.jsx("div",{className:"flex items-center text-sm text-gray-400 truncate",children:a.map((J,H)=>n.jsxs(At.Fragment,{children:[n.jsx("span",{onClick:()=>s(J.id),className:"px-1 hover:text-white cursor-pointer truncate",children:J.name}),H<a.length-1&&n.jsx("span",{className:"px-1 select-none",children:"/"})]},J.id||"root"))})]}),n.jsxs("div",{className:"flex space-x-2 flex-shrink-0",children:[n.jsx(jo,{title:L("catalog.newFolder"),children:n.jsxs("button",{onClick:l,className:"px-3 py-2 text-sm font-semibold bg-gray-600 hover:bg-gray-500 rounded-md flex items-center space-x-2",children:[n.jsx(Mu,{className:"h-5 w-5"}),n.jsx("span",{className:"hidden md:inline",children:L("library.actions.newFolder")})]})}),n.jsx(jo,{title:L("catalog.load"),children:n.jsxs("button",{onClick:m,className:"px-3 py-2 text-sm font-semibold bg-teal-600 hover:bg-teal-700 rounded-md flex items-center space-x-2",children:[n.jsx(Lu,{className:"h-5 w-5"}),n.jsx("span",{className:"hidden md:inline",children:L("library.loadFromFile")})]})}),z&&n.jsx(jo,{title:L("catalog.clearCloudCategory"),children:n.jsxs("button",{onClick:()=>{confirm("Are you sure you want to delete all files in this cloud folder?")&&z("groups")},className:"px-3 py-2 text-sm font-semibold bg-gray-700 hover:bg-red-600 text-gray-200 hover:text-white rounded-md flex items-center space-x-2 border border-gray-600 hover:border-red-500 transition-colors",children:[n.jsx("div",{className:"relative w-5 h-5",children:n.jsx(Du,{className:"h-5 w-5"})}),n.jsx("span",{className:"hidden md:inline",children:"Clear Cloud"})]})})]})]}),n.jsx("div",{className:"flex-grow overflow-y-auto p-4",children:r.length>0?n.jsx("div",{className:"grid grid-cols-3 gap-4",children:r.map(J=>n.jsx(mT,{item:J,onAddToCanvas:c,onNavigate:H=>s(H),onRename:d,onSave:u,onDelete:p,draggedItem:T,onDragStart:()=>F({id:J.id,tab:"groups"}),onDragEnd:de,onMoveItem:H=>w(T.id,H),isDragOver:te===J.id,setIsDragOver:H=>$(H?J.id:null),onUpload:H=>A&&A(H,"groups"),onDeleteFromDrive:O?H=>O(H,"groups"):void 0},J.id))}):n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),n.jsx("p",{className:"font-semibold",children:L("library.empty.title")}),n.jsx("p",{className:"text-sm",children:L("catalog.empty.description")})]})})]}),R=()=>n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"p-3 border-b border-gray-700 flex items-center justify-between space-x-2 flex-shrink-0",children:[n.jsxs("div",{className:"flex items-center space-x-1 min-w-0",children:[n.jsx("div",{className:`rounded-full transition-colors ${te==="back-library"?"ring-2 ring-cyan-500 ring-offset-2 ring-offset-gray-800":""}`,onDragOver:J=>{(T==null?void 0:T.tab)==="library"&&b.length>1&&(J.preventDefault(),$("back-library"))},onDragLeave:()=>$(null),onDrop:J=>{if(J.preventDefault(),J.stopPropagation(),$(null),!T||T.tab!=="library"||b.length<=1)return;const H=b[b.length-2].id;B(T.id,H)},children:n.jsx(dn,{title:L("catalog.back"),onClick:x,disabled:b.length<=1,children:n.jsx(Ru,{})})}),n.jsx("div",{className:"flex items-center text-sm text-gray-400 truncate",children:b.map((J,H)=>n.jsxs(At.Fragment,{children:[n.jsx("span",{onClick:()=>f(J.id),className:"px-1 hover:text-white cursor-pointer truncate",children:J.name}),H<b.length-1&&n.jsx("span",{className:"px-1 select-none",children:"/"})]},J.id||"root"))})]}),n.jsxs("div",{className:"flex space-x-2 flex-shrink-0",children:[n.jsx(jo,{title:L("library.actions.newPrompt"),children:n.jsxs("button",{onClick:()=>h($t.PROMPT),className:"px-3 py-2 text-sm font-semibold bg-cyan-600 hover:bg-cyan-700 rounded-md flex items-center space-x-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),n.jsx("span",{className:"hidden md:inline",children:L("library.actions.newPrompt")})]})}),n.jsx(jo,{title:L("catalog.newFolder"),children:n.jsxs("button",{onClick:()=>h($t.FOLDER),className:"px-3 py-2 text-sm font-semibold bg-gray-600 hover:bg-gray-500 rounded-md flex items-center space-x-2",children:[n.jsx(Mu,{className:"h-5 w-5"}),n.jsx("span",{className:"hidden md:inline",children:L("library.actions.newFolder")})]})}),n.jsx(jo,{title:L("catalog.load"),children:n.jsxs("button",{onClick:I,className:"px-3 py-2 text-sm font-semibold bg-teal-600 hover:bg-teal-700 rounded-md flex items-center space-x-2",children:[n.jsx(Lu,{className:"h-5 w-5"}),n.jsx("span",{className:"hidden md:inline",children:L("library.loadFromFile")})]})}),z&&n.jsx(jo,{title:L("catalog.clearCloudCategory"),children:n.jsxs("button",{onClick:()=>{confirm("Are you sure you want to delete all files in this cloud folder?")&&z("library")},className:"px-3 py-2 text-sm font-semibold bg-gray-700 hover:bg-red-600 text-gray-200 hover:text-white rounded-md flex items-center space-x-2 border border-gray-600 hover:border-red-500 transition-colors",children:[n.jsx("div",{className:"relative w-5 h-5",children:n.jsx(Du,{className:"h-5 w-5"})}),n.jsx("span",{className:"hidden md:inline",children:"Clear Cloud"})]})})]})]}),n.jsx("div",{className:"flex-grow overflow-y-auto p-4",children:k.length>0?n.jsx("div",{className:"grid grid-cols-3 gap-4",children:k.map(J=>n.jsx(gT,{item:J,onNavigate:f,onEdit:v,onRename:N,onSave:E,onDelete:_,draggedItem:T,onDragStart:()=>F({id:J.id,tab:"library"}),onDragEnd:de,onMoveItem:H=>B(T.id,H),isDragOver:te===J.id,setIsDragOver:H=>$(H?J.id:null),onUpload:H=>A&&A(H,"library"),onDeleteFromDrive:O?H=>O(H,"library"):void 0},J.id))}):n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),n.jsx("p",{className:"font-semibold",children:L("library.empty.title")}),n.jsx("p",{className:"text-sm",children:L("library.empty.description")})]})})]});return n.jsx("div",{className:"fixed inset-0 z-50 pointer-events-none",children:n.jsxs("div",{ref:K,className:"pointer-events-auto fixed bg-gray-800 rounded-lg shadow-2xl w-full max-w-4xl border border-gray-700 flex flex-col h-[80vh] select-none",style:{left:Y?Y.x:"50%",top:Y?Y.y:"50%",transform:Y?"none":"translate(-50%, -50%)"},onMouseDown:J=>J.stopPropagation(),children:[n.jsxs("div",{className:"p-4 pb-0 border-b border-gray-700 flex justify-between items-center flex-shrink-0 cursor-move",onPointerDown:ie,onPointerMove:Z,onPointerUp:se,children:[n.jsxs("div",{className:"flex items-end space-x-4",onPointerDown:J=>J.stopPropagation(),children:[n.jsx("button",{onClick:()=>D("groups"),className:`px-4 py-2 text-lg font-bold ${W==="groups"?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-white"}`,children:L("catalog.tabs.groups")}),n.jsx("button",{onClick:()=>D("library"),className:`px-4 py-2 text-lg font-bold ${W==="library"?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-white"}`,children:L("catalog.tabs.library")}),n.jsx("button",{onClick:()=>D("characters"),className:`px-4 py-2 text-lg font-bold ${W==="characters"?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-white"}`,children:L("catalog.tabs.characters")}),n.jsx("button",{onClick:()=>D("scripts"),className:`px-4 py-2 text-lg font-bold ${W==="scripts"?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-white"}`,children:L("catalog.tabs.scripts")}),n.jsx("button",{onClick:()=>D("sequences"),className:`px-4 py-2 text-lg font-bold ${W==="sequences"?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-white"}`,children:L("catalog.tabs.sequences")})]}),n.jsxs("div",{className:"flex items-center gap-3",onPointerDown:J=>J.stopPropagation(),children:[j&&n.jsxs("button",{onClick:j,disabled:!P||S,className:`flex items-center gap-2 px-3 py-1.5 rounded-full border transition-colors ${S?"bg-gray-700 border-gray-600 text-gray-400 cursor-wait":"bg-blue-600/20 border-blue-500 text-blue-400 hover:bg-blue-600/30"}`,title:"Sync catalogs from Google Drive",children:[S?n.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx(CP,{className:"h-4 w-4"}),n.jsx("span",{className:"text-xs font-bold",children:"Sync Drive"})]}),n.jsx("button",{onClick:o,className:"p-1 text-gray-400 rounded hover:bg-gray-600 hover:text-white",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),W==="groups"&&re(),W==="library"&&R(),W==="characters"&&n.jsx(xd,{catalog:e.characterCatalog,dragItemType:"CHARACTER",onRenameItem:M,t:L,draggedItem:T,setDraggedItem:F,dragOverTarget:te,setDragOverTarget:$,onUpload:A,onDeleteFromDrive:O,onClearCloudFolder:z}),W==="scripts"&&n.jsx(xd,{catalog:e.scriptCatalog,dragItemType:"SCRIPT",onRenameItem:G,t:L,draggedItem:T,setDraggedItem:F,dragOverTarget:te,setDragOverTarget:$,onUpload:A,onDeleteFromDrive:O,onClearCloudFolder:z}),W==="sequences"&&n.jsx(xd,{catalog:e.sequenceCatalog,dragItemType:"PROMPT_SEQUENCE",onRenameItem:V,t:L,draggedItem:T,setDraggedItem:F,dragOverTarget:te,setDragOverTarget:$,onUpload:A,onDeleteFromDrive:O,onClearCloudFolder:z})]})})},yT=({isOpen:e,onSelectKey:t,onClose:o})=>{const{t:r}=Pt(),[a,i]=y.useState(!1);return y.useEffect(()=>{if(e)i(!0);else{const s=setTimeout(()=>i(!1),300);return()=>clearTimeout(s)}},[e]),!e&&!a?null:n.jsx("div",{className:`fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300 ease-in-out ${e?"opacity-100":"opacity-0"}`,onMouseDown:o,children:n.jsxs("div",{className:`bg-gray-800 border border-gray-700 rounded-xl shadow-2xl w-full max-w-md flex flex-col select-none transform transition-all duration-300 ease-in-out ${e?"opacity-100 scale-100":"opacity-0 scale-95"}`,onMouseDown:s=>s.stopPropagation(),children:[n.jsx("div",{className:"px-6 py-4 border-b border-gray-700 bg-[#18202f] rounded-t-xl",children:n.jsx("h2",{className:"text-lg font-bold text-accent-text",children:r("dialog.apiKey.title")})}),n.jsxs("div",{className:"p-6 space-y-4",children:[n.jsx("p",{className:"text-sm text-gray-400 leading-relaxed",children:r("dialog.apiKey.description")}),n.jsx("a",{href:"https://ai.google.dev/gemini-api/docs/billing",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-accent-text hover:text-accent-hover underline",children:r("dialog.apiKey.billingLink")})]}),n.jsxs("div",{className:"px-6 py-4 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-900 rounded-b-xl",children:[n.jsx("button",{onClick:o,className:"px-4 py-2 font-semibold text-gray-400 bg-gray-800 hover:bg-gray-700 hover:text-white rounded-lg transition-colors border border-gray-600",children:r("dialog.rename.cancel")}),n.jsx("button",{onClick:t,className:"px-4 py-2 font-bold text-white bg-accent rounded-lg hover:bg-accent-hover transition-colors shadow-lg shadow-accent/20",children:r("dialog.apiKey.button")})]})]})})},vT=({position:e,onConfirm:t,onCancel:o,count:r=1})=>{const{t:a}=Pt(),i=y.useRef(null),[s,l]=y.useState(!1),[c,d]=y.useState(e),u=y.useRef(null),p=y.useRef(!1);y.useEffect(()=>{const b=Math.min(Math.max(0,e.x),window.innerWidth-220),x=Math.min(Math.max(0,e.y),window.innerHeight-150);d({x:b,y:x})},[]),y.useEffect(()=>{const b=f=>{f.code==="Space"||f.code==="Enter"?(f.preventDefault(),f.stopPropagation(),t(s)):f.code==="KeyX"?(f.preventDefault(),f.stopPropagation(),t(!0)):f.code==="Escape"&&(f.preventDefault(),f.stopPropagation(),o())},x=f=>{p.current||i.current&&!i.current.contains(f.target)&&o()};return window.addEventListener("keydown",b,!0),document.addEventListener("mousedown",x),()=>{window.removeEventListener("keydown",b,!0),document.removeEventListener("mousedown",x)}},[t,o,s]);const m=b=>{b.stopPropagation();const x=b.target;x.closest("button")||x.closest(".checkbox-container")||b.button===0&&(p.current=!0,u.current={x:b.clientX-c.x,y:b.clientY-c.y},window.addEventListener("mousemove",w),window.addEventListener("mouseup",k))},w=b=>{!p.current||!u.current||d({x:b.clientX-u.current.x,y:b.clientY-u.current.y})},k=()=>{p.current=!1,u.current=null,window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",k)};return n.jsxs("div",{ref:i,className:"fixed z-[100] bg-gray-800/95 backdrop-blur-md shadow-2xl rounded-xl p-4 flex flex-col items-center justify-center space-y-4 select-none animate-fade-in-up min-w-[220px] cursor-move border border-gray-700/50",style:{left:c.x,top:c.y},onMouseDown:m,children:[n.jsx("span",{className:"text-sm font-semibold text-gray-200 whitespace-nowrap mt-1 pointer-events-none",children:r>1?a("dialog.deleteNode.titlePlural"):a("dialog.deleteNode.title")}),n.jsxs("div",{className:"flex items-center justify-center space-x-3 w-full pb-1",children:[n.jsxs("button",{onClick:b=>{b.stopPropagation(),t(s)},className:"flex flex-row items-center space-x-2 group focus:outline-none px-5 py-2 rounded-lg bg-transparent hover:bg-gray-700 transition-all",title:a("dialog.deleteNode.confirmTooltip"),onMouseDown:b=>b.stopPropagation(),children:[n.jsx("div",{className:"text-cyan-400 group-hover:text-white transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),n.jsx("span",{className:"text-xs text-gray-200 group-hover:text-white transition-colors uppercase font-bold tracking-wider",children:a("dialog.deleteNode.confirm")})]}),n.jsxs("button",{onClick:b=>{b.stopPropagation(),o()},className:"flex flex-row items-center space-x-2 group focus:outline-none px-5 py-2 rounded-lg bg-transparent hover:bg-gray-700 transition-all",title:a("dialog.deleteNode.cancelTooltip"),onMouseDown:b=>b.stopPropagation(),children:[n.jsx("div",{className:"text-gray-400 group-hover:text-white transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),n.jsx("span",{className:"text-xs text-gray-400 group-hover:text-white transition-colors uppercase font-bold tracking-wider",children:a("dialog.deleteNode.cancel")})]})]}),n.jsxs("div",{className:"flex items-center space-x-2 pt-2 border-t border-gray-700/50 w-full justify-center cursor-pointer checkbox-container",onClick:b=>{b.stopPropagation(),l(!s)},onMouseDown:b=>b.stopPropagation(),children:[n.jsx("div",{className:`w-4 h-4 rounded flex items-center justify-center transition-all duration-200 border ${s?"bg-cyan-600 border-cyan-600":"bg-gray-700/50 border-gray-600 hover:border-gray-500"}`,children:n.jsx("svg",{className:`w-3 h-3 text-white transition-transform duration-200 ${s?"scale-100":"scale-0"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),n.jsxs("label",{className:"text-xs text-gray-400 select-none cursor-pointer hover:text-gray-300 transition-colors",children:[a("dialog.deleteNode.dontShowAgain")," ",n.jsx("span",{className:"text-gray-500 font-mono ml-1 opacity-50",children:"(X)"})]})]})]})},G0="settingsDialogPosition",wT=({isOpen:e,onClose:t,addToast:o,setIsInstantCloseEnabled:r,anchorPosition:a})=>{const{t:i}=Pt(),s=Kt(),[l,c]=y.useState(!1),[d,u]=y.useState({x:0,y:0}),p=y.useRef({x:0,y:0}),m=y.useRef(!1),w=y.useRef(d),[k,b]=y.useState("");if(y.useEffect(()=>{w.current=d},[d]),y.useEffect(()=>{if(e){c(!0),b(window.location.origin);const me=localStorage.getItem(G0);if(me)try{const ke=JSON.parse(me);if(typeof ke.x=="number"&&typeof ke.y=="number"){u(ke);return}}catch{}if(a){let Me=a.x,De=a.y+10;Me+512>window.innerWidth&&(Me=window.innerWidth-512-20),De+650>window.innerHeight&&(De=window.innerHeight-650-20),Me<20&&(Me=20),u({x:Me,y:De})}else u({x:Math.max(0,window.innerWidth/2-256),y:Math.max(0,window.innerHeight/2-325)})}else{const me=setTimeout(()=>c(!1),200);return()=>clearTimeout(me)}},[e]),!s)return null;const{setNodeAnimationMode:x,nodeAnimationMode:f,googleClientId:h,setGoogleClientId:v,handleGoogleSignIn:N,isGoogleDriveReady:_,isGoogleDriveSaving:E,handleSyncCatalogs:I,handleCleanupDuplicates:B,currentTheme:M,setTheme:G,setConfirmInfo:V,loadCanvasState:j,resetTabs:P,setIsHoverHighlightEnabled:S,isHoverHighlightEnabled:A,isConnectionAnimationEnabled:O,setIsConnectionAnimationEnabled:z,connectionOpacity:L,setConnectionOpacity:W}=s,[D,T]=y.useState(""),[F,te]=y.useState(""),[$,Y]=y.useState(!0),[oe,le]=y.useState(!1),[K,ie]=y.useState(!0),[Z,se]=y.useState("pulse"),[de,re]=y.useState(""),R=!!window.electronAPI;y.useEffect(()=>{if(e){const me=localStorage.getItem("settings_userApiKey")||"",ke=localStorage.getItem("settings_useDevKey"),Re=localStorage.getItem("settings_instantNodeClose"),Me=localStorage.getItem("settings_nodeAnimationMode"),De=localStorage.getItem("settings_hoverHighlight"),Ie=localStorage.getItem("settings_downloadPath")||"",Ne=localStorage.getItem("settings_nodeAnimation");T(me),te(h||""),Y(ke===null?!0:ke==="true"),le(Re==="true"),ie(De===null?!0:De==="true"),re(Ie),se(Me||(Ne==="false"?"none":f||"pulse"))}},[e,f,h]);const J=me=>{const ke=me.target.value;T(ke),ke&&$&&Y(!1)},H=async()=>{if(window.electronAPI){const me=await window.electronAPI.selectFolder();me&&re(me)}},U=()=>{re("")},ee=()=>{localStorage.setItem("settings_userApiKey",D),localStorage.setItem("settings_useDevKey",String($)),localStorage.setItem("settings_instantNodeClose",String(oe)),localStorage.setItem("settings_nodeAnimationMode",Z),localStorage.setItem("settings_hoverHighlight",String(K)),localStorage.setItem("settings_downloadPath",de),window.electronAPI&&window.electronAPI.setDownloadPath(de),v&&F!==h&&v(F.trim()),r(oe),x&&x(Z),S&&S(K),o(i("toast.apiKeySaved"),"success"),t()},ae=()=>{V({title:i("dialog.reload.title"),message:i("dialog.reload.message"),onConfirm:()=>{j({nodes:[],connections:[],groups:[],viewTransform:{scale:1,translate:{x:0,y:0}},nodeIdCounter:1,fullSizeImageCache:{}}),P&&P("en"),setTimeout(()=>{window.location.reload()},100)}})},xe=F.trim()!==(h||""),ne=me=>{const ke=me.target;ke.closest("button")||ke.closest("input")||(me.preventDefault(),me.stopPropagation(),m.current=!0,p.current={x:me.clientX-d.x,y:me.clientY-d.y},me.currentTarget.setPointerCapture(me.pointerId))},X=me=>{m.current&&(me.preventDefault(),me.stopPropagation(),u({x:me.clientX-p.current.x,y:me.clientY-p.current.y}))},ue=me=>{m.current=!1,me.currentTarget.releasePointerCapture(me.pointerId),localStorage.setItem(G0,JSON.stringify(w.current))},Q=()=>{navigator.clipboard.writeText(k),o(i("toast.copiedToClipboard"),"success")};if(!e&&!l)return null;const ce=[{id:"cyan",color:"#06b6d4",label:"Cyan"},{id:"azure",color:"#0ea5e9",label:"Azure"},{id:"purple",color:"#9333ea",label:"Purple"},{id:"pink",color:"#ec4899",label:"Pink"},{id:"red",color:"#dc2626",label:"Red"},{id:"orange",color:"#f97316",label:"Orange"},{id:"lime",color:"#84cc16",label:"Lime"},{id:"emerald",color:"#10b981",label:"Emerald"},{id:"gray",color:"#71717a",label:"Gray"}],pe={pulse:"pulse","blade-runner":"bladeRunner",none:"none"};return n.jsx("div",{className:`fixed inset-0 z-[100] pointer-events-none transition-opacity duration-200 ease-out ${l&&e?"opacity-100":"opacity-0"}`,children:n.jsxs("div",{className:"absolute bg-gray-800 rounded-xl shadow-2xl w-full max-w-lg flex flex-col cursor-default max-h-[95vh] overflow-hidden pointer-events-auto border border-gray-700 transition-transform duration-200 ease-out",style:{left:d.x,top:d.y,transform:l&&e?"scale(1)":"scale(0.95)"},onMouseDown:me=>me.stopPropagation(),children:[n.jsxs("div",{className:"px-6 py-4 flex justify-between items-center bg-[#18202f] cursor-move border-b border-gray-600",onPointerDown:ne,onPointerMove:X,onPointerUp:ue,children:[n.jsxs("h2",{className:"text-xl font-bold text-accent-text flex items-center gap-2 pointer-events-none",children:[n.jsx(fy,{}),i("dialog.settings.title")]}),n.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors p-1 hover:bg-white/10 rounded-full",onPointerDown:me=>me.stopPropagation(),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),n.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto custom-scrollbar bg-gray-800",children:[n.jsx("p",{className:"text-sm text-gray-400 mb-2",children:i("dialog.settings.description")}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest border-b border-gray-700 pb-1 mb-2",children:i("settings.group.api")}),n.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg space-y-3",children:[n.jsxs("div",{className:"space-y-2 transition-opacity duration-200",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("label",{htmlFor:"apiKey",className:"block text-xs font-medium text-gray-400",children:i("dialog.settings.apiKeyLabel")}),n.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-xs text-cyan-400 hover:text-cyan-300 underline",children:i("dialog.settings.getKeyLink")})]}),n.jsx("input",{type:"password",id:"apiKey",value:D,onChange:J,placeholder:$?"Using Free/Dev Key":"AIzaSy...",className:`w-full p-2.5 rounded-md text-sm border focus:ring-1 focus:ring-accent focus:border-accent focus:outline-none placeholder-gray-600 transition-colors
                        ${$?"bg-gray-800 border-gray-700 text-gray-500":"bg-gray-900 border-gray-600 text-white"}
                      `})]}),n.jsx("div",{className:"pt-1",children:n.jsx(Ht,{id:"useDevKey",checked:$,onChange:me=>{Y(me)},label:i("dialog.settings.useDevKeyLabel"),className:"text-sm text-gray-400"})})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest border-b border-gray-700 pb-1 mb-2",children:i("settings.group.style")}),n.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400",children:i("settings.themeLabel")}),n.jsx(An,{value:M,onChange:me=>G(me),options:ce.map(me=>({value:me.id,label:me.label,icon:n.jsx("div",{className:"w-3 h-3 rounded-full border border-gray-500",style:{backgroundColor:me.color}})}))})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400",children:i("dialog.settings.animationModeLabel")}),n.jsx("div",{className:"flex bg-gray-800 rounded-md p-1 border border-gray-700",children:["pulse","blade-runner","none"].map(me=>n.jsx("button",{onClick:()=>se(me),className:`flex-1 py-1.5 text-xs font-medium rounded transition-colors ${Z===me?"bg-gray-700 text-white shadow-sm":"text-gray-500 hover:text-gray-300"}`,children:i(`dialog.settings.anim.${pe[me]||me}`)},me))})]}),n.jsxs("div",{className:"pt-1 flex flex-col gap-2",children:[n.jsx(Ht,{id:"instantNodeClose",checked:oe,onChange:me=>le(me),label:i("dialog.settings.instantNodeCloseLabel"),className:"text-sm text-gray-400"}),n.jsx(Ht,{id:"hoverHighlight",checked:K,onChange:me=>ie(me),label:i("dialog.settings.hoverHighlightLabel"),className:"text-sm text-gray-400"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400",children:i("dialog.settings.connectionsLabel")}),n.jsxs("div",{className:"flex flex-col gap-2 p-2 bg-gray-800 rounded-md border border-gray-700",children:[n.jsx(Ht,{id:"connectionAnimation",checked:O,onChange:me=>z(me),label:i("dialog.settings.connectionAnimationLabel"),className:"text-sm text-gray-300"}),n.jsxs("div",{className:"space-y-1 pt-1",children:[n.jsxs("div",{className:"flex justify-between text-xs text-gray-400",children:[n.jsx("span",{children:i("dialog.settings.connectionOpacityLabel")}),n.jsxs("span",{children:[Math.round(L*100),"%"]})]}),n.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:L,onChange:me=>W(parseFloat(me.target.value)),className:"w-full h-1.5 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-accent"})]})]})]}),R&&n.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-700/50",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400",children:i("dialog.settings.downloadPathLabel")}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("div",{className:"flex-grow bg-gray-800 border border-gray-700 rounded-md p-2 text-xs text-gray-300 truncate",title:de||"Default",children:de||n.jsx("span",{className:"text-gray-500 italic",children:"Downloads Folder (Default)"})}),n.jsx("button",{onClick:H,className:"p-2 bg-gray-700 hover:bg-gray-600 text-gray-300 hover:text-white rounded-md border border-gray-600",title:i("dialog.settings.selectFolder"),children:n.jsx(ac,{className:"w-4 h-4"})}),de&&n.jsx("button",{onClick:U,className:"p-2 bg-gray-700 hover:bg-red-900/30 text-gray-400 hover:text-red-400 rounded-md border border-gray-600 hover:border-red-800",title:i("dialog.settings.resetPath"),children:n.jsx(Vr,{className:"w-4 h-4"})})]})]})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("div",{className:"flex justify-between items-end border-b border-gray-700 pb-1 mb-2",children:n.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest",children:i("settings.group.drive")})}),n.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg space-y-4",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-500",children:"Detected Origin (For Google Cloud Console):"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("code",{className:"flex-grow bg-black/30 p-1.5 rounded text-[10px] text-gray-300 font-mono truncate border border-gray-700",children:k}),n.jsx("button",{onClick:Q,className:"p-1.5 text-gray-400 hover:text-white bg-gray-700 rounded hover:bg-gray-600",title:"Copy Origin",children:n.jsx(zt,{className:"h-3.5 w-3.5"})})]}),n.jsx("p",{className:"text-[10px] text-gray-600 italic",children:'Add this URL to "Authorized JavaScript origins" in your Google Cloud Project if Auth fails.'})]}),n.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-700/30",children:[n.jsx("label",{htmlFor:"googleClientId",className:"block text-xs font-medium text-gray-400",children:i("settings.googleClientIdLabel")}),n.jsx("input",{type:"text",id:"googleClientId",value:F,onChange:me=>te(me.target.value),placeholder:"Google Cloud Client ID",className:"w-full p-2.5 bg-gray-800 border border-gray-700 rounded-md text-white text-sm focus:ring-1 focus:ring-accent focus:border-accent focus:outline-none placeholder-gray-600"})]}),xe?n.jsxs("button",{onClick:()=>{v&&v(F.trim())},className:"w-full py-2 px-4 rounded-md text-sm font-bold text-white bg-emerald-600 hover:bg-emerald-700 transition-all flex items-center justify-center gap-2 shadow-md shadow-emerald-900/20",children:[n.jsx(l0,{className:"w-4 h-4"}),i("settings.updateId")]}):_?n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs("button",{onClick:()=>N&&N(),className:"w-full py-2 px-4 rounded-md text-sm font-bold text-white transition-all flex items-center justify-center gap-2 bg-gray-700 hover:bg-blue-600 shadow-md",children:[n.jsx(l0,{className:"w-4 h-4"}),i("settings.signInWithGoogle")]}),B&&n.jsx("button",{onClick:B,disabled:E,className:"w-full py-2 px-4 rounded-md text-sm font-bold text-white transition-all flex items-center justify-center gap-2 bg-gray-700 hover:bg-red-600 shadow-md",children:E?n.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("span",{className:"flex items-center gap-2",children:"Cleanup Duplicates in Cloud"})}),I&&n.jsxs("button",{onClick:I,disabled:E,className:"w-full py-2 px-4 rounded-md text-sm font-bold text-white transition-all flex items-center justify-center gap-2 bg-gray-700 hover:bg-teal-600 shadow-md",children:[E?n.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Sync Catalogs from Drive"]})]}):n.jsxs("button",{className:"w-full py-2 px-4 rounded-md text-sm font-bold text-gray-400 bg-gray-700 cursor-not-allowed flex items-center justify-center gap-2",disabled:!0,children:[n.jsxs("svg",{className:"animate-spin h-4 w-4 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),i("settings.connecting")]})]})]})]}),n.jsxs("div",{className:"p-4 bg-gray-900 border-t border-gray-700 flex justify-between items-center",children:[n.jsxs("button",{onClick:ae,className:"flex items-center gap-2 px-4 py-2 text-red-400 hover:text-red-300 hover:bg-red-900/30 rounded-lg transition-colors border border-transparent hover:border-red-900/50",title:i("dialog.settings.reload"),children:[n.jsx(xy,{}),n.jsx("span",{className:"text-sm font-bold",children:i("dialog.settings.reload")})]}),n.jsx("button",{onClick:ee,className:"px-6 py-2 bg-accent hover:bg-accent-hover text-white font-bold rounded-lg transition-all shadow-lg shadow-accent/40 transform hover:-translate-y-0.5 active:translate-y-0",children:i("dialog.settings.save")})]})]})})},bT=({isOpen:e,message:t,onClose:o})=>{const{t:r}=Pt(),[a,i]=y.useState(!1),[s,l]=y.useState(!1),[c,d]=y.useState(t);if(y.useEffect(()=>{if(e)l(!0),d(t),i(!1);else{const p=setTimeout(()=>l(!1),300);return()=>clearTimeout(p)}},[e,t]),y.useEffect(()=>{const p=m=>{m.key==="Escape"&&o()};return e&&window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[e,o]),!e&&!s)return null;const u=()=>{c&&(navigator.clipboard.writeText(c),i(!0),setTimeout(()=>i(!1),2e3))};return n.jsx("div",{className:`fixed top-20 left-1/2 -translate-x-1/2 z-[200] w-full max-w-lg px-4 pointer-events-none transition-all duration-300 ease-out transform ${e?"opacity-100 translate-y-0":"opacity-0 -translate-y-4"}`,children:n.jsxs("div",{className:"bg-[#20293c] bg-opacity-95 backdrop-blur-xl rounded-xl shadow-2xl flex flex-col pointer-events-auto overflow-hidden border border-gray-600/50",role:"alert",children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-black/20 border-b border-white/5 select-none",children:[n.jsxs("div",{className:"flex items-center space-x-2.5",children:[n.jsx("div",{className:"p-1.5 bg-accent/20 rounded-full text-accent-text",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("h2",{className:"text-sm font-bold text-accent-text tracking-wide",children:r("app.error.title")})]}),n.jsx("button",{onClick:o,className:"text-text-secondary hover:text-white transition-colors p-1 hover:bg-white/10 rounded-lg",title:"Close",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),n.jsx("div",{className:"p-5 max-h-[300px] overflow-y-auto custom-scrollbar",children:n.jsx("p",{className:"text-gray-300 text-sm whitespace-pre-wrap break-words leading-relaxed font-medium select-none",children:c})}),n.jsx("div",{className:"px-4 py-3 bg-black/20 border-t border-white/5 flex justify-end",children:n.jsx("button",{onClick:u,className:`px-4 py-2 text-xs font-bold rounded-lg transition-all duration-200 flex items-center gap-2 ${a?"bg-green-600/20 text-green-300":"bg-gray-700 hover:bg-gray-600 text-gray-300 hover:text-white"}`,children:a?n.jsxs(n.Fragment,{children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),r("app.error.copied")]}):n.jsxs(n.Fragment,{children:[n.jsx(zt,{className:"h-3.5 w-3.5"}),r("app.error.copy")]})})})]})})},CT=()=>{const e=Kt(),[t,o]=y.useState(!1),r=y.useRef(null);if(!e)return null;const{logs:a,isDebugConsoleOpen:i,setIsDebugConsoleOpen:s,clearLogs:l}=e;if(y.useEffect(()=>{i&&r.current&&(r.current.scrollTop=r.current.scrollHeight)},[a,i]),!i)return null;const c=d=>{const u=`[${new Date(d.timestamp).toLocaleTimeString()}] ${d.level.toUpperCase()}: ${d.message}
${d.details?JSON.stringify(d.details,null,2):""}`;navigator.clipboard.writeText(u)};return n.jsxs("div",{className:"fixed bottom-[100px] left-1/2 -translate-x-1/2 bg-gray-900 border border-gray-700 shadow-2xl rounded-t-lg flex flex-col z-[300] transition-all duration-300 w-full max-w-[1040px]",style:{height:t?"80vh":"300px"},children:[n.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-800 rounded-t-lg border-b border-gray-700 select-none cursor-pointer",onClick:()=>o(!t),children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"text-xs font-bold text-gray-300 uppercase tracking-widest flex items-center gap-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-accent-text",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"System Logs"]}),n.jsxs("span",{className:"text-[10px] bg-gray-700 px-1.5 rounded text-gray-400",children:[a.length," events"]})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{onClick:d=>{d.stopPropagation(),l()},className:"p-1 hover:bg-gray-700 rounded text-gray-400 hover:text-white",title:"Clear",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),n.jsx("button",{onClick:d=>{d.stopPropagation(),o(!t)},className:"p-1 hover:bg-gray-700 rounded text-gray-400 hover:text-white",title:t?"Collapse":"Expand",children:t?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),n.jsx("button",{onClick:d=>{d.stopPropagation(),s(!1)},className:"p-1 hover:bg-gray-700 rounded text-gray-400 hover:text-white",title:"Close",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),n.jsxs("div",{ref:r,className:"flex-grow overflow-y-auto p-2 font-mono text-xs bg-[#0d1117] custom-scrollbar space-y-1",children:[a.length===0&&n.jsx("div",{className:"text-gray-600 italic p-2 text-center",children:"No logs recorded."}),a.map(d=>n.jsxs("div",{className:`p-2 rounded border-l-2 ${d.level==="error"?"border-red-500 bg-red-900/10":d.level==="warning"?"border-yellow-500 bg-yellow-900/10":"border-blue-500 bg-blue-900/10"} hover:bg-gray-800/50 transition-colors group relative`,children:[n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsx("span",{className:"text-gray-500 shrink-0 mr-2",children:new Date(d.timestamp).toLocaleTimeString()}),n.jsxs("span",{className:`font-bold shrink-0 mr-2 ${d.level==="error"?"text-red-400":d.level==="warning"?"text-yellow-400":"text-blue-400"}`,children:["[",d.level.toUpperCase(),"]"]}),n.jsx("span",{className:"flex-grow text-gray-300 break-words whitespace-pre-wrap",children:d.message}),n.jsx("button",{onClick:()=>c(d),className:"opacity-0 group-hover:opacity-100 text-gray-500 hover:text-white transition-opacity ml-2",children:n.jsx(zt,{className:"h-3 w-3"})})]}),d.details&&n.jsx("div",{className:"mt-1 ml-16 text-gray-400 bg-black/30 p-2 rounded overflow-x-auto",children:n.jsx("pre",{children:JSON.stringify(d.details,null,2)})})]},d.id))]})]})},kT=()=>{const e=Kt(),[t,o]=At.useState(!1),[r,a]=At.useState(null);if(At.useEffect(()=>{const dt=_t=>{_t.detail&&a(_t.detail),o(!0)};return window.addEventListener("open-settings",dt),()=>window.removeEventListener("open-settings",dt)},[]),y.useEffect(()=>{(()=>{if(!localStorage.getItem("hasVisited"))return;const cn=localStorage.getItem("settings_useDevKey")==="true",It=localStorage.getItem("settings_userApiKey");!cn&&!It&&o(!0)})()},[]),!e)return null;const{isQuickSearchOpen:i,quickSearchPosition:s,handleCloseAddNodeMenus:l,onAddNode:c,getTransformedPoint:d,isQuickAddOpen:u,isQuickAddMenuPinned:p,quickAddPosition:m,effectiveTool:w,setActiveTool:k,toggleQuickAddMenuPin:b,isRadialMenuOpen:x,radialMenuPosition:f,setIsRadialMenuOpen:h,radialMenuSelectedItem:v,setRadialMenuSelectedItem:N,contextMenu:_,handleCloseContextMenu:E,quickSlots:I,updateQuickSlot:B,setAllQuickSlots:M,isContextMenuPinned:G,toggleContextMenuPin:V,viewTransform:j,handleZoomChange:P,scaleToSliderValue:S,sliderValueToScale:A,nodeContextMenu:O,handleCloseNodeContextMenu:z,handleAlignNodes:L,selectedNodeIds:W,isConnectionQuickAddOpen:D,connectionQuickAddInfo:T,handleCloseConnectionQuickAdd:F,handleAddNodeAndConnect:te,nodeDeleteConfirm:$,deleteNodeAndConnections:Y,setIsInstantCloseEnabled:oe,cancelDeleteNodes:le,renameInfo:K,confirmRename:ie,setRenameInfo:Z,deselectAllNodes:se,t:de,showDialog:re,requestPermission:R,declinePermission:J,confirmInfo:H,setConfirmInfo:U,promptEditInfo:ee,confirmPromptEdit:ae,setPromptEditInfo:xe,isCatalogOpen:ne,handleCloseCatalog:X,currentCatalogItems:ue,catalogPath:Q,navigateCatalogBack:ce,navigateCatalogToFolder:pe,createCatalogItem:me,handleAddGroupFromCatalog:ke,renameCatalogItem:Re,saveCatalogItemToDisk:Me,deleteCatalogItem:De,triggerLoadFromFile:Ie,moveCatalogItem:Ne,libraryItems:Pe,currentLibraryItems:ye,libraryPath:_e,navigateBack:Fe,navigateToFolder:We,createLibraryItem:Ze,setPromptEditInfo:$e,updateLibraryItem:He,deleteLibraryItem:be,saveLibraryItemToDisk:Ae,triggerLoadLibraryFromFile:Te,moveLibraryItem:qe,characterCatalog:Ye,scriptCatalog:nt,sequenceCatalog:Nt,onRenameCharacter:ze,onRenameScript:je,onRenameSequence:Le,isApiKeyDialogOpen:rt,handleApiKeySelect:Ce,handleApiKeyDialogClose:Se,addToast:he,handlePaste:ge,error:ve,setError:Ge,handleSyncCatalogs:Ve,isGoogleDriveReady:ot,isGoogleDriveSaving:Xe,uploadCatalogItem:pt,handleDeleteFromDrive:st,handleClearCloudFolder:ft}=e,it=dt=>{let _t=m;i&&(_t=s);const cn=d(_t);c(dt,cn),l()},wt=dt=>{const _t=d(f);c(dt,_t),h(!1),N(null)};return n.jsxs(n.Fragment,{children:[n.jsx(eT,{isOpen:i,position:s,onClose:l,onAddNode:dt=>{const _t=d(s);c(dt,_t),l()}}),n.jsx(nT,{isOpen:u||p,position:m,onClose:l,onAddNode:it,onToolChange:k,activeTool:w,isPinned:p,onPinToggle:b,onPaste:ge}),n.jsx(aT,{isOpen:x,position:f,onClose:()=>h(!1),onAddNode:wt,onSelectItem:N}),n.jsx(sT,{isOpen:!!(_!=null&&_.isOpen),position:(_==null?void 0:_.position)||{x:0,y:0},onClose:E,onToolSelect:k,slots:I,onSlotUpdate:B,onSetSlots:M,onAddNode:dt=>{const _t=d((_==null?void 0:_.position)||{x:0,y:0});c(dt,_t)},isPinned:G,onPinToggle:V,zoom:j.scale,onZoomChange:P,scaleToSliderValue:S,sliderValueToScale:A,onPaste:ge}),n.jsx(lT,{isOpen:!!(O!=null&&O.isOpen),position:(O==null?void 0:O.position)||{x:0,y:0},onClose:z,onAlign:dt=>L(W,dt)}),n.jsx(cT,{isOpen:D,info:T,onClose:F,onSelect:te}),$&&n.jsx(vT,{position:$.position,onConfirm:dt=>{$.nodeIds.forEach(_t=>Y(_t)),dt&&(localStorage.setItem("settings_instantNodeClose","true"),oe(!0)),le()},onCancel:le,count:$.nodeIds.length}),n.jsx(dT,{isOpen:!!K,initialValue:(K==null?void 0:K.currentTitle)||"",onConfirm:ie,onClose:()=>Z(null),title:(K==null?void 0:K.type)==="group"?de("dialog.rename.group.title"):(K==null?void 0:K.type)==="catalog"?de("dialog.rename.catalog.title"):(K==null?void 0:K.type)==="node"?de("dialog.rename.node.title"):de("dialog.rename.title"),deselectAllNodes:se}),n.jsx(uT,{isOpen:re,onAllow:R,onDecline:J}),n.jsx(pT,{isOpen:!!H,title:(H==null?void 0:H.title)||"",message:(H==null?void 0:H.message)||"",onConfirm:(H==null?void 0:H.onConfirm)||(()=>{}),onClose:()=>U(null)}),n.jsx(bT,{isOpen:!!ve,message:ve,onClose:()=>Ge(null)}),n.jsx(CT,{}),n.jsx(hT,{isOpen:!!ee,initialName:(ee==null?void 0:ee.name)||"",initialContent:(ee==null?void 0:ee.content)||"",onConfirm:ae,onClose:()=>xe(null),deselectAllNodes:se}),n.jsx(xT,{isOpen:ne,onClose:X,currentCatalogItems:ue,catalogPath:Q,onCatalogNavigateBack:ce,onCatalogNavigateToFolder:pe,onCreateCatalogFolder:()=>me(Oa.FOLDER),onAddGroupFromCatalog:dt=>ke(dt),onRenameCatalogItem:(dt,_t)=>Z({type:"catalog",id:dt,currentTitle:_t}),onSaveCatalogItem:Me,onDeleteCatalogItem:De,onLoadCatalogItemFromFile:Ie,onMoveCatalogItem:Ne,libraryItems:ye,libraryPath:_e,onNavigateBack:Fe,onNavigateToFolder:We,onCreateLibraryItem:Ze,onEditLibraryItem:xe,onRenameLibraryItem:(dt,_t)=>Z({type:"library",id:dt,currentTitle:_t}),onDeleteLibraryItem:be,onSaveLibraryItem:Ae,onLoadLibraryItemFromFile:Te,onMoveLibraryItem:qe,characterCatalog:Ye,scriptCatalog:nt,sequenceCatalog:Nt,onRenameCharacter:(dt,_t)=>Z({type:"character",id:dt,currentTitle:_t}),onRenameScript:(dt,_t)=>Z({type:"script",id:dt,currentTitle:_t}),onRenameSequence:(dt,_t)=>Z({type:"sequence",id:dt,currentTitle:_t}),handleSyncCatalogs:Ve,isGoogleDriveReady:ot,isSyncing:Xe,uploadCatalogItem:pt,handleDeleteFromDrive:st,handleClearCloudFolder:ft}),n.jsx(yT,{isOpen:rt,onSelectKey:Ce,onClose:Se}),n.jsx(wT,{isOpen:t,onClose:()=>o(!1),addToast:he,setIsInstantCloseEnabled:oe,anchorPosition:r})]})},_T=()=>{const[e,t]=y.useState(0),o=y.useRef(0),r=y.useRef(performance.now()),a=y.useRef(0);return y.useEffect(()=>{const i=()=>{const s=performance.now();o.current++,s>=r.current+1e3&&(t(o.current),o.current=0,r.current=s),a.current=requestAnimationFrame(i)};return a.current=requestAnimationFrame(i),()=>{cancelAnimationFrame(a.current)}},[]),e},ST=e=>{const t=Math.floor(e/1e3),o=Math.floor(e%1e3/10);return`${t}.${o.toString().padStart(2,"0")}s`},NT=()=>{const e=Kt(),t=_T(),[o,r]=y.useState(!1),{language:a}=Pt(),[i,s]=y.useState(0),[l,c]=y.useState(0),d=y.useRef(null),u=y.useRef(null),[p,m]=y.useState(null),[w,k]=y.useState(!1),b=y.useRef(!1);if(!e)return null;const{activeOperations:x,t:f,tutorialStep:h,skipTutorial:v,advanceTutorial:N,nextAutoSaveTime:_,isAutoSaving:E,logs:I,isDebugConsoleOpen:B,setIsDebugConsoleOpen:M}=e,G=Array.from(x.values()),V=G.length>0?G[G.length-1]:null,j=G.length>0,P=I.filter(O=>O.level==="error").length,S=h==="image_output_generating";y.useEffect(()=>{if(j){d.current===null&&(d.current=performance.now(),s(0));const O=()=>{d.current!==null&&(s(performance.now()-d.current),u.current=requestAnimationFrame(O))};u.current=requestAnimationFrame(O)}else{if(d.current!==null){const O=performance.now()-d.current;c(O),s(0),d.current=null}u.current&&(cancelAnimationFrame(u.current),u.current=null)}return()=>{u.current&&cancelAnimationFrame(u.current)}},[j]),y.useEffect(()=>{if(!_){m(null);return}const O=setInterval(()=>{const z=Date.now(),L=_-z;L>0&&L<=1e4?m(Math.ceil(L/1e3)):m(null)},200);return()=>clearInterval(O)},[_]),y.useEffect(()=>{if(b.current&&!E){k(!0);const O=setTimeout(()=>k(!1),2e3);return()=>clearTimeout(O)}b.current=E},[E]);const A=j?i:l;return n.jsx("div",{className:"fixed top-2 right-2 z-50 flex flex-col items-end pointer-events-none select-none",children:n.jsx(Bn,{content:f("tutorial.step3b"),isActive:!!S,position:"bottom",onSkip:v,onNext:N,children:n.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-md rounded-lg shadow-lg border border-gray-700 p-1 flex items-center space-x-2 pointer-events-auto transition-all duration-300",children:[!o&&n.jsxs(n.Fragment,{children:[n.jsx(mt,{content:"Debug Console",position:"bottom",children:n.jsxs("button",{onClick:()=>M(!B),className:`p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center relative ${B?"text-accent-text bg-gray-800":"text-gray-400 hover:text-white hover:bg-gray-800"}`,children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),P>0&&!B&&n.jsxs("span",{className:"absolute top-1 right-1 flex h-2 w-2",children:[n.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),n.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-red-500"})]})]})}),n.jsx("div",{className:"w-px h-8 bg-gray-700 mx-1"}),n.jsx("div",{className:"flex items-center space-x-3 px-2 min-w-[140px]",children:V?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"relative flex h-3 w-3 flex-shrink-0",children:[n.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-accent opacity-75"}),n.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-accent"})]}),n.jsxs("div",{className:"flex flex-col leading-tight min-w-0",children:[n.jsx("span",{className:"text-[10px] font-bold text-accent-text uppercase tracking-wider truncate",children:"Processing"}),n.jsx("span",{className:"text-xs text-gray-300 whitespace-nowrap truncate max-w-[150px]",title:V.description,children:V.description})]})]}):E?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"relative flex h-3.5 w-3.5 flex-shrink-0 text-accent-text animate-pulse",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-full h-full",children:n.jsx("path",{fillRule:"evenodd",d:"M19.5 21a3 3 0 003-3V9a3 3 0 00-3-3h-5.379a.75.75 0 01-.53-.22L11.47 3.66A2.25 2.25 0 009.879 3H4.5a3 3 0 00-3 3v12a3 3 0 003 3h15zm-6.75-10.5a.75.75 0 00-1.5 0v4.19l-1.72-1.72a.75.75 0 00-1.06 1.06l3 3a.75.75 0 001.06 0l3-3a.75.75 0 10-1.06-1.06l-1.72 1.72V10.5z",clipRule:"evenodd"})})}),n.jsxs("div",{className:"flex flex-col leading-tight",children:[n.jsx("span",{className:"text-[10px] font-bold text-accent-text uppercase tracking-wider",children:"System"}),n.jsx("span",{className:"text-xs text-accent-text",children:"Saving..."})]})]}):w?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"relative flex h-3.5 w-3.5 flex-shrink-0 text-accent-text",children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-full h-full",children:[n.jsx("path",{d:"M11.47 3.84a.75.75 0 011.06 0l8.635 8.635a.75.75 0 11-1.06 1.06l-8.635-8.635a.75.75 0 010-1.06z"}),n.jsx("path",{d:"M19.5 21a3 3 0 003-3V9a3 3 0 00-3-3h-5.379a.75.75 0 01-.53-.22L11.47 3.66A2.25 2.25 0 009.879 3H4.5a3 3 0 00-3 3v12a3 3 0 003 3h15z",opacity:"0.5"}),n.jsx("path",{fillRule:"evenodd",d:"M19.916 4.626a.75.75 0 01.208 1.04l-9 13.5a.75.75 0 01-1.154.114l-6-6a.75.75 0 011.06-1.06l5.353 5.353 8.493-12.739a.75.75 0 011.04-.208z",clipRule:"evenodd"})]})}),n.jsxs("div",{className:"flex flex-col leading-tight",children:[n.jsx("span",{className:"text-[10px] font-bold text-accent-text uppercase tracking-wider",children:"System"}),n.jsx("span",{className:"text-xs text-white",children:"Saved"})]})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"h-2.5 w-2.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)] flex-shrink-0"}),n.jsxs("div",{className:"flex flex-col leading-tight",children:[n.jsx("span",{className:"text-[10px] font-bold text-emerald-400 uppercase tracking-wider",children:"System"}),n.jsx("span",{className:"text-xs text-gray-300",children:p!==null?`Saving in ${p}s...`:"Ready"})]})]})}),n.jsx("div",{className:"w-px h-8 bg-gray-700 mx-1"}),n.jsxs("div",{className:"flex flex-col items-center justify-center px-2 min-w-[60px]",children:[n.jsx("span",{className:`text-lg font-bold font-mono leading-none ${j?"text-accent-text":"text-gray-400"}`,children:ST(A)}),n.jsx("span",{className:"text-[10px] font-medium text-gray-500 uppercase tracking-wider leading-none mt-0.5",children:"Time"})]}),n.jsx("div",{className:"w-px h-8 bg-gray-700 mx-1"}),n.jsxs("div",{className:"flex flex-col items-center justify-center px-2 min-w-[50px]",children:[n.jsx("span",{className:"text-lg font-bold text-accent-text font-mono leading-none",children:t}),n.jsx("span",{className:"text-[10px] font-medium text-gray-500 uppercase tracking-wider leading-none mt-0.5",children:"FPS"})]})]}),n.jsx(mt,{content:f(o?"toolbar.expandPanel":"toolbar.collapsePanel"),position:"bottom",children:n.jsx("button",{onClick:()=>r(!o),className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300 ml-1","aria-label":o?"Expand Panel":"Collapse Panel",children:o?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})})]})})})},ET=(e,t=2)=>{if(e===0)return"0 Bytes";const o=1024,r=t<0?0:t,a=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(o));return parseFloat((e/Math.pow(o,i)).toFixed(r))+" "+a[i]},yd="imageViewerPosition",vd="imageViewerSize",PT=({sources:e,initialIndex:t,initialPosition:o,onClose:r,onDownloadImageFromUrl:a,onCopyImageToClipboard:i,onOpenInEditor:s,addToast:l})=>{const{t:c}=Pt(),[d,u]=y.useState(Al()),[p,m]=y.useState(!1),[w,k]=y.useState(()=>{try{const H=localStorage.getItem(yd);if(H){const U=JSON.parse(H);if(typeof U.x=="number"&&typeof U.y=="number")return U}}catch(H){console.error("Failed to load ImageViewer position",H)}return o}),[b,x]=y.useState(()=>{try{const H=localStorage.getItem(vd);if(H){const U=JSON.parse(H);if(U.width&&U.height)return U}}catch(H){console.error("Failed to load ImageViewer size",H)}return{width:"80vw",height:"80vh"}}),[f,h]=y.useState(!1),v=y.useRef(w);y.useEffect(()=>{v.current=w},[w]);const[N,_]=y.useState(t),E=y.useRef(null),I=y.useRef(null),B=y.useRef(null),[M,G]=y.useState(1),[V,j]=y.useState({x:0,y:0}),[P,S]=y.useState(!1),A=y.useRef(null),O=y.useRef(!1),[z,L]=y.useState({width:0,height:0,size:null}),W=e[N],D=H=>{if(H.startsWith("data:")){const U=H.length-(H.indexOf(",")+1),ee=H.charAt(H.length-1)==="="?H.charAt(H.length-2)==="="?2:1:0,ae=U*.75-ee;return ET(ae)}return null};y.useEffect(()=>{requestAnimationFrame(()=>h(!0)),T()},[]),y.useEffect(()=>{if(!W)return;const H=new Image;H.onload=()=>{L({width:H.naturalWidth,height:H.naturalHeight,size:D(W.src)});const U=localStorage.getItem(yd),ee=localStorage.getItem(vd);if(!U||!ee){const ne=window.innerWidth,X=window.innerHeight,ue=ne*.95,Q=X*.95;let ce=H.naturalWidth+20,pe=H.naturalHeight+100;if(ce>ue||pe>Q){const me=Math.min((ue-20)/H.naturalWidth,(Q-100)/H.naturalHeight);ce=H.naturalWidth*me+20,pe=H.naturalHeight*me+100}ce=Math.max(ce,800),pe=Math.max(pe,456),x({width:ce,height:pe}),k({x:(ne-ce)/2,y:(X-pe)/2})}if(!O.current){if(I.current){const{width:ae,height:xe}=I.current.getBoundingClientRect(),ne=ae-20,X=xe-20;if(ne>0&&X>0){const ue=ne/H.naturalWidth,Q=X/H.naturalHeight,ce=Math.min(ue,Q);G(Math.min(ce,1))}else G(1)}else G(1);j({x:0,y:0}),O.current=!0}},H.src=W.src},[W]);const T=()=>{u(Al())},F=H=>{H.stopPropagation(),m(!p)},te=H=>{H==null||H.stopPropagation(),_(U=>U>0?U-1:e.length-1)},$=H=>{H==null||H.stopPropagation(),_(U=>U<e.length-1?U+1:0)},Y=()=>{G(1),j({x:0,y:0})};y.useEffect(()=>{const H=U=>{U.stopPropagation(),U.key==="ArrowLeft"?te():U.key==="ArrowRight"?$():U.key==="Escape"&&r()};return window.addEventListener("keydown",H,!0),()=>{window.removeEventListener("keydown",H,!0)}},[r,e.length]);const oe=H=>{H.target.closest("button")||(T(),H.preventDefault(),H.stopPropagation(),!p&&(H.currentTarget.setPointerCapture(H.pointerId),E.current={offset:{x:H.clientX-w.x,y:H.clientY-w.y}}))},le=H=>{if(!E.current)return;const U=H.clientX-E.current.offset.x,ee=H.clientY-E.current.offset.y;k({x:U,y:ee})},K=H=>{E.current=null,H.currentTarget.releasePointerCapture(H.pointerId),localStorage.setItem(yd,JSON.stringify(v.current))},ie=()=>{if(B.current&&!p){const H=B.current.getBoundingClientRect(),U={width:H.width,height:H.height};x(U),localStorage.setItem(vd,JSON.stringify(U))}},Z=H=>{if(H.stopPropagation(),!I.current)return;const U=Math.pow(1.0005,-H.deltaY),ee=Math.max(.1,Math.min(10,M*U)),ae=I.current.getBoundingClientRect(),xe=H.clientX-ae.left,ne=H.clientY-ae.top,X=xe-ae.width/2,ue=ne-ae.height/2,Q=ee/M,ce=X-(X-V.x)*Q,pe=ue-(ue-V.y)*Q;G(ee),j({x:ce,y:pe})},se=()=>{if(!I.current||z.width===0)return!1;const{width:H,height:U}=I.current.getBoundingClientRect(),ee=z.width*M,ae=z.height*M;return ee>H||ae>U},de=M>1||se(),re=H=>{T(),(de||H.button===1)&&(H.preventDefault(),H.stopPropagation(),S(!0),A.current={x:H.clientX-V.x,y:H.clientY-V.y},window.addEventListener("mousemove",R),window.addEventListener("mouseup",J))},R=H=>{A.current&&(H.preventDefault(),H.stopPropagation(),j({x:H.clientX-A.current.x,y:H.clientY-A.current.y}))},J=()=>{S(!1),A.current=null,window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",J)};return y.useEffect(()=>()=>{window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",J)},[]),W?n.jsxs("div",{ref:B,className:`fixed bg-gray-800 rounded-lg shadow-2xl border-2 border-gray-700 flex flex-col z-[${d}] group transition-opacity duration-300 ease-out select-none ${f?"opacity-100":"opacity-0"}`,style:p?{left:0,top:0,width:"100%",height:"100%",maxWidth:"100vw",maxHeight:"100vh",borderRadius:0,border:"none"}:{left:w.x,top:w.y,width:b.width,height:b.height,maxWidth:"98vw",maxHeight:"98vh",minWidth:"800px",minHeight:"456px",resize:"both",overflow:"hidden"},onMouseDown:H=>{H.stopPropagation(),T()},onMouseUp:ie,children:[n.jsxs("div",{onPointerDown:oe,onPointerMove:le,onPointerUp:K,className:"bg-gray-700 text-white font-bold p-2 rounded-t-md flex justify-between items-center cursor-move flex-shrink-0 select-none",children:[n.jsxs("span",{children:[c("imageViewer.title")," - Frame ",W.frameNumber]}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(we,{title:"Copy Image",onClick:H=>{H.stopPropagation(),i(W.src)},className:"p-1 text-gray-400 rounded hover:bg-gray-600 hover:text-white transition-colors",tooltipPosition:"bottom",children:n.jsx(zt,{className:"h-5 w-5"})}),n.jsx(we,{title:"Download Image",onClick:H=>{H.stopPropagation(),a(W.src,W.frameNumber,W.prompt||""),l&&l(c("toast.downloadStarted"),"success")},className:"p-1 text-gray-400 rounded hover:bg-gray-600 hover:text-white transition-colors",tooltipPosition:"bottom",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-500 mx-1"}),n.jsx(we,{title:p?"Restore":"Full Screen",onClick:F,className:"p-1 text-gray-400 rounded hover:bg-gray-600 hover:text-white transition-colors",tooltipPosition:"bottom",children:p?n.jsx(Zp,{className:"h-5 w-5"}):n.jsx(Xp,{className:"h-5 w-5"})}),n.jsx(we,{title:"Close",onClick:H=>{H.stopPropagation(),r()},className:"p-1 text-gray-400 rounded hover:bg-gray-600 hover:text-white transition-colors",tooltipPosition:"bottom",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),n.jsxs("div",{ref:I,className:"p-1 flex-grow min-h-0 bg-gray-900 relative overflow-hidden flex items-center justify-center",onWheel:Z,onMouseDown:re,children:[n.jsx("img",{src:W.src,alt:`Full-size view of frame ${W.frameNumber}`,className:"shrink-0",style:{width:z.width||"auto",height:z.height||"auto",maxWidth:"none",maxHeight:"none",transform:`translate(${V.x}px, ${V.y}px) scale(${M})`,cursor:de?P?"grabbing":"grab":"default",pointerEvents:"auto",transformOrigin:"center"},draggable:!1,onMouseDown:H=>H.preventDefault()}),n.jsxs("div",{className:"absolute bottom-12 left-1/2 -translate-x-1/2 bg-gray-800/90 backdrop-blur-sm p-2 rounded-full flex items-center space-x-3 border border-gray-600 shadow-lg z-20 select-none",onMouseDown:H=>H.stopPropagation(),children:[n.jsx("button",{onClick:Y,className:"w-8 h-8 rounded-full bg-gray-700 hover:bg-gray-600 text-xs font-bold text-white flex items-center justify-center border border-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500",title:"Reset to 100% (Actual Size)",children:"1:1"}),n.jsx("input",{type:"range",min:"0.1",max:"5",step:"0.01",value:M,onChange:H=>G(parseFloat(H.target.value)),className:"w-32 h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-500"}),n.jsxs("span",{className:"text-xs font-mono text-gray-300 w-12 text-right",children:[Math.round(M*100),"%"]})]}),e.length>1&&n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:te,className:"absolute left-4 top-1/2 -translate-y-1/2 p-2 bg-black/40 rounded-full text-white opacity-0 group-hover:opacity-100 transition-opacity focus:outline-none focus:ring-2 focus:ring-cyan-500 z-10","aria-label":"Previous image",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),n.jsx("button",{onClick:$,className:"absolute right-4 top-1/2 -translate-y-1/2 p-2 bg-black/40 rounded-full text-white opacity-0 group-hover:opacity-100 transition-opacity focus:outline-none focus:ring-2 focus:ring-cyan-500 z-10","aria-label":"Next image",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]})]}),n.jsxs("div",{className:"bg-gray-800 text-gray-400 text-xs px-3 py-1 border-t border-gray-700 flex justify-between items-center rounded-b-lg select-none",children:[n.jsx("div",{children:z.width>0&&n.jsxs("span",{children:[z.width," x ",z.height," px"]})}),s&&n.jsx("button",{onClick:H=>{H.stopPropagation(),s(W.src)},className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors font-semibold",children:c("node.action.editor")}),n.jsx("div",{children:z.size&&n.jsx("span",{children:z.size})})]})]}):(r(),null)},mo=({mode:e,icon:t,label:o,isActive:r,onHover:a,className:i})=>n.jsxs("div",{"data-dock-mode":e,className:`relative flex items-center justify-center transition-all duration-200 cursor-pointer group ${i} ${r?"bg-accent/30 border-accent text-accent-text":"bg-gray-800/80 border-gray-600 text-gray-400 hover:bg-gray-700"}`,onMouseEnter:()=>a(e),onMouseLeave:()=>a(null),style:{pointerEvents:"auto"},children:[n.jsx("div",{className:"transform scale-90 group-hover:scale-100 transition-transform pointer-events-none",children:t}),n.jsx("div",{className:"absolute top-full mt-2 bg-gray-900 text-white text-[10px] px-2 py-1 rounded-md opacity-0 group-hover:opacity-100 whitespace-nowrap z-50 pointer-events-none border border-gray-700 transition-opacity duration-200 ease-in-out",children:o})]}),jT=({isVisible:e,hoveredMode:t})=>{const{setDockHoverMode:o,draggingInfo:r,nodes:a}=Kt()||{},{t:i}=Pt();if(!e||!o)return null;let s=!1;if((r==null?void 0:r.type)==="node"){const c=a==null?void 0:a.find(d=>d.id===r.id);c&&(s=Yl(c.type))}const l=c=>{o(c)};return n.jsx("div",{className:"fixed top-6 left-1/2 -translate-x-1/2 z-[200] animate-fade-in-down pointer-events-none select-none",children:n.jsxs("div",{className:"bg-gray-900/90 backdrop-blur-xl p-1.5 rounded-lg border border-gray-600 shadow-2xl flex items-center gap-1 pointer-events-auto",children:[!s&&n.jsx(mo,{mode:"q1",label:i("toolbar.dock.q1"),isActive:t==="q1",onHover:l,className:"h-16 w-8 rounded border-2",icon:n.jsxs("svg",{width:"12",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M2 4h5v16H2z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})}),!s&&n.jsx(mo,{mode:"q2",label:i("toolbar.dock.q2"),isActive:t==="q2",onHover:l,className:"h-16 w-8 rounded border-2",icon:n.jsxs("svg",{width:"12",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M7 4h5v16H7z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})}),!s&&n.jsxs("div",{className:"flex flex-col gap-1 h-16 w-12",children:[n.jsx(mo,{mode:"tl",label:i("toolbar.dock.tl"),isActive:t==="tl",onHover:l,className:"flex-1 rounded-t border-2",icon:n.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"currentColor",children:[n.jsx("path",{d:"M2 2h6v6H2z",opacity:"0.9"}),n.jsx("path",{d:"M2 2h12v12H2z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.5"})]})}),n.jsx(mo,{mode:"bl",label:i("toolbar.dock.bl"),isActive:t==="bl",onHover:l,className:"flex-1 rounded-b border-2",icon:n.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"currentColor",children:[n.jsx("path",{d:"M2 8h6v6H2z",opacity:"0.9"}),n.jsx("path",{d:"M2 2h12v12H2z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.5"})]})})]}),n.jsx(mo,{mode:"left",label:i("toolbar.dock.left"),isActive:t==="left",onHover:l,className:"h-16 w-12 rounded border-2",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M4 4h8v16H4z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})}),n.jsx(mo,{mode:"full",label:i("toolbar.dock.full"),isActive:t==="full",onHover:l,className:"h-16 w-16 rounded-lg border-2 bg-gray-800",icon:n.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"1",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})}),n.jsx(mo,{mode:"right",label:i("toolbar.dock.right"),isActive:t==="right",onHover:l,className:"h-16 w-12 rounded border-2",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M12 4h8v16h-8z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})}),!s&&n.jsxs("div",{className:"flex flex-col gap-1 h-16 w-12",children:[n.jsx(mo,{mode:"tr",label:i("toolbar.dock.tr"),isActive:t==="tr",onHover:l,className:"flex-1 rounded-t border-2",icon:n.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"currentColor",children:[n.jsx("path",{d:"M8 2h6v6H8z",opacity:"0.9"}),n.jsx("path",{d:"M2 2h12v12H2z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.5"})]})}),n.jsx(mo,{mode:"br",label:i("toolbar.dock.br"),isActive:t==="br",onHover:l,className:"flex-1 rounded-b border-2",icon:n.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"currentColor",children:[n.jsx("path",{d:"M8 8h6v6H8z",opacity:"0.9"}),n.jsx("path",{d:"M2 2h12v12H2z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.5"})]})})]}),!s&&n.jsx(mo,{mode:"q3",label:i("toolbar.dock.q3"),isActive:t==="q3",onHover:l,className:"h-16 w-8 rounded border-2",icon:n.jsxs("svg",{width:"12",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M12 4h5v16h-5z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})}),!s&&n.jsx(mo,{mode:"q4",label:i("toolbar.dock.q4"),isActive:t==="q4",onHover:l,className:"h-16 w-8 rounded border-2",icon:n.jsxs("svg",{width:"12",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M17 4h5v16h-5z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})})]})})},ra=({mode:e,isActive:t,icon:o,className:r})=>{const a=r?r.replace("border-b",""):"";return n.jsx("div",{"data-dock-mode":e,className:`
                w-12 h-16 flex items-center justify-center 
                transition-all duration-200 cursor-pointer flex-shrink-0
                ${t?`bg-gray-800 border-2 border-accent text-accent shadow-[0_0_15px_var(--color-accent)] z-20 scale-110 ${a}`:`bg-gray-900/95 text-gray-500 hover:bg-gray-800 hover:text-gray-300 border-gray-600 ${r||""}`}
            `,children:n.jsx("div",{className:"pointer-events-none",children:o})})},IT=()=>{const e=Kt();if(!e)return null;const{draggingInfo:t,dockHoverMode:o,nodes:r}=e,a=(t==null?void 0:t.type)==="node",i=o;let s=!1;if(a&&t){const d=r.find(u=>u.id===t.id);d&&(s=Yl(d.type))}const l=i==="tl"||i==="q1"||i==="bl",c=i==="tr"||i==="q4"||i==="br";return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed top-0 left-0 bottom-0 z-[190] flex flex-col justify-center pointer-events-none",children:n.jsxs("div",{className:`
                        absolute left-0 flex flex-col shadow-2xl rounded-r-xl overflow-hidden border-y border-r border-gray-600
                        transition-transform duration-300 ease-[cubic-bezier(0.2,0.8,0.2,1)] origin-left pointer-events-auto
                        ${l?"translate-x-0":"-translate-x-full"}
                    `,children:[!s&&n.jsx(ra,{mode:"tl",isActive:i==="tl",className:"border-b",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M4 4h8v10H4z",opacity:"0.9"}),n.jsx("path",{d:"M4 4h16v16H4z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.3"})]})}),!s&&n.jsx(ra,{mode:"q1",isActive:i==="q1",className:"border-b h-20",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M4 3h6v18H4z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",fill:"none",stroke:"currentColor",strokeWidth:"2",opacity:"0.3"})]})}),!s&&n.jsx(ra,{mode:"bl",isActive:i==="bl",className:"",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M4 10h8v10H4z",opacity:"0.9"}),n.jsx("path",{d:"M4 4h16v16H4z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.3"})]})})]})}),n.jsx("div",{className:"fixed top-0 right-0 bottom-0 z-[190] flex flex-col justify-center pointer-events-none",children:n.jsxs("div",{className:`
                        absolute right-0 flex flex-col shadow-2xl rounded-l-xl overflow-hidden border-y border-l border-gray-600
                        transition-transform duration-300 ease-[cubic-bezier(0.2,0.8,0.2,1)] origin-right pointer-events-auto
                        ${c?"translate-x-0":"translate-x-full"}
                    `,children:[!s&&n.jsx(ra,{mode:"tr",isActive:i==="tr",className:"border-b",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M12 4h8v10h-8z",opacity:"0.9"}),n.jsx("path",{d:"M4 4h16v16H4z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.3"})]})}),!s&&n.jsx(ra,{mode:"q4",isActive:i==="q4",className:"border-b h-20",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M14 3h6v18h-6z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",fill:"none",stroke:"currentColor",strokeWidth:"2",opacity:"0.3"})]})}),!s&&n.jsx(ra,{mode:"br",isActive:i==="br",className:"",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M12 10h8v10h-8z",opacity:"0.9"}),n.jsx("path",{d:"M4 4h16v16H4z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.3"})]})})]})})]})},TT=e=>{if(isNaN(e))return"0:00";const t=Math.floor(e/60),o=Math.floor(e%60);return`${t}:${o.toString().padStart(2,"0")}`},AT=()=>{const e=Kt(),[t,o]=y.useState(!1);if(!e||!e.globalMedia)return null;const{globalMedia:r,setGlobalMedia:a,selectNode:i}=e,{name:s,isPlaying:l,currentTime:c,duration:d,nodeId:u}=r,p=f=>{f.stopPropagation(),a(h=>{if(!h)return null;const v=!h.isPlaying;return{...h,isPlaying:v,command:v?"play":"pause",commandTimestamp:Date.now()}})},m=f=>{const h=parseFloat(f.target.value);a(v=>v?{...v,currentTime:h,command:void 0}:null)},w=f=>{const h=parseFloat(f.currentTarget.value);a(v=>v?{...v,command:"seek",seekTarget:h,currentTime:h,commandTimestamp:Date.now()}:null)},k=f=>{f.stopPropagation(),a(h=>h?{...h,command:"pause",commandTimestamp:Date.now()}:null),setTimeout(()=>a(null),100)},b=()=>{i(u)},x=f=>{f.stopPropagation(),o(!t)};return t?n.jsx("div",{className:"fixed bottom-4 right-4 z-50 animate-fade-in-up",children:n.jsxs("div",{className:"bg-gray-900/90 backdrop-blur-md border border-gray-700 rounded-lg shadow-2xl p-2 flex flex-col items-center space-y-2 cursor-pointer hover:bg-gray-800/90 transition-colors",onClick:b,title:s,children:[n.jsx("button",{onClick:x,className:"p-1 text-gray-400 hover:text-white hover:bg-gray-700 rounded transition-colors",title:"Expand",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),n.jsx("div",{className:"w-8 h-8 rounded bg-gray-800 flex items-center justify-center border border-gray-600 flex-shrink-0",children:r.type==="audio"?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z",clipRule:"evenodd"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-purple-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"})})}),n.jsx("button",{onClick:p,className:"text-cyan-400 hover:text-white transition-colors focus:outline-none p-1",children:l?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),n.jsx("button",{onClick:k,className:"text-gray-500 hover:text-red-400 p-1.5 hover:bg-gray-700 rounded-full transition-colors",title:"Close",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}):n.jsx("div",{className:"fixed bottom-4 right-4 z-50 animate-fade-in-up",children:n.jsxs("div",{className:"bg-gray-900/90 backdrop-blur-md border border-gray-700 rounded-lg shadow-2xl p-2 flex items-center space-x-3 w-[330px] cursor-pointer hover:bg-gray-800/90 transition-colors",onClick:b,children:[n.jsx("button",{onClick:x,className:"p-1 text-gray-500 hover:text-white hover:bg-gray-700 rounded transition-colors flex-shrink-0",title:"Collapse",onMouseDown:f=>f.stopPropagation(),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})}),n.jsx("div",{className:"w-8 h-8 rounded bg-gray-800 flex items-center justify-center border border-gray-600 flex-shrink-0",children:r.type==="audio"?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z",clipRule:"evenodd"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-purple-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"})})}),n.jsxs("div",{className:"flex-grow min-w-0 flex flex-col justify-center",children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsx("span",{className:"text-xs font-bold text-gray-200 truncate pr-2",title:s,children:s}),n.jsx("button",{onClick:k,className:"text-gray-500 hover:text-white p-0.5 rounded",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:p,className:"text-cyan-400 hover:text-white transition-colors focus:outline-none",children:l?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),n.jsx("input",{type:"range",min:"0",max:d||100,value:c,onChange:m,onMouseUp:w,onTouchEnd:w,onClick:f=>f.stopPropagation(),onMouseDown:f=>f.stopPropagation(),className:"w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-500"}),n.jsx("span",{className:"text-[9px] font-mono text-gray-400 whitespace-nowrap min-w-[24px]",children:TT(c)})]})]})]})})},RT=({children:e})=>{const[t,o]=y.useState("ru"),[r,a]=y.useState("en");y.useEffect(()=>{const s=localStorage.getItem("settings_secondaryLanguage");s&&["ru","es"].includes(s)&&o(s)},[]),y.useEffect(()=>{localStorage.setItem("settings_secondaryLanguage",t)},[t]);const i=y.useCallback((s,l)=>Po(r,s,l),[r]);return n.jsx(o1.Provider,{value:{language:r,setLanguage:a,secondaryLanguage:t,setSecondaryLanguage:o,t:i},children:e})},MT=()=>{const e=Kt(),[t,o]=y.useState(!1),[r,a]=y.useState(!1),i=y.useRef(!1);if(y.useEffect(()=>{e&&(i.current=e.nodes.length>0||e.tabs.length>1)},[e]),y.useEffect(()=>{const A=!!window.electronAPI,O=L=>{A||i.current&&(L.preventDefault(),L.returnValue="")};window.addEventListener("beforeunload",O);let z;return A&&(e!=null&&e.setConfirmInfo)&&(e!=null&&e.t)&&(z=window.electronAPI.onCloseRequested(()=>{i.current?e.setConfirmInfo({title:e.t("dialog.exitApp.title"),message:e.t("dialog.exitApp.message"),onConfirm:()=>{window.electronAPI.forceClose()}}):window.electronAPI.forceClose()})),()=>{window.removeEventListener("beforeunload",O),z&&z()}},[e]),y.useEffect(()=>{const A=O=>{const z=O.detail;z&&(e!=null&&e.handleLoadFromExternal)&&(console.log("Received external file content"),e.handleLoadFromExternal(z))};return window.addEventListener("prompt-modifier-open-file",A),()=>window.removeEventListener("prompt-modifier-open-file",A)},[e]),y.useEffect(()=>{const A=localStorage.getItem("settings_downloadPath");A&&window.electronAPI&&window.electronAPI.setDownloadPath(A)},[]),y.useEffect(()=>{const A=setTimeout(()=>{o(!0)},150),O=setTimeout(()=>{a(!0)},500);return()=>{clearTimeout(A),clearTimeout(O)}},[]),!e)return null;const{fileInputRef:s,handleFileChange:l,catalogFileInputRef:c,handleCatalogFileChange:d,libraryFileInputRef:u,handleLibraryFileChange:p,imageSequenceFileInputRef:m,handleImageSequenceFileChange:w,promptSequenceEditorFileInputRef:k,handlePromptSequenceFileChange:b,characterCardFileInputRef:x,handleCharacterCardFileChange:f,scriptFileInputRef:h,handleScriptFileChange:v,toasts:N,addToast:_,imageViewer:E,setImageViewer:I,onDownloadImageFromUrl:B,onCopyImageToClipboard:M,isDockingMenuVisible:G,dockHoverMode:V,clientPointerPositionRef:j,t:P,setConfirmInfo:S}=e;return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:`fixed inset-0 bg-[#111827] z-[9999] flex flex-col items-center justify-center transition-opacity duration-700 pointer-events-none ${r?"opacity-0":"opacity-100"}`,children:n.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[n.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin"}),n.jsx("div",{className:"text-cyan-400 font-bold tracking-widest uppercase text-sm animate-pulse",children:"..."})]})}),n.jsxs("div",{className:`relative w-screen h-screen flex flex-col overflow-hidden bg-canvas transition-opacity duration-700 delay-300 ${r?"opacity-100":"opacity-0"}`,style:{backgroundImage:"radial-gradient(hsla(215, 14%, 34%, 0.5) 1px, transparent 1px)",backgroundSize:"20px 20px"},children:[n.jsx("div",{className:`absolute inset-0 transition-opacity duration-700 ease-in-out ${t?"opacity-100":"opacity-0"}`,children:t&&n.jsx(WI,{})}),n.jsx(QI,{}),n.jsx(NT,{}),n.jsx(AT,{}),n.jsxs("div",{className:"absolute bottom-2 right-4 pointer-events-none z-[5] text-xs text-white/10 hover:text-white/50 transition-colors duration-300 flex flex-col items-end leading-tight select-none font-mono",children:[n.jsxs("span",{className:"font-bold",children:[P("help.author"),": MeowMaster"]}),n.jsx("span",{children:"MeowMasterArt@gmail.com"}),n.jsx("a",{href:"https://www.netlify.com",target:"_blank",rel:"noopener noreferrer",className:"pointer-events-auto hover:text-cyan-400 transition-colors mt-1",children:"Powered by Netlify"})]}),n.jsx(jT,{isVisible:G,hoveredMode:V,mousePosition:j.current}),n.jsx(IT,{}),n.jsx(kT,{}),E&&n.jsx(PT,{sources:E.sources,initialIndex:E.initialIndex,initialPosition:{x:window.innerWidth/2-512,y:window.innerHeight/2-400},onClose:()=>I(null),onDownloadImageFromUrl:B,onCopyImageToClipboard:M,addToast:_}),n.jsx("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-[101] flex flex-col items-center space-y-2 pointer-events-none",children:N.map(A=>{let O="font-bold px-6 py-3 rounded-xl shadow-xl animate-fade-in-out text-sm flex items-center justify-center text-center border pointer-events-auto";return A.type==="success"?O+=" bg-accent text-white border-accent-hover":A.type==="error"?O+=" bg-red-600 text-white border-red-500":O+=" bg-accent-secondary text-white border-accent-secondary-hover",n.jsx("div",{className:O,children:A.message},A.id)})}),n.jsx("input",{type:"file",ref:s,className:"hidden",accept:".json,.PMC,.PMP",onChange:l}),n.jsx("input",{type:"file",ref:c,className:"hidden",accept:".json",onChange:d}),n.jsx("input",{type:"file",ref:u,className:"hidden",accept:".json,.txt",onChange:p}),n.jsx("input",{type:"file",ref:m,className:"hidden",accept:".json",onChange:w}),n.jsx("input",{type:"file",ref:k,className:"hidden",accept:".json",onChange:b}),n.jsx("input",{type:"file",ref:x,className:"hidden",accept:".json,.CHAR",onChange:f}),n.jsx("input",{type:"file",ref:h,className:"hidden",accept:".json",onChange:v})]})]})},LT=()=>n.jsx(RT,{children:n.jsx(nP,{children:n.jsx(MT,{})})}),Ly=document.getElementById("root");if(!Ly)throw new Error("Could not find root element to mount to");const DT=wd.createRoot(Ly);DT.render(n.jsx(At.StrictMode,{children:n.jsx(LT,{})}));
