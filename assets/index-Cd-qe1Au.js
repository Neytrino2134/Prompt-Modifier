(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function o(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=o(a);fetch(a.href,i)}})();var Vi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pu(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var _0={exports:{}},jl={},S0={exports:{}},Tt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Di=Symbol.for("react.element"),r2=Symbol.for("react.portal"),a2=Symbol.for("react.fragment"),i2=Symbol.for("react.strict_mode"),s2=Symbol.for("react.profiler"),l2=Symbol.for("react.provider"),c2=Symbol.for("react.context"),d2=Symbol.for("react.forward_ref"),u2=Symbol.for("react.suspense"),p2=Symbol.for("react.memo"),h2=Symbol.for("react.lazy"),$p=Symbol.iterator;function m2(e){return e===null||typeof e!="object"?null:(e=$p&&e[$p]||e["@@iterator"],typeof e=="function"?e:null)}var N0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E0=Object.assign,P0={};function qa(e,t,o){this.props=e,this.context=t,this.refs=P0,this.updater=o||N0}qa.prototype.isReactComponent={};qa.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};qa.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function j0(){}j0.prototype=qa.prototype;function ju(e,t,o){this.props=e,this.context=t,this.refs=P0,this.updater=o||N0}var Tu=ju.prototype=new j0;Tu.constructor=ju;E0(Tu,qa.prototype);Tu.isPureReactComponent=!0;var Kp=Array.isArray,T0=Object.prototype.hasOwnProperty,Iu={current:null},I0={key:!0,ref:!0,__self:!0,__source:!0};function A0(e,t,o){var r,a={},i=null,s=null;if(t!=null)for(r in t.ref!==void 0&&(s=t.ref),t.key!==void 0&&(i=""+t.key),t)T0.call(t,r)&&!I0.hasOwnProperty(r)&&(a[r]=t[r]);var l=arguments.length-2;if(l===1)a.children=o;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];a.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps,l)a[r]===void 0&&(a[r]=l[r]);return{$$typeof:Di,type:e,key:i,ref:s,props:a,_owner:Iu.current}}function g2(e,t){return{$$typeof:Di,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Au(e){return typeof e=="object"&&e!==null&&e.$$typeof===Di}function f2(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(o){return t[o]})}var Jp=/\/+/g;function Cc(e,t){return typeof e=="object"&&e!==null&&e.key!=null?f2(""+e.key):t.toString(36)}function Ps(e,t,o,r,a){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var s=!1;if(e===null)s=!0;else switch(i){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case Di:case r2:s=!0}}if(s)return s=e,a=a(s),e=r===""?"."+Cc(s,0):r,Kp(a)?(o="",e!=null&&(o=e.replace(Jp,"$&/")+"/"),Ps(a,t,o,"",function(d){return d})):a!=null&&(Au(a)&&(a=g2(a,o+(!a.key||s&&s.key===a.key?"":(""+a.key).replace(Jp,"$&/")+"/")+e)),t.push(a)),1;if(s=0,r=r===""?".":r+":",Kp(e))for(var l=0;l<e.length;l++){i=e[l];var c=r+Cc(i,l);s+=Ps(i,t,o,c,a)}else if(c=m2(e),typeof c=="function")for(e=c.call(e),l=0;!(i=e.next()).done;)i=i.value,c=r+Cc(i,l++),s+=Ps(i,t,o,c,a);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function Wi(e,t,o){if(e==null)return e;var r=[],a=0;return Ps(e,r,"","",function(i){return t.call(o,i,a++)}),r}function x2(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(o){(e._status===0||e._status===-1)&&(e._status=1,e._result=o)},function(o){(e._status===0||e._status===-1)&&(e._status=2,e._result=o)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Dn={current:null},js={transition:null},y2={ReactCurrentDispatcher:Dn,ReactCurrentBatchConfig:js,ReactCurrentOwner:Iu};function M0(){throw Error("act(...) is not supported in production builds of React.")}Tt.Children={map:Wi,forEach:function(e,t,o){Wi(e,function(){t.apply(this,arguments)},o)},count:function(e){var t=0;return Wi(e,function(){t++}),t},toArray:function(e){return Wi(e,function(t){return t})||[]},only:function(e){if(!Au(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Tt.Component=qa;Tt.Fragment=a2;Tt.Profiler=s2;Tt.PureComponent=ju;Tt.StrictMode=i2;Tt.Suspense=u2;Tt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=y2;Tt.act=M0;Tt.cloneElement=function(e,t,o){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=E0({},e.props),a=e.key,i=e.ref,s=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,s=Iu.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)T0.call(t,c)&&!I0.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=o;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:Di,type:e.type,key:a,ref:i,props:r,_owner:s}};Tt.createContext=function(e){return e={$$typeof:c2,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:l2,_context:e},e.Consumer=e};Tt.createElement=A0;Tt.createFactory=function(e){var t=A0.bind(null,e);return t.type=e,t};Tt.createRef=function(){return{current:null}};Tt.forwardRef=function(e){return{$$typeof:d2,render:e}};Tt.isValidElement=Au;Tt.lazy=function(e){return{$$typeof:h2,_payload:{_status:-1,_result:e},_init:x2}};Tt.memo=function(e,t){return{$$typeof:p2,type:e,compare:t===void 0?null:t}};Tt.startTransition=function(e){var t=js.transition;js.transition={};try{e()}finally{js.transition=t}};Tt.unstable_act=M0;Tt.useCallback=function(e,t){return Dn.current.useCallback(e,t)};Tt.useContext=function(e){return Dn.current.useContext(e)};Tt.useDebugValue=function(){};Tt.useDeferredValue=function(e){return Dn.current.useDeferredValue(e)};Tt.useEffect=function(e,t){return Dn.current.useEffect(e,t)};Tt.useId=function(){return Dn.current.useId()};Tt.useImperativeHandle=function(e,t,o){return Dn.current.useImperativeHandle(e,t,o)};Tt.useInsertionEffect=function(e,t){return Dn.current.useInsertionEffect(e,t)};Tt.useLayoutEffect=function(e,t){return Dn.current.useLayoutEffect(e,t)};Tt.useMemo=function(e,t){return Dn.current.useMemo(e,t)};Tt.useReducer=function(e,t,o){return Dn.current.useReducer(e,t,o)};Tt.useRef=function(e){return Dn.current.useRef(e)};Tt.useState=function(e){return Dn.current.useState(e)};Tt.useSyncExternalStore=function(e,t,o){return Dn.current.useSyncExternalStore(e,t,o)};Tt.useTransition=function(){return Dn.current.useTransition()};Tt.version="18.3.1";S0.exports=Tt;var v=S0.exports;const jt=Pu(v);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v2=v,w2=Symbol.for("react.element"),b2=Symbol.for("react.fragment"),C2=Object.prototype.hasOwnProperty,k2=v2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_2={key:!0,ref:!0,__self:!0,__source:!0};function R0(e,t,o){var r,a={},i=null,s=null;o!==void 0&&(i=""+o),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(s=t.ref);for(r in t)C2.call(t,r)&&!_2.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:w2,type:e,key:i,ref:s,props:a,_owner:k2.current}}jl.Fragment=b2;jl.jsx=R0;jl.jsxs=R0;_0.exports=jl;var n=_0.exports,ud={},L0={exports:{}},Qn={},D0={exports:{}},z0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(G,U){var R=G.length;G.push(U);e:for(;0<R;){var q=R-1>>>1,H=G[q];if(0<a(H,U))G[q]=U,G[R]=H,R=q;else break e}}function o(G){return G.length===0?null:G[0]}function r(G){if(G.length===0)return null;var U=G[0],R=G.pop();if(R!==U){G[0]=R;e:for(var q=0,H=G.length,ne=H>>>1;q<ne;){var X=2*(q+1)-1,re=G[X],de=X+1,ge=G[de];if(0>a(re,R))de<H&&0>a(ge,re)?(G[q]=ge,G[de]=R,q=de):(G[q]=re,G[X]=R,q=X);else if(de<H&&0>a(ge,R))G[q]=ge,G[de]=R,q=de;else break e}}return U}function a(G,U){var R=G.sortIndex-U.sortIndex;return R!==0?R:G.id-U.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var s=Date,l=s.now();e.unstable_now=function(){return s.now()-l}}var c=[],d=[],u=1,p=null,h=3,w=!1,k=!1,b=!1,y=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(G){for(var U=o(d);U!==null;){if(U.callback===null)r(d);else if(U.startTime<=G)r(d),U.sortIndex=U.expirationTime,t(c,U);else break;U=o(d)}}function _(G){if(b=!1,x(G),!k)if(o(c)!==null)k=!0,F(S);else{var U=o(d);U!==null&&z(_,U.startTime-G)}}function S(G,U){k=!1,b&&(b=!1,g(M),M=-1),w=!0;var R=h;try{for(x(U),p=o(c);p!==null&&(!(p.expirationTime>U)||G&&!B());){var q=p.callback;if(typeof q=="function"){p.callback=null,h=p.priorityLevel;var H=q(p.expirationTime<=U);U=e.unstable_now(),typeof H=="function"?p.callback=H:p===o(c)&&r(c),x(U)}else r(c);p=o(c)}if(p!==null)var ne=!0;else{var X=o(d);X!==null&&z(_,X.startTime-U),ne=!1}return ne}finally{p=null,h=R,w=!1}}var P=!1,j=null,M=-1,D=5,O=-1;function B(){return!(e.unstable_now()-O<D)}function E(){if(j!==null){var G=e.unstable_now();O=G;var U=!0;try{U=j(!0,G)}finally{U?I():(P=!1,j=null)}}else P=!1}var I;if(typeof m=="function")I=function(){m(E)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,T=N.port2;N.port1.onmessage=E,I=function(){T.postMessage(null)}}else I=function(){y(E,0)};function F(G){j=G,P||(P=!0,I())}function z(G,U){M=y(function(){G(e.unstable_now())},U)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(G){G.callback=null},e.unstable_continueExecution=function(){k||w||(k=!0,F(S))},e.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<G?Math.floor(1e3/G):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return o(c)},e.unstable_next=function(G){switch(h){case 1:case 2:case 3:var U=3;break;default:U=h}var R=h;h=U;try{return G()}finally{h=R}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(G,U){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var R=h;h=G;try{return U()}finally{h=R}},e.unstable_scheduleCallback=function(G,U,R){var q=e.unstable_now();switch(typeof R=="object"&&R!==null?(R=R.delay,R=typeof R=="number"&&0<R?q+R:q):R=q,G){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=R+H,G={id:u++,callback:U,priorityLevel:G,startTime:R,expirationTime:H,sortIndex:-1},R>q?(G.sortIndex=R,t(d,G),o(c)===null&&G===o(d)&&(b?(g(M),M=-1):b=!0,z(_,R-q))):(G.sortIndex=H,t(c,G),k||w||(k=!0,F(S))),G},e.unstable_shouldYield=B,e.unstable_wrapCallback=function(G){var U=h;return function(){var R=h;h=U;try{return G.apply(this,arguments)}finally{h=R}}}})(z0);D0.exports=z0;var S2=D0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N2=v,Xn=S2;function nt(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,o=1;o<arguments.length;o++)t+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var q0=new Set,xi={};function Ur(e,t){Ea(e,t),Ea(e+"Capture",t)}function Ea(e,t){for(xi[e]=t,e=0;e<t.length;e++)q0.add(t[e])}var Go=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),pd=Object.prototype.hasOwnProperty,E2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Yp={},Zp={};function P2(e){return pd.call(Zp,e)?!0:pd.call(Yp,e)?!1:E2.test(e)?Zp[e]=!0:(Yp[e]=!0,!1)}function j2(e,t,o,r){if(o!==null&&o.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:o!==null?!o.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function T2(e,t,o,r){if(t===null||typeof t>"u"||j2(e,t,o,r))return!0;if(r)return!1;if(o!==null)switch(o.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function zn(e,t,o,r,a,i,s){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=o,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=s}var bn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){bn[e]=new zn(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];bn[t]=new zn(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){bn[e]=new zn(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){bn[e]=new zn(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){bn[e]=new zn(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){bn[e]=new zn(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){bn[e]=new zn(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){bn[e]=new zn(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){bn[e]=new zn(e,5,!1,e.toLowerCase(),null,!1,!1)});var Mu=/[\-:]([a-z])/g;function Ru(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Mu,Ru);bn[t]=new zn(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Mu,Ru);bn[t]=new zn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Mu,Ru);bn[t]=new zn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){bn[e]=new zn(e,1,!1,e.toLowerCase(),null,!1,!1)});bn.xlinkHref=new zn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){bn[e]=new zn(e,1,!1,e.toLowerCase(),null,!0,!0)});function Lu(e,t,o,r){var a=bn.hasOwnProperty(t)?bn[t]:null;(a!==null?a.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(T2(t,o,a,r)&&(o=null),r||a===null?P2(t)&&(o===null?e.removeAttribute(t):e.setAttribute(t,""+o)):a.mustUseProperty?e[a.propertyName]=o===null?a.type===3?!1:"":o:(t=a.attributeName,r=a.attributeNamespace,o===null?e.removeAttribute(t):(a=a.type,o=a===3||a===4&&o===!0?"":""+o,r?e.setAttributeNS(r,t,o):e.setAttribute(t,o))))}var Ko=N2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,$i=Symbol.for("react.element"),ra=Symbol.for("react.portal"),aa=Symbol.for("react.fragment"),Du=Symbol.for("react.strict_mode"),hd=Symbol.for("react.profiler"),O0=Symbol.for("react.provider"),F0=Symbol.for("react.context"),zu=Symbol.for("react.forward_ref"),md=Symbol.for("react.suspense"),gd=Symbol.for("react.suspense_list"),qu=Symbol.for("react.memo"),ar=Symbol.for("react.lazy"),B0=Symbol.for("react.offscreen"),Xp=Symbol.iterator;function Wa(e){return e===null||typeof e!="object"?null:(e=Xp&&e[Xp]||e["@@iterator"],typeof e=="function"?e:null)}var tn=Object.assign,kc;function ni(e){if(kc===void 0)try{throw Error()}catch(o){var t=o.stack.trim().match(/\n( *(at )?)/);kc=t&&t[1]||""}return`
`+kc+e}var _c=!1;function Sc(e,t){if(!e||_c)return"";_c=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var r=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){r=d}e.call(t.prototype)}else{try{throw Error()}catch(d){r=d}e()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var a=d.stack.split(`
`),i=r.stack.split(`
`),s=a.length-1,l=i.length-1;1<=s&&0<=l&&a[s]!==i[l];)l--;for(;1<=s&&0<=l;s--,l--)if(a[s]!==i[l]){if(s!==1||l!==1)do if(s--,l--,0>l||a[s]!==i[l]){var c=`
`+a[s].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=s&&0<=l);break}}}finally{_c=!1,Error.prepareStackTrace=o}return(e=e?e.displayName||e.name:"")?ni(e):""}function I2(e){switch(e.tag){case 5:return ni(e.type);case 16:return ni("Lazy");case 13:return ni("Suspense");case 19:return ni("SuspenseList");case 0:case 2:case 15:return e=Sc(e.type,!1),e;case 11:return e=Sc(e.type.render,!1),e;case 1:return e=Sc(e.type,!0),e;default:return""}}function fd(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case aa:return"Fragment";case ra:return"Portal";case hd:return"Profiler";case Du:return"StrictMode";case md:return"Suspense";case gd:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case F0:return(e.displayName||"Context")+".Consumer";case O0:return(e._context.displayName||"Context")+".Provider";case zu:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case qu:return t=e.displayName||null,t!==null?t:fd(e.type)||"Memo";case ar:t=e._payload,e=e._init;try{return fd(e(t))}catch{}}return null}function A2(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return fd(t);case 8:return t===Du?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function wr(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function H0(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function M2(e){var t=H0(e)?"checked":"value",o=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var a=o.get,i=o.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(s){r=""+s,i.call(this,s)}}),Object.defineProperty(e,t,{enumerable:o.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Ki(e){e._valueTracker||(e._valueTracker=M2(e))}function G0(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var o=t.getValue(),r="";return e&&(r=H0(e)?e.checked?"true":"false":e.value),e=r,e!==o?(t.setValue(e),!0):!1}function $s(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function xd(e,t){var o=t.checked;return tn({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??e._wrapperState.initialChecked})}function Qp(e,t){var o=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;o=wr(t.value!=null?t.value:o),e._wrapperState={initialChecked:r,initialValue:o,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function U0(e,t){t=t.checked,t!=null&&Lu(e,"checked",t,!1)}function yd(e,t){U0(e,t);var o=wr(t.value),r=t.type;if(o!=null)r==="number"?(o===0&&e.value===""||e.value!=o)&&(e.value=""+o):e.value!==""+o&&(e.value=""+o);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?vd(e,t.type,o):t.hasOwnProperty("defaultValue")&&vd(e,t.type,wr(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function eh(e,t,o){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,o||t===e.value||(e.value=t),e.defaultValue=t}o=e.name,o!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,o!==""&&(e.name=o)}function vd(e,t,o){(t!=="number"||$s(e.ownerDocument)!==e)&&(o==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+o&&(e.defaultValue=""+o))}var oi=Array.isArray;function ya(e,t,o,r){if(e=e.options,t){t={};for(var a=0;a<o.length;a++)t["$"+o[a]]=!0;for(o=0;o<e.length;o++)a=t.hasOwnProperty("$"+e[o].value),e[o].selected!==a&&(e[o].selected=a),a&&r&&(e[o].defaultSelected=!0)}else{for(o=""+wr(o),t=null,a=0;a<e.length;a++){if(e[a].value===o){e[a].selected=!0,r&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function wd(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(nt(91));return tn({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function th(e,t){var o=t.value;if(o==null){if(o=t.children,t=t.defaultValue,o!=null){if(t!=null)throw Error(nt(92));if(oi(o)){if(1<o.length)throw Error(nt(93));o=o[0]}t=o}t==null&&(t=""),o=t}e._wrapperState={initialValue:wr(o)}}function V0(e,t){var o=wr(t.value),r=wr(t.defaultValue);o!=null&&(o=""+o,o!==e.value&&(e.value=o),t.defaultValue==null&&e.defaultValue!==o&&(e.defaultValue=o)),r!=null&&(e.defaultValue=""+r)}function nh(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function W0(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function bd(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?W0(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Ji,$0=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,o,r,a){MSApp.execUnsafeLocalFunction(function(){return e(t,o,r,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Ji=Ji||document.createElement("div"),Ji.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Ji.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function yi(e,t){if(t){var o=e.firstChild;if(o&&o===e.lastChild&&o.nodeType===3){o.nodeValue=t;return}}e.textContent=t}var li={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},R2=["Webkit","ms","Moz","O"];Object.keys(li).forEach(function(e){R2.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),li[t]=li[e]})});function K0(e,t,o){return t==null||typeof t=="boolean"||t===""?"":o||typeof t!="number"||t===0||li.hasOwnProperty(e)&&li[e]?(""+t).trim():t+"px"}function J0(e,t){e=e.style;for(var o in t)if(t.hasOwnProperty(o)){var r=o.indexOf("--")===0,a=K0(o,t[o],r);o==="float"&&(o="cssFloat"),r?e.setProperty(o,a):e[o]=a}}var L2=tn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Cd(e,t){if(t){if(L2[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(nt(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(nt(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(nt(61))}if(t.style!=null&&typeof t.style!="object")throw Error(nt(62))}}function kd(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _d=null;function Ou(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Sd=null,va=null,wa=null;function oh(e){if(e=Oi(e)){if(typeof Sd!="function")throw Error(nt(280));var t=e.stateNode;t&&(t=Rl(t),Sd(e.stateNode,e.type,t))}}function Y0(e){va?wa?wa.push(e):wa=[e]:va=e}function Z0(){if(va){var e=va,t=wa;if(wa=va=null,oh(e),t)for(e=0;e<t.length;e++)oh(t[e])}}function X0(e,t){return e(t)}function Q0(){}var Nc=!1;function ef(e,t,o){if(Nc)return e(t,o);Nc=!0;try{return X0(e,t,o)}finally{Nc=!1,(va!==null||wa!==null)&&(Q0(),Z0())}}function vi(e,t){var o=e.stateNode;if(o===null)return null;var r=Rl(o);if(r===null)return null;o=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(o&&typeof o!="function")throw Error(nt(231,t,typeof o));return o}var Nd=!1;if(Go)try{var $a={};Object.defineProperty($a,"passive",{get:function(){Nd=!0}}),window.addEventListener("test",$a,$a),window.removeEventListener("test",$a,$a)}catch{Nd=!1}function D2(e,t,o,r,a,i,s,l,c){var d=Array.prototype.slice.call(arguments,3);try{t.apply(o,d)}catch(u){this.onError(u)}}var ci=!1,Ks=null,Js=!1,Ed=null,z2={onError:function(e){ci=!0,Ks=e}};function q2(e,t,o,r,a,i,s,l,c){ci=!1,Ks=null,D2.apply(z2,arguments)}function O2(e,t,o,r,a,i,s,l,c){if(q2.apply(this,arguments),ci){if(ci){var d=Ks;ci=!1,Ks=null}else throw Error(nt(198));Js||(Js=!0,Ed=d)}}function Vr(e){var t=e,o=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(o=t.return),e=t.return;while(e)}return t.tag===3?o:null}function tf(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function rh(e){if(Vr(e)!==e)throw Error(nt(188))}function F2(e){var t=e.alternate;if(!t){if(t=Vr(e),t===null)throw Error(nt(188));return t!==e?null:e}for(var o=e,r=t;;){var a=o.return;if(a===null)break;var i=a.alternate;if(i===null){if(r=a.return,r!==null){o=r;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===o)return rh(a),e;if(i===r)return rh(a),t;i=i.sibling}throw Error(nt(188))}if(o.return!==r.return)o=a,r=i;else{for(var s=!1,l=a.child;l;){if(l===o){s=!0,o=a,r=i;break}if(l===r){s=!0,r=a,o=i;break}l=l.sibling}if(!s){for(l=i.child;l;){if(l===o){s=!0,o=i,r=a;break}if(l===r){s=!0,r=i,o=a;break}l=l.sibling}if(!s)throw Error(nt(189))}}if(o.alternate!==r)throw Error(nt(190))}if(o.tag!==3)throw Error(nt(188));return o.stateNode.current===o?e:t}function nf(e){return e=F2(e),e!==null?of(e):null}function of(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=of(e);if(t!==null)return t;e=e.sibling}return null}var rf=Xn.unstable_scheduleCallback,ah=Xn.unstable_cancelCallback,B2=Xn.unstable_shouldYield,H2=Xn.unstable_requestPaint,sn=Xn.unstable_now,G2=Xn.unstable_getCurrentPriorityLevel,Fu=Xn.unstable_ImmediatePriority,af=Xn.unstable_UserBlockingPriority,Ys=Xn.unstable_NormalPriority,U2=Xn.unstable_LowPriority,sf=Xn.unstable_IdlePriority,Tl=null,To=null;function V2(e){if(To&&typeof To.onCommitFiberRoot=="function")try{To.onCommitFiberRoot(Tl,e,void 0,(e.current.flags&128)===128)}catch{}}var xo=Math.clz32?Math.clz32:K2,W2=Math.log,$2=Math.LN2;function K2(e){return e>>>=0,e===0?32:31-(W2(e)/$2|0)|0}var Yi=64,Zi=4194304;function ri(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Zs(e,t){var o=e.pendingLanes;if(o===0)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,s=o&268435455;if(s!==0){var l=s&~a;l!==0?r=ri(l):(i&=s,i!==0&&(r=ri(i)))}else s=o&~a,s!==0?r=ri(s):i!==0&&(r=ri(i));if(r===0)return 0;if(t!==0&&t!==r&&!(t&a)&&(a=r&-r,i=t&-t,a>=i||a===16&&(i&4194240)!==0))return t;if(r&4&&(r|=o&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)o=31-xo(t),a=1<<o,r|=e[o],t&=~a;return r}function J2(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Y2(e,t){for(var o=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var s=31-xo(i),l=1<<s,c=a[s];c===-1?(!(l&o)||l&r)&&(a[s]=J2(l,t)):c<=t&&(e.expiredLanes|=l),i&=~l}}function Pd(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function lf(){var e=Yi;return Yi<<=1,!(Yi&4194240)&&(Yi=64),e}function Ec(e){for(var t=[],o=0;31>o;o++)t.push(e);return t}function zi(e,t,o){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-xo(t),e[t]=o}function Z2(e,t){var o=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<o;){var a=31-xo(o),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,o&=~i}}function Bu(e,t){var o=e.entangledLanes|=t;for(e=e.entanglements;o;){var r=31-xo(o),a=1<<r;a&t|e[r]&t&&(e[r]|=t),o&=~a}}var Bt=0;function cf(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var df,Hu,uf,pf,hf,jd=!1,Xi=[],ur=null,pr=null,hr=null,wi=new Map,bi=new Map,sr=[],X2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ih(e,t){switch(e){case"focusin":case"focusout":ur=null;break;case"dragenter":case"dragleave":pr=null;break;case"mouseover":case"mouseout":hr=null;break;case"pointerover":case"pointerout":wi.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":bi.delete(t.pointerId)}}function Ka(e,t,o,r,a,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:o,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},t!==null&&(t=Oi(t),t!==null&&Hu(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function Q2(e,t,o,r,a){switch(t){case"focusin":return ur=Ka(ur,e,t,o,r,a),!0;case"dragenter":return pr=Ka(pr,e,t,o,r,a),!0;case"mouseover":return hr=Ka(hr,e,t,o,r,a),!0;case"pointerover":var i=a.pointerId;return wi.set(i,Ka(wi.get(i)||null,e,t,o,r,a)),!0;case"gotpointercapture":return i=a.pointerId,bi.set(i,Ka(bi.get(i)||null,e,t,o,r,a)),!0}return!1}function mf(e){var t=Mr(e.target);if(t!==null){var o=Vr(t);if(o!==null){if(t=o.tag,t===13){if(t=tf(o),t!==null){e.blockedOn=t,hf(e.priority,function(){uf(o)});return}}else if(t===3&&o.stateNode.current.memoizedState.isDehydrated){e.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Ts(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var o=Td(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(o===null){o=e.nativeEvent;var r=new o.constructor(o.type,o);_d=r,o.target.dispatchEvent(r),_d=null}else return t=Oi(o),t!==null&&Hu(t),e.blockedOn=o,!1;t.shift()}return!0}function sh(e,t,o){Ts(e)&&o.delete(t)}function ev(){jd=!1,ur!==null&&Ts(ur)&&(ur=null),pr!==null&&Ts(pr)&&(pr=null),hr!==null&&Ts(hr)&&(hr=null),wi.forEach(sh),bi.forEach(sh)}function Ja(e,t){e.blockedOn===t&&(e.blockedOn=null,jd||(jd=!0,Xn.unstable_scheduleCallback(Xn.unstable_NormalPriority,ev)))}function Ci(e){function t(a){return Ja(a,e)}if(0<Xi.length){Ja(Xi[0],e);for(var o=1;o<Xi.length;o++){var r=Xi[o];r.blockedOn===e&&(r.blockedOn=null)}}for(ur!==null&&Ja(ur,e),pr!==null&&Ja(pr,e),hr!==null&&Ja(hr,e),wi.forEach(t),bi.forEach(t),o=0;o<sr.length;o++)r=sr[o],r.blockedOn===e&&(r.blockedOn=null);for(;0<sr.length&&(o=sr[0],o.blockedOn===null);)mf(o),o.blockedOn===null&&sr.shift()}var ba=Ko.ReactCurrentBatchConfig,Xs=!0;function tv(e,t,o,r){var a=Bt,i=ba.transition;ba.transition=null;try{Bt=1,Gu(e,t,o,r)}finally{Bt=a,ba.transition=i}}function nv(e,t,o,r){var a=Bt,i=ba.transition;ba.transition=null;try{Bt=4,Gu(e,t,o,r)}finally{Bt=a,ba.transition=i}}function Gu(e,t,o,r){if(Xs){var a=Td(e,t,o,r);if(a===null)zc(e,t,r,Qs,o),ih(e,r);else if(Q2(a,e,t,o,r))r.stopPropagation();else if(ih(e,r),t&4&&-1<X2.indexOf(e)){for(;a!==null;){var i=Oi(a);if(i!==null&&df(i),i=Td(e,t,o,r),i===null&&zc(e,t,r,Qs,o),i===a)break;a=i}a!==null&&r.stopPropagation()}else zc(e,t,r,null,o)}}var Qs=null;function Td(e,t,o,r){if(Qs=null,e=Ou(r),e=Mr(e),e!==null)if(t=Vr(e),t===null)e=null;else if(o=t.tag,o===13){if(e=tf(t),e!==null)return e;e=null}else if(o===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Qs=e,null}function gf(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(G2()){case Fu:return 1;case af:return 4;case Ys:case U2:return 16;case sf:return 536870912;default:return 16}default:return 16}}var cr=null,Uu=null,Is=null;function ff(){if(Is)return Is;var e,t=Uu,o=t.length,r,a="value"in cr?cr.value:cr.textContent,i=a.length;for(e=0;e<o&&t[e]===a[e];e++);var s=o-e;for(r=1;r<=s&&t[o-r]===a[i-r];r++);return Is=a.slice(e,1<r?1-r:void 0)}function As(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Qi(){return!0}function lh(){return!1}function eo(e){function t(o,r,a,i,s){this._reactName=o,this._targetInst=a,this.type=r,this.nativeEvent=i,this.target=s,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(o=e[l],this[l]=o?o(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Qi:lh,this.isPropagationStopped=lh,this}return tn(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=Qi)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=Qi)},persist:function(){},isPersistent:Qi}),t}var Oa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Vu=eo(Oa),qi=tn({},Oa,{view:0,detail:0}),ov=eo(qi),Pc,jc,Ya,Il=tn({},qi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Wu,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ya&&(Ya&&e.type==="mousemove"?(Pc=e.screenX-Ya.screenX,jc=e.screenY-Ya.screenY):jc=Pc=0,Ya=e),Pc)},movementY:function(e){return"movementY"in e?e.movementY:jc}}),ch=eo(Il),rv=tn({},Il,{dataTransfer:0}),av=eo(rv),iv=tn({},qi,{relatedTarget:0}),Tc=eo(iv),sv=tn({},Oa,{animationName:0,elapsedTime:0,pseudoElement:0}),lv=eo(sv),cv=tn({},Oa,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),dv=eo(cv),uv=tn({},Oa,{data:0}),dh=eo(uv),pv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gv(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=mv[e])?!!t[e]:!1}function Wu(){return gv}var fv=tn({},qi,{key:function(e){if(e.key){var t=pv[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=As(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?hv[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Wu,charCode:function(e){return e.type==="keypress"?As(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?As(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),xv=eo(fv),yv=tn({},Il,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),uh=eo(yv),vv=tn({},qi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Wu}),wv=eo(vv),bv=tn({},Oa,{propertyName:0,elapsedTime:0,pseudoElement:0}),Cv=eo(bv),kv=tn({},Il,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),_v=eo(kv),Sv=[9,13,27,32],$u=Go&&"CompositionEvent"in window,di=null;Go&&"documentMode"in document&&(di=document.documentMode);var Nv=Go&&"TextEvent"in window&&!di,xf=Go&&(!$u||di&&8<di&&11>=di),ph=" ",hh=!1;function yf(e,t){switch(e){case"keyup":return Sv.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function vf(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ia=!1;function Ev(e,t){switch(e){case"compositionend":return vf(t);case"keypress":return t.which!==32?null:(hh=!0,ph);case"textInput":return e=t.data,e===ph&&hh?null:e;default:return null}}function Pv(e,t){if(ia)return e==="compositionend"||!$u&&yf(e,t)?(e=ff(),Is=Uu=cr=null,ia=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return xf&&t.locale!=="ko"?null:t.data;default:return null}}var jv={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mh(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!jv[e.type]:t==="textarea"}function wf(e,t,o,r){Y0(r),t=el(t,"onChange"),0<t.length&&(o=new Vu("onChange","change",null,o,r),e.push({event:o,listeners:t}))}var ui=null,ki=null;function Tv(e){If(e,0)}function Al(e){var t=ca(e);if(G0(t))return e}function Iv(e,t){if(e==="change")return t}var bf=!1;if(Go){var Ic;if(Go){var Ac="oninput"in document;if(!Ac){var gh=document.createElement("div");gh.setAttribute("oninput","return;"),Ac=typeof gh.oninput=="function"}Ic=Ac}else Ic=!1;bf=Ic&&(!document.documentMode||9<document.documentMode)}function fh(){ui&&(ui.detachEvent("onpropertychange",Cf),ki=ui=null)}function Cf(e){if(e.propertyName==="value"&&Al(ki)){var t=[];wf(t,ki,e,Ou(e)),ef(Tv,t)}}function Av(e,t,o){e==="focusin"?(fh(),ui=t,ki=o,ui.attachEvent("onpropertychange",Cf)):e==="focusout"&&fh()}function Mv(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Al(ki)}function Rv(e,t){if(e==="click")return Al(t)}function Lv(e,t){if(e==="input"||e==="change")return Al(t)}function Dv(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var bo=typeof Object.is=="function"?Object.is:Dv;function _i(e,t){if(bo(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var o=Object.keys(e),r=Object.keys(t);if(o.length!==r.length)return!1;for(r=0;r<o.length;r++){var a=o[r];if(!pd.call(t,a)||!bo(e[a],t[a]))return!1}return!0}function xh(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function yh(e,t){var o=xh(e);e=0;for(var r;o;){if(o.nodeType===3){if(r=e+o.textContent.length,e<=t&&r>=t)return{node:o,offset:t-e};e=r}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=xh(o)}}function kf(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?kf(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function _f(){for(var e=window,t=$s();t instanceof e.HTMLIFrameElement;){try{var o=typeof t.contentWindow.location.href=="string"}catch{o=!1}if(o)e=t.contentWindow;else break;t=$s(e.document)}return t}function Ku(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function zv(e){var t=_f(),o=e.focusedElem,r=e.selectionRange;if(t!==o&&o&&o.ownerDocument&&kf(o.ownerDocument.documentElement,o)){if(r!==null&&Ku(o)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in o)o.selectionStart=t,o.selectionEnd=Math.min(e,o.value.length);else if(e=(t=o.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=o.textContent.length,i=Math.min(r.start,a);r=r.end===void 0?i:Math.min(r.end,a),!e.extend&&i>r&&(a=r,r=i,i=a),a=yh(o,i);var s=yh(o,r);a&&s&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}}for(t=[],e=o;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<t.length;o++)e=t[o],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var qv=Go&&"documentMode"in document&&11>=document.documentMode,sa=null,Id=null,pi=null,Ad=!1;function vh(e,t,o){var r=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Ad||sa==null||sa!==$s(r)||(r=sa,"selectionStart"in r&&Ku(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),pi&&_i(pi,r)||(pi=r,r=el(Id,"onSelect"),0<r.length&&(t=new Vu("onSelect","select",null,t,o),e.push({event:t,listeners:r}),t.target=sa)))}function es(e,t){var o={};return o[e.toLowerCase()]=t.toLowerCase(),o["Webkit"+e]="webkit"+t,o["Moz"+e]="moz"+t,o}var la={animationend:es("Animation","AnimationEnd"),animationiteration:es("Animation","AnimationIteration"),animationstart:es("Animation","AnimationStart"),transitionend:es("Transition","TransitionEnd")},Mc={},Sf={};Go&&(Sf=document.createElement("div").style,"AnimationEvent"in window||(delete la.animationend.animation,delete la.animationiteration.animation,delete la.animationstart.animation),"TransitionEvent"in window||delete la.transitionend.transition);function Ml(e){if(Mc[e])return Mc[e];if(!la[e])return e;var t=la[e],o;for(o in t)if(t.hasOwnProperty(o)&&o in Sf)return Mc[e]=t[o];return e}var Nf=Ml("animationend"),Ef=Ml("animationiteration"),Pf=Ml("animationstart"),jf=Ml("transitionend"),Tf=new Map,wh="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function kr(e,t){Tf.set(e,t),Ur(t,[e])}for(var Rc=0;Rc<wh.length;Rc++){var Lc=wh[Rc],Ov=Lc.toLowerCase(),Fv=Lc[0].toUpperCase()+Lc.slice(1);kr(Ov,"on"+Fv)}kr(Nf,"onAnimationEnd");kr(Ef,"onAnimationIteration");kr(Pf,"onAnimationStart");kr("dblclick","onDoubleClick");kr("focusin","onFocus");kr("focusout","onBlur");kr(jf,"onTransitionEnd");Ea("onMouseEnter",["mouseout","mouseover"]);Ea("onMouseLeave",["mouseout","mouseover"]);Ea("onPointerEnter",["pointerout","pointerover"]);Ea("onPointerLeave",["pointerout","pointerover"]);Ur("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ur("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ur("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ur("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ur("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ur("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ai="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Bv=new Set("cancel close invalid load scroll toggle".split(" ").concat(ai));function bh(e,t,o){var r=e.type||"unknown-event";e.currentTarget=o,O2(r,t,void 0,e),e.currentTarget=null}function If(e,t){t=(t&4)!==0;for(var o=0;o<e.length;o++){var r=e[o],a=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var s=r.length-1;0<=s;s--){var l=r[s],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&a.isPropagationStopped())break e;bh(a,l,d),i=c}else for(s=0;s<r.length;s++){if(l=r[s],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&a.isPropagationStopped())break e;bh(a,l,d),i=c}}}if(Js)throw e=Ed,Js=!1,Ed=null,e}function Yt(e,t){var o=t[zd];o===void 0&&(o=t[zd]=new Set);var r=e+"__bubble";o.has(r)||(Af(t,e,2,!1),o.add(r))}function Dc(e,t,o){var r=0;t&&(r|=4),Af(o,e,r,t)}var ts="_reactListening"+Math.random().toString(36).slice(2);function Si(e){if(!e[ts]){e[ts]=!0,q0.forEach(function(o){o!=="selectionchange"&&(Bv.has(o)||Dc(o,!1,e),Dc(o,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[ts]||(t[ts]=!0,Dc("selectionchange",!1,t))}}function Af(e,t,o,r){switch(gf(t)){case 1:var a=tv;break;case 4:a=nv;break;default:a=Gu}o=a.bind(null,t,o,e),a=void 0,!Nd||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),r?a!==void 0?e.addEventListener(t,o,{capture:!0,passive:a}):e.addEventListener(t,o,!0):a!==void 0?e.addEventListener(t,o,{passive:a}):e.addEventListener(t,o,!1)}function zc(e,t,o,r,a){var i=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var l=r.stateNode.containerInfo;if(l===a||l.nodeType===8&&l.parentNode===a)break;if(s===4)for(s=r.return;s!==null;){var c=s.tag;if((c===3||c===4)&&(c=s.stateNode.containerInfo,c===a||c.nodeType===8&&c.parentNode===a))return;s=s.return}for(;l!==null;){if(s=Mr(l),s===null)return;if(c=s.tag,c===5||c===6){r=i=s;continue e}l=l.parentNode}}r=r.return}ef(function(){var d=i,u=Ou(o),p=[];e:{var h=Tf.get(e);if(h!==void 0){var w=Vu,k=e;switch(e){case"keypress":if(As(o)===0)break e;case"keydown":case"keyup":w=xv;break;case"focusin":k="focus",w=Tc;break;case"focusout":k="blur",w=Tc;break;case"beforeblur":case"afterblur":w=Tc;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":w=ch;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":w=av;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":w=wv;break;case Nf:case Ef:case Pf:w=lv;break;case jf:w=Cv;break;case"scroll":w=ov;break;case"wheel":w=_v;break;case"copy":case"cut":case"paste":w=dv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":w=uh}var b=(t&4)!==0,y=!b&&e==="scroll",g=b?h!==null?h+"Capture":null:h;b=[];for(var m=d,x;m!==null;){x=m;var _=x.stateNode;if(x.tag===5&&_!==null&&(x=_,g!==null&&(_=vi(m,g),_!=null&&b.push(Ni(m,_,x)))),y)break;m=m.return}0<b.length&&(h=new w(h,k,null,o,u),p.push({event:h,listeners:b}))}}if(!(t&7)){e:{if(h=e==="mouseover"||e==="pointerover",w=e==="mouseout"||e==="pointerout",h&&o!==_d&&(k=o.relatedTarget||o.fromElement)&&(Mr(k)||k[Uo]))break e;if((w||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,w?(k=o.relatedTarget||o.toElement,w=d,k=k?Mr(k):null,k!==null&&(y=Vr(k),k!==y||k.tag!==5&&k.tag!==6)&&(k=null)):(w=null,k=d),w!==k)){if(b=ch,_="onMouseLeave",g="onMouseEnter",m="mouse",(e==="pointerout"||e==="pointerover")&&(b=uh,_="onPointerLeave",g="onPointerEnter",m="pointer"),y=w==null?h:ca(w),x=k==null?h:ca(k),h=new b(_,m+"leave",w,o,u),h.target=y,h.relatedTarget=x,_=null,Mr(u)===d&&(b=new b(g,m+"enter",k,o,u),b.target=x,b.relatedTarget=y,_=b),y=_,w&&k)t:{for(b=w,g=k,m=0,x=b;x;x=$r(x))m++;for(x=0,_=g;_;_=$r(_))x++;for(;0<m-x;)b=$r(b),m--;for(;0<x-m;)g=$r(g),x--;for(;m--;){if(b===g||g!==null&&b===g.alternate)break t;b=$r(b),g=$r(g)}b=null}else b=null;w!==null&&Ch(p,h,w,b,!1),k!==null&&y!==null&&Ch(p,y,k,b,!0)}}e:{if(h=d?ca(d):window,w=h.nodeName&&h.nodeName.toLowerCase(),w==="select"||w==="input"&&h.type==="file")var S=Iv;else if(mh(h))if(bf)S=Lv;else{S=Mv;var P=Av}else(w=h.nodeName)&&w.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(S=Rv);if(S&&(S=S(e,d))){wf(p,S,o,u);break e}P&&P(e,h,d),e==="focusout"&&(P=h._wrapperState)&&P.controlled&&h.type==="number"&&vd(h,"number",h.value)}switch(P=d?ca(d):window,e){case"focusin":(mh(P)||P.contentEditable==="true")&&(sa=P,Id=d,pi=null);break;case"focusout":pi=Id=sa=null;break;case"mousedown":Ad=!0;break;case"contextmenu":case"mouseup":case"dragend":Ad=!1,vh(p,o,u);break;case"selectionchange":if(qv)break;case"keydown":case"keyup":vh(p,o,u)}var j;if($u)e:{switch(e){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else ia?yf(e,o)&&(M="onCompositionEnd"):e==="keydown"&&o.keyCode===229&&(M="onCompositionStart");M&&(xf&&o.locale!=="ko"&&(ia||M!=="onCompositionStart"?M==="onCompositionEnd"&&ia&&(j=ff()):(cr=u,Uu="value"in cr?cr.value:cr.textContent,ia=!0)),P=el(d,M),0<P.length&&(M=new dh(M,e,null,o,u),p.push({event:M,listeners:P}),j?M.data=j:(j=vf(o),j!==null&&(M.data=j)))),(j=Nv?Ev(e,o):Pv(e,o))&&(d=el(d,"onBeforeInput"),0<d.length&&(u=new dh("onBeforeInput","beforeinput",null,o,u),p.push({event:u,listeners:d}),u.data=j))}If(p,t)})}function Ni(e,t,o){return{instance:e,listener:t,currentTarget:o}}function el(e,t){for(var o=t+"Capture",r=[];e!==null;){var a=e,i=a.stateNode;a.tag===5&&i!==null&&(a=i,i=vi(e,o),i!=null&&r.unshift(Ni(e,i,a)),i=vi(e,t),i!=null&&r.push(Ni(e,i,a))),e=e.return}return r}function $r(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Ch(e,t,o,r,a){for(var i=t._reactName,s=[];o!==null&&o!==r;){var l=o,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,a?(c=vi(o,i),c!=null&&s.unshift(Ni(o,c,l))):a||(c=vi(o,i),c!=null&&s.push(Ni(o,c,l)))),o=o.return}s.length!==0&&e.push({event:t,listeners:s})}var Hv=/\r\n?/g,Gv=/\u0000|\uFFFD/g;function kh(e){return(typeof e=="string"?e:""+e).replace(Hv,`
`).replace(Gv,"")}function ns(e,t,o){if(t=kh(t),kh(e)!==t&&o)throw Error(nt(425))}function tl(){}var Md=null,Rd=null;function Ld(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Dd=typeof setTimeout=="function"?setTimeout:void 0,Uv=typeof clearTimeout=="function"?clearTimeout:void 0,_h=typeof Promise=="function"?Promise:void 0,Vv=typeof queueMicrotask=="function"?queueMicrotask:typeof _h<"u"?function(e){return _h.resolve(null).then(e).catch(Wv)}:Dd;function Wv(e){setTimeout(function(){throw e})}function qc(e,t){var o=t,r=0;do{var a=o.nextSibling;if(e.removeChild(o),a&&a.nodeType===8)if(o=a.data,o==="/$"){if(r===0){e.removeChild(a),Ci(t);return}r--}else o!=="$"&&o!=="$?"&&o!=="$!"||r++;o=a}while(o);Ci(t)}function mr(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Sh(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var o=e.data;if(o==="$"||o==="$!"||o==="$?"){if(t===0)return e;t--}else o==="/$"&&t++}e=e.previousSibling}return null}var Fa=Math.random().toString(36).slice(2),Eo="__reactFiber$"+Fa,Ei="__reactProps$"+Fa,Uo="__reactContainer$"+Fa,zd="__reactEvents$"+Fa,$v="__reactListeners$"+Fa,Kv="__reactHandles$"+Fa;function Mr(e){var t=e[Eo];if(t)return t;for(var o=e.parentNode;o;){if(t=o[Uo]||o[Eo]){if(o=t.alternate,t.child!==null||o!==null&&o.child!==null)for(e=Sh(e);e!==null;){if(o=e[Eo])return o;e=Sh(e)}return t}e=o,o=e.parentNode}return null}function Oi(e){return e=e[Eo]||e[Uo],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ca(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(nt(33))}function Rl(e){return e[Ei]||null}var qd=[],da=-1;function _r(e){return{current:e}}function Zt(e){0>da||(e.current=qd[da],qd[da]=null,da--)}function Kt(e,t){da++,qd[da]=e.current,e.current=t}var br={},jn=_r(br),Un=_r(!1),Or=br;function Pa(e,t){var o=e.type.contextTypes;if(!o)return br;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a={},i;for(i in o)a[i]=t[i];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Vn(e){return e=e.childContextTypes,e!=null}function nl(){Zt(Un),Zt(jn)}function Nh(e,t,o){if(jn.current!==br)throw Error(nt(168));Kt(jn,t),Kt(Un,o)}function Mf(e,t,o){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return o;r=r.getChildContext();for(var a in r)if(!(a in t))throw Error(nt(108,A2(e)||"Unknown",a));return tn({},o,r)}function ol(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||br,Or=jn.current,Kt(jn,e),Kt(Un,Un.current),!0}function Eh(e,t,o){var r=e.stateNode;if(!r)throw Error(nt(169));o?(e=Mf(e,t,Or),r.__reactInternalMemoizedMergedChildContext=e,Zt(Un),Zt(jn),Kt(jn,e)):Zt(Un),Kt(Un,o)}var Oo=null,Ll=!1,Oc=!1;function Rf(e){Oo===null?Oo=[e]:Oo.push(e)}function Jv(e){Ll=!0,Rf(e)}function Sr(){if(!Oc&&Oo!==null){Oc=!0;var e=0,t=Bt;try{var o=Oo;for(Bt=1;e<o.length;e++){var r=o[e];do r=r(!0);while(r!==null)}Oo=null,Ll=!1}catch(a){throw Oo!==null&&(Oo=Oo.slice(e+1)),rf(Fu,Sr),a}finally{Bt=t,Oc=!1}}return null}var ua=[],pa=0,rl=null,al=0,no=[],oo=0,Fr=null,Fo=1,Bo="";function jr(e,t){ua[pa++]=al,ua[pa++]=rl,rl=e,al=t}function Lf(e,t,o){no[oo++]=Fo,no[oo++]=Bo,no[oo++]=Fr,Fr=e;var r=Fo;e=Bo;var a=32-xo(r)-1;r&=~(1<<a),o+=1;var i=32-xo(t)+a;if(30<i){var s=a-a%5;i=(r&(1<<s)-1).toString(32),r>>=s,a-=s,Fo=1<<32-xo(t)+a|o<<a|r,Bo=i+e}else Fo=1<<i|o<<a|r,Bo=e}function Ju(e){e.return!==null&&(jr(e,1),Lf(e,1,0))}function Yu(e){for(;e===rl;)rl=ua[--pa],ua[pa]=null,al=ua[--pa],ua[pa]=null;for(;e===Fr;)Fr=no[--oo],no[oo]=null,Bo=no[--oo],no[oo]=null,Fo=no[--oo],no[oo]=null}var Zn=null,Jn=null,Xt=!1,fo=null;function Df(e,t){var o=ro(5,null,null,0);o.elementType="DELETED",o.stateNode=t,o.return=e,t=e.deletions,t===null?(e.deletions=[o],e.flags|=16):t.push(o)}function Ph(e,t){switch(e.tag){case 5:var o=e.type;return t=t.nodeType!==1||o.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Zn=e,Jn=mr(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Zn=e,Jn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(o=Fr!==null?{id:Fo,overflow:Bo}:null,e.memoizedState={dehydrated:t,treeContext:o,retryLane:1073741824},o=ro(18,null,null,0),o.stateNode=t,o.return=e,e.child=o,Zn=e,Jn=null,!0):!1;default:return!1}}function Od(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Fd(e){if(Xt){var t=Jn;if(t){var o=t;if(!Ph(e,t)){if(Od(e))throw Error(nt(418));t=mr(o.nextSibling);var r=Zn;t&&Ph(e,t)?Df(r,o):(e.flags=e.flags&-4097|2,Xt=!1,Zn=e)}}else{if(Od(e))throw Error(nt(418));e.flags=e.flags&-4097|2,Xt=!1,Zn=e}}}function jh(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Zn=e}function os(e){if(e!==Zn)return!1;if(!Xt)return jh(e),Xt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Ld(e.type,e.memoizedProps)),t&&(t=Jn)){if(Od(e))throw zf(),Error(nt(418));for(;t;)Df(e,t),t=mr(t.nextSibling)}if(jh(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(nt(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var o=e.data;if(o==="/$"){if(t===0){Jn=mr(e.nextSibling);break e}t--}else o!=="$"&&o!=="$!"&&o!=="$?"||t++}e=e.nextSibling}Jn=null}}else Jn=Zn?mr(e.stateNode.nextSibling):null;return!0}function zf(){for(var e=Jn;e;)e=mr(e.nextSibling)}function ja(){Jn=Zn=null,Xt=!1}function Zu(e){fo===null?fo=[e]:fo.push(e)}var Yv=Ko.ReactCurrentBatchConfig;function Za(e,t,o){if(e=o.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(nt(309));var r=o.stateNode}if(!r)throw Error(nt(147,e));var a=r,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(s){var l=a.refs;s===null?delete l[i]:l[i]=s},t._stringRef=i,t)}if(typeof e!="string")throw Error(nt(284));if(!o._owner)throw Error(nt(290,e))}return e}function rs(e,t){throw e=Object.prototype.toString.call(t),Error(nt(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Th(e){var t=e._init;return t(e._payload)}function qf(e){function t(g,m){if(e){var x=g.deletions;x===null?(g.deletions=[m],g.flags|=16):x.push(m)}}function o(g,m){if(!e)return null;for(;m!==null;)t(g,m),m=m.sibling;return null}function r(g,m){for(g=new Map;m!==null;)m.key!==null?g.set(m.key,m):g.set(m.index,m),m=m.sibling;return g}function a(g,m){return g=yr(g,m),g.index=0,g.sibling=null,g}function i(g,m,x){return g.index=x,e?(x=g.alternate,x!==null?(x=x.index,x<m?(g.flags|=2,m):x):(g.flags|=2,m)):(g.flags|=1048576,m)}function s(g){return e&&g.alternate===null&&(g.flags|=2),g}function l(g,m,x,_){return m===null||m.tag!==6?(m=Wc(x,g.mode,_),m.return=g,m):(m=a(m,x),m.return=g,m)}function c(g,m,x,_){var S=x.type;return S===aa?u(g,m,x.props.children,_,x.key):m!==null&&(m.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===ar&&Th(S)===m.type)?(_=a(m,x.props),_.ref=Za(g,m,x),_.return=g,_):(_=Os(x.type,x.key,x.props,null,g.mode,_),_.ref=Za(g,m,x),_.return=g,_)}function d(g,m,x,_){return m===null||m.tag!==4||m.stateNode.containerInfo!==x.containerInfo||m.stateNode.implementation!==x.implementation?(m=$c(x,g.mode,_),m.return=g,m):(m=a(m,x.children||[]),m.return=g,m)}function u(g,m,x,_,S){return m===null||m.tag!==7?(m=zr(x,g.mode,_,S),m.return=g,m):(m=a(m,x),m.return=g,m)}function p(g,m,x){if(typeof m=="string"&&m!==""||typeof m=="number")return m=Wc(""+m,g.mode,x),m.return=g,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case $i:return x=Os(m.type,m.key,m.props,null,g.mode,x),x.ref=Za(g,null,m),x.return=g,x;case ra:return m=$c(m,g.mode,x),m.return=g,m;case ar:var _=m._init;return p(g,_(m._payload),x)}if(oi(m)||Wa(m))return m=zr(m,g.mode,x,null),m.return=g,m;rs(g,m)}return null}function h(g,m,x,_){var S=m!==null?m.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return S!==null?null:l(g,m,""+x,_);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case $i:return x.key===S?c(g,m,x,_):null;case ra:return x.key===S?d(g,m,x,_):null;case ar:return S=x._init,h(g,m,S(x._payload),_)}if(oi(x)||Wa(x))return S!==null?null:u(g,m,x,_,null);rs(g,x)}return null}function w(g,m,x,_,S){if(typeof _=="string"&&_!==""||typeof _=="number")return g=g.get(x)||null,l(m,g,""+_,S);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case $i:return g=g.get(_.key===null?x:_.key)||null,c(m,g,_,S);case ra:return g=g.get(_.key===null?x:_.key)||null,d(m,g,_,S);case ar:var P=_._init;return w(g,m,x,P(_._payload),S)}if(oi(_)||Wa(_))return g=g.get(x)||null,u(m,g,_,S,null);rs(m,_)}return null}function k(g,m,x,_){for(var S=null,P=null,j=m,M=m=0,D=null;j!==null&&M<x.length;M++){j.index>M?(D=j,j=null):D=j.sibling;var O=h(g,j,x[M],_);if(O===null){j===null&&(j=D);break}e&&j&&O.alternate===null&&t(g,j),m=i(O,m,M),P===null?S=O:P.sibling=O,P=O,j=D}if(M===x.length)return o(g,j),Xt&&jr(g,M),S;if(j===null){for(;M<x.length;M++)j=p(g,x[M],_),j!==null&&(m=i(j,m,M),P===null?S=j:P.sibling=j,P=j);return Xt&&jr(g,M),S}for(j=r(g,j);M<x.length;M++)D=w(j,g,M,x[M],_),D!==null&&(e&&D.alternate!==null&&j.delete(D.key===null?M:D.key),m=i(D,m,M),P===null?S=D:P.sibling=D,P=D);return e&&j.forEach(function(B){return t(g,B)}),Xt&&jr(g,M),S}function b(g,m,x,_){var S=Wa(x);if(typeof S!="function")throw Error(nt(150));if(x=S.call(x),x==null)throw Error(nt(151));for(var P=S=null,j=m,M=m=0,D=null,O=x.next();j!==null&&!O.done;M++,O=x.next()){j.index>M?(D=j,j=null):D=j.sibling;var B=h(g,j,O.value,_);if(B===null){j===null&&(j=D);break}e&&j&&B.alternate===null&&t(g,j),m=i(B,m,M),P===null?S=B:P.sibling=B,P=B,j=D}if(O.done)return o(g,j),Xt&&jr(g,M),S;if(j===null){for(;!O.done;M++,O=x.next())O=p(g,O.value,_),O!==null&&(m=i(O,m,M),P===null?S=O:P.sibling=O,P=O);return Xt&&jr(g,M),S}for(j=r(g,j);!O.done;M++,O=x.next())O=w(j,g,M,O.value,_),O!==null&&(e&&O.alternate!==null&&j.delete(O.key===null?M:O.key),m=i(O,m,M),P===null?S=O:P.sibling=O,P=O);return e&&j.forEach(function(E){return t(g,E)}),Xt&&jr(g,M),S}function y(g,m,x,_){if(typeof x=="object"&&x!==null&&x.type===aa&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case $i:e:{for(var S=x.key,P=m;P!==null;){if(P.key===S){if(S=x.type,S===aa){if(P.tag===7){o(g,P.sibling),m=a(P,x.props.children),m.return=g,g=m;break e}}else if(P.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===ar&&Th(S)===P.type){o(g,P.sibling),m=a(P,x.props),m.ref=Za(g,P,x),m.return=g,g=m;break e}o(g,P);break}else t(g,P);P=P.sibling}x.type===aa?(m=zr(x.props.children,g.mode,_,x.key),m.return=g,g=m):(_=Os(x.type,x.key,x.props,null,g.mode,_),_.ref=Za(g,m,x),_.return=g,g=_)}return s(g);case ra:e:{for(P=x.key;m!==null;){if(m.key===P)if(m.tag===4&&m.stateNode.containerInfo===x.containerInfo&&m.stateNode.implementation===x.implementation){o(g,m.sibling),m=a(m,x.children||[]),m.return=g,g=m;break e}else{o(g,m);break}else t(g,m);m=m.sibling}m=$c(x,g.mode,_),m.return=g,g=m}return s(g);case ar:return P=x._init,y(g,m,P(x._payload),_)}if(oi(x))return k(g,m,x,_);if(Wa(x))return b(g,m,x,_);rs(g,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,m!==null&&m.tag===6?(o(g,m.sibling),m=a(m,x),m.return=g,g=m):(o(g,m),m=Wc(x,g.mode,_),m.return=g,g=m),s(g)):o(g,m)}return y}var Ta=qf(!0),Of=qf(!1),il=_r(null),sl=null,ha=null,Xu=null;function Qu(){Xu=ha=sl=null}function ep(e){var t=il.current;Zt(il),e._currentValue=t}function Bd(e,t,o){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===o)break;e=e.return}}function Ca(e,t){sl=e,Xu=ha=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Hn=!0),e.firstContext=null)}function so(e){var t=e._currentValue;if(Xu!==e)if(e={context:e,memoizedValue:t,next:null},ha===null){if(sl===null)throw Error(nt(308));ha=e,sl.dependencies={lanes:0,firstContext:e}}else ha=ha.next=e;return t}var Rr=null;function tp(e){Rr===null?Rr=[e]:Rr.push(e)}function Ff(e,t,o,r){var a=t.interleaved;return a===null?(o.next=o,tp(t)):(o.next=a.next,a.next=o),t.interleaved=o,Vo(e,r)}function Vo(e,t){e.lanes|=t;var o=e.alternate;for(o!==null&&(o.lanes|=t),o=e,e=e.return;e!==null;)e.childLanes|=t,o=e.alternate,o!==null&&(o.childLanes|=t),o=e,e=e.return;return o.tag===3?o.stateNode:null}var ir=!1;function np(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Bf(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ho(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function gr(e,t,o){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Mt&2){var a=r.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Vo(e,o)}return a=r.interleaved,a===null?(t.next=t,tp(r)):(t.next=a.next,a.next=t),r.interleaved=t,Vo(e,o)}function Ms(e,t,o){if(t=t.updateQueue,t!==null&&(t=t.shared,(o&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,o|=r,t.lanes=o,Bu(e,o)}}function Ih(e,t){var o=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,o===r)){var a=null,i=null;if(o=o.firstBaseUpdate,o!==null){do{var s={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};i===null?a=i=s:i=i.next=s,o=o.next}while(o!==null);i===null?a=i=t:i=i.next=t}else a=i=t;o={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},e.updateQueue=o;return}e=o.lastBaseUpdate,e===null?o.firstBaseUpdate=t:e.next=t,o.lastBaseUpdate=t}function ll(e,t,o,r){var a=e.updateQueue;ir=!1;var i=a.firstBaseUpdate,s=a.lastBaseUpdate,l=a.shared.pending;if(l!==null){a.shared.pending=null;var c=l,d=c.next;c.next=null,s===null?i=d:s.next=d,s=c;var u=e.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==s&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(i!==null){var p=a.baseState;s=0,u=d=c=null,l=i;do{var h=l.lane,w=l.eventTime;if((r&h)===h){u!==null&&(u=u.next={eventTime:w,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var k=e,b=l;switch(h=t,w=o,b.tag){case 1:if(k=b.payload,typeof k=="function"){p=k.call(w,p,h);break e}p=k;break e;case 3:k.flags=k.flags&-65537|128;case 0:if(k=b.payload,h=typeof k=="function"?k.call(w,p,h):k,h==null)break e;p=tn({},p,h);break e;case 2:ir=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,h=a.effects,h===null?a.effects=[l]:h.push(l))}else w={eventTime:w,lane:h,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=w,c=p):u=u.next=w,s|=h;if(l=l.next,l===null){if(l=a.shared.pending,l===null)break;h=l,l=h.next,h.next=null,a.lastBaseUpdate=h,a.shared.pending=null}}while(!0);if(u===null&&(c=p),a.baseState=c,a.firstBaseUpdate=d,a.lastBaseUpdate=u,t=a.shared.interleaved,t!==null){a=t;do s|=a.lane,a=a.next;while(a!==t)}else i===null&&(a.shared.lanes=0);Hr|=s,e.lanes=s,e.memoizedState=p}}function Ah(e,t,o){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(a!==null){if(r.callback=null,r=o,typeof a!="function")throw Error(nt(191,a));a.call(r)}}}var Fi={},Io=_r(Fi),Pi=_r(Fi),ji=_r(Fi);function Lr(e){if(e===Fi)throw Error(nt(174));return e}function op(e,t){switch(Kt(ji,t),Kt(Pi,e),Kt(Io,Fi),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:bd(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=bd(t,e)}Zt(Io),Kt(Io,t)}function Ia(){Zt(Io),Zt(Pi),Zt(ji)}function Hf(e){Lr(ji.current);var t=Lr(Io.current),o=bd(t,e.type);t!==o&&(Kt(Pi,e),Kt(Io,o))}function rp(e){Pi.current===e&&(Zt(Io),Zt(Pi))}var Qt=_r(0);function cl(e){for(var t=e;t!==null;){if(t.tag===13){var o=t.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Fc=[];function ap(){for(var e=0;e<Fc.length;e++)Fc[e]._workInProgressVersionPrimary=null;Fc.length=0}var Rs=Ko.ReactCurrentDispatcher,Bc=Ko.ReactCurrentBatchConfig,Br=0,en=null,un=null,gn=null,dl=!1,hi=!1,Ti=0,Zv=0;function _n(){throw Error(nt(321))}function ip(e,t){if(t===null)return!1;for(var o=0;o<t.length&&o<e.length;o++)if(!bo(e[o],t[o]))return!1;return!0}function sp(e,t,o,r,a,i){if(Br=i,en=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Rs.current=e===null||e.memoizedState===null?tw:nw,e=o(r,a),hi){i=0;do{if(hi=!1,Ti=0,25<=i)throw Error(nt(301));i+=1,gn=un=null,t.updateQueue=null,Rs.current=ow,e=o(r,a)}while(hi)}if(Rs.current=ul,t=un!==null&&un.next!==null,Br=0,gn=un=en=null,dl=!1,t)throw Error(nt(300));return e}function lp(){var e=Ti!==0;return Ti=0,e}function No(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gn===null?en.memoizedState=gn=e:gn=gn.next=e,gn}function lo(){if(un===null){var e=en.alternate;e=e!==null?e.memoizedState:null}else e=un.next;var t=gn===null?en.memoizedState:gn.next;if(t!==null)gn=t,un=e;else{if(e===null)throw Error(nt(310));un=e,e={memoizedState:un.memoizedState,baseState:un.baseState,baseQueue:un.baseQueue,queue:un.queue,next:null},gn===null?en.memoizedState=gn=e:gn=gn.next=e}return gn}function Ii(e,t){return typeof t=="function"?t(e):t}function Hc(e){var t=lo(),o=t.queue;if(o===null)throw Error(nt(311));o.lastRenderedReducer=e;var r=un,a=r.baseQueue,i=o.pending;if(i!==null){if(a!==null){var s=a.next;a.next=i.next,i.next=s}r.baseQueue=a=i,o.pending=null}if(a!==null){i=a.next,r=r.baseState;var l=s=null,c=null,d=i;do{var u=d.lane;if((Br&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:e(r,d.action);else{var p={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=p,s=r):c=c.next=p,en.lanes|=u,Hr|=u}d=d.next}while(d!==null&&d!==i);c===null?s=r:c.next=l,bo(r,t.memoizedState)||(Hn=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,o.lastRenderedState=r}if(e=o.interleaved,e!==null){a=e;do i=a.lane,en.lanes|=i,Hr|=i,a=a.next;while(a!==e)}else a===null&&(o.lanes=0);return[t.memoizedState,o.dispatch]}function Gc(e){var t=lo(),o=t.queue;if(o===null)throw Error(nt(311));o.lastRenderedReducer=e;var r=o.dispatch,a=o.pending,i=t.memoizedState;if(a!==null){o.pending=null;var s=a=a.next;do i=e(i,s.action),s=s.next;while(s!==a);bo(i,t.memoizedState)||(Hn=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),o.lastRenderedState=i}return[i,r]}function Gf(){}function Uf(e,t){var o=en,r=lo(),a=t(),i=!bo(r.memoizedState,a);if(i&&(r.memoizedState=a,Hn=!0),r=r.queue,cp($f.bind(null,o,r,e),[e]),r.getSnapshot!==t||i||gn!==null&&gn.memoizedState.tag&1){if(o.flags|=2048,Ai(9,Wf.bind(null,o,r,a,t),void 0,null),xn===null)throw Error(nt(349));Br&30||Vf(o,t,a)}return a}function Vf(e,t,o){e.flags|=16384,e={getSnapshot:t,value:o},t=en.updateQueue,t===null?(t={lastEffect:null,stores:null},en.updateQueue=t,t.stores=[e]):(o=t.stores,o===null?t.stores=[e]:o.push(e))}function Wf(e,t,o,r){t.value=o,t.getSnapshot=r,Kf(t)&&Jf(e)}function $f(e,t,o){return o(function(){Kf(t)&&Jf(e)})}function Kf(e){var t=e.getSnapshot;e=e.value;try{var o=t();return!bo(e,o)}catch{return!0}}function Jf(e){var t=Vo(e,1);t!==null&&yo(t,e,1,-1)}function Mh(e){var t=No();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ii,lastRenderedState:e},t.queue=e,e=e.dispatch=ew.bind(null,en,e),[t.memoizedState,e]}function Ai(e,t,o,r){return e={tag:e,create:t,destroy:o,deps:r,next:null},t=en.updateQueue,t===null?(t={lastEffect:null,stores:null},en.updateQueue=t,t.lastEffect=e.next=e):(o=t.lastEffect,o===null?t.lastEffect=e.next=e:(r=o.next,o.next=e,e.next=r,t.lastEffect=e)),e}function Yf(){return lo().memoizedState}function Ls(e,t,o,r){var a=No();en.flags|=e,a.memoizedState=Ai(1|t,o,void 0,r===void 0?null:r)}function Dl(e,t,o,r){var a=lo();r=r===void 0?null:r;var i=void 0;if(un!==null){var s=un.memoizedState;if(i=s.destroy,r!==null&&ip(r,s.deps)){a.memoizedState=Ai(t,o,i,r);return}}en.flags|=e,a.memoizedState=Ai(1|t,o,i,r)}function Rh(e,t){return Ls(8390656,8,e,t)}function cp(e,t){return Dl(2048,8,e,t)}function Zf(e,t){return Dl(4,2,e,t)}function Xf(e,t){return Dl(4,4,e,t)}function Qf(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function ex(e,t,o){return o=o!=null?o.concat([e]):null,Dl(4,4,Qf.bind(null,t,e),o)}function dp(){}function tx(e,t){var o=lo();t=t===void 0?null:t;var r=o.memoizedState;return r!==null&&t!==null&&ip(t,r[1])?r[0]:(o.memoizedState=[e,t],e)}function nx(e,t){var o=lo();t=t===void 0?null:t;var r=o.memoizedState;return r!==null&&t!==null&&ip(t,r[1])?r[0]:(e=e(),o.memoizedState=[e,t],e)}function ox(e,t,o){return Br&21?(bo(o,t)||(o=lf(),en.lanes|=o,Hr|=o,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Hn=!0),e.memoizedState=o)}function Xv(e,t){var o=Bt;Bt=o!==0&&4>o?o:4,e(!0);var r=Bc.transition;Bc.transition={};try{e(!1),t()}finally{Bt=o,Bc.transition=r}}function rx(){return lo().memoizedState}function Qv(e,t,o){var r=xr(e);if(o={lane:r,action:o,hasEagerState:!1,eagerState:null,next:null},ax(e))ix(t,o);else if(o=Ff(e,t,o,r),o!==null){var a=Mn();yo(o,e,r,a),sx(o,t,r)}}function ew(e,t,o){var r=xr(e),a={lane:r,action:o,hasEagerState:!1,eagerState:null,next:null};if(ax(e))ix(t,a);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var s=t.lastRenderedState,l=i(s,o);if(a.hasEagerState=!0,a.eagerState=l,bo(l,s)){var c=t.interleaved;c===null?(a.next=a,tp(t)):(a.next=c.next,c.next=a),t.interleaved=a;return}}catch{}finally{}o=Ff(e,t,a,r),o!==null&&(a=Mn(),yo(o,e,r,a),sx(o,t,r))}}function ax(e){var t=e.alternate;return e===en||t!==null&&t===en}function ix(e,t){hi=dl=!0;var o=e.pending;o===null?t.next=t:(t.next=o.next,o.next=t),e.pending=t}function sx(e,t,o){if(o&4194240){var r=t.lanes;r&=e.pendingLanes,o|=r,t.lanes=o,Bu(e,o)}}var ul={readContext:so,useCallback:_n,useContext:_n,useEffect:_n,useImperativeHandle:_n,useInsertionEffect:_n,useLayoutEffect:_n,useMemo:_n,useReducer:_n,useRef:_n,useState:_n,useDebugValue:_n,useDeferredValue:_n,useTransition:_n,useMutableSource:_n,useSyncExternalStore:_n,useId:_n,unstable_isNewReconciler:!1},tw={readContext:so,useCallback:function(e,t){return No().memoizedState=[e,t===void 0?null:t],e},useContext:so,useEffect:Rh,useImperativeHandle:function(e,t,o){return o=o!=null?o.concat([e]):null,Ls(4194308,4,Qf.bind(null,t,e),o)},useLayoutEffect:function(e,t){return Ls(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ls(4,2,e,t)},useMemo:function(e,t){var o=No();return t=t===void 0?null:t,e=e(),o.memoizedState=[e,t],e},useReducer:function(e,t,o){var r=No();return t=o!==void 0?o(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Qv.bind(null,en,e),[r.memoizedState,e]},useRef:function(e){var t=No();return e={current:e},t.memoizedState=e},useState:Mh,useDebugValue:dp,useDeferredValue:function(e){return No().memoizedState=e},useTransition:function(){var e=Mh(!1),t=e[0];return e=Xv.bind(null,e[1]),No().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,o){var r=en,a=No();if(Xt){if(o===void 0)throw Error(nt(407));o=o()}else{if(o=t(),xn===null)throw Error(nt(349));Br&30||Vf(r,t,o)}a.memoizedState=o;var i={value:o,getSnapshot:t};return a.queue=i,Rh($f.bind(null,r,i,e),[e]),r.flags|=2048,Ai(9,Wf.bind(null,r,i,o,t),void 0,null),o},useId:function(){var e=No(),t=xn.identifierPrefix;if(Xt){var o=Bo,r=Fo;o=(r&~(1<<32-xo(r)-1)).toString(32)+o,t=":"+t+"R"+o,o=Ti++,0<o&&(t+="H"+o.toString(32)),t+=":"}else o=Zv++,t=":"+t+"r"+o.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},nw={readContext:so,useCallback:tx,useContext:so,useEffect:cp,useImperativeHandle:ex,useInsertionEffect:Zf,useLayoutEffect:Xf,useMemo:nx,useReducer:Hc,useRef:Yf,useState:function(){return Hc(Ii)},useDebugValue:dp,useDeferredValue:function(e){var t=lo();return ox(t,un.memoizedState,e)},useTransition:function(){var e=Hc(Ii)[0],t=lo().memoizedState;return[e,t]},useMutableSource:Gf,useSyncExternalStore:Uf,useId:rx,unstable_isNewReconciler:!1},ow={readContext:so,useCallback:tx,useContext:so,useEffect:cp,useImperativeHandle:ex,useInsertionEffect:Zf,useLayoutEffect:Xf,useMemo:nx,useReducer:Gc,useRef:Yf,useState:function(){return Gc(Ii)},useDebugValue:dp,useDeferredValue:function(e){var t=lo();return un===null?t.memoizedState=e:ox(t,un.memoizedState,e)},useTransition:function(){var e=Gc(Ii)[0],t=lo().memoizedState;return[e,t]},useMutableSource:Gf,useSyncExternalStore:Uf,useId:rx,unstable_isNewReconciler:!1};function mo(e,t){if(e&&e.defaultProps){t=tn({},t),e=e.defaultProps;for(var o in e)t[o]===void 0&&(t[o]=e[o]);return t}return t}function Hd(e,t,o,r){t=e.memoizedState,o=o(r,t),o=o==null?t:tn({},t,o),e.memoizedState=o,e.lanes===0&&(e.updateQueue.baseState=o)}var zl={isMounted:function(e){return(e=e._reactInternals)?Vr(e)===e:!1},enqueueSetState:function(e,t,o){e=e._reactInternals;var r=Mn(),a=xr(e),i=Ho(r,a);i.payload=t,o!=null&&(i.callback=o),t=gr(e,i,a),t!==null&&(yo(t,e,a,r),Ms(t,e,a))},enqueueReplaceState:function(e,t,o){e=e._reactInternals;var r=Mn(),a=xr(e),i=Ho(r,a);i.tag=1,i.payload=t,o!=null&&(i.callback=o),t=gr(e,i,a),t!==null&&(yo(t,e,a,r),Ms(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var o=Mn(),r=xr(e),a=Ho(o,r);a.tag=2,t!=null&&(a.callback=t),t=gr(e,a,r),t!==null&&(yo(t,e,r,o),Ms(t,e,r))}};function Lh(e,t,o,r,a,i,s){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,i,s):t.prototype&&t.prototype.isPureReactComponent?!_i(o,r)||!_i(a,i):!0}function lx(e,t,o){var r=!1,a=br,i=t.contextType;return typeof i=="object"&&i!==null?i=so(i):(a=Vn(t)?Or:jn.current,r=t.contextTypes,i=(r=r!=null)?Pa(e,a):br),t=new t(o,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=zl,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function Dh(e,t,o,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(o,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(o,r),t.state!==e&&zl.enqueueReplaceState(t,t.state,null)}function Gd(e,t,o,r){var a=e.stateNode;a.props=o,a.state=e.memoizedState,a.refs={},np(e);var i=t.contextType;typeof i=="object"&&i!==null?a.context=so(i):(i=Vn(t)?Or:jn.current,a.context=Pa(e,i)),a.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(Hd(e,t,i,o),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&zl.enqueueReplaceState(a,a.state,null),ll(e,o,a,r),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function Aa(e,t){try{var o="",r=t;do o+=I2(r),r=r.return;while(r);var a=o}catch(i){a=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:a,digest:null}}function Uc(e,t,o){return{value:e,source:null,stack:o??null,digest:t??null}}function Ud(e,t){try{console.error(t.value)}catch(o){setTimeout(function(){throw o})}}var rw=typeof WeakMap=="function"?WeakMap:Map;function cx(e,t,o){o=Ho(-1,o),o.tag=3,o.payload={element:null};var r=t.value;return o.callback=function(){hl||(hl=!0,eu=r),Ud(e,t)},o}function dx(e,t,o){o=Ho(-1,o),o.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var a=t.value;o.payload=function(){return r(a)},o.callback=function(){Ud(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(o.callback=function(){Ud(e,t),typeof r!="function"&&(fr===null?fr=new Set([this]):fr.add(this));var s=t.stack;this.componentDidCatch(t.value,{componentStack:s!==null?s:""})}),o}function zh(e,t,o){var r=e.pingCache;if(r===null){r=e.pingCache=new rw;var a=new Set;r.set(t,a)}else a=r.get(t),a===void 0&&(a=new Set,r.set(t,a));a.has(o)||(a.add(o),e=yw.bind(null,e,t,o),t.then(e,e))}function qh(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Oh(e,t,o,r,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(t=Ho(-1,1),t.tag=2,gr(o,t,1))),o.lanes|=1),e)}var aw=Ko.ReactCurrentOwner,Hn=!1;function An(e,t,o,r){t.child=e===null?Of(t,null,o,r):Ta(t,e.child,o,r)}function Fh(e,t,o,r,a){o=o.render;var i=t.ref;return Ca(t,a),r=sp(e,t,o,r,i,a),o=lp(),e!==null&&!Hn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Wo(e,t,a)):(Xt&&o&&Ju(t),t.flags|=1,An(e,t,r,a),t.child)}function Bh(e,t,o,r,a){if(e===null){var i=o.type;return typeof i=="function"&&!yp(i)&&i.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(t.tag=15,t.type=i,ux(e,t,i,r,a)):(e=Os(o.type,null,r,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&a)){var s=i.memoizedProps;if(o=o.compare,o=o!==null?o:_i,o(s,r)&&e.ref===t.ref)return Wo(e,t,a)}return t.flags|=1,e=yr(i,r),e.ref=t.ref,e.return=t,t.child=e}function ux(e,t,o,r,a){if(e!==null){var i=e.memoizedProps;if(_i(i,r)&&e.ref===t.ref)if(Hn=!1,t.pendingProps=r=i,(e.lanes&a)!==0)e.flags&131072&&(Hn=!0);else return t.lanes=e.lanes,Wo(e,t,a)}return Vd(e,t,o,r,a)}function px(e,t,o){var r=t.pendingProps,a=r.children,i=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Kt(ga,Kn),Kn|=o;else{if(!(o&1073741824))return e=i!==null?i.baseLanes|o:o,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Kt(ga,Kn),Kn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:o,Kt(ga,Kn),Kn|=r}else i!==null?(r=i.baseLanes|o,t.memoizedState=null):r=o,Kt(ga,Kn),Kn|=r;return An(e,t,a,o),t.child}function hx(e,t){var o=t.ref;(e===null&&o!==null||e!==null&&e.ref!==o)&&(t.flags|=512,t.flags|=2097152)}function Vd(e,t,o,r,a){var i=Vn(o)?Or:jn.current;return i=Pa(t,i),Ca(t,a),o=sp(e,t,o,r,i,a),r=lp(),e!==null&&!Hn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Wo(e,t,a)):(Xt&&r&&Ju(t),t.flags|=1,An(e,t,o,a),t.child)}function Hh(e,t,o,r,a){if(Vn(o)){var i=!0;ol(t)}else i=!1;if(Ca(t,a),t.stateNode===null)Ds(e,t),lx(t,o,r),Gd(t,o,r,a),r=!0;else if(e===null){var s=t.stateNode,l=t.memoizedProps;s.props=l;var c=s.context,d=o.contextType;typeof d=="object"&&d!==null?d=so(d):(d=Vn(o)?Or:jn.current,d=Pa(t,d));var u=o.getDerivedStateFromProps,p=typeof u=="function"||typeof s.getSnapshotBeforeUpdate=="function";p||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==r||c!==d)&&Dh(t,s,r,d),ir=!1;var h=t.memoizedState;s.state=h,ll(t,r,s,a),c=t.memoizedState,l!==r||h!==c||Un.current||ir?(typeof u=="function"&&(Hd(t,o,u,r),c=t.memoizedState),(l=ir||Lh(t,o,l,r,h,c,d))?(p||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(t.flags|=4194308)):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),s.props=r,s.state=c,s.context=d,r=l):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,Bf(e,t),l=t.memoizedProps,d=t.type===t.elementType?l:mo(t.type,l),s.props=d,p=t.pendingProps,h=s.context,c=o.contextType,typeof c=="object"&&c!==null?c=so(c):(c=Vn(o)?Or:jn.current,c=Pa(t,c));var w=o.getDerivedStateFromProps;(u=typeof w=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==p||h!==c)&&Dh(t,s,r,c),ir=!1,h=t.memoizedState,s.state=h,ll(t,r,s,a);var k=t.memoizedState;l!==p||h!==k||Un.current||ir?(typeof w=="function"&&(Hd(t,o,w,r),k=t.memoizedState),(d=ir||Lh(t,o,d,r,h,k,c)||!1)?(u||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,k,c),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,k,c)),typeof s.componentDidUpdate=="function"&&(t.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof s.componentDidUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=k),s.props=r,s.state=k,s.context=c,r=d):(typeof s.componentDidUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Wd(e,t,o,r,i,a)}function Wd(e,t,o,r,a,i){hx(e,t);var s=(t.flags&128)!==0;if(!r&&!s)return a&&Eh(t,o,!1),Wo(e,t,i);r=t.stateNode,aw.current=t;var l=s&&typeof o.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&s?(t.child=Ta(t,e.child,null,i),t.child=Ta(t,null,l,i)):An(e,t,l,i),t.memoizedState=r.state,a&&Eh(t,o,!0),t.child}function mx(e){var t=e.stateNode;t.pendingContext?Nh(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Nh(e,t.context,!1),op(e,t.containerInfo)}function Gh(e,t,o,r,a){return ja(),Zu(a),t.flags|=256,An(e,t,o,r),t.child}var $d={dehydrated:null,treeContext:null,retryLane:0};function Kd(e){return{baseLanes:e,cachePool:null,transitions:null}}function gx(e,t,o){var r=t.pendingProps,a=Qt.current,i=!1,s=(t.flags&128)!==0,l;if((l=s)||(l=e!==null&&e.memoizedState===null?!1:(a&2)!==0),l?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),Kt(Qt,a&1),e===null)return Fd(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(s=r.children,e=r.fallback,i?(r=t.mode,i=t.child,s={mode:"hidden",children:s},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=s):i=Fl(s,r,0,null),e=zr(e,r,o,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=Kd(o),t.memoizedState=$d,e):up(t,s));if(a=e.memoizedState,a!==null&&(l=a.dehydrated,l!==null))return iw(e,t,s,r,l,a,o);if(i){i=r.fallback,s=t.mode,a=e.child,l=a.sibling;var c={mode:"hidden",children:r.children};return!(s&1)&&t.child!==a?(r=t.child,r.childLanes=0,r.pendingProps=c,t.deletions=null):(r=yr(a,c),r.subtreeFlags=a.subtreeFlags&14680064),l!==null?i=yr(l,i):(i=zr(i,s,o,null),i.flags|=2),i.return=t,r.return=t,r.sibling=i,t.child=r,r=i,i=t.child,s=e.child.memoizedState,s=s===null?Kd(o):{baseLanes:s.baseLanes|o,cachePool:null,transitions:s.transitions},i.memoizedState=s,i.childLanes=e.childLanes&~o,t.memoizedState=$d,r}return i=e.child,e=i.sibling,r=yr(i,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=o),r.return=t,r.sibling=null,e!==null&&(o=t.deletions,o===null?(t.deletions=[e],t.flags|=16):o.push(e)),t.child=r,t.memoizedState=null,r}function up(e,t){return t=Fl({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function as(e,t,o,r){return r!==null&&Zu(r),Ta(t,e.child,null,o),e=up(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function iw(e,t,o,r,a,i,s){if(o)return t.flags&256?(t.flags&=-257,r=Uc(Error(nt(422))),as(e,t,s,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=r.fallback,a=t.mode,r=Fl({mode:"visible",children:r.children},a,0,null),i=zr(i,a,s,null),i.flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,t.mode&1&&Ta(t,e.child,null,s),t.child.memoizedState=Kd(s),t.memoizedState=$d,i);if(!(t.mode&1))return as(e,t,s,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(nt(419)),r=Uc(i,r,void 0),as(e,t,s,r)}if(l=(s&e.childLanes)!==0,Hn||l){if(r=xn,r!==null){switch(s&-s){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|s)?0:a,a!==0&&a!==i.retryLane&&(i.retryLane=a,Vo(e,a),yo(r,e,a,-1))}return xp(),r=Uc(Error(nt(421))),as(e,t,s,r)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=vw.bind(null,e),a._reactRetry=t,null):(e=i.treeContext,Jn=mr(a.nextSibling),Zn=t,Xt=!0,fo=null,e!==null&&(no[oo++]=Fo,no[oo++]=Bo,no[oo++]=Fr,Fo=e.id,Bo=e.overflow,Fr=t),t=up(t,r.children),t.flags|=4096,t)}function Uh(e,t,o){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),Bd(e.return,t,o)}function Vc(e,t,o,r,a){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:o,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=o,i.tailMode=a)}function fx(e,t,o){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(An(e,t,r.children,o),r=Qt.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Uh(e,o,t);else if(e.tag===19)Uh(e,o,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Kt(Qt,r),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(o=t.child,a=null;o!==null;)e=o.alternate,e!==null&&cl(e)===null&&(a=o),o=o.sibling;o=a,o===null?(a=t.child,t.child=null):(a=o.sibling,o.sibling=null),Vc(t,!1,a,o,i);break;case"backwards":for(o=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&cl(e)===null){t.child=a;break}e=a.sibling,a.sibling=o,o=a,a=e}Vc(t,!0,o,null,i);break;case"together":Vc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ds(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Wo(e,t,o){if(e!==null&&(t.dependencies=e.dependencies),Hr|=t.lanes,!(o&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(nt(153));if(t.child!==null){for(e=t.child,o=yr(e,e.pendingProps),t.child=o,o.return=t;e.sibling!==null;)e=e.sibling,o=o.sibling=yr(e,e.pendingProps),o.return=t;o.sibling=null}return t.child}function sw(e,t,o){switch(t.tag){case 3:mx(t),ja();break;case 5:Hf(t);break;case 1:Vn(t.type)&&ol(t);break;case 4:op(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Kt(il,r._currentValue),r._currentValue=a;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(Kt(Qt,Qt.current&1),t.flags|=128,null):o&t.child.childLanes?gx(e,t,o):(Kt(Qt,Qt.current&1),e=Wo(e,t,o),e!==null?e.sibling:null);Kt(Qt,Qt.current&1);break;case 19:if(r=(o&t.childLanes)!==0,e.flags&128){if(r)return fx(e,t,o);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),Kt(Qt,Qt.current),r)break;return null;case 22:case 23:return t.lanes=0,px(e,t,o)}return Wo(e,t,o)}var xx,Jd,yx,vx;xx=function(e,t){for(var o=t.child;o!==null;){if(o.tag===5||o.tag===6)e.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===t)break;for(;o.sibling===null;){if(o.return===null||o.return===t)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};Jd=function(){};yx=function(e,t,o,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,Lr(Io.current);var i=null;switch(o){case"input":a=xd(e,a),r=xd(e,r),i=[];break;case"select":a=tn({},a,{value:void 0}),r=tn({},r,{value:void 0}),i=[];break;case"textarea":a=wd(e,a),r=wd(e,r),i=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=tl)}Cd(o,r);var s;o=null;for(d in a)if(!r.hasOwnProperty(d)&&a.hasOwnProperty(d)&&a[d]!=null)if(d==="style"){var l=a[d];for(s in l)l.hasOwnProperty(s)&&(o||(o={}),o[s]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(xi.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=a!=null?a[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(o||(o={}),o[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(o||(o={}),o[s]=c[s])}else o||(i||(i=[]),i.push(d,o)),o=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(xi.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Yt("scroll",e),i||l===c||(i=[])):(i=i||[]).push(d,c))}o&&(i=i||[]).push("style",o);var d=i;(t.updateQueue=d)&&(t.flags|=4)}};vx=function(e,t,o,r){o!==r&&(t.flags|=4)};function Xa(e,t){if(!Xt)switch(e.tailMode){case"hidden":t=e.tail;for(var o=null;t!==null;)t.alternate!==null&&(o=t),t=t.sibling;o===null?e.tail=null:o.sibling=null;break;case"collapsed":o=e.tail;for(var r=null;o!==null;)o.alternate!==null&&(r=o),o=o.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Sn(e){var t=e.alternate!==null&&e.alternate.child===e.child,o=0,r=0;if(t)for(var a=e.child;a!==null;)o|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)o|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=o,t}function lw(e,t,o){var r=t.pendingProps;switch(Yu(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Sn(t),null;case 1:return Vn(t.type)&&nl(),Sn(t),null;case 3:return r=t.stateNode,Ia(),Zt(Un),Zt(jn),ap(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(os(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,fo!==null&&(ou(fo),fo=null))),Jd(e,t),Sn(t),null;case 5:rp(t);var a=Lr(ji.current);if(o=t.type,e!==null&&t.stateNode!=null)yx(e,t,o,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(nt(166));return Sn(t),null}if(e=Lr(Io.current),os(t)){r=t.stateNode,o=t.type;var i=t.memoizedProps;switch(r[Eo]=t,r[Ei]=i,e=(t.mode&1)!==0,o){case"dialog":Yt("cancel",r),Yt("close",r);break;case"iframe":case"object":case"embed":Yt("load",r);break;case"video":case"audio":for(a=0;a<ai.length;a++)Yt(ai[a],r);break;case"source":Yt("error",r);break;case"img":case"image":case"link":Yt("error",r),Yt("load",r);break;case"details":Yt("toggle",r);break;case"input":Qp(r,i),Yt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Yt("invalid",r);break;case"textarea":th(r,i),Yt("invalid",r)}Cd(o,i),a=null;for(var s in i)if(i.hasOwnProperty(s)){var l=i[s];s==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&ns(r.textContent,l,e),a=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&ns(r.textContent,l,e),a=["children",""+l]):xi.hasOwnProperty(s)&&l!=null&&s==="onScroll"&&Yt("scroll",r)}switch(o){case"input":Ki(r),eh(r,i,!0);break;case"textarea":Ki(r),nh(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=tl)}r=a,t.updateQueue=r,r!==null&&(t.flags|=4)}else{s=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=W0(o)),e==="http://www.w3.org/1999/xhtml"?o==="script"?(e=s.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=s.createElement(o,{is:r.is}):(e=s.createElement(o),o==="select"&&(s=e,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):e=s.createElementNS(e,o),e[Eo]=t,e[Ei]=r,xx(e,t,!1,!1),t.stateNode=e;e:{switch(s=kd(o,r),o){case"dialog":Yt("cancel",e),Yt("close",e),a=r;break;case"iframe":case"object":case"embed":Yt("load",e),a=r;break;case"video":case"audio":for(a=0;a<ai.length;a++)Yt(ai[a],e);a=r;break;case"source":Yt("error",e),a=r;break;case"img":case"image":case"link":Yt("error",e),Yt("load",e),a=r;break;case"details":Yt("toggle",e),a=r;break;case"input":Qp(e,r),a=xd(e,r),Yt("invalid",e);break;case"option":a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=tn({},r,{value:void 0}),Yt("invalid",e);break;case"textarea":th(e,r),a=wd(e,r),Yt("invalid",e);break;default:a=r}Cd(o,a),l=a;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?J0(e,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&$0(e,c)):i==="children"?typeof c=="string"?(o!=="textarea"||c!=="")&&yi(e,c):typeof c=="number"&&yi(e,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(xi.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Yt("scroll",e):c!=null&&Lu(e,i,c,s))}switch(o){case"input":Ki(e),eh(e,r,!1);break;case"textarea":Ki(e),nh(e);break;case"option":r.value!=null&&e.setAttribute("value",""+wr(r.value));break;case"select":e.multiple=!!r.multiple,i=r.value,i!=null?ya(e,!!r.multiple,i,!1):r.defaultValue!=null&&ya(e,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=tl)}switch(o){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Sn(t),null;case 6:if(e&&t.stateNode!=null)vx(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(nt(166));if(o=Lr(ji.current),Lr(Io.current),os(t)){if(r=t.stateNode,o=t.memoizedProps,r[Eo]=t,(i=r.nodeValue!==o)&&(e=Zn,e!==null))switch(e.tag){case 3:ns(r.nodeValue,o,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&ns(r.nodeValue,o,(e.mode&1)!==0)}i&&(t.flags|=4)}else r=(o.nodeType===9?o:o.ownerDocument).createTextNode(r),r[Eo]=t,t.stateNode=r}return Sn(t),null;case 13:if(Zt(Qt),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Xt&&Jn!==null&&t.mode&1&&!(t.flags&128))zf(),ja(),t.flags|=98560,i=!1;else if(i=os(t),r!==null&&r.dehydrated!==null){if(e===null){if(!i)throw Error(nt(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(nt(317));i[Eo]=t}else ja(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Sn(t),i=!1}else fo!==null&&(ou(fo),fo=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=o,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||Qt.current&1?pn===0&&(pn=3):xp())),t.updateQueue!==null&&(t.flags|=4),Sn(t),null);case 4:return Ia(),Jd(e,t),e===null&&Si(t.stateNode.containerInfo),Sn(t),null;case 10:return ep(t.type._context),Sn(t),null;case 17:return Vn(t.type)&&nl(),Sn(t),null;case 19:if(Zt(Qt),i=t.memoizedState,i===null)return Sn(t),null;if(r=(t.flags&128)!==0,s=i.rendering,s===null)if(r)Xa(i,!1);else{if(pn!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(s=cl(e),s!==null){for(t.flags|=128,Xa(i,!1),r=s.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=o,o=t.child;o!==null;)i=o,e=r,i.flags&=14680066,s=i.alternate,s===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=s.childLanes,i.lanes=s.lanes,i.child=s.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=s.memoizedProps,i.memoizedState=s.memoizedState,i.updateQueue=s.updateQueue,i.type=s.type,e=s.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),o=o.sibling;return Kt(Qt,Qt.current&1|2),t.child}e=e.sibling}i.tail!==null&&sn()>Ma&&(t.flags|=128,r=!0,Xa(i,!1),t.lanes=4194304)}else{if(!r)if(e=cl(s),e!==null){if(t.flags|=128,r=!0,o=e.updateQueue,o!==null&&(t.updateQueue=o,t.flags|=4),Xa(i,!0),i.tail===null&&i.tailMode==="hidden"&&!s.alternate&&!Xt)return Sn(t),null}else 2*sn()-i.renderingStartTime>Ma&&o!==1073741824&&(t.flags|=128,r=!0,Xa(i,!1),t.lanes=4194304);i.isBackwards?(s.sibling=t.child,t.child=s):(o=i.last,o!==null?o.sibling=s:t.child=s,i.last=s)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=sn(),t.sibling=null,o=Qt.current,Kt(Qt,r?o&1|2:o&1),t):(Sn(t),null);case 22:case 23:return fp(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?Kn&1073741824&&(Sn(t),t.subtreeFlags&6&&(t.flags|=8192)):Sn(t),null;case 24:return null;case 25:return null}throw Error(nt(156,t.tag))}function cw(e,t){switch(Yu(t),t.tag){case 1:return Vn(t.type)&&nl(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Ia(),Zt(Un),Zt(jn),ap(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return rp(t),null;case 13:if(Zt(Qt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(nt(340));ja()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Zt(Qt),null;case 4:return Ia(),null;case 10:return ep(t.type._context),null;case 22:case 23:return fp(),null;case 24:return null;default:return null}}var is=!1,Nn=!1,dw=typeof WeakSet=="function"?WeakSet:Set,pt=null;function ma(e,t){var o=e.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(r){rn(e,t,r)}else o.current=null}function Yd(e,t,o){try{o()}catch(r){rn(e,t,r)}}var Vh=!1;function uw(e,t){if(Md=Xs,e=_f(),Ku(e)){if("selectionStart"in e)var o={start:e.selectionStart,end:e.selectionEnd};else e:{o=(o=e.ownerDocument)&&o.defaultView||window;var r=o.getSelection&&o.getSelection();if(r&&r.rangeCount!==0){o=r.anchorNode;var a=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{o.nodeType,i.nodeType}catch{o=null;break e}var s=0,l=-1,c=-1,d=0,u=0,p=e,h=null;t:for(;;){for(var w;p!==o||a!==0&&p.nodeType!==3||(l=s+a),p!==i||r!==0&&p.nodeType!==3||(c=s+r),p.nodeType===3&&(s+=p.nodeValue.length),(w=p.firstChild)!==null;)h=p,p=w;for(;;){if(p===e)break t;if(h===o&&++d===a&&(l=s),h===i&&++u===r&&(c=s),(w=p.nextSibling)!==null)break;p=h,h=p.parentNode}p=w}o=l===-1||c===-1?null:{start:l,end:c}}else o=null}o=o||{start:0,end:0}}else o=null;for(Rd={focusedElem:e,selectionRange:o},Xs=!1,pt=t;pt!==null;)if(t=pt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,pt=e;else for(;pt!==null;){t=pt;try{var k=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(k!==null){var b=k.memoizedProps,y=k.memoizedState,g=t.stateNode,m=g.getSnapshotBeforeUpdate(t.elementType===t.type?b:mo(t.type,b),y);g.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var x=t.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(nt(163))}}catch(_){rn(t,t.return,_)}if(e=t.sibling,e!==null){e.return=t.return,pt=e;break}pt=t.return}return k=Vh,Vh=!1,k}function mi(e,t,o){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,i!==void 0&&Yd(t,o,i)}a=a.next}while(a!==r)}}function ql(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var o=t=t.next;do{if((o.tag&e)===e){var r=o.create;o.destroy=r()}o=o.next}while(o!==t)}}function Zd(e){var t=e.ref;if(t!==null){var o=e.stateNode;switch(e.tag){case 5:e=o;break;default:e=o}typeof t=="function"?t(e):t.current=e}}function wx(e){var t=e.alternate;t!==null&&(e.alternate=null,wx(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Eo],delete t[Ei],delete t[zd],delete t[$v],delete t[Kv])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function bx(e){return e.tag===5||e.tag===3||e.tag===4}function Wh(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||bx(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Xd(e,t,o){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?o.nodeType===8?o.parentNode.insertBefore(e,t):o.insertBefore(e,t):(o.nodeType===8?(t=o.parentNode,t.insertBefore(e,o)):(t=o,t.appendChild(e)),o=o._reactRootContainer,o!=null||t.onclick!==null||(t.onclick=tl));else if(r!==4&&(e=e.child,e!==null))for(Xd(e,t,o),e=e.sibling;e!==null;)Xd(e,t,o),e=e.sibling}function Qd(e,t,o){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?o.insertBefore(e,t):o.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Qd(e,t,o),e=e.sibling;e!==null;)Qd(e,t,o),e=e.sibling}var vn=null,go=!1;function Qo(e,t,o){for(o=o.child;o!==null;)Cx(e,t,o),o=o.sibling}function Cx(e,t,o){if(To&&typeof To.onCommitFiberUnmount=="function")try{To.onCommitFiberUnmount(Tl,o)}catch{}switch(o.tag){case 5:Nn||ma(o,t);case 6:var r=vn,a=go;vn=null,Qo(e,t,o),vn=r,go=a,vn!==null&&(go?(e=vn,o=o.stateNode,e.nodeType===8?e.parentNode.removeChild(o):e.removeChild(o)):vn.removeChild(o.stateNode));break;case 18:vn!==null&&(go?(e=vn,o=o.stateNode,e.nodeType===8?qc(e.parentNode,o):e.nodeType===1&&qc(e,o),Ci(e)):qc(vn,o.stateNode));break;case 4:r=vn,a=go,vn=o.stateNode.containerInfo,go=!0,Qo(e,t,o),vn=r,go=a;break;case 0:case 11:case 14:case 15:if(!Nn&&(r=o.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var i=a,s=i.destroy;i=i.tag,s!==void 0&&(i&2||i&4)&&Yd(o,t,s),a=a.next}while(a!==r)}Qo(e,t,o);break;case 1:if(!Nn&&(ma(o,t),r=o.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=o.memoizedProps,r.state=o.memoizedState,r.componentWillUnmount()}catch(l){rn(o,t,l)}Qo(e,t,o);break;case 21:Qo(e,t,o);break;case 22:o.mode&1?(Nn=(r=Nn)||o.memoizedState!==null,Qo(e,t,o),Nn=r):Qo(e,t,o);break;default:Qo(e,t,o)}}function $h(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var o=e.stateNode;o===null&&(o=e.stateNode=new dw),t.forEach(function(r){var a=ww.bind(null,e,r);o.has(r)||(o.add(r),r.then(a,a))})}}function po(e,t){var o=t.deletions;if(o!==null)for(var r=0;r<o.length;r++){var a=o[r];try{var i=e,s=t,l=s;e:for(;l!==null;){switch(l.tag){case 5:vn=l.stateNode,go=!1;break e;case 3:vn=l.stateNode.containerInfo,go=!0;break e;case 4:vn=l.stateNode.containerInfo,go=!0;break e}l=l.return}if(vn===null)throw Error(nt(160));Cx(i,s,a),vn=null,go=!1;var c=a.alternate;c!==null&&(c.return=null),a.return=null}catch(d){rn(a,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)kx(t,e),t=t.sibling}function kx(e,t){var o=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(po(t,e),ko(e),r&4){try{mi(3,e,e.return),ql(3,e)}catch(b){rn(e,e.return,b)}try{mi(5,e,e.return)}catch(b){rn(e,e.return,b)}}break;case 1:po(t,e),ko(e),r&512&&o!==null&&ma(o,o.return);break;case 5:if(po(t,e),ko(e),r&512&&o!==null&&ma(o,o.return),e.flags&32){var a=e.stateNode;try{yi(a,"")}catch(b){rn(e,e.return,b)}}if(r&4&&(a=e.stateNode,a!=null)){var i=e.memoizedProps,s=o!==null?o.memoizedProps:i,l=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&U0(a,i),kd(l,s);var d=kd(l,i);for(s=0;s<c.length;s+=2){var u=c[s],p=c[s+1];u==="style"?J0(a,p):u==="dangerouslySetInnerHTML"?$0(a,p):u==="children"?yi(a,p):Lu(a,u,p,d)}switch(l){case"input":yd(a,i);break;case"textarea":V0(a,i);break;case"select":var h=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!i.multiple;var w=i.value;w!=null?ya(a,!!i.multiple,w,!1):h!==!!i.multiple&&(i.defaultValue!=null?ya(a,!!i.multiple,i.defaultValue,!0):ya(a,!!i.multiple,i.multiple?[]:"",!1))}a[Ei]=i}catch(b){rn(e,e.return,b)}}break;case 6:if(po(t,e),ko(e),r&4){if(e.stateNode===null)throw Error(nt(162));a=e.stateNode,i=e.memoizedProps;try{a.nodeValue=i}catch(b){rn(e,e.return,b)}}break;case 3:if(po(t,e),ko(e),r&4&&o!==null&&o.memoizedState.isDehydrated)try{Ci(t.containerInfo)}catch(b){rn(e,e.return,b)}break;case 4:po(t,e),ko(e);break;case 13:po(t,e),ko(e),a=e.child,a.flags&8192&&(i=a.memoizedState!==null,a.stateNode.isHidden=i,!i||a.alternate!==null&&a.alternate.memoizedState!==null||(mp=sn())),r&4&&$h(e);break;case 22:if(u=o!==null&&o.memoizedState!==null,e.mode&1?(Nn=(d=Nn)||u,po(t,e),Nn=d):po(t,e),ko(e),r&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!u&&e.mode&1)for(pt=e,u=e.child;u!==null;){for(p=pt=u;pt!==null;){switch(h=pt,w=h.child,h.tag){case 0:case 11:case 14:case 15:mi(4,h,h.return);break;case 1:ma(h,h.return);var k=h.stateNode;if(typeof k.componentWillUnmount=="function"){r=h,o=h.return;try{t=r,k.props=t.memoizedProps,k.state=t.memoizedState,k.componentWillUnmount()}catch(b){rn(r,o,b)}}break;case 5:ma(h,h.return);break;case 22:if(h.memoizedState!==null){Jh(p);continue}}w!==null?(w.return=h,pt=w):Jh(p)}u=u.sibling}e:for(u=null,p=e;;){if(p.tag===5){if(u===null){u=p;try{a=p.stateNode,d?(i=a.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=p.stateNode,c=p.memoizedProps.style,s=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=K0("display",s))}catch(b){rn(e,e.return,b)}}}else if(p.tag===6){if(u===null)try{p.stateNode.nodeValue=d?"":p.memoizedProps}catch(b){rn(e,e.return,b)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===e)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===e)break e;for(;p.sibling===null;){if(p.return===null||p.return===e)break e;u===p&&(u=null),p=p.return}u===p&&(u=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:po(t,e),ko(e),r&4&&$h(e);break;case 21:break;default:po(t,e),ko(e)}}function ko(e){var t=e.flags;if(t&2){try{e:{for(var o=e.return;o!==null;){if(bx(o)){var r=o;break e}o=o.return}throw Error(nt(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(yi(a,""),r.flags&=-33);var i=Wh(e);Qd(e,i,a);break;case 3:case 4:var s=r.stateNode.containerInfo,l=Wh(e);Xd(e,l,s);break;default:throw Error(nt(161))}}catch(c){rn(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function pw(e,t,o){pt=e,_x(e)}function _x(e,t,o){for(var r=(e.mode&1)!==0;pt!==null;){var a=pt,i=a.child;if(a.tag===22&&r){var s=a.memoizedState!==null||is;if(!s){var l=a.alternate,c=l!==null&&l.memoizedState!==null||Nn;l=is;var d=Nn;if(is=s,(Nn=c)&&!d)for(pt=a;pt!==null;)s=pt,c=s.child,s.tag===22&&s.memoizedState!==null?Yh(a):c!==null?(c.return=s,pt=c):Yh(a);for(;i!==null;)pt=i,_x(i),i=i.sibling;pt=a,is=l,Nn=d}Kh(e)}else a.subtreeFlags&8772&&i!==null?(i.return=a,pt=i):Kh(e)}}function Kh(e){for(;pt!==null;){var t=pt;if(t.flags&8772){var o=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Nn||ql(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Nn)if(o===null)r.componentDidMount();else{var a=t.elementType===t.type?o.memoizedProps:mo(t.type,o.memoizedProps);r.componentDidUpdate(a,o.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&Ah(t,i,r);break;case 3:var s=t.updateQueue;if(s!==null){if(o=null,t.child!==null)switch(t.child.tag){case 5:o=t.child.stateNode;break;case 1:o=t.child.stateNode}Ah(t,s,o)}break;case 5:var l=t.stateNode;if(o===null&&t.flags&4){o=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&o.focus();break;case"img":c.src&&(o.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var p=u.dehydrated;p!==null&&Ci(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(nt(163))}Nn||t.flags&512&&Zd(t)}catch(h){rn(t,t.return,h)}}if(t===e){pt=null;break}if(o=t.sibling,o!==null){o.return=t.return,pt=o;break}pt=t.return}}function Jh(e){for(;pt!==null;){var t=pt;if(t===e){pt=null;break}var o=t.sibling;if(o!==null){o.return=t.return,pt=o;break}pt=t.return}}function Yh(e){for(;pt!==null;){var t=pt;try{switch(t.tag){case 0:case 11:case 15:var o=t.return;try{ql(4,t)}catch(c){rn(t,o,c)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var a=t.return;try{r.componentDidMount()}catch(c){rn(t,a,c)}}var i=t.return;try{Zd(t)}catch(c){rn(t,i,c)}break;case 5:var s=t.return;try{Zd(t)}catch(c){rn(t,s,c)}}}catch(c){rn(t,t.return,c)}if(t===e){pt=null;break}var l=t.sibling;if(l!==null){l.return=t.return,pt=l;break}pt=t.return}}var hw=Math.ceil,pl=Ko.ReactCurrentDispatcher,pp=Ko.ReactCurrentOwner,ao=Ko.ReactCurrentBatchConfig,Mt=0,xn=null,ln=null,wn=0,Kn=0,ga=_r(0),pn=0,Mi=null,Hr=0,Ol=0,hp=0,gi=null,Bn=null,mp=0,Ma=1/0,zo=null,hl=!1,eu=null,fr=null,ss=!1,dr=null,ml=0,fi=0,tu=null,zs=-1,qs=0;function Mn(){return Mt&6?sn():zs!==-1?zs:zs=sn()}function xr(e){return e.mode&1?Mt&2&&wn!==0?wn&-wn:Yv.transition!==null?(qs===0&&(qs=lf()),qs):(e=Bt,e!==0||(e=window.event,e=e===void 0?16:gf(e.type)),e):1}function yo(e,t,o,r){if(50<fi)throw fi=0,tu=null,Error(nt(185));zi(e,o,r),(!(Mt&2)||e!==xn)&&(e===xn&&(!(Mt&2)&&(Ol|=o),pn===4&&lr(e,wn)),Wn(e,r),o===1&&Mt===0&&!(t.mode&1)&&(Ma=sn()+500,Ll&&Sr()))}function Wn(e,t){var o=e.callbackNode;Y2(e,t);var r=Zs(e,e===xn?wn:0);if(r===0)o!==null&&ah(o),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(o!=null&&ah(o),t===1)e.tag===0?Jv(Zh.bind(null,e)):Rf(Zh.bind(null,e)),Vv(function(){!(Mt&6)&&Sr()}),o=null;else{switch(cf(r)){case 1:o=Fu;break;case 4:o=af;break;case 16:o=Ys;break;case 536870912:o=sf;break;default:o=Ys}o=Ax(o,Sx.bind(null,e))}e.callbackPriority=t,e.callbackNode=o}}function Sx(e,t){if(zs=-1,qs=0,Mt&6)throw Error(nt(327));var o=e.callbackNode;if(ka()&&e.callbackNode!==o)return null;var r=Zs(e,e===xn?wn:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=gl(e,r);else{t=r;var a=Mt;Mt|=2;var i=Ex();(xn!==e||wn!==t)&&(zo=null,Ma=sn()+500,Dr(e,t));do try{fw();break}catch(l){Nx(e,l)}while(!0);Qu(),pl.current=i,Mt=a,ln!==null?t=0:(xn=null,wn=0,t=pn)}if(t!==0){if(t===2&&(a=Pd(e),a!==0&&(r=a,t=nu(e,a))),t===1)throw o=Mi,Dr(e,0),lr(e,r),Wn(e,sn()),o;if(t===6)lr(e,r);else{if(a=e.current.alternate,!(r&30)&&!mw(a)&&(t=gl(e,r),t===2&&(i=Pd(e),i!==0&&(r=i,t=nu(e,i))),t===1))throw o=Mi,Dr(e,0),lr(e,r),Wn(e,sn()),o;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(nt(345));case 2:Tr(e,Bn,zo);break;case 3:if(lr(e,r),(r&130023424)===r&&(t=mp+500-sn(),10<t)){if(Zs(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){Mn(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=Dd(Tr.bind(null,e,Bn,zo),t);break}Tr(e,Bn,zo);break;case 4:if(lr(e,r),(r&4194240)===r)break;for(t=e.eventTimes,a=-1;0<r;){var s=31-xo(r);i=1<<s,s=t[s],s>a&&(a=s),r&=~i}if(r=a,r=sn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*hw(r/1960))-r,10<r){e.timeoutHandle=Dd(Tr.bind(null,e,Bn,zo),r);break}Tr(e,Bn,zo);break;case 5:Tr(e,Bn,zo);break;default:throw Error(nt(329))}}}return Wn(e,sn()),e.callbackNode===o?Sx.bind(null,e):null}function nu(e,t){var o=gi;return e.current.memoizedState.isDehydrated&&(Dr(e,t).flags|=256),e=gl(e,t),e!==2&&(t=Bn,Bn=o,t!==null&&ou(t)),e}function ou(e){Bn===null?Bn=e:Bn.push.apply(Bn,e)}function mw(e){for(var t=e;;){if(t.flags&16384){var o=t.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var r=0;r<o.length;r++){var a=o[r],i=a.getSnapshot;a=a.value;try{if(!bo(i(),a))return!1}catch{return!1}}}if(o=t.child,t.subtreeFlags&16384&&o!==null)o.return=t,t=o;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function lr(e,t){for(t&=~hp,t&=~Ol,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var o=31-xo(t),r=1<<o;e[o]=-1,t&=~r}}function Zh(e){if(Mt&6)throw Error(nt(327));ka();var t=Zs(e,0);if(!(t&1))return Wn(e,sn()),null;var o=gl(e,t);if(e.tag!==0&&o===2){var r=Pd(e);r!==0&&(t=r,o=nu(e,r))}if(o===1)throw o=Mi,Dr(e,0),lr(e,t),Wn(e,sn()),o;if(o===6)throw Error(nt(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Tr(e,Bn,zo),Wn(e,sn()),null}function gp(e,t){var o=Mt;Mt|=1;try{return e(t)}finally{Mt=o,Mt===0&&(Ma=sn()+500,Ll&&Sr())}}function Gr(e){dr!==null&&dr.tag===0&&!(Mt&6)&&ka();var t=Mt;Mt|=1;var o=ao.transition,r=Bt;try{if(ao.transition=null,Bt=1,e)return e()}finally{Bt=r,ao.transition=o,Mt=t,!(Mt&6)&&Sr()}}function fp(){Kn=ga.current,Zt(ga)}function Dr(e,t){e.finishedWork=null,e.finishedLanes=0;var o=e.timeoutHandle;if(o!==-1&&(e.timeoutHandle=-1,Uv(o)),ln!==null)for(o=ln.return;o!==null;){var r=o;switch(Yu(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&nl();break;case 3:Ia(),Zt(Un),Zt(jn),ap();break;case 5:rp(r);break;case 4:Ia();break;case 13:Zt(Qt);break;case 19:Zt(Qt);break;case 10:ep(r.type._context);break;case 22:case 23:fp()}o=o.return}if(xn=e,ln=e=yr(e.current,null),wn=Kn=t,pn=0,Mi=null,hp=Ol=Hr=0,Bn=gi=null,Rr!==null){for(t=0;t<Rr.length;t++)if(o=Rr[t],r=o.interleaved,r!==null){o.interleaved=null;var a=r.next,i=o.pending;if(i!==null){var s=i.next;i.next=a,r.next=s}o.pending=r}Rr=null}return e}function Nx(e,t){do{var o=ln;try{if(Qu(),Rs.current=ul,dl){for(var r=en.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}dl=!1}if(Br=0,gn=un=en=null,hi=!1,Ti=0,pp.current=null,o===null||o.return===null){pn=1,Mi=t,ln=null;break}e:{var i=e,s=o.return,l=o,c=t;if(t=wn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,p=u.tag;if(!(u.mode&1)&&(p===0||p===11||p===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var w=qh(s);if(w!==null){w.flags&=-257,Oh(w,s,l,i,t),w.mode&1&&zh(i,d,t),t=w,c=d;var k=t.updateQueue;if(k===null){var b=new Set;b.add(c),t.updateQueue=b}else k.add(c);break e}else{if(!(t&1)){zh(i,d,t),xp();break e}c=Error(nt(426))}}else if(Xt&&l.mode&1){var y=qh(s);if(y!==null){!(y.flags&65536)&&(y.flags|=256),Oh(y,s,l,i,t),Zu(Aa(c,l));break e}}i=c=Aa(c,l),pn!==4&&(pn=2),gi===null?gi=[i]:gi.push(i),i=s;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var g=cx(i,c,t);Ih(i,g);break e;case 1:l=c;var m=i.type,x=i.stateNode;if(!(i.flags&128)&&(typeof m.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(fr===null||!fr.has(x)))){i.flags|=65536,t&=-t,i.lanes|=t;var _=dx(i,l,t);Ih(i,_);break e}}i=i.return}while(i!==null)}jx(o)}catch(S){t=S,ln===o&&o!==null&&(ln=o=o.return);continue}break}while(!0)}function Ex(){var e=pl.current;return pl.current=ul,e===null?ul:e}function xp(){(pn===0||pn===3||pn===2)&&(pn=4),xn===null||!(Hr&268435455)&&!(Ol&268435455)||lr(xn,wn)}function gl(e,t){var o=Mt;Mt|=2;var r=Ex();(xn!==e||wn!==t)&&(zo=null,Dr(e,t));do try{gw();break}catch(a){Nx(e,a)}while(!0);if(Qu(),Mt=o,pl.current=r,ln!==null)throw Error(nt(261));return xn=null,wn=0,pn}function gw(){for(;ln!==null;)Px(ln)}function fw(){for(;ln!==null&&!B2();)Px(ln)}function Px(e){var t=Ix(e.alternate,e,Kn);e.memoizedProps=e.pendingProps,t===null?jx(e):ln=t,pp.current=null}function jx(e){var t=e;do{var o=t.alternate;if(e=t.return,t.flags&32768){if(o=cw(o,t),o!==null){o.flags&=32767,ln=o;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{pn=6,ln=null;return}}else if(o=lw(o,t,Kn),o!==null){ln=o;return}if(t=t.sibling,t!==null){ln=t;return}ln=t=e}while(t!==null);pn===0&&(pn=5)}function Tr(e,t,o){var r=Bt,a=ao.transition;try{ao.transition=null,Bt=1,xw(e,t,o,r)}finally{ao.transition=a,Bt=r}return null}function xw(e,t,o,r){do ka();while(dr!==null);if(Mt&6)throw Error(nt(327));o=e.finishedWork;var a=e.finishedLanes;if(o===null)return null;if(e.finishedWork=null,e.finishedLanes=0,o===e.current)throw Error(nt(177));e.callbackNode=null,e.callbackPriority=0;var i=o.lanes|o.childLanes;if(Z2(e,i),e===xn&&(ln=xn=null,wn=0),!(o.subtreeFlags&2064)&&!(o.flags&2064)||ss||(ss=!0,Ax(Ys,function(){return ka(),null})),i=(o.flags&15990)!==0,o.subtreeFlags&15990||i){i=ao.transition,ao.transition=null;var s=Bt;Bt=1;var l=Mt;Mt|=4,pp.current=null,uw(e,o),kx(o,e),zv(Rd),Xs=!!Md,Rd=Md=null,e.current=o,pw(o),H2(),Mt=l,Bt=s,ao.transition=i}else e.current=o;if(ss&&(ss=!1,dr=e,ml=a),i=e.pendingLanes,i===0&&(fr=null),V2(o.stateNode),Wn(e,sn()),t!==null)for(r=e.onRecoverableError,o=0;o<t.length;o++)a=t[o],r(a.value,{componentStack:a.stack,digest:a.digest});if(hl)throw hl=!1,e=eu,eu=null,e;return ml&1&&e.tag!==0&&ka(),i=e.pendingLanes,i&1?e===tu?fi++:(fi=0,tu=e):fi=0,Sr(),null}function ka(){if(dr!==null){var e=cf(ml),t=ao.transition,o=Bt;try{if(ao.transition=null,Bt=16>e?16:e,dr===null)var r=!1;else{if(e=dr,dr=null,ml=0,Mt&6)throw Error(nt(331));var a=Mt;for(Mt|=4,pt=e.current;pt!==null;){var i=pt,s=i.child;if(pt.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(pt=d;pt!==null;){var u=pt;switch(u.tag){case 0:case 11:case 15:mi(8,u,i)}var p=u.child;if(p!==null)p.return=u,pt=p;else for(;pt!==null;){u=pt;var h=u.sibling,w=u.return;if(wx(u),u===d){pt=null;break}if(h!==null){h.return=w,pt=h;break}pt=w}}}var k=i.alternate;if(k!==null){var b=k.child;if(b!==null){k.child=null;do{var y=b.sibling;b.sibling=null,b=y}while(b!==null)}}pt=i}}if(i.subtreeFlags&2064&&s!==null)s.return=i,pt=s;else e:for(;pt!==null;){if(i=pt,i.flags&2048)switch(i.tag){case 0:case 11:case 15:mi(9,i,i.return)}var g=i.sibling;if(g!==null){g.return=i.return,pt=g;break e}pt=i.return}}var m=e.current;for(pt=m;pt!==null;){s=pt;var x=s.child;if(s.subtreeFlags&2064&&x!==null)x.return=s,pt=x;else e:for(s=m;pt!==null;){if(l=pt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:ql(9,l)}}catch(S){rn(l,l.return,S)}if(l===s){pt=null;break e}var _=l.sibling;if(_!==null){_.return=l.return,pt=_;break e}pt=l.return}}if(Mt=a,Sr(),To&&typeof To.onPostCommitFiberRoot=="function")try{To.onPostCommitFiberRoot(Tl,e)}catch{}r=!0}return r}finally{Bt=o,ao.transition=t}}return!1}function Xh(e,t,o){t=Aa(o,t),t=cx(e,t,1),e=gr(e,t,1),t=Mn(),e!==null&&(zi(e,1,t),Wn(e,t))}function rn(e,t,o){if(e.tag===3)Xh(e,e,o);else for(;t!==null;){if(t.tag===3){Xh(t,e,o);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(fr===null||!fr.has(r))){e=Aa(o,e),e=dx(t,e,1),t=gr(t,e,1),e=Mn(),t!==null&&(zi(t,1,e),Wn(t,e));break}}t=t.return}}function yw(e,t,o){var r=e.pingCache;r!==null&&r.delete(t),t=Mn(),e.pingedLanes|=e.suspendedLanes&o,xn===e&&(wn&o)===o&&(pn===4||pn===3&&(wn&130023424)===wn&&500>sn()-mp?Dr(e,0):hp|=o),Wn(e,t)}function Tx(e,t){t===0&&(e.mode&1?(t=Zi,Zi<<=1,!(Zi&130023424)&&(Zi=4194304)):t=1);var o=Mn();e=Vo(e,t),e!==null&&(zi(e,t,o),Wn(e,o))}function vw(e){var t=e.memoizedState,o=0;t!==null&&(o=t.retryLane),Tx(e,o)}function ww(e,t){var o=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(o=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(nt(314))}r!==null&&r.delete(t),Tx(e,o)}var Ix;Ix=function(e,t,o){if(e!==null)if(e.memoizedProps!==t.pendingProps||Un.current)Hn=!0;else{if(!(e.lanes&o)&&!(t.flags&128))return Hn=!1,sw(e,t,o);Hn=!!(e.flags&131072)}else Hn=!1,Xt&&t.flags&1048576&&Lf(t,al,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ds(e,t),e=t.pendingProps;var a=Pa(t,jn.current);Ca(t,o),a=sp(null,t,r,e,a,o);var i=lp();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Vn(r)?(i=!0,ol(t)):i=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,np(t),a.updater=zl,t.stateNode=a,a._reactInternals=t,Gd(t,r,e,o),t=Wd(null,t,r,!0,i,o)):(t.tag=0,Xt&&i&&Ju(t),An(null,t,a,o),t=t.child),t;case 16:r=t.elementType;e:{switch(Ds(e,t),e=t.pendingProps,a=r._init,r=a(r._payload),t.type=r,a=t.tag=Cw(r),e=mo(r,e),a){case 0:t=Vd(null,t,r,e,o);break e;case 1:t=Hh(null,t,r,e,o);break e;case 11:t=Fh(null,t,r,e,o);break e;case 14:t=Bh(null,t,r,mo(r.type,e),o);break e}throw Error(nt(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:mo(r,a),Vd(e,t,r,a,o);case 1:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:mo(r,a),Hh(e,t,r,a,o);case 3:e:{if(mx(t),e===null)throw Error(nt(387));r=t.pendingProps,i=t.memoizedState,a=i.element,Bf(e,t),ll(t,r,null,o);var s=t.memoizedState;if(r=s.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){a=Aa(Error(nt(423)),t),t=Gh(e,t,r,o,a);break e}else if(r!==a){a=Aa(Error(nt(424)),t),t=Gh(e,t,r,o,a);break e}else for(Jn=mr(t.stateNode.containerInfo.firstChild),Zn=t,Xt=!0,fo=null,o=Of(t,null,r,o),t.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(ja(),r===a){t=Wo(e,t,o);break e}An(e,t,r,o)}t=t.child}return t;case 5:return Hf(t),e===null&&Fd(t),r=t.type,a=t.pendingProps,i=e!==null?e.memoizedProps:null,s=a.children,Ld(r,a)?s=null:i!==null&&Ld(r,i)&&(t.flags|=32),hx(e,t),An(e,t,s,o),t.child;case 6:return e===null&&Fd(t),null;case 13:return gx(e,t,o);case 4:return op(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Ta(t,null,r,o):An(e,t,r,o),t.child;case 11:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:mo(r,a),Fh(e,t,r,a,o);case 7:return An(e,t,t.pendingProps,o),t.child;case 8:return An(e,t,t.pendingProps.children,o),t.child;case 12:return An(e,t,t.pendingProps.children,o),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,i=t.memoizedProps,s=a.value,Kt(il,r._currentValue),r._currentValue=s,i!==null)if(bo(i.value,s)){if(i.children===a.children&&!Un.current){t=Wo(e,t,o);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var l=i.dependencies;if(l!==null){s=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=Ho(-1,o&-o),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}i.lanes|=o,c=i.alternate,c!==null&&(c.lanes|=o),Bd(i.return,o,t),l.lanes|=o;break}c=c.next}}else if(i.tag===10)s=i.type===t.type?null:i.child;else if(i.tag===18){if(s=i.return,s===null)throw Error(nt(341));s.lanes|=o,l=s.alternate,l!==null&&(l.lanes|=o),Bd(s,o,t),s=i.sibling}else s=i.child;if(s!==null)s.return=i;else for(s=i;s!==null;){if(s===t){s=null;break}if(i=s.sibling,i!==null){i.return=s.return,s=i;break}s=s.return}i=s}An(e,t,a.children,o),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Ca(t,o),a=so(a),r=r(a),t.flags|=1,An(e,t,r,o),t.child;case 14:return r=t.type,a=mo(r,t.pendingProps),a=mo(r.type,a),Bh(e,t,r,a,o);case 15:return ux(e,t,t.type,t.pendingProps,o);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:mo(r,a),Ds(e,t),t.tag=1,Vn(r)?(e=!0,ol(t)):e=!1,Ca(t,o),lx(t,r,a),Gd(t,r,a,o),Wd(null,t,r,!0,e,o);case 19:return fx(e,t,o);case 22:return px(e,t,o)}throw Error(nt(156,t.tag))};function Ax(e,t){return rf(e,t)}function bw(e,t,o,r){this.tag=e,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ro(e,t,o,r){return new bw(e,t,o,r)}function yp(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Cw(e){if(typeof e=="function")return yp(e)?1:0;if(e!=null){if(e=e.$$typeof,e===zu)return 11;if(e===qu)return 14}return 2}function yr(e,t){var o=e.alternate;return o===null?(o=ro(e.tag,t,e.key,e.mode),o.elementType=e.elementType,o.type=e.type,o.stateNode=e.stateNode,o.alternate=e,e.alternate=o):(o.pendingProps=t,o.type=e.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=e.flags&14680064,o.childLanes=e.childLanes,o.lanes=e.lanes,o.child=e.child,o.memoizedProps=e.memoizedProps,o.memoizedState=e.memoizedState,o.updateQueue=e.updateQueue,t=e.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},o.sibling=e.sibling,o.index=e.index,o.ref=e.ref,o}function Os(e,t,o,r,a,i){var s=2;if(r=e,typeof e=="function")yp(e)&&(s=1);else if(typeof e=="string")s=5;else e:switch(e){case aa:return zr(o.children,a,i,t);case Du:s=8,a|=8;break;case hd:return e=ro(12,o,t,a|2),e.elementType=hd,e.lanes=i,e;case md:return e=ro(13,o,t,a),e.elementType=md,e.lanes=i,e;case gd:return e=ro(19,o,t,a),e.elementType=gd,e.lanes=i,e;case B0:return Fl(o,a,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case O0:s=10;break e;case F0:s=9;break e;case zu:s=11;break e;case qu:s=14;break e;case ar:s=16,r=null;break e}throw Error(nt(130,e==null?e:typeof e,""))}return t=ro(s,o,t,a),t.elementType=e,t.type=r,t.lanes=i,t}function zr(e,t,o,r){return e=ro(7,e,r,t),e.lanes=o,e}function Fl(e,t,o,r){return e=ro(22,e,r,t),e.elementType=B0,e.lanes=o,e.stateNode={isHidden:!1},e}function Wc(e,t,o){return e=ro(6,e,null,t),e.lanes=o,e}function $c(e,t,o){return t=ro(4,e.children!==null?e.children:[],e.key,t),t.lanes=o,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function kw(e,t,o,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ec(0),this.expirationTimes=Ec(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ec(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function vp(e,t,o,r,a,i,s,l,c){return e=new kw(e,t,o,l,c),t===1?(t=1,i===!0&&(t|=8)):t=0,i=ro(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},np(i),e}function _w(e,t,o){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ra,key:r==null?null:""+r,children:e,containerInfo:t,implementation:o}}function Mx(e){if(!e)return br;e=e._reactInternals;e:{if(Vr(e)!==e||e.tag!==1)throw Error(nt(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Vn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(nt(171))}if(e.tag===1){var o=e.type;if(Vn(o))return Mf(e,o,t)}return t}function Rx(e,t,o,r,a,i,s,l,c){return e=vp(o,r,!0,e,a,i,s,l,c),e.context=Mx(null),o=e.current,r=Mn(),a=xr(o),i=Ho(r,a),i.callback=t??null,gr(o,i,a),e.current.lanes=a,zi(e,a,r),Wn(e,r),e}function Bl(e,t,o,r){var a=t.current,i=Mn(),s=xr(a);return o=Mx(o),t.context===null?t.context=o:t.pendingContext=o,t=Ho(i,s),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=gr(a,t,s),e!==null&&(yo(e,a,s,i),Ms(e,a,s)),s}function fl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Qh(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var o=e.retryLane;e.retryLane=o!==0&&o<t?o:t}}function wp(e,t){Qh(e,t),(e=e.alternate)&&Qh(e,t)}function Sw(){return null}var Lx=typeof reportError=="function"?reportError:function(e){console.error(e)};function bp(e){this._internalRoot=e}Hl.prototype.render=bp.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(nt(409));Bl(e,t,null,null)};Hl.prototype.unmount=bp.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Gr(function(){Bl(null,e,null,null)}),t[Uo]=null}};function Hl(e){this._internalRoot=e}Hl.prototype.unstable_scheduleHydration=function(e){if(e){var t=pf();e={blockedOn:null,target:e,priority:t};for(var o=0;o<sr.length&&t!==0&&t<sr[o].priority;o++);sr.splice(o,0,e),o===0&&mf(e)}};function Cp(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Gl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function em(){}function Nw(e,t,o,r,a){if(a){if(typeof r=="function"){var i=r;r=function(){var d=fl(s);i.call(d)}}var s=Rx(t,r,e,0,null,!1,!1,"",em);return e._reactRootContainer=s,e[Uo]=s.current,Si(e.nodeType===8?e.parentNode:e),Gr(),s}for(;a=e.lastChild;)e.removeChild(a);if(typeof r=="function"){var l=r;r=function(){var d=fl(c);l.call(d)}}var c=vp(e,0,!1,null,null,!1,!1,"",em);return e._reactRootContainer=c,e[Uo]=c.current,Si(e.nodeType===8?e.parentNode:e),Gr(function(){Bl(t,c,o,r)}),c}function Ul(e,t,o,r,a){var i=o._reactRootContainer;if(i){var s=i;if(typeof a=="function"){var l=a;a=function(){var c=fl(s);l.call(c)}}Bl(t,s,e,a)}else s=Nw(o,t,e,a,r);return fl(s)}df=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var o=ri(t.pendingLanes);o!==0&&(Bu(t,o|1),Wn(t,sn()),!(Mt&6)&&(Ma=sn()+500,Sr()))}break;case 13:Gr(function(){var r=Vo(e,1);if(r!==null){var a=Mn();yo(r,e,1,a)}}),wp(e,1)}};Hu=function(e){if(e.tag===13){var t=Vo(e,134217728);if(t!==null){var o=Mn();yo(t,e,134217728,o)}wp(e,134217728)}};uf=function(e){if(e.tag===13){var t=xr(e),o=Vo(e,t);if(o!==null){var r=Mn();yo(o,e,t,r)}wp(e,t)}};pf=function(){return Bt};hf=function(e,t){var o=Bt;try{return Bt=e,t()}finally{Bt=o}};Sd=function(e,t,o){switch(t){case"input":if(yd(e,o),t=o.name,o.type==="radio"&&t!=null){for(o=e;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<o.length;t++){var r=o[t];if(r!==e&&r.form===e.form){var a=Rl(r);if(!a)throw Error(nt(90));G0(r),yd(r,a)}}}break;case"textarea":V0(e,o);break;case"select":t=o.value,t!=null&&ya(e,!!o.multiple,t,!1)}};X0=gp;Q0=Gr;var Ew={usingClientEntryPoint:!1,Events:[Oi,ca,Rl,Y0,Z0,gp]},Qa={findFiberByHostInstance:Mr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Pw={bundleType:Qa.bundleType,version:Qa.version,rendererPackageName:Qa.rendererPackageName,rendererConfig:Qa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ko.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=nf(e),e===null?null:e.stateNode},findFiberByHostInstance:Qa.findFiberByHostInstance||Sw,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ls=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ls.isDisabled&&ls.supportsFiber)try{Tl=ls.inject(Pw),To=ls}catch{}}Qn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ew;Qn.createPortal=function(e,t){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Cp(t))throw Error(nt(200));return _w(e,t,null,o)};Qn.createRoot=function(e,t){if(!Cp(e))throw Error(nt(299));var o=!1,r="",a=Lx;return t!=null&&(t.unstable_strictMode===!0&&(o=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=vp(e,1,!1,null,null,o,!1,r,a),e[Uo]=t.current,Si(e.nodeType===8?e.parentNode:e),new bp(t)};Qn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(nt(188)):(e=Object.keys(e).join(","),Error(nt(268,e)));return e=nf(t),e=e===null?null:e.stateNode,e};Qn.flushSync=function(e){return Gr(e)};Qn.hydrate=function(e,t,o){if(!Gl(t))throw Error(nt(200));return Ul(null,e,t,!0,o)};Qn.hydrateRoot=function(e,t,o){if(!Cp(e))throw Error(nt(405));var r=o!=null&&o.hydratedSources||null,a=!1,i="",s=Lx;if(o!=null&&(o.unstable_strictMode===!0&&(a=!0),o.identifierPrefix!==void 0&&(i=o.identifierPrefix),o.onRecoverableError!==void 0&&(s=o.onRecoverableError)),t=Rx(t,null,e,1,o??null,a,!1,i,s),e[Uo]=t.current,Si(e),r)for(e=0;e<r.length;e++)o=r[e],a=o._getVersion,a=a(o._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[o,a]:t.mutableSourceEagerHydrationData.push(o,a);return new Hl(t)};Qn.render=function(e,t,o){if(!Gl(t))throw Error(nt(200));return Ul(null,e,t,!1,o)};Qn.unmountComponentAtNode=function(e){if(!Gl(e))throw Error(nt(40));return e._reactRootContainer?(Gr(function(){Ul(null,null,e,!1,function(){e._reactRootContainer=null,e[Uo]=null})}),!0):!1};Qn.unstable_batchedUpdates=gp;Qn.unstable_renderSubtreeIntoContainer=function(e,t,o,r){if(!Gl(o))throw Error(nt(200));if(e==null||e._reactInternals===void 0)throw Error(nt(38));return Ul(e,t,o,!1,r)};Qn.version="18.3.1-next-f1338f8080-20240426";function Dx(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Dx)}catch(e){console.error(e)}}Dx(),L0.exports=Qn;var Ba=L0.exports;const jw=Pu(Ba);var tm=Ba;ud.createRoot=tm.createRoot,ud.hydrateRoot=tm.hydrateRoot;const Tw={"app.title":"Prompt Modifier","app.subtitle":"Connect ideas to create a masterpiece","app.error.title":"Notification","app.error.copy":"Copy Message","app.error.copied":"Copied!","error.apiKey":"Your API key is invalid or missing permissions. Please select a valid API key.","error.scriptModifierCanvas":"This canvas belongs to another application - Script Modifier. Please use Script Modifier to open this file.","welcome.title":"Welcome to","welcome.description":"Welcome to Prompt Modifier. Connect ideas to create masterpieces. Use nodes to generate and edit content.","welcome.apiKeyLabel":"API Key","welcome.apiKeyPlaceholder":"Enter your API key","welcome.apiKeyHelp":"Your API key is stored locally in your browser.","welcome.getKeyLink":"Get API Key","welcome.iAmDeveloper":"I am a Developer","welcome.letsGo":"Let's Go","welcome.resume":"Resume","welcome.startNew":"Start New Canvas","welcome.freeModeActive":"Free Mode Active","welcome.selectLanguage":"Select your primary language","welcome.navHint":"Use keyboard keys  and  to change language","toast.contentCleared":"Content cleared","toast.downloadStarted":"Download started","toast.characterLoaded":"Character card loaded","toast.characterSavedDisk":"Character card saved to disk","toast.copiedToClipboard":"Copied to clipboard","toast.pastedFromClipboard":"Pasted from clipboard","toast.pasteFailed":"Paste failed","toast.nodeDuplicated":"Node duplicated","toast.groupSavedToDisk":'Group "{groupTitle}" saved to disk',"toast.groupDeleted":"Group and contents deleted","toast.characterSavedCatalog":"Character saved to catalog","toast.promptSaved":"Prompt saved to library: {promptName}...","toast.connectionsCut":"Connections removed","toast.apiKeySaved":"API Key saved successfully","toast.cacheCleared":"Cleared {count} unused items from cache","toast.cacheEmpty":"Cache is already optimized","toast.scriptSaved":"Script saved to disk","toast.modificationComplete":"Character modified successfully","toast.canvasSaved":"Canvas saved successfully","toast.projectSaved":"Project saved successfully","alert.groupSaved":'Group "{groupTitle}" saved to catalog.',"alert.loadCatalogFailed":"Failed to load catalog file","alert.invalidCatalogFile":"Invalid catalog file format","alert.fileNotSupported":'File not supported. Missing or incorrect "appName".',"alert.invalidCatalogStructure":'Invalid catalog structure. Missing "root".',"tutorial.step1":"Click here to add a random word to the prompt.","tutorial.step2":'Click "Process Prompt" to combine inputs using AI.',"tutorial.step2_waiting":"The AI is currently analyzing your inputs and generating a technical prompt specification...","tutorial.step3":"Finally, click here to generate the image.","tutorial.step3b":"Generation takes some time. You can monitor the progress here.","tutorial.step4":"You can add new nodes manually from this toolbar.","tutorial.group.catalog":"Use the Catalog to search for nodes or manage groups.","tutorial.group.general":"Add Sticky Notes and Data Readers for debugging.","tutorial.group.input":"Basic inputs for text, images, and sequences.","tutorial.group.processing":"Analyze and process prompts or images with AI.","tutorial.group.character":"Create, analyze, and store detailed characters.","tutorial.group.output":"Display results and generate sequences.","tutorial.group.ai":"Chat with Gemini and translate text.","tutorial.group.video":"Tools for video prompts and editing.","tutorial.group.scripts":"Generate and view scripts for complex stories.","tutorial.group.file":"Save your work, load projects, or download the canvas.","tutorial.success.title":"Tutorial Completed!","tutorial.success.message":"You have successfully learned the basics of Prompt Modifier. Good luck creating masterpieces!","tutorial.success.button":"Start Creating","tutorial.skip":"Skip","tutorial.next":"Next","tutorial.finish":"Got it"},Iw={"toolbar.settings":"Settings","toolbar.resetCanvas":"Reset to Default","toolbar.clearCache":"Clear Unused Cache","toolbar.home":"Home","toolbar.exitApp":"Close Project","toolbar.edit":"Edit (V)","toolbar.cutter":"Cut Connection (C) / (Hold Ctrl)","toolbar.selection":"Selection (S) / (Hold Shift)","toolbar.reroute":"Reroute (R) / (Hold Ctrl+Alt)","toolbar.zoom":"Zoom (Hold Z)","toolbar.snapToGrid":"Snap to Grid","toolbar.smartGuides":"Smart Guides (Magnet)","toolbar.lineStyleSpaghetti":"Spaghetti Lines","toolbar.lineStyleOrthogonal":"Orthogonal Lines","toolbar.resetZoom":"Reset Zoom","toolbar.resetCamera":"Reset Camera Position","toolbar.clearCanvas":"Clear Canvas","toolbar.addNode":"Add Node (F)","toolbar.catalog":"Open Catalog (Ctrl + Space)","toolbar.addNote":"Add Note (N)","toolbar.addDataReader":"Add Data Reader (Shift + R)","toolbar.addTextInput":"Add Text Input (T)","toolbar.addImageInput":"Add Image Input (I)","toolbar.addPromptSequenceEditor":"Add Prompt Sequence Editor (Q)","toolbar.addImageAnalyzer":"Add Image Analyzer (Shift+A)","toolbar.addPromptAnalyzer":"Add Prompt Analyzer (A)","toolbar.addPromptProcessor":"Add Prompt Processor (P)","toolbar.addCharacterGenerator":"Add Character Generator (Shift+C)","toolbar.addCharacterAnalyzer":"Add Character Analyzer (Ctrl+Shift+A)","toolbar.addCharacterCard":"Add Character Card (Ctrl+Shift+C)","toolbar.addImageOutput":"Add Image Output (O)","toolbar.addImageEditor":"Add AI Image Editor (Shift+I)","toolbar.addImageSequenceGenerator":"Add Image Sequence Generator (Shift+Q)","toolbar.addTranslator":"Add Translator (L)","toolbar.addGeminiChat":"Add Gemini Chat (M)","toolbar.addVideoPromptProcessor":"Add Video Prompt Processor (Shift+P)","toolbar.addVideoOutput":"Add Video Output (Shift+O)","toolbar.addScriptGenerator":"Add Script Generator","toolbar.addScriptViewer":"Add Script Viewer (Shift + V)","toolbar.saveCanvas":"Save Canvas (Ctrl + S)","toolbar.saveProject":"Save Project","toolbar.saveToDrive":"Save to Google Drive","toolbar.loadCanvas":"Load Project/Canvas (Ctrl + O)","toolbar.group.general":"General","toolbar.group.catalog":"Catalog","toolbar.group.input":"Input","toolbar.group.processing":"Processing","toolbar.group.character":"Character","toolbar.group.output":"Output","toolbar.group.aiTools":"AI Tools","toolbar.group.video":"Video","toolbar.group.scripts":"Scripts","toolbar.group.file":"File","toolbar.title":"Toolbar","toolbar.dock":"Dock Toolbar","toolbar.detach":"Detach Toolbar","toolbar.expandPanel":"Expand Panel","toolbar.collapsePanel":"Collapse Panel","toolbar.dockArea.title":"Dock Toolbar Here","toolbar.duplicate":"Duplicate Node","toolbar.duplicateWithContent":"Duplicate with Content","toolbar.dock.q1":"Left 1st Qtr","toolbar.dock.q2":"Left 2nd Qtr","toolbar.dock.q3":"Right 3rd Qtr","toolbar.dock.q4":"Right 4th Qtr","toolbar.dock.tl":"Top Left","toolbar.dock.bl":"Bottom Left","toolbar.dock.tr":"Top Right","toolbar.dock.br":"Bottom Right","toolbar.dock.left":"Left Half","toolbar.dock.right":"Right Half","toolbar.dock.full":"Full Screen","toolbar.dock.exitFull":"Exit Full Screen","toolbar.dock.fullFocus":"Full Screen Focus","hotkeys.show":"Show Hotkeys","hotkeys.tools.title":"Tools","hotkeys.tools.edit":"Edit Mode","hotkeys.tools.cutter":"Cutter Tool","hotkeys.tools.selection":"Selection Tool","hotkeys.tools.reroute":"Reroute Tool","hotkeys.tools.zoom":"Zoom Tool","hotkeys.tools.toggleLineStyle":"Toggle Line Style","hotkeys.tools.group":"Group Selection","hotkeys.tools.closeNode":"Delete Selected","hotkeys.tools.duplicate":"Duplicate Node","hotkeys.tools.duplicateWithContent":"Duplicate with Content","hotkeys.tools.deleteGroup":"Delete Group (Shift+Click)","hotkeys.windows.title":"Windows","hotkeys.windows.search":"Quick Search","hotkeys.windows.catalog":"Catalog","hotkeys.createNode.title":"Create Node","help.panelTitle":"Help & Hotkeys","help.subtitle":"Help Center","help.title":"Keyboard Shortcuts","help.howToUse.title":"How to Use","help.howToUse.content":"Welcome to Prompt Modifier! Use the toolbar or hotkeys to add nodes. Connect nodes to pass data. Use the Edit tool to move nodes and pan the canvas. Double-click on empty space to open Quick Add menu. Right-click for context menu.","help.author":"Author","help.tab.links":"Other Apps & Links","help.section.socials":"Socials","help.section.studioStable":"Google AI Studio (Stable)","help.section.studioAlpha":"Google AI Studio (Alpha)","help.section.netlify":"Netlify Apps","help.section.github":"GitHub Repos","help.section.githubPages":"Applications on GitHub","help.license":"Licensed under GNU GPLv3","help.copyLink":"Copy Link","help.copied":"Copied!","contextMenu.undoPosition":"Undo Position","contextMenu.redoPosition":"Redo Position","contextMenu.align.left":"Align Left (F)","contextMenu.align.centerX":"Align Center X (E)","contextMenu.align.right":"Align Right (R)","contextMenu.align.top":"Align Top (T)","contextMenu.align.centerY":"Align Center Y (D)","contextMenu.align.bottom":"Align Bottom (B)","contextMenu.distribute.horizontal":"Distribute Horiz. (Ctrl+D)","contextMenu.distribute.vertical":"Distribute Vert. (Ctrl+E)","contextMenu.emptySlot":"Empty Slot (Right-click to assign)","contextMenu.saveSlots":"Save Slots Config","contextMenu.loadSlots":"Load Slots Config","quickadd.title":"Quick Add","quickadd.group.tools":"Tools","quickadd.group.inputs":"Inputs","quickadd.group.processing":"Processing","quickadd.group.character":"Character","quickadd.group.outputs":"Outputs","quickadd.group.ai":"AI Tools","quickadd.group.video":"Video","quickadd.group.scripts":"Scripts","quickadd.group.general":"General","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"Edit","quickadd.tool.cutter":"Cutter","quickadd.tool.selection":"Selection","search.placeholder":"Search for a node to add...","search.noResults":"No nodes found.","search.group.input":"Input & Basic","search.group.process":"Processing & Character","search.group.output":"Image & Sequence","search.group.ai":"AI Tools","search.group.video":"Video & Scripting","search.group.scripts":"Scripts","toolbar.enterFullScreen":"Full Screen","toolbar.exitFullScreen":"Exit Full Screen","dialog.settings.hoverHighlightLabel":"Node Hover Highlight"},Aw={"node.title.text_input":"Text Input","node.title.image_input":"Image Input","node.title.prompt_processor":"Prompt Processor","node.title.prompt_sanitizer":"Prompt Sanitizer","node.title.video_prompt_processor":"Video Prompt Processor","node.title.image_output":"Image Output","node.title.video_output":"Video Output","node.title.prompt_analyzer":"Prompt Analyzer","node.title.character_analyzer":"Character Analyzer","node.title.character_generator":"Character Generator","node.title.character_card":"Character Card","node.title.image_analyzer":"Image Analyzer","node.title.image_editor":"AI Image Editor","node.title.image_sequence_generator":"Image Sequence Generator","node.title.prompt_sequence_editor":"Prompt Sequence Editor","node.title.gemini_chat":"Gemini Chat","node.title.translator":"Translator","node.title.script_generator":"Script Generator","node.title.script_viewer":"Script Viewer","node.title.note":"Note","node.title.reroute_dot":"Reroute Dot","node.title.data_reader":"Data Reader","node.title.video_editor":"Video Editor Alpha","node.title.media_viewer":"Media Viewer","node.title.data_protection":"Data Protection","node.title.pose_creator":"Pose Creator","node.help.text_input":"A simple multiline text field for entering prompts or notes.","node.help.image_input":"Allows you to upload or paste an image to use as input for other nodes.","node.help.prompt_processor":"Combines multiple text inputs into a single, technical prompt specification using AI.","node.help.prompt_sanitizer":"Rewrites the input prompt to be safer for image generation policies while preserving artistic intent.","node.help.video_prompt_processor":"Specialized processor for creating detailed video generation prompts.","node.help.image_output":"Displays the result of image generation. Supports downloading and viewing.","node.help.video_output":"Displays the result of video generation using the Veo model.","node.help.prompt_analyzer":"Deconstructs a prompt into components like subject, style, and environment.","node.help.character_analyzer":"Analyses a character description and splits it into appearance and clothing.","node.help.character_generator":"Generates detailed character descriptions based on a short prompt.","node.help.character_card":"Stores comprehensive character data including image and description.","node.help.image_analyzer":"Uses AI to describe the content of an input image.","node.help.image_editor":"Advanced tool for editing images using text prompts and inpainting/outpainting.","node.help.image_sequence_generator":"Generates a sequence of images based on a list of prompts.","node.help.prompt_sequence_editor":"Allows bulk editing of prompt sequences using AI instructions.","node.help.gemini_chat":"A general-purpose chat interface with Gemini for brainstorming or assistance.","node.help.translator":"Translates text between languages using AI models.","node.help.script_generator":"Generates a structured script (scenes, characters) from a story idea.","node.help.script_viewer":"Visualizes and manages script data for frame-by-frame generation.","node.help.note":"A sticky note for adding comments or instructions to the canvas.","node.help.reroute_dot":"A small dot used to organize connections and create cleaner layouts.","node.help.data_reader":"Debug tool for inspecting raw data flowing through connections.","node.help.video_editor":"A timeline-based tool for editing video clips and images.","node.help.media_viewer":"A player for viewing video and audio files with playback controls.","node.help.data_protection":"An interactive Tower Defense game node. Defend your data stream from corruption.","node.help.pose_creator":"Visually rig and create character poses for generation guidance.","node.action.expand":"Expand","node.action.collapse":"Collapse","node.action.help":"Help","node.action.download":"Download","node.action.clear":"Clear Content","node.action.refreshChat":"Clear and Restart Chat","node.action.paste":"Paste","node.action.resetEditor":"Reset Editor","node.action.saveCharacter":"Save to Disk","node.action.loadCharacter":"Load from Disk","node.action.copy":"Copy","node.action.copyImage":"Copy Image","node.action.copyTextPrompt":"Copy Prompt","node.action.copyImagePrompt":"Copy Image Prompt","node.action.copyVideoPrompt":"Copy Video Prompt","node.action.cutConnections":"Cut Connections","node.action.close":"Close","node.action.closeNode":"Close Node (Shift+Click for instant close)","node.action.closeNodeSimple":"Close Node","node.action.randomWord":"Add Random Word","node.action.processImage":"Remove Watermarks","node.action.processImageTitle":"Uses Gemini to remove watermarks and text from the image.","node.action.editor":"Editor","node.action.rasterEditor":"Raster Editor","node.action.openInAIEditor":"Open in AI Editor","node.action.openInAnalyzer":"Open in Analyzer","node.action.outputToInput":"Use Output as Input","node.action.processChainForward":"Process Forward","node.action.executeChain":"Execute Chain","node.action.executeChainTitle":"Execute all upstream nodes to generate the final result.","node.action.sanitize":"Sanitize","node.action.rename":"Rename","node.action.stop":"Stop","node.action.stopping":"Stopping...","node.action.deleteItem":"Delete Item","node.action.detachAndPaste":"Detach and Paste","node.action.delete":"Delete","node.action.flipImage":"Flip Image","node.action.pin":"Pin Node to Top","node.action.unpin":"Unpin Node","node.action.updateDescription":"Update description from prompt","node.action.updatePersonality":"Update Personality","node.action.updateAppearance":"Update Appearance from prompt","node.action.updateClothing":"Update Clothing from prompt","node.action.modifyCharacter":"Request Changes","node.action.updateDataFormat":"Update data format","node.action.expand169":"Expand to 16:9","node.action.expand916":"Expand to 9:16","node.action.sync":"Sync from connections","node.action.expandRatio":"Extend Aspect Ratio","node.action.markPrimary":"Mark as Primary","node.action.addCard":"Add Card","node.action.removeCard":"Remove Card","node.action.showOutputs":"Show Outputs","node.action.hideOutputs":"Hide Outputs","node.action.showImages":"Show Images","node.action.hideImages":"Hide Images","node.action.characterConcept":"Character Concept","node.action.objectConcept":"Object Concept","node.action.downloadTxt":"Download .txt","node.action.downloadDoc":"Download .doc","node.mediaViewer.play":"Play","node.mediaViewer.pause":"Pause","node.mediaViewer.stop":"Stop","node.mediaViewer.addMarker":"Add Marker","node.mediaViewer.exportSRT":"Export Markers (SRT)","node.mediaViewer.deleteAllMarkers":"Delete All Markers","node.mediaViewer.saveMarkers":"Save Markers to Disk","node.mediaViewer.loadMarkers":"Load Markers from Disk","node.mediaViewer.relink":"Relink File","node.content.notePlaceholder":"Type your notes here...","node.content.dropImage":"Drop image here or click to upload","node.content.dropMedia":"Drop video or audio here","node.content.processing":"Processing...","node.content.processingChain":"Processing Chain...","node.content.metadataPrompt":"Prompt from Image Metadata:","node.content.metadataPromptPlaceholder":"No prompt found in image.","node.content.copyPrompt":"Use","node.content.prompt":"Prompt","node.content.promptPlaceholder":"Enter prompt for image generation...","node.content.inputPrompt":"Input Prompt","node.content.enhancedResult":"Processed Result","node.content.videoPrompt":"Video Prompt","node.content.editPromptPlaceholder":"Add to or edit the prompt...","node.content.enhancedPromptHere":"Processed prompt will appear here...","node.content.safePrompt":"Safe for commercial use","node.content.generating":"Generating...","node.content.imageHere":"Image will appear here","node.content.generationMode":"Generation Model","node.content.aspectRatio":"Aspect Ratio","node.content.aspectRatioHelp":"Set aspect ratio for image generation","node.content.aspectRatioNotSupportedFast":"Aspect ratio only available for Imagen models.","node.content.enableAspectRatioFormatting":"Enable Aspect Ratio Formatting","node.content.autoDownload":"Auto Download","node.content.generateImage":"Generate Image","node.content.enhancing":"Processing...","node.content.enhancePrompt":"Process Prompt","node.content.sanitizing":"Sanitizing...","node.content.sanitizedPromptHere":"Sanitized prompt will appear here...","node.content.analyzing":"Analyzing...","node.content.analyzePrompt":"Analyze Prompt","node.content.analyzeImage":"Analyze Image","node.content.imageToText":"Image to Text","node.content.updatePromptFromImage":"Update prompt from image","node.content.analyzeCharacter":"Analyze Character","node.content.generateCharacters":"Generate Characters","node.content.characterPromptPlaceholder":"Describe character(s) to generate...","node.content.character":"Character","node.content.clothing":"Clothing","node.content.characterPlaceholder":"Character description will appear here...","node.content.clothingPlaceholder":"Clothing description will appear here...","node.content.appearance":"Appearance","node.content.appearancePlaceholder":"Describe physical appearance...","node.content.personality":"Personality","node.content.personalityPlaceholder":"Describe personality or request changes...","node.content.environment":"Environment/Setting","node.content.action":"Action","node.content.emotion":"Emotion","node.content.style":"Style","node.content.environmentPlaceholder":"Detailed description of the environment...","node.content.charactersPlaceholder":"List of main characters...","node.content.characters":"Characters","node.content.characterConcepts":"Character Concepts","node.content.actionPlaceholder":"Description of the action...","node.content.emotionPlaceholder":"Description of the emotion...","node.content.stylePlaceholder":"Description of the art style...","node.content.descriptionHere":"Description will appear here...","node.content.enableOutpainting":"Enable Outpainting","node.content.outpaintingPromptPlaceholder":"Outpainting prompt...","node.content.inputImage":"Input Images","node.content.dropOrClick":"Drop or Click","node.content.outputImage":"Output Image","node.content.applyEdit":"Apply Edit","node.content.editing":"Editing...","node.content.chatPlaceholder":"Type your message...","node.content.connectedPlaceholder":"Connected to node, edit in source.","node.content.connectedNode":"Connected via node","node.content.connectedEmpty":"Connected node has no image.","node.content.translatePlaceholder":"Text to translate...","node.content.translatedTextPlaceholder":"Text translated...","node.content.targetLanguage":"Target Language","node.content.translate":"Translate","node.content.translating":"Translating...","node.content.scriptPromptPlaceholder":"Enter a story idea or plot...","node.content.generateScript":"Generate Script","node.content.loadScript":"Load Script File","node.content.summary":"Summary","node.content.scenes":"Scenes","node.content.unrecognizedFormat":"Unrecognized script format.","node.content.frames":"Frames","node.content.characterIndex":"Index","node.content.readData":"Read Data","node.content.textDataHere":"Text data will appear here.","node.content.noDataRead":'Connect a node and click "Read Data" to view its contents.',"node.content.previewError":"Preview Error","node.content.previewPlaceholder":"Preview will appear here","node.content.imagePrompt":"Image Prompt","node.output.allPromptData":"All Prompt Data","node.note.tab.note":"Note","node.note.tab.references":"References","node.note.nestedImages":"Nested Images","node.note.dropPlaceholder":"Drop images or click to add","node.note.addCaption":"Caption","node.note.action.shuffle":"Shuffle","node.note.action.undoShuffle":"Undo Shuffle","node.content.characterTypeShort":"Type:","node.content.numberOfCharactersShort":"Qty:","node.content.characterType.simple":"Simple","node.content.characterType.anthro":"Anthro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Key Item","node.content.style.simple":"Simple","node.content.style.realistic":"Realistic","node.content.style.3d_cartoon":"3D Cartoon","node.content.style.3d_realistic":"3D Realistic","node.content.style.2d_animation":"2D Animation","node.content.style.anime":"Anime","node.content.style.comics":"Comics","node.content.style.custom":"Custom","node.content.fullDescriptionTitle":"Full character description","node.content.integrationInstruction":"Integration Instruction","node.content.additionalPromptSuffix":"Additional Prompt (Suffix)","node.content.insertSceneContext":"Insert Scene Context","node.content.modificationRequest":"Modification Request","search.node.text_input.title":"Text Input","search.node.text_input.description":"A simple multiline text field.","search.node.image_input.title":"Image Input","search.node.image_input.description":"Allows you to upload or paste an image.","search.node.prompt_sequence_editor.title":"Prompt Sequence Editor","search.node.prompt_sequence_editor.description":"Edits a list of prompts using a single instruction, allowing for batch modifications.","search.node.data_reader.title":"Data Reader","search.node.data_reader.description":"Reads and displays the raw output (text or image) from any connected node for debugging purposes.","search.node.note.title":"Note","search.node.note.description":"A sticky note for comments.","search.node.prompt_processor.title":"Prompt Processor","search.node.prompt_processor.description":"Combines inputs into an enhanced prompt.","search.node.prompt_analyzer.title":"Prompt Analyzer","search.node.prompt_analyzer.description":"Deconstructs a prompt into components.","search.node.prompt_sanitizer.title":"Prompt Sanitizer","search.node.prompt_sanitizer.description":"Rewrites the prompt to be safer for AI models.","search.node.character_card.title":"Character Card","search.node.character_card.description":"Stores detailed information about a character.","search.node.character_analyzer.title":"Character Analyzer","search.node.character_analyzer.description":"Splits a description into appearance and clothing.","search.node.character_generator.title":"Character Generator","search.node.character_generator.description":"Generates one or more detailed character descriptions based on a prompt.","search.node.image_analyzer.title":"Image Analyzer","search.node.image_analyzer.description":"Describes an image using AI.","search.node.image_editor.title":"AI Image Editor","search.node.image_editor.description":"Edits or combines images with a prompt.","search.node.image_sequence_generator.title":"Image Sequence Generator","search.node.image_sequence_generator.description":"Generates a sequence of images based on a list of prompts.","search.node.gemini_chat.title":"Gemini Chat","search.node.gemini_chat.description":"A conversational interface to chat with Gemini, useful for brainstorming or assistance.","search.node.translator.title":"Translator","search.node.translator.description":"Translates text between languages using AI models.","search.node.script_generator.title":"Script Generator","search.node.script_generator.description":"Generates a structured script (scenes, characters) from a story idea.","search.node.script_viewer.title":"Script Viewer","search.node.script_viewer.description":"Visualizes and manages script data for frame-by-frame generation.","search.node.note":"A simple text box for leaving notes and comments on the canvas.","search.node.reroute_dot":"A small dot used to organize connections and create cleaner layouts.","search.node.video_prompt_processor.title":"Video Prompt Processor","search.node.video_prompt_processor.description":"Creates detailed prompts for video generation.","search.node.video_output.title":"Video Output","search.node.video_output.description":"Generates a video using the Veo model.","search.node.image_output.title":"Image Output","search.node.image_output.description":"Displays and allows downloading of generated images.","search.node.media_viewer.title":"Media Viewer","search.node.media_viewer.description":"Player for viewing video and audio files with playback controls.","search.node.data_protection.title":"Data Protection","search.node.data_protection.description":"Defend your data stream from corruption in this mini-game node.","search.node.pose_creator.title":"Pose Creator","search.node.pose_creator.description":"Visually rig and create character poses for generation guidance.","prompt_sequence_editor.instructionPlaceholder":"Enter instruction to modify prompts...","prompt_sequence_editor.modifying":"Modifying...","prompt_sequence_editor.modifySelected":"Modify Selected ({count})","prompt_sequence_editor.sourcePrompts":"Source Prompts","prompt_sequence_editor.finalPrompts":"Modified Prompts","prompt_sequence_editor.error.invalidInput":"Invalid data format. Please connect a prompt sequence array.","geminiChat.mode.general":"General","geminiChat.mode.prompt":"Prompt Expert","geminiChat.mode.script":"Script Writer","geminiChat.mode.youtube":"YouTube Analyst","image_sequence.deselect_scene":"Deselect all frames in this scene","image_sequence.clear_prompts_only":"Clear Text Prompts Only","image_sequence.prev_scene":"Previous Scene","image_sequence.next_scene":"Next Scene","image_sequence.frames_hidden":"({count} frames hidden)","image_sequence.frames_count":"({count} frames)","image_sequence.auto_crop":"Auto Crop 16:9","image_sequence.create_zip":"Create ZIP Archive","node.content.technicalPrompt":"Technical Prompt","node.promptProcessor.safePromptTooltip":"Rewrites the prompt to comply with safety guidelines and avoid policy violations.","node.promptProcessor.technicalPromptTooltip":"Converts the prompt into a highly detailed technical specification (lighting, camera, render settings).","node.promptProcessor.enhanceTooltip":"Uses AI to expand and enrich the prompt with descriptive details.","node.promptProcessor.chainTooltip":"Executes this node and triggers all connected downstream nodes.","image_sequence.tooltip.autoCrop":"Automatically crops generated images to 16:9 ratio.","image_sequence.tooltip.autoDownload":"Automatically saves each image to your device upon generation.","image_sequence.tooltip.createZip":"Packages all selected images into a single ZIP archive for download."},Mw={"imageEditor.title":"Image Editor","imageEditor.canvasResolution":"Canvas Resolution","imageEditor.background":"Background","imageEditor.toolSettings":"Tool Settings","imageEditor.snapToEdges":"Snap to Edges","imageEditor.freeAspect":"Free Aspect Ratio","imageEditor.section.aiRequest":"AI Modification Request","imageEditor.input.modificationPlaceholder":'Describe changes, e.g., "change background to blue"',"imageEditor.action.sendRequest":"Send Request","imageEditor.tooltip.removeObject":"Remove (Red) / Keep (Green)","imageEditor.action.removeObject":"Remove Object","imageEditor.action.removeBackground":"Remove Background","imageEditor.tool.transform":"Transform","imageEditor.tool.hand":"Hand (Pan)","imageEditor.tool.zoom":"Zoom","imageEditor.tool.pencil":"Pencil","imageEditor.tool.rectangle":"Rectangle","imageEditor.action.fit":"Fit to Canvas","imageEditor.action.fill":"Fill Canvas","imageEditor.action.cancel":"Cancel","imageEditor.action.resetEdits":"Reset Edits","imageEditor.action.apply":"Apply","imageViewer.title":"Image Viewer","imageEditor.outputResolution":"Output Resolution","imageEditor.outputResolutionHelp":'Set output resolution. If "Auto", uses canvas resolution.',"imageEditor.currentSize":"Current Size: {width}x{height}","imageEditor.sequenceMode":"Sequence Mode","imageEditor.sequenceModeHelp":"Process input images from Input A sequentially.","imageEditor.sequentialCombination":"Sequential Image Combination","imageEditor.sequentialCombinationHelp":"For each frame: Sends current Input A image + All Input B images.","imageEditor.sequentialPrompt":"Sequential Prompt Combination","imageEditor.sequentialPromptHelp":"For each frame: Uses a unique prompt from the list + current image.","imageEditor.sequentialEditingWithPrompts":"Sequential Editing with Prompts","imageEditor.sequentialEditingWithPromptsHelp":"For each frame: Uses Input B image + unique prompt. Input A is ignored.","imageEditor.input":"Input","imageEditor.inputA":"Input A","imageEditor.inputB":"Input B","imageEditor.status.queued":"Queued","imageEditor.status.generating":"Generating...","imageEditor.action.regenerate":"Regenerate","imageEditor.tooltip.fit":"Fit image to canvas boundaries (contain).","imageEditor.tooltip.fill":"Scale image to fill canvas (cover).","imageEditor.tooltip.flip":"Flip image horizontally.","imageEditor.background.white":"White","imageEditor.background.gray":"Gray","imageEditor.background.black":"Black","imageEditor.background.dark":"Dark","image_sequence.regenerate":"Regenerate","image_sequence.stop_queue":"Stop Queue","image_sequence.move_up":"Move Up","image_sequence.move_down":"Move Down","image_sequence.copy_prompt":"Copy Prompt","image_sequence.add_frame":"Add Frame","image_sequence.delete_frame":"Delete Frame","image_sequence.expand_all_frames":"Expand/Collapse All Frames","image_sequence.collapse_all_frames":"Collapse All Frames","image_sequence.expand_all_scenes":"Expand/Collapse All Scenes","image_sequence.collapse_all_scenes":"Collapse All Scenes","image_sequence.expand_all":"Expand All","image_sequence.collapse_all":"Collapse All","image_sequence.clear_all_prompts":"Clear All Prompts","image_sequence.add_first_frame":"Add First Frame","image_sequence.drop_or_add_title":"Drop Sequence JSON or Add Frame","image_sequence.drop_or_add_desc":"Drop a JSON file here or click to add a frame manually.","image_sequence.load_prompts":"Load Prompts","image_sequence.output_images_title":"Output Images","image_sequence.prompts_list_title":"Source Prompts","image_sequence.download_selected":"Download Selected","image_sequence.select_all":"Select All","image_sequence.select_none":"Select None","image_sequence.invert_selection":"Invert Selection","image_sequence.run_selected":"Run Selected","image_sequence.start_queue":"Start Queue","image_sequence.character_prompt_combination":"Character Prompt Combination","image_sequence.combination_none":"None","image_sequence.combination_combine":"Combine","image_sequence.combination_replace":"Replace Tags","image_sequence.status.error":"Error","image_sequence.status.pending":"Queued","image_sequence.clear_selected_prompts":"Clear Selected Prompts","image_sequence.range_from":"From:","image_sequence.range_to":"To:","image_sequence.stats.total":"Total Frames: {count}","image_sequence.stats.generated":"Generated: {count}","image_sequence.stats.queue":"Queue: {count}","image_sequence.edit_in_source":"Edit in Source","image_sequence.edit_prompt":"Edit Prompt","image_sequence.select_scene":"Select Scene","image_sequence.next_scene":"Next Scene","image_sequence.prev_scene":"Previous Scene","image_sequence.scene_input_label":"Scene","image_sequence.select_square":"Select Square (1:1)","image_sequence.select_landscape":"Select Landscape (16:9)","image_sequence.select_portrait":"Select Portrait (9:16)","image_sequence.select_range":"Select Range","image_sequence.force_refresh":"Force Refresh","image_sequence.select_scene_frames":"Select all frames in this scene","image_sequence.collapse_other_scenes":"Collapse other scenes","prompt_sequence_editor.instructionPlaceholder":"Enter instruction to modify prompts...","prompt_sequence_editor.modifying":"Modifying...","prompt_sequence_editor.modifySelected":"Modify Selected ({count})","prompt_sequence_editor.sourcePrompts":"Source Prompts","prompt_sequence_editor.finalPrompts":"Modified Prompts","prompt_sequence_editor.error.invalidInput":"Invalid data format. Please connect a prompt sequence array.","geminiChat.mode.general":"General","geminiChat.mode.prompt":"Prompt Expert","geminiChat.mode.script":"Script Writer","geminiChat.mode.youtube":"YouTube Analyst","geminiChat.mode.developer":"Developer","image_sequence.shot_type.WS":"Integrate the Entity with a Wide Shot (WS) into the scene and action. Show the environment.","image_sequence.shot_type.MS":"Integrate the Entity with a Medium Shot (MS) into the scene. Character from waist up.","image_sequence.shot_type.CU":"Integrate the Entity with a Close-Up (CU) into the scene.","image_sequence.shot_type.ECU":"Integrate the Entity with an Extreme Close-Up (ECU) into the scene. Maximum detail.","image_sequence.shot_type.LS":"Integrate the Entity with a Long Shot (LS) into the scene to show scale."},Rw={"dialog.permission.title":"Permission Required","dialog.permission.description":"This app needs permission to read from your clipboard to allow pasting content into nodes. Your data is not stored or sent anywhere.","dialog.permission.allow":"Allow","dialog.permission.decline":"Decline","dialog.rename.title":"Rename Item","dialog.rename.group.title":"Rename Group","dialog.rename.catalog.title":"Rename Catalog Item","dialog.rename.node.title":"Rename Node","dialog.rename.label":"New Name:","dialog.rename.confirm":"Rename","dialog.rename.cancel":"Cancel","dialog.promptEdit.title":"Edit Prompt","dialog.promptEdit.nameLabel":"Name:","dialog.promptEdit.contentLabel":"Content:","dialog.promptEdit.confirm":"Save","dialog.promptEdit.cancel":"Cancel","dialog.confirmDelete.title":"Confirm Deletion","dialog.confirmDelete.message":"Are you sure you want to delete this item? This action cannot be undone.","dialog.confirmDelete.confirm":"Delete","dialog.confirmDelete.cancel":"Cancel","dialog.confirmCloseTab.title":"Close Tab","dialog.confirmCloseTab.message":'Are you sure you want to close the tab "{tabName}"? Unsaved changes will be lost.',"dialog.confirmClear.title":"Clear Canvas","dialog.confirmClear.message":"Are you sure you want to clear the entire canvas? This action cannot be undone.","dialog.confirmReset.title":"Reset to Default","dialog.confirmReset.message":"Are you sure you want to reset the canvas to the default state? All current work will be lost.","dialog.confirmReset.confirm":"Reset","dialog.confirmLoad.title":"Confirm Load","dialog.confirmLoad.message":"Loading a new file will replace the current content. Any unsaved changes will be lost. Continue?","dialog.apiKey.title":"Select API Key","dialog.apiKey.description":'This feature requires a Project API key with the "AI Platform" API enabled. Video generation can take a few minutes.',"dialog.apiKey.billingLink":"Learn more about billing","dialog.apiKey.button":"Select API Key","dialog.settings.title":"Settings","dialog.settings.apiKeyLabel":"Google Gemini API Key","settings.googleClientIdLabel":"Client ID","settings.googleDriveTitle":"Google Drive Integration","settings.signInWithGoogle":"Sign In with Google","dialog.settings.useDevKeyLabel":"Use free API key (for development)","dialog.settings.instantNodeCloseLabel":"Instant node closing","dialog.settings.nodeAnimationLabel":"Node Addition Animation","dialog.settings.animationModeLabel":"Creation Animation Mode","dialog.settings.anim.pulse":"Pulse","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"None","dialog.settings.description":"Configure your environment preferences and API access below.","dialog.settings.getKeyLink":"Get an API Key here","dialog.settings.save":"Save & Close","dialog.settings.reload":"Restart App","dialog.deleteNode.title":"Close node?","dialog.deleteNode.titlePlural":"Close nodes?","dialog.deleteNode.confirm":"Yes","dialog.deleteNode.cancel":"No","dialog.deleteNode.confirmTooltip":"Close node - lost data cannot be recovered","dialog.deleteNode.cancelTooltip":"Do not close - continue working with the node","dialog.deleteNode.dontShowAgain":"Don't show again","dialog.exitApp.title":"Close Project?","dialog.exitApp.message":"Are you sure you want to close the project? All current work will be lost and the canvas will be reset.","toast.driveSaved":"Project saved to Google Drive successfully","toast.driveSaveFailed":"Failed to save to Google Drive","error.googleDriveInit":"Google Drive Client ID not set. Please configure it in Settings.","settings.group.api":"API & Access","settings.group.style":"Appearance & Behavior","settings.group.drive":"Cloud Storage","settings.themeLabel":"Interface Theme","dialog.reload.title":"Restart Application?","dialog.reload.message":"This will clear the current canvas completely and reload the page. Any unsaved changes will be lost.","dialog.settings.connectionsLabel":"Connections Style","dialog.settings.connectionAnimationLabel":"Data Flow Animation","dialog.settings.connectionOpacityLabel":"Line Opacity"},Lw={"group.button.create":"Create Group ({count})","group.rename":"Rename Group","group.saveToCatalog":"Save to Catalog","group.saveToDisk":"Save to Disk","group.ungroup":"Ungroup (Shift+Click to delete with content)","group.duplicate":"Duplicate group with content","catalog.tabs.groups":"Groups","catalog.tabs.library":"Library","catalog.tabs.characters":"Characters","catalog.tabs.scripts":"Scripts","catalog.tabs.sequences":"Sequences","catalog.back":"Back","catalog.load":"Load from File","catalog.newFolder":"New Folder","catalog.saveTo":"Save to Catalog","catalog.card.addToCanvas":"Add to Canvas","catalog.card.rename":"Rename","catalog.card.save":"Save","catalog.card.delete":"Delete","catalog.empty.description":"This folder is empty. You can add items or create new folders.","library.loadFromFile":"Load","library.actions.newFolder":"New Folder","library.actions.newPrompt":"New Prompt","library.actions.copy":"Copy","library.actions.edit":"Edit","library.empty.title":"Empty Folder","library.empty.description":"Create prompts and folders to get started.","library.emptyPrompt":"Empty prompt"},Dw={...Tw,...Iw,...Aw,...Mw,...Rw,...Lw},zw={"app.title":" ","app.subtitle":"    ","app.error.title":"","app.error.copy":" ","app.error.copied":"!","error.apiKey":" API-   . ,   API-.","error.scriptModifierCanvas":'      - " ". ,  " "    .',"welcome.title":"  ","welcome.description":"    .     .       .","welcome.apiKeyLabel":" API  Google Gemini","welcome.apiKeyPlaceholder":"  API  ...","welcome.apiKeyHelp":" API     .","welcome.getKeyLink":"  API ","welcome.iAmDeveloper":" ","welcome.letsGo":"","welcome.resume":"","welcome.startNew":" ","welcome.freeModeActive":"  ","welcome.selectLanguage":"Select your primary language","welcome.navHint":"        ","toast.contentCleared":" ","toast.downloadStarted":" ","toast.characterLoaded":"  ","toast.characterSavedDisk":"    ","toast.copiedToClipboard":"   ","toast.pastedFromClipboard":"   ","toast.pasteFailed":" ","toast.nodeDuplicated":" ","toast.groupSavedToDisk":' "{groupTitle}" .  ',"toast.groupDeleted":"   ","toast.characterSavedCatalog":"   ","toast.promptSaved":"   : {promptName}...","toast.connectionsCut":" ","toast.apiKeySaved":"API   ","toast.cacheCleared":" {count}    ","toast.cacheEmpty":"  ","toast.scriptSaved":"   ","toast.modificationComplete":"  ","toast.canvasSaved":"  ","toast.projectSaved":"  ","alert.groupSaved":' "{groupTitle}" .  .',"alert.loadCatalogFailed":"    ","alert.invalidCatalogFile":"   ","alert.fileNotSupported":'  .    "appName".',"alert.invalidCatalogStructure":'  .  "root".',"tutorial.step1":" ,      .","tutorial.step2":' " ",      .',"tutorial.step2_waiting":"       ...","tutorial.step3":",     .","tutorial.step3b":"   .      .","tutorial.step4":"          .","tutorial.group.catalog":"       .","tutorial.group.general":"      .","tutorial.group.input":"   ,   .","tutorial.group.processing":"        .","tutorial.group.character":",     .","tutorial.group.output":"    .","tutorial.group.ai":"  Gemini   .","tutorial.group.video":"     .","tutorial.group.scripts":"      .","tutorial.group.file":" ,     .","tutorial.success.title":" !","tutorial.success.message":"     .    !","tutorial.success.button":" ","tutorial.skip":"","tutorial.next":"","tutorial.finish":""},qw={"toolbar.settings":"","toolbar.resetCanvas":" ","toolbar.clearCache":"  ","toolbar.home":"","toolbar.exitApp":" ","toolbar.edit":" (V)","toolbar.cutter":"  (C) / ( Ctrl)","toolbar.selection":" (S) / ( Shift)","toolbar.reroute":" (R) / ( Ctrl+Alt)","toolbar.zoom":" ( Z)","toolbar.snapToGrid":"  ","toolbar.smartGuides":" ","toolbar.lineStyleSpaghetti":' ""',"toolbar.lineStyleOrthogonal":" ","toolbar.resetZoom":" ","toolbar.resetCamera":"  ","toolbar.clearCanvas":" ","toolbar.addNode":"  (F)","toolbar.catalog":"  (Ctrl + )","toolbar.addNote":"  (N)","toolbar.addDataReader":"   (Shift + R)","toolbar.addTextInput":"   (T)","toolbar.addImageInput":"   (I)","toolbar.addPromptSequenceEditor":"   (Q)","toolbar.addImageAnalyzer":"   (Shift+A)","toolbar.addPromptAnalyzer":"   (A)","toolbar.addPromptProcessor":"   (P)","toolbar.addCharacterGenerator":"  (Shift+C)","toolbar.addCharacterAnalyzer":"  (Ctrl+Shift+A)","toolbar.addCharacterCard":"  (Ctrl+Shift+C)","toolbar.addImageOutput":"   (O)","toolbar.addImageEditor":"    (Shift+I)","toolbar.addImageSequenceGenerator":"   (Shift+Q)","toolbar.addTranslator":"  (L)","toolbar.addGeminiChat":"   Gemini (M)","toolbar.addVideoPromptProcessor":"    (Shift+P)","toolbar.addVideoOutput":"   (Shift+O)","toolbar.addScriptGenerator":"  ","toolbar.addScriptViewer":"   (Shift + V)","toolbar.saveCanvas":"  (Ctrl + S)","toolbar.saveProject":" ","toolbar.saveToDrive":"  Google ","toolbar.loadCanvas":" / (Ctrl + O)","toolbar.group.general":"","toolbar.group.catalog":"","toolbar.group.input":"","toolbar.group.processing":"","toolbar.group.character":"","toolbar.group.output":"","toolbar.group.aiTools":" ","toolbar.group.video":"","toolbar.group.scripts":"","toolbar.group.file":"","toolbar.title":" ","toolbar.dock":" ","toolbar.detach":" ","toolbar.expandPanel":" ","toolbar.collapsePanel":" ","toolbar.dockArea.title":"  ","toolbar.duplicate":" ","toolbar.duplicateWithContent":"  ","toolbar.dock.q1":" 1- .","toolbar.dock.q2":" 2- .","toolbar.dock.q3":" 3- .","toolbar.dock.q4":" 4- .","toolbar.dock.tl":" ","toolbar.dock.bl":" ","toolbar.dock.tr":" ","toolbar.dock.br":" ","toolbar.dock.left":" ","toolbar.dock.right":" ","toolbar.dock.full":" ","toolbar.dock.exitFull":"   ","toolbar.dock.fullFocus":"   ","hotkeys.show":"  ","hotkeys.tools.title":"","hotkeys.tools.edit":" ","hotkeys.tools.cutter":" ","hotkeys.tools.selection":" ","hotkeys.tools.reroute":" ","hotkeys.tools.zoom":" ","hotkeys.tools.toggleLineStyle":"  ","hotkeys.tools.group":"","hotkeys.tools.closeNode":" ","hotkeys.tools.duplicate":" ","hotkeys.tools.duplicateWithContent":"  ","hotkeys.tools.deleteGroup":"  (Shift+)","hotkeys.windows.title":"","hotkeys.windows.search":" ","hotkeys.windows.catalog":"","hotkeys.createNode.title":" ","help.panelTitle":"   ","help.subtitle":" ","help.title":" ","help.howToUse.title":" ","help.howToUse.content":"   Prompt Modifier!         .     .         .         .   -  .","help.author":"","help.tab.links":"   ","help.section.socials":" ","help.section.studioStable":"Google AI Studio ()","help.section.studioAlpha":"Google AI Studio ()","help.section.netlify":" Netlify","help.section.github":" GitHub","help.section.githubPages":"  GitHub","help.license":" GNU GPLv3","help.copyLink":" ","help.copied":"!","contextMenu.undoPosition":" ","contextMenu.redoPosition":" ","contextMenu.align.left":"   (F)","contextMenu.align.centerX":"  . (E)","contextMenu.align.right":"   (R)","contextMenu.align.top":"  (T)","contextMenu.align.centerY":"  . (D)","contextMenu.align.bottom":"  (B)","contextMenu.distribute.horizontal":".  . (Ctrl+D)","contextMenu.distribute.vertical":".  . (Ctrl+E)","contextMenu.emptySlot":"  (  )","contextMenu.saveSlots":"  ","contextMenu.loadSlots":"  ","quickadd.title":" ","quickadd.group.tools":"","quickadd.group.inputs":"","quickadd.group.processing":"","quickadd.group.character":"","quickadd.group.outputs":"","quickadd.group.ai":"","quickadd.group.video":"","quickadd.group.scripts":"","quickadd.group.general":"","quickadd.group.youtube":"","quickadd.tool.edit":"","quickadd.tool.cutter":"","quickadd.tool.selection":"","search.placeholder":"   ...","search.noResults":"  .","search.group.input":"  ","search.group.process":"  ","search.group.output":"  ","search.group.ai":" ","search.group.video":"  ","search.group.scripts":"","toolbar.enterFullScreen":"  ","toolbar.exitFullScreen":"   ","dialog.settings.hoverHighlightLabel":"   "},Ow={"node.title.text_input":" ","node.title.image_input":" ","node.title.prompt_processor":" ","node.title.prompt_sanitizer":" ","node.title.video_prompt_processor":"  ","node.title.image_output":" ","node.title.video_output":" ","node.title.prompt_analyzer":" ","node.title.character_analyzer":" ","node.title.character_generator":" ","node.title.character_card":" ","node.title.image_analyzer":" ","node.title.image_editor":"  ","node.title.image_sequence_generator":"  ","node.title.prompt_sequence_editor":"  ","node.title.gemini_chat":"  Gemini","node.title.translator":"","node.title.script_generator":" ","node.title.script_viewer":" ","node.title.note":"","node.title.reroute_dot":" ","node.title.data_reader":" ","node.title.video_editor":"   ","node.title.media_viewer":"  ","node.title.data_protection":" ","node.title.pose_creator":" ","node.help.text_input":"        .","node.help.image_input":"         .","node.help.prompt_processor":"           .","node.help.prompt_sanitizer":"  ,       ,   .","node.help.video_prompt_processor":"        .","node.help.image_output":"   .    .","node.help.video_output":"       Veo.","node.help.prompt_analyzer":"   : , ,   ..","node.help.character_analyzer":"         .","node.help.character_generator":"       .","node.help.character_card":"    ,    .","node.help.image_analyzer":"      .","node.help.image_editor":"          inpainting/outpainting.","node.help.image_sequence_generator":"      .","node.help.prompt_sequence_editor":"       -.","node.help.gemini_chat":" -  Gemini     .","node.help.translator":"   ,   .","node.help.script_generator":"   (, )   .","node.help.script_viewer":"       .","node.help.note":"       .","node.help.reroute_dot":" ,         .","node.help.data_reader":"     ,   .","node.help.video_editor":"        .","node.help.media_viewer":"         .","node.help.data_protection":"  Tower Defense.      ,   .","node.help.pose_creator":"     .","node.action.expand":"","node.action.collapse":"","node.action.help":"","node.action.download":"","node.action.clear":" ","node.action.refreshChat":"   ","node.action.paste":"","node.action.resetEditor":" ","node.action.saveCharacter":"  ","node.action.loadCharacter":"  ","node.action.copy":"","node.action.copyImage":" ","node.action.copyTextPrompt":" ","node.action.copyImagePrompt":"  ","node.action.copyVideoPrompt":"  ","node.action.cutConnections":" ","node.action.close":"","node.action.closeNode":"  (Shift+   )","node.action.closeNodeSimple":" ","node.action.randomWord":"  ","node.action.processImage":"  ","node.action.processImageTitle":" Gemini        .","node.action.editor":"","node.action.rasterEditor":" ","node.action.openInAIEditor":"   ","node.action.openInAnalyzer":"  ","node.action.outputToInput":"   ","node.action.processChainForward":" ","node.action.executeChain":" ","node.action.executeChainTitle":"       .","node.action.sanitize":"","node.action.rename":"","node.action.stop":"","node.action.stopping":"...","node.action.deleteItem":" ","node.action.detachAndPaste":"  ","node.action.delete":"","node.action.flipImage":"","node.action.pin":"  ","node.action.unpin":" ","node.action.updateDescription":"   ","node.action.updatePersonality":" ","node.action.updateAppearance":"   ","node.action.updateClothing":"   ","node.action.modifyCharacter":" ","node.action.updateDataFormat":"  ","node.action.expand169":"  16:9","node.action.expand916":"  9:16","node.action.sync":" ","node.action.expandRatio":" ","node.action.markPrimary":" ","node.action.addCard":" ","node.action.removeCard":" ","node.action.showOutputs":" ","node.action.hideOutputs":" ","node.action.showImages":" ","node.action.hideImages":" ","node.action.characterConcept":" ","node.action.objectConcept":" ","node.action.downloadTxt":" .txt","node.action.downloadDoc":" .doc","node.mediaViewer.play":"","node.mediaViewer.pause":"","node.mediaViewer.stop":"","node.mediaViewer.addMarker":" ","node.mediaViewer.exportSRT":"  (SRT)","node.mediaViewer.deleteAllMarkers":"  ","node.mediaViewer.saveMarkers":" ","node.mediaViewer.loadMarkers":" ","node.mediaViewer.relink":" ","node.content.notePlaceholder":"   ...","node.content.dropImage":"      ","node.content.dropMedia":"    ","node.content.processing":"...","node.content.processingChain":" ...","node.content.metadataPrompt":"   :","node.content.metadataPromptPlaceholder":"    .","node.content.copyPrompt":".","node.content.prompt":"","node.content.promptPlaceholder":"    ...","node.content.inputPrompt":" ","node.content.enhancedResult":" ","node.content.videoPrompt":"Video Prompt","node.content.editPromptPlaceholder":"   ...","node.content.enhancedPromptHere":"   ...","node.content.safePrompt":"   ","node.content.generating":"...","node.content.imageHere":"  ","node.content.generationMode":" ","node.content.aspectRatio":" ","node.content.aspectRatioHelp":"     ","node.content.aspectRatioNotSupportedFast":"      Imagen.","node.content.enableAspectRatioFormatting":"   ","node.content.autoDownload":"","node.content.generateImage":" ","node.content.enhancing":"...","node.content.enhancePrompt":" ","node.content.sanitizing":"...","node.content.sanitizedPromptHere":"   ...","node.content.analyzing":"...","node.content.analyzePrompt":" ","node.content.analyzeImage":" ","node.content.imageToText":"  ","node.content.updatePromptFromImage":"   ","node.content.analyzeCharacter":" ","node.content.generateCharacters":" ","node.content.characterPromptPlaceholder":" ()  ...","node.content.character":"","node.content.clothing":"","node.content.characterPlaceholder":"   ...","node.content.clothingPlaceholder":"   ...","node.content.appearance":"","node.content.appearancePlaceholder":"   ...","node.content.personality":"","node.content.personalityPlaceholder":"      ...","node.content.environment":"/","node.content.action":"","node.content.emotion":"","node.content.style":"","node.content.environmentPlaceholder":"  ...","node.content.charactersPlaceholder":"  ...","node.content.characters":"","node.content.characterConcepts":" ","node.content.actionPlaceholder":" ...","node.content.emotionPlaceholder":" ...","node.content.stylePlaceholder":"  ...","node.content.descriptionHere":"  ...","node.content.enableOutpainting":" Outpainting","node.content.outpaintingPromptPlaceholder":"  Outpainting...","node.content.inputImage":" ","node.content.dropOrClick":"  ","node.content.outputImage":" ","node.content.applyEdit":"","node.content.editing":"...","node.content.chatPlaceholder":"  ...","node.content.connectedPlaceholder":"  ,   .","node.content.connectedNode":"  ","node.content.connectedEmpty":"    .","node.content.translatePlaceholder":"  ...","node.content.translatedTextPlaceholder":" ...","node.content.targetLanguage":" ","node.content.translate":"","node.content.translating":"...","node.content.scriptPromptPlaceholder":"    ...","node.content.generateScript":" ","node.content.loadScript":"  ","node.content.summary":" ","node.content.scenes":"","node.content.unrecognizedFormat":"  .","node.content.frames":"","node.content.characterIndex":"","node.content.readData":" ","node.content.textDataHere":"   .","node.content.noDataRead":'    " ",   .',"node.content.previewError":" ","node.content.previewPlaceholder":"  ","node.content.imagePrompt":" ","node.output.allPromptData":"  ","node.note.tab.note":"","node.note.tab.references":"","node.note.nestedImages":" ","node.note.dropPlaceholder":"     ","node.note.addCaption":"","node.note.action.shuffle":"","node.note.action.undoShuffle":" ","node.content.characterTypeShort":":","node.content.numberOfCharactersShort":"-:","node.content.characterType.simple":"","node.content.characterType.anthro":"","node.content.characterType.chibi":"","node.content.characterType.key_item":" ","node.content.style.simple":"","node.content.style.realistic":"","node.content.style.3d_cartoon":"3D ","node.content.style.3d_realistic":"3D ","node.content.style.2d_animation":"2D ","node.content.style.anime":"","node.content.style.comics":"","node.content.style.custom":" ","node.content.fullDescriptionTitle":"  ","node.content.integrationInstruction":" ","node.content.additionalPromptSuffix":".  ()","node.content.insertSceneContext":"  ","node.content.modificationRequest":"  ","search.node.text_input.title":" ","search.node.text_input.description":"   .","search.node.image_input.title":" ","search.node.image_input.description":"   .","search.node.prompt_sequence_editor.title":"  ","search.node.prompt_sequence_editor.description":"      ,   .","search.node.data_reader.title":" ","search.node.data_reader.description":"     (  )       .","search.node.note.title":"","search.node.note.description":"  .","search.node.prompt_processor.title":" ","search.node.prompt_processor.description":"     .","search.node.prompt_analyzer.title":" ","search.node.prompt_analyzer.description":"   .","search.node.prompt_sanitizer.title":" ","search.node.prompt_sanitizer.description":" ,       .","search.node.character_card.title":" ","search.node.character_card.description":"    .","search.node.character_analyzer.title":" ","search.node.character_analyzer.description":"     .","search.node.character_generator.title":" ","search.node.character_generator.description":"       .","search.node.image_analyzer.title":" ","search.node.image_analyzer.description":"    .","search.node.image_editor.title":"  ","search.node.image_editor.description":"    con .","search.node.image_sequence_generator.title":"  ","search.node.image_sequence_generator.description":"      .","search.node.gemini_chat.title":"  Gemini","search.node.gemini_chat.description":"    con Gemini,       .","search.node.translator.title":"","search.node.translator.description":"         .","search.node.script_generator.title":" ","search.node.script_generator.description":"   (, )   .","search.node.script_viewer.title":" ","search.node.script_viewer.description":"       .","search.node.note":"        .","search.node.reroute_dot":" ,         .","search.node.video_prompt_processor.title":"  ","search.node.video_prompt_processor.description":"     .","search.node.video_output.title":" ","search.node.video_output.description":"     Veo.","search.node.image_output.title":" ","search.node.image_output.description":"     .","search.node.media_viewer.title":"  ","search.node.media_viewer.description":"         .","search.node.data_protection.title":" ","search.node.data_protection.description":"- Tower Defense.     ,     .","search.node.pose_creator.title":" ","search.node.pose_creator.description":"     .","prompt_sequence_editor.instructionPlaceholder":"    ...","prompt_sequence_editor.modifying":"...","prompt_sequence_editor.modifySelected":"  ({count})","prompt_sequence_editor.sourcePrompts":" ","prompt_sequence_editor.finalPrompts":" ","prompt_sequence_editor.error.invalidInput":"  . ,    .","geminiChat.mode.general":"","geminiChat.mode.prompt":"  ","geminiChat.mode.script":"","geminiChat.mode.youtube":" ","image_sequence.deselect_scene":"Deselect all frames in this scene","image_sequence.clear_prompts_only":"   ","image_sequence.prev_scene":" ","image_sequence.next_scene":" ","image_sequence.frames_hidden":"({count}  )","image_sequence.frames_count":"({count} )","image_sequence.auto_crop":"- 16:9","image_sequence.create_zip":" Zip ","node.content.technicalPrompt":" ","node.promptProcessor.safePromptTooltip":"         .","node.promptProcessor.technicalPromptTooltip":"      (, ,  ).","node.promptProcessor.enhanceTooltip":"        .","node.promptProcessor.chainTooltip":"        .","image_sequence.tooltip.autoCrop":"       16:9.","image_sequence.tooltip.autoDownload":"        .","image_sequence.tooltip.createZip":"      ZIP-  ."},Fw={"imageEditor.title":" ","imageEditor.canvasResolution":" ","imageEditor.background":"","imageEditor.toolSettings":" ","imageEditor.snapToEdges":"  ","imageEditor.freeAspect":" ","imageEditor.section.aiRequest":"  ","imageEditor.input.modificationPlaceholder":" , :      ...","imageEditor.action.sendRequest":" ","imageEditor.tooltip.removeObject":" () /  ()","imageEditor.action.removeObject":" ","imageEditor.action.removeBackground":" ","imageEditor.tool.transform":"","imageEditor.tool.hand":" ()","imageEditor.tool.zoom":"","imageEditor.tool.pencil":"","imageEditor.tool.rectangle":"","imageEditor.action.fit":"  ","imageEditor.action.fill":" ","imageEditor.action.cancel":"","imageEditor.action.resetEdits":" ","imageEditor.action.apply":"","imageViewer.title":" ","imageEditor.outputResolution":" ","imageEditor.outputResolutionHelp":'    .  "Auto",   .',"imageEditor.currentSize":" : {width}x{height}","imageEditor.sequenceMode":" ","imageEditor.sequenceModeHelp":"     .","imageEditor.sequentialCombination":"  ","imageEditor.sequentialCombinationHelp":"  :     +    .","imageEditor.sequentialPrompt":"  ","imageEditor.sequentialPromptHelp":"  :      +  .","imageEditor.sequentialEditingWithPrompts":"   ","imageEditor.sequentialEditingWithPromptsHelp":"  :     +  .   .","imageEditor.input":"","imageEditor.inputA":" A","imageEditor.inputB":" B","imageEditor.status.queued":" ","imageEditor.status.generating":"...","imageEditor.action.regenerate":"","imageEditor.tooltip.fit":"     (contain).","imageEditor.tooltip.fill":"     (cover).","imageEditor.tooltip.flip":"   .","imageEditor.background.white":"","imageEditor.background.gray":"","imageEditor.background.black":"","imageEditor.background.dark":"","image_sequence.regenerate":"","image_sequence.stop_queue":" ","image_sequence.move_up":"","image_sequence.move_down":"","image_sequence.copy_prompt":" ","image_sequence.add_frame":" ","image_sequence.delete_frame":" ","image_sequence.expand_all_frames":"/  ","image_sequence.collapse_all_frames":"  ","image_sequence.expand_all_scenes":"/  ","image_sequence.collapse_all_scenes":"  ","image_sequence.expand_all":" ","image_sequence.collapse_all":" ","image_sequence.clear_all_prompts":"  ","image_sequence.add_first_frame":"  ","image_sequence.drop_or_add_title":" JSON    ","image_sequence.drop_or_add_desc":" JSON  ,       .","image_sequence.load_prompts":" ","image_sequence.output_images_title":" ","image_sequence.prompts_list_title":" ","image_sequence.download_selected":" ","image_sequence.select_all":" ","image_sequence.select_none":" ","image_sequence.invert_selection":"","image_sequence.run_selected":" ","image_sequence.start_queue":" ","image_sequence.character_prompt_combination":"  ","image_sequence.combination_none":"","image_sequence.combination_combine":"","image_sequence.combination_replace":" ","image_sequence.status.error":"","image_sequence.status.pending":" ","image_sequence.clear_selected_prompts":"  ","image_sequence.range_from":":","image_sequence.range_to":":","image_sequence.stats.total":" : {count}","image_sequence.stats.generated":": {count}","image_sequence.stats.queue":" : {count}","image_sequence.edit_in_source":"  ","image_sequence.edit_prompt":" ","image_sequence.select_scene":" ","image_sequence.next_scene":" ","image_sequence.prev_scene":" ","image_sequence.scene_input_label":"","image_sequence.select_square":"  (1:1)","image_sequence.select_landscape":"  (16:9)","image_sequence.select_portrait":"  (9:16)","image_sequence.select_range":" ","image_sequence.force_refresh":" ","image_sequence.select_scene_frames":"   ","image_sequence.collapse_other_scenes":"  ","prompt_sequence_editor.instructionPlaceholder":"    ...","prompt_sequence_editor.modifying":"...","prompt_sequence_editor.modifySelected":"  ({count})","prompt_sequence_editor.sourcePrompts":" ","prompt_sequence_editor.finalPrompts":" ","prompt_sequence_editor.error.invalidInput":"  . ,    .","geminiChat.mode.general":"","geminiChat.mode.prompt":"  ","geminiChat.mode.script":"","geminiChat.mode.youtube":" ","geminiChat.mode.developer":"","image_sequence.shot_type.WS":"     (WS)    .  .","image_sequence.shot_type.MS":"     (MS)  .   .","image_sequence.shot_type.CU":"     (CU)  .","image_sequence.shot_type.ECU":"      (ECU)  .  .","image_sequence.shot_type.LS":"     (LS)  ,   ."},Bw={"dialog.permission.title":" ","dialog.permission.description":"        ,     .        .","dialog.permission.allow":"","dialog.permission.decline":"","dialog.rename.title":" ","dialog.rename.group.title":" ","dialog.rename.catalog.title":"  ","dialog.rename.node.title":" ","dialog.rename.label":" :","dialog.rename.confirm":"","dialog.rename.cancel":"","dialog.promptEdit.title":" ","dialog.promptEdit.nameLabel":":","dialog.promptEdit.contentLabel":":","dialog.promptEdit.confirm":"","dialog.promptEdit.cancel":"","dialog.confirmDelete.title":" ","dialog.confirmDelete.message":" ,     ?    .","dialog.confirmDelete.confirm":"","dialog.confirmDelete.cancel":"","dialog.confirmCloseTab.title":" ","dialog.confirmCloseTab.message":' ,     "{tabName}"?    .',"dialog.confirmClear.title":" ","dialog.confirmClear.message":" ,     ?    .","dialog.confirmReset.title":"  ","dialog.confirmReset.message":" ,        ?     .","dialog.confirmReset.confirm":"","dialog.confirmLoad.title":" ","dialog.confirmLoad.message":"     .     . ?","dialog.apiKey.title":" API-","dialog.apiKey.description":'    API-    API "AI Platform".      .',"dialog.apiKey.billingLink":"   ","dialog.apiKey.button":" API-","dialog.settings.title":"","dialog.settings.apiKeyLabel":"API  Google Gemini","settings.googleClientIdLabel":"Client ID","settings.googleDriveTitle":"  Google Drive","settings.signInWithGoogle":"  Google","dialog.settings.useDevKeyLabel":"  ( )","dialog.settings.instantNodeCloseLabel":"  ","dialog.settings.nodeAnimationLabel":"   ","dialog.settings.animationModeLabel":"  ","dialog.settings.anim.pulse":"","dialog.settings.anim.bladeRunner":"  ","dialog.settings.anim.none":"","dialog.settings.description":"    API    .","dialog.settings.getKeyLink":" API  ","dialog.settings.save":"","dialog.settings.reload":"","dialog.deleteNode.title":" ?","dialog.deleteNode.titlePlural":" ?","dialog.deleteNode.confirm":"","dialog.deleteNode.cancel":"","dialog.deleteNode.confirmTooltip":"  -     ","dialog.deleteNode.cancelTooltip":"  -    ","dialog.deleteNode.dontShowAgain":"  ","dialog.exitApp.title":" ?","dialog.exitApp.message":" ,    ?     ,   .","toast.driveSaved":"    Google ","toast.driveSaveFailed":"   Google ","error.googleDriveInit":"Google Drive Client ID  . ,    .","settings.group.api":"API  ","settings.group.style":"   ","settings.group.drive":" ","settings.themeLabel":" ","dialog.reload.title":" ?","dialog.reload.message":"       .     .","dialog.settings.connectionsLabel":" ","dialog.settings.connectionAnimationLabel":"  ","dialog.settings.connectionOpacityLabel":" "},Hw={"group.button.create":"  ({count})","group.rename":" ","group.saveToCatalog":"  ","group.saveToDisk":"  ","group.ungroup":" (shift +    )","group.duplicate":"   ","catalog.tabs.groups":"","catalog.tabs.library":"","catalog.tabs.characters":"","catalog.tabs.scripts":"","catalog.tabs.sequences":"","catalog.back":"","catalog.load":"  ","catalog.newFolder":" ","catalog.saveTo":"  ","catalog.card.addToCanvas":"  ","catalog.card.rename":"","catalog.card.save":"","catalog.card.delete":"","catalog.empty.description":"  .        .","library.loadFromFile":"","library.actions.newFolder":" ","library.actions.newPrompt":" ","library.actions.copy":"","library.actions.edit":"","library.empty.title":" ","library.empty.description":"   ,  .","library.emptyPrompt":" "},Gw={...zw,...qw,...Ow,...Fw,...Bw,...Hw},Uw={"app.title":"Modificador de Prompt","app.subtitle":"Conecta ideas para crear una obra maestra","app.error.title":"Notificacin","app.error.copy":"Copiar Mensaje","app.error.copied":"Copiado!","error.apiKey":"Tu clave API es invlida o le faltan permisos. Por favor selecciona una clave API vlida.","error.scriptModifierCanvas":"Este lienzo pertenece a otra aplicacin: Modificador de Guiones. Por favor usa esa aplicacin para abrir este archivo.","welcome.title":"Bienvenido a","welcome.description":"Bienvenido a Prompt Modifier. Conecta ideas para crear obras maestras. Usa nodos para generar y editar contenido.","welcome.apiKeyLabel":"Tu Clave API de Google Gemini","welcome.apiKeyPlaceholder":"Ingresa tu clave API aqu...","welcome.apiKeyHelp":"Tu clave API se almacena localmente.","welcome.getKeyLink":"Obtener Clave API","welcome.iAmDeveloper":"Soy Desarrollador","welcome.letsGo":"Vamos!","welcome.resume":"Continuar","welcome.startNew":"Nueva Tela","welcome.freeModeActive":"Modo Gratuito Activo","welcome.selectLanguage":"Selecciona tu idioma principal","welcome.navHint":"Usa las teclas del teclado  y  para cambiar el idioma","toast.contentCleared":"Contenido borrado","toast.downloadStarted":"Descarga iniciada","toast.characterLoaded":"Tarjeta de personaje cargada","toast.characterSavedDisk":"Tarjeta de personaje guardada en disco","toast.copiedToClipboard":"Copiado al portapapeles","toast.pastedFromClipboard":"Pegado desde el portapapeles","toast.pasteFailed":"Fallo al pegar","toast.nodeDuplicated":"Nodo duplicado","toast.groupSavedToDisk":'Grupo "{groupTitle}" guardado en disco',"toast.groupDeleted":"Grupo y contenido eliminados","toast.characterSavedCatalog":"Personaje guardado en catlogo","toast.promptSaved":"Prompt guardado en biblioteca: {promptName}...","toast.connectionsCut":"Conexiones eliminadas","toast.apiKeySaved":"Clave API guardada exitosamente","toast.cacheCleared":"Se limpiaron {count} elementos no usados de la cach","toast.cacheEmpty":"La cach ya est optimizada","toast.scriptSaved":"Guion guardado en disco","alert.groupSaved":'Grupo "{groupTitle}" guardado en catlogo.',"alert.loadCatalogFailed":"Fallo al cargar archivo de catlogo","alert.invalidCatalogFile":"Formato de archivo de catlogo invlido","alert.fileNotSupported":'Archivo no soportado. Falta o es incorrecto "appName".',"alert.invalidCatalogStructure":'Estructura de catlogo invlida. Falta "root".'},Vw={"toolbar.settings":"Ajustes","toolbar.resetCanvas":"Restablecer Lienzo","toolbar.clearCache":"Borrar Cach No Usada","toolbar.home":"Inicio","toolbar.edit":"Editar (V)","toolbar.cutter":"Cortar Conexin (C) / (Mantener Ctrl)","toolbar.selection":"Seleccin (S) / (Mantener Shift)","toolbar.reroute":"Redirigir (R) / (Mantener Ctrl+Alt)","toolbar.zoom":"Zoom (Mantener Z)","toolbar.snapToGrid":"Ajustar a la Cuadrcula","toolbar.smartGuides":"Guas Inteligentes","toolbar.lineStyleSpaghetti":"Lneas Espagueti","toolbar.lineStyleOrthogonal":"Lneas Ortogonales","toolbar.resetZoom":"Restablecer Zoom","toolbar.resetCamera":"Restablecer Cmara","toolbar.clearCanvas":"Limpiar Lienzo","toolbar.addNode":"Aadir Nodo (F)","toolbar.catalog":"Abrir Catlogo (Ctrl + Espacio)","toolbar.addNote":"Aadir Nota (N)","toolbar.addDataReader":"Aadir Lector de Datos (Shift + R)","toolbar.addTextInput":"Aadir Entrada de Texto (T)","toolbar.addImageInput":"Aadir Entrada de Imagen (I)","toolbar.addPromptSequenceEditor":"Aadir Editor de Secuencia de Prompts (Q)","toolbar.addImageAnalyzer":"Aadir Analizador de Imagen (Shift+A)","toolbar.addPromptAnalyzer":"Aadir Analizador de Prompt (A)","toolbar.addPromptProcessor":"Aadir Procesador de Prompt (P)","toolbar.addCharacterGenerator":"Aadir Generador de Personajes (Shift+C)","toolbar.addCharacterAnalyzer":"Aadir Analizador de Personajes (Ctrl+Shift+A)","toolbar.addCharacterCard":"Aadir Tarjeta de Personaje (Ctrl+Shift+C)","toolbar.addImageOutput":"Aadir Salida de Imagen (O)","toolbar.addImageEditor":"Aadir Editor de Imagen IA (Shift+I)","toolbar.addImageSequenceGenerator":"Aadir Generador de Secuencia de Imgenes (Shift+Q)","toolbar.addTranslator":"Aadir Traductor (L)","toolbar.addGeminiChat":"Aadir Chat Gemini (M)","toolbar.addVideoPromptProcessor":"Aadir Procesador de Prompt de Video (Shift+P)","toolbar.addVideoOutput":"Aadir Salida de Video (Shift+O)","toolbar.addScriptGenerator":"Aadir Generador de Guiones","toolbar.addScriptViewer":"Aadir Visor de Guiones (Shift + V)","toolbar.saveCanvas":"Guardar Lienzo (Ctrl + S)","toolbar.saveProject":"Guardar Proyecto","toolbar.loadCanvas":"Cargar Proyecto/Lienzo (Ctrl + O)","toolbar.group.general":"General","toolbar.group.catalog":"Catlogo","toolbar.group.input":"Entrada","toolbar.group.processing":"Procesamiento","toolbar.group.character":"Personaje","toolbar.group.output":"Salida","toolbar.group.aiTools":"Herramientas IA","toolbar.group.video":"Video","toolbar.group.scripts":"Guiones","toolbar.group.file":"Archivo","toolbar.title":"Barra de Herramientas","toolbar.dock":"Acoplar Barra","toolbar.detach":"Desacoplar Barra","toolbar.expandPanel":"Expandir Panel","toolbar.collapsePanel":"Colapsar Panel","toolbar.dockArea.title":"Acoplar Barra Aqu","toolbar.duplicate":"Duplicar Nodo","toolbar.duplicateWithContent":"Duplicar con Contenido","toolbar.dock.q1":"Izq. 1er Cto","toolbar.dock.q2":"Izq. 2do Cto","toolbar.dock.q3":"Der. 3er Cto","toolbar.dock.q4":"Der. 4to Cto","toolbar.dock.tl":"Arriba Izq.","toolbar.dock.bl":"Abajo Izq.","toolbar.dock.tr":"Arriba Der.","toolbar.dock.br":"Abajo Der.","toolbar.dock.left":"Mitad Izq.","toolbar.dock.right":"Mitad Der.","toolbar.dock.full":"Pantalla Completa","toolbar.dock.exitFull":"Salir Pantalla Completa","toolbar.dock.fullFocus":"Enfoque Pantalla Completa","hotkeys.show":"Mostrar Atajos","hotkeys.tools.title":"Herramientas","hotkeys.tools.edit":"Modo Edicin","hotkeys.tools.cutter":"Herramienta de Corte","hotkeys.tools.selection":"Herramienta de Seleccin","hotkeys.tools.reroute":"Herramienta de Redireccin","hotkeys.tools.zoom":"Herramienta de Zoom","hotkeys.tools.toggleLineStyle":"Cambiar Estilo de Lnea","hotkeys.tools.group":"Seleccin de Grupo","hotkeys.tools.closeNode":"Eliminar Seleccionado","hotkeys.tools.duplicate":"Duplicar Nodo","hotkeys.tools.duplicateWithContent":"Duplicar con Contenido","hotkeys.tools.deleteGroup":"Eliminar Grupo (Shift+Clic)","hotkeys.windows.title":"Ventanas","hotkeys.windows.search":"Bsqueda Rpida","hotkeys.windows.catalog":"Catlogo","hotkeys.createNode.title":"Crear Nodo","help.panelTitle":"Ayuda y Atajos","help.subtitle":"Centro de Ayuda","help.title":"Atajos de Teclado","help.howToUse.title":"Cmo Usar","help.howToUse.content":"Bienvenido a Prompt Modifier! Usa la barra de herramientas o atajos para aadir nodos. Conecta nodos para pasar datos. Usa la herramienta Editar para mover nodos y el lienzo. Haz doble clic en el espacio vaco para abrir el men de adicin rpida. Clic derecho para el men contextual.","help.author":"Autor","help.tab.links":"Otras Apps y Enlaces","help.section.socials":"Redes Sociales","help.section.studioStable":"Google AI Studio (Estable)","help.section.studioAlpha":"Google AI Studio (Alpha)","help.section.netlify":"Apps Netlify","help.section.github":"Repositorios GitHub","help.license":"Licencia GNU GPLv3","help.copyLink":"Copiar Enlace","help.copied":"Copiado!","contextMenu.undoPosition":"Deshacer Posicin","contextMenu.redoPosition":"Rehacer Posicin","contextMenu.align.left":"Alinear Izquierda (F)","contextMenu.align.centerX":"Alinear Centro X (E)","contextMenu.align.right":"Alinear Derecha (R)","contextMenu.align.top":"Alinear Arriba (T)","contextMenu.align.centerY":"Alinear Centro Y (D)","contextMenu.align.bottom":"Alinear Abajo (B)","contextMenu.distribute.horizontal":"Distribuir Horiz. (Ctrl+D)","contextMenu.distribute.vertical":"Distribuir Vert. (Ctrl+E)","contextMenu.emptySlot":"Ranura Vaca (Click Der. para asignar)","contextMenu.saveSlots":"Guardar Config. Ranuras","contextMenu.loadSlots":"Cargar Config. Ranuras","quickadd.title":"Aadir Rpido","quickadd.group.tools":"Herramientas","quickadd.group.inputs":"Entradas","quickadd.group.processing":"Procesamiento","quickadd.group.character":"Personaje","quickadd.group.outputs":"Salidas","quickadd.group.ai":"Herramientas IA","quickadd.group.video":"Video","quickadd.group.scripts":"Guiones","quickadd.group.general":"General","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"Editar","quickadd.tool.cutter":"Cortar","quickadd.tool.selection":"Seleccin","search.placeholder":"Buscar un nodo para aadir...","search.noResults":"No se encontraron nodos.","search.group.input":"Entrada y Bsico","search.group.process":"Procesamiento y Personaje","search.group.output":"Imagen y Secuencia","search.group.ai":"Herramientas IA","search.group.video":"Video y Guion","search.group.scripts":"Guiones","toolbar.exitApp":"Cerrar Proyecto","toolbar.enterFullScreen":"Pantalla Completa","toolbar.exitFullScreen":"Salir Pantalla Completa"},Ww={"node.title.text_input":"Entrada de Texto","node.title.image_input":"Entrada de Imagen","node.title.prompt_processor":"Procesador de Prompt","node.title.prompt_sanitizer":"Sanitizador de Prompt","node.title.video_prompt_processor":"Proc. de Prompt de Video","node.title.image_output":"Salida de Imagen","node.title.video_output":"Salida de Video","node.title.prompt_analyzer":"Analizador de Prompt","node.title.character_analyzer":"Analizador de Personaje","node.title.character_generator":"Generador de Personajes","node.title.character_card":"Tarjeta de Personaje","node.title.image_analyzer":"Analizador de Imagen","node.title.image_editor":"Editor de Imagen IA","node.title.image_sequence_generator":"Generador de Secuencia de Imgenes","node.title.prompt_sequence_editor":"Editor de Secuencia de Prompts","node.title.gemini_chat":"Chat Gemini","node.title.translator":"Traductor","node.title.script_generator":"Generador de Guiones","node.title.script_viewer":"Visor de Guiones","node.title.note":"Nota","node.title.reroute_dot":"Punto de Redireccin","node.title.data_reader":"Lector de Datos","node.title.video_editor":"Editor de Video Versin Alfa","node.title.media_viewer":"Visor Multimedia","node.title.data_protection":"Proteccin de Datos","node.title.pose_creator":"Pose Creator","node.help.text_input":"Un campo de texto multilnea simple para ingresar prompts o notas.","node.help.image_input":"Permite subir o pegar una imagen para usarla como entrada en otros nodos.","node.help.prompt_processor":"Combina mltiples entradas de texto en un solo prompt mejorado usando IA.","node.help.prompt_sanitizer":"Reescribe el prompt de entrada para que sea ms seguro para las polticas de generacin de imgenes.","node.help.video_prompt_processor":"Procesador especializado para crear prompts detallados de generacin de video.","node.help.image_output":"Muestra el resultado de la generacin de imagen. Permite descargar y ver.","node.help.video_output":"Muestra el resultado de la generacin de video usando el modelo Veo.","node.help.prompt_analyzer":"Deconstruye un prompt en componentes como sujeto, estilo y entorno.","node.help.character_analyzer":"Analiza una descripcin de personaje y la divide en apariencia y ropa.","node.help.character_generator":"Genera descripciones detalladas de personajes basadas en un prompt corto.","node.help.character_card":"Almacena datos completos del personaje, incluyendo imagen y descripcin.","node.help.image_analyzer":"Usa IA para describir el contenido de una imagen de entrada.","node.help.image_editor":"Herramienta avanzada para editar imgenes usando prompts de texto e inpainting/outpainting.","node.help.image_sequence_generator":"Genera una secuencia de imgenes basada en una lista de prompts.","node.help.prompt_sequence_editor":"Permite la edicin masiva de secuencias de prompts usando instrucciones de IA.","node.help.gemini_chat":"Una interfaz de chat de propsito general con Gemini para lluvia de ideas o asistencia.","node.help.translator":"Traduce texto entre idiomas usando modelos de IA.","node.help.script_generator":"Genera un guion estructurado (escenas, personajes) a partir de una idea de historia.","node.help.script_viewer":"Visualiza y gestiona datos de guiones para la generacin cuadro por cuadro.","node.help.note":"Una nota adhesiva para agregar comentarios o instrucciones al lienzo.","node.help.reroute_dot":"Un punto pequeo usado para organizar conexiones y crear diseos ms limpios.","node.help.data_reader":"Herramienta de depuracin para inspeccionar los datos brutos que fluyen a travs de las conexiones.","node.help.video_editor":"Una herramienta basada en lnea de tiempo para editar clips de video e imgenes.","node.help.media_viewer":"Un reproductor para ver archivos de video y audio con controles de reproduccin.","node.help.data_protection":"Un nodo de mini-juego interactivo de Defensa de Torres. Defiende tus datos.","node.help.pose_creator":"Visual rig to define and generate character poses for consistency.","node.action.expand":"Expandir","node.action.collapse":"Colapsar","node.action.help":"Ayuda","node.action.download":"Descargar","node.action.clear":"Borrar Contenido","node.action.refreshChat":"Borrar y Reiniciar Chat","node.action.paste":"Pegar","node.action.resetEditor":"Restablecer Editor","node.action.saveCharacter":"Guardar Tarjeta","node.action.loadCharacter":"Cargar Tarjeta","node.action.copy":"Copiar","node.action.copyImage":"Copiar Imagen","node.action.copyTextPrompt":"Copiar Prompt","node.action.copyImagePrompt":"Copiar Prompt de Imagen","node.action.copyVideoPrompt":"Copiar Prompt de Video","node.action.cutConnections":"Cortar Conexiones","node.action.close":"Cerrar","node.action.closeNode":"Cerrar Nodo (Shift+Clic para cierre instantneo)","node.action.closeNodeSimple":"Cerrar Nodo","node.action.randomWord":"Aadir Palabra Aleatoria","node.action.processImage":"Eliminar Marcas de Agua","node.action.processImageTitle":"Usa Gemini para eliminar marcas de agua y texto de la imagen.","node.action.editor":"Editor","node.action.rasterEditor":"Editor Raster","node.action.openInAIEditor":"Abrir en Editor IA","node.action.openInAnalyzer":"Abrir en Analizador","node.action.outputToInput":"Usar Salida como Entrada","node.action.processChainForward":"Procesar Hacia Adelante","node.action.executeChain":"Ejecutar Cadena","node.action.executeChainTitle":"Ejecutar todos los nodos anteriores para generar el resultado final.","node.action.sanitize":"Sanitizar","node.action.rename":"Renombrar","node.action.stop":"Parar","node.action.stopping":"Parando...","node.action.deleteItem":"Eliminar Elemento","node.action.detachAndPaste":"Despegar y Pegar","node.action.delete":"Eliminar","node.action.flipImage":"Voltear Imagen","node.action.pin":"Fijar Nodo Arriba","node.action.unpin":"Desfijar Nodo","node.action.updateDescription":"Actualizar descripcin desde prompt","node.action.modifyCharacter":"Solicitar Cambios","node.action.updateDataFormat":"Actualizar formato de datos","node.action.expand169":"Expandir a 16:9","node.action.expand916":"Expandir a 9:16","node.action.sync":"Sincronizar desde conexiones","node.action.expandRatio":"Extender Relacin de Aspecto","node.action.markPrimary":"Marcar como Principal","node.action.addCard":"Aadir Tarjeta","node.action.removeCard":"Eliminar Tarjeta","node.action.showOutputs":"Mostrar Salidas","node.action.hideOutputs":"Ocultar Salidas","node.action.characterConcept":"Concepto de Personaje","node.action.objectConcept":"Concepto de Objeto","node.action.downloadTxt":"Descargar .txt","node.action.downloadDoc":"Descargar .doc","node.mediaViewer.play":"Reproducir","node.mediaViewer.pause":"Pausa","node.mediaViewer.stop":"Parar","node.mediaViewer.addMarker":"Aadir Marcador","node.mediaViewer.exportSRT":"Exportar Marcadores (SRT)","node.mediaViewer.deleteAllMarkers":"Eliminar Todos los Marcadores","node.mediaViewer.saveMarkers":"Guardar Marcadores en Disco","node.mediaViewer.loadMarkers":"Cargar Marcadores desde Disco","node.mediaViewer.relink":"Revincular Archivo","node.content.notePlaceholder":"Escribe tus notas aqu...","node.content.dropImage":"Suelta imagen aqu o clic para subir","node.content.dropMedia":"Suelta video o audio aqu","node.content.processing":"Procesando...","node.content.processingChain":"Procesando Cadena...","node.content.metadataPrompt":"Prompt de Metadatos:","node.content.metadataPromptPlaceholder":"No se encontr prompt en la imagen.","node.content.copyPrompt":"Usar","node.content.prompt":"Prompt","node.content.inputPrompt":"Prompt de Entrada","node.content.enhancedResult":"Resultado Mejorado","node.content.videoPrompt":"Prompt de Video","node.content.editPromptPlaceholder":"Aade o edita el prompt...","node.content.enhancedPromptHere":"El prompt mejorado aparecer aqu...","node.content.safePrompt":"Seguro para uso comercial","node.content.generating":"Generando...","node.content.imageHere":"La imagen aparecer aqu","node.content.generationMode":"Modelo de Generacin","node.content.aspectRatio":"Relacin de Aspecto","node.content.aspectRatioHelp":"Establecer relacin de aspecto para generacin de imagen","node.content.aspectRatioNotSupportedFast":"Relacin de aspecto solo disponible para modelos Imagen.","node.content.enableAspectRatioFormatting":"Habilitar Formato de Relacin de Aspecto","node.content.autoDownload":"Auto Descarga","node.content.generateImage":"Generar Imagen","node.content.enhancing":"Mejorando...","node.content.enhancePrompt":"Mejorar Prompt","node.content.sanitizing":"Sanitizando...","node.content.sanitizedPromptHere":"El prompt sanitizado aparecer aqu...","node.content.analyzing":"Analizando...","node.content.analyzePrompt":"Analizar Prompt","node.content.analyzeImage":"Analizar Imagen","node.content.imageToText":"Imagen a Texto","node.content.updatePromptFromImage":"Actualizar prompt desde imagen","node.content.analyzeCharacter":"Analizar Personaje","node.content.generateCharacters":"Generar Personajes","node.content.characterPromptPlaceholder":"Describe personaje(s) para generar...","node.content.character":"Personaje","node.content.clothing":"Ropa","node.content.characterPlaceholder":"La descripcin del personaje aparecer aqu...","node.content.clothingPlaceholder":"La descripcin de la ropa aparecer aqu...","node.content.appearance":"Apariencia","node.content.personality":"Personalidad","node.content.environment":"Entorno/Escenario","node.content.action":"Accin","node.content.emotion":"Emocin","node.content.style":"Estilo","node.content.environmentPlaceholder":"Descripcin detallada del entorno...","node.content.charactersPlaceholder":"Lista de personajes principales...","node.content.characters":"Personajes","node.content.characterConcepts":"Conceptos de Personaje","node.content.actionPlaceholder":"Descripcin de la accin...","node.content.emotionPlaceholder":"Descripcin de la emocin...","node.content.stylePlaceholder":"Descripcin del estilo artstico...","node.content.descriptionHere":"La descripcin aparecer aqu...","node.content.enableOutpainting":"Habilitar Outpainting","node.content.outpaintingPromptPlaceholder":"Prompt de Outpainting...","node.content.inputImage":"Imgenes de Entrada","node.content.dropOrClick":"Soltar o Clic","node.content.outputImage":"Imagen de Salida","node.content.applyEdit":"Aplicar Edicin","node.content.editing":"Editando...","node.content.chatPlaceholder":"Escribe tu mensaje...","node.content.connectedPlaceholder":"Conectado a nodo, editar en fuente.","node.content.connectedNode":"Conectado via nodo","node.content.connectedEmpty":"El nodo conectado no tiene imagen.","node.content.translatePlaceholder":"Texto a traducir...","node.content.translatedTextPlaceholder":"Texto traducido...","node.content.targetLanguage":"Idioma de Destino","node.content.translate":"Traducir","node.content.translating":"Traduciendo...","node.content.scriptPromptPlaceholder":"Introduce una idea de historia o trama...","node.content.generateScript":"Generar Guion","node.content.loadScript":"Cargar Archivo de Guion","node.content.summary":"Resumen","node.content.scenes":"Escenas","node.content.unrecognizedFormat":"Formato de guion no reconocido.","node.content.frames":"Cuadros","node.content.characterIndex":"ndice","node.content.readData":"Leer Datos","node.content.textDataHere":"Los datos de texto aparecern aqu.","node.content.noDataRead":'Conecta un nodo y haz clic en "Leer Datos" para ver su contenido.',"node.content.previewError":"Error de Previsualizacin","node.content.previewPlaceholder":"La previsualizacin aparecer aqu","node.content.imagePrompt":"Prompt de Imagen","node.output.allPromptData":"Todos los Datos del Prompt","node.note.tab.note":"Nota","node.note.tab.references":"Referencias","node.note.nestedImages":"Imgenes Anidadas","node.note.dropPlaceholder":"Suelta imgenes o clic para aadir","node.note.addCaption":"Leyenda","node.note.action.shuffle":"Mezclar","node.note.action.undoShuffle":"Deshacer Mezcla","node.content.characterTypeShort":"Tipo:","node.content.numberOfCharactersShort":"Cant:","node.content.characterType.simple":"Simple","node.content.characterType.anthro":"Anthro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Objeto Clave","node.content.style.simple":"Simple","node.content.style.realistic":"Realista","node.content.style.3d_cartoon":"3D Cartoon","node.content.style.3d_realistic":"3D Realista","node.content.style.2d_animation":"Animacin 2D","node.content.style.anime":"Anime","node.content.style.comics":"Comics","node.content.style.custom":"Personalizado","node.content.fullDescriptionTitle":"Descripcin completa del personaje","node.content.integrationInstruction":"Instruccin de integracin","node.content.additionalPromptSuffix":"Prompt Adicional (Sufijo)","image_sequence.auto_crop":"Recorte Auto 16:9","image_sequence.create_zip":"Crear Archivo ZIP","node.content.modificationRequest":"Solicitud de modificacin","node.content.technicalPrompt":"Prompt Tcnico","node.promptProcessor.safePromptTooltip":"Reescribe el prompt para cumplir con las pautas de seguridad y evitar infracciones de polticas.","node.promptProcessor.technicalPromptTooltip":"Convierte el prompt en una especificacin tcnica altamente detallada (iluminacin, cmara, ajustes de renderizado).","node.promptProcessor.enhanceTooltip":"Usa IA para expandir y enriquecer el prompt con detalles descriptivos.","node.promptProcessor.chainTooltip":"Ejecuta este nodo y activa todos los nodos posteriores conectados.","image_sequence.tooltip.autoCrop":"Recorta automticamente las imgenes generadas a una proporcin de 16:9.","image_sequence.tooltip.autoDownload":"Guarda automticamente cada imagen en tu dispositivo tras la generacin.","image_sequence.tooltip.createZip":"Empaqueta todas las imgenes seleccionadas en un nico archivo ZIP para su descarga."},$w={"imageEditor.title":"Editor de Imagen","imageEditor.canvasResolution":"Resolucin del Lienzo","imageEditor.background":"Fondo","imageEditor.toolSettings":"Ajustes de Herramienta","imageEditor.snapToEdges":"Ajustar a Bordes","imageEditor.freeAspect":"Relacin de Aspecto Libre","imageEditor.section.aiRequest":"Solicitud de Modificacin IA","imageEditor.input.modificationPlaceholder":'Describe cambios, ej. "cambiar fondo a azul"',"imageEditor.action.sendRequest":"Enviar Solicitud","imageEditor.tooltip.removeObject":"Eliminar (Rojo) / Mantener (Verde)","imageEditor.action.removeObject":"Eliminar Objeto","imageEditor.tool.transform":"Transformar","imageEditor.tool.hand":"Mano (Panormica)","imageEditor.tool.zoom":"Zoom","imageEditor.tool.pencil":"Lpiz","imageEditor.tool.rectangle":"Rectngulo","imageEditor.action.fit":"Ajustar al Lienzo","imageEditor.action.fill":"Llenar Lienzo","imageEditor.action.cancel":"Cancelar","imageEditor.action.resetEdits":"Restablecer Ediciones","imageEditor.action.apply":"Aplicar","imageViewer.title":"Visor de Imagen","imageEditor.outputResolution":"Resolucin de Salida","imageEditor.outputResolutionHelp":'Establecer resolucin de salida. Si es "Auto", usa la resolucin del lienzo.',"imageEditor.currentSize":"Tamao Actual: {width}x{height}","imageEditor.sequenceMode":"Modo Secuencia","imageEditor.sequenceModeHelp":"Procesar imgenes de entrada desde Entrada A secuencialmente.","imageEditor.sequentialCombination":"Combinacin Secuencial de Imgenes","imageEditor.sequentialCombinationHelp":"Para cada cuadro: Enve la imagen actual de A + Todas las imgenes de B.","imageEditor.sequentialPrompt":"Combinacin Secuencial de Prompts","imageEditor.sequentialPromptHelp":"Para cada cuadro: Usa un prompt nico de la lista + imagen actual.","imageEditor.sequentialEditingWithPrompts":"Edicin Secuencial con Prompts","imageEditor.sequentialEditingWithPromptsHelp":"Para cada cuadro: Usa imagen de B + prompt nico. La Entrada A se ignora.","imageEditor.input":"Entrada","imageEditor.inputA":"Entrada A","imageEditor.inputB":"Entrada B","imageEditor.status.queued":"En cola","imageEditor.status.generating":"Generando...","imageEditor.action.regenerate":"Regenerar","imageEditor.tooltip.fit":"Ajustar imagen a lmites del lienzo (contener).","imageEditor.tooltip.fill":"Escalar imagen para llenar lienzo (cubrir).","imageEditor.tooltip.flip":"Voltear imagen horizontalmente.","imageEditor.background.white":"Blanco","imageEditor.background.gray":"Gris","imageEditor.background.black":"Negro","imageEditor.background.dark":"Oscuro","image_sequence.regenerate":"Regenerar","image_sequence.stop_queue":"Detener Cola","image_sequence.move_up":"Mover Arriba","image_sequence.move_down":"Mover Abajo","image_sequence.copy_prompt":"Copiar Prompt","image_sequence.add_frame":"Aadir Cuadro","image_sequence.delete_frame":"Eliminar Cuadro","image_sequence.expand_all_frames":"Expandir/Colapsar Todos los Cuadros","image_sequence.collapse_all_frames":"Colapsar Todos los Cuadros","image_sequence.expand_all_scenes":"Expandir/Colapsar Todas las Escenas","image_sequence.collapse_all_scenes":"Colapsar Todas las Escenas","image_sequence.expand_all":"Expandir Todo","image_sequence.collapse_all":"Colapsar Todo","image_sequence.clear_all_prompts":"Borrar Todos los Prompts","image_sequence.add_first_frame":"Aadir Primer Cuadro","image_sequence.drop_or_add_title":"Soltar JSON de Secuencia o Aadir Cuadro","image_sequence.drop_or_add_desc":"Suelta un archivo JSON aqu o haz clic para aadir un cuadro manualmente.","image_sequence.load_prompts":"Cargar Prompts","image_sequence.output_images_title":"Imgenes de Salida","image_sequence.prompts_list_title":"Prompts de Origen","image_sequence.download_selected":"Descargar Seleccionados","image_sequence.select_all":"Seleccionar Todo","image_sequence.select_none":"Deseleccionar","image_sequence.invert_selection":"Invertir Seleccin","image_sequence.run_selected":"Ejecutar Seleccionados","image_sequence.start_queue":"Iniciar Cola","image_sequence.character_prompt_combination":"Combinacin de Prompt de Personaje","image_sequence.combination_none":"Ninguna","image_sequence.combination_combine":"Combinar","image_sequence.combination_replace":"Reemplazar Etiquetas","image_sequence.status.error":"Error","image_sequence.status.pending":"En cola","image_sequence.clear_selected_prompts":"Borrar Prompts Seleccionados","image_sequence.range_from":"De:","image_sequence.range_to":"A:","image_sequence.stats.total":"Total Cuadros: {count}","image_sequence.stats.generated":"Generados: {count}","image_sequence.stats.queue":"Cola: {count}","image_sequence.edit_in_source":"Editar en Fuente","image_sequence.edit_prompt":"Editar Prompt","image_sequence.select_scene":"Seleccionar Escena","image_sequence.next_scene":"Siguiente Escena","image_sequence.prev_scene":"Escena Anterior","image_sequence.scene_input_label":"Escena","image_sequence.select_square":"Seleccionar Cuadradas (1:1)","image_sequence.select_landscape":"Seleccionar Paisaje (16:9)","image_sequence.select_portrait":"Seleccionar Retrato (9:16)","image_sequence.select_range":"Seleccionar Rango","image_sequence.force_refresh":"Forzar Actualizacin","image_sequence.select_scene_frames":"Seleccionar todos los cuadros en esta escena","image_sequence.collapse_other_scenes":"Colapsar otras escenas","prompt_sequence_editor.instructionPlaceholder":"Introducir instruccin para modificar prompts...","prompt_sequence_editor.modifying":"Modificando...","prompt_sequence_editor.modifySelected":"Modificar Seleccionados ({count})","prompt_sequence_editor.sourcePrompts":"Prompts de Origen","prompt_sequence_editor.finalPrompts":"Prompts Modificados","prompt_sequence_editor.error.invalidInput":"Formato de datos invlido. Por favor conecte un array de secuencia de prompts.","geminiChat.mode.general":"General","geminiChat.mode.prompt":"Experto en Prompts","geminiChat.mode.script":"Guionista","geminiChat.mode.youtube":"Analista de YouTube","image_sequence.shot_type.WS":"Integra la Entidad con un Plano General (WS) en la escena y la accin. Muestra el entorno.","image_sequence.shot_type.MS":"Integra la Entidad con un Plano Medio (MS) en la escena. Personaje desde la cintura hacia arriba.","image_sequence.shot_type.CU":"Integra la Entidad con un Primer Plano (CU) en la escena.","image_sequence.shot_type.ECU":"Integra la Entidad con un Primersimo Primer Plano (ECU) en la escena. Mximo detalle.","image_sequence.shot_type.LS":"Integra la Entidad con un Plano Largo (LS) en la escena para mostrar escala."},Kw={"dialog.permission.title":"Permiso Requerido","dialog.permission.description":"Esta aplicacin necesita permiso para leer tu portapapeles y permitir pegar contenido en los nodos. Tus datos no se almacenan ni se envan a ningn lado.","dialog.permission.allow":"Permitir","dialog.permission.decline":"Rechazar","dialog.rename.title":"Renombrar Elemento","dialog.rename.group.title":"Renombrar Grupo","dialog.rename.catalog.title":"Renombrar Elemento de Catlogo","dialog.rename.node.title":"Renombrar Nodo","dialog.rename.label":"Nuevo Nombre:","dialog.rename.confirm":"Renombrar","dialog.rename.cancel":"Cancelar","dialog.promptEdit.title":"Editar Prompt","dialog.promptEdit.nameLabel":"Nombre:","dialog.promptEdit.contentLabel":"Contenido:","dialog.promptEdit.confirm":"Guardar","dialog.promptEdit.cancel":"Cancelar","dialog.confirmDelete.title":"Confirmar Eliminacin","dialog.confirmDelete.message":"Ests seguro de que quieres eliminar este elemento? Esta accin no se puede deshacer.","dialog.confirmDelete.confirm":"Eliminar","dialog.confirmDelete.cancel":"Cancelar","dialog.confirmCloseTab.title":"Cerrar Pestaa","dialog.confirmCloseTab.message":'Ests seguro de que quieres cerrar la pestaa "{tabName}"? Se perdern los cambios no guardados.',"dialog.confirmClear.title":"Limpiar Lienzo","dialog.confirmClear.message":"Ests seguro de que quieres limpiar todo el lienzo? Esta accin no se puede deshacer.","dialog.confirmReset.title":"Restablecer a Predeterminado","dialog.confirmReset.message":"Ests seguro de que quieres restablecer el lienzo al estado predeterminado? Se perder todo el trabajo actual.","dialog.confirmReset.confirm":"Restablecer","dialog.confirmLoad.title":"Confirmar Carga","dialog.confirmLoad.message":"Cargar un nuevo archivo reemplazar el contenido actual. Se perder cualquier cambio no guardado. Continuar?","dialog.apiKey.title":"Seleccionar Clave API","dialog.apiKey.description":'Esta funcin requiere una clave API de proyecto con la API "AI Platform" habilitada. La generacin de video puede tardar unos minutos.',"dialog.apiKey.billingLink":"Aprende ms sobre facturacin","dialog.apiKey.button":"Seleccionar Clave API","dialog.settings.title":"Ajustes","dialog.settings.apiKeyLabel":"Tu Clave API de Google Gemini:","dialog.settings.useDevKeyLabel":"Usar clave API gratuita (para desarrollo)","dialog.settings.instantNodeCloseLabel":"Cierre instantneo de nodos","dialog.settings.nodeAnimationLabel":"Animacin de Adicin de Nodo","dialog.settings.animationModeLabel":"Modo de Animacin de Creacin","dialog.settings.anim.pulse":"Pulso","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"Ninguna","dialog.settings.description":"Para usar tus propias cuotas y acceder a modelos especficos, ingresa tu clave API personal. La clave se almacena localmente en tu navegador.","dialog.settings.getKeyLink":"Obtn una Clave API aqu","dialog.settings.save":"Guardar","dialog.settings.reload":"Recargar App","dialog.deleteNode.title":"Cerrar nodo?","dialog.deleteNode.titlePlural":"Cerrar nodos?","dialog.deleteNode.confirm":"S","dialog.deleteNode.cancel":"No","dialog.deleteNode.confirmTooltip":"Cerrar nodo - los datos perdidos no se pueden recuperar","dialog.deleteNode.cancelTooltip":"No cerrar - continuar trabajando con el nodo","dialog.deleteNode.dontShowAgain":"No mostrar de nuevo","dialog.exitApp.title":"Cerrar Proyecto?","dialog.exitApp.message":"Ests seguro de que quieres cerrar el proyecto? Todo el trabajo actual se perder y el lienzo se reiniciar."},Jw={"group.button.create":"Crear Grupo ({count})","group.rename":"Renombrar Grupo","group.saveToCatalog":"Guardar en Catlogo","group.saveToDisk":"Guardar en Disco","group.ungroup":"Desagrupar (Shift+Clic para eliminar con contenido)","group.duplicate":"Duplicar grupo con contenido","catalog.tabs.groups":"Grupos","catalog.tabs.library":"Biblioteca","catalog.tabs.characters":"Personajes","catalog.tabs.scripts":"Guiones","catalog.tabs.sequences":"Secuencias","catalog.back":"Atrs","catalog.load":"Cargar desde Archivo","catalog.newFolder":"Nueva Carpeta","catalog.saveTo":"Guardar en Catlogo","catalog.card.addToCanvas":"Aadir al Lienzo","catalog.card.rename":"Renombrar","catalog.card.save":"Guardar","catalog.card.delete":"Eliminar","catalog.empty.description":"Esta carpeta est vaca. Puedes aadir elementos o crear nuevas carpetas.","library.loadFromFile":"Cargar","library.actions.newFolder":"Nueva Carpeta","library.actions.newPrompt":"Nuevo Prompt","library.actions.copy":"Copiar","library.actions.edit":"Editar","library.empty.title":"Carpeta Vaca","library.empty.description":"Crea prompts y carpetas para empezar.","library.emptyPrompt":"Prompt vaco"},Yw={...Uw,...Vw,...Ww,...$w,...Kw,...Jw},Zw={"app.title":"Prompt Modifikatori","app.subtitle":"G'oyalarni bog'lab, shoh asar yarating","app.error.title":"Bildirishnoma","app.error.copy":"Xabarni nusxalash","app.error.copied":"Nusxalandi!","error.apiKey":"API kalitingiz yaroqsiz yoki ruxsatlar yetishmayapti. Iltimos, to'g'ri API kalitini tanlang.","error.scriptModifierCanvas":"Bu xolst boshqa ilovaga tegishli - Script Modifier. Iltimos, ushbu faylni ochish uchun Script Modifier-dan foydalaning.","welcome.title":"Xush kelibsiz","welcome.description":"Prompt Modifier-ga xush kelibsiz. G'oyalarni bog'lab, shoh asar yarating. Tarkibni yaratish va tahrirlash uchun tugunlardan foydalaning.","welcome.apiKeyLabel":"Sizning Google Gemini API Kalitingiz","welcome.apiKeyPlaceholder":"API kalitingizni shu yerga kiriting...","welcome.apiKeyHelp":"Sizning API kalitingiz lokal tarzda saqlanadi.","welcome.getKeyLink":"API Kalitini Olish","welcome.iAmDeveloper":"Men Dasturchiman","welcome.letsGo":"Boshladik","welcome.freeModeActive":"Bepul Rejim Faol","welcome.selectLanguage":"Asosiy tilingizni tanlang","welcome.navHint":"Tilni o'zgartirish uchun klaviatura tugmalari  va  dan foydalaning","toast.contentCleared":"Tarkib tozalandi","toast.downloadStarted":"Yuklab olish boshlandi","toast.characterLoaded":"Personaj kartasi yuklandi","toast.characterSavedDisk":"Personaj kartasi diskka saqlandi","toast.copiedToClipboard":"Buferga nusxalandi","toast.pastedFromClipboard":"Buferdan joylandi","toast.pasteFailed":"Joylash amalga oshmadi","toast.nodeDuplicated":"Tugun nusxalandi","toast.groupSavedToDisk":'"{groupTitle}" guruhi diskka saqlandi',"toast.groupDeleted":"Guruh va uning tarkibi o'chirildi","toast.characterSavedCatalog":"Personaj katalogga saqlandi","toast.promptSaved":"Prompt kutubxonaga saqlandi: {promptName}...","toast.connectionsCut":"Ulanishlar uzildi","toast.apiKeySaved":"API Kaliti muvaffaqiyatli saqlandi","toast.cacheCleared":"{count} ta foydalanilmagan element keshdan tozalandi","toast.cacheEmpty":"Kesh allaqachon optimallashtirilgan","toast.scriptSaved":"Ssenariy diskka saqlandi","alert.groupSaved":'"{groupTitle}" guruhi katalogga saqlandi.',"alert.loadCatalogFailed":"Katalog faylini yuklashda xatolik","alert.invalidCatalogFile":"Katalog fayli formati noto'g'ri","alert.fileNotSupported":`Fayl qo'llab-quvvatlanmaydi. "appName" yetishmayapti yoki noto'g'ri.`,"alert.invalidCatalogStructure":`Katalog tuzilishi noto'g'ri. "root" yetishmayapti.`},Xw={"toolbar.settings":"Sozlamalar","toolbar.resetCanvas":"Xolstni tiklash","toolbar.clearCache":"Foydalanilmagan keshni tozalash","toolbar.home":"Bosh sahifa","toolbar.edit":"Tahrirlash (V)","toolbar.cutter":"Ulanishni qirqish (C) / (Ctrl bosib turing)","toolbar.selection":"Tanlash (S) / (Shift bosib turing)","toolbar.reroute":"Yo'naltirish (R) / (Ctrl+Alt bosib turing)","toolbar.zoom":"Kattalashtirish (Z bosib turing)","toolbar.snapToGrid":"To'rga yopishtirish","toolbar.smartGuides":"Aqlli qo'llanmalar","toolbar.lineStyleSpaghetti":"Spagetti chiziqlar","toolbar.lineStyleOrthogonal":"To'g'ri chiziqlar","toolbar.resetZoom":"Masshtabni tiklash","toolbar.resetCamera":"Kamera holatini tiklash","toolbar.clearCanvas":"Xolstni tozalash","toolbar.addNode":"Tugun qo'shish (F)","toolbar.catalog":"Katalogni ochish (Ctrl + Space)","toolbar.addNote":"Eslatma qo'shish (N)","toolbar.addDataReader":"Ma'lumot o'quvchi qo'shish (Shift + R)","toolbar.addTextInput":"Matn kiritish qo'shish (T)","toolbar.addImageInput":"Rasm kiritish qo'shish (I)","toolbar.addPromptSequenceEditor":"Prompt ketma-ketligi muharriri (Q)","toolbar.addImageAnalyzer":"Rasm analizatorini qo'shish (Shift+A)","toolbar.addPromptAnalyzer":"Prompt analizatorini qo'shish (A)","toolbar.addPromptProcessor":"Prompt protsessorini qo'shish (P)","toolbar.addCharacterGenerator":"Personaj generatorini qo'shish (Shift+C)","toolbar.addCharacterAnalyzer":"Personaj analizatorini qo'shish (Ctrl+Shift+A)","toolbar.addCharacterCard":"Personaj kartasini qo'shish (Ctrl+Shift+C)","toolbar.addImageOutput":"Rasm natijasini qo'shish (O)","toolbar.addImageEditor":"AI Rasm muharririni qo'shish (Shift+I)","toolbar.addImageSequenceGenerator":"Rasm ketma-ketligi generatorini qo'shish (Shift+Q)","toolbar.addTranslator":"Tarjimon qo'shish (L)","toolbar.addGeminiChat":"Gemini Chat qo'shish (M)","toolbar.addVideoPromptProcessor":"Video prompt protsessorini qo'shish (Shift+P)","toolbar.addVideoOutput":"Video natijasini qo'shish (Shift+O)","toolbar.addScriptGenerator":"Ssenariy generatorini qo'shish","toolbar.addScriptViewer":"Ssenariy ko'ruvchisini qo'shish (Shift + V)","toolbar.saveCanvas":"Xolstni saqlash (Ctrl + S)","toolbar.saveProject":"Loyihani saqlash","toolbar.loadCanvas":"Loyiha/Xolstni yuklash (Ctrl + O)","toolbar.group.general":"Umumiy","toolbar.group.catalog":"Katalog","toolbar.group.input":"Kiritish","toolbar.group.processing":"Qayta ishlash","toolbar.group.character":"Personaj","toolbar.group.output":"Chiqarish","toolbar.group.aiTools":"AI Vositalari","toolbar.group.video":"Video","toolbar.group.scripts":"Ssenariylar","toolbar.group.file":"Fayl","toolbar.title":"Asboblar paneli","toolbar.dock":"Panelni mahkamlash","toolbar.detach":"Panelni ajratish","toolbar.expandPanel":"Panelni kengaytirish","toolbar.collapsePanel":"Panelni yig'ish","toolbar.dockArea.title":"Panelni shu yerga mahkamlash","toolbar.duplicate":"Tugunni nusxalash","toolbar.duplicateWithContent":"Tarkib bilan nusxalash","toolbar.dock.q1":"Chap 1-chorak","toolbar.dock.q2":"Chap 2-chorak","toolbar.dock.q3":"O'ng 3-chorak","toolbar.dock.q4":"O'ng 4-chorak","toolbar.dock.tl":"Yuqori Chap","toolbar.dock.bl":"Pastki Chap","toolbar.dock.tr":"Yuqori O'ng","toolbar.dock.br":"Pastki O'ng","toolbar.dock.left":"Chap Yarim","toolbar.dock.right":"O'ng Yarim","toolbar.dock.full":"To'liq Ekran","toolbar.dock.exitFull":"To'liq ekrandan chiqish","toolbar.dock.fullFocus":"To'liq ekran fokusi","hotkeys.show":"Tugmalar birikmasini ko'rsatish","hotkeys.tools.title":"Vositalar","hotkeys.tools.edit":"Tahrirlash rejimi","hotkeys.tools.cutter":"Qirqish vositasi","hotkeys.tools.selection":"Tanlash vositasi","hotkeys.tools.reroute":"Yo'naltirish vositasi","hotkeys.tools.zoom":"Kattalashtirish vositasi","hotkeys.tools.toggleLineStyle":"Chiziq uslubini o'zgartirish","hotkeys.tools.group":"Guruh tanlash","hotkeys.tools.closeNode":"Tanlanganni o'chirish","hotkeys.tools.duplicate":"Tugunni nusxalash","hotkeys.tools.duplicateWithContent":"Tarkib bilan nusxalash","hotkeys.tools.deleteGroup":"Guruhni o'chirish (Shift+Click)","hotkeys.windows.title":"Oynalar","hotkeys.windows.search":"Tezkor qidiruv","hotkeys.windows.catalog":"Katalog","hotkeys.createNode.title":"Tugun yaratish","help.panelTitle":"Yordam va Tugmalar","help.title":"Klaviatura tugmalari","help.howToUse.title":"Qanday ishlatiladi","help.howToUse.content":"Prompt Modifier-ga xush kelibsiz! Tugunlarni qo'shish uchun asboblar paneli yoki tugmalar birikmasidan foydalaning. Ma'lumot uzatish uchun tugunlarni ulang. Tugunlarni ko'chirish va xolstni surish uchun Tahrirlash vositasidan foydalaning. Tezkor qo'shish menyusini ochish uchun bo'sh joyga ikki marta bosing. O'ng tugma kontekst menyusi uchun.","help.author":"Muallif","contextMenu.undoPosition":"Joylashuvni bekor qilish","contextMenu.redoPosition":"Joylashuvni qaytarish","contextMenu.align.left":"Chapga tekislash (F)","contextMenu.align.centerX":"Markazga (X) tekislash (E)","contextMenu.align.right":"O'ngga tekislash (R)","contextMenu.align.top":"Yuqoriga tekislash (T)","contextMenu.align.centerY":"Markazga (Y) tekislash (D)","contextMenu.align.bottom":"Pastga tekislash (B)","contextMenu.distribute.horizontal":"Gorizontal taqsimlash (Ctrl+D)","contextMenu.distribute.vertical":"Vertikal taqsimlash (Ctrl+E)","contextMenu.emptySlot":"Bo'sh slot (Tayinlash uchun o'ng tugma)","contextMenu.saveSlots":"Slotlar konfiguratsiyasini saqlash","contextMenu.loadSlots":"Slotlar konfiguratsiyasini yuklash","quickadd.title":"Tezkor Qo'shish","quickadd.group.tools":"Vositalar","quickadd.group.inputs":"Kiritish","quickadd.group.processing":"Qayta ishlash","quickadd.group.character":"Personaj","quickadd.group.outputs":"Chiqarish","quickadd.group.ai":"AI Vositalari","quickadd.group.video":"Video","quickadd.group.scripts":"Ssenariylar","quickadd.group.general":"Umumiy","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"Tahrirlash","quickadd.tool.cutter":"Qirqish","quickadd.tool.selection":"Tanlash","search.placeholder":"Qo'shish uchun tugunni qidiring...","search.noResults":"Tugunlar topilmadi.","search.group.input":"Kiritish va Asosiy","search.group.process":"Qayta ishlash va Personaj","search.group.output":"Rasm va Ketma-ketlik","search.group.ai":"AI Vositalari","search.group.video":"Video va Skriptlash","search.group.scripts":"Ssenariylar","toolbar.exitApp":"Loyihani yopish"},Qw={"node.title.text_input":"Matn Kiritish","node.title.image_input":"Rasm Kiritish","node.title.prompt_processor":"Prompt Protsessori","node.title.prompt_sanitizer":"Prompt Tozalagich","node.title.video_prompt_processor":"Video Prompt Protsessori","node.title.image_output":"Rasm Natijasi","node.title.video_output":"Video Natijasi","node.title.prompt_analyzer":"Prompt Analizatori","node.title.character_analyzer":"Personaj Analizatori","node.title.character_generator":"Personaj Generatori","node.title.character_card":"Personaj Kartasi","node.title.image_analyzer":"Rasm Analizatori","node.title.image_editor":"AI Rasm Muharriri","node.title.image_sequence_generator":"Rasm Ketma-ketligi Generatori","node.title.prompt_sequence_editor":"Prompt Ketma-ketligi Muharriri","node.title.gemini_chat":"Gemini Chat","node.title.translator":"Tarjimon","node.title.script_generator":"Ssenariy Generatori","node.title.script_viewer":"Ssenariy Ko'ruvchisi","node.title.note":"Eslatma","node.title.reroute_dot":"Yo'naltirish Nuqtasi","node.title.data_reader":"Ma'lumot O'quvchi","node.title.video_editor":"Video Muharriri Alfa Versiyasi","node.title.media_viewer":"Media Ko'ruvchi","node.title.data_protection":"Ma'lumotlarni Himoyalash","node.title.pose_creator":"Pose Creator","node.help.text_input":"Promptlar yoki eslatmalar kiritish uchun oddiy ko'p qatorli matn maydoni.","node.help.image_input":"Boshqa tugunlarda ishlatish uchun rasm yuklash yoki joylash imkonini beradi.","node.help.prompt_processor":"AI yordamida bir nechta matnli kiritmalarni bitta yaxshilangan promptga birlashtiradi.","node.help.prompt_sanitizer":"San'at maqsadini saqlagan holda rasm yaratish siyosati uchun xavfsizroq bo'lishi uchun kirish promptini qayta yozadi.","node.help.video_prompt_processor":"Video yaratish uchun batafsil promptlar yaratishga ixtisoslashgan protsessor.","node.help.image_output":"Rasm yaratish natijasini ko'rsatadi. Yuklab olish va ko'rishni qo'llab-quvvatlaydi.","node.help.video_output":"Veo modeli yordamida video yaratish natijasini ko'rsatadi.","node.help.prompt_analyzer":"Promptni mavzu, uslub va muhit kabi tarkibiy qismlarga ajratadi.","node.help.character_analyzer":"Personaj tavsifini tahlil qiladi va uni tashqi ko'rinish va kiyimga ajratadi.","node.help.character_generator":"Qisqa prompt asosida batafsil personaj tavsiflarini yaratadi.","node.help.character_card":"Rasm va tavsifni o'z ichiga olgan to'liq personaj ma'lumotlarini saqlaydi.","node.help.image_analyzer":"Kiritilgan rasmning mazmunini tasvirlash uchun AIdan foydalanadi.","node.help.image_editor":"Matn promptlari va inpainting/outpainting yordamida rasmlarni tahrirlash uchun ilg'or vosita.","node.help.image_sequence_generator":"Promptlar ro'yxati asosida rasmlar ketma-ketligini yaratadi.","node.help.prompt_sequence_editor":"AI ko'rsatmalari yordamida promptlar ketma-ketligini ommaviy tahrirlash imkonini beradi.","node.help.gemini_chat":"Fikr almashish yoki yordam olish uchun Gemini bilan umumiy maqsadli suhbat interfeysi.","node.help.translator":"AI modellari yordamida matnni tillar o'rtasida tarjima qiladi.","node.help.script_generator":"Hikoya g'oyasidan tuzilgan ssenariy (sahnalar, personajlar) yaratadi.","node.help.script_viewer":"Kadrlar bo'yicha generatsiya qilish uchun ssenariy ma'lumotlarini vizualizatsiya qiladi va boshqaradi.","node.help.note":"Xolstga izohlar yoki ko'rsatmalar qo'shish uchun yopishqoq eslatma.","node.help.reroute_dot":"Ulanishlarni tashkil qilish va toza chizmalar yaratish uchun kichik nuqta.","node.help.data_reader":"Ulanishlar orqali oqayotgan xom ma'lumotlarni tekshirish uchun disk raskadrovka vositasi.","node.help.video_editor":"Video kliplar va rasmlarni tahrirlash uchun vaqt shkalasi asosidagi vosita.","node.help.media_viewer":"Video va audio fayllarni ijro etish boshqaruvlari bilan ko'rish uchun pleyer.","node.help.data_protection":"Ma'lumotlar oqimini buzilishdan himoya qiluvchi mini-o'yin tuguni.","node.help.pose_creator":"Vizual rig yordamida personaj pozalarini yaratish va generatsiya uchun yo'riqnoma sifatida foydalanish.","node.action.expand":"Kengaytirish","node.action.collapse":"Yig'ish","node.action.help":"Yordam","node.action.download":"Yuklab olish","node.action.clear":"Tarkibni tozalash","node.action.refreshChat":"Chatni tozalash va qayta boshlash","node.action.paste":"Joylash","node.action.resetEditor":"Muharrirni tiklash","node.action.saveCharacter":"Diskka saqlash","node.action.loadCharacter":"Diskdan yuklash","node.action.copy":"Nusxalash","node.action.copyImage":"Rasmni nusxalash","node.action.copyTextPrompt":"Promptni nusxalash","node.action.copyImagePrompt":"Rasm promptini nusxalash","node.action.copyVideoPrompt":"Video promptini nusxalash","node.action.cutConnections":"Ulanishlarni uzish","node.action.close":"Yopish","node.action.closeNode":"Tugunni yopish (Shift+Click)","node.action.closeNodeSimple":"Tugunni yopish","node.action.randomWord":"Tasodifiy so'z qo'shish","node.action.processImage":"Belgilarni olib tashlash","node.action.processImageTitle":"Rasm va matn belgilarini olib tashlash uchun Gemini-dan foydalanadi.","node.action.editor":"Muharrir","node.action.rasterEditor":"Raster Muharriri","node.action.openInAIEditor":"AI Muharririda ochish","node.action.openInAnalyzer":"Analizatorda ochish","node.action.outputToInput":"Chiqishni kirish sifatida ishlatish","node.action.processChainForward":"Oldinga qayta ishlash","node.action.executeChain":"Zanjirni bajarish","node.action.executeChainTitle":"Yakuniy natijani yaratish uchun barcha yuqori oqim tugunlarini bajaring.","node.action.sanitize":"Tozalash","node.action.rename":"Nomini o'zgartirish","node.action.stop":"To'xtatish","node.action.stopping":"To'xtatilmoqda...","node.action.deleteItem":"Elementni o'chirish","node.action.detachAndPaste":"Ajratish va joylash","node.action.delete":"O'chirish","node.action.flipImage":"Rasmni aylantirish","node.action.pin":"Tugunni yuqoriga mahkamlash","node.action.unpin":"Tugunni bo'shatish","node.action.updateDescription":"Tavsifni yangilash","node.action.modifyCharacter":"O'zgarishlarni so'rash","node.action.updateDataFormat":"Ma'lumot formatini yangilash","node.action.expand169":"16:9 ga kengaytirish","node.action.expand916":"9:16 ga kengaytirish","node.action.sync":"Ulanishlardan sinxronlash","node.action.expandRatio":"Nisbatni kengaytirish","node.action.markPrimary":"Asosiy qilib belgilash","node.action.addCard":"Karta qo'shish","node.action.removeCard":"Kartani o'chirish","node.action.showOutputs":"Chiqishlarni ko'rsatish","node.action.hideOutputs":"Chiqishlarni yashirish","node.mediaViewer.play":"Ijro etish","node.mediaViewer.pause":"Pauza","node.mediaViewer.stop":"To'xtatish","node.mediaViewer.addMarker":"Marker qo'shish","node.mediaViewer.exportSRT":"Markerlarni eksport qilish (SRT)","node.mediaViewer.deleteAllMarkers":"Barcha markerlarni o'chirish","node.mediaViewer.saveMarkers":"Markerlarni saqlash","node.mediaViewer.loadMarkers":"Markerlarni yuklash","node.mediaViewer.relink":"Faylni qayta ulash","node.content.notePlaceholder":"Matningizni shu yerga kiriting...","node.content.dropImage":"Rasmni shu yerga tashlang yoki yuklash uchun bosing","node.content.dropMedia":"Video yoki audioni shu yerga tashlang","node.content.processing":"Qayta ishlanmoqda...","node.content.processingChain":"Zanjir qayta ishlanmoqda...","node.content.metadataPrompt":"Rasm metama'lumotlaridan prompt:","node.content.metadataPromptPlaceholder":"Rasmda prompt topilmadi.","node.content.copyPrompt":"Ishlatish","node.content.prompt":"Prompt","node.content.inputPrompt":"Kirish Prompti","node.content.enhancedResult":"Yaxshilangan Natija","node.content.videoPrompt":"Video Prompt","node.content.editPromptPlaceholder":"Promptga qo'shing yoki tahrirlang...","node.content.enhancedPromptHere":"Yaxshilangan prompt shu yerda paydo bo'ladi...","node.content.safePrompt":"Tijorat uchun xavfsiz","node.content.generating":"Yaratilmoqda...","node.content.imageHere":"Rasm shu yerda paydo bo'ladi","node.content.generationMode":"Yaratish Modeli","node.content.aspectRatio":"Tomonlar nisbati","node.content.aspectRatioHelp":"Rasm yaratish uchun tomonlar nisbatini o'rnating","node.content.aspectRatioNotSupportedFast":"Tomonlar nisbati faqat Imagen modellari uchun mavjud.","node.content.enableAspectRatioFormatting":"Nisbatni formatlashni yoqish","node.content.autoDownload":"Avto Yuklash","node.content.generateImage":"Rasm Yaratish","node.content.enhancing":"Yaxshilanmoqda...","node.content.enhancePrompt":"Promptni Yaxshilash","node.content.sanitizing":"Tozalanmoqda...","node.content.sanitizedPromptHere":"Tozalangan prompt shu yerda paydo bo'ladi...","node.content.analyzing":"Tahlil qilinmoqda...","node.content.analyzePrompt":"Promptni Tahlil Qilish","node.content.analyzeImage":"Rasmni Tahlil Qilish","node.content.imageToText":"Rasmdan Matnga","node.content.updatePromptFromImage":"Rasmdan promptni yangilash","node.content.analyzeCharacter":"Personajni Tahlil Qilish","node.content.generateCharacters":"Personajlarni Yaratish","node.content.characterPromptPlaceholder":"Yaratish uchun personaj(lar)ni tasvirlang...","node.content.character":"Personaj","node.content.clothing":"Kiyim","node.content.characterPlaceholder":"Personaj tavsifi shu yerda paydo bo'ladi...","node.content.clothingPlaceholder":"Kiyim tavsifi shu yerda paydo bo'ladi...","node.content.appearance":"Tashqi ko'rinish","node.content.personality":"Shaxsiyat","node.content.environment":"Muhit/Sozlama","node.content.action":"Harakat","node.content.emotion":"Hissiyot","node.content.style":"Uslub","node.content.environmentPlaceholder":"Muhitning batafsil tavsifi...","node.content.charactersPlaceholder":"Asosiy personajlar ro'yxati...","node.content.characters":"Personajlar","node.content.characterConcepts":"Personaj Konseptlari","node.content.actionPlaceholder":"Harakat tavsifi...","node.content.emotionPlaceholder":"Hissiyot tavsifi...","node.content.stylePlaceholder":"San'at uslubi tavsifi...","node.content.descriptionHere":"Tavsif shu yerda paydo bo'ladi...","node.content.enableOutpainting":"Outpainting-ni yoqish","node.content.outpaintingPromptPlaceholder":"Outpainting prompti...","node.content.inputImage":"Kirish Rasmlari","node.content.dropOrClick":"Tashlang yoki Bosing","node.content.outputImage":"Chiqish Rasmi","node.content.applyEdit":"Tahrirni Qo'llash","node.content.editing":"Tahrirlanmoqda...","node.content.chatPlaceholder":"Xabaringizni kiriting...","node.content.connectedPlaceholder":"Tugunga ulangan, manbada tahrirlang.","node.content.connectedNode":"Tugun orqali ulangan","node.content.connectedEmpty":"Ulangan tugunda rasm yo'q.","node.content.translatePlaceholder":"Tarjima qilinadigan matn...","node.content.translatedTextPlaceholder":"Tarjima qilingan matn...","node.content.targetLanguage":"Maqsadli Til","node.content.translate":"Tarjima qilish","node.content.translating":"Tarjima qilinmoqda...","node.content.scriptPromptPlaceholder":"Hikoya g'oyasi yoki syujetini kiriting...","node.content.generateScript":"Ssenariy Yaratish","node.content.loadScript":"Ssenariy faylini yuklash","node.content.summary":"Xulosa","node.content.scenes":"Sahnalar","node.content.unrecognizedFormat":"Tanilmagan ssenariy formati.","node.content.frames":"Kadrlar","node.content.characterIndex":"Indeks","node.content.readData":"Ma'lumotni O'qish","node.content.textDataHere":"Matn ma'lumotlari shu yerda paydo bo'ladi.","node.content.noDataRead":`Tarkibni ko'rish uchun tugunni ulang va "Ma'lumotni O'qish" ni bosing.`,"node.content.previewError":"Ko'rib chiqish xatosi","node.content.previewPlaceholder":"Ko'rib chiqish shu yerda paydo bo'ladi","node.content.imagePrompt":"Rasm Prompti","node.output.allPromptData":"Barcha Prompt Ma'lumotlari","node.note.tab.note":"Eslatma","node.note.tab.references":"Manbalar","node.note.nestedImages":"Ichki Rasmlar","node.note.dropPlaceholder":"Rasmlarni tashlang yoki qo'shish uchun bosing","node.note.addCaption":"Sarlavha","node.note.action.shuffle":"Aralashtirish","node.note.action.undoShuffle":"Aralashtirishni bekor qilish","node.content.characterTypeShort":"Tur:","node.content.numberOfCharactersShort":"Son:","node.content.characterType.simple":"Oddiy","node.content.characterType.anthro":"Anthro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Kalit element","node.content.style.simple":"Oddiy","node.content.style.realistic":"Haqiqiy","node.content.style.3d_cartoon":"3D Multfilm","node.content.style.3d_realistic":"3D Haqiqiy","node.content.style.2d_animation":"2D Animatsiya","node.content.style.anime":"Anime","node.content.style.comics":"Komiks","node.content.style.custom":"Maxsus","node.content.fullDescriptionTitle":"To'liq personaj tavsifi","node.content.integrationInstruction":"Integratsiya bo'yicha ko'rsatma","node.content.additionalPromptSuffix":"Qo'shimcha Prompt (Suffiks)","image_sequence.auto_crop":"Avto-qirqish 16:9","image_sequence.create_zip":"ZIP arxiv yaratish","node.content.modificationRequest":"O'zgartirish So'rovi","node.content.technicalPrompt":"Texnik Prompt","node.promptProcessor.safePromptTooltip":"Xavfsizlik qoidalariga rioya qilish va siyosat buzilishining oldini olish uchun promptni qayta yozadi.","node.promptProcessor.technicalPromptTooltip":"Promptni juda batafsil texnik spetsifikatsiyaga aylantiradi (yorug'lik, kamera, render sozlamalari).","node.promptProcessor.enhanceTooltip":"Promptni tavsiflovchi tafsilotlar bilan kengaytirish va boyitish uchun AIdan foydalanadi.","node.promptProcessor.chainTooltip":"Ushbu tugunni bajaradi va barcha ulangan quyi oqim tugunlarini ishga tushiradi.","image_sequence.tooltip.autoCrop":"Yaratilgan rasmlarni avtomatik ravishda 16:9 nisbatiga qirqadi.","image_sequence.tooltip.autoDownload":"Yaratilgandan so'ng har bir rasmni avtomatik ravishda qurilmangizga saqlaydi.","image_sequence.tooltip.createZip":"Yuklab olish uchun barcha tanlangan rasmlarni bitta ZIP arxiviga joylaydi."},eb={"imageEditor.title":"Rasm Muharriri","imageEditor.canvasResolution":"Xolst O'lchami","imageEditor.background":"Orqa Fon","imageEditor.toolSettings":"Asbob Sozlamalari","imageEditor.snapToEdges":"Chegaralarga yopishtirish","imageEditor.freeAspect":"Erkin Nisbat","imageEditor.section.aiRequest":"AI O'zgartirish So'rovi","imageEditor.input.modificationPlaceholder":`O'zgarishlarni tavsiflang, masalan "orqa fonni ko'k rangga o'zgartir"`,"imageEditor.action.sendRequest":"So'rov yuborish","imageEditor.tooltip.removeObject":"O'chirish (Qizil) / Saqlash (Yashil)","imageEditor.action.removeObject":"Obyektni o'chirish","imageEditor.tool.transform":"Transfarmatsiya","imageEditor.tool.hand":"Qo'l (Siljitish)","imageEditor.tool.zoom":"Kattalashtirish","imageEditor.tool.pencil":"Qalam","imageEditor.tool.rectangle":"To'rtburchak","imageEditor.action.fit":"Xolstga moslashtirish","imageEditor.action.fill":"Xolstni to'ldirish","imageEditor.action.cancel":"Bekor qilish","imageEditor.action.resetEdits":"Tahrirlarni tiklash","imageEditor.action.apply":"Qo'llash","imageViewer.title":"Rasm Ko'ruvchi","imageEditor.outputResolution":"Chiqish O'lchami","imageEditor.outputResolutionHelp":`Chiqish o'lchamini o'rnating. Agar "Auto" bo'lsa, xolst o'lchamidan foydalanadi.`,"imageEditor.currentSize":"Joriy O'lcham: {width}x{height}","imageEditor.sequenceMode":"Ketma-ketlik Rejimi","imageEditor.sequenceModeHelp":"Input A dagi kirish rasmlarini ketma-ket qayta ishlash.","imageEditor.sequentialCombination":"Rasmlarni Ketma-ket Birlashtirish","imageEditor.sequentialCombinationHelp":"Har bir kadr uchun: Joriy Input A rasmi + Barcha Input B rasmlarini yuboradi.","imageEditor.sequentialPrompt":"Promptlarni Ketma-ket Birlashtirish","imageEditor.sequentialPromptHelp":"Har bir kadr uchun: Ro'yxatdagi noyob prompt + joriy rasmni ishlatadi.","imageEditor.sequentialEditingWithPrompts":"Promptlar bilan Ketma-ket Tahrirlash","imageEditor.sequentialEditingWithPromptsHelp":"Har bir kadr uchun: Input B rasmi + noyob prompt ishlatiladi. Input A e'tiborga olinmaydi.","imageEditor.input":"Kirish","imageEditor.inputA":"Kirish A","imageEditor.inputB":"Kirish B","imageEditor.status.queued":"Navbatda","imageEditor.status.generating":"Yaratilmoqda...","imageEditor.action.regenerate":"Qayta yaratish","imageEditor.tooltip.fit":"Rasmni xolst chegaralariga moslashtirish (sig'dirish).","imageEditor.tooltip.fill":"Rasmni xolstni to'ldirish uchun masshtablash (qoplash).","imageEditor.tooltip.flip":"Rasmni gorizontal aylantirish.","imageEditor.background.white":"Oq","imageEditor.background.gray":"Kulrang","imageEditor.background.black":"Qora","imageEditor.background.dark":"To'q","image_sequence.regenerate":"Qayta yaratish","image_sequence.stop_queue":"Navbatni to'xtatish","image_sequence.move_up":"Yuqoriga","image_sequence.move_down":"Pastga","image_sequence.copy_prompt":"Promptni nusxalash","image_sequence.add_frame":"Kadr qo'shish","image_sequence.delete_frame":"Kadrni o'chirish","image_sequence.expand_all_frames":"Barcha Kadrlarni Yoyish/Yig'ish","image_sequence.collapse_all_frames":"Barcha Kadrlarni Yig'ish","image_sequence.expand_all_scenes":"Barcha Sahnalarni Yoyish/Yig'ish","image_sequence.collapse_all_scenes":"Barcha Sahnalarni Yig'ish","image_sequence.expand_all":"Hammasini Yoyish","image_sequence.collapse_all":"Hammasini Yig'ish","image_sequence.clear_all_prompts":"Barcha Promptlarni Tozalash","image_sequence.add_first_frame":"Birinchi Kadrni Qo'shish","image_sequence.drop_or_add_title":"Ketma-ketlik JSON tashlang yoki Kadr qo'shing","image_sequence.drop_or_add_desc":"JSON faylni shu yerga tashlang yoki kadrni qo'lda qo'shish uchun tugmani bosing.","image_sequence.load_prompts":"Promptlarni Yuklash","image_sequence.output_images_title":"Chiqish Rasmlari","image_sequence.prompts_list_title":"Manba Promptlar","image_sequence.download_selected":"Tanlanganlarni Yuklash","image_sequence.select_all":"Hammasini Tanlash","image_sequence.select_none":"Tanlovni Bekor Qilish","image_sequence.invert_selection":"Tanlovni Teskari Qilish","image_sequence.run_selected":"Tanlanganlarni Ishga Tushirish","image_sequence.start_queue":"Navbatni Boshlash","image_sequence.character_prompt_combination":"Personaj Prompt Kombinatsiyasi","image_sequence.combination_none":"Yo'q","image_sequence.combination_combine":"Birlashtirish","image_sequence.combination_replace":"Teglarni almashtirish","image_sequence.status.error":"Xato","image_sequence.status.pending":"Navbatda","image_sequence.clear_selected_prompts":"Tanlangan Promptlarni Tozalash","image_sequence.range_from":"Dan:","image_sequence.range_to":"Gacha:","image_sequence.stats.total":"Jami Kadrlar: {count}","image_sequence.stats.generated":"Yaratildi: {count}","image_sequence.stats.queue":"Navbat: {count}","image_sequence.edit_in_source":"Manbada Tahrirlash","image_sequence.edit_prompt":"Promptni Tahrirlash","image_sequence.select_scene":"Sahnani Tanlash","image_sequence.next_scene":"Keyingi Sahna","image_sequence.prev_scene":"Oldingi Sahna","image_sequence.scene_input_label":"Sahna","image_sequence.select_square":"Kvadrat Rasmlarni Tanlash (1:1)","image_sequence.select_landscape":"Landshaft Rasmlarni Tanlash (16:9)","image_sequence.select_portrait":"Portret Rasmlarni Tanlash (9:16)","image_sequence.select_range":"Oraliqni Tanlash","image_sequence.force_refresh":"Majburiy Yangilash","image_sequence.select_scene_frames":"Ushbu sahnadagi barcha kadrlarni tanlash","image_sequence.collapse_other_scenes":"Boshqa sahnalarni yig'ish","prompt_sequence_editor.instructionPlaceholder":"Promptlarni o'zgartirish uchun ko'rsatma kiriting...","prompt_sequence_editor.modifying":"O'zgartirilmoqda...","prompt_sequence_editor.modifySelected":"Tanlanganlarni O'zgartirish ({count})","prompt_sequence_editor.sourcePrompts":"Manba Promptlar","prompt_sequence_editor.finalPrompts":"O'zgartirilgan Promptlar","prompt_sequence_editor.error.invalidInput":"Ma'lumot formati noto'g'ri. Iltimos, prompt ketma-ketligi massivini ulang.","geminiChat.mode.general":"Umumiy","geminiChat.mode.prompt":"Prompt Mutaxassisi","geminiChat.mode.script":"Ssenarist","geminiChat.mode.youtube":"YouTube Analitik","image_sequence.shot_type.WS":"Ob'ektni Keng Plan (WS) bilan sahnaga va harakatga birlashtiring. Atrof-muhitni ko'rsating.","image_sequence.shot_type.MS":"Ob'ektni O'rta Plan (MS) bilan sahnaga birlashtiring. Personaj belidan yuqori.","image_sequence.shot_type.CU":"Ob'ektni Yirik Plan (CU) bilan sahnaga birlashtiring.","image_sequence.shot_type.ECU":"Ob'ektni Juda Yirik Plan (ECU) bilan sahnaga birlashtiring. Maksimal tafsilot.","image_sequence.shot_type.LS":"Ob'ektni Uzoq Plan (LS) bilan sahnaga birlashtirib, ko'lamni ko'rsating."},tb={"dialog.permission.title":"Ruxsat Talab Qilinadi","dialog.permission.description":"Ushbu ilova tugunlarga kontent joylash uchun buferingizni o'qishga ruxsat so'raydi. Ma'lumotlaringiz saqlanmaydi va hech qayerga yuborilmaydi.","dialog.permission.allow":"Ruxsat berish","dialog.permission.decline":"Rad etish","dialog.rename.title":"Element nomini o'zgartirish","dialog.rename.group.title":"Guruh nomini o'zgartirish","dialog.rename.catalog.title":"Katalog elementini qayta nomlash","dialog.rename.node.title":"Tugun nomini o'zgartirish","dialog.rename.label":"Yangi nom:","dialog.rename.confirm":"O'zgartirish","dialog.rename.cancel":"Bekor qilish","dialog.promptEdit.title":"Promptni Tahrirlash","dialog.promptEdit.nameLabel":"Nom:","dialog.promptEdit.contentLabel":"Tarkib:","dialog.promptEdit.confirm":"Saqlash","dialog.promptEdit.cancel":"Bekor qilish","dialog.confirmDelete.title":"O'chirishni Tasdiqlash","dialog.confirmDelete.message":"Haqiqatan ham ushbu elementni o'chirmoqchimisiz? Bu amalni bekor qilib bo'lmaydi.","dialog.confirmDelete.confirm":"O'chirish","dialog.confirmDelete.cancel":"Bekor qilish","dialog.confirmCloseTab.title":"Tabni Yopish","dialog.confirmCloseTab.message":`"{tabName}" tabini yopishni xohlaysizmi? Saqlanmagan o'zgarishlar yo'qoladi.`,"dialog.confirmClear.title":"Xolstni Tozalash","dialog.confirmClear.message":"Haqiqatan ham butun xolstni tozalamoqchimisiz? Bu amalni bekor qilib bo'lmaydi.","dialog.confirmReset.title":"Asl holatga qaytarish","dialog.confirmReset.message":"Xolstni asl holatiga qaytarishni xohlaysizmi? Barcha joriy ishlar yo'qoladi.","dialog.confirmReset.confirm":"Qaytarish","dialog.confirmLoad.title":"Yuklashni Tasdiqlash","dialog.confirmLoad.message":"Yangi faylni yuklash joriy tarkibni almashtiradi. Saqlanmagan o'zgarishlar yo'qoladi. Davom etasizmi?","dialog.apiKey.title":"API Kalitini Tanlash","dialog.apiKey.description":'Bu xususiyat "AI Platform" API yoqilgan Loyiha API kalitini talab qiladi. Video yaratish bir necha daqiqa vaqt olishi mumkin.',"dialog.apiKey.billingLink":"To'lovlar haqida ko'proq ma'lumot","dialog.apiKey.button":"API Kalitini Tanlash","dialog.settings.title":"Sozlamalar","dialog.settings.apiKeyLabel":"Sizning Google Gemini API Kalitingiz:","dialog.settings.useDevKeyLabel":"Bepul API kalitidan foydalanish (ishlab chiqish uchun)","dialog.settings.instantNodeCloseLabel":"Tugunni tezkor yopish","dialog.settings.nodeAnimationLabel":"Tugun Qo'shish Animatsiyasi","dialog.settings.animationModeLabel":"Yaratish Animatsiya Rejimi","dialog.settings.anim.pulse":"Puls","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"Yo'q","dialog.settings.description":"O'z kvotalaringizdan foydalanish va maxsus modellarga kirish uchun shaxsiy API kalitingizni kiriting. Kalit brauzeringizda lokal saqlanadi.","dialog.settings.getKeyLink":"API Kalitini bu yerdan oling","dialog.settings.save":"Saqlash","dialog.deleteNode.title":"Tugunni yopish?","dialog.deleteNode.titlePlural":"Tugunlarni yopish?","dialog.deleteNode.confirm":"Ha","dialog.deleteNode.cancel":"Yo'q","dialog.deleteNode.confirmTooltip":"Tugunni yopish - yo'qolgan ma'lumotlarni qaytarib bo'lmaydi","dialog.deleteNode.cancelTooltip":"Yopmaslik - tugun bilan ishlashni davom ettirish","dialog.deleteNode.dontShowAgain":"Qayta ko'rsatilmasin","dialog.exitApp.title":"Loyihani yopishni xohlaysizmi?","dialog.exitApp.message":"Loyihani yopishni xohlaysizmi? Barcha joriy ishlar yo'qoladi va xolst asl holatiga qaytariladi."},nb={"group.button.create":"Guruh Yaratish ({count})","group.rename":"Guruh Nomini O'zgartirish","group.saveToCatalog":"Katalogga Saqlash","group.saveToDisk":"Diskka Saqlash","group.ungroup":"Guruhdan Chiqarish (Tarkib bilan o'chirish uchun Shift+Click)","group.duplicate":"Guruhni tarkib bilan nusxalash","catalog.tabs.groups":"Guruhlar","catalog.tabs.library":"Kutubxona","catalog.tabs.characters":"Personajlar","catalog.tabs.scripts":"Ssenariylar","catalog.tabs.sequences":"Ketma-ketliklar","catalog.back":"Orqaga","catalog.load":"Fayldan Yuklash","catalog.newFolder":"Yangi Papka","catalog.saveTo":"Katalogga Saqlash","catalog.card.addToCanvas":"Xolstga Qo'shish","catalog.card.rename":"Nomini O'zgartirish","catalog.card.save":"Saqlash","catalog.card.delete":"O'chirish","catalog.empty.description":"Bu papka bo'sh. Siz elementlar qo'shishingiz yoki yangi papkalar yaratishingiz mumkin.","library.loadFromFile":"Yuklash","library.actions.newFolder":"Yangi Papka","library.actions.newPrompt":"Yangi Prompt","library.actions.copy":"Nusxalash","library.actions.edit":"Tahrirlash","library.empty.title":"Bo'sh Papka","library.empty.description":"Boshlash uchun promptlar va papkalar yarating.","library.emptyPrompt":"Bo'sh prompt"},ob={...Zw,...Xw,...Qw,...eb,...tb,...nb},rb={"app.title":"Modificateur de Prompt","app.subtitle":"Connectez des ides pour crer un chef-d'uvre","app.error.title":"Notification","app.error.copy":"Copier le message","app.error.copied":"Copi !","error.apiKey":"Votre cl API est invalide ou manque de permissions. Veuillez slectionner une cl API valide.","error.scriptModifierCanvas":"Ce canevas appartient  une autre application - Script Modifier. Veuillez utiliser Script Modifier pour ouvrir ce fichier.","welcome.title":"Bienvenue dans","welcome.description":"Bienvenue dans Prompt Modifier. Connectez des ides pour crer des chefs-d'uvre. Utilisez les nuds pour gnrer et diter du contenu.","welcome.apiKeyLabel":"Votre cl API Google Gemini","welcome.apiKeyPlaceholder":"Entrez votre cl API ici...","welcome.apiKeyHelp":"Votre cl API est stocke localement.","welcome.getKeyLink":"Obtenir une cl API","welcome.iAmDeveloper":"Je suis dveloppeur","welcome.letsGo":"C'est parti","welcome.resume":"Reprendre","welcome.startNew":"Nouveau Canevas","welcome.freeModeActive":"Mode Gratuit Actif","welcome.selectLanguage":"Slectionnez votre langue principale","welcome.navHint":"Utilisez les touches du clavier  et  pour changer de langue","toast.contentCleared":"Contenu effac","toast.downloadStarted":"Tlchargement commenc","toast.characterLoaded":"Carte de personnage charge","toast.characterSavedDisk":"Carte de personnage enregistre sur le disque","toast.copiedToClipboard":"Copi dans le presse-papiers","toast.pastedFromClipboard":"Coll depuis le presse-papiers","toast.pasteFailed":"chec du collage","toast.nodeDuplicated":"Nud dupliqu","toast.groupSavedToDisk":'Groupe "{groupTitle}" enregistr sur le disque',"toast.groupDeleted":"Groupe et contenu supprims","toast.characterSavedCatalog":"Personnage enregistr dans le catalogue","toast.promptSaved":"Prompt enregistr dans la bibliothque : {promptName}...","toast.connectionsCut":"Connexions supprimes","toast.apiKeySaved":"Cl API enregistre avec succs","toast.cacheCleared":"{count} lments inutiliss effacs du cache","toast.cacheEmpty":"Le cache est dj optimis","toast.scriptSaved":"Scnario enregistr sur le disque","alert.groupSaved":'Groupe "{groupTitle}" enregistr dans le catalogue.',"alert.loadCatalogFailed":"chec du chargement du fichier catalogue","alert.invalidCatalogFile":"Format de fichier catalogue invalide","alert.fileNotSupported":'Fichier non support. "appName" manquant ou incorrect.',"alert.invalidCatalogStructure":'Structure de catalogue invalide. "root" manquant.'},ab={"toolbar.settings":"Paramtres","toolbar.resetCanvas":"Rinitialiser le canevas","toolbar.clearCache":"Vider le cache inutilis","toolbar.home":"Accueil","toolbar.edit":"diter (V)","toolbar.cutter":"Couper connexion (C) / (Maintenir Ctrl)","toolbar.selection":"Slection (S) / (Maintenir Shift)","toolbar.reroute":"Rediriger (R) / (Maintenir Ctrl+Alt)","toolbar.zoom":"Zoom (Maintenir Z)","toolbar.snapToGrid":"Aligner sur la grille","toolbar.smartGuides":"Guides intelligents","toolbar.lineStyleSpaghetti":"Lignes Spaghetti","toolbar.lineStyleOrthogonal":"Lignes Orthogonales","toolbar.resetZoom":"Rinitialiser le zoom","toolbar.resetCamera":"Rinitialiser la camra","toolbar.clearCanvas":"Effacer le canevas","toolbar.addNode":"Ajouter un nud (F)","toolbar.catalog":"Ouvrir le catalogue (Ctrl + Espace)","toolbar.addNote":"Ajouter une note (N)","toolbar.addDataReader":"Ajouter un lecteur de donnes (Shift + R)","toolbar.addTextInput":"Ajouter une entre texte (T)","toolbar.addImageInput":"Ajouter une entre image (I)","toolbar.addPromptSequenceEditor":"Ajouter diteur de squence (Q)","toolbar.addImageAnalyzer":"Ajouter analyseur d'image (Shift+A)","toolbar.addPromptAnalyzer":"Ajouter analyseur de prompt (A)","toolbar.addPromptProcessor":"Ajouter processeur de prompt (P)","toolbar.addCharacterGenerator":"Ajouter gnrateur de personnage (Shift+C)","toolbar.addCharacterAnalyzer":"Ajouter analyseur de personnage (Ctrl+Shift+A)","toolbar.addCharacterCard":"Ajouter carte de personnage (Ctrl+Shift+C)","toolbar.addImageOutput":"Ajouter sortie image (O)","toolbar.addImageEditor":"Ajouter diteur d'image IA (Shift+I)","toolbar.addImageSequenceGenerator":"Ajouter gnrateur de squence (Shift+Q)","toolbar.addTranslator":"Ajouter traducteur (L)","toolbar.addGeminiChat":"Ajouter Chat Gemini (M)","toolbar.addVideoPromptProcessor":"Ajouter processeur de prompt vido (Shift+P)","toolbar.addVideoOutput":"Ajouter sortie vido (Shift+O)","toolbar.addScriptGenerator":"Ajouter gnrateur de scnario","toolbar.addScriptViewer":"Ajouter visualiseur de scnario (Shift + V)","toolbar.saveCanvas":"Enregistrer le canevas (Ctrl + S)","toolbar.saveProject":"Enregistrer le projet","toolbar.loadCanvas":"Charger Projet/Canevas (Ctrl + O)","toolbar.group.general":"Gnral","toolbar.group.catalog":"Catalogue","toolbar.group.input":"Entre","toolbar.group.processing":"Traitement","toolbar.group.character":"Personnage","toolbar.group.output":"Sortie","toolbar.group.aiTools":"Outils IA","toolbar.group.video":"Vido","toolbar.group.scripts":"Scnarios","toolbar.group.file":"Fichier","toolbar.title":"Barre d'outils","toolbar.dock":"Ancrer la barre","toolbar.detach":"Dtacher la barre","toolbar.expandPanel":"Agrandir le panneau","toolbar.collapsePanel":"Rduire le panneau","toolbar.dockArea.title":"Ancrer la barre ici","toolbar.duplicate":"Dupliquer le nud","toolbar.duplicateWithContent":"Dupliquer avec contenu","toolbar.dock.q1":"1er Quart Gauche","toolbar.dock.q2":"2me Quart Gauche","toolbar.dock.q3":"3me Quart Droite","toolbar.dock.q4":"4me Quart Droite","toolbar.dock.tl":"Haut Gauche","toolbar.dock.bl":"Bas Gauche","toolbar.dock.tr":"Haut Droite","toolbar.dock.br":"Bas Droite","toolbar.dock.left":"Moiti Gauche","toolbar.dock.right":"Moiti Droite","toolbar.dock.full":"Plein cran","toolbar.dock.exitFull":"Quitter Plein cran","toolbar.dock.fullFocus":"Focus Plein cran","hotkeys.show":"Voir les raccourcis","hotkeys.tools.title":"Outils","hotkeys.tools.edit":"Mode dition","hotkeys.tools.cutter":"Outil Couteau","hotkeys.tools.selection":"Outil Slection","hotkeys.tools.reroute":"Outil Redirection","hotkeys.tools.zoom":"Outil Zoom","hotkeys.tools.toggleLineStyle":"Changer style de ligne","hotkeys.tools.group":"Slection de Groupe","hotkeys.tools.closeNode":"Supprimer la slection","hotkeys.tools.duplicate":"Dupliquer le nud","hotkeys.tools.duplicateWithContent":"Dupliquer avec contenu","hotkeys.tools.deleteGroup":"Supprimer le groupe (Shift+Clic)","hotkeys.windows.title":"Fentres","hotkeys.windows.search":"Recherche Rapide","hotkeys.windows.catalog":"Catalogue","hotkeys.createNode.title":"Crer un nud","help.panelTitle":"Aide et Raccourcis","help.title":"Raccourcis Clavier","help.howToUse.title":"Comment utiliser","help.howToUse.content":"Bienvenue dans Prompt Modifier ! Utilisez la barre d'outils ou les raccourcis pour ajouter des nuds. Connectez les nuds pour transmettre les donnes. Utilisez l'outil dition pour dplacer les nuds et le canevas. Double-cliquez sur l'espace vide pour ouvrir le menu d'ajout rapide. Clic droit pour le menu contextuel.","help.author":"Auteur","contextMenu.undoPosition":"Annuler dplacement","contextMenu.redoPosition":"Rtablir dplacement","contextMenu.align.left":"Aligner  gauche (F)","contextMenu.align.centerX":"Aligner au centre X (E)","contextMenu.align.right":"Aligner  droite (R)","contextMenu.align.top":"Aligner en haut (T)","contextMenu.align.centerY":"Aligner au centre Y (D)","contextMenu.align.bottom":"Aligner en bas (B)","contextMenu.distribute.horizontal":"Distribuer Horiz. (Ctrl+D)","contextMenu.distribute.vertical":"Distribuer Vert. (Ctrl+E)","contextMenu.emptySlot":"Emplacement vide (Clic droit pour assigner)","contextMenu.saveSlots":"Sauvegarder config slots","contextMenu.loadSlots":"Charger config slots","quickadd.title":"Ajout Rapide","quickadd.group.tools":"Outils","quickadd.group.inputs":"Entres","quickadd.group.processing":"Traitement","quickadd.group.character":"Personnage","quickadd.group.outputs":"Sorties","quickadd.group.ai":"Outils IA","quickadd.group.video":"Vido","quickadd.group.scripts":"Scnarios","quickadd.group.general":"Gnral","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"diter","quickadd.tool.cutter":"Couper","quickadd.tool.selection":"Slection","search.placeholder":"Rechercher un nud  ajouter...","search.noResults":"Aucun nud trouv.","search.group.input":"Entre & Basique","search.group.process":"Traitement & Personnage","search.group.output":"Image & Squence","search.group.ai":"Outils IA","search.group.video":"Vido & Script","search.group.scripts":"Scnarios","toolbar.exitApp":"Fermer le projet"},ib={"node.title.text_input":"Entre de Texte","node.title.image_input":"Entre d'Image","node.title.prompt_processor":"Processeur de Prompt","node.title.prompt_sanitizer":"Nettoyeur de Prompt","node.title.video_prompt_processor":"Proc. Prompt Vido","node.title.image_output":"Sortie Image","node.title.video_output":"Sortie Vido","node.title.prompt_analyzer":"Analyseur de Prompt","node.title.character_analyzer":"Analyseur de Personnage","node.title.character_generator":"Gnrateur de Personnage","node.title.character_card":"Carte de Personnage","node.title.image_analyzer":"Analyseur d'Image","node.title.image_editor":"diteur d'Image IA","node.title.image_sequence_generator":"Gnrateur de Squence","node.title.prompt_sequence_editor":"diteur de Squence de Prompts","node.title.gemini_chat":"Chat Gemini","node.title.translator":"Traducteur","node.title.script_generator":"Gnrateur de Scnario","node.title.script_viewer":"Visualiseur de Scnario","node.title.note":"Note","node.title.reroute_dot":"Point de Redirection","node.title.data_reader":"Lecteur de Donnes","node.title.video_editor":"diteur Vido Alpha","node.title.media_viewer":"Lecteur Multimdia","node.title.data_protection":"Protection des Donnes","node.title.pose_creator":"Pose Creator","node.help.text_input":"Un champ de texte simple pour entrer des prompts ou des notes.","node.help.image_input":"Permet de tlcharger ou coller une image pour l'utiliser comme entre.","node.help.prompt_processor":"Combine plusieurs textes en un seul prompt amlior via IA.","node.help.prompt_sanitizer":"Rcrit le prompt pour le rendre plus sr pour les modles d'IA.","node.help.video_prompt_processor":"Processeur spcialis pour crer des prompts vido dtaills.","node.help.image_output":"Affiche le rsultat de la gnration d'image. Permet le tlchargement.","node.help.video_output":"Affiche le rsultat de la gnration vido via Veo.","node.help.prompt_analyzer":"Dcompose un prompt en sujet, style, environnement, etc.","node.help.character_analyzer":"Analyse une description de personnage (apparence vs vtements).","node.help.character_generator":"Gnre des descriptions dtailles bases sur un prompt court.","node.help.character_card":"Stocke les donnes compltes d'un personnage (image, description).","node.help.image_analyzer":"Utilise l'IA pour dcrire le contenu d'une image.","node.help.image_editor":"Outil avanc pour diter des images avec du texte (inpainting/outpainting).","node.help.image_sequence_generator":"Gnre une squence d'images base sur une liste de prompts.","node.help.prompt_sequence_editor":"Permet l'dition en masse de squences de prompts via instructions IA.","node.help.gemini_chat":"Interface de chat avec Gemini pour le brainstorming.","node.help.translator":"Traduit du texte entre les langues via l'IA.","node.help.script_generator":"Gnre un scnario structur (scnes, persos) depuis une ide.","node.help.script_viewer":"Visualise et gre les donnes de scnario pour la gnration.","node.help.note":"Une note adhsive pour ajouter des commentaires sur le canevas.","node.help.reroute_dot":"Un petit point pour organiser les connexions proprement.","node.help.data_reader":"Outil de dbogage pour inspecter les donnes brutes.","node.help.video_editor":"Outil de montage vido et image bas sur une timeline.","node.help.media_viewer":"Lecteur pour voir les fichiers vido et audio avec contrles.","node.help.data_protection":"Mini-jeu de Tower Defense pour protger vos donnes.","node.help.pose_creator":"Visually rig and create character poses for generation guidance.","node.action.expand":"Agrandir","node.action.collapse":"Rduire","node.action.help":"Aide","node.action.download":"Tlcharger","node.action.clear":"Effacer contenu","node.action.refreshChat":"Redmarrer le chat","node.action.paste":"Coller","node.action.resetEditor":"Rinitialiser","node.action.saveCharacter":"Sauver carte","node.action.loadCharacter":"Charger carte","node.action.copy":"Copier","node.action.copyImage":"Copier image","node.action.copyTextPrompt":"Copier prompt","node.action.copyImagePrompt":"Copier prompt image","node.action.copyVideoPrompt":"Copier prompt vido","node.action.cutConnections":"Couper connexions","node.action.close":"Fermer","node.action.closeNode":"Fermer le nud (Shift+Clic pour instantan)","node.action.closeNodeSimple":"Fermer le nud","node.action.randomWord":"Mot alatoire","node.action.processImage":"Enlever filigranes","node.action.processImageTitle":"Utilise Gemini pour enlever filigranes et textes.","node.action.editor":"diteur","node.action.rasterEditor":"diteur Raster","node.action.openInAIEditor":"Ouvrir diteur IA","node.action.openInAnalyzer":"Ouvrir Analyseur","node.action.outputToInput":"Sortie vers Entre","node.action.processChainForward":"Traiter la chane","node.action.executeChain":"Excuter la chane","node.action.executeChainTitle":"Excute tous les nuds en amont pour gnrer le rsultat.","node.action.sanitize":"Nettoyer","node.action.rename":"Renommer","node.action.stop":"Arrter","node.action.stopping":"Arrt...","node.action.deleteItem":"Supprimer lment","node.action.detachAndPaste":"Dtacher et Coller","node.action.delete":"Supprimer","node.action.flipImage":"Retourner l'image","node.action.pin":"pingler le nud","node.action.unpin":"Dspingler","node.action.updateDescription":"Mettre  jour la description","node.action.modifyCharacter":"Demander des modifications","node.action.updateDataFormat":"Mettre  jour le format des donnes","node.action.expand169":"tendre  16:9","node.action.expand916":"tendre  9:16","node.action.sync":"Synchroniser depuis les connexions","node.action.expandRatio":"tendre le ratio d'aspect","node.action.markPrimary":"Marquer comme principal","node.action.addCard":"Ajouter une carte","node.action.removeCard":"Retirer la carte","node.action.showOutputs":"Afficher les sorties","node.action.hideOutputs":"Masquer les sorties","node.mediaViewer.play":"Lecture","node.mediaViewer.pause":"Pause","node.mediaViewer.stop":"Arrt","node.mediaViewer.addMarker":"Ajouter marqueur","node.mediaViewer.exportSRT":"Exporter marqueurs (SRT)","node.mediaViewer.deleteAllMarkers":"Tout effacer","node.mediaViewer.saveMarkers":"Sauvegarder marqueurs","node.mediaViewer.loadMarkers":"Charger marqueurs","node.mediaViewer.relink":"Relier fichier","node.content.notePlaceholder":"crivez vos notes ici...","node.content.dropImage":"Dposez une image ou cliquez","node.content.dropMedia":"Dposez une vido ou un audio","node.content.processing":"Traitement...","node.content.processingChain":"Traitement chane...","node.content.metadataPrompt":"Prompt des mtadonnes :","node.content.metadataPromptPlaceholder":"Aucun prompt trouv.","node.content.copyPrompt":"Utiliser","node.content.prompt":"Prompt","node.content.inputPrompt":"Prompt d'entre","node.content.enhancedResult":"Rsultat amlior","node.content.videoPrompt":"Prompt Vido","node.content.editPromptPlaceholder":"Ajouter ou diter le prompt...","node.content.enhancedPromptHere":"Le prompt amlior apparatra ici...","node.content.safePrompt":"Sr pour usage commercial","node.content.generating":"Gnration...","node.content.imageHere":"L'image apparatra ici","node.content.generationMode":"Modle de gnration","node.content.aspectRatio":"Format","node.content.aspectRatioHelp":"Dfinir le format de l'image","node.content.aspectRatioNotSupportedFast":"Format disponible uniquement pour modles Imagen.","node.content.enableAspectRatioFormatting":"Activer le formatage du ratio","node.content.autoDownload":"Auto Tlchargement","node.content.generateImage":"Gnrer Image","node.content.enhancing":"Amlioration...","node.content.enhancePrompt":"Amliorer le prompt","node.content.sanitizing":"Nettoyage...","node.content.sanitizedPromptHere":"Le prompt nettoy apparatra ici...","node.content.analyzing":"Analyse...","node.content.analyzePrompt":"Analyser le prompt","node.content.analyzeImage":"Analyser l'image","node.content.imageToText":"Image vers Texte","node.content.updatePromptFromImage":"Mettre  jour le prompt depuis l'image","node.content.analyzeCharacter":"Analyser Personnage","node.content.generateCharacters":"Gnrer Personnages","node.content.characterPromptPlaceholder":"Dcrivez le(s) personnage(s)...","node.content.character":"Personnage","node.content.clothing":"Vtements","node.content.characterPlaceholder":"Description du personnage ici...","node.content.clothingPlaceholder":"Description des vtements ici...","node.content.appearance":"Apparence","node.content.personality":"Personnalit","node.content.environment":"Environnement","node.content.action":"Action","node.content.emotion":"motion","node.content.style":"Style","node.content.environmentPlaceholder":"Description dtaille de l'environnement...","node.content.charactersPlaceholder":"Liste des personnages principaux...","node.content.characters":"Personnages","node.content.characterConcepts":"Concepts de personnage","node.content.actionPlaceholder":"Description de l'action...","node.content.emotionPlaceholder":"Description de l'motion...","node.content.stylePlaceholder":"Description du style artistique...","node.content.descriptionHere":"La description apparatra ici...","node.content.enableOutpainting":"Activer Outpainting","node.content.outpaintingPromptPlaceholder":"Prompt d'outpainting...","node.content.inputImage":"Images d'entre","node.content.dropOrClick":"Dposer ou Cliquer","node.content.outputImage":"Image de sortie","node.content.applyEdit":"Appliquer","node.content.editing":"dition...","node.content.chatPlaceholder":"Tapez votre message...","node.content.connectedPlaceholder":"Connect  un nud, ditez  la source.","node.content.connectedNode":"Connect via nud","node.content.connectedEmpty":"Le nud connect n'a pas d'image.","node.content.translatePlaceholder":"Texte  traduire...","node.content.translatedTextPlaceholder":"Texte traduit...","node.content.targetLanguage":"Langue cible","node.content.translate":"Traduire","node.content.translating":"Traduction...","node.content.scriptPromptPlaceholder":"Entrez une ide d'histoire...","node.content.generateScript":"Gnrer Scnario","node.content.loadScript":"Charger Scnario","node.content.summary":"Rsum","node.content.scenes":"Scnes","node.content.unrecognizedFormat":"Format de scnario non reconnu.","node.content.frames":"Cadres","node.content.characterIndex":"Index","node.content.readData":"Lire les donnes","node.content.textDataHere":"Les donnes texte apparatront ici.","node.content.noDataRead":'Connectez un nud et cliquez sur "Lire les donnes".',"node.content.previewError":"Erreur Aperu","node.content.previewPlaceholder":"L'aperu apparatra ici","node.content.imagePrompt":"Prompt Image","node.output.allPromptData":"Toutes les donnes","node.note.tab.note":"Note","node.note.tab.references":"Rfrences","node.note.nestedImages":"Images Imbriques","node.note.dropPlaceholder":"Dposez des images","node.note.addCaption":"Lgende","node.note.action.shuffle":"Mlanger","node.note.action.undoShuffle":"Annuler Mlange","node.content.characterTypeShort":"Type:","node.content.numberOfCharactersShort":"Qt:","node.content.characterType.simple":"Simple","node.content.characterType.anthro":"Anthro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Objet Cl","node.content.style.simple":"Simple","node.content.style.realistic":"Raliste","node.content.style.3d_cartoon":"3D Cartoon","node.content.style.3d_realistic":"3D Raliste","node.content.style.2d_animation":"Animation 2D","node.content.style.anime":"Anime","node.content.style.comics":"Comics","node.content.style.custom":"Personnalis","node.content.fullDescriptionTitle":"Description complte du personnage","node.content.integrationInstruction":"Instruction d'intgration","node.content.additionalPromptSuffix":"Prompt Additionnel (Suffixe)","search.node.text_input.title":"Entre de Texte","search.node.text_input.description":"Un champ texte simple.","search.node.image_input.title":"Entre d'Image","search.node.image_input.description":"Charger une image.","search.node.prompt_sequence_editor.title":"diteur Squence Prompts","search.node.prompt_sequence_editor.description":"diter une liste de prompts en masse.","search.node.data_reader.title":"Lecteur de Donnes","search.node.data_reader.description":"Inspecter les donnes brutes d'un nud.","search.node.note.title":"Note","search.node.note.description":"Une note adhsive.","search.node.prompt_processor.title":"Processeur de Prompt","search.node.prompt_processor.description":"Amliore un prompt via IA.","search.node.prompt_analyzer.title":"Analyseur de Prompt","search.node.prompt_analyzer.description":"Dcompose un prompt.","search.node.prompt_sanitizer.title":"Nettoyeur de Prompt","search.node.prompt_sanitizer.description":"Rend le prompt sr pour l'IA.","search.node.character_card.title":"Carte Personnage","search.node.character_card.description":"Info dtaille d'un personnage.","search.node.character_analyzer.title":"Analyseur Personnage","search.node.character_analyzer.description":"Spare apparence et vtements.","search.node.character_generator.title":"Gnrateur Personnage","search.node.character_generator.description":"Cre des personnages depuis un prompt.","search.node.image_analyzer.title":"Analyseur d'Image","search.node.image_analyzer.description":"Dcrit une image.","search.node.image_editor.title":"diteur Image IA","search.node.image_editor.description":"dite des images avec des prompts.","search.node.image_sequence_generator.title":"Gnrateur Squence Image","search.node.image_sequence_generator.description":"Cre des squences d'images.","search.node.gemini_chat.title":"Chat Gemini","search.node.gemini_chat.description":"Discuter avec Gemini.","search.node.translator.title":"Traducteur","search.node.translator.description":"Traduit du texte.","search.node.script_generator.title":"Gnrateur Scnario","search.node.script_generator.description":"Cre un script structur.","search.node.script_viewer.title":"Visualiseur Scnario","search.node.script_viewer.description":"Gre les donnes de scnario.","search.node.note":"Bote de texte simple.","search.node.reroute_dot":"Point pour organiser les cbles.","search.node.video_prompt_processor.title":"Proc. Prompt Vido","search.node.video_prompt_processor.description":"Cre des prompts pour vido.","search.node.video_output.title":"Sortie Vido","search.node.video_output.description":"Gnre une vido avec Veo.","search.node.image_output.title":"Sortie Image","search.node.image_output.description":"Affiche les images gnres.","search.node.media_viewer.title":"Lecteur Multimdia","search.node.media_viewer.description":"Lecteur vido et audio.","search.node.data_protection.title":"Protection Donnes","search.node.data_protection.description":"Mini-jeu Tower Defense.","search.node.pose_creator.title":"Pose Creator","search.node.pose_creator.description":"Visually rig and create character poses for generation guidance.","prompt_sequence_editor.instructionPlaceholder":"Entrez une instruction pour modifier les prompts...","prompt_sequence_editor.modifying":"Modification...","prompt_sequence_editor.modifySelected":"Modifier slection ({count})","prompt_sequence_editor.sourcePrompts":"Prompts Source","prompt_sequence_editor.finalPrompts":"Prompts Modifis","prompt_sequence_editor.error.invalidInput":"Format invalide. Connectez une squence de prompts.","geminiChat.mode.general":"Gnral","geminiChat.mode.prompt":"Expert Prompt","geminiChat.mode.script":"Scnariste","geminiChat.mode.youtube":"Analyste YouTube","image_sequence.deselect_scene":"Dslectionner la scne","image_sequence.clear_prompts_only":"Effacer Textes Uniquement","image_sequence.prev_scene":"Scne Prcdente","image_sequence.next_scene":"Scne Suivante","image_sequence.frames_hidden":"({count} cadres masqus)","image_sequence.frames_count":"({count} cadres)","node.content.modificationRequest":"Demande de modification","node.content.technicalPrompt":"Prompt Technique","node.promptProcessor.safePromptTooltip":"Rcrit le prompt pour se conformer aux consignes de scurit et viter les violations de politique.","node.promptProcessor.technicalPromptTooltip":"Convertit le prompt en une spcification technique hautement dtaille (clairage, camra, paramtres de rendu).","node.promptProcessor.enhanceTooltip":"Utilise l'IA pour tendre et enrichir le prompt avec des dtails descriptifs.","node.promptProcessor.chainTooltip":"Excute ce nud et dclenche tous les nuds connects en aval.","image_sequence.tooltip.autoCrop":"Recadre automatiquement les images gnres au format 16:9.","image_sequence.tooltip.autoDownload":"Enregistre automatiquement chaque image sur votre appareil aprs sa gnration.","image_sequence.tooltip.createZip":"Regroupe toutes les images slectionnes dans une archive ZIP unique lors du tlchargement."},sb={"imageEditor.title":"diteur d'Image","imageEditor.canvasResolution":"Rsolution Canevas","imageEditor.background":"Arrire-plan","imageEditor.toolSettings":"Paramtres Outil","imageEditor.snapToEdges":"Magntisme","imageEditor.freeAspect":"Ratio Libre","imageEditor.section.aiRequest":"Demande Modification IA","imageEditor.input.modificationPlaceholder":'Dcrivez les changements, ex: "fond bleu"',"imageEditor.action.sendRequest":"Envoyer Demande","imageEditor.tooltip.removeObject":"Supprimer (Rouge) / Garder (Vert)","imageEditor.action.removeObject":"Supprimer Objet","imageEditor.tool.transform":"Transformer","imageEditor.tool.hand":"Main (Pan)","imageEditor.tool.zoom":"Zoom","imageEditor.tool.pencil":"Crayon","imageEditor.tool.rectangle":"Rectangle","imageEditor.action.fit":"Ajuster","imageEditor.action.fill":"Remplir","imageEditor.action.cancel":"Annuler","imageEditor.action.resetEdits":"Rinitialiser","imageEditor.action.apply":"Appliquer","imageViewer.title":"Visionneuse","imageEditor.outputResolution":"Rsolution Sortie","imageEditor.outputResolutionHelp":'Dfinir rsolution de sortie. "Auto" utilise le canevas.',"imageEditor.currentSize":"Taille Actuelle : {width}x{height}","imageEditor.sequenceMode":"Mode Squence","imageEditor.sequenceModeHelp":"Traiter les images de l'Entre A squentiellement.","imageEditor.sequentialCombination":"Combinaison Squentielle","imageEditor.sequentialCombinationHelp":"Pour chaque cadre : Envoie image A actuelle + Toutes images B.","imageEditor.sequentialPrompt":"Combinaison Prompt Squentiel","imageEditor.sequentialPromptHelp":"Pour chaque cadre : Utilise un prompt unique de la liste + image actuelle.","imageEditor.sequentialEditingWithPrompts":"dition Squentielle avec Prompts","imageEditor.sequentialEditingWithPromptsHelp":"Pour chaque cadre : Utilise image B + prompt unique. Entre A ignore.","imageEditor.input":"Entre","imageEditor.inputA":"Entre A","imageEditor.inputB":"Entre B","imageEditor.status.queued":"En attente","imageEditor.status.generating":"Gnration...","imageEditor.action.regenerate":"Rgnrer","imageEditor.tooltip.fit":"Ajuster l'image aux limites (contain).","imageEditor.tooltip.fill":"Remplir le canevas (cover).","imageEditor.tooltip.flip":"Retourner horizontalement.","imageEditor.background.white":"Blanc","imageEditor.background.gray":"Gris","imageEditor.background.black":"Noir","imageEditor.background.dark":"Sombre","image_sequence.regenerate":"Rgnrer","image_sequence.stop_queue":"Arrter File","image_sequence.move_up":"Monter","image_sequence.move_down":"Descendre","image_sequence.copy_prompt":"Copier Prompt","image_sequence.add_frame":"Ajouter Cadre","image_sequence.delete_frame":"Supprimer Cadre","image_sequence.expand_all_frames":"Tout Dplier/Replier","image_sequence.collapse_all_frames":"Tout Replier (Cadres)","image_sequence.expand_all_scenes":"Tout Dplier (Scnes)","image_sequence.collapse_all_scenes":"Tout Replier (Scnes)","image_sequence.expand_all":"Tout Dplier","image_sequence.collapse_all":"Tout Replier","image_sequence.clear_all_prompts":"Effacer Tous Prompts","image_sequence.add_first_frame":"Ajouter 1er Cadre","image_sequence.drop_or_add_title":"Dposer JSON ou Ajouter","image_sequence.drop_or_add_desc":"Dposez un fichier JSON ou cliquez pour ajouter.","image_sequence.load_prompts":"Charger Prompts","image_sequence.output_images_title":"Images de Sortie","image_sequence.prompts_list_title":"Prompts Source","image_sequence.download_selected":"Tlcharger Slection","image_sequence.select_all":"Tout Slectionner","image_sequence.select_none":"Dslectionner","image_sequence.invert_selection":"Inverser","image_sequence.run_selected":"Lancer Slection","image_sequence.start_queue":"Lancer File","image_sequence.character_prompt_combination":"Combinaison Prompt Perso","image_sequence.combination_none":"Aucun","image_sequence.combination_combine":"Combiner","image_sequence.combination_replace":"Remplacer Tags","image_sequence.status.error":"Erreur","image_sequence.status.pending":"En attente","image_sequence.clear_selected_prompts":"Effacer Prompts Slectionns","image_sequence.range_from":"De :","image_sequence.range_to":" :","image_sequence.stats.total":"Total : {count}","image_sequence.stats.generated":"Gnrs : {count}","image_sequence.stats.queue":"File : {count}","image_sequence.edit_in_source":"diter Source","image_sequence.edit_prompt":"diter Prompt","image_sequence.select_scene":"Slectionner Scne","image_sequence.next_scene":"Scne Suivante","image_sequence.prev_scene":"Scne Prcdente","image_sequence.scene_input_label":"Scne","image_sequence.select_square":"Carr (1:1)","image_sequence.select_landscape":"Paysage (16:9)","image_sequence.select_portrait":"Portrait (9:16)","image_sequence.select_range":"Slectionner Plage","image_sequence.force_refresh":"Forcer Actualisation","image_sequence.select_scene_frames":"Slectionner toute la scne","image_sequence.collapse_other_scenes":"Replier autres scnes","prompt_sequence_editor.instructionPlaceholder":"Entrez une instruction...","prompt_sequence_editor.modifying":"Modification...","prompt_sequence_editor.modifySelected":"Modifier Slection ({count})","prompt_sequence_editor.sourcePrompts":"Prompts Source","prompt_sequence_editor.finalPrompts":"Prompts Modifis","prompt_sequence_editor.error.invalidInput":"Format invalide.","geminiChat.mode.general":"Gnral","geminiChat.mode.prompt":"Expert Prompt","geminiChat.mode.script":"Scnariste","geminiChat.mode.youtube":"Analyste YouTube","image_sequence.shot_type.WS":"Intgrez l'Entit avec un Plan Large (WS) dans la scne et l'action. Montrez l'environnement.","image_sequence.shot_type.MS":"Intgrez l'Entit avec un Plan Moyen (MS) dans la scne. Personnage de la taille vers le haut.","image_sequence.shot_type.CU":"Intgrez l'Entit avec un Gros Plan (CU) dans la scne.","image_sequence.shot_type.ECU":"Intgrez l'Entit avec un Trs Gros Plan (ECU) dans la scne. Dtails maximum.","image_sequence.shot_type.LS":"Intgrez l'Entit avec un Plan d'Ensemble (LS) dans la scne pour montrer l'chelle."},lb={"dialog.permission.title":"Permission Requise","dialog.permission.description":"Cette application a besoin d'accder au presse-papiers pour coller du contenu dans les nuds. Vos donnes ne sont ni stockes ni envoyes.","dialog.permission.allow":"Autoriser","dialog.permission.decline":"Refuser","dialog.rename.title":"Renommer l'lment","dialog.rename.group.title":"Renommer le groupe","dialog.rename.catalog.title":"Renommer lment catalogue","dialog.rename.node.title":"Renommer le nud","dialog.rename.label":"Nouveau nom :","dialog.rename.confirm":"Renommer","dialog.rename.cancel":"Annuler","dialog.promptEdit.title":"diter le Prompt","dialog.promptEdit.nameLabel":"Nom :","dialog.promptEdit.contentLabel":"Contenu :","dialog.promptEdit.confirm":"Enregistrer","dialog.promptEdit.cancel":"Annuler","dialog.confirmDelete.title":"Confirmer la suppression","dialog.confirmDelete.message":"tes-vous sr de vouloir supprimer cet lment ? Cette action est irrversible.","dialog.confirmDelete.confirm":"Supprimer","dialog.confirmDelete.cancel":"Annuler","dialog.confirmCloseTab.title":"Fermer l'onglet","dialog.confirmCloseTab.message":`Voulez-vous vraiment fermer l'onglet "{tabName}" ? Les changements non sauvegards seront perdus.`,"dialog.confirmClear.title":"Effacer le canevas","dialog.confirmClear.message":"Voulez-vous vraiment tout effacer ? Cette action est irrversible.","dialog.confirmReset.title":"Rinitialiser","dialog.confirmReset.message":"Voulez-vous remettre le canevas  l'tat par dfaut ? Tout travail actuel sera perdu.","dialog.confirmReset.confirm":"Rinitialiser","dialog.confirmLoad.title":"Confirmer le chargement","dialog.confirmLoad.message":"Charger un fichier remplacera le contenu actuel. Les changements non sauvegards seront perdus. Continuer ?","dialog.apiKey.title":"Slectionner Cl API","dialog.apiKey.description":'Cette fonction ncessite une cl API Projet avec "AI Platform" activ. La gnration vido peut prendre quelques minutes.',"dialog.apiKey.billingLink":"En savoir plus sur la facturation","dialog.apiKey.button":"Slectionner Cl API","dialog.settings.title":"Paramtres","dialog.settings.apiKeyLabel":"Votre Cl API Google Gemini :","dialog.settings.useDevKeyLabel":"Utiliser la cl gratuite (dveloppement)","dialog.settings.instantNodeCloseLabel":"Fermeture instantane des nuds","dialog.settings.nodeAnimationLabel":"Animation d'ajout de nud","dialog.settings.animationModeLabel":"Mode d'animation de cration","dialog.settings.anim.pulse":"Pulsion","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"Aucune","dialog.settings.description":"Pour utiliser vos propres quotas et accder  des modles spcifiques, entrez votre cl API personnelle. Elle est stocke localement.","dialog.settings.getKeyLink":"Obtenir une cl API ici","dialog.settings.save":"Enregistrer","dialog.deleteNode.title":"Fermer le nud ?","dialog.deleteNode.titlePlural":"Fermer les nuds ?","dialog.deleteNode.confirm":"Oui","dialog.deleteNode.cancel":"Non","dialog.deleteNode.confirmTooltip":"Fermer le nud - les donnes perdues ne peuvent pas tre rcupres","dialog.deleteNode.cancelTooltip":"Ne pas fermer - continuer  travailler","dialog.deleteNode.dontShowAgain":"Ne plus afficher","dialog.exitApp.title":"Fermer le projet ?","dialog.exitApp.message":"Voulez-vous vraiment fermer le projet ? Tout travail actuel sera perdu et le canevas sera rinitialis."},cb={"group.button.create":"Crer un groupe ({count})","group.rename":"Renommer le groupe","group.saveToCatalog":"Sauver dans le catalogue","group.saveToDisk":"Sauver sur le disque","group.ungroup":"Dgrouper (Shift+Clic pour tout supprimer)","group.duplicate":"Dupliquer avec contenu","catalog.tabs.groups":"Groupes","catalog.tabs.library":"Bibliothque","catalog.tabs.characters":"Personnages","catalog.tabs.scripts":"Scnarios","catalog.tabs.sequences":"Squences","catalog.back":"Retour","catalog.load":"Charger un fichier","catalog.newFolder":"Nouveau Dossier","catalog.saveTo":"Sauver dans le catalogue","catalog.card.addToCanvas":"Ajouter au canevas","catalog.card.rename":"Renommer","catalog.card.save":"Sauvegarder","catalog.card.delete":"Supprimer","catalog.empty.description":"Ce dossier est vide. Ajoutez des lments ou crez des dossiers.","library.loadFromFile":"Charger","library.actions.newFolder":"Nouveau Dossier","library.actions.newPrompt":"Nouveau Prompt","library.actions.copy":"Copier","library.actions.edit":"diter","library.empty.title":"Dossier Vide","library.empty.description":"Crez des prompts et des dossiers pour commencer.","library.emptyPrompt":"Prompt vide"},db={...rb,...ab,...ib,...sb,...lb,...cb},ub={"app.title":"Prompt Modifier","app.subtitle":"Verbinden Sie Ideen, um ein Meisterwerk zu schaffen","app.error.title":"Benachrichtigung","app.error.copy":"Nachricht kopieren","app.error.copied":"Kopiert!","error.apiKey":"Ihr API-Schlssel ist ungltig oder hat keine Berechtigungen. Bitte whlen Sie einen gltigen API-Schlssel.","error.scriptModifierCanvas":"Diese Leinwand gehrt zu einer anderen Anwendung - Script Modifier. Bitte verwenden Sie Script Modifier, um diese Datei zu ffnen.","welcome.title":"Willkommen bei","welcome.description":"Willkommen beim Prompt Modifier. Verbinden Sie Ideen, um Meisterwerke zu schaffen. Verwenden Sie Knoten, um Inhalte zu generieren und zu bearbeiten.","welcome.apiKeyLabel":"Ihr Google Gemini API-Schlssel","welcome.apiKeyPlaceholder":"Geben Sie hier Ihren API-Schlssel ein...","welcome.apiKeyHelp":"Ihr API-Schlssel wird lokal gespeichert.","welcome.getKeyLink":"API-Schlssel erhalten","welcome.iAmDeveloper":"Ich bin Entwickler","welcome.letsGo":"Los geht's","welcome.resume":"Fortsetzen","welcome.startNew":"Neue Leinwand","welcome.freeModeActive":"Kostenloser Modus aktiv","welcome.selectLanguage":"Whlen Sie Ihre Hauptsprache","welcome.navHint":"Verwenden Sie die Tastaturtasten  und , um die Sprache zu ndern","toast.contentCleared":"Inhalt gelscht","toast.downloadStarted":"Download gestartet","toast.characterLoaded":"Charakterkarte geladen","toast.characterSavedDisk":"Charakterkarte auf Festplatte gespeichert","toast.copiedToClipboard":"In die Zwischenablage kopiert","toast.pastedFromClipboard":"Aus der Zwischenablage eingefgt","toast.pasteFailed":"Einfgen fehlgeschlagen","toast.nodeDuplicated":"Knoten dupliziert","toast.groupSavedToDisk":'Gruppe "{groupTitle}" auf Festplatte gespeichert',"toast.groupDeleted":"Gruppe und Inhalt gelscht","toast.characterSavedCatalog":"Charakter im Katalog gespeichert","toast.promptSaved":"Prompt in Bibliothek gespeichert: {promptName}...","toast.connectionsCut":"Verbindungen getrennt","toast.apiKeySaved":"API-Schlssel erfolgreich gespeichert","toast.cacheCleared":"{count} ungenutzte Elemente aus dem Cache gelscht","toast.cacheEmpty":"Cache ist bereits optimiert","toast.scriptSaved":"Skript auf Festplatte gespeichert","alert.groupSaved":'Gruppe "{groupTitle}" im Katalog gespeichert.',"alert.loadCatalogFailed":"Laden der Katalogdatei fehlgeschlagen","alert.invalidCatalogFile":"Ungltiges Katalogdateiformat","alert.fileNotSupported":'Datei nicht untersttzt. "appName" fehlt oder ist falsch.',"alert.invalidCatalogStructure":'Ungltige Katalogstruktur. "root" fehlt.',"tutorial.step1":"Klicken Sie hier, um dem Prompt ein zuflliges Wort hinzuzufgen.","tutorial.step2":'Klicken Sie auf "Prompt verbessern", um Eingaben mithilfe von KI zu kombinieren.',"tutorial.step2_waiting":"Die KI analysiert Ihre Eingaben und generiert einen reichhaltigeren Prompt...","tutorial.step3":"Klicken Sie schlielich hier, um das Bild zu generieren.","tutorial.step3b":"Die Generierung dauert einige Zeit. Sie knnen den Fortschritt hier berwachen.","tutorial.step4":"Sie knnen neue Knoten manuell ber diese Symbolleiste hinzufgen.","tutorial.group.catalog":"Verwenden Sie den Katalog, um nach Knoten zu suchen oder Gruppen zu verwalten.","tutorial.group.general":"Fgen Sie Haftnotizen und Datenleser zum Debuggen hinzu.","tutorial.group.input":"Grundlegende Eingaben fr Text, Bilder und Sequenzen.","tutorial.group.processing":"Analysieren und verarbeiten Sie Prompts oder Bilder mit KI.","tutorial.group.character":"Erstellen, analysieren und speichern Sie detaillierte Charaktere.","tutorial.group.output":"Ergebnisse anzeigen und Sequenzen generieren.","tutorial.group.ai":"Chatten Sie mit Gemini und bersetzen Sie Text.","tutorial.group.video":"Tools fr Videoprompts und Bearbeitung.","tutorial.group.scripts":"Generieren und betrachten Sie Skripte fr komplexe Geschichten.","tutorial.group.file":"Speichern Sie Ihre Arbeit, laden Sie Projekte oder laden Sie die Leinwand herunter.","tutorial.success.title":"Tutorial abgeschlossen!","tutorial.success.message":"Sie haben die Grundlagen von Prompt Modifier erfolgreich erlernt. Viel Glck beim Erstellen von Meisterwerken!","tutorial.success.button":"Erstellen beginnen","tutorial.skip":"berspringen","tutorial.next":"Weiter","tutorial.finish":"Verstanden"},pb={"toolbar.settings":"Einstellungen","toolbar.resetCanvas":"Leinwand zurcksetzen","toolbar.clearCache":"Ungenutzten Cache leeren","toolbar.home":"Startseite","toolbar.edit":"Bearbeiten (V)","toolbar.cutter":"Verbindung trennen (C) / (Strg halten)","toolbar.selection":"Auswahl (S) / (Umschalt halten)","toolbar.reroute":"Umlenken (R) / (Strg+Alt halten)","toolbar.zoom":"Zoom (Z halten)","toolbar.snapToGrid":"Am Raster ausrichten","toolbar.smartGuides":"Intelligente Hilfslinien","toolbar.lineStyleSpaghetti":"Spaghetti-Linien","toolbar.lineStyleOrthogonal":"Orthogonale Linien","toolbar.resetZoom":"Zoom zurcksetzen","toolbar.resetCamera":"Kameraposition zurcksetzen","toolbar.clearCanvas":"Leinwand leeren","toolbar.addNode":"Knoten hinzufgen (F)","toolbar.catalog":"Katalog ffnen (Strg + Leertaste)","toolbar.addNote":"Notiz hinzufgen (N)","toolbar.addDataReader":"Datenleser hinzufgen (Umschalt + R)","toolbar.addTextInput":"Texteingabe hinzufgen (T)","toolbar.addImageInput":"Bildeingabe hinzufgen (I)","toolbar.addPromptSequenceEditor":"Prompt-Sequenz-Editor hinzufgen (Q)","toolbar.addImageAnalyzer":"Bildanalysator hinzufgen (Umschalt+A)","toolbar.addPromptAnalyzer":"Prompt-Analysator hinzufgen (A)","toolbar.addPromptProcessor":"Prompt-Prozessor hinzufgen (P)","toolbar.addCharacterGenerator":"Charaktergenerator hinzufgen (Umschalt+C)","toolbar.addCharacterAnalyzer":"Charakteranalysator hinzufgen (Strg+Umschalt+A)","toolbar.addCharacterCard":"Charakterkarte hinzufgen (Strg+Umschalt+C)","toolbar.addImageOutput":"Bildausgabe hinzufgen (O)","toolbar.addImageEditor":"KI-Bildeditor hinzufgen (Umschalt+I)","toolbar.addImageSequenceGenerator":"Bildsequenz-Generator hinzufgen (Umschalt+Q)","toolbar.addTranslator":"bersetzer hinzufgen (L)","toolbar.addGeminiChat":"Gemini Chat hinzufgen (M)","toolbar.addVideoPromptProcessor":"Video-Prompt-Prozessor hinzufgen (Umschalt+P)","toolbar.addVideoOutput":"Videoausgabe hinzufgen (Umschalt+O)","toolbar.addScriptGenerator":"Skriptgenerator hinzufgen","toolbar.addScriptViewer":"Skript-Viewer hinzufgen (Umschalt + V)","toolbar.saveCanvas":"Leinwand speichern (Strg + S)","toolbar.saveProject":"Projekt speichern","toolbar.loadCanvas":"Projekt/Leinwand laden (Strg + O)","toolbar.group.general":"Allgemein","toolbar.group.catalog":"Katalog","toolbar.group.input":"Eingabe","toolbar.group.processing":"Verarbeitung","toolbar.group.character":"Charakter","toolbar.group.output":"Ausgabe","toolbar.group.aiTools":"KI-Tools","toolbar.group.video":"Video","toolbar.group.scripts":"Skripte","toolbar.group.file":"Datei","toolbar.title":"Symbolleiste","toolbar.dock":"Leiste andocken","toolbar.detach":"Leiste lsen","toolbar.expandPanel":"Panel erweitern","toolbar.collapsePanel":"Panel einklappen","toolbar.dockArea.title":"Leiste hier andocken","toolbar.duplicate":"Knoten duplizieren","toolbar.duplicateWithContent":"Mit Inhalt duplizieren","toolbar.dock.q1":"Links 1. Vtl.","toolbar.dock.q2":"Links 2. Vtl.","toolbar.dock.q3":"Rechts 3. Vtl.","toolbar.dock.q4":"Rechts 4. Vtl.","toolbar.dock.tl":"Oben Links","toolbar.dock.bl":"Unten Links","toolbar.dock.tr":"Oben Rechts","toolbar.dock.br":"Unten Rechts","toolbar.dock.left":"Linke Hlfte","toolbar.dock.right":"Rechte Hlfte","toolbar.dock.full":"Vollbild","toolbar.dock.exitFull":"Vollbild beenden","toolbar.dock.fullFocus":"Vollbild-Fokus","hotkeys.show":"Tastenkrzel anzeigen","hotkeys.tools.title":"Werkzeuge","hotkeys.tools.edit":"Bearbeitungsmodus","hotkeys.tools.cutter":"Schneidewerkzeug","hotkeys.tools.selection":"Auswahlwerkzeug","hotkeys.tools.reroute":"Umlenkwerkzeug","hotkeys.tools.zoom":"Zoom-Werkzeug","hotkeys.tools.toggleLineStyle":"Linienstil umschalten","hotkeys.tools.group":"Gruppenauswahl","hotkeys.tools.closeNode":"Auswahl lschen","hotkeys.tools.duplicate":"Knoten duplizieren","hotkeys.tools.duplicateWithContent":"Mit Inhalt duplizieren","hotkeys.tools.deleteGroup":"Gruppe lschen (Umschalt+Klick)","hotkeys.windows.title":"Fenster","hotkeys.windows.search":"Schnellsuche","hotkeys.windows.catalog":"Katalog","hotkeys.createNode.title":"Knoten erstellen","help.panelTitle":"Hilfe & Tastenkrzel","help.title":"Tastaturkrzel","help.howToUse.title":"Verwendung","help.howToUse.content":"Willkommen bei Prompt Modifier! Verwenden Sie die Symbolleiste oder Tastenkrzel, um Knoten hinzuzufgen. Verbinden Sie Knoten, um Daten zu bertragen. Verwenden Sie das Bearbeitungswerkzeug, um Knoten zu verschieben und die Leinwand zu schwenken. Doppelklicken Sie auf einen leeren Bereich, um das Schnellmen zu ffnen. Rechtsklick fr das Kontextmen.","help.author":"Autor","contextMenu.undoPosition":"Position rckgngig","contextMenu.redoPosition":"Position wiederherstellen","contextMenu.align.left":"Links ausrichten (F)","contextMenu.align.centerX":"Zentrieren X (E)","contextMenu.align.right":"Rechts ausrichten (R)","contextMenu.align.top":"Oben ausrichten (T)","contextMenu.align.centerY":"Zentrieren Y (D)","contextMenu.align.bottom":"Unten ausrichten (B)","contextMenu.distribute.horizontal":"Horiz. verteilen (Strg+D)","contextMenu.distribute.vertical":"Vert. verteilen (Strg+E)","contextMenu.emptySlot":"Leerer Slot (Rechtsklick zum Zuweisen)","contextMenu.saveSlots":"Slots speichern","contextMenu.loadSlots":"Slots laden","quickadd.title":"Schnell hinzufgen","quickadd.group.tools":"Werkzeuge","quickadd.group.inputs":"Eingaben","quickadd.group.processing":"Verarbeitung","quickadd.group.character":"Charakter","quickadd.group.outputs":"Ausgaben","quickadd.group.ai":"KI-Tools","quickadd.group.video":"Video","quickadd.group.scripts":"Skripte","quickadd.group.general":"Allgemein","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"Bearbeiten","quickadd.tool.cutter":"Schneiden","quickadd.tool.selection":"Auswahl","search.placeholder":"Knoten suchen...","search.noResults":"Keine Knoten gefunden.","search.group.input":"Eingabe & Basis","search.group.process":"Verarbeitung & Charakter","search.group.output":"Bild & Sequenz","search.group.ai":"KI-Tools","search.group.video":"Video & Skript","search.group.scripts":"Skripte","toolbar.exitApp":"Projekt schlieen"},hb={"node.title.text_input":"Texteingabe","node.title.image_input":"Bildeingabe","node.title.prompt_processor":"Prompt-Prozessor","node.title.prompt_sanitizer":"Prompt-Bereiniger","node.title.video_prompt_processor":"Video-Prompt-Prozessor","node.title.image_output":"Bildausgabe","node.title.video_output":"Videoausgabe","node.title.prompt_analyzer":"Prompt-Analysator","node.title.character_analyzer":"Charakter-Analysator","node.title.character_generator":"Charakter-Generator","node.title.character_card":"Charakterkarte","node.title.image_analyzer":"Bildanalysator","node.title.image_editor":"KI-Bildeditor","node.title.image_sequence_generator":"Bildsequenz-Generator","node.title.prompt_sequence_editor":"Prompt-Sequenz-Editor","node.title.gemini_chat":"Gemini Chat","node.title.translator":"bersetzer","node.title.script_generator":"Skript-Generator","node.title.script_viewer":"Skript-Viewer","node.title.note":"Notiz","node.title.reroute_dot":"Umlenkpunkt","node.title.data_reader":"Datenleser","node.title.video_editor":"Video-Editor Alpha","node.title.media_viewer":"Media Viewer","node.title.data_protection":"Datenschutz","node.title.pose_creator":"Pose Creator","node.help.text_input":"Ein einfaches mehrzeiliges Textfeld zur Eingabe von Prompts oder Notizen.","node.help.image_input":"Ermglicht das Hochladen oder Einfgen eines Bildes zur Verwendung als Eingabe fr andere Knoten.","node.help.prompt_processor":"Kombiniert mehrere Texteingaben zu einem einzigen, verbesserten Prompt mithilfe von KI.","node.help.prompt_sanitizer":"Schreibt den Eingabe-Prompt um, damit er sicherer fr Bildgenerierungsrichtlinien ist.","node.help.video_prompt_processor":"Spezialisierter Prozessor zum Erstellen detaillierter Videogenerierungs-Prompts.","node.help.image_output":"Zeigt das Ergebnis der Bildgenerierung an. Untersttzt das Herunterladen und Anzeigen.","node.help.video_output":"Zeigt das Ergebnis der Videogenerierung mit dem Veo-Modell an.","node.help.prompt_analyzer":"Zerlegt einen Prompt in Komponenten wie Subjekt, Stil und Umgebung.","node.help.character_analyzer":"Analysiert eine Charakterbeschreibung und teilt sie in Aussehen und Kleidung auf.","node.help.character_generator":"Generiert detaillierte Charakterbeschreibungen basierend auf einem kurzen Prompt.","node.help.character_card":"Speichert umfassende Charakterdaten einschlielich Bild und Beschreibung.","node.help.image_analyzer":"Verwendet KI, um den Inhalt eines Eingabebildes zu beschreiben.","node.help.image_editor":"Erweitertes Tool zum Bearbeiten von Bildern mit Text-Prompts und Inpainting/Outpainting.","node.help.image_sequence_generator":"Generiert eine Bildsequenz basierend auf einer Liste von Prompts.","node.help.prompt_sequence_editor":"Ermglicht die Massenbearbeitung von Prompt-Sequenzen mithilfe von KI-Anweisungen.","node.help.gemini_chat":"Eine universelle Chat-Schnittstelle mit Gemini fr Brainstorming oder Untersttzung.","node.help.translator":"bersetzt Text zwischen Sprachen mithilfe von KI-Modellen.","node.help.script_generator":"Generiert ein strukturiertes Skript (Szenen, Charaktere) aus einer Story-Idee.","node.help.script_viewer":"Visualisiert und verwaltet Skriptdaten fr die bildweise Generierung.","node.help.note":"Eine Haftnotiz zum Hinzufgen von Kommentaren oder Anweisungen auf der Leinwand.","node.help.reroute_dot":"Ein kleiner Punkt, um Verbindungen zu organisieren und sauberere Layouts zu erstellen.","node.help.data_reader":"Debug-Tool zum berprfen der Rohdaten, die durch Verbindungen flieen.","node.help.video_editor":"Ein zeitleistenbasiertes Tool zum Bearbeiten von Videoclips und Bildern.","node.help.media_viewer":"Ein Player zum Anzeigen von Video- und Audiodateien mit Wiedergabesteuerung.","node.help.data_protection":"Ein interaktives Tower-Defense-Spiel-Knoten. Verteidigen Sie Ihre Daten.","node.help.pose_creator":"Visual rig to define and generate character poses for consistency.","node.action.expand":"Erweitern","node.action.collapse":"Einklappen","node.action.help":"Hilfe","node.action.download":"Herunterladen","node.action.clear":"Inhalt lschen","node.action.refreshChat":"Chat leeren und neu starten","node.action.paste":"Einfgen","node.action.resetEditor":"Editor zurcksetzen","node.action.saveCharacter":"Karte speichern","node.action.loadCharacter":"Karte laden","node.action.copy":"Kopieren","node.action.copyImage":"Bild kopieren","node.action.copyTextPrompt":"Prompt kopieren","node.action.copyImagePrompt":"Bild-Prompt kopieren","node.action.copyVideoPrompt":"Video-Prompt kopieren","node.action.cutConnections":"Verbindungen trennen","node.action.close":"Schlieen","node.action.closeNode":"Knoten schlieen (Umschalt+Klick fr sofort)","node.action.closeNodeSimple":"Knoten schlieen","node.action.randomWord":"Zuflliges Wort","node.action.processImage":"Wasserzeichen entfernen","node.action.processImageTitle":"Verwendet Gemini, um Wasserzeichen und Text aus dem Bild zu entfernen.","node.action.editor":"Editor","node.action.rasterEditor":"Raster-Editor","node.action.openInAIEditor":"In KI-Editor ffnen","node.action.openInAnalyzer":"In Analysator ffnen","node.action.outputToInput":"Ausgabe als Eingabe","node.action.processChainForward":"Vorwrts verarbeiten","node.action.executeChain":"Kette ausfhren","node.action.executeChainTitle":"Fhrt alle vorgelagerten Knoten aus, um das Endergebnis zu generieren.","node.action.sanitize":"Bereinigen","node.action.rename":"Umbenennen","node.action.stop":"Stopp","node.action.stopping":"Stoppen...","node.action.deleteItem":"Element lschen","node.action.detachAndPaste":"Lsen und Einfgen","node.action.delete":"Lschen","node.action.flipImage":"Bild spiegeln","node.action.pin":"Knoten anpinnen","node.action.unpin":"Knoten lsen","node.mediaViewer.play":"Abspielen","node.mediaViewer.pause":"Pause","node.mediaViewer.stop":"Stopp","node.mediaViewer.addMarker":"Marker hinzufgen","node.mediaViewer.exportSRT":"Marker exportieren (SRT)","node.mediaViewer.deleteAllMarkers":"Alle Marker lschen","node.mediaViewer.saveMarkers":"Marker speichern","node.mediaViewer.loadMarkers":"Marker laden","node.mediaViewer.relink":"Datei neu verknpfen","node.content.notePlaceholder":"Schreiben Sie Ihre Notizen hier...","node.content.dropImage":"Bild hier ablegen oder klicken zum Hochladen","node.content.dropMedia":"Video oder Audio hier ablegen","node.content.processing":"Verarbeitung...","node.content.processingChain":"Kette wird verarbeitet...","node.content.metadataPrompt":"Prompt aus Bildmetadaten:","node.content.metadataPromptPlaceholder":"Kein Prompt im Bild gefunden.","node.content.copyPrompt":"Verwenden","node.content.prompt":"Prompt","node.content.inputPrompt":"Eingabe-Prompt","node.content.enhancedResult":"Verbessertes Ergebnis","node.content.videoPrompt":"Video-Prompt","node.content.editPromptPlaceholder":"Fgen Sie dem Prompt hinzu oder bearbeiten Sie ihn...","node.content.enhancedPromptHere":"Verbesserter Prompt erscheint hier...","node.content.safePrompt":"Sicher fr kommerzielle Nutzung","node.content.generating":"Generierung...","node.content.imageHere":"Bild erscheint hier","node.content.generationMode":"Generierungsmodell","node.content.aspectRatio":"Seitenverhltnis","node.content.aspectRatioHelp":"Seitenverhltnis fr die Bildgenerierung festlegen","node.content.aspectRatioNotSupportedFast":"Seitenverhltnis nur fr Imagen-Modelle verfgbar.","node.content.enableAspectRatioFormatting":"Seitenverhltnis-Formatierung aktivieren","node.content.autoDownload":"Autom. Download","node.content.generateImage":"Bild generieren","node.content.enhancing":"Verbesserung...","node.content.enhancePrompt":"Prompt verbessern","node.content.sanitizing":"Bereinigung...","node.content.sanitizedPromptHere":"Bereinigter Prompt erscheint hier...","node.content.analyzing":"Analyse...","node.content.analyzePrompt":"Prompt analysieren","node.content.analyzeImage":"Bild analysieren","node.content.imageToText":"Bild zu Text","node.content.updatePromptFromImage":"Prompt aus Bild aktualisieren","node.content.analyzeCharacter":"Charakter analysieren","node.content.generateCharacters":"Charaktere generieren","node.content.characterPromptPlaceholder":"Beschreiben Sie den/die Charakter(e)...","node.content.character":"Charakter","node.content.clothing":"Kleidung","node.content.characterPlaceholder":"Charakterbeschreibung erscheint hier...","node.content.clothingPlaceholder":"Kleidungsbeschreibung erscheint hier...","node.content.appearance":"Aussehen","node.content.personality":"Persnlichkeit","node.content.environment":"Umgebung/Setting","node.content.action":"Handlung","node.content.emotion":"Emotion","node.content.style":"Stil","node.content.environmentPlaceholder":"Detaillierte Beschreibung der Umgebung...","node.content.charactersPlaceholder":"Liste der Hauptcharaktere...","node.content.characters":"Charaktere","node.content.characterConcepts":"Charakterkonzepte","node.content.actionPlaceholder":"Beschreibung der Handlung...","node.content.emotionPlaceholder":"Beschreibung der Emotion...","node.content.stylePlaceholder":"Beschreibung des Kunststils...","node.content.descriptionHere":"Beschreibung erscheint hier...","node.content.enableOutpainting":"Outpainting aktivieren","node.content.outpaintingPromptPlaceholder":"Outpainting-Prompt...","node.content.inputImage":"Eingabebilder","node.content.dropOrClick":"Ablegen oder Klicken","node.content.outputImage":"Ausgabebild","node.content.applyEdit":"Bearbeitung anwenden","node.content.editing":"Bearbeitung...","node.content.chatPlaceholder":"Geben Sie Ihre Nachricht ein...","node.content.connectedPlaceholder":"Mit Knoten verbunden, in Quelle bearbeiten.","node.content.connectedNode":"ber Knoten verbunden","node.content.connectedEmpty":"Verbundener Knoten hat kein Bild.","node.content.translatePlaceholder":"Text zum bersetzen...","node.content.translatedTextPlaceholder":"bersetzter Text...","node.content.targetLanguage":"Zielsprache","node.content.translate":"bersetzen","node.content.translating":"bersetzung...","node.content.scriptPromptPlaceholder":"Geben Sie eine Story-Idee oder einen Plot ein...","node.content.generateScript":"Skript generieren","node.content.loadScript":"Skriptdatei laden","node.content.summary":"Zusammenfassung","node.content.scenes":"Szenen","node.content.unrecognizedFormat":"Nicht erkanntes Skriptformat.","node.content.frames":"Frames","node.content.characterIndex":"Index","node.content.readData":"Daten lesen","node.content.textDataHere":"Textdaten erscheinen hier.","node.content.noDataRead":'Verbinden Sie einen Knoten und klicken Sie auf "Daten lesen".',"node.content.previewError":"Vorschaufehler","node.content.previewPlaceholder":"Vorschau erscheint hier","node.content.imagePrompt":"Bild-Prompt","node.output.allPromptData":"Alle Prompt-Daten","node.note.tab.note":"Notiz","node.note.tab.references":"Referenzen","node.note.nestedImages":"Verschachtelte Bilder","node.note.dropPlaceholder":"Bilder ablegen oder klicken","node.note.addCaption":"Bildunterschrift","node.note.action.shuffle":"Mischen","node.note.action.undoShuffle":"Mischen rckgngig machen","node.content.characterTypeShort":"Typ:","node.content.numberOfCharactersShort":"Menge:","node.content.characterType.simple":"Einfach","node.content.characterType.anthro":"Anthro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Schlsselobjekt","node.content.style.simple":"Einfach","node.content.style.realistic":"Realistisch","node.content.style.3d_cartoon":"3D Cartoon","node.content.style.3d_realistic":"3D Realistisch","node.content.style.2d_animation":"2D Animation","node.content.style.anime":"Anime","node.content.style.comics":"Comics","node.content.style.custom":"Benutzerdefiniert","node.content.fullDescriptionTitle":"Detaillierte Charakterbeschreibung","node.content.integrationInstruction":"Integrationsanweisung","node.content.additionalPromptSuffix":"Zustzlicher Prompt (Suffix)","image_sequence.auto_crop":"Autom. Zuschnitt 16:9","image_sequence.create_zip":"ZIP-Archiv erstellen","node.content.modificationRequest":"nderungsanfrage","node.content.technicalPrompt":"Technischer Prompt","node.promptProcessor.safePromptTooltip":"Schreibt den Prompt um, um die Sicherheitsrichtlinien einzuhalten und Richtlinienverste zu vermeiden.","node.promptProcessor.technicalPromptTooltip":"Wandelt den Prompt in eine hochdetaillierte technische Spezifikation um (Beleuchtung, Kamera, Rendereinstellungen).","node.promptProcessor.enhanceTooltip":"Nutzt KI, um den Prompt mit beschreibenden Details zu erweitern und anzureichern.","node.promptProcessor.chainTooltip":"Fhrt diesen Knoten aus und lst alle verbundenen nachgelagerten Knoten aus.","image_sequence.tooltip.autoCrop":"Schneidet generierte Bilder automatisch auf ein Seitenverhltnis von 16:9 zu.","image_sequence.tooltip.autoDownload":"Speichert jedes Bild sofort nach der Generierung automatisch auf Ihrem Gert.","image_sequence.tooltip.createZip":"Packt alle ausgewhlten Bilder beim Herunterladen in ein einziges ZIP-Archiv."},mb={"imageEditor.title":"Bildeditor","imageEditor.canvasResolution":"Leinwandauflsung","imageEditor.background":"Hintergrund","imageEditor.toolSettings":"Werkzeugeinstellungen","imageEditor.snapToEdges":"An Rndern ausrichten","imageEditor.freeAspect":"Freies Seitenverhltnis","imageEditor.section.aiRequest":"KI-nderungsanfrage","imageEditor.input.modificationPlaceholder":'Beschreiben Sie nderungen, z.B. "Hintergrund blau machen"',"imageEditor.action.sendRequest":"Anfrage senden","imageEditor.tooltip.removeObject":"Entfernen (Rot) / Behalten (Grn)","imageEditor.action.removeObject":"Objekt entfernen","imageEditor.tool.transform":"Transformieren","imageEditor.tool.hand":"Hand (Schwenken)","imageEditor.tool.zoom":"Zoom","imageEditor.tool.pencil":"Stift","imageEditor.tool.rectangle":"Rechteck","imageEditor.action.fit":"An Leinwand anpassen","imageEditor.action.fill":"Leinwand fllen","imageEditor.action.cancel":"Abbrechen","imageEditor.action.resetEdits":"nderungen zurcksetzen","imageEditor.action.apply":"Anwenden","imageViewer.title":"Bildbetrachter","imageEditor.outputResolution":"Ausgabeauflsung","imageEditor.outputResolutionHelp":'Ausgabeauflsung festlegen. Bei "Auto" wird die Leinwandauflsung verwendet.',"imageEditor.currentSize":"Aktuelle Gre: {width}x{height}","imageEditor.sequenceMode":"Sequenzmodus","imageEditor.sequenceModeHelp":"Eingabebilder von Eingang A sequenziell verarbeiten.","imageEditor.sequentialCombination":"Sequenzielle Bildkombination","imageEditor.sequentialCombinationHelp":"Fr jeden Frame: Sendet aktuelles Bild A + Alle Bilder B.","imageEditor.sequentialPrompt":"Sequenzielle Prompt-Kombination","imageEditor.sequentialPromptHelp":"Fr jeden Frame: Verwendet einen eindeutigen Prompt aus der Liste + aktuelles Bild.","imageEditor.sequentialEditingWithPrompts":"Sequenzielle Bearbeitung mit Prompts","imageEditor.sequentialEditingWithPromptsHelp":"Fr jeden Frame: Verwendet Bild B + eindeutigen Prompt. Eingang A wird ignoriert.","imageEditor.input":"Eingang","imageEditor.inputA":"Eingang A","imageEditor.inputB":"Eingang B","imageEditor.status.queued":"In Warteschlange","imageEditor.status.generating":"Generierung...","imageEditor.action.regenerate":"Neu generieren","imageEditor.tooltip.fit":"Bild in Leinwand einpassen (contain).","imageEditor.tooltip.fill":"Bild skalieren, um Leinwand zu fllen (cover).","imageEditor.tooltip.flip":"Bild horizontal spiegeln.","imageEditor.background.white":"Wei","imageEditor.background.gray":"Grau","imageEditor.background.black":"Schwarz","imageEditor.background.dark":"Dunkel","image_sequence.regenerate":"Neu generieren","image_sequence.stop_queue":"Warteschlange stoppen","image_sequence.move_up":"Nach oben","image_sequence.move_down":"Nach unten","image_sequence.copy_prompt":"Prompt kopieren","image_sequence.add_frame":"Frame hinzufgen","image_sequence.delete_frame":"Frame lschen","image_sequence.expand_all_frames":"Alle Frames erweitern/einklappen","image_sequence.collapse_all_frames":"Alle Frames einklappen","image_sequence.expand_all_scenes":"Alle Szenen erweitern/einklappen","image_sequence.collapse_all_scenes":"Alle Szenen einklappen","image_sequence.expand_all":"Alles erweitern","image_sequence.collapse_all":"Alles einklappen","image_sequence.clear_all_prompts":"Alle Prompts lschen","image_sequence.add_first_frame":"Ersten Frame hinzufgen","image_sequence.drop_or_add_title":"Sequenz-JSON ablegen oder Frame hinzufgen","image_sequence.drop_or_add_desc":"Legen Sie hier eine JSON-Datei ab oder klicken Sie auf die Schaltflche, um manuell einen Frame hinzuzufgen.","image_sequence.load_prompts":"Prompts laden","image_sequence.output_images_title":"Ausgabebilder","image_sequence.prompts_list_title":"Quell-Prompts","image_sequence.download_selected":"Auswahl herunterladen","image_sequence.select_all":"Alle auswhlen","image_sequence.select_none":"Keine auswhlen","image_sequence.invert_selection":"Auswahl umkehren","image_sequence.run_selected":"Auswahl ausfhren","image_sequence.start_queue":"Warteschlange starten","image_sequence.character_prompt_combination":"Charakter-Prompt-Kombination","image_sequence.combination_none":"Keine","image_sequence.combination_combine":"Kombinieren","image_sequence.combination_replace":"Tags ersetzen","image_sequence.status.error":"Fehler","image_sequence.status.pending":"In Warteschlange","image_sequence.clear_selected_prompts":"Ausgewhlte Prompts lschen","image_sequence.range_from":"Von:","image_sequence.range_to":"Bis:","image_sequence.stats.total":"Gesamt Frames: {count}","image_sequence.stats.generated":"Generiert: {count}","image_sequence.stats.queue":"Warteschlange: {count}","image_sequence.edit_in_source":"In Quelle bearbeiten","image_sequence.edit_prompt":"Prompt bearbeiten","image_sequence.select_scene":"Szene auswhlen","image_sequence.next_scene":"Nchste Szene","image_sequence.prev_scene":"Vorherige Szene","image_sequence.scene_input_label":"Szene","image_sequence.select_square":"Quadratisch (1:1) auswhlen","image_sequence.select_landscape":"Landschaft (16:9) auswhlen","image_sequence.select_portrait":"Portrt (9:16) auswhlen","image_sequence.select_range":"Bereich auswhlen","image_sequence.force_refresh":"Aktualisierung erzwingen","image_sequence.select_scene_frames":"Alle Frames in dieser Szene auswhlen","image_sequence.collapse_other_scenes":"Andere Szenen einklappen","prompt_sequence_editor.instructionPlaceholder":"Anweisung eingeben...","prompt_sequence_editor.modifying":"nderung luft...","prompt_sequence_editor.modifySelected":"Auswahl ndern ({count})","prompt_sequence_editor.sourcePrompts":"Quell-Prompts","prompt_sequence_editor.finalPrompts":"Genderte Prompts","prompt_sequence_editor.error.invalidInput":"Ungltiges Format.","geminiChat.mode.general":"Allgemein","geminiChat.mode.prompt":"Prompt-Experte","geminiChat.mode.script":"Drehbuchautor","geminiChat.mode.youtube":"YouTube-Analyst","image_sequence.shot_type.WS":"Integrieren Sie die Entitt mit einer Totalen (WS) in die Szene und Handlung. Zeigen Sie die Umgebung.","image_sequence.shot_type.MS":"Integrieren Sie die Entitt mit einer Halbnahaufnahme (MS) in die Szene. Charakter ab der Taille aufwrts.","image_sequence.shot_type.CU":"Integrieren Sie die Entitt mit einer Nahaufnahme (CU) in die Szene.","image_sequence.shot_type.ECU":"Integrieren Sie die Entitt mit einer extremen Nahaufnahme (ECU) in die Szene. Maximale Details.","image_sequence.shot_type.LS":"Integrieren Sie die Entitt mit einer Weitwinkeleinstellung (LS) in die Szene, um den Mastab zu zeigen."},gb={"dialog.permission.title":"Berechtigung erforderlich","dialog.permission.description":"Diese App bentigt Zugriff auf Ihre Zwischenablage, um Inhalte in Knoten einzufgen. Ihre Daten werden weder gespeichert noch gesendet.","dialog.permission.allow":"Erlauben","dialog.permission.decline":"Ablehnen","dialog.rename.title":"Element umbenennen","dialog.rename.group.title":"Gruppe umbenennen","dialog.rename.catalog.title":"Katalogelement umbenennen","dialog.rename.node.title":"Knoten umbenennen","dialog.rename.label":"Neuer Name:","dialog.rename.confirm":"Umbenennen","dialog.rename.cancel":"Abbrechen","dialog.promptEdit.title":"Prompt bearbeiten","dialog.promptEdit.nameLabel":"Name:","dialog.promptEdit.contentLabel":"Inhalt:","dialog.promptEdit.confirm":"Speichern","dialog.promptEdit.cancel":"Abbrechen","dialog.confirmDelete.title":"Lschen besttigen","dialog.confirmDelete.message":"Sind Sie sicher, dass Sie dieses Element lschen mchten? Dies kann nicht rckgngig gemacht werden.","dialog.confirmDelete.confirm":"Lschen","dialog.confirmDelete.cancel":"Abbrechen","dialog.confirmCloseTab.title":"Tab schlieen","dialog.confirmCloseTab.message":'Mchten Sie den Tab "{tabName}" wirklich schlieen? Nicht gespeicherte nderungen gehen verloren.',"dialog.confirmClear.title":"Leinwand leeren","dialog.confirmClear.message":"Mchten Sie wirklich alles lschen? Dies kann nicht rckgngig gemacht werden.","dialog.confirmReset.title":"Zurcksetzen","dialog.confirmReset.message":"Mchten Sie die Leinwand auf den Standardzustand zurcksetzen? Alle aktuellen Arbeiten gehen verloren.","dialog.confirmReset.confirm":"Zurcksetzen","dialog.confirmLoad.title":"Laden besttigen","dialog.confirmLoad.message":"Das Laden einer neuen Datei ersetzt den aktuellen Inhalt. Nicht gespeicherte nderungen gehen verloren. Fortfahren?","dialog.apiKey.title":"API-Schlssel whlen","dialog.apiKey.description":'Diese Funktion erfordert einen Projekt-API-Schlssel mit aktivierter "AI Platform"-API. Die Videogenerierung kann einige Minuten dauern.',"dialog.apiKey.billingLink":"Mehr ber Abrechnung erfahren","dialog.apiKey.button":"API-Schlssel whlen","dialog.settings.title":"Einstellungen","dialog.settings.apiKeyLabel":"Ihr Google Gemini API-Schlssel:","dialog.settings.useDevKeyLabel":"Kostenlosen Schlssel verwenden (Entwicklung)","dialog.settings.instantNodeCloseLabel":"Sofortiges Schlieen von Knoten","dialog.settings.nodeAnimationLabel":"Knoten-Hinzufge-Animation","dialog.settings.animationModeLabel":"Erstellungs-Animationsmodus","dialog.settings.anim.pulse":"Pulsieren","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"Keine","dialog.settings.description":"Um Ihre eigenen Quoten zu nutzen und auf bestimmte Modelle zuzugreifen, geben Sie Ihren persnlichen API-Schlssel ein. Er wird lokal gespeichert.","dialog.settings.getKeyLink":"Hier API-Schlssel erhalten","dialog.settings.save":"Speichern","dialog.deleteNode.title":"Knoten schlieen?","dialog.deleteNode.titlePlural":"Knoten schlieen?","dialog.deleteNode.confirm":"Ja","dialog.deleteNode.cancel":"Nein","dialog.deleteNode.confirmTooltip":"Knoten schlieen - verlorene Daten knnen nicht wiederhergestellt werden","dialog.deleteNode.cancelTooltip":"Nicht schlieen - weiterarbeiten","dialog.deleteNode.dontShowAgain":"Nicht mehr anzeigen","dialog.exitApp.title":"Projekt schlieen?","dialog.exitApp.message":"Mchten Sie das Projekt wirklich schlieen? Alle aktuellen Arbeiten gehen verloren und die Leinwand wird zurckgesetzt."},fb={"group.button.create":"Gruppe erstellen ({count})","group.rename":"Gruppe umbenennen","group.saveToCatalog":"Im Katalog speichern","group.saveToDisk":"Auf Festplatte speichern","group.ungroup":"Gruppierung aufheben (Umschalt+Klick zum Lschen inkl. Inhalt)","group.duplicate":"Mit Inhalt duplizieren","catalog.tabs.groups":"Gruppen","catalog.tabs.library":"Bibliothek","catalog.tabs.characters":"Charaktere","catalog.tabs.scripts":"Skripte","catalog.tabs.sequences":"Sequenzen","catalog.back":"Zurck","catalog.load":"Aus Datei laden","catalog.newFolder":"Neuer Ordner","catalog.saveTo":"Im Katalog speichern","catalog.card.addToCanvas":"Zur Leinwand hinzufgen","catalog.card.rename":"Umbenennen","catalog.card.save":"Speichern","catalog.card.delete":"Lschen","catalog.empty.description":"Dieser Ordner ist leer. Sie knnen Elemente hinzufgen oder Ordner erstellen.","library.loadFromFile":"Laden","library.actions.newFolder":"Neuer Ordner","library.actions.newPrompt":"Neuer Prompt","library.actions.copy":"Kopieren","library.actions.edit":"Bearbeiten","library.empty.title":"Leerer Ordner","library.empty.description":"Erstellen Sie Prompts und Ordner, um zu beginnen.","library.emptyPrompt":"Leerer Prompt"},xb={...ub,...pb,...hb,...mb,...gb,...fb},yb={"app.title":"Modificatore di Prompt","app.subtitle":"Connetti idee per creare un capolavoro","app.error.title":"Notifica","app.error.copy":"Copia Messaggio","app.error.copied":"Copiato!","error.apiKey":"La tua chiave API non  valida o mancano i permessi. Seleziona una chiave API valida.","error.scriptModifierCanvas":"Questa tela appartiene a un'altra applicazione - Script Modifier. Utilizza Script Modifier per aprire questo file.","welcome.title":"Benvenuto in","welcome.description":"Benvenuto in Prompt Modifier. Connetti idee per creare capolavori. Usa i nodi per generare e modificare contenuti.","welcome.apiKeyLabel":"La tua Chiave API Google Gemini","welcome.apiKeyPlaceholder":"Inserisci la tua chiave API qui...","welcome.apiKeyHelp":"La tua chiave API  salvata localmente.","welcome.getKeyLink":"Ottieni Chiave API","welcome.iAmDeveloper":"Sono uno Sviluppatore","welcome.letsGo":"Andiamo","welcome.resume":"Riprendi","welcome.startNew":"Nuova Tela","welcome.freeModeActive":"Modalit Gratuita Attiva","welcome.selectLanguage":"Seleziona la tua lingua principale","welcome.navHint":"Usa i tasti della tastiera  e  per cambiare lingua","toast.contentCleared":"Contenuto cancellato","toast.downloadStarted":"Download avviato","toast.characterLoaded":"Scheda personaggio caricata","toast.characterSavedDisk":"Scheda personaggio salvata su disco","toast.copiedToClipboard":"Copiato negli appunti","toast.pastedFromClipboard":"Incollato dagli appunti","toast.pasteFailed":"Incollaggio fallito","toast.nodeDuplicated":"Nodo duplicato","toast.groupSavedToDisk":'Gruppo "{groupTitle}" salvato su disco',"toast.groupDeleted":"Gruppo e contenuti eliminati","toast.characterSavedCatalog":"Personaggio salvato nel catalogo","toast.promptSaved":"Prompt salvato nella libreria: {promptName}...","toast.connectionsCut":"Connessioni rimosse","toast.apiKeySaved":"Chiave API salvata con successo","toast.cacheCleared":"{count} elementi inutilizzati rimossi dalla cache","toast.cacheEmpty":"Cache gi ottimizzata","toast.scriptSaved":"Sceneggiatura salvata su disco","alert.groupSaved":'Gruppo "{groupTitle}" salvato nel catalogo.',"alert.loadCatalogFailed":"Impossibile caricare il file del catalogo","alert.invalidCatalogFile":"Formato file catalogo non valido","alert.fileNotSupported":'File non supportato. "appName" mancante o errato.',"alert.invalidCatalogStructure":'Struttura catalogo non valida. "root" mancante.',"tutorial.step1":"Clicca qui per aggiungere una parola casuale al prompt.","tutorial.step2":`Clicca su "Migliora Prompt" per combinare gli input usando l'IA.`,"tutorial.step2_waiting":"L'IA sta analizzando i tuoi input e generando un prompt pi ricco...","tutorial.step3":"Infine, clicca qui per generare l'immagine.","tutorial.step3b":"La generazione richiede del tempo. Puoi monitorare i progressi qui.","tutorial.step4":"Puoi aggiungere nuovi nodi manualmente da questa barra degli strumenti.","tutorial.group.catalog":"Usa il Catalogo per cercare nodi o gestire gruppi.","tutorial.group.general":"Aggiungi Note Adesive e Lettori di Dati per il debug.","tutorial.group.input":"Input di base per testo, immagini e sequenze.","tutorial.group.processing":"Analizza ed elabora prompt o immagini con l'IA.","tutorial.group.character":"Crea, analizza e memorizza personaggi dettagliati.","tutorial.group.output":"Visualizza i risultati e genera sequenze.","tutorial.group.ai":"Chatta con Gemini e traduci testi.","tutorial.group.video":"Strumenti per prompt video e montaggio.","tutorial.group.scripts":"Genera e visualizza sceneggiature per storie complesse.","tutorial.group.file":"Salva il tuo lavoro, carica progetti o scarica la tela.","tutorial.success.title":"Tutorial Completato!","tutorial.success.message":"Hai imparato con successo le basi di Prompt Modifier. Buona fortuna nella creazione di capolavori!","tutorial.success.button":"Inizia a Creare","tutorial.skip":"Salta","tutorial.next":"Avanti","tutorial.finish":"Capito"},vb={"toolbar.settings":"Impostazioni","toolbar.resetCanvas":"Resetta Tela","toolbar.clearCache":"Svuota Cache Inutilizzata","toolbar.home":"Home","toolbar.edit":"Modifica (V)","toolbar.cutter":"Taglia Connessione (C) / (Tieni premuto Ctrl)","toolbar.selection":"Selezione (S) / (Tieni premuto Shift)","toolbar.reroute":"Reindirizza (R) / (Tieni premuto Ctrl+Alt)","toolbar.zoom":"Zoom (Tieni premuto Z)","toolbar.snapToGrid":"Aggancia alla Griglia","toolbar.smartGuides":"Guide Intelligenti","toolbar.lineStyleSpaghetti":"Linee Spaghetti","toolbar.lineStyleOrthogonal":"Linee Ortogonali","toolbar.resetZoom":"Resetta Zoom","toolbar.resetCamera":"Resetta Posizione Camera","toolbar.clearCanvas":"Pulisci Tela","toolbar.addNode":"Aggiungi Nodo (F)","toolbar.catalog":"Apri Catalogo (Ctrl + Spazio)","toolbar.addNote":"Aggiungi Nota (N)","toolbar.addDataReader":"Aggiungi Lettore Dati (Shift + R)","toolbar.addTextInput":"Aggiungi Input Testo (T)","toolbar.addImageInput":"Aggiungi Input Immagine (I)","toolbar.addPromptSequenceEditor":"Aggiungi Editor Sequenza Prompt (Q)","toolbar.addImageAnalyzer":"Aggiungi Analizzatore Immagine (Shift+A)","toolbar.addPromptAnalyzer":"Aggiungi Analizzatore Prompt (A)","toolbar.addPromptProcessor":"Aggiungi Processore Prompt (P)","toolbar.addCharacterGenerator":"Aggiungi Generatore Personaggi (Shift+C)","toolbar.addCharacterAnalyzer":"Aggiungi Analizzatore Personaggi (Ctrl+Shift+A)","toolbar.addCharacterCard":"Aggiungi Scheda Personaggio (Ctrl+Shift+C)","toolbar.addImageOutput":"Aggiungi Output Immagine (O)","toolbar.addImageEditor":"Aggiungi Editor Immagini IA (Shift+I)","toolbar.addImageSequenceGenerator":"Aggiungi Generatore Sequenza Immagini (Shift+Q)","toolbar.addTranslator":"Aggiungi Traduttore (L)","toolbar.addGeminiChat":"Aggiungi Chat Gemini (M)","toolbar.addVideoPromptProcessor":"Aggiungi Processore Prompt Video (Shift+P)","toolbar.addVideoOutput":"Aggiungi Output Video (Shift+O)","toolbar.addScriptGenerator":"Aggiungi Generatore Sceneggiatura","toolbar.addScriptViewer":"Aggiungi Visualizzatore Sceneggiatura (Shift + V)","toolbar.saveCanvas":"Salva Tela (Ctrl + S)","toolbar.saveProject":"Salva Progetto","toolbar.loadCanvas":"Carica Progetto/Tela (Ctrl + O)","toolbar.group.general":"Generale","toolbar.group.catalog":"Catalogo","toolbar.group.input":"Input","toolbar.group.processing":"Elaborazione","toolbar.group.character":"Personaggio","toolbar.group.output":"Output","toolbar.group.aiTools":"Strumenti IA","toolbar.group.video":"Video","toolbar.group.scripts":"Sceneggiature","toolbar.group.file":"File","toolbar.title":"Barra degli Strumenti","toolbar.dock":"Ancora Barra","toolbar.detach":"Stacca Barra","toolbar.expandPanel":"Espandi Pannello","toolbar.collapsePanel":"Comprimi Pannello","toolbar.dockArea.title":"Ancora Barra Qui","toolbar.duplicate":"Duplica Nodo","toolbar.duplicateWithContent":"Duplica con Contenuto","toolbar.dock.q1":"Sinistra 1 Qrt","toolbar.dock.q2":"Sinistra 2 Qrt","toolbar.dock.q3":"Destra 3 Qrt","toolbar.dock.q4":"Destra 4 Qrt","toolbar.dock.tl":"Alto Sinistra","toolbar.dock.bl":"Basso Sinistra","toolbar.dock.tr":"Alto Destra","toolbar.dock.br":"Basso Destra","toolbar.dock.left":"Met Sinistra","toolbar.dock.right":"Met Destra","toolbar.dock.full":"Schermo Intero","toolbar.dock.exitFull":"Esci da Schermo Intero","toolbar.dock.fullFocus":"Focus Schermo Intero","hotkeys.show":"Mostra Scorciatoie","hotkeys.tools.title":"Strumenti","hotkeys.tools.edit":"Modalit Modifica","hotkeys.tools.cutter":"Strumento Taglierina","hotkeys.tools.selection":"Strumento Selezione","hotkeys.tools.reroute":"Strumento Reindirizzamento","hotkeys.tools.zoom":"Strumento Zoom","hotkeys.tools.toggleLineStyle":"Cambia Stile Linea","hotkeys.tools.group":"Selezione Gruppo","hotkeys.tools.closeNode":"Elimina Selezionati","hotkeys.tools.duplicate":"Duplica Nodo","hotkeys.tools.duplicateWithContent":"Duplica con Contenuto","hotkeys.tools.deleteGroup":"Elimina Gruppo (Shift+Click)","hotkeys.windows.title":"Finestre","hotkeys.windows.search":"Ricerca Rapida","hotkeys.windows.catalog":"Catalogo","hotkeys.createNode.title":"Crea Nodo","help.panelTitle":"Aiuto e Scorciatoie","help.title":"Scorciatoie da Tastiera","help.howToUse.title":"Come Usare","help.howToUse.content":"Benvenuto in Prompt Modifier! Usa la barra degli strumenti o le scorciatoie per aggiungere nodi. Connetti i nodi per passare i dati. Usa lo strumento Modifica per spostare i nodi e scorrere la tela. Doppio clic su uno spazio vuoto per aprire il menu di aggiunta rapida. Clic destro per il menu contestuale.","help.author":"Autore","contextMenu.undoPosition":"Annulla Posizione","contextMenu.redoPosition":"Ripeti Posizione","contextMenu.align.left":"Allinea a Sinistra (F)","contextMenu.align.centerX":"Allinea Centro X (E)","contextMenu.align.right":"Allinea a Destra (R)","contextMenu.align.top":"Allinea in Alto (T)","contextMenu.align.centerY":"Allinea Centro Y (D)","contextMenu.align.bottom":"Allinea in Basso (B)","contextMenu.distribute.horizontal":"Distribuisci Orizz. (Ctrl+D)","contextMenu.distribute.vertical":"Distribuisci Vert. (Ctrl+E)","contextMenu.emptySlot":"Slot Vuoto (Click destro per assegnare)","contextMenu.saveSlots":"Salva Config Slot","contextMenu.loadSlots":"Carica Config Slot","quickadd.title":"Aggiunta Rapida","quickadd.group.tools":"Strumenti","quickadd.group.inputs":"Input","quickadd.group.processing":"Elaborazione","quickadd.group.character":"Personaggio","quickadd.group.outputs":"Output","quickadd.group.ai":"Strumenti IA","quickadd.group.video":"Video","quickadd.group.scripts":"Sceneggiature","quickadd.group.general":"Generale","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"Modifica","quickadd.tool.cutter":"Taglierina","quickadd.tool.selection":"Selezione","search.placeholder":"Cerca un nodo da aggiungere...","search.noResults":"Nessun nodo trovato.","search.group.input":"Input & Base","search.group.process":"Elaborazione & Personaggio","search.group.output":"Immagine & Sequenza","search.group.ai":"Strumenti IA","search.group.video":"Video & Scrittura","search.group.scripts":"Sceneggiature","toolbar.exitApp":"Chiudi Progetto"},wb={"node.title.text_input":"Input Testo","node.title.image_input":"Input Immagine","node.title.prompt_processor":"Processore Prompt","node.title.prompt_sanitizer":"Sanitizzatore Prompt","node.title.video_prompt_processor":"Proc. Prompt Video","node.title.image_output":"Output Immagine","node.title.video_output":"Output Video","node.title.prompt_analyzer":"Analizzatore Prompt","node.title.character_analyzer":"Analizzatore Personaggio","node.title.character_generator":"Generatore Personaggio","node.title.character_card":"Scheda Personaggio","node.title.image_analyzer":"Analizzatore Immagine","node.title.image_editor":"Editor Immagini IA","node.title.image_sequence_generator":"Generatore Sequenza Immagini","node.title.prompt_sequence_editor":"Editor Sequenza Prompt","node.title.gemini_chat":"Chat Gemini","node.title.translator":"Traduttore","node.title.script_generator":"Generatore Sceneggiatura","node.title.script_viewer":"Visualizzatore Sceneggiatura","node.title.note":"Nota","node.title.reroute_dot":"Punto Reindirizzamento","node.title.data_reader":"Lettore Dati","node.title.video_editor":"Video Editor Alpha","node.title.media_viewer":"Visualizzatore Media","node.title.data_protection":"Protezione Dati","node.title.pose_creator":"Pose Creator","node.help.text_input":"Un semplice campo di testo multilinea per inserire prompt o note.","node.help.image_input":"Consente di caricare o incollare un'immagine da usare come input per altri nodi.","node.help.prompt_processor":"Combina pi input di testo in un singolo prompt migliorato usando l'IA.","node.help.prompt_sanitizer":"Riscrive il prompt di input per renderlo pi sicuro per le politiche di generazione immagini, preservando l'intento artistico.","node.help.video_prompt_processor":"Processore specializzato per creare prompt dettagliati per la generazione video.","node.help.image_output":"Visualizza il risultato della generazione di immagini. Supporta il download e la visualizzazione.","node.help.video_output":"Visualizza il risultato della generazione video usando il modello Veo.","node.help.prompt_analyzer":"Decostruisce un prompt in componenti come soggetto, stile e ambiente.","node.help.character_analyzer":"Analizza una descrizione del personaggio e la divide in aspetto e abbigliamento.","node.help.character_generator":"Genera descrizioni dettagliate di personaggi basate su un breve prompt.","node.help.character_card":"Memorizza dati completi del personaggio inclusi immagine e descrizione.","node.help.image_analyzer":"Usa l'IA per descrivere il contenuto di un'immagine di input.","node.help.image_editor":"Strumento avanzato per modificare immagini usando prompt di testo e inpainting/outpainting.","node.help.image_sequence_generator":"Genera una sequenza di immagini basata su una lista di prompt.","node.help.prompt_sequence_editor":"Permette la modifica in massa di sequenze di prompt usando istruzioni IA.","node.help.gemini_chat":"Un'interfaccia di chat generica con Gemini per brainstorming o assistenza.","node.help.translator":"Traduce il testo tra le lingue usando modelli IA.","node.help.script_generator":"Genera una sceneggiatura strutturata (scene, personaggi) da un'idea di storia.","node.help.script_viewer":"Visualizza e gestisce i dati della sceneggiatura per la generazione fotogramma per fotogramma.","node.help.note":"Una nota adesiva per aggiungere commenti o istruzioni sulla tela.","node.help.reroute_dot":"Un piccolo punto usato per organizzare le connessioni e creare layout pi puliti.","node.help.data_reader":"Strumento di debug per ispezionare i dati grezzi che fluiscono attraverso le connessioni.","node.help.video_editor":"Uno strumento basato su timeline per modificare clip video e immagini.","node.help.media_viewer":"Un lettore per visualizzare file video e audio con controlli di riproduzione.","node.help.data_protection":"Un nodo mini-gioco interattivo Tower Defense. Difendi il flusso di dati dalla corruzione.","node.help.pose_creator":"Visual rig to define and generate character poses for consistency.","node.action.expand":"Espandi","node.action.collapse":"Comprimi","node.action.help":"Aiuto","node.action.download":"Scarica","node.action.clear":"Pulisci Contenuto","node.action.refreshChat":"Pulisci e Riavvia Chat","node.action.paste":"Incolla","node.action.resetEditor":"Resetta Editor","node.action.saveCharacter":"Salva Scheda","node.action.loadCharacter":"Carica Scheda","node.action.copy":"Copia","node.action.copyImage":"Copia Immagine","node.action.copyTextPrompt":"Copia Prompt","node.action.copyImagePrompt":"Copia Prompt Immagine","node.action.copyVideoPrompt":"Copia Prompt Video","node.action.cutConnections":"Taglia Connessioni","node.action.close":"Chiudi","node.action.closeNode":"Chiudi Nodo (Shift+Click per chiusura istantanea)","node.action.closeNodeSimple":"Chiudi Nodo","node.action.randomWord":"Aggiungi Parola Casuale","node.action.processImage":"Rimuovi Watermark","node.action.processImageTitle":"Usa Gemini per rimuovere watermark e testo dall'immagine.","node.action.editor":"Editor","node.action.rasterEditor":"Editor Raster","node.action.openInAIEditor":"Apri in Editor IA","node.action.openInAnalyzer":"Apri in Analizzatore","node.action.outputToInput":"Usa Output come Input","node.action.processChainForward":"Processa in Avanti","node.action.executeChain":"Esegui Catena","node.action.executeChainTitle":"Esegui tutti i nodi a monte per generare il risultato finale.","node.action.sanitize":"Sanitizza","node.action.rename":"Rinomina","node.action.stop":"Stop","node.action.stopping":"Arresto...","node.action.deleteItem":"Elimina Elemento","node.action.detachAndPaste":"Stacca e Incolla","node.action.delete":"Elimina","node.action.flipImage":"Ribalta Immagine","node.action.pin":"Fissa Nodo in Alto","node.action.unpin":"Sblocca Nodo","node.action.updateDescription":"Aggiorna Descrizione","node.action.modifyCharacter":"Richiedi Modifiche","node.action.updateDataFormat":"Aggiorna Formato Dati","node.action.expand169":"Espandi a 16:9","node.action.expand916":"Espandi a 9:16","node.action.sync":"Sincronizza dalle Connessioni","node.action.expandRatio":"Espandi Proporzioni","node.action.markPrimary":"Segna come Principale","node.action.addCard":"Aggiungi Scheda","node.action.removeCard":"Rimuovi Scheda","node.action.showOutputs":"Mostra Output","node.action.hideOutputs":"Nascondi Output","node.mediaViewer.play":"Play","node.mediaViewer.pause":"Pausa","node.mediaViewer.stop":"Stop","node.mediaViewer.addMarker":"Aggiungi Marker","node.mediaViewer.exportSRT":"Esporta Marker (SRT)","node.mediaViewer.deleteAllMarkers":"Elimina Tutti i Marker","node.mediaViewer.saveMarkers":"Salva Marker su Disco","node.mediaViewer.loadMarkers":"Carica Marker da Disco","node.mediaViewer.relink":"Ricollega File","node.content.notePlaceholder":"Scrivi qui le tue note...","node.content.dropImage":"Trascina immagine qui o clicca per caricare","node.content.dropMedia":"Trascina video o audio qui","node.content.processing":"Elaborazione...","node.content.processingChain":"Elaborazione Catena...","node.content.metadataPrompt":"Prompt da Metadati Immagine:","node.content.metadataPromptPlaceholder":"Nessun prompt trovato nell'immagine.","node.content.copyPrompt":"Usa","node.content.prompt":"Prompt","node.content.inputPrompt":"Prompt di Input","node.content.enhancedResult":"Risultato Migliorato","node.content.videoPrompt":"Prompt Video","node.content.editPromptPlaceholder":"Aggiungi o modifica il prompt...","node.content.enhancedPromptHere":"Il prompt migliorato apparir qui...","node.content.safePrompt":"Sicuro per uso commerciale","node.content.generating":"Generazione...","node.content.imageHere":"L'immagine apparir qui","node.content.generationMode":"Modello di Generazione","node.content.aspectRatio":"Proporzioni","node.content.aspectRatioHelp":"Imposta le proporzioni per la generazione dell'immagine","node.content.aspectRatioNotSupportedFast":"Proporzioni disponibili solo per modelli Imagen.","node.content.enableAspectRatioFormatting":"Abilita Formattazione Proporzioni","node.content.autoDownload":"Auto Download","node.content.generateImage":"Genera Immagine","node.content.enhancing":"Miglioramento...","node.content.enhancePrompt":"Migliora Prompt","node.content.sanitizing":"Sanitizzazione...","node.content.sanitizedPromptHere":"Il prompt sanitizzato apparir qui...","node.content.analyzing":"Analisi...","node.content.analyzePrompt":"Analizza Prompt","node.content.analyzeImage":"Analizza Immagine","node.content.imageToText":"Immagine a Testo","node.content.updatePromptFromImage":"Aggiorna prompt da immagine","node.content.analyzeCharacter":"Analizza Personaggio","node.content.generateCharacters":"Genera Personaggi","node.content.characterPromptPlaceholder":"Descrivi il/i personaggio/i da generare...","node.content.character":"Personaggio","node.content.clothing":"Abbigliamento","node.content.characterPlaceholder":"La descrizione del personaggio apparir qui...","node.content.clothingPlaceholder":"La descrizione dell'abbigliamento apparir qui...","node.content.appearance":"Aspetto","node.content.personality":"Personalit","node.content.environment":"Ambiente/Setting","node.content.action":"Azione","node.content.emotion":"Emozione","node.content.style":"Stile","node.content.environmentPlaceholder":"Descrizione dettagliata dell'ambiente...","node.content.charactersPlaceholder":"Lista dei personaggi principali...","node.content.characters":"Personaggi","node.content.characterConcepts":"Concetti Personaggio","node.content.actionPlaceholder":"Descrizione dell'azione...","node.content.emotionPlaceholder":"Descrizione dell'emozione...","node.content.stylePlaceholder":"Descrizione dello stile artistico...","node.content.descriptionHere":"La descrizione apparir qui...","node.content.enableOutpainting":"Abilita Outpainting","node.content.outpaintingPromptPlaceholder":"Prompt Outpainting...","node.content.inputImage":"Immagini di Input","node.content.dropOrClick":"Trascina o Clicca","node.content.outputImage":"Immagine di Output","node.content.applyEdit":"Applica Modifica","node.content.editing":"Modifica...","node.content.chatPlaceholder":"Scrivi il tuo messaggio...","node.content.connectedPlaceholder":"Connesso al nodo, modifica nella sorgente.","node.content.connectedNode":"Connesso via nodo","node.content.connectedEmpty":"Il nodo connesso non ha immagini.","node.content.translatePlaceholder":"Testo da tradurre...","node.content.translatedTextPlaceholder":"Testo tradotto...","node.content.targetLanguage":"Lingua di Destinazione","node.content.translate":"Traduci","node.content.translating":"Traduzione...","node.content.scriptPromptPlaceholder":"Inserisci un'idea per la storia o trama...","node.content.generateScript":"Genera Sceneggiatura","node.content.loadScript":"Carica File Sceneggiatura","node.content.summary":"Riepilogo","node.content.scenes":"Scene","node.content.unrecognizedFormat":"Formato sceneggiatura non riconosciuto.","node.content.frames":"Fotogrammi","node.content.characterIndex":"Indice","node.content.readData":"Leggi Dati","node.content.textDataHere":"I dati di testo appariranno qui.","node.content.noDataRead":'Connetti un nodo e clicca "Leggi Dati" per visualizzarne il contenuto.',"node.content.previewError":"Errore Anteprima","node.content.previewPlaceholder":"L'anteprima apparir qui","node.content.imagePrompt":"Prompt Immagine","node.output.allPromptData":"Tutti i Dati Prompt","node.note.tab.note":"Nota","node.note.tab.references":"Riferimenti","node.note.nestedImages":"Immagini Nidificate","node.note.dropPlaceholder":"Trascina immagini o clicca per aggiungere","node.note.addCaption":"Didascalia","node.note.action.shuffle":"Mescola","node.note.action.undoShuffle":"Annulla Mescolamento","node.content.characterTypeShort":"Tipo:","node.content.numberOfCharactersShort":"Qt:","node.content.characterType.simple":"Semplice","node.content.characterType.anthro":"Antro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Oggetto Chiave","node.content.style.simple":"Semplice","node.content.style.realistic":"Realistico","node.content.style.3d_cartoon":"Cartone 3D","node.content.style.3d_realistic":"3D Realistico","node.content.style.2d_animation":"Animazione 2D","node.content.style.anime":"Anime","node.content.style.comics":"Fumetti","node.content.style.custom":"Personalizzato","node.content.fullDescriptionTitle":"Descrizione completa del personaggio","node.content.integrationInstruction":"Istruzione di integrazione","node.content.additionalPromptSuffix":"Prompt Aggiuntivo (Suffisso)","image_sequence.auto_crop":"Ritaglio Auto 16:9","image_sequence.create_zip":"Crea Archivio ZIP","node.content.modificationRequest":"Richiesta di modifica","node.content.technicalPrompt":"Prompt Tecnico","node.promptProcessor.safePromptTooltip":"Riscrive il prompt per rispettare le linee guida di sicurezza ed evitare violazioni delle norme.","node.promptProcessor.technicalPromptTooltip":"Converte il prompt in una specifica tecnica altamente dettagliata (illuminazione, camera, impostazioni di rendering).","node.promptProcessor.enhanceTooltip":"Usa l'IA per espandere e arricchire il prompt con dettagli descrittivi.","node.promptProcessor.chainTooltip":"Esegue questo nodo e innesca tutti i nodi connessi a valle.","image_sequence.tooltip.autoCrop":"Ritaglia automaticamente le immagini generate in rapporto 16:9.","image_sequence.tooltip.autoDownload":"Salva automaticamente ogni immagine sul dispositivo dopo la generazione.","image_sequence.tooltip.createZip":"Raggruppa tutte le immagini selezionate in un unico archivio ZIP per il download."},bb={"imageEditor.title":"Editor Immagini","imageEditor.canvasResolution":"Risoluzione Tela","imageEditor.background":"Sfondo","imageEditor.toolSettings":"Impostazioni Strumento","imageEditor.snapToEdges":"Aggancia ai Bordi","imageEditor.freeAspect":"Proporzioni Libere","imageEditor.section.aiRequest":"Richiesta Modifica IA","imageEditor.input.modificationPlaceholder":'Descrivi le modifiche, es. "cambia sfondo in blu"',"imageEditor.action.sendRequest":"Invia Richiesta","imageEditor.tooltip.removeObject":"Rimuovi (Rosso) / Mantieni (Verde)","imageEditor.action.removeObject":"Rimuovi Oggetto","imageEditor.tool.transform":"Trasforma","imageEditor.tool.hand":"Mano (Pan)","imageEditor.tool.zoom":"Zoom","imageEditor.tool.pencil":"Matita","imageEditor.tool.rectangle":"Rettangolo","imageEditor.action.fit":"Adatta alla Tela","imageEditor.action.fill":"Riempi Tela","imageEditor.action.cancel":"Annulla","imageEditor.action.resetEdits":"Resetta Modifiche","imageEditor.action.apply":"Applica","imageViewer.title":"Visualizzatore Immagini","imageEditor.outputResolution":"Risoluzione Output","imageEditor.outputResolutionHelp":'Imposta risoluzione output. Se "Auto", usa la risoluzione della tela.',"imageEditor.currentSize":"Dimensione Attuale: {width}x{height}","imageEditor.sequenceMode":"Modalit Sequenza","imageEditor.sequenceModeHelp":"Elabora le immagini di input da Input A in sequenza.","imageEditor.sequentialCombination":"Combinazione Sequenziale Immagini","imageEditor.sequentialCombinationHelp":"Per ogni fotogramma: Invia immagine Input A corrente + Tutte le immagini Input B.","imageEditor.sequentialPrompt":"Combinazione Sequenziale Prompt","imageEditor.sequentialPromptHelp":"Per ogni fotogramma: Usa un prompt unico dalla lista + immagine corrente.","imageEditor.sequentialEditingWithPrompts":"Modifica Sequenziale con Prompt","imageEditor.sequentialEditingWithPromptsHelp":"Per ogni fotogramma: Usa immagine Input B + prompt unico. Input A ignorato.","imageEditor.input":"Input","imageEditor.inputA":"Input A","imageEditor.inputB":"Input B","imageEditor.status.queued":"In Coda","imageEditor.status.generating":"Generazione...","imageEditor.action.regenerate":"Rigenera","imageEditor.tooltip.fit":"Adatta immagine ai bordi della tela (contain).","imageEditor.tooltip.fill":"Scala immagine per riempire la tela (cover).","imageEditor.tooltip.flip":"Ribalta immagine orizzontalmente.","imageEditor.background.white":"Bianco","imageEditor.background.gray":"Grigio","imageEditor.background.black":"Nero","imageEditor.background.dark":"Scuro","image_sequence.regenerate":"Rigenera","image_sequence.stop_queue":"Ferma Coda","image_sequence.move_up":"Sposta Su","image_sequence.move_down":"Sposta Gi","image_sequence.copy_prompt":"Copia Prompt","image_sequence.add_frame":"Aggiungi Fotogramma","image_sequence.delete_frame":"Elimina Fotogramma","image_sequence.expand_all_frames":"Espandi/Comprimi Tutti i Fotogrammi","image_sequence.collapse_all_frames":"Comprimi Tutti i Fotogrammi","image_sequence.expand_all_scenes":"Espandi/Comprimi Tutte le Scene","image_sequence.collapse_all_scenes":"Comprimi Tutte le Scene","image_sequence.expand_all":"Espandi Tutto","image_sequence.collapse_all":"Comprimi Tutto","image_sequence.clear_all_prompts":"Pulisci Tutti i Prompt","image_sequence.add_first_frame":"Aggiungi Primo Fotogramma","image_sequence.drop_or_add_title":"Trascina JSON Sequenza o Aggiungi Fotogramma","image_sequence.drop_or_add_desc":"Trascina un file JSON qui o clicca per aggiungere un fotogramma manualmente.","image_sequence.load_prompts":"Carica Prompt","image_sequence.output_images_title":"Immagini Output","image_sequence.prompts_list_title":"Prompt Sorgente","image_sequence.download_selected":"Scarica Selezionati","image_sequence.select_all":"Seleziona Tutto","image_sequence.select_none":"Deseleziona Tutto","image_sequence.invert_selection":"Inverti Selezione","image_sequence.run_selected":"Esegui Selezionati","image_sequence.start_queue":"Avvia Coda","image_sequence.character_prompt_combination":"Combinazione Prompt Personaggio","image_sequence.combination_none":"Nessuna","image_sequence.combination_combine":"Combina","image_sequence.combination_replace":"Sostituisci Tag","image_sequence.status.error":"Erro","image_sequence.status.pending":"In Coda","image_sequence.clear_selected_prompts":"Pulisci Prompt Selezionati","image_sequence.range_from":"Da:","image_sequence.range_to":"A:","image_sequence.stats.total":"Totale Fotogrammi: {count}","image_sequence.stats.generated":"Generati: {count}","image_sequence.stats.queue":"Coda: {count}","image_sequence.edit_in_source":"Modifica in Sorgente","image_sequence.edit_prompt":"Modifica Prompt","image_sequence.select_scene":"Seleziona Scena","image_sequence.next_scene":"Scena Successiva","image_sequence.prev_scene":"Scena Precedente","image_sequence.scene_input_label":"Scena","image_sequence.select_square":"Seleziona Quadrato (1:1)","image_sequence.select_landscape":"Seleziona Paesaggio (16:9)","image_sequence.select_portrait":"Seleziona Ritratto (9:16)","image_sequence.select_range":"Seleziona Intervallo","image_sequence.force_refresh":"Forza Aggiornamento","image_sequence.select_scene_frames":"Seleziona tutti i fotogrammi in questa scena","image_sequence.collapse_other_scenes":"Comprimi altre scene","prompt_sequence_editor.instructionPlaceholder":"Inserisci istruzione per modificare i prompt...","prompt_sequence_editor.modifying":"Modifica in corso...","prompt_sequence_editor.modifySelected":"Modifica Selezionati ({count})","prompt_sequence_editor.sourcePrompts":"Prompt Sorgente","prompt_sequence_editor.finalPrompts":"Prompt Modificati","prompt_sequence_editor.error.invalidInput":"Formato dati non valido. Connetti un array di sequenza prompt.","geminiChat.mode.general":"Generale","geminiChat.mode.prompt":"Esperto Prompt","geminiChat.mode.script":"Sceneggiatore","geminiChat.mode.youtube":"Analista YouTube","image_sequence.shot_type.WS":"Integra l'Entit con un Campo Lungo (WS) nella scena e nell'azione. Mostra l'ambiente.","image_sequence.shot_type.MS":"Integra l'Entit con un Piano Medio (MS) nella scena. Personaggio dalla vita in su.","image_sequence.shot_type.CU":"Integra l'Entit con un Primo Piano (CU) nella scena.","image_sequence.shot_type.ECU":"Integra l'Entit con un Primissimo Piano (ECU) nella scena. Massimo dettaglio.","image_sequence.shot_type.LS":"Integra l'Entit con un Piano Totale (LS) nella scena per mostrare la scala."},Cb={"dialog.permission.title":"Permesso Richiesto","dialog.permission.description":"Questa app necessita del permesso di leggere gli appunti per incollare contenuti nei nodi. I tuoi dati non vengono memorizzati o inviati da nessuna parte.","dialog.permission.allow":"Consenti","dialog.permission.decline":"Rifiuta","dialog.rename.title":"Rinomina Elemento","dialog.rename.group.title":"Rinomina Gruppo","dialog.rename.catalog.title":"Rinomina Elemento Catalogo","dialog.rename.node.title":"Rinomina Nodo","dialog.rename.label":"Nuovo Nome:","dialog.rename.confirm":"Rinomina","dialog.rename.cancel":"Annulla","dialog.promptEdit.title":"Modifica Prompt","dialog.promptEdit.nameLabel":"Nome:","dialog.promptEdit.contentLabel":"Contenuto:","dialog.promptEdit.confirm":"Salva","dialog.promptEdit.cancel":"Annulla","dialog.confirmDelete.title":"Conferma Eliminazione","dialog.confirmDelete.message":"Sei sicuro di voler eliminare questo elemento? Questa azione non pu essere annullata.","dialog.confirmDelete.confirm":"Elimina","dialog.confirmDelete.cancel":"Annulla","dialog.confirmCloseTab.title":"Chiudi Scheda","dialog.confirmCloseTab.message":'Sei sicuro di voler chiudere la scheda "{tabName}"? Le modifiche non salvate andranno perse.',"dialog.confirmClear.title":"Pulisci Tela","dialog.confirmClear.message":"Sei sicuro di voler pulire l'intera tela? Questa azione non pu essere annullata.","dialog.confirmReset.title":"Resetta a Default","dialog.confirmReset.message":"Sei sicuro di voler resettare la tela allo stato predefinito? Tutto il lavoro corrente andr perso.","dialog.confirmReset.confirm":"Resetta","dialog.confirmLoad.title":"Conferma Caricamento","dialog.confirmLoad.message":"Caricare un nuovo file sostituir il contenuto corrente. Eventuali modifiche non salvate andranno perse. Continuare?","dialog.apiKey.title":"Seleziona Chiave API","dialog.apiKey.description":`Questa funzionalit richiede una chiave API di Progetto con l'API "AI Platform" abilitata. La generazione video pu richiedere alcuni minuti.`,"dialog.apiKey.billingLink":"Scopri di pi sulla fatturazione","dialog.apiKey.button":"Seleziona Chiave API","dialog.settings.title":"Impostazioni","dialog.settings.apiKeyLabel":"La tua Chiave API Google Gemini:","dialog.settings.useDevKeyLabel":"Usa chiave API gratuita (per sviluppo)","dialog.settings.instantNodeCloseLabel":"Chiusura istantanea nodi","dialog.settings.nodeAnimationLabel":"Animazione Aggiunta Nodo","dialog.settings.animationModeLabel":"Modalit Animazione Creazione","dialog.settings.anim.pulse":"Impulso","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"Nessuna","dialog.settings.description":"Per usare le tue quote e accedere a modelli specifici, inserisci la tua chiave API personale. La chiave  salvata localmente nel tuo browser.","dialog.settings.getKeyLink":"Ottieni una Chiave API qui","dialog.settings.save":"Salva","dialog.deleteNode.title":"Chiudere nodo?","dialog.deleteNode.titlePlural":"Chiudere nodi?","dialog.deleteNode.confirm":"S","dialog.deleteNode.cancel":"No","dialog.deleteNode.confirmTooltip":"Chiudi nodo - i dati persi non possono essere recuperati","dialog.deleteNode.cancelTooltip":"Non chiudere - continua a lavorare con il nodo","dialog.deleteNode.dontShowAgain":"Non mostrare pi","dialog.exitApp.title":"Chiudere il Progetto?","dialog.exitApp.message":"Sei sicuro di voler chiudere il progetto? Tutto il lavoro corrente andr perso e la tela verr resettata."},kb={"group.button.create":"Crea Gruppo ({count})","group.rename":"Rinomina Gruppo","group.saveToCatalog":"Salva nel Catalogo","group.saveToDisk":"Salva su Disco","group.ungroup":"Separa (Shift+Click per eliminare con contenuto)","group.duplicate":"Duplica gruppo con contenuto","catalog.tabs.groups":"Gruppi","catalog.tabs.library":"Libreria","catalog.tabs.characters":"Personaggi","catalog.tabs.scripts":"Sceneggiature","catalog.tabs.sequences":"Sequenze","catalog.back":"Indietro","catalog.load":"Carica da File","catalog.newFolder":"Nuova Cartella","catalog.saveTo":"Salva nel Catalogo","catalog.card.addToCanvas":"Aggiungi alla Tela","catalog.card.rename":"Rinomina","catalog.card.save":"Salva","catalog.card.delete":"Elimina","catalog.empty.description":"Questa cartella  vuota. Puoi aggiungere elementi o creare nuove cartelle.","library.loadFromFile":"Carica","library.actions.newFolder":"Nuova Cartella","library.actions.newPrompt":"Nuovo Prompt","library.actions.copy":"Copia","library.actions.edit":"Modifica","library.empty.title":"Cartella Vuota","library.empty.description":"Crea prompt e cartelle per iniziare.","library.emptyPrompt":"Prompt vuoto"},_b={...yb,...vb,...wb,...bb,...Cb,...kb},Sb={"app.title":"Modificador de Prompt","app.subtitle":"Conecte ideias para criar uma obra-prima","app.error.title":"Notificao","app.error.copy":"Copiar Mensagem","app.error.copied":"Copiado!","error.apiKey":"Sua chave API  invlida ou no tem permisses. Por favor, selecione uma chave API vlida.","error.scriptModifierCanvas":"Esta tela pertence a outra aplicao - Script Modifier. Por favor, use o Script Modifier para abrir este arquivo.","welcome.title":"Bem-vindo ao","welcome.description":"Bem-vindo ao Modificador de Prompt. Conecte ideias para criar obras-primas. Use ns para gerar e editar contedo.","welcome.apiKeyLabel":"Sua Chave API Google Gemini","welcome.apiKeyPlaceholder":"Insira sua chave API aqui...","welcome.apiKeyHelp":"Sua chave API  armazenada localmente.","welcome.getKeyLink":"Obter Chave API","welcome.iAmDeveloper":"Sou Desenvolvedor","welcome.letsGo":"Vamos l","welcome.resume":"Continuar","welcome.startNew":"Nova Tela","welcome.freeModeActive":"Modo Gratuito Ativo","welcome.selectLanguage":"Selecione seu idioma principal","welcome.navHint":"Use as teclas do teclado  e  para mudar o idioma","toast.contentCleared":"Contedo limpo","toast.downloadStarted":"Download iniciado","toast.characterLoaded":"Carto de personagem carregado","toast.characterSavedDisk":"Carto de personagem salvo no disco","toast.copiedToClipboard":"Copiado para a rea de transferncia","toast.pastedFromClipboard":"Colado da rea de transferncia","toast.pasteFailed":"Falha ao colar","toast.nodeDuplicated":"N duplicado","toast.groupSavedToDisk":'Grupo "{groupTitle}" salvo no disco',"toast.groupDeleted":"Grupo e contedo excludos","toast.characterSavedCatalog":"Personagem salvo no catlogo","toast.promptSaved":"Prompt salvo na biblioteca: {promptName}...","toast.connectionsCut":"Conexes removidas","toast.apiKeySaved":"Chave API salva com sucesso","toast.cacheCleared":"Limpos {count} itens no utilizados do cache","toast.cacheEmpty":"Cache j est otimizado","toast.scriptSaved":"Roteiro salvo no disco","alert.groupSaved":'Grupo "{groupTitle}" salvo no catlogo.',"alert.loadCatalogFailed":"Falha ao carregar arquivo de catlogo","alert.invalidCatalogFile":"Formato de arquivo de catlogo invlido","alert.fileNotSupported":'Arquivo no suportado. "appName" ausente ou incorreto.',"alert.invalidCatalogStructure":'Estrutura de catlogo invlida. "root" ausente.',"tutorial.step1":"Clique aqui para adicionar uma palavra aleatria ao prompt.","tutorial.step2":'Clique em "Melhorar Prompt" para combinar entradas usando IA.',"tutorial.step2_waiting":"A IA est analisando suas entradas e gerando um prompt mais rico...","tutorial.step3":"Finalmente, clique aqui para gerar a imagem.","tutorial.step3b":"A gerao leva algum tempo. Voc pode monitorar o progresso aqui.","tutorial.step4":"Voc pode adicionar novos ns manualmente a partir desta barra de ferramentas.","tutorial.group.catalog":"Use o Catlogo para buscar ns ou gerenciar grupos.","tutorial.group.general":"Adicione Notas Adesivas e Leitores de Dados para depurao.","tutorial.group.input":"Entradas bsicas para texto, imagens e sequncias.","tutorial.group.processing":"Analise e processe prompts ou imagens com IA.","tutorial.group.character":"Crie, analise e armazene personagens detalhados.","tutorial.group.output":"Exiba resultados e gere sequncias.","tutorial.group.ai":"Converse com Gemini e traduza textos.","tutorial.group.video":"Ferramentas para prompts de vdeo e edio.","tutorial.group.scripts":"Gere e visualize roteiros para histrias complexas.","tutorial.group.file":"Salve seu trabalho, carregue projetos ou baixe a tela.","tutorial.success.title":"Tutorial Concludo!","tutorial.success.message":"Voc aprendeu com sucesso o bsico do Modificador de Prompt. Boa sorte criando obras-primas!","tutorial.success.button":"Comear a Criar","tutorial.skip":"Pular","tutorial.next":"Prximo","tutorial.finish":"Entendi"},Nb={"toolbar.settings":"Configuraes","toolbar.resetCanvas":"Redefinir Tela","toolbar.clearCache":"Limpar Cache No Usado","toolbar.home":"Incio","toolbar.edit":"Editar (V)","toolbar.cutter":"Cortar Conexo (C) / (Segure Ctrl)","toolbar.selection":"Seleo (S) / (Segure Shift)","toolbar.reroute":"Redirecionar (R) / (Segure Ctrl+Alt)","toolbar.zoom":"Zoom (Segure Z)","toolbar.snapToGrid":"Alinhar  Grade","toolbar.smartGuides":"Guias Inteligentes","toolbar.lineStyleSpaghetti":"Linhas Spaghetti","toolbar.lineStyleOrthogonal":"Linhas Ortogonais","toolbar.resetZoom":"Redefinir Zoom","toolbar.resetCamera":"Redefinir Posio da Cmera","toolbar.clearCanvas":"Limpar Tela","toolbar.addNode":"Adicionar N (F)","toolbar.catalog":"Abrir Catlogo (Ctrl + Espao)","toolbar.addNote":"Adicionar Nota (N)","toolbar.addDataReader":"Adicionar Leitor de Dados (Shift + R)","toolbar.addTextInput":"Adicionar Entrada de Texto (T)","toolbar.addImageInput":"Adicionar Entrada de Imagem (I)","toolbar.addPromptSequenceEditor":"Adicionar Editor de Sequncia de Prompt (Q)","toolbar.addImageAnalyzer":"Adicionar Analisador de Imagem (Shift+A)","toolbar.addPromptAnalyzer":"Adicionar Analisador de Prompt (A)","toolbar.addPromptProcessor":"Adicionar Processador de Prompt (P)","toolbar.addCharacterGenerator":"Adicionar Gerador de Personagem (Shift+C)","toolbar.addCharacterAnalyzer":"Adicionar Analisador de Personagem (Ctrl+Shift+A)","toolbar.addCharacterCard":"Adicionar Carto de Personagem (Ctrl+Shift+C)","toolbar.addImageOutput":"Adicionar Sada de Imagem (O)","toolbar.addImageEditor":"Adicionar Editor de Imagem IA (Shift+I)","toolbar.addImageSequenceGenerator":"Adicionar Gerador de Sequncia de Imagem (Shift+Q)","toolbar.addTranslator":"Adicionar Tradutor (L)","toolbar.addGeminiChat":"Adicionar Chat Gemini (M)","toolbar.addVideoPromptProcessor":"Adicionar Processador de Prompt de Vdeo (Shift+P)","toolbar.addVideoOutput":"Adicionar Sada de Vdeo (Shift+O)","toolbar.addScriptGenerator":"Adicionar Gerador de Roteiro","toolbar.addScriptViewer":"Adicionar Visualizador de Roteiro (Shift + V)","toolbar.saveCanvas":"Salvar Tela (Ctrl + S)","toolbar.saveProject":"Salvar Projeto","toolbar.loadCanvas":"Carregar Projeto/Tela (Ctrl + O)","toolbar.group.general":"Geral","toolbar.group.catalog":"Catlogo","toolbar.group.input":"Entrada","toolbar.group.processing":"Processamento","toolbar.group.character":"Personagem","toolbar.group.output":"Sada","toolbar.group.aiTools":"Ferramentas IA","toolbar.group.video":"Vdeo","toolbar.group.scripts":"Roteiros","toolbar.group.file":"Arquivo","toolbar.title":"Barra de Ferramentas","toolbar.dock":"Ancorar Barra","toolbar.detach":"Desancorar Barra","toolbar.expandPanel":"Expandir Painel","toolbar.collapsePanel":"Recolher Painel","toolbar.dockArea.title":"Ancorar Barra Aqui","toolbar.duplicate":"Duplicar N","toolbar.duplicateWithContent":"Duplicar com Contedo","toolbar.dock.q1":"Esq 1 Qrt","toolbar.dock.q2":"Esq 2 Qrt","toolbar.dock.q3":"Dir 3 Qrt","toolbar.dock.q4":"Dir 4 Qrt","toolbar.dock.tl":"Topo Esquerda","toolbar.dock.bl":"Fundo Esquerda","toolbar.dock.tr":"Topo Direita","toolbar.dock.br":"Fundo Direita","toolbar.dock.left":"Metade Esquerda","toolbar.dock.right":"Metade Direita","toolbar.dock.full":"Tela Cheia","toolbar.dock.exitFull":"Sair Tela Cheia","toolbar.dock.fullFocus":"Foco Tela Cheia","hotkeys.show":"Mostrar Atalhos","hotkeys.tools.title":"Ferramentas","hotkeys.tools.edit":"Modo Edio","hotkeys.tools.cutter":"Ferramenta de Corte","hotkeys.tools.selection":"Ferramenta de Seleo","hotkeys.tools.reroute":"Ferramenta de Redirecionamento","hotkeys.tools.zoom":"Ferramenta de Zoom","hotkeys.tools.toggleLineStyle":"Alternar Estilo de Linha","hotkeys.tools.group":"Seleo de Grupo","hotkeys.tools.closeNode":"Excluir Selecionados","hotkeys.tools.duplicate":"Duplicar N","hotkeys.tools.duplicateWithContent":"Duplicar com Contedo","hotkeys.tools.deleteGroup":"Excluir Grupo (Shift+Clique)","hotkeys.windows.title":"Janelas","hotkeys.windows.search":"Busca Rpida","hotkeys.windows.catalog":"Catlogo","hotkeys.createNode.title":"Criar N","help.panelTitle":"Ajuda e Atalhos","help.title":"Atalhos de Teclado","help.howToUse.title":"Como Usar","help.howToUse.content":"Bem-vindo ao Modificador de Prompt! Use a barra de ferramentas ou atalhos para adicionar ns. Conecte ns para passar dados. Use a ferramenta Editar para mover ns e a tela. Clique duas vezes no espao vazio para abrir o menu de adio rpida. Clique com o boto direito para o menu de contexto.","help.author":"Autor","contextMenu.undoPosition":"Desfazer Posio","contextMenu.redoPosition":"Refazer Posio","contextMenu.align.left":"Alinhar  Esquerda (F)","contextMenu.align.centerX":"Alinhar Centro X (E)","contextMenu.align.right":"Alinhar  Direita (R)","contextMenu.align.top":"Alinhar ao Topo (T)","contextMenu.align.centerY":"Alinhar Centro Y (D)","contextMenu.align.bottom":"Alinhar ao Fundo (B)","contextMenu.distribute.horizontal":"Distribuir Horiz. (Ctrl+D)","contextMenu.distribute.vertical":"Distribuir Vert. (Ctrl+E)","contextMenu.emptySlot":"Slot Vazio (Clique Dir. para atribuir)","contextMenu.saveSlots":"Salvar Config. Slots","contextMenu.loadSlots":"Carregar Config. Slots","quickadd.title":"Adio Rpida","quickadd.group.tools":"Ferramentas","quickadd.group.inputs":"Entradas","quickadd.group.processing":"Processamento","quickadd.group.character":"Personagem","quickadd.group.outputs":"Sadas","quickadd.group.ai":"Ferramentas IA","quickadd.group.video":"Vdeo","quickadd.group.scripts":"Roteiros","quickadd.group.general":"Geral","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"Editar","quickadd.tool.cutter":"Cortar","quickadd.tool.selection":"Seleo","search.placeholder":"Buscar um n para adicionar...","search.noResults":"Nenhum n encontrado.","search.group.input":"Entrada & Bsico","search.group.process":"Processamento & Personagem","search.group.output":"Imagem & Sequncia","search.group.ai":"Ferramentas IA","search.group.video":"Vdeo & Script","search.group.scripts":"Roteiros","toolbar.exitApp":"Fechar Projeto"},Eb={"node.title.text_input":"Entrada de Texto","node.title.image_input":"Entrada de Imagem","node.title.prompt_processor":"Processador de Prompt","node.title.prompt_sanitizer":"Higienizador de Prompt","node.title.video_prompt_processor":"Proc. Prompt Vdeo","node.title.image_output":"Sada de Imagem","node.title.video_output":"Sada de Vdeo","node.title.prompt_analyzer":"Analisador de Prompt","node.title.character_analyzer":"Analisador de Personagem","node.title.character_generator":"Gerador de Personagem","node.title.character_card":"Carto de Personagem","node.title.image_analyzer":"Analisador de Imagem","node.title.image_editor":"Editor de Imagem IA","node.title.image_sequence_generator":"Gerador de Sequncia de Imagem","node.title.prompt_sequence_editor":"Editor de Sequncia de Prompt","node.title.gemini_chat":"Chat Gemini","node.title.translator":"Tradutor","node.title.script_generator":"Gerador de Roteiro","node.title.script_viewer":"Visualizador de Roteiro","node.title.note":"Nota","node.title.reroute_dot":"Ponto de Redirecionamento","node.title.data_reader":"Leitor de Dados","node.title.video_editor":"Editor de Vdeo Alpha","node.title.media_viewer":"Visualizador de Mdia","node.title.data_protection":"Proteo de Dados","node.title.pose_creator":"Pose Creator","node.help.text_input":"Um campo de texto simples de vrias linhas para inserir prompts ou notas.","node.help.image_input":"Permite enviar ou colar uma imagem para usar como entrada em outros ns.","node.help.prompt_processor":"Combina vrias entradas de texto em um nico prompt aprimorado usando IA.","node.help.prompt_sanitizer":"Reescreve o prompt de entrada para ser mais seguro para polticas de gerao de imagem, preservando a inteno artstica.","node.help.video_prompt_processor":"Processador especializado para criar prompts detalhados de gerao de vdeo.","node.help.image_output":"Exibe o resultado da gerao de imagem. Suporta download e visualizao.","node.help.video_output":"Exibe o resultado da gerao de vdeo usando o modelo Veo.","node.help.prompt_analyzer":"Desconstri um prompt em componentes como assunto, estilo e ambiente.","node.help.character_analyzer":"Analisa uma descrio de personagem e a divide em aparncia e roupas.","node.help.character_generator":"Gera descries detalhadas de personagens com base em um prompt corto.","node.help.character_card":"Armazena dados completos do personagem, incluindo imagem e descrio.","node.help.image_analyzer":"Usa IA para descrever o contedo de uma imagem de entrada.","node.help.image_editor":"Ferramenta avanada para editar imagens usando prompts de texto e inpainting/outpainting.","node.help.image_sequence_generator":"Gera uma sequncia de imagens com base em uma lista de prompts.","node.help.prompt_sequence_editor":"Permite edio em massa de sequncias de prompts usando instrues de IA.","node.help.gemini_chat":"Uma interface de chat de uso geral com Gemini para brainstorming ou assistncia.","node.help.translator":"Traduz texto entre idiomas usando modelos de IA.","node.help.script_generator":"Gera um roteiro estruturado (cenas, personagens) a partir de uma ideia de histria.","node.help.script_viewer":"Visualiza e gerencia dados de roteiro para gerao quadro a quadro.","node.help.note":"Uma nota adesiva para adicionar comentrios ou instrues  tela.","node.help.reroute_dot":"Um pequeno ponto usado para organizar conexes e criar layouts mais limpos.","node.help.data_reader":"Ferramenta de depurao para inspecionar os data brutos que fluem pelas conexes.","node.help.video_editor":"Uma ferramenta baseada em linha do tempo para editar videoclipes e imagens.","node.help.media_viewer":"Um player para visualizar arquivos de vdeo e udio com controles de reproduo.","node.help.data_protection":"Um n de mini-jogo interativo de defesa de torre. Defenda seu fluxo de dados contra corrupo.","node.help.pose_creator":"Visual rig to define and generate character poses for consistency.","node.action.expand":"Expandir","node.action.collapse":"Recolher","node.action.help":"Ajuda","node.action.download":"Baixar","node.action.clear":"Limpar Contedo","node.action.refreshChat":"Limpar e Reiniciar Chat","node.action.paste":"Colar","node.action.resetEditor":"Redefinir Editor","node.action.saveCharacter":"Salvar Carto","node.action.loadCharacter":"Carregar Carto","node.action.copy":"Copiar","node.action.copyImage":"Copiar Imagem","node.action.copyTextPrompt":"Copiar Prompt","node.action.copyImagePrompt":"Copiar Prompt de Imagem","node.action.copyVideoPrompt":"Copiar Prompt de Vdeo","node.action.cutConnections":"Cortar Conexes","node.action.close":"Fechar","node.action.closeNode":"Fechar N (Shift+Clique para fechar instantaneamente)","node.action.closeNodeSimple":"Fechar N","node.action.randomWord":"Adicionar Palavra Aleatria","node.action.processImage":"Remover Marcas d'gua","node.action.processImageTitle":"Usa Gemini para remover marcas d'gua e texto da imagem.","node.action.editor":"Editor","node.action.rasterEditor":"Editor Raster","node.action.openInAIEditor":"Abrir no Editor IA","node.action.openInAnalyzer":"Abrir no Analisador","node.action.outputToInput":"Usar Sada como Entrada","node.action.processChainForward":"Processar Adiante","node.action.executeChain":"Executar Cadeia","node.action.executeChainTitle":"Executar todos os ns a montante para gerar o resultado final.","node.action.sanitize":"Higienizar","node.action.rename":"Renomear","node.action.stop":"Parar","node.action.stopping":"Parando...","node.action.deleteItem":"Excluir Item","node.action.detachAndPaste":"Desanexar e Colar","node.action.delete":"Excluir","node.action.flipImage":"Virar Imagem","node.action.pin":"Fixar N no Topo","node.action.unpin":"Desafixar N","node.action.updateDescription":"Atualizar Descrio","node.action.modifyCharacter":"Solicitar Mudanas","node.action.updateDataFormat":"Atualizar Formato de Dados","node.action.expand169":"Expandir para 16:9","node.action.expand916":"Expandir para 9:16","node.action.sync":"Sincronizar das Conexes","node.action.expandRatio":"Expandir Proporo","node.action.markPrimary":"Marcar como Primrio","node.action.addCard":"Adicionar Carto","node.action.removeCard":"Remover Carto","node.action.showOutputs":"Mostrar Sadas","node.action.hideOutputs":"Ocultar Sadas","node.mediaViewer.play":"Reproduzir","node.mediaViewer.pause":"Pausa","node.mediaViewer.stop":"Parar","node.mediaViewer.addMarker":"Adicionar Marcador","node.mediaViewer.exportSRT":"Exportar Marcadores (SRT)","node.mediaViewer.deleteAllMarkers":"Excluir Todos os Marcadores","node.mediaViewer.saveMarkers":"Salvar Marcadores no Disco","node.mediaViewer.loadMarkers":"Carregar Marcadores do Disco","node.mediaViewer.relink":"Revincular Arquivo","node.content.notePlaceholder":"Digite suas notas aqui...","node.content.dropImage":"Solte a imagem aqui ou clique para enviar","node.content.dropMedia":"Solte vdeo ou udio aqui","node.content.processing":"Processando...","node.content.processingChain":"Processando Cadeia...","node.content.metadataPrompt":"Prompt dos Metadados da Imagem:","node.content.metadataPromptPlaceholder":"Nenhum prompt encontrado na imagem.","node.content.copyPrompt":"Usar","node.content.prompt":"Prompt","node.content.inputPrompt":"Prompt de Entrada","node.content.enhancedResult":"Resultado Aprimorado","node.content.videoPrompt":"Prompt de Vdeo","node.content.editPromptPlaceholder":"Adicione ou edite o prompt...","node.content.enhancedPromptHere":"O prompt aprimorado aparecer aqui...","node.content.safePrompt":"Seguro para uso comercial","node.content.generating":"Gerando...","node.content.imageHere":"A imagem aparecer aqui","node.content.generationMode":"Modelo de Gerao","node.content.aspectRatio":"Proporo","node.content.aspectRatioHelp":"Definir proporo para gerao de imagem","node.content.aspectRatioNotSupportedFast":"Proporo disponvel apenas para modelos Imagen.","node.content.enableAspectRatioFormatting":"Habilitar Formatao de Proporo","node.content.autoDownload":"Download Automtico","node.content.generateImage":"Gerar Imagem","node.content.enhancing":"Melhorando...","node.content.enhancePrompt":"Melhorar Prompt","node.content.sanitizing":"Higienizando...","node.content.sanitizedPromptHere":"O prompt higienizado aparecer aqui...","node.content.analyzing":"Analisando...","node.content.analyzePrompt":"Analisar Prompt","node.content.analyzeImage":"Analisar Imagem","node.content.imageToText":"Imagem para Texto","node.content.updatePromptFromImage":"Atualizar prompt da imagem","node.content.analyzeCharacter":"Analisar Personagem","node.content.generateCharacters":"Gerar Personagens","node.content.characterPromptPlaceholder":"Descreva o(s) personagem(ns) para gerar...","node.content.character":"Personagem","node.content.clothing":"Roupas","node.content.characterPlaceholder":"A descrio do personagem aparecer aqui...","node.content.clothingPlaceholder":"A descrio das roupas aparecer aqui...","node.content.appearance":"Aparncia","node.content.personality":"Personalidade","node.content.environment":"Ambiente/Cenrio","node.content.action":"Ao","node.content.emotion":"Emoo","node.content.style":"Estilo","node.content.environmentPlaceholder":"Descrio detalhada do ambiente...","node.content.charactersPlaceholder":"Lista de personagens principais...","node.content.characters":"Personagens","node.content.characterConcepts":"Conceitos de Personagem","node.content.actionPlaceholder":"Descrio da ao...","node.content.emotionPlaceholder":"Descrio da emoo...","node.content.stylePlaceholder":"Descrio do estilo artstico...","node.content.descriptionHere":"A descrio aparecer aqui...","node.content.enableOutpainting":"Habilitar Outpainting","node.content.outpaintingPromptPlaceholder":"Prompt de Outpainting...","node.content.inputImage":"Imagens de Entrada","node.content.dropOrClick":"Soltar ou Clicar","node.content.outputImage":"Imagem de Sada","node.content.applyEdit":"Aplicar Edio","node.content.editing":"Editando...","node.content.chatPlaceholder":"Digite sua mensagem...","node.content.connectedPlaceholder":"Conectado ao n, edite na fonte.","node.content.connectedNode":"Conectado via n","node.content.connectedEmpty":"O n conectado no tem imagem.","node.content.translatePlaceholder":"Texto para traduzir...","node.content.translatedTextPlaceholder":"Texto traduzido...","node.content.targetLanguage":"Idioma de Destino","node.content.translate":"Traduzir","node.content.translating":"Traduzindo...","node.content.scriptPromptPlaceholder":"Insira uma ideia de histria ou enredo...","node.content.generateScript":"Gerar Roteiro","node.content.loadScript":"Carregar Arquivo de Roteiro","node.content.summary":"Resumo","node.content.scenes":"Cenas","node.content.unrecognizedFormat":"Formato de roteiro no reconhecido.","node.content.frames":"Quadros","node.content.characterIndex":"ndice","node.content.readData":"Ler Dados","node.content.textDataHere":"Os dados de texto aparecero aqui.","node.content.noDataRead":'Conecte um n e clique em "Ler Dados" para visualizar seu contedo.',"node.content.previewError":"Erro na Visualizao","node.content.previewPlaceholder":"A visualizao aparecer aqui","node.content.imagePrompt":"Prompt de Imagem","node.output.allPromptData":"Todos os Dados de Prompt","node.note.tab.note":"Nota","node.note.tab.references":"Referncias","node.note.nestedImages":"Imagens Aninhadas","node.note.dropPlaceholder":"Solte imagens ou clique para adicionar","node.note.addCaption":"Legenda","node.note.action.shuffle":"Embaralhar","node.note.action.undoShuffle":"Desfazer Embaralhamento","node.content.characterTypeShort":"Tipo:","node.content.numberOfCharactersShort":"Qtd:","node.content.characterType.simple":"Simples","node.content.characterType.anthro":"Anthro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Item Chave","node.content.style.simple":"Simples","node.content.style.realistic":"Realista","node.content.style.3d_cartoon":"Cartoon 3D","node.content.style.3d_realistic":"Realista 3D","node.content.style.2d_animation":"Animao 2D","node.content.style.anime":"Anime","node.content.style.comics":"Quadrinhos","node.content.style.custom":"Personalizado","node.content.fullDescriptionTitle":"Descrio completa do personagem","node.content.integrationInstruction":"Instruo de integrao","node.content.additionalPromptSuffix":"Prompt Adicional (Sufixo)","image_sequence.auto_crop":"Recorte Auto 16:9","image_sequence.create_zip":"Criar Arquivo ZIP","node.content.modificationRequest":"Solicitao de modificao","node.content.technicalPrompt":"Prompt Tcnico","node.promptProcessor.safePromptTooltip":"Reescreve o prompt para cumprir as diretrizes de segurana e evitar violaes de poltica.","node.promptProcessor.technicalPromptTooltip":"Converte o prompt em uma especificao tcnica altamente detalhada (iluminao, cmera, configuraes de renderizao).","node.promptProcessor.enhanceTooltip":"Usa IA para expandir e enriquecer o prompt com detalhes descritivos.","node.promptProcessor.chainTooltip":"Executa este n e aciona todos os ns conectados a jusante.","image_sequence.tooltip.autoCrop":"Recorta automaticamente as imagens geradas para a proporo 16:9.","image_sequence.tooltip.autoDownload":"Salva automaticamente cada imagem no seu dispositivo aps a gerao.","image_sequence.tooltip.createZip":"Empacota todas as imagens selecionadas em um nico arquivo ZIP para download."},Pb={"imageEditor.title":"Editor de Imagem","imageEditor.canvasResolution":"Resoluo da Tela","imageEditor.background":"Fundo","imageEditor.toolSettings":"Configuraes da Ferramenta","imageEditor.snapToEdges":"Alinhar s Bordas","imageEditor.freeAspect":"Proporo Livre","imageEditor.section.aiRequest":"Solicitao de Modificao IA","imageEditor.input.modificationPlaceholder":'Descreva as alteraes, ex: "mudar fundo para azul"',"imageEditor.action.sendRequest":"Enviar Solicitao","imageEditor.tooltip.removeObject":"Remover (Vermelho) / Manter (Verde)","imageEditor.action.removeObject":"Remover Objeto","imageEditor.tool.transform":"Transformar","imageEditor.tool.hand":"Mo (Pan)","imageEditor.tool.zoom":"Zoom","imageEditor.tool.pencil":"Lpis","imageEditor.tool.rectangle":"Retngulo","imageEditor.action.fit":"Ajustar  Tela","imageEditor.action.fill":"Preencher Tela","imageEditor.action.cancel":"Cancelar","imageEditor.action.resetEdits":"Redefinir Edies","imageEditor.action.apply":"Aplicar","imageViewer.title":"Visualizador de Imagem","imageEditor.outputResolution":"Resoluo de Sada","imageEditor.outputResolutionHelp":'Definir resoluo de sada. Se "Auto", usa a resoluo da tela.',"imageEditor.currentSize":"Tamanho Atual: {width}x{height}","imageEditor.sequenceMode":"Modo Sequncia","imageEditor.sequenceModeHelp":"Processar imagens de entrada da Entrada A sequencialmente.","imageEditor.sequentialCombination":"Combinao Sequencial de Imagens","imageEditor.sequentialCombinationHelp":"Para cada quadro: Envia a imagem atual da Entrada A + Todas as imagens da Entrada B.","imageEditor.sequentialPrompt":"Combinao Sequencial de Prompt","imageEditor.sequentialPromptHelp":"Para cada quadro: Usa um prompt exclusivo da lista + imagem atual.","imageEditor.sequentialEditingWithPrompts":"Edio Sequencial com Prompts","imageEditor.sequentialEditingWithPromptsHelp":"Para cada quadro: Usa imagem da Entrada B + prompt exclusivo. Entrada A  ignorada.","imageEditor.input":"Entrada","imageEditor.inputA":"Entrada A","imageEditor.inputB":"Entrada B","imageEditor.status.queued":"Na Fila","imageEditor.status.generating":"Gerando...","imageEditor.action.regenerate":"Regenerar","imageEditor.tooltip.fit":"Ajustar imagem aos limites da tela (conter).","imageEditor.tooltip.fill":"Escalar imagem para preencher a tela (cobrir).","imageEditor.tooltip.flip":"Virar imagem horizontalmente.","imageEditor.background.white":"Branco","imageEditor.background.gray":"Cinza","imageEditor.background.black":"Preto","imageEditor.background.dark":"Escuro","image_sequence.regenerate":"Regenerar","image_sequence.stop_queue":"Parar Fila","image_sequence.move_up":"Mover para Cima","image_sequence.move_down":"Mover para Baixo","image_sequence.copy_prompt":"Copiar Prompt","image_sequence.add_frame":"Adicionar Quadro","image_sequence.delete_frame":"Excluir Quadro","image_sequence.expand_all_frames":"Expandir/Recolher Todos os Quadros","image_sequence.collapse_all_frames":"Recolher Todos os Quadros","image_sequence.expand_all_scenes":"Expandir/Recolher Todas as Cenas","image_sequence.collapse_all_scenes":"Recolher Todas as Cenas","image_sequence.expand_all":"Expandir Tudo","image_sequence.collapse_all":"Recolher Tudo","image_sequence.clear_all_prompts":"Limpar Todos os Prompts","image_sequence.add_first_frame":"Adicionar Primeiro Quadro","image_sequence.drop_or_add_title":"Soltar JSON de Sequncia ou Adicionar Quadro","image_sequence.drop_or_add_desc":"Solte um arquivo JSON aqui ou clique no boto para adicionar um quadro manualmente.","image_sequence.load_prompts":"Carregar Prompts","image_sequence.output_images_title":"Imagens de Sada","image_sequence.prompts_list_title":"Prompts de Origem","image_sequence.download_selected":"Baixar Selecionados","image_sequence.select_all":"Selecionar Tudo","image_sequence.select_none":"Desmarcar Tudo","image_sequence.invert_selection":"Inverter Seleo","image_sequence.run_selected":"Executar Selecionados","image_sequence.start_queue":"Iniciar Fila","image_sequence.character_prompt_combination":"Combinao de Prompt de Personagem","image_sequence.combination_none":"Nenhum","image_sequence.combination_combine":"Combinar","image_sequence.combination_replace":"Substituir Tags","image_sequence.status.error":"Erro","image_sequence.status.pending":"Na Fila","image_sequence.clear_selected_prompts":"Limpar Prompts Selecionados","image_sequence.range_from":"De:","image_sequence.range_to":"Para:","image_sequence.stats.total":"Total de Quadros: {count}","image_sequence.stats.generated":"Gerados: {count}","image_sequence.stats.queue":"Fila: {count}","image_sequence.edit_in_source":"Editar na Fonte","image_sequence.edit_prompt":"Editar Prompt","image_sequence.select_scene":"Selecionar Cena","image_sequence.next_scene":"Prxima Cena","image_sequence.prev_scene":"Cena Anterior","image_sequence.scene_input_label":"Cena","image_sequence.select_square":"Selecionar Quadrado (1:1)","image_sequence.select_landscape":"Selecionar Paisagem (16:9)","image_sequence.select_portrait":"Selecionar Retrato (9:16)","image_sequence.select_range":"Selecionar Intervalo","image_sequence.force_refresh":"Forar Atualizao","image_sequence.select_scene_frames":"Selecionar todos os quadros nesta cena","image_sequence.collapse_other_scenes":"Recolher outras cenas","prompt_sequence_editor.instructionPlaceholder":"Insira a instruo para modificar prompts...","prompt_sequence_editor.modifying":"Modificando...","prompt_sequence_editor.modifySelected":"Modificar Selecionados ({count})","prompt_sequence_editor.sourcePrompts":"Prompts de Origem","prompt_sequence_editor.finalPrompts":"Prompts Modificados","prompt_sequence_editor.error.invalidInput":"Formato de dados invlido. Por favor conecte um array de sequncia de prompts.","geminiChat.mode.general":"Geral","geminiChat.mode.prompt":"Especialista em Prompt","geminiChat.mode.script":"Roteirista","geminiChat.mode.youtube":"Analista do YouTube","image_sequence.shot_type.WS":"Integre a Entidade com um Plano Aberto (WS) na cena e ao. Mostre o ambiente.","image_sequence.shot_type.MS":"Integre a Entidade com um Plano Mdio (MS) na cena. Personagem da cintura para cima.","image_sequence.shot_type.CU":"Integre a Entidade com um Plano Prximo (CU) na cena.","image_sequence.shot_type.ECU":"Integre a Entidade com um Plano Muito Prximo (ECU) na cena. Mximo detalhe.","image_sequence.shot_type.LS":"Integre a Entidade com um Plano Longo (LS) na cena para mostrar escala."},jb={"dialog.permission.title":"Permisso Necessria","dialog.permission.description":"Este aplicativo precisa de permisso para ler sua rea de transferncia para permitir colar contedo nos ns. Seus dados no so armazenados ou enviados para lugar nenhum.","dialog.permission.allow":"Permitir","dialog.permission.decline":"Recusar","dialog.rename.title":"Renomear Item","dialog.rename.group.title":"Renomear Grupo","dialog.rename.catalog.title":"Renomear Item do Catlogo","dialog.rename.node.title":"Renomear N","dialog.rename.label":"Novo Nome:","dialog.rename.confirm":"Renomear","dialog.rename.cancel":"Cancelar","dialog.promptEdit.title":"Editar Prompt","dialog.promptEdit.nameLabel":"Nome:","dialog.promptEdit.contentLabel":"Contedo:","dialog.promptEdit.confirm":"Salvar","dialog.promptEdit.cancel":"Cancelar","dialog.confirmDelete.title":"Confirmar Excluso","dialog.confirmDelete.message":"Tem certeza de que deseja excluir este item? Esta ao no pode ser desfeita.","dialog.confirmDelete.confirm":"Excluir","dialog.confirmDelete.cancel":"Cancelar","dialog.confirmCloseTab.title":"Fechar Aba","dialog.confirmCloseTab.message":'Tem certeza de que deseja fechar a aba "{tabName}"? As alteraes no salvas sero perdidas.',"dialog.confirmClear.title":"Limpar Tela","dialog.confirmClear.message":"Tem certeza de que deseja limpar toda a tela? Esta ao no pode ser desfeita.","dialog.confirmReset.title":"Redefinir para o Padro","dialog.confirmReset.message":"Tem certeza de que deseja redefinir a tela para o estado padro? Todo o trabalho atual ser perdido.","dialog.confirmReset.confirm":"Redefinir","dialog.confirmLoad.title":"Confirmar Carregamento","dialog.confirmLoad.message":"Carregar um novo arquivo substituir o contedo atual. Quaisquer alteraes no salvas sero perdidas. Continuar?","dialog.apiKey.title":"Selecionar Chave API","dialog.apiKey.description":'Este recurso requer uma chave API de Projeto com a API "AI Platform" ativada. A gerao de vdeo pode levar alguns minutos.',"dialog.apiKey.billingLink":"Saiba mais sobre faturamento","dialog.apiKey.button":"Selecionar Chave API","dialog.settings.title":"Configuraes","dialog.settings.apiKeyLabel":"Sua Chave API Google Gemini:","dialog.settings.useDevKeyLabel":"Usar chave API gratuita (para desenvolvimento)","dialog.settings.instantNodeCloseLabel":"Fechamento instantneo de n","dialog.settings.nodeAnimationLabel":"Animao de Adio de N","dialog.settings.animationModeLabel":"Modo de Animao de Criao","dialog.settings.anim.pulse":"Pulso","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"Nenhum","dialog.settings.description":"Para usar suas prprias cotas e acessar modelos especficos, insira sua chave API pessoal. A chave  armazenada localmente no seu navegador.","dialog.settings.getKeyLink":"Obtenha uma Chave API aqui","dialog.settings.save":"Salvar","dialog.deleteNode.title":"Fechar n?","dialog.deleteNode.titlePlural":"Fechar ns?","dialog.deleteNode.confirm":"Sim","dialog.deleteNode.cancel":"No","dialog.deleteNode.confirmTooltip":"Fechar n - dados perdidos no podem ser recuperados","dialog.deleteNode.cancelTooltip":"No fechar - continuar trabalhando com o n","dialog.deleteNode.dontShowAgain":"No mostrar novamente","dialog.exitApp.title":"Fechar Projeto?","dialog.exitApp.message":"Tem certeza de que deseja fechar o projeto? Todo o trabalho atual ser perdido e a tela ser redefinida."},Tb={"group.button.create":"Criar Grupo ({count})","group.rename":"Renomear Grupo","group.saveToCatalog":"Salvar no Catlogo","group.saveToDisk":"Salvar no Disco","group.ungroup":"Desagrupar (Shift+Clique para excluir com contedo)","group.duplicate":"Duplicar grupo com contedo","catalog.tabs.groups":"Grupos","catalog.tabs.library":"Biblioteca","catalog.tabs.characters":"Personagens","catalog.tabs.scripts":"Roteiros","catalog.tabs.sequences":"Sequncias","catalog.back":"Voltar","catalog.load":"Carregar de Arquivo","catalog.newFolder":"Nova Pasta","catalog.saveTo":"Salvar no Catlogo","catalog.card.addToCanvas":"Adicionar  Tela","catalog.card.rename":"Renomear","catalog.card.save":"Salvar","catalog.card.delete":"Excluir","catalog.empty.description":"Esta pasta est vazia. Voc pode adicionar itens ou criar novas pastas.","library.loadFromFile":"Carregar","library.actions.newFolder":"Nova Pasta","library.actions.newPrompt":"Novo Prompt","library.actions.copy":"Copiar","library.actions.edit":"Editar","library.empty.title":"Pasta Vazia","library.empty.description":"Crie prompts e pastas para comear.","library.emptyPrompt":"Prompt vazio"},Ib={...Sb,...Nb,...Eb,...Pb,...jb,...Tb},Ab={"app.title":"","app.subtitle":"","app.error.title":"","app.error.copy":"","app.error.copied":"","error.apiKey":" API  API ","error.scriptModifierCanvas":" - Script Modifier Script Modifier ","welcome.title":"","welcome.description":"","welcome.apiKeyLabel":" Google Gemini API ","welcome.apiKeyPlaceholder":" API ...","welcome.apiKeyHelp":" API ","welcome.getKeyLink":" API ","welcome.iAmDeveloper":"","welcome.letsGo":"","welcome.resume":"","welcome.startNew":"","welcome.freeModeActive":"","welcome.selectLanguage":"","welcome.navHint":"    ","toast.contentCleared":"","toast.downloadStarted":"","toast.characterLoaded":"","toast.characterSavedDisk":"","toast.copiedToClipboard":"","toast.pastedFromClipboard":"","toast.pasteFailed":"","toast.nodeDuplicated":"","toast.groupSavedToDisk":' "{groupTitle}" ',"toast.groupDeleted":"","toast.characterSavedCatalog":"","toast.promptSaved":"{promptName}...","toast.connectionsCut":"","toast.apiKeySaved":"API ","toast.cacheCleared":" {count} ","toast.cacheEmpty":"","toast.scriptSaved":"","alert.groupSaved":' "{groupTitle}" ',"alert.loadCatalogFailed":"","alert.invalidCatalogFile":"","alert.fileNotSupported":' "appName"',"alert.invalidCatalogStructure":' "root"',"tutorial.step1":"","tutorial.step2":" AI ","tutorial.step2_waiting":"AI ...","tutorial.step3":"","tutorial.step3b":"","tutorial.step4":"","tutorial.group.catalog":"","tutorial.group.general":"","tutorial.group.input":"","tutorial.group.processing":" AI ","tutorial.group.character":"","tutorial.group.output":"","tutorial.group.ai":" Gemini ","tutorial.group.video":"","tutorial.group.scripts":"","tutorial.group.file":"","tutorial.success.title":"","tutorial.success.message":"","tutorial.success.button":"","tutorial.skip":"","tutorial.next":"","tutorial.finish":""},Mb={"toolbar.settings":"","toolbar.resetCanvas":"","toolbar.clearCache":"","toolbar.home":"","toolbar.edit":" (V)","toolbar.cutter":" (C) / ( Ctrl)","toolbar.selection":" (S) / ( Shift)","toolbar.reroute":" (R) / ( Ctrl+Alt)","toolbar.zoom":" ( Z)","toolbar.snapToGrid":"","toolbar.smartGuides":"","toolbar.lineStyleSpaghetti":"","toolbar.lineStyleOrthogonal":"","toolbar.resetZoom":"","toolbar.resetCamera":"","toolbar.clearCanvas":"","toolbar.addNode":" (F)","toolbar.catalog":" (Ctrl + Space)","toolbar.addNote":" (N)","toolbar.addDataReader":" (Shift + R)","toolbar.addTextInput":" (T)","toolbar.addImageInput":" (I)","toolbar.addPromptSequenceEditor":" (Q)","toolbar.addImageAnalyzer":" (Shift+A)","toolbar.addPromptAnalyzer":" (A)","toolbar.addPromptProcessor":" (P)","toolbar.addCharacterGenerator":" (Shift+C)","toolbar.addCharacterAnalyzer":" (Ctrl+Shift+A)","toolbar.addCharacterCard":" (Ctrl+Shift+C)","toolbar.addImageOutput":" (O)","toolbar.addImageEditor":" AI  (Shift+I)","toolbar.addImageSequenceGenerator":" (Shift+Q)","toolbar.addTranslator":" (L)","toolbar.addGeminiChat":" Gemini  (M)","toolbar.addVideoPromptProcessor":" (Shift+P)","toolbar.addVideoOutput":" (Shift+O)","toolbar.addScriptGenerator":"","toolbar.addScriptViewer":" (Shift + V)","toolbar.saveCanvas":" (Ctrl + S)","toolbar.saveProject":"","toolbar.loadCanvas":"/ (Ctrl + O)","toolbar.group.general":"","toolbar.group.catalog":"","toolbar.group.input":"","toolbar.group.processing":"","toolbar.group.character":"","toolbar.group.output":"","toolbar.group.aiTools":"AI ","toolbar.group.video":"","toolbar.group.scripts":"","toolbar.group.file":"","toolbar.title":"","toolbar.dock":"","toolbar.detach":"","toolbar.expandPanel":"","toolbar.collapsePanel":"","toolbar.dockArea.title":"","toolbar.duplicate":"","toolbar.duplicateWithContent":"","toolbar.dock.q1":" 1/4","toolbar.dock.q2":" 2/4","toolbar.dock.q3":" 3/4","toolbar.dock.q4":" 4/4","toolbar.dock.tl":"","toolbar.dock.bl":"","toolbar.dock.tr":"","toolbar.dock.br":"","toolbar.dock.left":"","toolbar.dock.right":"","toolbar.dock.full":"","toolbar.dock.exitFull":"","toolbar.dock.fullFocus":"","hotkeys.show":"","hotkeys.tools.title":"","hotkeys.tools.edit":"","hotkeys.tools.cutter":"","hotkeys.tools.selection":"","hotkeys.tools.reroute":"","hotkeys.tools.zoom":"","hotkeys.tools.toggleLineStyle":"","hotkeys.tools.group":"","hotkeys.tools.closeNode":"","hotkeys.tools.duplicate":"","hotkeys.tools.duplicateWithContent":"","hotkeys.tools.deleteGroup":" (Shift+Click)","hotkeys.windows.title":"","hotkeys.windows.search":"","hotkeys.windows.catalog":"","hotkeys.createNode.title":"","help.panelTitle":"","help.subtitle":"","help.title":"","help.howToUse.title":"","help.howToUse.content":"","help.author":"","help.tab.links":"","help.section.socials":"","help.section.studioStable":"Google AI Studio ()","help.section.studioAlpha":"Google AI Studio (Alpha)","help.section.netlify":"Netlify ","help.section.github":"GitHub ","help.license":" GNU GPLv3 ","help.copyLink":"","help.copied":"","contextMenu.undoPosition":"","contextMenu.redoPosition":"","contextMenu.align.left":" (F)","contextMenu.align.centerX":" (E)","contextMenu.align.right":" (R)","contextMenu.align.top":" (T)","contextMenu.align.centerY":" (D)","contextMenu.align.bottom":" (B)","contextMenu.distribute.horizontal":" (Ctrl+D)","contextMenu.distribute.vertical":" (Ctrl+E)","contextMenu.emptySlot":" ()","contextMenu.saveSlots":"","contextMenu.loadSlots":"","quickadd.title":"","quickadd.group.tools":"","quickadd.group.inputs":"","quickadd.group.processing":"","quickadd.group.character":"","quickadd.group.outputs":"","quickadd.group.ai":"AI ","quickadd.group.video":"","quickadd.group.scripts":"","quickadd.group.general":"","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"","quickadd.tool.cutter":"","quickadd.tool.selection":"","search.placeholder":"...","search.noResults":"","search.group.input":" & ","search.group.process":" & ","search.group.output":" & ","search.group.ai":"AI ","search.group.video":" & ","search.group.scripts":"","toolbar.exitApp":""},Rb={"node.title.text_input":"","node.title.image_input":"","node.title.prompt_processor":"","node.title.prompt_sanitizer":"","node.title.video_prompt_processor":"","node.title.image_output":"","node.title.video_output":"","node.title.prompt_analyzer":"","node.title.character_analyzer":"","node.title.character_generator":"","node.title.character_card":"","node.title.image_analyzer":"","node.title.image_editor":"AI ","node.title.image_sequence_generator":"","node.title.prompt_sequence_editor":"","node.title.gemini_chat":"Gemini ","node.title.translator":"","node.title.script_generator":"","node.title.script_viewer":"","node.title.note":"","node.title.reroute_dot":"","node.title.data_reader":"","node.title.video_editor":" Alpha","node.title.media_viewer":"","node.title.data_protection":"","node.title.pose_creator":"Pose Creator","node.help.text_input":"","node.help.image_input":"","node.help.prompt_processor":" AI ","node.help.prompt_sanitizer":"","node.help.video_prompt_processor":"","node.help.image_output":"","node.help.video_output":" Veo ","node.help.prompt_analyzer":"","node.help.character_analyzer":"","node.help.character_generator":"","node.help.character_card":"","node.help.image_analyzer":" AI ","node.help.image_editor":"/","node.help.image_sequence_generator":"","node.help.prompt_sequence_editor":" AI ","node.help.gemini_chat":" Gemini ","node.help.translator":" AI ","node.help.script_generator":"","node.help.script_viewer":"","node.help.note":"","node.help.reroute_dot":"","node.help.data_reader":"","node.help.video_editor":"","node.help.media_viewer":" and ","node.help.data_protection":"","node.help.pose_creator":"","node.action.expand":"","node.action.collapse":"","node.action.help":"","node.action.download":"","node.action.clear":"","node.action.refreshChat":"","node.action.paste":"","node.action.resetEditor":"","node.action.saveCharacter":"","node.action.loadCharacter":"","node.action.copy":"","node.action.copyImage":"","node.action.copyTextPrompt":"","node.action.copyImagePrompt":"","node.action.copyVideoPrompt":"","node.action.cutConnections":"","node.action.close":"","node.action.closeNode":" (Shift+Click )","node.action.closeNodeSimple":"","node.action.randomWord":"","node.action.processImage":"","node.action.processImageTitle":" Gemini ","node.action.editor":"","node.action.rasterEditor":"","node.action.openInAIEditor":" AI ","node.action.openInAnalyzer":"","node.action.outputToInput":"","node.action.processChainForward":"","node.action.executeChain":"","node.action.executeChainTitle":"","node.action.sanitize":"","node.action.rename":"","node.action.stop":"","node.action.stopping":"...","node.action.deleteItem":"","node.action.detachAndPaste":"","node.action.delete":"","node.action.flipImage":"","node.action.pin":"","node.action.unpin":"","node.mediaViewer.play":"","node.mediaViewer.pause":"","node.mediaViewer.stop":"","node.mediaViewer.addMarker":"","node.mediaViewer.exportSRT":" (SRT)","node.mediaViewer.deleteAllMarkers":"","node.mediaViewer.saveMarkers":"","node.mediaViewer.loadMarkers":"","node.mediaViewer.relink":"","node.content.notePlaceholder":"...","node.content.dropImage":"","node.content.dropMedia":"","node.content.processing":"...","node.content.processingChain":"...","node.content.metadataPrompt":"","node.content.metadataPromptPlaceholder":"","node.content.copyPrompt":"","node.content.prompt":"","node.content.inputPrompt":"","node.content.enhancedResult":"","node.content.videoPrompt":"","node.content.editPromptPlaceholder":"...","node.content.enhancedPromptHere":"...","node.content.safePrompt":"","node.content.generating":"...","node.content.imageHere":"","node.content.generationMode":"","node.content.aspectRatio":"","node.content.aspectRatioHelp":"","node.content.aspectRatioNotSupportedFast":" Imagen ","node.content.enableAspectRatioFormatting":"","node.content.autoDownload":"","node.content.generateImage":"","node.content.enhancing":"...","node.content.enhancePrompt":"","node.content.sanitizing":"...","node.content.sanitizedPromptHere":"...","node.content.analyzing":"...","node.content.analyzePrompt":"","node.content.analyzeImage":"","node.content.imageToText":"","node.content.updatePromptFromImage":"","node.content.analyzeCharacter":"","node.content.generateCharacters":"","node.content.characterPromptPlaceholder":"...","node.content.character":"","node.content.clothing":"","node.content.characterPlaceholder":"...","node.content.clothingPlaceholder":"...","node.content.appearance":"","node.content.personality":"","node.content.environment":"/","node.content.action":"","node.content.emotion":"","node.content.style":"","node.content.environmentPlaceholder":"...","node.content.charactersPlaceholder":"...","node.content.characters":"","node.content.characterConcepts":"","node.content.actionPlaceholder":"...","node.content.emotionPlaceholder":"...","node.content.stylePlaceholder":"...","node.content.descriptionHere":"...","node.content.enableOutpainting":"","node.content.outpaintingPromptPlaceholder":"...","node.content.inputImage":"","node.content.dropOrClick":"","node.content.outputImage":"","node.content.applyEdit":"","node.content.editing":"...","node.content.chatPlaceholder":"...","node.content.connectedPlaceholder":"","node.content.connectedNode":"","node.content.connectedEmpty":"","node.content.translatePlaceholder":"...","node.content.translatedTextPlaceholder":"...","node.content.targetLanguage":"","node.content.translate":"","node.content.translating":"...","node.content.scriptPromptPlaceholder":"...","node.content.generateScript":"","node.content.loadScript":"","node.content.summary":"","node.content.scenes":"","node.content.unrecognizedFormat":"","node.content.frames":"","node.content.characterIndex":"","node.content.readData":"","node.content.textDataHere":"","node.content.noDataRead":"","node.content.previewError":"","node.content.previewPlaceholder":"","node.content.imagePrompt":"","node.output.allPromptData":"","node.note.tab.note":"","node.note.tab.references":"","node.note.nestedImages":"","node.note.dropPlaceholder":"","node.note.addCaption":"","node.note.action.shuffle":"","node.note.action.undoShuffle":"","node.content.characterTypeShort":":","node.content.numberOfCharactersShort":":","node.content.characterType.simple":"","node.content.characterType.anthro":"","node.content.characterType.chibi":"Q","node.content.characterType.key_item":"","node.content.style.simple":"","node.content.style.realistic":"","node.content.style.3d_cartoon":"3D ","node.content.style.3d_realistic":"3D ","node.content.style.2d_animation":"2D ","node.content.style.anime":"","node.content.style.comics":"","node.content.style.custom":"","node.content.fullDescriptionTitle":"","node.content.integrationInstruction":"","node.content.additionalPromptSuffix":" ()","image_sequence.auto_crop":" 16:9","image_sequence.create_zip":" ZIP ","node.content.modificationRequest":"","node.content.technicalPrompt":"","node.promptProcessor.safePromptTooltip":"","node.promptProcessor.technicalPromptTooltip":"","node.promptProcessor.enhanceTooltip":" AI ","node.promptProcessor.chainTooltip":"","image_sequence.tooltip.autoCrop":" 16:9 ","image_sequence.tooltip.autoDownload":"","image_sequence.tooltip.createZip":" ZIP "},Lb={"imageEditor.title":"","imageEditor.canvasResolution":"","imageEditor.background":"","imageEditor.toolSettings":"","imageEditor.snapToEdges":"","imageEditor.freeAspect":"","imageEditor.section.aiRequest":"AI ","imageEditor.input.modificationPlaceholder":"","imageEditor.action.sendRequest":"","imageEditor.tooltip.removeObject":" () /  ()","imageEditor.action.removeObject":"","imageEditor.tool.transform":"","imageEditor.tool.hand":" ()","imageEditor.tool.zoom":"","imageEditor.tool.pencil":"","imageEditor.tool.rectangle":"","imageEditor.action.fit":"","imageEditor.action.fill":"","imageEditor.action.cancel":"","imageEditor.action.resetEdits":"","imageEditor.action.apply":"","imageViewer.title":"","imageEditor.outputResolution":"","imageEditor.outputResolutionHelp":"","imageEditor.currentSize":": {width}x{height}","imageEditor.sequenceMode":"","imageEditor.sequenceModeHelp":" A ","imageEditor.sequentialCombination":"","imageEditor.sequentialCombinationHelp":" A  +  B ","imageEditor.sequentialPrompt":"","imageEditor.sequentialPromptHelp":" + ","imageEditor.sequentialEditingWithPrompts":"","imageEditor.sequentialEditingWithPromptsHelp":" B  +  A ","imageEditor.input":"","imageEditor.inputA":" A","imageEditor.inputB":" B","imageEditor.status.queued":"","imageEditor.status.generating":"...","imageEditor.action.regenerate":"","imageEditor.tooltip.fit":" (contain)","imageEditor.tooltip.fill":" (cover)","imageEditor.tooltip.flip":"","imageEditor.background.white":"","imageEditor.background.gray":"","imageEditor.background.black":"","imageEditor.background.dark":"","image_sequence.regenerate":"","image_sequence.stop_queue":"","image_sequence.move_up":"","image_sequence.move_down":"","image_sequence.copy_prompt":"","image_sequence.add_frame":"","image_sequence.delete_frame":"","image_sequence.expand_all_frames":"/","image_sequence.collapse_all_frames":"","image_sequence.expand_all_scenes":"/","image_sequence.collapse_all_scenes":"","image_sequence.expand_all":"","image_sequence.collapse_all":"","image_sequence.clear_all_prompts":"","image_sequence.add_first_frame":"","image_sequence.drop_or_add_title":" JSON ","image_sequence.drop_or_add_desc":" JSON ","image_sequence.load_prompts":"","image_sequence.output_images_title":"","image_sequence.prompts_list_title":"","image_sequence.download_selected":"","image_sequence.select_all":"","image_sequence.select_none":"","image_sequence.invert_selection":"","image_sequence.run_selected":"","image_sequence.start_queue":"","image_sequence.character_prompt_combination":"","image_sequence.combination_none":"","image_sequence.combination_combine":"","image_sequence.combination_replace":"","image_sequence.status.error":"","image_sequence.status.pending":"","image_sequence.clear_selected_prompts":"","image_sequence.range_from":":","image_sequence.range_to":":","image_sequence.stats.total":": {count}","image_sequence.stats.generated":": {count}","image_sequence.stats.queue":": {count}","image_sequence.edit_in_source":"","image_sequence.edit_prompt":"","image_sequence.select_scene":"","image_sequence.next_scene":"","image_sequence.prev_scene":"","image_sequence.scene_input_label":"","image_sequence.select_square":" (1:1)","image_sequence.select_landscape":" (16:9)","image_sequence.select_portrait":" (9:16)","image_sequence.select_range":"","image_sequence.force_refresh":"","image_sequence.select_scene_frames":"","image_sequence.collapse_other_scenes":"","prompt_sequence_editor.instructionPlaceholder":"...","prompt_sequence_editor.modifying":"...","prompt_sequence_editor.modifySelected":" ({count})","prompt_sequence_editor.sourcePrompts":"","prompt_sequence_editor.finalPrompts":"","prompt_sequence_editor.error.invalidInput":"","geminiChat.mode.general":"","geminiChat.mode.prompt":"","geminiChat.mode.script":"","geminiChat.mode.youtube":"YouTube ","image_sequence.shot_type.WS":" (WS) ","image_sequence.shot_type.MS":" (MS) ","image_sequence.shot_type.CU":" (CU) ","image_sequence.shot_type.ECU":" (ECU) ","image_sequence.shot_type.LS":" (LS) "},Db={"dialog.permission.title":"","dialog.permission.description":"","dialog.permission.allow":"","dialog.permission.decline":"","dialog.rename.title":"","dialog.rename.group.title":"","dialog.rename.catalog.title":"","dialog.rename.node.title":"","dialog.rename.label":"","dialog.rename.confirm":"","dialog.rename.cancel":"","dialog.promptEdit.title":"","dialog.promptEdit.nameLabel":"","dialog.promptEdit.contentLabel":"","dialog.promptEdit.confirm":"","dialog.promptEdit.cancel":"","dialog.confirmDelete.title":"","dialog.confirmDelete.message":"","dialog.confirmDelete.confirm":"","dialog.confirmDelete.cancel":"","dialog.confirmCloseTab.title":"","dialog.confirmCloseTab.message":' "{tabName}" ',"dialog.confirmClear.title":"","dialog.confirmClear.message":"","dialog.confirmReset.title":"","dialog.confirmReset.message":"","dialog.confirmReset.confirm":"","dialog.confirmLoad.title":"","dialog.confirmLoad.message":"","dialog.apiKey.title":" API ","dialog.apiKey.description":' "AI Platform" API  API ',"dialog.apiKey.billingLink":"","dialog.apiKey.button":" API ","dialog.settings.title":"","dialog.settings.apiKeyLabel":" Google Gemini API ","dialog.settings.useDevKeyLabel":" API ","dialog.settings.instantNodeCloseLabel":"","dialog.settings.nodeAnimationLabel":"","dialog.settings.animationModeLabel":"","dialog.settings.anim.pulse":"","dialog.settings.anim.bladeRunner":"","dialog.settings.anim.none":"","dialog.settings.description":" API ","dialog.settings.getKeyLink":" API ","dialog.settings.save":"","dialog.deleteNode.title":"","dialog.deleteNode.titlePlural":"","dialog.deleteNode.confirm":"","dialog.deleteNode.cancel":"","dialog.deleteNode.confirmTooltip":" - ","dialog.deleteNode.cancelTooltip":" - ","dialog.deleteNode.dontShowAgain":"","dialog.exitApp.title":"","dialog.exitApp.message":""},zb={"group.button.create":" ({count})","group.rename":"","group.saveToCatalog":"","group.saveToDisk":"","group.ungroup":" (Shift+Click )","group.duplicate":"","catalog.tabs.groups":"","catalog.tabs.library":"","catalog.tabs.characters":"","catalog.tabs.scripts":"","catalog.tabs.sequences":"","catalog.back":"","catalog.load":"","catalog.newFolder":"","catalog.saveTo":"","catalog.card.addToCanvas":"","catalog.card.rename":"","catalog.card.save":"","catalog.card.delete":"","catalog.empty.description":"","library.loadFromFile":"","library.actions.newFolder":"","library.actions.newPrompt":"","library.actions.copy":"","library.actions.edit":"","library.empty.title":"","library.empty.description":"","library.emptyPrompt":""},qb={...Ab,...Mb,...Rb,...Lb,...Db,...zb},Ob={"app.title":"","app.subtitle":"","app.error.title":"","app.error.copy":"","app.error.copied":"","error.apiKey":"APIAPI","error.scriptModifierCanvas":"Script ModifierScript Modifier","welcome.title":"","welcome.description":"Prompt Modifier","welcome.apiKeyLabel":"Google Gemini API","welcome.apiKeyPlaceholder":"API...","welcome.apiKeyHelp":"API","welcome.getKeyLink":"API","welcome.iAmDeveloper":"","welcome.letsGo":"","welcome.resume":"","welcome.startNew":"","welcome.freeModeActive":"","welcome.selectLanguage":"","welcome.navHint":"    ","toast.contentCleared":"","toast.downloadStarted":"","toast.characterLoaded":"","toast.characterSavedDisk":"","toast.copiedToClipboard":"","toast.pastedFromClipboard":"","toast.pasteFailed":"","toast.nodeDuplicated":"","toast.groupSavedToDisk":' "{groupTitle}" ',"toast.groupDeleted":"","toast.characterSavedCatalog":"","toast.promptSaved":": {promptName}...","toast.connectionsCut":"","toast.apiKeySaved":"API","toast.cacheCleared":"{count} ","toast.cacheEmpty":"","toast.scriptSaved":"","alert.groupSaved":' "{groupTitle}" ',"alert.loadCatalogFailed":"","alert.invalidCatalogFile":"","alert.fileNotSupported":'"appName" ',"alert.invalidCatalogStructure":'"root" ',"tutorial.step1":"","tutorial.step2":"AI","tutorial.step2_waiting":"AI...","tutorial.step3":"","tutorial.step3b":"","tutorial.step4":"","tutorial.group.catalog":"","tutorial.group.general":"","tutorial.group.input":"","tutorial.group.processing":"AI","tutorial.group.character":"","tutorial.group.output":"","tutorial.group.ai":"Gemini","tutorial.group.video":"","tutorial.group.scripts":"","tutorial.group.file":"","tutorial.success.title":"","tutorial.success.message":"Prompt Modifier","tutorial.success.button":"","tutorial.skip":"","tutorial.next":"","tutorial.finish":""},Fb={"toolbar.settings":"","toolbar.resetCanvas":"","toolbar.clearCache":"","toolbar.home":"","toolbar.edit":" (V)","toolbar.cutter":" (C) / (Ctrl)","toolbar.selection":" (S) / (Shift)","toolbar.reroute":" (R) / (Ctrl+Alt)","toolbar.zoom":" (Z)","toolbar.snapToGrid":"","toolbar.smartGuides":"","toolbar.lineStyleSpaghetti":"","toolbar.lineStyleOrthogonal":"","toolbar.resetZoom":"","toolbar.resetCamera":"","toolbar.clearCanvas":"","toolbar.addNode":" (F)","toolbar.catalog":" (Ctrl + Space)","toolbar.addNote":" (N)","toolbar.addDataReader":" (Shift + R)","toolbar.addTextInput":" (T)","toolbar.addImageInput":" (I)","toolbar.addPromptSequenceEditor":" (Q)","toolbar.addImageAnalyzer":" (Shift+A)","toolbar.addPromptAnalyzer":" (A)","toolbar.addPromptProcessor":" (P)","toolbar.addCharacterGenerator":" (Shift+C)","toolbar.addCharacterAnalyzer":" (Ctrl+Shift+A)","toolbar.addCharacterCard":" (Ctrl+Shift+C)","toolbar.addImageOutput":" (O)","toolbar.addImageEditor":"AI (Shift+I)","toolbar.addImageSequenceGenerator":" (Shift+Q)","toolbar.addTranslator":" (L)","toolbar.addGeminiChat":"Gemini (M)","toolbar.addVideoPromptProcessor":" (Shift+P)","toolbar.addVideoOutput":" (Shift+O)","toolbar.addScriptGenerator":"","toolbar.addScriptViewer":" (Shift + V)","toolbar.saveCanvas":" (Ctrl + S)","toolbar.saveProject":"","toolbar.loadCanvas":"/ (Ctrl + O)","toolbar.group.general":"","toolbar.group.catalog":"","toolbar.group.input":"","toolbar.group.processing":"","toolbar.group.character":"","toolbar.group.output":"","toolbar.group.aiTools":"AI","toolbar.group.video":"","toolbar.group.scripts":"","toolbar.group.file":"","toolbar.title":"","toolbar.dock":"","toolbar.detach":"","toolbar.expandPanel":"","toolbar.collapsePanel":"","toolbar.dockArea.title":"","toolbar.duplicate":"","toolbar.duplicateWithContent":"","toolbar.dock.q1":" 1/4","toolbar.dock.q2":" 2/4","toolbar.dock.q3":" 3/4","toolbar.dock.q4":" 4/4","toolbar.dock.tl":"","toolbar.dock.bl":"","toolbar.dock.tr":"","toolbar.dock.br":"","toolbar.dock.left":"","toolbar.dock.right":"","toolbar.dock.full":"","toolbar.dock.exitFull":"","toolbar.dock.fullFocus":"","hotkeys.show":"","hotkeys.tools.title":"","hotkeys.tools.edit":"","hotkeys.tools.cutter":"","hotkeys.tools.selection":"","hotkeys.tools.reroute":"","hotkeys.tools.zoom":"","hotkeys.tools.toggleLineStyle":"","hotkeys.tools.group":"","hotkeys.tools.closeNode":"","hotkeys.tools.duplicate":"","hotkeys.tools.duplicateWithContent":"","hotkeys.tools.deleteGroup":" (Shift+)","hotkeys.windows.title":"","hotkeys.windows.search":"","hotkeys.windows.catalog":"","hotkeys.createNode.title":"","help.panelTitle":" & ","help.subtitle":"","help.title":"","help.howToUse.title":"","help.howToUse.content":"Prompt Modifier","help.author":"","help.tab.links":" & ","help.section.socials":"","help.section.studioStable":"Google AI Studio ()","help.section.studioAlpha":"Google AI Studio ()","help.section.netlify":"Netlify ","help.section.github":"GitHub ","help.license":"GNU GPLv3 ","help.copyLink":"","help.copied":"","contextMenu.undoPosition":"","contextMenu.redoPosition":"","contextMenu.align.left":" (F)","contextMenu.align.centerX":" (E)","contextMenu.align.right":" (R)","contextMenu.align.top":" (T)","contextMenu.align.centerY":" (D)","contextMenu.align.bottom":" (B)","contextMenu.distribute.horizontal":" (Ctrl+D)","contextMenu.distribute.vertical":" (Ctrl+E)","contextMenu.emptySlot":" ()","contextMenu.saveSlots":"","contextMenu.loadSlots":"","quickadd.title":"","quickadd.group.tools":"","quickadd.group.inputs":"","quickadd.group.processing":"","quickadd.group.character":"","quickadd.group.outputs":"","quickadd.group.ai":"AI","quickadd.group.video":"","quickadd.group.scripts":"","quickadd.group.general":"","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"","quickadd.tool.cutter":"","quickadd.tool.selection":"","search.placeholder":"...","search.noResults":"","search.group.input":" & ","search.group.process":" & ","search.group.output":" & ","search.group.ai":"AI","search.group.video":" & ","search.group.scripts":"","toolbar.exitApp":""},Bb={"node.title.text_input":"","node.title.image_input":"","node.title.prompt_processor":"","node.title.prompt_sanitizer":"","node.title.video_prompt_processor":"","node.title.image_output":"","node.title.video_output":"","node.title.prompt_analyzer":"","node.title.character_analyzer":"","node.title.character_generator":"","node.title.character_card":"","node.title.image_analyzer":"","node.title.image_editor":"AI","node.title.image_sequence_generator":"","node.title.prompt_sequence_editor":"","node.title.gemini_chat":"Gemini","node.title.translator":"","node.title.script_generator":"","node.title.script_viewer":"","node.title.note":"","node.title.reroute_dot":"","node.title.data_reader":"","node.title.video_editor":" (Alpha)","node.title.media_viewer":"","node.title.data_protection":"","node.title.pose_creator":"","node.help.text_input":"","node.help.image_input":"","node.help.prompt_processor":"AI1","node.help.prompt_sanitizer":"","node.help.video_prompt_processor":"","node.help.image_output":"","node.help.video_output":"Veo","node.help.prompt_analyzer":"","node.help.character_analyzer":"","node.help.character_generator":"","node.help.character_card":"","node.help.image_analyzer":"AI","node.help.image_editor":"/","node.help.image_sequence_generator":"","node.help.prompt_sequence_editor":"AI","node.help.gemini_chat":"Gemini","node.help.translator":"AI","node.help.script_generator":"","node.help.script_viewer":"","node.help.note":"","node.help.reroute_dot":"","node.help.data_reader":"","node.help.video_editor":"","node.help.media_viewer":"","node.help.data_protection":"","node.help.pose_creator":"","node.action.expand":"","node.action.collapse":"","node.action.help":"","node.action.download":"","node.action.clear":"","node.action.refreshChat":"","node.action.paste":"","node.action.resetEditor":"","node.action.saveCharacter":"","node.action.loadCharacter":"","node.action.copy":"","node.action.copyImage":"","node.action.copyTextPrompt":"","node.action.copyImagePrompt":"","node.action.copyVideoPrompt":"","node.action.cutConnections":"","node.action.close":"","node.action.closeNode":" (Shift+)","node.action.closeNodeSimple":"","node.action.randomWord":"","node.action.processImage":"","node.action.processImageTitle":"Gemini","node.action.editor":"","node.action.rasterEditor":"","node.action.openInAIEditor":"AI","node.action.openInAnalyzer":"","node.action.outputToInput":"","node.action.processChainForward":"","node.action.executeChain":"","node.action.executeChainTitle":"","node.action.sanitize":"","node.action.rename":"","node.action.stop":"","node.action.stopping":"...","node.action.deleteItem":"","node.action.detachAndPaste":"","node.action.delete":"","node.action.flipImage":"","node.action.pin":"","node.action.unpin":"","node.action.updateDescription":"","node.action.modifyCharacter":"","node.action.updateDataFormat":"","node.action.expand169":"16:9","node.action.expand916":"9:16","node.action.sync":"","node.action.expandRatio":"","node.action.markPrimary":"","node.action.addCard":"","node.action.removeCard":"","node.action.showOutputs":"","node.action.hideOutputs":"","node.action.characterConcept":"","node.action.objectConcept":"","node.mediaViewer.play":"","node.mediaViewer.pause":"","node.mediaViewer.stop":"","node.mediaViewer.addMarker":"","node.mediaViewer.exportSRT":" (SRT)","node.mediaViewer.deleteAllMarkers":"","node.mediaViewer.saveMarkers":"","node.mediaViewer.loadMarkers":"","node.mediaViewer.relink":"","node.content.notePlaceholder":"...","node.content.dropImage":"","node.content.dropMedia":"","node.content.processing":"...","node.content.processingChain":"...","node.content.metadataPrompt":":","node.content.metadataPromptPlaceholder":"","node.content.copyPrompt":"","node.content.prompt":"","node.content.inputPrompt":"","node.content.enhancedResult":"","node.content.videoPrompt":"","node.content.editPromptPlaceholder":"...","node.content.enhancedPromptHere":"...","node.content.safePrompt":"","node.content.generating":"...","node.content.imageHere":"","node.content.generationMode":"","node.content.aspectRatio":"","node.content.aspectRatioHelp":"","node.content.aspectRatioNotSupportedFast":"Imagen","node.content.enableAspectRatioFormatting":"","node.content.autoDownload":"","node.content.generateImage":"","node.content.enhancing":"...","node.content.enhancePrompt":"","node.content.sanitizing":"...","node.content.sanitizedPromptHere":"...","node.content.analyzing":"...","node.content.analyzePrompt":"","node.content.analyzeImage":"","node.content.imageToText":"","node.content.updatePromptFromImage":"","node.content.analyzeCharacter":"","node.content.generateCharacters":"","node.content.characterPromptPlaceholder":"...","node.content.character":"","node.content.clothing":"","node.content.characterPlaceholder":"...","node.content.clothingPlaceholder":"...","node.content.appearance":"","node.content.personality":"","node.content.environment":"/","node.content.action":"","node.content.emotion":"","node.content.style":"","node.content.environmentPlaceholder":"...","node.content.charactersPlaceholder":"...","node.content.characters":"","node.content.characterConcepts":"","node.content.actionPlaceholder":"...","node.content.emotionPlaceholder":"...","node.content.stylePlaceholder":"...","node.content.descriptionHere":"...","node.content.enableOutpainting":"","node.content.outpaintingPromptPlaceholder":"...","node.content.inputImage":"","node.content.dropOrClick":"","node.content.outputImage":"","node.content.applyEdit":"","node.content.editing":"...","node.content.chatPlaceholder":"...","node.content.connectedPlaceholder":"","node.content.connectedNode":"","node.content.connectedEmpty":"","node.content.translatePlaceholder":"...","node.content.translatedTextPlaceholder":"...","node.content.targetLanguage":"","node.content.translate":"","node.content.translating":"...","node.content.scriptPromptPlaceholder":"...","node.content.generateScript":"","node.content.loadScript":"","node.content.summary":"","node.content.scenes":"","node.content.unrecognizedFormat":"","node.content.frames":"","node.content.characterIndex":"","node.content.readData":"","node.content.textDataHere":"","node.content.noDataRead":"","node.content.previewError":"","node.content.previewPlaceholder":"","node.content.imagePrompt":"","node.output.allPromptData":"","node.note.tab.note":"","node.note.tab.references":"","node.note.nestedImages":"","node.note.dropPlaceholder":"","node.note.addCaption":"","node.note.action.shuffle":"","node.note.action.undoShuffle":"","node.content.characterTypeShort":":","node.content.numberOfCharactersShort":":","node.content.characterType.simple":"","node.content.characterType.anthro":"","node.content.characterType.chibi":"","node.content.characterType.key_item":"","node.content.style.simple":"","node.content.style.realistic":"","node.content.style.3d_cartoon":"3D","node.content.style.3d_realistic":"3D","node.content.style.2d_animation":"2D","node.content.style.anime":"","node.content.style.comics":"","node.content.style.custom":"","node.content.fullDescriptionTitle":"","node.content.integrationInstruction":"","node.content.additionalPromptSuffix":" ()","image_sequence.auto_crop":" 16:9","image_sequence.create_zip":"ZIP","node.content.modificationRequest":"","node.content.technicalPrompt":"","node.promptProcessor.safePromptTooltip":"","node.promptProcessor.technicalPromptTooltip":"","node.promptProcessor.enhanceTooltip":"AI","node.promptProcessor.chainTooltip":"","image_sequence.tooltip.autoCrop":"16:9","image_sequence.tooltip.autoDownload":"","image_sequence.tooltip.createZip":"ZIP"},Hb={"imageEditor.title":"","imageEditor.canvasResolution":"","imageEditor.background":"","imageEditor.toolSettings":"","imageEditor.snapToEdges":"","imageEditor.freeAspect":"","imageEditor.section.aiRequest":"AI","imageEditor.input.modificationPlaceholder":"","imageEditor.action.sendRequest":"","imageEditor.tooltip.removeObject":" () /  ()","imageEditor.action.removeObject":"","imageEditor.action.removeBackground":"","imageEditor.tool.transform":"","imageEditor.tool.hand":"","imageEditor.tool.zoom":"","imageEditor.tool.pencil":"","imageEditor.tool.rectangle":"","imageEditor.action.fit":"","imageEditor.action.fill":"","imageEditor.action.cancel":"","imageEditor.action.resetEdits":"","imageEditor.action.apply":"","imageViewer.title":"","imageEditor.outputResolution":"","imageEditor.outputResolutionHelp":"Auto","imageEditor.currentSize":": {width}x{height}","imageEditor.sequenceMode":"","imageEditor.sequenceModeHelp":"A","imageEditor.sequentialCombination":"","imageEditor.sequentialCombinationHelp":"A + B","imageEditor.sequentialPrompt":"","imageEditor.sequentialPromptHelp":" + ","imageEditor.sequentialEditingWithPrompts":"","imageEditor.sequentialEditingWithPromptsHelp":"B + A","imageEditor.input":"","imageEditor.inputA":" A","imageEditor.inputB":" B","imageEditor.status.queued":"","imageEditor.status.generating":"...","imageEditor.action.regenerate":"","imageEditor.tooltip.fit":" (contain)","imageEditor.tooltip.fill":" (cover)","imageEditor.tooltip.flip":"","imageEditor.background.white":"","imageEditor.background.gray":"","imageEditor.background.black":"","imageEditor.background.dark":"","image_sequence.regenerate":"","image_sequence.stop_queue":"","image_sequence.move_up":"","image_sequence.move_down":"","image_sequence.copy_prompt":"","image_sequence.add_frame":"","image_sequence.delete_frame":"","image_sequence.expand_all_frames":"/","image_sequence.collapse_all_frames":"","image_sequence.expand_all_scenes":"/","image_sequence.collapse_all_scenes":"","image_sequence.expand_all":"","image_sequence.collapse_all":"","image_sequence.clear_all_prompts":"","image_sequence.add_first_frame":"","image_sequence.drop_or_add_title":"JSON","image_sequence.drop_or_add_desc":"JSON","image_sequence.load_prompts":"","image_sequence.output_images_title":"","image_sequence.prompts_list_title":"","image_sequence.download_selected":"","image_sequence.select_all":"","image_sequence.select_none":"","image_sequence.invert_selection":"","image_sequence.run_selected":"","image_sequence.start_queue":"","image_sequence.character_prompt_combination":"","image_sequence.combination_none":"","image_sequence.combination_combine":"","image_sequence.combination_replace":"","image_sequence.status.error":"","image_sequence.status.pending":"","image_sequence.clear_selected_prompts":"","image_sequence.range_from":":","image_sequence.range_to":":","image_sequence.stats.total":": {count}","image_sequence.stats.generated":": {count}","image_sequence.stats.queue":": {count}","image_sequence.edit_in_source":"","image_sequence.edit_prompt":"","image_sequence.select_scene":"","image_sequence.next_scene":"","image_sequence.prev_scene":"","image_sequence.scene_input_label":"","image_sequence.select_square":" (1:1) ","image_sequence.select_landscape":" (16:9) ","image_sequence.select_portrait":" (9:16) ","image_sequence.select_range":"","image_sequence.force_refresh":"","image_sequence.select_scene_frames":"","image_sequence.collapse_other_scenes":"","prompt_sequence_editor.instructionPlaceholder":"...","prompt_sequence_editor.modifying":"...","prompt_sequence_editor.modifySelected":" ({count})","prompt_sequence_editor.sourcePrompts":"","prompt_sequence_editor.finalPrompts":"","prompt_sequence_editor.error.invalidInput":"","geminiChat.mode.general":"","geminiChat.mode.prompt":"","geminiChat.mode.script":"","geminiChat.mode.youtube":"YouTube","image_sequence.shot_type.WS":" (WS) ","image_sequence.shot_type.MS":" (MS) ","image_sequence.shot_type.CU":" (CU) ","image_sequence.shot_type.ECU":" (ECU) ","image_sequence.shot_type.LS":" (LS) "},Gb={"dialog.permission.title":"","dialog.permission.description":"","dialog.permission.allow":"","dialog.permission.decline":"","dialog.rename.title":"","dialog.rename.group.title":"","dialog.rename.catalog.title":"","dialog.rename.node.title":"","dialog.rename.label":":","dialog.rename.confirm":"","dialog.rename.cancel":"","dialog.promptEdit.title":"","dialog.promptEdit.nameLabel":":","dialog.promptEdit.contentLabel":":","dialog.promptEdit.confirm":"","dialog.promptEdit.cancel":"","dialog.confirmDelete.title":"","dialog.confirmDelete.message":"","dialog.confirmDelete.confirm":"","dialog.confirmDelete.cancel":"","dialog.confirmCloseTab.title":"","dialog.confirmCloseTab.message":' "{tabName}" ',"dialog.confirmClear.title":"","dialog.confirmClear.message":"","dialog.confirmReset.title":"","dialog.confirmReset.message":"","dialog.confirmReset.confirm":"","dialog.confirmLoad.title":"","dialog.confirmLoad.message":"","dialog.apiKey.title":"API","dialog.apiKey.description":"AI PlatformAPIAPI","dialog.apiKey.billingLink":"","dialog.apiKey.button":"API","dialog.settings.title":"","dialog.settings.apiKeyLabel":"Google Gemini API:","dialog.settings.useDevKeyLabel":"API ()","dialog.settings.instantNodeCloseLabel":"","dialog.settings.nodeAnimationLabel":"","dialog.settings.animationModeLabel":"","dialog.settings.anim.pulse":"","dialog.settings.anim.bladeRunner":"","dialog.settings.anim.none":"","dialog.settings.description":"API","dialog.settings.getKeyLink":"API","dialog.settings.save":"","dialog.deleteNode.title":"","dialog.deleteNode.titlePlural":"","dialog.deleteNode.confirm":"","dialog.deleteNode.cancel":"","dialog.deleteNode.confirmTooltip":" - ","dialog.deleteNode.cancelTooltip":" - ","dialog.deleteNode.dontShowAgain":"","dialog.exitApp.title":"","dialog.exitApp.message":""},Ub={"group.button.create":" ({count})","group.rename":"","group.saveToCatalog":"","group.saveToDisk":"","group.ungroup":" (Shift+)","group.duplicate":"","catalog.tabs.groups":"","catalog.tabs.library":"","catalog.tabs.characters":"","catalog.tabs.scripts":"","catalog.tabs.sequences":"","catalog.back":"","catalog.load":"","catalog.newFolder":"","catalog.saveTo":"","catalog.card.addToCanvas":"","catalog.card.rename":"","catalog.card.save":"","catalog.card.delete":"","catalog.empty.description":"","library.loadFromFile":"","library.actions.newFolder":"","library.actions.newPrompt":"","library.actions.copy":"","library.actions.edit":"","library.empty.title":"","library.empty.description":"","library.emptyPrompt":""},Vb={...Ob,...Fb,...Bb,...Hb,...Gb,...Ub},Wb={"app.title":" ","app.subtitle":"   ","app.error.title":"","app.error.copy":" ","app.error.copied":"!","error.apiKey":"API     .  API   .","error.scriptModifierCanvas":'    "Script Modifier" .    Script Modifier  .',"welcome.title":"","welcome.description":"Prompt Modifier   .    .     .","welcome.apiKeyLabel":"Google Gemini API ","welcome.apiKeyPlaceholder":" API  ...","welcome.apiKeyHelp":"API    .","welcome.getKeyLink":"API  ","welcome.iAmDeveloper":" ","welcome.letsGo":"","welcome.resume":"","welcome.startNew":" ","welcome.freeModeActive":"  ","welcome.selectLanguage":"  ","welcome.navHint":"        ","toast.contentCleared":" ","toast.downloadStarted":" ","toast.characterLoaded":"  ","toast.characterSavedDisk":"   ","toast.copiedToClipboard":" ","toast.pastedFromClipboard":" ","toast.pasteFailed":" ","toast.nodeDuplicated":" ","toast.groupSavedToDisk":'"{groupTitle}"   ',"toast.groupDeleted":"   ","toast.characterSavedCatalog":"  ","toast.promptSaved":"  : {promptName}...","toast.connectionsCut":" ","toast.apiKeySaved":"API   ","toast.cacheCleared":" {count}    ","toast.cacheEmpty":"   ","toast.scriptSaved":"  ","alert.groupSaved":'"{groupTitle}"   .',"alert.loadCatalogFailed":"   ","alert.invalidCatalogFile":"    ","alert.fileNotSupported":'  . "appName"   .',"alert.invalidCatalogStructure":'   . "root" .',"tutorial.step1":"     .","tutorial.step2":'" "  AI   .',"tutorial.step2_waiting":"AI       ...","tutorial.step3":",    .","tutorial.step3b":"   .      .","tutorial.step4":"        .","tutorial.group.catalog":"     .","tutorial.group.general":"      .","tutorial.group.input":",      .","tutorial.group.processing":"AI    .","tutorial.group.character":"  ,   .","tutorial.group.output":"   .","tutorial.group.ai":"Gemini   .","tutorial.group.video":"     .","tutorial.group.scripts":"     .","tutorial.group.file":" ,    .","tutorial.success.title":" !","tutorial.success.message":"Prompt Modifier   .     !","tutorial.success.button":" ","tutorial.skip":"","tutorial.next":"","tutorial.finish":""},$b={"toolbar.settings":"","toolbar.resetCanvas":" ","toolbar.clearCache":"  ","toolbar.home":"","toolbar.edit":" (V)","toolbar.cutter":"  (C) / (Ctrl )","toolbar.selection":" (S) / (Shift )","toolbar.reroute":"  (R) / (Ctrl+Alt )","toolbar.zoom":"/ (Z )","toolbar.snapToGrid":" ","toolbar.smartGuides":" ","toolbar.lineStyleSpaghetti":" ","toolbar.lineStyleOrthogonal":" ","toolbar.resetZoom":" ","toolbar.resetCamera":"  ","toolbar.clearCanvas":" ","toolbar.addNode":"  (F)","toolbar.catalog":"  (Ctrl + Space)","toolbar.addNote":"  (N)","toolbar.addDataReader":"   (Shift + R)","toolbar.addTextInput":"   (T)","toolbar.addImageInput":"   (I)","toolbar.addPromptSequenceEditor":"    (Q)","toolbar.addImageAnalyzer":"   (Shift+A)","toolbar.addPromptAnalyzer":"   (A)","toolbar.addPromptProcessor":"   (P)","toolbar.addCharacterGenerator":"   (Shift+C)","toolbar.addCharacterAnalyzer":"   (Ctrl+Shift+A)","toolbar.addCharacterCard":"   (Ctrl+Shift+C)","toolbar.addImageOutput":"   (O)","toolbar.addImageEditor":"AI    (Shift+I)","toolbar.addImageSequenceGenerator":"    (Shift+Q)","toolbar.addTranslator":"  (L)","toolbar.addGeminiChat":"Gemini   (M)","toolbar.addVideoPromptProcessor":"    (Shift+P)","toolbar.addVideoOutput":"   (Shift+O)","toolbar.addScriptGenerator":"  ","toolbar.addScriptViewer":"   (Shift + V)","toolbar.saveCanvas":"  (Ctrl + S)","toolbar.saveProject":" ","toolbar.loadCanvas":"/  (Ctrl + O)","toolbar.group.general":"","toolbar.group.catalog":"","toolbar.group.input":"","toolbar.group.processing":"","toolbar.group.character":"","toolbar.group.output":"","toolbar.group.aiTools":"AI ","toolbar.group.video":"","toolbar.group.scripts":"","toolbar.group.file":"","toolbar.title":" ","toolbar.dock":"  ","toolbar.detach":"  ","toolbar.expandPanel":" ","toolbar.collapsePanel":" ","toolbar.dockArea.title":" ","toolbar.duplicate":" ","toolbar.duplicateWithContent":"  ","toolbar.dock.q1":" 1/4","toolbar.dock.q2":" 2/4","toolbar.dock.q3":" 3/4","toolbar.dock.q4":" 4/4","toolbar.dock.tl":" ","toolbar.dock.bl":" ","toolbar.dock.tr":" ","toolbar.dock.br":" ","toolbar.dock.left":" ","toolbar.dock.right":" ","toolbar.dock.full":" ","toolbar.dock.exitFull":"  ","toolbar.dock.fullFocus":"  ","hotkeys.show":" ","hotkeys.tools.title":"","hotkeys.tools.edit":" ","hotkeys.tools.cutter":" ","hotkeys.tools.selection":" ","hotkeys.tools.reroute":"  ","hotkeys.tools.zoom":" ","hotkeys.tools.toggleLineStyle":"  ","hotkeys.tools.group":" ","hotkeys.tools.closeNode":"  ","hotkeys.tools.duplicate":" ","hotkeys.tools.duplicateWithContent":"  ","hotkeys.tools.deleteGroup":"  (Shift+Click)","hotkeys.windows.title":"","hotkeys.windows.search":" ","hotkeys.windows.catalog":"","hotkeys.createNode.title":" ","help.panelTitle":"  ","help.title":" ","help.howToUse.title":" ","help.howToUse.content":"Prompt Modifier   !      .    .       .        .    .","help.author":"","contextMenu.undoPosition":"  ","contextMenu.redoPosition":"  ","contextMenu.align.left":"  (F)","contextMenu.align.centerX":"   (E)","contextMenu.align.right":"  (R)","contextMenu.align.top":"  (T)","contextMenu.align.centerY":"   (D)","contextMenu.align.bottom":"  (B)","contextMenu.distribute.horizontal":"  (Ctrl+D)","contextMenu.distribute.vertical":"  (Ctrl+E)","contextMenu.emptySlot":"  ( )","contextMenu.saveSlots":"  ","contextMenu.loadSlots":"  ","quickadd.title":" ","quickadd.group.tools":"","quickadd.group.inputs":"","quickadd.group.processing":"","quickadd.group.character":"","quickadd.group.outputs":"","quickadd.group.ai":"AI ","quickadd.group.video":"","quickadd.group.scripts":"","quickadd.group.general":"","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"","quickadd.tool.cutter":"","quickadd.tool.selection":"","search.placeholder":"  ...","search.noResults":"   .","search.group.input":" & ","search.group.process":" & ","search.group.output":" & ","search.group.ai":"AI ","search.group.video":" & ","search.group.scripts":"","toolbar.exitApp":" "},Kb={"node.title.text_input":" ","node.title.image_input":" ","node.title.prompt_processor":" ","node.title.prompt_sanitizer":" ","node.title.video_prompt_processor":"  ","node.title.image_output":" ","node.title.video_output":" ","node.title.prompt_analyzer":" ","node.title.character_analyzer":" ","node.title.character_generator":" ","node.title.character_card":" ","node.title.image_analyzer":" ","node.title.image_editor":"AI  ","node.title.image_sequence_generator":"  ","node.title.prompt_sequence_editor":"  ","node.title.gemini_chat":"Gemini ","node.title.translator":"","node.title.script_generator":" ","node.title.script_viewer":" ","node.title.note":"","node.title.reroute_dot":"  ","node.title.data_reader":" ","node.title.video_editor":"  ","node.title.media_viewer":" ","node.title.data_protection":" ","node.title.pose_creator":"Pose Creator","node.help.text_input":"        .","node.help.image_input":"        .","node.help.prompt_processor":"AI        .","node.help.prompt_sanitizer":"           .","node.help.video_prompt_processor":"       .","node.help.image_output":"   .    .","node.help.video_output":"Veo      .","node.help.prompt_analyzer":" , ,     .","node.help.character_analyzer":"     .","node.help.character_generator":"      .","node.help.character_card":"      .","node.help.image_analyzer":"AI     .","node.help.image_editor":"  /     .","node.help.image_sequence_generator":"     .","node.help.prompt_sequence_editor":"AI        .","node.help.gemini_chat":"   Gemini   .","node.help.translator":"AI      .","node.help.script_generator":"   (, ) .","node.help.script_viewer":"      .","node.help.note":"      .","node.help.reroute_dot":"         .","node.help.data_reader":"        .","node.help.video_editor":"       .","node.help.media_viewer":"        .","node.help.data_protection":"     .    .","node.help.pose_creator":"Visual rig to define and generate character poses for generation guidance.","node.action.expand":"","node.action.collapse":"","node.action.help":"","node.action.download":"","node.action.clear":" ","node.action.refreshChat":"   ","node.action.paste":"","node.action.resetEditor":" ","node.action.saveCharacter":" ","node.action.loadCharacter":" ","node.action.copy":"","node.action.copyImage":" ","node.action.copyTextPrompt":" ","node.action.copyImagePrompt":"  ","node.action.copyVideoPrompt":"  ","node.action.cutConnections":" ","node.action.close":"","node.action.closeNode":"  (Shift+Click  )","node.action.closeNodeSimple":" ","node.action.randomWord":"  ","node.action.processImage":" ","node.action.processImageTitle":"Gemini     .","node.action.editor":"","node.action.rasterEditor":" ","node.action.openInAIEditor":"AI  ","node.action.openInAnalyzer":" ","node.action.outputToInput":"  ","node.action.processChainForward":" ","node.action.executeChain":" ","node.action.executeChainTitle":"       .","node.action.sanitize":"","node.action.rename":" ","node.action.stop":"","node.action.stopping":" ...","node.action.deleteItem":" ","node.action.detachAndPaste":"  ","node.action.delete":"","node.action.flipImage":" ","node.action.pin":"  ","node.action.unpin":"  ","node.mediaViewer.play":"","node.mediaViewer.pause":" ","node.mediaViewer.stop":"","node.mediaViewer.addMarker":" ","node.mediaViewer.exportSRT":"  (SRT)","node.mediaViewer.deleteAllMarkers":"  ","node.mediaViewer.saveMarkers":"  ","node.mediaViewer.loadMarkers":"  ","node.mediaViewer.relink":"  ","node.content.notePlaceholder":"  ...","node.content.dropImage":"    ","node.content.dropMedia":"    ","node.content.processing":" ...","node.content.processingChain":"  ...","node.content.metadataPrompt":"  :","node.content.metadataPromptPlaceholder":"    .","node.content.copyPrompt":"","node.content.prompt":"","node.content.inputPrompt":" ","node.content.enhancedResult":" ","node.content.videoPrompt":" ","node.content.editPromptPlaceholder":"  ...","node.content.enhancedPromptHere":"   ...","node.content.safePrompt":"  ","node.content.generating":" ...","node.content.imageHere":"  ","node.content.generationMode":" ","node.content.aspectRatio":"","node.content.aspectRatioHelp":"    ","node.content.aspectRatioNotSupportedFast":" Imagen    .","node.content.enableAspectRatioFormatting":"  ","node.content.autoDownload":" ","node.content.generateImage":" ","node.content.enhancing":" ...","node.content.enhancePrompt":" ","node.content.sanitizing":" ...","node.content.sanitizedPromptHere":"   ...","node.content.analyzing":" ...","node.content.analyzePrompt":" ","node.content.analyzeImage":" ","node.content.imageToText":" ","node.content.analyzeCharacter":" ","node.content.generateCharacters":" ","node.content.characterPromptPlaceholder":"  ...","node.content.character":"","node.content.clothing":"","node.content.characterPlaceholder":"   ...","node.content.clothingPlaceholder":"   ...","node.content.appearance":"","node.content.personality":"","node.content.environment":"/","node.content.action":"","node.content.emotion":"","node.content.style":"","node.content.environmentPlaceholder":"   ...","node.content.charactersPlaceholder":"  ...","node.content.characters":"","node.content.characterConcepts":" ","node.content.actionPlaceholder":" ...","node.content.emotionPlaceholder":" ...","node.content.stylePlaceholder":"  ...","node.content.descriptionHere":"  ...","node.content.enableOutpainting":" ","node.content.outpaintingPromptPlaceholder":" ...","node.content.inputImage":" ","node.content.dropOrClick":"  ","node.content.outputImage":" ","node.content.applyEdit":" ","node.content.editing":" ...","node.content.chatPlaceholder":" ...","node.content.connectedPlaceholder":" ,  .","node.content.connectedNode":"  ","node.content.connectedEmpty":"   .","node.content.translatePlaceholder":" ...","node.content.translatedTextPlaceholder":" ...","node.content.targetLanguage":" ","node.content.translate":"","node.content.translating":" ...","node.content.scriptPromptPlaceholder":"   ...","node.content.generateScript":" ","node.content.loadScript":"  ","node.content.summary":"","node.content.scenes":"","node.content.unrecognizedFormat":"    .","node.content.frames":"","node.content.characterIndex":"","node.content.readData":" ","node.content.textDataHere":"   .","node.content.noDataRead":'  " "   .',"node.content.previewError":" ","node.content.previewPlaceholder":"  ","node.content.imagePrompt":" ","node.output.allPromptData":"  ","node.note.tab.note":"","node.note.tab.references":"","node.note.nestedImages":" ","node.note.dropPlaceholder":"   ","node.note.addCaption":"","node.note.action.shuffle":"","node.note.action.undoShuffle":" ","node.content.characterTypeShort":":","node.content.numberOfCharactersShort":":","node.content.characterType.simple":"","node.content.characterType.anthro":"","node.content.characterType.chibi":"","node.content.characterType.key_item":" ","node.content.style.simple":"","node.content.style.realistic":"","node.content.style.3d_cartoon":"3D ","node.content.style.3d_realistic":"3D ","node.content.style.2d_animation":"2D ","node.content.style.anime":"","node.content.style.comics":"","node.content.style.custom":" ","node.content.fullDescriptionTitle":"  ","node.content.additionalPromptSuffix":"  ()","image_sequence.auto_crop":"  16:9","image_sequence.create_zip":"ZIP  ","node.content.modificationRequest":" ","node.promptProcessor.safePromptTooltip":"Rewrites the prompt to comply with safety guidelines and avoid policy violations.","node.promptProcessor.technicalPromptTooltip":"Converts the prompt into a highly detailed technical specification (lighting, camera, render settings).","node.promptProcessor.enhanceTooltip":"Uses AI to expand and enrich the prompt with descriptive details.","node.promptProcessor.chainTooltip":"Executes this node and triggers all connected downstream nodes.","image_sequence.tooltip.autoCrop":"Automatically crops generated images to 16:9 ratio.","image_sequence.tooltip.autoDownload":"Automatically saves each image to your device upon generation.","image_sequence.tooltip.createZip":"Packages all selected images into a single ZIP archive for download."},Jb={"imageEditor.title":" ","imageEditor.canvasResolution":" ","imageEditor.background":"","imageEditor.toolSettings":" ","imageEditor.snapToEdges":" ","imageEditor.freeAspect":" ","imageEditor.section.aiRequest":"AI  ","imageEditor.input.modificationPlaceholder":'  , : "  "',"imageEditor.action.sendRequest":" ","imageEditor.tooltip.removeObject":" () /  ()","imageEditor.action.removeObject":" ","imageEditor.tool.transform":"","imageEditor.tool.hand":" ()","imageEditor.tool.zoom":"/","imageEditor.tool.pencil":"","imageEditor.tool.rectangle":"","imageEditor.action.fit":" ","imageEditor.action.fill":" ","imageEditor.action.cancel":"","imageEditor.action.resetEdits":" ","imageEditor.action.apply":"","imageViewer.title":" ","imageEditor.outputResolution":" ","imageEditor.outputResolutionHelp":'  . ""    .',"imageEditor.currentSize":" : {width}x{height}","imageEditor.sequenceMode":" ","imageEditor.sequenceModeHelp":" A   .","imageEditor.sequentialCombination":"  ","imageEditor.sequentialCombinationHelp":"  :   A  +   B  .","imageEditor.sequentialPrompt":"  ","imageEditor.sequentialPromptHelp":"  :    +   .","imageEditor.sequentialEditingWithPrompts":"  ","imageEditor.sequentialEditingWithPromptsHelp":"  :  B  +   .  A .","imageEditor.input":"","imageEditor.inputA":" A","imageEditor.inputB":" B","imageEditor.status.queued":" ","imageEditor.status.generating":" ...","imageEditor.action.regenerate":"","imageEditor.tooltip.fit":"    ().","imageEditor.tooltip.fill":"    ().","imageEditor.tooltip.flip":"  .","imageEditor.background.white":"","imageEditor.background.gray":"","imageEditor.background.black":"","imageEditor.background.dark":" ","image_sequence.regenerate":"","image_sequence.stop_queue":" ","image_sequence.move_up":" ","image_sequence.move_down":" ","image_sequence.copy_prompt":" ","image_sequence.add_frame":" ","image_sequence.delete_frame":" ","image_sequence.expand_all_frames":"  /","image_sequence.collapse_all_frames":"  ","image_sequence.expand_all_scenes":"  /","image_sequence.collapse_all_scenes":"  ","image_sequence.expand_all":" ","image_sequence.collapse_all":" ","image_sequence.clear_all_prompts":"  ","image_sequence.add_first_frame":"   ","image_sequence.drop_or_add_title":" JSON    ","image_sequence.drop_or_add_desc":"JSON        .","image_sequence.load_prompts":" ","image_sequence.output_images_title":" ","image_sequence.prompts_list_title":" ","image_sequence.download_selected":"  ","image_sequence.select_all":" ","image_sequence.select_none":" ","image_sequence.invert_selection":" ","image_sequence.run_selected":"  ","image_sequence.start_queue":" ","image_sequence.character_prompt_combination":"  ","image_sequence.combination_none":"","image_sequence.combination_combine":"","image_sequence.combination_replace":" ","image_sequence.status.error":"","image_sequence.status.pending":" ","image_sequence.clear_selected_prompts":"  ","image_sequence.range_from":":","image_sequence.range_to":":","image_sequence.stats.total":" : {count}","image_sequence.stats.generated":": {count}","image_sequence.stats.queue":": {count}","image_sequence.edit_in_source":" ","image_sequence.edit_prompt":" ","image_sequence.select_scene":" ","image_sequence.next_scene":" ","image_sequence.prev_scene":" ","image_sequence.scene_input_label":"","image_sequence.select_square":" (1:1) ","image_sequence.select_landscape":" (16:9) ","image_sequence.select_portrait":" (9:16) ","image_sequence.select_range":" ","image_sequence.force_refresh":" ","image_sequence.select_scene_frames":"    ","image_sequence.collapse_other_scenes":"  ","prompt_sequence_editor.instructionPlaceholder":"   ...","prompt_sequence_editor.modifying":" ...","prompt_sequence_editor.modifySelected":"   ({count})","prompt_sequence_editor.sourcePrompts":" ","prompt_sequence_editor.finalPrompts":" ","prompt_sequence_editor.error.invalidInput":"   .     .","geminiChat.mode.general":"","geminiChat.mode.prompt":" ","geminiChat.mode.script":" ","geminiChat.mode.youtube":"YouTube ","image_sequence.shot_type.WS":"  (WS)   .  .","image_sequence.shot_type.MS":"  (MS)  .   .","image_sequence.shot_type.CU":" (CU)  .","image_sequence.shot_type.ECU":"  (ECU)  .  .","image_sequence.shot_type.LS":"  (LS)    ."},Yb={"dialog.permission.title":" ","dialog.permission.description":"         .    .","dialog.permission.allow":"","dialog.permission.decline":"","dialog.rename.title":"  ","dialog.rename.group.title":"  ","dialog.rename.catalog.title":"   ","dialog.rename.node.title":"  ","dialog.rename.label":" :","dialog.rename.confirm":" ","dialog.rename.cancel":"","dialog.promptEdit.title":" ","dialog.promptEdit.nameLabel":":","dialog.promptEdit.contentLabel":":","dialog.promptEdit.confirm":"","dialog.promptEdit.cancel":"","dialog.confirmDelete.title":" ","dialog.confirmDelete.message":"  ?     .","dialog.confirmDelete.confirm":"","dialog.confirmDelete.cancel":"","dialog.confirmCloseTab.title":" ","dialog.confirmCloseTab.message":'"{tabName}"  ?     .',"dialog.confirmClear.title":" ","dialog.confirmClear.message":"  ?     .","dialog.confirmReset.title":" ","dialog.confirmReset.message":"   ?    .","dialog.confirmReset.confirm":"","dialog.confirmLoad.title":" ","dialog.confirmLoad.message":"     .     . ?","dialog.apiKey.title":"API  ","dialog.apiKey.description":'  "AI Platform" API   API  .       .',"dialog.apiKey.billingLink":"   ","dialog.apiKey.button":"API  ","dialog.settings.title":"","dialog.settings.apiKeyLabel":" Google Gemini API :","dialog.settings.useDevKeyLabel":" API   ()","dialog.settings.instantNodeCloseLabel":"  ","dialog.settings.nodeAnimationLabel":"  ","dialog.settings.animationModeLabel":"  ","dialog.settings.anim.pulse":"","dialog.settings.anim.bladeRunner":" ","dialog.settings.anim.none":"","dialog.settings.description":"       API  .    .","dialog.settings.getKeyLink":" API  ","dialog.settings.save":"","dialog.deleteNode.title":" ?","dialog.deleteNode.titlePlural":" ?","dialog.deleteNode.confirm":"","dialog.deleteNode.cancel":"","dialog.deleteNode.confirmTooltip":"  -     ","dialog.deleteNode.cancelTooltip":"  -   ","dialog.deleteNode.dontShowAgain":"  ","dialog.exitApp.title":" ?","dialog.exitApp.message":" ?      ."},Zb={"group.button.create":"  ({count})","group.rename":"  ","group.saveToCatalog":" ","group.saveToDisk":" ","group.ungroup":"  (Shift+Click   )","group.duplicate":"   ","catalog.tabs.groups":"","catalog.tabs.library":"","catalog.tabs.characters":"","catalog.tabs.scripts":"","catalog.tabs.sequences":"","catalog.back":"","catalog.load":" ","catalog.newFolder":" ","catalog.saveTo":" ","catalog.card.addToCanvas":" ","catalog.card.rename":" ","catalog.card.save":"","catalog.card.delete":"","catalog.empty.description":"   .       .","library.loadFromFile":"","library.actions.newFolder":" ","library.actions.newPrompt":" ","library.actions.copy":"","library.actions.edit":"","library.empty.title":" ","library.empty.description":"   .","library.emptyPrompt":" "},Xb={...Wb,...$b,...Kb,...Jb,...Yb,...Zb},fn={en:{name:"English",short:"EN",nativeName:"English"},ru:{name:"Russian",short:"RU",nativeName:""},es:{name:"Spanish",short:"ES",nativeName:"Espaol"},fr:{name:"French",short:"FR",nativeName:"Franais"},de:{name:"German",short:"DE",nativeName:"Deutsch"},it:{name:"Italian",short:"IT",nativeName:"Italiano"},pt:{name:"Portuguese",short:"PT",nativeName:"Portugus"},uz:{name:"Uzbek",short:"UZ",nativeName:"O'zbek"},zh:{name:"Chinese",short:"ZH",nativeName:""},ja:{name:"Japanese",short:"JA",nativeName:""},ko:{name:"Korean",short:"KO",nativeName:""}},Kc={en:Dw,ru:Gw,es:Yw,uz:ob,fr:db,de:xb,it:_b,pt:Ib,zh:qb,ja:Vb,ko:Xb},qo=(e,t,o)=>{const r=Kc[e]||Kc.en,a=Kc.en;let i=r[t]||a[t]||t;return o&&Object.entries(o).forEach(([s,l])=>{i=i.replace(`{${s}}`,String(l))}),i},zx=v.createContext(void 0),St=()=>{const e=v.useContext(zx);if(!e)throw new Error("useLanguage must be used within a LanguageProvider");return e};var L=(e=>(e.TEXT_INPUT="TEXT_INPUT",e.IMAGE_INPUT="IMAGE_INPUT",e.PROMPT_PROCESSOR="PROMPT_PROCESSOR",e.VIDEO_PROMPT_PROCESSOR="VIDEO_PROMPT_PROCESSOR",e.IMAGE_OUTPUT="IMAGE_OUTPUT",e.VIDEO_OUTPUT="VIDEO_OUTPUT",e.PROMPT_ANALYZER="PROMPT_ANALYZER",e.CHARACTER_ANALYZER="CHARACTER_ANALYZER",e.CHARACTER_GENERATOR="CHARACTER_GENERATOR",e.CHARACTER_CARD="CHARACTER_CARD",e.IMAGE_ANALYZER="IMAGE_ANALYZER",e.IMAGE_EDITOR="IMAGE_EDITOR",e.IMAGE_SEQUENCE_GENERATOR="IMAGE_SEQUENCE_GENERATOR",e.PROMPT_SEQUENCE_EDITOR="PROMPT_SEQUENCE_EDITOR",e.GEMINI_CHAT="GEMINI_CHAT",e.TRANSLATOR="TRANSLATOR",e.SCRIPT_GENERATOR="SCRIPT_GENERATOR",e.SCRIPT_VIEWER="SCRIPT_VIEWER",e.NOTE="NOTE",e.REROUTE_DOT="REROUTE_DOT",e.PROMPT_SANITIZER="PROMPT_SANITIZER",e.DATA_READER="DATA_READER",e.VIDEO_EDITOR="VIDEO_EDITOR",e.MEDIA_VIEWER="MEDIA_VIEWER",e.DATA_PROTECTION="DATA_PROTECTION",e.POSE_CREATOR="POSE_CREATOR",e))(L||{}),Vt=(e=>(e.FOLDER="FOLDER",e.PROMPT="PROMPT",e))(Vt||{});const Qb=(()=>{const e=new Uint32Array(256);for(let t=0;t<256;t++){let o=t;for(let r=0;r<8;r++)o=o&1?3988292384^o>>>1:o>>>1;e[t]=o}return t=>{let o=-1;for(let r=0;r<t.length;r++)o=o>>>8^e[(o^t[r])&255];return(o^-1)>>>0}})();function Jc(e){return new TextEncoder().encode(e)}function Fs(e){return new TextDecoder().decode(e)}const Bi=(e,t,o)=>{if(!e.startsWith("data:image/png;base64,"))return console.warn("Attempted to add metadata to a non-PNG image."),e;try{const r=e.substring(22),a=atob(r),i=new Uint8Array(a.length);for(let S=0;S<i.length;S++)i[S]=a.charCodeAt(S);const s=[137,80,78,71,13,10,26,10];if(i.length<8)return console.error("Invalid PNG: file is too short."),e;for(let S=0;S<s.length;S++)if(i[S]!==s[S])return console.error("Invalid PNG signature."),e;let l=-1,c=8;for(;c<i.length;){if(c+8>i.length){console.warn("Malformed PNG: not enough data for chunk header.");break}const P=new DataView(i.buffer,c).getUint32(0,!1),j=i.slice(c+4,c+8);if(j[0]===73&&j[1]===69&&j[2]===78&&j[3]===68){l=c;break}const M=12+P;if(c+M>i.length){console.warn(`Malformed PNG: chunk of type ${Fs(j)} with length ${P} exceeds file bounds.`);break}c+=M}if(l===-1)return console.error("Could not find IEND chunk in PNG."),e;const d=Jc(t),u=Jc(o),p=new Uint8Array(d.length+1+u.length);p.set(d,0),p.set([0],d.length),p.set(u,d.length+1);const h=Jc("tEXt"),w=new Uint8Array(h.length+p.length);w.set(h),w.set(p,h.length);const k=Qb(w),b=new ArrayBuffer(4);new DataView(b).setUint32(0,p.length,!1);const y=new ArrayBuffer(4);new DataView(y).setUint32(0,k,!1);const g=new Uint8Array([...new Uint8Array(b),...h,...p,...new Uint8Array(y)]),m=new Uint8Array(i.length+g.length);m.set(i.slice(0,l),0),m.set(g,l),m.set(i.slice(l),l+g.length);let x="";for(let S=0;S<m.length;S++)x+=String.fromCharCode(m[S]);return`data:image/png;base64,${btoa(x)}`}catch(r){return console.error("Failed to add metadata to PNG:",r),e}},eC=async e=>new Promise(t=>{if(!e||!e.startsWith("data:image/png;base64,"))return t({});try{const o=e.substring(22),r=atob(o),a=new Uint8Array(r.length);for(let l=0;l<a.length;l++)a[l]=r.charCodeAt(l);const i={};let s=8;for(;s<a.length;){const l=new DataView(a.buffer,s);if(s+8>a.length)break;const c=l.getUint32(0,!1),d=Fs(a.slice(s+4,s+8));if(s+12+c>a.length)break;if(d==="tEXt"){const u=a.slice(s+8,s+8+c),p=u.indexOf(0);if(p!==-1){const h=Fs(u.slice(0,p)),w=Fs(u.slice(p+1));i[h]=w}}if(d==="IEND")break;s+=12+c}t(i)}catch(o){console.error("Failed to read metadata from PNG:",o),t({})}}),xl=async e=>{const t=await eC(e);return t.prompt||t.Prompt||t.parameters||t.Comment||null},Lt=40,Wt=12,En=Lt+4,$t={"1:1":1,"16:9":2,"9:16":3},Vl=e=>[L.IMAGE_EDITOR,L.PROMPT_SEQUENCE_EDITOR,L.IMAGE_SEQUENCE_GENERATOR,L.POSE_CREATOR].includes(e),tC=(e,t,o)=>{const r={x:e.x-t.x,y:e.y-t.y},a={x:o.x-t.x,y:o.y-t.y},i=Math.max(0,Math.min(1,(r.x*a.x+r.y*a.y)/(a.x*a.x+a.y*a.y))),s=r.x-i*a.x,l=r.y-i*a.y;return Math.sqrt(s*s+l*l)},nC=(e,t,o,r,a)=>{const i=1-e;return{x:i*i*i*t.x+3*i*i*e*o.x+3*i*e*e*r.x+e*e*e*a.x,y:i*i*i*t.y+3*i*e*e*o.y+3*i*e*e*r.y+e*e*e*a.y}},oC=(e,t,o,r=20)=>{const a={x:t.x+Math.abs(o.x-t.x)*.5,y:t.y},i={x:o.x-Math.abs(o.x-t.x)*.5,y:o.y},s=10;for(let l=0;l<=s;l++){const c=l/s,d=nC(c,t,a,i,o);if(Math.hypot(e.x-d.x,e.y-d.y)<r)return!0}return tC(e,t,o)<r},vr=e=>{if(e.length===0)return null;let t=1/0,o=1/0,r=-1/0,a=-1/0;e.forEach(l=>{t=Math.min(t,l.position.x),o=Math.min(o,l.position.y),r=Math.max(r,l.position.x+l.width);const c=l.isCollapsed?En:l.height;a=Math.max(a,l.position.y+c)});const i=30,s=70;return{position:{x:t-i,y:o-s},width:r-t+i*2,height:a-o+s+i}},Yn=(e,t)=>{switch(e.type){case L.TEXT_INPUT:return"text";case L.IMAGE_INPUT:return t==="text"?"text":"image";case L.PROMPT_PROCESSOR:return"text";case L.PROMPT_SANITIZER:return"text";case L.VIDEO_PROMPT_PROCESSOR:return"text";case L.TRANSLATOR:return"text";case L.PROMPT_ANALYZER:return"text";case L.CHARACTER_ANALYZER:return"text";case L.CHARACTER_GENERATOR:return"character_data";case L.CHARACTER_CARD:return t==="image"?"image":["prompt","appearance","personality","clothing"].includes(t||"")?"text":"character_data";case L.IMAGE_ANALYZER:return t==="image"?"image":t==="text"?"text":null;case L.IMAGE_EDITOR:return"image";case L.GEMINI_CHAT:return null;case L.IMAGE_OUTPUT:return"image";case L.VIDEO_OUTPUT:return"video";case L.SCRIPT_GENERATOR:return"text";case L.SCRIPT_VIEWER:return"text";case L.PROMPT_SEQUENCE_EDITOR:return t==="all_data"?"text":null;case L.IMAGE_SEQUENCE_GENERATOR:return t==="all_images"?"image":null;case L.NOTE:return t==="all_images"?"image":t==="all_captions"?"text":null;case L.REROUTE_DOT:try{return JSON.parse(e.value||"{}").type||null}catch{return null}case L.VIDEO_EDITOR:return"video";case L.MEDIA_VIEWER:try{return JSON.parse(e.value||"{}").type==="audio"?"audio":"video"}catch{return"video"}case L.DATA_PROTECTION:return"text";case L.POSE_CREATOR:return"image";default:return null}},Bs=(e,t)=>{switch(e.type){case L.TEXT_INPUT:return null;case L.PROMPT_PROCESSOR:return"text";case L.PROMPT_SANITIZER:return"text";case L.VIDEO_PROMPT_PROCESSOR:return"text";case L.TRANSLATOR:return"text";case L.PROMPT_ANALYZER:return"text";case L.CHARACTER_ANALYZER:return"text";case L.CHARACTER_GENERATOR:return"text";case L.IMAGE_ANALYZER:return"image";case L.IMAGE_EDITOR:return t;case L.IMAGE_OUTPUT:return"text";case L.VIDEO_OUTPUT:return"text";case L.IMAGE_SEQUENCE_GENERATOR:return"character_data";case L.GEMINI_CHAT:return"text";case L.SCRIPT_GENERATOR:return"text";case L.SCRIPT_VIEWER:return null;case L.PROMPT_SEQUENCE_EDITOR:return null;case L.DATA_READER:return null;case L.REROUTE_DOT:return null;case L.VIDEO_EDITOR:return null;case L.NOTE:return null;case L.MEDIA_VIEWER:return null;case L.DATA_PROTECTION:return"text";case L.POSE_CREATOR:return null;case L.CHARACTER_CARD:return"text";default:return null}},Hi=e=>{const{type:t}=e;switch(t){case L.POSE_CREATOR:return JSON.stringify({image:null,aspectRatio:"1:1",resolution:"1K",joints:[]});case L.VIDEO_EDITOR:return JSON.stringify({currentTime:0,totalDuration:30,clips:[],tracks:[{id:2,name:"V2",type:"video",isMuted:!1,isVisible:!0},{id:1,name:"V1",type:"video",isMuted:!1,isVisible:!0},{id:101,name:"A1",type:"audio",isMuted:!1,isVisible:!0}],mediaFiles:[],isPlaying:!1,zoom:20});case L.TEXT_INPUT:case L.PROMPT_SANITIZER:case L.IMAGE_OUTPUT:case L.VIDEO_OUTPUT:return"";case L.NOTE:return JSON.stringify({text:"",references:[],activeTab:"note"});case L.PROMPT_PROCESSOR:return JSON.stringify({inputPrompt:"",prompt:"",safePrompt:!0});case L.VIDEO_PROMPT_PROCESSOR:return JSON.stringify({inputPrompt:"",prompt:""});case L.IMAGE_INPUT:return JSON.stringify({image:null,prompt:""});case L.PROMPT_ANALYZER:return JSON.stringify({environment:"",characters:[],action:"",emotion:"",style:"",softPrompt:!1});case L.CHARACTER_ANALYZER:return JSON.stringify({character:"",clothing:""});case L.CHARACTER_GENERATOR:return JSON.stringify({prompt:"",characters:[]});case L.CHARACTER_CARD:return JSON.stringify([{name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:""}]);case L.IMAGE_ANALYZER:return JSON.stringify({image:null,description:"",softPrompt:!1});case L.IMAGE_SEQUENCE_GENERATOR:return JSON.stringify({prompts:[],images:{},currentIndex:-1,isGenerating:!1,autoDownload:!1,selectedFrameNumber:null,frameStatuses:{},aspectRatio:"16:9",characterConcepts:[],model:"gemini-2.5-flash-image",characterPromptCombination:"replace",enableAspectRatio:!1,isStyleCollapsed:!0,checkedFrameNumbers:[],topPaneHeight:440,leftPaneWidth:570,autoCrop169:!0});case L.PROMPT_SEQUENCE_EDITOR:return JSON.stringify({instruction:"",sourcePrompts:[],modifiedPrompts:[],leftPaneWidth:500,checkedSourceFrameNumbers:[],selectedFrameNumber:null,targetLanguage:"en",modificationModel:"gemini-3-flash-preview",sceneContexts:{},expandedSceneContexts:[]});case L.IMAGE_EDITOR:return JSON.stringify({inputImages:[],prompt:"",outputImage:null,aspectRatio:"1:1",enableAspectRatio:!1,enableOutpainting:!1,outpaintingPrompt:"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.",model:"gemini-2.5-flash-image",autoDownload:!0,autoCrop169:!1,leftPaneWidth:360,topPaneHeight:330});case L.GEMINI_CHAT:return JSON.stringify({messages:[],currentInput:"",lastPrompt:""});case L.TRANSLATOR:return JSON.stringify({targetLanguage:"ru",inputText:"",translatedText:"",image:null});case L.SCRIPT_GENERATOR:return JSON.stringify({prompt:"",summary:"",detailedCharacters:[],scenes:[],targetLanguage:"en"});case L.SCRIPT_VIEWER:return"{}";case L.REROUTE_DOT:return JSON.stringify({type:null});case L.DATA_READER:return JSON.stringify({text:"",image:null});case L.MEDIA_VIEWER:return JSON.stringify({src:"",type:"video",name:"",markers:[],volume:.4});case L.DATA_PROTECTION:return JSON.stringify({score:0,bits:100,survivedWords:[]});case L.POSE_CREATOR:return JSON.stringify({joints:[],aspectRatio:"1:1",resolution:"1K",renderedImage:null,aiPrompt:""});default:return""}},rC=e=>{const{type:t,value:o}=e,r=Hi(e);try{const a=JSON.parse(o||"{}"),i=JSON.parse(r);switch(t){case L.POSE_CREATOR:return JSON.stringify({...i,joints:a.joints||i.joints,aspectRatio:a.aspectRatio||i.aspectRatio,resolution:a.resolution||i.resolution});case L.VIDEO_EDITOR:return JSON.stringify({...i,tracks:a.tracks||i.tracks,totalDuration:a.totalDuration||30,mediaFiles:a.mediaFiles||[]});case L.PROMPT_PROCESSOR:return JSON.stringify({inputPrompt:a.inputPrompt||"",prompt:"",safePrompt:a.safePrompt!==void 0?a.safePrompt:!0});case L.VIDEO_PROMPT_PROCESSOR:return JSON.stringify({inputPrompt:a.inputPrompt||"",prompt:""});case L.TRANSLATOR:return JSON.stringify({...i,targetLanguage:a.targetLanguage||"ru"});case L.IMAGE_EDITOR:return JSON.stringify({...i,aspectRatio:a.aspectRatio||"1:1",enableAspectRatio:a.enableAspectRatio!==void 0?a.enableAspectRatio:!1,enableOutpainting:a.enableOutpainting!==void 0?a.enableOutpainting:!1,outpaintingPrompt:a.outpaintingPrompt||"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.",model:a.model||"gemini-2.5-flash-image",autoDownload:a.autoDownload!==void 0?a.autoDownload:!0,autoCrop169:a.autoCrop169!==void 0?a.autoCrop169:!1,leftPaneWidth:a.leftPaneWidth||360,topPaneHeight:a.topPaneHeight||330});case L.IMAGE_SEQUENCE_GENERATOR:return JSON.stringify({...i,prompts:[],characterConcepts:a.characterConcepts||[],aspectRatio:a.aspectRatio||"16:9",autoDownload:a.autoDownload||!1,model:a.model||"gemini-2.5-flash-image",topPaneHeight:a.topPaneHeight||440,leftPaneWidth:a.leftPaneWidth||570,enableAspectRatio:a.enableAspectRatio!==void 0?a.enableAspectRatio:!1,isStyleCollapsed:a.isStyleCollapsed!==void 0?a.isStyleCollapsed:!0,autoCrop169:a.autoCrop169!==void 0?a.autoCrop169:!0});case L.CHARACTER_CARD:return JSON.stringify({...i,name:a.name,index:a.index,prompt:a.prompt,fullDescription:a.fullDescription,selectedRatio:a.selectedRatio});case L.NOTE:return r;case L.PROMPT_SEQUENCE_EDITOR:return JSON.stringify({...i,targetLanguage:a.targetLanguage,modificationModel:a.modificationModel,leftPaneWidth:a.leftPaneWidth||500});case L.MEDIA_VIEWER:return r;case L.DATA_PROTECTION:return r;default:return r}}catch{return r}},Ri=e=>{switch(e){case L.POSE_CREATOR:return{minWidth:600,minHeight:800};case L.VIDEO_EDITOR:return{minWidth:920,minHeight:640};case L.TEXT_INPUT:return{minWidth:460,minHeight:300};case L.IMAGE_INPUT:return{minWidth:460,minHeight:340};case L.PROMPT_PROCESSOR:return{minWidth:460,minHeight:410};case L.PROMPT_SANITIZER:return{minWidth:460,minHeight:280};case L.VIDEO_PROMPT_PROCESSOR:return{minWidth:460,minHeight:410};case L.IMAGE_OUTPUT:return{minWidth:460,minHeight:700};case L.VIDEO_OUTPUT:return{minWidth:460,minHeight:680};case L.PROMPT_ANALYZER:return{minWidth:460,minHeight:1e3};case L.CHARACTER_ANALYZER:return{minWidth:460,minHeight:500};case L.CHARACTER_GENERATOR:return{minWidth:500,minHeight:840};case L.CHARACTER_CARD:return{minWidth:520,minHeight:960};case L.IMAGE_ANALYZER:return{minWidth:460,minHeight:680};case L.IMAGE_EDITOR:return{minWidth:1e3,minHeight:920};case L.IMAGE_SEQUENCE_GENERATOR:return{minWidth:1400,minHeight:920};case L.PROMPT_SEQUENCE_EDITOR:return{minWidth:1300,minHeight:920};case L.GEMINI_CHAT:return{minWidth:400,minHeight:640};case L.TRANSLATOR:return{minWidth:380,minHeight:640};case L.SCRIPT_GENERATOR:return{minWidth:500,minHeight:1e3};case L.SCRIPT_VIEWER:return{minWidth:500,minHeight:600};case L.NOTE:return{minWidth:460,minHeight:660};case L.REROUTE_DOT:return{minWidth:60,minHeight:40};case L.DATA_READER:return{minWidth:400,minHeight:500};case L.MEDIA_VIEWER:return{minWidth:480,minHeight:320};case L.DATA_PROTECTION:return{minWidth:800,minHeight:600};default:return{minWidth:200,minHeight:150}}},qx=(e,t,o)=>{const r=(a,i,s)=>{var w;const l=a.isCollapsed;if(a.type===L.REROUTE_DOT){let k=!1;try{k=JSON.parse(a.value||"{}").direction==="RL"}catch{}return{x:a.position.x+(s?k?a.width:0:k?0:a.width),y:a.position.y+a.height/2}}if(a.dockState){const k=s?0:160;let b=s?[void 0]:[void 0];a.type===L.IMAGE_EDITOR&&s?b=["image","text"]:a.type===L.IMAGE_SEQUENCE_GENERATOR&&s&&(b=["character_data","prompt_input"]);let y=b.indexOf(i);return y===-1&&(y=0),{x:a.position.x+k,y:a.position.y+(y+1)*(48/(b.length+1))}}const c=Ri(a.type),d=Math.max(a.width,c.minWidth),u=l?En:Math.max(a.height,c.minHeight),p=s?0:d;let h=u/2;if(l)if(a.type===L.CHARACTER_CARD&&!s){const k=["all_data","primary_data"],b=["image","prompt","appearance","personality","clothing"];let y=[...k,...b];a.collapsedHandles&&(y=k);const g=y.indexOf(i||"");g!==-1?h=(g+1)*(En/(y.length+1)):h=En/2}else if(a.type===L.VIDEO_EDITOR&&s){const k=["video","audio","image","text"],b=k.indexOf(i||"");b!==-1?h=(b+1)*(En/(k.length+1)):h=En/2}else h=En/2;else if(a.type===L.IMAGE_EDITOR&&s){let k=330,b=!1,y=!1;try{const m=JSON.parse(a.value||"{}");m.topPaneHeight&&(k=m.topPaneHeight),b=m.isSequenceMode&&m.isSequentialCombinationMode,y=m.isSequenceMode&&m.isSequentialEditingWithPrompts}catch{}const g=Lt+Wt;if(i==="image")y?h=u/2:b?h=g+k*.25:h=g+k*.5;else if(i==="image_b")b?h=g+k*.75:y?h=g+k*.5:h=u/2;else if(i==="text"){const x=g+k+16,_=u-x-Wt;h=x+_/2}}else if(a.type===L.IMAGE_SEQUENCE_GENERATOR&&s){let k="normal";try{const g=JSON.parse(a.value||"{}");g.conceptsMode&&(k=g.conceptsMode)}catch{}let b=390;k==="collapsed"?b=37:k==="expanded"&&(b=u-Lt-Wt);const y=Lt+Wt;if(i==="character_data")h=y+b/2;else if(i==="prompt_input")if(k==="expanded")h=u-10;else{const m=y+b+8;h=m+(u-m-Wt)/2}}else if(a.type===L.VIDEO_EDITOR&&s){const k=Lt+20,b=50;i==="video"?h=k:i==="audio"?h=k+b:i==="image"?h=k+b*2:i==="text"?h=k+b*3:h=u/2}else if(a.type===L.IMAGE_INPUT&&!s){const k=u-Lt-2*Wt,b=Math.max(0,k);i==="image"?h=Lt+Wt+b/4:i==="text"&&(h=u-80)}else if(a.type===L.CHARACTER_CARD&&!s){const k=["all_data","primary_data"],b=["image","prompt","appearance","personality","clothing"];let y=[...k,...b];a.collapsedHandles&&(y=k);const m=(u-Lt-20)/(y.length+1),x=y.indexOf(i||"");x!==-1&&(h=Lt+m*(x+1))}else if(a.type===L.PROMPT_ANALYZER&&!s)try{const b=((w=JSON.parse(a.value||"{}").characters)==null?void 0:w.length)||0,y=4+b;let g=0;i==="environment"?g=0:i!=null&&i.startsWith("character-")?g=1+parseInt(i.split("-")[1]):i==="action"?g=1+b:i==="emotion"?g=2+b:i==="style"&&(g=3+b),h=Lt+Wt+(u-Lt-60)/y*(g+.5)}catch{}else if(a.type===L.IMAGE_ANALYZER&&!s){const k=u-Lt-2*Wt,b=8,y=(k-b)/2,g=Lt+Wt;i==="image"?h=g+y/2:i==="text"&&(h=g+y+b+y/2)}return{x:a.position.x+p,y:a.position.y+h}};return{start:r(e,o.fromHandleId,!1),end:r(t,o.toHandleId,!0)}},Cr=async(e,t)=>new Promise((o,r)=>{if(!e)return r(new Error("Source image is empty."));const a=new Image;a.onload=()=>{const i=a.width/a.height,[s,l]=t.split(":").map(Number),c=s/l;if(Math.abs(i-c)<.01)return o({formattedImage:e,needsFormatting:!1});let d,u,p,h;i>c?(d=a.width,u=a.width/c,p=0,h=(u-a.height)/2):(u=a.height,d=a.height*c,p=(d-a.width)/2,h=0);const w=document.createElement("canvas");w.width=d,w.height=u;const k=w.getContext("2d");if(!k)return r(new Error("Could not get canvas context"));k.fillStyle="white",k.fillRect(0,0,w.width,w.height),k.drawImage(a,p,h,a.width,a.height),o({formattedImage:w.toDataURL("image/png"),needsFormatting:!0})},a.onerror=()=>{console.error("Failed to load image for formatting. The provided image source might be invalid or corrupted."),r(new Error("Failed to load the provided image. It might be corrupted or in an unsupported format."))},a.src=e}),Ra=e=>new Promise((t,o)=>{if(!e)return o(new Error("Source image is empty for cropping."));const r=new Image;r.onload=()=>{const a=1.7777777777777777,i=r.width/r.height;if(i<1.2||Math.abs(i-a)<.02)return t(e);let s,l,c=0,d=0;i>a?(l=r.height,s=r.height*a,c=(r.width-s)/2):(s=r.width,l=r.width/a,d=(r.height-l)/2);const u=document.createElement("canvas");u.width=s,u.height=l;const p=u.getContext("2d");if(!p)return o(new Error("Could not get canvas context for cropping."));p.drawImage(r,c,d,s,l,0,0,s,l),t(u.toDataURL("image/png"))},r.onerror=()=>{o(new Error("Failed to load the provided image for cropping."))},r.src=e}),aC=e=>new Promise((t,o)=>{if(!e)return o(new Error("Source image is empty for cropping."));const r=new Image;r.onload=()=>{const a=Math.min(r.width,r.height),i=(r.width-a)/2,s=(r.height-a)/2,l=document.createElement("canvas");l.width=a,l.height=a;const c=l.getContext("2d");if(!c)return o(new Error("Could not get canvas context for cropping."));c.drawImage(r,i,s,a,a,0,0,a,a),t(l.toDataURL("image/png"))},r.onerror=()=>{o(new Error("Failed to load the provided image for cropping."))},r.src=e}),Rt=async(e,t,o)=>new Promise((r,a)=>{if(!e)return a(new Error("Source image is empty."));const i=new Image;i.onload=()=>{const s=document.createElement("canvas"),l=s.getContext("2d");if(!l)return a(new Error("Could not get canvas context"));let{width:c,height:d}=i;const u=c/d;c>t&&(c=t,d=c/u),d>o&&(d=o,c=d*u),s.width=c,s.height=d,l.drawImage(i,0,0,c,d),r(s.toDataURL("image/jpeg",.8))},i.onerror=s=>{console.error("Failed to load image for thumbnail generation:",s),a(new Error("Failed to load the provided image for thumbnailing."))},i.src=e}),iC=(e,t,o,r,a,i)=>{const[s,l]=v.useState(e),c=v.useRef(t),d=v.useCallback((B,E)=>{l(I=>I.map(N=>N.id===B?{...N,value:E}:N))},[]),u=v.useCallback((B,E)=>{l(I=>I.map(N=>N.id===B?{...N,title:E}:N))},[]),p=v.useCallback(B=>{l(E=>E.map(I=>I.id===B&&I.isNewlyCreated?{...I,isNewlyCreated:!1}:I))},[]),h=B=>{l(E=>E.filter(I=>I.id!==B))},w=v.useCallback(B=>{const E=s.find(T=>T.id===B);if(!E)return;c.current++;const I=`node-${c.current}-${Date.now()}`,N={...E,id:I,position:{x:E.position.x+30,y:E.position.y+30},isNewlyCreated:!0,value:rC(E)};return l(T=>[...T,N]),o(r("toast.nodeDuplicated")),I},[s,c,l,o,r]),k=v.useCallback(B=>{const E=s.find(T=>T.id===B);if(!E)return;c.current++;const I=`node-${c.current}-${Date.now()}`,N={...E,id:I,position:{x:E.position.x+30,y:E.position.y+30},isNewlyCreated:!0,value:E.value};for(let T=0;T<=100;T++){const F=i(B,T);F&&a(I,T,F)}return l(T=>[...T,N]),o(r("toast.nodeDuplicated")),I},[s,c,l,o,r,i,a]);return{nodes:s,setNodes:l,nodeIdCounter:c,handleValueChange:d,handleRenameNode:u,handleDeleteNode:h,handleDuplicateNode:w,handleDuplicateNodeWithContent:k,handlePasteNodeValue:async B=>{const E=s.find(I=>I.id===B);if(!E)return"Node not found.";try{const I=await navigator.clipboard.readText();if(E.type===L.CHARACTER_CARD)try{const N=JSON.parse(I);let T=[];if(Array.isArray(N)?T=N:typeof N=="object"&&N!==null&&(T=[N]),T.length>0&&(T[0].type==="character-card"||T[0].name||T[0].imageSources||T[0].prompt)){let z=[];try{z=JSON.parse(E.value||"[]"),Array.isArray(z)||(z=[z])}catch{z=[]}const G=z.length,U=await Promise.all(T.map(async(X,re)=>{const de=G+re,ge=X.imageSources||{"1:1":null,"16:9":null,"9:16":null},te={"1:1":null,"16:9":null,"9:16":null};X.image&&!X.imageSources&&(ge["1:1"]=X.image);for(const[se,ie]of Object.entries(ge))if(typeof ie=="string"&&ie.startsWith("data:")){const oe=$t[se];oe&&a(B,de*10+oe,ie);try{const A=await Rt(ie,256,256);te[se]=A}catch{te[se]=ie}}else te[se]=ie;const le=X.selectedRatio||"1:1",ee=ge[le];return ee&&typeof ee=="string"&&ee.startsWith("data:")&&a(B,de*10,ee),{id:`char-card-${Date.now()}-${de}`,name:X.name||"",index:X.index||X.alias||`Entity-${de+1}`,prompt:X.prompt||X.imagePrompt||"",fullDescription:X.fullDescription||X.description||"",selectedRatio:le,image:te[le],thumbnails:te,isOutput:!1}})),R=[...z,...U],ne=R.length*410+110;return l(X=>X.map(re=>re.id===B?{...re,value:JSON.stringify(R),width:ne}:re)),o(r("toast.pastedFromClipboard")),null}}catch{}return d(B,I),o(r("toast.pastedFromClipboard")),null}catch{return o(r("toast.pasteFailed"),"error"),"Could not read from clipboard."}},handlePasteImageToNode:async(B,E=null)=>{const I=N=>{const T=new FileReader;T.onload=async F=>{var R;const z=(R=F.target)==null?void 0:R.result;if(!z)return;const G=await Rt(z,512,512),U=await xl(z);l(q=>{const H=q.findIndex(ge=>ge.id===B);if(H===-1)return q;const ne=q[H];let X=ne.value,re=ne.width;try{const ge=JSON.parse(ne.value||"{}");if(ne.type===L.IMAGE_EDITOR){const te=[...ge.inputImages||[],G];a(B,te.length,z),X=JSON.stringify({...ge,inputImages:te})}else if(ne.type===L.IMAGE_INPUT||ne.type===L.IMAGE_ANALYZER||ne.type===L.CHARACTER_CARD||ne.type===L.TRANSLATOR)if(ne.type===L.TRANSLATOR&&(X=JSON.stringify({...ge,image:G})),a(B,0,z),ne.type===L.CHARACTER_CARD){let te=Array.isArray(ge)?[...ge]:[ge];const le=te.length,ee="1:1",se={"1:1":G,"16:9":null,"9:16":null},ie={id:`char-card-${Date.now()}-${le}`,name:`New Entity ${le+1}`,index:`Entity-${le+1}`,image:G,thumbnails:se,selectedRatio:ee,prompt:U||"",fullDescription:"",targetLanguage:"en",isOutput:te.length===0};te.push(ie);const oe=$t[ee];oe&&a(B,le*10+oe,z),a(B,le*10,z),re=te.length*410+110,X=JSON.stringify(te)}else ne.type!==L.TRANSLATOR&&(X=JSON.stringify({...ge,image:G,prompt:U||ge.prompt||""}));else return q}catch{if(ne.type===L.IMAGE_INPUT||ne.type===L.IMAGE_ANALYZER)a(B,0,z),X=JSON.stringify({image:G,prompt:U||""});else if(ne.type===L.TRANSLATOR)a(B,0,z),X=JSON.stringify({image:G});else if(ne.type===L.CHARACTER_CARD){a(B,0,z);const ge={"1:1":G,"16:9":null,"9:16":null};X=JSON.stringify([{id:`char-card-${Date.now()}`,image:G,thumbnails:ge,selectedRatio:"1:1",name:"New Entity 1",index:"Entity-1",prompt:U||"",isOutput:!0}]),a(B,1,z),re=410+110}else return q}const de=[...q];return de[H]={...ne,value:X,width:re},de}),o(r("toast.pastedFromClipboard"))},T.readAsDataURL(N)};if(E)return I(E),null;try{const N=await navigator.clipboard.read();for(const T of N)for(const F of T.types)if(F.startsWith("image/")){const z=await T.getType(F),G=new File([z],"pasted_image.png",{type:z.type});return I(G),null}return o(r("toast.pasteFailed"),"error"),"No image found on clipboard."}catch{return o(r("toast.pasteFailed"),"error"),"Could not read from clipboard."}},handleCopyNodeValue:async B=>{var T,F;const E=s.find(z=>z.id===B);if(!E)return"Node not found.";let I=null,N=E.value;try{if((T=E.value)!=null&&T.startsWith("{")||(F=E.value)!=null&&F.startsWith("[")){const z=JSON.parse(E.value);switch(E.type){case L.IMAGE_INPUT:I=i(E.id,0)||z.image,I?N="":N=z.prompt||"";break;case L.IMAGE_ANALYZER:I=i(E.id,0)||z.image,N=z.prompt||z.description||"";break;case L.CHARACTER_CARD:{const U=(Array.isArray(z)?z:[z]).map((R,q)=>{const H={...R.thumbnails};Object.entries($t).forEach(([ge,te])=>{const le=i(E.id,q*10+te);le&&(H[ge]=le)});const ne=R.selectedRatio||"1:1",re=i(E.id,q*10)||H[ne]||R.image,de={type:"character-card",nodeTitle:E.title,...R,image:re,imageSources:H};return delete de.thumbnails,delete de.id,de});N=JSON.stringify(U,null,2),I=null}break;case L.IMAGE_EDITOR:I=i(E.id,0)||z.outputImage,N=z.prompt||"";break;case L.IMAGE_OUTPUT:I=i(E.id,0)||E.value,N="";break;case L.TRANSLATOR:N=z.translatedText||z.inputText||"";break;case L.PROMPT_PROCESSOR:N=z.prompt||"";break;case L.PROMPT_ANALYZER:case L.CHARACTER_ANALYZER:case L.SCRIPT_GENERATOR:case L.CHARACTER_GENERATOR:N=JSON.stringify(z,null,2);break;default:N=E.value}}else(E.type===L.IMAGE_OUTPUT||E.type===L.IMAGE_INPUT)&&E.value.startsWith("data:image")?(I=i(E.id,0)||E.value,N=""):N=E.value}catch{N=E.value}try{if(I&&I.startsWith("data:image")){let G=await(await fetch(I)).blob();if(G.type!=="image/png")try{const U=await createImageBitmap(G),R=document.createElement("canvas");R.width=U.width,R.height=U.height;const q=R.getContext("2d");if(q){q.drawImage(U,0,0);const H=await new Promise(ne=>R.toBlob(ne,"image/png"));H&&(G=H)}}catch{}return await navigator.clipboard.write([new ClipboardItem({[G.type]:G})]),o(r("toast.copiedToClipboard")),null}else if(N&&typeof N=="string"&&N.trim()!=="")return await navigator.clipboard.writeText(N),o(r("toast.copiedToClipboard")),null}catch{return"Could not write to clipboard."}return"Nothing to copy."},handleAspectRatioChange:(B,E)=>{l(I=>I.map(N=>N.id===B?{...N,aspectRatio:E}:N))},handleResolutionChange:(B,E)=>{l(I=>I.map(N=>N.id===B?{...N,resolution:E}:N))},handleModelChange:(B,E)=>{l(I=>I.map(N=>N.id===B?{...N,model:E}:N))},handleAutoDownloadChange:(B,E)=>{l(I=>I.map(N=>N.id===B?{...N,autoDownload:E}:N))},handleSetImageEditorOutputToInput:B=>{const E=s.find(I=>I.id===B);if(!(!E||E.type!==L.IMAGE_EDITOR))try{const I=JSON.parse(E.value);if(I.outputImage){const N=[...I.inputImages||[],I.outputImage],T=i(B,0);T&&a(B,N.length,T),d(B,JSON.stringify({...I,inputImages:N,outputImage:null}))}}catch{}},handleRefreshImageEditor:B=>{const E=s.find(F=>F.id===B);if(!E||E.type!==L.IMAGE_EDITOR)return;let I={};try{const F=JSON.parse(E.value||"{}");I={enableAspectRatio:F.enableAspectRatio,enableOutpainting:F.enableOutpainting,aspectRatio:F.aspectRatio,outpaintingPrompt:F.outpaintingPrompt}}catch{}const T={...JSON.parse(Hi(E)),...I};d(B,JSON.stringify(T))},handleToggleNodeCollapse:B=>{l(E=>E.map(I=>I.id===B?{...I,isCollapsed:!I.isCollapsed}:I))},handleToggleNodePin:B=>{l(E=>E.map(I=>I.id===B?{...I,isPinned:!I.isPinned}:I))},handleToggleNodeHandles:B=>{l(E=>E.map(I=>I.id===B?{...I,collapsedHandles:!I.collapsedHandles}:I))},handleClearNodeNewFlag:p}},sC=(e,t,o)=>{const[r,a]=v.useState(()=>e.map((c,d)=>({...c,id:c.id||`initial-conn-${Date.now()}-${d}`}))),i=v.useCallback(c=>{a(d=>{if(d.some(p=>p.fromNodeId===c.fromNodeId&&p.toNodeId===c.toNodeId&&p.fromHandleId===c.fromHandleId&&p.toHandleId===c.toHandleId))return d;const u={...c,id:`conn-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};return[...d,u]})},[]),s=v.useCallback(c=>{a(d=>{const u=d.filter(p=>p.fromNodeId!==c&&p.toNodeId!==c);return u.length<d.length&&t(o("toast.connectionsCut")),u})},[t,o]),l=v.useCallback(c=>{a(d=>d.filter(u=>u.id!==c))},[]);return{connections:r,setConnections:a,addConnection:i,removeConnectionsByNodeId:s,removeConnectionById:l}},lC=e=>{const[t,o]=v.useState(e||{scale:1,translate:{x:0,y:0}}),[r,a]=v.useState(null),[i,s]=v.useState({x:0,y:0}),[l,c]=v.useState(()=>({x:typeof window<"u"?window.innerWidth/2:0,y:typeof window<"u"?window.innerHeight/2:0})),d=v.useRef(null),u=v.useCallback(j=>{d.current=j},[]),p=v.useCallback(j=>{if(!d.current)return j;const M=d.current.getBoundingClientRect();return{x:j.x-M.left,y:j.y-M.top}},[]),h=v.useCallback(j=>{const M=p(j);return!Number.isFinite(t.scale)||t.scale===0||!Number.isFinite(t.translate.x)||!Number.isFinite(t.translate.y)?{x:0,y:0}:{x:(M.x-t.translate.x)/t.scale,y:(M.y-t.translate.y)/t.scale}},[t.scale,t.translate.x,t.translate.y,p]),w=v.useCallback((j,M)=>{const D=p(M);o(O=>{let B=Math.max(.1,Math.min(j,2));(!Number.isFinite(B)||Number.isNaN(B))&&(B=1);const E=Number.isFinite(O.scale)&&O.scale>0?O.scale:1,I=Number.isFinite(O.translate.x)?O.translate.x:0,N=Number.isFinite(O.translate.y)?O.translate.y:0,T=(D.x-I)/E,F=(D.y-N)/E,z=D.x-T*B,G=D.y-F*B;return!Number.isFinite(z)||!Number.isFinite(G)?O:{scale:B,translate:{x:z,y:G}}})},[p]),k=v.useCallback(j=>{const M=window.innerWidth/2,D=window.innerHeight/2;w(j,{x:M,y:D})},[w]),b=v.useCallback(j=>{j.preventDefault(),j.stopPropagation();const M=Math.pow(1.001,-j.deltaY);o(D=>{const O=Number.isFinite(D.scale)&&D.scale>0?D.scale:1,B=Number.isFinite(D.translate.x)?D.translate.x:0,E=Number.isFinite(D.translate.y)?D.translate.y:0,I=Math.max(.1,Math.min(2,O*M));if(!Number.isFinite(I))return D;const N=p({x:j.clientX,y:j.clientY}),T=(N.x-B)/O,F=(N.y-E)/O,z=N.x-T*I,G=N.y-F*I;return!Number.isFinite(z)||!Number.isFinite(G)?D:{scale:I,translate:{x:z,y:G}}})},[p]),y=v.useCallback(j=>{o(M=>!Number.isFinite(M.translate.x)||!Number.isFinite(M.translate.y)?{scale:1,translate:{x:window.innerWidth/2,y:window.innerHeight/2}}:(a({startPoint:j,startTranslate:{...M.translate}}),M))},[]),g=v.useCallback(()=>a(null),[]),m=v.useCallback(j=>{if(!r)return;const M=j.x-r.startPoint.x,D=j.y-r.startPoint.y;o(O=>{const B=r.startTranslate.x+M,E=r.startTranslate.y+D;return!Number.isFinite(B)||!Number.isFinite(E)?O:{...O,translate:{x:B,y:E}}})},[r]),x=v.useCallback(j=>{const M={x:j.clientX,y:j.clientY},D=h(M);s(D),c(M)},[h]),_=v.useCallback(()=>{const j=window.innerWidth/2,M=window.innerHeight/2;o({scale:1,translate:{x:j,y:M}})},[]);return{viewTransform:t,setViewTransform:o,isPanning:!!r,pointerPosition:i,clientPointerPosition:l,handleWheel:b,startPanning:y,stopPanning:g,pan:m,updatePointerPosition:x,setZoom:w,setCanvasRef:u,getCanvasRelativePoint:p,getTransformedPoint:h,handleZoomChange:k,scaleToSliderValue:j=>j>=1?(j-1)*100:(j-1)*125,sliderValueToScale:j=>j>=0?1+j/100:1+j/125,resetView:_}},cC=({viewTransform:e,setViewTransform:t,isPanning:o,pan:r,startPanning:a,stopPanning:i,getCanvasRelativePoint:s,setZoom:l,handleCloseAddNodeMenus:c,setSelectedNodeIds:d,effectiveTool:u,setZoomDragInfo:p,getTransformedPoint:h,setSelectionRect:w})=>{const k=v.useRef(null),b=(S,P)=>{const j=S.clientX-P.clientX,M=S.clientY-P.clientY;return Math.hypot(j,M)},y=(S,P)=>({x:(S.clientX+P.clientX)/2,y:(S.clientY+P.clientY)/2}),g=v.useCallback(S=>{if(window.focus(),document.activeElement instanceof HTMLElement&&document.activeElement.blur(),c(),S.button===1){S.preventDefault(),a({x:S.clientX,y:S.clientY});return}if(S.button===0){if(u==="zoom"){S.preventDefault(),p({startClientX:S.clientX,startScale:e.scale,pivot:{x:S.clientX,y:S.clientY}});return}if(u==="selection"||S.shiftKey){S.preventDefault(),S.shiftKey||d([]);const P=h({x:S.clientX,y:S.clientY});w({start:P,end:P});return}!S.ctrlKey&&!S.metaKey&&!S.altKey&&d([]),S.preventDefault(),a({x:S.clientX,y:S.clientY})}},[u,a,e.scale,h,d,c,p,w]),m=v.useCallback(S=>{if(window.focus(),document.activeElement instanceof HTMLElement&&document.activeElement.blur(),c(),S.touches.length===2){o&&i();const P=b(S.touches[0],S.touches[1]),j=y(S.touches[0],S.touches[1]),M=s(j);k.current={startDist:P,startCenter:M,startTransform:{...e}};return}S.touches.length===1&&a({x:S.touches[0].clientX,y:S.touches[0].clientY})},[c,a,o,i,e,s]),x=v.useCallback(S=>{if(S.touches.length===2&&k.current){S.cancelable&&S.preventDefault&&S.preventDefault();const P=b(S.touches[0],S.touches[1]),j=y(S.touches[0],S.touches[1]),M=s(j),{startDist:D,startCenter:O,startTransform:B}=k.current;if(D===0)return;const E=P/D;let I=B.scale*E;I=Math.max(.1,Math.min(I,5));const N=I/B.scale,T=M.x-(O.x-B.translate.x)*N,F=M.y-(O.y-B.translate.y)*N;t({scale:I,translate:{x:T,y:F}});return}o&&S.touches.length===1&&(S.cancelable&&S.preventDefault&&S.preventDefault(),r({x:S.touches[0].clientX,y:S.touches[0].clientY}))},[o,r,t,s]),_=v.useCallback(S=>{S.touches.length<2&&(k.current=null),o&&S.touches.length===0&&i()},[o,i]);return{handleCanvasMouseDown:g,handleCanvasTouchStart:m,handleCanvasTouchMove:x,handleCanvasTouchEnd:_,pinchRef:k}},dC=({nodesRef:e,setNodes:t,groupsRef:o,setGroups:r,viewTransform:a,isSnapToGrid:i,isSmartGuidesEnabled:s,setSmartGuides:l,handleCloseAddNodeMenus:c,setSelectedNodeIds:d,selectedNodeIds:u,getTransformedPoint:p,activeTool:h,handleDockNode:w,setIsDockingMenuVisible:k,setDockHoverMode:b,dockHoverMode:y,connections:g,setConnections:m})=>{const[x,_]=v.useState(null),S=v.useRef(null),[P,j]=v.useState(null),M=v.useRef(null),[D,O]=v.useState(null),B=v.useRef(null);jt.useEffect(()=>{S.current=x},[x]),jt.useEffect(()=>{M.current=P},[P]);const E=v.useCallback((R,q)=>{if(R.stopPropagation(),R.button!==0)return;c(),t(X=>{const re=X.findIndex(se=>se.id===q);if(re===-1)return X;const de=X[re],ge=re!==X.length-1,te=de.isNewlyCreated;if(!ge&&!te)return X;const le=[...X],[ee]=le.splice(re,1);return le.push({...ee,isNewlyCreated:!1}),le});let H=[...u];const ne=H.includes(q);if(R.shiftKey||R.ctrlKey||R.metaKey?(ne?H=H.filter(X=>X!==q):H.push(q),d(H)):ne||(H=[q],d(H)),H.includes(q)){if(h==="edit"&&(R.ctrlKey||R.metaKey)&&!R.altKey||h==="cutter")return;const X=p({x:R.clientX,y:R.clientY}),re=new Map,de=new Map;e.current.filter(le=>H.includes(le.id)).forEach(le=>{re.set(le.id,{x:X.x-le.position.x,y:X.y-le.position.y}),de.set(le.id,{...le.position})});const te={type:"node",id:q,offsets:re,initialPositions:de,isDetaching:R.altKey};S.current=te,_(te)}},[u,d,p,_,c,h,t,e]),I=v.useCallback((R,q)=>{if(R.touches.length!==1)return;c();const H=R.touches[0];R.stopPropagation(),t(le=>{const ee=le.findIndex(Z=>Z.id===q);if(ee===-1)return le;const se=le[ee],ie=ee!==le.length-1,oe=se.isNewlyCreated;if(!ie&&!oe)return le;const A=[...le],[K]=A.splice(ee,1);return A.push({...K,isNewlyCreated:!1}),A});let ne=[...u];ne.includes(q)||(ne=[q],d(ne));const X=p({x:H.clientX,y:H.clientY}),re=new Map,de=new Map;e.current.filter(le=>ne.includes(le.id)).forEach(le=>{re.set(le.id,{x:X.x-le.position.x,y:X.y-le.position.y}),de.set(le.id,{...le.position})});const te={type:"node",id:q,offsets:re,initialPositions:de,isDetaching:!1};S.current=te,_(te)},[u,d,p,_,c,t,e]),N=v.useCallback((R,q,H)=>{R.stopPropagation(),R.preventDefault(),R.currentTarget.setPointerCapture&&R.currentTarget.setPointerCapture(R.pointerId);const ne=e.current.find(X=>X.id===q);if(ne){const X={nodeId:q,startPosition:{x:R.clientX,y:R.clientY},startSize:{width:ne.width,height:ne.height},direction:H};j(X),M.current=X}},[e]),T=v.useCallback((R,q)=>{if(R.stopPropagation(),R.button!==0)return;c(),r(de=>{const ge=de.findIndex(ee=>ee.id===q);if(ge===-1||ge===de.length-1)return de;const te=[...de],[le]=te.splice(ge,1);return te.push(le),te}),d([]);const H=o.current.find(de=>de.id===q);if(!H)return;const ne=p({x:R.clientX,y:R.clientY}),X=new Map;X.set(q,{x:ne.x-H.position.x,y:ne.y-H.position.y}),H.nodeIds.forEach(de=>{const ge=e.current.find(te=>te.id===de);ge&&X.set(de,{x:ne.x-ge.position.x,y:ne.y-ge.position.y})});const re={type:"group",id:q,offsets:X};S.current=re,_(re)},[p,_,c,d,r,o,e]),F=v.useCallback((R,q)=>{if(R.stopPropagation(),R.touches.length!==1)return;c();const H=R.touches[0];r(ge=>{const te=ge.findIndex(se=>se.id===q);if(te===-1||te===ge.length-1)return ge;const le=[...ge],[ee]=le.splice(te,1);return le.push(ee),le}),d([]);const ne=o.current.find(ge=>ge.id===q);if(!ne)return;const X=p({x:H.clientX,y:H.clientY}),re=new Map;re.set(q,{x:X.x-ne.position.x,y:X.y-ne.position.y}),ne.nodeIds.forEach(ge=>{const te=e.current.find(le=>le.id===ge);te&&re.set(ge,{x:X.x-te.position.x,y:X.y-te.position.y})});const de={type:"group",id:q,offsets:re};S.current=de,_(de)},[p,_,c,d,r,o,e]);return{handleNodeMouseDown:E,handleNodeTouchStart:I,handleNodeResizeMouseDown:N,handleGroupMouseDown:T,handleGroupTouchStart:F,processDrag:(R,q,H)=>{const ne=(R.clientX-a.translate.x)/a.scale,X=(R.clientY-a.translate.y)/a.scale;if(S.current){const re=S.current,de=i?20:1;if(re.type==="node"){const ge=re.id,te=e.current.find(ve=>ve.id===ge);if(te&&!te.dockState&&te.type!==L.REROUTE_DOT){const ve=window.innerWidth,me=150,_e=80,pe=R.clientY<me;k(pe);const xe=document.elementFromPoint(R.clientX,R.clientY),Se=xe==null?void 0:xe.closest("[data-dock-mode]"),Le=Se==null?void 0:Se.getAttribute("data-dock-mode");Le?b(Le):R.clientX<_e?b("q1"):R.clientX>ve-_e?b("q4"):b(null)}const le=Array.from(re.offsets.keys()),ee=re.id,se=re.offsets.get(ee),ie=ne-se.x,oe=X-se.y,A=e.current.find(ve=>ve.id===ee),K=A.isCollapsed?En:A.height;let Z=null;const W=A.width,Q=K,ce=W*.05,fe=Q*.05,$=ie+ce,V=oe+fe,J=ie+W-ce,Y=oe+Q-fe;for(let ve=o.current.length-1;ve>=0;ve--){const me=o.current[ve],_e=me.position.x,pe=me.position.y,xe=me.position.x+me.width,Se=me.position.y+me.height;if(!(J<_e||$>xe||Y<pe||V>Se)){Z=me.id;break}}B.current!==Z&&(B.current=Z,O(Z));let ae=0,ue=0,he=[];if((s||H)&&le.length===1){const ve=10/a.scale,me=e.current.filter(xe=>xe.id!==ee);let _e=!1,pe=!1;for(const xe of me){if(_e&&pe)break;const Se=xe.isCollapsed?En:xe.height;if(!_e){const Le=[xe.position.x,xe.position.x+xe.width/2,xe.position.x+xe.width],Ee=[ie,ie+A.width/2,ie+A.width];for(let Me of Le){let De=!1;for(let Te of Ee)if(Math.abs(Te-Me)<ve){ae=Me-Te;const Re=Math.min(oe,xe.position.y)-50,we=Math.max(oe+K,xe.position.y+Se)+50;he.push({type:"vertical",position:Me,start:Re,end:we}),De=!0,_e=!0;break}if(De)break}}if(!pe){const Le=[xe.position.y,xe.position.y+Se/2,xe.position.y+Se],Ee=[oe,oe+K/2,oe+K];for(let Me of Le){let De=!1;for(let Te of Ee)if(Math.abs(Te-Me)<ve){ue=Me-Te;const Re=Math.min(ie,xe.position.x)-50,we=Math.max(ie+A.width,xe.position.x+xe.width)+50;he.push({type:"horizontal",position:Me,start:Re,end:we}),De=!0,pe=!0;break}if(De)break}}}}l(he);const ye=e.current.map(ve=>{const me=re.offsets.get(ve.id);if(me){let _e=ne-me.x+ae,pe=X-me.y+ue;return i&&(_e=Math.round(_e/de)*de,pe=Math.round(pe/de)*de),{...ve,position:{x:_e,y:pe}}}return ve});if(e.current=ye,t(ye),!q){const ve=o.current.filter(me=>me.nodeIds.some(_e=>le.includes(_e)));ve.length>0&&r(me=>me.map(_e=>{if(ve.some(pe=>pe.id===_e.id)){const pe=ye.filter(Se=>_e.nodeIds.includes(Se.id)),xe=vr(pe);return xe?{..._e,...xe}:_e}return _e}))}}else if(re.type==="group"){const ge=re.offsets.get(re.id),te=Math.round((ne-ge.x)/de)*de,le=Math.round((X-ge.y)/de)*de;o.current.find(ee=>ee.id===re.id),r(ee=>ee.map(se=>se.id===re.id?{...se,position:{x:te,y:le}}:se)),t(ee=>ee.map(se=>{const ie=re.offsets.get(se.id);if(ie){let oe=ne-ie.x,A=X-ie.y;return i&&(oe=Math.round(oe/de)*de,A=Math.round(A/de)*de),{...se,position:{x:oe,y:A}}}return se}))}}},processResize:R=>{const q=M.current;if(q){const H=e.current.find(ne=>ne.id===q.nodeId);if(H){const ne=H.dockState?1:a.scale,X=(R.clientX-q.startPosition.x)/ne,re=(R.clientY-q.startPosition.y)/ne,de=Ri(H.type);let ge=H.width,te=H.height,le=H.position.x,ee=H.position.y;const se=q.direction||"se";if(se.includes("e")&&(ge=Math.max(de.minWidth,q.startSize.width+X)),se.includes("s")&&(te=Math.max(de.minHeight,q.startSize.height+re)),se.includes("w")){const oe=Math.max(de.minWidth,q.startSize.width-X);le=H.position.x+(H.width-oe),ge=oe}if(se.includes("n")){const oe=Math.max(de.minHeight,q.startSize.height-re);ee=H.position.y+(H.height-oe),te=oe}i&&(ge=Math.round(ge/20)*20,te=Math.round(te/20)*20),t(oe=>oe.map(A=>A.id===q.nodeId?{...A,width:ge,height:te,position:{x:le,y:ee}}:A));const ie=o.current.filter(oe=>oe.nodeIds.includes(q.nodeId));ie.length>0&&r(oe=>oe.map(A=>{if(ie.some(K=>K.id===A.id)){const K=e.current.map(W=>W.id===q.nodeId?{...W,width:ge,height:te,position:{x:le,y:ee}}:W).filter(W=>A.nodeIds.includes(W.id)),Z=vr(K);return Z?{...A,...Z}:A}return A}))}}},endDrag:()=>{var q;const R=S.current;if(R&&R.type==="node"&&y&&w){const H=(q=R.initialPositions)==null?void 0:q.get(R.id);w(R.id,y,H)}if(R&&R.type==="node"&&g&&m){const H=e.current.find(ne=>ne.id===R.id);if(H&&H.type===L.REROUTE_DOT){const ne={x:H.position.x+H.width/2,y:H.position.y+H.height/2},X=g.find(re=>{if(re.fromNodeId===H.id||re.toNodeId===H.id)return!1;const de=e.current.find(te=>te.id===re.fromNodeId),ge=e.current.find(te=>te.id===re.toNodeId);if(de&&ge){const{start:te,end:le}=qx(de,ge,re);return oC(ne,te,le,20)}return!1});if(X){const re=e.current.find(le=>le.id===X.fromNodeId),de=re?Yn(re,X.fromHandleId):null;de&&t(le=>le.map(ee=>ee.id===H.id?{...ee,value:JSON.stringify({type:de})}:ee));const ge={id:`conn-${Date.now()}-1`,fromNodeId:X.fromNodeId,fromHandleId:X.fromHandleId,toNodeId:H.id,toHandleId:void 0},te={id:`conn-${Date.now()}-2`,fromNodeId:H.id,fromHandleId:void 0,toNodeId:X.toNodeId,toHandleId:X.toHandleId};m(le=>[...le.filter(ee=>ee.id!==X.id),ge,te])}}}if(R&&R.type==="node"){const H=B.current,ne=Array.from(R.offsets.keys());r(X=>{let re=[...X];return H&&!R.isDetaching?re=re.map(de=>de.id===H?{...de,nodeIds:Array.from(new Set([...de.nodeIds,...ne]))}:de.nodeIds.some(ge=>ne.includes(ge))?{...de,nodeIds:de.nodeIds.filter(ge=>!ne.includes(ge))}:de):R.isDetaching&&(re=re.map(de=>({...de,nodeIds:de.nodeIds.filter(ge=>!ne.includes(ge))}))),re.filter(de=>de.nodeIds.length>0).map(de=>{const ge=e.current.filter(te=>de.nodeIds.includes(te.id));return{...de,...vr(ge)||{}}})})}_(null),S.current=null,j(null),M.current=null,O(null),B.current=null,l([]),k(!1),b(null)},draggingInfo:x,resizingInfo:P,setResizingInfo:j,draggingInfoRef:S,resizingInfoRef:M,hoveredGroupIdForDrop:D}},uC=({nodesRef:e,connectionsRef:t,getTransformedPoint:o,setConnections:r,addConnection:a,handleOpenConnectionQuickAdd:i,setNodes:s})=>{const[l,c]=v.useState(null),[d,u]=v.useState(null),[p,h]=v.useState(null),w=v.useCallback((g,m,x)=>{g.stopPropagation(),g.preventDefault();const _=e.current.find(j=>j.id===m);if(!_)return;const S=Yn(_,x),P=o({x:g.clientX,y:g.clientY});c({fromNodeId:m,fromHandleId:x,fromPoint:P,fromType:S})},[o,c,e]),k=v.useCallback((g,m,x)=>{if(g.stopPropagation(),g.touches.length!==1)return;const _=g.touches[0],S=e.current.find(M=>M.id===m);if(!S)return;const P=Yn(S,x),j=o({x:_.clientX,y:_.clientY});c({fromNodeId:m,fromHandleId:x,fromPoint:j,fromType:P})},[o,c,e]);return{connectingInfo:l,connectionTarget:d,hoveredNodeId:p,setHoveredNodeId:h,handleStartConnection:w,handleStartConnectionTouch:k,processConnectionDrag:(g,m)=>{if(!l)return;let x,_;"touches"in m?(x=m.touches[0].clientX,_=m.touches[0].clientY):(x=m.clientX,_=m.clientY);const S=document.elementFromPoint(x,_),P=S==null?void 0:S.closest('[data-is-input-handle="true"]');let j=null,M=null;if(P){const D=P.getAttribute("data-node-id"),O=P.getAttribute("data-handle-id"),B=O===""?void 0:O,E=P.getAttribute("data-handle-type");D&&D!==l.fromNodeId&&(M=D,(!E||E===l.fromType)&&(j={nodeId:D,handleId:B||void 0}))}if(!j){for(let D=e.current.length-1;D>=0;D--){const O=e.current[D],B=20;let E=O.width,I=O.height;if(O.dockState?(E=160,I=48):O.isCollapsed&&(I=En),g.x>=O.position.x-B&&g.x<=O.position.x+E+B&&g.y>=O.position.y&&g.y<=O.position.y+I){M=O.id;break}}if(M&&M!==l.fromNodeId){const D=e.current.find(O=>O.id===M);if(D){let O,B=!1;if(D.type===L.IMAGE_EDITOR){const E=l.fromType;if(E==="image"){let I=!1,N=!1,T=330;try{const F=JSON.parse(D.value||"{}");I=F.isSequenceMode&&F.isSequentialCombinationMode,N=F.isSequenceMode&&F.isSequentialEditingWithPrompts,F.topPaneHeight&&(T=F.topPaneHeight)}catch{}if(N)O="image_b",B=!0;else if(I){const U=D.position.y+52+T*.25,R=D.position.y+52+T*.75,q=Math.abs(g.y-U);O=Math.abs(g.y-R)<q?"image_b":"image",B=!0}else O="image",B=!0}else E==="text"&&(O="text",B=!0)}else if(D.type===L.VIDEO_EDITOR){const E={video:D.position.y+60,audio:D.position.y+110,image:D.position.y+160,text:D.position.y+210},I=l.fromType;if(I&&E[I])O=I,B=!0;else{let N=1/0,T=null;for(const[F,z]of Object.entries(E)){const G=Math.abs(g.y-z);G<N&&(N=G,T=F)}T&&(O=T,B=!0)}}else if(D.type===L.IMAGE_SEQUENCE_GENERATOR)l.fromType==="text"?(O="prompt_input",B=!0):l.fromType==="character_data"&&(O="character_data",B=!0);else if(D.type===L.PROMPT_SEQUENCE_EDITOR)l.fromType==="text"&&(O="prompts_sequence",B=!0);else if(D.type===L.NOTE)l.fromType==="text"&&(O="prompt_data",B=!0);else if(D.type===L.REROUTE_DOT||D.type===L.DATA_READER){const E=t.current.some(T=>T.toNodeId===M),I=m instanceof MouseEvent?m:m.touches[0],N=I.ctrlKey||I.metaKey;(!E||N)&&(O=void 0,B=!0)}else{const E=Bs(D);E&&l.fromType===E&&(O=void 0,B=!0)}B&&(j={nodeId:M,handleId:O})}}}p!==M&&h(M),u(D=>(D==null?void 0:D.nodeId)===(j==null?void 0:j.nodeId)&&(D==null?void 0:D.handleId)===(j==null?void 0:j.handleId)?D:j)},endConnection:(g,m,x)=>{if(l){if(d){const _=g;(_.ctrlKey||_.metaKey)&&r(P=>P.filter(j=>!(j.toNodeId===d.nodeId&&j.toHandleId===d.handleId))),a({fromNodeId:l.fromNodeId,fromHandleId:l.fromHandleId,toNodeId:d.nodeId,toHandleId:d.handleId});const S=e.current.find(P=>P.id===d.nodeId);if(S&&S.type===L.REROUTE_DOT){const P=e.current.find(j=>j.id===l.fromNodeId);if(P){const j=Yn(P,l.fromHandleId);j&&s(M=>M.map(D=>D.id===S.id?{...D,value:JSON.stringify({type:j})}:D))}}}else if(!p&&!m&&!x){let _,S;"changedTouches"in g?(_=g.changedTouches[0].clientX,S=g.changedTouches[0].clientY):(_=g.clientX,S=g.clientY);const P=g.target;if((P.id==="app-container"||P.id==="canvas-transform-layer"||P.tagName.toLowerCase()==="svg"||P.closest("#canvas-transform-layer"))&&i){const M=e.current.find(D=>D.id===l.fromNodeId);i({x:_,y:S},l,M==null?void 0:M.type)}}c(null),u(null),h(null)}},setConnectingInfo:c,setConnectionTarget:u}},pC=e=>{const{selectedNodeIds:t,setSelectedNodeIds:o,nodesRef:r,groupsRef:a,draggingInfoRef:i,isTyping:s,handleSaveCanvas:l,handleLoadCanvas:c,copyNodeValue:d,copyGroup:u,handlePaste:p,handleToggleCatalog:h,handleOpenQuickSearch:w,handleOpenQuickAdd:k,deselectAllNodes:b,handleDuplicateNode:y,handleDuplicateNodeWithContent:g,deleteNodeAndConnections:m,requestDeleteNodes:x,handleGroupSelection:_,handleToggleNodeCollapse:S,handleToggleNodePin:P,onAddNode:j,pointerPositionRef:M,clientPointerPositionRef:D,handleCloseAddNodeMenus:O,setIsSnapToGrid:B,setLineStyle:E,setIsSmartGuidesEnabled:I,setActiveTool:N,setIsShiftDown:T,setIsCtrlDown:F,setIsAltDown:z,setIsZDown:G,setSelectionRect:U,isRadialMenuOpen:R,setIsRadialMenuOpen:q,setRadialMenuPosition:H,radialMenuSelectedItem:ne,setRadialMenuSelectedItem:X,getTransformedPoint:re,radialMenuPosition:de,quickSlots:ge,isConnectionQuickAddOpen:te,isInstantCloseEnabled:le,handleAlignNodes:ee,undoPosition:se,redoPosition:ie,handleValueChange:oe}=e;v.useEffect(()=>{const A=W=>{var $;if((W.ctrlKey||W.metaKey)&&W.code==="Space"){W.preventDefault(),h();return}const Q=W.target;if(Q.tagName==="INPUT"||Q.tagName==="TEXTAREA"||Q.isContentEditable)return;if(W.key==="Shift"&&!W.repeat&&T(!0),W.key==="Control"&&!W.repeat&&F(!0),W.key==="Alt"&&!W.repeat&&z(!0),W.code==="KeyZ"&&!W.repeat&&t.length<=1&&!W.ctrlKey&&!W.metaKey&&G(!0),W.code==="Space"&&!W.ctrlKey&&!W.metaKey&&!W.altKey&&!W.shiftKey&&t.length===0){W.preventDefault(),W.repeat||k(D.current);return}if(W.code==="Tab"&&(W.preventDefault(),R||(H(D.current),q(!0))),(W.ctrlKey||W.metaKey)&&W.code==="KeyZ"){W.preventDefault(),W.shiftKey?ie(r.current):se(r.current);return}if((W.ctrlKey||W.metaKey)&&W.code==="KeyY"){W.preventDefault(),ie(r.current);return}if(t.length>1){if(W.ctrlKey||W.metaKey){if(W.code==="KeyD"){W.preventDefault(),ee(t,"distribute-horizontal");return}if(W.code==="KeyE"){W.preventDefault(),ee(t,"distribute-vertical");return}}else if(!W.ctrlKey&&!W.metaKey&&!W.altKey)switch(W.code){case"KeyF":W.preventDefault(),ee(t,"left");return;case"KeyT":W.preventDefault(),ee(t,"top");return;case"KeyB":W.preventDefault(),ee(t,"bottom");return;case"KeyR":W.preventDefault(),ee(t,"right");return;case"KeyE":W.preventDefault(),ee(t,"center-x");return;case"KeyD":W.preventDefault(),ee(t,"center-y");return;case"KeyZ":W.preventDefault(),se(r.current);return}}else if(W.code==="KeyF"&&!W.ctrlKey&&!W.metaKey&&!W.altKey&&!W.shiftKey){W.preventDefault(),w(D.current);return}if((W.ctrlKey||W.metaKey)&&W.code==="KeyS"){W.preventDefault(),l();return}if((W.ctrlKey||W.metaKey)&&W.code==="KeyO"){W.preventDefault(),c();return}if((W.ctrlKey||W.metaKey)&&!W.shiftKey&&W.code==="KeyC"){const V=window.getSelection();if(V&&V.toString().length>0)return;if(t.length>0){W.preventDefault();const J=t[t.length-1];d(J);return}else if(i.current&&i.current.type==="group"){W.preventDefault(),u(i.current.id);return}else if(i.current&&i.current.type==="node"){const J=i.current.id,Y=a.current.find(ae=>ae.nodeIds.includes(J));if(Y){W.preventDefault(),u(Y.id);return}}}if((W.ctrlKey||W.metaKey)&&W.code==="KeyV"&&(W.preventDefault(),p(W.shiftKey)),(W.ctrlKey||W.metaKey)&&!W.shiftKey&&W.code==="KeyA"){W.preventDefault(),o(r.current.map(V=>V.id));return}if(W.altKey&&W.code==="KeyA"){W.preventDefault(),b();return}if((W.ctrlKey||W.metaKey)&&W.code==="KeyD"&&t.length>0){if(W.preventDefault(),!W.repeat){const V=t.map(J=>g(J)).filter(J=>!!J);V.length>0&&o(V)}return}if(W.code==="KeyD"&&!(W.ctrlKey||W.metaKey)&&t.length>0){if(W.preventDefault(),!W.repeat){const V=t.map(J=>y(J)).filter(J=>!!J);V.length>0&&o(V)}return}if((W.code==="Delete"||W.code==="KeyX")&&t.length>0){W.preventDefault(),W.shiftKey||le?(t.forEach(V=>m(V)),o([])):x(t,D.current);return}if(W.code==="KeyH"&&!W.shiftKey&&!W.ctrlKey&&!W.altKey&&!W.metaKey){W.preventDefault(),W.repeat||t.forEach(S);return}if(W.code==="KeyG"&&!W.shiftKey&&!W.ctrlKey&&!W.altKey&&!W.metaKey){W.preventDefault(),W.repeat||(t.length>1?_():(j(L.GEMINI_CHAT,M.current),O()));return}if(!W.ctrlKey&&!W.metaKey&&!W.altKey&&!W.shiftKey&&W.code.startsWith("Digit")&&!te){const V=parseInt(W.code.replace("Digit",""));if(V>=1&&V<=8){const J=ge[V-1];if(J){W.preventDefault(),W.repeat||j(J,M.current);return}}}let ce=null;const fe=W.code;if(W.ctrlKey&&W.shiftKey)switch(fe){case"KeyA":ce=L.CHARACTER_ANALYZER;break;case"KeyC":ce=L.CHARACTER_CARD;break}else if(W.shiftKey)switch(fe){case"KeyA":ce=L.IMAGE_ANALYZER;break;case"KeyI":ce=L.IMAGE_EDITOR;break;case"KeyC":ce=L.CHARACTER_GENERATOR;break;case"KeyR":ce=L.DATA_READER;break;case"KeyV":ce=L.SCRIPT_VIEWER;break;case"KeyQ":ce=L.IMAGE_SEQUENCE_GENERATOR;break;case"KeyW":W.preventDefault(),W.repeat||B(V=>!V);return;case"KeyE":W.preventDefault(),W.repeat||E(V=>V==="spaghetti"?"orthogonal":"spaghetti");return;case"KeyL":W.preventDefault(),W.repeat||I(V=>!V);return;case"KeyP":ce=L.VIDEO_PROMPT_PROCESSOR;break;case"KeyO":ce=L.VIDEO_OUTPUT;break}else if(!W.ctrlKey&&!W.metaKey&&!W.altKey)switch(fe){case"KeyT":ce=L.TEXT_INPUT;break;case"KeyI":ce=L.IMAGE_INPUT;break;case"KeyA":ce=L.PROMPT_ANALYZER;break;case"KeyP":ce=L.PROMPT_PROCESSOR;break;case"KeyO":ce=L.IMAGE_OUTPUT;break;case"KeyM":t.length===1&&(($=r.current.find(J=>J.id===t[0]))==null?void 0:$.type)===L.MEDIA_VIEWER||(ce=L.MEDIA_VIEWER);break;case"KeyL":ce=L.TRANSLATOR;break;case"KeyN":ce=L.NOTE;break;case"KeyQ":ce=L.PROMPT_SEQUENCE_EDITOR;break;case"KeyE":ce=L.VIDEO_EDITOR;break}if(ce){W.preventDefault(),W.repeat||(j(ce,M.current),O());return}if(!W.metaKey&&!W.shiftKey&&!W.ctrlKey&&!W.altKey)switch(W.code){case"KeyV":W.preventDefault(),N("edit");break;case"KeyC":W.preventDefault(),N("cutter");break;case"KeyS":W.preventDefault(),N("selection");break;case"KeyR":W.preventDefault(),N("reroute");break}},K=W=>{W.key==="Shift"&&(T(!1),U(null)),W.key==="Control"&&F(!1),W.key==="Alt"&&z(!1),W.code==="KeyZ"&&G(!1),W.code==="Tab"&&R&&(ne&&j(ne,re(de)),q(!1),X(null))},Z=()=>{T(!1),F(!1),z(!1),G(!1),q(!1),X(null),U(null)};return window.addEventListener("keydown",A),window.addEventListener("keyup",K),window.addEventListener("blur",Z),window.addEventListener("focus",Z),document.addEventListener("visibilitychange",Z),()=>{window.removeEventListener("keydown",A),window.removeEventListener("keyup",K),window.removeEventListener("blur",Z),window.removeEventListener("focus",Z),document.removeEventListener("visibilitychange",Z)}},[t,r,i,s,l,c,d,u,p,h,w,k,b,y,g,m,x,_,S,j,M,D,O,B,E,I,N,T,F,z,G,U,R,q,H,ne,X,re,de,ge,te,le,ee,se,ie,oe])},hC=e=>{const{nodes:t,setNodes:o,groups:r,setGroups:a,addConnection:i,connections:s,viewTransform:l,setViewTransform:c,updatePointerPosition:d,pan:u,isPanning:p,startPanning:h,stopPanning:w,isSnapToGrid:k,onAddNode:b,removeConnectionsByNodeId:y,handleOpenQuickSearch:g,clientPointerPosition:m,getTransformedPoint:x,getCanvasRelativePoint:_,setZoom:S,t:P,handleDeleteNode:j,handleValueChange:M,handleDuplicateNode:D,handleDuplicateNodeWithContent:O,handleToggleNodeCollapse:B,handleToggleNodePin:E,copyNodeValue:I,pasteImageToNode:N,nodeIdCounter:T,setConnections:F,addGroup:z,handleCloseAddNodeMenus:G,activeTool:U,setActiveTool:R,setSpawnLine:q,pointerPosition:H,setError:ne,handleLoadCanvasIntoCurrentTab:X,setIsSnapToGrid:re,setLineStyle:de,deleteNodeAndConnections:ge,handleToggleCatalog:te,draggingInfo:le,setDraggingInfo:ee,handleDetachNodeFromGroup:se,handleSaveCanvas:ie,handleLoadCanvas:oe,handleOpenConnectionQuickAdd:A,handleOpenContextMenu:K,quickSlots:Z,isConnectionQuickAddOpen:W,pasteGroup:Q,copyGroup:ce,isSmartGuidesEnabled:fe,setIsSmartGuidesEnabled:$,setSmartGuides:V,selectedNodeIds:J,setSelectedNodeIds:Y,handleRenameNode:ae,setFullSizeImage:ue,handleOpenQuickAdd:he,requestDeleteNodes:ye,isInstantCloseEnabled:ve,handleAlignNodes:me,handleDockNode:_e,handlePaste:pe,selectNode:xe,dockHoverMode:Se,setDockHoverMode:Le,isDockingMenuVisible:Ee,setIsDockingMenuVisible:Me,undoPosition:De,redoPosition:Te}=e,Re=v.useRef(t);v.useEffect(()=>{Re.current=t},[t]);const we=v.useRef(r);v.useEffect(()=>{we.current=r},[r]);const Ce=v.useRef(s);v.useEffect(()=>{Ce.current=s},[s]);const qe=v.useRef(H);v.useEffect(()=>{qe.current=H},[H]);const Be=v.useRef(m);v.useEffect(()=>{Be.current=m},[m]);const[Ie,We]=v.useState(null),[at,Jt]=v.useState(null),[Oe,Ae]=v.useState(!1),[Ue,ke]=v.useState(!1),[Ne,He]=v.useState(!1),[Fe,$e]=v.useState(!1),[Ye,st]=v.useState(!1),[ht,ft]=v.useState(null),[mt,dt]=v.useState({x:0,y:0}),kt=v.useCallback(Ke=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur(),R(Ke)},[R]),Ct=Fe?"zoom":U==="edit"?Ue&&Ne?"reroute":Ue?"cutter":Oe?"selection":"edit":U,vt=cC({viewTransform:l,setViewTransform:c,isPanning:p,pan:u,startPanning:h,stopPanning:w,getCanvasRelativePoint:_,setZoom:S,handleCloseAddNodeMenus:G,setSelectedNodeIds:Y,effectiveTool:Ct,setZoomDragInfo:We,getTransformedPoint:x,setSelectionRect:Jt}),yt=dC({nodesRef:Re,setNodes:o,groupsRef:we,setGroups:a,viewTransform:l,isSnapToGrid:k,isSmartGuidesEnabled:fe,setSmartGuides:V,handleCloseAddNodeMenus:G,setSelectedNodeIds:Y,selectedNodeIds:J,getTransformedPoint:x,activeTool:U,handleDockNode:_e,setIsDockingMenuVisible:Me,setDockHoverMode:Le,dockHoverMode:Se,connections:s,setConnections:F}),wt=uC({nodesRef:Re,connectionsRef:Ce,getTransformedPoint:x,setConnections:F,addConnection:i,handleOpenConnectionQuickAdd:A,setNodes:o});pC({selectedNodeIds:J,setSelectedNodeIds:Y,nodesRef:Re,groupsRef:we,draggingInfoRef:yt.draggingInfoRef,isTyping:!1,handleSaveCanvas:ie,handleLoadCanvas:oe,copyNodeValue:I,copyGroup:ce,handlePaste:pe,handleToggleCatalog:te,handleOpenQuickSearch:g,handleOpenQuickAdd:he,deselectAllNodes:()=>Y([]),handleDuplicateNode:D,handleDuplicateNodeWithContent:O,deleteNodeAndConnections:ge,requestDeleteNodes:ye,handleGroupSelection:()=>{if(J.length>1){const Ke=Re.current.filter(Xe=>J.includes(Xe.id));z(Ke),Y([])}},handleToggleNodeCollapse:B,handleToggleNodePin:E,onAddNode:b,pointerPositionRef:qe,clientPointerPositionRef:Be,handleCloseAddNodeMenus:G,setIsSnapToGrid:re,setLineStyle:de,setIsSmartGuidesEnabled:$,setActiveTool:kt,setIsShiftDown:Ae,setIsCtrlDown:ke,setIsAltDown:He,setIsZDown:$e,setSelectionRect:Jt,isRadialMenuOpen:Ye,setIsRadialMenuOpen:st,setRadialMenuPosition:dt,radialMenuSelectedItem:ht,setRadialMenuSelectedItem:ft,getTransformedPoint:x,radialMenuPosition:mt,quickSlots:Z,isConnectionQuickAddOpen:W,isInstantCloseEnabled:ve,handleAlignNodes:me,undoPosition:De,redoPosition:Te,handleValueChange:M});const qn=v.useCallback(Ke=>{const Xe=Ke.target;Xe.closest(".node-view")||Xe.closest(".group-view")||Xe.closest("button")||Xe.closest("input")||Xe.closest("textarea")||Xe.closest(".ui-panel")||Xe.closest('[role="dialog"]')||(Xe.id==="app-container"||Xe.id==="canvas-transform-layer"||Xe.tagName==="svg"||Xe.classList.contains("connection-view"))&&(Ke.preventDefault(),he({x:Ke.clientX,y:Ke.clientY}))},[he]),Cn=()=>Ie?"ew-resize":yt.draggingInfo?"grabbing":Ct==="selection"?"crosshair":Ct==="zoom"?"ew-resize":Ct==="edit"||Ct==="cutter"||Ct==="reroute"?p?"grabbing":"grab":"default",Pt=Ke=>{const Xe="touches"in Ke,rt=yt.draggingInfoRef.current,ot=yt.resizingInfoRef.current;(rt||ot||wt.connectingInfo||at||p)&&Ke.cancelable&&Ke.preventDefault();let et=Ke;if(Xe?et=Ke.touches[0]:"pointerId"in Ke&&(et=Ke),!et)return;d({clientX:et.clientX,clientY:et.clientY});const bt=x({x:et.clientX,y:et.clientY});if(p&&(Ke.type==="touchmove"?vt.handleCanvasTouchMove(Ke):u({x:et.clientX,y:et.clientY})),Ie){const _t=et.clientX-Ie.startClientX,Nt=Math.pow(2,_t/300),It=Math.max(.2,Math.min(2,(Ie.startScale||1)*Nt));S(It,Ie.pivot);return}wt.connectingInfo&&wt.processConnectionDrag(bt,Ke),rt?yt.processDrag(et,Ne,Oe):ot?yt.processResize(et):at&&Jt({start:at.start,end:x({x:et.clientX,y:et.clientY})})},je=Ke=>{if(p&&w(),Ie&&We(null),at){const Xe=at,rt=Math.min(Xe.start.x,Xe.end.x),ot=Math.min(Xe.start.y,Xe.end.y),et=Math.abs(Xe.start.x-Xe.end.x),bt=Math.abs(Xe.start.y-Xe.end.y);if(et>0&&bt>0){const _t=Re.current.filter(xt=>{const Nt=xt.isCollapsed?En:xt.height;return xt.position.x<rt+et&&xt.position.x+xt.width>rt&&xt.position.y<ot+bt&&xt.position.y+Nt>ot}).map(xt=>xt.id);Y(_t),_t.length>0&&o(xt=>xt.map(Nt=>_t.includes(Nt.id)&&Nt.isNewlyCreated?{...Nt,isNewlyCreated:!1}:Nt))}Jt(null)}(yt.draggingInfoRef.current||yt.resizingInfoRef.current)&&yt.endDrag(),wt.connectingInfo&&wt.endConnection(Ke,p,yt.draggingInfoRef.current)};v.useEffect(()=>(window.addEventListener("mousemove",Pt),window.addEventListener("mouseup",je),window.addEventListener("touchmove",Pt,{passive:!1}),window.addEventListener("touchend",je),window.addEventListener("pointermove",Pt),window.addEventListener("pointerup",je),()=>{window.removeEventListener("mousemove",Pt),window.removeEventListener("mouseup",je),window.removeEventListener("touchmove",Pt),window.removeEventListener("touchend",je),window.removeEventListener("pointermove",Pt),window.removeEventListener("pointerup",je)}),[p,Ie,at,wt.connectingInfo,wt.connectionTarget,wt.endConnection,yt.draggingInfoRef.current,yt.resizingInfoRef.current,Ne,l,k,fe,Oe]);const Ve=v.useMemo(()=>{if(J.length<2)return null;const Ke=t.filter(et=>J.includes(et.id));if(Ke.length<2)return null;let Xe=1/0,rt=1/0,ot=-1/0;return Ke.forEach(et=>{Xe=Math.min(Xe,et.position.x),rt=Math.min(rt,et.position.y),ot=Math.max(ot,et.position.x+et.width)}),{x:(Xe+ot)/2,y:rt-60}},[t,J]);return{handleCanvasMouseDown:vt.handleCanvasMouseDown,handleCanvasTouchStart:vt.handleCanvasTouchStart,handleCanvasTouchMove:vt.handleCanvasTouchMove,handleCanvasTouchEnd:vt.handleCanvasTouchEnd,getCanvasCursor:Cn,selectedNodeIds:J,setSelectedNodeIds:Y,connectingInfo:wt.connectingInfo,setConnectingInfo:wt.setConnectingInfo,zoomDragInfo:Ie,setZoomDragInfo:We,resizingInfo:yt.resizingInfo,setResizingInfo:yt.setResizingInfo,hoveredNodeId:wt.hoveredNodeId,setHoveredNodeId:wt.setHoveredNodeId,connectionTarget:wt.connectionTarget,setConnectionTarget:wt.setConnectionTarget,handleNodeResizeMouseDown:yt.handleNodeResizeMouseDown,handleNodeMouseDown:yt.handleNodeMouseDown,handleNodeTouchStart:yt.handleNodeTouchStart,handleGroupMouseDown:yt.handleGroupMouseDown,handleGroupTouchStart:yt.handleGroupTouchStart,handleStartConnection:wt.handleStartConnection,handleStartConnectionTouch:wt.handleStartConnectionTouch,isRadialMenuOpen:Ye,setIsRadialMenuOpen:st,radialMenuPosition:mt,setRadialMenuPosition:dt,radialMenuSelectedItem:ht,setRadialMenuSelectedItem:ft,deselectAllNodes:()=>Y([]),setSelectionRect:Jt,selectionRect:at,effectiveTool:Ct,setActiveTool:kt,hoveredGroupIdForDrop:yt.hoveredGroupIdForDrop,draggingInfo:yt.draggingInfo,handleGroupSelection:()=>{if(J.length>1){const Ke=Re.current.filter(Xe=>J.includes(Xe.id));z(Ke),Y([])}},handleCanvasDoubleClick:qn,dockHoverMode:Se,setDockHoverMode:Le,isDockingMenuVisible:Ee,setIsDockingMenuVisible:Me,clientPointerPositionRef:Be,groupButtonPosition:Ve,handlePaste:pe,selectNode:xe}},mC=e=>{const{getCurrentCanvasState:t,loadCanvasState:o,setError:r,nodes:a,handleValueChange:i,addToast:s,t:l,activeTabName:c,getFullSizeImage:d,handleRenameTab:u,activeTabId:p,setFullSizeImage:h,tabs:w,setTabs:k,setActiveTabId:b,catalogItems:y,setCatalogItems:g,libraryItems:m,setLibraryItems:x,characterCatalog:_,scriptCatalog:S,sequenceCatalog:P,language:j,setLanguage:M,isSnapToGrid:D,setIsSnapToGrid:O,lineStyle:B,setLineStyle:E,setConfirmInfo:I,handleRenameNode:N,onAddNode:T,pasteGroup:F,viewTransform:z}=e,G=v.useRef(null),U=v.useRef(null),R=v.useRef(null),q=v.useRef(null),H=v.useRef(null),ne=v.useRef(null),X=()=>new Date().toISOString().replace(/:/g,"-").replace("T","_").split(".")[0],re=v.useCallback(()=>{const $={type:"prompt-modifier-canvas",appName:"Prompt_modifier",version:1,...t(),timestamp:new Date().toISOString()},V=new Blob([JSON.stringify($,null,2)],{type:"application/json"}),J=URL.createObjectURL(V),Y=document.createElement("a");Y.href=J;const ae=c.trim().replace(/\s+/g,"_");Y.download=`Prompt_Modifier_${ae}_${X()}.PMC`,Y.click(),URL.revokeObjectURL(J),Y.remove(),s(l("toast.canvasSaved"),"success")},[t,c,s,l]),de=v.useCallback(()=>{const fe=t(),$=w.map(ue=>ue.id===p?{...ue,state:fe}:ue),V={type:"prompt-modifier-project",appName:"Prompt_modifier",version:1,timestamp:new Date().toISOString(),tabs:$,activeTabId:p,settings:{language:j,isSnapToGrid:D,lineStyle:B},catalogs:{groups:y,library:m,characters:_.items,scripts:S.items,sequences:P.items}},J=new Blob([JSON.stringify(V,null,2)],{type:"application/json"}),Y=URL.createObjectURL(J),ae=document.createElement("a");ae.href=Y,ae.download=`Prompt_Modifier_Project_${X()}.PMP`,ae.click(),URL.revokeObjectURL(Y),ae.remove(),s(l("toast.projectSaved"),"success")},[t,w,p,j,D,B,y,m,_.items,S.items,P.items,s,l]),ge=v.useCallback(fe=>{try{const $=JSON.parse(fe);if($.type==="prompt-modifier-project"){$.tabs&&Array.isArray($.tabs)&&(k($.tabs),$.activeTabId&&b($.activeTabId)),$.settings&&($.settings.language&&M($.settings.language),$.settings.isSnapToGrid!==void 0&&O($.settings.isSnapToGrid),$.settings.lineStyle&&E($.settings.lineStyle)),$.catalogs&&($.catalogs.groups&&g($.catalogs.groups),$.catalogs.library&&x($.catalogs.library),$.catalogs.characters&&_.replaceAllItems($.catalogs.characters),$.catalogs.scripts&&S.replaceAllItems($.catalogs.scripts),$.catalogs.sequences&&P.replaceAllItems($.catalogs.sequences)),s(l("toast.downloadStarted"),"success");return}let V;if($.nodes&&$.connections)V={nodes:$.nodes||[],connections:$.connections||[],groups:$.groups||[],viewTransform:$.viewTransform||{scale:1,translate:{x:0,y:0}},nodeIdCounter:$.nodeIdCounter||100,fullSizeImageCache:$.fullSizeImageCache||{}};else throw new Error("Invalid file format");o(V)}catch($){console.error("Load error:",$),r(`Failed to load file: ${$.message}`)}},[k,b,M,O,E,g,x,_,S,P,o,r,s,l]),te=v.useCallback(fe=>{var ae;const $=(ae=fe.target.files)==null?void 0:ae[0];if(!$)return;const V=$.name.match(/^Prompt_Modifier_(.+?)_\d{4}-\d{2}-\d{2}/),J=V&&V[1]?V[1].replace(/_/g," "):null,Y=new FileReader;Y.onload=ue=>{var ye;const he=(ye=ue.target)==null?void 0:ye.result;try{const ve=JSON.parse(he);if(ve.type==="script-modifier-project"||ve.type==="script-modifier-canvas"){r(l("error.scriptModifierCanvas"));return}const me=ve.type==="prompt-modifier-project",_e=()=>{ge(he),!me&&J&&u(p,J)};I({title:l("dialog.confirmLoad.title"),message:l("dialog.confirmLoad.message")+(me?" (Loading Project)":""),onConfirm:_e})}catch{r("Invalid JSON file.")}},Y.readAsText($),fe.target&&(fe.target.value="")},[ge,I,l,r,u,p]),le=v.useCallback(()=>{var fe;(fe=G.current)==null||fe.click()},[]),ee=v.useCallback(fe=>{var $;ne.current=fe,($=U.current)==null||$.click()},[]),se=v.useCallback(fe=>{var ae;const $=(ae=fe.target.files)==null?void 0:ae[0];if(!$||!ne.current)return;const V=ne.current,J=a.find(ue=>ue.id===V);if(!J)return;const Y=new FileReader;Y.onload=ue=>{var ye;const he=(ye=ue.target)==null?void 0:ye.result;try{const ve=JSON.parse(he);let me=[],_e=[],pe="",xe=[],Se={};if(ve.type==="script-prompt-modifier-data"?(me=ve.finalPrompts||ve.prompts||[],_e=ve.videoPrompts||[],pe=ve.styleOverride||"",xe=ve.usedCharacters||[],Se=ve.sceneContexts||{}):Array.isArray(ve)?me=ve:ve.prompts&&(me=ve.prompts),Array.isArray(me)){const Le=new Map(_e.map(Re=>[Re.frameNumber,Re])),Ee=me.map((Re,we)=>{const Ce=Re.frameNumber!==void 0?Re.frameNumber:we+1,qe=Le.get(Ce);let Be=Re.characters||[];const Ie=Re.prompt||"";if(Be.length===0&&Ie){const We=Ie.match(/(?:character|entity)-\d+/gi)||[];Be=[...new Set(We.map(at=>at.toLowerCase().replace(/character-/i,"Entity-").replace(/entity-/i,"Entity-")))]}return{frameNumber:Ce,sceneNumber:Re.sceneNumber||1,sceneTitle:Re.sceneTitle||"",prompt:Ie,videoPrompt:(qe==null?void 0:qe.videoPrompt)||Re.videoPrompt||"",shotType:Re.shotType||Re.ShotType||(qe==null?void 0:qe.shotType)||"WS",characters:Be,isCollapsed:!0,duration:Re.duration||3}}),Me=JSON.parse(J.value||"{}"),De=Ee.reduce((Re,we)=>({...Re,[we.frameNumber]:"idle"}),{}),Te={prompts:Ee,frameStatuses:De,selectedFrameNumber:null,checkedFrameNumbers:[]};pe&&(Te.styleOverride=pe),xe.length>0&&(Te.usedCharacters=xe),Object.keys(Se).length>0&&(Te.sceneContexts=Se),i(V,JSON.stringify({...Me,...Te}))}else r("Invalid Image Sequence format.")}catch(ve){r(`Error loading sequence file: ${ve.message}`)}},Y.readAsText($),ne.current=null,fe.target&&(fe.target.value="")},[a,i,r]),ie=v.useCallback(fe=>{var $;ne.current=fe,($=R.current)==null||$.click()},[]),oe=v.useCallback(fe=>{var ae;const $=(ae=fe.target.files)==null?void 0:ae[0];if(!$||!ne.current)return;const V=ne.current,J=a.find(ue=>ue.id===V);if(!J)return;const Y=new FileReader;Y.onload=ue=>{var ye;const he=(ye=ue.target)==null?void 0:ye.result;try{const ve=JSON.parse(he);let me=null,_e=null,pe="",xe=[],Se={};if(ve&&ve.type==="script-prompt-modifier-data"?(me=ve.finalPrompts||ve.prompts,_e=ve.videoPrompts,pe=ve.styleOverride||"",xe=ve.usedCharacters||[],Se=ve.sceneContexts||{}):Array.isArray(ve)?me=ve:ve&&Array.isArray(ve.prompts)?me=ve.prompts:ve&&Array.isArray(ve.finalPrompts)&&(me=ve.finalPrompts),me&&Array.isArray(me)){const Le=new Map((_e||[]).map(De=>[De.frameNumber,De])),Ee=me.map((De,Te)=>{const Re=De.frameNumber!==void 0?De.frameNumber:Te+1,we=Le.get(Re);let Ce=De.prompt||(typeof De=="string"?De:""),qe=De.characters||[];if(qe.length===0&&Ce){const Be=Ce.match(/(?:character|entity)-\d+/gi)||[];qe=[...new Set(Be.map(Ie=>Ie.toLowerCase().replace(/character-/i,"Entity-").replace(/entity-/i,"Entity-")))]}return{frameNumber:Re,sceneNumber:De.sceneNumber||1,sceneTitle:De.sceneTitle||"",prompt:Ce,videoPrompt:(we==null?void 0:we.videoPrompt)||De.videoPrompt||"",shotType:De.shotType||De.ShotType||(we==null?void 0:we.shotType)||"WS",characters:qe,isCollapsed:!0,duration:De.duration||3}}),Me=JSON.parse(J.value||"{}");if(J.type===L.PROMPT_SEQUENCE_EDITOR){const De={sourcePrompts:Ee,modifiedPrompts:[],checkedSourceFrameNumbers:[],isStyleCollapsed:!0};pe&&(De.styleOverride=pe),xe.length>0&&(De.usedCharacters=xe),Object.keys(Se).length>0&&(De.sceneContexts=Se);const Te=JSON.stringify({...Me,...De});i(V,Te)}}else throw new Error("JSON is not an array of prompts or does not contain a 'prompts' or 'finalPrompts' array.")}catch(ve){r(`Error loading prompts file: ${ve.message}`)}},Y.readAsText($),ne.current=null,fe.target&&(fe.target.value="")},[a,i,r]),A=v.useCallback(fe=>{var $;ne.current=fe,($=q.current)==null||$.click()},[]),K=v.useCallback(fe=>{var Y;const $=(Y=fe.target.files)==null?void 0:Y[0];if(!$||!ne.current)return;const V=ne.current,J=new FileReader;J.onload=async ae=>{var he;const ue=(he=ae.target)==null?void 0:he.result;try{let ye=JSON.parse(ue);Array.isArray(ye)||(ye=[ye]);const ve=await Promise.all(ye.map(async(me,_e)=>{const pe=me.imageSources||{"1:1":null,"16:9":null,"9:16":null},xe={"1:1":null,"16:9":null,"9:16":null};me.image&&!me.imageSources&&(pe["1:1"]=me.image);for(const[Ee,Me]of Object.entries(pe))if(typeof Me=="string"&&Me.startsWith("data:")){const De=$t[Ee];De&&h(V,_e*10+De,Me);const Te=await Rt(Me,256,256);xe[Ee]=Te}else xe[Ee]=Me;const Se=me.selectedRatio||"1:1",Le=pe[Se];return Le&&typeof Le=="string"&&Le.startsWith("data:")&&h(V,_e*10,Le),{id:me.id||`char-card-${Date.now()}-${_e}`,name:me.name||"",index:me.index||me.alias||`Entity-${_e+1}`,image:xe[Se],thumbnails:xe,selectedRatio:Se,prompt:me.prompt||me.imagePrompt||"",fullDescription:me.fullDescription||me.description||"",targetLanguage:me.targetLanguage||"en",isOutput:me.isOutput||_e===0,isDescriptionCollapsed:me.isDescriptionCollapsed??!1}}));ye.length===1&&(ye[0].nodeTitle||ye[0].title)&&N(V,ye[0].nodeTitle||ye[0].title),i(V,JSON.stringify(ve)),s(l("toast.characterLoaded"))}catch(ye){r(`Error loading character card: ${ye.message}`)}},J.readAsText($),ne.current=null,fe.target&&(fe.target.value="")},[N,i,h,s,l,r]),Z=v.useCallback((fe,$)=>{var J;const V=a.find(Y=>Y.id===fe);if(!(!V||V.type!==L.CHARACTER_CARD))try{let Y=JSON.parse(V.value||"[]");Array.isArray(Y)||(Y=[Y]);let ae=[];if($!==void 0){const xe=Y[$];if(!xe)return;const Se={type:"character-card",nodeTitle:V.title,...xe,image:d(fe,$*10)||xe.image,imageSources:{...xe.thumbnails},index:xe.index||xe.alias||`Entity-${$+1}`};Object.entries($t).forEach(([Le,Ee])=>{const Me=d(fe,$*10+Ee);Me&&(Se.imageSources[Le]=Me)}),delete Se.thumbnails,delete Se.alias,ae=Se}else ae=Y.map((xe,Se)=>{const Le={...xe.thumbnails};Object.entries($t).forEach(([De,Te])=>{const Re=d(fe,Se*10+Te);Re&&(Le[De]=Re)});const Ee=d(fe,Se*10)||xe.image,Me={type:"character-card",nodeTitle:V.title,...xe,image:Ee,imageSources:Le,index:xe.index||xe.alias||`Entity-${Se+1}`};return delete Me.thumbnails,delete Me.alias,Me});const ue=JSON.stringify(ae,null,2),he=new Blob([ue],{type:"application/json"}),ye=URL.createObjectURL(he),ve=document.createElement("a");ve.href=ye;let me=V.title||"Character_Card";$!==void 0&&(me=((J=Y[$])==null?void 0:J.name)||`Character_${$+1}`);const _e=me.trim().replace(/[\\/:*?"<>|]/g,"").replace(/\s+/g,"_"),pe=X();ve.download=`${_e}_${pe}.CHAR`,ve.click(),URL.revokeObjectURL(ye),ve.remove(),s(l("toast.characterSavedDisk"))}catch{r("Failed to save character card.")}},[a,d,s,l,r]),W=v.useCallback(fe=>{var $;ne.current=fe,($=H.current)==null||$.click()},[]),Q=v.useCallback(fe=>{var Y;const $=(Y=fe.target.files)==null?void 0:Y[0];if(!$||!ne.current)return;const V=ne.current,J=new FileReader;J.onload=ae=>{var he;const ue=(he=ae.target)==null?void 0:he.result;try{JSON.parse(ue),i(V,ue)}catch(ye){r(`Error loading script file: ${ye.message}`)}},J.readAsText($),ne.current=null,fe.target&&(fe.target.value="")},[i,r]),ce=v.useCallback(fe=>{const $=a.find(he=>he.id===fe);if(!$)return;let V="",J=`file_${X()}.json`;if($.type===L.SCRIPT_GENERATOR||$.type===L.SCRIPT_VIEWER)V=$.value,J=`script_${X()}.json`;else if($.type===L.PROMPT_SEQUENCE_EDITOR)try{const he=$.value?JSON.parse($.value):{},ye=he.sourcePrompts||[],ve=he.modifiedPrompts||[],me=new Map(ve.map(Se=>[Se.frameNumber,Se])),_e=ye.map(Se=>{const Le=me.get(Se.frameNumber);return Le?{...Se,...Le}:Se}),pe={type:"script-prompt-modifier-data",title:$.title||" ",usedCharacters:he.usedCharacters||[],sceneContexts:he.sceneContexts||{},finalPrompts:_e.map(Se=>({frameNumber:Se.frameNumber,sceneNumber:Se.sceneNumber||1,sceneTitle:Se.sceneTitle||"",characters:Se.characters||[],duration:Se.duration||3,prompt:Se.prompt||"",shotType:Se.shotType||"WS"})),videoPrompts:_e.map(Se=>({sceneNumber:Se.sceneNumber||1,sceneTitle:Se.sceneTitle||"",frameNumber:Se.frameNumber,videoPrompt:Se.videoPrompt||"",shotType:Se.shotType||"WS"})),targetLanguage:"en",startFrameNumber:1,endFrameNumber:_e.length,startSceneNumber:null,endSceneNumber:null,styleOverride:he.styleOverride||"",breakIntoParagraphs:!1,copyVideoPrompt:!0,characterPaneHeight:160,isAdvancedMode:!0,model:"gemini-3-pro-preview",processWholeScene:!1,uiState:{isSettingsCollapsed:!1}};V=JSON.stringify(pe,null,2),J=`${($.title||"sequence").trim().replace(/\s+/g,"_")}_${X()}.json`}catch{r("Failed to parse sequence editor data for saving to disk.");return}else if($.type===L.IMAGE_SEQUENCE_GENERATOR)try{const he=$.value?JSON.parse($.value):{},ye=(he.prompts||[]).map(({frameNumber:_e,characters:pe,duration:xe,prompt:Se,videoPrompt:Le,sceneNumber:Ee,sceneTitle:Me,shotType:De})=>({frameNumber:_e,characters:pe,duration:xe,prompt:Se,videoPrompt:Le,sceneNumber:Ee||1,sceneTitle:Me||"",shotType:De||"WS"})),ve={type:"script-prompt-modifier-data",title:$.title||"Sequence Generator",usedCharacters:he.usedCharacters||[],sceneContexts:he.sceneContexts||{},finalPrompts:ye.map(_e=>({frameNumber:_e.frameNumber,sceneNumber:_e.sceneNumber,sceneTitle:_e.sceneTitle,characters:_e.characters,duration:_e.duration,prompt:_e.prompt,shotType:_e.shotType})),videoPrompts:ye.map(_e=>({sceneNumber:_e.sceneNumber,sceneTitle:_e.sceneTitle,frameNumber:_e.frameNumber,videoPrompt:_e.videoPrompt||"",shotType:_e.shotType})),styleOverride:he.styleOverride||""};V=JSON.stringify(ve,null,2),J=`${($.title||"seq_gen").trim().replace(/\s+/g,"_")}_${X()}.json`}catch{r("Failed to parse sequence generator data for saving to disk.");return}else return;const Y=new Blob([V],{type:"application/json"}),ae=URL.createObjectURL(Y),ue=document.createElement("a");ue.href=ae,ue.download=J,ue.click(),URL.revokeObjectURL(ae),ue.remove(),s(l("toast.scriptSaved"))},[a,s,l,r]);return{fileInputRef:G,handleFileChange:te,handleLoadCanvas:le,handleSaveCanvas:re,handleSaveProject:de,handleLoadCanvasIntoCurrentTab:ge,imageSequenceFileInputRef:U,handleImageSequenceFileChange:se,triggerLoadImageSequenceFile:ee,promptSequenceEditorFileInputRef:R,handlePromptSequenceFileChange:oe,triggerLoadPromptSequenceFile:ie,characterCardFileInputRef:q,handleCharacterCardFileChange:K,triggerLoadCharacterCard:A,handleSaveCharacterCard:Z,scriptFileInputRef:H,handleScriptFileChange:Q,triggerLoadScriptFile:W,handleSaveScriptFile:ce}},gC=new Map,fC=e=>{gC.delete(e)},xC="PromptModifierSessionDB",La="AppState",ru="latest_session",yC=1,Ox=()=>new Promise((e,t)=>{const o=indexedDB.open(xC,yC);o.onerror=()=>t(o.error),o.onsuccess=()=>e(o.result),o.onupgradeneeded=()=>{o.result.objectStoreNames.contains(La)||o.result.createObjectStore(La)}}),nm=async(e,t)=>{const o=await Ox();return new Promise((r,a)=>{const l=o.transaction(La,"readwrite").objectStore(La).put({id:ru,tabs:e,activeTabId:t},ru);l.onerror=()=>a(l.error),l.onsuccess=()=>r()})},vC=async()=>{const e=await Ox();return new Promise((t,o)=>{const i=e.transaction(La,"readonly").objectStore(La).get(ru);i.onerror=()=>o(i.error),i.onsuccess=()=>{const s=i.result;s&&Array.isArray(s.tabs)&&s.activeTabId?t({tabs:s.tabs,activeTabId:s.activeTabId}):t(void 0)}})},Hs=e=>({nodes:[{id:"node-19-1761553959672",type:L.GEMINI_CHAT,position:{x:80,y:1160},value:'{"messages":[],"currentInput":""}',title:qo(e,"node.title.gemini_chat"),width:400,height:640},{id:"node-46-1761685266349",type:L.TEXT_INPUT,position:{x:80,y:380},value:"",title:qo(e,"node.title.text_input"),width:460,height:300},{id:"node-49-1761685294534",type:L.PROMPT_PROCESSOR,position:{x:640,y:320},value:"",title:qo(e,"node.title.prompt_processor"),width:460,height:420},{id:"node-53-1761685402016",type:L.TEXT_INPUT,position:{x:80,y:60},value:"",title:qo(e,"node.title.text_input"),width:460,height:300},{id:"node-54-1761685404557",type:L.TEXT_INPUT,position:{x:80,y:700},value:"",title:qo(e,"node.title.text_input"),width:460,height:300},{id:"node-55-1761685416437",type:L.IMAGE_OUTPUT,position:{x:1220,y:60},value:"",title:qo(e,"node.title.image_output"),width:460,height:940,aspectRatio:"1:1",model:"gemini-2.5-flash-image",autoDownload:!0},{id:"node-82-1761838643720",type:L.TRANSLATOR,position:{x:560,y:1160},value:'{"inputText":"","targetLanguage":"ru","translatedText":"","inputHeight":197}',title:qo(e,"node.title.translator"),width:460,height:640}],connections:[{fromNodeId:"node-49-1761685294534",toNodeId:"node-55-1761685416437",id:"conn-1761685421734-dlsqz1009"},{fromNodeId:"node-53-1761685402016",toNodeId:"node-49-1761685294534",id:"conn-1765381486428-7mzadq6ki"},{fromNodeId:"node-46-1761685266349",toNodeId:"node-49-1761685294534",id:"conn-1765381487379-rsa3lf6ts"},{fromNodeId:"node-54-1761685404557",toNodeId:"node-49-1761685294534",id:"conn-1765381488527-69zcwd7sm"}],groups:[],viewTransform:{scale:1,translate:{x:21.096368784472816,y:34.78642041088381}},nodeIdCounter:85,fullSizeImageCache:{}}),Fx=Hs("en"),cs=(e,t)=>({id:`tab-${Date.now()}`,name:e,state:{nodes:(t==null?void 0:t.nodes)||[],connections:(t==null?void 0:t.connections)||[],groups:(t==null?void 0:t.groups)||[],viewTransform:(t==null?void 0:t.viewTransform)||{scale:1,translate:{x:0,y:0}},nodeIdCounter:(t==null?void 0:t.nodeIdCounter)||0,fullSizeImageCache:(t==null?void 0:t.fullSizeImageCache)||{}}}),wC=()=>{const[e,t]=v.useState(()=>[cs("Canvas 1",Fx)]),[o,r]=v.useState(e[0].id),[a,i]=v.useState(!1),s=v.useRef(null),[l,c]=v.useState(null),[d,u]=v.useState(!1);v.useEffect(()=>{(async()=>{try{const _=await vC();_&&(t(_.tabs),r(_.activeTabId))}catch(_){console.error("Failed to load session from IndexedDB:",_)}finally{i(!0)}})()},[]),v.useEffect(()=>{if(!a)return;s.current&&clearTimeout(s.current);const x=6e4;return c(Date.now()+x),s.current=setTimeout(()=>{u(!0);const _=async()=>{try{await nm(e,o)}catch(S){console.error("Failed to auto-save session:",S)}finally{u(!1),c(null)}};"requestIdleCallback"in window?window.requestIdleCallback(_,{timeout:5e3}):_()},x),()=>{s.current&&clearTimeout(s.current)}},[e,o,a]);const p=v.useCallback(x=>{x!==o&&r(x)},[o]),h=v.useCallback(()=>{const x=cs(`Canvas ${e.length+1}`);t(_=>[..._,x]),r(x.id)},[e.length]),w=v.useCallback(x=>{fC(x),t(_=>{if(_.length<=1)return _;const S=_.findIndex(j=>j.id===x),P=_.filter(j=>j.id!==x);if(o===x){const j=Math.max(0,S-1);r(P[j].id)}return P})},[o]),k=v.useCallback((x,_)=>{t(S=>S.map(P=>P.id===x?{...P,name:_}:P))},[]),b=v.useCallback(x=>{const _=Hs(x),S=cs("Canvas 1",_);t([S]),r(S.id),nm([S],S.id)},[]),y=v.useCallback(x=>{const _=Hs(x);t(S=>S.map(P=>P.id===o?{...P,state:_}:P))},[o]),g=v.useCallback(x=>{t(_=>_.map(S=>S.id===o?{...S,state:x}:S))},[o]),m=v.useCallback(()=>{var x;return((x=e.find(_=>_.id===o))==null?void 0:x.state)||cs("").state},[e,o]);return{tabs:e,setTabs:t,activeTabId:o,setActiveTabId:r,handleSwitchTab:p,handleAddTab:h,handleCloseTab:w,handleRenameTab:k,loadCanvasState:g,getCurrentCanvasState:m,resetTabs:b,resetCurrentTab:y,getLocalizedCanvasState:Hs,nextAutoSaveTime:l,isAutoSaving:d}},Yc="quick_slots_config",bC=e=>{const{setGroups:t,renameCatalogItem:o,updateLibraryItem:r,handleRenameTab:a,handleCloseTab:i,handleRenameNode:s,getCurrentCanvasState:l,loadCanvasState:c,tabs:d,activeTabId:u,t:p,characterCatalog:h,scriptCatalog:w,sequenceCatalog:k}=e,[b,y]=v.useState(!1),[g,m]=v.useState({x:0,y:0}),[x,_]=v.useState(!1),[S,P]=v.useState({x:0,y:0}),[j,M]=v.useState(!1),[D,O]=v.useState(null),[B,E]=v.useState(!1),[I,N]=v.useState(null),[T,F]=v.useState(null),[z,G]=v.useState(null),[U,R]=v.useState(!1),[q,H]=v.useState(!1),ne=v.useRef({onSelect:()=>{},onClose:()=>{}}),[X,re]=v.useState(null),[de,ge]=v.useState(null),[te,le]=v.useState(null),[ee,se]=v.useState(null),[ie,oe]=v.useState(!1),[A,K]=v.useState(Array(8).fill(null)),[Z,W]=v.useState(!1);v.useEffect(()=>{const Be=localStorage.getItem(Yc);if(Be)try{const Ie=JSON.parse(Be);Array.isArray(Ie)&&Ie.length===8&&K(Ie)}catch(Ie){console.error("Failed to load quick slots",Ie)}},[]);const Q=v.useCallback((Be,Ie)=>{K(We=>{const at=[...We];return at[Be]=Ie,localStorage.setItem(Yc,JSON.stringify(at)),at})},[]),ce=v.useCallback(Be=>{Array.isArray(Be)&&Be.length===8&&(K(Be),localStorage.setItem(Yc,JSON.stringify(Be)))},[]),fe=v.useCallback(Be=>{le({isOpen:!0,position:Be}),se(null),ge(null)},[]),$=v.useCallback((Be=!1)=>{!Be&&ie||(le(null),oe(!1))},[ie]),V=v.useCallback((Be,Ie)=>{Be.preventDefault(),Be.stopPropagation(),se({isOpen:!0,position:{x:Be.clientX,y:Be.clientY},nodeId:Ie}),le(null),ge(null)},[]),J=v.useCallback(()=>{se(null)},[]),Y=v.useCallback(()=>{oe(Be=>!Be)},[]),ae=v.useCallback(()=>{W(Be=>!Be)},[]),ue=v.useCallback(Be=>{m(Be),y(!0)},[]),he=v.useCallback(Be=>{_(!0),P(Be)},[]),ye=v.useCallback(()=>{y(!1),Z||_(!1),ie||le(null),se(null)},[ie,Z]),ve=v.useCallback((Be,Ie,We)=>{O({position:Be,connectingInfo:Ie,sourceNodeType:We}),M(!0)},[]),me=v.useCallback(()=>{M(!1),O(null)},[]),_e=v.useCallback(()=>E(Be=>!Be),[]),pe=v.useCallback(()=>E(!1),[]),xe=v.useCallback(Be=>{if(!I||!Be||!Be.trim()){N(null);return}const Ie=Be.trim();I.type==="group"?t(We=>We.map(at=>at.id===I.id?{...at,title:Ie}:at)):I.type==="catalog"?o(I.id,Ie):I.type==="library"?r(I.id,{name:Ie}):I.type==="tab"?a(I.id,Ie):I.type==="character"?h.renameItem(I.id,Ie):I.type==="script"?w.renameItem(I.id,Ie):I.type==="sequence"?k.renameItem(I.id,Ie):I.type==="node"&&s(I.id,Ie),N(null)},[I,t,o,r,a,h,w,k,s]),Se=v.useCallback((Be,Ie)=>{T&&r(T.id,{name:Be.trim(),content:Ie}),F(null)},[T,r]),Le=v.useCallback(Be=>{const Ie=()=>{c({nodes:[],connections:[],groups:[],viewTransform:{scale:1,translate:{x:0,y:0}},nodeIdCounter:0,fullSizeImageCache:{}})};Be!=null&&Be.shiftKey?Ie():G({title:p("dialog.confirmClear.title"),message:p("dialog.confirmClear.message"),onConfirm:Ie})},[p,c]),Ee=v.useCallback(Be=>{const Ie=()=>{const We=JSON.parse(JSON.stringify(Fx));c(We)};Be!=null&&Be.shiftKey?Ie():G({title:p("dialog.confirmReset.title"),message:p("dialog.confirmReset.message"),onConfirm:Ie})},[p,c]),Me=v.useCallback(Be=>{ne.current=Be,H(!0)},[]),De=v.useCallback(()=>{ne.current.onSelect(),H(!1)},[]),Te=v.useCallback(()=>{ne.current.onClose(),H(!1)},[]),Re=v.useCallback((Be,Ie)=>{if(d.length<=1)return;const We=d.find(Oe=>Oe.id===Be);if(!We)return;const at=Be===u?l():We.state;at.nodes.length===0&&at.connections.length===0&&(at.groups||[]).length===0||Ie!=null&&Ie.shiftKey?i(Be):G({title:p("dialog.confirmCloseTab.title"),message:p("dialog.confirmCloseTab.message",{tabName:We.name}),onConfirm:()=>i(Be)})},[d,u,i,G,p,l]),we=v.useCallback(Be=>{Be&&navigator.clipboard.writeText(Be).then(()=>{R(!0)})},[]),Ce=v.useCallback((Be,Ie)=>{ge({nodeIds:Be,position:Ie})},[]),qe=v.useCallback(()=>{ge(null)},[]);return{isQuickSearchOpen:b,quickSearchPosition:g,isQuickAddOpen:x,quickAddPosition:S,isCatalogOpen:B,renameInfo:I,promptEditInfo:T,confirmInfo:z,isErrorCopied:U,isApiKeyDialogOpen:q,handleOpenQuickSearch:ue,handleOpenQuickAdd:he,handleCloseAddNodeMenus:ye,handleToggleCatalog:_e,handleCloseCatalog:pe,setRenameInfo:N,setPromptEditInfo:F,setConfirmInfo:G,confirmRename:xe,confirmPromptEdit:Se,setIsErrorCopied:R,handleClearCanvas:Le,handleResetCanvas:Ee,showApiKeyDialog:Me,handleApiKeySelect:De,handleApiKeyDialogClose:Te,handleCloseTab:Re,handleCopyError:we,loadCanvasState:c,imageViewer:X,setImageViewer:re,isConnectionQuickAddOpen:j,connectionQuickAddInfo:D,handleOpenConnectionQuickAdd:ve,handleCloseConnectionQuickAdd:me,contextMenu:te,nodeContextMenu:ee,isContextMenuPinned:ie,toggleContextMenuPin:Y,quickSlots:A,updateQuickSlot:Q,setAllQuickSlots:ce,handleOpenContextMenu:fe,handleCloseContextMenu:$,handleOpenNodeContextMenu:V,handleCloseNodeContextMenu:J,isQuickAddMenuPinned:Z,toggleQuickAddMenuPin:ae,nodeDeleteConfirm:de,requestDeleteNodes:Ce,cancelDeleteNodes:qe}},CC=e=>{const[t,o]=v.useState(e),r=v.useRef(0),a=v.useCallback((l,c)=>{if(l.length===0)return;const d=vr(l);if(!d)return;r.current++;const u={id:`group-${r.current}-${Date.now()}`,title:c||`Group ${r.current}`,...d,nodeIds:l.map(p=>p.id)};o(p=>[...p,u])},[]),i=v.useCallback(l=>{o(c=>c.filter(d=>d.id!==l))},[]),s=v.useCallback((l,c)=>{o(d=>d.map(u=>{if(u.id===l){const p=c.filter(w=>u.nodeIds.includes(w.id)),h=vr(p);if(h)return{...u,...h}}return u}))},[]);return{groups:t,setGroups:o,addGroup:a,removeGroup:i,updateGroupBounds:s}};var yl=(e=>(e.FOLDER="FOLDER",e.GROUP="GROUP",e))(yl||{}),kp=(e=>(e.FOLDER="FOLDER",e.ITEM="ITEM",e))(kp||{});const kC="PromptModifierDB",Da="Catalogs",_C=1,Bx=()=>new Promise((e,t)=>{const o=indexedDB.open(kC,_C);o.onerror=()=>t(o.error),o.onsuccess=()=>e(o.result),o.onupgradeneeded=()=>{o.result.objectStoreNames.contains(Da)||o.result.createObjectStore(Da)}}),Hx=async e=>{const t=await Bx();return new Promise((o,r)=>{const s=t.transaction(Da,"readonly").objectStore(Da).get(e);s.onerror=()=>r(s.error),s.onsuccess=()=>o(s.result)})},vl=async(e,t)=>{const o=await Bx();return new Promise((r,a)=>{const l=o.transaction(Da,"readwrite").objectStore(Da).put(t,e);l.onerror=()=>a(l.error),l.onsuccess=()=>r()})},Zc="group-catalog-items",Xc=[{id:"default-group-image-editing",type:"GROUP",name:"Image Editing",parentId:null,nodes:[{id:"node-28-1761576310796",type:L.IMAGE_EDITOR,position:{x:460,y:0},value:'{"inputImage":null,"prompt":"","outputImage":null,"aspectRatio":"1:1","enableOutpainting":true,"inputImages":[],"outpaintingPrompt":"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.","topPaneHeight":645.6608879498896,"leftPaneRatio":0.4960591133004926}',title:" ",width:1040,height:1380,autoDownload:!0},{id:"node-29-1761576319677",type:L.NOTE,position:{x:0,y:0},value:`      Google

Edit images using modern innovations from Google`,title:"",width:380,height:240}],connections:[]}],Gx=()=>new Date().toISOString().replace(/:/g,"-").replace("T","_").split(".")[0],Qc=(e,t,o,r,a,i=[])=>{const[s,l]=v.useState([]),[c,d]=v.useState(!1);v.useEffect(()=>{(async()=>{try{const I=await Hx(e);if(I&&I.length>0)l(I);else{const N=i.length>0?i:[];l(N),N.length>0&&await vl(e,N)}}catch(I){console.error(`Failed to load catalog from IndexedDB (${e}):`,I),l(i)}finally{d(!0)}})()},[e]);const[u,p]=v.useState([null]),h=v.useRef(null),w=u[u.length-1],k=async E=>{try{await vl(e,E)}catch(I){console.error(`Failed to save catalog to ${e}`,I),alert(`Failed to save catalog: ${I}`)}},b=v.useMemo(()=>c?s.filter(E=>E.parentId===w).sort((E,I)=>E.type===I.type?E.name.localeCompare(I.name):E.type==="FOLDER"?-1:1):[],[s,w,c]),y=v.useMemo(()=>{const E={id:null,name:t};if(!c)return[E];const I=[];let N=w;for(;N;){const T=s.find(F=>F.id===N);if(T)I.unshift({id:T.id,name:T.name}),N=T.parentId;else break}return[E,...I]},[w,s,t,c]),g=v.useCallback(E=>{const I=u.findIndex(N=>N===E);I>-1?p(N=>N.slice(0,I+1)):p(N=>[...N,E])},[u]),m=v.useCallback(()=>{p(E=>E.length>1?E.slice(0,-1):E)},[]),x=v.useCallback(async(E,I,N)=>{if(!c)return;const T={id:`content-item-${Date.now()}-${Math.random()}`,type:E,name:I,parentId:w,content:N};l(F=>{const z=[...F,T];return k(z),z})},[c,w]),_=v.useCallback(async(E,I)=>{c&&l(N=>{const T=N.map(F=>F.id===E?{...F,name:I}:F);return k(T),T})},[c]),S=v.useCallback(async E=>{c&&l(I=>{const N=new Set([E]),T=[E];for(;T.length>0;){const z=T.shift();for(const G of I)G.parentId===z&&(N.add(G.id),G.type==="FOLDER"&&T.push(G.id))}const F=I.filter(z=>!N.has(z.id));return k(F),F})},[c]),P=v.useCallback(E=>{const I=s.find(H=>H.id===E);if(!I)return;let N;if(I.type==="ITEM"){let H;try{H=JSON.parse(I.content||"{}")}catch{H=I.content}N={type:"item",name:I.name,content:H}}else{const H=ne=>{const X=s.find(de=>de.id===ne);if(!X)return null;const re=s.filter(de=>de.parentId===ne);return{name:X.name,type:"folder",children:re.map(de=>{if(de.type==="FOLDER")return H(de.id);{let ge=de.content;try{ge=JSON.parse(ge)}catch{}return{name:de.name,type:"item",content:ge}}})}};N=H(E)}const F=JSON.stringify({appName:"Prompt_modifier",catalogContext:r,root:N},null,2),z=new Blob([F],{type:"application/json"}),G=URL.createObjectURL(z),U=document.createElement("a");U.href=G;const R=Gx(),q=`Catalog_${r}_${I.name.trim().replace(/\s+/g,"_")}_${R}.json`;U.download=q,U.click(),URL.revokeObjectURL(G),U.remove()},[s,r]),j=v.useCallback(async E=>{if(!c)return;const I=[],N=(F,z)=>{const G=`content-item-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;if(!F.name||!F.type)return;const U=F.type==="folder"?"FOLDER":"ITEM",R={id:G,type:U,name:F.name,parentId:z,content:U==="ITEM"?JSON.stringify(F.content):void 0};I.push(R),U==="FOLDER"&&Array.isArray(F.children)&&F.children.forEach(q=>N(q,G))},T=E.root||E;N(T,w),l(F=>{const z=[...F,...I];return k(z),z})},[c,w]),M=v.useCallback(E=>{var T;const I=(T=E.target.files)==null?void 0:T[0];if(!I)return;const N=new FileReader;N.onload=F=>{var z;try{const G=(z=F.target)==null?void 0:z.result,U=JSON.parse(G);if(U.appName!=="Prompt_modifier")throw new Error(o("alert.fileNotSupported")||'File not supported. Missing "appName": "Prompt_modifier".');if(!U.root)throw new Error(o("alert.invalidCatalogStructure")||'Invalid catalog structure. Missing "root".');if(U.catalogContext&&U.catalogContext!==r&&a){a(U);return}if(U.root)j(U);else if(U.type==="folder"&&Array.isArray(U.children))j({root:U});else{const R=I.name.replace(/^Catalog_.*?_/,"").replace(/_\d{4}-\d{2}-\d{2}.*\.json$/,"").replace(/\.json$/,"");x("ITEM",R,G)}}catch(G){alert(`${o("alert.loadCatalogFailed")}: ${G.message}`)}finally{E.target&&(E.target.value="")}},N.readAsText(I)},[x,o,r,a,j]),D=v.useCallback(()=>{var E;return(E=h.current)==null?void 0:E.click()},[]),O=v.useCallback(async(E,I)=>{c&&l(N=>{const T=N.find(z=>z.id===E);if(!T||T.parentId===I)return N;if(T.type==="FOLDER"){let z=I;for(;z;){if(z===E)return N;const G=N.find(U=>U.id===z);z=G?G.parentId:null}}const F=N.map(z=>z.id===E?{...z,parentId:I}:z);return k(F),F})},[c]),B=v.useCallback(async E=>{c&&(l(E),await k(E))},[c]);return{items:s,currentItems:b,path:y,navigateToFolder:g,navigateBack:m,createItem:x,renameItem:_,deleteItem:S,saveItemToDisk:P,fileInputRef:h,handleFileChange:M,triggerLoadFromFile:D,moveItem:O,replaceAllItems:B,importItemsData:j}},SC=(e,t)=>{const[o,r]=v.useState([]),[a,i]=v.useState(!1),s="groups";v.useEffect(()=>{(async()=>{try{const B=await Hx(Zc);B&&B.length>0?r(B):(r(Xc),await vl(Zc,Xc))}catch(B){console.error("Failed to load group catalog from IndexedDB",B),r(Xc)}finally{i(!0)}})()},[]);const[l,c]=v.useState([null]),d=v.useRef(null),u=l[l.length-1],p=async O=>{try{await vl(Zc,O)}catch(B){console.error("Failed to save group catalog to storage",B)}},h=v.useMemo(()=>a?o.filter(O=>O.parentId===u).sort((O,B)=>O.type===B.type?O.name.localeCompare(B.name):O.type==="FOLDER"?-1:1):[],[o,u,a]),w=v.useMemo(()=>{const O={id:null,name:e("catalog.tabs.groups")};if(!a)return[O];const B=[];let E=u;for(;E;){const I=o.find(N=>N.id===E);if(I)B.unshift({id:I.id,name:I.name}),E=I.parentId;else break}return[O,...B]},[u,o,e,a]),k=v.useCallback(O=>{const B=l.findIndex(E=>E===O);B>-1?c(E=>E.slice(0,B+1)):c(E=>[...E,O])},[l]),b=v.useCallback(()=>{c(O=>O.length>1?O.slice(0,-1):O)},[]),y=v.useCallback(async O=>{if(!a||O!=="FOLDER")return;const B={id:`cat-item-${Date.now()}`,type:O,name:e("library.actions.newFolder"),parentId:u};r(E=>{const I=[...E,B];return p(I),I})},[u,e,a]),g=v.useCallback(async(O,B,E,I)=>{if(!a)return;const N=B.filter(ne=>O.nodeIds.includes(ne.id));if(N.length===0)return;const T=new Set(N.map(ne=>ne.id)),F=E.filter(ne=>T.has(ne.fromNodeId)&&T.has(ne.toNodeId)),z=JSON.parse(JSON.stringify(N)),G=JSON.parse(JSON.stringify(F)),U=Math.min(...z.map(ne=>ne.position.x)),R=Math.min(...z.map(ne=>ne.position.y));z.forEach(ne=>{ne.position.x-=U,ne.position.y-=R});const q={};I&&N.forEach(ne=>{I[ne.id]&&(q[ne.id]=I[ne.id])});const H={id:`catalog-item-${Date.now()}`,type:"GROUP",name:O.title,parentId:u,nodes:z,connections:G,fullSizeImages:q};r(ne=>{const X=[...ne,H];return p(X),X})},[u,a]),m=v.useCallback(async(O,B)=>{!a||!B||!B.trim()||r(E=>{const I=E.map(N=>N.id===O?{...N,name:B.trim()}:N);return p(I),I})},[a]),x=v.useCallback(async O=>{a&&r(B=>{const E=new Set([O]),I=B.find(T=>T.id===O);if((I==null?void 0:I.type)==="FOLDER"){const T=[O];for(;T.length>0;){const F=T.shift();for(const z of B)z.parentId===F&&(E.add(z.id),z.type==="FOLDER"&&T.push(z.id))}}const N=B.filter(T=>!E.has(T.id));return p(N),N})},[a]),_=v.useCallback(O=>{const B=o.find(R=>R.id===O);if(!B)return;let E;if(B.type==="GROUP")E={type:"prompModifierGroup",name:B.name,nodes:B.nodes,connections:B.connections,fullSizeImages:B.fullSizeImages};else{const R=q=>{const H=o.find(X=>X.id===q);if(!H)return null;const ne=o.filter(X=>X.parentId===q);return{name:H.name,type:"folder",children:ne.map(X=>X.type==="FOLDER"?R(X.id):{type:"prompModifierGroup",name:X.name,nodes:X.nodes,connections:X.connections,fullSizeImages:X.fullSizeImages})}};E=R(O)}const N=JSON.stringify({appName:"Prompt_modifier",catalogContext:s,root:E},null,2),T=new Blob([N],{type:"application/json"}),F=URL.createObjectURL(T),z=document.createElement("a");z.href=F;const G=Gx(),U=`Catalog_${s}_${B.name.trim().replace(/\s+/g,"_")}_${G}.json`;z.download=U,z.click(),URL.revokeObjectURL(F),z.remove()},[o]),S=v.useCallback(async O=>{if(!a)return;const B=[],E=(N,T)=>{const F=`cat-item-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;if(!N.name||!N.type)return;const G=N.type==="prompModifierGroup"||N.type==="group"||N.type==="GROUP"?"GROUP":"FOLDER",U={id:F,type:G,name:N.name,parentId:T,nodes:G==="GROUP"?N.nodes||[]:void 0,connections:G==="GROUP"?N.connections||[]:void 0,fullSizeImages:G==="GROUP"?N.fullSizeImages:void 0};B.push(U),G==="FOLDER"&&Array.isArray(N.children)&&N.children.forEach(R=>E(R,F))},I=O.root||O;E(I,u),r(N=>{const T=[...N,...B];return p(T),T})},[a,u]),P=v.useCallback(async O=>{var I;const B=(I=O.target.files)==null?void 0:I[0];if(!B||!a)return;const E=new FileReader;E.onload=async N=>{var T;try{const F=(T=N.target)==null?void 0:T.result,z=JSON.parse(F);if(z.appName!=="Prompt_modifier")throw new Error(e("alert.fileNotSupported")||'File not supported. Missing "appName": "Prompt_modifier".');if(!z.root)throw new Error(e("alert.invalidCatalogStructure")||'Invalid catalog structure. Missing "root".');if(z.catalogContext&&z.catalogContext!==s&&t){t(z);return}S(z)}catch(F){alert(`${e("alert.loadCatalogFailed")}: ${F.message}`)}finally{O.target&&(O.target.value="")}},E.readAsText(B)},[e,a,s,t,S]),j=v.useCallback(()=>{var O;(O=d.current)==null||O.click()},[]),M=v.useCallback(async(O,B)=>{a&&r(E=>{const I=E.find(T=>T.id===O);if(!I||I.parentId===B)return E;if(I.type==="FOLDER"){let T=B;for(;T;){if(T===O)return E;const F=E.find(z=>z.id===T);T=F?F.parentId:null}}const N=E.map(T=>T.id===O?{...T,parentId:B}:T);return p(N),N})},[a]),D=v.useCallback(async O=>{a&&(r(O),await p(O))},[a]);return{catalogItems:o,currentCatalogItems:h,catalogPath:w,navigateCatalogBack:b,navigateCatalogToFolder:k,createCatalogItem:y,saveGroupToCatalog:g,renameCatalogItem:m,deleteCatalogItem:x,saveCatalogItemToDisk:_,catalogFileInputRef:d,handleCatalogFileChange:P,triggerLoadFromFile:j,moveCatalogItem:M,replaceAllItems:D,importItemsData:S}},NC=e=>{const[t,o]=v.useState(null),[r,a]=v.useState(!1),[i,s]=v.useState(!1);v.useEffect(()=>{let d;return(async()=>{try{d=await navigator.permissions.query({name:e}),o(d.state),d.state==="prompt"&&!i&&a(!0),d.onchange=()=>{o(d.state),d.state!=="prompt"&&a(!1)}}catch(p){console.warn(`Permission API for '${e}' not supported.`,p),o("granted")}})(),()=>{d&&(d.onchange=null)}},[e,i]);const l=v.useCallback(async()=>{try{await navigator.clipboard.readText()}catch(d){d instanceof DOMException&&d.name==="NotAllowedError"&&o("denied"),console.error("Clipboard read failed:",d)}finally{a(!1)}},[]),c=v.useCallback(()=>{a(!1),s(!0)},[]);return{showDialog:r,requestPermission:l,declinePermission:c}},om="prompt-library-items",rm=[{id:"folder-1",type:Vt.FOLDER,name:"Basic Promts",parentId:null},{id:"prompt-1",type:Vt.PROMPT,name:"Fill background",parentId:"folder-1",content:"Fill the white background with the surroundings"},{id:"prompt-2",type:Vt.PROMPT,name:"Remove all watermarks",parentId:"folder-1",content:"Remove all watermarks, logos, text overlays, and advertisement banners from the image. Restore the original background naturally, blending colors and textures smoothly. Keep all other visual elements unchanged and realistic."},{id:"prompt-3",type:Vt.PROMPT,name:"Character concept",parentId:"folder-1",content:"Create a character concept based on the provided image. The character is standing full-length against a gray background."}],EC=()=>new Date().toISOString().replace(/:/g,"-").replace("T","_").split(".")[0],PC=(e,t)=>{const[o,r]=v.useState(()=>{try{const O=localStorage.getItem(om);return O?JSON.parse(O):rm}catch(O){return console.error("Failed to load prompt library from storage",O),rm}}),a="library",[i,s]=v.useState([null]),l=v.useRef(null),c=i[i.length-1],d=O=>{try{localStorage.setItem(om,JSON.stringify(O))}catch(B){console.error("Failed to save prompt library to storage",B)}},u=v.useMemo(()=>o.filter(O=>O.parentId===c).sort((O,B)=>O.type===B.type?O.name.localeCompare(B.name):O.type===Vt.FOLDER?-1:1),[o,c]),p=v.useMemo(()=>{const O=[{id:null,name:e("catalog.tabs.library")}];return i.slice(1).forEach(B=>{if(!B)return;const E=o.find(I=>I.id===B);E&&O.push({id:E.id,name:E.name})}),O},[i,o,e]),h=v.useCallback(O=>{const B=i.findIndex(E=>E===O);B>-1?s(E=>E.slice(0,B+1)):s(E=>[...E,O])},[i]),w=v.useCallback(()=>{s(O=>O.length>1?O.slice(0,-1):O)},[]),k=v.useCallback(O=>{const B=O===Vt.FOLDER?e("library.actions.newFolder"):e("library.actions.newPrompt"),E={id:`lib-item-${Date.now()}`,type:O,name:B,parentId:c,content:O===Vt.PROMPT?"":void 0};r(I=>{const N=[...I,E];return d(N),N})},[c,e]),b=v.useCallback((O,B)=>{const E={id:`lib-item-${Date.now()}`,type:Vt.PROMPT,name:O,parentId:c,content:B};r(I=>{const N=[...I,E];return d(N),N})},[c]),y=v.useCallback((O,B)=>{O&&r(E=>{let I=E.find(q=>q.type===Vt.FOLDER&&q.parentId===null&&q.name===B),N,T=[...E];if(I)N=I.id;else{N=`lib-item-folder-${Date.now()}`;const q={id:N,type:Vt.FOLDER,name:B,parentId:null};T.push(q)}let z=O.split(/[\s,]+/).filter(Boolean).slice(0,4).join(" ");z.length>30&&(z=z.substring(0,30)+"..."),z||(z="New Prompt");let G=z,U=1;for(;T.some(q=>q.parentId===N&&q.name===G);)G=`${z} (${U++})`;const R={id:`lib-item-prompt-${Date.now()}`,type:Vt.PROMPT,name:G,parentId:N,content:O};return T.push(R),d(T),T})},[]),g=v.useCallback(O=>{y(O,"Processor Prompts")},[y]),m=v.useCallback((O,B)=>{r(E=>{const I=E.map(N=>N.id===O?{...N,...B}:N);return d(I),I})},[]),x=v.useCallback(O=>{r(B=>{new Map(B.map(T=>[T.id,T]));const E=new Set([O]),I=[O];for(;I.length>0;){const T=I.shift();for(const F of B)F.parentId===T&&(E.add(F.id),F.type===Vt.FOLDER&&I.push(F.id))}const N=B.filter(T=>!E.has(T.id));return d(N),N})},[]),_=v.useCallback(O=>{let B,E;const I=EC();if(O.type===Vt.PROMPT){const G=O.content||"";E=`${O.name.trim().replace(/\s+/g,"_")}_${I}.txt`;const U=new Blob([G],{type:"text/plain"}),R=URL.createObjectURL(U),q=document.createElement("a");q.href=R,q.download=E,q.click(),URL.revokeObjectURL(R),q.remove();return}else{const G=U=>{const R=o.find(H=>H.id===U);if(!R)return null;const q=o.filter(H=>H.parentId===U);return{name:R.name,type:"folder",children:q.map(H=>H.type===Vt.FOLDER?G(H.id):{name:H.name,type:"prompt",content:H.content||""})}};B={appName:"Prompt_modifier",catalogContext:a,root:G(O.id)},E=`Catalog_${a}_${O.name.trim().replace(/\s+/g,"_")}_${I}.json`}const N=JSON.stringify(B,null,2),T=new Blob([N],{type:"application/json"}),F=URL.createObjectURL(T),z=document.createElement("a");z.href=F,z.download=E,z.click(),URL.revokeObjectURL(F),z.remove()},[o]),S=v.useCallback(async O=>{const B=[],E=(N,T)=>{const F=`lib-item-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;if(!N.name||!N.type)return;const z=N.type==="folder"?Vt.FOLDER:Vt.PROMPT,G={id:F,type:z,name:N.name,parentId:T,content:z===Vt.PROMPT?N.content||"":void 0};B.push(G),z===Vt.FOLDER&&Array.isArray(N.children)&&N.children.forEach(U=>E(U,F))},I=O.root||O;E(I,c),r(N=>{const T=[...N,...B];return d(T),T})},[c]),P=v.useCallback(O=>{var I;const B=(I=O.target.files)==null?void 0:I[0];if(!B)return;const E=new FileReader;E.onload=N=>{var F;const T=(F=N.target)==null?void 0:F.result;try{if(!T)throw new Error("Empty file");if(B.name.endsWith(".txt")){const G=B.name.replace(".txt","");b(G,T);return}const z=JSON.parse(T);if(z.appName!=="Prompt_modifier")throw new Error(e("alert.fileNotSupported")||'File not supported. Missing "appName": "Prompt_modifier".');if(!z.root)throw new Error(e("alert.invalidCatalogStructure")||'Invalid catalog structure. Missing "root".');if(z.catalogContext&&z.catalogContext!==a&&t){t(z);return}S(z)}catch(z){alert(`${e("alert.loadCatalogFailed")}: ${z.message}`)}finally{O.target&&(O.target.value="")}},E.onerror=()=>{alert("Error reading the selected file.")},E.readAsText(B)},[S,t,a,e,b]),j=v.useCallback(()=>{var O;(O=l.current)==null||O.click()},[]),M=v.useCallback((O,B)=>{r(E=>{const I=E.find(T=>T.id===O);if(!I||I.parentId===B)return E;if(I.type===Vt.FOLDER){let T=B;for(;T;){if(T===O)return E;const F=E.find(z=>z.id===T);T=F?F.parentId:null}}const N=E.map(T=>T.id===O?{...T,parentId:B}:T);return d(N),N})},[]),D=v.useCallback(O=>{r(O),d(O)},[]);return{libraryItems:o,currentLibraryItems:u,libraryPath:p,navigateBack:w,navigateToFolder:h,createLibraryItem:k,updateLibraryItem:m,deleteLibraryItem:x,saveLibraryItemToDisk:_,libraryFileInputRef:l,handleLibraryFileChange:P,triggerLoadLibraryFromFile:j,moveLibraryItem:M,addPromptToLibrary:b,saveProcessorPrompt:g,saveToLibrary:y,replaceAllItems:D,importItemsData:S}},au=410,iu=110,jC=e=>{const{nodes:t,setNodes:o,connections:r,setConnections:a,nodeIdCounter:i,t:s,groups:l,setGroups:c,clearImagesForNodeFromCache:d,tabId:u,addToast:p,getFullSizeImage:h,setFullSizeImage:w,takeSnapshot:k}=e,b=v.useCallback((O,B,E,I={centerNode:!0})=>{i.current++;const N=`node-${i.current}-${Date.now()}`,T={[L.TEXT_INPUT]:s("node.title.text_input"),[L.IMAGE_INPUT]:s("node.title.image_input"),[L.PROMPT_PROCESSOR]:s("node.title.prompt_processor"),[L.VIDEO_PROMPT_PROCESSOR]:s("node.title.video_prompt_processor"),[L.IMAGE_OUTPUT]:s("node.title.image_output"),[L.VIDEO_OUTPUT]:s("node.title.video_output"),[L.PROMPT_ANALYZER]:s("node.title.prompt_analyzer"),[L.CHARACTER_ANALYZER]:s("node.title.character_analyzer"),[L.CHARACTER_GENERATOR]:s("node.title.character_generator"),[L.CHARACTER_CARD]:s("node.title.character_card"),[L.IMAGE_ANALYZER]:s("node.title.image_analyzer"),[L.IMAGE_EDITOR]:s("node.title.image_editor"),[L.IMAGE_SEQUENCE_GENERATOR]:s("node.title.image_sequence_generator"),[L.PROMPT_SEQUENCE_EDITOR]:s("node.title.prompt_sequence_editor"),[L.GEMINI_CHAT]:s("node.title.gemini_chat"),[L.TRANSLATOR]:s("node.title.translator"),[L.SCRIPT_GENERATOR]:s("node.title.script_generator"),[L.SCRIPT_VIEWER]:s("node.title.script_viewer"),[L.NOTE]:s("node.title.note"),[L.REROUTE_DOT]:s("node.title.reroute_dot"),[L.PROMPT_SANITIZER]:s("node.title.prompt_sanitizer"),[L.DATA_READER]:s("node.title.data_reader"),[L.VIDEO_EDITOR]:s("node.title.video_editor"),[L.MEDIA_VIEWER]:s("node.title.media_viewer"),[L.DATA_PROTECTION]:s("node.title.data_protection"),[L.POSE_CREATOR]:s("node.title.pose_creator")},F={id:N,type:O,position:B,title:E||T[O]||"New Node",value:"",width:400,height:300,isNewlyCreated:!0};switch(F.value=I.initialValue!==void 0?I.initialValue:Hi(F),O){case L.IMAGE_EDITOR:F.width=1e3,F.height=920;break;case L.PROMPT_ANALYZER:F.width=460,F.height=1e3;break;case L.IMAGE_INPUT:F.width=460,F.height=340;break;case L.IMAGE_ANALYZER:case L.VIDEO_OUTPUT:F.width=460,F.height=680;break;case L.PROMPT_PROCESSOR:F.width=460,F.height=410;break;case L.VIDEO_PROMPT_PROCESSOR:F.width=460,F.height=410;break;case L.IMAGE_OUTPUT:F.width=460,F.height=700,F.model="gemini-2.5-flash-image",F.autoDownload=!0;break;case L.GEMINI_CHAT:case L.TRANSLATOR:F.width=400,F.height=640;break;case L.NOTE:F.width=460,F.height=660;break;case L.CHARACTER_ANALYZER:F.width=460,F.height=500;break;case L.CHARACTER_CARD:F.width=520,F.height=960,F.collapsedHandles=!0;break;case L.SCRIPT_GENERATOR:F.width=500,F.height=1e3;break;case L.SCRIPT_VIEWER:F.width=500,F.height=600;break;case L.IMAGE_SEQUENCE_GENERATOR:F.width=1400,F.height=920,F.aspectRatio="16:9";break;case L.PROMPT_SEQUENCE_EDITOR:F.width=1300,F.height=920;break;case L.REROUTE_DOT:F.width=60,F.height=40;break;case L.PROMPT_SANITIZER:F.width=460,F.height=280;break;case L.DATA_READER:F.width=400,F.height=500;break;case L.CHARACTER_GENERATOR:F.width=520,F.height=960;break;case L.TEXT_INPUT:F.width=460,F.height=300;break;case L.MEDIA_VIEWER:F.width=500,F.height=340;break;case L.DATA_PROTECTION:F.width=800,F.height=600;break;case L.VIDEO_EDITOR:F.width=920,F.height=640;break;case L.POSE_CREATOR:F.width=600,F.height=800;break;default:F.width=460,F.height=280}return I.alignToInput?F.position={x:B.x,y:B.y-F.height/2}:I.centerNode?F.position={x:B.x-F.width/2,y:B.y-40/2}:F.position=B,o(z=>[...z,F]),N},[i,o,s]),y=v.useCallback(O=>{const B=t.find(E=>E.id===O);if(B&&B.type===L.REROUTE_DOT){const E=r.find(N=>N.toNodeId===O),I=r.filter(N=>N.fromNodeId===O);if(E&&I.length>0){const N=I.map(T=>({fromNodeId:E.fromNodeId,fromHandleId:E.fromHandleId,toNodeId:T.toNodeId,toHandleId:T.toHandleId,id:`conn-${Date.now()}-${Math.random()}`}));a(T=>[...T.filter(F=>F.toNodeId!==O&&F.fromNodeId!==O),...N])}}o(E=>E.filter(I=>I.id!==O)),a(E=>E.filter(I=>I.fromNodeId!==O&&I.toNodeId!==O)),c(E=>E.map(I=>({...I,nodeIds:I.nodeIds.filter(N=>N!==O)})).filter(I=>I.nodeIds.length>0)),d(O)},[t,r,o,a,c,d,u]),g=v.useCallback((O,B,E)=>{o(I=>I.map(N=>{if(N.id===O){const T=E||N.position,F=N.dockState?N.dockState.original:{x:N.position.x,y:N.position.y,width:N.width,height:N.height},z=Ri(N.type),G=56,U=window.innerWidth,R=window.innerHeight;let q=N.width,H=N.height;const ne=G*2,X=(U-ne)/4;return B==="left"||B==="right"?(q=U/2-G*1.5,H=R-ne):B==="full"?(q=U-ne,H=R-ne):["q1","q2","q3","q4"].includes(B)?(q=X,H=R-ne):(q=U/2-G*1.5,H=R/2-G*1.5),q=Math.max(q,z.minWidth),H=Math.max(H,z.minHeight),{...N,isCollapsed:!1,position:T,width:q,height:H,dockState:{mode:B,original:F}}}return N}))},[o]),m=v.useCallback(O=>{o(B=>{const E=B.find(T=>T.id===O);if(!E||!E.dockState)return B;const{original:I}=E.dockState,N=Ri(E.type);return B.map(T=>T.id===O?{...T,dockState:void 0,position:{x:T.position.x,y:T.position.y},width:Math.max(N.minWidth,I.width),height:Math.max(N.minHeight,I.height)}:T)}),setTimeout(()=>{o(B=>B.map(E=>E.id===O?{...E,width:E.width+1,height:E.height+1}:E)),setTimeout(()=>{o(B=>B.map(E=>E.id===O?{...E,width:E.width-1,height:E.height-1}:E))},50)},50)},[o]),x=v.useCallback(O=>{const B=t.find(I=>I.id===O);if(!B)return"";const E=(I,N)=>{const T=I.filter(z=>z.toNodeId===O),F=[];for(const z of T){const G=N.find(R=>R.id===z.fromNodeId);if(!G)continue;let U="";try{const R=JSON.parse(G.value||"{}");if(G.type===L.PROMPT_ANALYZER&&z.fromHandleId)if(z.fromHandleId.startsWith("character-")){const q=parseInt(z.fromHandleId.split("-")[1],10);R.characters&&Array.isArray(R.characters)&&(U=R.characters[q]||"")}else U=R[z.fromHandleId]||"";else G.type===L.IMAGE_INPUT&&z.fromHandleId==="text"?U=R.prompt||"":G.type===L.IMAGE_ANALYZER?U=R.description||"":U=G.value}catch{U=G.value}F.push(U)}return F.filter(z=>z&&z.trim()!=="")};if(B.type===L.IMAGE_EDITOR)try{return JSON.parse(B.value).prompt||""}catch{return""}return B.type===L.IMAGE_OUTPUT||B.type===L.VIDEO_OUTPUT?E(r,t).join(", "):""},[t,r]),_=v.useCallback(async O=>{const B=l.find(z=>z.id===O);if(!B)return;const E=t.filter(z=>B.nodeIds.includes(z.id)),I=new Set(E.map(z=>z.id)),N=r.filter(z=>I.has(z.fromNodeId)&&I.has(z.toNodeId)),T={};E.forEach(z=>{for(let G=0;G<20;G++){const U=h(z.id,G);U&&(T[z.id]||(T[z.id]={}),T[z.id][G]=U)}});const F={type:"prompModifierGroup",name:B.title,nodes:E,connections:N,fullSizeImages:T};try{await navigator.clipboard.writeText(JSON.stringify(F,null,2)),p(s("toast.copiedToClipboard"))}catch(z){console.error("Failed to copy group to clipboard",z),p(s("toast.copyFailed")+" (Check console)","error")}},[l,t,r,s,p,h]),S=v.useCallback(O=>{const B=l.find(H=>H.id===O);if(!B)return;const E=t.filter(H=>B.nodeIds.includes(H.id)),I=new Set(E.map(H=>H.id)),N=r.filter(H=>I.has(H.fromNodeId)&&I.has(H.toNodeId)),T=new Map,F=Date.now(),z={x:50,y:50},G=E.map((H,ne)=>{i.current++;const X=`node-${i.current}-${F}-${ne}`;T.set(H.id,X);for(let re=0;re<20;re++){const de=h(H.id,re);de&&w(X,re,de)}return{...H,id:X,position:{x:H.position.x+z.x,y:H.position.y+z.y},isNewlyCreated:!0}}),U=`group-${F}-${Math.random().toString(36).substr(2,5)}`,R={...B,id:U,position:{x:B.position.x+z.x,y:B.position.y+z.y},nodeIds:G.map(H=>H.id),title:`${B.title}`},q=N.map((H,ne)=>({...H,id:`conn-${F}-${ne}`,fromNodeId:T.get(H.fromNodeId),toNodeId:T.get(H.toNodeId)}));o(H=>[...H,...G]),c(H=>[...H,R]),a(H=>[...H,...q]),p(s("toast.nodeDuplicated"))},[l,t,r,i,o,c,a,s,p,h,w]),P=v.useCallback((O,B)=>{const E=O.nodes||[],I=O.connections||[],N=O.fullSizeImages||{},T=O.name||(O.group?O.group.title:"Imported Group");if(E.length===0)return;const F=new Map,z=Date.now();let G=1/0,U=1/0,R=-1/0,q=-1/0;E.forEach(A=>{G=Math.min(G,A.position.x),U=Math.min(U,A.position.y),R=Math.max(R,A.position.x+A.width),q=Math.max(q,A.position.y+A.height)});let H=50,ne=50;B?(H=B.x-G,ne=B.y-U):(H=50-G,ne=50-U);const X=E.map((A,K)=>{i.current++;const Z=`node-${i.current}-${z}-${K}`;return F.set(A.id,Z),N&&N[A.id]&&Object.entries(N[A.id]).forEach(([W,Q])=>{w(Z,Number(W),Q)}),{...A,id:Z,position:{x:A.position.x+H,y:A.position.y+ne},isNewlyCreated:!0}}),re=`group-${z}-${Math.random().toString(36).substr(2,5)}`,de=30,ge=70,te=R-G+de*2,le=q-U+ge+de,ee=G+H-de,se=U+ne-ge,ie={id:re,title:T,position:{x:ee,y:se},width:te,height:le,nodeIds:X.map(A=>A.id)},oe=I.map((A,K)=>({...A,id:`conn-${z}-${K}`,fromNodeId:F.get(A.fromNodeId),toNodeId:F.get(A.toNodeId)}));o(A=>[...A,...X]),c(A=>[...A,ie]),a(A=>[...A,...oe]),p(s("toast.pastedFromClipboard"))},[i,o,c,a,w,s,p]),j=v.useCallback((O,B)=>{O.length<2||(B==="distribute-horizontal"||B==="distribute-vertical")&&O.length<3||(k&&k(t),o(E=>{const I=E.filter(R=>O.includes(R.id));if(I.length<2)return E;let N=1/0,T=-1/0,F=1/0,z=-1/0;I.forEach(R=>{N=Math.min(N,R.position.x),T=Math.max(T,R.position.x+R.width),F=Math.min(F,R.position.y),z=Math.max(z,R.position.y+R.height)});const G=(N+T)/2,U=(F+z)/2;if(B==="distribute-horizontal"){I.sort((ee,se)=>ee.position.x-se.position.x);const R=I[0],q=I[I.length-1],H=R.position.x,X=q.position.x+q.width-H,re=I.reduce((ee,se)=>ee+se.width,0),ge=(X-re)/(I.length-1);let te=H;const le=new Map;le.set(R.id,te),te+=R.width+ge;for(let ee=1;ee<I.length-1;ee++){const se=I[ee];le.set(se.id,te),te+=se.width+ge}return le.set(q.id,q.position.x),E.map(ee=>le.has(ee.id)?{...ee,position:{x:le.get(ee.id)|0,y:ee.position.y}}:ee)}if(B==="distribute-vertical"){I.sort((ee,se)=>ee.position.y-se.position.y);const R=I[0],q=I[I.length-1],H=R.position.y,X=q.position.y+q.height-H,re=I.reduce((ee,se)=>ee+se.height,0),ge=(X-re)/(I.length-1);let te=H;const le=new Map;le.set(R.id,te),te+=R.height+ge;for(let ee=1;ee<I.length-1;ee++){const se=I[ee];le.set(se.id,te),te+=se.width+ge}return le.set(q.id,q.position.y),E.map(ee=>le.has(ee.id)?{...ee,position:{x:ee.position.x,y:le.get(ee.id)|0}}:ee)}return E.map(R=>{if(!O.includes(R.id))return R;let q=R.position.x,H=R.position.y;switch(B){case"left":q=N;break;case"center-x":q=G-R.width/2;break;case"right":q=T-R.width;break;case"top":H=F;break;case"center-y":H=U-R.height/2;break;case"bottom":H=z-R.height;break}return{...R,position:{x:q|0,y:H|0}}})}))},[o,k,t]),M=()=>new Date().toISOString().replace(/:/g,"-").replace("T","_").split(".")[0],D=v.useCallback((O,B)=>{const E=t.find(T=>T.id===O);if(!E)return;let I,N="";try{const T=JSON.parse(E.value||"{}");if(E.type===L.IMAGE_OUTPUT||E.type===L.VIDEO_OUTPUT)I=h(O,0)||E.value,N=x(O);else if(E.type===L.IMAGE_INPUT)I=h(O,0)||T.image,N=T.prompt||"";else if(E.type===L.IMAGE_EDITOR)I=h(O,0)||T.outputImage,N=T.prompt||"";else if(E.type===L.GEMINI_CHAT){const F={type:"gemini-chat-history",messages:T.messages||[],currentInput:T.currentInput||"",style:T.style||"general",attachment:T.attachment||null},z=new Blob([JSON.stringify(F,null,2)],{type:"application/json"}),G=URL.createObjectURL(z),U=document.createElement("a");U.href=G;const R=M();U.download=`Gemini_Chat_History_${R}.json`,document.body.appendChild(U),U.click(),document.body.removeChild(U),URL.revokeObjectURL(G),p(s("toast.scriptSaved"));return}}catch{}I&&B(I,0,N)},[t,h,x,p,s]);return{onAddNode:b,deleteNodeAndConnections:y,getPromptForNode:x,copyGroup:_,duplicateGroup:S,pasteGroup:P,handleAlignNodes:j,handleDockNode:g,handleUndockNode:m,handleDownloadImage:D}},ed=(e,t)=>{if(!e)return"";const o={appearance:"Appearance",:"Appearance",apariencia:"Appearance",personality:"Personality",:"Personality",:"Personality",personalidad:"Personality",clothing:"Clothing",:"Clothing",ropa:"Clothing"},r=/####\s*([^\n]+)\s*([\s\S]*?)(?=####|$)/gi;let a;for(;(a=r.exec(e))!==null;){const i=a[1].trim().toLowerCase(),s=a[2].trim();if(o[i]===t)return s}return""},am=e=>{if(!e)return"0";let t=0;const o=e.length,r=o>1e3?e.substring(0,500)+e.substring(o-500):e;for(let a=0;a<r.length;a++){const i=r.charCodeAt(a);t=(t<<5)-t+i,t=t&t}return`${o}-${t}`},TC=e=>{if(!e)return"empty";const t=e.match(/"(index|alias|name|selectedRatio|prompt|isActive|isOutput)"\s*:\s*("[^"]*"|true|false|null)/g);let o=0;for(let r=0;r<Math.min(e.length,200);r++)o=(o<<5)-o+e.charCodeAt(r);return(t?t.join(","):"no-match")+`-${o}`},IC=e=>{const{connections:t,nodes:o,getFullSizeImage:r}=e,a=v.useRef({signature:"",data:new Map}),i=v.useRef({signature:"",data:new Map}),s=v.useMemo(()=>{const h=new Map;return t.forEach(w=>{h.has(w.toNodeId)||h.set(w.toNodeId,new Set),h.get(w.toNodeId).add(w.toHandleId)}),h},[t]),l=v.useMemo(()=>{const h=new Map;return t.forEach(w=>{const k=o.find(b=>b.id===w.toNodeId);if(k&&(k.type===L.DATA_READER||k.type===L.REROUTE_DOT)){const b=o.find(y=>y.id===w.fromNodeId);if(b){const y=Yn(b,w.fromHandleId);y&&h.set(w.toNodeId,y)}}}),h},[t,o]),c=v.useCallback((h,w,k,b)=>{var m;if(k.has(h))return null;k.add(h);const y=o.find(x=>x.id===h);if(!y||Yn(y,w)!=="image"&&y.type!==L.REROUTE_DOT)return null;if(y.type===L.IMAGE_ANALYZER||y.type===L.REROUTE_DOT){const x=t.find(_=>_.toNodeId===h);if(x)return c(x.fromNodeId,x.fromHandleId,k,b)}try{const x=JSON.parse(y.value||"{}");switch(y.type){case L.IMAGE_INPUT:return b&&x.image?x.image:r(y.id,0)||x.image||null;case L.POSE_CREATOR:return x.renderedImage||null;case L.IMAGE_ANALYZER:case L.CHARACTER_CARD:if(y.type===L.CHARACTER_CARD&&w!=="image")break;const _=Array.isArray(x)?x:[x],S=_.find(O=>O.isOutput)||_[0];if(S&&S.isActive===!1)return null;const P=_.indexOf(S),j=S.selectedRatio||"1:1",M=$t[j]||1,D=r(y.id,P*10+M);return D&&!b?D:((m=S==null?void 0:S.thumbnails)==null?void 0:m[j])||(S==null?void 0:S.image)||null;case L.IMAGE_OUTPUT:return r(y.id,0)||(y.value.startsWith("data:")?y.value:null);case L.IMAGE_EDITOR:return b?x.outputImage:r(y.id,0)||x.outputImage||null}}catch{if(y.type===L.IMAGE_INPUT&&y.value.startsWith("data:image"))return y.value}return null},[o,t,r]),d=v.useMemo(()=>{const h=t.filter(y=>{const g=o.find(m=>m.id===y.toNodeId);return g?g.type===L.IMAGE_EDITOR&&y.toHandleId==="image"||g.type===L.IMAGE_ANALYZER:!1}),k=h.map(y=>{const g=o.find(m=>m.id===y.fromNodeId);return`${y.id}:${g==null?void 0:g.id}:${am((g==null?void 0:g.value)||"")}`}).join("|");if(k===i.current.signature)return i.current.data;const b=new Map;return h.forEach(y=>{b.has(y.toNodeId)||b.set(y.toNodeId,[]),b.get(y.toNodeId).push(c(y.fromNodeId,y.fromHandleId,new Set,!1))}),i.current={signature:k,data:b},b},[t,o,c]),u=v.useMemo(()=>{const h=o.filter(m=>m.type===L.IMAGE_SEQUENCE_GENERATOR),b=t.filter(m=>h.some(x=>x.id===m.toNodeId)&&m.toHandleId==="character_data").map(m=>{const x=o.find(_=>_.id===m.fromNodeId);return x?x.type===L.CHARACTER_CARD||x.type===L.CHARACTER_GENERATOR?`${m.id}:${x.id}:${TC(x.value||"")}`:`${m.id}:${x.id}:${am(x.value||"")}`:""}).join("|");if(b===a.current.signature)return a.current.data;const y=(m,x,_=new Set)=>{if(_.has(m))return[];_.add(m);const S=t.filter(j=>j.toNodeId===m&&(x===void 0||j.toHandleId===x)),P=[];for(const j of S){const M=o.find(D=>D.id===j.fromNodeId);M&&(M.type===L.REROUTE_DOT?P.push(...y(M.id,void 0,_)):Yn(M,j.fromHandleId)==="character_data"&&P.push({node:M,handleId:j.fromHandleId,connectionId:j.id}))}return P},g=new Map;return h.forEach(m=>{const x=y(m.id,"character_data");if(x.length>0){const _=[],S=new Set;x.forEach(P=>{var D,O;const j=P.node,M=`${j.id}:${P.handleId||"default"}`;if(!S.has(M)){S.add(M);try{const B=JSON.parse(j.value);if(j.type===L.CHARACTER_GENERATOR){const E=(D=P.handleId)==null?void 0:D.match(/character-(\d+)/),I=E?parseInt(E[1],10):-1;if(I>=0&&((O=B.characters)!=null&&O[I])){const N=B.characters[I];_.push({name:N.name,alias:N.index||N.alias,prompt:N.prompt,fullDescription:N.fullDescription,image:N.imageBase64?`data:image/png;base64,${N.imageBase64}`:null,_sourceNodeId:j.id,_connectionId:P.connectionId})}}else if(j.type===L.CHARACTER_CARD){const E=Array.isArray(B)?B:[B],I=P.handleId;let N=[];if(I==="all_data")N=E.map((T,F)=>({data:T,originalIndex:F})).filter(T=>T.data.isActive!==!1);else if(I==="primary_data"){const T=E.find(F=>F.isOutput)||E[0];if(T&&T.isActive!==!1){const F=E.indexOf(T);N=[{data:T,originalIndex:F}]}}else if(I&&I.startsWith("char_")){const T=parseInt(I.split("_")[1]);E[T]&&E[T].isActive!==!1&&(N=[{data:E[T],originalIndex:T}])}else N=E.map((T,F)=>({data:T,originalIndex:F})).filter(T=>T.data.isActive!==!1);N.forEach(({data:T,originalIndex:F})=>{if(!T)return;const z=T.thumbnails?{...T.thumbnails}:T.imageSources||{};Object.entries($t).forEach(([R,q])=>{const H=r(j.id,F*10+q);H&&(z[R]=H)});const G=T.selectedRatio||"1:1",U=z[G]||T.image||r(j.id,F*10);_.push({...T,alias:T.index||T.alias,image:U,imageSources:z,nodeTitle:j.title,_sourceNodeId:j.id,_connectionId:P.connectionId,_fullResImage:r(j.id,F*10)})})}}catch{}}}),_.length>0&&g.set(m.id,_)}}),a.current={signature:b,data:g},g},[t,o,r]),p=v.useCallback((h,w,k,b=!1)=>{var x,_,S;const y=k||o,g=t.filter(P=>P.toNodeId===h&&(w===void 0||P.toHandleId===w)),m=[];for(const P of g){const j=y.find(D=>D.id===P.fromNodeId);if(!j)continue;if(j.type===L.REROUTE_DOT){m.push(...p(j.id,void 0,y,b));continue}const M=Yn(j,P.fromHandleId);if(M==="character_data")try{const D=JSON.parse(j.value||"{}");if(j.type===L.CHARACTER_GENERATOR&&((x=P.fromHandleId)!=null&&x.startsWith("character-"))){const O=parseInt(P.fromHandleId.split("-")[1]);D.characters&&D.characters[O]&&m.push(D.characters[O])}else if(j.type===L.CHARACTER_CARD){const O=Array.isArray(D)?D:[D];P.fromHandleId==="all_data"?m.push(O.filter(B=>B.isActive!==!1)):m.push(D)}else m.push(D)}catch{m.push(j.value)}else if(M==="text")try{const D=JSON.parse(j.value||"{}");if(j.type===L.PROMPT_ANALYZER&&P.fromHandleId)if(P.fromHandleId.startsWith("character-")){const O=parseInt(P.fromHandleId.split("-")[1],10);m.push(((_=D.characters)==null?void 0:_[O])||"")}else m.push(D[P.fromHandleId]||"");else if(j.type===L.IMAGE_INPUT&&P.fromHandleId==="text")m.push(D.prompt||"");else if(j.type===L.IMAGE_ANALYZER&&P.fromHandleId==="text")m.push(D.description||"");else if(j.type===L.CHARACTER_CARD){const O=Array.isArray(D)?D:[D],B=O.find(E=>E.isOutput)||O[0];if(!(B&&B.isActive===!1)){const E=(B==null?void 0:B.fullDescription)||"";P.fromHandleId==="prompt"?m.push((B==null?void 0:B.prompt)||""):P.fromHandleId==="appearance"?m.push(ed(E,"Appearance")):P.fromHandleId==="personality"?m.push(ed(E,"Personality")):P.fromHandleId==="clothing"?m.push(ed(E,"Clothing")):m.push(j.value)}}else m.push(j.value)}catch{m.push(j.value)}else if(M==="image"){if(j.type===L.IMAGE_SEQUENCE_GENERATOR)try{const O=JSON.parse(j.value),B=O.checkedFrameNumbers||[],E=O.images||{};if(B.forEach(I=>{var T;const N=r(j.id,1e3+I)||E[I];if(N&&N.startsWith("data:")){const F=N.split(","),z=((T=N.match(/:(.*?);/))==null?void 0:T[1])||"image/png";m.push({base64ImageData:F[1],mimeType:z})}}),B.length>0)continue}catch{}const D=c(P.fromNodeId,P.fromHandleId,new Set,b);if(D&&D.startsWith("data:")){const O=D.split(","),B=((S=D.match(/:(.*?);/))==null?void 0:S[1])||"image/png";m.push({base64ImageData:O[1],mimeType:B})}}else if(j.type===L.MEDIA_VIEWER)try{const D=JSON.parse(j.value||"{}");D.src&&m.push(D.src)}catch{m.push(j.value)}else m.push(j.value)}return m},[o,t,c,r]);return{connectedInputs:s,connectedImageSources:d,connectedCharacterData:u,connectedInputTypes:l,getConnectionPoints:qx,getUpstreamNodeValues:p}},AC=e=>{const{onAddNode:t,handleValueChange:o,handleRenameNode:r,setFullSizeImage:a,getTransformedPoint:i,handleLoadCanvasIntoCurrentTab:s,setError:l,pasteGroup:c,t:d,handleAddGroupFromCatalog:u,libraryItems:p,setNodes:h,setConfirmInfo:w,handleRenameTab:k,activeTabId:b}=e,y=v.useRef(0),g=P=>{const j=document.getElementById("app-container");j&&(P?j.classList.add("ring-2","ring-cyan-500","ring-inset"):j.classList.remove("ring-2","ring-cyan-500","ring-inset"))};v.useEffect(()=>{const P=j=>{j.type==="dragleave"&&j.relatedTarget||(y.current=0,g(!1))};return window.addEventListener("dragend",P),window.addEventListener("dragleave",P),()=>{window.removeEventListener("dragend",P),window.removeEventListener("dragleave",P)}},[]);const m=v.useCallback(P=>{if(P.dataTransfer.types.includes("application/prompt-modifier-card"))return;const j=P.target;(j.id==="app-container"||j.id==="canvas-transform-layer")&&(P.preventDefault(),P.stopPropagation(),y.current+=1,y.current===1&&g(!0))},[]),x=v.useCallback(P=>{if(P.dataTransfer.types.includes("application/prompt-modifier-card"))return;const j=P.target;(j.id==="app-container"||j.id==="canvas-transform-layer")&&(P.preventDefault(),P.stopPropagation(),y.current-=1,y.current<=0&&(y.current=0,g(!1)))},[]),_=v.useCallback(P=>{P.target.closest(".node-view")||(P.preventDefault(),P.stopPropagation(),P.dataTransfer.dropEffect="copy")},[]);return{handleDrop:v.useCallback(P=>{if(P.dataTransfer.types.includes("application/prompt-modifier-card"))return;P.preventDefault(),P.stopPropagation(),y.current=0,g(!1);const j=i({x:P.clientX,y:P.clientY}),M=P.dataTransfer.getData("application/prompt-modifier-drag-image");if(M){const B=t(L.IMAGE_INPUT,j);a(B,0,M),xl(M).then(E=>{Rt(M,256,256).then(I=>{o(B,JSON.stringify({image:I,prompt:E||""}))})});return}const D=P.dataTransfer.getData("application/prompt-modifier-drag-item");if(D){try{const B=JSON.parse(D);if(B.type==="catalog-group"){u&&u(B.itemId,j);return}if(B.type==="library-prompt"){const E=p.find(I=>I.id===B.itemId);E&&t(L.TEXT_INPUT,j,void 0,{centerNode:!0,initialValue:E.content||""});return}if(B.type==="content-catalog-item"){const E=B.itemType;let I=null,N="";switch(E){case"CHARACTER":I=L.CHARACTER_CARD;let T;try{T=JSON.parse(B.content||"{}")}catch{T={}}if(Array.isArray(T))N=JSON.stringify(T);else{T.image&&typeof T.image=="string"&&!T.image.startsWith("data:")&&(T.image=`data:image/png;base64,${T.image}`);const de=T.index||T.alias||"Entity-1",ge={...T,index:de};ge.alias&&delete ge.alias,N=JSON.stringify([ge])}break;case"SCRIPT":I=L.SCRIPT_VIEWER,N=B.content||"{}";break;case"PROMPT_SEQUENCE":I=L.PROMPT_SEQUENCE_EDITOR;const F={id:"",type:L.PROMPT_SEQUENCE_EDITOR,position:{x:0,y:0},title:"",value:"",width:0,height:0},z=Hi(F),G=JSON.parse(z),U=JSON.parse(B.content||"{}");let R=[],q=[],H="",ne=[];U.type==="script-prompt-modifier-data"?(R=U.finalPrompts||U.prompts||[],q=U.videoPrompts||[],H=U.styleOverride||"",ne=U.usedCharacters||[]):Array.isArray(U)?R=U:U.prompts&&(R=U.prompts);const X=new Map(q.map(de=>[de.frameNumber,de])),re=R.map((de,ge)=>{const te=de.frameNumber!==void 0?de.frameNumber:ge+1,le=X.get(te);let ee=de.characters||[];const se=de.prompt||(typeof de=="string"?de:"");if(ee.length===0&&se){const ie=se.match(/(?:character|entity)-\d+/gi)||[];ee=[...new Set(ie.map(oe=>oe.toLowerCase().replace(/character-/i,"Entity-").replace(/entity-/i,"Entity-")))]}return{frameNumber:te,sceneNumber:de.sceneNumber||1,sceneTitle:de.sceneTitle||"",prompt:se,videoPrompt:(le==null?void 0:le.videoPrompt)||de.videoPrompt||"",shotType:de.shotType||de.ShotType||(le==null?void 0:le.shotType)||"WS",characters:ee,isCollapsed:!0,duration:de.duration||3}});N=JSON.stringify({...G,sourcePrompts:re,styleOverride:H,usedCharacters:ne});break}if(I){const T=t(I,j,void 0,{centerNode:!0,initialValue:N});if(E==="CHARACTER")try{let F=JSON.parse(B.content||"{}");const z=Array.isArray(F)?F[0]:F;if(z!=null&&z.nodeTitle&&r(T,z.nodeTitle),Array.isArray(F)&&h){const U=F.length*au+iu;h(R=>R.map(q=>q.id===T?{...q,width:U}:q))}(Array.isArray(F)?F:[F]).forEach((U,R)=>{if(U.imageSources){Object.entries(U.imageSources).forEach(([ne,X])=>{const re=$t[ne];re&&typeof X=="string"&&X.startsWith("data:")&&a(T,R*10+re,X)});const q=U.selectedRatio||"1:1",H=U.imageSources[q];H&&typeof H=="string"&&H.startsWith("data:")&&a(T,R*10,H)}})}catch(F){console.error("Failed to restore character images",F)}}}}catch(B){console.error("Error parsing drag data",B)}return}const O=Array.from(P.dataTransfer.files);if(O.length>0){let B=0,E=0;O.forEach(I=>{const N={x:j.x+B,y:j.y+E};if(I.type.startsWith("image/")){const T=new FileReader;T.onload=async F=>{var G;const z=(G=F.target)==null?void 0:G.result;if(z){const U=t(L.IMAGE_INPUT,N);a(U,0,z);const R=await xl(z);Rt(z,256,256).then(q=>{o(U,JSON.stringify({image:q,prompt:R||""}))})}},T.readAsDataURL(I),B+=30,E+=30}else if(I.type==="application/json"||I.name.endsWith(".json")||I.name.endsWith(".PMC")||I.name.endsWith(".PMP")||I.name.endsWith(".CHAR")){const T=new FileReader;T.onload=async F=>{var G;const z=(G=F.target)==null?void 0:G.result;try{const U=JSON.parse(z);if(U.type==="script-modifier-project"||U.type==="script-modifier-canvas"){l&&l(d("error.scriptModifierCanvas"));return}if(U.type==="gemini-chat-history"||U.messages&&Array.isArray(U.messages)&&!U.nodes){const R=t(L.GEMINI_CHAT,N),q=JSON.stringify({messages:U.messages||[],currentInput:U.currentInput||"",style:U.style||"general",attachment:U.attachment||null});o(R,q);return}if(U.type==="prompModifierGroup"||U.root&&U.root.type==="prompModifierGroup"){c&&c(U.root||U,N);return}if(U.type==="prompt-modifier-canvas"||U.type==="prompt-modifier-project"||Array.isArray(U.nodes)&&Array.isArray(U.connections)){if(s){const R=I.name.match(/^Prompt_Modifier_(.+?)_\d{4}-\d{2}-\d{2}/),q=R&&R[1]?R[1].replace(/_/g," "):null,H=U.type==="prompt-modifier-project",ne=()=>{s(z),!H&&q&&k&&b&&k(b,q)};w?w({title:d("dialog.confirmLoad.title"),message:d("dialog.confirmLoad.message")+(H?" (Loading Project)":""),onConfirm:ne}):ne()}}else{const R=X=>X&&(X.type==="character-card"||X.name&&X.imageSources);let q=null,H=!1;if(Array.isArray(U)?U.length>0&&R(U[0])&&(q=U,H=!0):R(U)&&(q=[U],H=!1),q){const X=q[0].nodeTitle||q[0].title||(H?"Character Cards":"Character Card"),re=t(L.CHARACTER_CARD,N,X);if(H&&h){const ge=q.length*au+iu;h(te=>te.map(le=>le.id===re?{...le,width:ge}:le))}const de=await Promise.all(q.map(async(ge,te)=>{const le=ge.imageSources||{};ge.image&&!ge.imageSources&&(le["1:1"]=ge.image);const ee={"1:1":null,"16:9":null,"9:16":null};for(const[oe,A]of Object.entries(le))if(typeof A=="string"&&A.startsWith("data:")){const K=$t[oe];K&&a(re,te*10+K,A),ee[oe]=await Rt(A,256,256)}else ee[oe]=A;const se=ge.selectedRatio||"1:1",ie=le[se];return ie&&typeof ie=="string"&&ie.startsWith("data:")&&a(re,te*10,ie),{...ge,image:ee[se],thumbnails:ee,index:ge.index||ge.alias||`Entity-${te+1}`}}));o(re,JSON.stringify(de));return}if(U.type==="script-prompt-modifier-data"||U.finalPrompts&&Array.isArray(U.finalPrompts)){const X=t(L.PROMPT_SEQUENCE_EDITOR,N),re=U.finalPrompts||U.prompts||[],de=U.videoPrompts||[],ge=new Map(de.map(ee=>[ee.frameNumber,ee])),te=re.map((ee,se)=>{const ie=ee.frameNumber!==void 0?ee.frameNumber:se+1,oe=ge.get(ie);let A=ee.characters||[];const K=ee.prompt||"";if(A.length===0&&K){const Z=K.match(/(?:character|entity)-\d+/gi)||[];A=[...new Set(Z.map(W=>W.toLowerCase().replace(/character-/i,"Entity-").replace(/entity-/i,"Entity-")))]}return{frameNumber:ie,sceneNumber:ee.sceneNumber||1,sceneTitle:ee.sceneTitle||"",prompt:K,videoPrompt:(oe==null?void 0:oe.videoPrompt)||ee.videoPrompt||"",shotType:ee.shotType||ee.ShotType||(oe==null?void 0:oe.shotType)||"WS",characters:A,duration:ee.duration||3,isCollapsed:!0}}),le=JSON.stringify({instruction:"",sourcePrompts:te,modifiedPrompts:[],checkedSourceFrameNumbers:[],selectedFrameNumber:null,styleOverride:U.styleOverride||"",usedCharacters:U.usedCharacters||[],sceneContexts:U.sceneContexts||{},leftPaneRatio:.5});o(X,le);return}if(U.type==="script-generator-data"||U.type==="script-analyzer-data"||U.characters&&U.scenes){const X=t(L.SCRIPT_VIEWER,N);U.type||(U.type="script-analyzer-data"),o(X,JSON.stringify(U));return}const ne=t(L.TEXT_INPUT,N);o(ne,JSON.stringify(U,null,2))}}catch{l&&l("Failed to parse JSON file.")}},T.readAsText(I),B+=30,E+=30}else if(I.type.startsWith("text/")){const T=new FileReader;T.onload=F=>{var z;return t(L.TEXT_INPUT,N,void 0,{centerNode:!0,initialValue:(z=F.target)==null?void 0:z.result})},T.readAsText(I),B+=30,E+=30}})}},[t,o,r,a,i,s,l,c,d,u,p,h,w,b,k]),handleDragOver:_,handleDragLeave:x,handleDragEnter:m}};var MC={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let RC,LC;function DC(){return{geminiUrl:RC,vertexUrl:LC}}function zC(e,t,o,r){var a,i;if(!(e!=null&&e.baseUrl)){const s=DC();return t?(a=s.vertexUrl)!==null&&a!==void 0?a:o:(i=s.geminiUrl)!==null&&i!==void 0?i:r}return e.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Jo{}function it(e,t){const o=/\{([^}]+)\}/g;return e.replace(o,(r,a)=>{if(Object.prototype.hasOwnProperty.call(t,a)){const i=t[a];return i!=null?String(i):""}else throw new Error(`Key '${a}' not found in valueMap.`)})}function C(e,t,o){for(let i=0;i<t.length-1;i++){const s=t[i];if(s.endsWith("[]")){const l=s.slice(0,-2);if(!(l in e))if(Array.isArray(o))e[l]=Array.from({length:o.length},()=>({}));else throw new Error(`Value must be a list given an array path ${s}`);if(Array.isArray(e[l])){const c=e[l];if(Array.isArray(o))for(let d=0;d<c.length;d++){const u=c[d];C(u,t.slice(i+1),o[d])}else for(const d of c)C(d,t.slice(i+1),o)}return}else if(s.endsWith("[0]")){const l=s.slice(0,-3);l in e||(e[l]=[{}]);const c=e[l];C(c[0],t.slice(i+1),o);return}(!e[s]||typeof e[s]!="object")&&(e[s]={}),e=e[s]}const r=t[t.length-1],a=e[r];if(a!==void 0){if(!o||typeof o=="object"&&Object.keys(o).length===0||o===a)return;if(typeof a=="object"&&typeof o=="object"&&a!==null&&o!==null)Object.assign(a,o);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof o=="object"&&o!==null&&!Array.isArray(o)?Object.assign(e,o):e[r]=o}function f(e,t,o=void 0){try{if(t.length===1&&t[0]==="_self")return e;for(let r=0;r<t.length;r++){if(typeof e!="object"||e===null)return o;const a=t[r];if(a.endsWith("[]")){const i=a.slice(0,-2);if(i in e){const s=e[i];return Array.isArray(s)?s.map(l=>f(l,t.slice(r+1),o)):o}else return o}else e=e[a]}return e}catch(r){if(r instanceof TypeError)return o;throw r}}function qC(e,t){for(const[o,r]of Object.entries(t)){const a=o.split("."),i=r.split("."),s=new Set;let l=-1;for(let c=0;c<a.length;c++)if(a[c]==="*"){l=c;break}if(l!==-1&&i.length>l)for(let c=l;c<i.length;c++){const d=i[c];d!=="*"&&!d.endsWith("[]")&&!d.endsWith("[0]")&&s.add(d)}su(e,a,i,0,s)}}function su(e,t,o,r,a){if(r>=t.length||typeof e!="object"||e===null)return;const i=t[r];if(i.endsWith("[]")){const s=i.slice(0,-2),l=e;if(s in l&&Array.isArray(l[s]))for(const c of l[s])su(c,t,o,r+1,a)}else if(i==="*"){if(typeof e=="object"&&e!==null&&!Array.isArray(e)){const s=e,l=Object.keys(s).filter(d=>!d.startsWith("_")&&!a.has(d)),c={};for(const d of l)c[d]=s[d];for(const[d,u]of Object.entries(c)){const p=[];for(const h of o.slice(r))h==="*"?p.push(d):p.push(h);C(s,p,u)}for(const d of l)delete s[d]}}else{const s=e;i in s&&su(s[i],t,o,r+1,a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function _p(e){if(typeof e!="string")throw new Error("fromImageBytes must be a string");return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function OC(e){const t={},o=f(e,["operationName"]);o!=null&&C(t,["operationName"],o);const r=f(e,["resourceName"]);return r!=null&&C(t,["_url","resourceName"],r),t}function FC(e){const t={},o=f(e,["name"]);o!=null&&C(t,["name"],o);const r=f(e,["metadata"]);r!=null&&C(t,["metadata"],r);const a=f(e,["done"]);a!=null&&C(t,["done"],a);const i=f(e,["error"]);i!=null&&C(t,["error"],i);const s=f(e,["response","generateVideoResponse"]);return s!=null&&C(t,["response"],HC(s)),t}function BC(e){const t={},o=f(e,["name"]);o!=null&&C(t,["name"],o);const r=f(e,["metadata"]);r!=null&&C(t,["metadata"],r);const a=f(e,["done"]);a!=null&&C(t,["done"],a);const i=f(e,["error"]);i!=null&&C(t,["error"],i);const s=f(e,["response"]);return s!=null&&C(t,["response"],GC(s)),t}function HC(e){const t={},o=f(e,["generatedSamples"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>UC(s))),C(t,["generatedVideos"],i)}const r=f(e,["raiMediaFilteredCount"]);r!=null&&C(t,["raiMediaFilteredCount"],r);const a=f(e,["raiMediaFilteredReasons"]);return a!=null&&C(t,["raiMediaFilteredReasons"],a),t}function GC(e){const t={},o=f(e,["videos"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>VC(s))),C(t,["generatedVideos"],i)}const r=f(e,["raiMediaFilteredCount"]);r!=null&&C(t,["raiMediaFilteredCount"],r);const a=f(e,["raiMediaFilteredReasons"]);return a!=null&&C(t,["raiMediaFilteredReasons"],a),t}function UC(e){const t={},o=f(e,["video"]);return o!=null&&C(t,["video"],ZC(o)),t}function VC(e){const t={},o=f(e,["_self"]);return o!=null&&C(t,["video"],XC(o)),t}function WC(e){const t={},o=f(e,["operationName"]);return o!=null&&C(t,["_url","operationName"],o),t}function $C(e){const t={},o=f(e,["operationName"]);return o!=null&&C(t,["_url","operationName"],o),t}function KC(e){const t={},o=f(e,["name"]);o!=null&&C(t,["name"],o);const r=f(e,["metadata"]);r!=null&&C(t,["metadata"],r);const a=f(e,["done"]);a!=null&&C(t,["done"],a);const i=f(e,["error"]);i!=null&&C(t,["error"],i);const s=f(e,["response"]);return s!=null&&C(t,["response"],JC(s)),t}function JC(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["parent"]);r!=null&&C(t,["parent"],r);const a=f(e,["documentName"]);return a!=null&&C(t,["documentName"],a),t}function Ux(e){const t={},o=f(e,["name"]);o!=null&&C(t,["name"],o);const r=f(e,["metadata"]);r!=null&&C(t,["metadata"],r);const a=f(e,["done"]);a!=null&&C(t,["done"],a);const i=f(e,["error"]);i!=null&&C(t,["error"],i);const s=f(e,["response"]);return s!=null&&C(t,["response"],YC(s)),t}function YC(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["parent"]);r!=null&&C(t,["parent"],r);const a=f(e,["documentName"]);return a!=null&&C(t,["documentName"],a),t}function ZC(e){const t={},o=f(e,["uri"]);o!=null&&C(t,["uri"],o);const r=f(e,["encodedVideo"]);r!=null&&C(t,["videoBytes"],_p(r));const a=f(e,["encoding"]);return a!=null&&C(t,["mimeType"],a),t}function XC(e){const t={},o=f(e,["gcsUri"]);o!=null&&C(t,["uri"],o);const r=f(e,["bytesBase64Encoded"]);r!=null&&C(t,["videoBytes"],_p(r));const a=f(e,["mimeType"]);return a!=null&&C(t,["mimeType"],a),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var im;(function(e){e.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",e.OUTCOME_OK="OUTCOME_OK",e.OUTCOME_FAILED="OUTCOME_FAILED",e.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(im||(im={}));var sm;(function(e){e.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",e.PYTHON="PYTHON"})(sm||(sm={}));var lm;(function(e){e.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",e.SILENT="SILENT",e.WHEN_IDLE="WHEN_IDLE",e.INTERRUPT="INTERRUPT"})(lm||(lm={}));var gt;(function(e){e.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",e.STRING="STRING",e.NUMBER="NUMBER",e.INTEGER="INTEGER",e.BOOLEAN="BOOLEAN",e.ARRAY="ARRAY",e.OBJECT="OBJECT",e.NULL="NULL"})(gt||(gt={}));var cm;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(cm||(cm={}));var dm;(function(e){e.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",e.SIMPLE_SEARCH="SIMPLE_SEARCH",e.ELASTIC_SEARCH="ELASTIC_SEARCH"})(dm||(dm={}));var um;(function(e){e.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",e.NO_AUTH="NO_AUTH",e.API_KEY_AUTH="API_KEY_AUTH",e.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",e.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",e.OAUTH="OAUTH",e.OIDC_AUTH="OIDC_AUTH"})(um||(um={}));var pm;(function(e){e.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",e.HTTP_IN_QUERY="HTTP_IN_QUERY",e.HTTP_IN_HEADER="HTTP_IN_HEADER",e.HTTP_IN_PATH="HTTP_IN_PATH",e.HTTP_IN_BODY="HTTP_IN_BODY",e.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(pm||(pm={}));var hm;(function(e){e.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",e.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",e.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",e.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(hm||(hm={}));var mm;(function(e){e.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH",e.MINIMAL="MINIMAL"})(mm||(mm={}));var gm;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",e.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",e.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",e.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",e.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(gm||(gm={}));var fm;(function(e){e.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",e.SEVERITY="SEVERITY",e.PROBABILITY="PROBABILITY"})(fm||(fm={}));var xm;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE",e.OFF="OFF"})(xm||(xm={}));var ym;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.IMAGE_SAFETY="IMAGE_SAFETY",e.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",e.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",e.NO_IMAGE="NO_IMAGE",e.IMAGE_RECITATION="IMAGE_RECITATION",e.IMAGE_OTHER="IMAGE_OTHER"})(ym||(ym={}));var vm;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(vm||(vm={}));var wm;(function(e){e.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",e.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",e.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",e.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",e.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(wm||(wm={}));var bm;(function(e){e.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",e.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",e.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",e.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",e.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(bm||(bm={}));var Cm;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.IMAGE_SAFETY="IMAGE_SAFETY",e.MODEL_ARMOR="MODEL_ARMOR",e.JAILBREAK="JAILBREAK"})(Cm||(Cm={}));var km;(function(e){e.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",e.ON_DEMAND="ON_DEMAND",e.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(km||(km={}));var za;(function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.AUDIO="AUDIO"})(za||(za={}));var _m;(function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(_m||(_m={}));var Sm;(function(e){e.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",e.TUNING_MODE_FULL="TUNING_MODE_FULL",e.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Sm||(Sm={}));var Nm;(function(e){e.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",e.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",e.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",e.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",e.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",e.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",e.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Nm||(Nm={}));var lu;(function(e){e.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",e.JOB_STATE_QUEUED="JOB_STATE_QUEUED",e.JOB_STATE_PENDING="JOB_STATE_PENDING",e.JOB_STATE_RUNNING="JOB_STATE_RUNNING",e.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",e.JOB_STATE_FAILED="JOB_STATE_FAILED",e.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",e.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",e.JOB_STATE_PAUSED="JOB_STATE_PAUSED",e.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",e.JOB_STATE_UPDATING="JOB_STATE_UPDATING",e.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(lu||(lu={}));var Em;(function(e){e.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",e.TUNING_TASK_I2V="TUNING_TASK_I2V",e.TUNING_TASK_T2V="TUNING_TASK_T2V",e.TUNING_TASK_R2V="TUNING_TASK_R2V"})(Em||(Em={}));var Pm;(function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",e.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(Pm||(Pm={}));var jm;(function(e){e.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",e.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",e.BALANCED="BALANCED",e.PRIORITIZE_COST="PRIORITIZE_COST"})(jm||(jm={}));var Tm;(function(e){e.UNSPECIFIED="UNSPECIFIED",e.BLOCKING="BLOCKING",e.NON_BLOCKING="NON_BLOCKING"})(Tm||(Tm={}));var Im;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(Im||(Im={}));var Am;(function(e){e.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",e.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Am||(Am={}));var Mm;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE",e.VALIDATED="VALIDATED"})(Mm||(Mm={}));var Rm;(function(e){e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(Rm||(Rm={}));var Lm;(function(e){e.DONT_ALLOW="DONT_ALLOW",e.ALLOW_ADULT="ALLOW_ADULT",e.ALLOW_ALL="ALLOW_ALL"})(Lm||(Lm={}));var Dm;(function(e){e.auto="auto",e.en="en",e.ja="ja",e.ko="ko",e.hi="hi",e.zh="zh",e.pt="pt",e.es="es"})(Dm||(Dm={}));var zm;(function(e){e.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",e.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",e.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",e.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",e.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(zm||(zm={}));var qm;(function(e){e.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",e.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",e.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",e.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(qm||(qm={}));var Om;(function(e){e.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",e.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",e.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",e.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Om||(Om={}));var Fm;(function(e){e.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",e.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",e.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",e.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",e.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",e.EDIT_MODE_STYLE="EDIT_MODE_STYLE",e.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",e.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Fm||(Fm={}));var Bm;(function(e){e.FOREGROUND="FOREGROUND",e.BACKGROUND="BACKGROUND",e.PROMPT="PROMPT",e.SEMANTIC="SEMANTIC",e.INTERACTIVE="INTERACTIVE"})(Bm||(Bm={}));var Hm;(function(e){e.ASSET="ASSET",e.STYLE="STYLE"})(Hm||(Hm={}));var Gm;(function(e){e.INSERT="INSERT",e.REMOVE="REMOVE",e.REMOVE_STATIC="REMOVE_STATIC",e.OUTPAINT="OUTPAINT"})(Gm||(Gm={}));var Um;(function(e){e.OPTIMIZED="OPTIMIZED",e.LOSSLESS="LOSSLESS"})(Um||(Um={}));var Vm;(function(e){e.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",e.PREFERENCE_TUNING="PREFERENCE_TUNING"})(Vm||(Vm={}));var Wm;(function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.STATE_PENDING="STATE_PENDING",e.STATE_ACTIVE="STATE_ACTIVE",e.STATE_FAILED="STATE_FAILED"})(Wm||(Wm={}));var $m;(function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.PROCESSING="PROCESSING",e.ACTIVE="ACTIVE",e.FAILED="FAILED"})($m||($m={}));var Km;(function(e){e.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",e.UPLOADED="UPLOADED",e.GENERATED="GENERATED"})(Km||(Km={}));var Jm;(function(e){e.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.RESPONSE_REJECTED="RESPONSE_REJECTED",e.NEED_MORE_INPUT="NEED_MORE_INPUT"})(Jm||(Jm={}));var Ym;(function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.DOCUMENT="DOCUMENT"})(Ym||(Ym={}));var Zm;(function(e){e.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",e.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",e.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(Zm||(Zm={}));var Xm;(function(e){e.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",e.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",e.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Xm||(Xm={}));var Qm;(function(e){e.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",e.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",e.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Qm||(Qm={}));var eg;(function(e){e.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",e.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",e.NO_INTERRUPTION="NO_INTERRUPTION"})(eg||(eg={}));var tg;(function(e){e.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",e.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",e.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(tg||(tg={}));var ng;(function(e){e.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",e.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",e.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",e.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",e.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",e.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",e.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",e.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",e.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",e.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",e.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",e.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",e.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(ng||(ng={}));var og;(function(e){e.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",e.QUALITY="QUALITY",e.DIVERSITY="DIVERSITY",e.VOCALIZATION="VOCALIZATION"})(og||(og={}));var fa;(function(e){e.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",e.PLAY="PLAY",e.PAUSE="PAUSE",e.STOP="STOP",e.RESET_CONTEXT="RESET_CONTEXT"})(fa||(fa={}));class cu{constructor(t){const o={};for(const r of t.headers.entries())o[r[0]]=r[1];this.headers=o,this.responseInternal=t}json(){return this.responseInternal.json()}}class ei{get text(){var t,o,r,a,i,s,l,c;if(((a=(r=(o=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||o===void 0?void 0:o.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",u=!1;const p=[];for(const h of(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)!==null&&c!==void 0?c:[]){for(const[w,k]of Object.entries(h))w!=="text"&&w!=="thought"&&w!=="thoughtSignature"&&(k!==null||k!==void 0)&&p.push(w);if(typeof h.text=="string"){if(typeof h.thought=="boolean"&&h.thought)continue;u=!0,d+=h.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?d:void 0}get data(){var t,o,r,a,i,s,l,c;if(((a=(r=(o=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||o===void 0?void 0:o.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="";const u=[];for(const p of(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)!==null&&c!==void 0?c:[]){for(const[h,w]of Object.entries(p))h!=="inlineData"&&(w!==null||w!==void 0)&&u.push(h);p.inlineData&&typeof p.inlineData.data=="string"&&(d+=atob(p.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var t,o,r,a,i,s,l,c;if(((a=(r=(o=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||o===void 0?void 0:o.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(u=>u.functionCall).map(u=>u.functionCall).filter(u=>u!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var t,o,r,a,i,s,l,c,d;if(((a=(r=(o=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||o===void 0?void 0:o.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const u=(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((u==null?void 0:u.length)!==0)return(d=u==null?void 0:u[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var t,o,r,a,i,s,l,c,d;if(((a=(r=(o=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||o===void 0?void 0:o.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const u=(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((u==null?void 0:u.length)!==0)return(d=u==null?void 0:u[0])===null||d===void 0?void 0:d.output}}class rg{}class ag{}class QC{}class e5{}class t5{}class n5{}class ig{}class sg{}class lg{}class o5{}class wl{_fromAPIResponse({apiResponse:t,_isVertexAI:o}){const r=new wl;let a;const i=t;return o?a=BC(i):a=FC(i),Object.assign(r,a),r}}class cg{}class dg{}class ug{}class pg{}class r5{}class a5{}class i5{}class Sp{_fromAPIResponse({apiResponse:t,_isVertexAI:o}){const r=new Sp,i=KC(t);return Object.assign(r,i),r}}class s5{}class l5{}class c5{}class hg{}class d5{get text(){var t,o,r;let a="",i=!1;const s=[];for(const l of(r=(o=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||o===void 0?void 0:o.parts)!==null&&r!==void 0?r:[]){for(const[c,d]of Object.entries(l))c!=="text"&&c!=="thought"&&d!==null&&s.push(c);if(typeof l.text=="string"){if(typeof l.thought=="boolean"&&l.thought)continue;i=!0,a+=l.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),i?a:void 0}get data(){var t,o,r;let a="";const i=[];for(const s of(r=(o=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||o===void 0?void 0:o.parts)!==null&&r!==void 0?r:[]){for(const[l,c]of Object.entries(s))l!=="inlineData"&&c!==null&&i.push(l);s.inlineData&&typeof s.inlineData.data=="string"&&(a+=atob(s.inlineData.data))}return i.length>0&&console.warn(`there are non-data parts ${i} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),a.length>0?btoa(a):void 0}}class u5{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class Np{_fromAPIResponse({apiResponse:t,_isVertexAI:o}){const r=new Np,i=Ux(t);return Object.assign(r,i),r}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zt(e,t){if(!t||typeof t!="string")throw new Error("model is required and must be a string");if(t.includes("..")||t.includes("?")||t.includes("&"))throw new Error("invalid model parameter");if(e.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(t.indexOf("/")>=0){const o=t.split("/",2);return`publishers/${o[0]}/models/${o[1]}`}else return`publishers/google/models/${t}`}else return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function Vx(e,t){const o=zt(e,t);return o?o.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${o}`:o.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${o}`:o:""}function Wx(e){return Array.isArray(e)?e.map(t=>bl(t)):[bl(e)]}function bl(e){if(typeof e=="object"&&e!==null)return e;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function $x(e){const t=bl(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function Kx(e){const t=bl(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function mg(e){if(e==null)throw new Error("PartUnion is required");if(typeof e=="object")return e;if(typeof e=="string")return{text:e};throw new Error(`Unsupported part type: ${typeof e}`)}function Jx(e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("PartListUnion is required");return Array.isArray(e)?e.map(t=>mg(t)):[mg(e)]}function du(e){return e!=null&&typeof e=="object"&&"parts"in e&&Array.isArray(e.parts)}function gg(e){return e!=null&&typeof e=="object"&&"functionCall"in e}function fg(e){return e!=null&&typeof e=="object"&&"functionResponse"in e}function Pn(e){if(e==null)throw new Error("ContentUnion is required");return du(e)?e:{role:"user",parts:Jx(e)}}function Ep(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(o=>{const r=Pn(o);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(e.isVertexAI()){const o=Pn(t);return o.parts&&o.parts.length>0&&o.parts[0].text!==void 0?[o.parts[0].text]:[]}return Array.isArray(t)?t.map(o=>Pn(o)):[Pn(t)]}function io(e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("contents are required");if(!Array.isArray(e)){if(gg(e)||fg(e))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Pn(e)]}const t=[],o=[],r=du(e[0]);for(const a of e){const i=du(a);if(i!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(i)t.push(a);else{if(gg(a)||fg(a))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");o.push(a)}}return r||t.push({role:"user",parts:Jx(o)}),t}function p5(e,t){e.includes("null")&&(t.nullable=!0);const o=e.filter(r=>r!=="null");if(o.length===1)t.type=Object.values(gt).includes(o[0].toUpperCase())?o[0].toUpperCase():gt.TYPE_UNSPECIFIED;else{t.anyOf=[];for(const r of o)t.anyOf.push({type:Object.values(gt).includes(r.toUpperCase())?r.toUpperCase():gt.TYPE_UNSPECIFIED})}}function _a(e){const t={},o=["items"],r=["anyOf"],a=["properties"];if(e.type&&e.anyOf)throw new Error("type and anyOf cannot be both populated.");const i=e.anyOf;i!=null&&i.length==2&&(i[0].type==="null"?(t.nullable=!0,e=i[1]):i[1].type==="null"&&(t.nullable=!0,e=i[0])),e.type instanceof Array&&p5(e.type,t);for(const[s,l]of Object.entries(e))if(l!=null)if(s=="type"){if(l==="null")throw new Error("type: null can not be the only possible type for the field.");if(l instanceof Array)continue;t.type=Object.values(gt).includes(l.toUpperCase())?l.toUpperCase():gt.TYPE_UNSPECIFIED}else if(o.includes(s))t[s]=_a(l);else if(r.includes(s)){const c=[];for(const d of l){if(d.type=="null"){t.nullable=!0;continue}c.push(_a(d))}t[s]=c}else if(a.includes(s)){const c={};for(const[d,u]of Object.entries(l))c[d]=_a(u);t[s]=c}else{if(s==="additionalProperties")continue;t[s]=l}return t}function Pp(e){return _a(e)}function jp(e){if(typeof e=="object")return e;if(typeof e=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw new Error(`Unsupported speechConfig type: ${typeof e}`)}function Tp(e){if("multiSpeakerVoiceConfig"in e)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function Ha(e){if(e.functionDeclarations)for(const t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=_a(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=_a(t.response));return e}function Ga(e){if(e==null)throw new Error("tools is required");if(!Array.isArray(e))throw new Error("tools is required and must be an array of Tools");const t=[];for(const o of e)t.push(o);return t}function h5(e,t,o,r=1){const a=!t.startsWith(`${o}/`)&&t.split("/").length===r;return e.isVertexAI()?t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${e.getProject()}/${t}`:t.startsWith(`${o}/`)?`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`:a?`projects/${e.getProject()}/locations/${e.getLocation()}/${o}/${t}`:t:a?`${o}/${t}`:t}function Yo(e,t){if(typeof t!="string")throw new Error("name must be a string");return h5(e,t,"cachedContents")}function Yx(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function Nr(e){return _p(e)}function m5(e){return e!=null&&typeof e=="object"&&"name"in e}function g5(e){return e!=null&&typeof e=="object"&&"video"in e}function f5(e){return e!=null&&typeof e=="object"&&"uri"in e}function Zx(e){var t;let o;if(m5(e)&&(o=e.name),!(f5(e)&&(o=e.uri,o===void 0))&&!(g5(e)&&(o=(t=e.video)===null||t===void 0?void 0:t.uri,o===void 0))){if(typeof e=="string"&&(o=e),o===void 0)throw new Error("Could not extract file name from the provided input.");if(o.startsWith("https://")){const a=o.split("files/")[1].match(/[a-z0-9]+/);if(a===null)throw new Error(`Could not extract file name from URI ${o}`);o=a[0]}else o.startsWith("files/")&&(o=o.split("files/")[1]);return o}}function Xx(e,t){let o;return e.isVertexAI()?o=t?"publishers/google/models":"models":o=t?"models":"tunedModels",o}function Qx(e){for(const t of["models","tunedModels","publisherModels"])if(x5(e,t))return e[t];return[]}function x5(e,t){return e!==null&&typeof e=="object"&&t in e}function y5(e,t={}){const o=e,r={name:o.name,description:o.description,parametersJsonSchema:o.inputSchema};return o.outputSchema&&(r.responseJsonSchema=o.outputSchema),t.behavior&&(r.behavior=t.behavior),{functionDeclarations:[r]}}function v5(e,t={}){const o=[],r=new Set;for(const a of e){const i=a.name;if(r.has(i))throw new Error(`Duplicate function name ${i} found in MCP tools. Please ensure function names are unique.`);r.add(i);const s=y5(a,t);s.functionDeclarations&&o.push(...s.functionDeclarations)}return{functionDeclarations:o}}function e1(e,t){let o;if(typeof t=="string")if(e.isVertexAI())if(t.startsWith("gs://"))o={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))o={format:"bigquery",bigqueryUri:t};else throw new Error(`Unsupported string source for Vertex AI: ${t}`);else if(t.startsWith("files/"))o={fileName:t};else throw new Error(`Unsupported string source for Gemini API: ${t}`);else if(Array.isArray(t)){if(e.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");o={inlinedRequests:t}}else o=t;const r=[o.gcsUri,o.bigqueryUri].filter(Boolean).length,a=[o.inlinedRequests,o.fileName].filter(Boolean).length;if(e.isVertexAI()){if(a>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||a!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return o}function w5(e){if(typeof e!="string")return e;const t=e;if(t.startsWith("gs://"))return{format:"jsonl",gcsUri:t};if(t.startsWith("bq://"))return{format:"bigquery",bigqueryUri:t};throw new Error(`Unsupported destination: ${t}`)}function t1(e){if(typeof e!="object"||e===null)return{};const t=e,o=t.inlinedResponses;if(typeof o!="object"||o===null)return e;const a=o.inlinedResponses;if(!Array.isArray(a)||a.length===0)return e;let i=!1;for(const s of a){if(typeof s!="object"||s===null)continue;const c=s.response;if(typeof c!="object"||c===null)continue;if(c.embedding!==void 0){i=!0;break}}return i&&(t.inlinedEmbedContentResponses=t.inlinedResponses,delete t.inlinedResponses),e}function Ua(e,t){const o=t;if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(o))return o.split("/").pop();throw new Error(`Invalid batch job name: ${o}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(o))return o.split("/").pop();if(/^\d+$/.test(o))return o;throw new Error(`Invalid batch job name: ${o}.`)}function n1(e){const t=e;return t==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":t==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":t==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":t==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":t==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":t==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":t==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function b5(e){const t={},o=f(e,["responsesFile"]);o!=null&&C(t,["fileName"],o);const r=f(e,["inlinedResponses","inlinedResponses"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>tk(s))),C(t,["inlinedResponses"],i)}const a=f(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),C(t,["inlinedEmbedContentResponses"],i)}return t}function C5(e){const t={},o=f(e,["predictionsFormat"]);o!=null&&C(t,["format"],o);const r=f(e,["gcsDestination","outputUriPrefix"]);r!=null&&C(t,["gcsUri"],r);const a=f(e,["bigqueryDestination","outputUri"]);return a!=null&&C(t,["bigqueryUri"],a),t}function k5(e){const t={},o=f(e,["format"]);o!=null&&C(t,["predictionsFormat"],o);const r=f(e,["gcsUri"]);r!=null&&C(t,["gcsDestination","outputUriPrefix"],r);const a=f(e,["bigqueryUri"]);if(a!=null&&C(t,["bigqueryDestination","outputUri"],a),f(e,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(f(e,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(f(e,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}function Gs(e){const t={},o=f(e,["name"]);o!=null&&C(t,["name"],o);const r=f(e,["metadata","displayName"]);r!=null&&C(t,["displayName"],r);const a=f(e,["metadata","state"]);a!=null&&C(t,["state"],n1(a));const i=f(e,["metadata","createTime"]);i!=null&&C(t,["createTime"],i);const s=f(e,["metadata","endTime"]);s!=null&&C(t,["endTime"],s);const l=f(e,["metadata","updateTime"]);l!=null&&C(t,["updateTime"],l);const c=f(e,["metadata","model"]);c!=null&&C(t,["model"],c);const d=f(e,["metadata","output"]);return d!=null&&C(t,["dest"],b5(t1(d))),t}function uu(e){const t={},o=f(e,["name"]);o!=null&&C(t,["name"],o);const r=f(e,["displayName"]);r!=null&&C(t,["displayName"],r);const a=f(e,["state"]);a!=null&&C(t,["state"],n1(a));const i=f(e,["error"]);i!=null&&C(t,["error"],i);const s=f(e,["createTime"]);s!=null&&C(t,["createTime"],s);const l=f(e,["startTime"]);l!=null&&C(t,["startTime"],l);const c=f(e,["endTime"]);c!=null&&C(t,["endTime"],c);const d=f(e,["updateTime"]);d!=null&&C(t,["updateTime"],d);const u=f(e,["model"]);u!=null&&C(t,["model"],u);const p=f(e,["inputConfig"]);p!=null&&C(t,["src"],_5(p));const h=f(e,["outputConfig"]);h!=null&&C(t,["dest"],C5(t1(h)));const w=f(e,["completionStats"]);return w!=null&&C(t,["completionStats"],w),t}function _5(e){const t={},o=f(e,["instancesFormat"]);o!=null&&C(t,["format"],o);const r=f(e,["gcsSource","uris"]);r!=null&&C(t,["gcsUri"],r);const a=f(e,["bigquerySource","inputUri"]);return a!=null&&C(t,["bigqueryUri"],a),t}function S5(e,t){const o={};if(f(t,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(f(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(f(t,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const r=f(t,["fileName"]);r!=null&&C(o,["fileName"],r);const a=f(t,["inlinedRequests"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>ek(e,s))),C(o,["requests","requests"],i)}return o}function N5(e){const t={},o=f(e,["format"]);o!=null&&C(t,["instancesFormat"],o);const r=f(e,["gcsUri"]);r!=null&&C(t,["gcsSource","uris"],r);const a=f(e,["bigqueryUri"]);if(a!=null&&C(t,["bigquerySource","inputUri"],a),f(e,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(f(e,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return t}function E5(e){const t={},o=f(e,["data"]);if(o!=null&&C(t,["data"],o),f(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=f(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function P5(e,t){const o={},r=f(t,["name"]);return r!=null&&C(o,["_url","name"],Ua(e,r)),o}function j5(e,t){const o={},r=f(t,["name"]);return r!=null&&C(o,["_url","name"],Ua(e,r)),o}function T5(e){const t={},o=f(e,["content"]);o!=null&&C(t,["content"],o);const r=f(e,["citationMetadata"]);r!=null&&C(t,["citationMetadata"],I5(r));const a=f(e,["tokenCount"]);a!=null&&C(t,["tokenCount"],a);const i=f(e,["finishReason"]);i!=null&&C(t,["finishReason"],i);const s=f(e,["avgLogprobs"]);s!=null&&C(t,["avgLogprobs"],s);const l=f(e,["groundingMetadata"]);l!=null&&C(t,["groundingMetadata"],l);const c=f(e,["index"]);c!=null&&C(t,["index"],c);const d=f(e,["logprobsResult"]);d!=null&&C(t,["logprobsResult"],d);const u=f(e,["safetyRatings"]);if(u!=null){let h=u;Array.isArray(h)&&(h=h.map(w=>w)),C(t,["safetyRatings"],h)}const p=f(e,["urlContextMetadata"]);return p!=null&&C(t,["urlContextMetadata"],p),t}function I5(e){const t={},o=f(e,["citationSources"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>a)),C(t,["citations"],r)}return t}function o1(e){const t={},o=f(e,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(i=>lk(i))),C(t,["parts"],a)}const r=f(e,["role"]);return r!=null&&C(t,["role"],r),t}function A5(e,t){const o={},r=f(e,["displayName"]);if(t!==void 0&&r!=null&&C(t,["batch","displayName"],r),f(e,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return o}function M5(e,t){const o={},r=f(e,["displayName"]);t!==void 0&&r!=null&&C(t,["displayName"],r);const a=f(e,["dest"]);return t!==void 0&&a!=null&&C(t,["outputConfig"],k5(w5(a))),o}function xg(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["_url","model"],zt(e,r));const a=f(t,["src"]);a!=null&&C(o,["batch","inputConfig"],S5(e,e1(e,a)));const i=f(t,["config"]);return i!=null&&A5(i,o),o}function R5(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["model"],zt(e,r));const a=f(t,["src"]);a!=null&&C(o,["inputConfig"],N5(e1(e,a)));const i=f(t,["config"]);return i!=null&&M5(i,o),o}function L5(e,t){const o={},r=f(e,["displayName"]);return t!==void 0&&r!=null&&C(t,["batch","displayName"],r),o}function D5(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["_url","model"],zt(e,r));const a=f(t,["src"]);a!=null&&C(o,["batch","inputConfig"],G5(e,a));const i=f(t,["config"]);return i!=null&&L5(i,o),o}function z5(e,t){const o={},r=f(t,["name"]);return r!=null&&C(o,["_url","name"],Ua(e,r)),o}function q5(e,t){const o={},r=f(t,["name"]);return r!=null&&C(o,["_url","name"],Ua(e,r)),o}function O5(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["name"]);r!=null&&C(t,["name"],r);const a=f(e,["done"]);a!=null&&C(t,["done"],a);const i=f(e,["error"]);return i!=null&&C(t,["error"],i),t}function F5(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["name"]);r!=null&&C(t,["name"],r);const a=f(e,["done"]);a!=null&&C(t,["done"],a);const i=f(e,["error"]);return i!=null&&C(t,["error"],i),t}function B5(e,t){const o={},r=f(t,["contents"]);if(r!=null){let i=Ep(e,r);Array.isArray(i)&&(i=i.map(s=>s)),C(o,["requests[]","request","content"],i)}const a=f(t,["config"]);return a!=null&&(C(o,["_self"],H5(a,o)),qC(o,{"requests[].*":"requests[].request.*"})),o}function H5(e,t){const o={},r=f(e,["taskType"]);t!==void 0&&r!=null&&C(t,["requests[]","taskType"],r);const a=f(e,["title"]);t!==void 0&&a!=null&&C(t,["requests[]","title"],a);const i=f(e,["outputDimensionality"]);if(t!==void 0&&i!=null&&C(t,["requests[]","outputDimensionality"],i),f(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(f(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return o}function G5(e,t){const o={},r=f(t,["fileName"]);r!=null&&C(o,["file_name"],r);const a=f(t,["inlinedRequests"]);return a!=null&&C(o,["requests"],B5(e,a)),o}function U5(e){const t={};if(f(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=f(e,["fileUri"]);o!=null&&C(t,["fileUri"],o);const r=f(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function V5(e){const t={},o=f(e,["id"]);o!=null&&C(t,["id"],o);const r=f(e,["args"]);r!=null&&C(t,["args"],r);const a=f(e,["name"]);if(a!=null&&C(t,["name"],a),f(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function W5(e){const t={},o=f(e,["mode"]);o!=null&&C(t,["mode"],o);const r=f(e,["allowedFunctionNames"]);if(r!=null&&C(t,["allowedFunctionNames"],r),f(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function $5(e,t,o){const r={},a=f(t,["systemInstruction"]);o!==void 0&&a!=null&&C(o,["systemInstruction"],o1(Pn(a)));const i=f(t,["temperature"]);i!=null&&C(r,["temperature"],i);const s=f(t,["topP"]);s!=null&&C(r,["topP"],s);const l=f(t,["topK"]);l!=null&&C(r,["topK"],l);const c=f(t,["candidateCount"]);c!=null&&C(r,["candidateCount"],c);const d=f(t,["maxOutputTokens"]);d!=null&&C(r,["maxOutputTokens"],d);const u=f(t,["stopSequences"]);u!=null&&C(r,["stopSequences"],u);const p=f(t,["responseLogprobs"]);p!=null&&C(r,["responseLogprobs"],p);const h=f(t,["logprobs"]);h!=null&&C(r,["logprobs"],h);const w=f(t,["presencePenalty"]);w!=null&&C(r,["presencePenalty"],w);const k=f(t,["frequencyPenalty"]);k!=null&&C(r,["frequencyPenalty"],k);const b=f(t,["seed"]);b!=null&&C(r,["seed"],b);const y=f(t,["responseMimeType"]);y!=null&&C(r,["responseMimeType"],y);const g=f(t,["responseSchema"]);g!=null&&C(r,["responseSchema"],Pp(g));const m=f(t,["responseJsonSchema"]);if(m!=null&&C(r,["responseJsonSchema"],m),f(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(f(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const x=f(t,["safetySettings"]);if(o!==void 0&&x!=null){let I=x;Array.isArray(I)&&(I=I.map(N=>ck(N))),C(o,["safetySettings"],I)}const _=f(t,["tools"]);if(o!==void 0&&_!=null){let I=Ga(_);Array.isArray(I)&&(I=I.map(N=>uk(Ha(N)))),C(o,["tools"],I)}const S=f(t,["toolConfig"]);if(o!==void 0&&S!=null&&C(o,["toolConfig"],dk(S)),f(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const P=f(t,["cachedContent"]);o!==void 0&&P!=null&&C(o,["cachedContent"],Yo(e,P));const j=f(t,["responseModalities"]);j!=null&&C(r,["responseModalities"],j);const M=f(t,["mediaResolution"]);M!=null&&C(r,["mediaResolution"],M);const D=f(t,["speechConfig"]);if(D!=null&&C(r,["speechConfig"],jp(D)),f(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const O=f(t,["thinkingConfig"]);O!=null&&C(r,["thinkingConfig"],O);const B=f(t,["imageConfig"]);B!=null&&C(r,["imageConfig"],Q5(B));const E=f(t,["enableEnhancedCivicAnswers"]);return E!=null&&C(r,["enableEnhancedCivicAnswers"],E),r}function K5(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["candidates"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(d=>T5(d))),C(t,["candidates"],c)}const a=f(e,["modelVersion"]);a!=null&&C(t,["modelVersion"],a);const i=f(e,["promptFeedback"]);i!=null&&C(t,["promptFeedback"],i);const s=f(e,["responseId"]);s!=null&&C(t,["responseId"],s);const l=f(e,["usageMetadata"]);return l!=null&&C(t,["usageMetadata"],l),t}function J5(e,t){const o={},r=f(t,["name"]);return r!=null&&C(o,["_url","name"],Ua(e,r)),o}function Y5(e,t){const o={},r=f(t,["name"]);return r!=null&&C(o,["_url","name"],Ua(e,r)),o}function Z5(e){const t={};if(f(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const o=f(e,["enableWidget"]);return o!=null&&C(t,["enableWidget"],o),t}function X5(e){const t={};if(f(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const o=f(e,["timeRangeFilter"]);return o!=null&&C(t,["timeRangeFilter"],o),t}function Q5(e){const t={},o=f(e,["aspectRatio"]);o!=null&&C(t,["aspectRatio"],o);const r=f(e,["imageSize"]);if(r!=null&&C(t,["imageSize"],r),f(e,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(f(e,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function ek(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["request","model"],zt(e,r));const a=f(t,["contents"]);if(a!=null){let l=io(a);Array.isArray(l)&&(l=l.map(c=>o1(c))),C(o,["request","contents"],l)}const i=f(t,["metadata"]);i!=null&&C(o,["metadata"],i);const s=f(t,["config"]);return s!=null&&C(o,["request","generationConfig"],$5(e,s,f(o,["request"],{}))),o}function tk(e){const t={},o=f(e,["response"]);o!=null&&C(t,["response"],K5(o));const r=f(e,["error"]);return r!=null&&C(t,["error"],r),t}function nk(e,t){const o={},r=f(e,["pageSize"]);t!==void 0&&r!=null&&C(t,["_query","pageSize"],r);const a=f(e,["pageToken"]);if(t!==void 0&&a!=null&&C(t,["_query","pageToken"],a),f(e,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return o}function ok(e,t){const o={},r=f(e,["pageSize"]);t!==void 0&&r!=null&&C(t,["_query","pageSize"],r);const a=f(e,["pageToken"]);t!==void 0&&a!=null&&C(t,["_query","pageToken"],a);const i=f(e,["filter"]);return t!==void 0&&i!=null&&C(t,["_query","filter"],i),o}function rk(e){const t={},o=f(e,["config"]);return o!=null&&nk(o,t),t}function ak(e){const t={},o=f(e,["config"]);return o!=null&&ok(o,t),t}function ik(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["nextPageToken"]);r!=null&&C(t,["nextPageToken"],r);const a=f(e,["operations"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>Gs(s))),C(t,["batchJobs"],i)}return t}function sk(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["nextPageToken"]);r!=null&&C(t,["nextPageToken"],r);const a=f(e,["batchPredictionJobs"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>uu(s))),C(t,["batchJobs"],i)}return t}function lk(e){const t={},o=f(e,["mediaResolution"]);o!=null&&C(t,["mediaResolution"],o);const r=f(e,["codeExecutionResult"]);r!=null&&C(t,["codeExecutionResult"],r);const a=f(e,["executableCode"]);a!=null&&C(t,["executableCode"],a);const i=f(e,["fileData"]);i!=null&&C(t,["fileData"],U5(i));const s=f(e,["functionCall"]);s!=null&&C(t,["functionCall"],V5(s));const l=f(e,["functionResponse"]);l!=null&&C(t,["functionResponse"],l);const c=f(e,["inlineData"]);c!=null&&C(t,["inlineData"],E5(c));const d=f(e,["text"]);d!=null&&C(t,["text"],d);const u=f(e,["thought"]);u!=null&&C(t,["thought"],u);const p=f(e,["thoughtSignature"]);p!=null&&C(t,["thoughtSignature"],p);const h=f(e,["videoMetadata"]);return h!=null&&C(t,["videoMetadata"],h),t}function ck(e){const t={},o=f(e,["category"]);if(o!=null&&C(t,["category"],o),f(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=f(e,["threshold"]);return r!=null&&C(t,["threshold"],r),t}function dk(e){const t={},o=f(e,["functionCallingConfig"]);o!=null&&C(t,["functionCallingConfig"],W5(o));const r=f(e,["retrievalConfig"]);return r!=null&&C(t,["retrievalConfig"],r),t}function uk(e){const t={},o=f(e,["functionDeclarations"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(p=>p)),C(t,["functionDeclarations"],u)}if(f(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=f(e,["googleSearchRetrieval"]);r!=null&&C(t,["googleSearchRetrieval"],r);const a=f(e,["computerUse"]);a!=null&&C(t,["computerUse"],a);const i=f(e,["fileSearch"]);i!=null&&C(t,["fileSearch"],i);const s=f(e,["codeExecution"]);if(s!=null&&C(t,["codeExecution"],s),f(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=f(e,["googleMaps"]);l!=null&&C(t,["googleMaps"],Z5(l));const c=f(e,["googleSearch"]);c!=null&&C(t,["googleSearch"],X5(c));const d=f(e,["urlContext"]);return d!=null&&C(t,["urlContext"],d),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var $o;(function(e){e.PAGED_ITEM_BATCH_JOBS="batchJobs",e.PAGED_ITEM_MODELS="models",e.PAGED_ITEM_TUNING_JOBS="tuningJobs",e.PAGED_ITEM_FILES="files",e.PAGED_ITEM_CACHED_CONTENTS="cachedContents",e.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",e.PAGED_ITEM_DOCUMENTS="documents"})($o||($o={}));class Wr{constructor(t,o,r,a){this.pageInternal=[],this.paramsInternal={},this.requestInternal=o,this.init(t,r,a)}init(t,o,r){var a,i;this.nameInternal=t,this.pageInternal=o[this.nameInternal]||[],this.sdkHttpResponseInternal=o==null?void 0:o.sdkHttpResponse,this.idxInternal=0;let s={config:{}};!r||Object.keys(r).length===0?s={config:{}}:typeof r=="object"?s=Object.assign({},r):s=r,s.config&&(s.config.pageToken=o.nextPageToken),this.paramsInternal=s,this.pageInternalSize=(i=(a=s.config)===null||a===void 0?void 0:a.pageSize)!==null&&i!==void 0?i:this.pageInternal.length}initNextPage(t){this.init(this.nameInternal,t,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(t){return this.pageInternal[t]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const t=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:t,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const t=await this.requestInternal(this.params);return this.initNextPage(t),this.page}hasNextPage(){var t;return((t=this.params.config)===null||t===void 0?void 0:t.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class pk extends Jo{constructor(t){super(),this.apiClient=t,this.list=async(o={})=>new Wr($o.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(o),o),this.create=async o=>(this.apiClient.isVertexAI()&&(o.config=this.formatDestination(o.src,o.config)),this.createInternal(o)),this.createEmbeddings=async o=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(o)}}createInlinedGenerateContentRequest(t){const o=xg(this.apiClient,t),r=o._url,a=it("{model}:batchGenerateContent",r),l=o.batch.inputConfig.requests,c=l.requests,d=[];for(const u of c){const p=Object.assign({},u);if(p.systemInstruction){const h=p.systemInstruction;delete p.systemInstruction;const w=p.request;w.systemInstruction=h,p.request=w}d.push(p)}return l.requests=d,delete o.config,delete o._url,delete o._query,{path:a,body:o}}getGcsUri(t){if(typeof t=="string")return t.startsWith("gs://")?t:void 0;if(!Array.isArray(t)&&t.gcsUri&&t.gcsUri.length>0)return t.gcsUri[0]}getBigqueryUri(t){if(typeof t=="string")return t.startsWith("bq://")?t:void 0;if(!Array.isArray(t))return t.bigqueryUri}formatDestination(t,o){const r=o?Object.assign({},o):{},a=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${a}`),r.dest===void 0){const i=this.getGcsUri(t),s=this.getBigqueryUri(t);if(i)i.endsWith(".jsonl")?r.dest=`${i.slice(0,-6)}/dest`:r.dest=`${i}_dest_${a}`;else if(s)r.dest=`${s}_dest_${a}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=R5(this.apiClient,t);return l=it("batchPredictionJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>uu(u))}else{const d=xg(this.apiClient,t);return l=it("{model}:batchGenerateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>Gs(u))}}async createEmbeddingsInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=D5(this.apiClient,t);return i=it("{model}:asyncBatchEmbedContent",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>Gs(c))}}async get(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=Y5(this.apiClient,t);return l=it("batchPredictionJobs/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>uu(u))}else{const d=J5(this.apiClient,t);return l=it("batches/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>Gs(u))}}async cancel(t){var o,r,a,i;let s="",l={};if(this.apiClient.isVertexAI()){const c=j5(this.apiClient,t);s=it("batchPredictionJobs/{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal})}else{const c=P5(this.apiClient,t);s=it("batches/{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=ak(t);return l=it("batchPredictionJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=sk(u),h=new hg;return Object.assign(h,p),h})}else{const d=rk(t);return l=it("batches",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=ik(u),h=new hg;return Object.assign(h,p),h})}}async delete(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=q5(this.apiClient,t);return l=it("batchPredictionJobs/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>F5(u))}else{const d=z5(this.apiClient,t);return l=it("batches/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>O5(u))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function hk(e){const t={},o=f(e,["data"]);if(o!=null&&C(t,["data"],o),f(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=f(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function yg(e){const t={},o=f(e,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(i=>Dk(i))),C(t,["parts"],a)}const r=f(e,["role"]);return r!=null&&C(t,["role"],r),t}function mk(e,t){const o={},r=f(e,["ttl"]);t!==void 0&&r!=null&&C(t,["ttl"],r);const a=f(e,["expireTime"]);t!==void 0&&a!=null&&C(t,["expireTime"],a);const i=f(e,["displayName"]);t!==void 0&&i!=null&&C(t,["displayName"],i);const s=f(e,["contents"]);if(t!==void 0&&s!=null){let u=io(s);Array.isArray(u)&&(u=u.map(p=>yg(p))),C(t,["contents"],u)}const l=f(e,["systemInstruction"]);t!==void 0&&l!=null&&C(t,["systemInstruction"],yg(Pn(l)));const c=f(e,["tools"]);if(t!==void 0&&c!=null){let u=c;Array.isArray(u)&&(u=u.map(p=>qk(p))),C(t,["tools"],u)}const d=f(e,["toolConfig"]);if(t!==void 0&&d!=null&&C(t,["toolConfig"],zk(d)),f(e,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return o}function gk(e,t){const o={},r=f(e,["ttl"]);t!==void 0&&r!=null&&C(t,["ttl"],r);const a=f(e,["expireTime"]);t!==void 0&&a!=null&&C(t,["expireTime"],a);const i=f(e,["displayName"]);t!==void 0&&i!=null&&C(t,["displayName"],i);const s=f(e,["contents"]);if(t!==void 0&&s!=null){let p=io(s);Array.isArray(p)&&(p=p.map(h=>h)),C(t,["contents"],p)}const l=f(e,["systemInstruction"]);t!==void 0&&l!=null&&C(t,["systemInstruction"],Pn(l));const c=f(e,["tools"]);if(t!==void 0&&c!=null){let p=c;Array.isArray(p)&&(p=p.map(h=>Ok(h))),C(t,["tools"],p)}const d=f(e,["toolConfig"]);t!==void 0&&d!=null&&C(t,["toolConfig"],d);const u=f(e,["kmsKeyName"]);return t!==void 0&&u!=null&&C(t,["encryption_spec","kmsKeyName"],u),o}function fk(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["model"],Vx(e,r));const a=f(t,["config"]);return a!=null&&mk(a,o),o}function xk(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["model"],Vx(e,r));const a=f(t,["config"]);return a!=null&&gk(a,o),o}function yk(e,t){const o={},r=f(t,["name"]);return r!=null&&C(o,["_url","name"],Yo(e,r)),o}function vk(e,t){const o={},r=f(t,["name"]);return r!=null&&C(o,["_url","name"],Yo(e,r)),o}function wk(e){const t={},o=f(e,["sdkHttpResponse"]);return o!=null&&C(t,["sdkHttpResponse"],o),t}function bk(e){const t={},o=f(e,["sdkHttpResponse"]);return o!=null&&C(t,["sdkHttpResponse"],o),t}function Ck(e){const t={};if(f(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=f(e,["fileUri"]);o!=null&&C(t,["fileUri"],o);const r=f(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function kk(e){const t={},o=f(e,["id"]);o!=null&&C(t,["id"],o);const r=f(e,["args"]);r!=null&&C(t,["args"],r);const a=f(e,["name"]);if(a!=null&&C(t,["name"],a),f(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function _k(e){const t={},o=f(e,["mode"]);o!=null&&C(t,["mode"],o);const r=f(e,["allowedFunctionNames"]);if(r!=null&&C(t,["allowedFunctionNames"],r),f(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function Sk(e){const t={};if(f(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const o=f(e,["description"]);o!=null&&C(t,["description"],o);const r=f(e,["name"]);r!=null&&C(t,["name"],r);const a=f(e,["parameters"]);a!=null&&C(t,["parameters"],a);const i=f(e,["parametersJsonSchema"]);i!=null&&C(t,["parametersJsonSchema"],i);const s=f(e,["response"]);s!=null&&C(t,["response"],s);const l=f(e,["responseJsonSchema"]);return l!=null&&C(t,["responseJsonSchema"],l),t}function Nk(e,t){const o={},r=f(t,["name"]);return r!=null&&C(o,["_url","name"],Yo(e,r)),o}function Ek(e,t){const o={},r=f(t,["name"]);return r!=null&&C(o,["_url","name"],Yo(e,r)),o}function Pk(e){const t={};if(f(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const o=f(e,["enableWidget"]);return o!=null&&C(t,["enableWidget"],o),t}function jk(e){const t={};if(f(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const o=f(e,["timeRangeFilter"]);return o!=null&&C(t,["timeRangeFilter"],o),t}function Tk(e,t){const o={},r=f(e,["pageSize"]);t!==void 0&&r!=null&&C(t,["_query","pageSize"],r);const a=f(e,["pageToken"]);return t!==void 0&&a!=null&&C(t,["_query","pageToken"],a),o}function Ik(e,t){const o={},r=f(e,["pageSize"]);t!==void 0&&r!=null&&C(t,["_query","pageSize"],r);const a=f(e,["pageToken"]);return t!==void 0&&a!=null&&C(t,["_query","pageToken"],a),o}function Ak(e){const t={},o=f(e,["config"]);return o!=null&&Tk(o,t),t}function Mk(e){const t={},o=f(e,["config"]);return o!=null&&Ik(o,t),t}function Rk(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["nextPageToken"]);r!=null&&C(t,["nextPageToken"],r);const a=f(e,["cachedContents"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),C(t,["cachedContents"],i)}return t}function Lk(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["nextPageToken"]);r!=null&&C(t,["nextPageToken"],r);const a=f(e,["cachedContents"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),C(t,["cachedContents"],i)}return t}function Dk(e){const t={},o=f(e,["mediaResolution"]);o!=null&&C(t,["mediaResolution"],o);const r=f(e,["codeExecutionResult"]);r!=null&&C(t,["codeExecutionResult"],r);const a=f(e,["executableCode"]);a!=null&&C(t,["executableCode"],a);const i=f(e,["fileData"]);i!=null&&C(t,["fileData"],Ck(i));const s=f(e,["functionCall"]);s!=null&&C(t,["functionCall"],kk(s));const l=f(e,["functionResponse"]);l!=null&&C(t,["functionResponse"],l);const c=f(e,["inlineData"]);c!=null&&C(t,["inlineData"],hk(c));const d=f(e,["text"]);d!=null&&C(t,["text"],d);const u=f(e,["thought"]);u!=null&&C(t,["thought"],u);const p=f(e,["thoughtSignature"]);p!=null&&C(t,["thoughtSignature"],p);const h=f(e,["videoMetadata"]);return h!=null&&C(t,["videoMetadata"],h),t}function zk(e){const t={},o=f(e,["functionCallingConfig"]);o!=null&&C(t,["functionCallingConfig"],_k(o));const r=f(e,["retrievalConfig"]);return r!=null&&C(t,["retrievalConfig"],r),t}function qk(e){const t={},o=f(e,["functionDeclarations"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(p=>p)),C(t,["functionDeclarations"],u)}if(f(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=f(e,["googleSearchRetrieval"]);r!=null&&C(t,["googleSearchRetrieval"],r);const a=f(e,["computerUse"]);a!=null&&C(t,["computerUse"],a);const i=f(e,["fileSearch"]);i!=null&&C(t,["fileSearch"],i);const s=f(e,["codeExecution"]);if(s!=null&&C(t,["codeExecution"],s),f(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=f(e,["googleMaps"]);l!=null&&C(t,["googleMaps"],Pk(l));const c=f(e,["googleSearch"]);c!=null&&C(t,["googleSearch"],jk(c));const d=f(e,["urlContext"]);return d!=null&&C(t,["urlContext"],d),t}function Ok(e){const t={},o=f(e,["functionDeclarations"]);if(o!=null){let p=o;Array.isArray(p)&&(p=p.map(h=>Sk(h))),C(t,["functionDeclarations"],p)}const r=f(e,["retrieval"]);r!=null&&C(t,["retrieval"],r);const a=f(e,["googleSearchRetrieval"]);a!=null&&C(t,["googleSearchRetrieval"],a);const i=f(e,["computerUse"]);if(i!=null&&C(t,["computerUse"],i),f(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=f(e,["codeExecution"]);s!=null&&C(t,["codeExecution"],s);const l=f(e,["enterpriseWebSearch"]);l!=null&&C(t,["enterpriseWebSearch"],l);const c=f(e,["googleMaps"]);c!=null&&C(t,["googleMaps"],c);const d=f(e,["googleSearch"]);d!=null&&C(t,["googleSearch"],d);const u=f(e,["urlContext"]);return u!=null&&C(t,["urlContext"],u),t}function Fk(e,t){const o={},r=f(e,["ttl"]);t!==void 0&&r!=null&&C(t,["ttl"],r);const a=f(e,["expireTime"]);return t!==void 0&&a!=null&&C(t,["expireTime"],a),o}function Bk(e,t){const o={},r=f(e,["ttl"]);t!==void 0&&r!=null&&C(t,["ttl"],r);const a=f(e,["expireTime"]);return t!==void 0&&a!=null&&C(t,["expireTime"],a),o}function Hk(e,t){const o={},r=f(t,["name"]);r!=null&&C(o,["_url","name"],Yo(e,r));const a=f(t,["config"]);return a!=null&&Fk(a,o),o}function Gk(e,t){const o={},r=f(t,["name"]);r!=null&&C(o,["_url","name"],Yo(e,r));const a=f(t,["config"]);return a!=null&&Bk(a,o),o}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Uk extends Jo{constructor(t){super(),this.apiClient=t,this.list=async(o={})=>new Wr($o.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(o),o)}async create(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=xk(this.apiClient,t);return l=it("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>u)}else{const d=fk(this.apiClient,t);return l=it("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>u)}}async get(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=Ek(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>u)}else{const d=Nk(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>u)}}async delete(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=vk(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=bk(u),h=new ug;return Object.assign(h,p),h})}else{const d=yk(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=wk(u),h=new ug;return Object.assign(h,p),h})}}async update(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=Gk(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>u)}else{const d=Hk(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>u)}}async listInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=Mk(t);return l=it("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=Lk(u),h=new pg;return Object.assign(h,p),h})}else{const d=Ak(t);return l=it("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=Rk(u),h=new pg;return Object.assign(h,p),h})}}}function Cl(e,t){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(o[r[a]]=e[r[a]]);return o}function vg(e){var t=typeof Symbol=="function"&&Symbol.iterator,o=t&&e[t],r=0;if(o)return o.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Et(e){return this instanceof Et?(this.v=e,this):new Et(e)}function vo(e,t,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=o.apply(e,t||[]),a,i=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",s),a[Symbol.asyncIterator]=function(){return this},a;function s(w){return function(k){return Promise.resolve(k).then(w,p)}}function l(w,k){r[w]&&(a[w]=function(b){return new Promise(function(y,g){i.push([w,b,y,g])>1||c(w,b)})},k&&(a[w]=k(a[w])))}function c(w,k){try{d(r[w](k))}catch(b){h(i[0][3],b)}}function d(w){w.value instanceof Et?Promise.resolve(w.value.v).then(u,p):h(i[0][2],w)}function u(w){c("next",w)}function p(w){c("throw",w)}function h(w,k){w(k),i.shift(),i.length&&c(i[0][0],i[0][1])}}function wo(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],o;return t?t.call(e):(e=typeof vg=="function"?vg(e):e[Symbol.iterator](),o={},r("next"),r("throw"),r("return"),o[Symbol.asyncIterator]=function(){return this},o);function r(i){o[i]=e[i]&&function(s){return new Promise(function(l,c){s=e[i](s),a(l,c,s.done,s.value)})}}function a(i,s,l,c){Promise.resolve(c).then(function(d){i({value:d,done:l})},s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Vk(e){var t;if(e.candidates==null||e.candidates.length===0)return!1;const o=(t=e.candidates[0])===null||t===void 0?void 0:t.content;return o===void 0?!1:r1(o)}function r1(e){if(e.parts===void 0||e.parts.length===0)return!1;for(const t of e.parts)if(t===void 0||Object.keys(t).length===0)return!1;return!0}function Wk(e){if(e.length!==0){for(const t of e)if(t.role!=="user"&&t.role!=="model")throw new Error(`Role must be user or model, but got ${t.role}.`)}}function wg(e){if(e===void 0||e.length===0)return[];const t=[],o=e.length;let r=0;for(;r<o;)if(e[r].role==="user")t.push(e[r]),r++;else{const a=[];let i=!0;for(;r<o&&e[r].role==="model";)a.push(e[r]),i&&!r1(e[r])&&(i=!1),r++;i?t.push(...a):t.pop()}return t}class $k{constructor(t,o){this.modelsModule=t,this.apiClient=o}create(t){return new Kk(this.apiClient,this.modelsModule,t.model,t.config,structuredClone(t.history))}}class Kk{constructor(t,o,r,a={},i=[]){this.apiClient=t,this.modelsModule=o,this.model=r,this.config=a,this.history=i,this.sendPromise=Promise.resolve(),Wk(i)}async sendMessage(t){var o;await this.sendPromise;const r=Pn(t.message),a=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(o=t.config)!==null&&o!==void 0?o:this.config});return this.sendPromise=(async()=>{var i,s,l;const c=await a,d=(s=(i=c.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content,u=c.automaticFunctionCallingHistory,p=this.getHistory(!0).length;let h=[];u!=null&&(h=(l=u.slice(p))!==null&&l!==void 0?l:[]);const w=d?[d]:[];this.recordHistory(r,w,h)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),a}async sendMessageStream(t){var o;await this.sendPromise;const r=Pn(t.message),a=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(o=t.config)!==null&&o!==void 0?o:this.config});this.sendPromise=a.then(()=>{}).catch(()=>{});const i=await a;return this.processStreamResponse(i,r)}getHistory(t=!1){const o=t?wg(this.history):this.history;return structuredClone(o)}processStreamResponse(t,o){return vo(this,arguments,function*(){var a,i,s,l,c,d;const u=[];try{for(var p=!0,h=wo(t),w;w=yield Et(h.next()),a=w.done,!a;p=!0){l=w.value,p=!1;const k=l;if(Vk(k)){const b=(d=(c=k.candidates)===null||c===void 0?void 0:c[0])===null||d===void 0?void 0:d.content;b!==void 0&&u.push(b)}yield yield Et(k)}}catch(k){i={error:k}}finally{try{!p&&!a&&(s=h.return)&&(yield Et(s.call(h)))}finally{if(i)throw i.error}}this.recordHistory(o,u)})}recordHistory(t,o,r){let a=[];o.length>0&&o.every(i=>i.role!==void 0)?a=o:a.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...wg(r)):this.history.push(t),this.history.push(...a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Wl extends Error{constructor(t){super(t.message),this.name="ApiError",this.status=t.status,Object.setPrototypeOf(this,Wl.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Jk(e){const t={},o=f(e,["file"]);return o!=null&&C(t,["file"],o),t}function Yk(e){const t={},o=f(e,["sdkHttpResponse"]);return o!=null&&C(t,["sdkHttpResponse"],o),t}function Zk(e){const t={},o=f(e,["name"]);return o!=null&&C(t,["_url","file"],Zx(o)),t}function Xk(e){const t={},o=f(e,["sdkHttpResponse"]);return o!=null&&C(t,["sdkHttpResponse"],o),t}function Qk(e){const t={},o=f(e,["name"]);return o!=null&&C(t,["_url","file"],Zx(o)),t}function e4(e,t){const o={},r=f(e,["pageSize"]);t!==void 0&&r!=null&&C(t,["_query","pageSize"],r);const a=f(e,["pageToken"]);return t!==void 0&&a!=null&&C(t,["_query","pageToken"],a),o}function t4(e){const t={},o=f(e,["config"]);return o!=null&&e4(o,t),t}function n4(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["nextPageToken"]);r!=null&&C(t,["nextPageToken"],r);const a=f(e,["files"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),C(t,["files"],i)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class o4 extends Jo{constructor(t){super(),this.apiClient=t,this.list=async(o={})=>new Wr($o.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(o),o)}async upload(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(t.file,t.config).then(o=>o)}async download(t){await this.apiClient.downloadFile(t)}async listInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=t4(t);return i=it("files",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>{const d=n4(c),u=new s5;return Object.assign(u,d),u})}}async createInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=Jk(t);return i=it("upload/v1beta/files",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=Yk(c),u=new l5;return Object.assign(u,d),u})}}async get(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=Qk(t);return i=it("files/{file}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async delete(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=Zk(t);return i=it("files/{file}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>{const d=Xk(c),u=new c5;return Object.assign(u,d),u})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Us(e){const t={},o=f(e,["data"]);if(o!=null&&C(t,["data"],o),f(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=f(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function r4(e){const t={},o=f(e,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(i=>w4(i))),C(t,["parts"],a)}const r=f(e,["role"]);return r!=null&&C(t,["role"],r),t}function a4(e){const t={};if(f(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=f(e,["fileUri"]);o!=null&&C(t,["fileUri"],o);const r=f(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function i4(e){const t={},o=f(e,["id"]);o!=null&&C(t,["id"],o);const r=f(e,["args"]);r!=null&&C(t,["args"],r);const a=f(e,["name"]);if(a!=null&&C(t,["name"],a),f(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function s4(e){const t={};if(f(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const o=f(e,["description"]);o!=null&&C(t,["description"],o);const r=f(e,["name"]);r!=null&&C(t,["name"],r);const a=f(e,["parameters"]);a!=null&&C(t,["parameters"],a);const i=f(e,["parametersJsonSchema"]);i!=null&&C(t,["parametersJsonSchema"],i);const s=f(e,["response"]);s!=null&&C(t,["response"],s);const l=f(e,["responseJsonSchema"]);return l!=null&&C(t,["responseJsonSchema"],l),t}function l4(e){const t={},o=f(e,["modelSelectionConfig"]);o!=null&&C(t,["modelConfig"],o);const r=f(e,["responseJsonSchema"]);r!=null&&C(t,["responseJsonSchema"],r);const a=f(e,["audioTimestamp"]);a!=null&&C(t,["audioTimestamp"],a);const i=f(e,["candidateCount"]);i!=null&&C(t,["candidateCount"],i);const s=f(e,["enableAffectiveDialog"]);s!=null&&C(t,["enableAffectiveDialog"],s);const l=f(e,["frequencyPenalty"]);l!=null&&C(t,["frequencyPenalty"],l);const c=f(e,["logprobs"]);c!=null&&C(t,["logprobs"],c);const d=f(e,["maxOutputTokens"]);d!=null&&C(t,["maxOutputTokens"],d);const u=f(e,["mediaResolution"]);u!=null&&C(t,["mediaResolution"],u);const p=f(e,["presencePenalty"]);p!=null&&C(t,["presencePenalty"],p);const h=f(e,["responseLogprobs"]);h!=null&&C(t,["responseLogprobs"],h);const w=f(e,["responseMimeType"]);w!=null&&C(t,["responseMimeType"],w);const k=f(e,["responseModalities"]);k!=null&&C(t,["responseModalities"],k);const b=f(e,["responseSchema"]);b!=null&&C(t,["responseSchema"],b);const y=f(e,["routingConfig"]);y!=null&&C(t,["routingConfig"],y);const g=f(e,["seed"]);g!=null&&C(t,["seed"],g);const m=f(e,["speechConfig"]);m!=null&&C(t,["speechConfig"],m);const x=f(e,["stopSequences"]);x!=null&&C(t,["stopSequences"],x);const _=f(e,["temperature"]);_!=null&&C(t,["temperature"],_);const S=f(e,["thinkingConfig"]);S!=null&&C(t,["thinkingConfig"],S);const P=f(e,["topK"]);P!=null&&C(t,["topK"],P);const j=f(e,["topP"]);if(j!=null&&C(t,["topP"],j),f(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function c4(e){const t={};if(f(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const o=f(e,["enableWidget"]);return o!=null&&C(t,["enableWidget"],o),t}function d4(e){const t={};if(f(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const o=f(e,["timeRangeFilter"]);return o!=null&&C(t,["timeRangeFilter"],o),t}function u4(e,t){const o={},r=f(e,["generationConfig"]);t!==void 0&&r!=null&&C(t,["setup","generationConfig"],r);const a=f(e,["responseModalities"]);t!==void 0&&a!=null&&C(t,["setup","generationConfig","responseModalities"],a);const i=f(e,["temperature"]);t!==void 0&&i!=null&&C(t,["setup","generationConfig","temperature"],i);const s=f(e,["topP"]);t!==void 0&&s!=null&&C(t,["setup","generationConfig","topP"],s);const l=f(e,["topK"]);t!==void 0&&l!=null&&C(t,["setup","generationConfig","topK"],l);const c=f(e,["maxOutputTokens"]);t!==void 0&&c!=null&&C(t,["setup","generationConfig","maxOutputTokens"],c);const d=f(e,["mediaResolution"]);t!==void 0&&d!=null&&C(t,["setup","generationConfig","mediaResolution"],d);const u=f(e,["seed"]);t!==void 0&&u!=null&&C(t,["setup","generationConfig","seed"],u);const p=f(e,["speechConfig"]);t!==void 0&&p!=null&&C(t,["setup","generationConfig","speechConfig"],Tp(p));const h=f(e,["thinkingConfig"]);t!==void 0&&h!=null&&C(t,["setup","generationConfig","thinkingConfig"],h);const w=f(e,["enableAffectiveDialog"]);t!==void 0&&w!=null&&C(t,["setup","generationConfig","enableAffectiveDialog"],w);const k=f(e,["systemInstruction"]);t!==void 0&&k!=null&&C(t,["setup","systemInstruction"],r4(Pn(k)));const b=f(e,["tools"]);if(t!==void 0&&b!=null){let P=Ga(b);Array.isArray(P)&&(P=P.map(j=>C4(Ha(j)))),C(t,["setup","tools"],P)}const y=f(e,["sessionResumption"]);t!==void 0&&y!=null&&C(t,["setup","sessionResumption"],b4(y));const g=f(e,["inputAudioTranscription"]);t!==void 0&&g!=null&&C(t,["setup","inputAudioTranscription"],g);const m=f(e,["outputAudioTranscription"]);t!==void 0&&m!=null&&C(t,["setup","outputAudioTranscription"],m);const x=f(e,["realtimeInputConfig"]);t!==void 0&&x!=null&&C(t,["setup","realtimeInputConfig"],x);const _=f(e,["contextWindowCompression"]);t!==void 0&&_!=null&&C(t,["setup","contextWindowCompression"],_);const S=f(e,["proactivity"]);if(t!==void 0&&S!=null&&C(t,["setup","proactivity"],S),f(e,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return o}function p4(e,t){const o={},r=f(e,["generationConfig"]);t!==void 0&&r!=null&&C(t,["setup","generationConfig"],l4(r));const a=f(e,["responseModalities"]);t!==void 0&&a!=null&&C(t,["setup","generationConfig","responseModalities"],a);const i=f(e,["temperature"]);t!==void 0&&i!=null&&C(t,["setup","generationConfig","temperature"],i);const s=f(e,["topP"]);t!==void 0&&s!=null&&C(t,["setup","generationConfig","topP"],s);const l=f(e,["topK"]);t!==void 0&&l!=null&&C(t,["setup","generationConfig","topK"],l);const c=f(e,["maxOutputTokens"]);t!==void 0&&c!=null&&C(t,["setup","generationConfig","maxOutputTokens"],c);const d=f(e,["mediaResolution"]);t!==void 0&&d!=null&&C(t,["setup","generationConfig","mediaResolution"],d);const u=f(e,["seed"]);t!==void 0&&u!=null&&C(t,["setup","generationConfig","seed"],u);const p=f(e,["speechConfig"]);t!==void 0&&p!=null&&C(t,["setup","generationConfig","speechConfig"],Tp(p));const h=f(e,["thinkingConfig"]);t!==void 0&&h!=null&&C(t,["setup","generationConfig","thinkingConfig"],h);const w=f(e,["enableAffectiveDialog"]);t!==void 0&&w!=null&&C(t,["setup","generationConfig","enableAffectiveDialog"],w);const k=f(e,["systemInstruction"]);t!==void 0&&k!=null&&C(t,["setup","systemInstruction"],Pn(k));const b=f(e,["tools"]);if(t!==void 0&&b!=null){let j=Ga(b);Array.isArray(j)&&(j=j.map(M=>k4(Ha(M)))),C(t,["setup","tools"],j)}const y=f(e,["sessionResumption"]);t!==void 0&&y!=null&&C(t,["setup","sessionResumption"],y);const g=f(e,["inputAudioTranscription"]);t!==void 0&&g!=null&&C(t,["setup","inputAudioTranscription"],g);const m=f(e,["outputAudioTranscription"]);t!==void 0&&m!=null&&C(t,["setup","outputAudioTranscription"],m);const x=f(e,["realtimeInputConfig"]);t!==void 0&&x!=null&&C(t,["setup","realtimeInputConfig"],x);const _=f(e,["contextWindowCompression"]);t!==void 0&&_!=null&&C(t,["setup","contextWindowCompression"],_);const S=f(e,["proactivity"]);t!==void 0&&S!=null&&C(t,["setup","proactivity"],S);const P=f(e,["explicitVadSignal"]);return t!==void 0&&P!=null&&C(t,["setup","explicitVadSignal"],P),o}function h4(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["setup","model"],zt(e,r));const a=f(t,["config"]);return a!=null&&C(o,["config"],u4(a,o)),o}function m4(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["setup","model"],zt(e,r));const a=f(t,["config"]);return a!=null&&C(o,["config"],p4(a,o)),o}function g4(e){const t={},o=f(e,["musicGenerationConfig"]);return o!=null&&C(t,["musicGenerationConfig"],o),t}function f4(e){const t={},o=f(e,["weightedPrompts"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>a)),C(t,["weightedPrompts"],r)}return t}function x4(e){const t={},o=f(e,["media"]);if(o!=null){let d=Wx(o);Array.isArray(d)&&(d=d.map(u=>Us(u))),C(t,["mediaChunks"],d)}const r=f(e,["audio"]);r!=null&&C(t,["audio"],Us(Kx(r)));const a=f(e,["audioStreamEnd"]);a!=null&&C(t,["audioStreamEnd"],a);const i=f(e,["video"]);i!=null&&C(t,["video"],Us($x(i)));const s=f(e,["text"]);s!=null&&C(t,["text"],s);const l=f(e,["activityStart"]);l!=null&&C(t,["activityStart"],l);const c=f(e,["activityEnd"]);return c!=null&&C(t,["activityEnd"],c),t}function y4(e){const t={},o=f(e,["media"]);if(o!=null){let d=Wx(o);Array.isArray(d)&&(d=d.map(u=>u)),C(t,["mediaChunks"],d)}const r=f(e,["audio"]);r!=null&&C(t,["audio"],Kx(r));const a=f(e,["audioStreamEnd"]);a!=null&&C(t,["audioStreamEnd"],a);const i=f(e,["video"]);i!=null&&C(t,["video"],$x(i));const s=f(e,["text"]);s!=null&&C(t,["text"],s);const l=f(e,["activityStart"]);l!=null&&C(t,["activityStart"],l);const c=f(e,["activityEnd"]);return c!=null&&C(t,["activityEnd"],c),t}function v4(e){const t={},o=f(e,["setupComplete"]);o!=null&&C(t,["setupComplete"],o);const r=f(e,["serverContent"]);r!=null&&C(t,["serverContent"],r);const a=f(e,["toolCall"]);a!=null&&C(t,["toolCall"],a);const i=f(e,["toolCallCancellation"]);i!=null&&C(t,["toolCallCancellation"],i);const s=f(e,["usageMetadata"]);s!=null&&C(t,["usageMetadata"],_4(s));const l=f(e,["goAway"]);l!=null&&C(t,["goAway"],l);const c=f(e,["sessionResumptionUpdate"]);c!=null&&C(t,["sessionResumptionUpdate"],c);const d=f(e,["voiceActivityDetectionSignal"]);return d!=null&&C(t,["voiceActivityDetectionSignal"],d),t}function w4(e){const t={},o=f(e,["mediaResolution"]);o!=null&&C(t,["mediaResolution"],o);const r=f(e,["codeExecutionResult"]);r!=null&&C(t,["codeExecutionResult"],r);const a=f(e,["executableCode"]);a!=null&&C(t,["executableCode"],a);const i=f(e,["fileData"]);i!=null&&C(t,["fileData"],a4(i));const s=f(e,["functionCall"]);s!=null&&C(t,["functionCall"],i4(s));const l=f(e,["functionResponse"]);l!=null&&C(t,["functionResponse"],l);const c=f(e,["inlineData"]);c!=null&&C(t,["inlineData"],Us(c));const d=f(e,["text"]);d!=null&&C(t,["text"],d);const u=f(e,["thought"]);u!=null&&C(t,["thought"],u);const p=f(e,["thoughtSignature"]);p!=null&&C(t,["thoughtSignature"],p);const h=f(e,["videoMetadata"]);return h!=null&&C(t,["videoMetadata"],h),t}function b4(e){const t={},o=f(e,["handle"]);if(o!=null&&C(t,["handle"],o),f(e,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function C4(e){const t={},o=f(e,["functionDeclarations"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(p=>p)),C(t,["functionDeclarations"],u)}if(f(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=f(e,["googleSearchRetrieval"]);r!=null&&C(t,["googleSearchRetrieval"],r);const a=f(e,["computerUse"]);a!=null&&C(t,["computerUse"],a);const i=f(e,["fileSearch"]);i!=null&&C(t,["fileSearch"],i);const s=f(e,["codeExecution"]);if(s!=null&&C(t,["codeExecution"],s),f(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=f(e,["googleMaps"]);l!=null&&C(t,["googleMaps"],c4(l));const c=f(e,["googleSearch"]);c!=null&&C(t,["googleSearch"],d4(c));const d=f(e,["urlContext"]);return d!=null&&C(t,["urlContext"],d),t}function k4(e){const t={},o=f(e,["functionDeclarations"]);if(o!=null){let p=o;Array.isArray(p)&&(p=p.map(h=>s4(h))),C(t,["functionDeclarations"],p)}const r=f(e,["retrieval"]);r!=null&&C(t,["retrieval"],r);const a=f(e,["googleSearchRetrieval"]);a!=null&&C(t,["googleSearchRetrieval"],a);const i=f(e,["computerUse"]);if(i!=null&&C(t,["computerUse"],i),f(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=f(e,["codeExecution"]);s!=null&&C(t,["codeExecution"],s);const l=f(e,["enterpriseWebSearch"]);l!=null&&C(t,["enterpriseWebSearch"],l);const c=f(e,["googleMaps"]);c!=null&&C(t,["googleMaps"],c);const d=f(e,["googleSearch"]);d!=null&&C(t,["googleSearch"],d);const u=f(e,["urlContext"]);return u!=null&&C(t,["urlContext"],u),t}function _4(e){const t={},o=f(e,["promptTokenCount"]);o!=null&&C(t,["promptTokenCount"],o);const r=f(e,["cachedContentTokenCount"]);r!=null&&C(t,["cachedContentTokenCount"],r);const a=f(e,["candidatesTokenCount"]);a!=null&&C(t,["responseTokenCount"],a);const i=f(e,["toolUsePromptTokenCount"]);i!=null&&C(t,["toolUsePromptTokenCount"],i);const s=f(e,["thoughtsTokenCount"]);s!=null&&C(t,["thoughtsTokenCount"],s);const l=f(e,["totalTokenCount"]);l!=null&&C(t,["totalTokenCount"],l);const c=f(e,["promptTokensDetails"]);if(c!=null){let w=c;Array.isArray(w)&&(w=w.map(k=>k)),C(t,["promptTokensDetails"],w)}const d=f(e,["cacheTokensDetails"]);if(d!=null){let w=d;Array.isArray(w)&&(w=w.map(k=>k)),C(t,["cacheTokensDetails"],w)}const u=f(e,["candidatesTokensDetails"]);if(u!=null){let w=u;Array.isArray(w)&&(w=w.map(k=>k)),C(t,["responseTokensDetails"],w)}const p=f(e,["toolUsePromptTokensDetails"]);if(p!=null){let w=p;Array.isArray(w)&&(w=w.map(k=>k)),C(t,["toolUsePromptTokensDetails"],w)}const h=f(e,["trafficType"]);return h!=null&&C(t,["trafficType"],h),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function S4(e){const t={},o=f(e,["data"]);if(o!=null&&C(t,["data"],o),f(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=f(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function N4(e){const t={},o=f(e,["content"]);o!=null&&C(t,["content"],o);const r=f(e,["citationMetadata"]);r!=null&&C(t,["citationMetadata"],E4(r));const a=f(e,["tokenCount"]);a!=null&&C(t,["tokenCount"],a);const i=f(e,["finishReason"]);i!=null&&C(t,["finishReason"],i);const s=f(e,["avgLogprobs"]);s!=null&&C(t,["avgLogprobs"],s);const l=f(e,["groundingMetadata"]);l!=null&&C(t,["groundingMetadata"],l);const c=f(e,["index"]);c!=null&&C(t,["index"],c);const d=f(e,["logprobsResult"]);d!=null&&C(t,["logprobsResult"],d);const u=f(e,["safetyRatings"]);if(u!=null){let h=u;Array.isArray(h)&&(h=h.map(w=>w)),C(t,["safetyRatings"],h)}const p=f(e,["urlContextMetadata"]);return p!=null&&C(t,["urlContextMetadata"],p),t}function E4(e){const t={},o=f(e,["citationSources"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>a)),C(t,["citations"],r)}return t}function P4(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["_url","model"],zt(e,r));const a=f(t,["contents"]);if(a!=null){let i=io(a);Array.isArray(i)&&(i=i.map(s=>s)),C(o,["contents"],i)}return o}function j4(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["tokensInfo"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>i)),C(t,["tokensInfo"],a)}return t}function T4(e){const t={},o=f(e,["values"]);o!=null&&C(t,["values"],o);const r=f(e,["statistics"]);return r!=null&&C(t,["statistics"],I4(r)),t}function I4(e){const t={},o=f(e,["truncated"]);o!=null&&C(t,["truncated"],o);const r=f(e,["token_count"]);return r!=null&&C(t,["tokenCount"],r),t}function $l(e){const t={},o=f(e,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(i=>F_(i))),C(t,["parts"],a)}const r=f(e,["role"]);return r!=null&&C(t,["role"],r),t}function A4(e){const t={},o=f(e,["controlType"]);o!=null&&C(t,["controlType"],o);const r=f(e,["enableControlImageComputation"]);return r!=null&&C(t,["computeControl"],r),t}function M4(e){const t={};if(f(e,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(f(e,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(f(e,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return t}function R4(e,t){const o={},r=f(e,["systemInstruction"]);t!==void 0&&r!=null&&C(t,["systemInstruction"],Pn(r));const a=f(e,["tools"]);if(t!==void 0&&a!=null){let s=a;Array.isArray(s)&&(s=s.map(l=>l1(l))),C(t,["tools"],s)}const i=f(e,["generationConfig"]);return t!==void 0&&i!=null&&C(t,["generationConfig"],S_(i)),o}function L4(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["_url","model"],zt(e,r));const a=f(t,["contents"]);if(a!=null){let s=io(a);Array.isArray(s)&&(s=s.map(l=>$l(l))),C(o,["contents"],s)}const i=f(t,["config"]);return i!=null&&M4(i),o}function D4(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["_url","model"],zt(e,r));const a=f(t,["contents"]);if(a!=null){let s=io(a);Array.isArray(s)&&(s=s.map(l=>l)),C(o,["contents"],s)}const i=f(t,["config"]);return i!=null&&R4(i,o),o}function z4(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["totalTokens"]);r!=null&&C(t,["totalTokens"],r);const a=f(e,["cachedContentTokenCount"]);return a!=null&&C(t,["cachedContentTokenCount"],a),t}function q4(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["totalTokens"]);return r!=null&&C(t,["totalTokens"],r),t}function O4(e,t){const o={},r=f(t,["model"]);return r!=null&&C(o,["_url","name"],zt(e,r)),o}function F4(e,t){const o={},r=f(t,["model"]);return r!=null&&C(o,["_url","name"],zt(e,r)),o}function B4(e){const t={},o=f(e,["sdkHttpResponse"]);return o!=null&&C(t,["sdkHttpResponse"],o),t}function H4(e){const t={},o=f(e,["sdkHttpResponse"]);return o!=null&&C(t,["sdkHttpResponse"],o),t}function G4(e,t){const o={},r=f(e,["outputGcsUri"]);t!==void 0&&r!=null&&C(t,["parameters","storageUri"],r);const a=f(e,["negativePrompt"]);t!==void 0&&a!=null&&C(t,["parameters","negativePrompt"],a);const i=f(e,["numberOfImages"]);t!==void 0&&i!=null&&C(t,["parameters","sampleCount"],i);const s=f(e,["aspectRatio"]);t!==void 0&&s!=null&&C(t,["parameters","aspectRatio"],s);const l=f(e,["guidanceScale"]);t!==void 0&&l!=null&&C(t,["parameters","guidanceScale"],l);const c=f(e,["seed"]);t!==void 0&&c!=null&&C(t,["parameters","seed"],c);const d=f(e,["safetyFilterLevel"]);t!==void 0&&d!=null&&C(t,["parameters","safetySetting"],d);const u=f(e,["personGeneration"]);t!==void 0&&u!=null&&C(t,["parameters","personGeneration"],u);const p=f(e,["includeSafetyAttributes"]);t!==void 0&&p!=null&&C(t,["parameters","includeSafetyAttributes"],p);const h=f(e,["includeRaiReason"]);t!==void 0&&h!=null&&C(t,["parameters","includeRaiReason"],h);const w=f(e,["language"]);t!==void 0&&w!=null&&C(t,["parameters","language"],w);const k=f(e,["outputMimeType"]);t!==void 0&&k!=null&&C(t,["parameters","outputOptions","mimeType"],k);const b=f(e,["outputCompressionQuality"]);t!==void 0&&b!=null&&C(t,["parameters","outputOptions","compressionQuality"],b);const y=f(e,["addWatermark"]);t!==void 0&&y!=null&&C(t,["parameters","addWatermark"],y);const g=f(e,["labels"]);t!==void 0&&g!=null&&C(t,["labels"],g);const m=f(e,["editMode"]);t!==void 0&&m!=null&&C(t,["parameters","editMode"],m);const x=f(e,["baseSteps"]);return t!==void 0&&x!=null&&C(t,["parameters","editConfig","baseSteps"],x),o}function U4(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["_url","model"],zt(e,r));const a=f(t,["prompt"]);a!=null&&C(o,["instances[0]","prompt"],a);const i=f(t,["referenceImages"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>W_(c))),C(o,["instances[0]","referenceImages"],l)}const s=f(t,["config"]);return s!=null&&G4(s,o),o}function V4(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>Kl(i))),C(t,["generatedImages"],a)}return t}function W4(e,t){const o={},r=f(e,["taskType"]);t!==void 0&&r!=null&&C(t,["requests[]","taskType"],r);const a=f(e,["title"]);t!==void 0&&a!=null&&C(t,["requests[]","title"],a);const i=f(e,["outputDimensionality"]);if(t!==void 0&&i!=null&&C(t,["requests[]","outputDimensionality"],i),f(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(f(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return o}function $4(e,t){const o={},r=f(e,["taskType"]);t!==void 0&&r!=null&&C(t,["instances[]","task_type"],r);const a=f(e,["title"]);t!==void 0&&a!=null&&C(t,["instances[]","title"],a);const i=f(e,["outputDimensionality"]);t!==void 0&&i!=null&&C(t,["parameters","outputDimensionality"],i);const s=f(e,["mimeType"]);t!==void 0&&s!=null&&C(t,["instances[]","mimeType"],s);const l=f(e,["autoTruncate"]);return t!==void 0&&l!=null&&C(t,["parameters","autoTruncate"],l),o}function K4(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["_url","model"],zt(e,r));const a=f(t,["contents"]);if(a!=null){let l=Ep(e,a);Array.isArray(l)&&(l=l.map(c=>c)),C(o,["requests[]","content"],l)}const i=f(t,["config"]);i!=null&&W4(i,o);const s=f(t,["model"]);return s!==void 0&&C(o,["requests[]","model"],zt(e,s)),o}function J4(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["_url","model"],zt(e,r));const a=f(t,["contents"]);if(a!=null){let s=Ep(e,a);Array.isArray(s)&&(s=s.map(l=>l)),C(o,["instances[]","content"],s)}const i=f(t,["config"]);return i!=null&&$4(i,o),o}function Y4(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["embeddings"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),C(t,["embeddings"],i)}const a=f(e,["metadata"]);return a!=null&&C(t,["metadata"],a),t}function Z4(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["predictions[]","embeddings"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>T4(s))),C(t,["embeddings"],i)}const a=f(e,["metadata"]);return a!=null&&C(t,["metadata"],a),t}function X4(e){const t={},o=f(e,["endpoint"]);o!=null&&C(t,["name"],o);const r=f(e,["deployedModelId"]);return r!=null&&C(t,["deployedModelId"],r),t}function Q4(e){const t={};if(f(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=f(e,["fileUri"]);o!=null&&C(t,["fileUri"],o);const r=f(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function e_(e){const t={},o=f(e,["id"]);o!=null&&C(t,["id"],o);const r=f(e,["args"]);r!=null&&C(t,["args"],r);const a=f(e,["name"]);if(a!=null&&C(t,["name"],a),f(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function t_(e){const t={},o=f(e,["mode"]);o!=null&&C(t,["mode"],o);const r=f(e,["allowedFunctionNames"]);if(r!=null&&C(t,["allowedFunctionNames"],r),f(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function n_(e){const t={};if(f(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const o=f(e,["description"]);o!=null&&C(t,["description"],o);const r=f(e,["name"]);r!=null&&C(t,["name"],r);const a=f(e,["parameters"]);a!=null&&C(t,["parameters"],a);const i=f(e,["parametersJsonSchema"]);i!=null&&C(t,["parametersJsonSchema"],i);const s=f(e,["response"]);s!=null&&C(t,["response"],s);const l=f(e,["responseJsonSchema"]);return l!=null&&C(t,["responseJsonSchema"],l),t}function o_(e,t,o){const r={},a=f(t,["systemInstruction"]);o!==void 0&&a!=null&&C(o,["systemInstruction"],$l(Pn(a)));const i=f(t,["temperature"]);i!=null&&C(r,["temperature"],i);const s=f(t,["topP"]);s!=null&&C(r,["topP"],s);const l=f(t,["topK"]);l!=null&&C(r,["topK"],l);const c=f(t,["candidateCount"]);c!=null&&C(r,["candidateCount"],c);const d=f(t,["maxOutputTokens"]);d!=null&&C(r,["maxOutputTokens"],d);const u=f(t,["stopSequences"]);u!=null&&C(r,["stopSequences"],u);const p=f(t,["responseLogprobs"]);p!=null&&C(r,["responseLogprobs"],p);const h=f(t,["logprobs"]);h!=null&&C(r,["logprobs"],h);const w=f(t,["presencePenalty"]);w!=null&&C(r,["presencePenalty"],w);const k=f(t,["frequencyPenalty"]);k!=null&&C(r,["frequencyPenalty"],k);const b=f(t,["seed"]);b!=null&&C(r,["seed"],b);const y=f(t,["responseMimeType"]);y!=null&&C(r,["responseMimeType"],y);const g=f(t,["responseSchema"]);g!=null&&C(r,["responseSchema"],Pp(g));const m=f(t,["responseJsonSchema"]);if(m!=null&&C(r,["responseJsonSchema"],m),f(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(f(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const x=f(t,["safetySettings"]);if(o!==void 0&&x!=null){let I=x;Array.isArray(I)&&(I=I.map(N=>$_(N))),C(o,["safetySettings"],I)}const _=f(t,["tools"]);if(o!==void 0&&_!=null){let I=Ga(_);Array.isArray(I)&&(I=I.map(N=>eS(Ha(N)))),C(o,["tools"],I)}const S=f(t,["toolConfig"]);if(o!==void 0&&S!=null&&C(o,["toolConfig"],Q_(S)),f(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const P=f(t,["cachedContent"]);o!==void 0&&P!=null&&C(o,["cachedContent"],Yo(e,P));const j=f(t,["responseModalities"]);j!=null&&C(r,["responseModalities"],j);const M=f(t,["mediaResolution"]);M!=null&&C(r,["mediaResolution"],M);const D=f(t,["speechConfig"]);if(D!=null&&C(r,["speechConfig"],jp(D)),f(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const O=f(t,["thinkingConfig"]);O!=null&&C(r,["thinkingConfig"],O);const B=f(t,["imageConfig"]);B!=null&&C(r,["imageConfig"],T_(B));const E=f(t,["enableEnhancedCivicAnswers"]);return E!=null&&C(r,["enableEnhancedCivicAnswers"],E),r}function r_(e,t,o){const r={},a=f(t,["systemInstruction"]);o!==void 0&&a!=null&&C(o,["systemInstruction"],Pn(a));const i=f(t,["temperature"]);i!=null&&C(r,["temperature"],i);const s=f(t,["topP"]);s!=null&&C(r,["topP"],s);const l=f(t,["topK"]);l!=null&&C(r,["topK"],l);const c=f(t,["candidateCount"]);c!=null&&C(r,["candidateCount"],c);const d=f(t,["maxOutputTokens"]);d!=null&&C(r,["maxOutputTokens"],d);const u=f(t,["stopSequences"]);u!=null&&C(r,["stopSequences"],u);const p=f(t,["responseLogprobs"]);p!=null&&C(r,["responseLogprobs"],p);const h=f(t,["logprobs"]);h!=null&&C(r,["logprobs"],h);const w=f(t,["presencePenalty"]);w!=null&&C(r,["presencePenalty"],w);const k=f(t,["frequencyPenalty"]);k!=null&&C(r,["frequencyPenalty"],k);const b=f(t,["seed"]);b!=null&&C(r,["seed"],b);const y=f(t,["responseMimeType"]);y!=null&&C(r,["responseMimeType"],y);const g=f(t,["responseSchema"]);g!=null&&C(r,["responseSchema"],Pp(g));const m=f(t,["responseJsonSchema"]);m!=null&&C(r,["responseJsonSchema"],m);const x=f(t,["routingConfig"]);x!=null&&C(r,["routingConfig"],x);const _=f(t,["modelSelectionConfig"]);_!=null&&C(r,["modelConfig"],_);const S=f(t,["safetySettings"]);if(o!==void 0&&S!=null){let F=S;Array.isArray(F)&&(F=F.map(z=>z)),C(o,["safetySettings"],F)}const P=f(t,["tools"]);if(o!==void 0&&P!=null){let F=Ga(P);Array.isArray(F)&&(F=F.map(z=>l1(Ha(z)))),C(o,["tools"],F)}const j=f(t,["toolConfig"]);o!==void 0&&j!=null&&C(o,["toolConfig"],j);const M=f(t,["labels"]);o!==void 0&&M!=null&&C(o,["labels"],M);const D=f(t,["cachedContent"]);o!==void 0&&D!=null&&C(o,["cachedContent"],Yo(e,D));const O=f(t,["responseModalities"]);O!=null&&C(r,["responseModalities"],O);const B=f(t,["mediaResolution"]);B!=null&&C(r,["mediaResolution"],B);const E=f(t,["speechConfig"]);E!=null&&C(r,["speechConfig"],jp(E));const I=f(t,["audioTimestamp"]);I!=null&&C(r,["audioTimestamp"],I);const N=f(t,["thinkingConfig"]);N!=null&&C(r,["thinkingConfig"],N);const T=f(t,["imageConfig"]);if(T!=null&&C(r,["imageConfig"],I_(T)),f(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return r}function bg(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["_url","model"],zt(e,r));const a=f(t,["contents"]);if(a!=null){let s=io(a);Array.isArray(s)&&(s=s.map(l=>$l(l))),C(o,["contents"],s)}const i=f(t,["config"]);return i!=null&&C(o,["generationConfig"],o_(e,i,o)),o}function Cg(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["_url","model"],zt(e,r));const a=f(t,["contents"]);if(a!=null){let s=io(a);Array.isArray(s)&&(s=s.map(l=>l)),C(o,["contents"],s)}const i=f(t,["config"]);return i!=null&&C(o,["generationConfig"],r_(e,i,o)),o}function kg(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["candidates"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(d=>N4(d))),C(t,["candidates"],c)}const a=f(e,["modelVersion"]);a!=null&&C(t,["modelVersion"],a);const i=f(e,["promptFeedback"]);i!=null&&C(t,["promptFeedback"],i);const s=f(e,["responseId"]);s!=null&&C(t,["responseId"],s);const l=f(e,["usageMetadata"]);return l!=null&&C(t,["usageMetadata"],l),t}function _g(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["candidates"]);if(r!=null){let d=r;Array.isArray(d)&&(d=d.map(u=>u)),C(t,["candidates"],d)}const a=f(e,["createTime"]);a!=null&&C(t,["createTime"],a);const i=f(e,["modelVersion"]);i!=null&&C(t,["modelVersion"],i);const s=f(e,["promptFeedback"]);s!=null&&C(t,["promptFeedback"],s);const l=f(e,["responseId"]);l!=null&&C(t,["responseId"],l);const c=f(e,["usageMetadata"]);return c!=null&&C(t,["usageMetadata"],c),t}function a_(e,t){const o={};if(f(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(f(e,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const r=f(e,["numberOfImages"]);t!==void 0&&r!=null&&C(t,["parameters","sampleCount"],r);const a=f(e,["aspectRatio"]);t!==void 0&&a!=null&&C(t,["parameters","aspectRatio"],a);const i=f(e,["guidanceScale"]);if(t!==void 0&&i!=null&&C(t,["parameters","guidanceScale"],i),f(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const s=f(e,["safetyFilterLevel"]);t!==void 0&&s!=null&&C(t,["parameters","safetySetting"],s);const l=f(e,["personGeneration"]);t!==void 0&&l!=null&&C(t,["parameters","personGeneration"],l);const c=f(e,["includeSafetyAttributes"]);t!==void 0&&c!=null&&C(t,["parameters","includeSafetyAttributes"],c);const d=f(e,["includeRaiReason"]);t!==void 0&&d!=null&&C(t,["parameters","includeRaiReason"],d);const u=f(e,["language"]);t!==void 0&&u!=null&&C(t,["parameters","language"],u);const p=f(e,["outputMimeType"]);t!==void 0&&p!=null&&C(t,["parameters","outputOptions","mimeType"],p);const h=f(e,["outputCompressionQuality"]);if(t!==void 0&&h!=null&&C(t,["parameters","outputOptions","compressionQuality"],h),f(e,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(f(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const w=f(e,["imageSize"]);if(t!==void 0&&w!=null&&C(t,["parameters","sampleImageSize"],w),f(e,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return o}function i_(e,t){const o={},r=f(e,["outputGcsUri"]);t!==void 0&&r!=null&&C(t,["parameters","storageUri"],r);const a=f(e,["negativePrompt"]);t!==void 0&&a!=null&&C(t,["parameters","negativePrompt"],a);const i=f(e,["numberOfImages"]);t!==void 0&&i!=null&&C(t,["parameters","sampleCount"],i);const s=f(e,["aspectRatio"]);t!==void 0&&s!=null&&C(t,["parameters","aspectRatio"],s);const l=f(e,["guidanceScale"]);t!==void 0&&l!=null&&C(t,["parameters","guidanceScale"],l);const c=f(e,["seed"]);t!==void 0&&c!=null&&C(t,["parameters","seed"],c);const d=f(e,["safetyFilterLevel"]);t!==void 0&&d!=null&&C(t,["parameters","safetySetting"],d);const u=f(e,["personGeneration"]);t!==void 0&&u!=null&&C(t,["parameters","personGeneration"],u);const p=f(e,["includeSafetyAttributes"]);t!==void 0&&p!=null&&C(t,["parameters","includeSafetyAttributes"],p);const h=f(e,["includeRaiReason"]);t!==void 0&&h!=null&&C(t,["parameters","includeRaiReason"],h);const w=f(e,["language"]);t!==void 0&&w!=null&&C(t,["parameters","language"],w);const k=f(e,["outputMimeType"]);t!==void 0&&k!=null&&C(t,["parameters","outputOptions","mimeType"],k);const b=f(e,["outputCompressionQuality"]);t!==void 0&&b!=null&&C(t,["parameters","outputOptions","compressionQuality"],b);const y=f(e,["addWatermark"]);t!==void 0&&y!=null&&C(t,["parameters","addWatermark"],y);const g=f(e,["labels"]);t!==void 0&&g!=null&&C(t,["labels"],g);const m=f(e,["imageSize"]);t!==void 0&&m!=null&&C(t,["parameters","sampleImageSize"],m);const x=f(e,["enhancePrompt"]);return t!==void 0&&x!=null&&C(t,["parameters","enhancePrompt"],x),o}function s_(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["_url","model"],zt(e,r));const a=f(t,["prompt"]);a!=null&&C(o,["instances[0]","prompt"],a);const i=f(t,["config"]);return i!=null&&a_(i,o),o}function l_(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["_url","model"],zt(e,r));const a=f(t,["prompt"]);a!=null&&C(o,["instances[0]","prompt"],a);const i=f(t,["config"]);return i!=null&&i_(i,o),o}function c_(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>b_(s))),C(t,["generatedImages"],i)}const a=f(e,["positivePromptSafetyAttributes"]);return a!=null&&C(t,["positivePromptSafetyAttributes"],i1(a)),t}function d_(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>Kl(s))),C(t,["generatedImages"],i)}const a=f(e,["positivePromptSafetyAttributes"]);return a!=null&&C(t,["positivePromptSafetyAttributes"],s1(a)),t}function u_(e,t){const o={},r=f(e,["numberOfVideos"]);if(t!==void 0&&r!=null&&C(t,["parameters","sampleCount"],r),f(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(f(e,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const a=f(e,["durationSeconds"]);if(t!==void 0&&a!=null&&C(t,["parameters","durationSeconds"],a),f(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const i=f(e,["aspectRatio"]);t!==void 0&&i!=null&&C(t,["parameters","aspectRatio"],i);const s=f(e,["resolution"]);t!==void 0&&s!=null&&C(t,["parameters","resolution"],s);const l=f(e,["personGeneration"]);if(t!==void 0&&l!=null&&C(t,["parameters","personGeneration"],l),f(e,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const c=f(e,["negativePrompt"]);t!==void 0&&c!=null&&C(t,["parameters","negativePrompt"],c);const d=f(e,["enhancePrompt"]);if(t!==void 0&&d!=null&&C(t,["parameters","enhancePrompt"],d),f(e,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const u=f(e,["lastFrame"]);t!==void 0&&u!=null&&C(t,["instances[0]","lastFrame"],Jl(u));const p=f(e,["referenceImages"]);if(t!==void 0&&p!=null){let h=p;Array.isArray(h)&&(h=h.map(w=>hS(w))),C(t,["instances[0]","referenceImages"],h)}if(f(e,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(f(e,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return o}function p_(e,t){const o={},r=f(e,["numberOfVideos"]);t!==void 0&&r!=null&&C(t,["parameters","sampleCount"],r);const a=f(e,["outputGcsUri"]);t!==void 0&&a!=null&&C(t,["parameters","storageUri"],a);const i=f(e,["fps"]);t!==void 0&&i!=null&&C(t,["parameters","fps"],i);const s=f(e,["durationSeconds"]);t!==void 0&&s!=null&&C(t,["parameters","durationSeconds"],s);const l=f(e,["seed"]);t!==void 0&&l!=null&&C(t,["parameters","seed"],l);const c=f(e,["aspectRatio"]);t!==void 0&&c!=null&&C(t,["parameters","aspectRatio"],c);const d=f(e,["resolution"]);t!==void 0&&d!=null&&C(t,["parameters","resolution"],d);const u=f(e,["personGeneration"]);t!==void 0&&u!=null&&C(t,["parameters","personGeneration"],u);const p=f(e,["pubsubTopic"]);t!==void 0&&p!=null&&C(t,["parameters","pubsubTopic"],p);const h=f(e,["negativePrompt"]);t!==void 0&&h!=null&&C(t,["parameters","negativePrompt"],h);const w=f(e,["enhancePrompt"]);t!==void 0&&w!=null&&C(t,["parameters","enhancePrompt"],w);const k=f(e,["generateAudio"]);t!==void 0&&k!=null&&C(t,["parameters","generateAudio"],k);const b=f(e,["lastFrame"]);t!==void 0&&b!=null&&C(t,["instances[0]","lastFrame"],Co(b));const y=f(e,["referenceImages"]);if(t!==void 0&&y!=null){let x=y;Array.isArray(x)&&(x=x.map(_=>mS(_))),C(t,["instances[0]","referenceImages"],x)}const g=f(e,["mask"]);t!==void 0&&g!=null&&C(t,["instances[0]","mask"],pS(g));const m=f(e,["compressionQuality"]);return t!==void 0&&m!=null&&C(t,["parameters","compressionQuality"],m),o}function h_(e){const t={},o=f(e,["name"]);o!=null&&C(t,["name"],o);const r=f(e,["metadata"]);r!=null&&C(t,["metadata"],r);const a=f(e,["done"]);a!=null&&C(t,["done"],a);const i=f(e,["error"]);i!=null&&C(t,["error"],i);const s=f(e,["response","generateVideoResponse"]);return s!=null&&C(t,["response"],x_(s)),t}function m_(e){const t={},o=f(e,["name"]);o!=null&&C(t,["name"],o);const r=f(e,["metadata"]);r!=null&&C(t,["metadata"],r);const a=f(e,["done"]);a!=null&&C(t,["done"],a);const i=f(e,["error"]);i!=null&&C(t,["error"],i);const s=f(e,["response"]);return s!=null&&C(t,["response"],y_(s)),t}function g_(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["_url","model"],zt(e,r));const a=f(t,["prompt"]);a!=null&&C(o,["instances[0]","prompt"],a);const i=f(t,["image"]);i!=null&&C(o,["instances[0]","image"],Jl(i));const s=f(t,["video"]);s!=null&&C(o,["instances[0]","video"],c1(s));const l=f(t,["source"]);l!=null&&v_(l,o);const c=f(t,["config"]);return c!=null&&u_(c,o),o}function f_(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["_url","model"],zt(e,r));const a=f(t,["prompt"]);a!=null&&C(o,["instances[0]","prompt"],a);const i=f(t,["image"]);i!=null&&C(o,["instances[0]","image"],Co(i));const s=f(t,["video"]);s!=null&&C(o,["instances[0]","video"],d1(s));const l=f(t,["source"]);l!=null&&w_(l,o);const c=f(t,["config"]);return c!=null&&p_(c,o),o}function x_(e){const t={},o=f(e,["generatedSamples"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>k_(s))),C(t,["generatedVideos"],i)}const r=f(e,["raiMediaFilteredCount"]);r!=null&&C(t,["raiMediaFilteredCount"],r);const a=f(e,["raiMediaFilteredReasons"]);return a!=null&&C(t,["raiMediaFilteredReasons"],a),t}function y_(e){const t={},o=f(e,["videos"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>__(s))),C(t,["generatedVideos"],i)}const r=f(e,["raiMediaFilteredCount"]);r!=null&&C(t,["raiMediaFilteredCount"],r);const a=f(e,["raiMediaFilteredReasons"]);return a!=null&&C(t,["raiMediaFilteredReasons"],a),t}function v_(e,t){const o={},r=f(e,["prompt"]);t!==void 0&&r!=null&&C(t,["instances[0]","prompt"],r);const a=f(e,["image"]);t!==void 0&&a!=null&&C(t,["instances[0]","image"],Jl(a));const i=f(e,["video"]);return t!==void 0&&i!=null&&C(t,["instances[0]","video"],c1(i)),o}function w_(e,t){const o={},r=f(e,["prompt"]);t!==void 0&&r!=null&&C(t,["instances[0]","prompt"],r);const a=f(e,["image"]);t!==void 0&&a!=null&&C(t,["instances[0]","image"],Co(a));const i=f(e,["video"]);return t!==void 0&&i!=null&&C(t,["instances[0]","video"],d1(i)),o}function b_(e){const t={},o=f(e,["_self"]);o!=null&&C(t,["image"],A_(o));const r=f(e,["raiFilteredReason"]);r!=null&&C(t,["raiFilteredReason"],r);const a=f(e,["_self"]);return a!=null&&C(t,["safetyAttributes"],i1(a)),t}function Kl(e){const t={},o=f(e,["_self"]);o!=null&&C(t,["image"],a1(o));const r=f(e,["raiFilteredReason"]);r!=null&&C(t,["raiFilteredReason"],r);const a=f(e,["_self"]);a!=null&&C(t,["safetyAttributes"],s1(a));const i=f(e,["prompt"]);return i!=null&&C(t,["enhancedPrompt"],i),t}function C_(e){const t={},o=f(e,["_self"]);o!=null&&C(t,["mask"],a1(o));const r=f(e,["labels"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>i)),C(t,["labels"],a)}return t}function k_(e){const t={},o=f(e,["video"]);return o!=null&&C(t,["video"],dS(o)),t}function __(e){const t={},o=f(e,["_self"]);return o!=null&&C(t,["video"],uS(o)),t}function S_(e){const t={},o=f(e,["modelSelectionConfig"]);o!=null&&C(t,["modelConfig"],o);const r=f(e,["responseJsonSchema"]);r!=null&&C(t,["responseJsonSchema"],r);const a=f(e,["audioTimestamp"]);a!=null&&C(t,["audioTimestamp"],a);const i=f(e,["candidateCount"]);i!=null&&C(t,["candidateCount"],i);const s=f(e,["enableAffectiveDialog"]);s!=null&&C(t,["enableAffectiveDialog"],s);const l=f(e,["frequencyPenalty"]);l!=null&&C(t,["frequencyPenalty"],l);const c=f(e,["logprobs"]);c!=null&&C(t,["logprobs"],c);const d=f(e,["maxOutputTokens"]);d!=null&&C(t,["maxOutputTokens"],d);const u=f(e,["mediaResolution"]);u!=null&&C(t,["mediaResolution"],u);const p=f(e,["presencePenalty"]);p!=null&&C(t,["presencePenalty"],p);const h=f(e,["responseLogprobs"]);h!=null&&C(t,["responseLogprobs"],h);const w=f(e,["responseMimeType"]);w!=null&&C(t,["responseMimeType"],w);const k=f(e,["responseModalities"]);k!=null&&C(t,["responseModalities"],k);const b=f(e,["responseSchema"]);b!=null&&C(t,["responseSchema"],b);const y=f(e,["routingConfig"]);y!=null&&C(t,["routingConfig"],y);const g=f(e,["seed"]);g!=null&&C(t,["seed"],g);const m=f(e,["speechConfig"]);m!=null&&C(t,["speechConfig"],m);const x=f(e,["stopSequences"]);x!=null&&C(t,["stopSequences"],x);const _=f(e,["temperature"]);_!=null&&C(t,["temperature"],_);const S=f(e,["thinkingConfig"]);S!=null&&C(t,["thinkingConfig"],S);const P=f(e,["topK"]);P!=null&&C(t,["topK"],P);const j=f(e,["topP"]);if(j!=null&&C(t,["topP"],j),f(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function N_(e,t){const o={},r=f(t,["model"]);return r!=null&&C(o,["_url","name"],zt(e,r)),o}function E_(e,t){const o={},r=f(t,["model"]);return r!=null&&C(o,["_url","name"],zt(e,r)),o}function P_(e){const t={};if(f(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const o=f(e,["enableWidget"]);return o!=null&&C(t,["enableWidget"],o),t}function j_(e){const t={};if(f(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const o=f(e,["timeRangeFilter"]);return o!=null&&C(t,["timeRangeFilter"],o),t}function T_(e){const t={},o=f(e,["aspectRatio"]);o!=null&&C(t,["aspectRatio"],o);const r=f(e,["imageSize"]);if(r!=null&&C(t,["imageSize"],r),f(e,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(f(e,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function I_(e){const t={},o=f(e,["aspectRatio"]);o!=null&&C(t,["aspectRatio"],o);const r=f(e,["imageSize"]);r!=null&&C(t,["imageSize"],r);const a=f(e,["outputMimeType"]);a!=null&&C(t,["imageOutputOptions","mimeType"],a);const i=f(e,["outputCompressionQuality"]);return i!=null&&C(t,["imageOutputOptions","compressionQuality"],i),t}function A_(e){const t={},o=f(e,["bytesBase64Encoded"]);o!=null&&C(t,["imageBytes"],Nr(o));const r=f(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function a1(e){const t={},o=f(e,["gcsUri"]);o!=null&&C(t,["gcsUri"],o);const r=f(e,["bytesBase64Encoded"]);r!=null&&C(t,["imageBytes"],Nr(r));const a=f(e,["mimeType"]);return a!=null&&C(t,["mimeType"],a),t}function Jl(e){const t={};if(f(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const o=f(e,["imageBytes"]);o!=null&&C(t,["bytesBase64Encoded"],Nr(o));const r=f(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function Co(e){const t={},o=f(e,["gcsUri"]);o!=null&&C(t,["gcsUri"],o);const r=f(e,["imageBytes"]);r!=null&&C(t,["bytesBase64Encoded"],Nr(r));const a=f(e,["mimeType"]);return a!=null&&C(t,["mimeType"],a),t}function M_(e,t,o){const r={},a=f(t,["pageSize"]);o!==void 0&&a!=null&&C(o,["_query","pageSize"],a);const i=f(t,["pageToken"]);o!==void 0&&i!=null&&C(o,["_query","pageToken"],i);const s=f(t,["filter"]);o!==void 0&&s!=null&&C(o,["_query","filter"],s);const l=f(t,["queryBase"]);return o!==void 0&&l!=null&&C(o,["_url","models_url"],Xx(e,l)),r}function R_(e,t,o){const r={},a=f(t,["pageSize"]);o!==void 0&&a!=null&&C(o,["_query","pageSize"],a);const i=f(t,["pageToken"]);o!==void 0&&i!=null&&C(o,["_query","pageToken"],i);const s=f(t,["filter"]);o!==void 0&&s!=null&&C(o,["_query","filter"],s);const l=f(t,["queryBase"]);return o!==void 0&&l!=null&&C(o,["_url","models_url"],Xx(e,l)),r}function L_(e,t){const o={},r=f(t,["config"]);return r!=null&&M_(e,r,o),o}function D_(e,t){const o={},r=f(t,["config"]);return r!=null&&R_(e,r,o),o}function z_(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["nextPageToken"]);r!=null&&C(t,["nextPageToken"],r);const a=f(e,["_self"]);if(a!=null){let i=Qx(a);Array.isArray(i)&&(i=i.map(s=>pu(s))),C(t,["models"],i)}return t}function q_(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["nextPageToken"]);r!=null&&C(t,["nextPageToken"],r);const a=f(e,["_self"]);if(a!=null){let i=Qx(a);Array.isArray(i)&&(i=i.map(s=>hu(s))),C(t,["models"],i)}return t}function O_(e){const t={},o=f(e,["maskMode"]);o!=null&&C(t,["maskMode"],o);const r=f(e,["segmentationClasses"]);r!=null&&C(t,["maskClasses"],r);const a=f(e,["maskDilation"]);return a!=null&&C(t,["dilation"],a),t}function pu(e){const t={},o=f(e,["name"]);o!=null&&C(t,["name"],o);const r=f(e,["displayName"]);r!=null&&C(t,["displayName"],r);const a=f(e,["description"]);a!=null&&C(t,["description"],a);const i=f(e,["version"]);i!=null&&C(t,["version"],i);const s=f(e,["_self"]);s!=null&&C(t,["tunedModelInfo"],tS(s));const l=f(e,["inputTokenLimit"]);l!=null&&C(t,["inputTokenLimit"],l);const c=f(e,["outputTokenLimit"]);c!=null&&C(t,["outputTokenLimit"],c);const d=f(e,["supportedGenerationMethods"]);d!=null&&C(t,["supportedActions"],d);const u=f(e,["temperature"]);u!=null&&C(t,["temperature"],u);const p=f(e,["maxTemperature"]);p!=null&&C(t,["maxTemperature"],p);const h=f(e,["topP"]);h!=null&&C(t,["topP"],h);const w=f(e,["topK"]);w!=null&&C(t,["topK"],w);const k=f(e,["thinking"]);return k!=null&&C(t,["thinking"],k),t}function hu(e){const t={},o=f(e,["name"]);o!=null&&C(t,["name"],o);const r=f(e,["displayName"]);r!=null&&C(t,["displayName"],r);const a=f(e,["description"]);a!=null&&C(t,["description"],a);const i=f(e,["versionId"]);i!=null&&C(t,["version"],i);const s=f(e,["deployedModels"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(h=>X4(h))),C(t,["endpoints"],p)}const l=f(e,["labels"]);l!=null&&C(t,["labels"],l);const c=f(e,["_self"]);c!=null&&C(t,["tunedModelInfo"],nS(c));const d=f(e,["defaultCheckpointId"]);d!=null&&C(t,["defaultCheckpointId"],d);const u=f(e,["checkpoints"]);if(u!=null){let p=u;Array.isArray(p)&&(p=p.map(h=>h)),C(t,["checkpoints"],p)}return t}function F_(e){const t={},o=f(e,["mediaResolution"]);o!=null&&C(t,["mediaResolution"],o);const r=f(e,["codeExecutionResult"]);r!=null&&C(t,["codeExecutionResult"],r);const a=f(e,["executableCode"]);a!=null&&C(t,["executableCode"],a);const i=f(e,["fileData"]);i!=null&&C(t,["fileData"],Q4(i));const s=f(e,["functionCall"]);s!=null&&C(t,["functionCall"],e_(s));const l=f(e,["functionResponse"]);l!=null&&C(t,["functionResponse"],l);const c=f(e,["inlineData"]);c!=null&&C(t,["inlineData"],S4(c));const d=f(e,["text"]);d!=null&&C(t,["text"],d);const u=f(e,["thought"]);u!=null&&C(t,["thought"],u);const p=f(e,["thoughtSignature"]);p!=null&&C(t,["thoughtSignature"],p);const h=f(e,["videoMetadata"]);return h!=null&&C(t,["videoMetadata"],h),t}function B_(e){const t={},o=f(e,["productImage"]);return o!=null&&C(t,["image"],Co(o)),t}function H_(e,t){const o={},r=f(e,["numberOfImages"]);t!==void 0&&r!=null&&C(t,["parameters","sampleCount"],r);const a=f(e,["baseSteps"]);t!==void 0&&a!=null&&C(t,["parameters","baseSteps"],a);const i=f(e,["outputGcsUri"]);t!==void 0&&i!=null&&C(t,["parameters","storageUri"],i);const s=f(e,["seed"]);t!==void 0&&s!=null&&C(t,["parameters","seed"],s);const l=f(e,["safetyFilterLevel"]);t!==void 0&&l!=null&&C(t,["parameters","safetySetting"],l);const c=f(e,["personGeneration"]);t!==void 0&&c!=null&&C(t,["parameters","personGeneration"],c);const d=f(e,["addWatermark"]);t!==void 0&&d!=null&&C(t,["parameters","addWatermark"],d);const u=f(e,["outputMimeType"]);t!==void 0&&u!=null&&C(t,["parameters","outputOptions","mimeType"],u);const p=f(e,["outputCompressionQuality"]);t!==void 0&&p!=null&&C(t,["parameters","outputOptions","compressionQuality"],p);const h=f(e,["enhancePrompt"]);t!==void 0&&h!=null&&C(t,["parameters","enhancePrompt"],h);const w=f(e,["labels"]);return t!==void 0&&w!=null&&C(t,["labels"],w),o}function G_(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["_url","model"],zt(e,r));const a=f(t,["source"]);a!=null&&V_(a,o);const i=f(t,["config"]);return i!=null&&H_(i,o),o}function U_(e){const t={},o=f(e,["predictions"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>Kl(a))),C(t,["generatedImages"],r)}return t}function V_(e,t){const o={},r=f(e,["prompt"]);t!==void 0&&r!=null&&C(t,["instances[0]","prompt"],r);const a=f(e,["personImage"]);t!==void 0&&a!=null&&C(t,["instances[0]","personImage","image"],Co(a));const i=f(e,["productImages"]);if(t!==void 0&&i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>B_(l))),C(t,["instances[0]","productImages"],s)}return o}function W_(e){const t={},o=f(e,["referenceImage"]);o!=null&&C(t,["referenceImage"],Co(o));const r=f(e,["referenceId"]);r!=null&&C(t,["referenceId"],r);const a=f(e,["referenceType"]);a!=null&&C(t,["referenceType"],a);const i=f(e,["maskImageConfig"]);i!=null&&C(t,["maskImageConfig"],O_(i));const s=f(e,["controlImageConfig"]);s!=null&&C(t,["controlImageConfig"],A4(s));const l=f(e,["styleImageConfig"]);l!=null&&C(t,["styleImageConfig"],l);const c=f(e,["subjectImageConfig"]);return c!=null&&C(t,["subjectImageConfig"],c),t}function i1(e){const t={},o=f(e,["safetyAttributes","categories"]);o!=null&&C(t,["categories"],o);const r=f(e,["safetyAttributes","scores"]);r!=null&&C(t,["scores"],r);const a=f(e,["contentType"]);return a!=null&&C(t,["contentType"],a),t}function s1(e){const t={},o=f(e,["safetyAttributes","categories"]);o!=null&&C(t,["categories"],o);const r=f(e,["safetyAttributes","scores"]);r!=null&&C(t,["scores"],r);const a=f(e,["contentType"]);return a!=null&&C(t,["contentType"],a),t}function $_(e){const t={},o=f(e,["category"]);if(o!=null&&C(t,["category"],o),f(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=f(e,["threshold"]);return r!=null&&C(t,["threshold"],r),t}function K_(e){const t={},o=f(e,["image"]);return o!=null&&C(t,["image"],Co(o)),t}function J_(e,t){const o={},r=f(e,["mode"]);t!==void 0&&r!=null&&C(t,["parameters","mode"],r);const a=f(e,["maxPredictions"]);t!==void 0&&a!=null&&C(t,["parameters","maxPredictions"],a);const i=f(e,["confidenceThreshold"]);t!==void 0&&i!=null&&C(t,["parameters","confidenceThreshold"],i);const s=f(e,["maskDilation"]);t!==void 0&&s!=null&&C(t,["parameters","maskDilation"],s);const l=f(e,["binaryColorThreshold"]);t!==void 0&&l!=null&&C(t,["parameters","binaryColorThreshold"],l);const c=f(e,["labels"]);return t!==void 0&&c!=null&&C(t,["labels"],c),o}function Y_(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["_url","model"],zt(e,r));const a=f(t,["source"]);a!=null&&X_(a,o);const i=f(t,["config"]);return i!=null&&J_(i,o),o}function Z_(e){const t={},o=f(e,["predictions"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>C_(a))),C(t,["generatedMasks"],r)}return t}function X_(e,t){const o={},r=f(e,["prompt"]);t!==void 0&&r!=null&&C(t,["instances[0]","prompt"],r);const a=f(e,["image"]);t!==void 0&&a!=null&&C(t,["instances[0]","image"],Co(a));const i=f(e,["scribbleImage"]);return t!==void 0&&i!=null&&C(t,["instances[0]","scribble"],K_(i)),o}function Q_(e){const t={},o=f(e,["functionCallingConfig"]);o!=null&&C(t,["functionCallingConfig"],t_(o));const r=f(e,["retrievalConfig"]);return r!=null&&C(t,["retrievalConfig"],r),t}function eS(e){const t={},o=f(e,["functionDeclarations"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(p=>p)),C(t,["functionDeclarations"],u)}if(f(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=f(e,["googleSearchRetrieval"]);r!=null&&C(t,["googleSearchRetrieval"],r);const a=f(e,["computerUse"]);a!=null&&C(t,["computerUse"],a);const i=f(e,["fileSearch"]);i!=null&&C(t,["fileSearch"],i);const s=f(e,["codeExecution"]);if(s!=null&&C(t,["codeExecution"],s),f(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=f(e,["googleMaps"]);l!=null&&C(t,["googleMaps"],P_(l));const c=f(e,["googleSearch"]);c!=null&&C(t,["googleSearch"],j_(c));const d=f(e,["urlContext"]);return d!=null&&C(t,["urlContext"],d),t}function l1(e){const t={},o=f(e,["functionDeclarations"]);if(o!=null){let p=o;Array.isArray(p)&&(p=p.map(h=>n_(h))),C(t,["functionDeclarations"],p)}const r=f(e,["retrieval"]);r!=null&&C(t,["retrieval"],r);const a=f(e,["googleSearchRetrieval"]);a!=null&&C(t,["googleSearchRetrieval"],a);const i=f(e,["computerUse"]);if(i!=null&&C(t,["computerUse"],i),f(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=f(e,["codeExecution"]);s!=null&&C(t,["codeExecution"],s);const l=f(e,["enterpriseWebSearch"]);l!=null&&C(t,["enterpriseWebSearch"],l);const c=f(e,["googleMaps"]);c!=null&&C(t,["googleMaps"],c);const d=f(e,["googleSearch"]);d!=null&&C(t,["googleSearch"],d);const u=f(e,["urlContext"]);return u!=null&&C(t,["urlContext"],u),t}function tS(e){const t={},o=f(e,["baseModel"]);o!=null&&C(t,["baseModel"],o);const r=f(e,["createTime"]);r!=null&&C(t,["createTime"],r);const a=f(e,["updateTime"]);return a!=null&&C(t,["updateTime"],a),t}function nS(e){const t={},o=f(e,["labels","google-vertex-llm-tuning-base-model-id"]);o!=null&&C(t,["baseModel"],o);const r=f(e,["createTime"]);r!=null&&C(t,["createTime"],r);const a=f(e,["updateTime"]);return a!=null&&C(t,["updateTime"],a),t}function oS(e,t){const o={},r=f(e,["displayName"]);t!==void 0&&r!=null&&C(t,["displayName"],r);const a=f(e,["description"]);t!==void 0&&a!=null&&C(t,["description"],a);const i=f(e,["defaultCheckpointId"]);return t!==void 0&&i!=null&&C(t,["defaultCheckpointId"],i),o}function rS(e,t){const o={},r=f(e,["displayName"]);t!==void 0&&r!=null&&C(t,["displayName"],r);const a=f(e,["description"]);t!==void 0&&a!=null&&C(t,["description"],a);const i=f(e,["defaultCheckpointId"]);return t!==void 0&&i!=null&&C(t,["defaultCheckpointId"],i),o}function aS(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["_url","name"],zt(e,r));const a=f(t,["config"]);return a!=null&&oS(a,o),o}function iS(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["_url","model"],zt(e,r));const a=f(t,["config"]);return a!=null&&rS(a,o),o}function sS(e,t){const o={},r=f(e,["outputGcsUri"]);t!==void 0&&r!=null&&C(t,["parameters","storageUri"],r);const a=f(e,["safetyFilterLevel"]);t!==void 0&&a!=null&&C(t,["parameters","safetySetting"],a);const i=f(e,["personGeneration"]);t!==void 0&&i!=null&&C(t,["parameters","personGeneration"],i);const s=f(e,["includeRaiReason"]);t!==void 0&&s!=null&&C(t,["parameters","includeRaiReason"],s);const l=f(e,["outputMimeType"]);t!==void 0&&l!=null&&C(t,["parameters","outputOptions","mimeType"],l);const c=f(e,["outputCompressionQuality"]);t!==void 0&&c!=null&&C(t,["parameters","outputOptions","compressionQuality"],c);const d=f(e,["enhanceInputImage"]);t!==void 0&&d!=null&&C(t,["parameters","upscaleConfig","enhanceInputImage"],d);const u=f(e,["imagePreservationFactor"]);t!==void 0&&u!=null&&C(t,["parameters","upscaleConfig","imagePreservationFactor"],u);const p=f(e,["labels"]);t!==void 0&&p!=null&&C(t,["labels"],p);const h=f(e,["numberOfImages"]);t!==void 0&&h!=null&&C(t,["parameters","sampleCount"],h);const w=f(e,["mode"]);return t!==void 0&&w!=null&&C(t,["parameters","mode"],w),o}function lS(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["_url","model"],zt(e,r));const a=f(t,["image"]);a!=null&&C(o,["instances[0]","image"],Co(a));const i=f(t,["upscaleFactor"]);i!=null&&C(o,["parameters","upscaleConfig","upscaleFactor"],i);const s=f(t,["config"]);return s!=null&&sS(s,o),o}function cS(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>Kl(i))),C(t,["generatedImages"],a)}return t}function dS(e){const t={},o=f(e,["uri"]);o!=null&&C(t,["uri"],o);const r=f(e,["encodedVideo"]);r!=null&&C(t,["videoBytes"],Nr(r));const a=f(e,["encoding"]);return a!=null&&C(t,["mimeType"],a),t}function uS(e){const t={},o=f(e,["gcsUri"]);o!=null&&C(t,["uri"],o);const r=f(e,["bytesBase64Encoded"]);r!=null&&C(t,["videoBytes"],Nr(r));const a=f(e,["mimeType"]);return a!=null&&C(t,["mimeType"],a),t}function pS(e){const t={},o=f(e,["image"]);o!=null&&C(t,["_self"],Co(o));const r=f(e,["maskMode"]);return r!=null&&C(t,["maskMode"],r),t}function hS(e){const t={},o=f(e,["image"]);o!=null&&C(t,["image"],Jl(o));const r=f(e,["referenceType"]);return r!=null&&C(t,["referenceType"],r),t}function mS(e){const t={},o=f(e,["image"]);o!=null&&C(t,["image"],Co(o));const r=f(e,["referenceType"]);return r!=null&&C(t,["referenceType"],r),t}function c1(e){const t={},o=f(e,["uri"]);o!=null&&C(t,["uri"],o);const r=f(e,["videoBytes"]);r!=null&&C(t,["encodedVideo"],Nr(r));const a=f(e,["mimeType"]);return a!=null&&C(t,["encoding"],a),t}function d1(e){const t={},o=f(e,["uri"]);o!=null&&C(t,["gcsUri"],o);const r=f(e,["videoBytes"]);r!=null&&C(t,["bytesBase64Encoded"],Nr(r));const a=f(e,["mimeType"]);return a!=null&&C(t,["mimeType"],a),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function gS(e,t){const o={},r=f(e,["displayName"]);return t!==void 0&&r!=null&&C(t,["displayName"],r),o}function fS(e){const t={},o=f(e,["config"]);return o!=null&&gS(o,t),t}function xS(e,t){const o={},r=f(e,["force"]);return t!==void 0&&r!=null&&C(t,["_query","force"],r),o}function yS(e){const t={},o=f(e,["name"]);o!=null&&C(t,["_url","name"],o);const r=f(e,["config"]);return r!=null&&xS(r,t),t}function vS(e){const t={},o=f(e,["name"]);return o!=null&&C(t,["_url","name"],o),t}function wS(e,t){const o={},r=f(e,["customMetadata"]);if(t!==void 0&&r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),C(t,["customMetadata"],i)}const a=f(e,["chunkingConfig"]);return t!==void 0&&a!=null&&C(t,["chunkingConfig"],a),o}function bS(e){const t={},o=f(e,["name"]);o!=null&&C(t,["name"],o);const r=f(e,["metadata"]);r!=null&&C(t,["metadata"],r);const a=f(e,["done"]);a!=null&&C(t,["done"],a);const i=f(e,["error"]);i!=null&&C(t,["error"],i);const s=f(e,["response"]);return s!=null&&C(t,["response"],kS(s)),t}function CS(e){const t={},o=f(e,["fileSearchStoreName"]);o!=null&&C(t,["_url","file_search_store_name"],o);const r=f(e,["fileName"]);r!=null&&C(t,["fileName"],r);const a=f(e,["config"]);return a!=null&&wS(a,t),t}function kS(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["parent"]);r!=null&&C(t,["parent"],r);const a=f(e,["documentName"]);return a!=null&&C(t,["documentName"],a),t}function _S(e,t){const o={},r=f(e,["pageSize"]);t!==void 0&&r!=null&&C(t,["_query","pageSize"],r);const a=f(e,["pageToken"]);return t!==void 0&&a!=null&&C(t,["_query","pageToken"],a),o}function SS(e){const t={},o=f(e,["config"]);return o!=null&&_S(o,t),t}function NS(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["nextPageToken"]);r!=null&&C(t,["nextPageToken"],r);const a=f(e,["fileSearchStores"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),C(t,["fileSearchStores"],i)}return t}function u1(e,t){const o={},r=f(e,["mimeType"]);t!==void 0&&r!=null&&C(t,["mimeType"],r);const a=f(e,["displayName"]);t!==void 0&&a!=null&&C(t,["displayName"],a);const i=f(e,["customMetadata"]);if(t!==void 0&&i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),C(t,["customMetadata"],l)}const s=f(e,["chunkingConfig"]);return t!==void 0&&s!=null&&C(t,["chunkingConfig"],s),o}function ES(e){const t={},o=f(e,["fileSearchStoreName"]);o!=null&&C(t,["_url","file_search_store_name"],o);const r=f(e,["config"]);return r!=null&&u1(r,t),t}function PS(e){const t={},o=f(e,["sdkHttpResponse"]);return o!=null&&C(t,["sdkHttpResponse"],o),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const jS="Content-Type",TS="X-Server-Timeout",IS="User-Agent",mu="x-goog-api-client",AS="1.34.0",MS=`google-genai-sdk/${AS}`,RS="v1beta1",LS="v1beta";class DS{constructor(t){var o,r;this.clientOptions=Object.assign(Object.assign({},t),{project:t.project,location:t.location,apiKey:t.apiKey,vertexai:t.vertexai});const a={};this.clientOptions.vertexai?(a.apiVersion=(o=this.clientOptions.apiVersion)!==null&&o!==void 0?o:RS,a.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(a.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:LS,a.baseUrl="https://generativelanguage.googleapis.com/"),a.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=a,t.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(a,t.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var t;return(t=this.clientOptions.vertexai)!==null&&t!==void 0?t:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){const t=new Headers;return await this.clientOptions.auth.addAuthHeaders(t),t}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(t){if(!t||t.baseUrl===void 0||t.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const r=[t.baseUrl.endsWith("/")?t.baseUrl.slice(0,-1):t.baseUrl];return t.apiVersion&&t.apiVersion!==""&&r.push(t.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const t=this.getBaseUrl(),o=new URL(t);return o.protocol=o.protocol=="http:"?"ws":"wss",o.toString()}setBaseUrl(t){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=t;else throw new Error("HTTP options are not correctly set.")}constructUrl(t,o,r){const a=[this.getRequestUrlInternal(o)];return r&&a.push(this.getBaseResourcePath()),t!==""&&a.push(t),new URL(`${a.join("/")}`)}shouldPrependVertexProjectPath(t){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||t.path.startsWith("projects/")||t.httpMethod==="GET"&&t.path.startsWith("publishers/google/models"))}async request(t){let o=this.clientOptions.httpOptions;t.httpOptions&&(o=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const r=this.shouldPrependVertexProjectPath(t),a=this.constructUrl(t.path,o,r);if(t.queryParams)for(const[s,l]of Object.entries(t.queryParams))a.searchParams.append(s,String(l));let i={};if(t.httpMethod==="GET"){if(t.body&&t.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else i.body=t.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,o,a.toString(),t.abortSignal),this.unaryApiCall(a,i,t.httpMethod)}patchHttpOptions(t,o){const r=JSON.parse(JSON.stringify(t));for(const[a,i]of Object.entries(o))typeof i=="object"?r[a]=Object.assign(Object.assign({},r[a]),i):i!==void 0&&(r[a]=i);return r}async requestStream(t){let o=this.clientOptions.httpOptions;t.httpOptions&&(o=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const r=this.shouldPrependVertexProjectPath(t),a=this.constructUrl(t.path,o,r);(!a.searchParams.has("alt")||a.searchParams.get("alt")!=="sse")&&a.searchParams.set("alt","sse");let i={};return i.body=t.body,i=await this.includeExtraHttpOptionsToRequestInit(i,o,a.toString(),t.abortSignal),this.streamApiCall(a,i,t.httpMethod)}async includeExtraHttpOptionsToRequestInit(t,o,r,a){if(o&&o.timeout||a){const i=new AbortController,s=i.signal;if(o.timeout&&(o==null?void 0:o.timeout)>0){const l=setTimeout(()=>i.abort(),o.timeout);l&&typeof l.unref=="function"&&l.unref()}a&&a.addEventListener("abort",()=>{i.abort()}),t.signal=s}return o&&o.extraBody!==null&&zS(t,o.extraBody),t.headers=await this.getHeadersInternal(o,r),t}async unaryApiCall(t,o,r){return this.apiCall(t.toString(),Object.assign(Object.assign({},o),{method:r})).then(async a=>(await Sg(a),new cu(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}async streamApiCall(t,o,r){return this.apiCall(t.toString(),Object.assign(Object.assign({},o),{method:r})).then(async a=>(await Sg(a),this.processStreamResponse(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}processStreamResponse(t){return vo(this,arguments,function*(){var r;const a=(r=t==null?void 0:t.body)===null||r===void 0?void 0:r.getReader(),i=new TextDecoder("utf-8");if(!a)throw new Error("Response body is empty");try{let s="";const l="data:",c=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:d,value:u}=yield Et(a.read());if(d){if(s.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const p=i.decode(u,{stream:!0});try{const k=JSON.parse(p);if("error"in k){const b=JSON.parse(JSON.stringify(k.error)),y=b.status,g=b.code,m=`got status: ${y}. ${JSON.stringify(k)}`;if(g>=400&&g<600)throw new Wl({message:m,status:g})}}catch(k){if(k.name==="ApiError")throw k}s+=p;let h=-1,w=0;for(;;){h=-1,w=0;for(const y of c){const g=s.indexOf(y);g!==-1&&(h===-1||g<h)&&(h=g,w=y.length)}if(h===-1)break;const k=s.substring(0,h);s=s.substring(h+w);const b=k.trim();if(b.startsWith(l)){const y=b.substring(l.length).trim();try{const g=new Response(y,{headers:t==null?void 0:t.headers,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText});yield yield Et(new cu(g))}catch(g){throw new Error(`exception parsing stream chunk ${y}. ${g}`)}}}}}finally{a.releaseLock()}})}async apiCall(t,o){return fetch(t,o).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){const t={},o=MS+" "+this.clientOptions.userAgentExtra;return t[IS]=o,t[mu]=o,t[jS]="application/json",t}async getHeadersInternal(t,o){const r=new Headers;if(t&&t.headers){for(const[a,i]of Object.entries(t.headers))r.append(a,i);t.timeout&&t.timeout>0&&r.append(TS,String(Math.ceil(t.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,o),r}getFileName(t){var o;let r="";return typeof t=="string"&&(r=t.replace(/[/\\]+$/,""),r=(o=r.split(/[/\\]/).pop())!==null&&o!==void 0?o:""),r}async uploadFile(t,o){var r;const a={};o!=null&&(a.mimeType=o.mimeType,a.name=o.name,a.displayName=o.displayName),a.name&&!a.name.startsWith("files/")&&(a.name=`files/${a.name}`);const i=this.clientOptions.uploader,s=await i.stat(t);a.sizeBytes=String(s.size);const l=(r=o==null?void 0:o.mimeType)!==null&&r!==void 0?r:s.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");a.mimeType=l;const c={file:a},d=this.getFileName(t),u=it("upload/v1beta/files",c._url),p=await this.fetchUploadUrl(u,a.sizeBytes,a.mimeType,d,c,o==null?void 0:o.httpOptions);return i.upload(t,p,this)}async uploadFileToFileSearchStore(t,o,r){var a;const i=this.clientOptions.uploader,s=await i.stat(o),l=String(s.size),c=(a=r==null?void 0:r.mimeType)!==null&&a!==void 0?a:s.type;if(c===void 0||c==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const d=`upload/v1beta/${t}:uploadToFileSearchStore`,u=this.getFileName(o),p={};r!=null&&u1(r,p);const h=await this.fetchUploadUrl(d,l,c,u,p,r==null?void 0:r.httpOptions);return i.uploadToFileSearchStore(o,h,this)}async downloadFile(t){await this.clientOptions.downloader.download(t,this)}async fetchUploadUrl(t,o,r,a,i,s){var l;let c={};s?c=s:c={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${o}`,"X-Goog-Upload-Header-Content-Type":`${r}`},a?{"X-Goog-Upload-File-Name":a}:{})};const d=await this.request({path:t,body:JSON.stringify(i),httpMethod:"POST",httpOptions:c});if(!d||!(d!=null&&d.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const u=(l=d==null?void 0:d.headers)===null||l===void 0?void 0:l["x-goog-upload-url"];if(u===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}}async function Sg(e){var t;if(e===void 0)throw new Error("response is undefined");if(!e.ok){const o=e.status;let r;!((t=e.headers.get("content-type"))===null||t===void 0)&&t.includes("application/json")?r=await e.json():r={error:{message:await e.text(),code:e.status,status:e.statusText}};const a=JSON.stringify(r);throw o>=400&&o<600?new Wl({message:a,status:o}):new Error(a)}}function zS(e,t){if(!t||Object.keys(t).length===0)return;if(e.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let o={};if(typeof e.body=="string"&&e.body.length>0)try{const i=JSON.parse(e.body);if(typeof i=="object"&&i!==null&&!Array.isArray(i))o=i;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(i,s){const l=Object.assign({},i);for(const c in s)if(Object.prototype.hasOwnProperty.call(s,c)){const d=s[c],u=l[c];d&&typeof d=="object"&&!Array.isArray(d)&&u&&typeof u=="object"&&!Array.isArray(u)?l[c]=r(u,d):(u&&d&&typeof u!=typeof d&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${c}". Original type: ${typeof u}, New type: ${typeof d}. Overwriting.`),l[c]=d)}return l}const a=r(o,t);e.body=JSON.stringify(a)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const qS="mcp_used/unknown";let OS=!1;function p1(e){for(const t of e)if(FS(t)||typeof t=="object"&&"inputSchema"in t)return!0;return OS}function h1(e){var t;const o=(t=e[mu])!==null&&t!==void 0?t:"";e[mu]=(o+` ${qS}`).trimStart()}function FS(e){return e!==null&&typeof e=="object"&&e instanceof Ip}function BS(e){return vo(this,arguments,function*(o,r=100){let a,i=0;for(;i<r;){const s=yield Et(o.listTools({cursor:a}));for(const l of s.tools)yield yield Et(l),i++;if(!s.nextCursor)break;a=s.nextCursor}})}class Ip{constructor(t=[],o){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=t,this.config=o}static create(t,o){return new Ip(t,o)}async initialize(){var t,o,r,a;if(this.mcpTools.length>0)return;const i={},s=[];for(const u of this.mcpClients)try{for(var l=!0,c=(o=void 0,wo(BS(u))),d;d=await c.next(),t=d.done,!t;l=!0){a=d.value,l=!1;const p=a;s.push(p);const h=p.name;if(i[h])throw new Error(`Duplicate function name ${h} found in MCP tools. Please ensure function names are unique.`);i[h]=u}}catch(p){o={error:p}}finally{try{!l&&!t&&(r=c.return)&&await r.call(c)}finally{if(o)throw o.error}}this.mcpTools=s,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),v5(this.mcpTools,this.config)}async callTool(t){await this.initialize();const o=[];for(const r of t)if(r.name in this.functionNameToMcpClient){const a=this.functionNameToMcpClient[r.name];let i;this.config.timeout&&(i={timeout:this.config.timeout});const s=await a.callTool({name:r.name,arguments:r.args},void 0,i);o.push({functionResponse:{name:r.name,response:s.isError?{error:s}:s}})}return o}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function HS(e,t,o){const r=new u5;let a;o.data instanceof Blob?a=JSON.parse(await o.data.text()):a=JSON.parse(o.data),Object.assign(r,a),t(r)}class GS{constructor(t,o,r){this.apiClient=t,this.auth=o,this.webSocketFactory=r}async connect(t){var o,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const a=this.apiClient.getWebsocketBaseUrl(),i=this.apiClient.getApiVersion(),s=WS(this.apiClient.getDefaultHeaders()),l=this.apiClient.getApiKey(),c=`${a}/ws/google.ai.generativelanguage.${i}.GenerativeService.BidiGenerateMusic?key=${l}`;let d=()=>{};const u=new Promise(x=>{d=x}),p=t.callbacks,h=function(){d({})},w=this.apiClient,k={onopen:h,onmessage:x=>{HS(w,p.onmessage,x)},onerror:(o=p==null?void 0:p.onerror)!==null&&o!==void 0?o:function(x){},onclose:(r=p==null?void 0:p.onclose)!==null&&r!==void 0?r:function(x){}},b=this.webSocketFactory.create(c,VS(s),k);b.connect(),await u;const m={setup:{model:zt(this.apiClient,t.model)}};return b.send(JSON.stringify(m)),new US(b,this.apiClient)}}class US{constructor(t,o){this.conn=t,this.apiClient=o}async setWeightedPrompts(t){if(!t.weightedPrompts||Object.keys(t.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const o=f4(t);this.conn.send(JSON.stringify({clientContent:o}))}async setMusicGenerationConfig(t){t.musicGenerationConfig||(t.musicGenerationConfig={});const o=g4(t);this.conn.send(JSON.stringify(o))}sendPlaybackControl(t){const o={playbackControl:t};this.conn.send(JSON.stringify(o))}play(){this.sendPlaybackControl(fa.PLAY)}pause(){this.sendPlaybackControl(fa.PAUSE)}stop(){this.sendPlaybackControl(fa.STOP)}resetContext(){this.sendPlaybackControl(fa.RESET_CONTEXT)}close(){this.conn.close()}}function VS(e){const t={};return e.forEach((o,r)=>{t[r]=o}),t}function WS(e){const t=new Headers;for(const[o,r]of Object.entries(e))t.append(o,r);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const $S="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function KS(e,t,o){const r=new d5;let a;o.data instanceof Blob?a=await o.data.text():o.data instanceof ArrayBuffer?a=new TextDecoder().decode(o.data):a=o.data;const i=JSON.parse(a);if(e.isVertexAI()){const s=v4(i);Object.assign(r,s)}else Object.assign(r,i);t(r)}class JS{constructor(t,o,r){this.apiClient=t,this.auth=o,this.webSocketFactory=r,this.music=new GS(this.apiClient,this.auth,this.webSocketFactory)}async connect(t){var o,r,a,i,s,l;if(t.config&&t.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const c=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let u;const p=this.apiClient.getHeaders();t.config&&t.config.tools&&p1(t.config.tools)&&h1(p);const h=QS(p);if(this.apiClient.isVertexAI())u=`${c}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(h,u);else{const D=this.apiClient.getApiKey();let O="BidiGenerateContent",B="key";D!=null&&D.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),d!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),O="BidiGenerateContentConstrained",B="access_token"),u=`${c}/ws/google.ai.generativelanguage.${d}.GenerativeService.${O}?${B}=${D}`}let w=()=>{};const k=new Promise(D=>{w=D}),b=t.callbacks,y=function(){var D;(D=b==null?void 0:b.onopen)===null||D===void 0||D.call(b),w({})},g=this.apiClient,m={onopen:y,onmessage:D=>{KS(g,b.onmessage,D)},onerror:(o=b==null?void 0:b.onerror)!==null&&o!==void 0?o:function(D){},onclose:(r=b==null?void 0:b.onclose)!==null&&r!==void 0?r:function(D){}},x=this.webSocketFactory.create(u,XS(h),m);x.connect(),await k;let _=zt(this.apiClient,t.model);if(this.apiClient.isVertexAI()&&_.startsWith("publishers/")){const D=this.apiClient.getProject(),O=this.apiClient.getLocation();_=`projects/${D}/locations/${O}/`+_}let S={};this.apiClient.isVertexAI()&&((a=t.config)===null||a===void 0?void 0:a.responseModalities)===void 0&&(t.config===void 0?t.config={responseModalities:[za.AUDIO]}:t.config.responseModalities=[za.AUDIO]),!((i=t.config)===null||i===void 0)&&i.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const P=(l=(s=t.config)===null||s===void 0?void 0:s.tools)!==null&&l!==void 0?l:[],j=[];for(const D of P)if(this.isCallableTool(D)){const O=D;j.push(await O.tool())}else j.push(D);j.length>0&&(t.config.tools=j);const M={model:_,config:t.config,callbacks:t.callbacks};return this.apiClient.isVertexAI()?S=m4(this.apiClient,M):S=h4(this.apiClient,M),delete S.config,x.send(JSON.stringify(S)),new ZS(x,this.apiClient)}isCallableTool(t){return"callTool"in t&&typeof t.callTool=="function"}}const YS={turnComplete:!0};class ZS{constructor(t,o){this.conn=t,this.apiClient=o}tLiveClientContent(t,o){if(o.turns!==null&&o.turns!==void 0){let r=[];try{r=io(o.turns),t.isVertexAI()||(r=r.map(a=>$l(a)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof o.turns}'`)}return{clientContent:{turns:r,turnComplete:o.turnComplete}}}return{clientContent:{turnComplete:o.turnComplete}}}tLiveClienttToolResponse(t,o){let r=[];if(o.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(o.functionResponses)?r=o.functionResponses:r=[o.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(const i of r){if(typeof i!="object"||i===null||!("name"in i)||!("response"in i))throw new Error(`Could not parse function response, type '${typeof i}'.`);if(!t.isVertexAI()&&!("id"in i))throw new Error($S)}return{toolResponse:{functionResponses:r}}}sendClientContent(t){t=Object.assign(Object.assign({},YS),t);const o=this.tLiveClientContent(this.apiClient,t);this.conn.send(JSON.stringify(o))}sendRealtimeInput(t){let o={};this.apiClient.isVertexAI()?o={realtimeInput:y4(t)}:o={realtimeInput:x4(t)},this.conn.send(JSON.stringify(o))}sendToolResponse(t){if(t.functionResponses==null)throw new Error("Tool response parameters are required.");const o=this.tLiveClienttToolResponse(this.apiClient,t);this.conn.send(JSON.stringify(o))}close(){this.conn.close()}}function XS(e){const t={};return e.forEach((o,r)=>{t[r]=o}),t}function QS(e){const t=new Headers;for(const[o,r]of Object.entries(e))t.append(o,r);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ng=10;function Eg(e){var t,o,r;if(!((t=e==null?void 0:e.automaticFunctionCalling)===null||t===void 0)&&t.disable)return!0;let a=!1;for(const s of(o=e==null?void 0:e.tools)!==null&&o!==void 0?o:[])if(Sa(s)){a=!0;break}if(!a)return!0;const i=(r=e==null?void 0:e.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return i&&(i<0||!Number.isInteger(i))||i==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",i),!0):!1}function Sa(e){return"callTool"in e&&typeof e.callTool=="function"}function eN(e){var t,o,r;return(r=(o=(t=e.config)===null||t===void 0?void 0:t.tools)===null||o===void 0?void 0:o.some(a=>Sa(a)))!==null&&r!==void 0?r:!1}function Pg(e){var t;const o=[];return!((t=e==null?void 0:e.config)===null||t===void 0)&&t.tools&&e.config.tools.forEach((r,a)=>{if(Sa(r))return;const i=r;i.functionDeclarations&&i.functionDeclarations.length>0&&o.push(a)}),o}function jg(e){var t;return!(!((t=e==null?void 0:e.automaticFunctionCalling)===null||t===void 0)&&t.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class tN extends Jo{constructor(t){super(),this.apiClient=t,this.generateContent=async o=>{var r,a,i,s,l;const c=await this.processParamsMaybeAddMcpUsage(o);if(this.maybeMoveToResponseJsonSchem(o),!eN(o)||Eg(o.config))return await this.generateContentInternal(c);const d=Pg(o);if(d.length>0){const b=d.map(y=>`tools[${y}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${b}.`)}let u,p;const h=io(c.contents),w=(i=(a=(r=c.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||a===void 0?void 0:a.maximumRemoteCalls)!==null&&i!==void 0?i:Ng;let k=0;for(;k<w&&(u=await this.generateContentInternal(c),!(!u.functionCalls||u.functionCalls.length===0));){const b=u.candidates[0].content,y=[];for(const g of(l=(s=o.config)===null||s===void 0?void 0:s.tools)!==null&&l!==void 0?l:[])if(Sa(g)){const x=await g.callTool(u.functionCalls);y.push(...x)}k++,p={role:"user",parts:y},c.contents=io(c.contents),c.contents.push(b),c.contents.push(p),jg(c.config)&&(h.push(b),h.push(p))}return jg(c.config)&&(u.automaticFunctionCallingHistory=h),u},this.generateContentStream=async o=>{var r,a,i,s,l;if(this.maybeMoveToResponseJsonSchem(o),Eg(o.config)){const p=await this.processParamsMaybeAddMcpUsage(o);return await this.generateContentStreamInternal(p)}const c=Pg(o);if(c.length>0){const p=c.map(h=>`tools[${h}]`).join(", ");throw new Error(`Incompatible tools found at ${p}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const d=(i=(a=(r=o==null?void 0:o.config)===null||r===void 0?void 0:r.toolConfig)===null||a===void 0?void 0:a.functionCallingConfig)===null||i===void 0?void 0:i.streamFunctionCallArguments,u=(l=(s=o==null?void 0:o.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||l===void 0?void 0:l.disable;if(d&&!u)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(o)},this.generateImages=async o=>await this.generateImagesInternal(o).then(r=>{var a;let i;const s=[];if(r!=null&&r.generatedImages)for(const c of r.generatedImages)c&&(c!=null&&c.safetyAttributes)&&((a=c==null?void 0:c.safetyAttributes)===null||a===void 0?void 0:a.contentType)==="Positive Prompt"?i=c==null?void 0:c.safetyAttributes:s.push(c);let l;return i?l={generatedImages:s,positivePromptSafetyAttributes:i,sdkHttpResponse:r.sdkHttpResponse}:l={generatedImages:s,sdkHttpResponse:r.sdkHttpResponse},l}),this.list=async o=>{var r;const s={config:Object.assign(Object.assign({},{queryBase:!0}),o==null?void 0:o.config)};if(this.apiClient.isVertexAI()&&!s.config.queryBase){if(!((r=s.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");s.config.filter="labels.tune-type:*"}return new Wr($o.PAGED_ITEM_MODELS,l=>this.listInternal(l),await this.listInternal(s),s)},this.editImage=async o=>{const r={model:o.model,prompt:o.prompt,referenceImages:[],config:o.config};return o.referenceImages&&o.referenceImages&&(r.referenceImages=o.referenceImages.map(a=>a.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async o=>{let r={numberOfImages:1,mode:"upscale"};o.config&&(r=Object.assign(Object.assign({},r),o.config));const a={model:o.model,image:o.image,upscaleFactor:o.upscaleFactor,config:r};return await this.upscaleImageInternal(a)},this.generateVideos=async o=>{var r,a,i,s,l,c;if((o.prompt||o.image||o.video)&&o.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((r=o.video)===null||r===void 0)&&r.uri&&(!((a=o.video)===null||a===void 0)&&a.videoBytes)?o.video={uri:o.video.uri,mimeType:o.video.mimeType}:!((s=(i=o.source)===null||i===void 0?void 0:i.video)===null||s===void 0)&&s.uri&&(!((c=(l=o.source)===null||l===void 0?void 0:l.video)===null||c===void 0)&&c.videoBytes)&&(o.source.video={uri:o.source.video.uri,mimeType:o.source.video.mimeType})),await this.generateVideosInternal(o)}}maybeMoveToResponseJsonSchem(t){t.config&&t.config.responseSchema&&(t.config.responseJsonSchema||Object.keys(t.config.responseSchema).includes("$schema")&&(t.config.responseJsonSchema=t.config.responseSchema,delete t.config.responseSchema))}async processParamsMaybeAddMcpUsage(t){var o,r,a;const i=(o=t.config)===null||o===void 0?void 0:o.tools;if(!i)return t;const s=await Promise.all(i.map(async c=>Sa(c)?await c.tool():c)),l={model:t.model,contents:t.contents,config:Object.assign(Object.assign({},t.config),{tools:s})};if(l.config.tools=s,t.config&&t.config.tools&&p1(t.config.tools)){const c=(a=(r=t.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&a!==void 0?a:{};let d=Object.assign({},c);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),h1(d),l.config.httpOptions=Object.assign(Object.assign({},t.config.httpOptions),{headers:d})}return l}async initAfcToolsMap(t){var o,r,a;const i=new Map;for(const s of(r=(o=t.config)===null||o===void 0?void 0:o.tools)!==null&&r!==void 0?r:[])if(Sa(s)){const l=s,c=await l.tool();for(const d of(a=c.functionDeclarations)!==null&&a!==void 0?a:[]){if(!d.name)throw new Error("Function declaration name is required.");if(i.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);i.set(d.name,l)}}return i}async processAfcStream(t){var o,r,a;const i=(a=(r=(o=t.config)===null||o===void 0?void 0:o.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&a!==void 0?a:Ng;let s=!1,l=0;const c=await this.initAfcToolsMap(t);return function(d,u,p){return vo(this,arguments,function*(){for(var h,w,k,b,y,g;l<i;){s&&(l++,s=!1);const S=yield Et(d.processParamsMaybeAddMcpUsage(p)),P=yield Et(d.generateContentStreamInternal(S)),j=[],M=[];try{for(var m=!0,x=(w=void 0,wo(P)),_;_=yield Et(x.next()),h=_.done,!h;m=!0){b=_.value,m=!1;const D=b;if(yield yield Et(D),D.candidates&&(!((y=D.candidates[0])===null||y===void 0)&&y.content)){M.push(D.candidates[0].content);for(const O of(g=D.candidates[0].content.parts)!==null&&g!==void 0?g:[])if(l<i&&O.functionCall){if(!O.functionCall.name)throw new Error("Function call name was not returned by the model.");if(u.has(O.functionCall.name)){const B=yield Et(u.get(O.functionCall.name).callTool([O.functionCall]));j.push(...B)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${u.keys()}, mising tool: ${O.functionCall.name}`)}}}}catch(D){w={error:D}}finally{try{!m&&!h&&(k=x.return)&&(yield Et(k.call(x)))}finally{if(w)throw w.error}}if(j.length>0){s=!0;const D=new ei;D.candidates=[{content:{role:"user",parts:j}}],yield yield Et(D);const O=[];O.push(...M),O.push({role:"user",parts:j});const B=io(p.contents).concat(O);p.contents=B}else break}})}(this,c,t)}async generateContentInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=Cg(this.apiClient,t);return l=it("{model}:generateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=_g(u),h=new ei;return Object.assign(h,p),h})}else{const d=bg(this.apiClient,t);return l=it("{model}:generateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=kg(u),h=new ei;return Object.assign(h,p),h})}}async generateContentStreamInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=Cg(this.apiClient,t);return l=it("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}),s.then(function(p){return vo(this,arguments,function*(){var h,w,k,b;try{for(var y=!0,g=wo(p),m;m=yield Et(g.next()),h=m.done,!h;y=!0){b=m.value,y=!1;const x=b,_=_g(yield Et(x.json()));_.sdkHttpResponse={headers:x.headers};const S=new ei;Object.assign(S,_),yield yield Et(S)}}catch(x){w={error:x}}finally{try{!y&&!h&&(k=g.return)&&(yield Et(k.call(g)))}finally{if(w)throw w.error}}})})}else{const d=bg(this.apiClient,t);return l=it("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}),s.then(function(p){return vo(this,arguments,function*(){var h,w,k,b;try{for(var y=!0,g=wo(p),m;m=yield Et(g.next()),h=m.done,!h;y=!0){b=m.value,y=!1;const x=b,_=kg(yield Et(x.json()));_.sdkHttpResponse={headers:x.headers};const S=new ei;Object.assign(S,_),yield yield Et(S)}}catch(x){w={error:x}}finally{try{!y&&!h&&(k=g.return)&&(yield Et(k.call(g)))}finally{if(w)throw w.error}}})})}}async embedContent(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=J4(this.apiClient,t);return l=it("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=Z4(u),h=new rg;return Object.assign(h,p),h})}else{const d=K4(this.apiClient,t);return l=it("{model}:batchEmbedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=Y4(u),h=new rg;return Object.assign(h,p),h})}}async generateImagesInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=l_(this.apiClient,t);return l=it("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=d_(u),h=new ag;return Object.assign(h,p),h})}else{const d=s_(this.apiClient,t);return l=it("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=c_(u),h=new ag;return Object.assign(h,p),h})}}async editImageInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=U4(this.apiClient,t);return i=it("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>{const d=V4(c),u=new QC;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=lS(this.apiClient,t);return i=it("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>{const d=cS(c),u=new e5;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=G_(this.apiClient,t);return i=it("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=U_(c),u=new t5;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=Y_(this.apiClient,t);return i=it("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=Z_(c),u=new n5;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async get(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=E_(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>hu(u))}else{const d=N_(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>pu(u))}}async listInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=D_(this.apiClient,t);return l=it("{models_url}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=q_(u),h=new ig;return Object.assign(h,p),h})}else{const d=L_(this.apiClient,t);return l=it("{models_url}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=z_(u),h=new ig;return Object.assign(h,p),h})}}async update(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=iS(this.apiClient,t);return l=it("{model}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>hu(u))}else{const d=aS(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>pu(u))}}async delete(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=F4(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=H4(u),h=new sg;return Object.assign(h,p),h})}else{const d=O4(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=B4(u),h=new sg;return Object.assign(h,p),h})}}async countTokens(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=D4(this.apiClient,t);return l=it("{model}:countTokens",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=q4(u),h=new lg;return Object.assign(h,p),h})}else{const d=L4(this.apiClient,t);return l=it("{model}:countTokens",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=z4(u),h=new lg;return Object.assign(h,p),h})}}async computeTokens(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=P4(this.apiClient,t);return i=it("{model}:computeTokens",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>{const d=j4(c),u=new o5;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=f_(this.apiClient,t);return l=it("{model}:predictLongRunning",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>{const p=m_(u),h=new wl;return Object.assign(h,p),h})}else{const d=g_(this.apiClient,t);return l=it("{model}:predictLongRunning",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>{const p=h_(u),h=new wl;return Object.assign(h,p),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nN extends Jo{constructor(t){super(),this.apiClient=t}async getVideosOperation(t){const o=t.operation,r=t.config;if(o.name===void 0||o.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=o.name.split("/operations/")[0];let i;r&&"httpOptions"in r&&(i=r.httpOptions);const s=await this.fetchPredictVideosOperationInternal({operationName:o.name,resourceName:a,config:{httpOptions:i}});return o._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{const a=await this.getVideosOperationInternal({operationName:o.name,config:r});return o._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async get(t){const o=t.operation,r=t.config;if(o.name===void 0||o.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=o.name.split("/operations/")[0];let i;r&&"httpOptions"in r&&(i=r.httpOptions);const s=await this.fetchPredictVideosOperationInternal({operationName:o.name,resourceName:a,config:{httpOptions:i}});return o._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{const a=await this.getVideosOperationInternal({operationName:o.name,config:r});return o._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async getVideosOperationInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=$C(t);return l=it("{operationName}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s}else{const d=WC(t);return l=it("{operationName}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s}}async fetchPredictVideosOperationInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=OC(t);return i=it("{resourceName}:fetchPredictOperation",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function oN(e){const t={},o=f(e,["data"]);if(o!=null&&C(t,["data"],o),f(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=f(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function rN(e){const t={},o=f(e,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(i=>hN(i))),C(t,["parts"],a)}const r=f(e,["role"]);return r!=null&&C(t,["role"],r),t}function aN(e,t,o){const r={},a=f(t,["expireTime"]);o!==void 0&&a!=null&&C(o,["expireTime"],a);const i=f(t,["newSessionExpireTime"]);o!==void 0&&i!=null&&C(o,["newSessionExpireTime"],i);const s=f(t,["uses"]);o!==void 0&&s!=null&&C(o,["uses"],s);const l=f(t,["liveConnectConstraints"]);o!==void 0&&l!=null&&C(o,["bidiGenerateContentSetup"],pN(e,l));const c=f(t,["lockAdditionalFields"]);return o!==void 0&&c!=null&&C(o,["fieldMask"],c),r}function iN(e,t){const o={},r=f(t,["config"]);return r!=null&&C(o,["config"],aN(e,r,o)),o}function sN(e){const t={};if(f(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=f(e,["fileUri"]);o!=null&&C(t,["fileUri"],o);const r=f(e,["mimeType"]);return r!=null&&C(t,["mimeType"],r),t}function lN(e){const t={},o=f(e,["id"]);o!=null&&C(t,["id"],o);const r=f(e,["args"]);r!=null&&C(t,["args"],r);const a=f(e,["name"]);if(a!=null&&C(t,["name"],a),f(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function cN(e){const t={};if(f(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const o=f(e,["enableWidget"]);return o!=null&&C(t,["enableWidget"],o),t}function dN(e){const t={};if(f(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const o=f(e,["timeRangeFilter"]);return o!=null&&C(t,["timeRangeFilter"],o),t}function uN(e,t){const o={},r=f(e,["generationConfig"]);t!==void 0&&r!=null&&C(t,["setup","generationConfig"],r);const a=f(e,["responseModalities"]);t!==void 0&&a!=null&&C(t,["setup","generationConfig","responseModalities"],a);const i=f(e,["temperature"]);t!==void 0&&i!=null&&C(t,["setup","generationConfig","temperature"],i);const s=f(e,["topP"]);t!==void 0&&s!=null&&C(t,["setup","generationConfig","topP"],s);const l=f(e,["topK"]);t!==void 0&&l!=null&&C(t,["setup","generationConfig","topK"],l);const c=f(e,["maxOutputTokens"]);t!==void 0&&c!=null&&C(t,["setup","generationConfig","maxOutputTokens"],c);const d=f(e,["mediaResolution"]);t!==void 0&&d!=null&&C(t,["setup","generationConfig","mediaResolution"],d);const u=f(e,["seed"]);t!==void 0&&u!=null&&C(t,["setup","generationConfig","seed"],u);const p=f(e,["speechConfig"]);t!==void 0&&p!=null&&C(t,["setup","generationConfig","speechConfig"],Tp(p));const h=f(e,["thinkingConfig"]);t!==void 0&&h!=null&&C(t,["setup","generationConfig","thinkingConfig"],h);const w=f(e,["enableAffectiveDialog"]);t!==void 0&&w!=null&&C(t,["setup","generationConfig","enableAffectiveDialog"],w);const k=f(e,["systemInstruction"]);t!==void 0&&k!=null&&C(t,["setup","systemInstruction"],rN(Pn(k)));const b=f(e,["tools"]);if(t!==void 0&&b!=null){let P=Ga(b);Array.isArray(P)&&(P=P.map(j=>gN(Ha(j)))),C(t,["setup","tools"],P)}const y=f(e,["sessionResumption"]);t!==void 0&&y!=null&&C(t,["setup","sessionResumption"],mN(y));const g=f(e,["inputAudioTranscription"]);t!==void 0&&g!=null&&C(t,["setup","inputAudioTranscription"],g);const m=f(e,["outputAudioTranscription"]);t!==void 0&&m!=null&&C(t,["setup","outputAudioTranscription"],m);const x=f(e,["realtimeInputConfig"]);t!==void 0&&x!=null&&C(t,["setup","realtimeInputConfig"],x);const _=f(e,["contextWindowCompression"]);t!==void 0&&_!=null&&C(t,["setup","contextWindowCompression"],_);const S=f(e,["proactivity"]);if(t!==void 0&&S!=null&&C(t,["setup","proactivity"],S),f(e,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return o}function pN(e,t){const o={},r=f(t,["model"]);r!=null&&C(o,["setup","model"],zt(e,r));const a=f(t,["config"]);return a!=null&&C(o,["config"],uN(a,o)),o}function hN(e){const t={},o=f(e,["mediaResolution"]);o!=null&&C(t,["mediaResolution"],o);const r=f(e,["codeExecutionResult"]);r!=null&&C(t,["codeExecutionResult"],r);const a=f(e,["executableCode"]);a!=null&&C(t,["executableCode"],a);const i=f(e,["fileData"]);i!=null&&C(t,["fileData"],sN(i));const s=f(e,["functionCall"]);s!=null&&C(t,["functionCall"],lN(s));const l=f(e,["functionResponse"]);l!=null&&C(t,["functionResponse"],l);const c=f(e,["inlineData"]);c!=null&&C(t,["inlineData"],oN(c));const d=f(e,["text"]);d!=null&&C(t,["text"],d);const u=f(e,["thought"]);u!=null&&C(t,["thought"],u);const p=f(e,["thoughtSignature"]);p!=null&&C(t,["thoughtSignature"],p);const h=f(e,["videoMetadata"]);return h!=null&&C(t,["videoMetadata"],h),t}function mN(e){const t={},o=f(e,["handle"]);if(o!=null&&C(t,["handle"],o),f(e,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function gN(e){const t={},o=f(e,["functionDeclarations"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(p=>p)),C(t,["functionDeclarations"],u)}if(f(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=f(e,["googleSearchRetrieval"]);r!=null&&C(t,["googleSearchRetrieval"],r);const a=f(e,["computerUse"]);a!=null&&C(t,["computerUse"],a);const i=f(e,["fileSearch"]);i!=null&&C(t,["fileSearch"],i);const s=f(e,["codeExecution"]);if(s!=null&&C(t,["codeExecution"],s),f(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=f(e,["googleMaps"]);l!=null&&C(t,["googleMaps"],cN(l));const c=f(e,["googleSearch"]);c!=null&&C(t,["googleSearch"],dN(c));const d=f(e,["urlContext"]);return d!=null&&C(t,["urlContext"],d),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function fN(e){const t=[];for(const o in e)if(Object.prototype.hasOwnProperty.call(e,o)){const r=e[o];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){const a=Object.keys(r).map(i=>`${o}.${i}`);t.push(...a)}else t.push(o)}return t.join(",")}function xN(e,t){let o=null;const r=e.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){const i=r.setup;typeof i=="object"&&i!==null?(e.bidiGenerateContentSetup=i,o=i):delete e.bidiGenerateContentSetup}else r!==void 0&&delete e.bidiGenerateContentSetup;const a=e.fieldMask;if(o){const i=fN(o);if(Array.isArray(t==null?void 0:t.lockAdditionalFields)&&(t==null?void 0:t.lockAdditionalFields.length)===0)i?e.fieldMask=i:delete e.fieldMask;else if(t!=null&&t.lockAdditionalFields&&t.lockAdditionalFields.length>0&&a!==null&&Array.isArray(a)&&a.length>0){const s=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let l=[];a.length>0&&(l=a.map(d=>s.includes(d)?`generationConfig.${d}`:d));const c=[];i&&c.push(i),l.length>0&&c.push(...l),c.length>0?e.fieldMask=c.join(","):delete e.fieldMask}else delete e.fieldMask}else a!==null&&Array.isArray(a)&&a.length>0?e.fieldMask=a.join(","):delete e.fieldMask;return e}class yN extends Jo{constructor(t){super(),this.apiClient=t}async create(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const l=iN(this.apiClient,t);i=it("auth_tokens",l._url),s=l._query,delete l.config,delete l._url,delete l._query;const c=xN(l,t.config);return a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>d)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function vN(e,t){const o={},r=f(e,["force"]);return t!==void 0&&r!=null&&C(t,["_query","force"],r),o}function wN(e){const t={},o=f(e,["name"]);o!=null&&C(t,["_url","name"],o);const r=f(e,["config"]);return r!=null&&vN(r,t),t}function bN(e){const t={},o=f(e,["name"]);return o!=null&&C(t,["_url","name"],o),t}function CN(e,t){const o={},r=f(e,["pageSize"]);t!==void 0&&r!=null&&C(t,["_query","pageSize"],r);const a=f(e,["pageToken"]);return t!==void 0&&a!=null&&C(t,["_query","pageToken"],a),o}function kN(e){const t={},o=f(e,["parent"]);o!=null&&C(t,["_url","parent"],o);const r=f(e,["config"]);return r!=null&&CN(r,t),t}function _N(e){const t={},o=f(e,["sdkHttpResponse"]);o!=null&&C(t,["sdkHttpResponse"],o);const r=f(e,["nextPageToken"]);r!=null&&C(t,["nextPageToken"],r);const a=f(e,["documents"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),C(t,["documents"],i)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class SN extends Jo{constructor(t){super(),this.apiClient=t,this.list=async o=>new Wr($o.PAGED_ITEM_DOCUMENTS,r=>this.listInternal({parent:o.parent,config:r.config}),await this.listInternal(o),o)}async get(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=bN(t);return i=it("{name}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async delete(t){var o,r;let a="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=wN(t);a=it("{name}",s._url),i=s._query,delete s._url,delete s._query,await this.apiClient.request({path:a,queryParams:i,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=kN(t);return i=it("{parent}/documents",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=_N(c),u=new r5;return Object.assign(u,d),u})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class NN extends Jo{constructor(t,o=new SN(t)){super(),this.apiClient=t,this.documents=o,this.list=async(r={})=>new Wr($o.PAGED_ITEM_FILE_SEARCH_STORES,a=>this.listInternal(a),await this.listInternal(r),r)}async uploadToFileSearchStore(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(t.fileSearchStoreName,t.file,t.config)}async create(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=fS(t);return i=it("fileSearchStores",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async get(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=vS(t);return i=it("{name}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async delete(t){var o,r;let a="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=yS(t);a=it("{name}",s._url),i=s._query,delete s._url,delete s._query,await this.apiClient.request({path:a,queryParams:i,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=SS(t);return i=it("fileSearchStores",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=NS(c),u=new a5;return Object.assign(u,d),u})}}async uploadToFileSearchStoreInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=ES(t);return i=it("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=PS(c),u=new i5;return Object.assign(u,d),u})}}async importFile(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=CS(t);return i=it("{file_search_store_name}:importFile",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=bS(c),u=new Sp;return Object.assign(u,d),u})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let m1=function(){const{crypto:e}=globalThis;if(e!=null&&e.randomUUID)return m1=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),o=e?()=>e.getRandomValues(t)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^o()&15>>+r/4).toString(16))};const EN=()=>m1();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function gu(e){return typeof e=="object"&&e!==null&&("name"in e&&e.name==="AbortError"||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const fu=e=>{if(e instanceof Error)return e;if(typeof e=="object"&&e!==null){try{if(Object.prototype.toString.call(e)==="[object Error]"){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class co extends Error{}class Ln extends co{constructor(t,o,r,a){super(`${Ln.makeMessage(t,o,r)}`),this.status=t,this.headers=a,this.error=o}static makeMessage(t,o,r){const a=o!=null&&o.message?typeof o.message=="string"?o.message:JSON.stringify(o.message):o?JSON.stringify(o):r;return t&&a?`${t} ${a}`:t?`${t} status code (no body)`:a||"(no status code or body)"}static generate(t,o,r,a){if(!t||!a)return new Yl({message:r,cause:fu(o)});const i=o;return t===400?new f1(t,i,r,a):t===401?new x1(t,i,r,a):t===403?new y1(t,i,r,a):t===404?new v1(t,i,r,a):t===409?new w1(t,i,r,a):t===422?new b1(t,i,r,a):t===429?new C1(t,i,r,a):t>=500?new k1(t,i,r,a):new Ln(t,i,r,a)}}class xu extends Ln{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}}class Yl extends Ln{constructor({message:t,cause:o}){super(void 0,void 0,t||"Connection error.",void 0),o&&(this.cause=o)}}class g1 extends Yl{constructor({message:t}={}){super({message:t??"Request timed out."})}}class f1 extends Ln{}class x1 extends Ln{}class y1 extends Ln{}class v1 extends Ln{}class w1 extends Ln{}class b1 extends Ln{}class C1 extends Ln{}class k1 extends Ln{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const PN=/^[a-z][a-z0-9+.-]*:/i,jN=e=>PN.test(e);let yu=e=>(yu=Array.isArray,yu(e));const TN=yu;let IN=TN;const Tg=IN;function AN(e){if(!e)return!0;for(const t in e)return!1;return!0}function MN(e,t){return Object.prototype.hasOwnProperty.call(e,t)}const RN=(e,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new co(`${e} must be an integer`);if(t<0)throw new co(`${e} must be a positive integer`);return t},LN=e=>{try{return JSON.parse(e)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const DN=e=>new Promise(t=>setTimeout(t,e));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const oa="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zN(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const qN=()=>{var e,t,o,r,a;const i=zN();if(i==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":oa,"X-Stainless-OS":Ag(Deno.build.os),"X-Stainless-Arch":Ig(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(t=(e=Deno.version)===null||e===void 0?void 0:e.deno)!==null&&t!==void 0?t:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":oa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(i==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":oa,"X-Stainless-OS":Ag((o=globalThis.process.platform)!==null&&o!==void 0?o:"unknown"),"X-Stainless-Arch":Ig((r=globalThis.process.arch)!==null&&r!==void 0?r:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(a=globalThis.process.version)!==null&&a!==void 0?a:"unknown"};const s=ON();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":oa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":oa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function ON(){if(typeof navigator>"u"||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:o}of e){const r=o.exec(navigator.userAgent);if(r){const a=r[1]||0,i=r[2]||0,s=r[3]||0;return{browser:t,version:`${a}.${i}.${s}`}}}return null}const Ig=e=>e==="x32"?"x32":e==="x86_64"||e==="x64"?"x64":e==="arm"?"arm":e==="aarch64"||e==="arm64"?"arm64":e?`other:${e}`:"unknown",Ag=e=>(e=e.toLowerCase(),e.includes("ios")?"iOS":e==="android"?"Android":e==="darwin"?"MacOS":e==="win32"?"Windows":e==="freebsd"?"FreeBSD":e==="openbsd"?"OpenBSD":e==="linux"?"Linux":e?`Other:${e}`:"Unknown");let ds;const FN=()=>ds??(ds=qN());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function BN(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function _1(...e){const t=globalThis.ReadableStream;if(typeof t>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function HN(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return _1({start(){},async pull(o){const{done:r,value:a}=await t.next();r?o.close():o.enqueue(a)},async cancel(){var o;await((o=t.return)===null||o===void 0?void 0:o.call(t))}})}function S1(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const o=await t.read();return o!=null&&o.done&&t.releaseLock(),o}catch(o){throw t.releaseLock(),o}},async return(){const o=t.cancel();return t.releaseLock(),await o,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function GN(e){var t,o;if(e===null||typeof e!="object")return;if(e[Symbol.asyncIterator]){await((o=(t=e[Symbol.asyncIterator]()).return)===null||o===void 0?void 0:o.call(t));return}const r=e.getReader(),a=r.cancel();r.releaseLock(),await a}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const UN=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const N1=()=>{var e;if(typeof File>"u"){const{process:t}=globalThis,o=typeof((e=t==null?void 0:t.versions)===null||e===void 0?void 0:e.node)=="string"&&parseInt(t.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(o?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function td(e,t,o){return N1(),new File(e,t??"unknown_file",o)}function VN(e){return(typeof e=="object"&&e!==null&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const WN=e=>e!=null&&typeof e=="object"&&typeof e[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const E1=e=>e!=null&&typeof e=="object"&&typeof e.size=="number"&&typeof e.type=="string"&&typeof e.text=="function"&&typeof e.slice=="function"&&typeof e.arrayBuffer=="function",$N=e=>e!=null&&typeof e=="object"&&typeof e.name=="string"&&typeof e.lastModified=="number"&&E1(e),KN=e=>e!=null&&typeof e=="object"&&typeof e.url=="string"&&typeof e.blob=="function";async function JN(e,t,o){if(N1(),e=await e,$N(e))return e instanceof File?e:td([await e.arrayBuffer()],e.name);if(KN(e)){const a=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),td(await vu(a),t,o)}const r=await vu(e);if(t||(t=VN(e)),!(o!=null&&o.type)){const a=r.find(i=>typeof i=="object"&&"type"in i&&i.type);typeof a=="string"&&(o=Object.assign(Object.assign({},o),{type:a}))}return td(r,t,o)}async function vu(e){var t,o,r,a,i;let s=[];if(typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)s.push(e);else if(E1(e))s.push(e instanceof Blob?e:await e.arrayBuffer());else if(WN(e))try{for(var l=!0,c=wo(e),d;d=await c.next(),t=d.done,!t;l=!0){a=d.value,l=!1;const u=a;s.push(...await vu(u))}}catch(u){o={error:u}}finally{try{!l&&!t&&(r=c.return)&&await r.call(c)}finally{if(o)throw o.error}}else{const u=(i=e==null?void 0:e.constructor)===null||i===void 0?void 0:i.name;throw new Error(`Unexpected data type: ${typeof e}${u?`; constructor: ${u}`:""}${YN(e)}`)}return s}function YN(e){return typeof e!="object"||e===null?"":`; props: [${Object.getOwnPropertyNames(e).map(o=>`"${o}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class P1{constructor(t){this._client=t}}P1._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function j1(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Mg=Object.freeze(Object.create(null)),ZN=(e=j1)=>function(o,...r){if(o.length===1)return o[0];let a=!1;const i=[],s=o.reduce((u,p,h)=>{var w,k,b;/[?#]/.test(p)&&(a=!0);const y=r[h];let g=(a?encodeURIComponent:e)(""+y);return h!==r.length&&(y==null||typeof y=="object"&&y.toString===((b=Object.getPrototypeOf((k=Object.getPrototypeOf((w=y.hasOwnProperty)!==null&&w!==void 0?w:Mg))!==null&&k!==void 0?k:Mg))===null||b===void 0?void 0:b.toString))&&(g=y+"",i.push({start:u.length+p.length,length:g.length,error:`Value of type ${Object.prototype.toString.call(y).slice(8,-1)} is not a valid path parameter`})),u+p+(h===r.length?"":g)},""),l=s.split(/[?#]/,1)[0],c=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let d;for(;(d=c.exec(l))!==null;)i.push({start:d.index,length:d[0].length,error:`Value "${d[0]}" can't be safely passed as a path parameter`});if(i.sort((u,p)=>u.start-p.start),i.length>0){let u=0;const p=i.reduce((h,w)=>{const k=" ".repeat(w.start-u),b="^".repeat(w.length);return u=w.start+w.length,h+k+b},"");throw new co(`Path parameters result in path with invalid segments:
${i.map(h=>h.error).join(`
`)}
${s}
${p}`)}return s},us=ZN(j1);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class T1 extends P1{create(t,o){var r;const{api_version:a=this._client.apiVersion}=t,i=Cl(t,["api_version"]);if("model"in i&&"agent_config"in i)throw new co("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in i&&"generation_config"in i)throw new co("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(us`/${a}/interactions`,Object.assign(Object.assign({body:i},o),{stream:(r=t.stream)!==null&&r!==void 0?r:!1}))}delete(t,o={},r){const{api_version:a=this._client.apiVersion}=o??{};return this._client.delete(us`/${a}/interactions/${t}`,r)}cancel(t,o={},r){const{api_version:a=this._client.apiVersion}=o??{};return this._client.post(us`/${a}/interactions/${t}/cancel`,r)}get(t,o={},r){var a;const i=o??{},{api_version:s=this._client.apiVersion}=i,l=Cl(i,["api_version"]);return this._client.get(us`/${s}/interactions/${t}`,Object.assign(Object.assign({query:l},r),{stream:(a=o==null?void 0:o.stream)!==null&&a!==void 0?a:!1}))}}T1._key=Object.freeze(["interactions"]);class I1 extends T1{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function XN(e){let t=0;for(const a of e)t+=a.length;const o=new Uint8Array(t);let r=0;for(const a of e)o.set(a,r),r+=a.length;return o}let ps;function Ap(e){let t;return(ps??(t=new globalThis.TextEncoder,ps=t.encode.bind(t)))(e)}let hs;function Rg(e){let t;return(hs??(t=new globalThis.TextDecoder,hs=t.decode.bind(t)))(e)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Zl{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(t){if(t==null)return[];const o=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?Ap(t):t;this.buffer=XN([this.buffer,o]);const r=[];let a;for(;(a=QN(this.buffer,this.carriageReturnIndex))!=null;){if(a.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=a.index;continue}if(this.carriageReturnIndex!=null&&(a.index!==this.carriageReturnIndex+1||a.carriage)){r.push(Rg(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const i=this.carriageReturnIndex!==null?a.preceding-1:a.preceding,s=Rg(this.buffer.subarray(0,i));r.push(s),this.buffer=this.buffer.subarray(a.index),this.carriageReturnIndex=null}return r}flush(){return this.buffer.length?this.decode(`
`):[]}}Zl.NEWLINE_CHARS=new Set([`
`,"\r"]);Zl.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function QN(e,t){for(let a=t??0;a<e.length;a++){if(e[a]===10)return{preceding:a,index:a+1,carriage:!1};if(e[a]===13)return{preceding:a,index:a+1,carriage:!0}}return null}function eE(e){for(let r=0;r<e.length-1;r++){if(e[r]===10&&e[r+1]===10||e[r]===13&&e[r+1]===13)return r+2;if(e[r]===13&&e[r+1]===10&&r+3<e.length&&e[r+2]===13&&e[r+3]===10)return r+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const kl={off:0,error:200,warn:300,info:400,debug:500},Lg=(e,t,o)=>{if(e){if(MN(kl,e))return e;In(o).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(kl))}`)}};function ii(){}function ms(e,t,o){return!t||kl[e]>kl[o]?ii:t[e].bind(t)}const tE={error:ii,warn:ii,info:ii,debug:ii};let Dg=new WeakMap;function In(e){var t;const o=e.logger,r=(t=e.logLevel)!==null&&t!==void 0?t:"off";if(!o)return tE;const a=Dg.get(o);if(a&&a[0]===r)return a[1];const i={error:ms("error",o,r),warn:ms("warn",o,r),info:ms("info",o,r),debug:ms("debug",o,r)};return Dg.set(o,[r,i]),i}const Ir=e=>(e.options&&(e.options=Object.assign({},e.options),delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([t,o])=>[t,t.toLowerCase()==="x-goog-api-key"||t.toLowerCase()==="authorization"||t.toLowerCase()==="cookie"||t.toLowerCase()==="set-cookie"?"***":o]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class xa{constructor(t,o,r){this.iterator=t,this.controller=o,this.client=r}static fromSSEResponse(t,o,r){let a=!1;const i=r?In(r):console;function s(){return vo(this,arguments,function*(){var c,d,u,p;if(a)throw new co("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let h=!1;try{try{for(var w=!0,k=wo(nE(t,o)),b;b=yield Et(k.next()),c=b.done,!c;w=!0){p=b.value,w=!1;const y=p;if(!h)if(y.data.startsWith("[DONE]")){h=!0;continue}else try{yield yield Et(JSON.parse(y.data))}catch(g){throw i.error("Could not parse message into JSON:",y.data),i.error("From chunk:",y.raw),g}}}catch(y){d={error:y}}finally{try{!w&&!c&&(u=k.return)&&(yield Et(u.call(k)))}finally{if(d)throw d.error}}h=!0}catch(y){if(gu(y))return yield Et(void 0);throw y}finally{h||o.abort()}})}return new xa(s,o,r)}static fromReadableStream(t,o,r){let a=!1;function i(){return vo(this,arguments,function*(){var c,d,u,p;const h=new Zl,w=S1(t);try{for(var k=!0,b=wo(w),y;y=yield Et(b.next()),c=y.done,!c;k=!0){p=y.value,k=!1;const g=p;for(const m of h.decode(g))yield yield Et(m)}}catch(g){d={error:g}}finally{try{!k&&!c&&(u=b.return)&&(yield Et(u.call(b)))}finally{if(d)throw d.error}}for(const g of h.flush())yield yield Et(g)})}function s(){return vo(this,arguments,function*(){var c,d,u,p;if(a)throw new co("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let h=!1;try{try{for(var w=!0,k=wo(i()),b;b=yield Et(k.next()),c=b.done,!c;w=!0){p=b.value,w=!1;const y=p;h||y&&(yield yield Et(JSON.parse(y)))}}catch(y){d={error:y}}finally{try{!w&&!c&&(u=k.return)&&(yield Et(u.call(k)))}finally{if(d)throw d.error}}h=!0}catch(y){if(gu(y))return yield Et(void 0);throw y}finally{h||o.abort()}})}return new xa(s,o,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){const t=[],o=[],r=this.iterator(),a=i=>({next:()=>{if(i.length===0){const s=r.next();t.push(s),o.push(s)}return i.shift()}});return[new xa(()=>a(t),this.controller,this.client),new xa(()=>a(o),this.controller,this.client)]}toReadableStream(){const t=this;let o;return _1({async start(){o=t[Symbol.asyncIterator]()},async pull(r){try{const{value:a,done:i}=await o.next();if(i)return r.close();const s=Ap(JSON.stringify(a)+`
`);r.enqueue(s)}catch(a){r.error(a)}},async cancel(){var r;await((r=o.return)===null||r===void 0?void 0:r.call(o))}})}}function nE(e,t){return vo(this,arguments,function*(){var r,a,i,s;if(!e.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new co("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new co("Attempted to iterate over a response with no body");const l=new rE,c=new Zl,d=S1(e.body);try{for(var u=!0,p=wo(oE(d)),h;h=yield Et(p.next()),r=h.done,!r;u=!0){s=h.value,u=!1;const w=s;for(const k of c.decode(w)){const b=l.decode(k);b&&(yield yield Et(b))}}}catch(w){a={error:w}}finally{try{!u&&!r&&(i=p.return)&&(yield Et(i.call(p)))}finally{if(a)throw a.error}}for(const w of c.flush()){const k=l.decode(w);k&&(yield yield Et(k))}})}function oE(e){return vo(this,arguments,function*(){var o,r,a,i;let s=new Uint8Array;try{for(var l=!0,c=wo(e),d;d=yield Et(c.next()),o=d.done,!o;l=!0){i=d.value,l=!1;const u=i;if(u==null)continue;const p=u instanceof ArrayBuffer?new Uint8Array(u):typeof u=="string"?Ap(u):u;let h=new Uint8Array(s.length+p.length);h.set(s),h.set(p,s.length),s=h;let w;for(;(w=eE(s))!==-1;)yield yield Et(s.slice(0,w)),s=s.slice(w)}}catch(u){r={error:u}}finally{try{!l&&!o&&(a=c.return)&&(yield Et(a.call(c)))}finally{if(r)throw r.error}}s.length>0&&(yield yield Et(s))})}class rE{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(t),t.startsWith(":"))return null;let[o,r,a]=aE(t,":");return a.startsWith(" ")&&(a=a.substring(1)),o==="event"?this.event=a:o==="data"&&this.data.push(a),null}}function aE(e,t){const o=e.indexOf(t);return o!==-1?[e.substring(0,o),t,e.substring(o+t.length)]:[e,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function iE(e,t){const{response:o,requestLogID:r,retryOfRequestLogID:a,startTime:i}=t,s=await(async()=>{var l;if(t.options.stream)return In(e).debug("response",o.status,o.url,o.headers,o.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(o,t.controller,e):xa.fromSSEResponse(o,t.controller,e);if(o.status===204)return null;if(t.options.__binaryResponse)return o;const c=o.headers.get("content-type"),d=(l=c==null?void 0:c.split(";")[0])===null||l===void 0?void 0:l.trim();return(d==null?void 0:d.includes("application/json"))||(d==null?void 0:d.endsWith("+json"))?await o.json():await o.text()})();return In(e).debug(`[${r}] response parsed`,Ir({retryOfRequestLogID:a,url:o.url,status:o.status,body:s,durationMs:Date.now()-i})),s}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Mp extends Promise{constructor(t,o,r=iE){super(a=>{a(null)}),this.responsePromise=o,this.parseResponse=r,this.client=t}_thenUnwrap(t){return new Mp(this.client,this.responsePromise,async(o,r)=>t(await this.parseResponse(o,r),r))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){const[t,o]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:o}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(t=>this.parseResponse(this.client,t))),this.parsedPromise}then(t,o){return this.parse().then(t,o)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const A1=Symbol("brand.privateNullableHeaders");function*sE(e){if(!e)return;if(A1 in e){const{values:r,nulls:a}=e;yield*r.entries();for(const i of a)yield[i,null];return}let t=!1,o;e instanceof Headers?o=e.entries():Tg(e)?o=e:(t=!0,o=Object.entries(e??{}));for(let r of o){const a=r[0];if(typeof a!="string")throw new TypeError("expected header name to be a string");const i=Tg(r[1])?r[1]:[r[1]];let s=!1;for(const l of i)l!==void 0&&(t&&!s&&(s=!0,yield[a,null]),yield[a,l])}}const ti=e=>{const t=new Headers,o=new Set;for(const r of e){const a=new Set;for(const[i,s]of sE(r)){const l=i.toLowerCase();a.has(l)||(t.delete(i),a.add(l)),s===null?(t.delete(i),o.add(l)):(t.append(i,s),o.delete(l))}}return{[A1]:!0,values:t,nulls:o}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const nd=e=>{var t,o,r,a,i,s;if(typeof globalThis.process<"u")return(r=(o=(t=MC)===null||t===void 0?void 0:t[e])===null||o===void 0?void 0:o.trim())!==null&&r!==void 0?r:void 0;if(typeof globalThis.Deno<"u")return(s=(i=(a=globalThis.Deno.env)===null||a===void 0?void 0:a.get)===null||i===void 0?void 0:i.call(a,e))===null||s===void 0?void 0:s.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var M1;class Xl{constructor(t){var o,r,a,i,s,l,c,{baseURL:d=nd("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:u=(o=nd("GEMINI_API_KEY"))!==null&&o!==void 0?o:null,apiVersion:p="v1beta"}=t,h=Cl(t,["baseURL","apiKey","apiVersion"]);const w=Object.assign(Object.assign({apiKey:u,apiVersion:p},h),{baseURL:d||"https://generativelanguage.googleapis.com"});this.baseURL=w.baseURL,this.timeout=(r=w.timeout)!==null&&r!==void 0?r:Xl.DEFAULT_TIMEOUT,this.logger=(a=w.logger)!==null&&a!==void 0?a:console;const k="warn";this.logLevel=k,this.logLevel=(s=(i=Lg(w.logLevel,"ClientOptions.logLevel",this))!==null&&i!==void 0?i:Lg(nd("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&s!==void 0?s:k,this.fetchOptions=w.fetchOptions,this.maxRetries=(l=w.maxRetries)!==null&&l!==void 0?l:2,this.fetch=(c=w.fetch)!==null&&c!==void 0?c:BN(),this.encoder=UN,this._options=w,this.apiKey=u,this.apiVersion=p,this.clientAdapter=w.clientAdapter}withOptions(t){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),t))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:o}){if(!(t.has("authorization")||t.has("x-goog-api-key"))&&!(this.apiKey&&t.get("x-goog-api-key"))&&!o.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(t){const o=ti([t.headers]);if(!(o.values.has("authorization")||o.values.has("x-goog-api-key"))){if(this.apiKey)return ti([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return ti([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(t){return Object.entries(t).filter(([o,r])=>typeof r<"u").map(([o,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(o)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(o)}=`;throw new co(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${oa}`}defaultIdempotencyKey(){return`stainless-node-retry-${EN()}`}makeStatusError(t,o,r,a){return Ln.generate(t,o,r,a)}buildURL(t,o,r){const a=!this.baseURLOverridden()&&r||this.baseURL,i=jN(t)?new URL(t):new URL(a+(a.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),s=this.defaultQuery();return AN(s)||(o=Object.assign(Object.assign({},s),o)),typeof o=="object"&&o&&!Array.isArray(o)&&(i.search=this.stringifyQuery(o)),i.toString()}async prepareOptions(t){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!t.path.startsWith(`/${this.apiVersion}/projects/`)){const o=t.path.slice(this.apiVersion.length+1);t.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${o}`}}async prepareRequest(t,{url:o,options:r}){}get(t,o){return this.methodRequest("get",t,o)}post(t,o){return this.methodRequest("post",t,o)}patch(t,o){return this.methodRequest("patch",t,o)}put(t,o){return this.methodRequest("put",t,o)}delete(t,o){return this.methodRequest("delete",t,o)}methodRequest(t,o,r){return this.request(Promise.resolve(r).then(a=>Object.assign({method:t,path:o},a)))}request(t,o=null){return new Mp(this,this.makeRequest(t,o,void 0))}async makeRequest(t,o,r){var a,i,s;const l=await t,c=(a=l.maxRetries)!==null&&a!==void 0?a:this.maxRetries;o==null&&(o=c),await this.prepareOptions(l);const{req:d,url:u,timeout:p}=await this.buildRequest(l,{retryCount:c-o});await this.prepareRequest(d,{url:u,options:l});const h="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),w=r===void 0?"":`, retryOf: ${r}`,k=Date.now();if(In(this).debug(`[${h}] sending request`,Ir({retryOfRequestLogID:r,method:l.method,url:u,options:l,headers:d.headers})),!((i=l.signal)===null||i===void 0)&&i.aborted)throw new xu;const b=new AbortController,y=await this.fetchWithTimeout(u,d,p,b).catch(fu),g=Date.now();if(y instanceof globalThis.Error){const x=`retrying, ${o} attempts remaining`;if(!((s=l.signal)===null||s===void 0)&&s.aborted)throw new xu;const _=gu(y)||/timed? ?out/i.test(String(y)+("cause"in y?String(y.cause):""));if(o)return In(this).info(`[${h}] connection ${_?"timed out":"failed"} - ${x}`),In(this).debug(`[${h}] connection ${_?"timed out":"failed"} (${x})`,Ir({retryOfRequestLogID:r,url:u,durationMs:g-k,message:y.message})),this.retryRequest(l,o,r??h);throw In(this).info(`[${h}] connection ${_?"timed out":"failed"} - error; no more retries left`),In(this).debug(`[${h}] connection ${_?"timed out":"failed"} (error; no more retries left)`,Ir({retryOfRequestLogID:r,url:u,durationMs:g-k,message:y.message})),_?new g1:new Yl({cause:y})}const m=`[${h}${w}] ${d.method} ${u} ${y.ok?"succeeded":"failed"} with status ${y.status} in ${g-k}ms`;if(!y.ok){const x=await this.shouldRetry(y);if(o&&x){const D=`retrying, ${o} attempts remaining`;return await GN(y.body),In(this).info(`${m} - ${D}`),In(this).debug(`[${h}] response error (${D})`,Ir({retryOfRequestLogID:r,url:y.url,status:y.status,headers:y.headers,durationMs:g-k})),this.retryRequest(l,o,r??h,y.headers)}const _=x?"error; no more retries left":"error; not retryable";In(this).info(`${m} - ${_}`);const S=await y.text().catch(D=>fu(D).message),P=LN(S),j=P?void 0:S;throw In(this).debug(`[${h}] response error (${_})`,Ir({retryOfRequestLogID:r,url:y.url,status:y.status,headers:y.headers,message:j,durationMs:Date.now()-k})),this.makeStatusError(y.status,P,j,y.headers)}return In(this).info(m),In(this).debug(`[${h}] response start`,Ir({retryOfRequestLogID:r,url:y.url,status:y.status,headers:y.headers,durationMs:g-k})),{response:y,options:l,controller:b,requestLogID:h,retryOfRequestLogID:r,startTime:k}}async fetchWithTimeout(t,o,r,a){const i=o||{},{signal:s,method:l}=i,c=Cl(i,["signal","method"]);s&&s.addEventListener("abort",()=>a.abort());const d=setTimeout(()=>a.abort(),r),u=globalThis.ReadableStream&&c.body instanceof globalThis.ReadableStream||typeof c.body=="object"&&c.body!==null&&Symbol.asyncIterator in c.body,p=Object.assign(Object.assign(Object.assign({signal:a.signal},u?{duplex:"half"}:{}),{method:"GET"}),c);l&&(p.method=l.toUpperCase());try{return await this.fetch.call(void 0,t,p)}finally{clearTimeout(d)}}async shouldRetry(t){const o=t.headers.get("x-should-retry");return o==="true"?!0:o==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,o,r,a){var i;let s;const l=a==null?void 0:a.get("retry-after-ms");if(l){const d=parseFloat(l);Number.isNaN(d)||(s=d)}const c=a==null?void 0:a.get("retry-after");if(c&&!s){const d=parseFloat(c);Number.isNaN(d)?s=Date.parse(c)-Date.now():s=d*1e3}if(!(s&&0<=s&&s<60*1e3)){const d=(i=t.maxRetries)!==null&&i!==void 0?i:this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(o,d)}return await DN(s),this.makeRequest(t,o-1,r)}calculateDefaultRetryTimeoutMillis(t,o){const i=o-t,s=Math.min(.5*Math.pow(2,i),8),l=1-Math.random()*.25;return s*l*1e3}async buildRequest(t,{retryCount:o=0}={}){var r,a,i;const s=Object.assign({},t),{method:l,path:c,query:d,defaultBaseURL:u}=s,p=this.buildURL(c,d,u);"timeout"in s&&RN("timeout",s.timeout),s.timeout=(r=s.timeout)!==null&&r!==void 0?r:this.timeout;const{bodyHeaders:h,body:w}=this.buildBody({options:s}),k=await this.buildHeaders({options:t,method:l,bodyHeaders:h,retryCount:o});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:l,headers:k},s.signal&&{signal:s.signal}),globalThis.ReadableStream&&w instanceof globalThis.ReadableStream&&{duplex:"half"}),w&&{body:w}),(a=this.fetchOptions)!==null&&a!==void 0?a:{}),(i=s.fetchOptions)!==null&&i!==void 0?i:{}),url:p,timeout:s.timeout}}async buildHeaders({options:t,method:o,bodyHeaders:r,retryCount:a}){let i={};this.idempotencyHeader&&o!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=t.idempotencyKey);const s=await this.authHeaders(t);let l=ti([i,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(a)},t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{}),FN()),this._options.defaultHeaders,r,t.headers,s]);return this.validateHeaders(l),l.values}buildBody({options:{body:t,headers:o}}){if(!t)return{bodyHeaders:void 0,body:void 0};const r=ti([o]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&r.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:HN(t)}:this.encoder({body:t,headers:r})}}Xl.DEFAULT_TIMEOUT=6e4;class yn extends Xl{constructor(){super(...arguments),this.interactions=new I1(this)}}M1=yn;yn.GeminiNextGenAPIClient=M1;yn.GeminiNextGenAPIClientError=co;yn.APIError=Ln;yn.APIConnectionError=Yl;yn.APIConnectionTimeoutError=g1;yn.APIUserAbortError=xu;yn.NotFoundError=v1;yn.ConflictError=w1;yn.RateLimitError=C1;yn.BadRequestError=f1;yn.AuthenticationError=x1;yn.InternalServerError=k1;yn.PermissionDeniedError=y1;yn.UnprocessableEntityError=b1;yn.toFile=JN;yn.Interactions=I1;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function lE(e,t){const o={},r=f(e,["name"]);return r!=null&&C(o,["_url","name"],r),o}function cE(e,t){const o={},r=f(e,["name"]);return r!=null&&C(o,["_url","name"],r),o}function dE(e,t){const o={},r=f(e,["sdkHttpResponse"]);return r!=null&&C(o,["sdkHttpResponse"],r),o}function uE(e,t){const o={},r=f(e,["sdkHttpResponse"]);return r!=null&&C(o,["sdkHttpResponse"],r),o}function pE(e,t,o){const r={};if(f(e,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const a=f(e,["tunedModelDisplayName"]);if(t!==void 0&&a!=null&&C(t,["displayName"],a),f(e,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const i=f(e,["epochCount"]);t!==void 0&&i!=null&&C(t,["tuningTask","hyperparameters","epochCount"],i);const s=f(e,["learningRateMultiplier"]);if(s!=null&&C(r,["tuningTask","hyperparameters","learningRateMultiplier"],s),f(e,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(f(e,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(f(e,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const l=f(e,["batchSize"]);t!==void 0&&l!=null&&C(t,["tuningTask","hyperparameters","batchSize"],l);const c=f(e,["learningRate"]);if(t!==void 0&&c!=null&&C(t,["tuningTask","hyperparameters","learningRate"],c),f(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(f(e,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return r}function hE(e,t,o){const r={};let a=f(o,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const w=f(e,["validationDataset"]);t!==void 0&&w!=null&&C(t,["supervisedTuningSpec"],zg(w))}else if(a==="PREFERENCE_TUNING"){const w=f(e,["validationDataset"]);t!==void 0&&w!=null&&C(t,["preferenceOptimizationSpec"],zg(w))}const i=f(e,["tunedModelDisplayName"]);t!==void 0&&i!=null&&C(t,["tunedModelDisplayName"],i);const s=f(e,["description"]);t!==void 0&&s!=null&&C(t,["description"],s);let l=f(o,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){const w=f(e,["epochCount"]);t!==void 0&&w!=null&&C(t,["supervisedTuningSpec","hyperParameters","epochCount"],w)}else if(l==="PREFERENCE_TUNING"){const w=f(e,["epochCount"]);t!==void 0&&w!=null&&C(t,["preferenceOptimizationSpec","hyperParameters","epochCount"],w)}let c=f(o,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){const w=f(e,["learningRateMultiplier"]);t!==void 0&&w!=null&&C(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],w)}else if(c==="PREFERENCE_TUNING"){const w=f(e,["learningRateMultiplier"]);t!==void 0&&w!=null&&C(t,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],w)}let d=f(o,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const w=f(e,["exportLastCheckpointOnly"]);t!==void 0&&w!=null&&C(t,["supervisedTuningSpec","exportLastCheckpointOnly"],w)}else if(d==="PREFERENCE_TUNING"){const w=f(e,["exportLastCheckpointOnly"]);t!==void 0&&w!=null&&C(t,["preferenceOptimizationSpec","exportLastCheckpointOnly"],w)}let u=f(o,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const w=f(e,["adapterSize"]);t!==void 0&&w!=null&&C(t,["supervisedTuningSpec","hyperParameters","adapterSize"],w)}else if(u==="PREFERENCE_TUNING"){const w=f(e,["adapterSize"]);t!==void 0&&w!=null&&C(t,["preferenceOptimizationSpec","hyperParameters","adapterSize"],w)}if(f(e,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(f(e,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const p=f(e,["labels"]);t!==void 0&&p!=null&&C(t,["labels"],p);const h=f(e,["beta"]);return t!==void 0&&h!=null&&C(t,["preferenceOptimizationSpec","hyperParameters","beta"],h),r}function mE(e,t){const o={},r=f(e,["baseModel"]);r!=null&&C(o,["baseModel"],r);const a=f(e,["preTunedModel"]);a!=null&&C(o,["preTunedModel"],a);const i=f(e,["trainingDataset"]);i!=null&&SE(i);const s=f(e,["config"]);return s!=null&&pE(s,o),o}function gE(e,t){const o={},r=f(e,["baseModel"]);r!=null&&C(o,["baseModel"],r);const a=f(e,["preTunedModel"]);a!=null&&C(o,["preTunedModel"],a);const i=f(e,["trainingDataset"]);i!=null&&NE(i,o,t);const s=f(e,["config"]);return s!=null&&hE(s,o,t),o}function fE(e,t){const o={},r=f(e,["name"]);return r!=null&&C(o,["_url","name"],r),o}function xE(e,t){const o={},r=f(e,["name"]);return r!=null&&C(o,["_url","name"],r),o}function yE(e,t,o){const r={},a=f(e,["pageSize"]);t!==void 0&&a!=null&&C(t,["_query","pageSize"],a);const i=f(e,["pageToken"]);t!==void 0&&i!=null&&C(t,["_query","pageToken"],i);const s=f(e,["filter"]);return t!==void 0&&s!=null&&C(t,["_query","filter"],s),r}function vE(e,t,o){const r={},a=f(e,["pageSize"]);t!==void 0&&a!=null&&C(t,["_query","pageSize"],a);const i=f(e,["pageToken"]);t!==void 0&&i!=null&&C(t,["_query","pageToken"],i);const s=f(e,["filter"]);return t!==void 0&&s!=null&&C(t,["_query","filter"],s),r}function wE(e,t){const o={},r=f(e,["config"]);return r!=null&&yE(r,o),o}function bE(e,t){const o={},r=f(e,["config"]);return r!=null&&vE(r,o),o}function CE(e,t){const o={},r=f(e,["sdkHttpResponse"]);r!=null&&C(o,["sdkHttpResponse"],r);const a=f(e,["nextPageToken"]);a!=null&&C(o,["nextPageToken"],a);const i=f(e,["tunedModels"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>R1(l))),C(o,["tuningJobs"],s)}return o}function kE(e,t){const o={},r=f(e,["sdkHttpResponse"]);r!=null&&C(o,["sdkHttpResponse"],r);const a=f(e,["nextPageToken"]);a!=null&&C(o,["nextPageToken"],a);const i=f(e,["tuningJobs"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>wu(l))),C(o,["tuningJobs"],s)}return o}function _E(e,t){const o={},r=f(e,["name"]);r!=null&&C(o,["model"],r);const a=f(e,["name"]);return a!=null&&C(o,["endpoint"],a),o}function SE(e,t){const o={};if(f(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(f(e,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const r=f(e,["examples"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>i)),C(o,["examples","examples"],a)}return o}function NE(e,t,o){const r={};let a=f(o,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const s=f(e,["gcsUri"]);t!==void 0&&s!=null&&C(t,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(a==="PREFERENCE_TUNING"){const s=f(e,["gcsUri"]);t!==void 0&&s!=null&&C(t,["preferenceOptimizationSpec","trainingDatasetUri"],s)}let i=f(o,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const s=f(e,["vertexDatasetResource"]);t!==void 0&&s!=null&&C(t,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(i==="PREFERENCE_TUNING"){const s=f(e,["vertexDatasetResource"]);t!==void 0&&s!=null&&C(t,["preferenceOptimizationSpec","trainingDatasetUri"],s)}if(f(e,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return r}function R1(e,t){const o={},r=f(e,["sdkHttpResponse"]);r!=null&&C(o,["sdkHttpResponse"],r);const a=f(e,["name"]);a!=null&&C(o,["name"],a);const i=f(e,["state"]);i!=null&&C(o,["state"],Yx(i));const s=f(e,["createTime"]);s!=null&&C(o,["createTime"],s);const l=f(e,["tuningTask","startTime"]);l!=null&&C(o,["startTime"],l);const c=f(e,["tuningTask","completeTime"]);c!=null&&C(o,["endTime"],c);const d=f(e,["updateTime"]);d!=null&&C(o,["updateTime"],d);const u=f(e,["description"]);u!=null&&C(o,["description"],u);const p=f(e,["baseModel"]);p!=null&&C(o,["baseModel"],p);const h=f(e,["_self"]);return h!=null&&C(o,["tunedModel"],_E(h)),o}function wu(e,t){const o={},r=f(e,["sdkHttpResponse"]);r!=null&&C(o,["sdkHttpResponse"],r);const a=f(e,["name"]);a!=null&&C(o,["name"],a);const i=f(e,["state"]);i!=null&&C(o,["state"],Yx(i));const s=f(e,["createTime"]);s!=null&&C(o,["createTime"],s);const l=f(e,["startTime"]);l!=null&&C(o,["startTime"],l);const c=f(e,["endTime"]);c!=null&&C(o,["endTime"],c);const d=f(e,["updateTime"]);d!=null&&C(o,["updateTime"],d);const u=f(e,["error"]);u!=null&&C(o,["error"],u);const p=f(e,["description"]);p!=null&&C(o,["description"],p);const h=f(e,["baseModel"]);h!=null&&C(o,["baseModel"],h);const w=f(e,["tunedModel"]);w!=null&&C(o,["tunedModel"],w);const k=f(e,["preTunedModel"]);k!=null&&C(o,["preTunedModel"],k);const b=f(e,["supervisedTuningSpec"]);b!=null&&C(o,["supervisedTuningSpec"],b);const y=f(e,["preferenceOptimizationSpec"]);y!=null&&C(o,["preferenceOptimizationSpec"],y);const g=f(e,["tuningDataStats"]);g!=null&&C(o,["tuningDataStats"],g);const m=f(e,["encryptionSpec"]);m!=null&&C(o,["encryptionSpec"],m);const x=f(e,["partnerModelTuningSpec"]);x!=null&&C(o,["partnerModelTuningSpec"],x);const _=f(e,["customBaseModel"]);_!=null&&C(o,["customBaseModel"],_);const S=f(e,["experiment"]);S!=null&&C(o,["experiment"],S);const P=f(e,["labels"]);P!=null&&C(o,["labels"],P);const j=f(e,["outputUri"]);j!=null&&C(o,["outputUri"],j);const M=f(e,["pipelineJob"]);M!=null&&C(o,["pipelineJob"],M);const D=f(e,["serviceAccount"]);D!=null&&C(o,["serviceAccount"],D);const O=f(e,["tunedModelDisplayName"]);O!=null&&C(o,["tunedModelDisplayName"],O);const B=f(e,["veoTuningSpec"]);return B!=null&&C(o,["veoTuningSpec"],B),o}function EE(e,t){const o={},r=f(e,["sdkHttpResponse"]);r!=null&&C(o,["sdkHttpResponse"],r);const a=f(e,["name"]);a!=null&&C(o,["name"],a);const i=f(e,["metadata"]);i!=null&&C(o,["metadata"],i);const s=f(e,["done"]);s!=null&&C(o,["done"],s);const l=f(e,["error"]);return l!=null&&C(o,["error"],l),o}function zg(e,t){const o={},r=f(e,["gcsUri"]);r!=null&&C(o,["validationDatasetUri"],r);const a=f(e,["vertexDatasetResource"]);return a!=null&&C(o,["validationDatasetUri"],a),o}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class PE extends Jo{constructor(t){super(),this.apiClient=t,this.list=async(o={})=>new Wr($o.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(o),o),this.get=async o=>await this.getInternal(o),this.tune=async o=>{var r;if(this.apiClient.isVertexAI())if(o.baseModel.startsWith("projects/")){const a={tunedModelName:o.baseModel};!((r=o.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(a.checkpointId=o.config.preTunedModelCheckpointId);const i=Object.assign(Object.assign({},o),{preTunedModel:a});return i.baseModel=void 0,await this.tuneInternal(i)}else{const a=Object.assign({},o);return await this.tuneInternal(a)}else{const a=Object.assign({},o),i=await this.tuneMldevInternal(a);let s="";return i.metadata!==void 0&&i.metadata.tunedModel!==void 0?s=i.metadata.tunedModel:i.name!==void 0&&i.name.includes("/operations/")&&(s=i.name.split("/operations/")[0]),{name:s,state:lu.JOB_STATE_QUEUED}}}}async getInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=xE(t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>wu(u))}else{const d=fE(t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>R1(u))}}async listInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=bE(t);return l=it("tuningJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=kE(u),h=new cg;return Object.assign(h,p),h})}else{const d=wE(t);return l=it("tunedModels",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=CE(u),h=new cg;return Object.assign(h,p),h})}}async cancel(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=cE(t);return l=it("{name}:cancel",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=uE(u),h=new dg;return Object.assign(h,p),h})}else{const d=lE(t);return l=it("{name}:cancel",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=dE(u),h=new dg;return Object.assign(h,p),h})}}async tuneInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=gE(t,t);return i=it("tuningJobs",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>wu(c))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=mE(t);return i=it("tunedModels",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>EE(c))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class jE{async download(t,o){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const TE=1024*1024*8,IE=3,AE=1e3,ME=2,_l="x-goog-upload-status";async function RE(e,t,o){var r;const a=await L1(e,t,o),i=await(a==null?void 0:a.json());if(((r=a==null?void 0:a.headers)===null||r===void 0?void 0:r[_l])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return i.file}async function LE(e,t,o){var r;const a=await L1(e,t,o),i=await(a==null?void 0:a.json());if(((r=a==null?void 0:a.headers)===null||r===void 0?void 0:r[_l])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const s=Ux(i),l=new Np;return Object.assign(l,s),l}async function L1(e,t,o){var r,a;let i=0,s=0,l=new cu(new Response),c="upload";for(i=e.size;s<i;){const d=Math.min(TE,i-s),u=e.slice(s,s+d);s+d>=i&&(c+=", finalize");let p=0,h=AE;for(;p<IE&&(l=await o.request({path:"",body:u,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(s),"Content-Length":String(d)}}}),!(!((r=l==null?void 0:l.headers)===null||r===void 0)&&r[_l]));)p++,await zE(h),h=h*ME;if(s+=d,((a=l==null?void 0:l.headers)===null||a===void 0?void 0:a[_l])!=="active")break;if(i<=s)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return l}async function DE(e){return{size:e.size,type:e.type}}function zE(e){return new Promise(t=>setTimeout(t,e))}class qE{async upload(t,o,r){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await RE(t,o,r)}async uploadToFileSearchStore(t,o,r){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await LE(t,o,r)}async stat(t){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await DE(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class OE{create(t,o,r){return new FE(t,o,r)}}class FE{constructor(t,o,r){this.url=t,this.headers=o,this.callbacks=r}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(t){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(t)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const qg="x-goog-api-key";class BE{constructor(t){this.apiKey=t}async addAuthHeaders(t,o){if(t.get(qg)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");t.append(qg,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const HE="gl-node/";class Rp{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const t=this.httpOptions;t!=null&&t.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const o=new yn({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:t==null?void 0:t.timeout});return this._interactions=o.interactions,this._interactions}constructor(t){var o;if(t.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(t.project||t.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(o=t.vertexai)!==null&&o!==void 0?o:!1,this.apiKey=t.apiKey;const r=zC(t.httpOptions,t.vertexai,void 0,void 0);r&&(t.httpOptions?t.httpOptions.baseUrl=r:t.httpOptions={baseUrl:r}),this.apiVersion=t.apiVersion,this.httpOptions=t.httpOptions;const a=new BE(this.apiKey);this.apiClient=new DS({auth:a,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:HE+"web",uploader:new qE,downloader:new jE}),this.models=new tN(this.apiClient),this.live=new JS(this.apiClient,a,new OE),this.batches=new pk(this.apiClient),this.chats=new $k(this.models,this.apiClient),this.caches=new Uk(this.apiClient),this.files=new o4(this.apiClient),this.operations=new nN(this.apiClient),this.authTokens=new yN(this.apiClient),this.tunings=new PE(this.apiClient),this.fileSearchStores=new NN(this.apiClient)}}const Ql=()=>{const e=localStorage.getItem("settings_useDevKey")==="true",t=localStorage.getItem("settings_userApiKey");if(!e)return t||void 0},hn=()=>{const e=Ql();if(!e)throw new Error("API Key is missing. Please check your settings or environment variables.");return new Rp({apiKey:e})},mn=async(e,t=3,o=1e3)=>{for(let r=0;r<t;r++)try{return await e()}catch(a){const i=a.status||a.code;if(!(i===503||i===429||a.message&&a.message.toLowerCase().includes("overloaded"))||r===t-1)throw a;const l=o*Math.pow(2,r);console.warn(`Gemini API overloaded (503). Retrying in ${l}ms... (Attempt ${r+1}/${t})`),await new Promise(c=>setTimeout(c,l))}throw new Error("Max retries reached")},D1=async(e,t,o)=>mn(async()=>{const r=hn(),a=e.filter(d=>d&&d.trim()!=="");if(a.length===0)return"High-quality masterpiece, 8k, detailed textures, cinematic lighting.";const i=a.join(", "),s=t?"STRICT REQUIREMENT: Zero trademarked terms, brand names, or specific artist identities. Use generic descriptive artistic terminology only.":"";let l="";o?l=`
        You are a technical prompt architect for generative AI imaging systems. 
        Your task is to aggregate the provided concepts into a singular, high-precision technical specification string.

        GUIDELINES:
        - Use structured technical language.
        - Specify precise attributes: [Subject topology], [Material properties/textures], [Physical lighting parameters], [Optical camera settings], [Render engine characteristics].
        - ABSOLUTELY NO flowery, poetic, or evocative adjectives (e.g., avoid "beautiful", "mysterious").
        - Combine all concepts into a cohesive, high-density technical instruction set.
        - ${s}
        - Output ONLY the final technical string. No introductions, no markdown blocks.
      `:l=`
        You are an expert prompt engineer for high-end AI image generation.
        Your goal is to transform the user's basic concepts into a rich, descriptive, and highly aesthetic image prompt.
        
        GUIDELINES:
        - Use evocative language and sensory details.
        - Describe lighting, mood, atmosphere, and artistic style in detail.
        - Ensure the output is a single, cohesive paragraph optimized for high-quality results.
        - ${s}
        - Output ONLY the enhanced prompt. No introductions, no markdown.
      `;const c=`Concepts to process: ${i}`;try{return(await r.models.generateContent({model:"gemini-3-flash-preview",contents:c,config:{systemInstruction:l}})).text||""}catch(d){throw console.error("Error processing prompt:",d),d}}),z1=async e=>mn(async()=>{const t=hn();if(!e||e.trim()==="")return"";const o="You are a prompt safety expert. Rewrite the user's prompt to be safer for image generation policies while preserving artistic intent. Replace age-specific terms (teenager, child) with neutral terms (young person, figure). Output only the sanitized prompt.";try{return(await t.models.generateContent({model:"gemini-3-flash-preview",contents:`Sanitize: "${e}"`,config:{systemInstruction:o}})).text||""}catch(r){throw console.error("Error sanitizing prompt:",r),r}}),q1=async e=>mn(async()=>{const t=hn(),o=e.filter(i=>i&&i.trim()!=="");if(o.length===0)return"A cinematic video, 4k, high resolution.";const a=`
      You are an expert video prompt engineer. Combine these concepts into a single, cohesive, detailed video prompt.
      Describe the scene, subjects, actions, camera movements, and lighting.
      Output only the prompt.
      
      Concepts: ${o.join(", ")}
    `;try{return(await t.models.generateContent({model:"gemini-3-flash-preview",contents:a})).text||""}catch(i){throw console.error("Error enhancing video prompt:",i),i}}),O1=async(e,t)=>mn(async()=>{const o=hn();if(!e||e.trim()==="")throw new Error("Input prompt for analysis cannot be empty.");const a=`
      ${t?"Important: When analyzing, formulate descriptions to be as neutral and safe as possible. Avoid potentially sensitive, intimate, or age-specific terms (like 'teenager', 'boy', 'girl'). Instead, use more general, age-ambiguous descriptions (like 'young person', 'figure', 'youthful character') while preserving the core artistic details and intent.":""}
      You are a meticulous and detailed prompt analyzer. Your task is to analyze the following text and deconstruct it into five distinct, comprehensive components. Do not summarize or shorten the information; instead, extract and organize all relevant details for each component.

      1.  **Environment/Setting**: Extract a complete and detailed description of the environment, setting, or background. Include all mentioned elements, atmosphere, lighting, time of day, and any contextual details. Crucially, also include descriptions of any secondary, background, or non-focal characters here (e.g., 'a crowd of people in the distance', 'birds flying in the sky').
      
      2.  **Characters/Subjects**: Identify and list ONLY the key, main, or foreground characters/subjects. Do NOT include background, secondary, or minor characters in this list. 
          For each main character, extract a detailed **physical description only**. 
          CRITICAL: **Exclude** all descriptions of actions (e.g., running, fighting, sitting), poses, and the surrounding environment/background. 
          Focus strictly on physical appearance, facial features, body type, hair, clothing, armor, and equipment/held items. The goal is to describe the character purely as they look, as if they were a 3D model or concept art asset in isolation.
          IMPORTANT: Append ", grey background, character concept" to the end of each character description. For example, if the text says "a hero fighting a dragon in a cave", the character entry for the hero should be "a hero in shining armor, detailed face, muscular build, grey background, character concept" (removing 'fighting' and 'cave').

      3.  **Action**: Describe the action being performed by the main characters in full detail. Generalize the subjects by replacing specific character names or descriptions with neutral terms such as "the character(s)" or "the subject(s)". The description of the action itself must be comprehensive and include all associated details.
      
      4.  **Emotion**: Describe the emotion being expressed by the main character(s) in general terms, detached from the specific subjects. For example, 'The character(s) are experiencing joy,' 'The subject(s) show signs of fear,' or 'A sense of wonder is being conveyed.' If no emotion is explicitly mentioned, infer a plausible one from the context of the action and environment. Focus on the feeling itself.
      
      5.  **Style**: CRITICAL: Your description for this category MUST be completely detached from the specific subjects and environment of the prompt. Analyze and describe ONLY the artistic essence. Focus on abstract elements like: art medium (e.g., photorealistic, oil painting, 3D render, anime, watercolor), mood (e.g., mysterious, cheerful, epic, melancholic), color palette (e.g., vibrant warm tones, monochromatic cool colors, pastel), lighting style (e.g., dramatic, soft, neon, chiaroscuro), composition (e.g., close-up, wide shot, rule of thirds), and artistic techniques (e.g., impressionistic brush strokes, sharp focus, cel shading). Under NO circumstances should you mention any objects, people, or places from the scene in this section. For example, instead of "cinematic shot of a knight", say "cinematic, dramatic lighting, sharp focus".

      If any component is missing from the input text, you should infer and create a plausible and complementary description for it based on the available context. The goal is to produce a complete set of components that could be used to reconstruct a detailed image prompt.

      Provide the output strictly as a JSON object with the keys "environment", "characters", "action", "emotion", and "style".

      Text to analyze: ${e}
    `,i={type:gt.OBJECT,properties:{environment:{type:gt.STRING,description:"A detailed description of the background, setting, or environment."},characters:{type:gt.ARRAY,description:"A list of all distinct characters or subjects in the prompt.",items:{type:gt.STRING}},action:{type:gt.STRING,description:"A generalized description of the action the characters/subjects are performing, with specific subjects replaced by neutral terms."},emotion:{type:gt.STRING,description:"A generalized description of the emotion expressed by the character(s), such as joy, fear, or wonder."},style:{type:gt.STRING,description:"A detailed description of the art style, mood, and color palette."}},required:["environment","characters","action","emotion","style"]};try{const l=(await o.models.generateContent({model:"gemini-3-pro-preview",contents:a,config:{responseMimeType:"application/json",responseSchema:i}})).text;if(!l)throw new Error("Received an empty response from the model. The prompt may have been blocked due to safety settings.");const c=JSON.parse(l);return Array.isArray(c.characters)||(c.characters=[String(c.characters||"")]),c}catch(s){throw console.error("Error analyzing prompt:",s),s}}),F1=async e=>mn(async()=>{const t=hn();if(!e||e.trim()==="")throw new Error("Input cannot be empty.");const o=`
      Analyze the character description. Split it into:
      1. character (physical features only)
      2. clothing (outfit only)
      Output JSON.
      Text: ${e}
    `,r={type:gt.OBJECT,properties:{character:{type:gt.STRING},clothing:{type:gt.STRING}},required:["character","clothing"]};try{const a=await t.models.generateContent({model:"gemini-3-flash-preview",contents:o,config:{responseMimeType:"application/json",responseSchema:r}});return JSON.parse(a.text||"{}")}catch(a){throw console.error("Error analyzing character:",a),a}}),GE=async(e,t,o)=>mn(async()=>{const r=hn();if(!e||!e.trim())throw new Error("Image prompt is required.");const a=`You are a character design expert. Your task is to update an existing character description based on a specific image generation prompt.
    
    INPUTS:
    1. Image Prompt: A description of a specific visual instance of the character.
    2. Current Description: A full markdown-formatted description of the character.

    GOAL:
    1. Rewrite the "Appearance" and "Clothing" sections of the description to match the details found in the Image Prompt.
    2. The "Personality" section must be preserved in meaning but TRANSLATED to ${o}.
    
    CRITICAL REQUIREMENT:
    The entire output (headers AND content) MUST be in the target language: ${o}.
    If the current description is in a different language, translate everything to ${o}.
    
    OUTPUT FORMAT:
    The output must be a single string in Markdown format, using the following headers in ${o}:
    - #### Appearance (translated header)
    - #### Personality (translated header)
    - #### Clothing (translated header)

    Output ONLY the updated description text.`,i=`Update this character description:
    
    IMAGE PROMPT:
    ${e}
    
    CURRENT DESCRIPTION:
    ${t}`;try{return(await r.models.generateContent({model:"gemini-3-flash-preview",contents:i,config:{systemInstruction:a}})).text||""}catch(s){throw console.error("Error updating character description:",s),s}}),UE=async(e,t,o,r)=>mn(async()=>{const a=hn(),i=`You are a creative writer and character designer. 
        Your task is to generate or rewrite the "${e}" section of a character description based on an image generation prompt.
        
        INPUTS:
        1. Image Prompt: Visual details of the character.
        2. Current Section Text: The existing text for this section (if any).
        
        GOAL:
        - Analyze the Image Prompt to extract details relevant to "${e}" (e.g. physical features for Appearance, outfit for Clothing).
        - Rewrite the section text to be descriptive, cohesive, and aligned with the visual prompt.
        - Output strictly in the target language: ${r}.
        
        Output ONLY the new text for the section. Do not include headers.`,s=`IMAGE PROMPT:
        ${t}
        
        CURRENT SECTION TEXT:
        ${o}`;try{return(await a.models.generateContent({model:"gemini-3-flash-preview",contents:s,config:{systemInstruction:i}})).text||""}catch(l){throw console.error(`Error updating character ${e}:`,l),l}}),VE=async(e,t)=>mn(async()=>{const o=hn(),r=`You are a creative writer and character designer. 
        Your task is to rewrite or improve the provided character personality description.
        The input may contain the current personality text AND a user request for changes mixed together.
        
        GOAL:
        1. Extract the core personality traits and the user's modification request (if any).
        2. Rewrite the personality description to incorporate the requested changes or simply improve the writing style if no specific change is requested.
        3. The output should be a cohesive, well-written paragraph describing the character's personality.
        4. Output strictly in the target language: ${t}.
        
        Output ONLY the new personality text. Do not include headers.`,a=`Current Personality / Request:
        ${e}`;try{return(await o.models.generateContent({model:"gemini-3-flash-preview",contents:a,config:{systemInstruction:r}})).text||""}catch(i){throw console.error("Error updating character personality:",i),i}}),WE=async(e,t,o,r)=>mn(async()=>{const a=hn(),i=`You are a professional character concept artist.
    Your goal is to modify an existing character based on a user instruction.
    
    INPUTS:
    1. Instruction: What to change (e.g., "Change her clothes to a space suit").
    2. Current Image Prompt: The current short prompt used for image generation.
    3. Current Full Description: The detailed markdown description.

    TASK:
    - Update the Image Prompt to reflect the changes.
    - Update the Full Description (sections Appearance, Personality and Clothing) in ${r}.
    - Ensure all sections are consistent with the new instruction.
    - Output only a JSON object with keys 'newPrompt' and 'newDescription'.`,s={type:gt.OBJECT,properties:{newPrompt:{type:gt.STRING},newDescription:{type:gt.STRING}},required:["newPrompt","newDescription"]},l=`INSTRUCTION: ${e}
CURRENT PROMPT: ${t}
CURRENT DESCRIPTION: ${o}`;try{const c=await a.models.generateContent({model:"gemini-3-pro-preview",contents:l,config:{systemInstruction:i,responseMimeType:"application/json",responseSchema:s}});return JSON.parse(c.text||"{}")}catch(c){throw console.error("Error modifying character:",c),c}}),$n=async(e,t="1:1",o,r="gemini-2.5-flash-image",a="1K")=>mn(async()=>{var s,l,c,d,u,p,h,w,k,b,y,g,m;const i=hn();try{if(r==="gemini-3-pro-image-preview"){const _=[...(o||[]).map(M=>({inlineData:{data:M.base64ImageData,mimeType:M.mimeType}}))];e&&e.trim()!==""&&_.push({text:e});const P=(s=(await i.models.generateContent({model:"gemini-3-pro-image-preview",contents:{parts:_},config:{imageConfig:{aspectRatio:t,imageSize:a}}})).candidates)==null?void 0:s[0],j=(c=(l=P==null?void 0:P.content)==null?void 0:l.parts)==null?void 0:c.find(M=>M.inlineData);if(j!=null&&j.inlineData)return`data:${j.inlineData.mimeType};base64,${j.inlineData.data}`;throw new Error("No image returned. The prompt may have been blocked or the model encountered an error.")}if(o&&o.length>0){const _=[...o.map(D=>({inlineData:{data:D.base64ImageData,mimeType:D.mimeType}}))];e&&e.trim()!==""&&_.push({text:e});const j=(d=(await i.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:_},config:{responseModalities:[za.IMAGE]}})).candidates)==null?void 0:d[0],M=(p=(u=j==null?void 0:j.content)==null?void 0:u.parts)==null?void 0:p.find(D=>D.inlineData);if(M!=null&&M.inlineData)return`data:${M.inlineData.mimeType};base64,${M.inlineData.data}`;throw new Error("No image returned. The prompt may have been blocked.")}else{if(!e||e.trim()==="")throw new Error("Prompt required.");if(r.startsWith("imagen-4.0")){const x=await i.models.generateImages({model:r,prompt:e,config:{numberOfImages:1,outputMimeType:"image/png",aspectRatio:t}});if((k=(w=(h=x.generatedImages)==null?void 0:h[0])==null?void 0:w.image)!=null&&k.imageBytes)return`data:image/png;base64,${x.generatedImages[0].image.imageBytes}`;throw new Error("No image returned.")}else{const x=r==="gemini-3-flash-preview"||!r?"gemini-2.5-flash-image":r,S=(m=(g=(y=(b=(await i.models.generateContent({model:x,contents:{parts:[{text:e}]},config:{responseModalities:[za.IMAGE]}})).candidates)==null?void 0:b[0])==null?void 0:y.content)==null?void 0:g.parts)==null?void 0:m.find(P=>P.inlineData);if(S!=null&&S.inlineData)return`data:${S.inlineData.mimeType};base64,${S.inlineData.data}`;throw new Error("No image returned.")}}}catch(x){let _=x.message||"";throw x.status&&(_+=` Status: ${x.status}`),x.code&&(_+=` Code: ${x.code}`),x.details&&(_+=` Details: ${JSON.stringify(x.details)}`),!_&&typeof x=="object"&&(_=JSON.stringify(x)),new Error(`Failed to generate image. ${_}`)}},2,2e3),$E=async(e,t="16:9",o="720p")=>mn(async()=>{var a,i,s,l;const r=hn();if(window.aistudio&&!await window.aistudio.hasSelectedApiKey()&&await window.aistudio.openSelectKey(),!e||e.trim()==="")throw new Error("Prompt required.");try{let c=await r.models.generateVideos({model:"veo-3.1-fast-generate-preview",prompt:e,config:{numberOfVideos:1,resolution:o,aspectRatio:t}});for(;!c.done;)await new Promise(h=>setTimeout(h,1e4)),c=await r.operations.getVideosOperation({operation:c});const d=(l=(s=(i=(a=c.response)==null?void 0:a.generatedVideos)==null?void 0:i[0])==null?void 0:s.video)==null?void 0:l.uri;if(!d)throw new Error("No video URI returned.");const u=await fetch(`${d}&key=${Ql()}`);if(!u.ok)throw new Error(`Download failed: ${u.statusText}`);const p=await u.blob();return new Promise((h,w)=>{const k=new FileReader;k.onloadend=()=>h(k.result),k.onerror=w,k.readAsDataURL(p)})}catch(c){console.error("Error generating video:",c);let d=c.message||"";throw c.status&&(d+=` Status: ${c.status}`),c.code&&(d+=` Code: ${c.code}`),new Error(`Failed to video video. ${d}`)}},1),B1=async(e,t,o)=>mn(async()=>{const r=hn(),i=`${o?"Important: Use neutral, safe terms.":""} Describe this image in detail (subject, setting, colors, mood).`;try{return(await r.models.generateContent({model:"gemini-3-flash-preview",contents:{parts:[{inlineData:{data:e,mimeType:t}},{text:i}]}})).text||""}catch(s){throw console.error("Error describing image:",s),s}}),KE=async(e,t)=>mn(async()=>{const o=hn(),r=`Analyze the visual appearance of the character in this image to create a text-to-image prompt.

        **REQUIREMENTS:**
        1. **SUBJECT ONLY**: Describe ONLY the character's physical features (face, hair, body type) and clothing/accessories in detail.
        2. **STYLE**: Describe the artistic style and render quality using general descriptive terms (e.g., '3D stylized render', 'soft lighting', 'detailed textures').

        **NEGATIVE CONSTRAINTS (DO NOT INCLUDE):**
        - DO NOT describe the pose, action, or gesture.
        - DO NOT describe the background or environment.
        - DO NOT use trademarked studio names (e.g., avoid 'Pixar', 'Disney'). Use generic style descriptions instead.

        Return ONLY the raw prompt text.`;try{return(await o.models.generateContent({model:"gemini-3-flash-preview",contents:{parts:[{inlineData:{data:e,mimeType:t}},{text:r}]}})).text||""}catch(a){throw console.error("Error generating prompt from image:",a),a}}),Lp=async(e,t)=>mn(async()=>{const o=hn(),r='Extract all text from this image. Return only the text found, without any description. If no text is found, say "No text found".';try{return(await o.models.generateContent({model:"gemini-3-flash-preview",contents:{parts:[{inlineData:{data:e,mimeType:t}},{text:r}]}})).text||""}catch(a){throw console.error("Error extracting text from image:",a),a}}),Dp=async(e,t)=>mn(async()=>{const o=hn();if(!e||e.trim()==="")throw new Error("Input empty.");try{return(await o.models.generateContent({model:"gemini-3-flash-preview",contents:e,config:{systemInstruction:`Translate to ${t}. Return only translated text.`}})).text||""}catch(r){throw console.error("Error translating:",r),r}}),H1=async(e,t)=>mn(async()=>{const o=hn(),r={type:gt.OBJECT,properties:{summary:{type:gt.STRING},detailedCharacters:{type:gt.ARRAY,items:{type:gt.OBJECT,properties:{name:{type:gt.STRING},fullDescription:{type:gt.STRING}}}},scenes:{type:gt.ARRAY,items:{type:gt.OBJECT,properties:{sceneNumber:{type:gt.INTEGER},description:{type:gt.STRING},narratorText:{type:gt.STRING}}}}},required:["summary","detailedCharacters","scenes"]};try{const a=await o.models.generateContent({model:"gemini-3-pro-preview",contents:e,config:{systemInstruction:`Generate a script structure in ${t}. Use markdown in fullDescription.`,responseMimeType:"application/json",responseSchema:r}});return JSON.parse(a.text||"{}")}catch(a){throw console.error("Error generating script:",a),a}}),G1=async e=>mn(async()=>{const t=hn(),o={type:gt.ARRAY,items:{type:gt.OBJECT,properties:{name:{type:gt.STRING},index:{type:gt.STRING},imagePrompt:{type:gt.STRING},fullDescription:{type:gt.STRING}},required:["name","fullDescription","index","imagePrompt"]}};try{const r=await t.models.generateContent({model:"gemini-3-flash-preview",contents:e,config:{systemInstruction:"Generate detailed characters. Use markdown headings in fullDescription. Ensure 'index' is provided (e.g. 'Entity-1', 'Entity-2').",responseMimeType:"application/json",responseSchema:o}});return JSON.parse(r.text||"[]")}catch(r){throw console.error("Error generating characters:",r),r}}),JE=async(e,t)=>mn(async()=>{const o=hn(),r=`Translate user-facing fields to ${t}. Preserve structure and markdown.`;try{const a=await o.models.generateContent({model:"gemini-3-pro-preview",contents:`Translate:
${JSON.stringify(e)}`,config:{systemInstruction:r,responseMimeType:"application/json"}});return JSON.parse(a.text||"{}")}catch(a){throw new Error(a.message)}}),U1=async(e,t,o="en",r="gemini-3-flash-preview",a=!1,i={})=>mn(async()=>{const s=hn(),l={type:gt.OBJECT,properties:{modifiedFrames:{type:gt.ARRAY,items:{type:gt.OBJECT,properties:{frameNumber:{type:gt.INTEGER},sceneNumber:{type:gt.INTEGER},prompt:{type:gt.STRING},videoPrompt:{type:gt.STRING},shotType:{type:gt.STRING,description:"The type of shot (e.g., WS, CU, ECU, LS, MS)."},characters:{type:gt.ARRAY,items:{type:gt.STRING}},duration:{type:gt.INTEGER}},required:["frameNumber","sceneNumber","prompt","characters","duration","shotType",...a?["videoPrompt"]:[]]}},modifiedSceneContexts:{type:gt.ARRAY,items:{type:gt.OBJECT,properties:{sceneNumber:{type:gt.INTEGER},context:{type:gt.STRING,description:"The updated scene context description."}},required:["sceneNumber","context"]}}},required:["modifiedFrames"]},c=o==="ru"?"Ensure the response fields (like prompts and context) are in Russian.":"Ensure the response fields (like prompts and context) are in English.";let d="";a&&(d=`
        CRITICAL: You MUST also generate or modify the 'videoPrompt' field for every frame.
        - If 'videoPrompt' is empty or missing in the source: Generate a NEW video prompt based on the image 'prompt'. It MUST describe specific actions happening in the frame and camera movements (e.g., "Camera pans left", "Zoom in").
        - If 'videoPrompt' exists: Modify it according to the user's instruction, while maintaining consistency with the image 'prompt'.
        `);let u="";Object.keys(i).length>0&&(u=`
        **SCENE CONTEXT**:
        The input data includes "sceneContexts". This dictionary maps scene numbers to context descriptions.
        
        TASK:
        1. Apply the user's instruction to the frames.
        2. IF the instruction implies changing the overall setting, mood, or context of a scene (e.g., "Change the weather to snow", "Make it night time"), YOU MUST ALSO MODIFY the Scene Context text for that scene.
        3. Return the updated scene contexts in the 'modifiedSceneContexts' array. Only include contexts that have changed or are relevant to the modified frames.
        
        Context Data: ${JSON.stringify(i)}
        `);try{const p=await s.models.generateContent({model:r,contents:`Instruction: ${t}
${u}
Data: ${JSON.stringify(e)}`,config:{systemInstruction:`Modify prompts based on instruction. Return a structured object with modified frames and modified scene contexts. ${c} ${d} For every frame, you MUST either preserve or generate a logical 'shotType' value (e.g., WS, MS, CU, etc.) representing the camera angle. Also, always ensure to return the correct 'sceneNumber' for each frame corresponding to the source.`,responseMimeType:"application/json",responseSchema:l}}),h=JSON.parse(p.text||"{}");return{modifiedFrames:h.modifiedFrames||[],modifiedSceneContexts:h.modifiedSceneContexts||[]}}catch(p){throw console.error("Error modifying sequence:",p),p}}),YE=({nodes:e,setNodes:t,getUpstreamNodeValues:o,setError:r,t:a,setFullSizeImage:i,getFullSizeImage:s,activeTabId:l,setTabs:c,activeTabName:d,registerOperation:u,unregisterOperation:p,addToast:h})=>{const[w,k]=v.useState(null),[b,y]=v.useState(null),[g,m]=v.useState(null),[x,_]=v.useState(null),[S,P]=v.useState(null),j=v.useRef(l);v.useEffect(()=>{j.current=l},[l]);const M=v.useCallback((T,F,z,G)=>{const U=R=>{try{return JSON.parse(R||"{}")}catch{return R}};j.current===T?(G&&i(F,G.frame,G.url),t(R=>R.map(q=>{if(q.id===F){const H=U(q.value),ne=z(H),X=typeof ne=="string"?ne:JSON.stringify(ne);return{...q,value:X}}return q}))):c(R=>R.map(q=>{if(q.id===T){const H=q.state.nodes.map(X=>{if(X.id===F){const re=U(X.value),de=z(re),ge=typeof de=="string"?de:JSON.stringify(de);return{...X,value:ge}}return X});let ne=q.state.fullSizeImageCache||{};return G&&(ne={...ne,[F]:{...ne[F]||{},[G.frame]:G.url}}),{...q,state:{...q.state,nodes:H,fullSizeImageCache:ne}}}return q}))},[t,c,i]),D=v.useCallback(async T=>{const F=j.current;k(T),r(null),u({id:T,type:"analysis",description:a("node.content.analyzing"),tabId:l,tabName:d});try{const z=e.find(H=>H.id===T);if(!z)return;const G=JSON.parse(z.value||"{}").softPrompt||!1,R=o(T).filter(H=>typeof H=="string").join(", "),q=await O1(R,G);M(F,T,H=>({...H,...q}))}catch(z){r(z.message)}finally{k(null),p(T)}},[o,r,e,a,M,u,p,l,d]),O=v.useCallback(async T=>{const F=j.current;y(T),r(null),u({id:T,type:"analysis",description:a("node.content.analyzing"),tabId:l,tabName:d});try{const G=o(T).filter(R=>typeof R=="string").join(", "),U=await F1(G);M(F,T,()=>U)}catch(z){r(z.message)}finally{y(null),p(T)}},[o,r,a,M,u,p,l,d]),B=v.useCallback(async T=>{const F=j.current;m(T),r(null),u({id:T,type:"analysis",description:a("node.content.analyzing"),tabId:l,tabName:d});try{const z=e.find(X=>X.id===T);if(!z)return;const G=JSON.parse(z.value||"{}"),U=G.softPrompt||!1,q=o(T).find(X=>typeof X=="object");let H=null;if(q)H={base64:q.base64ImageData,mime:q.mimeType};else if(G.image&&typeof G.image=="string"&&G.image.startsWith("data:image")){const X=G.image.split(",");if(X.length===2){const re=G.image.match(/:(.*?);/),de=re?re[1]:"image/png";H={base64:X[1],mime:de}}}if(!H)throw new Error("No image provided to analyzer.");const ne=await B1(H.base64,H.mime,U);M(F,T,X=>({...X,description:ne}))}catch(z){r(z.message)}finally{m(null),p(T)}},[o,e,r,a,M,u,p,l,d]),E=v.useCallback(async T=>{const F=j.current;m(T),r(null),u({id:T,type:"analysis",description:a("node.content.analyzing"),tabId:l,tabName:d});try{const z=e.find(X=>X.id===T);if(!z)return;const G=JSON.parse(z.value||"{}"),R=o(T).find(X=>typeof X=="object");let q=null;if(R)q={base64:R.base64ImageData,mime:R.mimeType};else{let re=s(T,0);if(!re&&G.image&&typeof G.image=="string"&&G.image.startsWith("data:image")&&(re=G.image),re){const de=re.split(",");if(de.length===2){const ge=re.match(/:(.*?);/),te=ge?ge[1]:"image/png";q={base64:de[1],mime:te}}}}if(!q)throw new Error("No image provided.");const H=await Lp(q.base64,q.mime),ne=z.type===L.IMAGE_INPUT?"prompt":"description";M(F,T,X=>({...X,[ne]:H}))}catch(z){r(z.message)}finally{m(null),p(T)}},[o,e,r,a,M,u,p,l,d,s]),I=v.useCallback(async T=>{var z;const F=j.current;_(T),r(null),u({id:T,type:"generation",description:a("node.content.processing"),tabId:l,tabName:d});try{const G=e.find(X=>X.id===T);if(!G)return;let U="",R="";if(G.type===L.IMAGE_INPUT){let re=s(T,0);if(!re)try{re=JSON.parse(G.value||"{}").image}catch{}if(!re)throw new Error("No image found in node.");if(re.startsWith("data:"))U=re.split(",")[1],R=((z=re.match(/:(.*?);/))==null?void 0:z[1])||"image/png";else throw new Error("Image format not supported.")}else{const re=o(T,"image").find(de=>typeof de=="object");re&&(U=re.base64ImageData,R=re.mimeType)}if(!U)throw new Error("No image to process.");const H=await $n("Remove all possible overlays, text, watermarks, and watermarked texts. Pay special attention to the top and bottom of the image, restoring the original background naturally.","1:1",[{base64ImageData:U,mimeType:R}],"gemini-3-flash-preview"),ne=await Rt(H,256,256);M(F,T,X=>({...X,image:ne}),{frame:0,url:H})}catch(G){r(G.message)}finally{_(null),p(T)}},[e,r,o,s,M,u,p,l,d,a]),N=v.useCallback(async(T,F)=>{const z=j.current,G=`${T}-${F}`;P(G),r(null),u({id:G,type:"analysis",description:a("node.content.analyzing"),tabId:l,tabName:d});try{const U=e.find(le=>le.id===T);if(!U)return;const R=JSON.parse(U.value||"[]"),H=(Array.isArray(R)?R:[R])[F];if(!H)throw new Error("Character card not found.");const ne=s(T,F*10)||H.image;if(!ne||!ne.startsWith("data:"))throw new Error("No valid image found to analyze.");const re=ne.split(",")[1],de=ne.match(/:(.*?);/),ge=de?de[1]:"image/png",te=await KE(re,ge);M(z,T,le=>{const ee=Array.isArray(le)?[...le]:[le];return ee[F]&&(ee[F]={...ee[F],prompt:te}),ee}),h("Prompt updated from image","success")}catch(U){r(U.message)}finally{P(null),p(G)}},[e,r,a,M,u,p,l,d,s,h]);return{isAnalyzing:w,isAnalyzingCharacter:b,isAnalyzingImage:g,isProcessingImage:x,handleAnalyzePrompt:D,handleAnalyzeCharacter:O,handleAnalyzeImage:B,handleImageToText:E,handleProcessImage:I,handleUpdateCharacterPromptFromImage:N,isUpdatingCharacterPrompt:S}},Og={general:`You are Gemini, a versatile and helpful AI assistant integrated into the "Prompt Modifier" application.
    
**Context:**
You are operating within a node-based visual editor used for creating and refining workflows for Generative AI.

**Goal:**
Assist the user with general questions, brainstorming, coding, or any other topic they raise. Be concise, professional, and helpful.`,prompt:`You are an **Expert Image Prompt Engineer**. Your sole purpose is to help the user create the perfect text-to-image prompts (for Midjourney, Stable Diffusion, Imagen, etc.).

**Behaviors:**
1.  **Analyze:** When given a vague idea, analyze it for artistic style, lighting, composition, and medium.
2.  **Enhance:** Rewrite simple prompts into rich, descriptive, and evocative prompts. Use keywords effectively.
3.  **Format:** ALWAYS wrap your final suggested prompt inside a markdown code block labeled 'prompt'.
    Example:
    \`\`\`prompt
    A futuristic city with neon lights, cinematic lighting, hyper-realistic, 8k
    \`\`\`
`,script:`You are a **Professional Screenwriter and Story Consultant**. You excel at structuring narratives, developing characters, and writing screenplay format.

**Behaviors:**
1.  **Ideation:** Help generate loglines, plot twists, and character arcs.
2.  **Formatting:** When asked to write a scene, use standard screenplay format elements (Sluglines, Action, Character, Dialogue).
3.  **Advice:** Offer constructive feedback on pacing, dialogue, and "show, don't tell".
`,youtube:`You are a **YouTube Growth Strategist and Analytics Expert**. You specialize in channel growth, video retention, and click-through rates (CTR).

**Behaviors:**
1.  **Titles & Thumbs:** Suggest viral-worthy titles and thumbnail concepts that trigger curiosity or emotion.
2.  **Retention:** Analyze script ideas for hooks, pacing, and retention spikes.
3.  **Strategy:** Provide advice on SEO, tags, trends, and audience engagement.
4.  **Tone:** Be analytical, data-driven, and direct.
`,developer:`You are an **Expert Software Developer and Solutions Architect**. You specialize in writing clean, efficient, and well-documented code.

**Behaviors:**
1.  **Code First:** Prioritize providing code solutions. When code is requested, ensure it is complete and functional.
2.  **Best Practices:** Follow standard conventions, design patterns, and security best practices.
3.  **Explain:** Briefly explain the logic, algorithms, and libraries used.
4.  **Debug:** If analyzing an error, explain the root cause and provide a specific fix.
5.  **Format:** Always use markdown code blocks for code outputs.
`},ZE=({nodes:e,setNodes:t,setError:o,t:r,getUpstreamNodeValues:a,activeTabId:i,setTabs:s})=>{const[l,c]=v.useState(null),d=v.useRef(new Map),u=v.useRef(i);jt.useEffect(()=>{u.current=i},[i]);const p=v.useCallback((k,b,y)=>{const g=m=>{try{return JSON.parse(m||"{}")}catch{return m}};u.current===k?t(m=>m.map(x=>{if(x.id===b){const _=g(x.value),S=y(_),P=JSON.stringify(S);return{...x,value:P}}return x})):s(m=>m.map(x=>{if(x.id===k){const _=x.state.nodes.map(S=>{if(S.id===b){const P=g(S.value),j=y(P),M=JSON.stringify(j);return{...S,value:M}}return S});return{...x,state:{...x.state,nodes:_}}}return x}))},[t,s]),h=v.useCallback(async k=>{const b=u.current,y=e.find(P=>P.id===k);if(!y||y.type!=="GEMINI_CHAT")return;const g=JSON.parse(y.value||"{}");let{messages:m=[],currentInput:x,style:_="general"}=g;if(!x||!x.trim()){const P=a(k).filter(j=>typeof j=="string");P.length>0&&(x=P.join(`
`))}if(!x||!x.trim())return;c(k),o(null);const S=[...m,{role:"user",content:x}];p(b,k,P=>({...P,messages:S,currentInput:""}));try{const P=d.current.get(k);if(!P||P.style!==_){const I=Ql();if(!I)throw new Error("API Key is missing.");const N=new Rp({apiKey:I}),T=Og[_]||Og.general,F=N.chats.create({model:"gemini-3-flash-preview",config:{systemInstruction:T}});d.current.set(k,{chat:F,style:_})}const D=(await d.current.get(k).chat.sendMessage({message:x})).text||"",O=D.match(/```prompt\n([\s\S]*?)\n```/),B=O?O[1].trim():"",E=[...S,{role:"model",content:D}];p(b,k,I=>({...I,messages:E,currentInput:"",lastPrompt:B||I.lastPrompt}))}catch(P){o(P.message)}finally{c(null)}},[e,o,r,a,p]),w=v.useCallback(k=>{d.current.has(k)&&d.current.delete(k),p(u.current,k,b=>({messages:[],currentInput:"",lastPrompt:"",style:b.style||"general"}))},[p]);return{isChatting:l,handleSendMessage:h,handleRefreshChat:w}},XE=async({node:e,upstreamData:t})=>{let o=t.filter(l=>typeof l=="string"),r={},a=!0,i=!1;try{r=JSON.parse(e.value||"{}"),typeof r=="object"&&r!==null&&(a=r.safePrompt!==!1,i=r.technicalPrompt===!0)}catch{}o.length===0&&r.inputPrompt&&(o=[r.inputPrompt]);const s=await D1(o,a,i);return{value:{...r,prompt:s,safePrompt:a,technicalPrompt:i}}},QE=async({upstreamData:e})=>{const t=e.filter(r=>typeof r=="string");return{value:await z1(t.join(", "))}},e3=async({node:e,upstreamData:t})=>{let o=t.filter(i=>typeof i=="string"),r={};try{r=JSON.parse(e.value||"{}")}catch{}o.length===0&&r.inputPrompt&&(o=[r.inputPrompt]);const a=await q1(o);return{value:{...r,prompt:a}}},t3=async({node:e,upstreamData:t})=>{const o=JSON.parse(e.value||"{}"),r=t.filter(l=>typeof l=="string");let a=r.length>0?r.join(`
`):o.inputText;const i=o.targetLanguage||"en";if(o.image&&typeof o.image=="string"&&o.image.startsWith("data:image")){const l=o.image.split(",");if(l.length===2){const c=o.image.match(/:(.*?);/),d=c?c[1]:"image/png",u=l[1],p=await Lp(u,d);p&&p!=="No text found"&&(a=p,o.inputText=p)}}const s=await Dp(a,i);return{value:{...o,inputText:a,translatedText:s}}},n3=async({node:e,upstreamData:t,saveImageToCache:o})=>{const a=t.filter(l=>typeof l=="string").join(", ");if(!a)throw new Error("Prompt is empty. Make sure a node with text is connected and has been processed.");const i=await $n(a,e.aspectRatio,void 0,e.model,e.resolution),s=await Rt(i,256,256);return o(0,i),{value:s,downloadData:e.autoDownload?{url:i,prompt:a,type:e.type}:void 0}},o3=async(e,t,o,r,a,i,s)=>{const l=JSON.parse(e.value),c=[...r,...o],d=[...a,...i];if(!l.isSequentialEditingWithPrompts&&c.length===0&&l.model!=="gemini-3-pro-image-preview")throw new Error("No input image provided for editing.");let u=[l.prompt,...t].filter(Boolean).join(", "),p=[];if(!l.isSequenceMode){let x=c;const _=l.checkedInputIndices;_&&Array.isArray(_)?x=c.filter((S,P)=>_.includes(P)):x=c,p=x}if(!l.isSequenceMode){if(p.length===0&&l.model!=="gemini-3-pro-image-preview")throw new Error("No images selected for processing.");const x=p.map(async M=>{var O;const D=`data:${M.mimeType};base64,${M.base64ImageData}`;if(l.enableAspectRatio&&l.aspectRatio&&l.aspectRatio!=="Auto"){const{formattedImage:B}=await Cr(D,l.aspectRatio);return{base64ImageData:B.split(",")[1],mimeType:((O=B.match(/:(.*?);/))==null?void 0:O[1])||"image/png"}}return M}),_=await Promise.all(x);l.enableOutpainting&&(u=(l.outpaintingPrompt||"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.").replace("{main_prompt}",u));const S=await $n(u,l.aspectRatio,_,l.model,l.resolution);let P=S;if(l.autoCrop169)try{P=await Ra(S)}catch(M){console.error("Failed to auto-crop image:",M.message)}const j=await Rt(P,256,256);return s(0,P),{value:{...l,outputImage:j},downloadData:l.autoDownload?{url:P,prompt:u,type:e.type}:void 0}}let h=0;l.checkedInputIndices&&l.checkedInputIndices.length>0&&(h=l.checkedInputIndices[0]),l.isSequentialEditingWithPrompts&&(h=0);let w=[];if(l.isSequentialEditingWithPrompts)w=d;else{const x=c[h]||(c.length>0?c[0]:void 0);if(!x&&l.model!=="gemini-3-pro-image-preview")throw new Error("No image found for sequence chain execution.");x&&(w=[x]),l.isSequentialCombinationMode&&!l.isSequentialEditingWithPrompts&&x&&d.length>0&&w.push(...d)}const k=w.map(async x=>{var S;const _=`data:${x.mimeType};base64,${x.base64ImageData}`;if(l.enableAspectRatio&&l.aspectRatio&&l.aspectRatio!=="Auto"){const{formattedImage:P}=await Cr(_,l.aspectRatio);return{base64ImageData:P.split(",")[1],mimeType:((S=P.match(/:(.*?);/))==null?void 0:S[1])||"image/png"}}return x}),b=await Promise.all(k);l.enableOutpainting&&(u=(l.outpaintingPrompt||"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.").replace("{main_prompt}",u));const y=await $n(u,l.aspectRatio,b,l.model,l.resolution);let g=y;if(l.autoCrop169)try{g=await Ra(y)}catch(x){console.error("Failed to auto-crop image:",x.message)}const m=await Rt(g,256,256);return s(0,g),{value:{...l,outputImage:m},downloadData:l.autoDownload?{url:g,prompt:u,type:e.type}:void 0}},r3=async({node:e,upstreamData:t})=>{const o=t.filter(s=>typeof s=="string"),r=JSON.parse(e.value||"{}").softPrompt||!1,a=await O1(o.join(", "),r);return{value:{...JSON.parse(e.value||"{}"),...a}}},a3=async({upstreamData:e})=>{const t=e.filter(r=>typeof r=="string");return{value:await F1(t.join(", "))}},i3=async({node:e,upstreamData:t})=>{const o=t.find(s=>typeof s=="object");if(!o)throw new Error("No image provided to analyzer.");const r=JSON.parse(e.value||"{}"),a=r.softPrompt||!1,i=await B1(o.base64ImageData,o.mimeType,a);return{value:{...r,description:i}}},s3=async({node:e,upstreamData:t})=>{const o=JSON.parse(e.value||"{}"),r=t.filter(l=>typeof l=="string"),a=r.length>0?r.join(`
`):o.prompt,i=o.targetLanguage||"en",s=await H1(a,i);return{value:{...o,...s,prompt:a,type:"script-generator-data"}}},l3=async({node:e,upstreamData:t})=>{const o=JSON.parse(e.value||"{}"),r=t.filter(l=>typeof l=="string"),a=r.length>0?r.join(`
`):o.prompt,i=await G1(a),s=[...o.characters||[],...i];return{value:{...o,characters:s,prompt:a}}},c3=async({node:e})=>{const{instruction:t,sourcePrompts:o=[],checkedSourceFrameNumbers:r=[],targetLanguage:a="en",modificationModel:i="gemini-3-flash-preview",includeVideoPrompts:s=!1,checkedContextScenes:l=[],sceneContexts:c={}}=JSON.parse(e.value||"{}");if(!(t!=null&&t.trim()))throw new Error("Modification instruction is empty.");if(r.length===0)throw new Error("No source prompts selected for modification.");const d=o.filter(x=>r.includes(x.frameNumber));if(d.length===0)throw new Error("Selected prompts not found.");let u={};new Set(d.map(x=>x.sceneNumber)).forEach(x=>{c[x]&&l.includes(x)&&(u[String(x)]=c[x])});const{modifiedFrames:h,modifiedSceneContexts:w}=await U1(d,t,a,i,s,u),k=JSON.parse(e.value||"{}"),b=k.modifiedPrompts||[],y=new Map(b.map(x=>[x.frameNumber,x])),g=new Map(o.map(x=>[x.frameNumber,x]));h.forEach(x=>{const _=g.get(x.frameNumber);_&&(!x.videoPrompt&&_.videoPrompt&&(x.videoPrompt=_.videoPrompt),!x.sceneTitle&&_.sceneTitle&&(x.sceneTitle=_.sceneTitle),!x.sceneNumber&&_.sceneNumber&&(x.sceneNumber=_.sceneNumber),!x.shotType&&_.shotType&&(x.shotType=_.shotType)),y.set(x.frameNumber,x)});let m={...k.modifiedSceneContexts||{}};return w&&w.length>0&&w.forEach(x=>{x.sceneNumber&&x.context&&(m[String(x.sceneNumber)]=x.context)}),{value:{...k,modifiedPrompts:Array.from(y.values()),modifiedSceneContexts:m}}},d3={[L.PROMPT_PROCESSOR]:XE,[L.PROMPT_SANITIZER]:QE,[L.VIDEO_PROMPT_PROCESSOR]:e3,[L.TRANSLATOR]:t3,[L.IMAGE_OUTPUT]:n3,[L.PROMPT_ANALYZER]:r3,[L.CHARACTER_ANALYZER]:a3,[L.IMAGE_ANALYZER]:i3,[L.SCRIPT_GENERATOR]:s3,[L.CHARACTER_GENERATOR]:l3,[L.PROMPT_SEQUENCE_EDITOR]:c3},u3=e=>d3[e],p3=(e,t,o)=>{const r=o==="VIDEO_OUTPUT",a=r?"video_output":o==="IMAGE_EDITOR"?"image_editor":o==="IMAGE_SEQUENCE_GENERATOR"?"sequence":"image_output",i=r?"mp4":"png",s=new Date,l=s.toISOString().split("T")[0];let c=`${a}_${l}.${i}`;if(o==="IMAGE_EDITOR")c=`Image_Editor_Frame_001_${l}.${i}`;else if(o==="IMAGE_SEQUENCE_GENERATOR")c=`Sequence_Frame_001_${l}.${i}`;else{const p=s.toTimeString().split(" ")[0].replace(/:/g,"-");c=`${a}_${l}_${p}.${i}`}let d=e;!r&&e.startsWith("data:image/png")&&(d=Bi(e,"prompt",t));const u=document.createElement("a");u.href=d,u.download=c,document.body.appendChild(u),u.click(),document.body.removeChild(u)},h3=({nodes:e,setNodes:t,connections:o,setError:r,getUpstreamNodeValues:a,t:i,setFullSizeImage:s,getFullSizeImage:l,activeTabId:c,activeTabName:d,registerOperation:u,unregisterOperation:p,isGlobalProcessing:h,setTabs:w})=>{const[k,b]=v.useState(!1),[y,g]=v.useState(null),m=v.useRef(null),x=v.useRef(c);v.useEffect(()=>{x.current=c},[c]);const _=v.useCallback((j,M,D,O)=>{x.current===j?(O&&s(M,O.frame,O.url),t(B=>B.map(E=>E.id===M?{...E,value:D}:E))):w(B=>B.map(E=>{if(E.id===j){const I=E.state.nodes.map(T=>T.id===M?{...T,value:D}:T);let N=E.state.fullSizeImageCache||{};return O&&(N={...N,[M]:{...N[M]||{},[O.frame]:O.url}}),{...E,state:{...E.state,nodes:I,fullSizeImageCache:N}}}return E}))},[t,w,s]),S=v.useCallback(async(j,M,D)=>{if(j.type===L.IMAGE_EDITOR){const B=a(j.id,"text",M).filter(G=>typeof G=="string"),E=a(j.id,"image",M).filter(G=>typeof G=="object"),I=a(j.id,"image_b",M).filter(G=>typeof G=="object"),N=JSON.parse(j.value),T=(N.inputImages||[]).map((G,U)=>{var H;const q=l(j.id,U+1)||G;return{base64ImageData:q.split(",")[1],mimeType:((H=q.match(/:(.*?);/))==null?void 0:H[1])||"image/png"}}),F=(N.inputImagesB||[]).map((G,U)=>{var H;const q=l(j.id,2e3+U+1)||G;return{base64ImageData:q.split(",")[1],mimeType:((H=q.match(/:(.*?);/))==null?void 0:H[1])||"image/png"}});return await o3(j,B,E,T,F,I,(G,U)=>{x.current===D&&s(j.id,G,U)})}const O=u3(j.type);if(O){const B=a(j.id,void 0,M);return await O({node:j,upstreamData:B,saveImageToCache:(I,N)=>{x.current===D&&s(j.id,I,N)}})}return{value:null,downloadData:void 0}},[a,s,l]),P=v.useCallback(async(j,M)=>{if(k)return;const D=x.current,O=[...e],B=[...o];b(!0),u({id:j,type:"chain",description:i(M==="execute"?"node.action.executeChain":"node.action.processChainForward"),tabId:c,tabName:d}),m.current=new AbortController;let E=[];if(M==="execute"){const I=new Set,N=T=>{if(I.has(T))return;I.add(T);const F=B.filter(z=>z.toNodeId===T);for(const z of F)N(z.fromNodeId);E.push(T)};N(j)}else{let I=j;for(;I;){E.push(I);const N=B.find(T=>T.fromNodeId===I);I=N?N.toNodeId:null}}try{const I=new Map(O.map(N=>[N.id,N]));for(const N of E){if(m.current.signal.aborted)throw new Error("Aborted");g(N);const T=I.get(N);if(T&&T.type!==L.TEXT_INPUT&&T.type!==L.IMAGE_INPUT&&T.type!==L.NOTE&&T.type!==L.REROUTE_DOT&&T.type!==L.DATA_READER&&T){const z=Array.from(I.values()),G=await S(T,z,D),{value:U,downloadData:R}=G;if(U!=null){const q=typeof U=="object"?JSON.stringify(U):String(U);I.set(N,{...T,value:q}),_(D,N,q)}R&&p3(R.url,R.prompt,R.type)}}}catch(I){I.name!=="AbortError"&&I.message!=="Aborted"&&r(I.message)}finally{b(!1),g(null),m.current=null,p(j)}},[k,e,o,r,S,u,p,c,d,i,_]);return{isExecutingChain:k,executingNodeId:y,handleExecuteChain:j=>P(j,"execute"),stopChainExecution:()=>{m.current&&m.current.abort(),b(!1)},handleProcessChainForward:j=>P(j,"forward")}},m3=({nodes:e,getUpstreamNodeValues:t,setError:o,t:r,registerOperation:a,unregisterOperation:i,updateNodeInStorage:s,activeTabId:l,activeTabName:c,activeTabIdRef:d,setFullSizeImage:u})=>{const[p,h]=v.useState(null),w=v.useCallback(async(k,b=0)=>{const y=d.current,g=e.find(m=>m.id===k);if(g){h(k),o(null),a({id:k,type:"generation",description:r("node.content.generating"),tabId:l,tabName:c});try{let m="",x=g.aspectRatio||"1:1";if(g.type===L.CHARACTER_CARD){let P=JSON.parse(g.value||"[]");Array.isArray(P)||(P=[P]);const j=P[b]||{},M=j.prompt||"";x=j.selectedRatio||"1:1";const D=j.additionalPrompt!==void 0?j.additionalPrompt:"Full body character concept on a gray background";D.trim()?m=M?`${M}, ${D}`:D:m=M}else m=t(k).filter(j=>typeof j=="string").join(", ");if(!m)throw new Error("Prompt is empty. Connect a text node or enter a prompt.");const _=await $n(m,x,void 0,g.model,g.resolution),S=await Rt(_,256,256);if(g.type===L.CHARACTER_CARD){const P=$t[x]||1,j=b*10+P;s(y,k,M=>{let D=Array.isArray(M)?[...M]:[M];if(!D[b])return M;const O={...D[b].thumbnails||{},[x]:S};return D[b]={...D[b],image:S,thumbnails:O},D},{frame:j,url:_}),u(k,b*10,_),u(k,j,_)}else s(y,k,()=>S,{frame:0,url:_})}catch(m){o(m.message)}finally{h(null),i(k)}}},[e,t,o,r,s,a,i,l,c,d,u]);return{isGeneratingImage:p,handleGenerateImage:w}},g3=({nodes:e,getUpstreamNodeValues:t,setError:o,t:r,registerOperation:a,unregisterOperation:i,updateNodeInStorage:s,activeTabId:l,activeTabName:c,activeTabIdRef:d,showApiKeyDialog:u})=>{const[p,h]=v.useState(null),w=v.useCallback(async k=>{const b=d.current,y=e.find(g=>g.id===k);if(y){h(k),o(null),a({id:k,type:"video",description:r("node.content.generating"),tabId:l,tabName:c});try{const m=t(k).filter(_=>typeof _=="string").join(", ");if(!m)throw new Error("Video generation requires a text prompt.");if(localStorage.getItem("settings_useDevKey")!=="true"&&!localStorage.getItem("settings_userApiKey")){u({onSelect:()=>{},onClose:()=>{h(null),i(k)}});return}const x=await $E(m,y.aspectRatio,y.resolution);s(b,k,()=>x)}catch(g){o(g.message)}finally{h(null),i(k)}}},[e,t,o,u,r,s,a,i,l,c,d]);return{isGeneratingVideo:p,handleGenerateVideo:w}},f3=(e,t)=>{let o=e;e.startsWith("data:image/png")&&(o=Bi(e,"prompt",t));const r=document.createElement("a");r.href=o;const s=`Image_Editor_Frame_001_${new Date().toISOString().split("T")[0]}.png`;r.download=s,document.body.appendChild(r),r.click(),document.body.removeChild(r)},Fg=(e,t)=>Promise.race([e,new Promise((o,r)=>{t.aborted&&r(new DOMException("Aborted","AbortError"));const a=()=>{t.removeEventListener("abort",a),r(new DOMException("Aborted","AbortError"))};t.addEventListener("abort",a)})]),x3=({nodes:e,getUpstreamNodeValues:t,setError:o,t:r,registerOperation:a,unregisterOperation:i,updateNodeInStorage:s,getFullSizeImage:l,activeTabId:c,activeTabName:d,activeTabIdRef:u})=>{const[p,h]=v.useState(!1),[w,k]=v.useState(!1),b=v.useRef(null),y=v.useCallback(async(m,x)=>{const _=u.current,S=e.find(F=>F.id===m);if(!S)return;const P=JSON.parse(S.value||"{}"),j=P.isSequenceMode,M=t(m,"text").filter(F=>typeof F=="string"),D=t(m,"image").filter(F=>typeof F=="object"),O=t(m,"image_b").filter(F=>typeof F=="object"),B=new Map;M.forEach(F=>{try{const z=JSON.parse(F);let G=[];if(z.sourcePrompts||z.modifiedPrompts){const U=z.sourcePrompts||[],R=z.modifiedPrompts||[],q=new Map;U.forEach(H=>q.set(H.frameNumber,H)),R.forEach(H=>q.set(H.frameNumber,{...q.get(H.frameNumber),...H})),G=Array.from(q.values())}else z.type==="script-prompt-modifier-data"?G=z.finalPrompts||z.prompts||[]:Array.isArray(z)&&(G=z);G.length>0&&G.forEach((U,R)=>{const q=(U.frameNumber!==void 0?U.frameNumber:R+1)-1;U.prompt&&B.set(q,U.prompt)})}catch{}});const E=(P.inputImages||[]).map((F,z)=>{var R;const U=l(S.id,z+1)||F;return{base64ImageData:U.split(",")[1],mimeType:((R=U.match(/:(.*?);/))==null?void 0:R[1])||"image/png"}}),I=(P.inputImagesB||[]).map((F,z)=>{var R;const U=l(S.id,2e3+z+1)||F;return{base64ImageData:U.split(",")[1],mimeType:((R=U.match(/:(.*?);/))==null?void 0:R[1])||"image/png"}}),N=[...E,...D],T=[...I,...O];if(!P.isSequentialEditingWithPrompts&&N.length===0&&P.model!=="gemini-3-pro-image-preview"){o("No input image provided for editing.");return}h(!0),o(null),k(!1),b.current=new AbortController,a({id:m,type:"generation",description:r("node.content.editing"),tabId:c,tabName:d});try{if(j){const F=x||(P.isSequentialEditingWithPrompts?P.checkedSequenceOutputIndices||T.map((U,R)=>R):P.checkedInputIndices??N.map((U,R)=>R)),G=[...P.sequenceOutputs||[]];F.forEach(U=>{G[U]={status:"pending",thumbnail:null}}),s(_,m,U=>({...U,sequenceOutputs:G}));for(const U of F){if(b.current.signal.aborted)break;let R=[];if(P.isSequentialEditingWithPrompts)R=T;else{const q=N[U];if(!q&&P.model!=="gemini-3-pro-image-preview")continue;q&&(R=[q]),P.isSequentialCombinationMode&&T.length>0&&R.push(...T)}s(_,m,q=>{const H=[...q.sequenceOutputs||[]];return H[U]={...H[U],status:"generating"},{...q,sequenceOutputs:H}});try{let q=P.prompt;(P.isSequentialPromptMode||P.isSequentialEditingWithPrompts)&&(B.has(U)?q=B.get(U):P.framePrompts&&P.framePrompts[U]&&(q=P.framePrompts[U]));const H=M.filter(te=>!te.trim().startsWith("{")&&!te.trim().startsWith("["));let ne=[q,...H].filter(Boolean).join(", ");const X=await Promise.all(R.map(async te=>{var ee;const le=`data:${te.mimeType};base64,${te.base64ImageData}`;if(P.enableAspectRatio&&P.aspectRatio&&P.aspectRatio!=="Auto"){const{formattedImage:se}=await Cr(le,P.aspectRatio);return{base64ImageData:se.split(",")[1],mimeType:((ee=se.match(/:(.*?);/))==null?void 0:ee[1])||"image/png"}}return te}));P.enableOutpainting&&(ne=(P.outpaintingPrompt||"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.").replace("{main_prompt}",ne));const re=await Fg($n(ne,P.aspectRatio,X,P.model,P.resolution),b.current.signal);let de=re;if(P.autoCrop169)try{de=await Ra(re)}catch(te){console.error(te)}const ge=await Rt(de,256,256);if(s(_,m,te=>{const le=[...te.sequenceOutputs||[]];return le[U]={status:"done",thumbnail:ge},{...te,sequenceOutputs:le}},{frame:1e3+U,url:de}),P.autoDownload){const le=new Date().toISOString().split("T")[0],se=`Image_Editor_Frame_${String(U+1).padStart(3,"0")}_${le}.png`;let ie=de;de.startsWith("data:image/png")&&(ie=Bi(de,"prompt",ne));const oe=document.createElement("a");oe.href=ie,oe.download=se,document.body.appendChild(oe),oe.click(),document.body.removeChild(oe)}}catch(q){if(q.name==="AbortError"||q.message==="Aborted"){s(_,m,H=>{const ne=[...H.sequenceOutputs||[]];return ne[U]={...ne[U],status:"pending"},{...H,sequenceOutputs:ne}});break}else console.error(`Frame ${U} failed`,q),s(_,m,H=>{const ne=[...H.sequenceOutputs||[]];return ne[U]={status:"error",thumbnail:null},{...H,sequenceOutputs:ne}})}}}else{let F=[];const z=P.checkedInputIndices;z&&Array.isArray(z)?F=N.filter((X,re)=>z.includes(re)):F=N;const G=M.filter(X=>!X.trim().startsWith("{")&&!X.trim().startsWith("["));let U=[P.prompt,...G].filter(Boolean).join(", ");const R=await Promise.all(F.map(async X=>{var de;const re=`data:${X.mimeType};base64,${X.base64ImageData}`;if(P.enableAspectRatio&&P.aspectRatio&&P.aspectRatio!=="Auto"){const{formattedImage:ge}=await Cr(re,P.aspectRatio);return{base64ImageData:ge.split(",")[1],mimeType:((de=ge.match(/:(.*?);/))==null?void 0:de[1])||"image/png"}}return X}));P.enableOutpainting&&(U=(P.outpaintingPrompt||"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.").replace("{main_prompt}",U));const q=await Fg($n(U,P.aspectRatio,R,P.model,P.resolution),b.current.signal);let H=q;if(P.autoCrop169)try{H=await Ra(q)}catch(X){console.error(X)}const ne=await Rt(H,256,256);s(_,m,X=>({...X,outputImage:ne}),{frame:0,url:H}),P.autoDownload&&f3(H,U)}}catch(F){F.name!=="AbortError"&&F.message!=="Aborted"&&o(F.message)}finally{h(!1),k(!1),b.current=null,i(m)}},[e,t,l,o,r,s,a,i,c,d,u]),g=v.useCallback(()=>{b.current&&(k(!0),b.current.abort())},[]);return{isEditingImage:p,isStoppingEdit:w,handleEditImage:y,handleStopEdit:g}},Bg=(e,t)=>Promise.race([e,new Promise((o,r)=>{t.aborted&&r(new DOMException("Aborted","AbortError"));const a=()=>{t.removeEventListener("abort",a),r(new DOMException("Aborted","AbortError"))};t.addEventListener("abort",a)})]),Hg=(e,t,o)=>{let r=e;e.startsWith("data:image/png")&&(r=Bi(e,"prompt",o));const a=document.createElement("a");a.href=r;const i=new Date,s=i.toISOString().split("T")[0],l=i.toTimeString().split(" ")[0].replace(/:/g,"-"),c=String(t).padStart(3,"0");a.download=`Frame_${c}_seq_gen_${s}_${l}.png`,document.body.appendChild(a),a.click(),document.body.removeChild(a)},y3=({nodes:e,setError:t,t:o,registerOperation:r,unregisterOperation:a,updateNodeInStorage:i,connectedCharacterData:s,activeTabId:l,activeTabName:c,activeTabIdRef:d,addToast:u,setFullSizeImage:p})=>{const[h,w]=v.useState(null),[k,b]=v.useState(!1),y=v.useRef(null),g=(j,M)=>{const D=j.characterConcepts||[];return[...(s.get(M)||[]).map(E=>({...E,id:E.index||E.alias||E.name||`upstream-${Math.random().toString(36).substr(2,5)}`,isUpstream:!0})),...D]},m=(j,M)=>{if(!j)return null;const D=B=>String(B).toLowerCase().replace(/[^a-z0-9]/g,""),O=D(j);return M.find(B=>!!(B.index&&D(B.index)===O||B.alias&&D(B.alias)===O||B.name&&D(B.name)===O||B.id&&D(B.id)===O))},x=v.useCallback((j,M)=>{i(j,M,D=>{const O={...D.frameStatuses||{}};let B=!1;return Object.keys(O).forEach(E=>{const I=O[E];(I==="pending"||I==="generating"||I==="prompt_processing")&&(O[E]="idle",B=!0)}),B?{...D,frameStatuses:O}:D})},[i]),_=v.useCallback(async(j,M=0)=>{var B;const D=d.current,O=e.find(E=>E.id===j);if(O){w(j),t(null),b(!1),y.current=new AbortController,r({id:j,type:"sequence",description:o("node.content.generating"),tabId:l,tabName:c});try{const E=JSON.parse(O.value||"{}"),I=E.prompts||[],N=g(E,j),T=I.slice(M),F=E.isStyleInserted!==!1,z=E.isSceneContextInserted!==!1,G=E.sceneContexts||{},U=E.integrationPrompt||"Integrate these Entities into the scene, action and pose. Fill the background with environmental elements  fill in the gray area of the source scene image naturally.";i(D,j,R=>{const q={...R.frameStatuses||{}};return Object.keys(q).forEach(H=>{q[H]==="generating"&&(q[H]="idle")}),T.forEach(H=>{q[H.frameNumber]="pending"}),{...R,frameStatuses:q}});for(const R of T){if((B=y.current)!=null&&B.signal.aborted)break;const q=R.frameNumber;i(D,j,H=>({...H,frameStatuses:{...H.frameStatuses||{},[q]:"generating"}}));try{let H=R.characters||[];if(H.length===0&&R.prompt){const ee=R.prompt.match(/(?:character|entity)-\d+/gi);ee&&(H=[...new Set(ee)])}const ne=[],X=new Set;for(const ee of H){const se=m(ee,N);if(!se||X.has(se.index||se.id))continue;const ie=se._fullResImage||se.image;if(ie&&typeof ie=="string"&&ie.startsWith("data:")){const oe=ie.match(/:(.*?);/),A=ie.split(",")[1];A&&(ne.push({base64ImageData:A,mimeType:oe?oe[1]:"image/png",_dataUrl:ie}),X.add(se.index||se.id))}}let re=R.prompt;if(z){const ee=R.sceneNumber||1,se=G[String(ee)];se&&se.trim()&&(re=`${se.trim()}

${re}`)}if(ne.length>0){const ee=R.shotType?o(`image_sequence.shot_type.${R.shotType}`):"";re=`${U}
${ee}

${re}`,E.characterPromptCombination==="replace"&&(re=re.replace(/((?:Character|Entity)[-\s]?\d+|(?:Character|Entity)[-\s]?\w+)/gi,se=>{const ie=m(se,N);return ie&&ie.prompt?`${se} (${ie.prompt})`:se}))}let de=[];E.enableAspectRatio&&E.aspectRatio&&E.aspectRatio!=="Auto"&&ne.length>0?de=await Promise.all(ne.map(async ee=>{var se;try{const{formattedImage:ie}=await Cr(ee._dataUrl,E.aspectRatio);return{base64ImageData:ie.split(",")[1],mimeType:((se=ie.match(/:(.*?);/))==null?void 0:se[1])||"image/png"}}catch{return{base64ImageData:ee.base64ImageData,mimeType:ee.mimeType}}})):de=ne.map(ee=>({base64ImageData:ee.base64ImageData,mimeType:ee.mimeType})),F&&E.styleOverride&&(re=`${re}

[Visual Style]: ${E.styleOverride}`);const ge=await Bg($n(re,E.aspectRatio,de.length>0?de:void 0,E.model),y.current.signal);let te=ge;if(E.autoCrop169&&E.aspectRatio==="16:9")try{te=await Ra(ge)}catch{}const le=await Rt(te,256,256);i(D,j,ee=>({...ee,images:{...ee.images||{},[q]:le},frameStatuses:{...ee.frameStatuses||{},[q]:"done"}}),{frame:1e3+q,url:te}),E.autoDownload&&Hg(te,q,R.prompt),await new Promise(ee=>setTimeout(ee,50))}catch(H){if(H.name==="AbortError"||H.message==="Aborted"){i(D,j,ne=>({...ne,frameStatuses:{...ne.frameStatuses||{},[q]:"idle"}}));break}else console.error(`Frame ${q} failed:`,H),i(D,j,ne=>({...ne,frameStatuses:{...ne.frameStatuses||{},[q]:"error"}}))}}}catch(E){E.name!=="AbortError"&&E.message!=="Aborted"&&t(E.message)}finally{x(D,j),w(null),b(!1),y.current=null,a(j)}}},[e,s,t,o,i,r,a,l,c,d,u,p,x]),S=v.useCallback(async(j,M)=>{var I;const D=d.current,O=e.find(N=>N.id===j);if(!O)return;const B=JSON.parse(O.value||"{}"),E=M||B.checkedFrameNumbers||[];if(E.length!==0){w(j),t(null),b(!1),y.current=new AbortController,r({id:j,type:"sequence",description:o("node.content.generating"),tabId:l,tabName:c});try{const N=B.prompts||[],T=g(B,j),F=N.filter(q=>E.includes(q.frameNumber)),z=B.isStyleInserted!==!1,G=B.isSceneContextInserted!==!1,U=B.sceneContexts||{},R=B.integrationPrompt||"Integrate these Entities into the scene, action and pose. Fill the background with environmental elements  fill in the gray area of the source scene image naturally.";i(D,j,q=>{const H={...q.frameStatuses||{}};return Object.keys(H).forEach(ne=>{H[ne]==="generating"&&(H[ne]="idle")}),E.forEach(ne=>{H[ne]="pending"}),{...q,frameStatuses:H}});for(const q of F){if((I=y.current)!=null&&I.signal.aborted)break;const H=q.frameNumber;i(D,j,ne=>({...ne,frameStatuses:{...ne.frameStatuses||{},[H]:"generating"}}));try{let ne=q.characters||[];if(ne.length===0&&q.prompt){const se=q.prompt.match(/(?:character|entity)-\d+/gi);se&&(ne=[...new Set(se)])}const X=[],re=new Set;for(const se of ne){const ie=m(se,T);if(!ie||re.has(ie.index||ie.id))continue;const oe=ie._fullResImage||ie.image;if(oe&&typeof oe=="string"&&oe.startsWith("data:")){const A=oe.match(/:(.*?);/),K=oe.split(",")[1];K&&(X.push({base64ImageData:K,mimeType:A?A[1]:"image/png",_dataUrl:oe}),re.add(ie.index||ie.id))}}let de=q.prompt;if(G){const se=q.sceneNumber||1,ie=U[String(se)];ie&&ie.trim()&&(de=`${ie.trim()}

${de}`)}if(X.length>0){const se=q.shotType?o(`image_sequence.shot_type.${q.shotType}`):"";de=`${R}
${se}

${de}`,B.characterPromptCombination==="replace"&&(de=de.replace(/((?:Character|Entity)[-\s]?\d+|(?:Character|Entity)[-\s]?\w+)/gi,ie=>{const oe=m(ie,T);return oe&&oe.prompt?`${ie} (${oe.prompt})`:ie}))}let ge=[];B.enableAspectRatio&&B.aspectRatio&&B.aspectRatio!=="Auto"&&X.length>0?ge=await Promise.all(X.map(async se=>{var ie;try{const{formattedImage:oe}=await Cr(se._dataUrl,B.aspectRatio);return{base64ImageData:oe.split(",")[1],mimeType:((ie=oe.match(/:(.*?);/))==null?void 0:ie[1])||"image/png"}}catch{return{base64ImageData:se.base64ImageData,mimeType:se.mimeType}}})):ge=X.map(se=>({base64ImageData:se.base64ImageData,mimeType:se.mimeType})),z&&B.styleOverride&&(de=`${de}

[Visual Style]: ${B.styleOverride}`);const te=await Bg($n(de,B.aspectRatio,ge.length>0?ge:void 0,B.model),y.current.signal);let le=te;if(B.autoCrop169&&B.aspectRatio==="16:9")try{le=await Ra(te)}catch{}const ee=await Rt(le,256,256);i(D,j,se=>({...se,images:{...se.images||{},[H]:ee},frameStatuses:{...se.frameStatuses||{},[H]:"done"}}),{frame:1e3+H,url:le}),B.autoDownload&&Hg(le,H,q.prompt),await new Promise(se=>setTimeout(se,50))}catch(ne){if(ne.name==="AbortError"&&ne.message==="Aborted"){i(D,j,X=>({...X,frameStatuses:{...X.frameStatuses||{},[H]:"idle"}}));break}else console.error(`Frame ${H} failed:`,ne),i(D,j,X=>({...X,frameStatuses:{...X.frameStatuses||{},[H]:"error"}}))}}}catch(N){N.name!=="AbortError"&&N.message!=="Aborted"&&t(N.message)}finally{x(D,j),w(null),b(!1),y.current=null,a(j)}}},[e,s,t,o,i,r,a,l,c,d,u,p,x]),P=v.useCallback(()=>{y.current&&(b(!0),y.current.abort())},[]);return{isGeneratingSequence:h,isStoppingSequence:k,handleGenerateImageSequence:_,handleGenerateSelectedFrames:S,handleStopImageSequence:P}},v3=({nodes:e,setError:t,t:o,registerOperation:r,unregisterOperation:a,updateNodeInStorage:i,activeTabId:s,activeTabName:l,activeTabIdRef:c})=>{const[d,u]=v.useState(null),p=v.useCallback(async(h,w)=>{const k=c.current,b=e.find(y=>y.id===h);if(b){u(`${h}-${w}`),r({id:h,type:"generation",description:o("node.content.generating"),tabId:s,tabName:l});try{const y=JSON.parse(b.value||"{}"),g=y.characters||[],m=g.find(D=>D.id===w);if(!m)throw new Error("Character not found");const x=m.prompt||m.imagePrompt;if(!x)throw new Error("No prompt for character");const _=y.additionalPrompt||"",S=_.trim()?`${x}, ${_}`:x,j=(await $n(S,"1:1",void 0,"gemini-3-flash-preview")).split(",")[1],M=g.map(D=>D.id===w?{...D,imageBase64:j}:D);i(k,h,D=>({...D,characters:M}))}catch(y){t(y.message)}finally{u(null),a(h)}}},[e,t,o,i,r,a,s,l,c]);return{isGeneratingCharacterImage:d,handleGenerateCharacterImage:p}},w3=({nodes:e,connections:t,setNodes:o,getUpstreamNodeValues:r,setError:a,showApiKeyDialog:i,t:s,setFullSizeImage:l,getFullSizeImage:c,connectedCharacterData:d,activeTabId:u,setTabs:p,activeTabName:h,registerOperation:w,unregisterOperation:k,isGlobalProcessing:b,addToast:y})=>{const g=v.useRef(u);v.useEffect(()=>{g.current=u},[u]);const m=v.useCallback((D,O,B,E)=>{const I=N=>{try{return JSON.parse(N||"{}")}catch{return N}};g.current===D?(E&&l(O,E.frame,E.url),o(N=>N.map(T=>{if(T.id===O){const F=I(T.value),z=B(F),G=typeof z=="string"?z:JSON.stringify(z);return{...T,value:G}}return T}))):p(N=>N.map(T=>{if(T.id===D){const F=T.state.nodes.map(G=>{if(G.id===O){const U=I(G.value),R=B(U),q=typeof R=="string"?R:JSON.stringify(R);return{...G,value:q}}return G});let z=T.state.fullSizeImageCache||{};return E&&(z={...z,[O]:{...z[O]||{},[E.frame]:E.url}}),{...T,state:{...T.state,nodes:F,fullSizeImageCache:z}}}return T}))},[o,p,l]),x={nodes:e,setNodes:o,getUpstreamNodeValues:r,setError:a,t:s,setFullSizeImage:l,getFullSizeImage:c,activeTabId:u,setTabs:p,activeTabName:h,registerOperation:w,unregisterOperation:k,updateNodeInStorage:m,activeTabIdRef:g,addToast:y},_=m3(x),S=g3({...x,showApiKeyDialog:i}),P=x3(x),j=y3({...x,connectedCharacterData:d}),M=v3(x);return{isGeneratingImage:_.isGeneratingImage,handleGenerateImage:_.handleGenerateImage,isGeneratingVideo:S.isGeneratingVideo,handleGenerateVideo:S.handleGenerateVideo,isEditingImage:P.isEditingImage,isStoppingEdit:P.isStoppingEdit,handleEditImage:P.handleEditImage,handleStopEdit:P.handleStopEdit,isGeneratingSequence:j.isGeneratingSequence,isStoppingSequence:j.isStoppingSequence,handleGenerateImageSequence:j.handleGenerateImageSequence,handleGenerateSelectedFrames:j.handleGenerateSelectedFrames,handleStopImageSequence:j.handleStopImageSequence,isGeneratingCharacterImage:M.isGeneratingCharacterImage,handleGenerateCharacterImage:M.handleGenerateCharacterImage}},b3=({nodes:e,setNodes:t,getUpstreamNodeValues:o,setError:r,t:a,activeTabId:i,setTabs:s,activeTabName:l,registerOperation:c,unregisterOperation:d,addToast:u})=>{const[p,h]=v.useState(null),[w,k]=v.useState(null),[b,y]=v.useState(null),[g,m]=v.useState(null),[x,_]=v.useState(null),[S,P]=v.useState(null),[j,M]=v.useState(null),[D,O]=v.useState(null),[B,E]=v.useState(null),[I,N]=v.useState(null),[T,F]=v.useState(null),[z,G]=v.useState(null),[U,R]=v.useState(null),[q,H]=v.useState(!1),ne=v.useRef(null),X=v.useRef(i);v.useEffect(()=>{X.current=i},[i]);const re=v.useCallback(($,V,J)=>{const Y=ae=>{try{return JSON.parse(ae||"{}")}catch{return ae}};X.current===$?t(ae=>ae.map(ue=>{if(ue.id===V){const he=Y(ue.value),ye=J(he),ve=typeof ye=="string"?ye:JSON.stringify(ye);return{...ue,value:ve}}return ue})):s(ae=>ae.map(ue=>{if(ue.id===$){const he=ue.state.nodes.map(ye=>{if(ye.id===V){const ve=Y(ye.value),me=J(ve),_e=typeof me=="string"?me:JSON.stringify(me);return{...ye,value:_e}}return ye});return{...ue,state:{...ue.state,nodes:he}}}return ue}))},[t,s]),de=v.useCallback(async $=>{const V=X.current;h($),r(null),c({id:$,type:"generation",description:a("node.content.enhancing"),tabId:i,tabName:l});try{const J=e.find(ve=>ve.id===$);if(!J)return;let Y;try{Y=JSON.parse(J.value||"{}")}catch{Y={prompt:J.value}}const ae=Y.safePrompt!==!1,ue=Y.technicalPrompt===!0;let he=o($).filter(ve=>typeof ve=="string");he.length===0&&Y.inputPrompt&&(he=[Y.inputPrompt]);const ye=await D1(he,ae,ue);re(V,$,ve=>({...ve,prompt:ye}))}catch(J){r(J.message)}finally{h(null),d($)}},[e,o,r,a,re,c,d,i,l]),ge=v.useCallback(async $=>{const V=X.current;y($),r(null),c({id:$,type:"generation",description:a("node.content.sanitizing"),tabId:i,tabName:l});try{const J=o($).filter(ae=>typeof ae=="string"),Y=await z1(J.join(", "));re(V,$,()=>Y)}catch(J){r(J.message)}finally{y(null),d($)}},[o,r,a,re,c,d,i,l]),te=v.useCallback(async $=>{const V=X.current;k($),r(null),c({id:$,type:"generation",description:a("node.content.enhancing"),tabId:i,tabName:l});try{const J=o($).filter(ae=>typeof ae=="string"),Y=await q1(J);re(V,$,ae=>typeof ae=="object"?{...ae,prompt:Y}:Y)}catch(J){r(J.message)}finally{k(null),d($)}},[o,r,a,re,c,d,i,l]),le=v.useCallback(async $=>{const V=X.current;m($),r(null),c({id:$,type:"generation",description:a("node.content.translating"),tabId:i,tabName:l});try{const J=e.find(ve=>ve.id===$);if(!J)return;const Y=JSON.parse(J.value||"{}"),ae=o($).filter(ve=>typeof ve=="string");let ue=ae.length>0?ae.join(`
`):Y.inputText;const he=Y.targetLanguage||"en";if(Y.image&&typeof Y.image=="string"&&Y.image.startsWith("data:image")){const ve=Y.image.split(",");if(ve.length===2){const me=Y.image.match(/:(.*?);/),_e=me?me[1]:"image/png",pe=ve[1],xe=await Lp(pe,_e);xe&&xe!=="No text found"&&(ue=xe,Y.inputText=xe)}}const ye=await Dp(ue,he);re(V,$,ve=>({...ve,inputText:ue,translatedText:ye}))}catch(J){r(J.message)}finally{m(null),d($)}},[e,o,r,a,re,c,d,i,l]),ee=v.useCallback(async $=>{const V=X.current;_($),r(null),c({id:$,type:"generation",description:a("node.content.translating"),tabId:i,tabName:l});try{const J=e.find(ve=>ve.id===$);if(!J)return;const Y=JSON.parse(J.value||"{}"),ae=Y.targetLanguage||"en",he={en:"English",ru:"Russian"}[ae]||"English",ye=await JE(Y,he);re(V,$,()=>(ye.targetLanguage=ae,ye))}catch(J){r(J.message)}finally{_(null),d($)}},[e,r,a,re,c,d,i,l]),se=v.useCallback(async $=>{const V=X.current;P($),r(null),c({id:$,type:"generation",description:a("node.content.generating"),tabId:i,tabName:l});try{const J=e.find(ve=>ve.id===$);if(!J)return;const Y=JSON.parse(J.value||"{}"),ae=o($).filter(ve=>typeof ve=="string"),ue=ae.length>0?ae.join(`
`):Y.prompt,he=Y.targetLanguage||"en",ye=await H1(ue,he);re(V,$,ve=>({...ve,...ye,prompt:ue,type:"script-generator-data"}))}catch(J){r(J.message)}finally{P(null),d($)}},[e,o,r,a,re,c,d,i,l]),ie=v.useCallback(async $=>{var J;const V=X.current;M($),r(null),ne.current=new AbortController,c({id:$,type:"generation",description:a("node.content.generating"),tabId:i,tabName:l});try{const Y=e.find(De=>De.id===$);if(!Y)return;const ae=JSON.parse(Y.value||"{}"),ue=o($).filter(De=>typeof De=="string"),he=ue.length>0?ue.join(`
`):ae.prompt,ye=ae.numberOfCharacters||1,ve=ae.targetLanguage||"ru",me=ae.characterType||"simple",_e=ae.style||"simple",pe=ae.customStyle||"",xe=ae.characters||[],Se=`Generate ${ye} detailed character description(s) based on this prompt: "${he}". 
            Language for CONTENT: ${ve}. 
            Character Type: ${me}. 
            Visual Style: ${_e==="custom"?pe:_e}.
            
            **CRITICAL REQUIREMENTS:**
            1. **APPEARANCE ONLY**: Focus strictly on physical attributes: physiognomy, hair/fur texture, eye color, body type, clothing details, colors, and materials.
            2. **NEGATIVE CONSTRAINTS**: Do NOT describe the pose, action, gesture, expression (e.g. smiling), background, lighting, or camera angle.
            3. **FORMAT**: You MUST use the following English Markdown Headers exactly as written, regardless of content language:
               #### Appearance
               #### Personality
               #### Clothing
            
            REQUIRED OUTPUT FORMAT:
            Return a JSON array where each object has:
            - 'name': Character name.
            - 'index': Short identifier (e.g. Entity-1, Entity-2).
            - 'imagePrompt': A highly detailed English image generation prompt describing the character's visual features ONLY.
            - 'fullDescription': A detailed text description formatted with the markdown headers specified above.
            `,Le=await G1(Se);if((J=ne.current)!=null&&J.signal.aborted)return;let Ee=0;xe.forEach(De=>{const Re=(De.index||De.alias||"").match(/(?:Entity|Character)-(\d+)/i);Re&&(Ee=Math.max(Ee,parseInt(Re[1],10)))});const Me=Le.map((De,Te)=>({id:`char-${Date.now()}-${Te}`,...De,index:De.index||`Entity-${Ee+Te+1}`,prompt:De.imagePrompt}));re(V,$,De=>{const Te=De.characters||[],Re=[...Me,...Te];return{...De,characters:Re,prompt:he,error:null}})}catch(Y){Y.name!=="AbortError"&&r(Y.message)}finally{M(null),ne.current=null,H(!1),d($)}},[e,o,r,a,re,c,d,i,l]),oe=v.useCallback(()=>{ne.current&&(H(!0),ne.current.abort())},[]),A=v.useCallback(async $=>{const V=X.current;O($),r(null),c({id:$,type:"sequence",description:a("prompt_sequence_editor.modifying"),tabId:i,tabName:l});try{const J=e.find(De=>De.id===$);if(!J)return;const{instruction:Y,sourcePrompts:ae=[],checkedSourceFrameNumbers:ue=[],targetLanguage:he="en",modificationModel:ye="gemini-2.5-flash",includeVideoPrompts:ve=!1,checkedContextScenes:me=[],sceneContexts:_e={}}=JSON.parse(J.value||"{}");if(!Y||!Y.trim())throw new Error("Modification instruction is empty.");if(!ue||ue.length===0)throw new Error("No source prompts selected for modification.");const pe=ae.filter(De=>ue.includes(De.frameNumber));if(pe.length===0)throw new Error("Selected prompts not found in the source list.");let xe={};new Set(pe.map(De=>De.sceneNumber)).forEach(De=>{_e[De]&&me.includes(De)&&(xe[String(De)]=_e[De])});const Le=await U1(pe,Y,he,ye,ve,xe),{modifiedFrames:Ee,modifiedSceneContexts:Me}=Le;re(V,$,De=>{const Te=De.modifiedPrompts||[],Re=De.sourcePrompts||[],we=new Map(Re.map(Ie=>[Ie.frameNumber,Ie])),Ce=new Map(Te.map(Ie=>[Ie.frameNumber,Ie]));Ee.forEach(Ie=>{const We=we.get(Ie.frameNumber);We&&(Ie.sceneNumber=We.sceneNumber,Ie.sceneTitle=We.sceneTitle),Ce.set(Ie.frameNumber,Ie)});const qe=Array.from(Ce.values());let Be={...De.modifiedSceneContexts||{}};return Me&&Me.length>0&&Me.forEach(Ie=>{Ie.sceneNumber&&Ie.context&&(Be[String(Ie.sceneNumber)]=Ie.context)}),{...De,modifiedPrompts:qe,modifiedSceneContexts:Be}})}catch(J){r(J.message)}finally{O(null),d($)}},[e,r,a,re,c,d,i,l]),K=v.useCallback(async($,V)=>{var ae;const J=X.current,Y=`${$}-${V}`;E(Y),r(null),c({id:Y,type:"generation",description:a("node.content.enhancing"),tabId:i,tabName:l});try{const ue=e.find(Le=>Le.id===$);if(!ue)return;const he=JSON.parse(ue.value||"[]"),ve=(Array.isArray(he)?he:[he])[V];if(!ve)throw new Error("Character card not found at specified index.");const me=ve.prompt,_e=ve.fullDescription,pe=ve.targetLanguage||localStorage.getItem("settings_secondaryLanguage")||"en",xe=((ae=fn[pe])==null?void 0:ae.name)||"English";if(!me||!me.trim())throw new Error("Image prompt is missing for this character.");const Se=await GE(me,_e,xe);re(J,$,Le=>{const Ee=Array.isArray(Le)?[...Le]:[Le];return Ee[V]&&(Ee[V]={...Ee[V],fullDescription:Se}),Ee}),u("Description updated successfully","success")}catch(ue){r(ue.message)}finally{E(null),d(Y)}},[e,r,a,re,c,d,i,l,u]),Z=v.useCallback(async($,V,J,Y)=>{var he;const ae=X.current,ue=`${$}-${V}-${J}`;Y(ue),r(null),c({id:ue,type:"generation",description:a("node.content.enhancing"),tabId:i,tabName:l});try{const ye=e.find(we=>we.id===$);if(!ye)return;const ve=JSON.parse(ye.value||"[]"),_e=(Array.isArray(ve)?ve:[ve])[V];if(!_e)throw new Error("Character card not found at specified index.");const pe=_e.prompt;if(!pe)throw new Error("Image prompt required for update.");const xe=_e.fullDescription||"",Se=_e.targetLanguage||localStorage.getItem("settings_secondaryLanguage")||"en",Le=((he=fn[Se])==null?void 0:he.name)||"English",Me=new RegExp(`####\\s*(${J}|${a(`node.content.${J.toLowerCase()}`)})\\s*([\\s\\S]*?)(?=####|$)`,"i").exec(xe),De=Me?Me[2].trim():"",Te=await UE(J,pe,De,Le);let Re=xe;if(Me){const we=Me[0],qe=`#### ${Me[1]}
${Te}
`;Re=xe.replace(we,qe)}else{const we=a(`node.content.${J.toLowerCase()}`)||J;Re+=`

#### ${we}
${Te}`}re(ae,$,we=>{const Ce=Array.isArray(we)?[...we]:[we];return Ce[V]&&(Ce[V]={...Ce[V],fullDescription:Re}),Ce}),u(`${J} updated successfully`,"success")}catch(ye){r(ye.message)}finally{Y(null),d(ue)}},[e,r,a,re,c,d,i,l,u]),W=v.useCallback(($,V)=>{Z($,V,"Appearance",F)},[Z]),Q=v.useCallback(($,V)=>{Z($,V,"Clothing",G)},[Z]),ce=v.useCallback(async($,V)=>{var ae;const J=X.current,Y=`${$}-${V}-personality`;N(Y),r(null),c({id:Y,type:"generation",description:a("node.content.enhancing"),tabId:i,tabName:l});try{const ue=e.find(De=>De.id===$);if(!ue)return;const he=JSON.parse(ue.value||"[]"),ve=(Array.isArray(he)?he:[he])[V];if(!ve)throw new Error("Character card not found at specified index.");const me=ve.fullDescription||"",_e=ve.targetLanguage||localStorage.getItem("settings_secondaryLanguage")||"en",pe=((ae=fn[_e])==null?void 0:ae.name)||"English",Se=/####\s*(Personality|||Personalidad)\s*([\s\S]*?)(?=####|$)/i.exec(me),Le=Se?Se[2].trim():"";if(!Le)throw new Error("Personality section is empty or not found.");const Ee=await VE(Le,pe);let Me=me;if(Se){const De=Se[0],Re=`#### ${Se[1]}
${Ee}
`;Me=me.replace(De,Re)}else Me+=`

#### Personality
${Ee}`;re(J,$,De=>{const Te=Array.isArray(De)?[...De]:[De];return Te[V]&&(Te[V]={...Te[V],fullDescription:Me}),Te}),u("Personality updated successfully","success")}catch(ue){r(ue.message)}finally{N(null),d(Y)}},[e,r,a,re,c,d,i,l,u]),fe=v.useCallback(async($,V,J)=>{var ue;const Y=X.current,ae=`${$}-${V}`;R(ae),r(null),c({id:ae,type:"generation",description:a("prompt_sequence_editor.modifying"),tabId:i,tabName:l});try{const he=e.find(Ee=>Ee.id===$);if(!he)return;const ye=JSON.parse(he.value||"[]"),me=(Array.isArray(ye)?ye:[ye])[V];if(!me)throw new Error("Character card not found.");const _e=me.prompt,pe=me.fullDescription,xe=me.targetLanguage||localStorage.getItem("settings_secondaryLanguage")||"en",Se=((ue=fn[xe])==null?void 0:ue.name)||"English",Le=await WE(J,_e,pe,Se);re(Y,$,Ee=>{const Me=Array.isArray(Ee)?[...Ee]:[Ee];return Me[V]&&(Me[V]={...Me[V],prompt:Le.newPrompt,fullDescription:Le.newDescription}),Me}),u(a("toast.modificationComplete"),"success")}catch(he){r(he.message)}finally{R(null),d(ae)}},[e,r,a,re,c,d,i,l,u]);return{isEnhancing:p,isEnhancingVideo:w,isSanitizing:b,isTranslating:g,isTranslatingScript:x,isGeneratingScript:S,isGeneratingCharacters:j,isModifyingPromptSequence:D,isUpdatingDescription:B,isUpdatingPersonality:I,isUpdatingAppearance:T,isUpdatingClothing:z,isModifyingCharacter:U,handleEnhance:de,handleEnhanceVideo:te,handleSanitizePrompt:ge,handleTranslate:le,handleTranslateScript:ee,handleGenerateScript:se,handleGenerateCharacters:ie,onModifyPromptSequence:A,handleUpdateCharacterDescription:K,handleUpdateCharacterPersonality:ce,handleUpdateCharacterAppearance:W,handleUpdateCharacterClothing:Q,handleModifyCharacter:fe,isStopping:q,handleStopGeneration:oe}},C3=e=>{const[t,o]=v.useState([]),[r,a]=v.useState([]),i=5,s=v.useCallback(d=>{const u=d.map(p=>({id:p.id,position:{...p.position}}));o(p=>{const h=[...p,u];return h.length>i?h.slice(h.length-i):h}),a([])},[]),l=v.useCallback(d=>{o(u=>{if(u.length===0)return u;const p=[...u],h=p.pop();if(h){const w=d.map(k=>({id:k.id,position:{...k.position}}));a(k=>[w,...k]),e(k=>k.map(b=>{const y=h.find(g=>g.id===b.id);return y?{...b,position:{...y.position}}:b}))}return p})},[e]),c=v.useCallback(d=>{a(u=>{if(u.length===0)return u;const p=[...u],h=p.shift();if(h){const w=d.map(k=>({id:k.id,position:{...k.position}}));o(k=>{const b=[...k,w];return b.length>i?b.slice(b.length-i):b}),e(k=>k.map(b=>{const y=h.find(g=>g.id===b.id);return y?{...b,position:{...y.position}}:b}))}return p})},[e]);return{takeSnapshot:s,undoPosition:l,redoPosition:c,canUndo:t.length>0,canRedo:r.length>0}},k3=({nodes:e})=>{const[t,o]=v.useState("idle"),[r,a]=v.useState(null),i=v.useRef(!1);v.useEffect(()=>{if(i.current)return;localStorage.getItem("tutorial_completed")&&o("completed"),i.current=!0},[]);const s=v.useCallback(()=>{if(localStorage.getItem("tutorial_completed")){o("completed");return}o("text_input_0")},[]),l=v.useCallback(()=>{localStorage.setItem("tutorial_completed","true"),o("completed")},[]),c=v.useCallback(()=>{o(u=>{switch(u){case"text_input_0":return"text_input_1";case"text_input_1":return"text_input_2";case"text_input_2":return"prompt_processor_enhance";case"prompt_processor_enhance":return"prompt_processor_waiting";case"prompt_processor_waiting":return"image_output_generate";case"image_output_generate":return"image_output_generating";case"image_output_generating":return"toolbar_group_catalog";case"toolbar_group_catalog":return"toolbar_group_general";case"toolbar_group_general":return"toolbar_group_input";case"toolbar_group_input":return"toolbar_group_processing";case"toolbar_group_processing":return"toolbar_group_character";case"toolbar_group_character":return"toolbar_group_output";case"toolbar_group_output":return"toolbar_group_ai";case"toolbar_group_ai":return"toolbar_group_video";case"toolbar_group_video":return"toolbar_group_scripts";case"toolbar_group_scripts":return"toolbar_group_file";case"toolbar_group_file":return"tutorial_success_message";case"tutorial_success_message":return localStorage.setItem("tutorial_completed","true"),"completed";default:return"completed"}})},[]),d=v.useCallback(u=>{o(u),u==="completed"&&localStorage.setItem("tutorial_completed","true")},[]);return v.useEffect(()=>{if(t==="completed"||t==="idle"||t==="tutorial_success_message"){a(null);return}const u=e.filter(k=>k.type===L.TEXT_INPUT).sort((k,b)=>k.position.y-b.position.y),p=e.filter(k=>k.type===L.PROMPT_PROCESSOR),h=e.filter(k=>k.type===L.IMAGE_OUTPUT);let w=null;switch(t){case"text_input_0":u.length>0&&(w=u[0].id);break;case"text_input_1":u.length>1?w=u[1].id:p.length>0&&o("prompt_processor_enhance");break;case"text_input_2":u.length>2?w=u[2].id:p.length>0&&o("prompt_processor_enhance");break;case"prompt_processor_enhance":case"prompt_processor_waiting":p.length>0&&(w=p[0].id);break;case"image_output_generate":h.length>0&&(w=h[0].id);break}a(w)},[t,e]),{tutorialStep:t,tutorialTargetId:r,advanceTutorial:c,startTutorial:s,setTutorialStep:d,skipTutorial:l}},V1="settings_googleClientId",_3=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],S3="https://www.googleapis.com/auth/drive.file";let Na,bu=!1,Cu=!1;const N3=async e=>e?new Promise(t=>{const o=()=>{typeof gapi<"u"?gapi.load("client",async()=>{await gapi.client.init({clientId:e,discoveryDocs:_3}),bu=!0,a()}):setTimeout(o,100)},r=()=>{typeof google<"u"&&google.accounts?(Na=google.accounts.oauth2.initTokenClient({client_id:e,scope:S3,callback:""}),Cu=!0,a()):setTimeout(r,100)},a=()=>{bu&&Cu&&t(!0)};o(),r()}):!1,E3=async()=>{if(!Na)throw new Error("Google Drive API not initialized. Please check Client ID.");return new Promise((e,t)=>{Na.callback=o=>{o.error?t(o):e(o)},Na.requestAccessToken({prompt:"consent"})})},P3=async(e,t)=>{if(!bu||!Cu)throw new Error("Google Drive API not initialized. Please configure Client ID in settings.");return new Promise((o,r)=>{const a=gapi.client.getToken(),i=async()=>{try{const s={name:e,mimeType:"application/json"},l="-------314159265358979323846",c=`\r
--`+l+`\r
`,d=`\r
--`+l+"--",u=c+`Content-Type: application/json\r
\r
`+JSON.stringify(s)+c+`Content-Type: application/json\r
\r
`+t+d;await gapi.client.request({path:"/upload/drive/v3/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/related; boundary="'+l+'"'},body:u}),o()}catch(s){r(s)}};a===null?(Na.callback=async s=>{s.error?r(s):await i()},Na.requestAccessToken({prompt:"consent"})):i()})},j3=()=>localStorage.getItem(V1)||"",T3=e=>localStorage.setItem(V1,e),I3=({addToast:e,getCurrentCanvasState:t,tabs:o,activeTabId:r,language:a,isSnapToGrid:i,lineStyle:s,catalogItems:l,libraryItems:c,characterCatalog:d,scriptCatalog:u,sequenceCatalog:p,t:h})=>{const[w,k]=v.useState(j3()),[b,y]=v.useState(!1),[g,m]=v.useState(!1);v.useEffect(()=>{w&&N3(w).then(()=>{y(!0)})},[w]);const x=P=>{T3(P),k(P)},_=v.useCallback(async()=>{if(!b){e(h("error.googleDriveInit"),"error");return}try{await E3(),e("Successfully signed in to Google!","success")}catch(P){console.error("Sign in failed",P),e("Failed to sign in to Google Drive","error")}},[b,e,h]),S=v.useCallback(async()=>{if(!b){e(h("error.googleDriveInit"),"error");return}m(!0);try{const P=t(),j=o.map(E=>E.id===r?{...E,state:P}:E),M={type:"prompt-modifier-project",appName:"Prompt_modifier",version:1,timestamp:new Date().toISOString(),tabs:j,activeTabId:r,settings:{language:a,isSnapToGrid:i,lineStyle:s},catalogs:{groups:l,library:c,characters:d.items,scripts:u.items,sequences:p.items}},D=JSON.stringify(M,null,2),B=`Prompt_Modifier_Project_${new Date().toISOString().replace(/:/g,"-").replace("T","_").split(".")[0]}.json`;await P3(B,D),e(h("toast.driveSaved"),"success")}catch(P){console.error("Drive Save Error:",P),e(h("toast.driveSaveFailed"),"error")}finally{m(!1)}},[b,t,o,r,a,i,s,l,c,d,u,p,h,e]);return{googleClientId:w,setGoogleClientId:x,handleSaveToDrive:S,handleGoogleSignIn:_,isGoogleDriveReady:b,isGoogleDriveSaving:g}},A3=e=>{const{t}=St(),[o,r]=v.useState(!0),[a,i]=v.useState([]),s=v.useRef(0),[l,c]=v.useState(!1),[d,u]=v.useState("orthogonal"),[p,h]=v.useState(null),[w,k]=v.useState("edit"),[b,y]=v.useState(null),[g,m]=v.useState(null),[x,_]=v.useState({}),[S,P]=v.useState(0),[j,M]=v.useState(null),[D,O]=v.useState(!1),[B,E]=v.useState([]),[I,N]=v.useState([]),[T,F]=v.useState(!1),[z,G]=v.useState(!0),[U,R]=v.useState("pulse"),[q,H]=v.useState(null),[ne,X]=v.useState(!1),[re,de]=v.useState(null),[ge,te]=v.useState([]),[le,ee]=v.useState(!1),[se,ie]=v.useState(!0),[oe,A]=v.useState(.4),[K,Z]=v.useState("cyan"),[W,Q]=v.useState(null),[ce,fe]=v.useState(new Map);v.useEffect(()=>{const Me=localStorage.getItem("settings_instantNodeClose");F(Me==="true");const De=localStorage.getItem("settings_hoverHighlight");De!==null&&G(De==="true");const Te=localStorage.getItem("settings_connectionAnimation");Te!==null&&ie(Te==="true");const Re=localStorage.getItem("settings_connectionOpacity");if(Re!==null){const qe=parseFloat(Re);isNaN(qe)||A(qe)}const we=localStorage.getItem("settings_nodeAnimationMode");if(we)R(we);else{const qe=localStorage.getItem("settings_nodeAnimation");R(qe==="false"?"none":"pulse")}const Ce=localStorage.getItem("settings_theme");Ce&&["cyan","orange","pink","gray"].includes(Ce)&&Z(Ce)},[]),v.useEffect(()=>{document.documentElement.setAttribute("data-theme",K),localStorage.setItem("settings_theme",K)},[K]);const $=v.useCallback(Me=>{Z(Me)},[]),V=v.useCallback(Me=>{ie(Me),localStorage.setItem("settings_connectionAnimation",String(Me))},[]),J=v.useCallback(Me=>{A(Me),localStorage.setItem("settings_connectionOpacity",String(Me))},[]),Y=v.useCallback((Me,De="success")=>{const Te=s.current++;i(Re=>[...Re,{id:Te,message:Me,type:De}]),setTimeout(()=>{i(Re=>Re.filter(we=>we.id!==Te))},3e3)},[]),ae=v.useCallback((Me,De,Te)=>{te(Re=>[{id:`log-${Date.now()}-${Math.random()}`,timestamp:Date.now(),level:Me,message:De,details:Te},...Re].slice(0,100))},[]),ue=v.useCallback(()=>{te([])},[]),he=v.useCallback(Me=>{var De;if(m(Me),Me){if(Me.trim().startsWith("{")||Me.trim().includes('{"error":'))try{const Te=Me.indexOf("{"),Re=Me.lastIndexOf("}");if(Te!==-1&&Re!==-1){const we=Me.substring(Te,Re+1),Ce=JSON.parse(we),qe=Me.substring(0,Te).trim()||((De=Ce.error)==null?void 0:De.message)||"API Error";ae("error",qe,Ce);return}}catch{}ae("error",Me)}},[ae]),ye=v.useCallback(Me=>{fe(De=>{const Te=new Map(De);return Te.set(Me.id,Me),Te})},[]),ve=v.useCallback(Me=>{fe(De=>{const Te=new Map(De);return Te.delete(Me),Te})},[]),me=v.useCallback(Me=>{_(De=>{const Te={...De};return delete Te[Me],Te})},[]),_e=v.useCallback((Me,De,Te)=>{_(Re=>({...Re,[Me]:{...Re[Me]||{},[De]:Te}}))},[]),pe=v.useCallback((Me,De)=>{var Te;return(Te=x[Me])==null?void 0:Te[De]},[x]),xe=v.useCallback(()=>{_(Me=>{const De=new Set(e.map(we=>we.id)),Te={};let Re=0;return Object.keys(Me).forEach(we=>{De.has(we)?Te[we]=Me[we]:Re++}),Re>0?Y(t("toast.cacheCleared",{count:Re})):Y(t("toast.cacheEmpty")),Te})},[e,Y,t]),Se=v.useCallback(Me=>{M({src:Me})},[]),Le=v.useCallback(()=>{M(null)},[]),Ee=v.useCallback(Me=>{de(Me)},[]);return{showWelcome:o,setShowWelcome:r,toasts:a,addToast:Y,isSnapToGrid:l,setIsSnapToGrid:c,lineStyle:d,setLineStyle:u,spawnLine:p,setSpawnLine:h,activeTool:w,setActiveTool:k,draggingInfo:b,setDraggingInfo:y,error:g,setError:he,logs:ge,addLog:ae,clearLogs:ue,isDebugConsoleOpen:le,setIsDebugConsoleOpen:ee,fullSizeImageCache:x,setFullSizeImageCache:_,clearSelectionsSignal:S,setClearSelectionsSignal:P,globalImageEditor:j,openGlobalImageEditor:Se,closeGlobalImageEditor:Le,isSmartGuidesEnabled:D,setIsSmartGuidesEnabled:O,smartGuides:B,setSmartGuides:E,selectedNodeIds:I,setSelectedNodeIds:N,isInstantCloseEnabled:T,setIsInstantCloseEnabled:F,isHoverHighlightEnabled:z,setIsHoverHighlightEnabled:G,nodeAnimationMode:U,setNodeAnimationMode:R,dockHoverMode:q,setDockHoverMode:H,isDockingMenuVisible:ne,setIsDockingMenuVisible:X,activeOperations:ce,registerOperation:ye,unregisterOperation:ve,setFullSizeImage:_e,getFullSizeImage:pe,clearImagesForNodeFromCache:me,clearUnusedFullSizeImages:xe,t,focusedNodeId:re,toggleNodeFullScreen:Ee,globalMedia:W,setGlobalMedia:Q,currentTheme:K,setTheme:$,isConnectionAnimationEnabled:se,setIsConnectionAnimationEnabled:V,connectionOpacity:oe,setConnectionOpacity:J}},M3=(e,t,o,r,a,i,s,l,c,d,u,p,h,w,k,b,y,g,m,x,_,S,P,j,M,D)=>{const O=v.useRef(()=>console.warn("Redirect handler not ready")),B=v.useCallback(V=>{O.current(V)},[]);v.useEffect(()=>{O.current=V=>{const J=V.catalogContext;switch(J){case"groups":w.importItemsData(V),P("Imported into Groups catalog.","success");break;case"library":h.importItemsData(V),P("Imported into Prompt Library.","success");break;case"characters":k.importItemsData(V),P("Imported into Character catalog.","success");break;case"scripts":b.importItemsData(V),P("Imported into Script catalog.","success");break;case"sequences":y.importItemsData(V),P("Imported into Sequence catalog.","success");break;default:j(`Unknown catalog context: ${J}`)}}},[w,h,k,b,y,P,j]);const E=v.useCallback(V=>{V&&(h.saveProcessorPrompt(V),P(M("toast.promptSaved",{promptName:V.substring(0,20)})))},[h,P,M]),I=v.useCallback((V,J)=>{V&&(h.saveToLibrary(V,J),P(M("toast.promptSaved",{promptName:V.substring(0,20)})))},[h,P,M]),N=v.useCallback((V,J)=>{const Y=e.find(ae=>ae.id===V);if(!(!Y||Y.type!==L.CHARACTER_CARD))try{const ae=Y.value?JSON.parse(Y.value):[],ue=Array.isArray(ae)?ae:[ae];if(J!==void 0){const he=ue[J];if(!he)throw new Error("Character not found");const ye=he.name||`Entity ${J+1}`,ve={type:"character-card",nodeTitle:Y.title,...he,index:he.index||he.alias||`Entity-${J+1}`};ve.alias&&delete ve.alias;const me=he.thumbnails?{...he.thumbnails}:he.imageSources||{};Object.entries($t).forEach(([pe,xe])=>{const Se=c(V,J*10+xe);Se&&(me[pe]=Se)});const _e=c(V,J*10);_e&&(ve.image=_e),ve.imageSources=me,k.createItem("ITEM",ye,JSON.stringify(ve,null,2)),P(M("toast.characterSavedCatalog"))}else{const he=Y.title||"Character Collection",ye=ue.map((ve,me)=>{const _e={...ve.thumbnails};Object.entries($t).forEach(([Se,Le])=>{const Ee=c(V,me*10+Le);Ee&&(_e[Se]=Ee)});const pe=c(V,me*10)||ve.image,xe={type:"character-card",nodeTitle:Y.title,...ve,image:pe,imageSources:_e,index:ve.index||ve.alias||`Entity-${me+1}`};return xe.alias&&delete xe.alias,xe});k.createItem("ITEM",he,JSON.stringify(ye,null,2)),P(M("toast.characterSavedCatalog")+" (All)")}}catch{j("Failed to save character to catalog.")}},[e,k,j,P,M,c]),T=v.useCallback(V=>{try{const J=V.name||"Unnamed Entity",Y={};V.imageBase64&&(Y["1:1"]=`data:image/png;base64,${V.imageBase64}`);const ae={type:"character-card",id:`char-card-${Date.now()}`,name:V.name,index:V.alias||"Entity-1",image:V.imageBase64?`data:image/png;base64,${V.imageBase64}`:null,selectedRatio:"1:1",prompt:V.prompt,fullDescription:V.fullDescription,imageSources:Y};k.createItem("ITEM",J,JSON.stringify(ae,null,2)),P(M("toast.characterSavedCatalog"))}catch{j("Failed to save character to catalog.")}},[k,j,P,M]),F=v.useCallback(V=>{var Y;const J=e.find(ae=>ae.id===V);if(!(!J||J.type!==L.SCRIPT_VIEWER))try{let ae=J.value||"{}";const ue=JSON.parse(ae);ue.type||(ue.summary&&ue.detailedCharacters&&ue.scenes?ue.type="script-generator-data":ue.characters&&(ue.frames||ue.scenes&&((Y=ue.scenes[0])!=null&&Y.frames))&&(ue.type="script-analyzer-data"),ae=JSON.stringify(ue,null,2));const he=`Script ${new Date().toLocaleDateString()}`;b.createItem("ITEM",he,ae),P(M("toast.scriptSaved"))}catch{j("Failed to save script to catalog.")}},[e,b,j,P,M]),z=v.useCallback(V=>{const J=e.find(Y=>Y.id===V);if(!(!J||J.type!==L.IMAGE_SEQUENCE_GENERATOR&&J.type!==L.PROMPT_SEQUENCE_EDITOR))try{let Y={};const ae=J.title||" ",ue=J.value?JSON.parse(J.value):{};if(J.type===L.IMAGE_SEQUENCE_GENERATOR){const ye=(ue.prompts||[]).map(({frameNumber:ve,characters:me,duration:_e,prompt:pe,videoPrompt:xe,sceneNumber:Se,shotType:Le})=>({frameNumber:ve,characters:me,duration:_e,prompt:pe,videoPrompt:xe,sceneNumber:Se||1,shotType:Le||"WS"}));Y={type:"script-prompt-modifier-data",title:ae,usedCharacters:ue.usedCharacters||[],sceneContexts:ue.sceneContexts||{},finalPrompts:ye}}else if(J.type===L.PROMPT_SEQUENCE_EDITOR){const ye=ue.sourcePrompts||[],ve=ue.modifiedPrompts||[],me=new Map(ve.map(pe=>[pe.frameNumber,pe])),_e=ye.map(pe=>{const xe=me.get(pe.frameNumber);return xe?{...pe,...xe}:pe});Y={type:"script-prompt-modifier-data",title:ae,usedCharacters:ue.usedCharacters||[],sceneContexts:ue.sceneContexts||{},finalPrompts:_e.map(pe=>({frameNumber:pe.frameNumber,sceneNumber:pe.sceneNumber||1,characters:pe.characters||[],duration:pe.duration||3,prompt:pe.prompt||"",shotType:pe.shotType||"WS"}))}}const he=`Sequence ${new Date().toLocaleDateString()}`;y.createItem("ITEM",he,JSON.stringify(Y,null,2)),P(M("toast.characterSavedCatalog"))}catch{j("Failed to save sequence to catalog.")}},[e,y,j,P,M]),G=v.useCallback(V=>{const J=e.find(Y=>Y.id===V);if(!(!J||J.type!==L.MEDIA_VIEWER))try{const Y=J.value||"{}",ae=new Blob([Y],{type:"application/json"}),ue=URL.createObjectURL(ae),he=ee(),ye=document.createElement("a");ye.href=ue,ye.download=`Media_Viewer_${he}.json`,ye.click(),URL.revokeObjectURL(ue),ye.remove(),P(M("toast.scriptSaved"))}catch{j("Failed to save media state.")}},[e,j,P,M]),U=v.useCallback(async V=>{const J=e.find(Y=>Y.id===V);if(J){j(null);try{const Y=d(V);let ae=null,ue="",he=null,ye=null;const ve=Y.find(pe=>pe&&typeof pe=="object"&&(pe.type==="video"||pe.type==="audio")&&pe.url);ve&&(he=ve.url,ye=ve.type);const me=Y.find(pe=>!(!pe||typeof pe!="object"||pe.base64ImageData&&pe.mimeType||pe.type&&(pe.type==="video"||pe.type==="audio")&&pe.url));if(me){ue=JSON.stringify(me,null,2);let pe=null;if(Array.isArray(me)){const xe=me.find(Se=>Se.image||Se.imageBase64||Se.imageSources&&Object.values(Se.imageSources).some(Le=>Le));xe&&(pe=xe)}else pe=me;pe&&(pe.image&&pe.image.startsWith("data:")?ae=pe.image:pe.imageBase64?ae=`data:image/png;base64,${pe.imageBase64}`:pe.imageSources&&pe.imageSources["1:1"]&&(ae=pe.imageSources["1:1"]))}else{const pe=Y.find(Se=>typeof Se=="string")||"";pe&&(ue=pe);const xe=Y.find(Se=>typeof Se=="object"&&Se.base64ImageData&&(Se.type==="image"||!Se.type));xe&&(ae=`data:${xe.mimeType};base64,${xe.base64ImageData}`)}const _e=JSON.stringify({text:ue,image:ae,mediaUrl:he,mediaType:ye||"video"});J.value!==_e&&m.handleValueChange(V,_e)}catch(Y){j(Y.message)}}},[d,m,e,j]),R=v.useCallback((V,J,Y,ae)=>{if(!V)return;let ue=V;V.startsWith("data:image/png")&&(ue=Bi(V,"prompt",Y));const he=document.createElement("a");he.href=ue;let ye;if(ae)ye=ae.endsWith(".png")?ae:`${ae}.png`;else{const ve=new Date,me=ve.toISOString().split("T")[0],_e=ve.toTimeString().split(" ")[0].replace(/:/g,"-"),pe=`${me}_${_e}`,xe=(Y||"image").substring(0,30).replace(/[^a-z0-9\u0400-\u04FF]/gi,"_");ye=`frame_${J}_${xe}_${pe}.png`}he.download=ye,document.body.appendChild(he),he.click(),document.body.removeChild(he)},[]),q=v.useCallback(async V=>{if(V)try{let Y=await(await fetch(V)).blob();if(Y.type!=="image/png"){const ue=await createImageBitmap(Y),he=document.createElement("canvas");he.width=ue.width,he.height=ue.height;const ye=he.getContext("2d");if(ye){ye.drawImage(ue,0,0);const ve=await new Promise(me=>he.toBlob(me,"image/png"));ve&&(Y=ve)}}const ae=new ClipboardItem({[Y.type]:Y});await navigator.clipboard.write([ae]),P(M("toast.copiedToClipboard"))}catch(J){console.error("Failed to copy image to clipboard",J),P(M("toast.pasteFailed"),"error")}},[P,M]),H=v.useCallback(V=>m.handleDuplicateNode(V),[m]),ne=v.useCallback(V=>{const J=e.find(ye=>ye.id===V);if(!J)return;m.nodeIdCounter.current++;const Y=`node-${m.nodeIdCounter.current}-${Date.now()}`,ae={...J,id:Y,position:{x:J.position.x+30,y:J.position.y+30},isNewlyCreated:!0,value:J.value},he=o.filter(ye=>ye.toNodeId===V).map(ye=>({...ye,id:`conn-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,toNodeId:Y}));for(let ye=0;ye<=100;ye++){const ve=c(V,ye);ve&&l(Y,ye,ve)}return t(ye=>[...ye,ae]),r(ye=>[...ye,...he]),p&&p([Y]),P(M("toast.nodeDuplicated")),Y},[e,o,m,c,l,t,r,p,P,M]),X=v.useCallback(async V=>{const J=await m.handleCopyNodeValue(V);J&&j(J)},[m,j]),re=v.useCallback(async V=>{const J=await m.handlePasteNodeValue(V);J&&j(J)},[m,j]),de=v.useCallback(async(V,J)=>{const Y=await m.handlePasteImageToNode(V,J);Y&&j(Y)},[m,j]),ge=v.useCallback((V,J)=>{const Y=e.find(ae=>ae.id===V);if(Y){J._connectionId&&r(ae=>ae.filter(ue=>ue.id!==J._connectionId));try{const ae=JSON.parse(Y.value||"{}"),ue=ae.characterConcepts||[];let he=0;ue.forEach(pe=>{const xe=(pe.id||"").match(/Entity-(\d+)/);xe&&(he=Math.max(he,parseInt(xe[1],10)))});const ve={id:`Entity-${he+1}`,name:J.name||"Converted Concept",prompt:J.prompt||"",image:J._fullResImage||J.image||null,fullDescription:J.fullDescription||""},me=[...ue,ve],_e=JSON.stringify({...ae,characterConcepts:me});m.handleValueChange(V,_e),P(M("toast.pastedFromClipboard"),"success")}catch(ae){console.error("Failed to detach and paste concept",ae),j("Failed to update node data.")}}},[r,e,m,P,M,j]),te=v.useCallback((V,J)=>{const Y=e.find(he=>he.id===J);if(!Y)return;const ae=_.getTransformedPoint({x:Y.position.x*_.viewTransform.scale+_.viewTransform.translate.x+(Y.width+50)*_.viewTransform.scale,y:Y.position.y*_.viewTransform.scale+_.viewTransform.translate.y}),ue=g.onAddNode(L.IMAGE_INPUT,ae);l(ue,0,V),Rt(V,256,256).then(he=>{const ye=JSON.stringify({image:he,prompt:""});m.handleValueChange(ue,ye)})},[e,g,m,_,l]),le=v.useCallback((V,J)=>{const Y={x:J.position.x+J.width+50,y:J.position.y},ae=g.onAddNode(L.CHARACTER_CARD,Y),ue=V.imageSources||{};let he=V.image;if(V.imageBase64&&!he){const ve=`data:image/png;base64,${V.imageBase64}`;ue["1:1"]=ve,he=ve,l(ae,0,ve),l(ae,1,ve)}else if(V.imageSources){Object.entries(V.imageSources).forEach(([me,_e])=>{if(typeof _e=="string"&&_e.startsWith("data:")){const pe=$t[me];pe&&l(ae,pe,_e)}});const ve=V._fullResImage;ve&&l(ae,0,ve)}(async()=>{let ve=he;he&&he.length>5e3&&(ve=await Rt(he,256,256));const me=[{type:"character-card",id:V.id||`char-card-${Date.now()}`,name:V.name||"",index:V.index||V.alias||"Entity-1",prompt:V.prompt||"",fullDescription:V.fullDescription||"",image:ve,thumbnails:V.thumbnails||ue,selectedRatio:V.selectedRatio||"1:1",targetLanguage:V.targetLanguage||"en"}];m.handleValueChange(ae,JSON.stringify(me)),p&&p([ae])})()},[g,m,l,p]),ee=()=>new Date().toISOString().replace(/:/g,"-").replace("T","_").split(".")[0],se=v.useCallback(V=>{const J=a.find(Se=>Se.id===V);if(!J)return;const Y=e.filter(Se=>J.nodeIds.includes(Se.id)),ae=new Set(Y.map(Se=>Se.id)),ue=o.filter(Se=>ae.has(Se.fromNodeId)&&ae.has(Se.toNodeId)),he={};Y.forEach(Se=>{s[Se.id]&&(he[Se.id]=s[Se.id])});const ye={type:"prompModifierGroup",name:J.title,nodes:Y,connections:ue,fullSizeImages:he},ve=new Blob([JSON.stringify(ye,null,2)],{type:"application/json"}),me=URL.createObjectURL(ve),_e=document.createElement("a");_e.href=me;const pe=J.title.trim().replace(/\s+/g,"_"),xe=ee();_e.download=`${pe}_Prompt_Modifier_Group_${xe}.json`,_e.click(),URL.revokeObjectURL(me),P(M("toast.groupSavedToDisk",{groupTitle:J.title}))},[a,e,o,s,P,M]),ie=v.useCallback(V=>{const J=a.find(Y=>Y.id===V);J&&(w.saveGroupToCatalog(J,e,o,s),P(M("alert.groupSaved",{groupTitle:J.title})))},[a,e,o,w,M,P,s]),oe=v.useCallback((V,J)=>{const Y=w.catalogItems.find(Ee=>Ee.id===V);if(!Y||Y.type!=="GROUP"||!Y.nodes||!Y.connections)return;let ae=1/0,ue=1/0;Y.nodes.forEach(Ee=>{ae=Math.min(ae,Ee.position.x),ue=Math.min(ue,Ee.position.y)});let he,ye;J?(he=J.x,ye=J.y):(he=(window.innerWidth/2-_.viewTransform.translate.x)/_.viewTransform.scale,ye=(window.innerHeight/2-_.viewTransform.translate.y)/_.viewTransform.scale);const ve=he-ae,me=ye-ue,_e=new Map,pe=Y.nodes.map(Ee=>{m.nodeIdCounter.current++;const Me=`node-${m.nodeIdCounter.current}-${Date.now()}`;return _e.set(Ee.id,Me),{...Ee,id:Me,position:{x:Ee.position.x+ve,y:Ee.position.y+me},isNewlyCreated:!0}});Y.fullSizeImages&&Object.entries(Y.fullSizeImages).forEach(([Ee,Me])=>{const De=_e.get(Ee);De&&Me&&Object.entries(Me).forEach(([Te,Re])=>{l(De,Number(Te),Re)})});const xe=Y.connections.map(Ee=>({...Ee,id:`conn-${Date.now()}-${Math.random()}`,fromNodeId:_e.get(Ee.fromNodeId),toNodeId:_e.get(Ee.toNodeId)}));t(Ee=>[...Ee,...pe]),r(Ee=>[...Ee,...xe]);const Se=vr(pe)||{position:{x:0,y:0},width:0,height:0},Le={id:`group-${Date.now()}`,title:Y.name,nodeIds:pe.map(Ee=>Ee.id),...Se};i(Ee=>[...Ee,Le])},[w,_,m,t,r,i,l]),A=v.useCallback((V,J)=>{if(J.stopPropagation(),J.shiftKey){const Y=a.find(ae=>ae.id===V);if(Y){const ae=new Set(Y.nodeIds);t(ue=>ue.filter(he=>!ae.has(he.id))),r(ue=>ue.filter(he=>!ae.has(he.fromNodeId)&&!ae.has(he.toNodeId))),Y.nodeIds.forEach(ue=>D(ue)),P(M("toast.groupDeleted"))}}i(Y=>Y.filter(ae=>ae.id!==V))},[a,t,r,D,M,P,i]),K=v.useCallback(V=>{const J=o.find(me=>me.id===V);if(!J)return;const Y=e.find(me=>me.id===J.fromNodeId);if(!Y)return;const ae=Yn(Y,J.fromHandleId),ue=JSON.stringify({type:ae}),he=g.onAddNode(L.REROUTE_DOT,_.pointerPosition,void 0,{centerNode:!0,initialValue:ue}),ye={id:`conn-${Date.now()}-1`,fromNodeId:J.fromNodeId,fromHandleId:J.fromHandleId,toNodeId:he,toHandleId:void 0},ve={id:`conn-${Date.now()}-2`,fromNodeId:he,fromHandleId:void 0,toNodeId:J.toNodeId,toHandleId:J.toHandleId};r(me=>[...me.filter(_e=>_e.id!==V),ye,ve])},[o,e,g,_,r]),Z=v.useCallback((V,J,Y)=>{if(!J)return;const{position:ae,connectingInfo:ue}=J,he=_.getTransformedPoint(ae);let ye;V===L.REROUTE_DOT&&ue.fromType&&(ye=JSON.stringify({type:ue.fromType}));const ve=g.onAddNode(V,he,void 0,{alignToInput:!0,initialValue:ye});let me;V===L.IMAGE_EDITOR?(ue.fromType==="image"&&(me="image"),ue.fromType==="text"&&(me="text")):V===L.IMAGE_SEQUENCE_GENERATOR?(ue.fromType==="text"&&(me="prompt_input"),ue.fromType==="character_data"&&(me="character_data")):V===L.PROMPT_SEQUENCE_EDITOR?ue.fromType==="text"&&(me="prompts_sequence"):V===L.NOTE?ue.fromType==="text"&&(me="prompt_data"):V===L.VIDEO_EDITOR&&(ue.fromType==="video"&&(me="video"),ue.fromType==="audio"&&(me="audio"),ue.fromType==="image"&&(me="image"),ue.fromType==="text"&&(me="text"));const _e={id:`conn-${Date.now()}`,fromNodeId:ue.fromNodeId,fromHandleId:ue.fromHandleId,toNodeId:ve,toHandleId:me};r(pe=>[...pe,_e]),Y()},[g,r,_]),W=v.useCallback(V=>{x.removeConnectionsByNodeId(V)},[x]),Q=v.useCallback((V,J)=>{S.handleEditImage(V,[J])},[S]),ce=v.useCallback(async(V,J,Y,ae,ue,he,ye=!1)=>{const ve=ae.pointerPosition||{x:0,y:0},me=ve.x===0&&ve.y===0?ae.getTransformedPoint({x:window.innerWidth/2,y:window.innerHeight/2}):ve;try{const _e=await navigator.clipboard.read();for(const pe of _e)if(pe.types.some(xe=>xe.startsWith("image/"))){const xe=await pe.getType(pe.types.find(Le=>Le.startsWith("image/")));if(!ye&&V.length===1){const Le=e.find(Ee=>Ee.id===V[0]);if(Le&&(Le.type===L.IMAGE_INPUT||Le.type===L.IMAGE_EDITOR||Le.type===L.IMAGE_ANALYZER||Le.type===L.CHARACTER_CARD)){await Y(V[0]);return}}const Se=new File([xe],"pasted_image.png",{type:xe.type});if(ye){const Le=ue.onAddNode(L.IMAGE_EDITOR,me),Ee=new FileReader;Ee.onload=async Me=>{var Te;const De=(Te=Me.target)==null?void 0:Te.result;if(De){l(Le,1,De);const we={inputImages:[await Rt(De,256,256)],prompt:"",outputImage:null,aspectRatio:"1:1",enableAspectRatio:!0,enableOutpainting:!1,outpaintingPrompt:"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.",model:"gemini-3-flash-preview",autoDownload:!0,autoCrop169:!1,leftPaneWidth:360,topPaneHeight:330};he.handleValueChange(Le,JSON.stringify(we)),P(M("toast.pastedFromClipboard"),"success"),p&&p([Le])}},Ee.readAsDataURL(Se)}else{const Le=ue.onAddNode(L.IMAGE_INPUT,me);await Y(Le,Se),p&&p([Le])}return}}catch{}try{const _e=await navigator.clipboard.readText();if(!_e)return;if(V.length===1){const pe=e.find(xe=>xe.id===V[0]);if(pe&&pe.type!==L.IMAGE_OUTPUT&&pe.type!==L.VIDEO_OUTPUT&&pe.type!==L.IMAGE_INPUT){await J(V[0]);return}}try{let pe=JSON.parse(_e);if(pe.type==="gemini-chat-history"||pe.messages&&Array.isArray(pe.messages)&&!pe.nodes){const Se=ue.onAddNode(L.GEMINI_CHAT,me),Le=JSON.stringify({messages:pe.messages||[],currentInput:pe.currentInput||"",style:pe.style||"general",attachment:pe.attachment||null});he.handleValueChange(Se,Le);return}if(pe.type==="character-card"||Array.isArray(pe)&&pe.length>0&&(pe[0].type==="character-card"||pe[0].name&&pe[0].imageSources)){const Se=Array.isArray(pe)?pe:[pe],Le=Se[0].nodeTitle||Se[0].title||"Character Card",Ee=ue.onAddNode(L.CHARACTER_CARD,me,Le,{centerNode:!0}),Me=Se.length*au+iu;t(Te=>Te.map(Re=>Re.id===Ee?{...Re,width:Me}:Re));const De=await Promise.all(Se.map(async(Te,Re)=>{const we=Te.imageSources||{},Ce={"1:1":null,"16:9":null,"9:16":null};Te.image&&!Te.imageSources&&(we["1:1"]=Te.image);for(const[Ie,We]of Object.entries(we))if(typeof We=="string"&&We.startsWith("data:")){const at=$t[Ie];at&&l(Ee,Re*10+at,We);try{Ce[Ie]=await Rt(We,256,256)}catch{Ce[Ie]=We}}else Ce[Ie]=We;const qe=Te.selectedRatio||"1:1",Be=we[qe];return Be&&typeof Be=="string"&&Be.startsWith("data:")&&l(Ee,Re*10,Be),{...Te,id:Te.id||`char-card-${Date.now()}-${Re}`,image:Ce[qe],thumbnails:Ce,index:Te.index||Te.alias||`Entity-${Re+1}`}}));he.handleValueChange(Ee,JSON.stringify(De)),p&&p([Ee]);return}if(pe.type==="prompModifierGroup"||pe.nodes&&pe.connections){ue.pasteGroup(pe,me);return}if(pe.type==="script-prompt-modifier-data"||pe.finalPrompts&&Array.isArray(pe.finalPrompts)){const Se=ue.onAddNode(L.PROMPT_SEQUENCE_EDITOR,me),Le=pe.finalPrompts||pe.prompts||[],Ee=pe.videoPrompts||[],Me=new Map(Ee.map(Re=>[Re.frameNumber,Re])),De=Le.map((Re,we)=>{const Ce=Re.frameNumber!==void 0?Re.frameNumber:we+1,qe=Me.get(Ce);return{frameNumber:Ce,sceneNumber:Re.sceneNumber||1,sceneTitle:Re.sceneTitle||"",prompt:Re.prompt||"",videoPrompt:(qe==null?void 0:qe.videoPrompt)||Re.videoPrompt||"",shotType:Re.shotType||Re.ShotType||(qe==null?void 0:qe.shotType)||"WS",characters:Re.characters||[],duration:Re.duration||3,isCollapsed:!0}}),Te=JSON.stringify({instruction:"",sourcePrompts:De,modifiedPrompts:[],checkedSourceFrameNumbers:[],selectedFrameNumber:null,styleOverride:pe.styleOverride||"",usedCharacters:pe.usedCharacters||[],sceneContexts:pe.sceneContexts||{},leftPaneRatio:.5});he.handleValueChange(Se,Te);return}if(pe.type==="script-generator-data"||pe.type==="script-analyzer-data"||pe.characters&&pe.scenes){const Se=ue.onAddNode(L.SCRIPT_VIEWER,me);pe.type||(pe.type="script-analyzer-data"),he.handleValueChange(Se,JSON.stringify(pe));return}const xe=ue.onAddNode(L.TEXT_INPUT,me);he.handleValueChange(xe,JSON.stringify(pe,null,2))}catch{const xe=ue.onAddNode(L.TEXT_INPUT,me);he.handleValueChange(xe,_e)}}catch(_e){console.error("Paste failed",_e)}},[e,l,P,M,p]),fe=v.useCallback((V,J)=>{const Y=e.find(he=>he.id===V);if(!Y)return;let ae,ue="";try{const he=JSON.parse(Y.value||"{}");Y.type===L.IMAGE_OUTPUT||Y.type===L.VIDEO_OUTPUT?(ae=c(V,0)||Y.value,ue=g.getPromptForNode(V)):Y.type===L.IMAGE_INPUT?(ae=c(V,0)||he.image,ue=he.prompt||""):Y.type===L.IMAGE_EDITOR&&(ae=c(V,0)||he.outputImage,ue=he.prompt||"")}catch{}ae&&J(ae,0,ue)},[e,c,g]),$=v.useCallback((V,J)=>{t(ae=>ae.map(ue=>{if(ue.id===V)try{const he=JSON.parse(ue.value||"{}");if(ue.type===L.PROMPT_SEQUENCE_EDITOR){const ye=[J];let ve=he.sourcePrompts||[],me=he.collapsedSourceScenes||[];const _e=ve.find(pe=>pe.frameNumber===J);if(_e){ve=ve.map(xe=>xe.frameNumber===J?{...xe,isCollapsed:!1}:xe);const pe=_e.sceneNumber||1;me.includes(pe)&&(me=me.filter(xe=>xe!==pe))}return{...ue,isCollapsed:!1,value:JSON.stringify({...he,sourcePrompts:ve,collapsedSourceScenes:me,selectedFrameNumber:J,checkedSourceFrameNumbers:ye})}}}catch{}return ue}));const Y=e.find(ae=>ae.id===V);if(Y){const ae=window.innerWidth,ue=window.innerHeight,he=Number.isFinite(_.viewTransform.scale)&&_.viewTransform.scale>0?_.viewTransform.scale:1,ye=Y.position.x+Y.width/2,ve=Y.position.y+Y.height/2,me=ae/2-ye*he,_e=ue/2-ve*he;Number.isFinite(me)&&Number.isFinite(_e)&&_.setViewTransform({scale:he,translate:{x:me,y:_e}})}},[e,t,_]);return{onRedirectImport:B,onSavePromptToLibrary:E,onSaveToLibrary:I,onSaveCharacterToCatalog:N,onSaveGeneratedCharacterToCatalog:T,onSaveScriptToCatalog:F,onSaveSequenceToCatalog:z,onSaveMediaToDisk:G,onReadData:U,onDownloadImageFromUrl:R,onCopyImageToClipboard:q,handleDuplicateNode:H,handleDuplicateNodeWithContent:ne,copyNodeValue:X,pasteNodeValue:re,pasteImageToNode:de,handleDetachAndPasteConcept:ge,onDetachImageToNode:te,onDetachCharacter:le,handleSaveGroupToDisk:se,handleSaveGroupToCatalog:ie,handleAddGroupFromCatalog:oe,handleRemoveGroup:A,handleSplitConnection:K,handleAddNodeAndConnect:Z,handleNodeCutConnections:W,handleRegenerateFrame:Q,handlePaste:ce,handleDownloadImage:fe,handleNavigateToNodeFrame:$}},W1=v.createContext(null),R3=({children:e})=>{const{t,language:o,setLanguage:r}=St(),a=NC("clipboard-read"),i=wC(),{tabs:s,setTabs:l,activeTabId:c,setActiveTabId:d,handleAddTab:u,handleSwitchTab:p,handleRenameTab:h,handleCloseTab:w,resetTabs:k,resetCurrentTab:b,getLocalizedCanvasState:y}=i,g=v.useMemo(()=>{const Te=s.find(Re=>Re.id===c);return Te||(s.length>0?s[0]:{id:"fallback",name:"Loading...",state:{nodes:[],connections:[],groups:[],viewTransform:{scale:1,translate:{x:0,y:0}},nodeIdCounter:0,fullSizeImageCache:{}}})},[s,c]),m=A3(g.state.nodes),{toasts:x,addToast:_,fullSizeImageCache:S,setFullSizeImageCache:P,setFullSizeImage:j,getFullSizeImage:M,clearImagesForNodeFromCache:D,clearUnusedFullSizeImages:O,registerOperation:B,unregisterOperation:E,activeOperations:I,selectedNodeIds:N,setSelectedNodeIds:T,draggingInfo:F,setDraggingInfo:z,showWelcome:G,setShowWelcome:U}=m,R=iC(g.state.nodes,g.state.nodeIdCounter,_,t,j,M),q=sC(g.state.connections,_,t),H=lC(g.state.viewTransform),ne=CC(g.state.groups),X=C3(R.setNodes),re=k3({nodes:R.nodes}),de=IC({connections:q.connections,nodes:R.nodes,getFullSizeImage:M}),{getUpstreamNodeValues:ge}=de,te=v.useCallback(()=>({nodes:R.nodes,connections:q.connections,groups:ne.groups,viewTransform:H.viewTransform,nodeIdCounter:R.nodeIdCounter.current,fullSizeImageCache:S}),[R.nodes,q.connections,ne.groups,H.viewTransform,R.nodeIdCounter,S]),le=v.useCallback(Te=>{R.setNodes(Te.nodes),q.setConnections(Te.connections),ne.setGroups(Te.groups||[]),H.setViewTransform(Te.viewTransform),R.nodeIdCounter.current=Te.nodeIdCounter,P(Te.fullSizeImageCache||{})},[R,q,ne,H,P]);v.useEffect(()=>{const Te=s.find(Re=>Re.id===c);Te&&le(Te.state)},[c]),v.useEffect(()=>{const Te=te();l(Re=>Re.map(we=>we.id===c?{...we,state:Te}:we))},[te,c,l]);const ee=v.useCallback(Te=>{k(Te)},[k]),se=v.useRef(c);v.useEffect(()=>{se.current=c},[c]);const ie=jC({nodes:R.nodes,setNodes:R.setNodes,connections:q.connections,setConnections:q.setConnections,nodeIdCounter:R.nodeIdCounter,groups:ne.groups,setGroups:ne.setGroups,t,clearImagesForNodeFromCache:D,tabId:c,addToast:_,getFullSizeImage:M,setFullSizeImage:j,takeSnapshot:X.takeSnapshot}),oe=v.useRef(null),A=Te=>{oe.current&&oe.current.onRedirectImport&&oe.current.onRedirectImport(Te)},K=SC(t,A),Z=PC(t,A),W=Qc("character-catalog",t("catalog.tabs.characters"),t,"characters",A),Q=Qc("script-catalog",t("catalog.tabs.scripts"),t,"scripts",A),ce=Qc("sequence-catalog",t("catalog.tabs.sequences"),t,"sequences",A),fe=I3({addToast:_,getCurrentCanvasState:te,tabs:s,activeTabId:c,language:o,isSnapToGrid:m.isSnapToGrid,lineStyle:m.lineStyle,catalogItems:K.catalogItems,libraryItems:Z.libraryItems,characterCatalog:W,scriptCatalog:Q,sequenceCatalog:ce,t}),$=YE({nodes:R.nodes,setNodes:R.setNodes,getUpstreamNodeValues:ge,setError:m.setError,t,setFullSizeImage:j,getFullSizeImage:M,activeTabId:c,setTabs:l,activeTabName:g.name,registerOperation:B,unregisterOperation:E,addToast:_}),V=b3({nodes:R.nodes,setNodes:R.setNodes,getUpstreamNodeValues:ge,setError:m.setError,t,activeTabId:c,setTabs:l,activeTabName:g.name,registerOperation:B,unregisterOperation:E,addToast:_}),J=ZE({nodes:R.nodes,setNodes:R.setNodes,setError:m.setError,t,getUpstreamNodeValues:ge,activeTabId:c,setTabs:l}),Y=w3({nodes:R.nodes,connections:q.connections,setNodes:R.setNodes,getUpstreamNodeValues:ge,setError:m.setError,showApiKeyDialog:Te=>he.showApiKeyDialog(Te),t,setFullSizeImage:j,getFullSizeImage:M,connectedCharacterData:de.connectedCharacterData,activeTabId:c,setTabs:l,activeTabName:g.name,registerOperation:B,unregisterOperation:E,isGlobalProcessing:I.size>0,addToast:_}),ae=h3({nodes:R.nodes,setNodes:R.setNodes,connections:q.connections,setError:m.setError,getUpstreamNodeValues:ge,t,setFullSizeImage:j,getFullSizeImage:M,activeTabId:c,activeTabName:g.name,registerOperation:B,unregisterOperation:E,isGlobalProcessing:I.size>0,setTabs:l}),ue=mC({getCurrentCanvasState:te,loadCanvasState:le,setError:m.setError,nodes:R.nodes,getPromptForNode:ie.getPromptForNode,handleValueChange:R.handleValueChange,addToast:_,t,activeTabName:g.name,getFullSizeImage:M,handleRenameTab:h,activeTabId:c,setFullSizeImage:j,tabs:i.tabs,setTabs:i.setTabs,setActiveTabId:i.setActiveTabId,catalogItems:K.catalogItems,setCatalogItems:K.replaceAllItems,libraryItems:Z.libraryItems,setLibraryItems:Z.replaceAllItems,characterCatalog:W,scriptCatalog:Q,sequenceCatalog:ce,language:o,setLanguage:r,isSnapToGrid:m.isSnapToGrid,setIsSnapToGrid:m.setIsSnapToGrid,lineStyle:m.lineStyle,setLineStyle:m.setLineStyle,setConfirmInfo:Te=>he.setConfirmInfo(Te),handleRenameNode:R.handleRenameNode,onAddNode:ie.onAddNode,pasteGroup:ie.pasteGroup,viewTransform:H.viewTransform}),he=bC({setGroups:ne.setGroups,renameCatalogItem:K.renameCatalogItem,updateLibraryItem:Z.updateLibraryItem,handleRenameTab:h,handleCloseTab:w,handleRenameNode:R.handleRenameNode,getCurrentCanvasState:te,loadCanvasState:le,tabs:s,activeTabId:c,t,characterCatalog:W,scriptCatalog:Q,sequenceCatalog:ce}),ye=M3(R.nodes,R.setNodes,q.connections,q.setConnections,ne.groups,ne.setGroups,S,j,M,ge,se,T,Z,K,W,Q,ce,ie,R,q,H,Y,_,m.setError,t,D);v.useEffect(()=>{oe.current=ye},[ye]);const ve=v.useCallback(Te=>{he.connectionQuickAddInfo&&ye.handleAddNodeAndConnect(Te,he.connectionQuickAddInfo,he.handleCloseConnectionQuickAdd)},[he.connectionQuickAddInfo,he.handleCloseConnectionQuickAdd,ye]),me=v.useCallback(Te=>{const Re=R.nodes;ne.setGroups(we=>{const Ce=we.find(Be=>Be.nodeIds.includes(Te));if(!Ce)return we;const qe=Ce.nodeIds.filter(Be=>Be!==Te);if(qe.length>0){const Be=Re.filter(We=>qe.includes(We.id)),Ie=vr(Be);return Ie?we.map(We=>We.id===Ce.id?{...We,nodeIds:qe,...Ie}:We):we.map(We=>We.id===Ce.id?{...We,nodeIds:qe}:We)}else return we.filter(Be=>Be.id!==Ce.id)})},[ne.setGroups,R.nodes]),_e=hC({...R,...q,...ne,...H,...he,handleToggleCatalog:he.handleToggleCatalog,deleteNodeAndConnections:ie.deleteNodeAndConnections,onAddNode:ie.onAddNode,handleDuplicateNode:ye.handleDuplicateNode,handleDuplicateNodeWithContent:ye.handleDuplicateNodeWithContent,copyNodeValue:ye.copyNodeValue,pasteImageToNode:ye.pasteImageToNode,addConnection:q.addConnection,isSnapToGrid:m.isSnapToGrid,setIsSnapToGrid:m.setIsSnapToGrid,setLineStyle:m.setLineStyle,activeTool:m.activeTool,setActiveTool:m.setActiveTool,setSpawnLine:m.setSpawnLine,setError:m.setError,handleLoadCanvasIntoCurrentTab:ue.handleLoadCanvasIntoCurrentTab,t,draggingInfo:F,setDraggingInfo:z,handleDetachNodeFromGroup:me,handleSaveCanvas:ue.handleSaveCanvas,handleLoadCanvas:ue.handleLoadCanvas,handleOpenConnectionQuickAdd:he.handleOpenConnectionQuickAdd,handleOpenContextMenu:he.handleOpenContextMenu,quickSlots:he.quickSlots,isConnectionQuickAddOpen:he.isConnectionQuickAddOpen,pasteGroup:ie.pasteGroup,copyGroup:ie.copyGroup,isSmartGuidesEnabled:m.isSmartGuidesEnabled,setIsSmartGuidesEnabled:m.setIsSmartGuidesEnabled,setSmartGuides:m.setSmartGuides,selectedNodeIds:N,setSelectedNodeIds:T,handleRenameNode:R.handleRenameNode,setFullSizeImage:j,handleOpenQuickAdd:he.handleOpenQuickAdd,requestDeleteNodes:he.requestDeleteNodes,isInstantCloseEnabled:m.isInstantCloseEnabled,handleAlignNodes:ie.handleAlignNodes,handleDockNode:ie.handleDockNode,handlePaste:Te=>ye.handlePaste(N,ye.pasteNodeValue,ye.pasteImageToNode,H,ie,R,Te),selectNode:Te=>T([Te]),dockHoverMode:m.dockHoverMode,setDockHoverMode:m.setDockHoverMode,isDockingMenuVisible:m.isDockingMenuVisible,setIsDockingMenuVisible:m.setIsDockingMenuVisible,undoPosition:X.undoPosition,redoPosition:X.redoPosition,handleToggleNodePin:R.handleToggleNodePin}),pe=v.useCallback((Te,Re)=>{R.nodes.find(Ce=>Ce.id===Re)&&(N.includes(Re)||T([Re]),he.handleOpenNodeContextMenu(Te,Re))},[R.nodes,N,T,he.handleOpenNodeContextMenu]),xe=v.useCallback(Te=>{if(R.handleToggleNodeCollapse(Te),R.nodes.find(we=>we.id===Te)){const we=ne.groups.find(Ce=>Ce.nodeIds.includes(Te));if(we){const qe=R.nodes.map(Ie=>Ie.id===Te?{...Ie,isCollapsed:!Ie.isCollapsed}:Ie).filter(Ie=>we.nodeIds.includes(Ie.id)),Be=vr(qe);Be&&ne.setGroups(Ie=>Ie.map(We=>We.id===we.id?{...We,...Be}:We))}}},[R.handleToggleNodeCollapse,R.nodes,ne.groups,ne.setGroups]),Se=v.useCallback((Te,Re)=>{const we=R.nodes.find(Ce=>Ce.id===Te);(we==null?void 0:we.type)===L.IMAGE_SEQUENCE_GENERATOR?Y.handleGenerateSelectedFrames(Te,[Re]):Y.handleEditImage(Te,[Re])},[Y,R.nodes]),Le=AC({..._e,...he,...H,...ie,...ue,...R,...q,...ne,catalogItems:K.currentCatalogItems,libraryItems:Z.currentLibraryItems,handleLoadCanvasIntoCurrentTab:ue.handleLoadCanvasIntoCurrentTab,setError:m.setError,pasteImageToNode:ye.pasteImageToNode,isPanning:H.isPanning,addGroup:ne.addGroup,onAddNode:ie.onAddNode,zoomDragInfo:_e.zoomDragInfo,characterCatalogItems:W.items,scriptCatalogItems:Q.items,sequenceCatalogItems:ce.items,connectingInfo:_e.connectingInfo,setFullSizeImage:j,t,handleAddGroupFromCatalog:ye.handleAddGroupFromCatalog,activeTabId:c,handleRenameTab:h}),Ee=v.useCallback(Te=>{const Re=Te.target;Re.closest(".node-view")||Re.closest(".group-view")||Re.closest(".connection-view")||Re.closest("input, textarea, button, a, select")||(Te.preventDefault(),he.handleOpenContextMenu({x:Te.clientX,y:Te.clientY}))},[he.handleOpenContextMenu]),Me=v.useCallback(Te=>{const Re=()=>{const we=y(o);b(o),le(we)};Te!=null&&Te.shiftKey?Re():he.setConfirmInfo({title:t("dialog.confirmReset.title"),message:t("dialog.confirmReset.message"),onConfirm:Re})},[b,o,t,he,y,le]),De=v.useMemo(()=>{const{replaceAllItems:Te,importItemsData:Re,...we}=Z,{replaceAllItems:Ce,importItemsData:qe,...Be}=K;return{...i,...R,...q,...ne,...H,...he,...Be,...we,...a,...ue,...ie,..._e,...de,...Le,...$,...J,...ae,...Y,...V,...X,...m,...ye,...fe,tutorialStep:re.tutorialStep,advanceTutorial:re.advanceTutorial,setTutorialStep:re.setTutorialStep,tutorialTargetId:re.tutorialTargetId,startTutorial:re.startTutorial,skipTutorial:re.skipTutorial,t,onSanitize:V.handleSanitizePrompt,characterCatalog:W,scriptCatalog:Q,sequenceCatalog:ce,onRenameCharacter:(Ie,We)=>he.setRenameInfo({type:"character",id:Ie,currentTitle:We}),onRenameScript:(Ie,We)=>he.setRenameInfo({type:"script",id:Ie,currentTitle:We}),onRenameSequence:(Ie,We)=>he.setRenameInfo({type:"sequence",id:Ie,currentTitle:We}),onGenerateSelectedFrames:Y.handleGenerateSelectedFrames,onTranslateScript:V.handleTranslateScript,onRefreshUpstreamData:(Ie,We)=>{},handleDetachNodeFromGroup:me,onSaveScriptToDisk:ue.handleSaveScriptFile,onSaveMediaToDisk:ye.onSaveMediaToDisk,onGenerateCharacterImage:Y.handleGenerateCharacterImage,onStopGeneration:V.handleStopGeneration,onEditImage:Y.handleEditImage,onImageToText:$.handleImageToText,handleRegenerateFrame:Se,replaceAllItems:Te,importItemsData:Re,handleToggleNodeCollapse:xe,handleNodeContextMenuLogic:pe,handleCanvasContextMenu:Ee,isGlobalProcessing:I.size>0,handlePaste:(Ie=!1)=>ye.handlePaste(N,ye.pasteNodeValue,ye.pasteImageToNode,H,ie,R,Ie),handleDownloadImage:Ie=>ye.handleDownloadImage(Ie,ye.onDownloadImageFromUrl),setLibraryItems:Te,activeTool:_e.effectiveTool,setActiveTool:_e.setActiveTool,dragOverNodeId:_e.hoveredNodeId,isDraggingOverCanvas:!1,handleOpenNodeContextMenu:pe,onRefreshChat:J.handleRefreshChat,isStopping:V.isStopping||Y.isStoppingEdit,isStoppingSequence:Y.isStoppingEdit,selectNode:Ie=>T([Ie]),handleAddNodeAndConnect:ve,handleToggleNodePin:R.handleToggleNodePin,handleToggleNodeHandles:R.handleToggleNodeHandles,handleClearNodeNewFlag:R.handleClearNodeNewFlag,handleResetCanvas:Me,resetCanvasToDefault:ee,showWelcome:m.showWelcome,setShowWelcome:m.setShowWelcome,nextAutoSaveTime:i.nextAutoSaveTime,isAutoSaving:i.isAutoSaving,onUpdateCharacterDescription:V.handleUpdateCharacterDescription,handleUpdateCharacterDescription:V.handleUpdateCharacterDescription,isUpdatingDescription:V.isUpdatingDescription,onUpdateCharacterPersonality:V.handleUpdateCharacterPersonality,handleUpdateCharacterPersonality:V.handleUpdateCharacterPersonality,isUpdatingPersonality:V.isUpdatingPersonality,onUpdateCharacterAppearance:V.handleUpdateCharacterAppearance,handleUpdateCharacterAppearance:V.handleUpdateCharacterAppearance,isUpdatingAppearance:V.isUpdatingAppearance,onUpdateCharacterClothing:V.handleUpdateCharacterClothing,handleUpdateCharacterClothing:V.handleUpdateCharacterClothing,isUpdatingClothing:V.isUpdatingClothing,onModifyCharacter:V.handleModifyCharacter,handleModifyCharacter:V.handleModifyCharacter,isModifyingCharacter:V.isModifyingCharacter,onGenerateImage:Y.handleGenerateImage,handleUpdateCharacterPromptFromImage:$.handleUpdateCharacterPromptFromImage,isUpdatingCharacterPrompt:$.isUpdatingCharacterPrompt}},[i,R,q,ne,H,he,K,Z,a,ue,ie,_e,de,Le,$,J,ae,Y,V,X,m,ye,re,fe,xe,pe,Ee,I.size,N,t,W,Q,ce,me,ve,Se,$.handleImageToText,Me,ee,R.handleToggleNodeHandles,R.handleClearNodeNewFlag,$.handleUpdateCharacterPromptFromImage,$.isUpdatingCharacterPrompt,V.handleUpdateCharacterPersonality,V.isUpdatingPersonality,V.handleUpdateCharacterAppearance,V.isUpdatingAppearance,V.handleUpdateCharacterClothing,V.isUpdatingClothing]);return n.jsx(W1.Provider,{value:De,children:e})},Ut=()=>{const e=v.useContext(W1);if(!e)throw new Error("useAppContext must be used within a AppProvider");return e},Pe=({title:e,onClick:t,children:o,tooltipPosition:r="top",tooltipAlign:a="center",disabled:i=!1,className:s})=>{const c=s||"p-1 text-gray-400 rounded hover:bg-gray-600 hover:text-white transition-colors duration-150 focus:outline-none disabled:text-gray-600 disabled:bg-transparent disabled:cursor-not-allowed flex items-center justify-center";let d="";return r==="top"?(d="bottom-full mb-2",a==="center"?d+=" left-1/2 -translate-x-1/2":a==="start"?d+=" left-0":a==="end"&&(d+=" right-0")):r==="bottom"?(d="top-full mt-2",a==="center"?d+=" left-1/2 -translate-x-1/2":a==="start"?d+=" left-0":a==="end"&&(d+=" right-0")):r==="left"?d="right-full top-1/2 -translate-y-1/2 mr-2":r==="right"&&(d="left-full top-1/2 -translate-y-1/2 ml-2"),n.jsxs("div",{className:"relative group/btn-tooltip flex items-center justify-center",children:[n.jsx("button",{onClick:t,disabled:i,onMouseDown:u=>u.stopPropagation(),"aria-label":e,className:c,children:o}),e&&!i&&n.jsx("div",{className:`absolute ${d} px-2 py-1 bg-slate-700 text-slate-200 text-[10px] font-bold whitespace-nowrap rounded-md shadow-xl z-50 opacity-0 pointer-events-none group-hover/btn-tooltip:opacity-100 transition-opacity duration-200`,role:"tooltip",children:e})]})},ut=({content:e,children:t,position:o="top",align:r="center",className:a="",delay:i=0,usePortal:s=!0})=>{const[l,c]=v.useState(!1),[d,u]=v.useState(null),p=v.useRef(null),h=v.useRef(null),w=()=>{if(!h.current||!s)return;const m=h.current.getBoundingClientRect(),x=6;let _=0,S=0;o==="top"||o==="bottom"?r==="start"?_=m.left:r==="end"?_=m.right:_=m.left+m.width/2:o==="left"?_=m.left-x:o==="right"&&(_=m.right+x),o==="top"?S=m.top-x:o==="bottom"?S=m.bottom+x:S=m.top+m.height/2,u({x:_,y:S})},k=()=>{s&&w(),i>0?p.current=setTimeout(()=>c(!0),i):c(!0)},b=()=>{p.current&&(clearTimeout(p.current),p.current=null),c(!1)};if(v.useEffect(()=>{if(l&&s)return window.addEventListener("scroll",w,!0),window.addEventListener("resize",w),()=>{window.removeEventListener("scroll",w,!0),window.removeEventListener("resize",w)}},[l,s]),v.useEffect(()=>{if(!l)return;const m=x=>{if(h.current){const _=h.current.getBoundingClientRect(),S=10;x.clientX>=_.left-S&&x.clientX<=_.right+S&&x.clientY>=_.top-S&&x.clientY<=_.bottom+S||(c(!1),p.current&&clearTimeout(p.current))}};return window.addEventListener("mousemove",m),()=>window.removeEventListener("mousemove",m)},[l]),!e)return n.jsx("div",{className:a,children:t});let y="",g="";return s?o==="top"?r==="center"?y="translate(-50%, -100%)":r==="start"?y="translate(0, -100%)":r==="end"&&(y="translate(-100%, -100%)"):o==="bottom"?r==="center"?y="translate(-50%, 0)":r==="start"?y="translate(0, 0)":r==="end"&&(y="translate(-100%, 0)"):o==="left"?y="translate(-100%, -50%)":o==="right"&&(y="translate(0, -50%)"):o==="top"?(g="bottom-full mb-2",r==="center"?(g+=" left-1/2",y="translate(-50%, 0)"):r==="start"?g+=" left-0":r==="end"&&(g+=" right-0")):o==="bottom"?(g="top-full mt-2",r==="center"?(g+=" left-1/2",y="translate(-50%, 0)"):r==="start"?g+=" left-0":r==="end"&&(g+=" right-0")):o==="left"?(g="right-full mr-2 top-1/2",y="translate(0, -50%)"):o==="right"&&(g="left-full ml-2 top-1/2",y="translate(0, -50%)"),n.jsxs(n.Fragment,{children:[n.jsxs("div",{ref:h,className:`relative flex items-center justify-center ${a} pointer-events-auto`,onMouseEnter:k,onMouseLeave:b,onMouseDown:()=>c(!1),children:[t,!s&&l&&n.jsx("div",{className:`absolute z-50 px-3 py-1.5 bg-slate-700 text-slate-200 text-xs font-medium whitespace-nowrap rounded-md shadow-xl pointer-events-none ${g}`,style:{transform:y,animation:"fade-in-tooltip 0.15s ease-out"},children:e})]}),s&&l&&d&&Ba.createPortal(n.jsxs("div",{className:"fixed z-[9999] px-3 py-1.5 bg-slate-700 text-slate-200 text-xs font-medium whitespace-nowrap rounded-md shadow-xl pointer-events-none",style:{top:d.y,left:d.x,transform:y,animation:"fade-in-tooltip 0.15s ease-out"},children:[n.jsx("style",{children:`
                        @keyframes fade-in-tooltip {
                            from { opacity: 0; }
                            to { opacity: 1; }
                        }
                    `}),e]}),document.body)]})},L3=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}),D3=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),z3=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),q3=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),$1=({className:e="h-5 w-5"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),O3=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),K1=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),F3=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})}),B3=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),H3=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})}),G3=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"})}),J1=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"4",width:"6",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"8",width:"8",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"12",width:"4",height:"2",fill:"currentColor",rx:"1"})]}),Y1=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"7",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1",opacity:"0.5"}),n.jsx("rect",{x:"3",y:"4",width:"10",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"8",width:"6",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"2",y:"12",width:"12",height:"2",fill:"currentColor",rx:"1"})]}),Z1=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"12",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"4",width:"6",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"3",y:"8",width:"8",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"7",y:"12",width:"4",height:"2",fill:"currentColor",rx:"1"})]}),U3=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"4",y:"5",width:"2",height:"6",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"8",y:"5",width:"2",height:"8",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"5",width:"2",height:"4",fill:"currentColor",rx:"1"})]}),V3=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"7",width:"12",height:"2",fill:"currentColor",rx:"1",opacity:"0.5"}),n.jsx("rect",{x:"4",y:"3",width:"2",height:"10",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"8",y:"5",width:"2",height:"6",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"})]}),W3=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"12",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"4",y:"5",width:"2",height:"6",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"8",y:"3",width:"2",height:"8",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"7",width:"2",height:"4",fill:"currentColor",rx:"1"})]}),$3=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"7",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"})]}),K3=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"2",y:"7",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"2",y:"12",width:"12",height:"2",fill:"currentColor",rx:"1"})]}),J3=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 14v6m-3-3h6M6 10h2a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2zm10 0h2a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2zM6 20h2a2 2 0 002-2v-2a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2z"})}),Dt=({className:e="h-5 w-5"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("rect",{x:"8",y:"8",width:"12",height:"12",rx:"2",ry:"2"}),n.jsx("path",{d:"M16 8V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2"})]}),X1=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),Q1=({className:e="h-4 w-4"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 24 24",children:[n.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2"}),n.jsx("path",{d:"M4 4h8v16H4z",fill:"currentColor",stroke:"none",opacity:"0.8"})]}),ey=({className:e="h-4 w-4"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 24 24",children:[n.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2"}),n.jsx("path",{d:"M12 4h8v16h-8z",fill:"currentColor",stroke:"none",opacity:"0.8"})]}),zp=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})}),qp=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9H5a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1zm0 0l-5-5M15 9h4a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1zm0 0l5-5M9 15H5a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1zm0 0l-5 5M15 15h4a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1zm0 0l5 5"})}),Op=({className:e="h-4 w-4"})=>n.jsx("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 512 512",fill:"currentColor",children:n.jsx("g",{children:n.jsx("path",{d:`M374.8,9.4c-12.4-12.5-32.6-12.6-45.2-0.1c-3.3,3.3-5.6,7.3-7.2,11.3c-26.6,55.5-55.8,86.7-92.8,105.2
                c-41.4,20.5-89,34.7-165.7,34.7c-4.2,0-8.3,0.8-12.2,2.4c-7.8,3.2-14,9.5-17.3,17.3c-3.2,7.8-3.2,16.6,0,24.4
                c1.6,3.9,4,7.5,6.9,10.4L145,318.7L0,512l193.3-145L297,470.6c2.9,3,6.5,5.3,10.4,6.9c3.9,1.6,8.1,2.5,12.2,2.5
                c4.2,0,8.3-0.9,12.2-2.5c7.8-3.3,14.1-9.4,17.3-17.3c1.6-3.9,2.5-8.1,2.5-12.2c0-76.7,14.2-124.3,34.6-165.1
                c18.4-36.9,49.7-66.2,105.2-92.8c4.1-1.6,8-3.9,11.3-7.2c12.4-12.6,12.4-32.7-0.1-45.2L374.8,9.4z`})})}),Y3=({className:e="h-4 w-4"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),Z3=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 000-6.364l-7.682 7.682-7.682-7.682z"})}),X3=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),Q3=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),eP=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363 1.118l-3.976-2.888c-.784-.57-.382-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})}),tP=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363 1.118l-3.976-2.888c-.784-.57-.382-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})}),Sl=({className:e="h-4 w-4"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),Nl=({className:e="h-4 w-4"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24"}),n.jsx("path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"}),n.jsx("path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"}),n.jsx("line",{x1:"2",x2:"22",y1:"2",y2:"22"})]}),nP=({className:e="h-5 w-5"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 87.3 78",fill:"currentColor",children:[n.jsx("path",{d:"M6.6 66.85l3.85 6.65c.8 1.4 1.95 2.5 3.3 3.3l13.75-23.8h-27.5c0 1.55.4 3.1 1.2 4.5z",fill:"#0066da"}),n.jsx("path",{d:"M43.65 25l13.75-23.8c-1.35-.8-2.9-1.2-4.5-1.2h-18.5c-1.6 0-3.15.45-4.5 1.2l13.75 23.8z",fill:"#00ac47"}),n.jsx("path",{d:"M73.55 76.8c1.35-.8 2.5-1.9 3.3-3.3l9.6-16.6c.8-1.4 1.2-2.95 1.2-4.5h-27.5l13.4 24.4z",fill:"#ea4335"}),n.jsx("path",{d:"M43.65 25L29.9 1.2c-1.35.8-2.5 1.9-3.3 3.3l-9.6 16.6c-.8 1.4-1.2 2.95-1.2 4.5h27.5z",fill:"#00832d"}),n.jsx("path",{d:"M59.05 52.9H31.55l-13.75 23.8c1.35.8 2.9 1.2 4.5 1.2h18.5c1.6 0 3.15-.45 4.5-1.2l13.75-23.8z",fill:"#2684fc"}),n.jsx("path",{d:"M73.55 76.8l-13.75-23.8h-27.5l13.75 23.8c1.35.8 2.9 1.2 4.5 1.2h18.5c1.6 0 3.15-.45 4.5-1.2z",fill:"#ffba00"})]}),oP=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 4.5l-2.404 2.404a5.002 5.002 0 01-7.072 0l-1.06-1.06a5.002 5.002 0 010-7.072l2.404-2.404a1.5 1.5 0 012.122 0l6.01 6.01a1.5 1.5 0 010 2.122zM8.25 15.75l-4.5 4.5a1.5 1.5 0 000 2.122l1.06 1.06a1.5 1.5 0 002.122 0l4.5-4.5"})}),ty=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})}),rP=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),aP=({node:e,isDockedWindow:t,isRerouteDot:o,headerBgClass:r,onMouseDown:a,onTouchStart:i,onMouseUp:s,onDoubleClick:l,onToggleCollapse:c,onRenameNode:d,onCutConnections:u,onDuplicateNode:p,onDuplicateNodeWithContent:h,onCopyNodeValue:w,onPasteNodeValue:k,onPasteImage:b,onDownloadImage:y,onRefreshImageEditor:g,onRefreshChat:m,onValueChange:x,clearImagesForNodeFromCache:_,addToast:S,getEmptyValueForNodeType:P,onSaveSequenceToCatalog:j,onSaveScriptToDisk:M,onSaveMediaToDisk:D,onSaveCharacterToCatalog:O,onSaveCharacterCard:B,handleUndockNode:E,handleOpenNodeContextMenu:I,handleRequestDelete:N,isInstantCloseEnabled:T,onToggleCharacterImages:F,allImagesCollapsed:z})=>{const{t:G}=St(),U=Ut(),{handleDockNode:R,toggleNodeFullScreen:q,focusedNodeId:H,handleToggleNodePin:ne,handleToggleNodeHandles:X}=U||{},re=H===e.id,de=Vl(e.type),ge=e.type===L.NOTE;let te=!1,le={};if(ge)try{le=JSON.parse(e.value||"{}"),te=!!le.isMinimal}catch{}const ee=Q=>{Q.stopPropagation();const ce={...le,isMinimal:!te};x(e.id,JSON.stringify(ce))},se=jt.useMemo(()=>{if(e.type===L.IMAGE_OUTPUT||e.type===L.VIDEO_OUTPUT)return!!e.value;if(e.type===L.IMAGE_INPUT||e.type===L.IMAGE_ANALYZER||e.type===L.IMAGE_EDITOR||e.type===L.CHARACTER_CARD||e.type===L.DATA_READER)try{const Q=JSON.parse(e.value||"{}");return!!Q.image||Q.inputImages&&Q.inputImages.length>0||!!Q.outputImage}catch{return e.type===L.IMAGE_INPUT?!!e.value:!1}return!1},[e.type,e.value]),ie=jt.useMemo(()=>({[L.TEXT_INPUT]:G("node.help.text_input"),[L.IMAGE_INPUT]:G("node.help.image_input"),[L.PROMPT_PROCESSOR]:G("node.help.prompt_processor"),[L.PROMPT_SANITIZER]:G("node.help.prompt_sanitizer"),[L.VIDEO_PROMPT_PROCESSOR]:G("node.help.video_prompt_processor"),[L.IMAGE_OUTPUT]:G("node.help.image_output"),[L.VIDEO_OUTPUT]:G("node.help.video_output"),[L.PROMPT_ANALYZER]:G("node.help.prompt_analyzer"),[L.CHARACTER_ANALYZER]:G("node.help.character_analyzer"),[L.CHARACTER_GENERATOR]:G("node.help.character_generator"),[L.CHARACTER_CARD]:G("node.help.character_card"),[L.IMAGE_ANALYZER]:G("node.help.image_analyzer"),[L.IMAGE_EDITOR]:G("node.help.image_editor"),[L.IMAGE_SEQUENCE_GENERATOR]:G("node.help.image_sequence_generator"),[L.PROMPT_SEQUENCE_EDITOR]:G("node.help.prompt_sequence_editor"),[L.GEMINI_CHAT]:G("node.help.gemini_chat"),[L.TRANSLATOR]:G("node.help.translator"),[L.SCRIPT_GENERATOR]:G("node.help.script_generator"),[L.SCRIPT_VIEWER]:G("node.help.script_viewer"),[L.NOTE]:G("node.help.note"),[L.REROUTE_DOT]:G("node.help.reroute_dot"),[L.DATA_READER]:G("node.help.data_reader"),[L.VIDEO_EDITOR]:G("node.help.video_editor"),[L.MEDIA_VIEWER]:G("node.help.media_viewer")}),[G]),oe=Q=>{Q.stopPropagation(),x(e.id,P(e)),(e.type===L.IMAGE_INPUT||e.type===L.IMAGE_OUTPUT||e.type===L.IMAGE_ANALYZER||e.type===L.IMAGE_SEQUENCE_GENERATOR)&&_(e.id),S(G("toast.contentCleared"))},A=Q=>{Q.stopPropagation(),R&&R(e.id,"full"),q&&setTimeout(()=>q(e.id),50)},K=Q=>{if(!R||!e.dockState)return;const ce=["q1","q2","q3","q4"],fe=e.dockState.mode;let $=ce.indexOf(fe);$===-1&&(["left","tl","bl"].includes(fe)?$=0:["right","tr","br"].includes(fe)?$=3:$=0);let V=$+Q;V<0&&(V=0),V>=ce.length&&(V=ce.length-1),ce[V]!==fe&&R(e.id,ce[V])},Z=Q=>{if(!R||!e.dockState)return;const ce=e.dockState.mode;Q==="left"?ce==="tl"?R(e.id,"bl"):R(e.id,"tl"):ce==="tr"?R(e.id,"br"):R(e.id,"tr")},W=Q=>{Q.stopPropagation();let ce=[];try{const Y=JSON.parse(e.value||"[]");ce=Array.isArray(Y)?Y:[Y]}catch{ce=[]}let fe=1;const $=new Set(ce.map(Y=>Y.name));for(;$.has(`New Character ${fe}`);)fe++;const V={id:`char-card-${Date.now()}`,name:`New Character ${fe}`,index:`Character-${ce.length+1}`,image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:ce.length===0,isDescriptionCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"},J=[...ce,V];if(x(e.id,JSON.stringify(J)),U!=null&&U.setNodes){const ue=J.length*410+90;U.setNodes(he=>he.map(ye=>ye.id===e.id?{...ye,width:ue}:ye))}};return n.jsx("div",{className:`${r} text-white font-bold p-2 ${e.isCollapsed?"rounded-md":"rounded-t-md"} flex justify-between items-center flex-shrink-0 ${!o&&!t?"cursor-move":""}`,onMouseDown:a,onTouchStart:!o&&!t?i:void 0,onMouseUp:s,onContextMenu:Q=>{I&&I(Q,e.id)},onDoubleClick:l,style:o?{height:"100%"}:{height:`${Lt}px`},children:o?n.jsx("div",{className:"w-full h-full flex justify-center items-center"}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"flex items-center space-x-1 min-w-0",children:!te&&n.jsxs(n.Fragment,{children:[!t&&!re&&n.jsx(Pe,{title:e.isCollapsed?G("node.action.expand"):G("node.action.collapse"),onClick:()=>c(e.id),children:e.isCollapsed?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),!t&&!re&&ne&&n.jsx(Pe,{title:e.isPinned?G("node.action.unpin"):G("node.action.pin"),onClick:Q=>{Q.stopPropagation(),ne(e.id)},className:`p-1 rounded hover:bg-gray-600 transition-colors border ${e.isPinned?"border-accent-text text-accent-text":"border-transparent text-gray-500 hover:text-white"}`,children:n.jsx(Op,{className:"h-4 w-4"})}),n.jsx("span",{className:"truncate pr-2",children:e.title})]})}),n.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0",onMouseDown:Q=>Q.stopPropagation(),onTouchStart:Q=>Q.stopPropagation(),onDoubleClick:Q=>Q.stopPropagation(),children:[ge&&n.jsx(Pe,{title:te?"Show Controls":"Hide Controls",onClick:ee,className:`p-1 rounded hover:bg-gray-600 transition-colors ${te?"text-gray-500":"text-gray-400 hover:text-white"}`,children:te?n.jsx(Sl,{className:"h-4 w-4"}):n.jsx(Nl,{className:"h-4 w-4"})}),e.type===L.CHARACTER_CARD&&!te&&n.jsxs(n.Fragment,{children:[F&&n.jsx(Pe,{title:G(z?"node.action.showImages":"node.action.hideImages"),onClick:Q=>{Q.stopPropagation(),F()},className:`p-1 rounded hover:bg-gray-600 transition-colors border ${z?"border-transparent text-gray-400 hover:text-white":"border-accent text-accent-text"}`,children:n.jsx(rP,{className:"h-4 w-4"})}),X&&n.jsx(Pe,{title:e.collapsedHandles?G("node.action.showOutputs"):G("node.action.hideOutputs"),onClick:Q=>{Q.stopPropagation(),X(e.id)},className:`p-1 rounded hover:bg-gray-600 transition-colors border ${e.collapsedHandles?"border-accent text-accent-text":"border-transparent text-gray-400 hover:text-white"}`,children:e.collapsedHandles?n.jsx(Nl,{className:"h-4 w-4"}):n.jsx(Sl,{className:"h-4 w-4"})})]}),!te&&n.jsxs("div",{className:"relative flex items-center group/help-tooltip",children:[n.jsx("button",{onMouseDown:Q=>Q.stopPropagation(),className:"p-1 text-gray-400 rounded hover:bg-gray-600 hover:text-white transition-colors duration-150 focus:outline-none focus:ring-1 focus:ring-cyan-500","aria-label":G("node.action.help"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 bg-slate-700 text-slate-200 text-xs whitespace-normal w-64 rounded-lg shadow-xl z-50 opacity-0 pointer-events-none group-hover/help-tooltip:opacity-100 transition-opacity duration-200 ease-out",children:ie[e.type]||G("node.action.help")})]}),!t&&!te&&n.jsx(Pe,{title:G("node.action.rename"),onClick:()=>d(e.id,e.title),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),!te&&e.type===L.PROMPT_SEQUENCE_EDITOR&&j&&M&&n.jsxs(n.Fragment,{children:[n.jsx(Pe,{title:G("catalog.saveTo"),onClick:()=>j(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2v15"})})}),n.jsx(Pe,{title:G("group.saveToDisk"),onClick:()=>M(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]}),!te&&e.type===L.SCRIPT_VIEWER&&M&&n.jsx(Pe,{title:G("group.saveToDisk"),onClick:()=>M(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),!te&&e.type===L.MEDIA_VIEWER&&D&&n.jsx(Pe,{title:G("group.saveToDisk"),onClick:()=>D(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),!te&&(e.type===L.IMAGE_OUTPUT||e.type===L.VIDEO_OUTPUT||e.type===L.IMAGE_INPUT||e.type===L.GEMINI_CHAT)&&(se||e.type===L.GEMINI_CHAT)&&n.jsx(Pe,{title:G("node.action.download"),onClick:()=>y(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),!te&&(e.type===L.IMAGE_INPUT||e.type===L.IMAGE_OUTPUT||e.type===L.DATA_READER)&&se&&n.jsx(Pe,{title:G("node.action.clear"),onClick:oe,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),!te&&e.type===L.IMAGE_ANALYZER&&se&&n.jsx(Pe,{title:G("node.action.clear"),onClick:oe,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),!te&&e.type===L.IMAGE_EDITOR&&n.jsx(Pe,{title:G("node.action.clear"),onClick:()=>g(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),!te&&e.type===L.GEMINI_CHAT&&n.jsx(Pe,{title:G("node.action.refreshChat"),onClick:()=>m(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-4 w-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),!te&&(e.type===L.PROMPT_ANALYZER||e.type===L.CHARACTER_ANALYZER||e.type===L.CHARACTER_GENERATOR)&&n.jsx(Pe,{title:G("node.action.clear"),onClick:oe,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),!te&&(e.type===L.IMAGE_SEQUENCE_GENERATOR||e.type===L.PROMPT_SEQUENCE_EDITOR)&&n.jsx(Pe,{title:G("node.action.clear"),onClick:()=>{if(e.type===L.IMAGE_SEQUENCE_GENERATOR)try{const ce={...JSON.parse(e.value||"{}"),prompts:[],images:{},frameStatuses:{},checkedFrameNumbers:[],selectedFrameNumber:null,usedCharacters:[]};x(e.id,JSON.stringify(ce)),_(e.id),S(G("toast.contentCleared"))}catch{oe(null)}else oe(null)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),!te&&(e.type===L.IMAGE_INPUT||e.type===L.IMAGE_ANALYZER||e.type===L.IMAGE_EDITOR)&&n.jsxs(n.Fragment,{children:[" ",n.jsx(Pe,{title:G("node.action.paste"),onClick:()=>b(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})})," "]}),!te&&e.type===L.CHARACTER_CARD&&n.jsxs(n.Fragment,{children:[n.jsx(Pe,{title:G("node.action.addCard"),onClick:W,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),O&&B&&n.jsxs(n.Fragment,{children:[n.jsx(Pe,{title:G("catalog.saveTo"),onClick:()=>O(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})}),n.jsx(Pe,{title:G("node.action.saveCharacter"),onClick:()=>B(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Pe,{title:G("node.action.paste"),onClick:()=>k(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),n.jsx(Pe,{title:G("node.action.copy"),onClick:()=>w(e.id),children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Pe,{title:G("node.action.clear"),onClick:oe,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),!te&&(e.type===L.TEXT_INPUT||e.type===L.NOTE||e.type===L.SCRIPT_GENERATOR||e.type===L.SCRIPT_VIEWER||e.type===L.MEDIA_VIEWER)&&n.jsxs(n.Fragment,{children:[" ",n.jsx(Pe,{title:G("node.action.clear"),onClick:oe,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),n.jsxs(Pe,{title:G("node.action.paste"),onClick:()=>k(e.id),children:[" ",n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})]})," "]}),!te&&e.type!==L.IMAGE_EDITOR&&e.type!==L.CHARACTER_CARD&&n.jsx(Pe,{title:G("node.action.copy"),onClick:()=>w(e.id),children:n.jsx(Dt,{className:"h-4 w-4"})}),!t&&!te&&n.jsx(Pe,{title:G("toolbar.duplicateWithContent"),onClick:()=>h(e.id),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("rect",{x:"5",y:"5",width:"14",height:"14",rx:"2",ry:"2"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m-3-3h6"})]})}),!t&&!te&&n.jsx(Pe,{title:G("toolbar.duplicate"),onClick:()=>p(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("rect",{x:"5",y:"5",width:"14",height:"14",rx:"2",ry:"2"})})}),!te&&e.type!==L.NOTE&&!t&&n.jsx(Pe,{title:G("node.action.cutConnections"),onClick:Q=>{Q.stopPropagation(),u(e.id)},children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121M12 12L4.5 4.5"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5l.707-.707M19.5 4.5l-.707.707"})]})}),!t&&!te&&n.jsx(Pe,{title:G(T?"node.action.closeNodeSimple":"node.action.closeNode"),onClick:N,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),!te&&(t||re)&&E&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"w-px h-3 bg-gray-500 mx-1"}),!re&&n.jsxs(n.Fragment,{children:[!de&&n.jsx(ut,{content:"Cycle Horizontal Left",children:n.jsx("button",{onClick:Q=>{Q.stopPropagation(),K(-1)},className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("path",{d:"M15 18l-6-6 6-6"})})})}),!de&&n.jsx(ut,{content:"Cycle Vertical Left (TL/BL)",children:n.jsx("button",{onClick:Q=>{Q.stopPropagation(),Z("left")},className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M7 15l5 5 5-5"}),n.jsx("path",{d:"M7 9l5-5 5 5"})]})})}),n.jsx(ut,{content:G("toolbar.dock.left"),children:n.jsx("button",{onClick:Q=>{Q.stopPropagation(),R&&R(e.id,"left")},className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsx(Q1,{})})}),n.jsx(ut,{content:G("toolbar.dock.right"),children:n.jsx("button",{onClick:Q=>{Q.stopPropagation(),R&&R(e.id,"right")},className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsx(ey,{})})}),!de&&n.jsx(ut,{content:"Cycle Vertical Right (TR/BR)",children:n.jsx("button",{onClick:Q=>{Q.stopPropagation(),Z("right")},className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M7 15l5 5 5-5"}),n.jsx("path",{d:"M7 9l5-5 5 5"})]})})}),!de&&n.jsx(ut,{content:"Cycle Horizontal Right",children:n.jsx("button",{onClick:Q=>{Q.stopPropagation(),K(1)},className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("path",{d:"M9 18l6-6-6-6"})})})})]}),re?n.jsx(ut,{content:G("toolbar.dock.exitFull"),children:n.jsx("button",{onClick:Q=>{Q.stopPropagation(),q==null||q(null)},className:"text-cyan-400 hover:text-white transition-colors p-1",children:n.jsx(qp,{})})}):n.jsx(ut,{content:G("toolbar.dock.fullFocus"),children:n.jsx("button",{onClick:A,className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsx(zp,{})})}),n.jsx(ut,{content:G("toolbar.detach"),children:n.jsx("button",{onClick:Q=>{Q.stopPropagation(),re&&(q==null||q(null)),E(e.id)},className:"text-gray-400 hover:text-white transition-colors ml-1 p-1",children:n.jsx(X1,{})})})]})]})]})})},iP=({text:e})=>n.jsx("div",{className:"absolute z-50 px-2 py-1 text-sm transition-opacity duration-200 ease-out opacity-0 pointer-events-none left-full ml-3 top-1/2 -translate-y-1/2 bg-slate-700 text-slate-200 whitespace-nowrap rounded-md shadow-xl group-hover/handle:opacity-100",children:e}),sP=({text:e})=>n.jsx("div",{className:"absolute z-50 px-2 py-1 text-sm transition-opacity duration-200 ease-out opacity-0 pointer-events-none right-full mr-3 top-1/2 -translate-y-1/2 bg-slate-700 text-slate-200 whitespace-nowrap rounded-md shadow-xl group-hover/handle:opacity-100",children:e}),Gg=({node:e,getHandleColor:t,handleCursor:o,isCollapsed:r,isProxy:a,connectedInputType:i})=>{const s=jt.useMemo(()=>{if(e.type===L.IMAGE_EDITOR)try{return JSON.parse(e.value||"{}")}catch{return{}}return{}},[e.value,e.type]),l=jt.useMemo(()=>e.type===L.IMAGE_EDITOR?s.isSequenceMode&&(s.isSequentialCombinationMode||s.isSequentialEditingWithPrompts):!1,[e.type,s]),c=jt.useMemo(()=>e.type===L.IMAGE_EDITOR?s.isSequenceMode&&s.isSequentialEditingWithPrompts:!1,[e.type,s]),d=e.type===L.REROUTE_DOT,p=jt.useMemo(()=>{if(!d)return!1;try{return JSON.parse(e.value||"{}").direction==="RL"}catch{return!1}},[d,e.value])?{right:"-10px",left:"auto"}:{left:"-10px"},h=y=>e.type===L.DATA_READER&&i?i:y,w=(y,g,m)=>n.jsx("div",{style:{top:g,cursor:o,...p},className:`absolute w-5 h-5 rounded-full border-2 border-gray-900 transform -translate-y-1/2 ${t(h(y.type),y.handleId)} group/handle transition-[transform,border-color,background-color] duration-200 hover:scale-125 hover:border-white hover:z-20`,"data-is-input-handle":"true","data-node-id":e.id,"data-handle-id":y.handleId||"","data-handle-type":y.type||"",children:n.jsx(iP,{text:y.title})},m);if(a){let y=[];if(e.type===L.IMAGE_EDITOR)c||y.push({handleId:"image",type:"image",title:"Image"}),l&&y.push({handleId:"image_b",type:"image",title:"Image B"}),y.push({handleId:"text",type:"text",title:"Text"});else if(e.type===L.IMAGE_SEQUENCE_GENERATOR)y=[{handleId:"character_data",type:"character_data",title:"Character Data Input"},{handleId:"prompt_input",type:"text",title:"Text"}];else if(e.type===L.PROMPT_SEQUENCE_EDITOR)y=[{handleId:"prompts_sequence",type:"text",title:"Prompts Sequence Input"}];else if(e.type===L.NOTE)y=[{handleId:"prompt_data",type:"text",title:"Prompt Input"}];else if(e.type===L.VIDEO_EDITOR)y=[{handleId:"video",type:"video",title:"Video"},{handleId:"audio",type:"audio",title:"Audio"},{handleId:"image",type:"image",title:"Image"},{handleId:"text",type:"text",title:"Text"}];else if(e.type===L.CHARACTER_CARD)y=[{handleId:void 0,type:"text",title:"Input"}];else{const g=Bs(e,void 0);(g!==null||e.type===L.REROUTE_DOT||e.type===L.DATA_READER)&&(y=[{handleId:void 0,type:g,title:"Input"}])}return y.length===0?null:n.jsxs(n.Fragment,{children:[" ",y.map((g,m)=>{const x=48/(y.length+1);return w(g,`${(m+1)*x}px`,g.handleId||`proxy-in-${m}`)})," "]})}if(r){let y=[];if(e.type===L.IMAGE_EDITOR)c||y.push({handleId:"image",type:"image",title:"Image Input A"}),l&&y.push({handleId:"image_b",type:"image",title:"Image Input B"}),y.push({handleId:"text",type:"text",title:"Text Input"});else if(e.type===L.IMAGE_SEQUENCE_GENERATOR)y=[{handleId:"character_data",type:"character_data",title:"Character Data Input"},{handleId:"prompt_input",type:"text",title:"Prompts JSON Input"}];else if(e.type===L.NOTE){try{if(JSON.parse(e.value||"{}").activeTab==="note")return null}catch{}y=[{handleId:"prompt_data",type:"text",title:"Prompt Data Input"}]}else if(e.type===L.PROMPT_SEQUENCE_EDITOR)y=[{handleId:"prompts_sequence",type:"text",title:"Prompts Sequence Input"}];else if(e.type===L.VIDEO_EDITOR)y=[{handleId:"video",type:"video",title:"Video Input"},{handleId:"audio",type:"audio",title:"Audio Input"},{handleId:"image",type:"image",title:"Image Input"},{handleId:"text",type:"text",title:"Text Input"}];else{const g=Bs(e,void 0);(g!==null||e.type===L.REROUTE_DOT||e.type===L.DATA_READER)&&(y=[{handleId:void 0,type:g,title:"Input"}])}return y.length===0?null:n.jsxs(n.Fragment,{children:[" ",y.map((g,m)=>w(g,`${(m+1)*(En/(y.length+1))}px`,g.handleId||`input-${m}`))," "]})}if(e.type===L.IMAGE_EDITOR){let y=330;s.topPaneHeight&&(y=s.topPaneHeight);const g=Lt+Wt;let m,x;l?(m=g+y*.25,x=g+y*.75):m=g+y*.5,c&&(x=g+y*.5);const S=g+y+16,j=e.height-Wt-S,M=S+j/2;return n.jsxs(n.Fragment,{children:[!c&&w({type:"image",handleId:"image",title:l?"Image Input A":"Image Input"},`${m}px`,"image"),(l||c)&&x&&w({type:"image",handleId:"image_b",title:"Image Input B"},`${x}px`,"image_b"),w({type:"text",handleId:"text",title:"Text Input"},`${M}px`,"text")]})}if(e.type===L.VIDEO_EDITOR){const y=Lt+20,g=50;return n.jsxs(n.Fragment,{children:[w({type:"video",handleId:"video",title:"Video Input"},`${y}px`,"video"),w({type:"audio",handleId:"audio",title:"Audio Input"},`${y+g}px`,"audio"),w({type:"image",handleId:"image",title:"Image Input"},`${y+g*2}px`,"image"),w({type:"text",handleId:"text",title:"Text Input"},`${y+g*3}px`,"text")]})}if(e.type===L.IMAGE_SEQUENCE_GENERATOR){let y="normal";try{const j=JSON.parse(e.value||"{}");j.conceptsMode&&(y=j.conceptsMode)}catch{}let g=390;y==="collapsed"?g=37:y==="expanded"&&(g=e.height-Lt-Wt);const m=Lt+Wt,x=m+g/2,S=m+g+8,P=S+(e.height-S-Wt)/2;return n.jsxs(n.Fragment,{children:[w({type:"character_data",handleId:"character_data",title:"Character Data Input"},`${x}px`,"character_data"),y!=="expanded"&&w({type:"text",handleId:"prompt_input",title:"Prompts JSON Input"},`${P}px`,"prompt_input")]})}if(e.type===L.NOTE){try{if(JSON.parse(e.value||"{}").activeTab==="note")return null}catch{}const y=80+(e.height-80)/2;return w({type:"text",handleId:"prompt_data",title:"Prompt Data Input"},`${y}px`,"prompt_data")}if(e.type===L.PROMPT_SEQUENCE_EDITOR)return w({type:"text",handleId:"prompts_sequence",title:"Prompts Sequence Input"},"50%","prompts_sequence");const k=Bs(e,void 0);if(k===null)return e.type===L.REROUTE_DOT||e.type===L.DATA_READER?w({type:null,handleId:void 0,title:"Any Input"},"50%","any"):null;let b="Input";return k==="image"?b="Image Input":k==="character_data"?b="Character Data Input":k==="text"?b="Text Input":k==="video"?b="Video Input":k==="audio"&&(b="Audio Input"),w({type:k,handleId:void 0,title:b},"50%","default")},Ug=({node:e,getHandleColor:t,handleCursor:o,onOutputHandleMouseDown:r,onOutputHandleTouchStart:a,t:i,isCollapsed:s,isProxy:l})=>{const c=(y,g)=>{y.stopPropagation(),r&&r(y,e.id,g)},d=(y,g)=>{y.stopPropagation(),a&&a(y,e.id,g)},u=v.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{}}},[e.value]),p=e.type===L.REROUTE_DOT,w=jt.useMemo(()=>{if(!p)return!1;try{return JSON.parse(e.value||"{}").direction==="RL"}catch{return!1}},[p,e.value])?{left:"-10px",right:"auto"}:{right:"-10px"},k=(y,g,m)=>n.jsx("div",{onMouseDown:x=>c(x,y.handleId),onTouchStart:x=>d(x,y.handleId),style:{top:g,cursor:o,...w},className:`absolute w-5 h-5 rounded-full border-2 border-gray-900 transform -translate-y-1/2 ${t(y.type,y.handleId)} group/handle transition-[transform,border-color,background-color] duration-200 hover:scale-125 hover:border-white hover:z-20`,children:n.jsx(sP,{text:y.title})},m);if(l){let y=[];const g=Yn(e,void 0);return e.type===L.IMAGE_EDITOR?y=[{handleId:void 0,type:"image",title:"Output"}]:e.type===L.CHARACTER_GENERATOR?y=[{handleId:"character-0",type:"character_data",title:"Characters"}]:e.type===L.NOTE?y=[{handleId:"all_images",type:"image",title:"Images"},{handleId:"all_captions",type:"text",title:"Captions"}]:e.type===L.PROMPT_SEQUENCE_EDITOR?y=[{handleId:"all_data",type:"text",title:"All Data"}]:e.type===L.CHARACTER_CARD?y=[{handleId:"all_data",type:"character_data",title:"All Data"}]:(g!==null||e.type===L.REROUTE_DOT)&&(y=[{handleId:void 0,type:g,title:"Output"}]),y.length===0?null:n.jsxs(n.Fragment,{children:[" ",y.map((m,x)=>{const _=48/(y.length+1);return k(m,`${(x+1)*_}px`,m.handleId||`proxy-out-${x}`)})," "]})}if(s){let y=[];if(e.type===L.PROMPT_ANALYZER){const{characters:g=[]}=u;y=["environment",...g.map((x,_)=>`character-${_}`),"action","emotion","style"].map(x=>({handleId:x,type:"text",title:x.startsWith("character-")?`${i("node.content.character")} ${parseInt(x.split("-")[1],10)+1}`:i(`node.content.${x}`)}))}else if(e.type===L.PROMPT_SEQUENCE_EDITOR)y=[{handleId:"all_data",type:"text",title:i("node.output.allPromptData")}];else if(e.type===L.CHARACTER_ANALYZER)y=[{handleId:"character",type:"text",title:i("node.content.character")},{handleId:"clothing",type:"text",title:i("node.content.clothing")}];else if(e.type===L.IMAGE_INPUT||e.type===L.IMAGE_ANALYZER)y=[{handleId:"image",type:"image",title:"Image Output"},{handleId:"text",type:"text",title:"Text Output"}];else if(e.type===L.SCRIPT_GENERATOR){const{summary:g,detailedCharacters:m=[],scenes:x=[]}=u,_=m.map((P,j)=>({handleId:`character-${j}`,type:"text",title:`Character ${j+1}`})),S=x.map((P,j)=>({handleId:`scene-${j}`,type:"text",title:`Scene ${j+1}`}));y=g?[{handleId:"summary",type:"text",title:"Summary"},..._,...S]:[..._,...S]}else if(e.type===L.SCRIPT_VIEWER){const g=u.type;y=[{handleId:"full-json",type:"text",title:"Full Data JSON"}],g==="script-analyzer-data"&&y.push({handleId:"all-image-prompts",type:"text",title:"All Image Prompts"},{handleId:"all-video-prompts",type:"text",title:"All Video Prompts"})}else if(e.type===L.CHARACTER_GENERATOR){const{characters:g=[]}=u;y=g.map((m,x)=>({handleId:`character-${x}`,type:"text",title:m.name||`Character ${x+1}`}))}else if(e.type===L.CHARACTER_CARD){const g=[{handleId:"all_data",type:"character_data",title:"All Characters Data"},{handleId:"primary_data",type:"character_data",title:"Primary Character Data"}],m=[{handleId:"image",type:"image",title:"Image (primary)"},{handleId:"prompt",type:"text",title:"Prompt (primary)"},{handleId:"appearance",type:"text",title:`${i("node.content.appearance")} (primary)`},{handleId:"personality",type:"text",title:`${i("node.content.personality")} (primary)`},{handleId:"clothing",type:"text",title:`${i("node.content.clothing")} (primary)`}];e.collapsedHandles?y=g:y=[...g,...m]}else if(e.type===L.IMAGE_SEQUENCE_GENERATOR)y=[{handleId:"all_images",type:"image",title:"All Images"}];else if(e.type===L.NOTE){try{if(JSON.parse(e.value||"{}").activeTab==="note")return null}catch{}y=[{handleId:"all_images",type:"image",title:"All Images"},{handleId:"all_captions",type:"text",title:"All Captions"}]}else{const g=Yn(e,void 0);if(g!==null||e.type===L.REROUTE_DOT){const m=e.type===L.REROUTE_DOT?"Any Output":g==="image"?"Image Output":g==="character_data"?"Character Data Output":g==="video"?"Video Output":g==="audio"?"Audio Output":"Text Output";y=[{handleId:void 0,type:g,title:m}]}}return y.length===0?null:n.jsxs(n.Fragment,{children:[" ",y.map((g,m)=>k(g,`${(m+1)*(En/(y.length+1))}px`,g.handleId||`output-${m}`))," "]})}if(e.type===L.NOTE){try{if(JSON.parse(e.value||"{}").activeTab==="note")return null}catch{}const y=e.height-80,g=80+y*.33,m=80+y*.66;return n.jsxs(n.Fragment,{children:[k({type:"image",handleId:"all_images",title:"All Images"},`${g}px`,"all_images"),k({type:"text",handleId:"all_captions",title:"All Captions"},`${m}px`,"all_captions")]})}if(e.type===L.PROMPT_ANALYZER)return null;if(e.type===L.SCRIPT_VIEWER){const y=u.type,g=[{handleId:"full-json",type:"text",title:"Full Data JSON"}];y==="script-analyzer-data"&&g.push({handleId:"all-image-prompts",type:"text",title:"All Image Prompts"},{handleId:"all-video-prompts",type:"text",title:"All Video Prompts"});const m=e.height/(g.length+1);return n.jsxs(n.Fragment,{children:[" ",g.map((x,_)=>k(x,`${(_+1)*m}px`,x.handleId))," "]})}if(e.type===L.PROMPT_SEQUENCE_EDITOR)return k({type:"text",handleId:"all_data",title:i("node.output.allPromptData")},"50%","all_data");if(e.type===L.IMAGE_SEQUENCE_GENERATOR)return k({type:"image",handleId:"all_images",title:"All Images"},"50%","all_images");if(e.type===L.CHARACTER_GENERATOR){const{characters:y=[]}=u;if(y.length===0)return null;const g=e.height-Lt-2*Wt,m=180,x=g-m;return n.jsxs(n.Fragment,{children:[" ",y.map((_,S)=>{const P=x/(y.length+1),j=Lt+Wt+m+P*(S+1);return k({type:"character_data",handleId:`character-${S}`,title:_.name||`Character ${S+1}`},`${j}px`,`character-${S}`)})," "]})}if(e.type===L.SCRIPT_GENERATOR){const{summary:y,detailedCharacters:g=[],scenes:m=[]}=u,x=[];y&&x.push({id:"summary",title:"Summary"}),g.forEach((S,P)=>x.push({id:`character-${P}`,title:`Character ${P+1}`})),m.forEach((S,P)=>x.push({id:`scene-${P}`,title:`Scene ${P+1}`}));const _=e.height-Lt-2*Wt;return n.jsxs(n.Fragment,{children:[" ",x.map((S,P)=>{const j=Lt+Wt+_/(x.length+1)*(P+1);return k({type:"text",handleId:S.id,title:S.title},`${j}px`,S.id)})," "]})}if(e.type===L.CHARACTER_ANALYZER){const y=["character","clothing"],_=Lt+Wt,P=e.height-Wt-40-8-_;return n.jsxs(n.Fragment,{children:[" ",y.map((j,M)=>{const D=_+P/2*(M+.5),O=i(`node.content.${j}`);return k({type:"text",handleId:j,title:O},`${D}px`,j)})," "]})}if(e.type===L.IMAGE_INPUT){const y=e.height-Lt-2*Wt,g=Math.max(0,y),m=Lt+Wt+g/4,x=e.height-80;return n.jsxs(n.Fragment,{children:[k({type:"image",handleId:"image",title:"Image Output"},`${m}px`,"image"),k({type:"text",handleId:"text",title:"Text Output"},`${x}px`,"text")]})}if(e.type===L.IMAGE_ANALYZER){const y=e.height-Lt-2*Wt,g=8,m=(y-g)/2,x=Lt+Wt,_=x+m/2,S=x+m+g+m/2;return n.jsxs(n.Fragment,{children:[k({type:"image",handleId:"image",title:"Image Output"},`${_}px`,"image"),k({type:"text",handleId:"text",title:"Text Output"},`${S}px`,"text")]})}if(e.type===L.CHARACTER_CARD)try{const y=[{handleId:"all_data",type:"character_data",title:"All Characters Data"},{handleId:"primary_data",type:"character_data",title:"Primary Character Data"}];if(e.collapsedHandles){const P=(e.height-Lt-20)/(y.length+1);return n.jsx(n.Fragment,{children:y.map((j,M)=>k(j,`${Lt+P*(M+1)}px`,j.handleId||`output-${M}`))})}const g=[{handleId:"image",type:"image",title:"Image (primary)"},{handleId:"prompt",type:"text",title:"Prompt (primary)"},{handleId:"appearance",type:"text",title:`${i("node.content.appearance")} (primary)`},{handleId:"personality",type:"text",title:`${i("node.content.personality")} (primary)`},{handleId:"clothing",type:"text",title:`${i("node.content.clothing")} (primary)`}],m=[...y,...g],_=(e.height-Lt-20)/(m.length+1);return n.jsx(n.Fragment,{children:m.map((S,P)=>k(S,`${Lt+_*(P+1)}px`,S.handleId||`output-${P}`))})}catch{return null}const b=Yn(e,void 0);if(b!==null||e.type===L.REROUTE_DOT){const y=e.type===L.REROUTE_DOT?"Any Output":b==="image"?"Image Output":b==="character_data"?"Character Data Output":b==="video"?"Video Output":b==="audio"?"Audio Output":"Text Output";return k({type:b,handleId:void 0,title:y},"50%","default")}return null},Fp=({libraryItems:e,onPromptInsert:t})=>{const{t:o}=St(),[r,a]=v.useState(!1),[i,s]=v.useState(!1),[l,c]=v.useState(null),d=v.useRef(null),[u,p]=v.useState(null),h=x=>{x.stopPropagation(),r?k():w()},w=()=>{if(d.current){const x=d.current.getBoundingClientRect(),_=window.innerHeight-x.bottom,S=280;let P=x.bottom+4;_<S&&(P=x.top-S-4),p({top:P,left:x.left,width:Math.max(x.width,256)}),a(!0)}},k=()=>{s(!0),setTimeout(()=>{a(!1),s(!1),c(null)},200)};v.useEffect(()=>{if(!r)return;const x=_=>{const S=_.target,P=document.getElementById("prompt-library-portal-menu");d.current&&!d.current.contains(S)&&P&&!P.contains(S)&&k()};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[r]),v.useEffect(()=>{if(!r)return;const x=()=>k();return window.addEventListener("scroll",x,!0),window.addEventListener("resize",x),()=>{window.removeEventListener("scroll",x,!0),window.removeEventListener("resize",x)}},[r]);const b=x=>{t(x),k()},y=x=>{if(x.stopPropagation(),l){const _=e.find(S=>S.id===l);c((_==null?void 0:_.parentId)||null)}},g=v.useMemo(()=>e.filter(x=>x.parentId===l).sort((x,_)=>x.type===_.type?x.name.localeCompare(_.name):x.type===Vt.FOLDER?-1:1),[e,l]),m=v.useMemo(()=>{var x;return l&&((x=e.find(_=>_.id===l))==null?void 0:x.name)||o("catalog.tabs.library")},[l,e,o]);return n.jsxs("div",{ref:d,className:"relative w-full",children:[n.jsxs("button",{onClick:h,title:o("catalog.tabs.library"),className:`w-full p-1.5 rounded transition-colors flex items-center justify-start space-x-2 ${r?"bg-accent":"bg-gray-700 hover:bg-gray-600"}`,children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 flex-shrink-0 ${r?"text-white":"text-accent-text"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),n.jsx("span",{className:`text-xs font-semibold truncate ${r?"text-white":"text-gray-200"}`,children:o("catalog.tabs.library")}),n.jsx("div",{className:"flex-grow"}),n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 ${r?"text-white":"text-gray-400"} transition-transform duration-200 ${r?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),r&&u&&Ba.createPortal(n.jsxs("div",{id:"prompt-library-portal-menu",className:`fixed bg-gray-800 rounded-lg shadow-xl border border-gray-600 z-[9999] flex flex-col overflow-hidden transition-all duration-200 ease-out origin-top ${i?"opacity-0 scale-95":"opacity-100 scale-100"}`,style:{top:u.top,left:u.left,width:u.width,maxHeight:"280px"},onWheel:x=>x.stopPropagation(),children:[n.jsxs("div",{className:`flex items-center p-2 border-b border-gray-700 bg-gray-900/50 transition-colors select-none ${l?"cursor-pointer hover:bg-gray-700":""}`,onClick:l?y:void 0,children:[l?n.jsx("div",{className:"mr-2 p-1 text-accent-text flex-shrink-0",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}):n.jsx("div",{className:"mr-2 p-1 text-gray-500 flex-shrink-0",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h7"})})}),n.jsx("span",{className:"text-sm font-bold text-gray-200 truncate",children:m})]}),n.jsx("div",{className:"overflow-y-auto p-1 custom-scrollbar flex-grow",children:g.length===0?n.jsx("div",{className:"p-4 text-center text-xs text-gray-500",children:o("library.empty.description")}):n.jsx("ul",{className:"space-y-0.5",children:g.map(x=>n.jsx("li",{children:x.type===Vt.FOLDER?n.jsxs("button",{onClick:_=>{_.stopPropagation(),c(x.id)},className:"w-full flex items-center justify-between p-2 rounded hover:bg-gray-700 text-left group transition-colors",children:[n.jsxs("div",{className:"flex items-center space-x-2 min-w-0",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-accent-text flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),n.jsx("span",{className:"text-sm text-gray-200 truncate group-hover:text-white",children:x.name})]}),n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-gray-500 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]}):n.jsxs("button",{onClick:_=>{_.stopPropagation(),b(x.content||"")},className:"w-full flex items-center space-x-2 p-2 rounded hover:bg-gray-700 text-left group transition-colors",title:x.content,children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-accent flex-shrink-0 opacity-70 group-hover:opacity-100",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),n.jsx("span",{className:"text-sm text-gray-300 truncate group-hover:text-white",children:x.name})]})},x.id))})})]}),document.body)]})},Tn=({value:e,onDebouncedChange:t,debounceTime:o=300,onChange:r,...a})=>{const[i,s]=v.useState(e),l=v.useRef(null),c=v.useRef(!1);v.useEffect(()=>{!c.current&&e!==i&&s(e)},[e]);const d=p=>{const h=p.target.value;s(h),c.current=!0,l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{t(h),c.current=!1},o),r&&r(p)},u=p=>{l.current&&(clearTimeout(l.current),t(i),c.current=!1),a.onBlur&&a.onBlur(p)};return n.jsx("textarea",{...a,value:i,onChange:d,onBlur:u})},Vg=({color:e,selected:t,onClick:o})=>n.jsx("button",{onClick:r=>{r.stopPropagation(),o()},className:`w-4 h-4 rounded-full border border-gray-600 transition-transform ${t?"scale-125 ring-2 ring-white border-transparent":"hover:scale-110"}`,style:{backgroundColor:e}}),lP=({text:e,style:t,onTextChange:o,onStyleChange:r,libraryItems:a,t:i,deselectAllNodes:s,isMinimal:l})=>{const c=["#ffffff","#9ca3af","#ef4444","#f97316","#facc15","#22d3ee","#3b82f6","#a855f7","#10b981"];return n.jsxs("div",{className:"flex flex-col h-full",children:[!l&&n.jsxs("div",{className:"flex-shrink-0 flex flex-col gap-1 mb-1",children:[n.jsx(Fp,{libraryItems:a,onPromptInsert:d=>{const u=e?`${e}
${d}`:d;o(u)}}),n.jsxs("div",{className:"flex items-center justify-between bg-gray-800/80 p-1.5 rounded-md border border-gray-700/50",children:[n.jsxs("div",{className:"flex items-center gap-1 bg-gray-900 rounded p-0.5",children:[n.jsx("button",{onClick:d=>{d.stopPropagation(),r({fontSize:Math.max(10,t.fontSize-2)})},className:"w-5 h-5 flex items-center justify-center text-gray-400 hover:text-white bg-gray-800 rounded hover:bg-gray-700 transition-colors text-xs",children:"-"}),n.jsx("span",{className:"text-[10px] w-5 text-center text-gray-300 font-mono select-none",children:t.fontSize}),n.jsx("button",{onClick:d=>{d.stopPropagation(),r({fontSize:Math.min(72,t.fontSize+2)})},className:"w-5 h-5 flex items-center justify-center text-gray-400 hover:text-white bg-gray-800 rounded hover:bg-gray-700 transition-colors text-xs",children:"+"})]}),n.jsx("div",{className:"w-px h-4 bg-gray-700 mx-1"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{onClick:d=>{d.stopPropagation(),r({isBold:!t.isBold})},className:`w-5 h-5 flex items-center justify-center rounded text-xs font-serif font-bold transition-colors ${t.isBold?"bg-gray-200 text-black":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:"B"}),n.jsx("button",{onClick:d=>{d.stopPropagation(),r({isItalic:!t.isItalic})},className:`w-5 h-5 flex items-center justify-center rounded text-xs font-serif italic transition-colors ${t.isItalic?"bg-gray-200 text-black":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:"I"})]}),n.jsx("div",{className:"w-px h-4 bg-gray-700 mx-1"}),n.jsxs("div",{className:"flex items-center gap-0.5",children:[n.jsx("button",{onClick:d=>{d.stopPropagation(),r({textAlign:"left"})},className:`p-1 rounded ${t.textAlign==="left"?"text-white bg-gray-700":"text-gray-500 hover:text-gray-300"}`,children:n.jsx(J1,{})}),n.jsx("button",{onClick:d=>{d.stopPropagation(),r({textAlign:"center"})},className:`p-1 rounded ${t.textAlign==="center"?"text-white bg-gray-700":"text-gray-500 hover:text-gray-300"}`,children:n.jsx(Y1,{})}),n.jsx("button",{onClick:d=>{d.stopPropagation(),r({textAlign:"right"})},className:`p-1 rounded ${t.textAlign==="right"?"text-white bg-gray-700":"text-gray-500 hover:text-gray-300"}`,children:n.jsx(Z1,{})})]}),n.jsx("div",{className:"w-px h-4 bg-gray-700 mx-1"}),n.jsxs("div",{className:"flex items-center gap-1",children:[c.slice(0,5).map(d=>n.jsx(Vg,{color:d,selected:t.color===d,onClick:()=>r({color:d})},d)),c.slice(5).map(d=>n.jsx(Vg,{color:d,selected:t.color===d,onClick:()=>r({color:d})},d))]})]})]}),n.jsx(Tn,{value:e,onDebouncedChange:o,placeholder:i("node.content.notePlaceholder"),className:"w-full h-full p-2 bg-transparent border-none rounded-md resize-none focus:ring-2 focus:ring-cyan-500 focus:outline-none leading-relaxed transition-all",style:{fontSize:`${t.fontSize}px`,color:t.color,fontWeight:t.isBold?"bold":"normal",fontStyle:t.isItalic?"italic":"normal",textAlign:t.textAlign},onWheel:d=>d.stopPropagation(),onMouseDown:d=>d.stopPropagation(),onFocus:s})]})},cP=({id:e,index:t,image:o,caption:r,manualOrderValue:a,isLocked:i,isDragging:s,isSelected:l,top:c,left:d,width:u,height:p,onSelect:h,onDragStart:w,onDragEnd:k,onDrop:b,onDragOver:y,onManualOrderChange:g,onManualOrderSubmit:m,onMove:x,onMoveToStart:_,onMoveToEnd:S,onRemove:P,onCaptionChange:j,onViewImage:M,onCopyImage:D,onImageDragStart:O,deselectAllNodes:B,isFirst:E,isLast:I,insertionIndex:N,t:T})=>n.jsxs("div",{style:{position:"absolute",top:c,left:d,width:`${u}px`,height:`${p}px`},onDragOver:F=>y(F,t),onDrop:F=>b(F,t),onClick:F=>{F.stopPropagation(),h(e)},className:`bg-gray-800 rounded-md overflow-visible border-2 group flex flex-col shadow-sm transition-colors ${s?"opacity-40 border-dashed border-cyan-500":l?"border-cyan-500":"border-gray-700 hover:border-gray-500"}`,children:[N===t&&!i&&n.jsx("div",{className:"absolute left-[-10px] top-0 bottom-0 w-1.5 bg-cyan-500 rounded z-50 pointer-events-none"}),n.jsxs("div",{draggable:!i,onDragStart:F=>w(F,t),onDragEnd:k,className:`h-7 bg-gray-900/80 border-b border-gray-700 flex items-center justify-between px-2 ${i?"cursor-default":"cursor-move hover:bg-gray-700/50"} transition-colors shrink-0 rounded-t-sm`,children:[n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx("span",{className:"text-xs text-gray-500 font-mono",children:"#"}),n.jsx("input",{type:"text",value:a,onChange:F=>g(e,F.target.value),onKeyDown:F=>{F.key==="Enter"&&m(e,t,a)},disabled:i,className:`w-8 bg-gray-900 border border-gray-600 rounded text-[10px] text-center text-gray-300 focus:border-cyan-500 focus:outline-none px-0.5 py-0.5 ${i?"opacity-50":""}`,onMouseDown:F=>F.stopPropagation(),onFocus:B}),!i&&n.jsx("button",{onClick:F=>{F.stopPropagation(),m(e,t,a)},className:"text-gray-500 hover:text-cyan-400 p-0.5 rounded transition-colors",title:"Apply Order",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]}),n.jsxs("div",{className:"flex items-center space-x-1",children:[o&&n.jsx("button",{onClick:F=>{F.stopPropagation(),D(o)},className:"text-gray-400 hover:text-white p-0.5 rounded transition-colors",title:T("node.action.copy"),children:n.jsx(Dt,{className:"h-3 w-3"})}),!i&&n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:F=>{F.stopPropagation(),_()},disabled:E,className:"text-gray-500 hover:text-white disabled:opacity-30 p-0.5",title:"Move to Top",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),n.jsx("button",{onClick:F=>{F.stopPropagation(),x(t,"up")},disabled:E,className:"text-gray-500 hover:text-white disabled:opacity-30 p-0.5",title:"Move Up",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),n.jsx("button",{onClick:F=>{F.stopPropagation(),x(t,"down")},disabled:I,className:"text-gray-500 hover:text-white disabled:opacity-30 p-0.5",title:"Move Down",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),n.jsx("button",{onClick:F=>{F.stopPropagation(),S()},disabled:I,className:"text-gray-500 hover:text-white disabled:opacity-30 p-0.5",title:"Move to Bottom",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-700 mx-1"}),n.jsx("button",{onClick:F=>{F.stopPropagation(),P(e)},className:"text-gray-500 hover:text-red-400 p-0.5",title:T("node.action.delete"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})]}),n.jsx("div",{className:"h-[170px] bg-gray-900 relative cursor-pointer flex items-center justify-center shrink-0 border-b border-gray-700 overflow-hidden",onClick:()=>M(t),children:o?n.jsx("img",{src:o,alt:"Reference",draggable:!0,onDragStart:F=>{F.stopPropagation(),O(F,o)},className:"w-full h-full object-contain"}):n.jsx("span",{className:"text-xs text-gray-600",children:"No Image"})}),n.jsx("div",{className:"flex-grow p-1",children:n.jsx(Tn,{value:r,onDebouncedChange:F=>j(e,F),placeholder:T("node.note.addCaption"),className:`w-full h-full bg-transparent text-xs text-gray-300 border-none focus:ring-0 p-1 placeholder-gray-600 resize-none leading-tight focus:outline-none transition-colors ${i?"cursor-default opacity-80":""}`,onMouseDown:F=>F.stopPropagation(),onFocus:B,readOnly:i})})]}),gs=200,Kr=270,Pr=8,Jr=8,dP=({references:e,isLocked:t,onAddImages:o,onReorder:r,onUpdateCaption:a,onRemoveReference:i,onDetach:s,onShuffle:l,onUndoShuffle:c,canUndoShuffle:d,t:u,deselectAllNodes:p,setImageViewer:h,addToast:w,getFullSizeImage:k,isMinimal:b})=>{const y=v.useRef(null),g=v.useRef(null),[m,x]=v.useState(0),[_,S]=v.useState(0),[P,j]=v.useState(!1),[M,D]=v.useState(!1),[O,B]=v.useState(null),[E,I]=v.useState(null),[N,T]=v.useState(null),[F,z]=v.useState({});v.useEffect(()=>{if(!y.current)return;const ee=new ResizeObserver(se=>{se[0]&&x(se[0].contentRect.width)});return ee.observe(y.current),()=>ee.disconnect()},[]);const G=v.useMemo(()=>{const ee=Math.max(0,m-Jr*2),se=Math.max(1,Math.floor((ee+Pr)/(gs+Pr))),ie=e.length+(t?0:1),oe=Math.ceil(ie/se),A=oe*Kr+Math.max(0,oe-1)*Pr+Jr*2;return{columns:se,totalHeight:A,totalItems:ie}},[m,e.length,t]),U=v.useMemo(()=>{var Q;const{columns:ee,totalItems:se}=G,ie=600,oe=Math.max(0,_-ie),A=_+(((Q=y.current)==null?void 0:Q.clientHeight)||600)+ie,K=[],Z=Math.floor((oe-Jr)/(Kr+Pr)),W=Math.ceil((A-Jr)/(Kr+Pr));for(let ce=Math.max(0,Z);ce<=W;ce++)for(let fe=0;fe<ee;fe++){const $=ce*ee+fe;if($>=se)break;const V=Jr+ce*(Kr+Pr),J=Jr+fe*(gs+Pr);K.push({index:$,top:V,left:J,isAddButton:!t&&$===e.length})}return K},[G,_,e.length,t]),R=ee=>{ee.target.files&&ee.target.files.length>0&&o(Array.from(ee.target.files)),ee.target&&(ee.target.value="")},q=ee=>{if(ee.preventDefault(),ee.stopPropagation(),j(!1),D(!1),I(null),t)return;const se=ee.dataTransfer.getData("note-ref-index");if(se){const A=parseInt(se,10);isNaN(A)||r(A,e.length),B(null);return}const ie=ee.dataTransfer.getData("application/prompt-modifier-drag-image");if(ie){o([ie]);return}const oe=Array.from(ee.dataTransfer.files).filter(A=>A.type.startsWith("image/"));oe.length>0&&o(oe)},H=(ee,se)=>{if(ee.preventDefault(),ee.stopPropagation(),j(!1),D(!1),I(null),t)return;const ie=ee.dataTransfer.getData("note-ref-index");if(ie){const K=parseInt(ie,10);isNaN(K)||r(K,se),B(null);return}const oe=ee.dataTransfer.getData("application/prompt-modifier-drag-image");if(oe){o([oe],se);return}const A=Array.from(ee.dataTransfer.files).filter(K=>K.type.startsWith("image/"));A.length>0&&o(A,se)},ne=(ee,se)=>{t||(ee.stopPropagation(),B(se),ee.dataTransfer.setData("note-ref-index",se.toString()),ee.dataTransfer.effectAllowed="move")},X=ee=>{B(null),I(null),j(!1),D(!1)},re=()=>{B(null),I(null),j(!1),D(!1),T(null)},de=(ee,se,ie)=>{if(!ie||t)return;const oe=parseInt(ie,10);if(isNaN(oe)||oe<1||oe===se+1)return;let A;oe>e.length?A=e.length:(A=oe-1,se<A&&(A=oe)),r(se,A),z(K=>{const Z={...K};return delete Z[ee],Z})},ge=async ee=>{if(ee)try{const ie=await(await fetch(ee)).blob();await navigator.clipboard.write([new ClipboardItem({[ie.type]:ie})]),w(u("toast.copiedToClipboard"))}catch{w(u("toast.copyFailed"),"error")}},te=ee=>{const se=e[ee];!se||!se.image||h({sources:e.filter(ie=>ie.image).map((ie,oe)=>({src:k(oe)||ie.image,frameNumber:0,prompt:ie.caption})),initialIndex:ee})},le=e.length===0;return n.jsxs("div",{className:"flex flex-col h-full",children:[!b&&n.jsxs("div",{className:"flex justify-between items-center px-2 py-1 bg-gray-900/30 mb-1 rounded flex-shrink-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:u("node.note.nestedImages")}),n.jsx("button",{onClick:re,className:"p-0.5 rounded hover:bg-gray-700 text-gray-500 hover:text-white transition-colors",title:"Reset/Refresh State",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})}),t&&n.jsxs("div",{className:"flex items-center text-cyan-400 text-xs gap-1 bg-cyan-900/30 px-1.5 py-0.5 rounded border border-cyan-700/50",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),n.jsx("span",{className:"font-semibold",children:"Linked"}),n.jsx("button",{onClick:s,className:"ml-1 hover:text-white",title:"Detach and Keep Data",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]}),n.jsx("div",{className:"flex items-center space-x-2",children:!t&&!le&&n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(Pe,{title:u("node.note.action.undoShuffle"),onClick:c,disabled:!d,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),n.jsx(Pe,{title:u("node.note.action.shuffle"),onClick:l,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})})]})})]}),n.jsx("div",{ref:y,className:`flex-grow w-full overflow-y-auto custom-scrollbar rounded-md transition-colors ${P?"bg-cyan-900/20 ring-2 ring-cyan-500 ring-inset":"bg-transparent"}`,onDragEnter:ee=>{ee.preventDefault(),ee.stopPropagation(),!t&&le&&j(!0)},onDragOver:ee=>{ee.preventDefault(),ee.stopPropagation()},onDragLeave:ee=>{ee.preventDefault(),ee.stopPropagation(),j(!1),D(!1),I(null)},onDrop:q,onScroll:ee=>S(ee.currentTarget.scrollTop),onWheel:ee=>ee.stopPropagation(),children:le&&!t?n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-500 cursor-pointer hover:text-gray-400 transition-colors p-4 text-center",onClick:()=>{var ee;return(ee=g.current)==null?void 0:ee.click()},children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 mb-2 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),n.jsx("p",{className:"text-sm font-medium",children:u("node.note.dropPlaceholder")}),n.jsx("input",{type:"file",ref:g,className:"hidden",onChange:R,multiple:!0,accept:"image/*"})]}):le&&t?n.jsx("div",{className:"h-full flex flex-col items-center justify-center text-gray-500 p-4 text-center",children:n.jsx("span",{className:"text-sm italic",children:"Waiting for prompt data..."})}):n.jsx("div",{style:{height:G.totalHeight,position:"relative",width:"100%"},children:U.map(({index:ee,top:se,left:ie,isAddButton:oe})=>{if(oe)return n.jsxs("div",{className:`absolute bg-gray-800/50 rounded-md border-2 border-dashed flex flex-col gap-2 items-center justify-center cursor-pointer transition-colors ${M?"border-cyan-500 text-cyan-500 bg-cyan-900/20":"border-gray-700 hover:border-cyan-500 hover:text-cyan-500 text-gray-500"}`,style:{width:`${gs}px`,height:`${Kr}px`,top:se,left:ie},onClick:()=>{var K;return(K=g.current)==null?void 0:K.click()},onDragOver:K=>{K.preventDefault(),K.stopPropagation(),D(!0)},onDrop:q,children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),n.jsx("span",{className:"text-xs font-medium",children:"Add Images"}),n.jsx("input",{type:"file",ref:g,className:"hidden",onChange:R,multiple:!0,accept:"image/*"})]},"add-button");const A=e[ee];return A?n.jsx(cP,{id:A.id,index:ee,image:A.image,caption:A.caption,manualOrderValue:F[A.id]??(ee+1).toString(),isLocked:t,isDragging:O===ee,isSelected:N===A.id,top:se,left:ie,width:gs,height:Kr,onSelect:T,onDragStart:ne,onDragEnd:X,onDrop:H,onDragOver:(K,Z)=>{t||(K.preventDefault(),K.stopPropagation(),I(Z))},onManualOrderChange:(K,Z)=>z(W=>({...W,[K]:Z})),onManualOrderSubmit:de,onMove:(K,Z)=>{r(K,Z==="up"?K-1:K+2)},onMoveToStart:()=>r(ee,0),onMoveToEnd:()=>r(ee,e.length),onRemove:i,onCaptionChange:a,onViewImage:te,onCopyImage:K=>ge(k(ee)||K),onImageDragStart:(K,Z)=>{const W=k(ee)||Z;W&&(K.dataTransfer.setData("application/prompt-modifier-drag-image",W),K.dataTransfer.effectAllowed="copy",K.stopPropagation())},deselectAllNodes:p,isFirst:ee===0,isLast:ee===e.length-1,insertionIndex:E,t:u},A.id):null})})})]})},od={fontSize:14,color:"#ffffff",isBold:!1,isItalic:!1,textAlign:"left"},uP=({node:e,onValueChange:t,t:o,deselectAllNodes:r,libraryItems:a,setImageViewer:i,addToast:s,setFullSizeImage:l,getFullSizeImage:c,connectedInputs:d,getUpstreamNodeValues:u})=>{const{setConnections:p}=Ut(),h=d==null?void 0:d.has("prompt_data"),w=v.useMemo(()=>{try{const D=JSON.parse(e.value||"{}");return typeof D=="object"&&D!==null&&("text"in D||"references"in D)?{text:D.text||"",references:D.references||[],activeTab:D.activeTab||"note",isMinimal:D.isMinimal||!1,style:{...od,...D.style||{}}}:{text:e.value||"",references:[],activeTab:"note",isMinimal:!1,style:od}}catch{return{text:e.value||"",references:[],activeTab:"note",isMinimal:!1,style:od}}},[e.value]),[k,b]=v.useState(null),y=v.useCallback(D=>{const O={...w,...D};t(e.id,JSON.stringify(O))},[w,e.id,t]),g=v.useCallback(D=>{const O={...w.style,...D};y({style:O})},[w.style,y]);v.useEffect(()=>{if(h){const O=u(e.id,"prompt_data")[0];if(typeof O=="string")try{const B=JSON.parse(O);if(B.type==="sequence-prompt-data"&&Array.isArray(B.sourcePrompts)){const E=B.sourcePrompts,I=[...w.references],N=[];let T=!1;const F=E.reduce((G,U)=>Math.max(G,U.frameNumber||0),0),z=new Map(E.map(G=>[G.frameNumber,G.prompt]));for(let G=0;G<F;G++){const U=G+1,R=z.get(U)||"",q=I[G];q?q.caption!==R?(N.push({...q,caption:R}),T=!0):N.push(q):(N.push({id:`ref-${Date.now()}-${G}`,image:null,caption:R}),T=!0)}I.length>F&&(T=!0),T&&y({references:N})}}catch(B){console.error("Failed to parse prompt data from sequence editor",B)}}},[h,u,e.id,y,w.references]);const m=()=>{p(D=>D.filter(O=>!(O.toNodeId===e.id&&O.toHandleId==="prompt_data"))),s&&s(o("toast.connectionsCut"))},x=async(D,O)=>{if(h)return;const B=async z=>typeof z=="string"?z:new Promise(G=>{const U=new FileReader;U.onload=R=>{var q;return G((q=R.target)==null?void 0:q.result)},U.readAsDataURL(z)}),E=await Promise.all(D.map(B)),I=[...w.references],N=[];for(let z=0;z<E.length;z++){const G=E[z],U=await Rt(G,256,256);N.push({id:`ref-${Date.now()}-${z}-${Math.random().toString(36).substr(2,9)}`,image:U,caption:""})}const T=O??I.length;I.splice(T,0,...N);const F=new Map;w.references.forEach((z,G)=>{const U=c(e.id,G);U?F.set(z.id,U):z.image&&F.set(z.id,z.image)}),N.forEach((z,G)=>{F.set(z.id,E[G])}),y({references:I,activeTab:"reference"}),I.forEach((z,G)=>{const U=F.get(z.id);U&&l(e.id,G,U)})},_=(D,O)=>{if(D===O||h)return;const B=[...w.references],[E]=B.splice(D,1),I=D<O?O-1:O;B.splice(I,0,E);const N=[];for(let F=0;F<w.references.length;F++)N.push(c(e.id,F)||w.references[F].image);const[T]=N.splice(D,1);N.splice(I,0,T),N.forEach((F,z)=>{l(e.id,z,F)}),y({references:B})},S=(D,O)=>{if(h)return;const B=w.references.map(E=>E.id===D?{...E,caption:O}:E);y({references:B})},P=D=>{if(h)return;const O=w.references.findIndex(E=>E.id===D);if(O===-1)return;const B=w.references.filter(E=>E.id!==D);for(let E=O;E<B.length;E++){const I=c(e.id,E+1);if(I)l(e.id,E,I);else{const N=w.references[E+1];N&&N.image&&l(e.id,E,N.image)}}y({references:B})},j=()=>{if(h)return;b([...w.references]);const D=new Map;w.references.forEach((B,E)=>{const I=c(e.id,E)||B.image;I&&D.set(B.id,I)});const O=[...w.references];for(let B=O.length-1;B>0;B--){const E=Math.floor(Math.random()*(B+1));[O[B],O[E]]=[O[E],O[B]]}y({references:O}),O.forEach((B,E)=>{const I=D.get(B.id);I&&l(e.id,E,I)})},M=()=>{if(!k||h)return;const D=new Map;w.references.forEach((O,B)=>{const E=c(e.id,B)||O.image;E&&D.set(O.id,E)}),k.forEach((O,B)=>{const E=D.get(O.id);E&&l(e.id,B,E)}),y({references:k}),b(null)};return n.jsxs("div",{className:"flex flex-col h-full",children:[!w.isMinimal&&n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-900/50 p-1 rounded-t-md mb-1 flex-shrink-0",children:[n.jsx("button",{onClick:()=>y({activeTab:"note"}),className:`flex-1 py-1 text-xs font-semibold rounded transition-colors ${w.activeTab==="note"?"bg-cyan-600 text-white":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:o("node.note.tab.note")}),n.jsxs("button",{onClick:()=>y({activeTab:"reference"}),className:`flex-1 py-1 text-xs font-semibold rounded transition-colors ${w.activeTab==="reference"?"bg-cyan-600 text-white":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:[o("node.note.tab.references"),w.references.length>0&&n.jsxs("span",{className:"ml-1 opacity-75",children:["(",w.references.length,")"]})]})]}),n.jsx("div",{className:"flex-grow min-h-0 relative",children:w.activeTab==="note"?n.jsx(lP,{text:w.text,style:w.style,onTextChange:D=>y({text:D}),onStyleChange:g,libraryItems:a,t:o,deselectAllNodes:r,isMinimal:!!w.isMinimal}):n.jsx(dP,{references:w.references,isLocked:!!h,onAddImages:x,onReorder:_,onUpdateCaption:S,onRemoveReference:P,onDetach:m,onShuffle:j,onUndoShuffle:M,canUndoShuffle:!!k,t:o,deselectAllNodes:r,setImageViewer:i,addToast:s,getFullSizeImage:D=>c(e.id,D),setFullSizeImage:(D,O)=>l(e.id,D,O),isMinimal:!!w.isMinimal})})]})},pP=()=>null,Wg={en:{subjects:["a majestic lion","a futuristic robot","a wise old wizard","a curious alien","a brave knight","a mythical dragon","a cyberpunk detective","a goddess of nature","a talking squirrel","an ancient golem","a pirate captain","a stealthy ninja","a lonely astronaut","a phantom queen","a clockwork beast"],objects:["a glowing crystal","an enchanted sword","a rusty key","a mysterious book","a floating lantern","a time-traveling watch","a powerful artifact","a forgotten map","a steampunk airship","a magical potion","a shard of a fallen star","the crown of a forgotten king"],actions:["exploring a hidden cave","casting a powerful spell","flying through the clouds","solving a complex puzzle","standing on a cliff edge","sailing across a stormy sea","building a futuristic city","meditating in a peaceful forest","leading an army into battle","discovering a lost secret","dancing in the moonlight"],environments:["in a neon-lit cyberpunk city","in an enchanted forest at night","on a volcanic planet","in a lost underwater city","in a grand, gothic castle","in a tranquil zen garden","on a floating island in the sky","in a post-apocalyptic wasteland","inside a massive spaceship","at the edge of a black hole","in a victorian-era library"]},ru:{subjects:[" "," ","  "," "," "," ","-"," "," "," "," "," "," ","-"," "],objects:[" "," "," "," "," ","    "," "," ","-"," ","  ","  "],actions:["  ","  ","  ","  ","   ","   ","  ","   ","   ","  ","   "],environments:["  -","   ","  ","   ","   ","  -","    ","  ","   ","   ","   "]},uz:{subjects:["ulugvor sher","futuristik robot","dono keksa sehrgar","qiziquvchan ozga sayyoralik","jasur ritsar","afsonaviy ajdaho","kiberpank detektiv","tabiat mabudasi","gapiruvchi sincap","qadimiy golem","qaroqchi kapitan","yashirin ninja","yolgiz astronavt","fantom malika","mexanik yirtqich"],objects:["porlayotgan kristall","sehrlangan qilich","zanglagan kalit","sirli kitob","uchuvchi chiroq","vaqt sayohati soati","qudratli artefakt","unutilgan xarita","stimpank havo kemasi","sehrli damlama","qulagan yulduz parchasi","unutilgan qirol toji"],actions:["yashirin gorni organmoqda","kuchli sehr oqimoqda","bulutlar orasidan uchmoqda","murakkab jumboqni yechmoqda","jarlik chetida turibdi","boronli dengizda suzmoqda","futuristik shahar qurmoqda","tinch ormonda meditatsiya qilmoqda","armiyani jangga boshlamoqda","yoqolgan sirni ochmoqda","oy nuri ostida raqsga tushmoqda"],environments:["neon chiroqli kiberpank shaharda","tunda sehrlangan ormonda","vulqonli sayyorada","yoqolgan suv osti shahrida","hashamatli gotik qasrda","tinch dzen bogida","osmondagi uchuvchi orolda","post-apokaliptik cholda","ulkan kosmik kema ichida","qora tuynuk chetida","viktoriya davri kutubxonasida"]},es:{subjects:["un len majestuoso","un robot futurista","un viejo mago sabio","un aliengena curioso","un caballero valiente","un dragn mtico","un detective cyberpunk","una diosa de la naturaleza","una ardilla parlante","un glem antiguo","un capitn pirata","un ninja sigiloso","un astronauta solitario","una reina fantasma","una bestia de relojera"],objects:["un cristal brillante","una espada encantada","una llave oxidada","un libro misterioso","una linterna flotante","un reloj para viajar en el tiempo","un artefacto poderoso","un mapa olvidado","una aeronave steampunk","una pocin mgica","un fragmento de estrella cada","la corona de un rey olvidado"],actions:["explorando una cueva oculta","lanzando un hechizo poderoso","volando a travs de las nubes","resolviendo un rompecabezas complejo","de pie en el borde de un acantilado","navegando por un mar tormentoso","construyendo una ciudad futurista","meditando en un bosque tranquilo","liderando un ejrcito a la batalla","descubriendo un secreto perdido","bailando a la luz de la luna"],environments:["en una ciudad cyberpunk iluminada por nen","en un bosque encantado de noche","en un planeta volcnico","en una ciudad submarina perdida","en un gran castillo gtico","en un tranquilo jardn zen","en una isla flotante en el cielo","en un pramo post-apocalptico","dentro de una nave espacial masiva","en el borde de un agujero negro","en una biblioteca de la era victoriana"]},fr:{subjects:["un lion majestueux","un robot futuriste","un vieux sorcier sage","un extraterrestre curieux","un chevalier courageux","un dragon mythique","un dtective cyberpunk","une desse de la nature","un cureuil parlant","un golem ancien","un capitaine pirate","un ninja furtif","un astronaute solitaire","une reine fantme","une bte mcanique"],objects:["un cristal brillant","une pe enchante","une cl rouille","un livre mystrieux","une lanterne flottante","une montre de voyage dans le temps","un artefact puissant","une carte oublie","un dirigeable steampunk","une potion magique","un clat d'toile tombe","la couronne d'un roi oubli"],actions:["explore une grotte cache","lance un sort puissant","vole  travers les nuages","rsout un puzzle complexe","se tient au bord d'une falaise","navigue sur une mer dchane","construit une ville futuriste","mdite dans une fort paisible","mne une arme au combat","dcouvre un secret perdu","danse au clair de lune"],environments:["dans une ville cyberpunk claire au non","dans une fort enchante la nuit","sur une plante volcanique","dans une cit sous-marine perdue","dans un grand chteau gothique","dans un jardin zen tranquille","sur une le flottante dans le ciel","dans un dsert post-apocalyptique"," l'intrieur d'un immense vaisseau spatial","au bord d'un trou noir","dans une bibliothque de l'poque victorienne"]},de:{subjects:["ein majesttischer Lwe","ein futuristischer Roboter","ein weiser alter Zauberer","ein neugieriges Alien","ein tapferer Ritter","ein mythischer Drache","ein Cyberpunk-Detektiv","eine Gttin der Natur","ein sprechendes Eichhrnchen","ein alter Golem","ein Piratenkapitn","ein heimlicher Ninja","ein einsamer Astronaut","eine Phantomknigin","ein Uhrwerk-Biest"],objects:["ein leuchtender Kristall","ein verzaubertes Schwert","ein rostiger Schlssel","ein geheimnisvolles Buch","eine schwebende Laterne","eine Zeitreiseuhr","ein mchtiges Artefakt","eine vergessene Karte","ein Steampunk-Luftschiff","ein Zaubertrank","ein Splitter eines gefallenen Sterns","die Krone eines vergessenen Knigs"],actions:["erkundet eine versteckte Hhle","wirkt einen mchtigen Zauber","fliegt durch die Wolken","lst ein komplexes Rtsel","steht am Rand einer Klippe","segelt ber ein strmisches Meer","baut eine futuristische Stadt","meditiert in einem friedlichen Wald","fhrt eine Armee in die Schlacht","entdeckt ein verlorenes Geheimnis","tanzt im Mondlicht"],environments:["in einer neonbeleuchteten Cyberpunk-Stadt","in einem verzauberten Wald bei Nacht","auf einem vulkanischen Planeten","in einer verlorenen Unterwasserstadt","in einem groen gotischen Schloss","in einem ruhigen Zen-Garten","auf einer schwebenden Insel im Himmel","in einem postapokalyptischen dland","in einem riesigen Raumschiff","am Rande eines schwarzen Lochs","in einer Bibliothek der viktorianischen ra"]},it:{subjects:["un leone maestoso","un robot futuristico","un vecchio mago saggio","un alieno curioso","un cavaliere coraggioso","un drago mitico","un detective cyberpunk","una dea della natura","uno scoiattolo parlante","un antico golem","un capitano pirata","un ninja furtivo","un astronauta solitario","una regina fantasma","una bestia a orologeria"],objects:["un cristallo luminoso","una spada incantata","una chiave arrugginita","un libro misterioso","una lanterna fluttuante","un orologio per viaggiare nel tempo","un artefatto potente","una mappa dimenticata","un dirigibile steampunk","una pozione magica","una scheggia di una stella caduta","la corona di un re dimenticato"],actions:["esplora una grotta nascosta","lancia un potente incantesimo","vola attraverso le nuvole","risolve un enigma complesso","sta sul bordo di una scogliera","naviga attraverso un mare in tempesta","costruisce una citt futuristica","medita in una foresta tranquilla","guida un esercito in battaglia","scopre un segreto perduto","balla al chiaro di luna"],environments:["in una citt cyberpunk illuminata al neon","in una foresta incantata di notte","su un pianeta vulcanico","in una citt sottomarina perduta","in un grande castello gotico","in un tranquillo giardino zen","su un'isola fluttuante nel cielo","in una terra desolata post-apocalittica","all'interno di un'enorme astronave","ai margini di un buco nero","in una biblioteca di epoca vittoriana"]},pt:{subjects:["um leo majestoso","um rob futurista","um velho mago sbio","um aliengena curioso","um cavaleiro corajoso","um drago mtico","um detetive cyberpunk","uma deusa da natureza","um esquilo falante","um golem antigo","um capito pirata","um ninja furtivo","um astronauta solitrio","uma rainha fantasma","uma besta mecnica"],objects:["um cristal brilhante","uma espada encantada","uma chave enferrujada","um livro misterioso","uma lanterna flutuante","um relgio de viagem no tempo","um artefato poderoso","um mapa esquecido","um dirigvel steampunk","uma poo mgica","um fragmento de uma estrela cada","a coroa de um rei esquecido"],actions:["explorando uma caverna escondida","lanando um feitio poderoso","voando atravs das nuvens","resolvendo um quebra-cabea complexo","de p na beira de um penhasco","navegando por um mar tempestuoso","construindo uma cidade futurista","meditando em uma floresta pacfica","liderando um exrcito para a batalha","descobrindo um segredo perdido","danando ao luar"],environments:["em uma cidade cyberpunk iluminada por neon","em uma floresta encantada  noite","em um planeta vulcnico","em uma cidade subaqutica perdida","em um grande castelo gtico","em um jardim zen tranquilo","em uma ilha flutuante no cu","em um terreno baldio ps-apocalptico","dentro de uma enorme nave espacial","na borda de um buraco negro","em uma biblioteca da era vitoriana"]},zh:{subjects:["","","","","","","","","","","","","","",""],objects:["","","","","","","","","","","",""],actions:["","","","","","","","","","",""],environments:["","","","","","","","","","",""]},ja:{subjects:["","","","","","","","","","","","","","",""],objects:["","","","","","","","","","","",""],actions:["","","","","","","","","","",""],environments:["","","","","","","","","","",""]},ko:{subjects:["  "," ","  ","  "," ","  "," "," "," "," "," "," "," "," "," "],objects:[" ","  "," "," "," ","  "," "," "," "," ","  ","  "],actions:["   ","   ","   ","   ","   ","    ","   ","   ","   ","   ","    "],environments:["    ","  "," ","  ","  ","  ","   ","  ","  "," ","  "]}},ny=e=>{const t=Wg[e]||Wg.en,o=Object.keys(t),r=o[Math.floor(Math.random()*o.length)],a=t[r];return a[Math.floor(Math.random()*a.length)]},Fn=({children:e,content:t,isActive:o,position:r="top",pulseColor:a="rgba(34, 211, 238, 0.8)",className:i="",onSkip:s,onNext:l,isFinishStep:c=!1})=>{const{t:d}=St();if(!o)return n.jsx(n.Fragment,{children:e});const u={top:"bottom-full left-1/2 -translate-x-1/2 mb-3",bottom:"top-full left-1/2 -translate-x-1/2 mt-3",left:"right-full top-1/2 -translate-y-1/2 mr-3",right:"left-full top-1/2 -translate-y-1/2 ml-3"},p={top:"top-full left-1/2 -translate-x-1/2 border-t-cyan-900",bottom:"bottom-full left-1/2 -translate-x-1/2 border-b-cyan-900",left:"left-full top-1/2 -translate-y-1/2 border-l-cyan-900",right:"right-full top-1/2 -translate-y-1/2 border-r-cyan-900"};return n.jsxs("div",{className:`relative inline-flex ${i}`,style:{zIndex:1e3},children:[n.jsx("div",{className:"absolute inset-0 rounded-md pointer-events-none tutorial-ring",style:{boxShadow:`0 0 0 0 ${a}`}}),e,n.jsx("div",{className:`absolute ${u[r]} z-[1001] w-max max-w-[250px] pointer-events-auto`,children:n.jsxs("div",{className:"bg-cyan-900 border border-cyan-500 text-white text-xs font-bold px-3 py-2 rounded-lg shadow-2xl relative animate-bounce-gentle",children:[n.jsx("div",{className:"mb-2",children:t}),n.jsxs("div",{className:"flex justify-end border-t border-cyan-700/50 pt-1 mt-1 gap-2",children:[l&&n.jsx("button",{onClick:h=>{h.stopPropagation(),l()},className:"text-[10px] text-cyan-300 hover:text-white underline decoration-cyan-500/50 hover:decoration-white transition-all",children:d("tutorial.next")}),s&&n.jsx("button",{onClick:h=>{h.stopPropagation(),s()},className:"text-[10px] text-gray-400 hover:text-white underline decoration-gray-500/50 hover:decoration-white transition-all",children:d(c?"tutorial.finish":"tutorial.skip")})]}),n.jsx("div",{className:`absolute border-4 border-transparent ${p[r]}`})]})})]})},hP=({node:e,onValueChange:t,libraryItems:o,t:r,onSelectNode:a})=>{const{language:i}=St(),s=Ut(),{tutorialStep:l,tutorialTargetId:c,advanceTutorial:d,skipTutorial:u}=s||{},p=c===e.id&&(l==="text_input_0"||l==="text_input_1"||l==="text_input_2"),h=()=>{const w=ny(i),k=e.value?`${e.value}, ${w}`:w;t(e.id,k),p&&d&&d()};return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex items-center mb-1 flex-shrink-0 space-x-2",children:[n.jsx("div",{className:"flex-grow",children:n.jsx(Fp,{libraryItems:o,onPromptInsert:w=>{const k=e.value?`${e.value}, ${w}`:w;t(e.id,k)}})}),n.jsx(Fn,{content:r("tutorial.step1"),isActive:!!p,position:"left",onSkip:u,children:n.jsx(Pe,{title:r("node.action.randomWord"),onClick:h,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})})})]}),n.jsx("div",{className:"flex-grow min-h-0",children:n.jsx(Tn,{value:e.value,onDebouncedChange:w=>t(e.id,w),placeholder:r("node.content.notePlaceholder"),className:"w-full h-full p-2 bg-input border border-transparent rounded-md resize-none focus:border-accent focus:outline-none",onWheel:w=>w.stopPropagation(),onMouseDown:w=>{w.stopPropagation(),a()}})})]})};let mP=500;const El=()=>++mP,gP=({onClose:e,onPointerDown:t,onPointerMove:o,onPointerUp:r})=>{const{t:a}=St();return n.jsxs("div",{onPointerDown:t,onPointerMove:o,onPointerUp:r,className:"p-3 border-b border-gray-700 flex justify-between items-center cursor-move bg-gray-900 select-none",children:[n.jsxs("h2",{className:"text-lg font-bold text-cyan-400 flex items-center gap-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),a("imageEditor.title")]}),n.jsx("button",{onClick:e,className:"p-1 text-gray-400 rounded-full hover:bg-gray-600 hover:text-white transition-colors",onPointerDown:i=>i.stopPropagation(),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})},Rn=({options:e,value:t,onChange:o,disabled:r,id:a,title:i})=>{const[s,l]=v.useState(!1),[c,d]=v.useState(-1),u=v.useRef(null),p=v.useRef([]),h=e.find(y=>y.value===t),w=(h==null?void 0:h.label)||t;v.useEffect(()=>{const y=g=>{u.current&&!u.current.contains(g.target)&&l(!1)};return document.addEventListener("mousedown",y,!0),()=>document.removeEventListener("mousedown",y,!0)},[]),v.useEffect(()=>{if(s){const y=e.findIndex(g=>g.value===t);d(y>-1?y:0),setTimeout(()=>{var g;return(g=p.current[y>-1?y:0])==null?void 0:g.focus()},0)}},[s,e,t]);const k=y=>{var g,m;switch(y.key){case"ArrowDown":if(y.preventDefault(),!s)l(!0);else{const x=Math.min(c+1,e.length-1);d(x),(g=p.current[x])==null||g.focus()}break;case"ArrowUp":if(y.preventDefault(),s){const x=Math.max(c-1,0);d(x),(m=p.current[x])==null||m.focus()}break;case"Enter":case" ":y.preventDefault(),s&&c!==-1?(o(e[c].value),l(!1)):l(!s);break;case"Escape":l(!1);break;case"Tab":l(!1);break}},b=y=>{o(y),l(!1)};return n.jsxs("div",{ref:u,className:"relative w-full",title:i,children:[n.jsxs("button",{id:a,disabled:r,onClick:()=>l(!s),onKeyDown:k,type:"button","aria-haspopup":"listbox","aria-expanded":s,className:"w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed flex justify-between items-center text-left group",children:[n.jsxs("span",{className:"truncate flex items-center gap-2",children:[(h==null?void 0:h.icon)&&n.jsx("span",{className:"text-gray-400",children:h.icon}),w]}),n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 transition-transform duration-200 flex-shrink-0 ml-1 ${s?"transform rotate-180":""}`,viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),s&&n.jsx("ul",{role:"listbox",className:"absolute z-10 w-full mt-1 bg-gray-700 border border-gray-600 rounded-md shadow-lg focus:outline-none",children:e.map((y,g)=>n.jsxs("li",{ref:m=>{p.current[g]=m},tabIndex:-1,role:"option","aria-selected":t===y.value,onClick:()=>b(y.value),onKeyDown:k,className:`p-2 text-sm cursor-pointer select-none transition-colors flex items-center gap-2 group ${c===g?"bg-cyan-600 text-white":"text-gray-200 hover:bg-gray-600"} ${t===y.value?"font-semibold":""}`,children:[y.icon&&n.jsx("span",{className:`${c===g?"text-white":"text-gray-400 group-hover:text-gray-200"}`,children:y.icon}),n.jsx("span",{children:y.label})]},y.value))})]})},Mo=({title:e,onClick:t,active:o,icon:r,tooltipPosition:a="right"})=>n.jsxs("div",{className:"relative group flex items-center justify-center",children:[n.jsx("button",{onClick:t,className:`w-10 h-10 rounded-md flex items-center justify-center border transition-all ${o?"bg-cyan-600/20 border-cyan-500 text-cyan-400 shadow-[0_0_10px_rgba(34,211,238,0.2)]":"bg-gray-700 border-gray-600 text-gray-400 hover:bg-gray-600 hover:text-gray-200"}`,children:r}),n.jsx("div",{className:`absolute ${a==="right"?"left-full top-1/2 -translate-y-1/2 ml-2":"top-full left-1/2 -translate-x-1/2 mt-2"} px-3 py-1.5 bg-slate-700 text-slate-200 text-xs whitespace-nowrap rounded-md shadow-xl opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50`,children:e})]}),$g=({title:e,onClick:t,disabled:o,children:r,className:a})=>n.jsxs("div",{className:"relative group flex-1 flex",children:[n.jsx("button",{onClick:t,disabled:o,className:`w-full px-2 py-1.5 text-xs font-semibold rounded transition-colors flex items-center justify-center gap-2 ${a}`,children:r}),n.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-xs whitespace-normal text-center w-40 rounded-md shadow-xl opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 break-words",children:e})]}),fP=({resolution:e,setResolution:t,aspectRatio:o,setAspectRatio:r,backgroundType:a,setBackgroundType:i,activeTool:s,isSnappingEnabled:l,setIsSnappingEnabled:c,isFreeAspect:d,setIsFreeAspect:u,brushSize:p,setBrushSize:h,modificationPrompt:w,setModificationPrompt:k,isProcessing:b,handleRequestModification:y,handleRemoveObject:g,handleRemoveBackground:m,canvasSize:x})=>{const{t:_}=St(),S=v.useMemo(()=>[{value:"auto",label:"Auto (Fit Image)",type:"auto"},{value:"1920x1080",label:"1920x1080",type:"landscape"},{value:"1080x1920",label:"1080x1920",type:"portrait"},{value:"512x512",label:"512x512",type:"square"},{value:"1024x1024",label:"1024x1024",type:"square"},{value:"2048x2048",label:"2048x2048",type:"square"},{value:"4096x4096",label:"4096x4096",type:"square"}].map(M=>{let D;switch(M.type){case"landscape":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"2",y:"7",width:"20",height:"10",rx:"1"})});break;case"portrait":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"7",y:"2",width:"10",height:"20",rx:"1"})});break;case"square":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"1"})});break;case"auto":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})});break}return{value:M.value,label:M.label,icon:D}}),[]),P=v.useMemo(()=>[{value:"free",label:"Free",type:"free"},{value:"16:9",label:"16:9",type:"landscape"},{value:"9:16",label:"9:16",type:"portrait"},{value:"4:3",label:"4:3",type:"landscape_slight"},{value:"3:4",label:"3:4",type:"portrait_slight"},{value:"1:1",label:"1:1",type:"square"}].map(M=>{let D;switch(M.type){case"free":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})});break;case"landscape":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"2",y:"8",width:"20",height:"8",rx:"1"})});break;case"portrait":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"8",y:"2",width:"10",height:"20",rx:"1"})});break;case"landscape_slight":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"3",y:"6",width:"18",height:"12",rx:"1"})});break;case"portrait_slight":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"6",y:"3",width:"12",height:"18",rx:"1"})});break;case"square":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"5",y:"5",width:"14",height:"14",rx:"1"})});break}return{value:M.value,label:M.label,icon:D}}),[]);return n.jsxs("div",{className:"w-64 p-4 border-r border-gray-700 flex-shrink-0 flex flex-col bg-gray-800 overflow-y-auto overflow-x-hidden custom-scrollbar select-none",onWheel:j=>j.stopPropagation(),children:[n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wider",children:_("imageEditor.canvasResolution")}),n.jsx(Rn,{value:e,onChange:t,options:S}),n.jsxs("p",{className:"text-[10px] text-gray-500 mt-1 text-right",children:[x.width," x ",x.height," px"]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wider",children:_("node.content.aspectRatio")}),n.jsx(Rn,{value:o,onChange:r,options:P,disabled:e!=="auto"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wider",children:_("imageEditor.background")}),n.jsxs("div",{className:"flex space-x-2 bg-gray-900/50 p-2 rounded-md border border-gray-600 justify-between items-center",children:[n.jsx("button",{onClick:()=>i("checkerboard"),className:`w-6 h-6 rounded border border-gray-500 focus:outline-none transition-transform hover:scale-110 overflow-hidden ${a==="checkerboard"?"ring-2 ring-cyan-500 scale-110":""}`,title:"Checkerboard (Transparent)",children:n.jsx("div",{className:"w-full h-full bg-[url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAIklEQVQYV2NkYGD4z8DAwMgwMoyCQAwMDAwMjAyDQAwM4wA+2wz/m6j50AAAAABJRU5ErkJggg==')]"})}),["#ffffff","#808080","#000000","#1f2937"].map(j=>n.jsx("button",{onClick:()=>i(j),className:`w-6 h-6 rounded-full border border-gray-500 focus:outline-none transition-transform hover:scale-110 ${a===j?"ring-2 ring-cyan-500 scale-110":""}`,style:{backgroundColor:j}},j)),n.jsx("input",{type:"color",value:a!=="checkerboard"?a:"#ffffff",onChange:j=>i(j.target.value),className:"w-6 h-6 p-0 rounded-full border-none overflow-hidden cursor-pointer"})]})]})]}),s==="transform"&&n.jsxs("div",{className:"mt-4 space-y-2",children:[n.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2",children:_("imageEditor.toolSettings")}),n.jsxs("div",{className:"bg-gray-700/50 p-2 rounded space-y-2",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("input",{type:"checkbox",id:"snap-toggle",checked:l,onChange:j=>c(j.target.checked),className:"h-4 w-4 rounded border-gray-500 text-accent focus:ring-accent cursor-pointer"}),n.jsx("label",{htmlFor:"snap-toggle",className:"text-xs text-gray-300 cursor-pointer select-none",children:_("imageEditor.snapToEdges")})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("input",{type:"checkbox",id:"free-aspect-toggle",checked:d,onChange:j=>u(j.target.checked),className:"h-4 w-4 rounded border-gray-500 text-accent focus:ring-accent cursor-pointer"}),n.jsx("label",{htmlFor:"free-aspect-toggle",className:"text-xs text-gray-300 cursor-pointer select-none",children:_("imageEditor.freeAspect")})]})]})]}),(s==="pencil"||s==="rectangle")&&n.jsxs("div",{className:"mt-4 space-y-2",children:[n.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-2 uppercase tracking-wider",children:"Brush Settings"}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("span",{className:"text-xs text-gray-400 w-8",children:"Size"}),n.jsx("input",{type:"range",min:"1",max:"50",value:p,onChange:j=>h(Number(j.target.value)),className:"flex-grow h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-500"}),n.jsx("span",{className:"text-xs text-gray-300 w-6 text-right",children:p})]})]}),n.jsx("div",{className:"flex-grow"}),n.jsxs("div",{className:"space-y-4 mt-4 border-t border-gray-700 pt-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2",children:_("imageEditor.section.aiRequest")}),n.jsx("textarea",{value:w,onChange:j=>k(j.target.value),placeholder:_("imageEditor.input.modificationPlaceholder"),className:"w-full p-2 bg-gray-900/50 border border-gray-600 rounded-md text-xs text-white focus:ring-2 focus:ring-cyan-500 focus:outline-none resize-none select-text",rows:3}),n.jsx("button",{onClick:y,disabled:b||!w.trim(),className:"w-full px-3 py-1.5 text-xs font-bold text-white bg-cyan-600 rounded hover:bg-cyan-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors",children:b?"Processing...":_("imageEditor.action.sendRequest")})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx($g,{title:_("imageEditor.tooltip.removeObject"),onClick:g,disabled:b,className:"text-white bg-red-600 hover:bg-red-700 border border-red-500 shadow-[0_0_15px_rgba(220,38,38,0.4)] disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none",children:b?"...":_("imageEditor.action.removeObject")}),n.jsx($g,{title:"Remove background keeping main object",onClick:m,disabled:b,className:"text-white bg-teal-600 hover:bg-teal-700 border border-teal-500 shadow-[0_0_15px_rgba(13,148,136,0.4)] disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none",children:b?"...":_("imageEditor.action.removeBackground")})]})]})]})},xP=({activeTool:e,setActiveTool:t,onFit:o,onFill:r,onFlip:a})=>{const{t:i}=St();return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"absolute top-4 left-4 flex flex-col gap-2 z-20 bg-gray-900/80 backdrop-blur-sm p-1.5 rounded-lg border border-gray-700 shadow-lg",children:[n.jsx(Mo,{title:i("imageEditor.tool.transform"),onClick:()=>t("transform"),active:e==="transform",icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),n.jsx(Mo,{title:i("imageEditor.tool.hand"),onClick:()=>t("hand"),active:e==="hand",icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11"})})}),n.jsx(Mo,{title:i("imageEditor.tool.zoom"),onClick:()=>t("zoom"),active:e==="zoom",icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7"})})}),n.jsx("div",{className:"w-full h-px bg-gray-700 my-1"}),n.jsx(Mo,{title:i("imageEditor.tool.pencil"),onClick:()=>t("pencil"),active:e==="pencil",icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),n.jsx(Mo,{title:i("imageEditor.tool.rectangle"),onClick:()=>t("rectangle"),active:e==="rectangle",icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"})})}),n.jsx(Mo,{title:"Eyedropper",onClick:()=>t("eyedropper"),active:e==="eyedropper",icon:n.jsx(oP,{className:"h-5 w-5"})})]}),n.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 flex gap-2 z-20 bg-gray-900/80 backdrop-blur-sm p-1.5 rounded-lg border border-gray-700 shadow-lg",children:[n.jsx(Mo,{title:i("imageEditor.action.fit"),onClick:o,icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5M15 15l5.25 5.25"})}),tooltipPosition:"bottom"}),n.jsx(Mo,{title:i("imageEditor.action.fill"),onClick:r,icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"})}),tooltipPosition:"bottom"}),n.jsx(Mo,{title:i("node.action.flipImage"),onClick:a,icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5"})}),tooltipPosition:"bottom"})]})]})},yP=({zoom:e,onZoomChange:t,onClose:o,onReset:r,onApply:a,isProcessing:i})=>{const{t:s}=St();return n.jsxs("div",{className:"p-3 border-t border-gray-700 flex justify-between items-center bg-gray-900 gap-3 select-none",children:[n.jsx("div",{className:"flex items-center space-x-4",children:n.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-400",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),n.jsxs("span",{className:"w-12 text-right",children:[Math.round(e*100),"%"]}),n.jsx("input",{type:"range",min:"0.1",max:"4",step:"0.1",value:e,onChange:t,className:"w-32 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]})}),n.jsxs("div",{className:"flex space-x-3 items-center",children:[n.jsx("button",{onClick:o,className:"px-4 py-2 text-sm font-semibold text-gray-300 bg-gray-800 rounded-md hover:bg-gray-700 transition-colors border border-gray-600",children:s("imageEditor.action.cancel")}),n.jsx("button",{onClick:r,className:"px-4 py-2 text-sm font-semibold text-red-200 bg-red-900/30 rounded-md hover:bg-red-900/50 border border-red-900/50 transition-colors",children:s("imageEditor.action.resetEdits")}),n.jsx("button",{onClick:a,disabled:i,className:"px-6 py-2 text-sm font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 transition-colors shadow-lg shadow-cyan-900/20 disabled:opacity-50 disabled:cursor-not-allowed",children:s("imageEditor.action.apply")})]})]})},Yr=e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:0,g:0,b:0}},vP=(e,t,o)=>"#"+((1<<24)+(e<<16)+(t<<8)+o).toString(16).slice(1),rd=(e,t,o)=>{e/=255,t/=255,o/=255;const r=Math.max(e,t,o),a=Math.min(e,t,o);let i=0,s,l=r;const c=r-a;if(s=r===0?0:c/r,r===a)i=0;else{switch(r){case e:i=(t-o)/c+(t<o?6:0);break;case t:i=(o-e)/c+2;break;case o:i=(e-t)/c+4;break}i/=6}return{h:i*360,s,v:l}},wP=(e,t,o)=>{let r=0,a=0,i=0;const s=Math.floor(e*6),l=e*6-s,c=o*(1-t),d=o*(1-l*t),u=o*(1-(1-l)*t);switch(s%6){case 0:r=o,a=u,i=c;break;case 1:r=d,a=o,i=c;break;case 2:r=c,a=o,i=u;break;case 3:r=c,a=d,i=o;break;case 4:r=u,a=c,i=o;break;case 5:r=o,a=c,i=d;break}return{r:Math.round(r*255),g:Math.round(a*255),b:Math.round(i*255)}},bP=({color:e,onChange:t})=>{const[o,r]=v.useState({h:0,s:1,v:1}),[a,i]=v.useState(e),s=v.useRef(null),l=v.useRef(null),c=v.useRef(!1),d=v.useRef(!1);v.useEffect(()=>{const g=Yr(e);r(rd(g.r,g.g,g.b)),i(e)},[e]);const u=(g,m,x)=>{const _=wP(g/360,m,x),S=vP(_.r,_.g,_.b);t(S),r({h:g,s:m,v:x}),i(S)},p=v.useCallback(()=>{const g=s.current;if(!g)return;const m=g.getContext("2d");if(!m)return;const x=g.width,_=g.height;m.clearRect(0,0,x,_),m.fillStyle=`hsl(${o.h}, 100%, 50%)`,m.fillRect(0,0,x,_);const S=m.createLinearGradient(0,0,x,0);S.addColorStop(0,"rgba(255,255,255,1)"),S.addColorStop(1,"rgba(255,255,255,0)"),m.fillStyle=S,m.fillRect(0,0,x,_);const P=m.createLinearGradient(0,0,0,_);P.addColorStop(0,"rgba(0,0,0,0)"),P.addColorStop(1,"rgba(0,0,0,1)"),m.fillStyle=P,m.fillRect(0,0,x,_);const j=o.s*x,M=(1-o.v)*_;m.beginPath(),m.arc(j,M,6,0,Math.PI*2),m.strokeStyle="white",m.lineWidth=2,m.stroke(),m.beginPath(),m.arc(j,M,4,0,Math.PI*2),m.strokeStyle="black",m.lineWidth=1,m.stroke()},[o]),h=v.useCallback(()=>{const g=l.current;if(!g)return;const m=g.getContext("2d");if(!m)return;const x=g.width,_=g.height;m.clearRect(0,0,x,_);const S=m.createLinearGradient(0,0,x,0);S.addColorStop(0,"#ff0000"),S.addColorStop(1/6,"#ffff00"),S.addColorStop(2/6,"#00ff00"),S.addColorStop(3/6,"#00ffff"),S.addColorStop(4/6,"#000000"),S.addColorStop(4/6,"#0000ff"),S.addColorStop(5/6,"#ff00ff"),S.addColorStop(1,"#ff0000"),m.fillStyle=S,m.fillRect(0,0,x,_);const P=o.h/360*x;m.fillStyle="white",m.fillRect(P-2,0,4,_),m.strokeStyle="black",m.lineWidth=1,m.strokeRect(P-2,0,4,_)},[o.h]);v.useEffect(()=>{p()},[p]),v.useEffect(()=>{h()},[h]);const w=g=>{const m=s.current;if(!m)return;const x=m.getBoundingClientRect(),_=Math.max(0,Math.min(x.width,g.clientX-x.left)),S=Math.max(0,Math.min(x.height,g.clientY-x.top)),P=_/x.width,j=1-S/x.height;u(o.h,P,j)},k=g=>{const m=l.current;if(!m)return;const x=m.getBoundingClientRect(),S=Math.max(0,Math.min(x.width,g.clientX-x.left))/x.width*360;u(S,o.s,o.v)};v.useEffect(()=>{const g=j=>{c.current&&w(j),d.current&&k(j)},m=()=>{c.current=!1,d.current=!1,window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",m)},x=j=>{c.current=!0,w(j),window.addEventListener("mousemove",g),window.addEventListener("mouseup",m)},_=j=>{d.current=!0,k(j),window.addEventListener("mousemove",g),window.addEventListener("mouseup",m)},S=s.current,P=l.current;return S&&(S.onmousedown=x),P&&(P.onmousedown=_),()=>{S&&(S.onmousedown=null),P&&(P.onmousedown=null)}},[o]);const b=g=>{const m=g.target.value;if(i(m),/^#[0-9A-F]{6}$/i.test(m)){t(m);const x=Yr(m);r(rd(x.r,x.g,x.b))}},y=["#ef4444","#f97316","#f59e0b","#84cc16","#10b981","#06b6d4","#3b82f6","#8b5cf6","#d946ef","#f43f5e","#ffffff","#000000"];return n.jsxs("div",{className:"flex flex-col gap-3 p-2 bg-gray-800 rounded border border-gray-700 w-full",children:[n.jsx("canvas",{ref:s,width:200,height:150,className:"w-full h-[150px] rounded cursor-crosshair shadow-inner"}),n.jsx("canvas",{ref:l,width:200,height:20,className:"w-full h-[20px] rounded cursor-ew-resize shadow-inner"}),n.jsxs("div",{className:"flex gap-2 items-center",children:[n.jsx("div",{className:"w-8 h-8 rounded border border-gray-500 shadow-sm flex-shrink-0",style:{backgroundColor:e}}),n.jsxs("div",{className:"flex-grow flex items-center bg-gray-900 rounded border border-gray-600 px-2 py-1",children:[n.jsx("span",{className:"text-gray-500 text-xs mr-1",children:"#"}),n.jsx("input",{type:"text",value:a.replace("#",""),onChange:b,className:"bg-transparent text-xs text-white outline-none w-full uppercase font-mono",maxLength:6})]})]}),n.jsx("div",{className:"flex flex-wrap gap-1.5 justify-between",children:y.map(g=>n.jsx("button",{onClick:()=>{t(g),i(g);const m=Yr(g);r(rd(m.r,m.g,m.b))},className:`w-5 h-5 rounded-full border border-gray-600 transition-transform hover:scale-110 ${e===g?"ring-2 ring-white":""}`,style:{backgroundColor:g}},g))}),n.jsx("div",{className:"flex text-[10px] text-gray-500 justify-between px-1",children:n.jsxs("span",{children:["R:",Yr(e).r," G:",Yr(e).g," B:",Yr(e).b]})})]})},CP=({color:e,onChange:t})=>{const{t:o}=St();return n.jsxs("div",{className:"w-64 bg-gray-900 border-l border-gray-700 flex flex-col flex-shrink-0 p-4 overflow-y-auto select-none",children:[n.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3",children:"Palette & Color"}),n.jsx(bP,{color:e,onChange:t}),n.jsxs("div",{className:"mt-4 p-3 bg-gray-800/50 rounded-lg border border-gray-700 text-xs text-gray-400",children:[n.jsx("p",{className:"mb-2 font-semibold text-gray-300",children:"Tips:"}),n.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[n.jsxs("li",{children:["Use the ",n.jsx("strong",{children:"Eyedropper"})," tool to pick colors from the image."]}),n.jsxs("li",{children:["Hold ",n.jsx("strong",{children:"Alt"})," while drawing to pick color temporarily."]})]})]})]})},ad="imageEditorModalPosition",Kg="imageEditorModalSize",ec=({isOpen:e,onClose:t,onApply:o,imageSrc:r})=>{const{t:a}=St(),i=v.useRef(null),s=v.useRef(null),l=v.useRef(null),c=v.useRef(null),d=v.useRef(!0),[u,p]=v.useState(El()),[h,w]=v.useState(!1),[k,b]=v.useState({zoom:1,offset:{x:0,y:0}}),[y,g]=v.useState(!1),[m,x]=v.useState({x:0,y:0,width:0,height:0}),[_,S]=v.useState(!1),[P,j]=v.useState("free"),[M,D]=v.useState("auto"),[O,B]=v.useState({width:0,height:0}),[E,I]=v.useState("checkerboard"),[N,T]=v.useState(!0),[F,z]=v.useState(!1),[G,U]=v.useState(!1),[R,q]=v.useState(""),[H,ne]=v.useState("transform"),[X,re]=v.useState("#ff0000"),[de,ge]=v.useState(5),[te,le]=v.useState(!1),[ee,se]=v.useState("none"),ie=v.useRef(null),oe=v.useRef(null),A=v.useRef(null),K=v.useRef(null),[Z,W]=v.useState(()=>{try{const Oe=localStorage.getItem(ad);if(Oe)return JSON.parse(Oe)}catch{}return{x:0,y:0}}),[Q,ce]=v.useState(()=>{try{const Oe=localStorage.getItem(Kg);if(Oe)return JSON.parse(Oe)}catch{}return{width:"90vw",height:"90vh"}}),fe=v.useRef(null),$=v.useRef(Z);v.useEffect(()=>{$.current=Z},[Z]);const V=()=>{p(El())},J=Oe=>{Oe.target.closest("button")||(V(),Oe.preventDefault(),Oe.stopPropagation(),!h&&(Oe.currentTarget.setPointerCapture(Oe.pointerId),fe.current={offset:{x:Oe.clientX-Z.x,y:Oe.clientY-Z.y}}))},Y=Oe=>{fe.current&&W({x:Oe.clientX-fe.current.offset.x,y:Oe.clientY-fe.current.offset.y})},ae=Oe=>{fe.current=null,Oe.currentTarget.releasePointerCapture(Oe.pointerId),localStorage.setItem(ad,JSON.stringify($.current))},ue=()=>{if(c.current&&!h){const Oe=c.current.getBoundingClientRect(),Ae={width:Oe.width,height:Oe.height};ce(Ae),localStorage.setItem(Kg,JSON.stringify(Ae))}};v.useEffect(()=>{e?(d.current=!0,S(!1),V(),requestAnimationFrame(()=>g(!0))):g(!1)},[e]),v.useEffect(()=>{H==="rectangle"&&ge(1)},[H]),v.useEffect(()=>{if(e&&r){const Oe=new Image;Oe.crossOrigin="anonymous",Oe.onload=()=>{l.current=Oe;const Ae=document.createElement("canvas");Ae.width=Oe.width,Ae.height=Oe.height,s.current=Ae,x({x:0,y:0,width:Oe.width,height:Oe.height}),localStorage.getItem(ad)||(W({x:(window.innerWidth-1200)/2,y:(window.innerHeight-800)/2}),ce({width:1200,height:800}))},Oe.src=r}else l.current=null,s.current=null},[e,r]),v.useEffect(()=>{let Oe=1024,Ae=1024;if(M!=="auto"){const Ue=M.split("x").map(Number);Ue.length===2&&(Oe=Ue[0],Ae=Ue[1])}else if(l.current){const Ue=l.current;if(P!=="free"){const[ke,Ne]=P.split(":").map(Number);if(ke&&Ne){const He=ke/Ne;Ue.width/Ue.height>He?(Oe=Ue.width,Ae=Ue.width/He):(Ae=Ue.height,Oe=Ue.height*He)}else Oe=Ue.width,Ae=Ue.height}else Oe=Ue.width,Ae=Ue.height}if(Oe=Math.round(Oe),Ae=Math.round(Ae),B({width:Oe,height:Ae}),e){if(d.current)b(Ue=>({...Ue,zoom:.4,offset:{x:0,y:0}})),d.current=!1;else if(l.current){const Ue=l.current.width,ke=l.current.height,Ne=Math.min(Oe/Ue,Ae/ke);x({x:0,y:0,width:Ue*Ne,height:ke*Ne})}}},[P,M,e,l.current]);const he=(Oe,Ae)=>{const Ue=i.current;if(!Ue)return{x:0,y:0};const ke=Ue.getBoundingClientRect(),Ne=Oe-ke.left,He=Ae-ke.top,Fe=ke.width/2,$e=ke.height/2,Ye=(Ne-Fe-k.offset.x)/k.zoom,st=(He-$e-k.offset.y)/k.zoom;return{x:Ye,y:st}},ye=Oe=>{const Ae=he(Oe.clientX,Oe.clientY),Ue=Ae.x-m.x,ke=Ae.y-m.y,Ne=l.current;if(!Ne)return{x:0,y:0};const He=Ue+m.width/2,Fe=ke+m.height/2,$e=m.width/Ne.width,Ye=m.height/Ne.height;return{x:He/$e,y:Fe/Ye}},ve=Oe=>{const Ae=i.current;if(!Ae)return;const Ue=Ae.getBoundingClientRect(),ke=Oe.clientX-Ue.left,Ne=Oe.clientY-Ue.top,He=Ae.getContext("2d");if(!He)return;const Fe=Ae.width/Ue.width,$e=Ae.height/Ue.height,Ye=Math.floor(ke*Fe),st=Math.floor(Ne*$e),ht=He.getImageData(Ye,st,1,1).data,ft="#"+((1<<24)+(ht[0]<<16)+(ht[1]<<8)+ht[2]).toString(16).slice(1);re(ft)},me=Oe=>{const Ae=document.createElement("canvas");Ae.width=20,Ae.height=20;const Ue=Ae.getContext("2d");return Ue&&(Ue.fillStyle="#ccc",Ue.fillRect(0,0,10,10),Ue.fillRect(10,10,10,10),Ue.fillStyle="#fff",Ue.fillRect(10,0,10,10),Ue.fillRect(0,10,10,10)),Oe.createPattern(Ae,"repeat")},_e=v.useCallback(()=>{var $e;const Oe=i.current;if(!Oe)return;const Ae=($e=Oe.parentElement)==null?void 0:$e.getBoundingClientRect();Ae&&(Oe.width!==Ae.width||Oe.height!==Ae.height)&&(Oe.width=Ae.width,Oe.height=Ae.height);const Ue=Oe.getContext("2d",{willReadFrequently:!0});if(!Ue)return;Ue.fillStyle="#374151",Ue.fillRect(0,0,Oe.width,Oe.height),Ue.save();const ke=Oe.width/2,Ne=Oe.height/2;Ue.translate(ke+k.offset.x,Ne+k.offset.y),Ue.scale(k.zoom,k.zoom);const He=O.width,Fe=O.height;if(Ue.shadowColor="rgba(0, 0, 0, 0.5)",Ue.shadowBlur=30,Ue.shadowOffsetX=0,Ue.shadowOffsetY=10,Ue.fillStyle="#000",Ue.fillRect(-He/2,-Fe/2,He,Fe),Ue.shadowColor="transparent",E==="checkerboard"){const Ye=me(Ue);Ye?Ue.fillStyle=Ye:Ue.fillStyle="#fff"}else Ue.fillStyle=E;if(Ue.fillRect(-He/2,-Fe/2,He,Fe),Ue.beginPath(),Ue.rect(-He/2,-Fe/2,He,Fe),Ue.clip(),l.current){const Ye=l.current;Ue.save(),Ue.translate(m.x,m.y);const st=m.width,ht=m.height;if(_&&Ue.scale(-1,1),Ue.drawImage(Ye,-st/2,-ht/2,st,ht),s.current&&Ue.drawImage(s.current,-st/2,-ht/2,st,ht),te&&H==="rectangle"&&A.current&&oe.current){const ft=A.current,mt=oe.current,dt=st/Ye.width,kt=ht/Ye.height,Ct=ft.x*dt-st/2,vt=ft.y*kt-ht/2,yt=(mt.x-ft.x)*dt,wt=(mt.y-ft.y)*kt;Ue.strokeStyle=X,Ue.lineWidth=de/((dt+kt)/2),Ue.strokeRect(Ct,vt,yt,wt)}if(H==="pencil"&&K.current){const ft=st/Ye.width,mt=ht/Ye.height,dt=(ft+mt)/2,kt=K.current.x*ft-st/2,Ct=K.current.y*mt-ht/2,vt=de/2*dt;Ue.beginPath(),Ue.arc(kt,Ct,vt,0,Math.PI*2),Ue.strokeStyle=X,Ue.lineWidth=1/k.zoom,Ue.stroke(),Ue.beginPath(),Ue.arc(kt,Ct,Math.max(0,vt-1/k.zoom),0,Math.PI*2),Ue.strokeStyle="rgba(255,255,255,0.5)",Ue.lineWidth=1/k.zoom,Ue.stroke()}Ue.restore()}if(Ue.restore(),Ue.save(),Ue.translate(ke+k.offset.x,Ne+k.offset.y),Ue.scale(k.zoom,k.zoom),l.current&&H==="transform"){const Ye=m.width,st=m.height;Ue.save(),Ue.translate(m.x,m.y),Ue.strokeStyle="#22d3ee",Ue.lineWidth=2/k.zoom,Ue.strokeRect(-Ye/2,-st/2,Ye,st);const ht=8/k.zoom;Ue.fillStyle="#22d3ee",[{x:-Ye/2,y:-st/2},{x:Ye/2,y:-st/2},{x:-Ye/2,y:st/2},{x:Ye/2,y:st/2}].forEach(mt=>{Ue.fillRect(mt.x-ht/2,mt.y-ht/2,ht,ht)}),Ue.restore()}Ue.restore(),H==="eyedropper"&&K.current},[k,m,O,E,_,H,te,X,de]);v.useEffect(()=>{if(e){let Oe=requestAnimationFrame(_e);const Ae=()=>{_e(),Oe=requestAnimationFrame(Ae)};return Ae(),()=>cancelAnimationFrame(Oe)}},[e,_e]);const pe=(Oe,Ae)=>{if(!l.current)return"none";const Ue=m.width,ke=m.height,Ne=m.x,He=m.y,Fe=10/k.zoom,$e=(Ye,st)=>Math.abs(Oe-Ye)<Fe&&Math.abs(Ae-st)<Fe;return $e(Ne-Ue/2,He-ke/2)?"tl":$e(Ne+Ue/2,He-ke/2)?"tr":$e(Ne-Ue/2,He+ke/2)?"bl":$e(Ne+Ue/2,He+ke/2)?"br":"none"},xe=(Oe,Ae)=>{if(!l.current)return!1;const Ue=m.width,ke=m.height,Ne=m.x,He=m.y;return Oe>=Ne-Ue/2&&Oe<=Ne+Ue/2&&Ae>=He-ke/2&&Ae<=He+ke/2},Se=(Oe,Ae,Ue)=>{const ke=i.current;if(!ke)return;const Ne=ke.getBoundingClientRect(),He=Math.max(.1,Math.min(Ue,5)),Fe=Oe-Ne.left,$e=Ae-Ne.top,Ye=Ne.width/2,st=Ne.height/2,ht=Fe-Ye,ft=$e-st,mt=k.offset.x,dt=k.offset.y,kt=He/k.zoom,Ct=ht-(ht-mt)*kt,vt=ft-(ft-dt)*kt;b({zoom:He,offset:{x:Ct,y:vt}})},Le=Oe=>{const Ae=Number(Oe.target.value),Ue=Ae/k.zoom;b({zoom:Ae,offset:{x:k.offset.x*Ue,y:k.offset.y*Ue}})},Ee=(Oe,Ae,Ue)=>Math.abs(Oe-Ae)<Ue?Ae:Oe,Me=Oe=>{if(V(),Oe.preventDefault(),H==="eyedropper"){ve(Oe);return}if(H==="zoom"){ie.current={mouse:{x:Oe.clientX,y:Oe.clientY},viewOffset:{...k.offset},imgState:{...m},startZoom:k.zoom},le(!0);return}const Ae=he(Oe.clientX,Oe.clientY);if(H==="transform"){const Ue=pe(Ae.x,Ae.y);if(Ue!=="none"){se(Ue),le(!0),ie.current={mouse:{x:Oe.clientX,y:Oe.clientY},viewOffset:{...k.offset},imgState:{...m},startDist:Math.hypot(Ae.x-m.x,Ae.y-m.y),startAspectRatio:m.width/m.height};return}else if(xe(Ae.x,Ae.y))se("none");else return}if(le(!0),ie.current={mouse:{x:Oe.clientX,y:Oe.clientY},viewOffset:{...k.offset},imgState:{...m}},H==="pencil"||H==="rectangle"){const Ue=ye(Oe);if(A.current=Ue,oe.current=Ue,H==="pencil"&&s.current){const ke=s.current.getContext("2d");ke&&(ke.beginPath(),ke.moveTo(Ue.x,Ue.y),ke.lineCap="round",ke.lineJoin="round",ke.strokeStyle=X,ke.lineWidth=de,ke.stroke())}}},De=Oe=>{const Ae=he(Oe.clientX,Oe.clientY),Ue=ye(Oe);if(K.current=Ue,!te){H==="transform"?pe(Ae.x,Ae.y)!=="none"?document.body.style.cursor="nwse-resize":xe(Ae.x,Ae.y)?document.body.style.cursor="move":document.body.style.cursor="default":H==="hand"?document.body.style.cursor="grab":H==="zoom"?document.body.style.cursor="ew-resize":document.body.style.cursor="crosshair";return}const ke=ie.current;if(!ke)return;const Ne=Oe.clientX-ke.mouse.x,He=Oe.clientY-ke.mouse.y;if(H==="hand")b(Fe=>({...Fe,offset:{x:ke.viewOffset.x+Ne,y:ke.viewOffset.y+He}})),document.body.style.cursor="grabbing";else if(H==="zoom"){const $e=Math.pow(2,Ne/200),Ye=Math.max(.1,Math.min(10,(ke.startZoom||1)*$e));b(st=>({...st,zoom:Ye}))}else if(H==="transform")if(ee!=="none"){const Fe=he(Oe.clientX,Oe.clientY),$e=ke.imgState.width/2,Ye=ke.imgState.height/2,st=ke.imgState.x-$e,ht=ke.imgState.x+$e,ft=ke.imgState.y-Ye,mt=ke.imgState.y+Ye;let dt=st,kt=ht,Ct=ft,vt=mt;if(ee==="tl"&&(dt=Fe.x,Ct=Fe.y),ee==="tr"&&(kt=Fe.x,Ct=Fe.y),ee==="bl"&&(dt=Fe.x,vt=Fe.y),ee==="br"&&(kt=Fe.x,vt=Fe.y),N){const Pt=10/k.zoom,je=O.width/2,Ve=O.height/2;ee.includes("l")&&(dt=Ee(dt,-je,Pt),dt=Ee(dt,0,Pt),dt=Ee(dt,je,Pt)),ee.includes("r")&&(kt=Ee(kt,je,Pt),kt=Ee(kt,0,Pt),kt=Ee(kt,-je,Pt)),ee.includes("t")&&(Ct=Ee(Ct,-Ve,Pt),Ct=Ee(Ct,0,Pt),Ct=Ee(Ct,Ve,Pt)),ee.includes("b")&&(vt=Ee(vt,Ve,Pt),vt=Ee(vt,0,Pt),vt=Ee(vt,-Ve,Pt))}let yt=Math.abs(kt-dt),wt=Math.abs(vt-Ct);if(!F&&ke.startAspectRatio){const Pt=ke.startAspectRatio;yt/Pt>wt?wt=yt/Pt:yt=wt*Pt,ee==="tl"&&(dt=kt-yt,Ct=vt-wt),ee==="tr"&&(kt=dt+yt,Ct=vt-wt),ee==="bl"&&(dt=kt-yt,vt=Ct+wt),ee==="br"&&(kt=dt+yt,vt=Ct+wt)}const qn=(dt+kt)/2,Cn=(Ct+vt)/2;x({x:qn,y:Cn,width:yt,height:wt})}else{const Fe=Ne/k.zoom,$e=He/k.zoom;let Ye=ke.imgState.x+Fe,st=ke.imgState.y+$e;if(N){const ht=10/k.zoom,ft=ke.imgState.width/2,mt=ke.imgState.height/2,dt=O.width/2,kt=O.height/2,Ct=Ye-ft,vt=Ye+ft,yt=st-mt,wt=st+mt;Math.abs(Ct- -dt)<ht?Ye=-dt+ft:Math.abs(vt-dt)<ht?Ye=dt-ft:Math.abs(Ct-0)<ht?Ye=0+ft:Math.abs(vt-0)<ht?Ye=0-ft:Math.abs(Ye-0)<ht&&(Ye=0),Math.abs(yt- -kt)<ht?st=-kt+mt:Math.abs(wt-kt)<ht?st=kt-mt:Math.abs(yt-0)<ht?st=0+mt:Math.abs(wt-0)<ht?st=0-mt:Math.abs(st-0)<ht&&(st=0)}x(ht=>({...ht,x:Ye,y:st}))}else if(H==="pencil"){if(s.current){const Fe=s.current.getContext("2d");Fe&&(Fe.lineTo(Ue.x,Ue.y),Fe.stroke())}}else H==="rectangle"&&(oe.current=Ue)},Te=()=>{if(le(!1),se("none"),ie.current=null,H==="rectangle"&&A.current&&oe.current&&s.current){const Oe=s.current.getContext("2d");if(Oe){const Ae=A.current,Ue=oe.current,ke=Ue.x-Ae.x,Ne=Ue.y-Ae.y;Oe.strokeStyle=X,Oe.lineWidth=de,Oe.strokeRect(Ae.x,Ae.y,ke,Ne)}}A.current=null,oe.current=null},Re=()=>{K.current=null,Te()},we=Oe=>{Oe.preventDefault(),Oe.stopPropagation();const Ae=Math.pow(1.001,-Oe.deltaY),Ue=Math.max(.1,Math.min(5,k.zoom*Ae));Se(Oe.clientX,Oe.clientY,Ue)},Ce=()=>{if(!l.current)return;const Oe=l.current.width,Ae=l.current.height,Ue=O.width,ke=O.height,Ne=Math.min(Ue/Oe,ke/Ae);x({x:0,y:0,width:Oe*Ne,height:Ae*Ne})},qe=()=>{if(!l.current)return;const Oe=l.current.width,Ae=l.current.height,Ue=O.width,ke=O.height,Ne=Math.max(Ue/Oe,ke/Ae);x({x:0,y:0,width:Oe*Ne,height:Ae*Ne})},Be=()=>{var Oe,Ae;if(x({x:0,y:0,width:((Oe=l.current)==null?void 0:Oe.width)||0,height:((Ae=l.current)==null?void 0:Ae.height)||0}),S(!1),j("free"),D("auto"),s.current){const Ue=s.current.getContext("2d");Ue&&Ue.clearRect(0,0,s.current.width,s.current.height)}},Ie=async()=>{if(!(!l.current||G)){U(!0);try{const Oe=document.createElement("canvas");Oe.width=l.current.width,Oe.height=l.current.height;const Ae=Oe.getContext("2d");if(!Ae)throw new Error("Could not get context");Ae.drawImage(l.current,0,0),s.current&&Ae.drawImage(s.current,0,0);const ke=Oe.toDataURL("image/png").split(",")[1],Fe=await $n("Modify the image based on the colored markings: 1. REMOVE objects covered in RED. 2. STRICTLY PRESERVE and do NOT change objects covered in GREEN. Fill the removed red areas naturally to match the surroundings.","1:1",[{base64ImageData:ke,mimeType:"image/png"}],"gemini-3-flash-preview"),$e=new Image;$e.onload=()=>{if(l.current=$e,s.current){const Ye=s.current.getContext("2d");Ye==null||Ye.clearRect(0,0,s.current.width,s.current.height)}U(!1)},$e.src=Fe}catch(Oe){console.error("Error removing object:",Oe),U(!1),alert("Failed to remove object. Please check console.")}}},We=async()=>{if(!(!l.current||G)){U(!0);try{const Oe=document.createElement("canvas");Oe.width=l.current.width,Oe.height=l.current.height;const Ae=Oe.getContext("2d");if(!Ae)throw new Error("Could not get context");Ae.drawImage(l.current,0,0);const ke=Oe.toDataURL("image/png").split(",")[1],Fe=await $n("Replace the background with solid pure black color (#000000). Keep the main subject exactly identical.","1:1",[{base64ImageData:ke,mimeType:"image/png"}],"gemini-3-flash-preview"),$e=new Image;$e.crossOrigin="anonymous",$e.onload=()=>{l.current=$e,U(!1)},$e.src=Fe}catch{U(!1)}}},at=async()=>{if(!(!l.current||G||!R.trim())){U(!0);try{const Oe=document.createElement("canvas");Oe.width=l.current.width,Oe.height=l.current.height;const Ae=Oe.getContext("2d");if(!Ae)throw new Error("Could not get context");Ae.drawImage(l.current,0,0),s.current&&Ae.drawImage(s.current,0,0);const ke=Oe.toDataURL("image/png").split(",")[1],He=await $n(R,"1:1",[{base64ImageData:ke,mimeType:"image/png"}],"gemini-3-flash-preview"),Fe=new Image;Fe.onload=()=>{if(l.current=Fe,s.current){const $e=s.current.getContext("2d");$e==null||$e.clearRect(0,0,s.current.width,s.current.height)}U(!1)},Fe.src=He}catch(Oe){console.error("Error requesting modification:",Oe),U(!1),alert("Failed to request changes. Please check console.")}}},Jt=()=>{if(!i.current||!l.current)return;const Oe=O.width,Ae=O.height,Ue=document.createElement("canvas");Ue.width=Oe,Ue.height=Ae;const ke=Ue.getContext("2d");if(!ke)return;E!=="checkerboard"&&(ke.fillStyle=E,ke.fillRect(0,0,Oe,Ae));const Ne=Oe/2,He=Ae/2;ke.save(),ke.translate(Ne,He),ke.translate(m.x,m.y);const Fe=m.width,$e=m.height;_&&ke.scale(-1,1);const Ye=l.current;ke.drawImage(Ye,-Fe/2,-$e/2,Fe,$e),s.current&&ke.drawImage(s.current,-Fe/2,-$e/2,Fe,$e),ke.restore();const st=Ue.toDataURL("image/png");o(st),t()};return e?jw.createPortal(n.jsx("div",{className:`fixed inset-0 z-[${u}] pointer-events-none transition-opacity duration-300 ease-out ${y?"opacity-100":"opacity-0"}`,children:n.jsxs("div",{ref:c,className:"absolute bg-gray-800 rounded-lg shadow-2xl border-2 border-gray-700 flex flex-col pointer-events-auto overflow-hidden",onMouseDown:V,style:h?{left:0,top:0,width:"100%",height:"100%",borderRadius:0,border:"none"}:{left:Z.x,top:Z.y,width:Q.width,height:Q.height,maxWidth:"98vw",maxHeight:"98vh",minWidth:"800px",minHeight:"600px",resize:"both"},onMouseUp:ue,children:[n.jsx(gP,{onClose:t,onPointerDown:J,onPointerMove:Y,onPointerUp:ae}),n.jsxs("div",{className:"flex-grow min-h-0 flex",children:[n.jsx(fP,{resolution:M,setResolution:D,aspectRatio:P,setAspectRatio:j,backgroundType:E,setBackgroundType:I,activeTool:H,isSnappingEnabled:N,setIsSnappingEnabled:T,isFreeAspect:F,setIsFreeAspect:z,brushSize:de,setBrushSize:ge,modificationPrompt:R,setModificationPrompt:q,isProcessing:G,handleRequestModification:at,handleRemoveObject:Ie,handleRemoveBackground:We,canvasSize:O}),n.jsxs("div",{className:"flex-grow bg-black/90 relative overflow-hidden flex items-center justify-center",style:{cursor:H==="hand"?te?"grabbing":"grab":"default"},children:[n.jsx(xP,{activeTool:H,setActiveTool:ne,onFit:Ce,onFill:qe,onFlip:()=>S(Oe=>!Oe)}),n.jsx("canvas",{ref:i,onMouseDown:Me,onMouseMove:De,onMouseUp:Te,onMouseLeave:Re,onWheel:we,onContextMenu:Oe=>Oe.preventDefault()})]}),n.jsx(CP,{color:X,onChange:re})]}),n.jsx(yP,{zoom:k.zoom,onZoomChange:Le,onClose:t,onReset:Be,onApply:Jt,isProcessing:G})]})}),document.body):null},kP="Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.",Bp=async(e,t,o="",r="gemini-3-flash-preview",a=kP)=>{var p;const{formattedImage:i}=await Cr(e,t),l=i.split(",")[1],c=((p=i.match(/:(.*?);/))==null?void 0:p[1])||"image/png",d=o?`${o}. ${a}`:`High quality image. ${a}`;return await $n(d,t,[{base64ImageData:l,mimeType:c}],r)},_P=({node:e,onValueChange:t,onProcessImage:o,isProcessingImage:r,onPasteImage:a,t:i,deselectAllNodes:s,getFullSizeImage:l,setImageViewer:c,setFullSizeImage:d,onCopyImageToClipboard:u,onDownloadImage:p,addToast:h,onAddNode:w,onDeleteNode:k,onImageToText:b,isAnalyzingImage:y})=>{const g=Ut(),m=w||(g==null?void 0:g.onAddNode),x=k||(g==null?void 0:g.deleteNodeAndConnections),_=g==null?void 0:g.setSelectedNodeIds,S=v.useRef(null),[P,j]=v.useState(null),[M,D]=v.useState(!1),[O,B]=v.useState(!1),[E,I]=v.useState(null),[N,T]=v.useState(null),F=(e.height??0)>=460,z=v.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{image:e.value.startsWith("data:image")?e.value:null,prompt:""}}},[e.value]),{image:G,prompt:U}=z,R=l(e.id,0);v.useEffect(()=>{const Z=R||G;if(!Z){T(null);return}const W=new Image;W.onload=()=>{T({width:W.naturalWidth,height:W.naturalHeight})},W.src=Z},[R,G]);const q=Z=>{t(e.id,JSON.stringify({...z,...Z}))},H=async Z=>{const W=await xl(Z);j(W);const Q=await Rt(Z,256,256);d(e.id,0,Z),q({image:Q})},ne=Z=>{var Q;const W=(Q=Z.target.files)==null?void 0:Q[0];W&&a(e.id,W)},X=Z=>{Z.preventDefault(),Z.stopPropagation(),D(!0);const W=document.getElementById("app-container");W&&W.classList.remove("ring-2","ring-cyan-500","ring-inset")},re=Z=>{Z.preventDefault(),Z.stopPropagation(),D(!0)},de=Z=>{Z.preventDefault(),Z.stopPropagation(),D(!1)},ge=Z=>{var ce;Z.preventDefault(),Z.stopPropagation(),D(!1);const W=Z.dataTransfer.getData("application/prompt-modifier-drag-image");if(W){fetch(W).then(fe=>fe.blob()).then(fe=>{const $=new File([fe],"dragged_image.png",{type:fe.type});a(e.id,$)});return}const Q=(ce=Z.dataTransfer.files)==null?void 0:ce[0];Q&&Q.type.startsWith("image/")&&a(e.id,Q)},te=Z=>{H(Z)},le=Z=>{if(Z.stopPropagation(),!G)return;const W=l(e.id,0)||G;W&&c({sources:[{src:W,frameNumber:0,prompt:U||"Input Image"}],initialIndex:0})},ee=Z=>{Z.stopPropagation();const W=l(e.id,0)||G;W&&u&&u(W)},se=Z=>{Z.stopPropagation(),p&&p(e.id)},ie=Z=>{Z.stopPropagation(),q({image:null}),h&&h(i("toast.contentCleared"))},oe=async Z=>{const W=l(e.id,0)||G;if(W){I(Z);try{const Q=await Bp(W,Z,U);await H(Q),h&&h(`Converted to ${Z} successfully`,"success")}catch(Q){console.error("Ratio expansion failed:",Q),h&&h(`Failed to convert: ${Q.message}`,"error")}finally{I(null)}}},A=(Z,W)=>{if(!m)return;const Q=l(e.id,0)||G;if(!Q)return;let ce={x:e.position.x,y:e.position.y};Z.shiftKey||(ce={x:e.position.x+e.width+50,y:e.position.y});const fe=m(W,ce);W===L.IMAGE_ANALYZER?(t(fe,JSON.stringify({image:G,description:"",softPrompt:!1})),d(fe,0,Q)):W===L.IMAGE_EDITOR&&(t(fe,JSON.stringify({inputImages:[G],prompt:U||"",outputImage:null,aspectRatio:"1:1",enableAspectRatio:!1,enableOutpainting:!1,outpaintingPrompt:"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.",model:"gemini-2.5-flash-image",autoDownload:!0,autoCrop169:!1,leftPaneWidth:280,topPaneHeight:320})),d(fe,1,Q)),_&&_([fe]),Z.shiftKey&&x&&x(e.id)},K=Z=>{Z.stopPropagation();const W=F?340:560;g!=null&&g.setNodes&&g.setNodes(Q=>Q.map(ce=>ce.id===e.id?{...ce,height:W}:ce))};return n.jsxs("div",{className:"flex flex-col h-full space-y-2","data-node-id":e.id,children:[n.jsx(ec,{isOpen:O,onClose:()=>B(!1),onApply:te,imageSrc:l(e.id,0)||G}),n.jsx("input",{ref:S,type:"file",accept:"image/*",className:"hidden",onChange:ne}),n.jsxs("div",{className:"flex-grow min-h-0 relative group rounded-md overflow-hidden bg-gray-700",children:[n.jsx("div",{onClick:()=>{var Z;return(Z=S.current)==null?void 0:Z.click()},onDragEnter:X,onDragOver:re,onDragLeave:de,onDrop:ge,className:`w-full h-full flex items-center justify-center cursor-pointer transition-all relative ${M?"bg-gray-600 ring-2 ring-accent":"hover:bg-gray-600"}`,children:G?n.jsxs(n.Fragment,{children:[n.jsx("img",{src:G||l(e.id,0),alt:"Input",className:"object-contain w-full h-full",draggable:!0,onMouseDown:Z=>Z.stopPropagation(),onClick:le,onDragStart:Z=>{const W=l(e.id,0)||G;W&&(Z.dataTransfer.setData("application/prompt-modifier-drag-image",W),Z.dataTransfer.effectAllowed="copy",Z.stopPropagation())}}),n.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"}),N&&n.jsxs("div",{className:"absolute bottom-2 left-2 z-20 bg-black/60 text-gray-300 text-[10px] px-1.5 py-0.5 rounded pointer-events-none backdrop-blur-sm font-mono",children:[N.width,"x",N.height]}),n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity z-10 bg-black/60 backdrop-blur-sm p-1 rounded-md",children:[n.jsx(Pe,{title:i("node.action.download"),onClick:se,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Pe,{title:i("node.action.copy"),onClick:ee,children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Pe,{title:i("node.action.clear"),onClick:ie,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}):n.jsx("span",{className:"text-gray-400 pointer-events-none",children:i("node.content.dropImage")})}),n.jsxs("div",{className:"absolute bottom-2 right-2 z-20 flex gap-1 items-center",children:[!F&&G&&n.jsxs(n.Fragment,{children:[n.jsx(ut,{content:i("node.action.rasterEditor"),children:n.jsx("button",{onClick:Z=>{Z.stopPropagation(),B(!0)},className:"p-1 bg-gray-900/60 hover:bg-gray-700 text-gray-400 hover:text-white rounded transition-colors shadow-sm",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})})}),n.jsx(ut,{content:i("node.action.openInAIEditor"),children:n.jsx("button",{onClick:Z=>{Z.stopPropagation(),A(Z,L.IMAGE_EDITOR)},className:"p-1 bg-gray-900/60 hover:bg-gray-700 text-gray-400 hover:text-white rounded transition-colors shadow-sm",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})})})]}),n.jsx(ut,{content:F?" ":" ",children:n.jsx("button",{onClick:K,className:"p-1 bg-gray-900/60 hover:bg-gray-700 text-gray-400 hover:text-white rounded transition-colors shadow-sm",children:F?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})})})]})]}),F&&n.jsxs("div",{className:"flex-shrink-0 flex flex-col space-y-2 h-[220px] overflow-hidden",children:[n.jsxs("div",{className:"flex gap-2 shrink-0 h-[80px]",children:[n.jsxs("div",{className:"flex-[1.2] flex flex-col gap-2 min-w-0",children:[n.jsx(ut,{content:i("node.action.processImageTitle"),className:"w-full",children:n.jsxs("button",{onClick:()=>o(e.id),disabled:r||!G||!!E,className:"w-full h-9 px-3 text-sm font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 truncate flex items-center justify-center gap-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z"})}),n.jsx("span",{className:"truncate",children:i(r?"node.content.processing":"node.action.processImage")})]})}),n.jsxs("div",{className:"grid grid-cols-4 gap-1 h-9",children:[n.jsx(ut,{content:i("node.action.openInAnalyzer"),children:n.jsx("button",{onClick:Z=>A(Z,L.IMAGE_ANALYZER),disabled:!G,className:"w-full h-full flex items-center justify-center bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-white",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12.792V5.25a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 5.25v13.5A2.25 2.25 0 005.25 21h7.55"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 18.375L21 21"})]})})}),n.jsx(ut,{content:i("node.content.imageToText"),children:n.jsx("button",{onClick:()=>b&&b(e.id),disabled:!G||y||!b,className:"w-full h-full flex items-center justify-center bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:y?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-white",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})})})}),n.jsx(ut,{content:i("node.action.expand169"),children:n.jsx("button",{onClick:()=>oe("16:9"),disabled:!G||r||!!E,className:"w-full h-full px-1 text-[10px] font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center gap-1",children:E==="16:9"?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsxs(n.Fragment,{children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 hidden sm:block",children:n.jsx("rect",{x:"2",y:"6",width:"20",height:"12",rx:"2"})}),n.jsx("span",{children:"16:9"})]})})}),n.jsx(ut,{content:i("node.action.expand916"),children:n.jsx("button",{onClick:()=>oe("9:16"),disabled:!G||r||!!E,className:"w-full h-full px-1 text-[10px] font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center gap-1",children:E==="9:16"?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsxs(n.Fragment,{children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 hidden sm:block",children:n.jsx("rect",{x:"6",y:"2",width:"12",height:"20",rx:"2"})}),n.jsx("span",{children:"9:16"})]})})})]})]}),n.jsxs("div",{className:"flex-1 flex flex-col gap-2 min-w-0",children:[n.jsx(ut,{content:i("node.action.rasterEditor"),className:"w-full",children:n.jsxs("button",{onClick:()=>B(!0),disabled:!G,className:"w-full h-9 px-2 text-xs font-bold text-white bg-accent-secondary rounded-md hover:bg-accent-secondary-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center gap-1.5",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 shrink-0",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})}),n.jsx("span",{className:"truncate",children:i("node.action.rasterEditor")})]})}),n.jsx(ut,{content:i("node.action.openInAIEditor"),className:"w-full",children:n.jsxs("button",{onClick:Z=>A(Z,L.IMAGE_EDITOR),disabled:!G,className:"w-full h-9 px-2 text-xs font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center gap-1.5",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 shrink-0",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})}),n.jsx("span",{className:"truncate",children:i("node.action.openInAIEditor")})]})})]})]}),P&&n.jsxs("div",{className:"flex-shrink-0 relative",children:[n.jsx("div",{className:"absolute top-0 right-0 z-10",children:n.jsx("button",{onClick:()=>{q({prompt:`${U?U+", ":""}${P}`}),j(null)},className:"px-2 py-0.5 text-[10px] font-bold bg-accent hover:bg-accent-hover text-white rounded shadow-sm",title:i("node.action.copyPrompt"),children:"Use"})}),n.jsx("textarea",{readOnly:!0,value:P,placeholder:i("node.content.metadataPromptPlaceholder"),className:"w-full p-2 text-xs bg-input/50 rounded-md resize-none focus:outline-none text-gray-400 italic border border-gray-600/50",rows:2,onWheel:Z=>Z.stopPropagation(),onFocus:s})]}),n.jsxs("div",{className:"flex-grow min-h-0 flex flex-col relative",children:[n.jsx("textarea",{value:U||"",onChange:Z=>q({prompt:Z.target.value}),placeholder:i("node.content.prompt"),className:"w-full h-full p-2 bg-[#18202f] border border-gray-600 rounded-md resize-none focus:ring-1 focus:ring-accent focus:border-accent focus:outline-none custom-scrollbar text-sm",onWheel:Z=>Z.stopPropagation(),onMouseDown:Z=>Z.stopPropagation(),onFocus:s}),n.jsx("div",{className:"absolute bottom-2 right-2 opacity-50 hover:opacity-100 transition-opacity",children:n.jsx(Pe,{title:i("node.action.copy"),onClick:()=>navigator.clipboard.writeText(U||""),children:n.jsx(Dt,{className:"h-4 w-4"})})})]})]})]})},SP=({node:e,onValueChange:t,onTranslate:o,isTranslating:r,connectedInputs:a,t:i,onSelectNode:s,onPasteImage:l,getFullSizeImage:c,setImageViewer:d})=>{const u=v.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{inputText:"",targetLanguage:"ru",translatedText:"",image:null}}},[e.value]),{inputText:p="",targetLanguage:h="ru",translatedText:w="",image:k=null}=u,b=a==null?void 0:a.has(void 0),y=P=>{const j={...u,...P};delete j.inputHeight,t(e.id,JSON.stringify(j))},g=P=>{P.stopPropagation(),l(e.id)},m=P=>{P.stopPropagation(),y({inputText:""})},x=P=>{P.stopPropagation(),y({image:null})},_=P=>{P.stopPropagation(),k&&d({sources:[{src:k,frameNumber:0,prompt:"Input Image"}],initialIndex:0})},S=Object.entries(fn);return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex-shrink-0 mb-2 flex items-end space-x-2",onMouseDown:P=>{P.stopPropagation(),s()},children:[n.jsxs("div",{className:"flex-grow",children:[n.jsx("label",{htmlFor:`lang-select-${e.id}`,className:"block text-xs font-medium text-gray-400 mb-1",children:i("node.content.targetLanguage")}),n.jsx(Rn,{id:`lang-select-${e.id}`,value:h,onChange:P=>y({targetLanguage:P}),disabled:r,options:S.map(([P,{name:j}])=>({value:P,label:j}))})]}),n.jsx("button",{onClick:g,className:"h-[38px] px-3 bg-accent-secondary hover:bg-accent-secondary-hover text-white rounded-md transition-colors flex items-center justify-center shadow-sm",title:i("node.action.paste"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),n.jsx(ut,{content:"Model: gemini-3-flash-preview",position:"top",children:n.jsx("button",{onClick:()=>o(e.id),disabled:r||!b&&!p.trim()&&!k,className:"h-[38px] px-4 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors duration-200 flex-shrink-0 shadow-sm",children:i(r?"node.content.translating":"node.content.translate")})})]}),n.jsxs("div",{className:"flex-1 min-h-0 mb-2 flex flex-col gap-2",children:[k&&n.jsxs("div",{className:"relative h-24 w-full bg-gray-900/50 rounded-md border border-gray-600 flex-shrink-0 group overflow-hidden",children:[n.jsx("img",{src:k,alt:"Input",className:"w-full h-full object-contain cursor-pointer",onClick:_}),n.jsx("div",{className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsx(Pe,{title:i("node.action.clear"),onClick:x,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})})]}),n.jsxs("div",{className:"relative flex-grow h-full",children:[n.jsx("textarea",{value:p,onChange:P=>y({inputText:P.target.value}),placeholder:i(b?"node.content.connectedPlaceholder":"node.content.translatePlaceholder"),className:"w-full h-full p-2 bg-input border border-gray-700/50 rounded-md resize-none focus:ring-1 focus:ring-accent focus:border-accent focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 custom-scrollbar",onWheel:P=>P.stopPropagation(),onMouseDown:P=>{P.stopPropagation(),s()},disabled:b}),!b&&p&&n.jsx("div",{className:"absolute top-1 right-1 opacity-50 hover:opacity-100 transition-opacity",children:n.jsx(Pe,{title:i("node.action.clear"),onClick:m,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})})]})]}),n.jsxs("div",{className:"flex-1 min-h-0 relative",children:[n.jsx("textarea",{value:w,onChange:P=>y({translatedText:P.target.value}),placeholder:i("node.content.translatedTextPlaceholder"),className:"w-full h-full p-2 bg-input border border-gray-700/50 rounded-md resize-none focus:ring-1 focus:ring-accent focus:border-accent focus:outline-none custom-scrollbar",onWheel:P=>P.stopPropagation(),onMouseDown:P=>{P.stopPropagation(),s()}}),n.jsx("div",{className:"absolute top-1 right-1 opacity-50 hover:opacity-100 transition-opacity",children:n.jsx(Pe,{title:i("node.action.copy"),onClick:P=>{P.stopPropagation(),navigator.clipboard.writeText(w)},children:n.jsx(Dt,{className:"h-4 w-4"})})})]})]})},fs=e=>{let t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/"/g,"&#039;");return t=t.replace(/\*\*(.*?)\*\*/g,'<strong class="text-accent-text font-bold">$1</strong>'),t=t.replace(/__(.*?)__/g,'<strong class="text-accent-text font-bold">$1</strong>'),t=t.replace(/`([^`]+)`/g,'<code class="bg-gray-800 px-1 rounded text-accent-text font-mono text-xs">$1</code>'),t},Jg=({code:e})=>{const[t,o]=v.useState(!1),r=()=>{navigator.clipboard.writeText(e),o(!0),setTimeout(()=>o(!1),2e3)};return n.jsxs("div",{className:"relative group/code my-2",children:[n.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover/code:opacity-100 transition-opacity z-10",children:n.jsx("button",{onClick:r,className:"p-1.5 bg-gray-700 hover:bg-accent text-gray-300 hover:text-white rounded text-xs flex items-center gap-1 shadow-sm transition-colors",title:t?"Copied!":"Copy Code",children:t?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):n.jsx(Dt,{className:"h-4 w-4"})})}),n.jsx("pre",{className:"bg-gray-900/80 p-3 rounded-md border border-gray-600 text-accent-text overflow-x-auto font-mono text-xs shadow-inner [&::-webkit-scrollbar]:h-2 [&::-webkit-scrollbar-track]:bg-transparent [&::-webkit-scrollbar-thumb]:bg-gray-600 [&::-webkit-scrollbar-thumb]:rounded-full hover:[&::-webkit-scrollbar-thumb]:bg-gray-500 select-text",children:n.jsx("code",{children:e})})]})},NP=jt.memo(({content:e})=>{const t=e.split(/(```prompt\n[\s\S]*?\n```|```[\s\S]*?```)/g);return n.jsx("div",{className:"text-sm leading-relaxed space-y-2 text-gray-200 break-words cursor-text",children:t.map((o,r)=>{const a=o.match(/```prompt\n([\s\S]*?)\n```/);if(a)return n.jsx(Jg,{code:a[1].trim()},r);const i=o.match(/```([\s\S]*?)```/);if(i){let p=i[1];const h=p.indexOf(`
`);if(h!==-1){const w=p.substring(0,h).trim();w&&!w.includes(" ")&&(p=p.substring(h+1))}return n.jsx(Jg,{code:p.trim()},r)}if(!o.trim())return null;const s=o.split(`
`),l=[];let c=[],d=!1;const u=()=>{c.length>0&&(d?l.push(n.jsx("ol",{className:"list-decimal list-outside ml-4 space-y-1 mb-2 marker:text-gray-500 select-text",children:[...c]},`list-${r}-${l.length}`)):l.push(n.jsx("ul",{className:"list-disc list-outside ml-4 space-y-1 mb-2 marker:text-gray-500 select-text",children:[...c]},`list-${r}-${l.length}`)),c=[])};return s.forEach((p,h)=>{const w=p.match(/^(\d+)\.\s+(.*)/),k=p.match(/^[\*\-]\s+(.*)/),b=p.match(/^(#{1,6})\s+(.*)/);if(w){c.length>0&&!d&&u(),d=!0;const y=parseInt(w[1],10);c.push(n.jsx("li",{value:y,dangerouslySetInnerHTML:{__html:fs(w[2])}},h))}else if(k)c.length>0&&d&&u(),d=!1,c.push(n.jsx("li",{dangerouslySetInnerHTML:{__html:fs(k[1])}},h));else if(u(),b){const y=b[1].length,g=y===1?"text-lg":y===2?"text-base":"text-sm";l.push(n.jsx("div",{className:`${g} font-bold text-accent-text mt-3 mb-1 border-b border-gray-700/50 pb-1 select-text`,dangerouslySetInnerHTML:{__html:fs(b[2])}},h))}else p.trim()===""?l.push(n.jsx("div",{className:"h-2"},h)):l.push(n.jsx("div",{className:"min-h-[1.2em] select-text",dangerouslySetInnerHTML:{__html:fs(p)}},h))}),u(),n.jsx("div",{className:"select-text",children:l},r)})})}),EP=({label:e,icon:t,isActive:o,onClick:r})=>{const[a,i]=v.useState(!1);return n.jsxs("div",{className:"relative flex-1 flex",onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),onMouseDown:s=>s.stopPropagation(),children:[n.jsx("button",{onClick:r,className:`flex-1 flex items-center justify-center p-1.5 rounded transition-all duration-200 group ${o?"bg-accent text-white shadow-sm":"hover:bg-gray-700 text-gray-400 hover:text-gray-200"}`,children:t}),n.jsxs("div",{className:`absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-xs whitespace-nowrap rounded shadow-xl z-50 pointer-events-none transition-opacity duration-200 ease-out origin-bottom ${a?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:[e,n.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-700"})]})]})},PP=({selection:e,onCopy:t,rootRef:o,scale:r})=>{const[a,i]=v.useState(null);return v.useEffect(()=>{if(!e||e.rangeCount===0||e.toString().length===0){i(null);return}const s=e.getRangeAt(0),l=s.getBoundingClientRect();if(o.current&&!o.current.contains(s.commonAncestorContainer)){i(null);return}if(!o.current)return;const c=o.current.getBoundingClientRect(),d=(l.top-c.top)/r-40,u=(l.left-c.left)/r+l.width/r/2;i({top:d,left:u})},[e,o,r]),a?n.jsxs("button",{onClick:s=>{s.preventDefault(),s.stopPropagation(),t()},style:{top:a.top,left:a.left,transform:"translateX(-50%)"},className:"absolute z-[100] px-3 py-1.5 bg-gray-800 text-white text-xs font-bold rounded-lg shadow-xl border border-gray-600 hover:bg-gray-700 hover:border-cyan-500 transition-all flex items-center gap-2 animate-fade-in-up",children:[n.jsx(Dt,{className:"h-3 w-3"}),"Copy"]}):null},jP=({node:e,onValueChange:t,onSendMessage:o,isChatting:r,t:a,onSelectNode:i,addToast:s})=>{var G;const l=Ut(),c=(l==null?void 0:l.viewTransform.scale)||1,d=v.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{messages:[],currentInput:"",style:"general",attachment:null}}},[e.value]),{messages:u=[],currentInput:p="",style:h="general",attachment:w=null}=d,k=v.useRef(null),b=v.useRef(!0),y=v.useRef(null),g=v.useRef(null),m=v.useRef(null),[x,_]=v.useState(null);v.useLayoutEffect(()=>{const U=m.current;if(!U)return;U.style.height="80px";const R=U.scrollHeight,q=Math.min(Math.max(80,R),200);U.style.height=`${q}px`,U.style.overflowY=R>200?"auto":"hidden"},[p]);const S=U=>{U.stopPropagation();const{scrollTop:R,scrollHeight:q,clientHeight:H}=U.currentTarget;b.current=Math.abs(q-H-R)<50};v.useEffect(()=>{k.current&&b.current&&k.current.scrollTo({top:k.current.scrollHeight,behavior:"smooth"})},[u,r]),v.useEffect(()=>{const U=()=>{const R=window.getSelection();if(R&&R.toString().length>0&&k.current&&k.current.contains(R.anchorNode)){_(R);return}_(null)};return document.addEventListener("selectionchange",U),()=>document.removeEventListener("selectionchange",U)},[]);const P=()=>{r||(o(e.id),b.current=!0)},j=U=>{t(e.id,JSON.stringify({...d,style:U}))},M=()=>{var U;(U=g.current)==null||U.click()},D=async U=>{var H;const R=(H=U.target.files)==null?void 0:H[0];if(!R)return;const q=new FileReader;q.onload=ne=>{var de;const X=(de=ne.target)==null?void 0:de.result,re={name:R.name,type:R.type,data:X};t(e.id,JSON.stringify({...d,attachment:re})),s&&s("File attached","success")},q.readAsDataURL(R),U.target.value=""},O=async()=>{try{const U=await navigator.clipboard.read();for(const R of U)if(R.types.some(q=>q.startsWith("image/"))){const q=await R.getType(R.types.find(X=>X.startsWith("image/"))),H=new File([q],"pasted_image.png",{type:q.type}),ne=new FileReader;ne.onload=X=>{var de;const re=(de=X.target)==null?void 0:de.result;t(e.id,JSON.stringify({...d,attachment:{name:H.name,type:H.type,data:re}})),s&&s(a("toast.pastedFromClipboard"),"success")},ne.readAsDataURL(H);return}try{const R=await navigator.clipboard.readText();R&&(t(e.id,JSON.stringify({...d,currentInput:p+R})),s&&s(a("toast.pastedFromClipboard"),"success"))}catch{}}catch{try{const R=await navigator.clipboard.readText();R&&t(e.id,JSON.stringify({...d,currentInput:p+R}))}catch{s&&s(a("toast.pasteFailed"),"error")}}},B=()=>{t(e.id,JSON.stringify({...d,attachment:null}))},E=()=>{x&&(navigator.clipboard.writeText(x.toString()),s&&s(a("toast.copiedToClipboard")),x.removeAllRanges(),_(null))},I=U=>{const R=new Blob([U],{type:"text/plain"}),q=URL.createObjectURL(R),H=document.createElement("a");H.href=q;const ne=new Date().toISOString().replace(/[:.]/g,"-");H.download=`Gemini_Chat_${ne}.txt`,document.body.appendChild(H),H.click(),document.body.removeChild(H),URL.revokeObjectURL(q)},N=U=>{let R=U.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");R=R.replace(/^### (.*$)/gim,`<h3 style="color: #0891b2; font-size: 14pt; margin-top: 12pt; margin-bottom: 3pt; font-family: 'Calibri Light', sans-serif;">$1</h3>`),R=R.replace(/^## (.*$)/gim,`<h2 style="color: #0891b2; font-size: 16pt; margin-top: 14pt; margin-bottom: 6pt; font-family: 'Calibri Light', sans-serif;">$1</h2>`),R=R.replace(/^# (.*$)/gim,`<h1 style="color: #0891b2; font-size: 18pt; margin-top: 16pt; margin-bottom: 6pt; font-family: 'Calibri Light', sans-serif;">$1</h1>`),R=R.replace(/\*\*(.*?)\*\*/g,'<b style="color: #0891b2;">$1</b>'),R=R.replace(/__(.*?)__/g,'<b style="color: #0891b2;">$1</b>'),R=R.replace(/\*(.*?)\*/g,"<i>$1</i>"),R=R.replace(/_(.*?)_/g,"<i>$1</i>"),R=R.replace(/```([\s\S]*?)```/g,(de,ge)=>`<div style="background-color: #f5f5f5; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-family: 'Courier New', monospace; font-size: 10pt; margin: 10px 0;">${ge.replace(/\n/g,"<br>")}</div>`),R=R.replace(/`([^`]+)`/g,`<span style="background-color: #f0f0f0; padding: 2px; border-radius: 4px; font-family: 'Courier New', monospace; color: #d63384; font-size: 10pt;">$1</span>`),R=R.replace(/\n/g,"<br>");const q=`
            <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
            <head>
                <meta charset='utf-8'>
                <title>Gemini Export</title>
                <style>
                    body { font-family: 'Calibri', 'Arial', sans-serif; font-size: 11pt; color: #000000; line-height: 1.5; }
                    h1, h2, h3, h4, h5, h6 { font-family: 'Calibri Light', 'Arial', sans-serif; color: #0891b2; }
                    strong, b { color: #0891b2; }
                </style>
            </head>
            <body>
                ${R}
            </body>
            </html>
        `,H=new Blob(["\uFEFF",q],{type:"application/msword"}),ne=URL.createObjectURL(H),X=document.createElement("a");X.href=ne;const re=new Date().toISOString().replace(/[:.]/g,"-");X.download=`Gemini_Chat_${re}.doc`,document.body.appendChild(X),X.click(),document.body.removeChild(X),URL.revokeObjectURL(ne)},T=[{id:"general",label:a("geminiChat.mode.general"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})},{id:"prompt",label:a("geminiChat.mode.prompt"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-4 w-4",children:[n.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 15-5-5L5 21"})]})},{id:"script",label:a("geminiChat.mode.script"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})},{id:"youtube",label:a("geminiChat.mode.youtube"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})},{id:"developer",label:a("geminiChat.mode.developer"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"})})}],F=(G=T.find(U=>U.id===h))==null?void 0:G.label,z=U=>{U.stopPropagation()};return n.jsxs("div",{className:"flex flex-col h-full relative",ref:y,children:[n.jsx("input",{type:"file",ref:g,className:"hidden",onChange:D,accept:"image/*,.txt,.pdf,.json"}),x&&n.jsx(PP,{selection:x,onCopy:E,rootRef:y,scale:c}),n.jsx("div",{className:"flex items-center bg-gray-900/50 p-1 rounded-md mb-2 shrink-0 justify-between",onMouseDown:U=>{U.stopPropagation(),i()},children:n.jsx("div",{className:"flex space-x-1 flex-1",children:T.map(U=>n.jsx(EP,{id:U.id,label:U.label,icon:U.icon,isActive:h===U.id,onClick:()=>j(U.id)},U.id))})}),n.jsxs("div",{ref:k,onWheel:U=>U.stopPropagation(),onScroll:S,className:"flex-grow p-2 bg-gray-900/50 rounded-md overflow-y-auto overflow-x-hidden mb-1 space-y-4 custom-scrollbar select-text cursor-text",onMouseDown:z,onMouseMove:z,onMouseUp:z,onClick:z,children:[u.length===0&&n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-500 space-y-2 opacity-50 select-none pointer-events-none",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),n.jsx("span",{className:"text-xs font-medium",children:F})]}),u.map((U,R)=>n.jsx("div",{className:`flex ${U.role==="user"?"justify-end":"justify-start"}`,children:n.jsxs("div",{className:`relative group max-w-[90%] p-3 rounded-lg select-text flex gap-2 ${U.role==="user"?"bg-accent text-white shadow-md":"bg-gray-800 border border-gray-700"}`,children:[n.jsx("div",{className:"min-w-0 flex-grow",children:U.role==="model"?n.jsx(NP,{content:U.content}):n.jsx("p",{className:`text-sm whitespace-pre-wrap break-words select-text ${U.role==="user"?"text-white":"text-gray-200"}`,children:U.content})}),U.role==="model"&&n.jsx("div",{className:"flex flex-col justify-start shrink-0 self-stretch",children:n.jsxs("div",{className:"sticky top-2 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col gap-1",children:[n.jsx(Pe,{title:a("node.action.copy"),onClick:q=>{q.stopPropagation(),navigator.clipboard.writeText(U.content),s(a("toast.copiedToClipboard"))},className:"p-1.5 bg-gray-800/80 rounded-md text-gray-400 hover:text-white border border-gray-600 hover:border-gray-500 shadow-sm",tooltipPosition:"left",children:n.jsx(Dt,{className:"h-3 w-3"})}),n.jsx(Pe,{title:a("node.action.downloadTxt"),onClick:q=>{q.stopPropagation(),I(U.content)},className:"p-1.5 bg-gray-800/80 rounded-md text-gray-400 hover:text-white border border-gray-600 hover:border-gray-500 shadow-sm",tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),n.jsx(Pe,{title:a("node.action.downloadDoc"),onClick:q=>{q.stopPropagation(),N(U.content)},className:"p-1.5 bg-gray-800/80 rounded-md text-gray-400 hover:text-white border border-gray-600 hover:border-gray-500 shadow-sm",tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})})]})})]})},R)),r&&n.jsx("div",{className:"flex justify-start",children:n.jsx("div",{className:"p-3 rounded-lg bg-gray-800 border border-gray-700",children:n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce"}),n.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),n.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})})]}),n.jsxs("div",{className:"relative w-full group flex-shrink-0 bg-gray-700 rounded-md border-none focus-within:ring-1 focus-within:ring-node-selected transition-shadow",children:[w&&n.jsxs("div",{className:"absolute -top-8 left-2 bg-gray-800 text-accent-text text-xs px-2 py-1 rounded-t-md border border-accent/50 border-b-0 flex items-center gap-2 max-w-[200px] shadow-sm z-0",children:[n.jsx("span",{className:"truncate",children:w.name}),n.jsx("button",{onClick:U=>{U.stopPropagation(),B()},className:"text-gray-500 hover:text-red-400",title:"Remove attachment",children:""})]}),n.jsx("textarea",{ref:m,value:p,onChange:U=>t(e.id,JSON.stringify({...d,currentInput:U.target.value})),onKeyDown:U=>{U.stopPropagation(),U.key==="Enter"&&!U.shiftKey&&(U.preventDefault(),P())},onKeyUp:U=>U.stopPropagation(),placeholder:a("node.content.chatPlaceholder"),onWheel:U=>U.stopPropagation(),onMouseDown:U=>{U.stopPropagation(),i()},onMouseMove:z,onMouseUp:z,className:"w-full p-2 pr-20 bg-transparent border-none rounded-md resize-none focus:outline-none text-sm text-white placeholder-gray-400",style:{minHeight:"80px",maxHeight:"200px",overflowY:"hidden"}}),n.jsxs("div",{className:"absolute bottom-2 right-2 flex gap-1",children:[n.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx(ut,{content:"  ",position:"top",children:n.jsx("button",{onClick:O,className:"p-1.5 rounded-md transition-colors duration-200 bg-gray-600 hover:bg-gray-500 text-gray-300 hover:text-white",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})})}),n.jsx(ut,{content:" ",position:"top",children:n.jsx("button",{onClick:M,className:`p-1.5 rounded-md transition-colors duration-200 ${w?"bg-accent/20 text-accent-text border border-accent/50":"bg-gray-600 hover:bg-gray-500 text-gray-300 hover:text-white"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})})})]}),n.jsx(ut,{content:"",position:"top",children:n.jsx("button",{onClick:P,disabled:r||!p.trim()&&!w,className:"p-1.5 bg-accent hover:bg-accent-hover rounded-md text-white disabled:bg-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors duration-200",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})})})})]})]})]})},TP=jt.memo(jP);function xs(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var oy={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(e,t){(function(o){e.exports=o()})(function(){return function o(r,a,i){function s(d,u){if(!a[d]){if(!r[d]){var p=typeof xs=="function"&&xs;if(!u&&p)return p(d,!0);if(l)return l(d,!0);var h=new Error("Cannot find module '"+d+"'");throw h.code="MODULE_NOT_FOUND",h}var w=a[d]={exports:{}};r[d][0].call(w.exports,function(k){var b=r[d][1][k];return s(b||k)},w,w.exports,o,r,a,i)}return a[d].exports}for(var l=typeof xs=="function"&&xs,c=0;c<i.length;c++)s(i[c]);return s}({1:[function(o,r,a){var i=o("./utils"),s=o("./support"),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(c){for(var d,u,p,h,w,k,b,y=[],g=0,m=c.length,x=m,_=i.getTypeOf(c)!=="string";g<c.length;)x=m-g,p=_?(d=c[g++],u=g<m?c[g++]:0,g<m?c[g++]:0):(d=c.charCodeAt(g++),u=g<m?c.charCodeAt(g++):0,g<m?c.charCodeAt(g++):0),h=d>>2,w=(3&d)<<4|u>>4,k=1<x?(15&u)<<2|p>>6:64,b=2<x?63&p:64,y.push(l.charAt(h)+l.charAt(w)+l.charAt(k)+l.charAt(b));return y.join("")},a.decode=function(c){var d,u,p,h,w,k,b=0,y=0,g="data:";if(c.substr(0,g.length)===g)throw new Error("Invalid base64 input, it looks like a data url.");var m,x=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===l.charAt(64)&&x--,c.charAt(c.length-2)===l.charAt(64)&&x--,x%1!=0)throw new Error("Invalid base64 input, bad content length.");for(m=s.uint8array?new Uint8Array(0|x):new Array(0|x);b<c.length;)d=l.indexOf(c.charAt(b++))<<2|(h=l.indexOf(c.charAt(b++)))>>4,u=(15&h)<<4|(w=l.indexOf(c.charAt(b++)))>>2,p=(3&w)<<6|(k=l.indexOf(c.charAt(b++))),m[y++]=d,w!==64&&(m[y++]=u),k!==64&&(m[y++]=p);return m}},{"./support":30,"./utils":32}],2:[function(o,r,a){var i=o("./external"),s=o("./stream/DataWorker"),l=o("./stream/Crc32Probe"),c=o("./stream/DataLengthProbe");function d(u,p,h,w,k){this.compressedSize=u,this.uncompressedSize=p,this.crc32=h,this.compression=w,this.compressedContent=k}d.prototype={getContentWorker:function(){var u=new s(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),p=this;return u.on("end",function(){if(this.streamInfo.data_length!==p.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new s(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(u,p,h){return u.pipe(new l).pipe(new c("uncompressedSize")).pipe(p.compressWorker(h)).pipe(new c("compressedSize")).withStreamInfo("compression",p)},r.exports=d},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(o,r,a){var i=o("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},a.DEFLATE=o("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(o,r,a){var i=o("./utils"),s=function(){for(var l,c=[],d=0;d<256;d++){l=d;for(var u=0;u<8;u++)l=1&l?3988292384^l>>>1:l>>>1;c[d]=l}return c}();r.exports=function(l,c){return l!==void 0&&l.length?i.getTypeOf(l)!=="string"?function(d,u,p,h){var w=s,k=h+p;d^=-1;for(var b=h;b<k;b++)d=d>>>8^w[255&(d^u[b])];return-1^d}(0|c,l,l.length,0):function(d,u,p,h){var w=s,k=h+p;d^=-1;for(var b=h;b<k;b++)d=d>>>8^w[255&(d^u.charCodeAt(b))];return-1^d}(0|c,l,l.length,0):0}},{"./utils":32}],5:[function(o,r,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(o,r,a){var i=null;i=typeof Promise<"u"?Promise:o("lie"),r.exports={Promise:i}},{lie:37}],7:[function(o,r,a){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=o("pako"),l=o("./utils"),c=o("./stream/GenericWorker"),d=i?"uint8array":"array";function u(p,h){c.call(this,"FlateWorker/"+p),this._pako=null,this._pakoAction=p,this._pakoOptions=h,this.meta={}}a.magic="\b\0",l.inherits(u,c),u.prototype.processChunk=function(p){this.meta=p.meta,this._pako===null&&this._createPako(),this._pako.push(l.transformTo(d,p.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var p=this;this._pako.onData=function(h){p.push({data:h,meta:p.meta})}},a.compressWorker=function(p){return new u("Deflate",p)},a.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(o,r,a){function i(w,k){var b,y="";for(b=0;b<k;b++)y+=String.fromCharCode(255&w),w>>>=8;return y}function s(w,k,b,y,g,m){var x,_,S=w.file,P=w.compression,j=m!==d.utf8encode,M=l.transformTo("string",m(S.name)),D=l.transformTo("string",d.utf8encode(S.name)),O=S.comment,B=l.transformTo("string",m(O)),E=l.transformTo("string",d.utf8encode(O)),I=D.length!==S.name.length,N=E.length!==O.length,T="",F="",z="",G=S.dir,U=S.date,R={crc32:0,compressedSize:0,uncompressedSize:0};k&&!b||(R.crc32=w.crc32,R.compressedSize=w.compressedSize,R.uncompressedSize=w.uncompressedSize);var q=0;k&&(q|=8),j||!I&&!N||(q|=2048);var H=0,ne=0;G&&(H|=16),g==="UNIX"?(ne=798,H|=function(re,de){var ge=re;return re||(ge=de?16893:33204),(65535&ge)<<16}(S.unixPermissions,G)):(ne=20,H|=function(re){return 63&(re||0)}(S.dosPermissions)),x=U.getUTCHours(),x<<=6,x|=U.getUTCMinutes(),x<<=5,x|=U.getUTCSeconds()/2,_=U.getUTCFullYear()-1980,_<<=4,_|=U.getUTCMonth()+1,_<<=5,_|=U.getUTCDate(),I&&(F=i(1,1)+i(u(M),4)+D,T+="up"+i(F.length,2)+F),N&&(z=i(1,1)+i(u(B),4)+E,T+="uc"+i(z.length,2)+z);var X="";return X+=`
\0`,X+=i(q,2),X+=P.magic,X+=i(x,2),X+=i(_,2),X+=i(R.crc32,4),X+=i(R.compressedSize,4),X+=i(R.uncompressedSize,4),X+=i(M.length,2),X+=i(T.length,2),{fileRecord:p.LOCAL_FILE_HEADER+X+M+T,dirRecord:p.CENTRAL_FILE_HEADER+i(ne,2)+X+i(B.length,2)+"\0\0\0\0"+i(H,4)+i(y,4)+M+T+B}}var l=o("../utils"),c=o("../stream/GenericWorker"),d=o("../utf8"),u=o("../crc32"),p=o("../signature");function h(w,k,b,y){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=k,this.zipPlatform=b,this.encodeFileName=y,this.streamFiles=w,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}l.inherits(h,c),h.prototype.push=function(w){var k=w.meta.percent||0,b=this.entriesCount,y=this._sources.length;this.accumulate?this.contentBuffer.push(w):(this.bytesWritten+=w.data.length,c.prototype.push.call(this,{data:w.data,meta:{currentFile:this.currentFile,percent:b?(k+100*(b-y-1))/b:100}}))},h.prototype.openedSource=function(w){this.currentSourceOffset=this.bytesWritten,this.currentFile=w.file.name;var k=this.streamFiles&&!w.file.dir;if(k){var b=s(w,k,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:b.fileRecord,meta:{percent:0}})}else this.accumulate=!0},h.prototype.closedSource=function(w){this.accumulate=!1;var k=this.streamFiles&&!w.file.dir,b=s(w,k,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(b.dirRecord),k)this.push({data:function(y){return p.DATA_DESCRIPTOR+i(y.crc32,4)+i(y.compressedSize,4)+i(y.uncompressedSize,4)}(w),meta:{percent:100}});else for(this.push({data:b.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},h.prototype.flush=function(){for(var w=this.bytesWritten,k=0;k<this.dirRecords.length;k++)this.push({data:this.dirRecords[k],meta:{percent:100}});var b=this.bytesWritten-w,y=function(g,m,x,_,S){var P=l.transformTo("string",S(_));return p.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(g,2)+i(g,2)+i(m,4)+i(x,4)+i(P.length,2)+P}(this.dirRecords.length,b,w,this.zipComment,this.encodeFileName);this.push({data:y,meta:{percent:100}})},h.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},h.prototype.registerPrevious=function(w){this._sources.push(w);var k=this;return w.on("data",function(b){k.processChunk(b)}),w.on("end",function(){k.closedSource(k.previous.streamInfo),k._sources.length?k.prepareNextSource():k.end()}),w.on("error",function(b){k.error(b)}),this},h.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},h.prototype.error=function(w){var k=this._sources;if(!c.prototype.error.call(this,w))return!1;for(var b=0;b<k.length;b++)try{k[b].error(w)}catch{}return!0},h.prototype.lock=function(){c.prototype.lock.call(this);for(var w=this._sources,k=0;k<w.length;k++)w[k].lock()},r.exports=h},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(o,r,a){var i=o("../compressions"),s=o("./ZipFileWorker");a.generateWorker=function(l,c,d){var u=new s(c.streamFiles,d,c.platform,c.encodeFileName),p=0;try{l.forEach(function(h,w){p++;var k=function(m,x){var _=m||x,S=i[_];if(!S)throw new Error(_+" is not a valid compression method !");return S}(w.options.compression,c.compression),b=w.options.compressionOptions||c.compressionOptions||{},y=w.dir,g=w.date;w._compressWorker(k,b).withStreamInfo("file",{name:h,dir:y,date:g,comment:w.comment||"",unixPermissions:w.unixPermissions,dosPermissions:w.dosPermissions}).pipe(u)}),u.entriesCount=p}catch(h){u.error(h)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(o,r,a){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new i;for(var l in this)typeof this[l]!="function"&&(s[l]=this[l]);return s}}(i.prototype=o("./object")).loadAsync=o("./load"),i.support=o("./support"),i.defaults=o("./defaults"),i.version="3.10.1",i.loadAsync=function(s,l){return new i().loadAsync(s,l)},i.external=o("./external"),r.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(o,r,a){var i=o("./utils"),s=o("./external"),l=o("./utf8"),c=o("./zipEntries"),d=o("./stream/Crc32Probe"),u=o("./nodejsUtils");function p(h){return new s.Promise(function(w,k){var b=h.decompressed.getContentWorker().pipe(new d);b.on("error",function(y){k(y)}).on("end",function(){b.streamInfo.crc32!==h.decompressed.crc32?k(new Error("Corrupted zip : CRC32 mismatch")):w()}).resume()})}r.exports=function(h,w){var k=this;return w=i.extend(w||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:l.utf8decode}),u.isNode&&u.isStream(h)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",h,!0,w.optimizedBinaryString,w.base64).then(function(b){var y=new c(w);return y.load(b),y}).then(function(b){var y=[s.Promise.resolve(b)],g=b.files;if(w.checkCRC32)for(var m=0;m<g.length;m++)y.push(p(g[m]));return s.Promise.all(y)}).then(function(b){for(var y=b.shift(),g=y.files,m=0;m<g.length;m++){var x=g[m],_=x.fileNameStr,S=i.resolve(x.fileNameStr);k.file(S,x.decompressed,{binary:!0,optimizedBinaryString:!0,date:x.date,dir:x.dir,comment:x.fileCommentStr.length?x.fileCommentStr:null,unixPermissions:x.unixPermissions,dosPermissions:x.dosPermissions,createFolders:w.createFolders}),x.dir||(k.file(S).unsafeOriginalName=_)}return y.zipComment.length&&(k.comment=y.zipComment),k})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(o,r,a){var i=o("../utils"),s=o("../stream/GenericWorker");function l(c,d){s.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(d)}i.inherits(l,s),l.prototype._bindStream=function(c){var d=this;(this._stream=c).pause(),c.on("data",function(u){d.push({data:u,meta:{percent:0}})}).on("error",function(u){d.isPaused?this.generatedError=u:d.error(u)}).on("end",function(){d.isPaused?d._upstreamEnded=!0:d.end()})},l.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},l.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=l},{"../stream/GenericWorker":28,"../utils":32}],13:[function(o,r,a){var i=o("readable-stream").Readable;function s(l,c,d){i.call(this,c),this._helper=l;var u=this;l.on("data",function(p,h){u.push(p)||u._helper.pause(),d&&d(h)}).on("error",function(p){u.emit("error",p)}).on("end",function(){u.push(null)})}o("../utils").inherits(s,i),s.prototype._read=function(){this._helper.resume()},r.exports=s},{"../utils":32,"readable-stream":16}],14:[function(o,r,a){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,s);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,s)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var s=new Buffer(i);return s.fill(0),s},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(o,r,a){function i(S,P,j){var M,D=l.getTypeOf(P),O=l.extend(j||{},u);O.date=O.date||new Date,O.compression!==null&&(O.compression=O.compression.toUpperCase()),typeof O.unixPermissions=="string"&&(O.unixPermissions=parseInt(O.unixPermissions,8)),O.unixPermissions&&16384&O.unixPermissions&&(O.dir=!0),O.dosPermissions&&16&O.dosPermissions&&(O.dir=!0),O.dir&&(S=g(S)),O.createFolders&&(M=y(S))&&m.call(this,M,!0);var B=D==="string"&&O.binary===!1&&O.base64===!1;j&&j.binary!==void 0||(O.binary=!B),(P instanceof p&&P.uncompressedSize===0||O.dir||!P||P.length===0)&&(O.base64=!1,O.binary=!0,P="",O.compression="STORE",D="string");var E=null;E=P instanceof p||P instanceof c?P:k.isNode&&k.isStream(P)?new b(S,P):l.prepareContent(S,P,O.binary,O.optimizedBinaryString,O.base64);var I=new h(S,E,O);this.files[S]=I}var s=o("./utf8"),l=o("./utils"),c=o("./stream/GenericWorker"),d=o("./stream/StreamHelper"),u=o("./defaults"),p=o("./compressedObject"),h=o("./zipObject"),w=o("./generate"),k=o("./nodejsUtils"),b=o("./nodejs/NodejsStreamInputAdapter"),y=function(S){S.slice(-1)==="/"&&(S=S.substring(0,S.length-1));var P=S.lastIndexOf("/");return 0<P?S.substring(0,P):""},g=function(S){return S.slice(-1)!=="/"&&(S+="/"),S},m=function(S,P){return P=P!==void 0?P:u.createFolders,S=g(S),this.files[S]||i.call(this,S,null,{dir:!0,createFolders:P}),this.files[S]};function x(S){return Object.prototype.toString.call(S)==="[object RegExp]"}var _={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(S){var P,j,M;for(P in this.files)M=this.files[P],(j=P.slice(this.root.length,P.length))&&P.slice(0,this.root.length)===this.root&&S(j,M)},filter:function(S){var P=[];return this.forEach(function(j,M){S(j,M)&&P.push(M)}),P},file:function(S,P,j){if(arguments.length!==1)return S=this.root+S,i.call(this,S,P,j),this;if(x(S)){var M=S;return this.filter(function(O,B){return!B.dir&&M.test(O)})}var D=this.files[this.root+S];return D&&!D.dir?D:null},folder:function(S){if(!S)return this;if(x(S))return this.filter(function(D,O){return O.dir&&S.test(D)});var P=this.root+S,j=m.call(this,P),M=this.clone();return M.root=j.name,M},remove:function(S){S=this.root+S;var P=this.files[S];if(P||(S.slice(-1)!=="/"&&(S+="/"),P=this.files[S]),P&&!P.dir)delete this.files[S];else for(var j=this.filter(function(D,O){return O.name.slice(0,S.length)===S}),M=0;M<j.length;M++)delete this.files[j[M].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(S){var P,j={};try{if((j=l.extend(S||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=j.type.toLowerCase(),j.compression=j.compression.toUpperCase(),j.type==="binarystring"&&(j.type="string"),!j.type)throw new Error("No output type specified.");l.checkSupport(j.type),j.platform!=="darwin"&&j.platform!=="freebsd"&&j.platform!=="linux"&&j.platform!=="sunos"||(j.platform="UNIX"),j.platform==="win32"&&(j.platform="DOS");var M=j.comment||this.comment||"";P=w.generateWorker(this,j,M)}catch(D){(P=new c("error")).error(D)}return new d(P,j.type||"string",j.mimeType)},generateAsync:function(S,P){return this.generateInternalStream(S).accumulate(P)},generateNodeStream:function(S,P){return(S=S||{}).type||(S.type="nodebuffer"),this.generateInternalStream(S).toNodejsStream(P)}};r.exports=_},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(o,r,a){r.exports=o("stream")},{stream:void 0}],17:[function(o,r,a){var i=o("./DataReader");function s(l){i.call(this,l);for(var c=0;c<this.data.length;c++)l[c]=255&l[c]}o("../utils").inherits(s,i),s.prototype.byteAt=function(l){return this.data[this.zero+l]},s.prototype.lastIndexOfSignature=function(l){for(var c=l.charCodeAt(0),d=l.charCodeAt(1),u=l.charCodeAt(2),p=l.charCodeAt(3),h=this.length-4;0<=h;--h)if(this.data[h]===c&&this.data[h+1]===d&&this.data[h+2]===u&&this.data[h+3]===p)return h-this.zero;return-1},s.prototype.readAndCheckSignature=function(l){var c=l.charCodeAt(0),d=l.charCodeAt(1),u=l.charCodeAt(2),p=l.charCodeAt(3),h=this.readData(4);return c===h[0]&&d===h[1]&&u===h[2]&&p===h[3]},s.prototype.readData=function(l){if(this.checkOffset(l),l===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=s},{"../utils":32,"./DataReader":18}],18:[function(o,r,a){var i=o("../utils");function s(l){this.data=l,this.length=l.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(l){this.checkIndex(this.index+l)},checkIndex:function(l){if(this.length<this.zero+l||l<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+l+"). Corrupted zip ?")},setIndex:function(l){this.checkIndex(l),this.index=l},skip:function(l){this.setIndex(this.index+l)},byteAt:function(){},readInt:function(l){var c,d=0;for(this.checkOffset(l),c=this.index+l-1;c>=this.index;c--)d=(d<<8)+this.byteAt(c);return this.index+=l,d},readString:function(l){return i.transformTo("string",this.readData(l))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var l=this.readInt(4);return new Date(Date.UTC(1980+(l>>25&127),(l>>21&15)-1,l>>16&31,l>>11&31,l>>5&63,(31&l)<<1))}},r.exports=s},{"../utils":32}],19:[function(o,r,a){var i=o("./Uint8ArrayReader");function s(l){i.call(this,l)}o("../utils").inherits(s,i),s.prototype.readData=function(l){this.checkOffset(l);var c=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(o,r,a){var i=o("./DataReader");function s(l){i.call(this,l)}o("../utils").inherits(s,i),s.prototype.byteAt=function(l){return this.data.charCodeAt(this.zero+l)},s.prototype.lastIndexOfSignature=function(l){return this.data.lastIndexOf(l)-this.zero},s.prototype.readAndCheckSignature=function(l){return l===this.readData(4)},s.prototype.readData=function(l){this.checkOffset(l);var c=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=s},{"../utils":32,"./DataReader":18}],21:[function(o,r,a){var i=o("./ArrayReader");function s(l){i.call(this,l)}o("../utils").inherits(s,i),s.prototype.readData=function(l){if(this.checkOffset(l),l===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(o,r,a){var i=o("../utils"),s=o("../support"),l=o("./ArrayReader"),c=o("./StringReader"),d=o("./NodeBufferReader"),u=o("./Uint8ArrayReader");r.exports=function(p){var h=i.getTypeOf(p);return i.checkSupport(h),h!=="string"||s.uint8array?h==="nodebuffer"?new d(p):s.uint8array?new u(i.transformTo("uint8array",p)):new l(i.transformTo("array",p)):new c(p)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(o,r,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(o,r,a){var i=o("./GenericWorker"),s=o("../utils");function l(c){i.call(this,"ConvertWorker to "+c),this.destType=c}s.inherits(l,i),l.prototype.processChunk=function(c){this.push({data:s.transformTo(this.destType,c.data),meta:c.meta})},r.exports=l},{"../utils":32,"./GenericWorker":28}],25:[function(o,r,a){var i=o("./GenericWorker"),s=o("../crc32");function l(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}o("../utils").inherits(l,i),l.prototype.processChunk=function(c){this.streamInfo.crc32=s(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=l},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(o,r,a){var i=o("../utils"),s=o("./GenericWorker");function l(c){s.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}i.inherits(l,s),l.prototype.processChunk=function(c){if(c){var d=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=d+c.data.length}s.prototype.processChunk.call(this,c)},r.exports=l},{"../utils":32,"./GenericWorker":28}],27:[function(o,r,a){var i=o("../utils"),s=o("./GenericWorker");function l(c){s.call(this,"DataWorker");var d=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){d.dataIsReady=!0,d.data=u,d.max=u&&u.length||0,d.type=i.getTypeOf(u),d.isPaused||d._tickAndRepeat()},function(u){d.error(u)})}i.inherits(l,s),l.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},l.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},l.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},l.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,d=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,d);break;case"uint8array":c=this.data.subarray(this.index,d);break;case"array":case"nodebuffer":c=this.data.slice(this.index,d)}return this.index=d,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=l},{"../utils":32,"./GenericWorker":28}],28:[function(o,r,a){function i(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,l){return this._listeners[s].push(l),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,l){if(this._listeners[s])for(var c=0;c<this._listeners[s].length;c++)this._listeners[s][c].call(this,l)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var l=this;return s.on("data",function(c){l.processChunk(c)}),s.on("end",function(){l.end()}),s.on("error",function(c){l.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,l){return this.extraStreamInfo[s]=l,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},r.exports=i},{}],29:[function(o,r,a){var i=o("../utils"),s=o("./ConvertWorker"),l=o("./GenericWorker"),c=o("../base64"),d=o("../support"),u=o("../external"),p=null;if(d.nodestream)try{p=o("../nodejs/NodejsStreamOutputAdapter")}catch{}function h(k,b){return new u.Promise(function(y,g){var m=[],x=k._internalType,_=k._outputType,S=k._mimeType;k.on("data",function(P,j){m.push(P),b&&b(j)}).on("error",function(P){m=[],g(P)}).on("end",function(){try{var P=function(j,M,D){switch(j){case"blob":return i.newBlob(i.transformTo("arraybuffer",M),D);case"base64":return c.encode(M);default:return i.transformTo(j,M)}}(_,function(j,M){var D,O=0,B=null,E=0;for(D=0;D<M.length;D++)E+=M[D].length;switch(j){case"string":return M.join("");case"array":return Array.prototype.concat.apply([],M);case"uint8array":for(B=new Uint8Array(E),D=0;D<M.length;D++)B.set(M[D],O),O+=M[D].length;return B;case"nodebuffer":return Buffer.concat(M);default:throw new Error("concat : unsupported type '"+j+"'")}}(x,m),S);y(P)}catch(j){g(j)}m=[]}).resume()})}function w(k,b,y){var g=b;switch(b){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string"}try{this._internalType=g,this._outputType=b,this._mimeType=y,i.checkSupport(g),this._worker=k.pipe(new s(g)),k.lock()}catch(m){this._worker=new l("error"),this._worker.error(m)}}w.prototype={accumulate:function(k){return h(this,k)},on:function(k,b){var y=this;return k==="data"?this._worker.on(k,function(g){b.call(y,g.data,g.meta)}):this._worker.on(k,function(){i.delay(b,arguments,y)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(k){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:this._outputType!=="nodebuffer"},k)}},r.exports=w},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(o,r,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var i=new ArrayBuffer(0);try{a.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(i),a.blob=s.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!o("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(o,r,a){for(var i=o("./utils"),s=o("./support"),l=o("./nodejsUtils"),c=o("./stream/GenericWorker"),d=new Array(256),u=0;u<256;u++)d[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;d[254]=d[254]=1;function p(){c.call(this,"utf-8 decode"),this.leftOver=null}function h(){c.call(this,"utf-8 encode")}a.utf8encode=function(w){return s.nodebuffer?l.newBufferFrom(w,"utf-8"):function(k){var b,y,g,m,x,_=k.length,S=0;for(m=0;m<_;m++)(64512&(y=k.charCodeAt(m)))==55296&&m+1<_&&(64512&(g=k.charCodeAt(m+1)))==56320&&(y=65536+(y-55296<<10)+(g-56320),m++),S+=y<128?1:y<2048?2:y<65536?3:4;for(b=s.uint8array?new Uint8Array(S):new Array(S),m=x=0;x<S;m++)(64512&(y=k.charCodeAt(m)))==55296&&m+1<_&&(64512&(g=k.charCodeAt(m+1)))==56320&&(y=65536+(y-55296<<10)+(g-56320),m++),y<128?b[x++]=y:(y<2048?b[x++]=192|y>>>6:(y<65536?b[x++]=224|y>>>12:(b[x++]=240|y>>>18,b[x++]=128|y>>>12&63),b[x++]=128|y>>>6&63),b[x++]=128|63&y);return b}(w)},a.utf8decode=function(w){return s.nodebuffer?i.transformTo("nodebuffer",w).toString("utf-8"):function(k){var b,y,g,m,x=k.length,_=new Array(2*x);for(b=y=0;b<x;)if((g=k[b++])<128)_[y++]=g;else if(4<(m=d[g]))_[y++]=65533,b+=m-1;else{for(g&=m===2?31:m===3?15:7;1<m&&b<x;)g=g<<6|63&k[b++],m--;1<m?_[y++]=65533:g<65536?_[y++]=g:(g-=65536,_[y++]=55296|g>>10&1023,_[y++]=56320|1023&g)}return _.length!==y&&(_.subarray?_=_.subarray(0,y):_.length=y),i.applyFromCharCode(_)}(w=i.transformTo(s.uint8array?"uint8array":"array",w))},i.inherits(p,c),p.prototype.processChunk=function(w){var k=i.transformTo(s.uint8array?"uint8array":"array",w.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var b=k;(k=new Uint8Array(b.length+this.leftOver.length)).set(this.leftOver,0),k.set(b,this.leftOver.length)}else k=this.leftOver.concat(k);this.leftOver=null}var y=function(m,x){var _;for((x=x||m.length)>m.length&&(x=m.length),_=x-1;0<=_&&(192&m[_])==128;)_--;return _<0||_===0?x:_+d[m[_]]>x?_:x}(k),g=k;y!==k.length&&(s.uint8array?(g=k.subarray(0,y),this.leftOver=k.subarray(y,k.length)):(g=k.slice(0,y),this.leftOver=k.slice(y,k.length))),this.push({data:a.utf8decode(g),meta:w.meta})},p.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=p,i.inherits(h,c),h.prototype.processChunk=function(w){this.push({data:a.utf8encode(w.data),meta:w.meta})},a.Utf8EncodeWorker=h},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(o,r,a){var i=o("./support"),s=o("./base64"),l=o("./nodejsUtils"),c=o("./external");function d(b){return b}function u(b,y){for(var g=0;g<b.length;++g)y[g]=255&b.charCodeAt(g);return y}o("setimmediate"),a.newBlob=function(b,y){a.checkSupport("blob");try{return new Blob([b],{type:y})}catch{try{var g=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return g.append(b),g.getBlob(y)}catch{throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(b,y,g){var m=[],x=0,_=b.length;if(_<=g)return String.fromCharCode.apply(null,b);for(;x<_;)y==="array"||y==="nodebuffer"?m.push(String.fromCharCode.apply(null,b.slice(x,Math.min(x+g,_)))):m.push(String.fromCharCode.apply(null,b.subarray(x,Math.min(x+g,_)))),x+=g;return m.join("")},stringifyByChar:function(b){for(var y="",g=0;g<b.length;g++)y+=String.fromCharCode(b[g]);return y},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,l.allocBuffer(1)).length===1}catch{return!1}}()}};function h(b){var y=65536,g=a.getTypeOf(b),m=!0;if(g==="uint8array"?m=p.applyCanBeUsed.uint8array:g==="nodebuffer"&&(m=p.applyCanBeUsed.nodebuffer),m)for(;1<y;)try{return p.stringifyByChunk(b,g,y)}catch{y=Math.floor(y/2)}return p.stringifyByChar(b)}function w(b,y){for(var g=0;g<b.length;g++)y[g]=b[g];return y}a.applyFromCharCode=h;var k={};k.string={string:d,array:function(b){return u(b,new Array(b.length))},arraybuffer:function(b){return k.string.uint8array(b).buffer},uint8array:function(b){return u(b,new Uint8Array(b.length))},nodebuffer:function(b){return u(b,l.allocBuffer(b.length))}},k.array={string:h,array:d,arraybuffer:function(b){return new Uint8Array(b).buffer},uint8array:function(b){return new Uint8Array(b)},nodebuffer:function(b){return l.newBufferFrom(b)}},k.arraybuffer={string:function(b){return h(new Uint8Array(b))},array:function(b){return w(new Uint8Array(b),new Array(b.byteLength))},arraybuffer:d,uint8array:function(b){return new Uint8Array(b)},nodebuffer:function(b){return l.newBufferFrom(new Uint8Array(b))}},k.uint8array={string:h,array:function(b){return w(b,new Array(b.length))},arraybuffer:function(b){return b.buffer},uint8array:d,nodebuffer:function(b){return l.newBufferFrom(b)}},k.nodebuffer={string:h,array:function(b){return w(b,new Array(b.length))},arraybuffer:function(b){return k.nodebuffer.uint8array(b).buffer},uint8array:function(b){return w(b,new Uint8Array(b.length))},nodebuffer:d},a.transformTo=function(b,y){if(y=y||"",!b)return y;a.checkSupport(b);var g=a.getTypeOf(y);return k[g][b](y)},a.resolve=function(b){for(var y=b.split("/"),g=[],m=0;m<y.length;m++){var x=y[m];x==="."||x===""&&m!==0&&m!==y.length-1||(x===".."?g.pop():g.push(x))}return g.join("/")},a.getTypeOf=function(b){return typeof b=="string"?"string":Object.prototype.toString.call(b)==="[object Array]"?"array":i.nodebuffer&&l.isBuffer(b)?"nodebuffer":i.uint8array&&b instanceof Uint8Array?"uint8array":i.arraybuffer&&b instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(b){if(!i[b.toLowerCase()])throw new Error(b+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(b){var y,g,m="";for(g=0;g<(b||"").length;g++)m+="\\x"+((y=b.charCodeAt(g))<16?"0":"")+y.toString(16).toUpperCase();return m},a.delay=function(b,y,g){setImmediate(function(){b.apply(g||null,y||[])})},a.inherits=function(b,y){function g(){}g.prototype=y.prototype,b.prototype=new g},a.extend=function(){var b,y,g={};for(b=0;b<arguments.length;b++)for(y in arguments[b])Object.prototype.hasOwnProperty.call(arguments[b],y)&&g[y]===void 0&&(g[y]=arguments[b][y]);return g},a.prepareContent=function(b,y,g,m,x){return c.Promise.resolve(y).then(function(_){return i.blob&&(_ instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(_))!==-1)&&typeof FileReader<"u"?new c.Promise(function(S,P){var j=new FileReader;j.onload=function(M){S(M.target.result)},j.onerror=function(M){P(M.target.error)},j.readAsArrayBuffer(_)}):_}).then(function(_){var S=a.getTypeOf(_);return S?(S==="arraybuffer"?_=a.transformTo("uint8array",_):S==="string"&&(x?_=s.decode(_):g&&m!==!0&&(_=function(P){return u(P,i.uint8array?new Uint8Array(P.length):new Array(P.length))}(_))),_):c.Promise.reject(new Error("Can't read the data of '"+b+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(o,r,a){var i=o("./reader/readerFor"),s=o("./utils"),l=o("./signature"),c=o("./zipEntry"),d=o("./support");function u(p){this.files=[],this.loadOptions=p}u.prototype={checkSignature:function(p){if(!this.reader.readAndCheckSignature(p)){this.reader.index-=4;var h=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(h)+", expected "+s.pretty(p)+")")}},isSignature:function(p,h){var w=this.reader.index;this.reader.setIndex(p);var k=this.reader.readString(4)===h;return this.reader.setIndex(w),k},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var p=this.reader.readData(this.zipCommentLength),h=d.uint8array?"uint8array":"array",w=s.transformTo(h,p);this.zipComment=this.loadOptions.decodeFileName(w)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var p,h,w,k=this.zip64EndOfCentralSize-44;0<k;)p=this.reader.readInt(2),h=this.reader.readInt(4),w=this.reader.readData(h),this.zip64ExtensibleData[p]={id:p,length:h,value:w}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var p,h;for(p=0;p<this.files.length;p++)h=this.files[p],this.reader.setIndex(h.localHeaderOffset),this.checkSignature(l.LOCAL_FILE_HEADER),h.readLocalPart(this.reader),h.handleUTF8(),h.processAttributes()},readCentralDir:function(){var p;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(l.CENTRAL_FILE_HEADER);)(p=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(p);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var p=this.reader.lastIndexOfSignature(l.CENTRAL_DIRECTORY_END);if(p<0)throw this.isSignature(0,l.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(p);var h=p;if(this.checkSignature(l.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(p=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(p),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,l.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var w=this.centralDirOffset+this.centralDirSize;this.zip64&&(w+=20,w+=12+this.zip64EndOfCentralSize);var k=h-w;if(0<k)this.isSignature(h,l.CENTRAL_FILE_HEADER)||(this.reader.zero=k);else if(k<0)throw new Error("Corrupted zip: missing "+Math.abs(k)+" bytes.")},prepareReader:function(p){this.reader=i(p)},load:function(p){this.prepareReader(p),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(o,r,a){var i=o("./reader/readerFor"),s=o("./utils"),l=o("./compressedObject"),c=o("./crc32"),d=o("./utf8"),u=o("./compressions"),p=o("./support");function h(w,k){this.options=w,this.loadOptions=k}h.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(w){var k,b;if(w.skip(22),this.fileNameLength=w.readInt(2),b=w.readInt(2),this.fileName=w.readData(this.fileNameLength),w.skip(b),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((k=function(y){for(var g in u)if(Object.prototype.hasOwnProperty.call(u,g)&&u[g].magic===y)return u[g];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new l(this.compressedSize,this.uncompressedSize,this.crc32,k,w.readData(this.compressedSize))},readCentralPart:function(w){this.versionMadeBy=w.readInt(2),w.skip(2),this.bitFlag=w.readInt(2),this.compressionMethod=w.readString(2),this.date=w.readDate(),this.crc32=w.readInt(4),this.compressedSize=w.readInt(4),this.uncompressedSize=w.readInt(4);var k=w.readInt(2);if(this.extraFieldsLength=w.readInt(2),this.fileCommentLength=w.readInt(2),this.diskNumberStart=w.readInt(2),this.internalFileAttributes=w.readInt(2),this.externalFileAttributes=w.readInt(4),this.localHeaderOffset=w.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");w.skip(k),this.readExtraFields(w),this.parseZIP64ExtraField(w),this.fileComment=w.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var w=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),w==0&&(this.dosPermissions=63&this.externalFileAttributes),w==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var w=i(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=w.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=w.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=w.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=w.readInt(4))}},readExtraFields:function(w){var k,b,y,g=w.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});w.index+4<g;)k=w.readInt(2),b=w.readInt(2),y=w.readData(b),this.extraFields[k]={id:k,length:b,value:y};w.setIndex(g)},handleUTF8:function(){var w=p.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=d.utf8decode(this.fileName),this.fileCommentStr=d.utf8decode(this.fileComment);else{var k=this.findExtraFieldUnicodePath();if(k!==null)this.fileNameStr=k;else{var b=s.transformTo(w,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(b)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var g=s.transformTo(w,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(g)}}},findExtraFieldUnicodePath:function(){var w=this.extraFields[28789];if(w){var k=i(w.value);return k.readInt(1)!==1||c(this.fileName)!==k.readInt(4)?null:d.utf8decode(k.readData(w.length-5))}return null},findExtraFieldUnicodeComment:function(){var w=this.extraFields[25461];if(w){var k=i(w.value);return k.readInt(1)!==1||c(this.fileComment)!==k.readInt(4)?null:d.utf8decode(k.readData(w.length-5))}return null}},r.exports=h},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(o,r,a){function i(k,b,y){this.name=k,this.dir=y.dir,this.date=y.date,this.comment=y.comment,this.unixPermissions=y.unixPermissions,this.dosPermissions=y.dosPermissions,this._data=b,this._dataBinary=y.binary,this.options={compression:y.compression,compressionOptions:y.compressionOptions}}var s=o("./stream/StreamHelper"),l=o("./stream/DataWorker"),c=o("./utf8"),d=o("./compressedObject"),u=o("./stream/GenericWorker");i.prototype={internalStream:function(k){var b=null,y="string";try{if(!k)throw new Error("No output type specified.");var g=(y=k.toLowerCase())==="string"||y==="text";y!=="binarystring"&&y!=="text"||(y="string"),b=this._decompressWorker();var m=!this._dataBinary;m&&!g&&(b=b.pipe(new c.Utf8EncodeWorker)),!m&&g&&(b=b.pipe(new c.Utf8DecodeWorker))}catch(x){(b=new u("error")).error(x)}return new s(b,y,"")},async:function(k,b){return this.internalStream(k).accumulate(b)},nodeStream:function(k,b){return this.internalStream(k||"nodebuffer").toNodejsStream(b)},_compressWorker:function(k,b){if(this._data instanceof d&&this._data.compression.magic===k.magic)return this._data.getCompressedWorker();var y=this._decompressWorker();return this._dataBinary||(y=y.pipe(new c.Utf8EncodeWorker)),d.createWorkerFrom(y,k,b)},_decompressWorker:function(){return this._data instanceof d?this._data.getContentWorker():this._data instanceof u?this._data:new l(this._data)}};for(var p=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},w=0;w<p.length;w++)i.prototype[p[w]]=h;r.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(o,r,a){(function(i){var s,l,c=i.MutationObserver||i.WebKitMutationObserver;if(c){var d=0,u=new c(k),p=i.document.createTextNode("");u.observe(p,{characterData:!0}),s=function(){p.data=d=++d%2}}else if(i.setImmediate||i.MessageChannel===void 0)s="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var b=i.document.createElement("script");b.onreadystatechange=function(){k(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},i.document.documentElement.appendChild(b)}:function(){setTimeout(k,0)};else{var h=new i.MessageChannel;h.port1.onmessage=k,s=function(){h.port2.postMessage(0)}}var w=[];function k(){var b,y;l=!0;for(var g=w.length;g;){for(y=w,w=[],b=-1;++b<g;)y[b]();g=w.length}l=!1}r.exports=function(b){w.push(b)!==1||l||s()}}).call(this,typeof Vi<"u"?Vi:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(o,r,a){var i=o("immediate");function s(){}var l={},c=["REJECTED"],d=["FULFILLED"],u=["PENDING"];function p(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,g!==s&&b(this,g)}function h(g,m,x){this.promise=g,typeof m=="function"&&(this.onFulfilled=m,this.callFulfilled=this.otherCallFulfilled),typeof x=="function"&&(this.onRejected=x,this.callRejected=this.otherCallRejected)}function w(g,m,x){i(function(){var _;try{_=m(x)}catch(S){return l.reject(g,S)}_===g?l.reject(g,new TypeError("Cannot resolve promise with itself")):l.resolve(g,_)})}function k(g){var m=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof m=="function")return function(){m.apply(g,arguments)}}function b(g,m){var x=!1;function _(j){x||(x=!0,l.reject(g,j))}function S(j){x||(x=!0,l.resolve(g,j))}var P=y(function(){m(S,_)});P.status==="error"&&_(P.value)}function y(g,m){var x={};try{x.value=g(m),x.status="success"}catch(_){x.status="error",x.value=_}return x}(r.exports=p).prototype.finally=function(g){if(typeof g!="function")return this;var m=this.constructor;return this.then(function(x){return m.resolve(g()).then(function(){return x})},function(x){return m.resolve(g()).then(function(){throw x})})},p.prototype.catch=function(g){return this.then(null,g)},p.prototype.then=function(g,m){if(typeof g!="function"&&this.state===d||typeof m!="function"&&this.state===c)return this;var x=new this.constructor(s);return this.state!==u?w(x,this.state===d?g:m,this.outcome):this.queue.push(new h(x,g,m)),x},h.prototype.callFulfilled=function(g){l.resolve(this.promise,g)},h.prototype.otherCallFulfilled=function(g){w(this.promise,this.onFulfilled,g)},h.prototype.callRejected=function(g){l.reject(this.promise,g)},h.prototype.otherCallRejected=function(g){w(this.promise,this.onRejected,g)},l.resolve=function(g,m){var x=y(k,m);if(x.status==="error")return l.reject(g,x.value);var _=x.value;if(_)b(g,_);else{g.state=d,g.outcome=m;for(var S=-1,P=g.queue.length;++S<P;)g.queue[S].callFulfilled(m)}return g},l.reject=function(g,m){g.state=c,g.outcome=m;for(var x=-1,_=g.queue.length;++x<_;)g.queue[x].callRejected(m);return g},p.resolve=function(g){return g instanceof this?g:l.resolve(new this(s),g)},p.reject=function(g){var m=new this(s);return l.reject(m,g)},p.all=function(g){var m=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=g.length,_=!1;if(!x)return this.resolve([]);for(var S=new Array(x),P=0,j=-1,M=new this(s);++j<x;)D(g[j],j);return M;function D(O,B){m.resolve(O).then(function(E){S[B]=E,++P!==x||_||(_=!0,l.resolve(M,S))},function(E){_||(_=!0,l.reject(M,E))})}},p.race=function(g){var m=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=g.length,_=!1;if(!x)return this.resolve([]);for(var S=-1,P=new this(s);++S<x;)j=g[S],m.resolve(j).then(function(M){_||(_=!0,l.resolve(P,M))},function(M){_||(_=!0,l.reject(P,M))});var j;return P}},{immediate:36}],38:[function(o,r,a){var i={};(0,o("./lib/utils/common").assign)(i,o("./lib/deflate"),o("./lib/inflate"),o("./lib/zlib/constants")),r.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(o,r,a){var i=o("./zlib/deflate"),s=o("./utils/common"),l=o("./utils/strings"),c=o("./zlib/messages"),d=o("./zlib/zstream"),u=Object.prototype.toString,p=0,h=-1,w=0,k=8;function b(g){if(!(this instanceof b))return new b(g);this.options=s.assign({level:h,method:k,chunkSize:16384,windowBits:15,memLevel:8,strategy:w,to:""},g||{});var m=this.options;m.raw&&0<m.windowBits?m.windowBits=-m.windowBits:m.gzip&&0<m.windowBits&&m.windowBits<16&&(m.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var x=i.deflateInit2(this.strm,m.level,m.method,m.windowBits,m.memLevel,m.strategy);if(x!==p)throw new Error(c[x]);if(m.header&&i.deflateSetHeader(this.strm,m.header),m.dictionary){var _;if(_=typeof m.dictionary=="string"?l.string2buf(m.dictionary):u.call(m.dictionary)==="[object ArrayBuffer]"?new Uint8Array(m.dictionary):m.dictionary,(x=i.deflateSetDictionary(this.strm,_))!==p)throw new Error(c[x]);this._dict_set=!0}}function y(g,m){var x=new b(m);if(x.push(g,!0),x.err)throw x.msg||c[x.err];return x.result}b.prototype.push=function(g,m){var x,_,S=this.strm,P=this.options.chunkSize;if(this.ended)return!1;_=m===~~m?m:m===!0?4:0,typeof g=="string"?S.input=l.string2buf(g):u.call(g)==="[object ArrayBuffer]"?S.input=new Uint8Array(g):S.input=g,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new s.Buf8(P),S.next_out=0,S.avail_out=P),(x=i.deflate(S,_))!==1&&x!==p)return this.onEnd(x),!(this.ended=!0);S.avail_out!==0&&(S.avail_in!==0||_!==4&&_!==2)||(this.options.to==="string"?this.onData(l.buf2binstring(s.shrinkBuf(S.output,S.next_out))):this.onData(s.shrinkBuf(S.output,S.next_out)))}while((0<S.avail_in||S.avail_out===0)&&x!==1);return _===4?(x=i.deflateEnd(this.strm),this.onEnd(x),this.ended=!0,x===p):_!==2||(this.onEnd(p),!(S.avail_out=0))},b.prototype.onData=function(g){this.chunks.push(g)},b.prototype.onEnd=function(g){g===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},a.Deflate=b,a.deflate=y,a.deflateRaw=function(g,m){return(m=m||{}).raw=!0,y(g,m)},a.gzip=function(g,m){return(m=m||{}).gzip=!0,y(g,m)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(o,r,a){var i=o("./zlib/inflate"),s=o("./utils/common"),l=o("./utils/strings"),c=o("./zlib/constants"),d=o("./zlib/messages"),u=o("./zlib/zstream"),p=o("./zlib/gzheader"),h=Object.prototype.toString;function w(b){if(!(this instanceof w))return new w(b);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},b||{});var y=this.options;y.raw&&0<=y.windowBits&&y.windowBits<16&&(y.windowBits=-y.windowBits,y.windowBits===0&&(y.windowBits=-15)),!(0<=y.windowBits&&y.windowBits<16)||b&&b.windowBits||(y.windowBits+=32),15<y.windowBits&&y.windowBits<48&&!(15&y.windowBits)&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var g=i.inflateInit2(this.strm,y.windowBits);if(g!==c.Z_OK)throw new Error(d[g]);this.header=new p,i.inflateGetHeader(this.strm,this.header)}function k(b,y){var g=new w(y);if(g.push(b,!0),g.err)throw g.msg||d[g.err];return g.result}w.prototype.push=function(b,y){var g,m,x,_,S,P,j=this.strm,M=this.options.chunkSize,D=this.options.dictionary,O=!1;if(this.ended)return!1;m=y===~~y?y:y===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof b=="string"?j.input=l.binstring2buf(b):h.call(b)==="[object ArrayBuffer]"?j.input=new Uint8Array(b):j.input=b,j.next_in=0,j.avail_in=j.input.length;do{if(j.avail_out===0&&(j.output=new s.Buf8(M),j.next_out=0,j.avail_out=M),(g=i.inflate(j,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&D&&(P=typeof D=="string"?l.string2buf(D):h.call(D)==="[object ArrayBuffer]"?new Uint8Array(D):D,g=i.inflateSetDictionary(this.strm,P)),g===c.Z_BUF_ERROR&&O===!0&&(g=c.Z_OK,O=!1),g!==c.Z_STREAM_END&&g!==c.Z_OK)return this.onEnd(g),!(this.ended=!0);j.next_out&&(j.avail_out!==0&&g!==c.Z_STREAM_END&&(j.avail_in!==0||m!==c.Z_FINISH&&m!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(x=l.utf8border(j.output,j.next_out),_=j.next_out-x,S=l.buf2string(j.output,x),j.next_out=_,j.avail_out=M-_,_&&s.arraySet(j.output,j.output,x,_,0),this.onData(S)):this.onData(s.shrinkBuf(j.output,j.next_out)))),j.avail_in===0&&j.avail_out===0&&(O=!0)}while((0<j.avail_in||j.avail_out===0)&&g!==c.Z_STREAM_END);return g===c.Z_STREAM_END&&(m=c.Z_FINISH),m===c.Z_FINISH?(g=i.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===c.Z_OK):m!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(j.avail_out=0))},w.prototype.onData=function(b){this.chunks.push(b)},w.prototype.onEnd=function(b){b===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},a.Inflate=w,a.inflate=k,a.inflateRaw=function(b,y){return(y=y||{}).raw=!0,k(b,y)},a.ungzip=k},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(o,r,a){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(c){for(var d=Array.prototype.slice.call(arguments,1);d.length;){var u=d.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var p in u)u.hasOwnProperty(p)&&(c[p]=u[p])}}return c},a.shrinkBuf=function(c,d){return c.length===d?c:c.subarray?c.subarray(0,d):(c.length=d,c)};var s={arraySet:function(c,d,u,p,h){if(d.subarray&&c.subarray)c.set(d.subarray(u,u+p),h);else for(var w=0;w<p;w++)c[h+w]=d[u+w]},flattenChunks:function(c){var d,u,p,h,w,k;for(d=p=0,u=c.length;d<u;d++)p+=c[d].length;for(k=new Uint8Array(p),d=h=0,u=c.length;d<u;d++)w=c[d],k.set(w,h),h+=w.length;return k}},l={arraySet:function(c,d,u,p,h){for(var w=0;w<p;w++)c[h+w]=d[u+w]},flattenChunks:function(c){return[].concat.apply([],c)}};a.setTyped=function(c){c?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,s)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,l))},a.setTyped(i)},{}],42:[function(o,r,a){var i=o("./common"),s=!0,l=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{l=!1}for(var c=new i.Buf8(256),d=0;d<256;d++)c[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;function u(p,h){if(h<65537&&(p.subarray&&l||!p.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(p,h));for(var w="",k=0;k<h;k++)w+=String.fromCharCode(p[k]);return w}c[254]=c[254]=1,a.string2buf=function(p){var h,w,k,b,y,g=p.length,m=0;for(b=0;b<g;b++)(64512&(w=p.charCodeAt(b)))==55296&&b+1<g&&(64512&(k=p.charCodeAt(b+1)))==56320&&(w=65536+(w-55296<<10)+(k-56320),b++),m+=w<128?1:w<2048?2:w<65536?3:4;for(h=new i.Buf8(m),b=y=0;y<m;b++)(64512&(w=p.charCodeAt(b)))==55296&&b+1<g&&(64512&(k=p.charCodeAt(b+1)))==56320&&(w=65536+(w-55296<<10)+(k-56320),b++),w<128?h[y++]=w:(w<2048?h[y++]=192|w>>>6:(w<65536?h[y++]=224|w>>>12:(h[y++]=240|w>>>18,h[y++]=128|w>>>12&63),h[y++]=128|w>>>6&63),h[y++]=128|63&w);return h},a.buf2binstring=function(p){return u(p,p.length)},a.binstring2buf=function(p){for(var h=new i.Buf8(p.length),w=0,k=h.length;w<k;w++)h[w]=p.charCodeAt(w);return h},a.buf2string=function(p,h){var w,k,b,y,g=h||p.length,m=new Array(2*g);for(w=k=0;w<g;)if((b=p[w++])<128)m[k++]=b;else if(4<(y=c[b]))m[k++]=65533,w+=y-1;else{for(b&=y===2?31:y===3?15:7;1<y&&w<g;)b=b<<6|63&p[w++],y--;1<y?m[k++]=65533:b<65536?m[k++]=b:(b-=65536,m[k++]=55296|b>>10&1023,m[k++]=56320|1023&b)}return u(m,k)},a.utf8border=function(p,h){var w;for((h=h||p.length)>p.length&&(h=p.length),w=h-1;0<=w&&(192&p[w])==128;)w--;return w<0||w===0?h:w+c[p[w]]>h?w:h}},{"./common":41}],43:[function(o,r,a){r.exports=function(i,s,l,c){for(var d=65535&i|0,u=i>>>16&65535|0,p=0;l!==0;){for(l-=p=2e3<l?2e3:l;u=u+(d=d+s[c++]|0)|0,--p;);d%=65521,u%=65521}return d|u<<16|0}},{}],44:[function(o,r,a){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(o,r,a){var i=function(){for(var s,l=[],c=0;c<256;c++){s=c;for(var d=0;d<8;d++)s=1&s?3988292384^s>>>1:s>>>1;l[c]=s}return l}();r.exports=function(s,l,c,d){var u=i,p=d+c;s^=-1;for(var h=d;h<p;h++)s=s>>>8^u[255&(s^l[h])];return-1^s}},{}],46:[function(o,r,a){var i,s=o("../utils/common"),l=o("./trees"),c=o("./adler32"),d=o("./crc32"),u=o("./messages"),p=0,h=4,w=0,k=-2,b=-1,y=4,g=2,m=8,x=9,_=286,S=30,P=19,j=2*_+1,M=15,D=3,O=258,B=O+D+1,E=42,I=113,N=1,T=2,F=3,z=4;function G(A,K){return A.msg=u[K],K}function U(A){return(A<<1)-(4<A?9:0)}function R(A){for(var K=A.length;0<=--K;)A[K]=0}function q(A){var K=A.state,Z=K.pending;Z>A.avail_out&&(Z=A.avail_out),Z!==0&&(s.arraySet(A.output,K.pending_buf,K.pending_out,Z,A.next_out),A.next_out+=Z,K.pending_out+=Z,A.total_out+=Z,A.avail_out-=Z,K.pending-=Z,K.pending===0&&(K.pending_out=0))}function H(A,K){l._tr_flush_block(A,0<=A.block_start?A.block_start:-1,A.strstart-A.block_start,K),A.block_start=A.strstart,q(A.strm)}function ne(A,K){A.pending_buf[A.pending++]=K}function X(A,K){A.pending_buf[A.pending++]=K>>>8&255,A.pending_buf[A.pending++]=255&K}function re(A,K){var Z,W,Q=A.max_chain_length,ce=A.strstart,fe=A.prev_length,$=A.nice_match,V=A.strstart>A.w_size-B?A.strstart-(A.w_size-B):0,J=A.window,Y=A.w_mask,ae=A.prev,ue=A.strstart+O,he=J[ce+fe-1],ye=J[ce+fe];A.prev_length>=A.good_match&&(Q>>=2),$>A.lookahead&&($=A.lookahead);do if(J[(Z=K)+fe]===ye&&J[Z+fe-1]===he&&J[Z]===J[ce]&&J[++Z]===J[ce+1]){ce+=2,Z++;do;while(J[++ce]===J[++Z]&&J[++ce]===J[++Z]&&J[++ce]===J[++Z]&&J[++ce]===J[++Z]&&J[++ce]===J[++Z]&&J[++ce]===J[++Z]&&J[++ce]===J[++Z]&&J[++ce]===J[++Z]&&ce<ue);if(W=O-(ue-ce),ce=ue-O,fe<W){if(A.match_start=K,$<=(fe=W))break;he=J[ce+fe-1],ye=J[ce+fe]}}while((K=ae[K&Y])>V&&--Q!=0);return fe<=A.lookahead?fe:A.lookahead}function de(A){var K,Z,W,Q,ce,fe,$,V,J,Y,ae=A.w_size;do{if(Q=A.window_size-A.lookahead-A.strstart,A.strstart>=ae+(ae-B)){for(s.arraySet(A.window,A.window,ae,ae,0),A.match_start-=ae,A.strstart-=ae,A.block_start-=ae,K=Z=A.hash_size;W=A.head[--K],A.head[K]=ae<=W?W-ae:0,--Z;);for(K=Z=ae;W=A.prev[--K],A.prev[K]=ae<=W?W-ae:0,--Z;);Q+=ae}if(A.strm.avail_in===0)break;if(fe=A.strm,$=A.window,V=A.strstart+A.lookahead,J=Q,Y=void 0,Y=fe.avail_in,J<Y&&(Y=J),Z=Y===0?0:(fe.avail_in-=Y,s.arraySet($,fe.input,fe.next_in,Y,V),fe.state.wrap===1?fe.adler=c(fe.adler,$,Y,V):fe.state.wrap===2&&(fe.adler=d(fe.adler,$,Y,V)),fe.next_in+=Y,fe.total_in+=Y,Y),A.lookahead+=Z,A.lookahead+A.insert>=D)for(ce=A.strstart-A.insert,A.ins_h=A.window[ce],A.ins_h=(A.ins_h<<A.hash_shift^A.window[ce+1])&A.hash_mask;A.insert&&(A.ins_h=(A.ins_h<<A.hash_shift^A.window[ce+D-1])&A.hash_mask,A.prev[ce&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=ce,ce++,A.insert--,!(A.lookahead+A.insert<D)););}while(A.lookahead<B&&A.strm.avail_in!==0)}function ge(A,K){for(var Z,W;;){if(A.lookahead<B){if(de(A),A.lookahead<B&&K===p)return N;if(A.lookahead===0)break}if(Z=0,A.lookahead>=D&&(A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+D-1])&A.hash_mask,Z=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart),Z!==0&&A.strstart-Z<=A.w_size-B&&(A.match_length=re(A,Z)),A.match_length>=D)if(W=l._tr_tally(A,A.strstart-A.match_start,A.match_length-D),A.lookahead-=A.match_length,A.match_length<=A.max_lazy_match&&A.lookahead>=D){for(A.match_length--;A.strstart++,A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+D-1])&A.hash_mask,Z=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart,--A.match_length!=0;);A.strstart++}else A.strstart+=A.match_length,A.match_length=0,A.ins_h=A.window[A.strstart],A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+1])&A.hash_mask;else W=l._tr_tally(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++;if(W&&(H(A,!1),A.strm.avail_out===0))return N}return A.insert=A.strstart<D-1?A.strstart:D-1,K===h?(H(A,!0),A.strm.avail_out===0?F:z):A.last_lit&&(H(A,!1),A.strm.avail_out===0)?N:T}function te(A,K){for(var Z,W,Q;;){if(A.lookahead<B){if(de(A),A.lookahead<B&&K===p)return N;if(A.lookahead===0)break}if(Z=0,A.lookahead>=D&&(A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+D-1])&A.hash_mask,Z=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart),A.prev_length=A.match_length,A.prev_match=A.match_start,A.match_length=D-1,Z!==0&&A.prev_length<A.max_lazy_match&&A.strstart-Z<=A.w_size-B&&(A.match_length=re(A,Z),A.match_length<=5&&(A.strategy===1||A.match_length===D&&4096<A.strstart-A.match_start)&&(A.match_length=D-1)),A.prev_length>=D&&A.match_length<=A.prev_length){for(Q=A.strstart+A.lookahead-D,W=l._tr_tally(A,A.strstart-1-A.prev_match,A.prev_length-D),A.lookahead-=A.prev_length-1,A.prev_length-=2;++A.strstart<=Q&&(A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+D-1])&A.hash_mask,Z=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart),--A.prev_length!=0;);if(A.match_available=0,A.match_length=D-1,A.strstart++,W&&(H(A,!1),A.strm.avail_out===0))return N}else if(A.match_available){if((W=l._tr_tally(A,0,A.window[A.strstart-1]))&&H(A,!1),A.strstart++,A.lookahead--,A.strm.avail_out===0)return N}else A.match_available=1,A.strstart++,A.lookahead--}return A.match_available&&(W=l._tr_tally(A,0,A.window[A.strstart-1]),A.match_available=0),A.insert=A.strstart<D-1?A.strstart:D-1,K===h?(H(A,!0),A.strm.avail_out===0?F:z):A.last_lit&&(H(A,!1),A.strm.avail_out===0)?N:T}function le(A,K,Z,W,Q){this.good_length=A,this.max_lazy=K,this.nice_length=Z,this.max_chain=W,this.func=Q}function ee(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=m,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*j),this.dyn_dtree=new s.Buf16(2*(2*S+1)),this.bl_tree=new s.Buf16(2*(2*P+1)),R(this.dyn_ltree),R(this.dyn_dtree),R(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(M+1),this.heap=new s.Buf16(2*_+1),R(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*_+1),R(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function se(A){var K;return A&&A.state?(A.total_in=A.total_out=0,A.data_type=g,(K=A.state).pending=0,K.pending_out=0,K.wrap<0&&(K.wrap=-K.wrap),K.status=K.wrap?E:I,A.adler=K.wrap===2?0:1,K.last_flush=p,l._tr_init(K),w):G(A,k)}function ie(A){var K=se(A);return K===w&&function(Z){Z.window_size=2*Z.w_size,R(Z.head),Z.max_lazy_match=i[Z.level].max_lazy,Z.good_match=i[Z.level].good_length,Z.nice_match=i[Z.level].nice_length,Z.max_chain_length=i[Z.level].max_chain,Z.strstart=0,Z.block_start=0,Z.lookahead=0,Z.insert=0,Z.match_length=Z.prev_length=D-1,Z.match_available=0,Z.ins_h=0}(A.state),K}function oe(A,K,Z,W,Q,ce){if(!A)return k;var fe=1;if(K===b&&(K=6),W<0?(fe=0,W=-W):15<W&&(fe=2,W-=16),Q<1||x<Q||Z!==m||W<8||15<W||K<0||9<K||ce<0||y<ce)return G(A,k);W===8&&(W=9);var $=new ee;return(A.state=$).strm=A,$.wrap=fe,$.gzhead=null,$.w_bits=W,$.w_size=1<<$.w_bits,$.w_mask=$.w_size-1,$.hash_bits=Q+7,$.hash_size=1<<$.hash_bits,$.hash_mask=$.hash_size-1,$.hash_shift=~~(($.hash_bits+D-1)/D),$.window=new s.Buf8(2*$.w_size),$.head=new s.Buf16($.hash_size),$.prev=new s.Buf16($.w_size),$.lit_bufsize=1<<Q+6,$.pending_buf_size=4*$.lit_bufsize,$.pending_buf=new s.Buf8($.pending_buf_size),$.d_buf=1*$.lit_bufsize,$.l_buf=3*$.lit_bufsize,$.level=K,$.strategy=ce,$.method=Z,ie(A)}i=[new le(0,0,0,0,function(A,K){var Z=65535;for(Z>A.pending_buf_size-5&&(Z=A.pending_buf_size-5);;){if(A.lookahead<=1){if(de(A),A.lookahead===0&&K===p)return N;if(A.lookahead===0)break}A.strstart+=A.lookahead,A.lookahead=0;var W=A.block_start+Z;if((A.strstart===0||A.strstart>=W)&&(A.lookahead=A.strstart-W,A.strstart=W,H(A,!1),A.strm.avail_out===0)||A.strstart-A.block_start>=A.w_size-B&&(H(A,!1),A.strm.avail_out===0))return N}return A.insert=0,K===h?(H(A,!0),A.strm.avail_out===0?F:z):(A.strstart>A.block_start&&(H(A,!1),A.strm.avail_out),N)}),new le(4,4,8,4,ge),new le(4,5,16,8,ge),new le(4,6,32,32,ge),new le(4,4,16,16,te),new le(8,16,32,32,te),new le(8,16,128,128,te),new le(8,32,128,256,te),new le(32,128,258,1024,te),new le(32,258,258,4096,te)],a.deflateInit=function(A,K){return oe(A,K,m,15,8,0)},a.deflateInit2=oe,a.deflateReset=ie,a.deflateResetKeep=se,a.deflateSetHeader=function(A,K){return A&&A.state?A.state.wrap!==2?k:(A.state.gzhead=K,w):k},a.deflate=function(A,K){var Z,W,Q,ce;if(!A||!A.state||5<K||K<0)return A?G(A,k):k;if(W=A.state,!A.output||!A.input&&A.avail_in!==0||W.status===666&&K!==h)return G(A,A.avail_out===0?-5:k);if(W.strm=A,Z=W.last_flush,W.last_flush=K,W.status===E)if(W.wrap===2)A.adler=0,ne(W,31),ne(W,139),ne(W,8),W.gzhead?(ne(W,(W.gzhead.text?1:0)+(W.gzhead.hcrc?2:0)+(W.gzhead.extra?4:0)+(W.gzhead.name?8:0)+(W.gzhead.comment?16:0)),ne(W,255&W.gzhead.time),ne(W,W.gzhead.time>>8&255),ne(W,W.gzhead.time>>16&255),ne(W,W.gzhead.time>>24&255),ne(W,W.level===9?2:2<=W.strategy||W.level<2?4:0),ne(W,255&W.gzhead.os),W.gzhead.extra&&W.gzhead.extra.length&&(ne(W,255&W.gzhead.extra.length),ne(W,W.gzhead.extra.length>>8&255)),W.gzhead.hcrc&&(A.adler=d(A.adler,W.pending_buf,W.pending,0)),W.gzindex=0,W.status=69):(ne(W,0),ne(W,0),ne(W,0),ne(W,0),ne(W,0),ne(W,W.level===9?2:2<=W.strategy||W.level<2?4:0),ne(W,3),W.status=I);else{var fe=m+(W.w_bits-8<<4)<<8;fe|=(2<=W.strategy||W.level<2?0:W.level<6?1:W.level===6?2:3)<<6,W.strstart!==0&&(fe|=32),fe+=31-fe%31,W.status=I,X(W,fe),W.strstart!==0&&(X(W,A.adler>>>16),X(W,65535&A.adler)),A.adler=1}if(W.status===69)if(W.gzhead.extra){for(Q=W.pending;W.gzindex<(65535&W.gzhead.extra.length)&&(W.pending!==W.pending_buf_size||(W.gzhead.hcrc&&W.pending>Q&&(A.adler=d(A.adler,W.pending_buf,W.pending-Q,Q)),q(A),Q=W.pending,W.pending!==W.pending_buf_size));)ne(W,255&W.gzhead.extra[W.gzindex]),W.gzindex++;W.gzhead.hcrc&&W.pending>Q&&(A.adler=d(A.adler,W.pending_buf,W.pending-Q,Q)),W.gzindex===W.gzhead.extra.length&&(W.gzindex=0,W.status=73)}else W.status=73;if(W.status===73)if(W.gzhead.name){Q=W.pending;do{if(W.pending===W.pending_buf_size&&(W.gzhead.hcrc&&W.pending>Q&&(A.adler=d(A.adler,W.pending_buf,W.pending-Q,Q)),q(A),Q=W.pending,W.pending===W.pending_buf_size)){ce=1;break}ce=W.gzindex<W.gzhead.name.length?255&W.gzhead.name.charCodeAt(W.gzindex++):0,ne(W,ce)}while(ce!==0);W.gzhead.hcrc&&W.pending>Q&&(A.adler=d(A.adler,W.pending_buf,W.pending-Q,Q)),ce===0&&(W.gzindex=0,W.status=91)}else W.status=91;if(W.status===91)if(W.gzhead.comment){Q=W.pending;do{if(W.pending===W.pending_buf_size&&(W.gzhead.hcrc&&W.pending>Q&&(A.adler=d(A.adler,W.pending_buf,W.pending-Q,Q)),q(A),Q=W.pending,W.pending===W.pending_buf_size)){ce=1;break}ce=W.gzindex<W.gzhead.comment.length?255&W.gzhead.comment.charCodeAt(W.gzindex++):0,ne(W,ce)}while(ce!==0);W.gzhead.hcrc&&W.pending>Q&&(A.adler=d(A.adler,W.pending_buf,W.pending-Q,Q)),ce===0&&(W.status=103)}else W.status=103;if(W.status===103&&(W.gzhead.hcrc?(W.pending+2>W.pending_buf_size&&q(A),W.pending+2<=W.pending_buf_size&&(ne(W,255&A.adler),ne(W,A.adler>>8&255),A.adler=0,W.status=I)):W.status=I),W.pending!==0){if(q(A),A.avail_out===0)return W.last_flush=-1,w}else if(A.avail_in===0&&U(K)<=U(Z)&&K!==h)return G(A,-5);if(W.status===666&&A.avail_in!==0)return G(A,-5);if(A.avail_in!==0||W.lookahead!==0||K!==p&&W.status!==666){var $=W.strategy===2?function(V,J){for(var Y;;){if(V.lookahead===0&&(de(V),V.lookahead===0)){if(J===p)return N;break}if(V.match_length=0,Y=l._tr_tally(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++,Y&&(H(V,!1),V.strm.avail_out===0))return N}return V.insert=0,J===h?(H(V,!0),V.strm.avail_out===0?F:z):V.last_lit&&(H(V,!1),V.strm.avail_out===0)?N:T}(W,K):W.strategy===3?function(V,J){for(var Y,ae,ue,he,ye=V.window;;){if(V.lookahead<=O){if(de(V),V.lookahead<=O&&J===p)return N;if(V.lookahead===0)break}if(V.match_length=0,V.lookahead>=D&&0<V.strstart&&(ae=ye[ue=V.strstart-1])===ye[++ue]&&ae===ye[++ue]&&ae===ye[++ue]){he=V.strstart+O;do;while(ae===ye[++ue]&&ae===ye[++ue]&&ae===ye[++ue]&&ae===ye[++ue]&&ae===ye[++ue]&&ae===ye[++ue]&&ae===ye[++ue]&&ae===ye[++ue]&&ue<he);V.match_length=O-(he-ue),V.match_length>V.lookahead&&(V.match_length=V.lookahead)}if(V.match_length>=D?(Y=l._tr_tally(V,1,V.match_length-D),V.lookahead-=V.match_length,V.strstart+=V.match_length,V.match_length=0):(Y=l._tr_tally(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++),Y&&(H(V,!1),V.strm.avail_out===0))return N}return V.insert=0,J===h?(H(V,!0),V.strm.avail_out===0?F:z):V.last_lit&&(H(V,!1),V.strm.avail_out===0)?N:T}(W,K):i[W.level].func(W,K);if($!==F&&$!==z||(W.status=666),$===N||$===F)return A.avail_out===0&&(W.last_flush=-1),w;if($===T&&(K===1?l._tr_align(W):K!==5&&(l._tr_stored_block(W,0,0,!1),K===3&&(R(W.head),W.lookahead===0&&(W.strstart=0,W.block_start=0,W.insert=0))),q(A),A.avail_out===0))return W.last_flush=-1,w}return K!==h?w:W.wrap<=0?1:(W.wrap===2?(ne(W,255&A.adler),ne(W,A.adler>>8&255),ne(W,A.adler>>16&255),ne(W,A.adler>>24&255),ne(W,255&A.total_in),ne(W,A.total_in>>8&255),ne(W,A.total_in>>16&255),ne(W,A.total_in>>24&255)):(X(W,A.adler>>>16),X(W,65535&A.adler)),q(A),0<W.wrap&&(W.wrap=-W.wrap),W.pending!==0?w:1)},a.deflateEnd=function(A){var K;return A&&A.state?(K=A.state.status)!==E&&K!==69&&K!==73&&K!==91&&K!==103&&K!==I&&K!==666?G(A,k):(A.state=null,K===I?G(A,-3):w):k},a.deflateSetDictionary=function(A,K){var Z,W,Q,ce,fe,$,V,J,Y=K.length;if(!A||!A.state||(ce=(Z=A.state).wrap)===2||ce===1&&Z.status!==E||Z.lookahead)return k;for(ce===1&&(A.adler=c(A.adler,K,Y,0)),Z.wrap=0,Y>=Z.w_size&&(ce===0&&(R(Z.head),Z.strstart=0,Z.block_start=0,Z.insert=0),J=new s.Buf8(Z.w_size),s.arraySet(J,K,Y-Z.w_size,Z.w_size,0),K=J,Y=Z.w_size),fe=A.avail_in,$=A.next_in,V=A.input,A.avail_in=Y,A.next_in=0,A.input=K,de(Z);Z.lookahead>=D;){for(W=Z.strstart,Q=Z.lookahead-(D-1);Z.ins_h=(Z.ins_h<<Z.hash_shift^Z.window[W+D-1])&Z.hash_mask,Z.prev[W&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=W,W++,--Q;);Z.strstart=W,Z.lookahead=D-1,de(Z)}return Z.strstart+=Z.lookahead,Z.block_start=Z.strstart,Z.insert=Z.lookahead,Z.lookahead=0,Z.match_length=Z.prev_length=D-1,Z.match_available=0,A.next_in=$,A.input=V,A.avail_in=fe,Z.wrap=ce,w},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(o,r,a){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(o,r,a){r.exports=function(i,s){var l,c,d,u,p,h,w,k,b,y,g,m,x,_,S,P,j,M,D,O,B,E,I,N,T;l=i.state,c=i.next_in,N=i.input,d=c+(i.avail_in-5),u=i.next_out,T=i.output,p=u-(s-i.avail_out),h=u+(i.avail_out-257),w=l.dmax,k=l.wsize,b=l.whave,y=l.wnext,g=l.window,m=l.hold,x=l.bits,_=l.lencode,S=l.distcode,P=(1<<l.lenbits)-1,j=(1<<l.distbits)-1;e:do{x<15&&(m+=N[c++]<<x,x+=8,m+=N[c++]<<x,x+=8),M=_[m&P];t:for(;;){if(m>>>=D=M>>>24,x-=D,(D=M>>>16&255)===0)T[u++]=65535&M;else{if(!(16&D)){if(!(64&D)){M=_[(65535&M)+(m&(1<<D)-1)];continue t}if(32&D){l.mode=12;break e}i.msg="invalid literal/length code",l.mode=30;break e}O=65535&M,(D&=15)&&(x<D&&(m+=N[c++]<<x,x+=8),O+=m&(1<<D)-1,m>>>=D,x-=D),x<15&&(m+=N[c++]<<x,x+=8,m+=N[c++]<<x,x+=8),M=S[m&j];n:for(;;){if(m>>>=D=M>>>24,x-=D,!(16&(D=M>>>16&255))){if(!(64&D)){M=S[(65535&M)+(m&(1<<D)-1)];continue n}i.msg="invalid distance code",l.mode=30;break e}if(B=65535&M,x<(D&=15)&&(m+=N[c++]<<x,(x+=8)<D&&(m+=N[c++]<<x,x+=8)),w<(B+=m&(1<<D)-1)){i.msg="invalid distance too far back",l.mode=30;break e}if(m>>>=D,x-=D,(D=u-p)<B){if(b<(D=B-D)&&l.sane){i.msg="invalid distance too far back",l.mode=30;break e}if(I=g,(E=0)===y){if(E+=k-D,D<O){for(O-=D;T[u++]=g[E++],--D;);E=u-B,I=T}}else if(y<D){if(E+=k+y-D,(D-=y)<O){for(O-=D;T[u++]=g[E++],--D;);if(E=0,y<O){for(O-=D=y;T[u++]=g[E++],--D;);E=u-B,I=T}}}else if(E+=y-D,D<O){for(O-=D;T[u++]=g[E++],--D;);E=u-B,I=T}for(;2<O;)T[u++]=I[E++],T[u++]=I[E++],T[u++]=I[E++],O-=3;O&&(T[u++]=I[E++],1<O&&(T[u++]=I[E++]))}else{for(E=u-B;T[u++]=T[E++],T[u++]=T[E++],T[u++]=T[E++],2<(O-=3););O&&(T[u++]=T[E++],1<O&&(T[u++]=T[E++]))}break}}break}}while(c<d&&u<h);c-=O=x>>3,m&=(1<<(x-=O<<3))-1,i.next_in=c,i.next_out=u,i.avail_in=c<d?d-c+5:5-(c-d),i.avail_out=u<h?h-u+257:257-(u-h),l.hold=m,l.bits=x}},{}],49:[function(o,r,a){var i=o("../utils/common"),s=o("./adler32"),l=o("./crc32"),c=o("./inffast"),d=o("./inftrees"),u=1,p=2,h=0,w=-2,k=1,b=852,y=592;function g(E){return(E>>>24&255)+(E>>>8&65280)+((65280&E)<<8)+((255&E)<<24)}function m(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function x(E){var I;return E&&E.state?(I=E.state,E.total_in=E.total_out=I.total=0,E.msg="",I.wrap&&(E.adler=1&I.wrap),I.mode=k,I.last=0,I.havedict=0,I.dmax=32768,I.head=null,I.hold=0,I.bits=0,I.lencode=I.lendyn=new i.Buf32(b),I.distcode=I.distdyn=new i.Buf32(y),I.sane=1,I.back=-1,h):w}function _(E){var I;return E&&E.state?((I=E.state).wsize=0,I.whave=0,I.wnext=0,x(E)):w}function S(E,I){var N,T;return E&&E.state?(T=E.state,I<0?(N=0,I=-I):(N=1+(I>>4),I<48&&(I&=15)),I&&(I<8||15<I)?w:(T.window!==null&&T.wbits!==I&&(T.window=null),T.wrap=N,T.wbits=I,_(E))):w}function P(E,I){var N,T;return E?(T=new m,(E.state=T).window=null,(N=S(E,I))!==h&&(E.state=null),N):w}var j,M,D=!0;function O(E){if(D){var I;for(j=new i.Buf32(512),M=new i.Buf32(32),I=0;I<144;)E.lens[I++]=8;for(;I<256;)E.lens[I++]=9;for(;I<280;)E.lens[I++]=7;for(;I<288;)E.lens[I++]=8;for(d(u,E.lens,0,288,j,0,E.work,{bits:9}),I=0;I<32;)E.lens[I++]=5;d(p,E.lens,0,32,M,0,E.work,{bits:5}),D=!1}E.lencode=j,E.lenbits=9,E.distcode=M,E.distbits=5}function B(E,I,N,T){var F,z=E.state;return z.window===null&&(z.wsize=1<<z.wbits,z.wnext=0,z.whave=0,z.window=new i.Buf8(z.wsize)),T>=z.wsize?(i.arraySet(z.window,I,N-z.wsize,z.wsize,0),z.wnext=0,z.whave=z.wsize):(T<(F=z.wsize-z.wnext)&&(F=T),i.arraySet(z.window,I,N-T,F,z.wnext),(T-=F)?(i.arraySet(z.window,I,N-T,T,0),z.wnext=T,z.whave=z.wsize):(z.wnext+=F,z.wnext===z.wsize&&(z.wnext=0),z.whave<z.wsize&&(z.whave+=F))),0}a.inflateReset=_,a.inflateReset2=S,a.inflateResetKeep=x,a.inflateInit=function(E){return P(E,15)},a.inflateInit2=P,a.inflate=function(E,I){var N,T,F,z,G,U,R,q,H,ne,X,re,de,ge,te,le,ee,se,ie,oe,A,K,Z,W,Q=0,ce=new i.Buf8(4),fe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!E||!E.state||!E.output||!E.input&&E.avail_in!==0)return w;(N=E.state).mode===12&&(N.mode=13),G=E.next_out,F=E.output,R=E.avail_out,z=E.next_in,T=E.input,U=E.avail_in,q=N.hold,H=N.bits,ne=U,X=R,K=h;e:for(;;)switch(N.mode){case k:if(N.wrap===0){N.mode=13;break}for(;H<16;){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}if(2&N.wrap&&q===35615){ce[N.check=0]=255&q,ce[1]=q>>>8&255,N.check=l(N.check,ce,2,0),H=q=0,N.mode=2;break}if(N.flags=0,N.head&&(N.head.done=!1),!(1&N.wrap)||(((255&q)<<8)+(q>>8))%31){E.msg="incorrect header check",N.mode=30;break}if((15&q)!=8){E.msg="unknown compression method",N.mode=30;break}if(H-=4,A=8+(15&(q>>>=4)),N.wbits===0)N.wbits=A;else if(A>N.wbits){E.msg="invalid window size",N.mode=30;break}N.dmax=1<<A,E.adler=N.check=1,N.mode=512&q?10:12,H=q=0;break;case 2:for(;H<16;){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}if(N.flags=q,(255&N.flags)!=8){E.msg="unknown compression method",N.mode=30;break}if(57344&N.flags){E.msg="unknown header flags set",N.mode=30;break}N.head&&(N.head.text=q>>8&1),512&N.flags&&(ce[0]=255&q,ce[1]=q>>>8&255,N.check=l(N.check,ce,2,0)),H=q=0,N.mode=3;case 3:for(;H<32;){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}N.head&&(N.head.time=q),512&N.flags&&(ce[0]=255&q,ce[1]=q>>>8&255,ce[2]=q>>>16&255,ce[3]=q>>>24&255,N.check=l(N.check,ce,4,0)),H=q=0,N.mode=4;case 4:for(;H<16;){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}N.head&&(N.head.xflags=255&q,N.head.os=q>>8),512&N.flags&&(ce[0]=255&q,ce[1]=q>>>8&255,N.check=l(N.check,ce,2,0)),H=q=0,N.mode=5;case 5:if(1024&N.flags){for(;H<16;){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}N.length=q,N.head&&(N.head.extra_len=q),512&N.flags&&(ce[0]=255&q,ce[1]=q>>>8&255,N.check=l(N.check,ce,2,0)),H=q=0}else N.head&&(N.head.extra=null);N.mode=6;case 6:if(1024&N.flags&&(U<(re=N.length)&&(re=U),re&&(N.head&&(A=N.head.extra_len-N.length,N.head.extra||(N.head.extra=new Array(N.head.extra_len)),i.arraySet(N.head.extra,T,z,re,A)),512&N.flags&&(N.check=l(N.check,T,re,z)),U-=re,z+=re,N.length-=re),N.length))break e;N.length=0,N.mode=7;case 7:if(2048&N.flags){if(U===0)break e;for(re=0;A=T[z+re++],N.head&&A&&N.length<65536&&(N.head.name+=String.fromCharCode(A)),A&&re<U;);if(512&N.flags&&(N.check=l(N.check,T,re,z)),U-=re,z+=re,A)break e}else N.head&&(N.head.name=null);N.length=0,N.mode=8;case 8:if(4096&N.flags){if(U===0)break e;for(re=0;A=T[z+re++],N.head&&A&&N.length<65536&&(N.head.comment+=String.fromCharCode(A)),A&&re<U;);if(512&N.flags&&(N.check=l(N.check,T,re,z)),U-=re,z+=re,A)break e}else N.head&&(N.head.comment=null);N.mode=9;case 9:if(512&N.flags){for(;H<16;){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}if(q!==(65535&N.check)){E.msg="header crc mismatch",N.mode=30;break}H=q=0}N.head&&(N.head.hcrc=N.flags>>9&1,N.head.done=!0),E.adler=N.check=0,N.mode=12;break;case 10:for(;H<32;){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}E.adler=N.check=g(q),H=q=0,N.mode=11;case 11:if(N.havedict===0)return E.next_out=G,E.avail_out=R,E.next_in=z,E.avail_in=U,N.hold=q,N.bits=H,2;E.adler=N.check=1,N.mode=12;case 12:if(I===5||I===6)break e;case 13:if(N.last){q>>>=7&H,H-=7&H,N.mode=27;break}for(;H<3;){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}switch(N.last=1&q,H-=1,3&(q>>>=1)){case 0:N.mode=14;break;case 1:if(O(N),N.mode=20,I!==6)break;q>>>=2,H-=2;break e;case 2:N.mode=17;break;case 3:E.msg="invalid block type",N.mode=30}q>>>=2,H-=2;break;case 14:for(q>>>=7&H,H-=7&H;H<32;){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}if((65535&q)!=(q>>>16^65535)){E.msg="invalid stored block lengths",N.mode=30;break}if(N.length=65535&q,H=q=0,N.mode=15,I===6)break e;case 15:N.mode=16;case 16:if(re=N.length){if(U<re&&(re=U),R<re&&(re=R),re===0)break e;i.arraySet(F,T,z,re,G),U-=re,z+=re,R-=re,G+=re,N.length-=re;break}N.mode=12;break;case 17:for(;H<14;){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}if(N.nlen=257+(31&q),q>>>=5,H-=5,N.ndist=1+(31&q),q>>>=5,H-=5,N.ncode=4+(15&q),q>>>=4,H-=4,286<N.nlen||30<N.ndist){E.msg="too many length or distance symbols",N.mode=30;break}N.have=0,N.mode=18;case 18:for(;N.have<N.ncode;){for(;H<3;){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}N.lens[fe[N.have++]]=7&q,q>>>=3,H-=3}for(;N.have<19;)N.lens[fe[N.have++]]=0;if(N.lencode=N.lendyn,N.lenbits=7,Z={bits:N.lenbits},K=d(0,N.lens,0,19,N.lencode,0,N.work,Z),N.lenbits=Z.bits,K){E.msg="invalid code lengths set",N.mode=30;break}N.have=0,N.mode=19;case 19:for(;N.have<N.nlen+N.ndist;){for(;le=(Q=N.lencode[q&(1<<N.lenbits)-1])>>>16&255,ee=65535&Q,!((te=Q>>>24)<=H);){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}if(ee<16)q>>>=te,H-=te,N.lens[N.have++]=ee;else{if(ee===16){for(W=te+2;H<W;){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}if(q>>>=te,H-=te,N.have===0){E.msg="invalid bit length repeat",N.mode=30;break}A=N.lens[N.have-1],re=3+(3&q),q>>>=2,H-=2}else if(ee===17){for(W=te+3;H<W;){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}H-=te,A=0,re=3+(7&(q>>>=te)),q>>>=3,H-=3}else{for(W=te+7;H<W;){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}H-=te,A=0,re=11+(127&(q>>>=te)),q>>>=7,H-=7}if(N.have+re>N.nlen+N.ndist){E.msg="invalid bit length repeat",N.mode=30;break}for(;re--;)N.lens[N.have++]=A}}if(N.mode===30)break;if(N.lens[256]===0){E.msg="invalid code -- missing end-of-block",N.mode=30;break}if(N.lenbits=9,Z={bits:N.lenbits},K=d(u,N.lens,0,N.nlen,N.lencode,0,N.work,Z),N.lenbits=Z.bits,K){E.msg="invalid literal/lengths set",N.mode=30;break}if(N.distbits=6,N.distcode=N.distdyn,Z={bits:N.distbits},K=d(p,N.lens,N.nlen,N.ndist,N.distcode,0,N.work,Z),N.distbits=Z.bits,K){E.msg="invalid distances set",N.mode=30;break}if(N.mode=20,I===6)break e;case 20:N.mode=21;case 21:if(6<=U&&258<=R){E.next_out=G,E.avail_out=R,E.next_in=z,E.avail_in=U,N.hold=q,N.bits=H,c(E,X),G=E.next_out,F=E.output,R=E.avail_out,z=E.next_in,T=E.input,U=E.avail_in,q=N.hold,H=N.bits,N.mode===12&&(N.back=-1);break}for(N.back=0;le=(Q=N.lencode[q&(1<<N.lenbits)-1])>>>16&255,ee=65535&Q,!((te=Q>>>24)<=H);){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}if(le&&!(240&le)){for(se=te,ie=le,oe=ee;le=(Q=N.lencode[oe+((q&(1<<se+ie)-1)>>se)])>>>16&255,ee=65535&Q,!(se+(te=Q>>>24)<=H);){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}q>>>=se,H-=se,N.back+=se}if(q>>>=te,H-=te,N.back+=te,N.length=ee,le===0){N.mode=26;break}if(32&le){N.back=-1,N.mode=12;break}if(64&le){E.msg="invalid literal/length code",N.mode=30;break}N.extra=15&le,N.mode=22;case 22:if(N.extra){for(W=N.extra;H<W;){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}N.length+=q&(1<<N.extra)-1,q>>>=N.extra,H-=N.extra,N.back+=N.extra}N.was=N.length,N.mode=23;case 23:for(;le=(Q=N.distcode[q&(1<<N.distbits)-1])>>>16&255,ee=65535&Q,!((te=Q>>>24)<=H);){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}if(!(240&le)){for(se=te,ie=le,oe=ee;le=(Q=N.distcode[oe+((q&(1<<se+ie)-1)>>se)])>>>16&255,ee=65535&Q,!(se+(te=Q>>>24)<=H);){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}q>>>=se,H-=se,N.back+=se}if(q>>>=te,H-=te,N.back+=te,64&le){E.msg="invalid distance code",N.mode=30;break}N.offset=ee,N.extra=15&le,N.mode=24;case 24:if(N.extra){for(W=N.extra;H<W;){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}N.offset+=q&(1<<N.extra)-1,q>>>=N.extra,H-=N.extra,N.back+=N.extra}if(N.offset>N.dmax){E.msg="invalid distance too far back",N.mode=30;break}N.mode=25;case 25:if(R===0)break e;if(re=X-R,N.offset>re){if((re=N.offset-re)>N.whave&&N.sane){E.msg="invalid distance too far back",N.mode=30;break}de=re>N.wnext?(re-=N.wnext,N.wsize-re):N.wnext-re,re>N.length&&(re=N.length),ge=N.window}else ge=F,de=G-N.offset,re=N.length;for(R<re&&(re=R),R-=re,N.length-=re;F[G++]=ge[de++],--re;);N.length===0&&(N.mode=21);break;case 26:if(R===0)break e;F[G++]=N.length,R--,N.mode=21;break;case 27:if(N.wrap){for(;H<32;){if(U===0)break e;U--,q|=T[z++]<<H,H+=8}if(X-=R,E.total_out+=X,N.total+=X,X&&(E.adler=N.check=N.flags?l(N.check,F,X,G-X):s(N.check,F,X,G-X)),X=R,(N.flags?q:g(q))!==N.check){E.msg="incorrect data check",N.mode=30;break}H=q=0}N.mode=28;case 28:if(N.wrap&&N.flags){for(;H<32;){if(U===0)break e;U--,q+=T[z++]<<H,H+=8}if(q!==(4294967295&N.total)){E.msg="incorrect length check",N.mode=30;break}H=q=0}N.mode=29;case 29:K=1;break e;case 30:K=-3;break e;case 31:return-4;case 32:default:return w}return E.next_out=G,E.avail_out=R,E.next_in=z,E.avail_in=U,N.hold=q,N.bits=H,(N.wsize||X!==E.avail_out&&N.mode<30&&(N.mode<27||I!==4))&&B(E,E.output,E.next_out,X-E.avail_out)?(N.mode=31,-4):(ne-=E.avail_in,X-=E.avail_out,E.total_in+=ne,E.total_out+=X,N.total+=X,N.wrap&&X&&(E.adler=N.check=N.flags?l(N.check,F,X,E.next_out-X):s(N.check,F,X,E.next_out-X)),E.data_type=N.bits+(N.last?64:0)+(N.mode===12?128:0)+(N.mode===20||N.mode===15?256:0),(ne==0&&X===0||I===4)&&K===h&&(K=-5),K)},a.inflateEnd=function(E){if(!E||!E.state)return w;var I=E.state;return I.window&&(I.window=null),E.state=null,h},a.inflateGetHeader=function(E,I){var N;return E&&E.state&&2&(N=E.state).wrap?((N.head=I).done=!1,h):w},a.inflateSetDictionary=function(E,I){var N,T=I.length;return E&&E.state?(N=E.state).wrap!==0&&N.mode!==11?w:N.mode===11&&s(1,I,T,0)!==N.check?-3:B(E,I,T,T)?(N.mode=31,-4):(N.havedict=1,h):w},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(o,r,a){var i=o("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,p,h,w,k,b,y,g){var m,x,_,S,P,j,M,D,O,B=g.bits,E=0,I=0,N=0,T=0,F=0,z=0,G=0,U=0,R=0,q=0,H=null,ne=0,X=new i.Buf16(16),re=new i.Buf16(16),de=null,ge=0;for(E=0;E<=15;E++)X[E]=0;for(I=0;I<w;I++)X[p[h+I]]++;for(F=B,T=15;1<=T&&X[T]===0;T--);if(T<F&&(F=T),T===0)return k[b++]=20971520,k[b++]=20971520,g.bits=1,0;for(N=1;N<T&&X[N]===0;N++);for(F<N&&(F=N),E=U=1;E<=15;E++)if(U<<=1,(U-=X[E])<0)return-1;if(0<U&&(u===0||T!==1))return-1;for(re[1]=0,E=1;E<15;E++)re[E+1]=re[E]+X[E];for(I=0;I<w;I++)p[h+I]!==0&&(y[re[p[h+I]]++]=I);if(j=u===0?(H=de=y,19):u===1?(H=s,ne-=257,de=l,ge-=257,256):(H=c,de=d,-1),E=N,P=b,G=I=q=0,_=-1,S=(R=1<<(z=F))-1,u===1&&852<R||u===2&&592<R)return 1;for(;;){for(M=E-G,O=y[I]<j?(D=0,y[I]):y[I]>j?(D=de[ge+y[I]],H[ne+y[I]]):(D=96,0),m=1<<E-G,N=x=1<<z;k[P+(q>>G)+(x-=m)]=M<<24|D<<16|O|0,x!==0;);for(m=1<<E-1;q&m;)m>>=1;if(m!==0?(q&=m-1,q+=m):q=0,I++,--X[E]==0){if(E===T)break;E=p[h+y[I]]}if(F<E&&(q&S)!==_){for(G===0&&(G=F),P+=N,U=1<<(z=E-G);z+G<T&&!((U-=X[z+G])<=0);)z++,U<<=1;if(R+=1<<z,u===1&&852<R||u===2&&592<R)return 1;k[_=q&S]=F<<24|z<<16|P-b|0}}return q!==0&&(k[P+q]=E-G<<24|64<<16|0),g.bits=F,0}},{"../utils/common":41}],51:[function(o,r,a){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(o,r,a){var i=o("../utils/common"),s=0,l=1;function c(Q){for(var ce=Q.length;0<=--ce;)Q[ce]=0}var d=0,u=29,p=256,h=p+1+u,w=30,k=19,b=2*h+1,y=15,g=16,m=7,x=256,_=16,S=17,P=18,j=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],B=new Array(2*(h+2));c(B);var E=new Array(2*w);c(E);var I=new Array(512);c(I);var N=new Array(256);c(N);var T=new Array(u);c(T);var F,z,G,U=new Array(w);function R(Q,ce,fe,$,V){this.static_tree=Q,this.extra_bits=ce,this.extra_base=fe,this.elems=$,this.max_length=V,this.has_stree=Q&&Q.length}function q(Q,ce){this.dyn_tree=Q,this.max_code=0,this.stat_desc=ce}function H(Q){return Q<256?I[Q]:I[256+(Q>>>7)]}function ne(Q,ce){Q.pending_buf[Q.pending++]=255&ce,Q.pending_buf[Q.pending++]=ce>>>8&255}function X(Q,ce,fe){Q.bi_valid>g-fe?(Q.bi_buf|=ce<<Q.bi_valid&65535,ne(Q,Q.bi_buf),Q.bi_buf=ce>>g-Q.bi_valid,Q.bi_valid+=fe-g):(Q.bi_buf|=ce<<Q.bi_valid&65535,Q.bi_valid+=fe)}function re(Q,ce,fe){X(Q,fe[2*ce],fe[2*ce+1])}function de(Q,ce){for(var fe=0;fe|=1&Q,Q>>>=1,fe<<=1,0<--ce;);return fe>>>1}function ge(Q,ce,fe){var $,V,J=new Array(y+1),Y=0;for($=1;$<=y;$++)J[$]=Y=Y+fe[$-1]<<1;for(V=0;V<=ce;V++){var ae=Q[2*V+1];ae!==0&&(Q[2*V]=de(J[ae]++,ae))}}function te(Q){var ce;for(ce=0;ce<h;ce++)Q.dyn_ltree[2*ce]=0;for(ce=0;ce<w;ce++)Q.dyn_dtree[2*ce]=0;for(ce=0;ce<k;ce++)Q.bl_tree[2*ce]=0;Q.dyn_ltree[2*x]=1,Q.opt_len=Q.static_len=0,Q.last_lit=Q.matches=0}function le(Q){8<Q.bi_valid?ne(Q,Q.bi_buf):0<Q.bi_valid&&(Q.pending_buf[Q.pending++]=Q.bi_buf),Q.bi_buf=0,Q.bi_valid=0}function ee(Q,ce,fe,$){var V=2*ce,J=2*fe;return Q[V]<Q[J]||Q[V]===Q[J]&&$[ce]<=$[fe]}function se(Q,ce,fe){for(var $=Q.heap[fe],V=fe<<1;V<=Q.heap_len&&(V<Q.heap_len&&ee(ce,Q.heap[V+1],Q.heap[V],Q.depth)&&V++,!ee(ce,$,Q.heap[V],Q.depth));)Q.heap[fe]=Q.heap[V],fe=V,V<<=1;Q.heap[fe]=$}function ie(Q,ce,fe){var $,V,J,Y,ae=0;if(Q.last_lit!==0)for(;$=Q.pending_buf[Q.d_buf+2*ae]<<8|Q.pending_buf[Q.d_buf+2*ae+1],V=Q.pending_buf[Q.l_buf+ae],ae++,$===0?re(Q,V,ce):(re(Q,(J=N[V])+p+1,ce),(Y=j[J])!==0&&X(Q,V-=T[J],Y),re(Q,J=H(--$),fe),(Y=M[J])!==0&&X(Q,$-=U[J],Y)),ae<Q.last_lit;);re(Q,x,ce)}function oe(Q,ce){var fe,$,V,J=ce.dyn_tree,Y=ce.stat_desc.static_tree,ae=ce.stat_desc.has_stree,ue=ce.stat_desc.elems,he=-1;for(Q.heap_len=0,Q.heap_max=b,fe=0;fe<ue;fe++)J[2*fe]!==0?(Q.heap[++Q.heap_len]=he=fe,Q.depth[fe]=0):J[2*fe+1]=0;for(;Q.heap_len<2;)J[2*(V=Q.heap[++Q.heap_len]=he<2?++he:0)]=1,Q.depth[V]=0,Q.opt_len--,ae&&(Q.static_len-=Y[2*V+1]);for(ce.max_code=he,fe=Q.heap_len>>1;1<=fe;fe--)se(Q,J,fe);for(V=ue;fe=Q.heap[1],Q.heap[1]=Q.heap[Q.heap_len--],se(Q,J,1),$=Q.heap[1],Q.heap[--Q.heap_max]=fe,Q.heap[--Q.heap_max]=$,J[2*V]=J[2*fe]+J[2*$],Q.depth[V]=(Q.depth[fe]>=Q.depth[$]?Q.depth[fe]:Q.depth[$])+1,J[2*fe+1]=J[2*$+1]=V,Q.heap[1]=V++,se(Q,J,1),2<=Q.heap_len;);Q.heap[--Q.heap_max]=Q.heap[1],function(ye,ve){var me,_e,pe,xe,Se,Le,Ee=ve.dyn_tree,Me=ve.max_code,De=ve.stat_desc.static_tree,Te=ve.stat_desc.has_stree,Re=ve.stat_desc.extra_bits,we=ve.stat_desc.extra_base,Ce=ve.stat_desc.max_length,qe=0;for(xe=0;xe<=y;xe++)ye.bl_count[xe]=0;for(Ee[2*ye.heap[ye.heap_max]+1]=0,me=ye.heap_max+1;me<b;me++)Ce<(xe=Ee[2*Ee[2*(_e=ye.heap[me])+1]+1]+1)&&(xe=Ce,qe++),Ee[2*_e+1]=xe,Me<_e||(ye.bl_count[xe]++,Se=0,we<=_e&&(Se=Re[_e-we]),Le=Ee[2*_e],ye.opt_len+=Le*(xe+Se),Te&&(ye.static_len+=Le*(De[2*_e+1]+Se)));if(qe!==0){do{for(xe=Ce-1;ye.bl_count[xe]===0;)xe--;ye.bl_count[xe]--,ye.bl_count[xe+1]+=2,ye.bl_count[Ce]--,qe-=2}while(0<qe);for(xe=Ce;xe!==0;xe--)for(_e=ye.bl_count[xe];_e!==0;)Me<(pe=ye.heap[--me])||(Ee[2*pe+1]!==xe&&(ye.opt_len+=(xe-Ee[2*pe+1])*Ee[2*pe],Ee[2*pe+1]=xe),_e--)}}(Q,ce),ge(J,he,Q.bl_count)}function A(Q,ce,fe){var $,V,J=-1,Y=ce[1],ae=0,ue=7,he=4;for(Y===0&&(ue=138,he=3),ce[2*(fe+1)+1]=65535,$=0;$<=fe;$++)V=Y,Y=ce[2*($+1)+1],++ae<ue&&V===Y||(ae<he?Q.bl_tree[2*V]+=ae:V!==0?(V!==J&&Q.bl_tree[2*V]++,Q.bl_tree[2*_]++):ae<=10?Q.bl_tree[2*S]++:Q.bl_tree[2*P]++,J=V,he=(ae=0)===Y?(ue=138,3):V===Y?(ue=6,3):(ue=7,4))}function K(Q,ce,fe){var $,V,J=-1,Y=ce[1],ae=0,ue=7,he=4;for(Y===0&&(ue=138,he=3),$=0;$<=fe;$++)if(V=Y,Y=ce[2*($+1)+1],!(++ae<ue&&V===Y)){if(ae<he)for(;re(Q,V,Q.bl_tree),--ae!=0;);else V!==0?(V!==J&&(re(Q,V,Q.bl_tree),ae--),re(Q,_,Q.bl_tree),X(Q,ae-3,2)):ae<=10?(re(Q,S,Q.bl_tree),X(Q,ae-3,3)):(re(Q,P,Q.bl_tree),X(Q,ae-11,7));J=V,he=(ae=0)===Y?(ue=138,3):V===Y?(ue=6,3):(ue=7,4)}}c(U);var Z=!1;function W(Q,ce,fe,$){X(Q,(d<<1)+($?1:0),3),function(V,J,Y,ae){le(V),ne(V,Y),ne(V,~Y),i.arraySet(V.pending_buf,V.window,J,Y,V.pending),V.pending+=Y}(Q,ce,fe)}a._tr_init=function(Q){Z||(function(){var ce,fe,$,V,J,Y=new Array(y+1);for(V=$=0;V<u-1;V++)for(T[V]=$,ce=0;ce<1<<j[V];ce++)N[$++]=V;for(N[$-1]=V,V=J=0;V<16;V++)for(U[V]=J,ce=0;ce<1<<M[V];ce++)I[J++]=V;for(J>>=7;V<w;V++)for(U[V]=J<<7,ce=0;ce<1<<M[V]-7;ce++)I[256+J++]=V;for(fe=0;fe<=y;fe++)Y[fe]=0;for(ce=0;ce<=143;)B[2*ce+1]=8,ce++,Y[8]++;for(;ce<=255;)B[2*ce+1]=9,ce++,Y[9]++;for(;ce<=279;)B[2*ce+1]=7,ce++,Y[7]++;for(;ce<=287;)B[2*ce+1]=8,ce++,Y[8]++;for(ge(B,h+1,Y),ce=0;ce<w;ce++)E[2*ce+1]=5,E[2*ce]=de(ce,5);F=new R(B,j,p+1,h,y),z=new R(E,M,0,w,y),G=new R(new Array(0),D,0,k,m)}(),Z=!0),Q.l_desc=new q(Q.dyn_ltree,F),Q.d_desc=new q(Q.dyn_dtree,z),Q.bl_desc=new q(Q.bl_tree,G),Q.bi_buf=0,Q.bi_valid=0,te(Q)},a._tr_stored_block=W,a._tr_flush_block=function(Q,ce,fe,$){var V,J,Y=0;0<Q.level?(Q.strm.data_type===2&&(Q.strm.data_type=function(ae){var ue,he=4093624447;for(ue=0;ue<=31;ue++,he>>>=1)if(1&he&&ae.dyn_ltree[2*ue]!==0)return s;if(ae.dyn_ltree[18]!==0||ae.dyn_ltree[20]!==0||ae.dyn_ltree[26]!==0)return l;for(ue=32;ue<p;ue++)if(ae.dyn_ltree[2*ue]!==0)return l;return s}(Q)),oe(Q,Q.l_desc),oe(Q,Q.d_desc),Y=function(ae){var ue;for(A(ae,ae.dyn_ltree,ae.l_desc.max_code),A(ae,ae.dyn_dtree,ae.d_desc.max_code),oe(ae,ae.bl_desc),ue=k-1;3<=ue&&ae.bl_tree[2*O[ue]+1]===0;ue--);return ae.opt_len+=3*(ue+1)+5+5+4,ue}(Q),V=Q.opt_len+3+7>>>3,(J=Q.static_len+3+7>>>3)<=V&&(V=J)):V=J=fe+5,fe+4<=V&&ce!==-1?W(Q,ce,fe,$):Q.strategy===4||J===V?(X(Q,2+($?1:0),3),ie(Q,B,E)):(X(Q,4+($?1:0),3),function(ae,ue,he,ye){var ve;for(X(ae,ue-257,5),X(ae,he-1,5),X(ae,ye-4,4),ve=0;ve<ye;ve++)X(ae,ae.bl_tree[2*O[ve]+1],3);K(ae,ae.dyn_ltree,ue-1),K(ae,ae.dyn_dtree,he-1)}(Q,Q.l_desc.max_code+1,Q.d_desc.max_code+1,Y+1),ie(Q,Q.dyn_ltree,Q.dyn_dtree)),te(Q),$&&le(Q)},a._tr_tally=function(Q,ce,fe){return Q.pending_buf[Q.d_buf+2*Q.last_lit]=ce>>>8&255,Q.pending_buf[Q.d_buf+2*Q.last_lit+1]=255&ce,Q.pending_buf[Q.l_buf+Q.last_lit]=255&fe,Q.last_lit++,ce===0?Q.dyn_ltree[2*fe]++:(Q.matches++,ce--,Q.dyn_ltree[2*(N[fe]+p+1)]++,Q.dyn_dtree[2*H(ce)]++),Q.last_lit===Q.lit_bufsize-1},a._tr_align=function(Q){X(Q,2,3),re(Q,x,B),function(ce){ce.bi_valid===16?(ne(ce,ce.bi_buf),ce.bi_buf=0,ce.bi_valid=0):8<=ce.bi_valid&&(ce.pending_buf[ce.pending++]=255&ce.bi_buf,ce.bi_buf>>=8,ce.bi_valid-=8)}(Q)}},{"../utils/common":41}],53:[function(o,r,a){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(o,r,a){(function(i){(function(s,l){if(!s.setImmediate){var c,d,u,p,h=1,w={},k=!1,b=s.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(s);y=y&&y.setTimeout?y:s,c={}.toString.call(s.process)==="[object process]"?function(_){process.nextTick(function(){m(_)})}:function(){if(s.postMessage&&!s.importScripts){var _=!0,S=s.onmessage;return s.onmessage=function(){_=!1},s.postMessage("","*"),s.onmessage=S,_}}()?(p="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",x,!1):s.attachEvent("onmessage",x),function(_){s.postMessage(p+_,"*")}):s.MessageChannel?((u=new MessageChannel).port1.onmessage=function(_){m(_.data)},function(_){u.port2.postMessage(_)}):b&&"onreadystatechange"in b.createElement("script")?(d=b.documentElement,function(_){var S=b.createElement("script");S.onreadystatechange=function(){m(_),S.onreadystatechange=null,d.removeChild(S),S=null},d.appendChild(S)}):function(_){setTimeout(m,0,_)},y.setImmediate=function(_){typeof _!="function"&&(_=new Function(""+_));for(var S=new Array(arguments.length-1),P=0;P<S.length;P++)S[P]=arguments[P+1];var j={callback:_,args:S};return w[h]=j,c(h),h++},y.clearImmediate=g}function g(_){delete w[_]}function m(_){if(k)setTimeout(m,0,_);else{var S=w[_];if(S){k=!0;try{(function(P){var j=P.callback,M=P.args;switch(M.length){case 0:j();break;case 1:j(M[0]);break;case 2:j(M[0],M[1]);break;case 3:j(M[0],M[1],M[2]);break;default:j.apply(l,M)}})(S)}finally{g(_),k=!1}}}}function x(_){_.source===s&&typeof _.data=="string"&&_.data.indexOf(p)===0&&m(+_.data.slice(p.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof Vi<"u"?Vi:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(oy);var IP=oy.exports;const Li=Pu(IP),Yg=({value:e,placeholder:t,onChange:o,min:r,className:a,title:i})=>{const s=c=>{const d=parseInt(e,10);let u=isNaN(d)?r||1:d+c;r!==void 0&&u<r&&(u=r),o(u.toString())},l=c=>{const d=c.target.value;if(d===""){o("");return}const u=parseInt(d,10);!isNaN(u)&&r!==void 0&&u<r||o(d)};return n.jsxs("div",{className:`relative flex items-center bg-gray-800 rounded border border-gray-600 h-6 ${a}`,title:i,children:[n.jsx("input",{type:"number",min:r,value:e,placeholder:t,onChange:l,className:"appearance-none w-full h-full bg-transparent text-[10px] text-white text-center focus:outline-none px-1 placeholder-gray-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",onClick:c=>c.stopPropagation(),onMouseDown:c=>c.stopPropagation()}),n.jsxs("div",{className:"flex flex-col h-full border-l border-gray-600 w-3 flex-shrink-0",children:[n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-gray-700 text-gray-400 hover:text-white transition-colors",onClick:c=>{c.stopPropagation(),s(1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-gray-700 text-gray-400 hover:text-white transition-colors border-t border-gray-600",onClick:c=>{c.stopPropagation(),s(-1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})},er=160,tr=8,AP=({state:e,imageSlots:t,hasInputImages:o,isEditing:r,isStopping:a,isGlobalProcessing:i,totalFrames:s,doneCount:l,currentGeneratingDisplay:c,fullSizeOutputForCopy:d,imageForEditor:u,modelOptions:p,isNanoBanana:h,onUpdateState:w,onRunSelected:k,onDownloadSelected:b,onStartQueue:y,onStop:g,onEdit:m,onOpenEditor:x,onSetOutputToInput:_,onDownload:S,onCopy:P,onSelectAll:j,onSelectNone:M,onInvertSelection:D,onManualRefresh:O,onOutputClick:B,onSequenceOutputClick:E,onCheckOutput:I,onCopyFrame:N,onDownloadFrame:T,onRegenerateFrame:F,onStopFrame:z,getFullSizeImage:G,t:U,upstreamPrompt:R,isTextConnected:q,onEditPrompt:H,onEditInSource:ne})=>{const{isSequenceMode:X,sequenceOutputs:re,checkedSequenceOutputIndices:de,model:ge,autoCrop169:te,autoDownload:le,checkedInputIndices:ee,prompt:se,outputImage:ie,resolution:oe,isSequentialEditingWithPrompts:A,createZip:K}=e,[Z,W]=v.useState(""),[Q,ce]=v.useState(""),fe=v.useRef(null),[$,V]=v.useState(0),[J,Y]=v.useState(0);v.useEffect(()=>{if(!X||!fe.current)return;const me=new ResizeObserver(_e=>{_e[0]&&Y(_e[0].contentRect.width)});return me.observe(fe.current),()=>me.disconnect()},[X]);const ae=v.useMemo(()=>{if(!X)return{columns:0,totalHeight:0,items:[]};const me=Math.max(0,J-16),_e=Math.max(1,Math.floor((me+tr)/(er+tr))),pe=A?s:t.length,Se=Math.ceil(pe/_e)*(er+tr)+tr;return{columns:_e,totalHeight:Se,totalItems:pe}},[J,t.length,X,A,s]),ue=()=>{var De;const{columns:me,totalItems:_e}=ae,pe=400,xe=Math.max(0,$-pe),Se=$+(((De=fe.current)==null?void 0:De.clientHeight)||500)+pe,Le=Math.floor(xe/(er+tr)),Ee=Math.ceil(Se/(er+tr)),Me=[];for(let Te=Le;Te<=Ee;Te++)for(let Re=0;Re<me;Re++){const we=Te*me+Re;we<_e&&Me.push({index:we,top:Te*(er+tr),left:Re*(er+tr)})}return Me},he=()=>{const me=parseInt(Z,10),_e=parseInt(Q,10);if(isNaN(me))return;const pe=A?s:t.length,xe=isNaN(_e)?pe:Math.min(_e,pe),Se=Math.max(1,me);if(Se>xe)return;const Le=[];for(let Ee=Se-1;Ee<xe;Ee++)Le.push(Ee);w({checkedSequenceOutputIndices:Le})},ye=me=>{const _e=parseInt(Z,10)||1,pe=5;let xe=Math.ceil(_e/pe);me==="next"?xe++:xe--,xe<1&&(xe=1);const Se=A?s:t.length,Le=(xe-1)*pe+1,Ee=Math.min(Le+pe-1,Se);W(Le.toString()),ce(Ee.toString());const Me=[];for(let De=Le-1;De<Ee;De++)Me.push(De);w({checkedSequenceOutputIndices:Me})},ve=n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-white/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("rect",{x:"8",y:"8",width:"12",height:"12",rx:"2",ry:"2"}),n.jsx("path",{d:"M16 8V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2"})]});return n.jsxs("div",{className:"h-full flex flex-col space-y-2 flex-grow min-w-0 pl-1",children:[n.jsx("div",{className:"flex justify-between items-center bg-gray-900/50 p-1 rounded-md border border-gray-700",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("label",{className:"text-xs font-medium text-gray-400 pl-1",children:U(X?"image_sequence.output_images_title":"node.content.outputImage")}),X&&n.jsxs("div",{className:"text-[10px] text-gray-500 flex space-x-2 border-l border-gray-600 pl-3",children:[n.jsxs("span",{children:["Total: ",n.jsx("span",{className:"text-gray-300",children:s})]}),n.jsxs("span",{className:l>0?"text-cyan-400":"",children:["Done: ",l]}),n.jsxs("span",{className:"text-emerald-400",children:["Selected: ",de.length]}),r&&n.jsxs("span",{className:"text-cyan-400 animate-pulse",children:["Processing: ",c," of ",s]})]})]})}),X&&n.jsxs("div",{className:"flex justify-between items-center bg-gray-900/50 p-1 rounded-md border border-gray-700",children:[n.jsx("div",{className:"flex items-center space-x-1 pl-1",children:n.jsxs("div",{className:"flex items-center gap-1 bg-gray-800 rounded p-0.5",children:[n.jsx(Yg,{value:Z,onChange:W,placeholder:"1",title:"Start Index",className:"w-12 border-none",min:1}),n.jsx("span",{className:"text-[10px] text-gray-500",children:"-"}),n.jsx(Yg,{value:Q,onChange:ce,placeholder:A?s.toString():t.length.toString(),title:"End Index",className:"w-12 border-none",min:1}),n.jsxs("div",{className:"flex items-center ml-1 border-l border-gray-600 pl-1",children:[n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white transition-colors",onClick:me=>{me.stopPropagation(),ye("prev")},title:"Previous 5",children:n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:n.jsx("path",{d:"M15 18l-6-6 6-6"})})}),n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white transition-colors",onClick:me=>{me.stopPropagation(),ye("next")},title:"Next 5",children:n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:n.jsx("path",{d:"M9 18l6-6-6-6"})})})]}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx("button",{onClick:he,className:"p-0.5 text-gray-400 hover:text-white transition-colors",title:"Select Range",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]})}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(Pe,{title:U("image_sequence.select_all"),onClick:j,disabled:s===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${s===0?"text-gray-600":"text-green-400"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(Pe,{title:U("image_sequence.select_none"),onClick:M,disabled:de.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${de.length===0?"text-gray-600":"text-red-400"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(Pe,{title:U("image_sequence.invert_selection"),onClick:D,disabled:s===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${s===0?"text-gray-600":"text-gray-300"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Pe,{title:U("image_sequence.run_selected"),onClick:k,disabled:r||de.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${r||de.length===0?"text-gray-600":"text-emerald-400"}`,viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),n.jsx(Pe,{title:`${U("image_sequence.download_selected")} (${de.length})`,onClick:async()=>{var xe,Se;const me=[...de].sort((Le,Ee)=>Le-Ee),pe=new Date().toISOString().split("T")[0];if(K)try{const Le=Li.default||Li,Ee=new Le;for(const Te of me){const Re=G(1e3+Te)||((xe=re[Te])==null?void 0:xe.thumbnail);if(Re&&Re.startsWith("data:image")){const we=String(Te+1).padStart(3,"0"),Ce=((Se=Re.match(/image\/(png|jpeg|jpg)/))==null?void 0:Se[1])||"png",qe=`Image_Editor_Frame_${we}.${Ce}`,Be=await(await fetch(Re)).blob();Ee.file(qe,Be)}}const Me=await Ee.generateAsync({type:"blob",compression:"STORE"}),De=document.createElement("a");De.href=URL.createObjectURL(Me),De.download=`Image_Editor_Sequence_${pe}.zip`,De.click(),URL.revokeObjectURL(De.href)}catch(Le){console.error("ZIP Error",Le)}else b()},disabled:de.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${de.length===0?"text-gray-600":"text-sky-400"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Pe,{title:U("node.action.clear"),onClick:()=>w({sequenceOutputs:[]}),disabled:r||re.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${r||re.length===0?"text-gray-600":"text-gray-300 hover:text-white"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Pe,{title:"Force Refresh",onClick:O,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})})]})]}),!X&&n.jsxs("div",{onClick:B,onWheel:me=>me.stopPropagation(),className:"relative w-full flex-grow bg-gray-900/50 rounded-md flex items-center justify-center overflow-hidden group cursor-pointer",children:[ie?n.jsx("img",{src:ie,alt:"Output",className:"object-contain w-full h-full",onMouseDown:me=>me.stopPropagation(),draggable:!0,onDragStart:me=>{const _e=d||ie;_e&&(me.dataTransfer.setData("application/prompt-modifier-drag-image",_e),me.dataTransfer.effectAllowed="copy",me.stopPropagation())}}):n.jsx("span",{className:"text-gray-400",children:U("node.content.imageHere")}),ie&&!r&&n.jsxs("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none gap-4",children:[n.jsx("button",{onClick:me=>{me.stopPropagation(),P()},className:"w-20 h-20 flex items-center justify-center rounded-full bg-black/50 hover:bg-black/60 transition-colors pointer-events-auto","aria-label":U("node.action.copy"),title:U("node.action.copy"),children:ve}),n.jsx("button",{onClick:me=>{me.stopPropagation(),S()},className:"w-20 h-20 flex items-center justify-center rounded-full bg-black/50 hover:bg-black/60 transition-colors pointer-events-auto","aria-label":U("node.action.download"),title:U("node.action.download"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-white/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]}),r&&n.jsxs("div",{className:"absolute inset-0 bg-gray-800/80 flex flex-col items-center justify-center text-white",children:[n.jsxs("svg",{className:"animate-spin h-8 w-8 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n.jsx("span",{className:"mt-2 font-semibold",children:U("node.content.generating")})]}),ie&&n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx(Pe,{title:U("node.action.copy"),onClick:me=>{me.stopPropagation(),P()},children:n.jsx(Dt,{})}),n.jsx(Pe,{title:U("node.action.download"),onClick:me=>{me.stopPropagation(),S()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]})]}),X&&n.jsx("div",{className:"flex-grow min-h-0 flex flex-col space-y-2",children:n.jsx("div",{ref:fe,className:"flex-grow bg-gray-900/50 rounded-md overflow-y-auto p-2 custom-scrollbar relative",onScroll:me=>V(me.currentTarget.scrollTop),onWheel:me=>me.stopPropagation(),children:n.jsx("div",{style:{height:ae.totalHeight,width:"100%",position:"relative"},children:ue().map(({index:me,top:_e,left:pe})=>{if(!(A||!ee||ee.includes(me)))return null;const Se=t[me];if(!Se&&!A)return null;const Le=re[me],Ee=de.includes(me),Me=Le&&Le.status==="pending",De=Le&&Le.status==="generating",Te=Le&&Le.status==="error",Re=Le&&Le.status==="done"&&Le.thumbnail,we=G(1e3+me);let Ce=Re?Le.thumbnail:Se?Se.src:null;!Re&&A&&!Ce&&t.length>0&&(Ce=t[0].src);const qe=!Re&&!Me&&!De&&!Te&&Ce,Be=we||Ce,Ie=A;return n.jsxs("div",{className:"absolute rounded-lg border-2 overflow-hidden cursor-pointer border-gray-700 bg-gray-800 group",style:{top:_e,left:pe,width:er,height:er},onClick:We=>{We.stopPropagation(),E(me,Be||"")},children:[Ce?n.jsx("img",{src:Ce,alt:`Output ${me+1}`,className:`w-full h-full object-contain ${qe?"opacity-60":""}`,draggable:!0,onDragStart:We=>{const at=we||Ce;at&&(We.dataTransfer.setData("application/prompt-modifier-drag-image",at),We.dataTransfer.effectAllowed="copy",We.stopPropagation())}}):n.jsxs("div",{className:"w-full h-full flex items-center justify-center text-gray-600 text-xs",children:["Frame ",me+1]}),n.jsx("div",{className:"absolute inset-x-0 top-0 h-12 bg-gradient-to-b from-black/80 to-transparent z-20 pointer-events-none"}),Me&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60",children:n.jsx("span",{className:"text-xs text-gray-400 font-medium",children:U("imageEditor.status.queued")})}),De&&n.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/70 z-10",children:[n.jsxs("svg",{className:"animate-spin h-6 w-6 text-cyan-500 mb-1",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n.jsx("span",{className:"text-xs text-white font-medium mb-2",children:U("imageEditor.status.generating")}),n.jsx("button",{onClick:We=>{We.stopPropagation(),z(We,me)},className:"px-2 py-0.5 bg-red-600/90 hover:bg-red-700 text-white text-[10px] font-bold rounded shadow-sm border border-red-500/50",children:"Stop Queue"})]}),Te&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-900/50",children:n.jsx("span",{className:"text-xs text-red-200 font-medium",children:"Error"})}),n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity z-30",children:[n.jsx(Pe,{title:U("node.action.copy"),onClick:We=>N(We,me),className:"p-1 text-gray-200 hover:text-white rounded hover:bg-gray-600 transition-colors",children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("rect",{x:"8",y:"8",width:"12",height:"12",rx:"2",ry:"2"}),n.jsx("path",{d:"M16 8V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2"})]})}),Re&&n.jsx(Pe,{title:U("node.action.download"),onClick:We=>T(We,me),className:"p-1 text-gray-200 hover:text-white rounded hover:bg-gray-600 transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Pe,{title:U("imageEditor.action.regenerate"),onClick:We=>F(We,me),disabled:r,className:"p-1 text-gray-200 hover:text-white rounded hover:bg-gray-600 transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})}),Ie&&n.jsx(Pe,{title:U(q?"image_sequence.edit_in_source":"image_sequence.edit_prompt"),onClick:We=>{We.stopPropagation(),q?ne(me):H(me)},className:"p-1 text-gray-200 hover:text-white rounded hover:bg-gray-600 transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]}),n.jsx("div",{className:"absolute top-1 left-1 z-20",onClick:We=>{We.stopPropagation(),I(me)},children:n.jsx("input",{type:"checkbox",checked:Ee,readOnly:!0,className:"h-4 w-4 rounded bg-gray-900/50 border-gray-500 text-accent focus:ring-accent cursor-pointer"})}),n.jsxs("div",{className:"absolute bottom-1 left-1 right-1 flex justify-between items-end pointer-events-none z-20",children:[n.jsx("div",{}),n.jsx("div",{className:"bg-black/60 text-white text-[10px] px-1.5 py-0.5 rounded backdrop-blur-sm",children:me+1})]})]},me)})})})}),n.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 mt-2 pt-2 border-t border-gray-700/50",children:[n.jsxs("div",{className:"flex bg-gray-700 rounded-md p-1 space-x-1 h-[36px] flex-shrink-0",children:[n.jsx(ut,{content:"Gemini 2.5 Flash Image (Nano Banana)",className:"h-full",children:n.jsx("button",{onClick:()=>w({model:"gemini-2.5-flash-image"}),disabled:r,className:`px-2 text-xs font-bold rounded flex items-center transition-colors h-full ${ge==="gemini-2.5-flash-image"?"bg-cyan-600 text-white shadow":"text-gray-400 hover:text-white"}`,children:"Flash"})}),n.jsx(ut,{content:"Gemini 3.0 Image (Nano Banana Pro)",className:"h-full",children:n.jsx("button",{onClick:()=>w({model:"gemini-3-pro-image-preview"}),disabled:r,className:`px-2 text-xs font-bold rounded flex items-center transition-colors h-full ${ge==="gemini-3-pro-image-preview"?"bg-purple-600 text-white shadow":"text-gray-400 hover:text-white"}`,children:"Pro"})})]}),n.jsxs("div",{className:"flex-1 flex space-x-2",children:[r&&X?n.jsx("button",{onClick:g,className:"flex-1 h-[36px] font-bold text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors",children:U(a?"node.action.stopping":"node.action.stop")}):n.jsx("button",{onClick:X?k:m,disabled:r||!o&&!A||!(q?R:se)&&!X,className:"flex-1 h-[36px] font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",children:U(r?"node.content.editing":X?"image_sequence.run_selected":"node.content.applyEdit")}),!X&&n.jsx(ut,{content:"Edit in Canvas",children:n.jsx("button",{onClick:x,disabled:!ie&&!u,className:"h-[36px] px-3 font-bold text-white bg-teal-600 rounded-md hover:bg-teal-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})})}),X&&n.jsx("button",{onClick:b,disabled:de.length===0,className:"flex-1 h-[36px] py-2 text-sm font-bold text-white bg-sky-600 rounded-md hover:bg-sky-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",children:K?"Download ZIP":`${U("image_sequence.download_selected")} (${de.length})`})]}),!X&&ie&&n.jsx(Pe,{title:U("node.action.outputToInput"),onClick:_,className:"h-[36px]",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L9.414 11H13a1 1 0 100-2H9.414l1.293-1.293z",clipRule:"evenodd"})})})]})]})},Zg={inputImages:[],inputImagesB:[],prompt:"",outputImage:null,enableOutpainting:!1,outpaintingPrompt:"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.",model:"gemini-2.5-flash-image",aspectRatio:"1:1",enableAspectRatio:!1,autoCrop169:!0,leftPaneWidth:360,topPaneHeight:330,resolution:"1K",isSequenceMode:!1,isSequentialCombinationMode:!1,isSequentialPromptMode:!1,isSequentialEditingWithPrompts:!1,framePrompts:{},sequenceOutputs:[],checkedSequenceOutputIndices:[],autoDownload:!0,createZip:!1,checkedInputIndices:[],selectedSourceFrameIndex:null},ys=280,Xg=300,Vs=330,ry=180,ay=450,Qg=({value:e,placeholder:t,onChange:o,min:r,className:a,title:i})=>{const s=c=>{const d=parseInt(e,10);let u=isNaN(d)?r||1:d+c;r!==void 0&&u<r&&(u=r),o(u.toString())},l=c=>{const d=c.target.value;if(d===""){o("");return}const u=parseInt(d,10);!isNaN(u)&&r!==void 0&&u<r||o(d)};return n.jsxs("div",{className:`relative flex items-center bg-gray-800 rounded border border-gray-600 h-6 ${a}`,title:i,children:[n.jsx("input",{type:"number",min:r,value:e,placeholder:t,onChange:l,className:"appearance-none w-full h-full bg-transparent text-[10px] text-white text-center focus:outline-none px-1 placeholder-gray-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",onClick:c=>c.stopPropagation(),onMouseDown:c=>c.stopPropagation()}),n.jsxs("div",{className:"flex flex-col h-full border-l border-gray-600 w-3 flex-shrink-0",children:[n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-gray-700 text-gray-400 hover:text-white transition-colors",onClick:c=>{c.stopPropagation(),s(1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-gray-700 text-gray-400 hover:text-white transition-colors border-t border-gray-600",onClick:c=>{c.stopPropagation(),s(-1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})},vs=120,Zr=150,nr=4,e0=({title:e,slots:t,isB:o,isEditing:r,checkedIndices:a,getFullSizeImage:i,onCheck:s,onSelectAll:l,onSelectNone:c,onClear:d,onClick:u,onReorder:p,onRemove:h,onMoveToB:w,onFileClick:k,onDropFiles:b,onDropData:y,onSlotDrop:g,t:m,isSequentialCombinationMode:x,onSetCheckedIndices:_,onInvertSelection:S})=>{const[P,j]=v.useState(!1),[M,D]=v.useState(null),[O,B]=v.useState(""),[E,I]=v.useState(""),[N,T]=v.useState(null),F=v.useRef(null),[z,G]=v.useState(0),[U,R]=v.useState(0);v.useEffect(()=>{if(!F.current)return;const oe=new ResizeObserver(A=>{A[0]&&R(A[0].contentRect.width)});return oe.observe(F.current),()=>oe.disconnect()},[]);const q=v.useMemo(()=>{const oe=Math.max(0,U-8),A=Math.max(1,Math.floor((oe+nr)/(vs+nr))),K=t.length+1,W=Math.ceil(K/A)*(Zr+nr)+nr;return{columns:A,totalHeight:W,totalItems:K}},[U,t.length]),H=()=>{var $;const{columns:oe,totalItems:A}=q,K=400,Z=Math.max(0,z-K),W=z+((($=F.current)==null?void 0:$.clientHeight)||500)+K,Q=Math.floor(Z/(Zr+nr)),ce=Math.ceil(W/(Zr+nr)),fe=[];for(let V=Q;V<=ce;V++)for(let J=0;J<oe;J++){const Y=V*oe+J;Y<A&&fe.push({index:Y,top:V*(Zr+nr),left:J*(vs+nr)})}return fe},ne=oe=>{oe.preventDefault(),oe.stopPropagation(),j(!0);const A=document.getElementById("app-container");A&&A.classList.remove("ring-2","ring-cyan-500","ring-inset")},X=oe=>{oe.preventDefault(),oe.stopPropagation(),j(!0)},re=oe=>{oe.preventDefault(),oe.stopPropagation(),j(!1)},de=oe=>{oe.preventDefault(),oe.stopPropagation(),j(!1);const A=oe.dataTransfer.getData("application/prompt-modifier-drag-image");if(A){y(A);return}const K=oe.dataTransfer.getData("image-input-reorder-index");if(K){const Z=parseInt(K,10);isNaN(Z)||p(Z,t.length),T(null);return}if(oe.dataTransfer.files&&oe.dataTransfer.files.length>0){const Z=Array.from(oe.dataTransfer.files).filter(W=>W.type.startsWith("image/"));Z.length>0&&b(Z)}},ge=(oe,A)=>{oe.preventDefault(),oe.stopPropagation(),D(A)},te=(oe,A)=>{oe.preventDefault(),oe.stopPropagation(),D(null)},le=(oe,A)=>{var Q;oe.preventDefault(),oe.stopPropagation(),D(null);const K=oe.dataTransfer.getData("image-input-reorder-index");if(K){const ce=parseInt(K,10);isNaN(ce)||p(ce,A),T(null);return}const Z=oe.dataTransfer.getData("application/prompt-modifier-drag-image");if(Z){g(A,Z);return}const W=(Q=oe.dataTransfer.files)==null?void 0:Q[0];W&&W.type.startsWith("image/")&&g(A,W)},ee=(oe,A)=>{r||(oe.stopPropagation(),T(A),oe.dataTransfer.setData("image-input-reorder-index",A.toString()),oe.dataTransfer.effectAllowed="move")},se=()=>{if(!_)return;const oe=parseInt(O,10),A=parseInt(E,10);if(isNaN(oe))return;const K=isNaN(A)?t.length:Math.min(A,t.length),Z=Math.max(1,oe);if(Z>K)return;const W=[];for(let Q=Z-1;Q<K;Q++)W.push(Q);_(W)},ie=oe=>{const A=parseInt(O,10)||1,K=5;let Z=Math.ceil(A/K);oe==="next"?Z++:Z--,Z<1&&(Z=1);const W=(Z-1)*K+1,Q=Math.min(W+K-1,t.length);if(B(W.toString()),I(Q.toString()),_){const ce=[];for(let fe=W-1;fe<Q;fe++)ce.push(fe);_(ce)}};return n.jsxs("div",{className:"flex-1 flex flex-col min-h-0 bg-gray-900/30 p-1 rounded-md border border-gray-700/50",children:[n.jsx("div",{className:"flex flex-col gap-1 mb-1 px-1",children:n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:e}),n.jsx("div",{className:"flex items-center space-x-1",children:o?n.jsx(Pe,{title:m("node.action.clear"),onClick:d,disabled:t.length===0||r,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 ${t.length===0||r?"text-gray-600":"text-gray-300 hover:text-white"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}):n.jsx(n.Fragment,{children:n.jsxs("div",{className:"flex items-center gap-1 bg-gray-800 rounded p-0.5 border border-gray-700 mr-2",children:[n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white transition-colors border-r border-gray-600 pr-1",onClick:oe=>{oe.stopPropagation(),ie("prev")},title:"Previous 5",children:n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:n.jsx("path",{d:"M15 18l-6-6 6-6"})})}),n.jsx(Qg,{value:O,onChange:B,placeholder:"1",title:"Start Index",className:"w-10 border-none",min:1}),n.jsx("span",{className:"text-[10px] text-gray-500",children:"-"}),n.jsx(Qg,{value:E,onChange:I,placeholder:t.length.toString(),title:"End Index",className:"w-10 border-none",min:1}),n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white transition-colors border-l border-gray-600 pl-1",onClick:oe=>{oe.stopPropagation(),ie("next")},title:"Next 5",children:n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:n.jsx("path",{d:"M9 18l6-6-6-6"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx("button",{onClick:se,className:"p-0.5 text-gray-400 hover:text-white transition-colors",title:"Select Range",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx(Pe,{title:m("image_sequence.select_all"),onClick:l,disabled:t.length===0||r,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 ${t.length===0||r?"text-gray-600":"text-gray-300 group-hover:text-white"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(Pe,{title:m("image_sequence.select_none"),onClick:c,disabled:!a||a.length===0||r,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 ${!a||a.length===0||r?"text-gray-600":"text-gray-300 group-hover:text-white"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),S&&n.jsx(Pe,{title:m("image_sequence.invert_selection"),onClick:S,disabled:t.length===0||r,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 ${t.length===0||r?"text-gray-600":"text-gray-300"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx(Pe,{title:m("node.action.clear"),onClick:d,disabled:t.length===0||r,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 ${t.length===0||r?"text-gray-600":"text-gray-300 hover:text-white"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})})]})}),n.jsx("div",{ref:F,className:"bg-gray-900/50 rounded-md overflow-y-auto p-1 min-h-0 flex-grow custom-scrollbar relative",onScroll:oe=>G(oe.currentTarget.scrollTop),onWheel:oe=>oe.stopPropagation(),children:n.jsx("div",{style:{height:q.totalHeight,width:"100%",position:"relative"},children:H().map(({index:oe,top:A,left:K})=>{if(oe===t.length)return n.jsx("div",{style:{position:"absolute",top:A,left:K,width:vs,height:Zr},onClick:()=>!r&&k(),onDragEnter:ne,onDragOver:X,onDragLeave:re,onDrop:de,className:`bg-transparent rounded-md flex items-center justify-center cursor-pointer border-2 border-dashed transition-colors ${P?"border-cyan-500 bg-gray-700/50":"border-gray-600 hover:border-cyan-500 hover:bg-gray-700/50"} ${r?"opacity-50 cursor-not-allowed":""}`,children:n.jsxs("div",{className:"text-center text-gray-500",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),n.jsx("span",{className:"text-[10px] mt-1 block",children:m("node.content.dropOrClick")})]})},"placeholder");const Z=t[oe],W=o?!0:!a||a.includes(oe),Q=(o?2e3:0)+Z.index+1,ce=Z.type==="local"?i(Q):Z.src,fe=M===Z.index&&(!o||Z.type==="local");return n.jsxs("div",{style:{position:"absolute",top:A,left:K,width:vs,height:Zr},className:`relative group border-2 flex flex-col rounded-md overflow-visible bg-gray-800 transition-colors ${fe?"border-cyan-500 z-10":"border-gray-700 hover:border-gray-600"}`,onDragOver:$=>ge($,Z.index),onDragLeave:$=>te($,Z.index),onDrop:$=>le($,Z.index),children:[n.jsxs("div",{className:"h-6 bg-gray-900/80 border-b border-gray-700 flex items-center justify-between px-1 cursor-grab active:cursor-grabbing",draggable:Z.type==="local"&&!r,onDragStart:$=>Z.type==="local"?ee($,oe):$.preventDefault(),children:[n.jsxs("div",{className:"flex items-center space-x-1",children:[!o&&Z.type==="local"&&n.jsx("input",{type:"checkbox",checked:W,disabled:r,readOnly:!0,onClick:$=>{$.stopPropagation(),s(oe)},className:"h-3 w-3 rounded bg-gray-900 border-gray-500 text-accent focus:ring-0 cursor-pointer disabled:opacity-50"}),n.jsxs("span",{className:"text-[10px] font-mono text-gray-400",children:["#",oe+1]})]}),Z.type==="local"&&!r&&n.jsxs("div",{className:"flex items-center gap-0.5",children:[n.jsx("button",{onClick:$=>{$.stopPropagation(),p(oe,0)},className:"text-gray-500 hover:text-white p-0.5",title:"Top",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),n.jsx("button",{onClick:$=>{$.stopPropagation(),p(oe,oe-1)},className:"text-gray-500 hover:text-white p-0.5",title:"Up",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M5 15l7-7 7 7"})})}),n.jsx("button",{onClick:$=>{$.stopPropagation(),p(oe,oe+1)},className:"text-gray-500 hover:text-white p-0.5",title:"Down",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M19 9l-7 7-7-7"})})}),n.jsx("button",{onClick:$=>{$.stopPropagation(),p(oe,t.length)},className:"text-gray-500 hover:text-white p-0.5",title:"Bottom",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-700 mx-0.5"}),n.jsx("button",{onClick:$=>{$.stopPropagation(),h(Z.index)},className:"text-gray-500 hover:text-red-400 p-0.5",title:"Remove",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})]}),n.jsxs("div",{className:"flex-grow relative cursor-pointer overflow-hidden bg-black/40",onClick:()=>u(oe),children:[Z.src?n.jsx("img",{src:Z.src||"",alt:`Input ${oe+1}`,className:`object-contain w-full h-full ${!W&&Z.type==="local"?"opacity-50":""}`,onMouseDown:$=>$.stopPropagation(),draggable:!0,onDragStart:$=>{const V=ce||Z.src;V&&($.dataTransfer.setData("application/prompt-modifier-drag-image",V),$.dataTransfer.effectAllowed="copy",$.stopPropagation())}}):n.jsx("div",{className:"w-full h-full bg-gray-800 flex items-center justify-center text-gray-600 text-xs",children:"No Image"}),Z.type==="connected"&&n.jsx("div",{className:"absolute top-1 right-1 pointer-events-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-400 drop-shadow-md",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),!o&&x&&w&&Z.type==="local"&&n.jsx("button",{onClick:$=>{$.stopPropagation(),w(Z.index)},disabled:r,className:"absolute bottom-1 right-1 p-1 bg-gray-900/80 rounded text-gray-300 hover:text-cyan-400 opacity-0 group-hover:opacity-100 transition-opacity",title:"Move to Input B",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})})]})]},`${Z.type}-${o?"b":"a"}-${Z.index}`)})})})]})},Ot=({checked:e,onChange:t,label:o,disabled:r=!1,className:a="",title:i,id:s})=>n.jsxs("div",{id:s,className:`flex items-center space-x-2 cursor-pointer group select-none ${r?"opacity-50 cursor-not-allowed":""} ${a}`,onClick:l=>{l.stopPropagation(),r||t(!e,l)},onMouseDown:l=>l.stopPropagation(),title:i,children:[n.jsx("div",{className:`
                w-4 h-4 min-w-[1rem] min-h-[1rem] rounded border flex items-center justify-center transition-all duration-200 ease-in-out flex-shrink-0 relative
                ${e?"bg-accent border-accent shadow-[0_0_8px_var(--color-accent)]":"bg-gray-800 border-gray-600 group-hover:border-gray-500"}
            `,children:n.jsx("svg",{className:`w-3 h-3 text-white pointer-events-none block transition-transform duration-200 ${e?"scale-100":"scale-0"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,style:{transformOrigin:"center"},children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),o&&n.jsx("span",{className:`text-sm leading-tight pt-[1px] transition-colors ${e?"text-gray-200":"text-gray-400"} group-hover:text-gray-300`,children:o})]}),MP=({state:e,onUpdateState:t,onCleanupInputB:o,isEditing:r,t:a,nodeId:i,deselectAllNodes:s})=>{const{isSequenceMode:l,isSequentialCombinationMode:c,isSequentialPromptMode:d,isSequentialEditingWithPrompts:u,enableAspectRatio:p,aspectRatio:h,enableOutpainting:w,outpaintingPrompt:k}=e,b=v.useMemo(()=>[{value:"Auto",label:"Auto",icon:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})},{value:"1:1",label:"1:1",icon:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"5",y:"5",width:"14",height:"14",rx:"1"})})},{value:"16:9",label:"16:9",icon:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"2",y:"8",width:"20",height:"8",rx:"1"})})},{value:"9:16",label:"9:16",icon:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"8",y:"2",width:"8",height:"20",rx:"1"})})},{value:"4:3",label:"4:3",icon:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"3",y:"6",width:"18",height:"12",rx:"1"})})},{value:"3:4",label:"3:4",icon:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"6",y:"3",width:"12",height:"18",rx:"1"})})}],[]);return n.jsxs("div",{className:"flex-shrink-0 space-y-2",children:[n.jsxs("div",{className:"flex flex-col space-y-2",children:[n.jsx(Ot,{id:`sequence-mode-toggle-${i}`,checked:l,onChange:y=>{y||o(),t({isSequenceMode:y})},disabled:r,label:a("imageEditor.sequenceMode"),title:a("imageEditor.sequenceModeHelp")}),l&&n.jsxs("div",{className:"ml-6 flex flex-col space-y-1.5",children:[n.jsx(Ot,{id:`seq-combo-toggle-${i}`,checked:c,onChange:y=>{y?t({isSequentialCombinationMode:!0}):(o(),t({isSequentialCombinationMode:!1,isSequentialEditingWithPrompts:!1}))},disabled:r,label:a("imageEditor.sequentialCombination"),title:a("imageEditor.sequentialCombinationHelp")}),n.jsx(Ot,{id:`seq-prompt-toggle-${i}`,checked:d,onChange:y=>t({isSequentialPromptMode:y}),disabled:r,label:a("imageEditor.sequentialPrompt"),title:a("imageEditor.sequentialPromptHelp")}),n.jsx(Ot,{id:`seq-edit-prompts-toggle-${i}`,checked:u,onChange:y=>{t(y?{isSequentialEditingWithPrompts:!0,isSequentialCombinationMode:!1,isSequentialPromptMode:!0}:{isSequentialEditingWithPrompts:!1})},disabled:r,label:a("imageEditor.sequentialEditingWithPrompts"),title:a("imageEditor.sequentialEditingWithPromptsHelp")})]})]}),n.jsx(Ot,{id:`aspect-ratio-toggle-${i}`,checked:p,onChange:y=>{t({enableAspectRatio:y,aspectRatio:"Auto",enableOutpainting:y?w:!1})},label:a("node.content.enableAspectRatioFormatting")}),p&&n.jsx(n.Fragment,{children:n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:a("node.content.aspectRatio")}),n.jsx(Rn,{value:h||"1:1",onChange:y=>t({aspectRatio:y}),disabled:r,options:b})]})})]})},RP=v.forwardRef(({totalFrames:e,framePrompts:t,globalPrompt:o,onChange:r,upstreamPrompts:a,t:i,visibleIndices:s,onAddFrame:l,onSync:c,onDeleteFrame:d,onMoveFrame:u,onSelectFrame:p,onClearAll:h,selectedFrameIndex:w},k)=>{const b=v.useRef(null),y=v.useRef([]),g=a&&a.size>0;v.useImperativeHandle(k,()=>({scrollToIndex:_=>{const S=y.current[_];if(S&&b.current){const P=b.current,j=S.offsetTop,M=j+S.offsetHeight,D=P.scrollTop,O=D+P.clientHeight;(j<D||M>O)&&S.scrollIntoView({behavior:"smooth",block:"center"})}}}));const m=Array.from({length:Math.max(1,e)},(_,S)=>S),x=s?m.filter(_=>s.includes(_)):m;return n.jsxs("div",{className:"flex-grow flex flex-col bg-gray-900/30 rounded-md border border-gray-700/50 overflow-hidden h-full",children:[n.jsxs("div",{className:"flex justify-between items-center p-1 bg-gray-800/80 border-b border-gray-700/50 flex-shrink-0",children:[n.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase px-1",children:i("prompt_sequence_editor.sourcePrompts")||"Source Prompts"}),g?n.jsx("div",{className:"flex items-center",children:n.jsx(Pe,{title:"Copy Upstream Prompts to Local",onClick:_=>{_.stopPropagation(),c&&c()},className:"p-1 hover:bg-cyan-900/50 rounded text-cyan-400 hover:text-cyan-200 transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})})}):n.jsxs("div",{className:"flex items-center space-x-1",children:[d&&n.jsx(Pe,{title:"Delete Selected Frame",onClick:_=>{_.stopPropagation(),w!=null&&d(w)},disabled:w==null,className:`p-1 rounded transition-colors ${w!=null?"hover:bg-red-900/50 text-gray-400 hover:text-red-400":"text-gray-600 cursor-not-allowed"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),h&&n.jsx(Pe,{title:"Clear All Prompts",onClick:_=>{_.stopPropagation(),h()},className:"p-1 hover:bg-red-900/50 rounded text-gray-500 hover:text-red-500 transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),l&&n.jsx("button",{onClick:_=>{_.stopPropagation(),l()},className:"p-1 hover:bg-gray-700 rounded text-cyan-400 hover:text-white transition-colors",title:"Add Prompt Slot",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]})]}),n.jsxs("div",{ref:b,className:"overflow-y-auto custom-scrollbar p-2 space-y-2 flex-grow min-h-0",onWheel:_=>_.stopPropagation(),children:[x.map(_=>{const S=a==null?void 0:a.get(_+1),P=t[_],j=g?S||"":P!==void 0?P:o,M=!g&&P===void 0&&!!o,D=w===_;return n.jsxs("div",{ref:O=>{y.current[_]=O},className:`flex flex-col bg-gray-800 rounded border transition-colors ${D?"border-cyan-500 ring-1 ring-cyan-500":"border-gray-700"}`,onClick:()=>p&&p(_),children:[n.jsxs("div",{className:"flex items-center justify-between px-2 py-1 bg-gray-700/50 border-b border-gray-600/30 h-7",children:[n.jsxs("span",{className:"text-[10px] font-bold text-gray-400 uppercase",children:["Frame ",_+1]}),!g&&u&&d&&n.jsxs("div",{className:"flex items-center space-x-0.5",children:[n.jsx("button",{onClick:O=>{O.stopPropagation(),u(_,0)},className:"p-0.5 text-gray-500 hover:text-white rounded",title:"Move to Top",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),n.jsx("button",{onClick:O=>{O.stopPropagation(),u(_,_-1)},disabled:_===0,className:"p-0.5 text-gray-500 hover:text-white rounded disabled:opacity-30",title:"Move Up",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M5 15l7-7 7 7"})})}),n.jsx("button",{onClick:O=>{O.stopPropagation(),u(_,_+1)},disabled:_===e-1,className:"p-0.5 text-gray-500 hover:text-white rounded disabled:opacity-30",title:"Move Down",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M19 9l-7 7-7-7"})})}),n.jsx("button",{onClick:O=>{O.stopPropagation(),u(_,e)},className:"p-0.5 text-gray-500 hover:text-white rounded",title:"Move to Bottom",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx("button",{onClick:O=>{O.stopPropagation(),d(_)},className:"p-0.5 text-gray-500 hover:text-red-400 rounded",title:"Delete Frame",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})]}),n.jsx(Tn,{value:j,onDebouncedChange:O=>!g&&r(_,O),placeholder:o||i("node.content.editPromptPlaceholder"),className:`w-full p-2 bg-transparent border-none rounded-b resize-none focus:outline-none text-xs min-h-[60px] ${M?"text-gray-500 italic":"text-gray-200"}`,readOnly:g,onWheel:O=>O.stopPropagation(),onMouseDown:O=>O.stopPropagation()})]},_)}),e===0&&n.jsx("div",{className:"text-center text-gray-500 text-xs py-4",children:"Add input images or prompts to define frames."})]})]})}),LP=v.forwardRef(({nodeId:e,state:t,leftPaneWidth:o,viewScale:r,imageSlots:a,imageSlotsB:i,onUpdateState:s,onCleanupInputB:l,inputListActions:c,previewElement:d,libraryItems:u,upstreamPrompt:p,upstreamPromptsMap:h,isTextConnected:w,isInputConnected:k,isEditing:b,seqTotalFrames:y,handleDetachAndPasteInput:g,handleManualRefresh:m,t:x,deselectAllNodes:_,onSyncPrompts:S,onDeleteFrame:P,onMoveFrame:j,onSelectFrame:M,onClearFrames:D,selectedFrameIndex:O},B)=>{const{topPaneHeight:E,inputImages:I,inputImagesB:N,checkedInputIndices:T,isSequenceMode:F,isSequentialCombinationMode:z,isSequentialPromptMode:G,isSequentialEditingWithPrompts:U,enableAspectRatio:R,framePrompts:q,prompt:H,enableOutpainting:ne,outpaintingPrompt:X}=t,re=v.useRef(null),{getFullSizeImage:de,onCheck:ge,onSelectAll:te,onSelectNone:le,onClear:ee,onClick:se,onMove:ie,onRemove:oe,onMoveToB:A,onFileClick:K,onDropFiles:Z,onDropData:W,onSlotDrop:Q}=c,ce=t.model==="gemini-3-pro-image-preview"?8:4,fe=x("node.content.inputImage"),$=x(F&&z?"imageEditor.inputA":"imageEditor.input"),V=`${x("imageEditor.inputB")} (Max ${ce-1})`,J=v.useCallback(Y=>{Y.preventDefault(),Y.stopPropagation();const ae=Y.clientY,ue=E,he=r,ye=me=>{const _e=(me.clientY-ae)/he;if(re.current){const pe=re.current.offsetHeight,xe=R?ay:ry,Se=Math.max(Vs,Math.min(ue+_e,pe-xe));s({topPaneHeight:Se})}},ve=()=>{window.removeEventListener("mousemove",ye),window.removeEventListener("mouseup",ve)};window.addEventListener("mousemove",ye),window.addEventListener("mouseup",ve)},[E,s,r,R]);return n.jsxs("div",{ref:re,style:{width:`${o}px`},className:"h-full flex flex-col flex-shrink-0 pr-1",children:[n.jsxs("div",{className:"flex flex-col flex-shrink-0",style:{height:`${E}px`},children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsxs("div",{className:"flex items-center space-x-1",children:[k&&n.jsx(ut,{content:x("node.action.detachAndPaste"),children:n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white rounded transition-colors",onClick:Y=>{Y.stopPropagation(),g()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z",clipRule:"evenodd"})})})}),n.jsx("label",{className:"text-xs font-medium text-gray-400 flex-shrink-0",children:fe})]}),n.jsx(Pe,{title:" ",onClick:Y=>{Y.stopPropagation(),m()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})})]}),n.jsxs("div",{className:"flex-grow flex flex-col gap-1 min-h-0",children:[!U&&n.jsx(e0,{title:$,slots:a,isB:!1,isEditing:b,checkedIndices:T,getFullSizeImage:Y=>de(Y),onCheck:Y=>ge(Y,!1),onSelectAll:()=>te(!1),onSelectNone:()=>le(!1),onClear:()=>ee(!1),onClick:Y=>se(Y,!1),onReorder:(Y,ae)=>ie(Y,ae,!1),onRemove:Y=>oe(Y,!1),onMoveToB:z?A:void 0,onFileClick:()=>K(!1),onDropFiles:Y=>Z(Y,!1),onDropData:Y=>W(Y,!1),onSlotDrop:(Y,ae)=>Q(Y,ae,!1),t:x,isSequentialCombinationMode:z,onSetCheckedIndices:Y=>s({checkedInputIndices:Y}),onInvertSelection:()=>{const ae=a.map((ue,he)=>he).filter(ue=>!T.includes(ue));s({checkedInputIndices:ae})}}),(U||F&&z)&&n.jsx(e0,{title:V,slots:i,isB:!0,isEditing:b,checkedIndices:[],getFullSizeImage:Y=>de(2e3+Y),onCheck:()=>{},onSelectAll:()=>{},onSelectNone:()=>{},onClear:()=>ee(!0),onClick:Y=>se(Y,!0),onReorder:(Y,ae)=>ie(Y,ae,!0),onRemove:Y=>oe(Y,!0),onFileClick:()=>K(!0),onDropFiles:Y=>Z(Y,!0),onDropData:Y=>W(Y,!0),onSlotDrop:(Y,ae)=>Q(Y,ae,!0),t:x,isSequentialCombinationMode:!0})]})]}),n.jsx("div",{onMouseDown:J,className:"h-2 w-full bg-gray-700/50 hover:bg-cyan-600 cursor-row-resize rounded transition-colors flex-shrink-0 my-1"}),n.jsxs("div",{className:"flex-grow min-h-0 flex flex-col space-y-2",children:[n.jsx("div",{className:"flex-shrink-0 space-y-2",children:n.jsx(MP,{state:t,onUpdateState:s,onCleanupInputB:l,isEditing:b,t:x,nodeId:e,deselectAllNodes:_})}),d,n.jsxs("div",{className:"flex-grow flex flex-col min-h-0 mt-2 space-y-2 relative",children:[n.jsxs("div",{className:"relative flex-grow min-h-0 flex flex-col overflow-hidden",children:[!G&&!U&&n.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-1 mb-1",children:[n.jsx("div",{className:"flex-grow min-w-0",children:n.jsx(Fp,{libraryItems:u,onPromptInsert:Y=>s({prompt:H?`${H.trim()}, ${Y}`:Y})})}),n.jsx(Pe,{title:x("node.action.clear"),onClick:()=>s({prompt:""}),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),n.jsx("div",{className:"flex-grow min-h-0 mt-1 relative",children:G&&F||U?n.jsx(RP,{ref:B,totalFrames:U?y:a.length,framePrompts:q||{},globalPrompt:H,onChange:(Y,ae)=>s({framePrompts:{...q||{},[Y]:ae}}),upstreamPrompts:h,t:x,visibleIndices:U?void 0:T,onAddFrame:U?()=>{const Y=Object.keys(q||{}).length;s({framePrompts:{...q||{},[Y]:""}})}:void 0,onSync:S,onDeleteFrame:P,onMoveFrame:j,onSelectFrame:M,onClearAll:D,selectedFrameIndex:O}):n.jsx(Tn,{value:w?p:H,onDebouncedChange:Y=>s({prompt:Y}),placeholder:w?p||x("node.content.connectedPlaceholder"):x("node.content.editPromptPlaceholder"),className:"w-full h-full p-2 bg-gray-900/50 rounded-md resize-none border border-gray-600 focus:border-cyan-500 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500",readOnly:w,onFocus:_,onWheel:Y=>Y.stopPropagation(),onMouseDown:Y=>Y.stopPropagation()})})]}),R&&n.jsxs("div",{className:"flex-shrink-0 space-y-2 pt-1 border-t border-gray-700/50",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("input",{id:`outpainting-toggle-${e}`,type:"checkbox",checked:ne,onChange:Y=>s({enableOutpainting:Y.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-cyan-600 focus:ring-cyan-500 bg-gray-700 cursor-pointer",onMouseDown:Y=>Y.stopPropagation()}),n.jsx("label",{htmlFor:`outpainting-toggle-${e}`,className:"text-sm text-gray-300 select-none cursor-pointer",children:x("node.content.enableOutpainting")})]}),ne&&n.jsx(Tn,{value:X,onDebouncedChange:Y=>s({outpaintingPrompt:Y}),placeholder:x("node.content.outpaintingPromptPlaceholder"),className:"w-full p-2 bg-gray-900/50 rounded-md resize-none border border-gray-600 focus:border-cyan-500 focus:outline-none text-xs",style:{height:"60px"},onFocus:_,onWheel:Y=>Y.stopPropagation(),onMouseDown:Y=>Y.stopPropagation()})]})]})]})]})}),DP=({node:e,onValueChange:t,onEditImage:o,onStopEdit:r,isEditingImage:a,onPasteImage:i,onSetImageEditorOutputToInput:s,connectedImageSources:l,t:c,deselectAllNodes:d,connectedInputs:u,onCopyImageToClipboard:p,onDownloadImage:h,libraryItems:w,onDetachImageToNode:k,getUpstreamNodeValues:b,viewTransform:y,setImageViewer:g,getFullSizeImage:m,setFullSizeImage:x,onDownloadImageFromUrl:_,onRefreshUpstreamData:S,isStopping:P,onCutConnections:j,addToast:M})=>{const{setConnections:D,handleNavigateToNodeFrame:O,nodes:B,connections:E}=Ut(),I=v.useRef(null),N=v.useRef(null),T=v.useRef(null),F=v.useRef(null),[z,G]=v.useState(null),U=v.useRef(null),[R,q]=v.useState(!1),[H,ne]=v.useState(null),X=v.useRef(null),[re,de]=v.useReducer(je=>je+1,0),ge=v.useMemo(()=>{try{return{...Zg,...JSON.parse(e.value||"{}")}}catch{return Zg}},[e.value]),te=v.useRef(ge);te.current=ge;const{inputImages:le,inputImagesB:ee,prompt:se,outputImage:ie,model:oe,aspectRatio:A,enableAspectRatio:K,leftPaneWidth:Z,topPaneHeight:W,resolution:Q,isSequenceMode:ce,isSequentialCombinationMode:fe,isSequentialEditingWithPrompts:$,framePrompts:V,sequenceOutputs:J,checkedSequenceOutputIndices:Y,checkedInputIndices:ae,enableOutpainting:ue,outpaintingPrompt:he,autoDownload:ye,autoCrop169:ve,isSequentialPromptMode:me,createZip:_e,selectedSourceFrameIndex:pe}=ge,xe=oe==="gemini-3-pro-image-preview",Se=u==null?void 0:u.has("text"),Le=(y==null?void 0:y.scale)||1,Ee=v.useCallback(je=>{const Ve={...te.current,...je};te.current=Ve,t(e.id,JSON.stringify(Ve))},[t,e.id]);v.useEffect(()=>{if(!e.width||!e.height)return;const je=Lt+Wt*2,Ve=e.width-Xg-8;let Ke=Z;Z>Ve?Ke=Math.max(ys,Ve):Z<ys&&(Ke=ys);const ot=e.height-je-(K?ay:ry)-8;let et=W;W>ot?et=Math.max(Vs,ot):W<Vs&&(et=Vs),(Ke!==Z||et!==W)&&Ee({leftPaneWidth:Ke,topPaneHeight:et})},[e.width,e.height,Z,W,K,Ee]);const Me=v.useCallback(()=>{Ee({inputImagesB:[],isSequentialCombinationMode:!1,isSequentialEditingWithPrompts:!1,isSequentialPromptMode:!1})},[Ee]),De=v.useCallback(()=>{if(ce){const je=Y?[...Y].sort((Ve,Ke)=>Ve-Ke):[];o(e.id,je)}else o(e.id)},[ce,e.id,Y,o]),Te=v.useCallback(()=>{r&&r()},[r]),Re=v.useCallback(()=>{const Ve=(te.current.sequenceOutputs||[]).map(Ke=>Ke?Ke.status==="done"?Ke:{...Ke,status:"idle"}:{status:"idle",thumbnail:null});Ee({sequenceOutputs:Ve}),S&&S(e.id),de()},[Ee,S,e.id]),we=v.useCallback(je=>{je.preventDefault(),je.stopPropagation();const Ve=je.clientX,Ke=Z;if(!T.current)return;const Xe=T.current.offsetWidth,rt=(y==null?void 0:y.scale)||1,ot=bt=>{const _t=(bt.clientX-Ve)/rt,xt=Math.max(ys,Math.min(Ke+_t,Xe-Xg));Ee({leftPaneWidth:xt})},et=()=>{window.removeEventListener("mousemove",ot),window.removeEventListener("mouseup",et)};window.addEventListener("mousemove",ot),window.addEventListener("mouseup",et)},[Z,Ee,y==null?void 0:y.scale]),Ce=v.useMemo(()=>{if(!Se)return;const je=b(e.id,"text",void 0,!0).filter(Xe=>typeof Xe=="string"),Ve=new Map;let Ke=!1;return je.forEach(Xe=>{const rt=Xe.trim();if(rt.startsWith("{")||rt.startsWith("["))try{const ot=JSON.parse(Xe);let et=[];if(ot.sourcePrompts||ot.modifiedPrompts){const bt=ot.sourcePrompts||[],_t=ot.modifiedPrompts||[],xt=new Map;bt.forEach(Nt=>xt.set(Nt.frameNumber,Nt)),_t.forEach(Nt=>xt.set(Nt.frameNumber,{...xt.get(Nt.frameNumber),...Nt})),et=Array.from(xt.values()),Ke=!0}else ot.type==="script-prompt-modifier-data"?(et=ot.finalPrompts||ot.prompts||[],Ke=!0):Array.isArray(ot)&&(et=ot,Ke=!0);et.length>0&&et.forEach((bt,_t)=>{const xt=bt.frameNumber!==void 0?bt.frameNumber:_t+1;bt.prompt&&Ve.set(xt,bt.prompt)})}catch{}}),Ke?Ve:void 0},[Se,b,e.id,re]),qe=v.useMemo(()=>Se&&!Ce?b(e.id,"text",void 0,!0).filter(je=>typeof je=="string").join(`

`):"",[Se,b,e.id,Ce]),Be=v.useMemo(()=>b(e.id,"image",void 0,!0),[b,e.id,re]),Ie=v.useMemo(()=>b(e.id,"image_b",void 0,!0),[b,e.id,re]),We=async je=>{if(je instanceof File)return new Promise(Ve=>{const Ke=new FileReader;Ke.onload=Xe=>{var rt;return Ve((rt=Xe.target)==null?void 0:rt.result)},Ke.readAsDataURL(je)});if(typeof je=="string"){if(je.startsWith("data:"))return je;try{const Ke=await(await fetch(je)).blob();return new Promise(Xe=>{const rt=new FileReader;rt.onload=ot=>{var et;return Xe((et=ot.target)==null?void 0:et.result)},rt.readAsDataURL(Ke)})}catch{return null}}return null},at=async(je,Ve)=>{const Xe=(await Promise.all(je.map(_t=>We(_t)))).filter(Boolean);if(Xe.length===0)return;const rt=Ve?te.current.inputImagesB||[]:te.current.inputImages||[],ot=Ve?2e3:0,et=[];for(let _t=0;_t<Xe.length;_t++){const xt=Xe[_t],Nt=rt.length+_t;x(e.id,ot+Nt+1,xt);const It=await Rt(xt,256,256);et.push(It)}const bt=[...rt,...et];Ee(Ve?{inputImagesB:bt}:{inputImages:bt})},Jt=v.useCallback((je,Ve)=>{const Ke=Ve?"inputImagesB":"inputImages",rt=[...Ve?ee:le];rt.splice(je,1);const ot=Ve?2e3:0;for(let bt=je;bt<rt.length;bt++){const _t=m(e.id,ot+bt+2);_t&&x(e.id,ot+bt+1,_t)}const et={[Ke]:rt};!Ve&&ae&&(et.checkedInputIndices=ae.filter(bt=>bt!==je).map(bt=>bt>je?bt-1:bt)),Ee(et)},[le,ee,ae,Ee,e.id,m,x]),Oe=v.useCallback((je,Ve,Ke)=>{const Xe=Ke?ee:le;if(je===Ve||Ve<0||Ve>=Xe.length)return;const rt=Ke?2e3:0,ot=Xe.map((xt,Nt)=>({thumb:xt,full:m(e.id,rt+Nt+1)})),[et]=ot.splice(je,1);ot.splice(Ve,0,et),ot.forEach((xt,Nt)=>{xt.full&&x(e.id,rt+Nt+1,xt.full)});const bt=ot.map(xt=>xt.thumb),_t={[Ke?"inputImagesB":"inputImages"]:bt};if(!Ke&&ae){const xt=ae.includes(je);let Nt=ae.map(It=>{if(It===je)return-1;if(je<Ve){if(It>je&&It<=Ve)return It-1}else if(It>=Ve&&It<je)return It+1;return It});if(xt){const It=Nt.indexOf(-1);It!==-1&&(Nt[It]=Ve)}Nt=Nt.filter(It=>It!==-1).sort((It,Zo)=>It-Zo),_t.checkedInputIndices=Nt}Ee(_t)},[le,ee,ae,Ee,e.id,m,x]),Ae=v.useCallback(je=>{const Ve=le[je],Ke=m(e.id,je+1)||Ve,Xe=[...le];Xe.splice(je,1);for(let et=je;et<Xe.length;et++){const bt=m(e.id,et+2);x(e.id,et+1,bt||Xe[et])}const rt=[...ee,Ve];Ke&&x(e.id,2e3+rt.length,Ke);let ot=ae||[];ot.length>0&&(ot=ot.filter(et=>et!==je).map(et=>et>je?et-1:et)),Ee({inputImages:Xe,inputImagesB:rt,checkedInputIndices:ot})},[le,ee,m,x,e.id,Ee,ae]),Ue=async(je,Ve,Ke=!1)=>{const Xe=await We(Ve);if(!Xe)return;const rt=Ke?2e3:0;x(e.id,rt+je+1,Xe);const ot=await Rt(Xe,256,256),et=Ke?[...ee]:[...le];et[je]=ot,Ee({[Ke?"inputImagesB":"inputImages"]:et})},ke=(je,Ve,Ke)=>{const Xe=[];return Ve.forEach((rt,ot)=>{let et=null;typeof rt=="string"?et=rt:rt&&typeof rt=="object"&&(et=`data:${rt.mimeType};base64,${rt.base64ImageData}`),Xe.push({type:"connected",src:et,index:ot})}),je.forEach((rt,ot)=>Xe.push({type:"local",src:rt,index:ot})),Xe},Ne=v.useMemo(()=>ke(le,Be),[le,Be]),He=v.useMemo(()=>ke(ee,Ie),[ee,Ie]),Fe=(u==null?void 0:u.has("image"))||ge.isSequentialEditingWithPrompts&&(u==null?void 0:u.has("image_b")),$e=v.useMemo(()=>{if($){const je=Object.keys(V||{}).length,Ve=(Ce==null?void 0:Ce.size)||0;return Math.max(je,Ve,1)}return Ne.length},[$,V,Ce,Ne.length]);v.useEffect(()=>{if($)(!Y||Y.length!==$e)&&Ee({checkedSequenceOutputIndices:Array.from({length:$e},(je,Ve)=>Ve)});else{const je=ae?ae.length:0;(Ne.length>je||ae===void 0)&&Ee({checkedInputIndices:Ne.map((Ve,Ke)=>Ke)})}},[Ne.length,$,$e]),$?He.length>0:Ne.length>0;const Ye=v.useMemo(()=>{if($){if(He.length>0){const je=He[He.length-1];return je.type==="local"&&m(e.id,2e3+je.index+1)||je.src}}else{const je=Ne.filter((Ve,Ke)=>!ae||ae.includes(Ke));if(je.length>0){const Ve=je[je.length-1];return Ve.type==="local"&&m(e.id,Ve.index+1)||Ve.src}}return null},[Ne,He,m,e.id,ae,$]);v.useEffect(()=>{(async()=>{if(K&&Ye&&A&&A!=="Auto")try{const{formattedImage:Ve}=await Cr(Ye,A);U.current=Ve,G(await Rt(Ve,256,256))}catch{G(null)}else K&&Ye?(U.current=Ye,G(Ye.length>1e5?await Rt(Ye,256,256):Ye)):(G(null),U.current=null)})()},[Ye,A,K]);const st=async()=>{U.current&&at([U.current],!1)},ht=(je,Ve)=>{const Ke=Ve?He:Ne,Xe=Ve?2e3:0,rt=Ve?[]:b(e.id,"image",void 0,!1),ot=Ve?b(e.id,"image_b",void 0,!1):[],et=Ve?ot:rt,bt=Ke.map((_t,xt)=>{let Nt=null;if(_t.type==="local")Nt=m(e.id,Xe+_t.index+1)||_t.src;else{const It=et[_t.index];typeof It=="object"&&It.base64ImageData?Nt=`data:${It.mimeType};base64,${It.base64ImageData}`:typeof It=="string"?Nt=It:Nt=_t.src}return Nt?{src:Nt,frameNumber:xt+1,prompt:`Input ${Ve?"B ":""}Image ${xt+1}`}:null}).filter(Boolean);bt.length>0&&g({sources:bt,initialIndex:je})},ft=v.useCallback(()=>{let je="image",Ve=!1;te.current.isSequentialEditingWithPrompts&&(je="image_b",Ve=!0);const Ke=b(e.id,je,void 0,!1),Xe=[];Ke.forEach(rt=>{typeof rt=="string"?Xe.push(rt):rt&&typeof rt=="object"&&Xe.push(`data:${rt.mimeType};base64,${rt.base64ImageData}`)}),Xe.length>0&&(at(Xe,Ve),j&&D(rt=>rt.filter(ot=>!(ot.toNodeId===e.id&&(ot.toHandleId===je||je==="image"&&ot.toHandleId===void 0)))))},[b,at,j,e.id,D]),mt=je=>{x(e.id,0,je),Rt(je,256,256).then(Ve=>Ee({outputImage:Ve}))},dt={getFullSizeImage:je=>m(e.id,je),onCheck:(je,Ve)=>{if(!Ve){const Ke=te.current.checkedInputIndices||[],Xe=Ke.includes(je)?Ke.filter(rt=>rt!==je):[...Ke,je];Ee({checkedInputIndices:Xe})}},onSelectAll:je=>{je||Ee({checkedInputIndices:Ne.map((Ve,Ke)=>Ke)})},onSelectNone:je=>{je||Ee({checkedInputIndices:[]})},onClear:je=>{Ee(je?{inputImagesB:[]}:{inputImages:[],checkedInputIndices:[]})},onClick:ht,onMove:Oe,onRemove:Jt,onMoveToB:fe?Ae:void 0,onFileClick:je=>{var Ve,Ke;return je?(Ve=N.current)==null?void 0:Ve.click():(Ke=I.current)==null?void 0:Ke.click()},onDropFiles:at,onDropData:(je,Ve)=>at([je],Ve),onSlotDrop:Ue},kt=v.useCallback(je=>{const Ve={...te.current.framePrompts},Ke=[...te.current.sequenceOutputs||[]],Xe=Math.max(...Object.keys(Ve).map(Number)),rt={};for(let et=0;et<=Xe;et++)et<je?Ve[et]&&(rt[et]=Ve[et]):et>je&&Ve[et]&&(rt[et-1]=Ve[et]);je<Ke.length&&Ke.splice(je,1);let ot=pe;ot===je?ot=null:ot!==null&&ot>je&&ot--,Ee({framePrompts:rt,sequenceOutputs:Ke,selectedSourceFrameIndex:ot})},[Ee,pe]),Ct=v.useCallback(()=>{Ee({framePrompts:{},sequenceOutputs:[],selectedSourceFrameIndex:null})},[Ee]),vt=v.useCallback((je,Ve)=>{const Ke={...te.current.framePrompts},Xe=[...te.current.sequenceOutputs||[]],rt=Math.max(...Object.keys(Ke).map(Number),je,Ve),ot=[];for(let Nt=0;Nt<=rt;Nt++)ot.push(Ke[Nt]||"");const[et]=ot.splice(je,1);ot.splice(Ve,0,et);const bt={};for(ot.forEach((Nt,It)=>{Nt&&(bt[It]=Nt)});Xe.length<=Math.max(je,Ve);)Xe.push({status:"idle",thumbnail:null});const[_t]=Xe.splice(je,1);Xe.splice(Ve,0,_t);let xt=pe;xt===je?xt=Ve:xt!==null&&(je<Ve?xt>je&&xt<=Ve&&xt--:xt>=Ve&&xt<je&&xt++),Ee({framePrompts:bt,sequenceOutputs:Xe,selectedSourceFrameIndex:xt})},[Ee,pe]),yt=v.useCallback(je=>{Ee({selectedSourceFrameIndex:je})},[Ee]),wt=v.useMemo(()=>K&&n.jsx("div",{className:"relative group flex-shrink-0 mt-2 h-40 bg-gray-900/50 rounded-md flex items-center justify-center",children:z?n.jsxs(n.Fragment,{children:[n.jsx("img",{src:z,alt:"Preview",className:"max-w-full max-h-full object-contain",draggable:!0,onDragStart:je=>{(U.current||z)&&(je.dataTransfer.setData("application/prompt-modifier-drag-image",U.current||z),je.dataTransfer.effectAllowed="copy",je.stopPropagation())}}),n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx(Pe,{title:"Copy",onClick:je=>{je.stopPropagation(),p(U.current||z)},children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Pe,{title:"Use as Input",onClick:st,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L9.414 11H13a1 1 0 100-2H9.414l1.293-1.293z",clipRule:"evenodd"})})}),n.jsx(Pe,{title:"Detach",onClick:()=>{U.current&&k(U.current,e.id)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})})]})]}):n.jsx("p",{className:"text-gray-500 text-sm text-center px-2",children:c("node.content.previewPlaceholder")})}),[K,z,st,k,p,c]),qn=v.useCallback(je=>{F.current&&F.current.scrollToIndex(je)},[]),Cn=v.useCallback(je=>{const Ve=(Xe,rt,ot=new Set)=>{if(!E||!B||ot.has(Xe))return;ot.add(Xe);const et=E.find(_t=>_t.toNodeId===Xe&&(_t.toHandleId===rt||rt===void 0));if(!et)return;const bt=B.find(_t=>_t.id===et.fromNodeId);if(bt)return bt.type===L.REROUTE_DOT?Ve(bt.id,void 0,ot):bt.id},Ke=Ve(e.id,"text");Ke&&O&&O(Ke,je+1)},[E,B,O,e.id]),Pt=v.useCallback(()=>{if(!Ce||Ce.size===0)return;const je={...V};Ce.forEach((Ve,Ke)=>{je[Ke]=Ve}),Ee({framePrompts:je})},[Ce,V,Ee]);return n.jsxs("div",{ref:T,className:"flex w-full h-full",children:[n.jsx(ec,{isOpen:R,onClose:()=>{q(!1),X.current=null},onApply:mt,imageSrc:H}),n.jsx("input",{ref:I,type:"file",accept:"image/*",className:"hidden",onChange:je=>{var Ve;(Ve=je.target.files)!=null&&Ve.length&&at(Array.from(je.target.files),!1)},multiple:!0}),n.jsx("input",{ref:N,type:"file",accept:"image/*",className:"hidden",onChange:je=>{var Ve;(Ve=je.target.files)!=null&&Ve.length&&at(Array.from(je.target.files),!0)},multiple:!0}),n.jsx(LP,{ref:F,nodeId:e.id,state:ge,leftPaneWidth:Z,viewScale:Le,imageSlots:Ne,imageSlotsB:He,onUpdateState:Ee,onCleanupInputB:Me,onEditImage:()=>{},inputListActions:dt,previewElement:wt,libraryItems:w,upstreamPrompt:qe,upstreamPromptsMap:Ce,isTextConnected:Se,isInputConnected:Fe,isEditing:a,seqTotalFrames:ce&&$?$e:Ne.length,handleDetachAndPasteInput:ft,handleManualRefresh:Re,t:c,deselectAllNodes:d,onCopyImageToClipboard:p,onDetachImageToNode:k,onSyncPrompts:Pt,onDeleteFrame:kt,onMoveFrame:vt,onSelectFrame:yt,onClearFrames:Ct,selectedFrameIndex:pe}),n.jsx("div",{onMouseDown:we,className:"w-2 h-full bg-gray-700/50 hover:bg-cyan-600 cursor-col-resize rounded transition-colors flex-shrink-0"}),n.jsx(AP,{state:ge,imageSlots:$?He:Ne,hasInputImages:$?He.length>0:Ne.length>0,isEditing:a,isStopping:P,isGlobalProcessing:!1,totalFrames:$?$e:ae.length,doneCount:J.filter((je,Ve)=>($||ae.includes(Ve))&&(je==null?void 0:je.status)==="done").length,currentGeneratingDisplay:J.findIndex(je=>(je==null?void 0:je.status)==="generating")+1||"-",fullSizeOutputForCopy:m(e.id,0)||ie,imageForEditor:m(e.id,0)||ie,modelOptions:[],isNanoBanana:xe,onUpdateState:Ee,onRunSelected:De,onDownloadSelected:async()=>{var Xe,rt;const je=[...Y].sort((ot,et)=>ot-et),Ke=new Date().toISOString().split("T")[0];if(_e)try{const ot=new Li;for(const _t of je){const xt=m(e.id,1e3+_t)||((Xe=J[_t])==null?void 0:Xe.thumbnail);if(xt&&xt.startsWith("data:image")){const It=`Image_Editor_Frame_${String(_t+1).padStart(3,"0")}.png`,Zo=xt.split(",")[1];ot.file(It,Zo,{base64:!0})}}const et=await ot.generateAsync({type:"blob"}),bt=document.createElement("a");bt.href=URL.createObjectURL(et),bt.download=`Image_Editor_${Ke}.zip`,bt.click(),URL.revokeObjectURL(bt.href),M&&M("ZIP Downloaded","success")}catch(ot){console.error("ZIP Error",ot),M&&M("Failed to create ZIP","error")}else for(const ot of je){const et=m(e.id,1e3+ot)||((rt=J[ot])==null?void 0:rt.thumbnail),_t=`Image_Editor_Frame_${String(ot+1).padStart(3,"0")}_${Ke}.png`;et&&(_(et,ot+1,se||"Sequence",_t),await new Promise(xt=>setTimeout(xt,300)))}},onStartQueue:()=>{},onStop:Te,onEdit:De,onOpenEditor:()=>{const je=m(e.id,0)||ie;je&&(ne(je),X.current=0,q(!0))},onSetOutputToInput:()=>s(e.id),onDownload:()=>h(e.id),onCopy:()=>{const je=m(e.id,0)||ie;je&&p(je)},onSelectAll:()=>Ee({checkedSequenceOutputIndices:Array.from({length:$?$e:Ne.length},(je,Ve)=>Ve)}),onSelectNone:()=>Ee({checkedSequenceOutputIndices:[]}),onInvertSelection:()=>{const je=$?$e:Ne.length,Ve=te.current.checkedSequenceOutputIndices||[],Ke=Array.from({length:je},(Xe,rt)=>rt).filter(Xe=>!Ve.includes(Xe));Ee({checkedSequenceOutputIndices:Ke})},onManualRefresh:Re,onOutputClick:()=>{const je=m(e.id,0)||ie;je&&g({sources:[{src:je,frameNumber:0,prompt:se}],initialIndex:0})},onSequenceOutputClick:(je,Ve)=>{if(!Ve)return;const Ke=J.map((rt,ot)=>{const et=m(e.id,1e3+ot)||(rt==null?void 0:rt.thumbnail);return et?{src:et,frameNumber:ot+1,prompt:`Output ${ot+1}`}:null}).filter(rt=>rt!==null),Xe=Ke.findIndex(rt=>rt.frameNumber===je+1);Xe!==-1&&g({sources:Ke,initialIndex:Xe})},onCheckOutput:je=>{const Ve=te.current.checkedSequenceOutputIndices||[],Ke=Ve.includes(je)?Ve.filter(Xe=>Xe!==je):[...Ve,je];Ee({checkedSequenceOutputIndices:Ke})},onCopyFrame:(je,Ve)=>{var Xe;je.stopPropagation();const Ke=m(e.id,1e3+Ve)||((Xe=J[Ve])==null?void 0:Xe.thumbnail);Ke&&p(Ke)},onDownloadFrame:(je,Ve)=>{var Xe;je.stopPropagation();const Ke=m(e.id,1e3+Ve)||((Xe=J[Ve])==null?void 0:Xe.thumbnail);if(Ke){const ot=new Date().toISOString().split("T")[0],bt=`Image_Editor_Frame_${String(Ve+1).padStart(3,"0")}_${ot}.png`;_(Ke,Ve+1,se,bt)}},onRegenerateFrame:(je,Ve)=>{je.stopPropagation(),o(e.id,[Ve])},onStopFrame:(je,Ve)=>{je.stopPropagation(),r&&r()},getFullSizeImage:je=>m(e.id,je),t:c,upstreamPrompt:qe,isTextConnected:Se,onEditPrompt:qn,onEditInSource:Cn})]})},zP=({node:e,onValueChange:t,onAnalyzeImage:o,onImageToText:r,isAnalyzingImage:a,t:i,deselectAllNodes:s,connectedImageSources:l,setImageViewer:c,getFullSizeImage:d,onSaveToLibrary:u,onCopyImageToClipboard:p,addToast:h,onPasteImage:w,onOutputHandleMouseDown:k,onOutputHandleTouchStart:b,getHandleColor:y,handleCursor:g})=>{const m=v.useRef(null),[x,_]=v.useState(!1),S=Ut(),P=S==null?void 0:S.onAddNode,j=S==null?void 0:S.setConnections,M=S==null?void 0:S.handleAnalyzePrompt,D=(S==null?void 0:S.connections)||[],O=(S==null?void 0:S.nodes)||[],B=v.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{image:null,description:"",softPrompt:!1}}},[e.value]),{image:E,description:I,softPrompt:N=!1}=B,T=l&&l.length>0,F=T?l[0]:E,z=le=>{t(e.id,JSON.stringify({...B,...le}))},G=le=>{var se;const ee=(se=le.target.files)==null?void 0:se[0];ee&&w(e.id,ee)},U=le=>{le.preventDefault(),le.stopPropagation(),_(!0);const ee=document.getElementById("app-container");ee&&ee.classList.remove("ring-2","ring-cyan-500","ring-inset")},R=le=>{le.preventDefault(),le.stopPropagation(),_(!0)},q=le=>{le.preventDefault(),le.stopPropagation(),_(!1)},H=le=>{var ie;le.preventDefault(),le.stopPropagation(),_(!1);const ee=le.dataTransfer.getData("application/prompt-modifier-drag-image");if(ee){fetch(ee).then(oe=>oe.blob()).then(oe=>{const A=new File([oe],"dragged_image.png",{type:oe.type});w(e.id,A)});return}const se=(ie=le.dataTransfer.files)==null?void 0:ie[0];se&&se.type.startsWith("image/")&&w(e.id,se)},ne=le=>{var se;if(le.stopPropagation(),!F&&T)return;if(!F&&!T){(se=m.current)==null||se.click();return}let ee=F;T||(ee=d(e.id,0)||E),ee&&c({sources:[{src:ee,frameNumber:0,prompt:I||"Analyzed Image"}],initialIndex:0})},X=le=>{le.stopPropagation();let ee=F;T||(ee=d(e.id,0)||E),ee&&p&&p(ee)},re=le=>{le.stopPropagation(),z({image:null}),h&&h(i("toast.contentCleared"))},de=le=>{le.stopPropagation(),I&&(navigator.clipboard.writeText(I),h&&h(i("toast.copiedToClipboard")))},ge=le=>{le.stopPropagation(),I&&u&&u(I,"Image Analyzer Prompts")},te=v.useCallback(()=>{if(!P||!j||!M||!I)return;const le=D.find(se=>se.fromNodeId===e.id&&se.fromHandleId==="text");let ee=null;if(le){const se=O.find(ie=>ie.id===le.toNodeId);se&&se.type===L.PROMPT_ANALYZER&&(ee=se.id)}if(ee)M(ee);else{const se={x:e.position.x+e.width+50,y:e.position.y},ie=P(L.PROMPT_ANALYZER,se);j(oe=>[...oe,{id:`conn-${Date.now()}-${Math.random()}`,fromNodeId:e.id,fromHandleId:"text",toNodeId:ie,toHandleId:void 0}]),setTimeout(()=>{M(ie)},100)}},[P,j,M,e,I,D,O]);return n.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[n.jsx("input",{ref:m,type:"file",accept:"image/*",className:"hidden",onChange:G}),n.jsxs("div",{className:"flex-1 flex flex-col min-h-0 space-y-2 relative group",children:[n.jsxs("div",{className:"flex-grow min-h-0 relative",children:[n.jsx("div",{onClick:ne,onDragEnter:U,onDragOver:R,onDragLeave:q,onDrop:H,className:`w-full h-full bg-gray-700 rounded-md flex items-center justify-center transition-all cursor-pointer ${x?"bg-gray-600 ring-2 ring-accent-text":"hover:bg-gray-600"}`,children:F?n.jsx("img",{src:F,alt:"Input",className:"object-contain w-full h-full",draggable:!0,onMouseDown:le=>le.stopPropagation(),onDragStart:le=>{let ee=F;T||(ee=d(e.id,0)||E),ee&&(le.dataTransfer.setData("application/prompt-modifier-drag-image",ee),le.dataTransfer.effectAllowed="copy",le.stopPropagation())}}):!T&&n.jsx("span",{className:"text-gray-400 pointer-events-none",children:i("node.content.dropImage")})}),T&&n.jsxs("div",{className:"absolute inset-0 bg-gray-900/50 flex items-center justify-center rounded-md pointer-events-none group-hover:bg-gray-900/30 transition-colors",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-gray-400 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),n.jsx("div",{className:"absolute top-full mt-2 px-2 py-1 bg-slate-700 text-slate-200 text-sm rounded-md shadow-xl z-50 opacity-0 group-hover:opacity-100 transition-opacity",children:i("node.content.connectedPlaceholder")})]}),F&&n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[n.jsx(Pe,{title:i("node.action.copy"),onClick:X,children:n.jsx(Dt,{className:"h-4 w-4"})}),!T&&n.jsx(Pe,{title:i("node.action.clear"),onClick:re,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),n.jsxs("div",{className:"flex flex-col gap-2 shrink-0",children:[n.jsx("button",{onClick:()=>o(e.id),disabled:a||!F,className:"w-full px-4 py-2 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center whitespace-nowrap",children:i(a?"node.content.analyzing":"node.content.analyzeImage")}),r&&n.jsx("button",{onClick:()=>r(e.id),disabled:a||!F,className:"w-full px-4 py-2 font-bold text-white bg-accent-secondary rounded-md hover:bg-accent-secondary-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center whitespace-nowrap",children:i("node.content.imageToText")})]})]}),n.jsxs("div",{className:"flex-1 flex flex-col min-h-0 space-y-2 relative group",children:[n.jsxs("div",{className:"flex-grow min-h-0 flex flex-col relative",children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-400",children:i("node.content.prompt")}),n.jsxs("div",{className:"flex space-x-1",children:[n.jsx(Pe,{title:i("node.action.copy"),onClick:de,disabled:!I,children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Pe,{title:i("catalog.saveTo"),onClick:ge,disabled:!I,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})})]})]}),n.jsx("textarea",{value:I,onChange:le=>z({description:le.target.value}),placeholder:i("node.content.descriptionHere"),className:"w-full h-full p-2 bg-gray-700 border-none rounded-md resize-none focus:ring-2 focus:ring-accent focus:outline-none flex-grow",onWheel:le=>le.stopPropagation(),onMouseDown:le=>le.stopPropagation(),onFocus:s})]}),n.jsx("div",{className:"flex items-center space-x-2 flex-shrink-0",children:n.jsx(Ot,{id:`soft-prompt-toggle-${e.id}`,checked:N,onChange:le=>z({softPrompt:le}),disabled:a||!F,label:" "})}),n.jsx("button",{onClick:te,disabled:!I||a,className:"w-full px-4 py-2 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex-shrink-0",children:i("node.content.analyzePrompt")})]})]})},qP=({node:e,onValueChange:t,onAnalyze:o,isAnalyzing:r,onOutputHandleMouseDown:a,getHandleColor:i,handleCursor:s,t:l,deselectAllNodes:c,onSaveToLibrary:d})=>{const u=v.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{environment:"",characters:[],action:"",emotion:"",style:"",softPrompt:!1}}},[e.value]),{environment:p,characters:h=[],action:w,emotion:k,style:b,softPrompt:y=!1}=u,g=Math.max(1,h.length),m=P=>{t(e.id,JSON.stringify({...u,...P}))},x=(P,j)=>{const M=[...h];M[P]=j,m({characters:M})},_=(P,j)=>{P.stopPropagation(),a(P,e.id,j)},S=(P,j,M,D,O)=>{const B=P.startsWith("character")?`${l("node.content.character")} ${O+1}`:l(`node.content.${P}`),E=l(`node.content.${P}Placeholder`),I=N=>{N.stopPropagation(),d&&j&&d(j,"Analyzer Prompts")};return n.jsxs("div",{className:"relative flex-grow flex flex-col",children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400",children:B}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(Pe,{tooltipPosition:"left",title:l("catalog.saveTo"),onClick:I,disabled:!j,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})}),n.jsx(Pe,{tooltipPosition:"left",title:l("node.action.copy"),onClick:N=>{N.stopPropagation(),navigator.clipboard.writeText(j||"")},children:n.jsx(Dt,{className:"h-4 w-4"})})]})]}),n.jsx("div",{className:"flex-grow min-h-0",children:n.jsx("textarea",{value:j||"",onChange:N=>M(N.target.value),placeholder:E,className:"w-full h-full p-2 bg-gray-700 border-none rounded-md resize-none focus:ring-2 focus:ring-accent focus:outline-none",onWheel:N=>N.stopPropagation(),onMouseDown:N=>N.stopPropagation(),onFocus:c})}),n.jsx("div",{onMouseDown:N=>_(N,D),style:{cursor:s},className:`absolute top-1/2 -right-2.5 w-5 h-5 rounded-full border-2 border-gray-900 transform -translate-y-1/2 ${i("text",D)} group`,children:n.jsx("div",{className:"absolute right-full mr-3 top-1/2 -translate-y-1/2 px-2 py-1 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:B})})]},D)};return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 overflow-y-auto overflow-x-hidden px-2",children:[S("environment",p,P=>m({environment:P}),"environment"),Array.from({length:g}).map((P,j)=>S("character",h[j]||"",M=>x(j,M),`character-${j}`,j)),S("action",w,P=>m({action:P}),"action"),S("emotion",k,P=>m({emotion:P}),"emotion"),S("style",b,P=>m({style:P}),"style")]}),n.jsx("div",{className:"flex items-center space-x-2 mt-2 px-2",children:n.jsx(Ot,{id:`soft-prompt-toggle-${e.id}`,checked:y,onChange:P=>m({softPrompt:P}),disabled:r,label:" "})}),n.jsx("div",{className:"px-2",children:n.jsx("button",{onClick:()=>o(e.id),disabled:r,className:"w-full px-4 py-2 mt-2 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex-shrink-0",children:l(r?"node.content.analyzing":"node.content.analyzePrompt")})})]})},OP=({node:e,onValueChange:t,onAnalyzeCharacter:o,isAnalyzingCharacter:r,t:a,onSelectNode:i})=>{const s=v.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{character:"",clothing:""}}},[e.value]),l=c=>{t(e.id,JSON.stringify({...s,...c}))};return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"grid grid-rows-2 gap-2 flex-grow min-h-0",children:[n.jsx("div",{className:"min-h-0",children:n.jsx("textarea",{value:s.character||"",onChange:c=>l({character:c.target.value}),placeholder:a("node.content.characterPlaceholder"),className:"w-full h-full p-2 bg-gray-700 border-none rounded-md resize-none focus:ring-2 focus:ring-cyan-500 focus:outline-none",onWheel:c=>c.stopPropagation(),onMouseDown:c=>{c.stopPropagation(),i()},onKeyDown:c=>c.stopPropagation()})}),n.jsx("div",{className:"min-h-0",children:n.jsx("textarea",{value:s.clothing||"",onChange:c=>l({clothing:c.target.value}),placeholder:a("node.content.clothingPlaceholder"),className:"w-full h-full p-2 bg-gray-700 border-none rounded-md resize-none focus:ring-2 focus:ring-cyan-500 focus:outline-none",onWheel:c=>c.stopPropagation(),onMouseDown:c=>{c.stopPropagation(),i()},onKeyDown:c=>c.stopPropagation()})})]}),n.jsx("button",{onClick:()=>o(e.id),disabled:r,className:"w-full px-4 py-2 mt-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:a(r?"node.content.analyzing":"node.content.analyzeCharacter")})]})},FP=({node:e,onValueChange:t,onEnhance:o,isEnhancing:r,onProcessChainForward:a,isExecutingChain:i,t:s,onSelectNode:l,onSavePromptToLibrary:c,addToast:d,connectedInputs:u,getUpstreamNodeValues:p})=>{const{language:h}=St(),w=Ut(),{tutorialStep:k,tutorialTargetId:b,advanceTutorial:y,skipTutorial:g}=w||{},m=b===e.id&&k==="prompt_processor_enhance",x=b===e.id&&k==="prompt_processor_waiting",_=()=>{o(e.id),m&&y&&y()};v.useEffect(()=>{x&&!r&&y&&y()},[r,x,y]);const S=v.useMemo(()=>{try{const T=JSON.parse(e.value||"{}");return typeof T=="object"&&T!==null?{inputPrompt:T.inputPrompt||"",prompt:T.prompt||"",safePrompt:T.safePrompt!==!1,technicalPrompt:T.technicalPrompt===!0}:{inputPrompt:"",prompt:e.value,safePrompt:!0,technicalPrompt:!1}}catch{return{inputPrompt:"",prompt:e.value,safePrompt:!0,technicalPrompt:!1}}},[e.value]),P=u==null?void 0:u.has(void 0),j=v.useMemo(()=>P?p(e.id).filter(F=>typeof F=="string"&&F.trim()!=="").join(", "):"",[P,p,e.id,e.value]),M=T=>{t(e.id,JSON.stringify({...S,safePrompt:T}))},D=T=>{t(e.id,JSON.stringify({...S,technicalPrompt:T}))},O=T=>{t(e.id,JSON.stringify({...S,inputPrompt:T}))},B=async()=>{try{const T=await navigator.clipboard.readText();if(T){const F=S.inputPrompt?`${S.inputPrompt}, ${T}`:T;O(F),d&&d(s("toast.pastedFromClipboard"))}}catch{d&&d(s("toast.pasteFailed"),"error")}},E=()=>{const T=ny(h),F=S.inputPrompt?`${S.inputPrompt}, ${T}`:T;O(F)},I=T=>{T.stopPropagation(),c&&S.prompt&&c(S.prompt)},N=T=>{T.stopPropagation(),S.prompt&&(navigator.clipboard.writeText(S.prompt),d&&d(s("toast.copiedToClipboard")))};return n.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[n.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsxs("div",{className:"flex items-center space-x-1",children:[P&&n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:P?s("node.content.connectedNode"):" "})]}),!P&&n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(Pe,{title:s("node.action.randomWord"),onClick:E,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})}),n.jsx(Pe,{title:s("node.action.paste"),onClick:B,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})})]})]}),n.jsx(Tn,{value:P?j:S.inputPrompt,onDebouncedChange:O,placeholder:s("node.content.editPromptPlaceholder"),className:`w-full h-full p-2 bg-input border-none rounded-md resize-none focus:ring-2 focus:ring-accent focus:outline-none ${P?"text-gray-400 cursor-default":"text-white"}`,onWheel:T=>T.stopPropagation(),onMouseDown:T=>{T.stopPropagation(),l()},readOnly:P})]}),n.jsxs("div",{className:"flex-1 flex flex-col min-h-0 relative",children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:s("node.content.enhancedResult")}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(Pe,{title:s("node.action.copy"),onClick:N,disabled:!S.prompt,children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Pe,{title:s("catalog.saveTo"),onClick:I,disabled:!S.prompt,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})})]})]}),n.jsx("textarea",{readOnly:!0,value:S.prompt,placeholder:s("node.content.enhancedPromptHere"),className:"w-full h-full p-2 bg-input border-none rounded-md resize-none focus:outline-none",onWheel:T=>T.stopPropagation(),onMouseDown:T=>{T.stopPropagation(),l()}})]}),n.jsxs("div",{className:"flex flex-col gap-1 pt-1 items-start",onMouseDown:T=>{T.stopPropagation(),l()},children:[n.jsx(ut,{content:s("node.promptProcessor.safePromptTooltip"),position:"top",align:"start",usePortal:!1,children:n.jsx(Ot,{checked:S.safePrompt,onChange:M,disabled:r||i,label:s("node.content.safePrompt")})}),n.jsx(ut,{content:s("node.promptProcessor.technicalPromptTooltip"),position:"top",align:"start",usePortal:!1,children:n.jsx(Ot,{checked:S.technicalPrompt,onChange:D,disabled:r||i,label:s("node.content.technicalPrompt")})})]}),n.jsxs("div",{className:"flex space-x-2 h-10",children:[n.jsx(Fn,{content:s(x?"tutorial.step2_waiting":"tutorial.step2"),isActive:!!m||!!x,position:"top",pulseColor:x?"rgba(234, 179, 8, 0.8)":void 0,onSkip:g,className:"flex-grow h-full",children:n.jsx(ut,{content:`${s("node.promptProcessor.enhanceTooltip")} (gemini-3-flash-preview)`,position:"top",className:"w-full h-full",usePortal:!1,children:n.jsx("button",{onClick:_,disabled:r||i,className:"w-full h-full px-4 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:s(r?"node.content.enhancing":"node.content.enhancePrompt")})})}),n.jsx(ut,{content:s("node.promptProcessor.chainTooltip"),position:"top",className:"h-10 w-10 flex-shrink-0",usePortal:!1,children:n.jsx("button",{onClick:()=>a(e.id),disabled:r||i,className:"h-10 w-10 flex items-center justify-center font-bold text-white bg-accent-secondary rounded-md hover:bg-accent-secondary-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:i?n.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 5l7 7m0 0l-7 7m7-7H3"})})})})]})]})},BP=({node:e,isGeneratingImage:t,isExecutingChain:o,onModelChange:r,onAspectRatioChange:a,onResolutionChange:i,onAutoDownloadChange:s,onGenerateImage:l,onStopChainExecution:c,onExecuteChain:d,t:u,onDownloadImage:p,setImageViewer:h,getFullSizeImage:w,getUpstreamNodeValues:k,isGlobalProcessing:b,onCopyImageToClipboard:y})=>{const g=Ut(),{tutorialStep:m,tutorialTargetId:x,advanceTutorial:_,skipTutorial:S}=g||{},P=x===e.id&&m==="image_output_generate",j=()=>{l(e.id),P&&_&&_()},M=z=>{z.stopPropagation();const G=w(e.id,0)||e.value;G&&y&&y(G)},D=["1:1","16:9","9:16","4:3","3:4"],O=[{value:"imagen-4.0-generate-001",label:"Imagen 4.0 (Quality)"},{value:"imagen-4.0-ultra-generate-preview-06-06",label:"Imagen 4.0 Ultra (Preview)"},{value:"gemini-3-pro-image-preview",label:"Gemini 3.0 Pro (Nano Banana Pro)"},{value:"gemini-2.5-flash-image",label:"Gemini 2.5 Flash Image (Nano Banana)"}],B=e.model==="gemini-3-pro-image-preview",I=!e.model||e.model.startsWith("imagen-4.0")||B,N=[{value:"1K",label:"1K"},{value:"2K",label:"2K"},{value:"4K",label:"4K"}],T=()=>{if(!e.value)return;const z=w(e.id,0)||e.value;if(z){const U=k(e.id).filter(R=>typeof R=="string").join(", ");h({sources:[{src:z,frameNumber:0,prompt:U}],initialIndex:0})}},F=n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-white/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("rect",{x:"8",y:"8",width:"12",height:"12",rx:"2",ry:"2"}),n.jsx("path",{d:"M16 8V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2"})]});return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{onClick:T,onWheel:z=>z.stopPropagation(),className:"relative w-full flex-grow bg-gray-700 rounded-md flex items-center justify-center overflow-hidden mb-2 group cursor-pointer border border-gray-600 hover:border-gray-500 transition-colors",children:[e.value?n.jsx("img",{src:e.value||w(e.id,0),alt:"Generated result",className:"object-contain w-full h-full",draggable:!0,onMouseDown:z=>z.stopPropagation(),onDragStart:z=>{const G=w(e.id,0)||e.value;G&&(z.dataTransfer.setData("application/prompt-modifier-drag-image",G),z.dataTransfer.effectAllowed="copy",z.stopPropagation())}}):n.jsx("span",{className:"text-gray-400",children:u("node.content.imageHere")}),n.jsxs("div",{className:`absolute inset-0 bg-gray-800/70 backdrop-blur-sm flex flex-col items-center justify-center text-white z-10 transition-opacity duration-300 ${t||o&&!e.value?"opacity-100":"opacity-0 pointer-events-none"}`,children:[n.jsxs("svg",{className:"animate-spin h-8 w-8 text-accent-text",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n.jsx("span",{className:"mt-2 font-semibold text-accent-text",children:o?"Executing...":u("node.content.generating")})]}),e.value&&!(t||o&&!e.value)&&n.jsxs("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none gap-4",children:[n.jsx("button",{onClick:M,className:"w-20 h-20 flex items-center justify-center rounded-full bg-black/50 hover:bg-black/60 transition-colors pointer-events-auto","aria-label":u("node.action.copy"),title:u("node.action.copy"),children:F}),n.jsx("button",{onClick:z=>{z.stopPropagation(),p(e.id)},className:"w-20 h-20 flex items-center justify-center rounded-full bg-black/50 hover:bg-black/60 transition-colors pointer-events-auto","aria-label":u("node.action.download"),title:u("node.action.download"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-white/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]}),e.value&&n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx(Pe,{title:u("node.action.copy"),onClick:M,children:n.jsx(Dt,{})}),n.jsx(Pe,{title:u("node.action.download"),onClick:z=>{z.stopPropagation(),p(e.id)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]})]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:u("node.content.generationMode")}),n.jsx(Rn,{id:`model-select-${e.id}`,value:e.model||"imagen-4.0-generate-001",onChange:z=>r(e.id,z),disabled:t||o,options:O})]}),B&&n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Resolution"}),n.jsx(Rn,{value:e.resolution&&["1K","2K","4K"].includes(e.resolution)?e.resolution:"1K",onChange:z=>i(e.id,z),disabled:t||o,options:N})]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{htmlFor:`aspect-ratio-${e.id}`,className:`block text-xs font-medium mb-1 transition-colors ${I?"text-gray-400":"text-gray-600"}`,children:u("node.content.aspectRatio")}),n.jsx(Rn,{id:`aspect-ratio-${e.id}`,value:e.aspectRatio||"1:1",onChange:z=>a(e.id,z),disabled:t||!I||o,title:u(I?"node.content.aspectRatioHelp":"node.content.aspectRatioNotSupportedFast"),options:D.map(z=>({value:z,label:z}))})]}),n.jsx("div",{className:"mb-2",children:n.jsx(Ot,{id:`auto-download-toggle-${e.id}`,checked:!!e.autoDownload,onChange:z=>s(e.id,z),disabled:t||o,label:u("node.content.autoDownload")})}),n.jsxs("div",{className:"flex space-x-2 h-10",children:[n.jsx(Fn,{content:u("tutorial.step3"),isActive:!!P,position:"top",onSkip:S,className:"flex-grow h-full",children:n.jsx("button",{onClick:j,disabled:t||o||b,className:"w-full h-full px-4 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:u(t?"node.content.generating":"node.content.generateImage")})}),o?n.jsx("button",{onClick:c,className:"h-10 w-10 flex-shrink-0 flex items-center justify-center font-bold text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors duration-200",title:" ",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1zm4 0a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})}):n.jsx("button",{onClick:()=>d(e.id),disabled:t||o||b,className:"h-10 w-10 flex-shrink-0 flex items-center justify-center font-bold text-white bg-accent-secondary rounded-md hover:bg-accent-secondary-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",title:u("node.action.executeChainTitle"),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})})]})]})},HP=({node:e,isGeneratingVideo:t,isExecutingChain:o,onAspectRatioChange:r,onResolutionChange:a,onAutoDownloadChange:i,onGenerateVideo:s,onStopChainExecution:l,onExecuteChain:c,t:d,isGlobalProcessing:u})=>{const p=["16:9","9:16"],h=["720p","1080p"];return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"relative w-full flex-grow bg-gray-700 rounded-md flex items-center justify-center overflow-hidden mb-2",children:[e.value?n.jsx("video",{src:e.value,controls:!0,className:"object-contain w-full h-full"}):n.jsx("span",{className:"text-gray-400",children:"Video will appear here"}),n.jsxs("div",{className:`absolute inset-0 bg-gray-800/70 backdrop-blur-sm flex flex-col items-center justify-center text-white z-10 transition-opacity duration-300 ${t||o&&!e.value?"opacity-100":"opacity-0 pointer-events-none"}`,children:[n.jsxs("svg",{className:"animate-spin h-8 w-8 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n.jsx("span",{className:"mt-2 font-semibold",children:d(o?"node.content.processingChain":"node.content.generating")})]})]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{htmlFor:`aspect-ratio-${e.id}`,className:"block text-xs font-medium mb-1 text-gray-400",children:d("node.content.aspectRatio")}),n.jsx(Rn,{id:`aspect-ratio-${e.id}`,value:e.aspectRatio||"16:9",onChange:w=>r(e.id,w),disabled:t||o,options:p.map(w=>({value:w,label:w}))})]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{htmlFor:`resolution-${e.id}`,className:"block text-xs font-medium mb-1 text-gray-400",children:"Resolution"}),n.jsx(Rn,{id:`resolution-${e.id}`,value:e.resolution||"720p",onChange:w=>a(e.id,w),disabled:t||o,options:h.map(w=>({value:w,label:w}))})]}),n.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[n.jsx("input",{type:"checkbox",id:`auto-download-toggle-${e.id}`,checked:!!e.autoDownload,onChange:w=>i(e.id,w.target.checked),disabled:t||o,className:"h-4 w-4 rounded border-gray-300 text-accent focus:ring-accent bg-gray-700 cursor-pointer",onMouseDown:w=>w.stopPropagation()}),n.jsx("label",{htmlFor:`auto-download-toggle-${e.id}`,className:"text-sm text-gray-300 select-none cursor-pointer",children:d("node.content.autoDownload")})]}),n.jsxs("div",{className:"flex space-x-2",children:[n.jsx("button",{onClick:()=>s(e.id),disabled:t||o||u,className:"w-1/2 px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:t?d("node.content.generating"):"Generate Video"}),o?n.jsxs("button",{onClick:l,className:"w-1/2 px-4 py-2 font-bold text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors duration-200 flex items-center justify-center space-x-2",title:" ",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1zm4 0a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),n.jsx("span",{children:"Stop"})]}):n.jsxs("button",{onClick:()=>c(e.id),disabled:t||o||u,className:"w-1/2 px-4 py-2 font-bold text-white bg-teal-600 rounded-md hover:bg-teal-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center space-x-2",title:d("node.action.executeChainTitle"),children:[n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),n.jsx("span",{children:d("node.action.executeChain")})]})]})]})},GP=({node:e,onValueChange:t,onEnhanceVideo:o,isEnhancingVideo:r,onProcessChainForward:a,isExecutingChain:i,t:s,onSelectNode:l,connectedInputs:c,getUpstreamNodeValues:d})=>{const u=v.useMemo(()=>{try{const k=JSON.parse(e.value||"{}");return typeof k=="object"&&k!==null?{inputPrompt:k.inputPrompt||"",prompt:k.prompt||k.value||""}:{inputPrompt:"",prompt:e.value||""}}catch{return{inputPrompt:"",prompt:e.value||""}}},[e.value]),p=c==null?void 0:c.has(void 0),h=v.useMemo(()=>p?d(e.id).filter(b=>typeof b=="string").join(", "):"",[p,d,e.id,e.value]),w=k=>{t(e.id,JSON.stringify({...u,inputPrompt:k}))};return n.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[n.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase mb-1",children:p?s("node.content.connectedPlaceholder"):"Input Prompt"}),n.jsx(Tn,{value:p?h:u.inputPrompt,onDebouncedChange:w,placeholder:s("node.content.editPromptPlaceholder"),className:`w-full h-full p-2 bg-input border-none rounded-md resize-none focus:ring-2 focus:ring-cyan-500 focus:outline-none ${p?"text-gray-400 cursor-not-allowed":"text-white"}`,onWheel:k=>k.stopPropagation(),onMouseDown:k=>{k.stopPropagation(),l()},readOnly:p})]}),n.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[n.jsx("label",{className:"text-[10px] font-bold text-cyan-400 uppercase mb-1",children:"Video Prompt"}),n.jsx("textarea",{readOnly:!0,value:u.prompt,placeholder:s("node.content.enhancedPromptHere"),className:"w-full h-full p-2 bg-input border-none rounded-md resize-none focus:outline-none",onWheel:k=>k.stopPropagation(),onMouseDown:k=>{k.stopPropagation(),l()}})]}),n.jsxs("div",{className:"flex space-x-2 pt-1",children:[n.jsx("button",{onClick:()=>o(e.id),disabled:r||i,className:"w-1/2 px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:s(r?"node.content.enhancing":"node.content.enhancePrompt")}),n.jsxs("button",{onClick:()=>a(e.id),disabled:r||i,className:"w-1/2 px-4 py-2 font-bold text-white bg-accent-secondary rounded-md hover:bg-accent-secondary-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center space-x-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 5l7 7m0 0l-7 7m7-7H3"})}),n.jsx("span",{children:s(i?"node.content.processingChain":"node.action.processChainForward")})]})]})]})},UP=({node:e,onValueChange:t,connectedInputs:o,isGeneratingScript:r,onGenerateScript:a,t:i,deselectAllNodes:s})=>{const l=v.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{type:"script-generator-data",prompt:"",summary:"",detailedCharacters:[],scenes:[],targetLanguage:"en"}}},[e.value]),{prompt:c="",summary:d="",detailedCharacters:u=[],scenes:p=[],targetLanguage:h="en"}=l,w=o==null?void 0:o.has(void 0),k=y=>{t(e.id,JSON.stringify({...l,type:"script-generator-data",...y}))},b=Object.entries(fn);return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex-shrink-0 space-y-2 mb-2",children:[n.jsx("textarea",{value:c,onChange:y=>k({prompt:y.target.value}),placeholder:i(w?"node.content.connectedPlaceholder":"node.content.scriptPromptPlaceholder"),className:"w-full p-2 bg-gray-700 border-none rounded-md resize-none focus:ring-2 focus:ring-cyan-500 focus:outline-none",onWheel:y=>y.stopPropagation(),onMouseDown:y=>y.stopPropagation(),disabled:w,rows:3,onFocus:s}),n.jsxs("div",{className:"flex items-end space-x-2",children:[n.jsxs("div",{className:"flex-grow",children:[n.jsx("label",{htmlFor:`lang-select-${e.id}`,className:"block text-xs font-medium text-gray-400 mb-1",children:i("node.content.targetLanguage")}),n.jsx("select",{id:`lang-select-${e.id}`,value:h,onChange:y=>k({targetLanguage:y.target.value}),onMouseDown:y=>y.stopPropagation(),disabled:r,className:"w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:ring-2 focus:ring-cyan-500 focus:outline-none disabled:opacity-50",children:b.map(([y,{name:g}])=>n.jsx("option",{value:y,children:g},y))})]}),n.jsx("button",{onClick:()=>a(e.id),disabled:r||!w&&!c.trim(),className:"px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:i(r?"node.content.generating":"node.content.generateScript")})]})]}),n.jsxs("div",{className:"flex-grow min-h-0 overflow-y-auto space-y-4 pr-2",onWheel:y=>y.stopPropagation(),children:[d&&n.jsxs("div",{className:"bg-gray-700/50 p-3 rounded-lg",children:[n.jsx("h3",{className:"font-bold text-cyan-400 mb-1",children:"Summary"}),n.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:d})]}),u.length>0&&u.map((y,g)=>n.jsxs("div",{className:"bg-gray-700/50 p-3 rounded-lg",children:[n.jsx("h3",{className:"font-bold text-cyan-400 mb-1",children:y.name}),n.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:y.fullDescription})]},`char-${g}`)),p.length>0&&p.map((y,g)=>n.jsxs("div",{className:"bg-gray-700/50 p-3 rounded-lg",children:[n.jsxs("h3",{className:"font-bold text-cyan-400 mb-1",children:["Scene ",y.sceneNumber]}),n.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:y.description})]},`scene-${g}`))]})]})},VP=e=>(e||"").split(`
`).filter(t=>t.trim()!=="").map((t,o)=>t.startsWith("####")?n.jsx("h5",{className:"block text-cyan-400 font-bold mt-2 mb-1 text-base",children:t.replace(/####/g,"").trim()},o):n.jsx("span",{className:"block select-text break-words whitespace-pre-wrap",children:t},o)),or=({isCollapsed:e,onClick:t,className:o})=>n.jsx("button",{onClick:t,className:`p-1 rounded hover:bg-gray-600 text-gray-400 hover:text-white transition-colors focus:outline-none ${o}`,children:e?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),WP=({node:e,onValueChange:t,onLoadScriptFile:o,t:r,onSaveScriptToCatalog:a,onSaveScriptToDisk:i,onTranslateScript:s,isTranslatingScript:l})=>{const[c,d]=v.useState(new Set),u=x=>{d(_=>{const S=new Set(_);return S.has(x)?S.delete(x):S.add(x),S})},p=v.useMemo(()=>{var x;try{if(!e.value||e.value==="{}")return{type:"empty",targetLanguage:"en"};const _=JSON.parse(e.value),S=_.targetLanguage||"en";return _.type==="script-generator-data"?{type:"generator",data:_,targetLanguage:S}:_.type==="script-analyzer-data"?{type:"analyzer",data:_,targetLanguage:S}:_.summary&&_.detailedCharacters&&_.scenes?{type:"generator",data:{..._,type:"script-generator-data"},targetLanguage:S}:_.characters&&_.scenes&&Array.isArray(_.scenes)&&((x=_.scenes[0])!=null&&x.frames)?{type:"analyzer",data:{..._,type:"script-analyzer-data"},targetLanguage:S}:{type:"invalid",targetLanguage:S}}catch{return{type:"invalid",targetLanguage:"en"}}},[e.value]),h=x=>{try{const S={...JSON.parse(e.value||"{}"),targetLanguage:x};t(e.id,JSON.stringify(S,null,2))}catch{t(e.id,JSON.stringify({targetLanguage:x},null,2))}},w=(x,_)=>n.jsxs("div",{className:"mb-4 pb-2 border-b border-gray-600 flex justify-between items-end",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-bold text-white",children:x}),_&&n.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:["Model: ",n.jsx("span",{className:"text-cyan-300",children:_})]})]}),n.jsx("div",{className:"text-xs text-gray-500 font-mono",children:"JSON"})]}),k=(x,_,S)=>n.jsxs("div",{className:"relative bg-gray-700/50 p-3 rounded-lg group overflow-hidden mb-2",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("h4",{className:"font-bold text-cyan-400 mb-1 truncate",children:x}),n.jsx("div",{className:"flex-shrink-0 ml-2",children:n.jsx(Pe,{title:r("node.action.copy"),onClick:P=>{P.stopPropagation(),navigator.clipboard.writeText(_)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})]}),n.jsx("div",{className:"text-sm text-gray-300 whitespace-pre-wrap select-text break-words",children:_})]},S),b=()=>{const x=p.type==="analyzer",_=[{id:"full-json",label:"Full Data JSON",copyVal:e.value}];x&&(_.push({id:"all-image-prompts",label:"All Image Prompts",copyVal:""}),_.push({id:"all-video-prompts",label:"All Video Prompts",copyVal:""}));const S=P=>{var D;const j=p.type==="analyzer"?p.data:null;if(!j||!j.scenes)return"";const M=[];return p.type==="analyzer"&&((D=j.scenes)==null||D.forEach(O=>O.frames.forEach(B=>{const E=P==="img"?B.imagePrompt:B.videoPrompt;E&&M.push(E)}))),M.join(`
`)};return n.jsx("div",{className:"mb-4 space-y-2",children:_.map(P=>n.jsxs("div",{className:"relative flex justify-between items-center p-2 rounded bg-gray-800 border border-gray-700 shadow-sm",children:[n.jsx("span",{className:"text-xs font-bold text-gray-400 pl-1 uppercase tracking-wider",children:P.label}),n.jsx("div",{className:"flex items-center",children:n.jsx(Pe,{title:r("node.action.copy"),onClick:j=>{j.stopPropagation();const M=P.id==="full-json"?P.copyVal:P.id==="all-image-prompts"?S("img"):S("vid");navigator.clipboard.writeText(M||"")},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})]},P.id))})},y=(x,_,S)=>{const P=`char-${_}`,j=c.has(P);return n.jsxs("div",{className:"bg-gray-700/50 rounded-lg group overflow-hidden mb-2 border border-gray-600/30",children:[n.jsxs("div",{className:"flex justify-between items-center p-3 cursor-pointer hover:bg-gray-700/80 transition-colors",onClick:M=>{M.stopPropagation(),u(P)},children:[n.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[n.jsx(or,{isCollapsed:j,onClick:M=>{M.stopPropagation(),u(P)}}),n.jsxs("h4",{className:"font-bold text-cyan-400 truncate",children:[x.name,x.alias&&n.jsxs("span",{className:"text-xs font-mono text-gray-400 ml-2",children:["(",x.alias,")"]})]})]}),n.jsx("div",{className:"flex flex-col items-end space-y-2 flex-shrink-0",children:n.jsx("div",{className:"opacity-100",children:n.jsx(Pe,{title:r("node.action.copy"),onClick:M=>{M.stopPropagation(),navigator.clipboard.writeText(x.fullDescription)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})})]}),!j&&n.jsxs("div",{className:"px-3 pb-3 pt-0 text-sm text-gray-300 whitespace-pre-wrap select-text break-words border-t border-gray-600/30 mt-1",children:[VP(x.fullDescription),S&&x.imagePrompt&&n.jsxs("div",{className:"mt-2 p-2 bg-gray-800/50 rounded border-l-2 border-cyan-500",children:[n.jsx("span",{className:"text-xs font-bold text-gray-400 block uppercase mb-1",children:"Image Prompt"}),n.jsx("span",{className:"text-xs text-gray-300",children:x.imagePrompt})]})]})]},x.id||_)},g=(x,_)=>{var O;const S=`Frame ${x.frameNumber} (${x.duration?`${x.duration}s`:"Duration N/A"})`,P=((O=x.characters)==null?void 0:O.join(", "))||"",j=`frame-${_}-${x.frameNumber}`,M=c.has(j),D=[{label:"Description",value:x.description},{label:"Environment",value:x.environmentPrompt},{label:"Image Prompt",value:x.imagePrompt},{label:"Video Prompt",value:x.videoPrompt}].filter(B=>B.value);return n.jsxs("div",{className:"bg-gray-700/50 rounded-lg overflow-hidden mb-2 border border-gray-600/20",children:[n.jsx("div",{className:"flex justify-between items-center p-3 cursor-pointer hover:bg-gray-700/80 transition-colors",onClick:B=>{B.stopPropagation(),u(j)},children:n.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[n.jsx(or,{isCollapsed:M,onClick:B=>{B.stopPropagation(),u(j)}}),n.jsx("h4",{className:"font-bold text-cyan-300 text-sm truncate",children:S}),P&&n.jsxs("span",{className:"text-xs text-gray-400 truncate max-w-[120px]",title:P,children:["Chars: ",P]})]})}),!M&&n.jsx("div",{className:"px-3 pb-3 pt-0 space-y-2 border-t border-gray-600/20 mt-1",children:D.map(B=>n.jsxs("div",{className:"relative bg-gray-800/50 p-2 rounded group overflow-hidden",children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsx("label",{className:"text-[10px] uppercase font-bold text-gray-400 truncate",children:B.label}),n.jsx("div",{className:"flex items-center space-x-1 flex-shrink-0",children:n.jsx("div",{children:n.jsx(Pe,{title:r("node.action.copy"),onClick:E=>{E.stopPropagation(),navigator.clipboard.writeText(B.value)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})})]}),n.jsx("p",{className:"text-xs text-gray-200 whitespace-pre-wrap select-text break-words leading-relaxed",children:B.value})]},B.label))})]},`frame-${x.frameNumber}`)},m=()=>{switch(p.type){case"empty":return n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500 p-4",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})}),n.jsx("p",{className:"font-semibold",children:"No Script Loaded"}),n.jsx("p",{className:"text-sm mt-1",children:'Drop a JSON file here or use the "Load" button.'})]});case"invalid":return n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center p-4",children:[n.jsx("span",{className:"text-red-400 font-bold mb-2",children:"Format Error"}),n.jsx("span",{className:"text-sm text-gray-400",children:r("node.content.unrecognizedFormat")})]});case"generator":{const x=p.data,_=x.customVisualStyle||x.visualStyle||x.generatedStyle||"",S=c.has("section-characters"),P=c.has("section-scenes");return n.jsxs("div",{className:"space-y-6 pb-4",children:[w("Generated Script",x.model),b(),_&&n.jsxs("div",{className:"bg-gray-800/30 p-3 rounded-lg border border-gray-600/50",children:[n.jsx("h3",{className:"font-bold text-cyan-400 mb-1 text-sm uppercase tracking-wider",children:r("node.content.style")}),n.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:_})]}),x.summary&&n.jsxs("div",{className:"bg-gray-800/30 p-3 rounded-lg border border-gray-600/50",children:[n.jsx("h3",{className:"font-bold text-cyan-400 mb-1 text-sm uppercase tracking-wider",children:r("node.content.summary")}),k("Summary",x.summary,"summary")]}),x.detailedCharacters&&x.detailedCharacters.length>0&&n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center mb-3 border-b border-gray-700 pb-1 cursor-pointer hover:bg-gray-800/50 rounded px-1 -mx-1",onClick:()=>u("section-characters"),children:[n.jsx(or,{isCollapsed:S,onClick:j=>{j.stopPropagation(),u("section-characters")}}),n.jsx("h3",{className:"font-bold text-cyan-400 text-sm uppercase tracking-wider ml-2 select-none",children:r("node.content.characters")})]}),!S&&n.jsx("div",{className:"space-y-2",children:x.detailedCharacters.map((j,M)=>y(j,M,!1))})]}),x.scenes&&x.scenes.length>0&&n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center mb-3 border-b border-gray-700 pb-1 cursor-pointer hover:bg-gray-800/50 rounded px-1 -mx-1",onClick:()=>u("section-scenes"),children:[n.jsx(or,{isCollapsed:P,onClick:j=>{j.stopPropagation(),u("section-scenes")}}),n.jsx("h3",{className:"font-bold text-cyan-400 text-sm uppercase tracking-wider ml-2 select-none",children:r("node.content.scenes")})]}),!P&&n.jsx("div",{className:"space-y-6",children:x.scenes.map((j,M)=>{const D=`scene-${j.sceneNumber}`,O=c.has(D);return n.jsxs("div",{className:"relative pl-4 border-l-2 border-gray-700",children:[n.jsx("div",{className:"absolute -left-[5px] top-0 w-2.5 h-2.5 bg-gray-600 rounded-full"}),n.jsxs("div",{className:"flex items-center mb-2 cursor-pointer hover:bg-gray-800/30 rounded",onClick:()=>u(D),children:[n.jsx(or,{isCollapsed:O,onClick:B=>{B.stopPropagation(),u(D)}}),n.jsxs("h4",{className:"font-bold text-white text-lg ml-2 select-none",children:["Scene ",j.sceneNumber,": ",n.jsx("span",{className:"text-gray-300 font-normal",children:j.title})]})]}),!O&&n.jsxs(n.Fragment,{children:[k("Description",j.description,`scene-${M}`),j.narratorText&&k("Narrator",j.narratorText,`scene-${M}-narrator`)]})]},`scene-container-${M}`)})})]})]})}case"analyzer":{const x=p.data,_=c.has("section-characters"),S=c.has("section-scenes");return n.jsxs("div",{className:"space-y-6 pb-4",children:[w("Analyzed Script",x.model),b(),x.visualStyle&&n.jsxs("div",{className:"bg-gray-800/30 p-3 rounded-lg border border-gray-600/50",children:[n.jsx("h3",{className:"font-bold text-cyan-400 mb-1 text-sm uppercase tracking-wider",children:r("node.content.style")}),n.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:x.visualStyle})]}),x.characters&&x.characters.length>0&&n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center mb-3 border-b border-gray-700 pb-1 cursor-pointer hover:bg-gray-800/50 rounded px-1 -mx-1",onClick:()=>u("section-characters"),children:[n.jsx(or,{isCollapsed:_,onClick:P=>{P.stopPropagation(),u("section-characters")}}),n.jsx("h3",{className:"font-bold text-cyan-400 text-sm uppercase tracking-wider ml-2 select-none",children:r("node.content.characters")})]}),!_&&n.jsx("div",{className:"space-y-2",children:x.characters.map((P,j)=>y(P,j,!0))})]}),x.scenes&&x.scenes.length>0&&n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center mb-3 border-b border-gray-700 pb-1 cursor-pointer hover:bg-gray-800/50 rounded px-1 -mx-1",onClick:()=>u("section-scenes"),children:[n.jsx(or,{isCollapsed:S,onClick:P=>{P.stopPropagation(),u("section-scenes")}}),n.jsx("h3",{className:"font-bold text-cyan-400 text-sm uppercase tracking-wider ml-2 select-none",children:"Scenes & Frames"})]}),!S&&n.jsx("div",{className:"space-y-8",children:x.scenes.map((P,j)=>{var O;const M=`scene-${P.sceneNumber}`,D=c.has(M);return n.jsxs("div",{className:"bg-gray-800/20 rounded-xl p-2 border border-gray-700",children:[n.jsxs("div",{className:"bg-gray-900/50 p-2 rounded-lg mb-3 border-l-4 border-cyan-500 flex items-center cursor-pointer hover:bg-gray-900 transition-colors",onClick:()=>u(M),children:[n.jsx(or,{isCollapsed:D,onClick:B=>{B.stopPropagation(),u(M)}}),n.jsx("div",{className:"ml-2",children:n.jsx("h4",{className:"font-bold text-lg text-white",children:P.title?P.title:`Scene ${P.sceneNumber}`})})]}),!D&&n.jsx("div",{className:"pl-2 space-y-2",children:(O=P.frames)==null?void 0:O.map(B=>g(B,P.sceneNumber))})]},`scene-${P.sceneNumber}`)})})]})]})}default:return null}};return n.jsxs("div",{className:"relative flex flex-col h-full overflow-x-hidden",children:[n.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-2 mb-2",children:[n.jsx("div",{className:"w-32",children:n.jsx(Rn,{id:`lang-select-${e.id}`,value:p.targetLanguage||"en",onChange:h,disabled:l===e.id,options:Object.entries(fn).map(([x,{name:_}])=>({value:x,label:_}))})}),n.jsx("button",{onClick:()=>s(e.id),disabled:l===e.id||p.type==="empty"||p.type==="invalid",className:"px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:l===e.id?r("node.content.translating"):r("node.content.translate")})]}),n.jsx("div",{className:"flex-grow min-h-0 overflow-y-auto pr-2 overflow-x-hidden custom-scrollbar",onWheel:x=>x.stopPropagation(),children:m()}),n.jsxs("div",{className:"flex-shrink-0 flex items-center justify-end space-x-2 mt-2 pt-2 border-t border-gray-700",children:[n.jsx("button",{onClick:()=>o(e.id),className:"flex-1 px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 transition-colors duration-200",children:r("node.content.loadScript")}),n.jsx("button",{onClick:()=>a(e.id),disabled:p.type==="empty"||p.type==="invalid",className:"flex-1 px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",title:r("catalog.saveTo"),children:r("catalog.saveTo")}),n.jsx(Pe,{title:r("group.saveToDisk"),onClick:()=>i(e.id),disabled:p.type==="empty"||p.type==="invalid",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]})]})},$P=({value:e,onChange:t,min:o=1,max:r=10,label:a})=>{const i=l=>{let c=e+l;o!==void 0&&c<o&&(c=o),r!==void 0&&c>r&&(c=r),t(c)},s=l=>{const c=parseInt(l.target.value,10);isNaN(c)||o!==void 0&&c<o||r!==void 0&&c>r||t(c)};return n.jsxs("div",{children:[a&&n.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:a}),n.jsxs("div",{className:"relative flex items-center bg-gray-700 rounded-md border border-gray-600 h-[38px] overflow-hidden group hover:border-gray-500 transition-colors",children:[n.jsx("input",{type:"number",value:e,onChange:s,className:"appearance-none w-full h-full bg-transparent text-sm text-white text-center focus:outline-none px-2 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none font-bold",onMouseDown:l=>l.stopPropagation(),onKeyDown:l=>l.stopPropagation()}),n.jsxs("div",{className:"flex flex-col h-full border-l border-gray-600 w-5 flex-shrink-0 bg-gray-800",children:[n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-accent text-gray-400 hover:text-white transition-colors active:bg-accent-hover",onClick:l=>{l.stopPropagation(),i(1)},children:n.jsx("svg",{width:"8",height:"4",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-accent text-gray-400 hover:text-white transition-colors border-t border-gray-600 active:bg-accent-hover",onClick:l=>{l.stopPropagation(),i(-1)},children:n.jsx("svg",{width:"8",height:"4",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})]})},KP=({fullDescription:e,onDescriptionChange:t,t:o,onFocus:r})=>{const[a,i]=v.useState({});v.useEffect(()=>{const l={Appearance:"",Personality:"",Clothing:""},c={:"Appearance",:"Personality",:"Personality",:"Clothing",apariencia:"Appearance",personalidad:"Personality",ropa:"Clothing",appearance:"Appearance",personality:"Personality",clothing:"Clothing"},d=/####\s*(Appearance|Personality|Clothing|||||Apariencia|Personalidad|Ropa)\s*([\s\S]*?)(?=####|$)/gi;let u,p=!1;for(;(u=d.exec(e))!==null;){p=!0;const h=u[1].trim().toLowerCase(),w=c[h],k=u[2].trim();w&&(l[w]=k)}!p&&e.trim()&&(l.Appearance=e.trim()),i(l)},[e]);const s=(l,c)=>{const d={...a,[l]:c};i(d);const u=`#### Appearance
${d.Appearance||""}

#### Personality
${d.Personality||""}

#### Clothing
${d.Clothing||""}`;t(u)};return n.jsx("div",{className:"space-y-2 text-sm h-full flex flex-col overflow-y-auto custom-scrollbar pr-1 pb-1",children:["Appearance","Personality","Clothing"].map(l=>n.jsxs("div",{className:"flex-shrink-0 flex flex-col",children:[n.jsx("h5",{className:"font-semibold text-gray-400 text-xs uppercase tracking-wider flex-shrink-0 mb-1",children:o(`node.content.${l.toLowerCase()}`)||l}),n.jsx("textarea",{value:a[l]||"",onChange:c=>s(l,c.target.value),className:"w-full text-sm p-2 bg-gray-900/50 border-none rounded-md resize-none focus:outline-none focus:ring-1 focus:ring-accent custom-scrollbar h-[100px] min-h-[80px]",onWheel:c=>c.stopPropagation(),onKeyDown:c=>c.stopPropagation(),onFocus:r})]},l))})},ws="Full body character concept on a gray background",t0="Full-length conceptual object on a grey background",JP=({node:e,onValueChange:t,onGenerateCharacters:o,isGeneratingCharacters:r,isStopping:a,onStopGeneration:i,t:s,deselectAllNodes:l,connectedInputs:c,clearSelectionsSignal:d,onGenerateCharacterImage:u,isGeneratingCharacterImage:p,onDetachCharacter:h,onSaveGeneratedCharacterToCatalog:w,getUpstreamNodeValues:k,addToast:b,setImageViewer:y})=>{const{secondaryLanguage:g}=St(),m=r,x=c==null?void 0:c.has(void 0),[_,S]=v.useState(!1),[P,j]=v.useState(new Set),[M,D]=v.useState(new Set);v.useEffect(()=>{d>0&&j(new Set)},[d]);const O=v.useMemo(()=>{try{const ie=JSON.parse(e.value||"{}");return{prompt:ie.prompt||"",numberOfCharacters:ie.numberOfCharacters||1,targetLanguage:ie.targetLanguage||g,characterType:ie.characterType||"simple",style:ie.style||"simple",customStyle:ie.customStyle||"",characters:Array.isArray(ie.characters)?ie.characters:[],additionalPrompt:ie.additionalPrompt!==void 0?ie.additionalPrompt:ws,error:ie.error||null}}catch{return{prompt:"",numberOfCharacters:1,targetLanguage:g,characterType:"simple",style:"simple",customStyle:"",characters:[],additionalPrompt:ws,error:null}}},[e.value,g]),{prompt:B,numberOfCharacters:E,targetLanguage:I,characterType:N,style:T,customStyle:F,characters:z,additionalPrompt:G,error:U}=O,R=v.useCallback(ie=>{const oe={...O,...ie};t(e.id,JSON.stringify(oe))},[e.id,t,O]),q=(ie,oe)=>{ie.target.closest('textarea, input, button, [role="listbox"]')||(document.activeElement&&(document.activeElement instanceof HTMLTextAreaElement||document.activeElement instanceof HTMLInputElement)&&document.activeElement.blur(),j(K=>{const Z=new Set(ie.shiftKey?K:[]);return Z.has(oe)?Z.delete(oe):Z.add(oe),Z}))},H=ie=>{D(oe=>{const A=new Set(oe);return A.has(ie)?A.delete(ie):A.add(ie),A})},ne=(ie,oe,A)=>{const K=z.map(Z=>Z.id===ie?{...Z,[oe]:A}:Z);R({characters:K})},X=ie=>{R({characters:z.filter(oe=>oe.id!==ie)})},re=ie=>{navigator.clipboard.writeText(ie)},de=ie=>{const oe={};ie.imageBase64&&(oe["1:1"]=`data:image/png;base64,${ie.imageBase64}`);let A=ie.index||ie.alias||"Entity-1";A=A.replace(/^Character-/,"Entity-");const K={type:"character-card",name:ie.name,index:A,image:ie.imageBase64?`data:image/png;base64,${ie.imageBase64}`:null,selectedRatio:"1:1",prompt:ie.prompt,fullDescription:ie.fullDescription,imageSources:oe,additionalPrompt:G},Z=JSON.stringify(K,null,2),W=new Blob([Z],{type:"application/json"}),Q=URL.createObjectURL(W),ce=document.createElement("a");ce.href=Q,ce.download=`${(ie.name||"entity").replace(/ /g,"_")}.json`,document.body.appendChild(ce),ce.click(),document.body.removeChild(ce),URL.revokeObjectURL(Q)},ge=ie=>{if(w){const oe={...ie,alias:(ie.index||ie.alias||"Entity-1").replace(/^Character-/,"Entity-"),additionalPrompt:G};w(oe)}},te=ie=>{if(h){const oe={...ie,index:(ie.index||ie.alias||"Entity-1").replace(/^Character-/,"Entity-"),additionalPrompt:G};h(oe,e)}},le=()=>{if(!x||!k)return;const oe=k(e.id).find(A=>typeof A=="string")||"";oe?(R({prompt:oe}),b==null||b("Prompt synced from connection","success")):b==null||b("No text found in connection","info")};v.useEffect(()=>{const ie=z.map((A,K)=>{let Z=A.index||A.alias;return Z?Z.startsWith("Character-")&&(Z=Z.replace("Character-","Entity-")):Z=`Entity-${K+1}`,Z!==A.index?{...A,index:Z}:A});JSON.stringify(ie)!==JSON.stringify(z)&&R({characters:ie})},[z.length]);const ee=async()=>{if(!(!B||_)){S(!0);try{const ie=await Dp(B,"en");R({prompt:ie})}catch(ie){console.error("Translation failed",ie)}finally{S(!1)}}},se=(ie,oe,A)=>{ie.stopPropagation(),y&&y({sources:[{src:oe,frameNumber:0,prompt:A||"Character Concept"}],initialIndex:0})};return n.jsxs("div",{className:"flex flex-col h-full",onWheel:ie=>ie.stopPropagation(),children:[n.jsxs("div",{className:"flex-shrink-0 space-y-2 mb-2",children:[n.jsxs("div",{className:"relative",children:[n.jsx("textarea",{value:B,onChange:ie=>R({prompt:ie.target.value}),placeholder:s(x?"node.content.connectedPlaceholder":"node.content.characterPromptPlaceholder"),disabled:x||m,className:"w-full p-2 bg-gray-700 border-none rounded-md resize-y min-h-[80px] max-h-[300px] focus:ring-2 focus:ring-accent focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 custom-scrollbar overflow-y-scroll pb-8",rows:2,onWheel:ie=>ie.stopPropagation(),onMouseDown:ie=>ie.stopPropagation(),onKeyDown:ie=>ie.stopPropagation(),onFocus:l}),n.jsxs("div",{className:"absolute bottom-2 right-2 flex space-x-1",children:[x&&n.jsx("button",{onClick:le,className:"p-1 bg-gray-600 hover:bg-accent text-gray-300 hover:text-white rounded transition-colors",title:"Sync from connection",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),!x&&n.jsx("button",{onClick:ee,disabled:!B||_,className:"p-1 bg-gray-600 hover:bg-accent text-gray-300 hover:text-white rounded transition-colors disabled:opacity-50",title:s(_?"node.content.translating":"node.content.translate"),children:_?n.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"})})})]})]}),n.jsxs("div",{className:"flex flex-col gap-1 mb-2",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:s("node.content.additionalPromptSuffix")}),n.jsxs("div",{className:"flex gap-0.5",children:[n.jsx("button",{onClick:ie=>{ie.stopPropagation(),R({additionalPrompt:ws})},className:`p-0.5 rounded hover:bg-gray-700 transition-colors ${G===ws?"text-accent-text":"text-gray-500 hover:text-white"}`,title:"Character Concept",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),n.jsx("button",{onClick:ie=>{ie.stopPropagation(),R({additionalPrompt:t0})},className:`p-0.5 rounded hover:bg-gray-700 transition-colors ${G===t0?"text-accent-text":"text-gray-500 hover:text-white"}`,title:"Object Concept",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})})]})]}),n.jsx("input",{type:"text",value:G,onChange:ie=>R({additionalPrompt:ie.target.value}),className:"w-full p-1 bg-gray-900/60 border border-gray-700 rounded text-xs text-gray-400 focus:border-accent outline-none",onMouseDown:ie=>ie.stopPropagation(),onFocus:l})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:s("node.content.characterTypeShort")}),n.jsx(Rn,{value:N,onChange:ie=>R({characterType:ie}),disabled:m,options:[{value:"simple",label:s("node.content.characterType.simple")},{value:"anthro",label:s("node.content.characterType.anthro")},{value:"chibi",label:s("node.content.characterType.chibi")},{value:"key_item",label:s("node.content.characterType.key_item")}]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:s("node.content.style")}),n.jsx(Rn,{value:T,onChange:ie=>R({style:ie}),disabled:m,options:[{value:"simple",label:s("node.content.style.simple")},{value:"realistic",label:s("node.content.style.realistic")},{value:"3d_cartoon",label:s("node.content.style.3d_cartoon")},{value:"3d_realistic",label:s("node.content.style.3d_realistic")},{value:"2d_animation",label:s("node.content.style.2d_animation")},{value:"anime",label:s("node.content.style.anime")},{value:"comics",label:s("node.content.style.comics")},{value:"custom",label:s("node.content.style.custom")}]})]}),n.jsx("div",{children:n.jsx($P,{label:s("node.content.numberOfCharactersShort"),value:E,onChange:ie=>R({numberOfCharacters:ie}),min:1,max:10})})]}),T==="custom"&&n.jsxs("div",{className:"flex items-center space-x-2 bg-gray-700 rounded-md p-1",children:[n.jsx("label",{htmlFor:`custom-style-input-${e.id}`,className:"text-xs text-gray-400 pl-1 flex-shrink-0",children:s("node.content.style.custom")}),n.jsx("textarea",{id:`custom-style-input-${e.id}`,value:F,onChange:ie=>R({customStyle:ie.target.value}),onMouseDown:ie=>ie.stopPropagation(),onKeyDown:ie=>ie.stopPropagation(),onFocus:l,rows:2,className:"w-full p-1 bg-gray-800 text-white rounded-md text-xs focus:ring-2 focus:ring-accent focus:outline-none custom-scrollbar",placeholder:"..."})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"flex items-center bg-gray-700 rounded-md p-1 space-x-1 h-10",children:[n.jsx("button",{onClick:()=>R({targetLanguage:g}),className:`px-2 py-1 rounded text-xs font-bold w-10 h-full transition-colors ${I===g?"bg-accent text-white":"text-gray-300 hover:bg-gray-600"}`,title:fn[g].name,children:fn[g].short}),n.jsx("button",{onClick:()=>R({targetLanguage:"en"}),className:`px-2 py-1 rounded text-xs font-bold w-10 h-full transition-colors ${I==="en"?"bg-accent text-white":"text-gray-300 hover:bg-gray-600"}`,children:"EN"})]}),n.jsx("button",{onClick:()=>o(e.id),disabled:m||a||!x&&!B.trim(),className:`flex-grow h-10 px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 flex items-center justify-center space-x-2 ${m?"bg-gray-600 cursor-not-allowed opacity-75":"bg-accent hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed"}`,children:m?n.jsxs(n.Fragment,{children:[n.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n.jsx("span",{children:s("node.content.generating")})]}):s("node.content.generateCharacters")})]})]}),n.jsxs("div",{className:"flex-grow overflow-y-auto overflow-x-hidden space-y-2 pr-2 custom-scrollbar scrollbar-gutter-stable",children:[U&&n.jsx("div",{className:"text-red-400 text-xs p-2 bg-red-900/20 rounded border border-red-800",children:U}),z.length===0?n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-500 opacity-50 select-none",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),n.jsx("p",{className:"text-sm font-medium",children:"Character cards will appear here"})]}):z.map(ie=>n.jsxs("div",{className:`bg-gray-800 rounded-md border-2 transition-colors ${P.has(ie.id)?"border-accent":"border-gray-700"}`,onClick:oe=>q(oe,ie.id),children:[n.jsxs("div",{className:"flex justify-between items-center p-2 cursor-pointer bg-gray-700/50 select-none",onClick:oe=>{oe.target===oe.currentTarget&&H(ie.id)},children:[n.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden",onClick:oe=>H(ie.id),children:[n.jsx(Pe,{title:M.has(ie.id)?s("node.action.expand"):s("node.action.collapse"),onClick:oe=>{oe.stopPropagation(),H(ie.id)},children:M.has(ie.id)?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),n.jsx("input",{type:"text",value:ie.name,onChange:oe=>ne(ie.id,"name",oe.target.value),className:"bg-transparent font-bold text-sm text-white focus:outline-none truncate",onClick:oe=>oe.stopPropagation(),onMouseDown:oe=>oe.stopPropagation(),onKeyDown:oe=>oe.stopPropagation(),onFocus:l})]}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(Pe,{title:s("catalog.saveTo"),tooltipPosition:"left",onClick:oe=>{oe.stopPropagation(),ge(ie)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})}),n.jsx(Pe,{title:s("node.action.saveCharacter"),tooltipPosition:"left",onClick:oe=>{oe.stopPropagation(),de(ie)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Pe,{title:"Detach and Copy",tooltipPosition:"left",onClick:oe=>{oe.stopPropagation(),te(ie)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})}),n.jsx(Pe,{title:s("node.action.deleteItem"),tooltipPosition:"left",onClick:oe=>{oe.stopPropagation(),X(ie.id)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),!M.has(ie.id)&&n.jsxs("div",{className:"p-2 space-y-2 border-t border-gray-700 flex flex-col",children:[n.jsxs("div",{className:"flex space-x-2 h-[140px] flex-shrink-0",children:[n.jsx("div",{className:"w-1/3 h-full flex-shrink-0",children:n.jsx("div",{className:"aspect-square bg-gray-900 rounded-md flex items-center justify-center overflow-hidden relative group h-full w-full",children:ie.imageBase64?n.jsxs(n.Fragment,{children:[n.jsx("img",{src:`data:image/png;base64,${ie.imageBase64}`,alt:ie.name,className:"w-full h-full object-cover cursor-pointer",onClick:oe=>se(oe,`data:image/png;base64,${ie.imageBase64}`,ie.name)}),n.jsx("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsx(Pe,{title:s("node.action.copy"),onClick:oe=>{if(oe.stopPropagation(),ie.imageBase64){const A=new Blob([Uint8Array.from(atob(ie.imageBase64),K=>K.charCodeAt(0))],{type:"image/png"});navigator.clipboard.write([new ClipboardItem({"image/png":A})])}},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})]}):n.jsx("div",{className:"text-gray-500 text-xs text-center px-2",children:p===`${e.id}-${ie.id}`?n.jsxs("svg",{className:"animate-spin h-6 w-6 text-white mx-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("button",{onClick:oe=>{oe.stopPropagation(),u&&u(e.id,ie.id)},className:"text-accent-text hover:text-accent-hover underline",children:"Generate Image"})})})}),n.jsxs("div",{className:"w-2/3 flex flex-col space-y-1 h-full min-w-0",children:[n.jsxs("div",{className:"flex justify-between items-center flex-shrink-0",children:[n.jsx("label",{className:"text-xs text-gray-400 font-medium",children:s("node.content.characterIndex")}),n.jsx("input",{type:"text",value:ie.index||ie.alias||"",onChange:oe=>ne(ie.id,"index",oe.target.value),className:"text-xs bg-gray-900 rounded px-1 border border-gray-600 w-24 focus:ring-1 focus:ring-accent focus:outline-none",onMouseDown:oe=>oe.stopPropagation(),onKeyDown:oe=>oe.stopPropagation(),onFocus:l})]}),n.jsxs("div",{className:"flex justify-between items-center flex-shrink-0",children:[n.jsx("label",{className:"text-xs text-gray-400 font-medium",children:s("node.content.imagePrompt")}),n.jsx(Pe,{title:s("node.action.copy"),onClick:oe=>{oe.stopPropagation(),re(ie.prompt||"")},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),n.jsx("textarea",{value:ie.prompt||"",onChange:oe=>ne(ie.id,"prompt",oe.target.value),className:"w-full flex-grow h-full min-h-[80px] text-xs p-1 bg-gray-900 rounded resize-none border-none focus:ring-1 focus:ring-accent focus:outline-none custom-scrollbar",onWheel:oe=>oe.stopPropagation(),onMouseDown:oe=>oe.stopPropagation(),onKeyDown:oe=>oe.stopPropagation(),onFocus:l})]})]}),n.jsx("div",{className:"flex-grow flex flex-col min-h-[360px]",children:n.jsx(KP,{fullDescription:ie.fullDescription||"",onDescriptionChange:oe=>ne(ie.id,"fullDescription",oe),t:s,onFocus:l})})]})]},ie.id))]})]})},YP=({value:e,onChange:t,placeholder:o,className:r,onFocus:a,readOnly:i})=>{const s=l=>{const c=parseInt(e.replace(/[^0-9]/g,""),10)||0;let d=e.replace(/[0-9]/g,"");(d==="Character-"||!d||d.trim()==="")&&(d="Entity-"),t(`${d}${Math.max(1,c+l)}`)};return n.jsxs("div",{className:`flex items-center bg-gray-700 rounded-md border border-gray-600 h-[32px] overflow-hidden group hover:border-gray-500 transition-colors ${r}`,children:[n.jsx("input",{type:"text",value:e,onChange:l=>!i&&t(l.target.value),placeholder:o,onFocus:a,readOnly:i,className:`w-full h-full bg-transparent text-sm text-white px-2 focus:outline-none border-none min-w-0 ${i?"cursor-default select-none":""}`,onMouseDown:l=>l.stopPropagation()}),n.jsxs("div",{className:"flex flex-col h-full border-l border-gray-600 w-5 flex-shrink-0 bg-gray-800",children:[n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-cyan-600 text-gray-400 hover:text-white transition-colors active:bg-cyan-700",onClick:l=>{l.stopPropagation(),s(1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-cyan-600 text-gray-400 hover:text-white transition-colors border-t border-gray-600 active:bg-cyan-700",onClick:l=>{l.stopPropagation(),s(-1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})},ZP=({fullDescription:e,onDescriptionChange:t,t:o,onFocus:r,isUpdatingPersonality:a,onUpdatePersonality:i,isUpdatingAppearance:s,onUpdateAppearance:l,isUpdatingClothing:c,onUpdateClothing:d})=>{const[u,p]=v.useState({});v.useEffect(()=>{const y={Appearance:"",Personality:"",Clothing:""},g={:"Appearance",:"Personality",:"Personality",:"Clothing",apariencia:"Appearance",personalidad:"Personality",ropa:"Clothing",appearance:"Appearance",personality:"Personality",clothing:"Clothing"},m=/####\s*(Appearance|Personality|Clothing|||||Apariencia|Personalidad|Ropa)\s*([\s\S]*?)(?=####|$)/gi;let x,_=!1;for(;(x=m.exec(e))!==null;){_=!0;const S=x[1].trim().toLowerCase(),P=g[S];let j=x[2];m.lastIndex<e.length&&j.endsWith(`

`)&&(j=j.slice(0,-2)),P&&(y[P]=j)}!_&&e.trim()&&(y.Appearance=e),p(y)},[e]);const h=(y,g)=>{const m={...u,[y]:g};p(m);const x=`#### Appearance
${m.Appearance||""}

#### Personality
${m.Personality||""}

#### Clothing
${m.Clothing||""}`;t(x)},w={Appearance:{icon:n.jsx(Y3,{className:"h-3.5 w-3.5"}),color:"text-gray-400"},Personality:{icon:n.jsx(Z3,{className:"h-3.5 w-3.5"}),color:"text-gray-400"},Clothing:{icon:n.jsx(X3,{className:"h-3.5 w-3.5"}),color:"text-gray-400"}},k=y=>y==="Appearance"?o("node.content.appearancePlaceholder"):y==="Personality"?o("node.content.personalityPlaceholder"):y==="Clothing"?o("node.content.clothingPlaceholder"):"",b=y=>y==="Personality"&&i?{title:o("node.action.updatePersonality"),onClick:i,isLoading:a}:y==="Appearance"&&l?{title:o("node.action.updateAppearance"),onClick:l,isLoading:s}:y==="Clothing"&&d?{title:o("node.action.updateClothing"),onClick:d,isLoading:c}:null;return n.jsx("div",{className:"space-y-4 p-4 pb-2 text-sm flex flex-col pr-1 overflow-x-hidden",children:["Appearance","Personality","Clothing"].map(y=>{const g=w[y],m=b(y);return n.jsxs("div",{className:"flex-shrink-0 flex flex-col items-start w-full",children:[n.jsxs("div",{className:"flex flex-row items-center justify-between mb-1.5 w-full",children:[n.jsxs("div",{className:"flex flex-row items-center gap-1.5",children:[n.jsx("span",{className:g.color,children:g.icon}),n.jsx("h5",{className:`font-bold ${g.color} text-[11px] uppercase tracking-wider flex-shrink-0`,children:o(`node.content.${y.toLowerCase()}`)||y}),m&&n.jsx(Pe,{title:m.title||"Update",onClick:x=>{x.stopPropagation(),m.onClick()},disabled:m.isLoading,className:"p-1 ml-1 text-gray-500 hover:text-accent-text transition-colors disabled:opacity-50",tooltipPosition:"right",children:m.isLoading?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-accent-text",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),n.jsx(Pe,{title:o("node.action.copy"),onClick:x=>{x.stopPropagation(),navigator.clipboard.writeText(u[y]||"")},className:"p-1 text-gray-500 hover:text-accent-text transition-colors",tooltipPosition:"left",children:n.jsx(Dt,{className:"h-3 w-3"})})]}),n.jsx("textarea",{value:u[y]||"",onChange:x=>h(y,x.target.value),className:"w-full text-sm p-2 bg-gray-900/60 border border-gray-700 rounded-md resize-y focus:outline-none focus:ring-1 focus:ring-accent custom-scrollbar min-h-[60px] transition-colors text-gray-200 text-left",onWheel:x=>x.stopPropagation(),onKeyDown:x=>x.stopPropagation(),onFocus:r,placeholder:k(y)})]},y)})})},bs=()=>n.jsxs("svg",{className:"animate-spin h-3.5 w-3.5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),XP=({char:e,cardIdx:t,nodeId:o,isDragOver:r,setIsDragOver:a,onRatioChange:i,onPasteImage:s,onClearImage:l,onCopyImage:c,onGenerateImage:d,onEditRaster:u,onEditAI:p,onCrop1x1:h,onExpandRatio:w,onSetEditingIndex:k,getFullSizeImage:b,setImageViewer:y,onCopyImageToClipboard:g,processNewImage:m,transformingRatio:x,isGeneratingImage:_,t:S})=>{const P=!!(e.thumbnails[e.selectedRatio]||e.image),j=M=>M?"bg-gray-600 text-white cursor-wait":"bg-accent hover:bg-accent-hover text-white disabled:opacity-50 disabled:bg-gray-700 disabled:text-gray-500";return n.jsxs("div",{className:"flex flex-col flex-shrink-0",children:[n.jsx("div",{onClick:k,onDragEnter:M=>{M.dataTransfer.types.includes("application/prompt-modifier-card")||(M.preventDefault(),M.stopPropagation(),a(!0))},onDragOver:M=>{M.dataTransfer.types.includes("application/prompt-modifier-card")||(M.preventDefault(),M.stopPropagation(),a(!0))},className:`flex-shrink-0 h-[256px] bg-gray-700/50 rounded-xl flex items-center justify-center cursor-pointer transition-all group relative overflow-hidden z-10 hover:z-20 hover:bg-gray-800/60 ${r?"border-2 border-accent ring-2 ring-accent/20":""}`,onDragLeave:()=>a(!1),onDrop:M=>{var B;if(M.dataTransfer.types.includes("application/prompt-modifier-card"))return;M.preventDefault(),M.stopPropagation(),a(!1);const D=M.dataTransfer.getData("application/prompt-modifier-drag-image");if(D){m(D);return}const O=(B=M.dataTransfer.files)==null?void 0:B[0];if(O!=null&&O.type.startsWith("image/")){const E=new FileReader;E.onload=I=>{var N;return m((N=I.target)==null?void 0:N.result)},E.readAsDataURL(O)}},children:e.thumbnails[e.selectedRatio]||e.image?n.jsxs(n.Fragment,{children:[n.jsx("img",{src:e.thumbnails[e.selectedRatio]||e.image,className:"object-contain w-full h-full transition-opacity group-hover:opacity-80",style:{imageRendering:"auto"},draggable:!0,onDragStart:M=>{const D=b(t*10+($t[e.selectedRatio]||1))||e.image;D&&(M.dataTransfer.setData("application/prompt-modifier-drag-image",D),M.stopPropagation())},onClick:M=>{M.stopPropagation(),y({sources:[{src:b(t*10+($t[e.selectedRatio]||1))||e.image,frameNumber:0}],initialIndex:0})}}),n.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-20",children:[n.jsx(Pe,{title:S("node.action.copy"),onClick:M=>{M.stopPropagation(),c()},className:"bg-black/60 p-1.5 rounded text-accent-text hover:text-white",tooltipPosition:"left",children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Pe,{title:S("node.action.paste"),onClick:M=>{M.stopPropagation(),s()},className:"bg-black/60 p-1.5 rounded text-accent-text hover:text-white",tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),n.jsx(Pe,{title:S("node.action.clear"),onClick:M=>{M.stopPropagation(),l()},className:"bg-black/60 p-1.5 rounded text-red-400 hover:text-white",tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{d:"M6 18L18 6M6 6l12 12",strokeWidth:2,strokeLinecap:"round"})})})]})]}):n.jsxs("div",{className:"flex flex-col items-center justify-center w-full h-full gap-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),n.jsx("div",{className:"flex flex-col items-center justify-center text-[10px] text-gray-500 uppercase font-bold text-center px-4 leading-normal gap-1 max-w-[200px]",children:n.jsx("span",{className:"text-balance",children:S("node.content.dropImage")})}),n.jsxs("button",{onClick:M=>{M.stopPropagation(),s()},className:"mt-2 px-3 py-1 bg-gray-700 hover:bg-gray-600 text-gray-300 hover:text-white text-xs font-bold rounded border border-gray-600 transition-colors flex items-center gap-1.5",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),S("node.action.paste")]})]})}),n.jsx("div",{className:"h-4"}),n.jsxs("div",{className:"flex gap-1 flex-shrink-0 mb-2 items-center px-1",children:[n.jsx("button",{onClick:M=>{M.stopPropagation(),d()},disabled:_||!e.prompt,className:`flex-grow h-8 font-bold rounded text-[10px] uppercase transition-colors shadow-sm flex items-center justify-center gap-2 ${j(_)}`,children:_?n.jsxs(n.Fragment,{children:[n.jsx(bs,{}),n.jsx("span",{children:S("node.content.generating")})]}):S("node.content.generateImage")}),n.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.selectedRatio==="1:1"&&n.jsx(ut,{content:"Crop to 1:1",children:n.jsx("button",{onClick:M=>{M.stopPropagation(),h()},disabled:!!x||!P,className:`w-12 h-8 rounded text-[10px] font-bold transition-colors flex items-center justify-center ${j(x==="1:1")}`,children:x==="1:1"?n.jsx(bs,{}):"1:1"})}),e.selectedRatio==="16:9"&&n.jsx(ut,{content:S("node.action.expand169"),children:n.jsx("button",{onClick:M=>{M.stopPropagation(),w("16:9")},disabled:!!x||!P,className:`w-12 h-8 rounded text-[10px] font-bold transition-colors flex items-center justify-center ${j(x==="16:9")}`,children:x==="16:9"?n.jsx(bs,{}):"16:9"})}),e.selectedRatio==="9:16"&&n.jsx(ut,{content:S("node.action.expand916"),children:n.jsx("button",{onClick:M=>{M.stopPropagation(),w("9:16")},disabled:!!x||!P,className:`w-12 h-8 rounded text-[10px] font-bold transition-colors flex items-center justify-center ${j(x==="9:16")}`,children:x==="9:16"?n.jsx(bs,{}):"9:16"})})]}),n.jsxs("div",{className:"flex gap-1 shrink-0",children:[n.jsx(ut,{content:S("node.action.rasterEditor"),children:n.jsx("button",{onClick:M=>{M.stopPropagation(),u()},disabled:!(e.thumbnails[e.selectedRatio]||e.image),className:"w-9 h-8 bg-accent-secondary hover:bg-accent-secondary-hover text-white rounded flex items-center justify-center disabled:opacity-50 transition-colors disabled:bg-gray-700 disabled:text-gray-500",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})})}),n.jsx(ut,{content:S("node.action.openInAIEditor"),children:n.jsx("button",{onClick:M=>{M.stopPropagation(),p()},disabled:!e.image,className:"w-9 h-8 bg-accent-secondary hover:bg-accent-secondary-hover text-white rounded flex items-center justify-center disabled:opacity-50 transition-colors disabled:bg-gray-700 disabled:text-gray-500",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})})})]})]})]})},QP=380,n0="Full body character concept on a gray background",o0="Full-length conceptual object on a grey background",ej=({isCollapsed:e})=>n.jsx("div",{className:`p-0.5 text-gray-400 transition-transform duration-200 flex items-center justify-center ${e?"rotate-0":"rotate-180"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),tj=({char:e,index:t,nodeId:o,isDragging:r,onUpdate:a,onRemove:i,onSetAsOutput:s,onToggleActive:l,onDragStart:c,onDragEnd:d,onSmartDragOver:u,onRatioChange:p,onPasteImage:h,onClearImage:w,onCopyImage:k,onGenerateImage:b,onEditRaster:y,onEditAI:g,onCrop1x1:m,onExpandRatio:x,onSetEditingIndex:_,onSyncFromConnection:S,onLoad:P,onSave:j,onSaveToCatalog:M,onCopySpecific:D,onPasteSpecific:O,onDetach:B,onModify:E,getFullSizeImage:I,setImageViewer:N,onCopyImageToClipboard:T,processNewImage:F,t:z,deselectAllNodes:G,languages:U,secondaryLanguage:R,isModifyingCharacter:q,isUpdatingDescription:H,onUpdateDescription:ne,isUpdatingPersonality:X,onUpdatePersonality:re,isUpdatingAppearance:de,onUpdateAppearance:ge,isUpdatingClothing:te,onUpdateClothing:le,transformingRatio:ee,isGeneratingImage:se,isUpdatingCharacterPrompt:ie,modificationRequest:oe,setModificationRequest:A,hasDuplicateIndex:K})=>{const[Z,W]=v.useState(!1),Q=`${o}-${t}`,ce=e.isActive?"":"opacity-50 grayscale pointer-events-none",fe=e.isImageCollapsed??!1,$=e.isPromptCollapsed??!1;return n.jsxs("div",{className:"flex flex-col h-full border border-gray-800 rounded-xl bg-gray-900/80 p-2.5 overflow-hidden shadow-xl hover:border-gray-700 transition-all flex-shrink-0",style:{width:`${QP}px`,contain:"content",opacity:r?.4:1,transform:r?"scale(0.95)":"none"},onDragOver:u,children:[n.jsxs("div",{className:"h-8 bg-gray-700 rounded-t-lg border-b border-gray-600 flex items-center px-3 cursor-grab active:cursor-grabbing hover:bg-gray-800 transition-colors mb-2 group/handle relative flex-shrink-0 gap-2",draggable:!0,onDragStart:c,onDragEnd:d,children:[n.jsx("div",{className:"flex items-center gap-1 overflow-hidden flex-grow",children:n.jsxs("span",{className:"text-xs font-bold truncate",children:[n.jsxs("span",{className:K?"text-red-500 font-black":"text-accent-text",children:[e.index||"CH",":"]})," ",n.jsx("span",{className:"text-gray-200 ml-1",children:e.name||"Unnamed"}),n.jsxs("span",{className:"text-[9px] text-gray-500 font-mono ml-2 opacity-50",children:["#",e.id]})]})}),n.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[n.jsx(ut,{content:e.isActive?"Mute Card (Exclude from Output)":"Unmute Card",children:n.jsx("button",{onClick:V=>{V.stopPropagation(),l()},className:`p-0.5 rounded hover:bg-gray-600 transition-colors ${e.isActive?"text-gray-400 hover:text-white":"text-gray-500"}`,onMouseDown:V=>V.stopPropagation(),children:e.isActive?n.jsx(Sl,{className:"h-4 w-4"}):n.jsx(Nl,{className:"h-4 w-4"})})}),n.jsx(ut,{content:z("node.action.markPrimary"),children:n.jsx("button",{onClick:V=>{V.stopPropagation(),s()},className:`p-0.5 rounded hover:bg-gray-700 transition-colors ${e.isOutput?"text-accent-text":"text-gray-500 hover:text-gray-300"}`,onMouseDown:V=>V.stopPropagation(),children:e.isOutput?n.jsx(tP,{className:"h-4 w-4"}):n.jsx(eP,{className:"h-4 w-4"})})}),n.jsx(ut,{content:z("node.action.removeCard"),children:n.jsx("button",{onClick:V=>{V.stopPropagation(),i()},className:"p-0.5 rounded hover:bg-red-900/50 text-gray-500 hover:text-red-400 transition-colors",onMouseDown:V=>V.stopPropagation(),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{d:"M6 18L18 6M6 6l12 12",strokeWidth:2.5,strokeLinecap:"round"})})})})]})]}),n.jsxs("div",{className:`flex flex-col flex-grow min-h-0 ${ce}`,children:[n.jsxs("div",{className:"flex gap-2 flex-shrink-0 items-center mb-2 h-[32px]",children:[n.jsx("input",{type:"text",value:e.name,onChange:V=>a({name:V.target.value}),placeholder:z("node.content.character"),className:"flex-grow min-w-0 px-2 bg-gray-700 border border-gray-600 rounded-md text-sm text-white focus:ring-1 focus:ring-accent outline-none h-[32px] transition-colors hover:border-gray-500",onMouseDown:V=>V.stopPropagation(),onFocus:G}),n.jsx(YP,{value:e.index,onChange:V=>a({index:V}),placeholder:"Index",onFocus:G,readOnly:!0,className:`w-28 shrink-0 ${K?"border-red-500 hover:border-red-500":""}`})]}),n.jsxs("div",{className:"flex flex-col flex-shrink-0 mb-1",children:[n.jsxs("div",{className:"flex items-end justify-between h-7 relative z-30 mb-0 cursor-pointer hover:bg-gray-800/60 transition-colors rounded-t-md",onClick:V=>{V.stopPropagation(),a({isImageCollapsed:!fe})},children:[n.jsx("div",{className:"flex items-end pl-2 gap-1 h-full",onClick:V=>V.stopPropagation(),children:["1:1","16:9","9:16"].map(V=>n.jsx("button",{onClick:J=>{J.stopPropagation(),p(V)},onDragEnter:J=>{J.stopPropagation(),p(V)},className:`px-3 py-1 text-[10px] font-bold outline-none transition-colors rounded-t-md ${e.selectedRatio===V?"bg-gray-700/50 text-white h-full shadow-none":"bg-gray-900/40 text-gray-500 h-[80%] hover:bg-gray-700/50 hover:text-gray-300"}`,children:V},V))}),n.jsx("div",{className:"pb-1 pr-1",children:n.jsx(ej,{isCollapsed:fe})})]}),!fe&&n.jsx(XP,{char:e,cardIdx:t,nodeId:o,isDragOver:Z,setIsDragOver:W,onRatioChange:p,onPasteImage:h,onClearImage:w,onCopyImage:k,onGenerateImage:b,onEditRaster:y,onEditAI:g,onCrop1x1:m,onExpandRatio:x,onSetEditingIndex:_,getFullSizeImage:I,setImageViewer:N,onCopyImageToClipboard:T,processNewImage:F,transformingRatio:ee,isGeneratingImage:se,t:z})]}),n.jsxs("div",{className:"flex flex-col shrink-0 mb-2 border border-gray-700/50 rounded-xl bg-gray-900/20 shadow-inner overflow-hidden",children:[n.jsxs("div",{className:"px-4 py-2 bg-gray-800 border-b border-gray-700 flex items-center justify-between cursor-pointer hover:bg-gray-750 transition-colors select-none",onClick:V=>{V.stopPropagation(),a({isPromptCollapsed:!$})},children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:`transform transition-transform duration-200 ${$?"-rotate-90":""}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})}),n.jsx("span",{className:"text-gray-400",children:n.jsx(Q3,{className:"h-3 w-3"})}),n.jsx("span",{className:"text-[10px] font-black text-gray-300 uppercase tracking-widest",children:z("node.content.prompt")})]}),n.jsxs("div",{className:"flex gap-1",onClick:V=>V.stopPropagation(),children:[n.jsx(Pe,{title:z("node.content.updatePromptFromImage"),onClick:()=>S(),tooltipPosition:"left",disabled:ie===Q,children:ie===Q?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-cyan-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),n.jsx(Pe,{title:z("node.action.copy"),onClick:()=>navigator.clipboard.writeText(e.prompt),tooltipPosition:"left",children:n.jsx(Dt,{className:"h-3 w-3"})})]})]}),!$&&n.jsxs("div",{className:"p-2 space-y-2",children:[n.jsx("textarea",{value:e.prompt,onChange:V=>a({prompt:V.target.value}),className:"w-full p-2 bg-gray-900/60 border border-gray-700 rounded text-xs text-gray-200 resize-y focus:border-accent outline-none min-h-[60px] max-h-[200px] custom-scrollbar",placeholder:z("node.content.promptPlaceholder"),onMouseDown:V=>V.stopPropagation(),onFocus:G}),n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsxs("div",{className:"flex justify-between items-center px-1",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:z("node.content.additionalPromptSuffix")}),n.jsxs("div",{className:"flex gap-0.5",children:[n.jsx(ut,{content:z("node.action.characterConcept"),children:n.jsx("button",{onClick:V=>{V.stopPropagation(),a({additionalPrompt:n0})},className:`p-0.5 rounded hover:bg-gray-700 transition-colors ${e.additionalPrompt===n0?"text-accent":"text-gray-500 hover:text-accent"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})})}),n.jsx(ut,{content:z("node.action.objectConcept"),children:n.jsx("button",{onClick:V=>{V.stopPropagation(),a({additionalPrompt:o0})},className:`p-0.5 rounded hover:bg-gray-700 transition-colors ${e.additionalPrompt===o0?"text-accent":"text-gray-500 hover:text-accent"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})})})]})]}),n.jsx("input",{type:"text",value:e.additionalPrompt||"",onChange:V=>a({additionalPrompt:V.target.value}),className:"w-full p-1 bg-gray-900/60 border border-gray-700 rounded text-xs text-gray-400 focus:border-accent outline-none",onMouseDown:V=>V.stopPropagation(),onFocus:G})]}),n.jsxs("div",{className:"flex flex-col gap-1 border-t border-gray-700/50 pt-2 mt-1",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter px-1",children:z("node.content.modificationRequest")}),n.jsxs("div",{className:"flex gap-2 h-[32px]",children:[n.jsx("input",{value:oe,onChange:V=>A(V.target.value),placeholder:"...",className:"flex-grow bg-gray-900/60 border border-gray-700 rounded px-2 text-xs text-white focus:border-accent outline-none h-full",onMouseDown:V=>V.stopPropagation(),onFocus:G}),[{code:"en",label:"EN"},{code:R,label:U[R].short}].map((V,J)=>n.jsx("button",{onClick:Y=>{Y.stopPropagation(),a({targetLanguage:V.code})},className:`h-full w-8 rounded text-[10px] font-bold transition-colors flex items-center justify-center border ${e.targetLanguage===V.code?"bg-accent text-white border-accent":"bg-gray-900/60 border-gray-700 text-gray-400 hover:text-white hover:bg-gray-700"}`,children:V.label},V.code+J)),n.jsx("div",{className:"flex gap-1 h-full",children:n.jsx(ut,{content:z("node.action.modifyCharacter"),children:n.jsx("button",{onClick:V=>{V.stopPropagation(),E()},disabled:!oe.trim()||q===Q,className:"w-8 bg-accent hover:bg-accent-hover text-white rounded flex items-center justify-center disabled:opacity-50 h-full",children:q===Q?n.jsxs("svg",{className:"animate-spin h-3.5 w-3.5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})})})]})]})]})]}),n.jsxs("div",{className:"flex-grow min-h-0 mt-2 relative p-0 border border-gray-700/50 rounded-xl bg-gray-900/20 shadow-inner overflow-hidden flex flex-col overflow-x-hidden",children:[n.jsxs("div",{className:"px-4 py-2 bg-gray-800 border-b border-gray-700 flex items-center justify-between cursor-pointer hover:bg-gray-750 transition-colors select-none flex-shrink-0",onClick:()=>a({isDescriptionCollapsed:!e.isDescriptionCollapsed}),children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:`transform transition-transform duration-200 ${e.isDescriptionCollapsed?"-rotate-90":""}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})}),n.jsx("span",{className:"text-[10px] font-black text-gray-300 uppercase tracking-widest",children:z("node.content.fullDescriptionTitle")})]}),n.jsxs("div",{className:"flex gap-1",children:[n.jsx(Pe,{title:z("node.action.updateDescription"),onClick:V=>{V.stopPropagation(),ne()},disabled:H===Q||!e.prompt,className:"p-1 text-gray-500 hover:text-accent-text transition-colors",tooltipPosition:"left",children:H===Q?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-accent-text",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),n.jsx(Pe,{title:z("node.action.copy"),onClick:V=>{V.stopPropagation(),navigator.clipboard.writeText(e.fullDescription)},className:"p-1 text-gray-500 hover:text-accent-text transition-colors",tooltipPosition:"left",children:n.jsx(Dt,{className:"h-3 w-3"})})]})]}),!e.isDescriptionCollapsed&&n.jsx("div",{className:"overflow-y-auto custom-scrollbar flex-grow overflow-x-hidden mr-1",onWheel:V=>V.stopPropagation(),style:{scrollbarGutter:"stable",overscrollBehaviorY:"contain"},children:n.jsx(ZP,{fullDescription:e.fullDescription||"",onDescriptionChange:V=>a({fullDescription:V}),t:z,onFocus:G,isUpdatingPersonality:X===`${Q}-personality`,onUpdatePersonality:re,isUpdatingAppearance:de===`${Q}-appearance`,onUpdateAppearance:ge,isUpdatingClothing:te===`${Q}-clothing`,onUpdateClothing:le})})]}),n.jsxs("div",{className:"flex gap-1.5 pt-2.5 mt-auto border-t border-gray-700/50 flex-shrink-0 bg-gray-800/20 backdrop-blur-sm",children:[n.jsx("button",{onClick:V=>{V.stopPropagation(),j()},className:"flex-1 h-9 bg-accent hover:bg-accent-hover text-white font-bold rounded text-[10px] uppercase tracking-tighter transition-colors",children:z("node.action.saveCharacter")}),n.jsx("button",{onClick:V=>{V.stopPropagation(),P()},className:"flex-1 h-9 bg-accent-secondary hover:bg-accent-secondary-hover text-white font-bold rounded text-[10px] uppercase tracking-tighter transition-colors",children:z("node.action.loadCharacter")}),n.jsxs("div",{className:"flex gap-1.5 ml-auto",children:[n.jsx(Pe,{title:z("catalog.saveTo"),onClick:V=>{V.stopPropagation(),M()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Pe,{title:z("node.action.copy"),onClick:V=>{V.stopPropagation(),D()},children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Pe,{title:z("node.action.paste"),onClick:V=>{V.stopPropagation(),O()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),n.jsx(Pe,{title:z("node.action.detachAndPaste"),onClick:V=>{V.stopPropagation(),B()},tooltipPosition:"top",tooltipAlign:"end",children:n.jsx(X1,{className:"h-4 w-4"})})]})]})]})]})},nj=jt.memo(tj),Xr=410,Qr=90,r0=jt.memo(({index:e,activeDropZone:t,onDragOver:o,onDrop:r,onDragLeave:a})=>n.jsx("div",{className:`w-[24px] h-full flex items-center justify-center flex-shrink-0 transition-all cursor-copy ${t===e?"bg-gray-800/30":""}`,onDragOver:i=>o(i,e),onDragLeave:a,onDrop:r,children:n.jsx("div",{className:`h-[90%] rounded-full transition-all duration-200 pointer-events-none ${t===e?"w-1 bg-accent shadow-[0_0_10px_var(--color-accent)] opacity-100 scale-y-100":"w-[1px] bg-gray-700/30 opacity-50 scale-y-90"}`})})),oj=({node:e,onValueChange:t,onSaveCharacterCard:o,onLoadCharacterCard:r,t:a,deselectAllNodes:i,onSaveCharacterToCatalog:s,setFullSizeImage:l,getFullSizeImage:c,setImageViewer:d,onCopyImageToClipboard:u,onDownloadImage:p,addToast:h,onUpdateCharacterDescription:w,isUpdatingDescription:k,onModifyCharacter:b,isModifyingCharacter:y,getUpstreamNodeValues:g,connectedInputs:m,onDetachCharacter:x,onGenerateImage:_,isGeneratingImage:S,onAddNode:P,onDeleteNode:j})=>{const M=Ut(),{setNodes:D,setSelectedNodeIds:O,handleUpdateCharacterPromptFromImage:B,isUpdatingCharacterPrompt:E,handleUpdateCharacterPersonality:I,isUpdatingPersonality:N,handleUpdateCharacterAppearance:T,isUpdatingAppearance:F,handleUpdateCharacterClothing:z,isUpdatingClothing:G}=M||{},U=P||(M==null?void 0:M.onAddNode);j||(M==null||M.deleteNodeAndConnections);const R=v.useRef(null),[q,H]=v.useState(null),[ne,X]=v.useState(!1),[re,de]=v.useState(null),[ge,te]=v.useState(0),[le,ee]=v.useState({}),[se,ie]=v.useState(null),[oe,A]=v.useState(null),[K,Z]=v.useState(null),[W,Q]=v.useState(!1),{secondaryLanguage:ce}=St(),fe=m==null?void 0:m.has(void 0),$=v.useMemo(()=>{try{let ke=JSON.parse(e.value||"[]");return Array.isArray(ke)||(typeof ke=="object"&&ke!==null?ke=[ke]:ke=[]),ke.length===0&&(ke=[{id:`char-card-${Date.now()}`,name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!0,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"}]),ke.map((Ne,He)=>({id:Ne.id||`char-card-${Date.now()}-${He}`,name:Ne.name||"",index:(Ne.index||Ne.alias||`Entity-${He+1}`).replace(/^Character-/,"Entity-"),image:Ne.image||null,thumbnails:Ne.thumbnails||Ne.imageSources||{"1:1":null,"16:9":null,"9:16":null},selectedRatio:Ne.selectedRatio||"1:1",prompt:Ne.prompt||"",additionalPrompt:Ne.additionalPrompt!==void 0?Ne.additionalPrompt:"Full body character concept on a gray background",fullDescription:Ne.fullDescription||"",targetLanguage:Ne.targetLanguage||"en",isOutput:Ne.isOutput||He===0&&!ke.some(Fe=>Fe.isOutput),isActive:Ne.isActive!==!1,isDescriptionCollapsed:Ne.isDescriptionCollapsed??!1,isImageCollapsed:Ne.isImageCollapsed??!1,isPromptCollapsed:Ne.isPromptCollapsed??!1}))}catch{return[{id:`char-card-${Date.now()}`,name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!0,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"}]}},[e.value]),V=v.useRef($);v.useEffect(()=>{V.current=$},[$]),v.useEffect(()=>{try{const ke=JSON.parse(e.value||"[]");(Array.isArray(ke)?ke:[ke]).some(Fe=>Fe.index&&Fe.index.startsWith("Character-"))&&t(e.id,JSON.stringify($))}catch{}},[e.value,$,t,e.id]),v.useEffect(()=>{ie(null),A(null),Z(null)},[$.length]);const J=v.useMemo(()=>{const ke={},Ne=new Set;return $.forEach(He=>{const Fe=(He.index||"").trim();Fe&&(ke[Fe]=(ke[Fe]||0)+1)}),Object.entries(ke).forEach(([He,Fe])=>{Fe>1&&Ne.add(He)}),Ne},[$]),Y=v.useCallback(ke=>{t(e.id,JSON.stringify(ke))},[e.id,t]),ae=v.useCallback((ke,Ne)=>{const He=[...V.current];He[ke]&&(He[ke]={...He[ke],...Ne},Y(He))},[Y]),ue=ke=>{const Ne=$.map((He,Fe)=>({...He,isOutput:Fe===ke}));Y(Ne),h==null||h("Character marked as output","success")},he=ke=>{const Ne=[...$];Ne[ke]={...Ne[ke],isActive:!Ne[ke].isActive},Y(Ne)},ye=(ke,Ne)=>{ie(Ne);const He=$[Ne],Fe={...He.thumbnails};Object.entries($t).forEach(([Ye,st])=>{const ht=c(e.id,Ne*10+st);ht&&(Fe[Ye]=ht)});const $e={type:"prompt-modifier-character-card-transfer",sourceNodeId:e.id,sourceIndex:Ne,character:{...He,imageSources:Fe,_fullResActive:c(e.id,Ne*10)}};ke.dataTransfer.setData("application/prompt-modifier-card",JSON.stringify($e)),ke.dataTransfer.effectAllowed="move"},ve=(ke,Ne)=>{if(!ke.dataTransfer.types.includes("application/prompt-modifier-card"))return;ke.preventDefault(),ke.stopPropagation();const He=ke.currentTarget.getBoundingClientRect(),$e=ke.clientX-He.left>He.width/2,Ye=Ne+($e?1:0);Z(Ye),A(Ye)},me=v.useCallback((ke,Ne)=>{ke.dataTransfer.types.includes("application/prompt-modifier-card")&&(ke.preventDefault(),ke.stopPropagation(),Z(Ne),A(Ne))},[]),_e=v.useCallback(()=>{},[]),pe=async ke=>{ke.preventDefault(),ke.stopPropagation(),Z(null),ie(null),Q(!1);const Ne=oe;A(null);const He=ke.dataTransfer.getData("application/prompt-modifier-card");if(He)try{const Fe=JSON.parse(He);if(Fe.type!=="prompt-modifier-character-card-transfer")return;const{sourceNodeId:$e,sourceIndex:Ye,character:st}=Fe,ht=Ne!==null?Ne:$.length;if($e===e.id){if(Ye===ht||Ye===ht-1)return;const ft=[...$],[mt]=ft.splice(Ye,1);let dt=ht;ht>Ye&&(dt-=1),ft.splice(dt,0,mt);const kt={};$.forEach((Ct,vt)=>{for(let yt=0;yt<10;yt++){const wt=c(e.id,vt*10+yt);wt&&(kt[vt*10+yt]=wt)}});for(let Ct=0;Ct<$.length*10;Ct++)l(e.id,Ct,null);ft.forEach((Ct,vt)=>{const yt=$.findIndex(wt=>wt.id===Ct.id);if(yt!==-1)for(let wt=0;wt<10;wt++){const qn=kt[yt*10+wt];qn&&l(e.id,vt*10+wt,qn)}}),Y(ft)}else{const ft=[...$];ft.length===1&&!ft[0].name&&!ft[0].image&&!ft[0].prompt&&ft.splice(0,1);const mt=ft.length===0,dt={...st,id:`char-card-${Date.now()}`,isOutput:mt,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!1},kt=Math.min(ht,ft.length);ft.splice(kt,0,dt),dt.imageSources&&Object.entries(dt.imageSources).forEach(([Ct,vt])=>{const yt=$t[Ct];yt&&typeof vt=="string"&&l(e.id,kt*10+yt,vt)}),dt._fullResActive&&l(e.id,kt*10,dt._fullResActive),D&&D(Ct=>Ct.map(vt=>vt.id===e.id?{...vt,width:ft.length*Xr+Qr}:vt)),Y(ft),D&&(M!=null&&M.setFullSizeImage)&&(M!=null&&M.getFullSizeImage)&&D(Ct=>Ct.map(vt=>{if(vt.id===$e)try{const yt=JSON.parse(vt.value);let wt=yt.filter((Cn,Pt)=>Pt!==Ye);if(wt.length===0){wt=[{id:`char-card-${Date.now()}-reset`,name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!0,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"}];for(let Cn=0;Cn<10;Cn++)M.setFullSizeImage($e,Cn,null)}else{yt[Ye].isOutput&&wt.length>0&&(wt[0].isOutput=!0);for(let Pt=Ye;Pt<yt.length-1;Pt++)for(let je=0;je<10;je++){const Ve=M.getFullSizeImage($e,(Pt+1)*10+je);M.setFullSizeImage($e,Pt*10+je,Ve||null)}const Cn=yt.length-1;for(let Pt=0;Pt<10;Pt++)M.setFullSizeImage($e,Cn*10+Pt,null)}const qn=Math.max(Xr+Qr,wt.length*Xr+Qr);return{...vt,value:JSON.stringify(wt),width:qn}}catch{return vt}return vt})),h==null||h("Card transferred","success")}}catch(Fe){console.error("Drop failed",Fe),h==null||h("Drop failed: "+(Fe instanceof Error?Fe.message:"Unknown error"),"error")}},xe=ke=>{ke.stopPropagation();let Ne=1;const He=new Set($.map($e=>$e.name));for(;He.has(`New Character ${Ne}`);)Ne++;const Fe=[...$,{id:`char-card-${Date.now()}`,name:`New Character ${Ne}`,index:`Entity-${$.length+1}`,image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!1,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"}];Y(Fe),D&&D($e=>$e.map(Ye=>Ye.id===e.id?{...Ye,width:Fe.length*Xr+Qr}:Ye))},Se=ke=>{if($.length<=1){Y([{id:`char-card-${Date.now()}`,name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!0,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"}]);return}for(let Fe=ke;Fe<$.length-1;Fe++)for(let $e=0;$e<10;$e++){const Ye=c(e.id,(Fe+1)*10+$e);l(e.id,Fe*10+$e,Ye||null)}const Ne=$.length-1;for(let Fe=0;Fe<10;Fe++)l(e.id,Ne*10+Fe,null);const He=$.filter((Fe,$e)=>$e!==ke);He.some(Fe=>Fe.isOutput)||(He[0].isOutput=!0),Y(He),D&&D(Fe=>Fe.map($e=>$e.id===e.id?{...$e,width:Math.max(Xr+Qr,He.length*Xr+Qr)}:$e))},Le=async ke=>{const Ne=$[ke],He={...Ne.thumbnails};Object.entries($t).forEach(([$e,Ye])=>{const st=c(e.id,ke*10+Ye);st&&(He[$e]=st)});const Fe={type:"character-card",...Ne,imageSources:He};delete Fe.id,delete Fe.thumbnails;try{await navigator.clipboard.writeText(JSON.stringify(Fe,null,2)),h==null||h(a("toast.copiedToClipboard"),"success")}catch{h==null||h(a("toast.copyFailed"),"error")}},Ee=async ke=>{try{const Ne=await navigator.clipboard.readText(),He=JSON.parse(Ne);let Fe=Array.isArray(He)?He[0]:He;if(Fe&&(Fe.type==="character-card"||Fe.name||Fe.prompt)){const $e=Fe.imageSources||{"1:1":null,"16:9":null,"9:16":null},Ye={"1:1":null,"16:9":null,"9:16":null};Fe.image&&!Fe.imageSources&&($e["1:1"]=Fe.image);for(const[ht,ft]of Object.entries($e))if(typeof ft=="string"&&ft.startsWith("data:")){const mt=ke*10+($t[ht]||1);l(e.id,mt,ft),Ye[ht]=await Rt(ft,256,256)}else Ye[ht]=ft;const st=Fe.selectedRatio||"1:1";$e[st]&&typeof $e[st]=="string"&&$e[st].startsWith("data:")&&l(e.id,ke*10,$e[st]),ae(ke,{name:Fe.name||"",index:Fe.index||Fe.alias||`Entity-${ke+1}`,prompt:Fe.prompt||Fe.imagePrompt||"",fullDescription:Fe.fullDescription||Fe.description||"",selectedRatio:st,image:Ye[st],thumbnails:Ye}),h==null||h(a("toast.pastedFromClipboard"),"success")}}catch{h==null||h(a("toast.pasteFailed"),"error")}},Me=async ke=>{try{const Ne=await navigator.clipboard.read();for(const He of Ne){const Fe=He.types.find($e=>$e.startsWith("image/"));if(Fe){const $e=await He.getType(Fe),Ye=new FileReader;Ye.onload=async st=>{var ft;const ht=(ft=st.target)==null?void 0:ft.result;ht&&(await Te(ke,ht),h==null||h(a("toast.pastedFromClipboard"),"success"))},Ye.readAsDataURL($e);return}}h==null||h(a("toast.pasteFailed"),"error")}catch(Ne){console.error("Paste image failed",Ne),h==null||h(a("toast.pasteFailed"),"error")}},De=(ke,Ne)=>{const He=V.current[ke];if(Ne===He.selectedRatio)return;const Fe=c(e.id,ke*10+($t[Ne]||1)),$e=He.thumbnails[Ne]||null;Fe?l(e.id,ke*10,Fe):$e&&l(e.id,ke*10,$e),ae(ke,{selectedRatio:Ne,image:$e})},Te=async(ke,Ne)=>{const He=V.current[ke];if(!He)return;l(e.id,ke*10,Ne),l(e.id,ke*10+($t[He.selectedRatio]||1),Ne);const Fe=await Rt(Ne,256,256),$e={...He.thumbnails,[He.selectedRatio]:Fe};ae(ke,{thumbnails:$e,image:Fe})};v.useCallback(ke=>{if(!fe||!g)return;const He=g(e.id).find(Fe=>typeof Fe=="string"&&!Fe.trim().startsWith("{")&&!Fe.trim().startsWith("["))||"";He?(ae(ke,{prompt:He}),h==null||h("Prompt synced from connection","success")):h==null||h("No text found in connection","info")},[fe,g,e.id,ae,h]);const Re=v.useCallback(ke=>{var He;const Ne=(He=ke.target.files)==null?void 0:He[0];if(Ne){const Fe=new FileReader;Fe.onload=async $e=>{var st;const Ye=(st=$e.target)==null?void 0:st.result;Ye&&await Te(ge,Ye)},Fe.readAsDataURL(Ne)}ke.target&&(ke.target.value="")},[ge,Te]),we=ke=>{const Ne=le[ke];!(Ne!=null&&Ne.trim())||!b||(b(e.id,ke,Ne),ee(He=>({...He,[ke]:""})))},Ce=ke=>{B&&B(e.id,ke)},qe=ke=>{I&&I(e.id,ke)},Be=ke=>{T&&T(e.id,ke)},Ie=ke=>{z&&z(e.id,ke)},We=ke=>{const Ne=V.current[ke],He=c(e.id,ke*10+($t[Ne.selectedRatio]||1))||Ne.image;if(!He||!U)return;const Fe={x:e.position.x+e.width+50,y:e.position.y},$e=U(L.IMAGE_EDITOR,Fe),Ye={inputImages:[Ne.thumbnails[Ne.selectedRatio]||Ne.image],prompt:Ne.prompt||"",outputImage:null,aspectRatio:Ne.selectedRatio,enableAspectRatio:!0,enableOutpainting:!1,outpaintingPrompt:"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.",model:"gemini-2.5-flash-image",autoDownload:!0,autoCrop169:!1,leftPaneWidth:360,topPaneHeight:330};t($e,JSON.stringify(Ye)),l($e,1,He)},at=ke=>{const Ne=V.current[ke],He=c(e.id,ke*10+($t[Ne.selectedRatio]||1))||Ne.image;He&&(de(He),te(ke),X(!0))},Jt=async(ke,Ne)=>{const He=V.current[ke],Fe=c(e.id,ke*10)||He.image;if(Fe){H(Ne);try{let $e="Fill the background with gray studio environment";Ne==="16:9"?$e="Fill the background with gray studio environment - fill in the white areas on the sides to naturally expand the image area of the gray scene.":Ne==="9:16"&&($e="Fill the background with gray studio environment - fill in the white areas on top and bottom to naturally expand the image area of the gray scene.");const Ye=await Bp(Fe,Ne,$e,"gemini-2.5-flash-image","");await Te(ke,Ye),h&&h(`Converted to ${Ne} successfully`,"success")}catch($e){console.error($e),h&&h(`Failed to convert: ${$e.message}`,"error")}finally{H(null)}}},Oe=async ke=>{const Ne=V.current[ke],He=c(e.id,ke*10)||Ne.image;if(He){H("1:1");try{const Fe=await aC(He);await Te(ke,Fe),h&&h("Cropped to 1:1 successfully","success")}catch(Fe){console.error(Fe),h&&h(`Failed to crop: ${Fe.message}`,"error")}finally{H(null)}}},Ae=ke=>{const Ne=V.current[ke];if(x){const He={...Ne.thumbnails};Object.entries($t).forEach(([Ye,st])=>{const ht=c(e.id,ke*10+st);ht&&(He[Ye]=ht)});const Fe=c(e.id,ke*10),$e={...Ne,imageSources:He,_fullResImage:Fe};x($e,e),Se(ke)}},Ue=ke=>{(ke.dataTransfer.types.includes("application/prompt-modifier-card")||ke.dataTransfer.types.includes("Files")||ke.dataTransfer.types.includes("application/prompt-modifier-drag-image"))&&(ke.preventDefault(),ke.stopPropagation(),Q(!0))};return n.jsxs("div",{className:`flex h-full w-full overflow-x-scroll custom-scrollbar p-0 gap-0 pb-2 transition-colors ${W?"bg-accent-dim":""}`,onWheel:ke=>ke.stopPropagation(),style:{scrollbarGutter:"stable",overscrollBehaviorY:"contain"},onDrop:pe,onDragOver:Ue,onDragLeave:()=>Q(!1),children:[n.jsx("style",{children:".custom-scrollbar::-webkit-scrollbar { height: 8px; width: 8px; } .custom-scrollbar::-webkit-scrollbar-track { background: rgba(31, 41, 45, 0.5); border-radius: 4px; margin: 0 4px; } .custom-scrollbar::-webkit-scrollbar-thumb { background: var(--color-scrollbar); border-radius: 4px; } .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #6b7280; }"}),n.jsx(ec,{isOpen:ne,onClose:()=>{X(!1)},onApply:ke=>Te(ge,ke),imageSrc:re}),n.jsx("input",{ref:R,type:"file",accept:"image/*",className:"hidden",onChange:Re}),$.map((ke,Ne)=>n.jsxs(jt.Fragment,{children:[n.jsx(r0,{index:Ne,activeDropZone:K,onDragOver:me,onDrop:pe,onDragLeave:_e}),n.jsx(nj,{char:ke,index:Ne,nodeId:e.id,isDragging:se===Ne,onUpdate:He=>ae(Ne,He),onRemove:()=>Se(Ne),onSetAsOutput:()=>ue(Ne),onToggleActive:()=>he(Ne),onDragStart:He=>ye(He,Ne),onDragEnd:()=>{ie(null),A(null),Z(null)},onSmartDragOver:He=>ve(He,Ne),onRatioChange:He=>De(Ne,He),onPasteImage:()=>Me(Ne),onClearImage:()=>ae(Ne,{thumbnails:{...ke.thumbnails,[ke.selectedRatio]:null},image:null}),onCopyImage:()=>{const He=c(e.id,Ne*10)||ke.image;He&&u(He)},onGenerateImage:()=>{te(Ne),_(e.id,Ne)},onEditRaster:()=>at(Ne),onEditAI:()=>We(Ne),onCrop1x1:()=>Oe(Ne),onExpandRatio:He=>Jt(Ne,He),onSetEditingIndex:()=>{var He;te(Ne),(He=R.current)==null||He.click()},onSyncFromConnection:()=>Ce(Ne),onLoad:()=>r(e.id),onSave:()=>o(e.id,Ne),onSaveToCatalog:()=>s(e.id,Ne),onCopySpecific:()=>Le(Ne),onPasteSpecific:()=>Ee(Ne),onDetach:()=>Ae(Ne),onModify:()=>we(Ne),getFullSizeImage:He=>c(e.id,He),setImageViewer:d,onCopyImageToClipboard:u,processNewImage:He=>Te(Ne,He),t:a,deselectAllNodes:i,languages:fn,secondaryLanguage:ce,isModifyingCharacter:y,isUpdatingDescription:k,onUpdateDescription:()=>w&&w(e.id,Ne),isUpdatingPersonality:N,onUpdatePersonality:()=>qe(Ne),isUpdatingAppearance:F,onUpdateAppearance:()=>Be(Ne),isUpdatingClothing:G,onUpdateClothing:()=>Ie(Ne),transformingRatio:q,isGeneratingImage:S,isUpdatingCharacterPrompt:E,modificationRequest:le[Ne]||"",setModificationRequest:He=>ee(Fe=>({...Fe,[Ne]:He})),hasDuplicateIndex:J.has((ke.index||"").trim())})]},ke.id)),n.jsx(r0,{index:$.length,activeDropZone:K,onDragOver:me,onDrop:pe,onDragLeave:_e}),n.jsx("div",{className:"flex items-center justify-start pl-2 min-w-[60px] h-full",children:n.jsx(ut,{content:a("node.action.addCard"),children:n.jsx("button",{onClick:xe,className:"w-12 h-12 flex items-center justify-center bg-gray-800 hover:bg-cyan-900 border border-gray-600 hover:border-cyan-500 text-gray-400 hover:text-cyan-400 rounded-full transition-all shadow-lg group relative",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 transform transition-transform duration-200 group-hover:scale-110",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{d:"M12 4v16m8-8H4"})})})})})]})},rj=({node:e,onSanitize:t,isSanitizing:o,t:r,onSelectNode:a})=>n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsx("div",{className:"relative flex-grow min-h-0 mb-2",children:n.jsx("textarea",{readOnly:!0,value:e.value,placeholder:r("node.content.sanitizedPromptHere"),className:"absolute inset-0 w-full h-full p-2 bg-gray-700 border-none rounded-md resize-none focus:outline-none",onWheel:i=>i.stopPropagation(),onMouseDown:i=>{i.stopPropagation(),a()}})}),n.jsx("button",{onClick:()=>t(e.id),disabled:o,className:"w-full px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:r(o?"node.content.sanitizing":"node.action.sanitize")})]}),aj=({node:e,onReadData:t,t:o,onSelectNode:r,getUpstreamNodeValues:a})=>{const{text:i,image:s,mediaUrl:l,mediaType:c}=v.useMemo(()=>{try{const w=JSON.parse(e.value||"{}");return{text:w.text||"",image:w.image||null,mediaUrl:w.mediaUrl||null,mediaType:w.mediaType||"video"}}catch{return{text:"",image:null,mediaUrl:null,mediaType:"video"}}},[e.value]),[d,u]=v.useState(null);v.useEffect(()=>{u(null)},[s]);const p=v.useMemo(()=>a(e.id),[a,e.id]),h=JSON.stringify(p);return v.useEffect(()=>{t(e.id)},[h,t,e.id]),n.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[n.jsxs("div",{className:"flex-grow min-h-0 flex flex-col space-y-2",children:[l&&n.jsxs("div",{className:"flex-1 min-h-[150px] bg-black rounded-md overflow-hidden relative group border border-gray-700",onMouseDown:w=>{w.stopPropagation(),r()},children:[c==="video"?n.jsx("video",{src:l,controls:!0,className:"w-full h-full object-contain"}):n.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-4 bg-gray-900",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-gray-500 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),n.jsx("audio",{src:l,controls:!0,className:"w-full max-w-[90%]"})]}),n.jsx("div",{className:"absolute top-1 left-1 bg-black/60 text-white text-[10px] px-1.5 py-0.5 rounded pointer-events-none uppercase backdrop-blur-sm border border-white/10",children:c})]}),s&&n.jsxs("div",{className:"flex-1 min-h-[150px] bg-gray-900/50 rounded-md p-1 relative group",onMouseDown:w=>{w.stopPropagation(),r()},children:[n.jsx("img",{src:s,alt:"Read data",className:"object-contain w-full h-full",onLoad:w=>u({width:w.currentTarget.naturalWidth,height:w.currentTarget.naturalHeight})}),d&&n.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/70 text-white text-[10px] px-1.5 py-0.5 rounded pointer-events-none backdrop-blur-sm",children:[d.width," x ",d.height," px"]})]}),n.jsxs("div",{className:"flex-grow min-h-0 relative",children:[n.jsx("textarea",{readOnly:!0,value:i,placeholder:!s&&!i&&!l?"":o("node.content.textDataHere"),className:"w-full h-full p-2 bg-slate-800 border-none rounded-md resize-none focus:outline-none text-gray-300",onWheel:w=>w.stopPropagation(),onMouseDown:w=>{w.stopPropagation(),r()}}),!s&&!i&&!l&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-center text-gray-500 pointer-events-none p-4",children:n.jsx("span",{children:o("node.content.noDataRead")})})]})]}),n.jsx("button",{onClick:()=>t(e.id),className:"w-full px-4 py-2 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex-shrink-0",children:o("node.content.readData")})]})},ij=({data:e,color:t="rgba(255, 255, 255, 0.5)",height:o=40})=>{const r=v.useRef(null);return v.useEffect(()=>{const a=r.current;if(!a||!e)return;const i=a.getContext("2d");if(!i)return;const s=window.devicePixelRatio||1,l=a.getBoundingClientRect();a.width=l.width*s,a.height=l.height*s,i.scale(s,s),i.clearRect(0,0,l.width,l.height);const c=l.width,d=l.height,u=d/2;i.fillStyle=t,i.beginPath();const p=Math.ceil(e.length/c),h=d/2;for(let w=0;w<c;w++){let k=1,b=-1;for(let y=0;y<p;y++){const g=e[w*p+y];g<k&&(k=g),g>b&&(b=g)}i.fillRect(w,u+k*h,1,Math.max(1,(b-k)*h))}},[e,t,o]),n.jsx("canvas",{ref:r,className:"w-full h-full absolute inset-0 pointer-events-none opacity-60"})},sj=({tracks:e,clips:t,currentTime:o,duration:r,zoom:a,onSeek:i,scrollLeft:s,onScroll:l,onClipSelect:c,selectedClipId:d,audioDataMap:u})=>{var S;const p=v.useRef(null),h=v.useRef(!1),w=Math.max(r*a,((S=p.current)==null?void 0:S.clientWidth)||0)+200,k=(P,j)=>{P.stopPropagation(),c(j)},b=P=>P.type==="video"?"bg-indigo-900/80 border-indigo-500":P.type==="image"?"bg-emerald-900/80 border-emerald-500":P.type==="audio"?"bg-amber-900/80 border-amber-500":"bg-gray-700 border-gray-500",y=P=>{if(!p.current)return 0;const j=p.current.getBoundingClientRect(),D=P-j.left+p.current.scrollLeft;return Math.max(0,D/a)},g=P=>{h.current=!0,i(y(P.clientX)),window.addEventListener("mousemove",m),window.addEventListener("mouseup",x)},m=P=>{h.current&&i(y(P.clientX))},x=()=>{h.current=!1,window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",x)};v.useEffect(()=>()=>{window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",x)},[]);const _=()=>{const P=[],j=a<20?5:a<50?1:.5,M=r+10;for(let D=0;D<=M;D+=j){const O=D*a;P.push(n.jsx("div",{className:"absolute top-0 bottom-0 border-l border-gray-600 pointer-events-none",style:{left:O},children:n.jsxs("span",{className:"absolute top-0 left-1 text-[9px] text-gray-400 select-none",children:[D,"s"]})},D))}return P};return n.jsx("div",{className:"flex flex-col h-full bg-gray-900 border-t border-gray-700",children:n.jsxs("div",{className:"flex-1 flex overflow-hidden relative",children:[n.jsxs("div",{className:"w-24 flex-shrink-0 bg-gray-800 border-r border-gray-700 z-20 flex flex-col shadow-lg",children:[n.jsx("div",{className:"h-8 border-b border-gray-700 bg-gray-800"})," ",e.map(P=>n.jsxs("div",{className:"h-16 border-b border-gray-700 flex flex-col justify-center px-2 text-xs text-gray-400 bg-gray-800 gap-1 relative",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:`w-2 h-2 rounded-full ${P.type==="audio"?"bg-amber-500":"bg-indigo-500"}`}),n.jsx("span",{className:"font-bold truncate",title:P.name,children:P.name})]}),n.jsx("div",{className:"flex items-center gap-1 text-[10px] opacity-60",children:n.jsx("span",{children:P.type.toUpperCase()})})]},P.id))]}),n.jsx("div",{className:"flex-1 overflow-x-auto overflow-y-hidden relative custom-scrollbar",ref:p,onScroll:P=>l(P.currentTarget.scrollLeft),children:n.jsxs("div",{style:{width:w,height:"100%"},className:"relative",children:[n.jsxs("div",{className:"h-8 bg-gray-800 border-b border-gray-700 relative cursor-pointer hover:bg-gray-750 z-10",onMouseDown:g,children:[_(),n.jsx("div",{className:"absolute top-0 bottom-0 w-0 z-20 pointer-events-none",style:{left:o*a},children:n.jsx("div",{className:"absolute -top-0 -left-2 w-0 h-0 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent border-t-[12px] border-t-red-500"})})]}),e.map(P=>n.jsxs("div",{className:"h-16 border-b border-gray-700 relative bg-gray-900/50",children:[n.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-20"}),t.filter(j=>j.layer===P.id).map(j=>n.jsxs("div",{onClick:M=>k(M,j.id),className:`absolute top-1 bottom-1 rounded overflow-hidden cursor-pointer border border-opacity-50 select-none group
                                            ${b(j)}
                                            ${d===j.id?"ring-2 ring-white z-10":""}
                                        `,style:{left:j.start*a,width:j.duration*a},title:`${j.name} (Start: ${j.start.toFixed(1)}s, Dur: ${j.duration.toFixed(1)}s)`,children:[u&&u[j.id]&&n.jsx(ij,{data:u[j.id],color:j.type==="audio"?"rgba(251, 191, 36, 0.7)":"rgba(99, 102, 241, 0.7)"}),n.jsx("div",{className:"absolute top-0 left-0 right-0 px-1 text-[10px] text-white/90 truncate bg-black/30 pointer-events-none",children:j.name})]},j.id))]},P.id)),n.jsx("div",{className:"absolute top-8 bottom-0 w-px bg-red-500 pointer-events-none z-30",style:{left:o*a}})]})})]})})},lj=({currentTime:e,clips:t,isPlaying:o,onTimeUpdate:r})=>{const a=v.useRef(null),i=v.useRef(null),s=v.useRef(null),l=v.useRef(null),c=v.useRef(e),[d,u]=v.useState(null),[p,h]=v.useState([]);v.useEffect(()=>{const k=t.filter(y=>(y.type==="video"||y.type==="image")&&e>=y.start&&e<y.start+y.duration);k.sort((y,g)=>g.layer-y.layer),u(k[0]||null);const b=t.filter(y=>y.type==="audio"&&e>=y.start&&e<y.start+y.duration);h(b)},[e,t]),v.useEffect(()=>{const k=d;if(k&&k.type==="video"&&a.current){const b=e-k.start+k.offset;Math.abs(a.current.currentTime-b)>.3&&(a.current.currentTime=b),o&&a.current.paused?a.current.play().catch(()=>{}):!o&&!a.current.paused&&a.current.pause()}},[e,d,o]),v.useEffect(()=>{i.current&&Array.from(i.current.children).forEach(k=>{const b=k,y=b.getAttribute("data-clip-id"),g=p.find(m=>m.id===y);if(g){const m=e-g.start+g.offset;Math.abs(b.currentTime-m)>.3&&(b.currentTime=m),o&&b.paused?b.play().catch(()=>{}):!o&&!b.paused&&b.pause()}})},[e,p,o]);const w=k=>{if(o){const b=(k-c.current)/1e3,y=Math.min(b,.1);r(g=>g+y)}c.current=k,l.current=requestAnimationFrame(w)};return v.useEffect(()=>(c.current=performance.now(),l.current=requestAnimationFrame(w),()=>{l.current&&cancelAnimationFrame(l.current)}),[o]),n.jsxs("div",{ref:s,className:"w-full h-full bg-black flex items-center justify-center overflow-hidden relative",children:[d?d.type==="video"?n.jsx("video",{ref:a,src:d.src,className:"max-w-full max-h-full object-contain",muted:!0,playsInline:!0}):n.jsx("img",{src:d.src,alt:"preview",className:"max-w-full max-h-full object-contain"}):n.jsx("div",{className:"text-gray-600 text-xs",children:"No Visual Signal"}),n.jsx("div",{ref:i,className:"hidden",children:p.map(k=>n.jsx("audio",{"data-clip-id":k.id,src:k.src},k.id))}),n.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/60 px-2 py-1 rounded text-white text-xs font-mono pointer-events-none z-10",children:[e.toFixed(2),"s"]})]})},cj=({type:e})=>{switch(e){case"folder":return n.jsx("svg",{className:"w-5 h-5 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:n.jsx("path",{d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})});case"image":return n.jsx("svg",{className:"w-5 h-5 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})});case"video":return n.jsx("svg",{className:"w-5 h-5 text-purple-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})});case"audio":return n.jsx("svg",{className:"w-5 h-5 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})});default:return n.jsx("svg",{className:"w-5 h-5 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}},dj=({className:e})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),uj=({files:e,currentFolderId:t,viewMode:o,onUpload:r,onDragStart:a,onDelete:i,onNavigate:s,onCreateFolder:l,onRename:c,onToggleView:d})=>{const u=v.useRef(null),[p,h]=v.useState(null),[w,k]=v.useState(""),b=v.useMemo(()=>e.filter(S=>S.parentId===t).sort((S,P)=>S.type==="folder"&&P.type!=="folder"?-1:S.type!=="folder"&&P.type==="folder"?1:S.name.localeCompare(P.name)),[e,t]),y=v.useMemo(()=>{const S=[];let P=t;for(;P;){const j=e.find(M=>M.id===P);j?(S.unshift({id:j.id,name:j.name}),P=j.parentId):P=null}return[{id:null,name:"Root"},...S]},[t,e]),g=()=>{if(!t)return;const S=e.find(P=>P.id===t);s(S?S.parentId:null)},m=S=>{S.isLinked||(h(S.id),k(S.name))},x=()=>{p&&w.trim()&&c(p,w.trim()),h(null)},_=S=>{S.type==="folder"&&s(S.id)};return n.jsxs("div",{className:"flex flex-col h-full bg-gray-800",children:[n.jsxs("div",{className:"flex items-center justify-between p-1 border-b border-gray-700 bg-gray-900/50",children:[n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx("button",{onClick:g,disabled:!t,className:"p-1 hover:bg-gray-700 rounded text-gray-400 disabled:opacity-30 transition-colors",title:"Up",children:n.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})})}),n.jsx("div",{className:"h-4 w-px bg-gray-700 mx-1"}),n.jsx("button",{onClick:l,className:"p-1 hover:bg-gray-700 rounded text-yellow-500 hover:text-yellow-400",title:"New Folder",children:n.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:n.jsx("path",{d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})})}),n.jsx("button",{onClick:()=>{var S;return(S=u.current)==null?void 0:S.click()},className:"p-1 hover:bg-gray-700 rounded text-cyan-400 hover:text-cyan-300",title:"Import",children:n.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0l-4 4m4 4V4"})})})]}),n.jsx("button",{onClick:d,className:"p-1 hover:bg-gray-700 rounded text-gray-400 hover:text-white",title:"Toggle View",children:o==="grid"?n.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})}):n.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),n.jsx("input",{ref:u,type:"file",multiple:!0,accept:"image/*,video/*,audio/*",className:"hidden",onChange:S=>{S.target.files&&r(S.target.files),S.target.value=""}})]}),n.jsx("div",{className:"px-2 py-1 bg-gray-900 border-b border-gray-700 text-xs text-gray-400 flex items-center overflow-x-auto whitespace-nowrap scrollbar-none",children:y.map((S,P)=>n.jsxs(jt.Fragment,{children:[n.jsx("span",{className:"hover:text-white cursor-pointer hover:underline",onClick:()=>s(S.id),children:S.name}),P<y.length-1&&n.jsx("span",{className:"mx-1 text-gray-600",children:"/"})]},S.id||"root"))}),n.jsx("div",{className:`flex-1 overflow-y-auto p-2 custom-scrollbar ${o==="grid"?"flex flex-wrap content-start gap-2":"flex flex-col space-y-1"}`,children:b.length===0?n.jsxs("div",{className:"col-span-full w-full h-32 flex flex-col items-center justify-center text-gray-500 text-xs italic",children:[n.jsx("span",{children:"Empty Folder"}),n.jsx("span",{className:"opacity-50 mt-1",children:"Drop files here"})]}):b.map(S=>n.jsxs("div",{className:`
                                group relative border border-gray-700 rounded hover:bg-gray-700/50 hover:border-gray-500 transition-colors overflow-hidden
                                ${o==="grid"?"flex flex-col w-24 h-24":"flex items-center h-8 px-2 w-full"}
                            `,draggable:S.type!=="folder"&&!!S.src,onDragStart:P=>a(P,S),onDoubleClick:()=>_(S),children:[n.jsxs("div",{className:`${o==="grid"?"flex-1 w-full bg-black/40 overflow-hidden flex items-center justify-center relative":"w-5 h-5 flex-shrink-0 mr-2 relative"}`,children:[S.thumbnail?n.jsx("img",{src:S.thumbnail,className:"w-full h-full object-cover opacity-80 group-hover:opacity-100",alt:"thumb"}):(S.type==="image"||S.type==="text"&&S.src.startsWith("data:image"))&&S.src?n.jsx("img",{src:S.src,className:"w-full h-full object-cover opacity-80 group-hover:opacity-100",alt:"thumb"}):n.jsx(cj,{type:S.type}),S.isLinked&&n.jsx("div",{className:"absolute top-0 right-0 bg-cyan-600/80 p-0.5 rounded-bl-md z-10 shadow-sm pointer-events-none",children:n.jsx(dj,{className:"w-2.5 h-2.5 text-white"})})]}),n.jsx("div",{className:`${o==="grid"?"h-7 px-1 flex items-center bg-gray-800 border-t border-gray-700":"flex-grow min-w-0"}`,children:p===S.id?n.jsx("input",{type:"text",value:w,onChange:P=>k(P.target.value),onBlur:x,onKeyDown:P=>{P.key==="Enter"&&x()},onDoubleClick:P=>P.stopPropagation(),className:"w-full bg-gray-900 text-white text-[10px] px-1 rounded border border-blue-500 outline-none",autoFocus:!0}):n.jsx("span",{className:`text-[10px] truncate cursor-text w-full block ${S.isLinked?"text-cyan-200":"text-gray-300"}`,title:S.name,onClick:P=>{P.stopPropagation(),m(S)},children:S.name})}),!S.isLinked&&n.jsx("button",{onClick:P=>{P.stopPropagation(),i(S.id)},className:`
                                        text-gray-500 hover:text-red-400 transition-colors
                                        ${o==="grid"?"absolute top-1 right-1 bg-black/50 rounded p-0.5 opacity-0 group-hover:opacity-100":"ml-2 opacity-0 group-hover:opacity-100"}
                                    `,children:n.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},S.id))})]})},pj=e=>{const[t,o]=v.useState({}),r=v.useRef(new Set);return v.useEffect(()=>{const a=async()=>{const i={};let s=!1;const l=window.AudioContext||window.webkitAudioContext,c=new l;for(const d of e)if(!(d.type!=="audio"&&d.type!=="video"||t[d.id]||r.current.has(d.id))){r.current.add(d.id);try{const p=await(await fetch(d.src)).arrayBuffer(),w=(await c.decodeAudioData(p)).getChannelData(0);i[d.id]=w,s=!0}catch(u){console.error(`Failed to decode audio for clip ${d.id}`,u)}}s&&o(d=>({...d,...i})),c.state!=="closed"&&c.close()};e.length>0&&a()},[e,t]),t},a0={currentTime:0,totalDuration:30,clips:[],tracks:[{id:2,name:"V2",type:"video",isMuted:!1,isVisible:!0},{id:1,name:"V1",type:"video",isMuted:!1,isVisible:!0},{id:101,name:"A1",type:"audio",isMuted:!1,isVisible:!0}],mediaFiles:[],isPlaying:!1,zoom:20,selectedClipId:null,scrollLeft:0,mediaPanelWidth:240,currentFolderId:null,viewMode:"grid"},hj=180,mj=600,gj=({node:e,onValueChange:t,t:o,deselectAllNodes:r,getUpstreamNodeValues:a,isSelected:i,onSelectNode:s})=>{const l=v.useRef(null),c=v.useRef(null),d=v.useMemo(()=>{try{return{...a0,...JSON.parse(e.value||"{}")}}catch{return a0}},[e.value]),u=v.useCallback(R=>{const q={...d,...R};t(e.id,JSON.stringify(q))},[d,e.id,t]),[p,h]=v.useState(d.currentTime),[w,k]=v.useState(!1),b=pj(d.clips);v.useEffect(()=>{h(d.currentTime)},[d.currentTime]),v.useEffect(()=>{if(!a)return;const R=a(e.id,"video"),q=a(e.id,"audio"),H=a(e.id,"image"),ne=a(e.id,"text"),X=d.mediaFiles.filter(ee=>!ee.isLinked),re=[],de=[{type:"video",data:R,folderName:"Video Inputs"},{type:"audio",data:q,folderName:"Audio Inputs"},{type:"image",data:H,folderName:"Image Inputs"},{type:"text",data:ne,folderName:"Text Inputs"}],ge=ee=>ee.replace(/[<>&'"]/g,se=>{switch(se){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;";default:return se}});de.forEach(({type:ee,data:se,folderName:ie})=>{if(se.length>0){const oe=`folder-linked-${ee}`;re.push({id:oe,type:"folder",src:"",name:ie,parentId:null,isLinked:!0}),se.forEach((A,K)=>{let Z="";if(A&&typeof A=="object"&&A.base64ImageData)Z=`data:${A.mimeType};base64,${A.base64ImageData}`;else if(typeof A=="string")if(ee==="text"){const Q=`<svg xmlns="http://www.w3.org/2000/svg" width="800" height="200" style="background:black;"><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="white" font-family="sans-serif" font-size="40">${ge(A)}</text></svg>`;Z=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(Q)}`}else(A.startsWith("data:")||A.startsWith("http")||A.startsWith("blob:"))&&(Z=A);re.push({id:`linked-${ee}-${K}`,type:ee,src:Z,name:Z?`${ee.charAt(0).toUpperCase()+ee.slice(1)} ${K+1}`:`Empty ${ee} Slot ${K+1}`,parentId:oe,isLinked:!0})})}});const te=d.mediaFiles.filter(ee=>ee.isLinked);if(re.length!==te.length||re.some((ee,se)=>{var ie,oe;return ee.id!==((ie=te[se])==null?void 0:ie.id)||ee.src!==((oe=te[se])==null?void 0:oe.src)})){let ee=d.currentFolderId;ee&&ee.startsWith("folder-linked-")&&(re.find(se=>se.id===ee)||(ee=null)),u({mediaFiles:[...X,...re],currentFolderId:ee})}},[a,e.id,d.mediaFiles,d.currentFolderId]);const y=v.useCallback(()=>{const R=!w;k(R),R||u({currentTime:p,isPlaying:!1})},[w,p,u]),g=R=>{h(R),w||u({currentTime:R})},m=R=>{h(q=>{const H=R(q);return H>=d.totalDuration?(k(!1),d.totalDuration):H})},x=R=>{const q=R==="in"?d.zoom*1.2:d.zoom/1.2;u({zoom:Math.max(5,Math.min(200,q))})},_=async R=>new Promise(q=>{const H=document.createElement("video");H.preload="metadata",H.src=URL.createObjectURL(R),H.muted=!0,H.playsInline=!0,H.currentTime=1,H.onloadeddata=()=>{const ne=document.createElement("canvas");ne.width=160,ne.height=90;const X=ne.getContext("2d");X==null||X.drawImage(H,0,0,160,90);const re=ne.toDataURL("image/jpeg",.7);q(re),URL.revokeObjectURL(H.src)},H.onerror=()=>{q("")}}),S=async R=>{const q=[];for(const H of Array.from(R)){const ne=URL.createObjectURL(H);let X="image",re;if(H.type.startsWith("video/")){X="video";try{re=await _(H)}catch(de){console.error("Thumbnail generation failed",de)}}else if(H.type.startsWith("audio/"))X="audio";else if(H.type.startsWith("image/")){X="image";try{re=await Rt(ne,160,160)}catch{}}q.push({id:`media-${Date.now()}-${Math.random()}`,type:X,src:ne,name:H.name,parentId:d.currentFolderId,thumbnail:re,isLinked:!1})}u({mediaFiles:[...d.mediaFiles,...q]})},P=R=>{const q=d.mediaFiles.find(X=>X.id===R);if(q!=null&&q.isLinked)return;const H=new Set,ne=X=>{H.add(X),d.mediaFiles.filter(re=>re.parentId===X).forEach(re=>ne(re.id))};ne(R),u({mediaFiles:d.mediaFiles.filter(X=>!H.has(X.id))})},j=()=>{const R={id:`folder-${Date.now()}`,type:"folder",src:"",name:"New Folder",parentId:d.currentFolderId,isLinked:!1};u({mediaFiles:[...d.mediaFiles,R]})},M=R=>{u({currentFolderId:R})},D=(R,q)=>{const H=d.mediaFiles.find(ne=>ne.id===R);H!=null&&H.isLinked||u({mediaFiles:d.mediaFiles.map(ne=>ne.id===R?{...ne,name:q}:ne)})},O=()=>{u({viewMode:d.viewMode==="grid"?"list":"grid"})},B=(R,q)=>{q.type!=="folder"&&q.src&&(R.dataTransfer.setData("application/video-editor-media",JSON.stringify(q)),R.dataTransfer.effectAllowed="copy")},E=R=>{R.preventDefault(),R.stopPropagation(),c.current={x:R.clientX,startWidth:d.mediaPanelWidth},window.addEventListener("mousemove",I),window.addEventListener("mouseup",N)},I=R=>{if(!c.current)return;const q=R.clientX-c.current.x,H=Math.max(hj,Math.min(mj,c.current.startWidth+q));l.current&&u({mediaPanelWidth:H})},N=()=>{c.current=null,window.removeEventListener("mousemove",I),window.removeEventListener("mouseup",N)},T=R=>{R.preventDefault(),R.stopPropagation();const q=R.dataTransfer.getData("application/video-editor-media");if(q){const H=JSON.parse(q);F(H,R.clientX)}else R.dataTransfer.files.length>0&&S(R.dataTransfer.files)},F=(R,q)=>{var de,ge;const H=R.type==="audio"?((de=d.tracks.find(te=>te.type==="audio"))==null?void 0:de.id)||101:((ge=d.tracks.find(te=>te.type==="video"))==null?void 0:ge.id)||1,ne=R.type==="text"?"image":R.type,X=p,re={id:`clip-${Date.now()}-${Math.random()}`,type:ne,src:R.src,start:X,duration:R.type==="image"||R.type==="text"?5:10,offset:0,layer:H,name:R.name,thumbnail:R.thumbnail};u({clips:[...d.clips,re]})},z=R=>{u({selectedClipId:R})},G=()=>{d.selectedClipId&&u({clips:d.clips.filter(R=>R.id!==d.selectedClipId),selectedClipId:null})},U=R=>{R.stopPropagation(),s&&s()};return v.useEffect(()=>{if(!i)return;const R=q=>{if(q.code==="Space"){const H=q.target;if(H.tagName==="INPUT"||H.tagName==="TEXTAREA"||H.isContentEditable)return;q.preventDefault(),q.stopPropagation(),y()}};return window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)},[i,y]),n.jsxs("div",{ref:l,className:"flex flex-col w-full h-full bg-gray-900 text-white rounded-lg overflow-hidden",onMouseDown:U,onWheel:R=>R.stopPropagation(),onDragOver:R=>{R.preventDefault(),R.stopPropagation()},onDrop:T,children:[n.jsxs("div",{className:"flex-1 flex min-h-0",children:[n.jsxs("div",{style:{width:d.mediaPanelWidth},className:"flex-shrink-0 flex flex-col relative border-r border-gray-700",children:[n.jsx(uj,{files:d.mediaFiles,currentFolderId:d.currentFolderId,viewMode:d.viewMode,onUpload:S,onDragStart:B,onDelete:P,onNavigate:M,onCreateFolder:j,onRename:D,onToggleView:O}),n.jsx("div",{className:"absolute top-0 bottom-0 right-[-4px] w-2 cursor-col-resize z-10 hover:bg-cyan-500/50 transition-colors",onMouseDown:E})]}),n.jsx("div",{className:"flex-1 bg-black relative",children:n.jsx(lj,{currentTime:p,clips:d.clips,isPlaying:w,onTimeUpdate:m})}),n.jsxs("div",{className:"w-48 bg-gray-800 p-2 flex flex-col space-y-2 border-l border-gray-700 flex-shrink-0",children:[n.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase",children:"Properties"}),d.selectedClipId?n.jsxs("div",{className:"text-xs space-y-2",children:[n.jsx("p",{className:"text-gray-300",children:"Selected Clip"}),n.jsx("div",{className:"h-px bg-gray-700 w-full"}),n.jsx("button",{onClick:G,className:"w-full bg-red-600 hover:bg-red-700 px-2 py-1 rounded text-white transition-colors",children:"Delete Clip"})]}):n.jsx("p",{className:"text-xs text-gray-500",children:"No clip selected"})]})]}),n.jsxs("div",{className:"h-10 bg-gray-800 border-t border-gray-700 flex items-center px-4 justify-between shrink-0",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("button",{onClick:()=>g(0),className:"text-gray-400 hover:text-white",children:"|<"}),n.jsx("button",{onClick:y,className:`w-8 h-8 rounded-full flex items-center justify-center ${w?"bg-red-600 hover:bg-red-700":"bg-cyan-600 hover:bg-cyan-700"} text-white transition-colors`,children:w?n.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})}):n.jsx("svg",{className:"w-4 h-4 ml-0.5",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{d:"M8 5v14l11-7z"})})})]}),n.jsxs("div",{className:"font-mono text-sm text-cyan-400",children:[p.toFixed(2),"s / ",d.totalDuration,"s"]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("button",{onClick:()=>x("out"),className:"text-gray-400 hover:text-white text-xs bg-gray-700 px-2 py-1 rounded",children:"- Zoom"}),n.jsx("button",{onClick:()=>x("in"),className:"text-gray-400 hover:text-white text-xs bg-gray-700 px-2 py-1 rounded",children:"+ Zoom"})]})]}),n.jsx("div",{className:"h-56 flex-shrink-0",children:n.jsx(sj,{tracks:d.tracks,clips:d.clips,currentTime:p,duration:d.totalDuration,zoom:d.zoom,onSeek:g,scrollLeft:d.scrollLeft,onScroll:R=>u({scrollLeft:R}),onClipSelect:z,selectedClipId:d.selectedClipId,audioDataMap:b})})]})},fj=(e,t,o)=>{const r=v.useRef(null),a=Ut(),i=a==null?void 0:a.setGlobalMedia,s=a==null?void 0:a.globalMedia,l=q=>{try{const H=JSON.parse(q||"{}");return{src:H.src||"",type:H.type||"video",name:H.name||"",currentTime:H.currentTime||0,volume:H.volume!==void 0?H.volume:.4,isPlaying:H.isPlaying||!1,markers:H.markers||[]}}catch{return{src:"",type:"video",name:"",markers:[],volume:.4}}},[c,d]=v.useState(()=>{const q=l(t);return a!=null&&a.globalMedia&&a.globalMedia.nodeId===e?{...q,currentTime:a.globalMedia.currentTime,isPlaying:a.globalMedia.isPlaying}:q}),u=v.useRef(c);v.useEffect(()=>{u.current=c},[c]);const{isPlaying:p,currentTime:h,volume:w,markers:k,src:b,type:y,name:g}=c,[m,x]=v.useState(0),_=v.useRef(!1),S=v.useCallback(q=>{d(H=>{let ne={};r.current&&(ne={currentTime:r.current.currentTime,volume:r.current.volume,isPlaying:q.isPlaying!==void 0?q.isPlaying:!r.current.paused});const X={...H,...ne,...q};return o(e,JSON.stringify(X)),i&&(X.isPlaying||H.isPlaying)&&i(re=>{var de;return{nodeId:e,name:X.name||"Media",isPlaying:!!X.isPlaying,currentTime:X.currentTime||0,duration:((de=r.current)==null?void 0:de.duration)||0,volume:X.volume||.4,type:X.type||"video",command:void 0,commandTimestamp:void 0}}),X})},[e,o,i]),P=v.useCallback(()=>{r.current&&(r.current.pause(),S({isPlaying:!1}))},[S]);v.useEffect(()=>{s&&s.nodeId!==e&&s.isPlaying&&p&&P()},[s,e,p,P]),v.useEffect(()=>{s&&s.nodeId===e&&s.command&&r.current&&(s.command==="play"?r.current.paused&&(r.current.play().catch(q=>console.error(q)),d(q=>({...q,isPlaying:!0}))):s.command==="pause"?r.current.paused||(r.current.pause(),d(q=>({...q,isPlaying:!1})),S({isPlaying:!1})):s.command==="seek"&&s.seekTarget!==void 0&&(r.current.currentTime=s.seekTarget,j(s.seekTarget)))},[s,e,S]),v.useEffect(()=>{const q=l(t),H=(s==null?void 0:s.nodeId)===e;if(q.src!==b){d(ne=>({...ne,src:q.src,name:q.name,type:q.type,currentTime:0,isPlaying:!!q.isPlaying})),r.current&&(r.current.pause(),r.current.currentTime=0),H&&i&&i(null);return}if(H){JSON.stringify(q.markers)!==JSON.stringify(k)&&d(ne=>({...ne,markers:q.markers||[]}));return}q.currentTime>.1&&Math.abs(q.currentTime-h)>.5&&!_.current&&(j(q.currentTime),r.current&&Math.abs(r.current.currentTime-q.currentTime)>.5&&(r.current.currentTime=q.currentTime)),JSON.stringify(q.markers)!==JSON.stringify(k)&&d(ne=>({...ne,markers:q.markers||[]})),q.volume!==void 0&&Math.abs(q.volume-(w||.4))>.01&&(M(q.volume),r.current&&(r.current.volume=q.volume)),q.isPlaying!==p&&(q.isPlaying?D():P())},[t,s==null?void 0:s.nodeId,e,b,h,p,w,k,i]);const j=q=>d(H=>({...H,currentTime:q})),M=q=>d(H=>({...H,volume:q})),D=v.useCallback(async()=>{if(r.current)try{await r.current.play(),S({isPlaying:!0})}catch(q){console.error(q),S({isPlaying:!1})}},[S]),O=v.useCallback(()=>{p?P():D()},[p,D,P]),B=v.useCallback(()=>{r.current&&(r.current.pause(),r.current.currentTime=0,j(0),S({isPlaying:!1,currentTime:0}))},[S]),E=v.useCallback(q=>{_.current=!0,r.current&&(r.current.currentTime=q,j(q)),setTimeout(()=>{_.current=!1},500)},[]),I=v.useCallback(q=>{r.current&&(r.current.volume=q),M(q),S({volume:q})},[S]),N=v.useCallback(()=>{const q={id:`marker-${Date.now()}`,time:h||0,label:`Marker ${(k||[]).length+1}`,color:"#3b82f6"},H=[...k||[],q].sort((ne,X)=>ne.time-X.time);S({markers:H})},[h,k,S]),T=v.useCallback((q,H)=>{const ne=(k||[]).map(X=>X.id===q?{...X,...H}:X);S({markers:ne})},[k,S]),F=v.useCallback(q=>{const H=(k||[]).filter(ne=>ne.id!==q);S({markers:H})},[k,S]),z=v.useCallback(()=>{S({markers:[]})},[S]),G=v.useCallback(()=>{if(r.current&&!_.current){const q=r.current.currentTime;j(q),(s==null?void 0:s.nodeId)===e&&i&&i(H=>H?{...H,currentTime:q,command:void 0,commandTimestamp:void 0}:null)}},[s==null?void 0:s.nodeId,e,i]),U=v.useCallback(()=>{if(r.current){x(r.current.duration);const q=u.current;r.current.volume=q.volume!==void 0?q.volume:.4,q.currentTime>0&&Math.abs(r.current.currentTime-q.currentTime)>.5&&(r.current.currentTime=q.currentTime),q.isPlaying&&D()}},[D]),R=v.useCallback(()=>{S({isPlaying:!1,currentTime:0}),r.current&&(r.current.currentTime=0),j(0)},[S]);return{mediaRef:r,isPlaying:!!p,currentTime:h||0,duration:m,volume:w!==void 0?w:.4,markers:k||[],togglePlay:O,stop:B,seek:E,changeVolume:I,addMarker:N,updateMarker:T,deleteMarker:F,deleteAllMarkers:z,handleTimeUpdate:G,handleLoadedMetadata:U,handleEnded:R}},xj=(e,t,o)=>{const r=v.useRef(null),a=v.useRef(null),i=v.useRef(null);return v.useEffect(()=>t!=="audio"||!e||!o?void 0:((()=>{if(r.current)r.current.state==="suspended"&&r.current.resume();else{const l=window.AudioContext||window.webkitAudioContext,c=new l,d=c.createAnalyser();d.fftSize=256;try{c.createMediaElementSource(o).connect(d),d.connect(c.destination),r.current=c,a.current=d}catch{}}})(),()=>{r.current&&r.current.state!=="closed"&&(r.current.close(),r.current=null,a.current=null)}),[e,t,o]),v.useEffect(()=>{if(t!=="audio"||!e){i.current=null;return}(async()=>{try{const c=await(await fetch(e)).arrayBuffer(),u=await new(window.AudioContext||window.webkitAudioContext)().decodeAudioData(c);i.current=u.getChannelData(0)}catch(l){console.warn("Failed to generate waveform data",l)}})()},[e,t]),{audioContextRef:r,analyserRef:a,audioDataRef:i}},i0=e=>{const t=Math.floor(e/60),o=Math.floor(e%60);return`${t}:${o.toString().padStart(2,"0")}`},Cs=(e,t)=>("000"+e).slice(t*-1),s0=e=>{const t=Math.floor(e/3600),o=Math.floor(e%3600/60),r=Math.floor(e%60),a=Math.floor(e%1*1e3);return`${Cs(t,2)}:${Cs(o,2)}:${Cs(r,2)},${Cs(a,3)}`},yj=({marker:e,onUpdate:t,onDelete:o,onClose:r,initialPosition:a})=>{const[i,s]=v.useState(e.label),[l,c]=v.useState(e.color),d=["#22d3ee","#facc15","#ef4444","#3b82f6","#10b981","#a855f7","#f97316","#ffffff"],[u,p]=v.useState(a),h=v.useRef(null),w=m=>{m.preventDefault(),m.stopPropagation(),h.current={x:m.clientX-u.x,y:m.clientY-u.y},window.addEventListener("mousemove",k),window.addEventListener("mouseup",b)},k=m=>{h.current&&p({x:m.clientX-h.current.x,y:m.clientY-h.current.y})},b=()=>{h.current=null,window.removeEventListener("mousemove",k),window.removeEventListener("mouseup",b)},y=()=>{t(e.id,{label:i,color:l}),r()},g=()=>{o(e.id),r()};return Ba.createPortal(n.jsxs("div",{className:"fixed z-[9999] bg-gray-800 border border-gray-600 rounded-lg shadow-2xl p-2 flex flex-col gap-2 w-56",style:{left:u.x,top:u.y},onMouseDown:m=>m.stopPropagation(),children:[n.jsxs("div",{className:"flex justify-between items-center border-b border-gray-700 pb-1 mb-1 cursor-move select-none",onMouseDown:w,children:[n.jsx("span",{className:"text-xs font-bold text-gray-300",children:"Edit Marker"}),n.jsx("button",{onClick:r,className:"text-gray-500 hover:text-white",title:"Cancel",onMouseDown:m=>m.stopPropagation(),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),n.jsx("input",{type:"text",value:i,onChange:m=>s(m.target.value),className:"bg-gray-900 border border-gray-600 rounded px-2 py-1 text-xs text-white focus:outline-none focus:border-cyan-500 w-full",placeholder:"Marker Name"}),n.jsx("div",{className:"flex gap-1 justify-between",children:d.map(m=>n.jsx("button",{onClick:()=>c(m),className:`w-4 h-4 rounded-full border ${l===m?"border-white scale-110":"border-transparent hover:scale-110"}`,style:{backgroundColor:m}},m))}),n.jsxs("div",{className:"flex justify-between items-center mt-1 pt-2 border-t border-gray-700",children:[n.jsx("button",{onClick:g,className:"p-1 text-red-400 hover:text-red-200 hover:bg-red-900/30 rounded transition-colors",title:"Delete Marker",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})}),n.jsxs("button",{onClick:y,className:"px-3 py-1 bg-cyan-600 hover:bg-cyan-700 text-white text-xs font-bold rounded transition-colors flex items-center gap-1",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Apply"]})]})]}),document.body)},vj=({isPlaying:e,currentTime:t,duration:o,volume:r,markers:a,onTogglePlay:i,onStop:s,onSeek:l,onVolumeChange:c,onClear:d,onAddMarker:u,onUpdateMarker:p,onDeleteMarker:h,onDeleteAllMarkers:w,onSaveMarkers:k,onLoadMarkers:b,onSelect:y,disabled:g,t:m})=>{const x=v.useRef(null),[_,S]=v.useState(null),[P,j]=v.useState(null),M=a.find(E=>E.id===_),D=(E,I)=>{E.stopPropagation(),l(I.time)},O=(E,I)=>{E.stopPropagation();const N=E.target.getBoundingClientRect();j({x:N.left,y:N.top-160}),S(I)},B=()=>{if(a.length===0)return;const E=[...a].sort((z,G)=>z.time-G.time);let I="";E.forEach((z,G)=>{const U=s0(z.time),R=s0(z.time+1);I+=`${G+1}
${U} --> ${R}
${z.label}

`});const N=new Blob([I],{type:"text/plain"}),T=URL.createObjectURL(N),F=document.createElement("a");F.href=T,F.download=`markers_${new Date().toISOString().slice(0,10)}.srt`,F.click(),URL.revokeObjectURL(T)};return n.jsxs("div",{className:"flex-shrink-0 bg-gray-800 border-t border-gray-700 flex flex-col gap-1 relative z-30",onMouseDown:E=>{E.stopPropagation(),y&&y()},children:[_&&M&&P&&n.jsx(yj,{marker:M,onUpdate:p,onDelete:E=>{h(E),S(null)},onClose:()=>S(null),initialPosition:P}),n.jsxs("div",{className:"flex items-center relative group w-full pt-1",children:[n.jsxs("div",{className:"flex-grow relative h-4 flex items-center mx-1",ref:x,children:[o>0&&a.map(E=>{const I=E.time/o*100;return n.jsxs("div",{className:"absolute top-0 w-4 h-4 -ml-2 cursor-pointer z-10 group/marker flex flex-col items-center hover:z-20",style:{left:`${I}%`},onClick:N=>D(N,E),children:[n.jsx("div",{className:"w-0.5 h-full bg-white/50 group-hover/marker:bg-white pointer-events-none"}),n.jsx("div",{className:"w-2.5 h-2.5 rounded-full absolute top-1/2 -translate-y-1/2 shadow-sm border border-black/50 transition-transform group-hover/marker:scale-125",style:{backgroundColor:E.color}}),_!==E.id&&n.jsxs("div",{className:"absolute bottom-full mb-1 flex flex-col items-center gap-1 opacity-0 group-hover/marker:opacity-100 transition-opacity",children:[n.jsx("div",{className:"bg-black/80 text-white text-[9px] px-1 rounded whitespace-nowrap pointer-events-none mb-0.5",children:E.label}),n.jsx("button",{onClick:N=>O(N,E.id),className:"px-2 py-0.5 bg-gray-700 hover:bg-cyan-600 text-white text-[9px] rounded shadow border border-gray-500 hover:border-cyan-400 pointer-events-auto",children:"Edit"})]})]},E.id)}),n.jsx("input",{type:"range",min:"0",max:o||100,value:t,onChange:E=>l(parseFloat(E.target.value)),disabled:g,className:"w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-500 relative z-0"})]}),n.jsxs("span",{className:"text-[10px] text-gray-400 font-mono whitespace-nowrap min-w-[70px] text-right pr-2",children:[i0(t)," / ",i0(o)]})]}),n.jsxs("div",{className:"relative flex items-center justify-center px-1 h-8 mb-1",children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx(ut,{content:m("node.mediaViewer.stop"),children:n.jsx("button",{onClick:s,disabled:g,className:"p-1.5 rounded-full text-gray-400 hover:text-white hover:bg-red-600 transition-colors disabled:opacity-50","aria-label":m("node.mediaViewer.stop"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("rect",{x:"5",y:"5",width:"10",height:"10"})})})}),n.jsx(ut,{content:m(e?"node.mediaViewer.pause":"node.mediaViewer.play"),children:n.jsx("button",{onClick:i,disabled:g,className:"flex items-center justify-center w-8 h-8 rounded bg-cyan-600 hover:bg-cyan-700 text-white transition-colors disabled:bg-gray-700 disabled:text-gray-500","aria-label":m(e?"node.mediaViewer.pause":"node.mediaViewer.play"),children:e?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 ml-0.5",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:"M8 5v14l11-7z"})})})}),n.jsx(ut,{content:m("node.mediaViewer.addMarker"),children:n.jsx("button",{onClick:u,disabled:g,className:"p-1.5 rounded-full text-gray-400 hover:text-blue-400 hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":m("node.mediaViewer.addMarker"),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})})})]}),n.jsxs("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 flex items-center space-x-1 pr-1",children:[n.jsx(ut,{content:m("node.mediaViewer.saveMarkers"),children:n.jsx("button",{onClick:k,className:"p-1.5 rounded-full text-gray-400 hover:text-cyan-400 hover:bg-gray-700 transition-colors cursor-pointer","aria-label":m("node.mediaViewer.saveMarkers"),disabled:g||a.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})}),n.jsx(ut,{content:m("node.mediaViewer.loadMarkers"),children:n.jsx("button",{onClick:b,className:"p-1.5 rounded-full text-gray-400 hover:text-emerald-400 hover:bg-gray-700 transition-colors cursor-pointer","aria-label":m("node.mediaViewer.loadMarkers"),disabled:g,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0l-4 4m4-4v12"})})})}),n.jsx(ut,{content:m("node.mediaViewer.exportSRT"),children:n.jsx("button",{onClick:B,className:"p-1.5 rounded-full text-gray-400 hover:text-purple-400 hover:bg-gray-700 transition-colors cursor-pointer","aria-label":m("node.mediaViewer.exportSRT"),disabled:g||a.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})}),n.jsx(ut,{content:m("node.mediaViewer.deleteAllMarkers"),children:n.jsx("button",{onClick:w,className:"p-1.5 rounded-full text-gray-400 hover:text-red-400 hover:bg-gray-700 transition-colors cursor-pointer","aria-label":m("node.mediaViewer.deleteAllMarkers"),disabled:g||a.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]})]})]})},wj=({audioData:e,currentTime:t,duration:o,isPlaying:r,onSeek:a,markers:i,onSelect:s})=>{const l=v.useRef(null),c=v.useRef(null),d=v.useRef(a),u=v.useRef(i),p=v.useRef(!1);v.useEffect(()=>{d.current=a},[a]),v.useEffect(()=>{u.current=i},[i]);const h=v.useCallback(()=>{const g=l.current,m=c.current,x=e;if(!g||!m||!x)return;const _=g.getContext("2d");if(!_)return;const S=m.getBoundingClientRect(),P=S.width,j=S.height,M=window.devicePixelRatio||1;(g.width!==P*M||g.height!==j*M)&&(g.width=P*M,g.height=j*M),_.resetTransform(),_.scale(M,M),_.clearRect(0,0,P,j);const D=3,B=D+1,E=Math.floor(P/B),I=Math.floor(x.length/E),N=o>0?t/o:0,T=Math.floor(E*N);_.beginPath();for(let G=0;G<E;G++){let U=I*G,R=0;const q=Math.ceil(I/10);let H=0;for(let ge=0;ge<I;ge+=q)U+ge<x.length&&(R+=Math.abs(x[U+ge]),H++);const ne=H>0?R/H:0,X=Math.min(j,Math.max(2,ne*j*2.5)),re=G*B,de=j-X;_.fillStyle=G<T?"#22d3ee":"#4b5563",_.fillRect(re,de,D,X)}const F=u.current;o>0&&F&&(_.font="bold 10px sans-serif",_.textAlign="center",_.textBaseline="top",F.forEach(G=>{const U=Math.round(G.time/o*P);_.beginPath(),_.strokeStyle=G.color,_.lineWidth=2,_.moveTo(U,0),_.lineTo(U,j),_.stroke(),_.beginPath(),_.fillStyle=G.color,_.arc(U,j-6,3,0,Math.PI*2),_.fill();const R=_.measureText(G.label).width,q=Math.round(U-R/2-2),H=2,ne=Math.round(R+4),X=14;_.fillStyle="rgba(0,0,0,0.7)",_.fillRect(q,H,ne,X),_.fillStyle=G.color,_.fillText(G.label,U,4)}));const z=Math.round(P*N);_.fillStyle="#ffffff",_.fillRect(z-1,0,2,j)},[e,t,o]);v.useEffect(()=>{let g;const m=()=>{h(),(r||p.current)&&(g=requestAnimationFrame(m))};return h(),r&&(g=requestAnimationFrame(m)),()=>{g&&cancelAnimationFrame(g)}},[h,r]),v.useEffect(()=>{if(!c.current)return;const g=new ResizeObserver(()=>requestAnimationFrame(h));return g.observe(c.current),()=>g.disconnect()},[h]);const w=g=>{if(!c.current||!o)return;const m=c.current.getBoundingClientRect(),x=g-m.left,_=Math.max(0,Math.min(1,x/m.width));d.current(_*o)},k=v.useCallback(g=>{g.preventDefault(),g.stopPropagation(),s&&s(),p.current=!0,w(g.clientX),window.addEventListener("mousemove",b),window.addEventListener("mouseup",y)},[s,o]),b=v.useCallback(g=>{p.current&&(g.preventDefault(),w(g.clientX))},[o]),y=v.useCallback(()=>{p.current=!1,window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",y)},[b]);return v.useEffect(()=>()=>{window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",y)},[b,y]),n.jsx("div",{ref:c,className:"absolute inset-0 w-full h-full cursor-pointer",onMouseDown:k,children:n.jsx("canvas",{ref:l,className:"w-full h-full object-cover block"})})},bj=({analyser:e,isPlaying:t})=>{const o=v.useRef(null),r=v.useRef(null);return v.useEffect(()=>{if(!t||!e){r.current&&cancelAnimationFrame(r.current);return}const a=()=>{const i=o.current;if(!i)return;const s=i.getContext("2d");if(!s)return;const l=new Uint8Array(e.frequencyBinCount);e.getByteTimeDomainData(l);let c=0;for(let b=0;b<l.length;b++){const y=(l[b]-128)/128;c+=y*y}const d=Math.sqrt(c/l.length),u=Math.min(1,d*4),p=i.width,h=i.height;s.clearRect(0,0,p,h),s.fillStyle="#1f2937",s.fillRect(0,0,p,h);const w=u*h,k=s.createLinearGradient(0,h,0,0);k.addColorStop(0,"#10b981"),k.addColorStop(.6,"#f59e0b"),k.addColorStop(1,"#ef4444"),s.fillStyle=k,s.fillRect(0,h-w,p,w),s.fillStyle="rgba(0,0,0,0.5)";for(let b=10;b<h;b+=10)s.fillRect(0,b,p,1);r.current=requestAnimationFrame(a)};return a(),()=>{r.current&&cancelAnimationFrame(r.current)}},[t,e]),n.jsx("canvas",{ref:o,width:8,height:150,className:"w-full h-full"})},Cj=({src:e,name:t,mediaRef:o,audioData:r,analyser:a,currentTime:i,duration:s,isPlaying:l,volume:c,markers:d,onSeek:u,onVolumeChange:p,onTimeUpdate:h,onLoadedMetadata:w,onEnded:k,onClear:b,onRelink:y,onSelect:g,t:m})=>n.jsxs("div",{className:"w-full h-full flex flex-col relative group bg-gray-900 overflow-hidden pr-3",children:[n.jsxs("div",{className:"h-10 bg-gray-800 border-b border-gray-700 flex items-center px-3 space-x-2 shrink-0 z-10 w-full",onMouseDown:x=>{},children:[n.jsx("div",{className:"w-6 h-6 rounded bg-cyan-900/50 flex items-center justify-center border border-cyan-700 shadow-sm flex-shrink-0",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-cyan-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z",clipRule:"evenodd"})})}),n.jsx("span",{className:"text-gray-200 text-xs font-semibold truncate shadow-sm flex-grow",children:t}),n.jsx(Pe,{title:m("node.mediaViewer.relink"),onClick:y,tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),n.jsx(Pe,{title:m("node.action.clear"),onClick:b,tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),n.jsxs("div",{className:"flex-grow flex min-h-0 relative w-full",children:[n.jsx("div",{className:"flex-grow relative h-full bg-gray-900 min-w-0",children:n.jsx(wj,{audioData:r,currentTime:i,duration:s,isPlaying:l,onSeek:u,markers:d,onSelect:g})}),n.jsxs("div",{className:"w-12 bg-gray-900 border-l border-gray-700 flex flex-col items-center py-2 gap-2 flex-shrink-0 relative z-20",onMouseDown:x=>{x.stopPropagation(),g&&g()},children:[n.jsx("div",{className:"flex-1 w-2 relative bg-gray-800 rounded-full overflow-hidden",children:n.jsx(bj,{analyser:a,isPlaying:l})}),n.jsx("div",{className:"h-24 w-full flex justify-center py-1",children:n.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:c,onChange:x=>p(parseFloat(x.target.value)),className:"h-full w-1 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-cyan-500",style:{writingMode:"vertical-lr",direction:"rtl",WebkitAppearance:"slider-vertical",width:"4px"},title:`Volume: ${Math.round(c*100)}%`})}),n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z",clipRule:"evenodd"})})]})]}),n.jsx("audio",{ref:o,src:e,onTimeUpdate:h,onLoadedMetadata:w,onEnded:k})]}),kj=({src:e,mediaRef:t,onTimeUpdate:o,onLoadedMetadata:r,onEnded:a,onTogglePlay:i})=>n.jsx("video",{ref:t,src:e,className:"w-full h-full object-contain mx-auto",onTimeUpdate:o,onLoadedMetadata:r,onEnded:a,onClick:s=>{s.stopPropagation(),i()}}),_j=({node:e,onValueChange:t,t:o,isSelected:r,onSelectNode:a})=>{const i=v.useRef(null),s=v.useRef(null),l=v.useRef(null),[c,d]=v.useState(!1),[u,p]=v.useState(""),h=v.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{src:"",type:"video",name:""}}},[e.value]),{src:w,type:k,name:b}=h,{mediaRef:y,isPlaying:g,currentTime:m,duration:x,volume:_,markers:S,togglePlay:P,stop:j,seek:M,changeVolume:D,addMarker:O,updateMarker:B,deleteMarker:E,deleteAllMarkers:I,handleTimeUpdate:N,handleLoadedMetadata:T,handleEnded:F}=fj(e.id,e.value,t),z=v.useCallback(()=>{a&&a()},[a]),G=v.useCallback(()=>{z(),P()},[z,P]),U=v.useCallback(()=>{z(),j()},[z,j]),R=v.useCallback($=>{z(),M($)},[z,M]),q=v.useCallback($=>{z(),D($)},[z,D]),H=v.useCallback(()=>{z(),O()},[z,O]),ne=v.useCallback(($,V)=>{z(),B($,V)},[z,B]),X=v.useCallback($=>{z(),E($)},[z,E]),re=v.useCallback(()=>{z(),I()},[z,I]);v.useEffect(()=>{if(!r||!w)return;const $=V=>{const J=V.target;if(J.tagName==="INPUT"||J.tagName==="TEXTAREA"||J.isContentEditable)return;const Y=.042;V.code==="KeyM"?(V.preventDefault(),V.stopPropagation(),O()):V.code==="ArrowLeft"?(V.preventDefault(),M(Math.max(0,m-Y))):V.code==="ArrowRight"?(V.preventDefault(),M(Math.min(x,m+Y))):V.code==="Space"&&(V.preventDefault(),P())};return window.addEventListener("keydown",$),()=>window.removeEventListener("keydown",$)},[r,w,m,x,O,M,P]);const{analyserRef:de,audioDataRef:ge}=xj(w,k,y.current),te=$=>{var J;const V=(J=$.target.files)==null?void 0:J[0];V&&ee(V),$.target&&($.target.value="")},le=$=>{var J;const V=(J=$.target.files)==null?void 0:J[0];V&&ie(V),$.target&&($.target.value="")},ee=$=>{const V=URL.createObjectURL($),J=$.type.startsWith("audio/")?"audio":"video";t(e.id,JSON.stringify({src:V,type:J,name:$.name,currentTime:0,volume:.4,isPlaying:!0,markers:[]}))},se=()=>{var ue;if(!u.trim())return;const $=u.trim(),V=(ue=$.split(".").pop())==null?void 0:ue.toLowerCase(),Y=["mp3","wav","ogg","m4a","aac","flac"].includes(V||"")?"audio":"video",ae=$.split("/").pop()||"Remote Media";t(e.id,JSON.stringify({src:$,type:Y,name:ae.length>30?ae.substring(0,30)+"...":ae,currentTime:0,volume:.4,isPlaying:!0,markers:[]})),p("")},ie=$=>{const V=URL.createObjectURL($),J=$.type.startsWith("audio/")?"audio":"video",Y=JSON.parse(e.value||"{}");t(e.id,JSON.stringify({...Y,src:V,type:J,name:$.name,currentTime:0,isPlaying:!0}))},oe=()=>{z(),y.current&&(y.current.pause(),y.current.removeAttribute("src"),y.current.load());const $=JSON.parse(e.value||"{}");t(e.id,JSON.stringify({...$,src:"",name:"",isPlaying:!1,currentTime:0})),setTimeout(()=>{var V;(V=s.current)==null||V.click()},100)},A=()=>{if(z(),!S||S.length===0)return;const $=JSON.stringify(S,null,2),V=new Blob([$],{type:"application/json"}),J=URL.createObjectURL(V),Y=document.createElement("a");Y.href=J;const ae=new Date().toISOString().slice(0,10);Y.download=`markers_${ae}.json`,Y.click(),URL.revokeObjectURL(J)},K=()=>{var $;z(),($=l.current)==null||$.click()},Z=$=>{var Y;const V=(Y=$.target.files)==null?void 0:Y[0];if(!V)return;const J=new FileReader;J.onload=ae=>{var ue;try{const he=(ue=ae.target)==null?void 0:ue.result,ye=JSON.parse(he);if(Array.isArray(ye)){const ve=JSON.parse(e.value||"{}");t(e.id,JSON.stringify({...ve,markers:ye}))}else console.error("Invalid markers file format")}catch(he){console.error("Failed to load markers",he)}},J.readAsText(V),$.target&&($.target.value="")},W=$=>{$.preventDefault(),$.stopPropagation(),d(!0)},Q=$=>{$.preventDefault(),$.stopPropagation(),d(!1)},ce=$=>{var J;$.preventDefault(),$.stopPropagation(),d(!1);const V=(J=$.dataTransfer.files)==null?void 0:J[0];if(V){if(V.type.startsWith("video/")||V.type.startsWith("audio/"))ee(V);else if(V.name.endsWith(".json")){const Y=new FileReader;Y.onload=ae=>{var ue;try{const he=(ue=ae.target)==null?void 0:ue.result,ye=JSON.parse(he);if(Array.isArray(ye)){const ve=JSON.parse(e.value||"{}");t(e.id,JSON.stringify({...ve,markers:ye}))}}catch{}},Y.readAsText(V)}}},fe=()=>{z(),y.current&&(y.current.pause(),y.current.src=""),t(e.id,JSON.stringify({src:"",type:"video",name:"",markers:[],volume:.4}))};return n.jsxs("div",{className:"flex flex-col h-full bg-gray-900 rounded-lg overflow-hidden",children:[n.jsx("input",{ref:i,type:"file",accept:"video/*,audio/*",className:"hidden",onChange:te}),n.jsx("input",{ref:s,type:"file",accept:"video/*,audio/*",className:"hidden",onChange:le}),n.jsx("input",{ref:l,type:"file",accept:".json",className:"hidden",onChange:Z}),n.jsx("div",{className:`flex-grow relative flex ${w?"bg-black":"bg-gray-800"} min-h-0 overflow-hidden group ${c?"ring-2 ring-cyan-500 bg-gray-800":""}`,onDragEnter:W,onDragOver:$=>{$.preventDefault(),$.stopPropagation(),d(!0)},onDragLeave:Q,onDrop:ce,children:w?k==="video"?n.jsxs(n.Fragment,{children:[n.jsx(kj,{src:w,mediaRef:y,onTimeUpdate:N,onLoadedMetadata:T,onEnded:F,onTogglePlay:G}),n.jsxs("div",{className:"absolute top-2 right-2 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity z-20",children:[n.jsx(Pe,{title:o("node.mediaViewer.relink"),onClick:$=>{$.stopPropagation(),oe()},className:"bg-black/50 hover:bg-black/70 p-1.5 rounded-full text-white cursor-pointer",tooltipPosition:"bottom",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),n.jsx(Pe,{title:o("node.action.clear"),onClick:$=>{$.stopPropagation(),fe()},className:"bg-black/50 hover:bg-black/70 p-1.5 rounded-full text-white cursor-pointer",tooltipPosition:"bottom",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}):n.jsx(Cj,{src:w,name:b,mediaRef:y,audioData:ge.current,analyser:de.current,currentTime:m,duration:x,isPlaying:g,volume:_,markers:S,onSeek:R,onVolumeChange:q,onTimeUpdate:N,onLoadedMetadata:T,onEnded:F,onClear:$=>{$&&$.stopPropagation(),fe()},onRelink:$=>{$&&$.stopPropagation(),oe()},onSelect:z,t:o}):n.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-4",children:[n.jsxs("div",{className:"flex flex-col items-center justify-center text-gray-500 cursor-pointer hover:text-gray-400 transition-colors mb-4",onClick:()=>{var $;return($=i.current)==null?void 0:$.click()},children:[n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 mx-auto mb-2 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),n.jsx("p",{className:"text-sm font-medium",children:o("node.content.dropMedia")})]}),n.jsx("div",{className:"w-1/2 h-px bg-gray-700 my-2"}),n.jsxs("div",{className:"w-full max-w-[80%] flex items-center space-x-1",children:[n.jsxs("div",{className:"flex-grow bg-gray-800 rounded-md border border-gray-600 flex items-center px-2 py-1 focus-within:border-cyan-500 focus-within:ring-1 focus-within:ring-cyan-500 transition-all",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),n.jsx("input",{type:"text",value:u,onChange:$=>p($.target.value),placeholder:"Paste URL...",className:"bg-transparent border-none text-xs text-white focus:outline-none w-full",onKeyDown:$=>{$.key==="Enter"&&se()},onMouseDown:$=>$.stopPropagation()})]}),n.jsx("button",{onClick:se,className:"p-1.5 bg-cyan-600 hover:bg-cyan-700 rounded-md text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:!u.trim(),title:"Load from URL",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]})]})}),w&&n.jsx(vj,{isPlaying:g,currentTime:m,duration:x,volume:_,markers:S,onTogglePlay:G,onStop:U,onSeek:R,onVolumeChange:q,onClear:fe,onAddMarker:H,onUpdateMarker:ne,onDeleteMarker:X,onDeleteAllMarkers:re,onSaveMarkers:A,onLoadMarkers:K,onSelect:z,disabled:!w,t:o})]})},Po=30,jo=20,ks=(e,t)=>{const o=[e];let r={...e},a=0;for(;(r.x!==t.x||r.y!==t.y)&&a<1e3;){a++;const i=t.x-r.x,s=t.y-r.y;let l={...r};Math.random()>.2?Math.abs(i)>Math.abs(s)?l.x+=Math.sign(i):l.y+=Math.sign(s):Math.abs(i)>Math.abs(s)?l.y+=Math.random()>.5?1:-1:l.x+=Math.random()>.5?1:-1,l.x=Math.max(0,Math.min(Po-1,l.x)),l.y=Math.max(0,Math.min(jo-1,l.y)),o.push(l),r=l}return o},Sj=()=>{const e={x:Math.floor(Po/2),y:Math.floor(jo/2)},t=ks({x:0,y:Math.floor(jo/2)},e),o=ks({x:Math.floor(Po/2),y:0},e),r=ks({x:Po-1,y:Math.floor(jo/2)},e),a=ks({x:Math.floor(Po/2),y:jo-1},e);return[t,o,r,a]},Nj=1500,Ej=2e3,l0=`&@/"'*?! :;*,....%$#`,Pj=e=>{const t={x:Math.floor(Po/2),y:Math.floor(jo/2)},o={grid:[],paths:[],dataUnits:[],enemies:[],towers:[],projectiles:[],score:0,bits:150,wordsQueue:[],storedData:[],totalWordsInitial:0,isLevelComplete:!1,isPaused:!0,centerPoint:t},r=v.useRef(o),[a,i]=v.useState({score:0,bits:150,isPaused:!0,isLevelComplete:!1}),s=v.useRef(0),l=v.useRef(0),c=v.useRef(0),d=v.useRef(0);v.useEffect(()=>{const g=Sj(),m=Array.from({length:jo},(x,_)=>Array.from({length:Po},(S,P)=>({x:P,y:_,isOccupied:!1})));r.current={...r.current,grid:m,paths:g}},[]),v.useEffect(()=>{const g=e.split(/\s+/).filter(m=>m.length>0);r.current.wordsQueue=g,r.current.totalWordsInitial=g.length,g.length>0&&(r.current.isLevelComplete=!1,r.current.storedData=[],i(m=>({...m,isLevelComplete:!1})))},[e]);const u=()=>{r.current.isPaused=!1,i(g=>({...g,isPaused:!1})),s.current=performance.now(),k()},p=()=>{r.current.isPaused=!0,i(g=>({...g,isPaused:!0})),d.current&&cancelAnimationFrame(d.current)},h=(g,m)=>{const x=r.current,_=x.paths.some(M=>M.some(D=>D.x===g&&D.y===m)),S=Math.abs(g-x.centerPoint.x),P=Math.abs(m-x.centerPoint.y),j=S<=1&&P<=1;x.bits>=50&&!x.grid[m][g].isOccupied&&!_&&!j&&(x.bits-=50,x.grid[m][g].isOccupied=!0,x.towers.push({id:`tower-${Date.now()}`,x:g,y:m,range:6,damage:3,cooldown:400,lastShotTime:0,color:"#22d3ee"}),i(M=>({...M,bits:x.bits})))},w=g=>{if(!g)return"ERR";const m=g.length;let x="";for(let _=0;_<m;_++)x+=l0.charAt(Math.floor(Math.random()*l0.length));return x},k=()=>{if(r.current.isPaused)return;const g=performance.now(),m=g-s.current;s.current=g,b(m,g),d.current=requestAnimationFrame(k)},b=(g,m)=>{const x=r.current;if(x.wordsQueue.length===0&&x.dataUnits.length===0&&!x.isLevelComplete&&x.totalWordsInitial>0){x.isLevelComplete=!0,x.isPaused=!0,i(_=>({..._,isLevelComplete:!0,isPaused:!0}));return}if(x.wordsQueue.length>0&&m-l.current>Nj){const _=x.wordsQueue.shift();_&&(x.dataUnits.push({id:`data-${Date.now()}`,word:_,pathIndex:0,progress:0,hp:20,maxHp:20,speed:2,isDead:!1,reachedBase:!1,color:"#06b6d4"}),l.current=m)}if((x.dataUnits.length>0||x.wordsQueue.length>0)&&m-c.current>Ej){const _=Math.floor(Math.random()*3)+1;x.enemies.push({id:`enemy-${Date.now()}`,pathIndex:_,progress:0,hp:8,maxHp:8,speed:2.5,reachedBase:!1,isDead:!1,damage:0,color:"#ef4444"}),c.current=m}x.dataUnits.forEach(_=>{if(_.isDead||_.reachedBase)return;const S=x.paths[_.pathIndex];_.progress+=_.speed*g/1e3,_.progress>=S.length-1&&(_.reachedBase=!0,x.score+=20,x.bits+=15,x.storedData.push(_.word),i(P=>({...P,score:x.score,bits:x.bits})))}),x.enemies.forEach(_=>{if(_.isDead||_.reachedBase)return;const S=x.paths[_.pathIndex];if(_.progress+=_.speed*g/1e3,_.progress>=S.length-1&&(_.reachedBase=!0,x.storedData.length>0)){const P=Math.floor(Math.random()*x.storedData.length),j=x.storedData[P];x.storedData[P]=w(j)}}),x.towers.forEach(_=>{if(m-_.lastShotTime>_.cooldown){let S,P=1/0;x.enemies.forEach(j=>{if(j.isDead||j.reachedBase)return;const M=x.paths[j.pathIndex],D=Math.floor(j.progress),O=M[D]||M[M.length-1],B=Math.hypot(O.x-_.x,O.y-_.y);B<=_.range&&B<P&&(P=B,S=j)}),S&&(x.projectiles.push({id:`proj-${Date.now()}-${Math.random()}`,x:_.x,y:_.y,targetId:S.id,targetType:"enemy",speed:15,damage:_.damage,color:"#fef08a"}),_.lastShotTime=m)}}),x.projectiles.forEach(_=>{const S=x.enemies.find(I=>I.id===_.targetId);if(!S||S.isDead||S.reachedBase){_.damage=0;return}const P=x.paths[S.pathIndex],j=Math.floor(S.progress),M=P[j]||P[P.length-1],D=M.x-_.x,O=M.y-_.y,B=Math.hypot(D,O),E=_.speed*g/1e3;B<=E?(S.hp-=_.damage,S.hp<=0&&(S.isDead=!0,x.bits+=5,x.score+=5,i(I=>({...I,bits:x.bits,score:x.score}))),_.damage=0):(_.x+=D/B*E,_.y+=O/B*E)}),x.dataUnits=x.dataUnits.filter(_=>!_.isDead&&!_.reachedBase),x.enemies=x.enemies.filter(_=>!_.isDead&&!_.reachedBase),x.projectiles=x.projectiles.filter(_=>_.damage>0)};return{gameStateRef:r,uiState:a,startGame:u,pauseGame:p,buildTower:h,getFinalText:()=>r.current.storedData.join(" ")}},jj=({gameStateRef:e,onCellClick:t})=>{const o=v.useRef(null),r=v.useRef(null),a=()=>{const s=o.current;if(!s)return;const l=s.getContext("2d");if(!l)return;const c=e.current;l.clearRect(0,0,s.width,s.height);const d=s.width,u=s.height,p=d/Po,h=u/jo;l.strokeStyle="rgba(255,255,255,0.03)",l.lineWidth=1;for(let m=0;m<=Po;m++)l.beginPath(),l.moveTo(m*p,0),l.lineTo(m*p,u),l.stroke();for(let m=0;m<=jo;m++)l.beginPath(),l.moveTo(0,m*h),l.lineTo(d,m*h),l.stroke();c.paths.forEach((m,x)=>{if(m.length===0)return;l.beginPath(),l.strokeStyle=x===0?"rgba(34, 211, 238, 0.2)":"rgba(239, 68, 68, 0.2)",l.lineWidth=p*.4,l.lineCap="round",l.lineJoin="round";const _=m[0];l.moveTo((_.x+.5)*p,(_.y+.5)*h);for(let S=1;S<m.length;S++){const P=m[S];l.lineTo((P.x+.5)*p,(P.y+.5)*h)}l.stroke()});const w=(c.centerPoint.x+.5)*p,k=(c.centerPoint.y+.5)*h,b=p*1.5,y=l.createRadialGradient(w,k,b*.2,w,k,b);y.addColorStop(0,"rgba(6, 182, 212, 0.8)"),y.addColorStop(.6,"rgba(16, 185, 129, 0.4)"),y.addColorStop(1,"rgba(0,0,0,0)"),l.fillStyle=y,l.beginPath(),l.arc(w,k,b,0,Math.PI*2),l.fill(),l.strokeStyle="#fff",l.lineWidth=2,l.beginPath(),l.arc(w,k,b*.5,0,Math.PI*2),l.stroke(),c.towers.forEach(m=>{l.fillStyle=m.color,l.fillRect(m.x*p+2,m.y*h+2,p-4,h-4),l.fillStyle="#fff",l.fillRect(m.x*p+p/2-2,m.y*h+h/2-2,4,4)});const g=(m,x,_,S)=>{const P=c.paths[m];if(!P)return;const j=Math.floor(x),M=P[j]||P[P.length-1],D=P[j+1]||M,O=x-j,B=M.x+(D.x-M.x)*O,E=M.y+(D.y-M.y)*O,I=(B+.5)*p,N=(E+.5)*h;l.fillStyle=_,l.beginPath(),l.arc(I,N,p*.3,0,Math.PI*2),l.fill(),l.fillStyle="red",l.fillRect(I-p*.3,N-h*.5,p*.6,3),l.fillStyle="#10b981",l.fillRect(I-p*.3,N-h*.5,p*.6*S,3)};c.dataUnits.forEach(m=>g(m.pathIndex,m.progress,m.color,m.hp/m.maxHp)),c.enemies.forEach(m=>g(m.pathIndex,m.progress,m.color,m.hp/m.maxHp)),c.projectiles.forEach(m=>{l.fillStyle=m.color,l.beginPath(),l.arc((m.x+.5)*p,(m.y+.5)*h,3,0,Math.PI*2),l.fill()}),r.current=requestAnimationFrame(a)};v.useEffect(()=>(r.current=requestAnimationFrame(a),()=>{r.current&&cancelAnimationFrame(r.current)}),[]);const i=s=>{const l=o.current;if(!l)return;const c=l.getBoundingClientRect(),d=s.clientX-c.left,u=s.clientY-c.top,p=l.width/Po,h=l.height/jo,w=l.width/c.width,k=l.height/c.height,b=Math.floor(d*w/p),y=Math.floor(u*k/h);t(b,y)};return n.jsx("canvas",{ref:o,width:900,height:600,className:"w-full h-full bg-gray-900 cursor-crosshair",onClick:i})},Tj=({score:e,bits:t,isPaused:o,onTogglePause:r,t:a})=>n.jsxs("div",{className:"absolute top-2 left-2 right-2 flex justify-between items-start pointer-events-none",children:[n.jsxs("div",{className:"bg-gray-800/80 backdrop-blur rounded p-2 border border-gray-600 shadow-lg pointer-events-auto flex flex-col gap-1",children:[n.jsxs("div",{className:"text-cyan-400 font-bold text-lg",children:["Score: ",e]}),n.jsxs("div",{className:"text-yellow-400 font-mono text-sm",children:["Bits: ",t]})]}),n.jsx("div",{className:"pointer-events-auto",children:n.jsx("button",{onClick:r,className:`px-4 py-2 rounded font-bold text-white shadow-lg transition-colors ${o?"bg-emerald-600 hover:bg-emerald-700":"bg-red-600 hover:bg-red-700"}`,children:o?"START / RESUME":"PAUSE"})}),n.jsxs("div",{className:"bg-gray-800/80 backdrop-blur rounded p-2 border border-gray-600 shadow-lg text-xs text-gray-300 max-w-[150px]",children:[n.jsx("p",{children:"Click on empty cells to build towers (50 Bits)."}),n.jsx("p",{children:"Protect the blue circles!"})]})]}),Ij=({node:e,onValueChange:t,t:o,getUpstreamNodeValues:r})=>{const a=v.useMemo(()=>r(e.id).filter(k=>typeof k=="string").join(" "),[r,e.id]),{gameStateRef:i,uiState:s,startGame:l,pauseGame:c,buildTower:d,getFinalText:u}=Pj(a),p=()=>{const h=u();try{const w=JSON.parse(e.value||"{}");t(e.id,JSON.stringify({...w,outputText:h}))}catch{t(e.id,JSON.stringify({outputText:h}))}};return n.jsxs("div",{className:"relative w-full h-full bg-gray-900 rounded-md overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"flex-grow relative group",children:[n.jsx(jj,{gameStateRef:i,onCellClick:d}),n.jsx(Tj,{score:s.score,bits:s.bits,isPaused:s.isPaused,onTogglePause:()=>s.isPaused?l():c(),t:o}),s.isLevelComplete&&n.jsxs("div",{className:"absolute inset-0 flex items-center justify-center z-20 pointer-events-auto",children:[n.jsx("div",{className:"bg-black/60 absolute inset-0 backdrop-blur-sm"}),n.jsxs("div",{className:"relative flex flex-col items-center gap-4 p-6 bg-gray-800 rounded-xl border-2 border-cyan-500 shadow-[0_0_50px_rgba(6,182,212,0.4)] animate-fade-in-up",children:[n.jsx("h2",{className:"text-2xl font-bold text-white uppercase tracking-widest",children:"Transmission Complete"}),n.jsxs("div",{className:"text-gray-300 text-sm",children:["Integrity: ",n.jsxs("span",{className:"text-cyan-400 font-mono",children:[Math.floor(s.score/(i.current.totalWordsInitial*20)*100),"%"]})]}),n.jsx("button",{onClick:p,className:"px-8 py-3 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-bold rounded-lg shadow-lg transform hover:scale-105 transition-all",children:"GENERATE OUTPUT"})]})]})]}),n.jsxs("div",{className:"h-6 bg-gray-800 border-t border-gray-700 flex items-center px-2 text-[10px] text-gray-400 justify-between shrink-0",children:[n.jsxs("span",{children:["Input: ",a.length>20?a.substring(0,20)+"...":a?`${a.length} chars`:"No Data"]}),n.jsxs("span",{children:["Status: ",s.isLevelComplete?"Complete":s.isPaused?"Paused":"Active"]})]})]})},id=[{id:0,name:"Nose",x:.5,y:.15,color:"#ff0000"},{id:1,name:"Neck",x:.5,y:.25,color:"#ff5500",isFixed:!0},{id:2,name:"RShoulder",x:.4,y:.25,color:"#ffaa00",parent:1},{id:3,name:"RElbow",x:.35,y:.4,color:"#ffff00",parent:2},{id:4,name:"RWrist",x:.3,y:.55,color:"#aaff00",parent:3},{id:5,name:"LShoulder",x:.6,y:.25,color:"#55ff00",parent:1},{id:6,name:"LElbow",x:.65,y:.4,color:"#00ff00",parent:5},{id:7,name:"LWrist",x:.7,y:.55,color:"#00ff55",parent:6},{id:8,name:"RHip",x:.45,y:.55,color:"#00ffaa",parent:1},{id:9,name:"RKnee",x:.45,y:.75,color:"#00ffff",parent:8},{id:10,name:"RAnkle",x:.45,y:.95,color:"#00aaff",parent:9},{id:11,name:"LHip",x:.55,y:.55,color:"#0055ff",parent:1},{id:12,name:"LKnee",x:.55,y:.75,color:"#0000ff",parent:11},{id:13,name:"LAnkle",x:.55,y:.95,color:"#5500ff",parent:12},{id:14,name:"REye",x:.48,y:.13,color:"#aa00ff",parent:0},{id:15,name:"LEye",x:.52,y:.13,color:"#ff00ff",parent:0},{id:16,name:"REar",x:.45,y:.14,color:"#ff00aa",parent:14},{id:17,name:"LEar",x:.55,y:.14,color:"#ff0055",parent:15}],Aj=[{from:1,to:2,color:"#ffaa00"},{from:2,to:3,color:"#ffff00"},{from:3,to:4,color:"#aaff00"},{from:1,to:5,color:"#55ff00"},{from:5,to:6,color:"#00ff00"},{from:6,to:7,color:"#00ff55"},{from:1,to:8,color:"#00ffaa"},{from:8,to:9,color:"#00ffff"},{from:9,to:10,color:"#00aaff"},{from:1,to:11,color:"#0055ff"},{from:11,to:12,color:"#0000ff"},{from:12,to:13,color:"#5500ff"},{from:1,to:0,color:"#ff5500"},{from:0,to:14,color:"#aa00ff"},{from:14,to:16,color:"#ff00aa"},{from:0,to:15,color:"#ff00ff"},{from:15,to:17,color:"#ff0055"}],Mj=(e,t,o=5)=>{if(e.length<2)return e;const r=[];for(let l=0;l<e.length-1;l++)r.push(Math.hypot(e[l+1].x-e[l].x,e[l+1].y-e[l].y));const a={x:e[0].x,y:e[0].y},i=r.reduce((l,c)=>l+c,0);if(Math.hypot(t.x-a.x,t.y-a.y)>i){for(let l=0;l<e.length-1;l++){const c=t.x-e[l].x,d=t.y-e[l].y,u=Math.hypot(c,d),p=r[l]/u;e[l+1].x=e[l].x+c*p,e[l+1].y=e[l].y+d*p}return e}for(let l=0;l<o;l++){e[e.length-1].x=t.x,e[e.length-1].y=t.y;for(let c=e.length-2;c>=0;c--){const d=e[c].x-e[c+1].x,u=e[c].y-e[c+1].y,p=Math.hypot(d,u),h=r[c]/p;e[c].x=e[c+1].x+d*h,e[c].y=e[c+1].y+u*h}e[0].x=a.x,e[0].y=a.y;for(let c=0;c<e.length-1;c++){const d=e[c+1].x-e[c].x,u=e[c+1].y-e[c].y,p=Math.hypot(d,u),h=r[c]/p;e[c+1].x=e[c].x+d*h,e[c+1].y=e[c].y+u*h}}return e},Rj=({node:e,onValueChange:t,t:o,onSelectNode:r,addToast:a,onDownloadImageFromUrl:i,onCopyImageToClipboard:s})=>{const l=v.useRef(null),c=v.useRef(null),d=v.useRef(null),u=v.useMemo(()=>{try{const T=JSON.parse(e.value||"{}");return{joints:T.joints&&T.joints.length>0?T.joints:JSON.parse(JSON.stringify(id)),aspectRatio:T.aspectRatio||"1:1",resolution:T.resolution||"1K",renderedImage:T.renderedImage||null,aiPrompt:T.aiPrompt||""}}catch{return{joints:JSON.parse(JSON.stringify(id)),aspectRatio:"1:1",resolution:"1K",renderedImage:null,aiPrompt:""}}},[e.value]),[p,h]=v.useState(u.joints),[w,k]=v.useState(null),[b,y]=v.useState(!1);v.useEffect(()=>{h(u.joints)},[u.joints]);const g=(T,F,z)=>{const G={...u,...z,joints:T,renderedImage:F!==void 0?F:u.renderedImage};t(e.id,JSON.stringify(G))},m=async()=>{if(!(!u.aiPrompt.trim()||b)){y(!0);try{const T=Ql();if(!T)throw new Error("API Key is missing. Please check settings.");const z=await new Rp({apiKey:T}).models.generateContent({model:"gemini-3-flash-preview",contents:`Generate a 2D character pose for the following description: "${u.aiPrompt}".
                
                The rig uses 18 joints (0-17): 0:Nose, 1:Neck, 2:RShoulder, 3:RElbow, 4:RWrist, 5:LShoulder, 6:LElbow, 7:LWrist, 8:RHip, 9:RKnee, 10:RAnkle, 11:LHip, 12:LKnee, 13:LAnkle, 14:REye, 15:LEye, 16:REar, 17:LEar.
                
                Coordinates x and y must be between 0.0 (top/left) and 1.0 (bottom/right).
                Make sure the pose is dynamic, anatomically plausible, and fits within the 0-1 range.`,config:{responseMimeType:"application/json",responseSchema:{type:gt.OBJECT,properties:{joints:{type:gt.ARRAY,items:{type:gt.OBJECT,properties:{id:{type:gt.INTEGER},name:{type:gt.STRING},x:{type:gt.NUMBER},y:{type:gt.NUMBER},color:{type:gt.STRING}},required:["id","x","y"]}}},required:["joints"]}}}),G=JSON.parse(z.text||"{}");if(G.joints&&Array.isArray(G.joints)){const U=p.map(R=>{const q=G.joints.find(H=>H.id===R.id);return q?{...R,x:q.x,y:q.y}:R});h(U),g(U),a==null||a("AI Pose Generated","success")}}catch(T){console.error("AI Pose Generation failed:",T),a==null||a("AI Generation failed","error")}finally{y(!1)}}},x=(T,F,z,G=!1)=>{T.fillStyle="black",T.fillRect(0,0,F,z),Aj.forEach(U=>{const R=p.find(H=>H.id===U.from),q=p.find(H=>H.id===U.to);R&&q&&(T.beginPath(),T.strokeStyle=U.color,T.lineWidth=G?6:2,T.moveTo(R.x*F,R.y*z),T.lineTo(q.x*F,q.y*z),T.stroke())}),G||p.forEach(U=>{T.beginPath(),T.fillStyle=U.color,T.arc(U.x*F,U.y*z,w===U.id?8:5,0,Math.PI*2),T.fill(),T.strokeStyle="white",T.lineWidth=1,T.stroke()})};v.useEffect(()=>{var G;const T=l.current;if(!T)return;const F=T.getContext("2d");if(!F)return;const z=(G=T.parentElement)==null?void 0:G.getBoundingClientRect();z&&(T.width=z.width,T.height=z.height),x(F,T.width,T.height)},[p,w]);const _=T=>{T.stopPropagation(),r&&r();const F=l.current;if(!F)return;const z=F.getBoundingClientRect(),G=(T.clientX-z.left)/F.width,U=(T.clientY-z.top)/F.height,R=.05,q=p.find(H=>Math.hypot(H.x-G,H.y-U)<R);q&&k(q.id)},S=T=>{if(w===null)return;const F=l.current;if(!F)return;const z=F.getBoundingClientRect(),G=(T.clientX-z.left)/F.width,U=(T.clientY-z.top)/F.height,R=[...p],q=R.find(ne=>ne.id===w);if(!q)return;if([4,7,10,13].includes(w)){let ne=[];w===4?ne=[1,2,3,4]:w===7?ne=[1,5,6,7]:w===10?ne=[1,8,9,10]:w===13&&(ne=[1,11,12,13]);const X=ne.map(re=>R.find(de=>de.id===re));Mj(X,{x:G,y:U})}else q.x=G,q.y=U;h(R)},P=()=>{w!==null&&(k(null),g(p))},j=()=>{const T=document.createElement("canvas"),z={"720p":1280,"1080p":1920,"1K":1024,"2K":2048,"4K":4096}[u.resolution]||1024,[G,U]=u.aspectRatio.split(":").map(Number),R=G/U;let q=z,H=z;R>1?H=z/R:q=z*R,T.width=q,T.height=H;const ne=T.getContext("2d");if(ne){x(ne,q,H,!0);const X=T.toDataURL("image/png");g(p,X),a&&a("Pose Rendered","success")}},M=()=>{const T=JSON.parse(JSON.stringify(id));h(T),g(T,null)},D=()=>{var T;(T=d.current)==null||T.click()},O=T=>{var G;const F=(G=T.target.files)==null?void 0:G[0];if(!F)return;const z=new FileReader;z.onload=U=>{var R;try{const q=(R=U.target)==null?void 0:R.result,H=JSON.parse(q);if(H.joints&&Array.isArray(H.joints))h(H.joints),t(e.id,JSON.stringify({...u,...H})),a&&a("Pose Loaded","success");else throw new Error("Invalid pose format")}catch{a&&a("Failed to load pose: Invalid JSON","error")}},z.readAsText(F),T.target&&(T.target.value="")},B=T=>{T.stopPropagation(),u.renderedImage&&i&&i(u.renderedImage,0,"Pose Reference")},E=T=>{T.stopPropagation(),u.renderedImage&&s&&s(u.renderedImage)},I=["1:1","16:9","9:16","4:3","3:4"],N=["720p","1080p","1K","2K","4K"];return n.jsxs("div",{className:"flex flex-col h-full bg-gray-900 rounded-lg overflow-hidden",onWheel:T=>T.stopPropagation(),children:[n.jsx("input",{type:"file",ref:d,className:"hidden",accept:".json",onChange:O}),n.jsxs("div",{className:"p-2 bg-gray-800 border-b border-gray-700 flex gap-2 shrink-0",children:[n.jsx("input",{type:"text",value:u.aiPrompt,onChange:T=>g(p,void 0,{aiPrompt:T.target.value}),onKeyDown:T=>{T.key==="Enter"&&m()},placeholder:"Describe pose (e.g. 'Hero landing', 'Sitting on a bench')...",className:"flex-grow bg-gray-900 border border-gray-600 rounded px-2 py-1 text-xs text-white focus:border-cyan-500 outline-none",onMouseDown:T=>T.stopPropagation()}),n.jsx("button",{onClick:m,disabled:b||!u.aiPrompt.trim(),className:"px-3 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-700 rounded text-xs font-bold flex items-center gap-1.5 transition-colors shrink-0",children:b?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):" AI"})]}),n.jsxs("div",{className:"p-2 border-b border-gray-700 flex justify-between items-center bg-gray-800 gap-2 shrink-0",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsx("div",{className:"w-24",children:n.jsx(Rn,{value:u.aspectRatio,onChange:T=>t(e.id,JSON.stringify({...u,aspectRatio:T})),options:I.map(T=>({value:T,label:T}))})}),n.jsx("div",{className:"w-24",children:n.jsx(Rn,{value:u.resolution,onChange:T=>t(e.id,JSON.stringify({...u,resolution:T})),options:N.map(T=>({value:T,label:T}))})})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[u.renderedImage&&n.jsxs(n.Fragment,{children:[n.jsx(Pe,{title:o("node.action.copy"),onClick:E,children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Pe,{title:o("node.action.download"),onClick:B,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-700 mx-1"})]}),n.jsx("button",{onClick:D,className:"p-2 bg-gray-700 hover:bg-gray-600 rounded text-xs text-gray-300",children:"Load"}),n.jsx("button",{onClick:M,className:"p-2 bg-gray-700 hover:bg-gray-600 rounded text-xs text-gray-300",children:"Reset"}),n.jsx("button",{onClick:j,className:"p-2 bg-cyan-600 hover:bg-cyan-700 rounded text-xs font-bold text-white uppercase tracking-wider",children:"Render"})]})]}),n.jsxs("div",{ref:c,className:"flex-grow relative bg-black min-h-0",children:[n.jsx("canvas",{ref:l,className:"w-full h-full cursor-crosshair block",onMouseDown:_,onMouseMove:S,onMouseUp:P,onMouseLeave:P}),u.renderedImage&&n.jsx("div",{className:"absolute bottom-2 left-2 w-24 h-24 border border-gray-600 rounded overflow-hidden shadow-lg bg-black pointer-events-none group-hover:w-48 group-hover:h-48 transition-all duration-300",children:n.jsx("img",{src:u.renderedImage,alt:"Rendered",className:"w-full h-full object-contain"})})]}),n.jsx("div",{className:"p-1.5 bg-gray-800 border-t border-gray-700 flex items-center justify-center gap-4 shrink-0",children:n.jsx("span",{className:"text-[10px] text-gray-500 font-bold uppercase tracking-widest",children:"Inverse Kinematics: Draggable Wrists & Ankles"})})]})},Lj=({value:e,onDebouncedChange:t,debounceTime:o=300,onChange:r,...a})=>{const[i,s]=v.useState(e),l=v.useRef(null),c=v.useRef(!1);v.useEffect(()=>{!c.current&&e!==i&&s(e)},[e]);const d=p=>{const h=p.target.value;s(h),c.current=!0,l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{t(h),c.current=!1},o),r&&r(p)},u=p=>{l.current&&(clearTimeout(l.current),t(i),c.current=!1),a.onBlur&&a.onBlur(p)};return n.jsx("input",{...a,value:i,onChange:d,onBlur:u})},Dj=({width:e,height:t})=>{const o=e/t;let r="",a="";return o>1.2?(r="M2 6h20v12H2z",a="Landscape"):o<.85?(r="M6 2h12v20H6z",a="Portrait"):(r="M4 4h16v16H4z",a="Square"),n.jsx("div",{className:"bg-black/60 rounded-tl-md px-1.5 py-1 flex items-center justify-center",title:a,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white/90",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:r})})})},zj=({concept:e,displayImage:t,fullResImage:o,isReadOnly:r,onUpdate:a,onDelete:i,onMoveUp:s,onMoveDown:l,isFirst:c,isLast:d,onDetach:u,onViewImage:p,t:h,hasError:w})=>{const k=v.useRef(null),[b,y]=v.useState(!1),[g,m]=v.useState(null),x=B=>{var I;const E=(I=B.target.files)==null?void 0:I[0];if(E){const N=new FileReader;N.onload=T=>{var F;(F=T.target)!=null&&F.result&&a({image:T.target.result})},N.readAsDataURL(E)}B.target&&(B.target.value="")},_=B=>{e.isConnected||(B.preventDefault(),B.stopPropagation(),y(!0))},S=B=>{e.isConnected||(B.preventDefault(),B.stopPropagation(),y(!1))},P=B=>{e.isConnected||(B.preventDefault(),B.stopPropagation(),y(!0))},j=B=>{var N;if(e.isConnected)return;B.preventDefault(),B.stopPropagation(),y(!1);const E=B.dataTransfer.getData("application/prompt-modifier-drag-image");if(E){E.startsWith("data:")?a({image:E}):fetch(E).then(T=>T.blob()).then(T=>{const F=new FileReader;F.onload=z=>{var G;(G=z.target)!=null&&G.result&&a({image:z.target.result})},F.readAsDataURL(T)});return}const I=(N=B.dataTransfer.files)==null?void 0:N[0];if(I&&I.type.startsWith("image/")){const T=new FileReader;T.onload=F=>{var z;(z=F.target)!=null&&z.result&&a({image:F.target.result})},T.readAsDataURL(I)}},M=B=>{var I;B.stopPropagation();const E=o||t;E?p(E):e.isConnected||(I=k.current)==null||I.click()},D=B=>{B.stopPropagation(),a({image:null}),m(null)},O=B=>{const E=o||t;E&&(B.dataTransfer.setData("application/prompt-modifier-drag-image",E),B.dataTransfer.effectAllowed="copy",B.stopPropagation())};return n.jsxs("div",{className:`bg-gray-800 rounded-lg p-2 flex flex-col h-full border-2 ${w?"border-red-500":"border-gray-700"} w-full`,children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:`text-xs font-bold ${w?"text-red-500 animate-pulse":"text-gray-400"} truncate`,title:e.id,children:e.id}),n.jsxs("div",{className:"flex items-center space-x-1",children:[e.isConnected&&n.jsx(Pe,{title:"Detach",tooltipPosition:"left",onClick:B=>{B.stopPropagation(),u()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("button",{onClick:B=>{B.stopPropagation(),s()},disabled:c,className:"text-gray-500 hover:text-white disabled:opacity-30",children:n.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),n.jsx("button",{onClick:B=>{B.stopPropagation(),l()},disabled:d,className:"text-gray-500 hover:text-white disabled:opacity-30",children:n.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),!e.isConnected&&n.jsx(Pe,{title:h("node.action.delete"),tooltipPosition:"left",onClick:B=>{B.stopPropagation(),i()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-h-0",children:[n.jsxs("div",{className:`aspect-square bg-gray-900 rounded flex items-center justify-center overflow-hidden relative group flex-shrink-0 cursor-pointer transition-all ${b?"ring-2 ring-cyan-400 bg-gray-800":"hover:ring-1 hover:ring-cyan-500"}`,onClick:M,onDragEnter:_,onDragOver:P,onDragLeave:S,onDrop:j,title:t?"Click to View":"Click to Upload or Drop Image",children:[t?n.jsxs(n.Fragment,{children:[n.jsx("img",{src:t,alt:e.name,className:"w-full h-full object-cover",draggable:!0,onDragStart:O,onLoad:B=>m({width:B.currentTarget.naturalWidth,height:B.currentTarget.naturalHeight})}),!e.isConnected&&n.jsx("div",{className:"absolute top-1 right-1",children:n.jsx(Pe,{title:h("node.action.clear"),onClick:D,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white drop-shadow-md",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})}),g&&n.jsx("div",{className:"absolute bottom-0 right-0 pointer-events-none z-10",children:n.jsx(Dj,{width:g.width,height:g.height})})]}):n.jsx("div",{className:"text-gray-600 text-xs text-center px-1 pointer-events-none",children:e.isConnected?"No Image":"Drop or Click"}),n.jsx("input",{ref:k,type:"file",className:"hidden",accept:"image/*",onChange:x})]}),n.jsxs("div",{className:"space-y-1 flex-grow flex flex-col min-h-0",children:[n.jsx(Lj,{value:e.name,onDebouncedChange:B=>a({name:B}),className:"w-full bg-gray-900 text-xs text-white p-1 rounded border border-gray-700 focus:outline-none focus:border-cyan-500",placeholder:"Name",readOnly:r}),n.jsx(Tn,{value:e.prompt,onDebouncedChange:B=>a({prompt:B}),className:"w-full flex-grow bg-gray-900 text-xs text-gray-300 p-1 rounded border border-gray-700 focus:outline-none focus:border-cyan-500 resize-none custom-scrollbar",placeholder:"Appearance prompt...",readOnly:r})]})]})]})},qj=({allConcepts:e,onUpdateConcept:t,onDeleteConcept:o,onMoveConcept:r,onAddConcept:a,onDetachConnectedConcept:i,onClearConcepts:s,handleViewImage:l,t:c,deselectAllNodes:d,conceptsMode:u="normal",onToggleMode:p,duplicateIndices:h=new Set})=>{const[w,k]=v.useState(!1),b=x=>{x.preventDefault(),x.stopPropagation(),k(!0)},y=x=>{x.preventDefault(),x.stopPropagation(),k(!1),a()},g=x=>{p&&p(u==="collapsed"?"normal":"collapsed")},m=e.findIndex(x=>!x.isConnected);return n.jsxs("div",{className:"flex-shrink-0 flex flex-col h-full bg-gray-900/30 rounded-t-md overflow-hidden",children:[n.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-800/80 border-b border-gray-700 select-none cursor-pointer hover:bg-gray-700/80 transition-colors",onClick:g,title:"Click to toggle collapse",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs("h3",{className:`text-sm font-bold ${h.size>0?"text-red-400":"text-gray-300"} flex-shrink-0`,children:[c("node.content.characterConcepts"),h.size>0&&n.jsx("span",{className:"ml-2 text-[10px] bg-red-900/40 px-1 rounded uppercase",children:"  "})]}),n.jsx("div",{onClick:x=>x.stopPropagation(),children:n.jsx(Pe,{title:"Clear All (Local & Connected)",onClick:s,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]}),p&&n.jsxs("div",{className:"flex items-center space-x-1",onClick:x=>x.stopPropagation(),children:[u==="expanded"?n.jsx("button",{onClick:()=>p("normal"),className:"p-1 text-gray-400 hover:text-white rounded hover:bg-gray-700 transition-colors",title:"Restore size",children:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("path",{d:"M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"})})}):n.jsx("button",{onClick:()=>p("expanded"),className:"p-1 text-gray-400 hover:text-white rounded hover:bg-gray-700 transition-colors",title:"Expand to full height",children:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("path",{d:"M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"})})}),u==="collapsed"?n.jsx("button",{onClick:()=>p("normal"),className:"p-1 text-gray-400 hover:text-white rounded hover:bg-gray-700 transition-colors",title:"Expand Panel",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}):n.jsx("button",{onClick:()=>p("collapsed"),className:"p-1 text-gray-400 hover:text-white rounded hover:bg-gray-700 transition-colors",title:"Collapse Panel",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]})]}),u!=="collapsed"&&n.jsxs("div",{className:"bg-gray-900/50 p-2 overflow-y-auto grid gap-2 custom-scrollbar flex-grow min-h-0",style:{gridTemplateColumns:"repeat(auto-fill, 240px)",gridAutoRows:"340px",justifyContent:"start"},onWheel:x=>x.stopPropagation(),children:[e.map((x,_)=>{const S=h.has((x.id||"").trim());return n.jsx("div",{className:"h-full w-full",children:n.jsx(zj,{concept:{id:x.id,name:x.name,prompt:x.prompt,image:x.image,fullDescription:x.fullDescription,isConnected:x.isConnected},displayImage:x.image,fullResImage:x._fullResImage||x.image,isReadOnly:!1,onUpdate:P=>t(_,P,x.isConnected,x.uniqueKey),onDelete:()=>o(_),onMoveUp:()=>r(_,"up"),onMoveDown:()=>r(_,"down"),isFirst:_===0||_===m&&!x.isConnected,isLast:_===e.length-1,onDetach:()=>i(x),onViewImage:l,t:c,hasError:S})},x.uniqueKey||_)}),n.jsx("button",{onClick:a,onDragEnter:b,onDragOver:x=>{x.preventDefault(),x.stopPropagation(),k(!0)},onDragLeave:()=>k(!1),onDrop:y,className:`h-[340px] bg-gray-700 hover:bg-gray-600 rounded-md flex items-center justify-center text-gray-400 text-4xl transition-all ${w?"ring-2 ring-cyan-400":""}`,children:"+"})]})]})},Pl=({value:e,onDebouncedChange:t,debounceTime:o=300,className:r="",style:a,...i})=>{const[s,l]=v.useState(e),c=v.useRef(null),d=v.useRef(null),u=v.useRef(null),p=v.useRef(!1);v.useEffect(()=>{!p.current&&e!==s&&l(e)},[e]);const h=b=>{const y=b.target.value;l(y),p.current=!0,c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{t(y),p.current=!1},o),i.onChange&&i.onChange(b)},w=()=>{d.current&&u.current&&(u.current.scrollTop=d.current.scrollTop,u.current.scrollLeft=d.current.scrollLeft)};v.useEffect(()=>{if(!d.current||!u.current)return;const b=()=>{const g=d.current,m=u.current;if(g&&m){const x=window.getComputedStyle(g),_=parseFloat(x.borderLeftWidth)||0,S=parseFloat(x.borderRightWidth)||0,P=g.offsetWidth-g.clientWidth-_-S;if(P>0){const j=parseFloat(x.paddingRight)||0;m.style.paddingRight=`${j+P}px`}else m.style.removeProperty("padding-right")}},y=new ResizeObserver(b);return y.observe(d.current),d.current.addEventListener("input",b),()=>{y.disconnect(),d.current&&d.current.removeEventListener("input",b)}},[]);const k=b=>b.split(/(\[(?:Entity|Character)-[^\]]+\])/g).map((g,m)=>g.match(/^\[(?:Entity|Character)-[^\]]+\]$/)?n.jsx("span",{className:"text-connection-text",children:g},m):n.jsx("span",{children:g},m));return n.jsxs("div",{className:"relative w-full h-full group/highlighter",style:a,children:[n.jsx("div",{ref:u,className:`absolute inset-0 pointer-events-none whitespace-pre-wrap break-words overflow-hidden text-transparent ${r}`,style:{color:"transparent",zIndex:0,borderColor:"transparent"},"aria-hidden":"true",children:n.jsxs("div",{className:"text-gray-200",style:{width:"100%",height:"100%"},children:[k(s),s.endsWith(`
`)&&n.jsx("br",{})]})}),n.jsx("textarea",{...i,ref:d,value:s,onChange:h,onScroll:w,className:`relative w-full h-full text-transparent caret-white resize-none focus:outline-none z-10 ${r}`,style:{color:"transparent",caretColor:"white",backgroundColor:"transparent",...a},spellCheck:!1})]})},ku=260,_u=180,iy=44,c0=36,Oj=200,Fj=200,d0=16,Bj=160,Hj=32,sy={WS:"Integrate the character/object with a Wide Shot (WS) into the scene and action. Show the environment.",MS:"Integrate the character/object with a Medium Shot (MS) into the scene. Character from waist up.",CU:"Integrate the character/object with a Close-Up (CU) into the scene.",ECU:"Integrate the character/object with an Extreme Close-Up (ECU) into the scene. Maximum detail.",LS:"Integrate the character/object with a Long Shot (LS) into the scene to show scale."},qr=({value:e,placeholder:t,onChange:o,min:r,className:a,title:i})=>{const s=c=>{const d=parseInt(e,10);let u=isNaN(d)?r||1:d+c;r!==void 0&&u<r&&(u=r),o(u.toString())},l=c=>{const d=c.target.value;if(d===""){o("");return}const u=parseInt(d,10);!isNaN(u)&&r!==void 0&&u<r||o(d)};return n.jsxs("div",{className:`relative flex items-center bg-gray-800 rounded border border-gray-600 h-7 ${a}`,title:i,children:[n.jsx("input",{type:"number",min:r,value:e,placeholder:t,onChange:l,className:"appearance-none w-full h-full bg-transparent text-xs text-white text-center focus:outline-none px-1 placeholder-gray-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",onClick:c=>c.stopPropagation(),onMouseDown:c=>c.stopPropagation()}),n.jsxs("div",{className:"flex flex-col h-full border-l border-gray-600 w-4 flex-shrink-0",children:[n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-gray-700 text-gray-400 hover:text-white transition-colors",onClick:c=>{c.stopPropagation(),s(1)},children:n.jsx("svg",{width:"8",height:"4",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-gray-700 text-gray-400 hover:text-white transition-colors border-t border-gray-600",onClick:c=>{c.stopPropagation(),s(-1)},children:n.jsx("svg",{width:"8",height:"4",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})},Gj=["WS","MS","CU","ECU","LS"],Uj=jt.memo(({index:e,frameNumber:t,sceneNumber:o,prompt:r,videoPrompt:a,shotType:i,characters:s,duration:l,isSelected:c,isCollapsed:d,onToggleCollapse:u,onSelect:p,onChange:h,onDelete:w,onAddAfter:k,onCopy:b,onCopyVideo:y,onMoveUp:g,onMoveDown:m,onMoveToSource:x,onMoveToStart:_,onMoveToEnd:S,isFirst:P,isLast:j,t:M,readOnly:D=!1,isChecked:O,onCheck:B,style:E,onEditInSource:I,onEditPrompt:N,showVideoPrompts:T=!0,showSceneInfo:F=!0,onCopyCombinedPrompt:z})=>{const G=v.useCallback((te,le)=>{if(D||le<1)return;const ee=(s||[])[te],se=`Entity-${le}`,ie=[...s||[]];ie[te]=se;const oe=ee.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),A=new RegExp(`\\(${oe}\\)`,"gi"),K=r.replace(A,`(${se})`);h(t,{characters:ie,prompt:K})},[D,s,r,h,t]),U=v.useCallback(te=>{if(D)return;const le=(s||[])[te],ee=(s||[]).filter((A,K)=>K!==te),se=le.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),ie=new RegExp(`\\s*\\(${se}\\)`,"gi"),oe=r.replace(ie,"").trim().replace(/,\s*$/,"");h(t,{characters:ee,prompt:oe})},[D,s,r,h,t]),R=v.useCallback(te=>{if(D)return;const le=`[${te}] ${r}`;h(t,{prompt:le})},[D,r,h,t]),q=v.useCallback(()=>{if(D)return;const te=s||[],le=te.map(oe=>parseInt(oe.replace(/(?:character|entity)-/i,""),10)).filter(oe=>!isNaN(oe));let ee=1;for(;le.includes(ee);)ee++;const se=`Entity-${ee}`,ie=[...te,se];h(t,{characters:ie})},[D,s,h,t]),H=te=>{if(D)return;const le=te,ee=K=>(K.match(/(?:character|entity)-\d+/gi)||[]).map(W=>W.toLowerCase()).sort().join(","),se=ee(r),ie=ee(le),oe=se!==ie,A={prompt:le};if(oe){const K=le.match(/(?:character|entity)-\d+/gi)||[],Z=[...new Set(K.map(W=>W.replace(/character-/i,"Entity-").replace(/entity-/i,"Entity-")))];A.characters=Z}h(t,A)},ne=te=>{D||h(t,{videoPrompt:te})},X=te=>{D||h(t,{shotType:te.target.value})},de=`FRAME-${String(t).padStart(3,"0")}${i?`, [${i}]`:""}`,ge=i?sy[i]:void 0;return n.jsxs("div",{onClick:()=>p(t),style:{...E,height:d?`${iy}px`:T?ge?`${ku+30}px`:`${ku}px`:ge?`${_u+30}px`:`${_u}px`},className:`relative group bg-gray-700 p-2 rounded-lg border-2 overflow-hidden mb-1 ${c?"border-connection-text shadow-[0_0_15px_var(--color-connection-text)]":"border-transparent hover:border-gray-600"}`,children:[n.jsxs("div",{className:"flex justify-between items-center mb-1 h-[28px] gap-2 cursor-pointer",onClick:te=>{te.stopPropagation(),u(t)},children:[n.jsxs("div",{className:"flex items-center space-x-2 flex-1 overflow-hidden",children:[B&&n.jsx("div",{className:"flex-shrink-0",onClick:te=>te.stopPropagation(),title:"Select frame for batch modification",children:n.jsx(Ot,{checked:!!O,onChange:(te,le)=>B(t,le.shiftKey),className:"h-5 w-5"})}),n.jsx(Pe,{tooltipPosition:"right",title:M(d?"node.action.expand":"node.action.collapse"),onClick:te=>{te.stopPropagation(),u(t)},children:d?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7M19 5l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),n.jsx("h4",{className:"text-[10px] font-black text-gray-200 flex-shrink-0 whitespace-nowrap uppercase tracking-tighter",title:de,children:de}),n.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0 ml-1",children:[n.jsx("span",{className:"text-[10px] text-gray-500 font-semibold uppercase",children:"ENT:"}),(s||[]).map((te,le)=>{const ee=parseInt(te.replace(/(?:character|entity)-/i,""),10);return isNaN(ee)?null:n.jsxs("div",{className:"flex items-center bg-gray-600 rounded text-gray-200 border border-gray-500",onClick:se=>se.stopPropagation(),children:[n.jsx("span",{className:"text-[10px] font-semibold px-1.5",children:ee}),n.jsxs("div",{className:"flex flex-col border-l border-gray-500",children:[n.jsx("button",{onClick:se=>{se.stopPropagation(),G(le,ee+1)},className:"px-0.5 text-gray-300 hover:text-white text-[8px] middle-none disabled:text-gray-500 disabled:cursor-not-allowed",disabled:D,children:""}),n.jsx("button",{onClick:se=>{se.stopPropagation(),G(le,ee-1)},className:"px-0.5 text-gray-300 hover:text-white text-[8px] border-t border-gray-600 disabled:text-gray-500 disabled:cursor-not-allowed",disabled:D||ee<=1,children:""})]}),n.jsx("button",{onClick:se=>{se.stopPropagation(),R(te)},disabled:D,className:"px-1 text-cyan-300 hover:text-cyan-100 border-l border-gray-500 text-[10px] disabled:text-gray-500 disabled:cursor-not-allowed",title:"Insert at start: [Entity-N]",children:""}),n.jsx("button",{onClick:se=>{se.stopPropagation(),U(le)},disabled:D,className:"px-1 text-red-300 hover:text-red-100 border-l border-gray-500 text-[10px] disabled:text-gray-500 disabled:cursor-not-allowed",children:""})]},le)}),n.jsx("button",{onClick:te=>{te.stopPropagation(),q()},disabled:D,className:"flex items-center justify-center w-4 h-4 bg-gray-600 hover:bg-gray-500 rounded text-[10px] text-gray-300 disabled:bg-gray-700 disabled:cursor-not-allowed",children:"+"})]})]}),n.jsxs("div",{className:"flex items-center flex-shrink-0 space-x-1",children:[x&&n.jsx(Pe,{tooltipPosition:"left",title:"Move to Source",onClick:te=>{te.stopPropagation(),x(t)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),!D&&n.jsxs("div",{className:"flex p-0.5",children:[_&&n.jsx(Pe,{tooltipPosition:"left",title:"Move to Start",onClick:te=>{te.stopPropagation(),_(e)},disabled:P,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),g&&n.jsx(Pe,{tooltipPosition:"left",title:"Move Up",onClick:te=>{te.stopPropagation(),g(e)},disabled:P,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),m&&n.jsx(Pe,{tooltipPosition:"left",title:"Move Down",onClick:te=>{te.stopPropagation(),m(e)},disabled:j,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),S&&n.jsx(Pe,{tooltipPosition:"left",title:"Move to End",onClick:te=>{te.stopPropagation(),S(e)},disabled:j,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})})]}),!D&&k&&n.jsx(Pe,{tooltipPosition:"left",title:"Add Frame After",onClick:te=>{te.stopPropagation(),k(t)},className:"p-1 rounded-md text-[#dad5cf] hover:bg-gray-600 hover:text-white transition-colors focus:outline-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),n.jsx(Pe,{tooltipPosition:"left",title:M("node.action.copyVideoPrompt"),onClick:te=>{te.stopPropagation(),a&&y&&y(a)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})})}),n.jsx(Pe,{tooltipPosition:"left",title:M("node.action.copyImagePrompt"),onClick:te=>{te.stopPropagation(),b(r)},children:n.jsx(Dt,{className:"h-4 w-4"})}),z&&n.jsx(Pe,{title:"Copy Combined Prompt",tooltipPosition:"bottom",tooltipAlign:"center",onClick:te=>{te.stopPropagation(),z(t)},className:"p-1 rounded-md text-[#dad5cf] hover:bg-gray-600 hover:text-white transition-colors focus:outline-none",children:n.jsx(ty,{className:"h-4 w-4 text-orange-400 group-hover:text-orange-200"})}),!D&&w&&n.jsx(Pe,{tooltipPosition:"left",title:M("image_sequence.delete_frame"),onClick:te=>{te.stopPropagation(),w(t)},className:"p-1 rounded-md text-gray-500 hover:text-red-400 hover:bg-gray-600 transition-colors focus:outline-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),(!D&&N||D&&I)&&n.jsx(Pe,{title:M(D?"image_sequence.edit_in_source":"image_sequence.edit_prompt"),tooltipPosition:"left",onClick:te=>{te.stopPropagation(),D&&I?I(t):N&&N(t)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})})]})]}),!d&&n.jsxs("div",{className:"flex flex-col space-y-1 mt-1",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1 bg-gray-800 p-1 rounded",children:[n.jsx("select",{value:i||"WS",onChange:X,disabled:D,className:"bg-gray-700 text-white text-[10px] rounded border border-gray-600 px-1 py-0.5 focus:outline-none focus:ring-1 focus:ring-cyan-500 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed w-20 shrink-0",onClick:te=>te.stopPropagation(),onMouseDown:te=>te.stopPropagation(),children:Gj.map(te=>n.jsx("option",{value:te,children:te},te))}),n.jsx("div",{className:"text-[10px] text-gray-400 italic flex-grow truncate",title:ge||"No Shot Type",children:ge||n.jsx("span",{className:"opacity-50",children:"No shot type selected"})}),!D&&n.jsxs("div",{className:"flex items-center flex-shrink-0 border-l border-gray-600 pl-2",children:[n.jsx(qr,{value:l.toString(),onChange:te=>h(t,{duration:Math.max(0,parseInt(te,10)||0)}),min:0}),n.jsx("span",{className:"text-[9px] text-gray-500 ml-1",children:"s"})]})]}),n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase",children:"IMAGE PROMPT"}),n.jsx(Pl,{value:r,onDebouncedChange:H,readOnly:D,style:{height:T?"100px":"120px"},className:`w-full text-xs p-1 bg-gray-800 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-2 focus:ring-cyan-500 ${D?"cursor-default":"cursor-text"}`,onClick:te=>te.stopPropagation(),onMouseDown:te=>te.stopPropagation(),onWheel:te=>te.stopPropagation()})]}),T&&n.jsxs("div",{className:"flex flex-col mt-1 pt-1 border-t border-gray-600/30",children:[n.jsx("div",{className:"flex justify-between items-center mb-0.5",children:n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase",children:"VIDEO PROMPT"})}),n.jsx(Pl,{value:a||"",onDebouncedChange:ne,readOnly:D,style:{height:"60px"},className:`w-full text-xs p-1 bg-gray-800 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-2 focus:ring-cyan-500 ${D?"cursor-default":"cursor-text"}`,onClick:te=>te.stopPropagation(),onMouseDown:te=>te.stopPropagation(),onWheel:te=>te.stopPropagation()})]})]})]})}),Vj=(e,t,o,r=800,a=!0,i=!0,s={},l=[],c=[])=>{const d=v.useMemo(()=>{const k=[...e].sort((m,x)=>m.frameNumber-x.frameNumber),b=[];let y=-1,g=null;return k.forEach(m=>{const x=m.sceneNumber||1;if(x!==y){y=x;const _=m.sceneTitle||"";g={scene:x,title:_,prompts:[]},b.push(g)}g&&g.prompts.push(m)}),b},[e]),u=v.useMemo(()=>{const k=[];let b=0;return d.forEach(y=>{if(i&&(k.push({type:"scene_header",h:c0,top:b,data:y,scene:y.scene}),b+=c0),!i||!t.includes(y.scene)){const g=s[String(y.scene)]||"",m=l.includes(y.scene)?Bj:Hj;k.push({type:"scene_context",h:m+8,top:b,data:g,scene:y.scene}),b+=m+8,y.prompts.forEach(x=>{const S=(x.shotType?sy[x.shotType]:void 0)?30:0,P=(a?ku:_u)+S,j=(x.isCollapsed?iy:P)+8;k.push({type:"prompt",h:j,top:b,data:x,scene:y.scene}),b+=j})}}),{items:k,totalHeight:b}},[d,t,a,i,s,l,c]),p=v.useMemo(()=>{const b=Math.max(0,o-800),y=o+r+800;return u.items.filter(g=>g.top+g.h>b&&g.top<y)},[u,o,r]),h=k=>{const b=u.items.find(y=>y.type==="prompt"&&y.data.frameNumber===k);return b?b.top:null},w=k=>{if(!i)return null;const b=u.items.find(y=>y.type==="scene_header"&&y.scene===k);return b?b.top:null};return{groupedPrompts:d,virtualItems:u,visibleItems:p,totalHeight:u.totalHeight,getScrollPositionForFrame:h,getScrollPositionForScene:w}},Wj=v.forwardRef(({prompts:e,collapsedScenes:t,checkedFrameNumbers:o,selectedFrameNumber:r,isLinked:a,onUpdatePrompts:i,onLoadFile:s,onSaveToCatalog:l,onSaveToDisk:c,t:d,onSelect:u,onToggleCollapse:p,onToggleScene:h,onDetachToEditor:w,onClearAll:k,onAddPrompt:b,onAddScene:y,onDeletePrompt:g,onMovePromptUp:m,onMovePromptDown:x,onMoveToStart:_,onMoveToEnd:S,onRegenerate:P,isAnyGenerationInProgress:j,onEditInSource:M,onEditPrompt:D,isGeneratingSequence:O,allConceptsLength:B,selectionKey:E="checkedSourceFrameNumbers",onUnlink:I,addToast:N,onClearTextOnly:T,sceneContexts:F={},onUpdateSceneContext:z,expandedSceneContexts:G=[],onToggleSceneContext:U,checkedContextScenes:R=[],onToggleContextCheck:q,onCopyCombinedPrompt:H},ne)=>{const X=v.useRef(null),[re,de]=v.useState(0),[ge,te]=v.useState(800),[le,ee]=v.useState(!1),[se,ie]=v.useState(""),[oe,A]=v.useState(""),[K,Z]=v.useState(""),[W,Q]=v.useState(!0),[ce,fe]=v.useState(!0);v.useEffect(()=>{if(!X.current)return;const we=()=>{X.current&&requestAnimationFrame(()=>{X.current&&(te(X.current.clientHeight),de(X.current.scrollTop))})},Ce=new ResizeObserver(we);return Ce.observe(X.current),we(),()=>Ce.disconnect()},[]);const{groupedPrompts:$,totalHeight:V,visibleItems:J,getScrollPositionForFrame:Y}=Vj(e,t,re,ge,W,ce,F,G,R);v.useImperativeHandle(ne,()=>({scrollToFrame:we=>{const Ce=Y(we);Ce!==null&&X.current&&X.current.scrollTo({top:Math.max(0,Ce-100),behavior:"smooth"})},scrollToBottom:()=>{X.current&&X.current.scrollTo({top:X.current.scrollHeight,behavior:"smooth"})}}));const ae=we=>{const Ce=parseInt(we||se,10);if(isNaN(Ce))return;const qe=e.find(at=>at.frameNumber===Ce);if(!qe)return;const Be=qe.sceneNumber||1;let Ie=[...t];Ie.includes(Be)&&(Ie=Ie.filter(at=>at!==Be));const We=e.map(at=>at.frameNumber===Ce?{...at,isCollapsed:!1}:at);i({prompts:We,sourcePrompts:We,collapsedScenes:Ie,collapsedSourceScenes:Ie,selectedFrameNumber:Ce}),setTimeout(()=>{const at=Y(Ce);at!==null&&X.current&&X.current.scrollTo({top:at,behavior:"smooth"})},100)},ue=we=>{if(we.preventDefault(),we.stopPropagation(),ee(!1),a)return;const Ce=we.dataTransfer.files[0];if(Ce&&Ce.type==="application/json"){const qe=new FileReader;qe.onload=Be=>{var Ie;if((Ie=Be.target)!=null&&Ie.result)try{const We=JSON.parse(Be.target.result);let at=We.finalPrompts||We.prompts||(Array.isArray(We)?We:[]),Jt=We.sceneContexts||{};at.length>0&&i({sourcePrompts:at,prompts:at,sceneContexts:Jt})}catch(We){console.error(We)}},qe.readAsText(Ce)}},he=()=>{const we=parseInt(oe,10),Ce=parseInt(K,10);if(isNaN(we)||isNaN(Ce))return;const qe=Math.max(1,we),Be=Math.min(e.length,Ce);if(qe>Be)return;const Ie=[];for(let We=qe;We<=Be;We++)Ie.push(We);i({[E]:Ie})},ye=()=>i({[E]:e.map(we=>we.frameNumber)}),ve=()=>i({[E]:[]}),me=()=>{const Ce=e.map(qe=>qe.frameNumber).filter(qe=>!o.includes(qe));i({[E]:Ce})},_e=$.length>0&&$.every(we=>t.includes(we.scene)),pe=()=>{const we=$.map(qe=>qe.scene),Ce=_e?[]:we;i({collapsedScenes:Ce,collapsedSourceScenes:Ce})},xe=e.every(we=>we.isCollapsed),Se=()=>{const we=e.map(Ce=>({...Ce,isCollapsed:!xe}));i({prompts:we,sourcePrompts:we})},Le=(we,Ce)=>{if(a)return;const qe=e.map(Be=>Be.frameNumber===we?{...Be,...Ce}:Be);i({prompts:qe,sourcePrompts:qe})},Ee=(we,Ce)=>{if(Ce){i({[E]:[we]});return}const qe=o.includes(we)?o.filter(Be=>Be!==we):[...o,we];i({[E]:qe})},Me=we=>{navigator.clipboard.writeText(we),N&&N(d("toast.copiedToClipboard"))},De=()=>{T?T():k()},Te=we=>{const Ce=$.find(We=>We.scene===we);if(!Ce)return;const qe=Ce.prompts.map(We=>We.frameNumber),Be=qe.every(We=>o.includes(We));let Ie;Be?Ie=o.filter(We=>!qe.includes(We)):Ie=[...new Set([...o,...qe])],i({[E]:Ie})},Re=we=>{const Ce=$.find(qe=>qe.scene===we);return!Ce||Ce.prompts.length===0?!1:Ce.prompts.every(qe=>o.includes(qe.frameNumber))};return n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-h-0",children:[n.jsxs("div",{className:"flex justify-between items-center flex-shrink-0 bg-gray-900/50 p-1 rounded-md border border-gray-700 h-9",onWheel:we=>we.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center space-x-1 h-full",children:[a&&n.jsx("button",{className:"text-cyan-400 hover:text-white transition-colors",title:"Linked to Upstream (Click to Unlink and Copy)",onClick:we=>{we.stopPropagation(),I&&I()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),!a&&e.length>0&&w&&n.jsx(Pe,{title:"Detach and Edit",onClick:w,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-400 hover:text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),n.jsx("h3",{className:"text-sm font-bold text-gray-300 px-1 whitespace-nowrap",children:d("image_sequence.prompts_list_title")||"Prompts"}),n.jsx("div",{className:"flex items-center",children:n.jsx(qr,{value:se,placeholder:"#",onChange:we=>{ie(we),ae(we)},min:1,className:"w-12 border-none",title:"Go to Frame"})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsxs("div",{className:"flex items-center gap-1 bg-gray-800 rounded p-0.5 h-6",children:[n.jsx("span",{className:"text-[9px] text-gray-400 px-1 whitespace-nowrap",children:d("image_sequence.range_from")}),n.jsx(qr,{value:oe,placeholder:"1",onChange:A,min:1,className:"w-10 border-none"}),n.jsx("span",{className:"text-[9px] text-gray-400 px-1 whitespace-nowrap",children:d("image_sequence.range_to")}),n.jsx(qr,{value:K,placeholder:"N",onChange:Z,min:1,className:"w-10 border-none"}),n.jsx(Pe,{title:"Select range",onClick:we=>{we.stopPropagation(),he()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-800 rounded p-0.5 h-6",children:[n.jsx(Pe,{title:d("image_sequence.select_all"),onClick:ye,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600"}),n.jsx(Pe,{title:d("image_sequence.select_none"),onClick:ve,disabled:o.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600"}),n.jsx(Pe,{title:d("image_sequence.invert_selection"),onClick:me,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})})]})]}),n.jsxs("div",{className:"flex items-center space-x-1 h-full",children:[n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-900/50 rounded p-0.5",children:[n.jsx(Pe,{title:"Add Scene",onClick:y,disabled:a,children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m-3-3h6"})]})}),n.jsx(Pe,{title:d("image_sequence.add_frame"),onClick:()=>b(-1),disabled:a,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Pe,{title:W?" -":" -",onClick:()=>Q(!W),children:W?n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})}),n.jsx(Pe,{title:ce?" ":" ",onClick:()=>fe(!ce),children:ce?n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Pe,{title:_e?"Expand Scenes":"Collapse Scenes",onClick:pe,children:_e?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})}),n.jsx(Pe,{title:xe?"Expand Prompts":"Collapse Prompts",onClick:Se,disabled:_e,children:xe?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),!a&&n.jsx(Pe,{title:d("image_sequence.clear_prompts_only"),onClick:De,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),n.jsx("div",{ref:X,className:`flex-grow min-h-0 bg-gray-900/50 p-2 rounded-md border-2 border-dashed transition-colors overflow-y-auto scrollbar-gutter-stable ${le?"border-cyan-500 bg-gray-700/50":"border-transparent"} ${le?"bg-cyan-900/20":""}`,onScroll:we=>de(we.currentTarget.scrollTop),onDragOver:we=>{we.preventDefault(),we.stopPropagation(),ee(!0)},onDragLeave:()=>ee(!1),onDrop:ue,onWheel:we=>we.stopPropagation(),style:{overscrollBehaviorY:"contain"},children:e.length===0?n.jsx("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500 p-4 cursor-pointer",onClick:()=>!a&&b(-1),children:a?n.jsxs(n.Fragment,{children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-gray-400 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),n.jsx("p",{className:"font-semibold text-sm",children:"Linked to References"}),n.jsx("p",{className:"text-xs",children:"Waiting for data..."})]}):n.jsxs(n.Fragment,{children:[n.jsx("h4",{className:"font-semibold text-sm",children:d("image_sequence.drop_or_add_title")}),n.jsx("p",{className:"text-xs",children:d("image_sequence.drop_or_add_desc")})]})}):n.jsx("div",{style:{height:V,position:"relative"},children:J.map(we=>{if(we.type==="scene_header"){const Ce=we.data,qe=t.includes(Ce.scene);return n.jsx("div",{style:{position:"absolute",top:we.top,left:0,right:0,height:we.h,paddingBottom:4},children:n.jsx("div",{className:"flex items-center justify-between bg-gray-800 p-1 rounded select-none cursor-pointer hover:bg-gray-700 transition-colors h-full",onClick:Be=>{Be.stopPropagation(),h(Ce.scene)},children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"text-gray-400",children:qe?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),n.jsxs("div",{className:"flex items-center gap-2",onClick:Be=>Be.stopPropagation(),children:[n.jsx(Ot,{checked:q&&R?R.includes(Ce.scene):!1,onChange:()=>q&&q(Ce.scene),title:"Include Context in Modification"}),n.jsx(Ot,{checked:Re(Ce.scene),onChange:()=>Te(Ce.scene),title:"Select All Frames in Scene",className:"text-cyan-400"})]}),n.jsxs("span",{className:"text-xs font-bold text-gray-300 uppercase tracking-wider bg-gray-800 px-2 py-1 rounded",children:[d("image_sequence.scene_input_label")," ",Ce.scene,Ce.title?`: ${Ce.title}`:""]}),n.jsxs("span",{className:"text-[10px] text-gray-500",children:["(",Ce.prompts.length," frames)"]})]})})},`header-${Ce.scene}`)}else if(we.type==="scene_context"){const Ce=we.data,qe=we.scene,Be=G.includes(qe);return n.jsx("div",{style:{position:"absolute",top:we.top,left:0,right:0,height:we.h},className:"pl-2 border-l-2 border-connection-text ml-2 pb-2",children:n.jsxs("div",{className:"bg-gray-800/80 rounded border border-connection-text p-2 h-full flex flex-col",children:[n.jsx("div",{className:"flex justify-between items-center cursor-pointer select-none",onClick:Ie=>{Ie.stopPropagation(),U&&U(qe)},children:n.jsx("div",{className:"flex items-center gap-2",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{onClick:Ie=>Ie.stopPropagation(),children:n.jsx(Ot,{checked:q&&R?R.includes(qe):!1,onChange:()=>q&&q(qe),title:"Include Context in Modification"})}),n.jsx("div",{className:"text-connection-text",children:Be?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})}),n.jsx("label",{className:"text-[10px] font-bold text-connection-text uppercase tracking-wider cursor-pointer",children:"SCENE CONTEXT"})]})})}),Be&&n.jsx("div",{className:"flex-grow min-h-0 mt-2",children:n.jsx(Tn,{value:Ce,onDebouncedChange:Ie=>z&&z(qe,Ie),readOnly:a,className:`w-full h-full text-xs p-1.5 bg-gray-900/50 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-1 focus:ring-accent ${a?"cursor-default":"cursor-text"}`,placeholder:"Describe scene environment and context...",onMouseDown:Ie=>Ie.stopPropagation(),onWheel:Ie=>Ie.stopPropagation()})})]})},`context-${qe}`)}else{const Ce=we.data,qe=e.findIndex(Ie=>Ie.frameNumber===Ce.frameNumber),Be=r===Ce.frameNumber;return n.jsx("div",{style:{position:"absolute",top:we.top,left:0,right:0,height:we.h},className:"pl-2 border-l-2 border-gray-700 ml-2",children:n.jsx(Uj,{index:qe,frameNumber:Ce.frameNumber,sceneNumber:Ce.sceneNumber,prompt:Ce.prompt,videoPrompt:Ce.videoPrompt,shotType:Ce.shotType,characters:Ce.characters,duration:Ce.duration||0,isSelected:Be,isCollapsed:Ce.isCollapsed??!1,onToggleCollapse:()=>p(Ce.frameNumber),onSelect:()=>u(Ce.frameNumber),onChange:Le,onCopy:Ie=>Me(Ie),onCopyVideo:Ie=>Me(Ie),t:d,readOnly:a,isChecked:o.includes(Ce.frameNumber),onCheck:(Ie,We)=>Ee(Ie,We),onDelete:()=>g(Ce.frameNumber),onAddAfter:()=>b(Ce.frameNumber),onMoveUp:()=>m(qe),onMoveDown:()=>x(qe),onMoveToStart:()=>_(qe),onMoveToEnd:()=>S(qe),isFirst:qe===0,isLast:qe===e.length-1,showVideoPrompts:W,onRegenerate:P,isAnyGenerationInProgress:j||O,onEditInSource:M,onEditPrompt:D,maxCharacters:B,onCopyCombinedPrompt:H})},`prompt-${Ce.frameNumber}`)}})})}),!a&&n.jsxs("div",{className:"flex-shrink-0 flex space-x-2",children:[n.jsx("div",{className:"flex-1 flex space-x-1",children:n.jsx("button",{onClick:s,className:"flex-1 px-3 py-2 text-sm font-semibold text-white bg-accent-secondary hover:bg-accent-secondary-hover rounded-md",children:d("image_sequence.load_prompts")})}),n.jsx("button",{onClick:l,disabled:e.length===0,className:"flex-1 px-3 py-2 text-sm font-semibold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",title:d("catalog.saveTo"),children:d("catalog.saveTo")}),n.jsx(Pe,{title:d("group.saveToDisk"),onClick:c,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]})]})}),$j=({width:e,height:t})=>{const o=e/t;let r="",a="";return o>1.2?(r="M2 6h20v12H2z",a="Landscape"):o<.85?(r="M6 2h12v20H6z",a="Portrait"):(r="M4 4h16v16H4z",a="Square"),n.jsx("div",{className:"flex items-center justify-center w-6 h-6",title:a,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-white",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:r})})})},Kj=jt.memo(({index:e,frameNumber:t,imageUrl:o,fullSizeImageUrl:r,status:a,isSelected:i,onSelect:s,onDoubleClick:l,onRegenerate:c,onDownload:d,onCopy:u,onCopyTextPrompt:p,onCopyVideo:h,onStop:w,isGeneratingSequence:k,isAnyGenerationInProgress:b,t:y,isChecked:g,onCheck:m,prompt:x,videoPrompt:_,onOpenRaster:S,onOpenAI:P,onReplaceImage:j,onEditPrompt:M,readOnlyPrompt:D,onEditInSource:O,characterIndices:B,onExpandFrame:E,shotType:I,onReportDimensions:N,onCopyCombinedPrompt:T})=>{const F={idle:"bg-gray-800",pending:"bg-gray-700/50",prompt_processing:"bg-yellow-800/50 animate-pulse",generating:"bg-blue-800/50 animate-pulse",done:"bg-gray-800",error:"bg-red-800/50"},z={idle:"",pending:y("image_sequence.status.pending")||"Queued",prompt_processing:"Processing...",generating:"Generating...",done:"",error:y("image_sequence.status.error")},[G,U]=v.useState(!1),[R,q]=v.useState(null),H=v.useCallback(oe=>{oe.stopPropagation(),s(t)},[t,s]),ne=v.useCallback(oe=>{oe.stopPropagation(),(r||o)&&S(t,r||o)},[t,r,o,S]),X=v.useCallback(oe=>{oe.stopPropagation(),(r||o)&&P(r||o)},[r,o,P]),re=oe=>{a==="generating"||a==="prompt_processing"||(oe.preventDefault(),oe.stopPropagation(),U(!0))},de=oe=>{a==="generating"||a==="prompt_processing"||(oe.preventDefault(),oe.stopPropagation(),U(!0))},ge=oe=>{a==="generating"||a==="prompt_processing"||(oe.preventDefault(),oe.stopPropagation(),U(!1))},te=v.useCallback(oe=>{if(a==="generating"||a==="prompt_processing")return;oe.preventDefault(),oe.stopPropagation(),U(!1);const A=oe.dataTransfer.getData("application/prompt-modifier-drag-image");if(A){A.startsWith("data:")?j(t,A):fetch(A).then(Z=>Z.blob()).then(Z=>{const W=new FileReader;W.onload=Q=>{var ce;(ce=Q.target)!=null&&ce.result&&j(t,Q.target.result)},W.readAsDataURL(Z)});return}const K=oe.dataTransfer.files;if(K&&K.length>0){const Z=K[0];if(Z.type.startsWith("image/")){const W=new FileReader;W.onload=Q=>{var ce;(ce=Q.target)!=null&&ce.result&&j(t,Q.target.result)},W.readAsDataURL(Z)}}},[t,j,a]),le=oe=>{const A=oe.currentTarget,K=A.naturalWidth,Z=A.naturalHeight;q({width:K,height:Z}),N&&N(t,K,Z)},ee="p-1 rounded-md text-[#dad5cf] hover:bg-gray-600 hover:text-white transition-colors focus:outline-none pointer-events-auto disabled:cursor-not-allowed disabled:opacity-50",se=a==="prompt_processing"||a==="generating",ie=!!o;return n.jsxs("div",{onClick:H,onDragEnter:re,onDragOver:de,onDragLeave:ge,onDrop:te,className:`relative group border-2 transition-colors h-full w-full ${G?"border-accent bg-gray-700/50":i?"border-accent":"border-transparent"} ${F[a]}`,children:[n.jsx("div",{className:"absolute top-1 left-1 z-20 pointer-events-auto",title:"Select frame for batch generation",children:n.jsx(Ot,{checked:!!g,onChange:(oe,A)=>m(t,A.shiftKey)})}),n.jsxs("div",{className:"w-full h-full overflow-hidden rounded-lg pointer-events-none relative",children:[ie&&n.jsx("img",{src:o,className:`w-full h-full object-cover cursor-pointer ${se?"opacity-50 blur-[2px]":""}`,alt:`Frame ${t}`,style:{pointerEvents:"auto"},draggable:!0,onLoad:le,onMouseDown:oe=>oe.stopPropagation(),onClick:oe=>{oe.stopPropagation(),l(t)},onDragStart:oe=>{oe.dataTransfer.setData("application/prompt-modifier-drag-image",r||o||""),oe.dataTransfer.effectAllowed="copy",oe.stopPropagation()}}),(a==="pending"||se||a==="error"||a==="idle"&&!ie)&&n.jsxs("div",{className:`absolute inset-0 flex flex-col items-center justify-center p-2 text-center z-10 ${ie?"bg-black/40":""}`,children:[a!=="pending"&&a!=="idle"&&n.jsx("span",{className:"text-white font-semibold text-sm drop-shadow-md",children:z[a]}),a==="pending"&&!ie&&n.jsx("span",{className:"text-white font-semibold text-sm drop-shadow-md",children:z[a]}),se&&n.jsxs(n.Fragment,{children:[n.jsxs("svg",{className:"animate-spin h-6 w-6 text-accent mt-2 drop-shadow-md",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n.jsx("div",{className:"flex space-x-2 mt-2 pointer-events-auto",children:n.jsx("button",{onClick:oe=>{oe.stopPropagation(),w(t)},className:"px-2 py-1 text-xs bg-red-600 hover:bg-red-700 rounded-md text-white font-semibold shadow-md",children:y("image_sequence.stop_queue")})})]})]})]}),!o&&a==="idle"&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:n.jsx("span",{className:"text-gray-600 text-xs",children:G?"Drop Image":""})}),!se&&a!=="pending"&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute inset-x-0 top-0 h-12 bg-gradient-to-b from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10"}),n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity z-30 pointer-events-auto",children:[h&&_&&n.jsx(Pe,{title:y("node.action.copyVideoPrompt"),tooltipPosition:"bottom",tooltipAlign:"start",onClick:oe=>{oe.stopPropagation(),h(_)},className:ee,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),o&&n.jsx(Pe,{title:y("node.action.copyImage"),tooltipPosition:"bottom",tooltipAlign:"center",onClick:oe=>{oe.stopPropagation(),u(t)},className:ee,children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Pe,{title:y("node.action.copyImagePrompt"),tooltipPosition:"bottom",tooltipAlign:"center",onClick:oe=>{oe.stopPropagation(),p(x)},className:ee,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),T&&n.jsx(Pe,{title:"Copy Combined Prompt",tooltipPosition:"bottom",tooltipAlign:"center",onClick:oe=>{oe.stopPropagation(),T(t)},className:ee,children:n.jsx(ty,{className:"h-4 w-4 text-orange-400 group-hover:text-orange-200"})}),o&&n.jsx(Pe,{title:y("node.action.download"),tooltipPosition:"bottom",tooltipAlign:"center",onClick:oe=>{oe.stopPropagation(),d(t,x)},className:ee,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Pe,{title:y("image_sequence.regenerate"),tooltipPosition:"bottom",tooltipAlign:"end",onClick:oe=>{oe.stopPropagation(),c(t)},disabled:b,className:ee,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})}),(!D&&M||D&&O)&&n.jsx(Pe,{title:y(D?"image_sequence.edit_in_source":"image_sequence.edit_prompt"),tooltipPosition:"bottom",tooltipAlign:"end",onClick:oe=>{oe.stopPropagation(),D&&O?O(t):M&&M(t)},className:ee,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})})]}),o&&n.jsxs("div",{className:"absolute bottom-1 left-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity z-30 pointer-events-auto",children:[n.jsx(Pe,{title:y("node.action.rasterEditor"),tooltipPosition:"top",tooltipAlign:"start",onClick:ne,className:"p-1 bg-emerald-600/80 rounded text-white hover:bg-emerald-700",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})}),n.jsx(Pe,{title:y("node.action.openInAIEditor"),tooltipPosition:"top",tooltipAlign:"start",onClick:X,className:"p-1 bg-cyan-600/80 rounded text-white hover:bg-cyan-700",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})}),n.jsx(Pe,{title:"Expand to 16:9",tooltipPosition:"top",tooltipAlign:"start",disabled:b,onClick:oe=>{oe.stopPropagation(),E&&E(t,"16:9")},className:`p-1 rounded text-white transition-colors ${b?"bg-gray-700/50 cursor-not-allowed opacity-50":"bg-gray-700/80 hover:bg-cyan-600"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"2",y:"8",width:"20",height:"8",rx:"1"})})}),n.jsx(Pe,{title:"Expand to 9:16",tooltipPosition:"top",tooltipAlign:"start",disabled:b,onClick:oe=>{oe.stopPropagation(),E&&E(t,"9:16")},className:`p-1 rounded text-white transition-colors ${b?"bg-gray-700/50 cursor-not-allowed opacity-50":"bg-gray-700/80 hover:bg-cyan-600"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",stroke:"currentColor",fill:"currentColor",children:n.jsx("rect",{x:"8",y:"2",width:"8",height:"20",rx:"1"})})})]}),B&&B.length>0&&n.jsx("div",{className:"absolute bottom-8 right-1 flex flex-col items-end space-y-0.5 z-10 pointer-events-none opacity-75 group-hover:opacity-100 transition-opacity",children:B.map((oe,A)=>n.jsxs("div",{className:"bg-black/60 text-white text-[9px] font-bold px-1 rounded backdrop-blur-sm",children:["ENT-",oe]},A))}),n.jsxs("div",{className:"absolute bottom-1 right-1 flex items-center space-x-1 z-10 pointer-events-none opacity-75",children:[n.jsxs("div",{className:"text-[10px] font-bold text-white bg-black/60 px-1.5 py-0.5 rounded-l-md h-6 flex items-center justify-center min-w-[20px]",children:[t,I?` [${I}]`:""]}),n.jsx("div",{className:"bg-black/60 h-6 flex items-center justify-center px-1 rounded-r-md",children:R?n.jsx($j,{width:R.width,height:R.height}):n.jsx("span",{className:"text-[9px] text-gray-300 font-mono",children:"N/A"})})]})]})]})}),Jj=({prompts:e,images:t,frameStatuses:o,selectedFrameNumber:r,checkedFrameNumbers:a,collapsedOutputScenes:i,isGeneratingSequence:s,isAnyFrameGenerating:l,t:c,onUpdateState:d,groupedPrompts:u,onRegenerate:p,onDownload:h,onCopy:w,onCopyPrompt:k,onCopyVideoPrompt:b,onStopFrame:y,onFrameSelect:g,onFrameDoubleClick:m,onCheckFrame:x,onOpenRaster:_,onOpenAI:S,onReplaceImage:P,onEditPrompt:j,onEditInSource:M,readOnlyPrompt:D,getFullSizeImage:O,onSelectByAspectRatio:B,onSelectSceneByAspectRatio:E,onSelectAll:I,onSelectNone:N,onInvertSelection:T,onRunSelected:F,onDownloadSelected:z,onForceRefresh:G,onExpandFrame:U,onExpandSelected:R,onReportDimensions:q,onClearImages:H,onCopyCombinedPrompt:ne})=>{const X=v.useRef(null),[re,de]=v.useState(0),[ge,te]=v.useState(800),[le,ee]=v.useState(600),[se,ie]=v.useState(""),[oe,A]=v.useState(""),[K,Z]=v.useState(""),W=Object.keys(t).length,Q=Object.values(o).filter(pe=>pe==="pending"||pe==="generating").length,ce=e.length;v.useEffect(()=>{if(!X.current)return;const pe=()=>{X.current&&requestAnimationFrame(()=>{X.current&&(te(X.current.clientWidth),ee(X.current.clientHeight))})},xe=new ResizeObserver(pe);return xe.observe(X.current),pe(),()=>xe.disconnect()},[]);const fe=v.useMemo(()=>{const pe=Math.max(0,ge-20),xe=Math.floor(pe/(Oj+d0))||1,Se=[];let Le=0;return u.forEach(Ee=>{if(Se.push({type:"scene_header",h:40,top:Le,data:Ee,scene:Ee.scene}),Le+=40,!i.includes(Ee.scene)){const Me=Math.ceil(Ee.prompts.length/xe),De=Me>0?Me*Fj+Math.max(0,Me-1)*d0+24:0;Se.push({type:"scene_grid",h:Math.max(0,De),top:Le,data:Ee,scene:Ee.scene}),Le+=Math.max(0,De)}}),{items:Se,totalHeight:Le}},[u,i,ge]),$=()=>{const xe=Math.max(0,re-800),Se=re+le+800;return fe.items.filter(Le=>Le.top+Le.h>xe&&Le.top<Se)},V=()=>{const pe=se===""?1:parseInt(se,10),xe=oe===""?ce:parseInt(oe,10);if(isNaN(pe)||isNaN(xe))return;const Se=Math.max(1,pe),Le=Math.min(ce,xe);if(Se>Le)return;const Ee=[];for(let Me=Se;Me<=Le;Me++)Ee.push(Me);d({checkedFrameNumbers:Ee})},J=pe=>{setTimeout(()=>{const xe=u.findIndex(Se=>Se.scene===pe);if(xe!==-1&&X.current){const Se=xe*40;X.current.scrollTo({top:Se,behavior:"smooth"})}},50)},Y=pe=>{const xe=pe!==void 0?pe:K===""?1:parseInt(K,10);if(isNaN(xe))return;const Se=u.find(De=>De.scene===xe);if(!Se)return;const Le=Se.prompts.map(De=>De.frameNumber),Me=u.map(De=>De.scene).filter(De=>De!==xe);d({checkedFrameNumbers:Le,collapsedOutputScenes:Me}),pe!==void 0&&Z(pe.toString()),J(xe)},ae=()=>{const pe=parseInt(K,10)||1,xe=u.map(Le=>Le.scene).sort((Le,Ee)=>Le-Ee),Se=xe.indexOf(pe);Se!==-1&&Se<xe.length-1?Y(xe[Se+1]):Se===-1&&xe.length>0&&Y(xe[0])},ue=()=>{const pe=parseInt(K,10)||1,xe=u.map(Le=>Le.scene).sort((Le,Ee)=>Le-Ee),Se=xe.indexOf(pe);Se>0?Y(xe[Se-1]):Se===-1&&xe.length>0&&Y(xe[xe.length-1])},he=u.length>0&&u.every(pe=>i.includes(pe.scene)),ye=()=>{const pe=u.map(Se=>Se.scene);d({collapsedOutputScenes:he?[]:pe})},ve=()=>{H?H():d({sequenceOutputs:[]})},me=pe=>{const xe=u.find(Me=>Me.scene===pe);if(!xe)return;const Se=xe.prompts.map(Me=>Me.frameNumber),Le=Se.every(Me=>a.includes(Me));let Ee;Le?Ee=a.filter(Me=>!Se.includes(Me)):Ee=[...new Set([...a,...Se])],d({checkedFrameNumbers:Ee})},_e=pe=>{const xe=u.find(Se=>Se.scene===pe);return!xe||xe.prompts.length===0?!1:xe.prompts.every(Se=>a.includes(Se.frameNumber))};return n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-h-0 pl-1",children:[n.jsxs("div",{className:"flex justify-between items-center flex-shrink-0 bg-gray-900/50 p-1 rounded-md border border-gray-700 mb-1",children:[n.jsxs("div",{className:"flex items-center space-x-3 px-1",children:[n.jsx("h3",{className:"text-sm font-bold text-gray-300 flex-shrink-0",children:c("image_sequence.output_images_title")}),n.jsxs("div",{className:"text-[10px] text-gray-400 flex space-x-2 border-l border-gray-600 pl-3",children:[n.jsx("span",{children:c("image_sequence.stats.total",{count:ce})}),n.jsx("span",{className:W>0?"text-accent":"",children:c("image_sequence.stats.generated",{count:W})}),Q>0&&n.jsx("span",{className:"text-accent animate-pulse",children:c("image_sequence.stats.queue",{count:Q})})]})]}),n.jsx(Pe,{title:c("image_sequence.force_refresh"),onClick:G,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-accent",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),n.jsxs("div",{className:"flex items-center justify-between gap-2 bg-gray-900/50 p-1 rounded-md border border-gray-700 mb-1",children:[n.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0",children:[n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-800 rounded border border-gray-600 px-1 py-0.5",children:[n.jsx("span",{className:"text-[10px] text-gray-400 pr-1 whitespace-nowrap",children:c("image_sequence.range_from")}),n.jsx(qr,{value:se,placeholder:"1",onChange:ie,min:1,className:"w-12 border-none"}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx("span",{className:"text-[10px] text-gray-400 pr-1 whitespace-nowrap",children:c("image_sequence.range_to")}),n.jsx(qr,{value:oe,placeholder:"Last",onChange:A,min:1,className:"w-12 border-none"}),n.jsx(Pe,{title:c("image_sequence.select_range"),onClick:pe=>{pe.stopPropagation(),V()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-800 rounded border border-gray-600 px-1 py-0.5",children:[n.jsx("span",{className:"text-[10px] text-gray-400 px-1 whitespace-nowrap",children:c("image_sequence.scene_input_label")}),n.jsx(qr,{value:K,placeholder:"1",onChange:Z,min:1,className:"w-14 border-none"}),n.jsx(Pe,{title:c("image_sequence.select_scene"),onClick:pe=>{pe.stopPropagation(),Y()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white transition-colors",onClick:pe=>{pe.stopPropagation(),ue()},title:c("image_sequence.prev_scene"),children:n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:n.jsx("path",{d:"M15 18l-6-6 6-6"})})}),n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white transition-colors",onClick:pe=>{pe.stopPropagation(),ae()},title:c("image_sequence.next_scene"),children:n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:n.jsx("path",{d:"M9 18l6-6-6-6"})})})]})]}),n.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0 ml-auto",children:[n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-800 rounded p-0.5",children:[n.jsx(Pe,{title:c("image_sequence.select_square"),onClick:()=>B("square"),disabled:W===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"1"})})}),n.jsx(Pe,{title:c("image_sequence.select_landscape"),onClick:()=>B("landscape"),disabled:W===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"2",y:"7",width:"20",height:"10",rx:"1"})})}),n.jsx(Pe,{title:c("image_sequence.select_portrait"),onClick:()=>B("portrait"),disabled:W===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"7",y:"2",width:"10",height:"20",rx:"1"})})})]}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Pe,{title:c("image_sequence.select_all"),onClick:I,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${e.length===0?"text-gray-600":"text-green-400"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(Pe,{title:c("image_sequence.select_none"),onClick:N,disabled:a.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${a.length===0?"text-gray-600":"text-red-400"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(Pe,{title:c("image_sequence.invert_selection"),onClick:T,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${e.length===0?"text-gray-600":"text-gray-300"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Pe,{title:c("image_sequence.run_selected"),onClick:F,disabled:s||l||a.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${s||l||a.length===0?"text-gray-600":"text-emerald-400"}`,viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),n.jsx(Pe,{title:`${c("image_sequence.download_selected")} (${a.length})`,onClick:z,disabled:a.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${a.length===0?"text-gray-600":"text-sky-400"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Pe,{title:c("node.action.clear"),onClick:ve,disabled:Object.keys(t).length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${Object.keys(t).length===0?"text-gray-600":"text-gray-300 hover:text-white"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),n.jsx(Pe,{title:he?"  ":"  ",onClick:ye,children:he?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})})]}),n.jsx("div",{ref:X,onScroll:pe=>de(pe.currentTarget.scrollTop),className:"flex-grow bg-gray-900/50 rounded-md p-2 overflow-y-auto custom-scrollbar overflow-x-hidden scrollbar-gutter-stable",onWheel:pe=>pe.stopPropagation(),style:{overscrollBehaviorY:"contain"},children:n.jsx("div",{style:{height:fe.totalHeight,position:"relative"},children:$().map(pe=>{var Se,Le;const xe=pe.data;if(pe.type==="scene_header"){const Ee=i.includes(xe.scene),Me=(Se=xe.prompts[0])==null?void 0:Se.frameNumber,De=(Le=xe.prompts[xe.prompts.length-1])==null?void 0:Le.frameNumber,Te=Me!==void 0&&De!==void 0?`(${Me}-${De})`:"";return n.jsx("div",{style:{position:"absolute",top:pe.top,left:0,right:0,height:pe.h,paddingBottom:4},children:n.jsxs("div",{className:"flex items-center justify-between mb-2 pb-1 border-b border-gray-700 cursor-pointer hover:bg-gray-800/50 rounded transition-colors p-1 h-full",onClick:()=>{const Re=i.includes(xe.scene)?i.filter(we=>we!==xe.scene):[...i,xe.scene];d({collapsedOutputScenes:Re})},children:[n.jsxs("div",{className:"flex items-center gap-2 overflow-hidden flex-grow mr-2",children:[n.jsx("div",{className:"text-gray-400 flex-shrink-0",children:Ee?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),n.jsxs("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider bg-gray-800 px-2 py-1 rounded truncate",title:`${c("image_sequence.scene_input_label")} ${xe.scene}${xe.title?`: ${xe.title}`:""}`,children:[c("image_sequence.scene_input_label")," ",xe.scene,xe.title?`: ${xe.title}`:""]})]}),n.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[n.jsx("span",{className:"text-[10px] text-gray-500 font-medium whitespace-nowrap",children:Ee?c("image_sequence.frames_hidden",{count:xe.prompts.length}):c("image_sequence.frames_count",{count:xe.prompts.length})}),n.jsx("span",{className:"text-[10px] text-gray-500 font-mono whitespace-nowrap",children:Te}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(Pe,{title:c("image_sequence.select_square"),onClick:Re=>{Re.stopPropagation(),E(xe.scene,"square")},disabled:!1,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"1"})})}),n.jsx(Pe,{title:c("image_sequence.select_landscape"),onClick:Re=>{Re.stopPropagation(),E(xe.scene,"landscape")},disabled:!1,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"2",y:"7",width:"20",height:"10",rx:"1"})})}),n.jsx(Pe,{title:c("image_sequence.select_portrait"),onClick:Re=>{Re.stopPropagation(),E(xe.scene,"portrait")},disabled:!1,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"7",y:"2",width:"10",height:"20",rx:"1"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Pe,{title:"Focus Scene (Collapse others)",tooltipPosition:"left",onClick:Re=>{Re.stopPropagation(),Y(xe.scene)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-accent hover:text-accent-hover",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Ot,{checked:_e(xe.scene),onChange:()=>me(xe.scene),title:"Select All Frames in Scene",className:"text-accent"})]})]})]})},`grid-header-${xe.scene}`)}else{const Ee=pe.data;return n.jsx("div",{style:{position:"absolute",top:pe.top,left:0,right:0,height:pe.h},children:n.jsx("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-4 pl-2",children:Ee.prompts.map(Me=>{const De=[];Me.characters&&Array.isArray(Me.characters)&&Me.characters.forEach(Ce=>{const qe=Ce.match(/(?:character|entity)-(\d+)/i);qe&&De.push(qe[1])});const Te=t[Me.frameNumber],Re=O(1e3+Me.frameNumber),we=Te||Re;return n.jsx("div",{className:"w-full h-[200px]",children:n.jsx(Kj,{index:Me.frameNumber,frameNumber:Me.frameNumber,imageUrl:we,fullSizeImageUrl:Re||we,status:o[Me.frameNumber]||"idle",isSelected:r===Me.frameNumber,onSelect:g,onDoubleClick:m,onRegenerate:p,onDownload:(Ce,qe)=>h(Ce,qe),onCopy:w,onCopyTextPrompt:k,onCopyVideo:b,onStop:y,isGeneratingSequence:!!s,isAnyGenerationInProgress:!!s||l,t:c,isChecked:a.includes(Me.frameNumber),onCheck:x,prompt:Me.prompt,videoPrompt:Me.videoPrompt,onOpenRaster:_,onOpenAI:S,onReplaceImage:P,onEditPrompt:j,readOnlyPrompt:D,onEditInSource:M,characterIndices:De,onExpandFrame:U,shotType:Me.shotType,onReportDimensions:q,onCopyCombinedPrompt:ne})},Me.frameNumber)})})},`grid-content-${Ee.scene}`)}})})})]})},Yj=({model:e,autoCrop169:t,autoDownload:o,createZip:r,isGeneratingSequence:a,isAnyFrameGenerating:i,checkedCount:s,promptsLength:l,onUpdateState:c,onGenerateSelected:d,onDownloadSelected:u,onStartQueue:p,onExpandSelected:h,t:w})=>{const k=[{value:"gemini-2.5-flash-image",label:"Gemini 2.5 Flash Image"},{value:"imagen-4.0-generate-001",label:"Imagen 4.0"}];return n.jsxs("div",{className:"flex-shrink-0 space-y-2 mt-2",children:[n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:w("node.content.generationMode")}),n.jsx(Rn,{value:e,onChange:b=>c({model:b}),disabled:a,options:k})]}),n.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-2",children:[n.jsx(Ot,{id:"auto-crop-169",checked:!!t,onChange:b=>c({autoCrop169:b}),label:w("image_sequence.auto_crop"),title:w("image_sequence.tooltip.autoCrop"),className:"text-sm text-gray-300"}),n.jsx(Ot,{id:"auto-download",checked:o,onChange:b=>c({autoDownload:b}),label:w("node.content.autoDownload"),title:w("image_sequence.tooltip.autoDownload"),className:"text-sm text-gray-300"}),n.jsx(Ot,{id:"create-zip",checked:!!r,onChange:b=>c({createZip:b}),label:w("image_sequence.create_zip"),title:w("image_sequence.tooltip.createZip"),className:"text-sm text-gray-300"})]}),n.jsxs("div",{className:"flex space-x-2 mb-2",children:[n.jsxs("button",{onClick:d,disabled:a||i||s===0,className:"flex-1 py-2 text-sm font-semibold text-white bg-accent-secondary hover:bg-accent-secondary-hover rounded-md disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",children:[w("image_sequence.run_selected")," (",s,")"]}),n.jsxs("button",{onClick:()=>h("16:9"),disabled:a||i||s===0,className:"flex-shrink-0 w-20 py-2 text-xs font-bold text-white bg-accent hover:bg-accent-hover rounded-md disabled:bg-gray-700 disabled:text-gray-500 transition-colors flex items-center justify-center gap-2",title:"Expand Selected to 16:9",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"2",y:"8",width:"20",height:"8",rx:"1"})}),"16:9"]}),n.jsxs("button",{onClick:()=>h("9:16"),disabled:a||i||s===0,className:"flex-shrink-0 w-20 py-2 text-xs font-bold text-white bg-accent hover:bg-accent-hover rounded-md disabled:bg-gray-700 disabled:text-gray-500 transition-colors flex items-center justify-center gap-2",title:"Expand Selected to 9:16",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"8",y:"2",width:"8",height:"20",rx:"1"})}),"9:16"]}),n.jsx("button",{onClick:u,disabled:s===0,className:"flex-1 py-2 text-sm font-semibold text-white bg-accent-secondary hover:bg-accent-secondary-hover rounded-md disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",children:r?"Download ZIP":`${w("image_sequence.download_selected")} (${s})`})]}),n.jsx("div",{children:n.jsx("button",{onClick:p,disabled:a||i||l===0,className:`w-full py-2 rounded-md font-semibold transition-colors ${a||i?"bg-gray-600 text-gray-300 cursor-not-allowed":"bg-accent hover:bg-accent-hover text-white"}`,children:w(a||i?"node.content.generating":"image_sequence.start_queue")})})]})},Ro=640,u0=660,Zj=390,Xj=37,_s="Integrate these Entities into the scene, action and pose. Fill the background with environmental elements  fill in the gray area of the source scene image naturally.",Qj=({node:e,onValueChange:t,onLoadImageSequenceFile:o,onGenerateImageSequence:r,onGenerateSelectedFrames:a,onStopImageSequence:i,isGeneratingSequence:s,onRegenerateFrame:l,onDownloadImageFromUrl:c,onCopyImageToClipboard:d,t:u,deselectAllNodes:p,connectedCharacterData:h,onDetachAndPasteConcept:w,onDetachImageToNode:k,onSaveSequenceToCatalog:b,setError:y,setImageViewer:g,getFullSizeImage:m,setFullSizeImage:x,connectedInputs:_,onRefreshUpstreamData:S,clearImagesForNodeFromCache:P,getUpstreamNodeValues:j,addToast:M,onSaveScriptToDisk:D,viewTransform:O})=>{const B=_==null?void 0:_.has("prompt_input"),E=Ut(),{nodes:I,onAddNode:N,connections:T,handleNavigateToNodeFrame:F,setConnections:z,setSelectedNodeIds:G}=E||{};v.useRef(null);const U=v.useRef(null),R=v.useRef(null),q=v.useRef(null),H=v.useRef(null),[ne,X]=v.useState(!1),[re,de]=v.useState(null),ge=v.useRef(null),[te,le]=v.useState(null),[ee,se]=v.useState(!1),ie=v.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{prompts:[],images:{},currentIndex:-1,isGenerating:!1,autoDownload:!1,selectedFrameNumber:null,frameStatuses:{},aspectRatio:"16:9",characterConcepts:[],model:"gemini-2.5-flash-image",characterPromptCombination:"replace",enableAspectRatio:!1,checkedFrameNumbers:[],styleOverride:"",isStyleSelected:!1,isStyleCollapsed:!0,isStyleInserted:!0,isSceneContextInserted:!0,isUsedCharsCollapsed:!0,isIntegrationSettingsCollapsed:!0,isCharacterPromptCombinationCollapsed:!0,integrationPrompt:_s,usedCharacters:[],conceptsMode:"normal",connectedCharacterConfig:{},collapsedScenes:[],collapsedOutputScenes:[],autoCrop169:!0,leftPaneWidth:Ro,createZip:!1,imageDimensions:{},sceneContexts:{},expandedSceneContexts:[],checkedContextScenes:[]}}},[e.value]),oe=v.useRef(ie);v.useEffect(()=>{oe.current=ie},[ie]);let A=ie.leftPaneWidth;!A&&ie.leftPaneRatio?A=Math.max(Ro,(e.width||1200)*ie.leftPaneRatio):A||(A=Ro);const{prompts:K=[],images:Z={},selectedFrameNumber:W=null,frameStatuses:Q={},aspectRatio:ce="16:9",autoDownload:fe=!1,characterConcepts:$=[],model:V="gemini-2.5-flash-image",characterPromptCombination:J="replace",enableAspectRatio:Y=!1,checkedFrameNumbers:ae=[],styleOverride:ue="",isStyleCollapsed:he=!0,isStyleInserted:ye=!0,isSceneContextInserted:ve=!0,isUsedCharsCollapsed:me=!0,isIntegrationSettingsCollapsed:_e=!0,isCharacterPromptCombinationCollapsed:pe=!0,integrationPrompt:xe=_s,usedCharacters:Se=[],conceptsMode:Le="normal",collapsedScenes:Ee=[],collapsedOutputScenes:Me=[],autoCrop169:De=!0,leftPaneWidth:Te=Ro,createZip:Re=!1,imageDimensions:we={},sceneContexts:Ce={},expandedSceneContexts:qe=[],checkedContextScenes:Be=[]}=ie;v.useEffect(()=>{xe||Ae({integrationPrompt:_s})},[]);const Ie=v.useMemo(()=>[...Se].map((be,Ge)=>({...be,originalIndex:Ge})).sort((be,Ge)=>{const ze=Je=>parseInt((Je||"0").replace(/[^0-9]/g,""),10);return ze(be.index)-ze(Ge.index)}),[Se]),We=v.useMemo(()=>Object.values(Q).some(be=>be==="pending"||be==="generating"),[Q]),at=!!s||We,Jt=v.useMemo(()=>Le==="collapsed"?Xj:Le==="expanded"?"100%":Zj,[Le]);v.useMemo(()=>[...K].sort((be,Ge)=>be.frameNumber-Ge.frameNumber),[K]);const Oe=v.useMemo(()=>{const be=[...K].sort((tt,Qe)=>tt.frameNumber-Qe.frameNumber),Ge=[];let ze=-1,Je=null;return be.forEach(tt=>{const Qe=tt.sceneNumber||1;if(Qe!==ze){ze=Qe;const lt=tt.sceneTitle||"";Je={scene:Qe,title:lt,prompts:[]},Ge.push(Je)}Je&&Je.prompts.push(tt)}),Ge},[K]),Ae=v.useCallback(be=>{const ze={...oe.current,...be};oe.current=ze,t(e.id,JSON.stringify(ze))},[e.id,t]);v.useEffect(()=>{if(!e.width)return;const be=e.width-u0;Te>be?Ae({leftPaneWidth:Math.max(Ro,be)}):Te<Ro&&Ae({leftPaneWidth:Ro})},[e.width,Te,Ae]);const Ue=h||[],ke=v.useMemo(()=>[...Ue].sort((be,Ge)=>{const ze=parseInt((be.alias||"0").replace(/[^0-9]/g,""),10),Je=parseInt((Ge.alias||"0").replace(/[^0-9]/g,""),10);return ze-Je}),[Ue]),Ne=ke.length,He=v.useMemo(()=>{const be=ke.map((ze,Je)=>{var tt;return{...ze,id:ze.index||ze.alias||ze.name||`upstream-stable-${Je}`,index:ze.index||ze.alias,image:ze.image||((tt=ze.imageSources)==null?void 0:tt["1:1"])||null,isConnected:!0,uniqueKey:`upstream-${ze.index||Je}`,_connectionId:ze._connectionId,_sourceNodeId:ze._sourceNodeId}}),Ge=$.map(ze=>({...ze,index:ze.id,isConnected:!1,uniqueKey:`local-${ze.id}`}));return[...be,...Ge]},[ke,$]),Fe=v.useMemo(()=>{let be=!1,Ge=0;const ze=Qe=>(Qe||"").toLowerCase().trim(),Je=Ie.map(Qe=>{const lt=ze(Qe.name),ct=ze(Qe.index);if(!lt&&!ct)return{status:"empty"};const Ht=He.find(qt=>ze(qt.index||qt.id||qt.alias)===ct),At=He.find(qt=>ze(qt.name)===lt);if(Ht&&At&&Ht===At)return Ge++,{status:"match"};if(Ht){const qt=Ht.name;if(ze(qt)!==lt)return be=!0,{status:"mismatch_name",expectedName:qt,conceptIndex:Ht.index||Ht.id}}if(At){const qt=At.index||At.id||At.alias;if(ze(qt)!==ct)return be=!0,{status:"mismatch_index",expectedIndex:qt,conceptName:At.name}}return{status:"missing"}}),tt=Ie.length>0&&Ge===Ie.length&&!be;return{results:Je,hasError:be,allValid:tt}},[Ie,He]),$e=v.useMemo(()=>{const be={},Ge=new Set;return He.forEach(ze=>{const Je=(ze.id||"").trim();Je&&(be[Je]=(be[Je]||0)+1)}),Object.keys(be).forEach(ze=>{be[ze]>1&&Ge.add(ze)}),Ge},[He]),Ye=be=>{let Ge=0;return ke.forEach(ze=>{const Je=parseInt((ze.index||ze.alias||"0").replace(/[^0-9]/g,""),10);isNaN(Je)||(Ge=Math.max(Ge,Je))}),Ge===0&&Ne>0&&(Ge=Ne),be.map((ze,Je)=>{const tt=Ge+Je+1;return{...ze,id:`Entity-${tt}`,name:`Entity-${tt}`}})},st=v.useCallback((be,Ge,ze,Je)=>{if(ze)return;const tt=be-Ne;if(tt>=0&&tt<$.length){const Qe=[...$];Qe[tt]={...Qe[tt],...Ge},Ae({characterConcepts:Qe})}},[$,Ne,Ae]),ht=v.useCallback(be=>{const Ge=be-Ne;if(Ge>=0){const ze=$.filter((tt,Qe)=>Qe!==Ge),Je=Ye(ze);Ae({characterConcepts:Je})}},[$,Ne,Ae,Ye]),ft=v.useCallback(()=>{const be={id:"",name:"",prompt:"",image:null},Ge=[...$,be],ze=Ye(Ge);Ae({characterConcepts:ze})},[$,Ae,Ye]),mt=v.useCallback(()=>{Ae({characterConcepts:[]}),z&&z(be=>be.filter(Ge=>!(Ge.toNodeId===e.id&&Ge.toHandleId==="character_data"))),S&&S(e.id),M&&M(u("toast.contentCleared"),"info")},[Ae,S,e.id,M,u,z]),dt=v.useCallback(be=>{if(be._sourceNodeId&&z&&I&&T){const Ge=I.find(ze=>ze.id===be._sourceNodeId);if(T.filter(ze=>ze.toNodeId===e.id&&ze.toHandleId==="character_data"),Ge&&Ge.type===L.CHARACTER_CARD){let ze=[];try{ze=JSON.parse(Ge.value||"[]")}catch{}Array.isArray(ze)||(ze=[ze]);let Je=0;$.forEach(Qe=>{const lt=(Qe.id||"").match(/(?:Character|Entity)-(\d+)/i);lt&&(Je=Math.max(Je,parseInt(lt[1],10)))});const tt=ze.map((Qe,lt)=>{var ct;return{id:`Entity-${Je+lt+1}`,name:Qe.name||`Entity ${Je+lt+1}`,prompt:Qe.prompt||"",image:((ct=Qe.thumbnails)==null?void 0:ct["1:1"])||Qe.image||null,fullDescription:Qe.fullDescription||""}});Ae({characterConcepts:[...$,...tt]}),z(Qe=>Qe.filter(lt=>!(lt.toNodeId===e.id&&lt.toHandleId==="character_data"))),M&&M(u("toast.pastedFromClipboard"),"success");return}}w&&w(e.id,be)},[I,T,z,$,Ae,w,e.id,M,u]),kt=v.useCallback((be,Ge)=>{const ze=be-Ne;if(ze<0)return;const Je=[...$],tt=Ge==="up"?ze-1:ze+1;if(tt>=0&&tt<Je.length){[Je[ze],Je[tt]]=[Je[tt],Je[ze]];const Qe=Ye(Je);Ae({characterConcepts:Qe})}},[$,Ne,Ae,Ye]),Ct=v.useCallback(be=>{Ae({conceptsMode:be})},[Ae]),vt=v.useCallback(()=>{if(K.length===0||!N)return;const Ge={x:e.position.x-1350,y:e.position.y},ze=N(L.PROMPT_SEQUENCE_EDITOR,Ge);t(ze,JSON.stringify({instruction:"",sourcePrompts:K,modifiedPrompts:[],checkedSourceFrameNumbers:[],selectedFrameNumber:null,styleOverride:ue,usedCharacters:Se,leftPaneRatio:.5})),G&&G([ze]),M&&M("Prompts detached to Prompt Sequence Editor (Left)","success")},[K,N,e,ue,Se,t,M,G]),yt=v.useCallback(()=>{Ae({prompts:[],images:{},frameStatuses:{}}),M&&M("All prompts cleared","info")},[Ae,M]),wt=v.useCallback(()=>{Ae({images:{}}),P(e.id),M&&M(u("toast.contentCleared"))},[Ae,P,e.id,M,u]),qn=v.useCallback(()=>{const Ge=[...oe.current.prompts||[]].map(ze=>({...ze,prompt:"",videoPrompt:"",shotType:"WS"}));Ae({prompts:Ge}),M&&M("Text prompts cleared","info")},[Ae,M]),Cn=v.useCallback(be=>{const Ge=[...oe.current.prompts||[]],ze=Ge.length>0?Math.max(...Ge.map(Qe=>Qe.frameNumber))+1:1,Je=Ge.length>0?Ge[Ge.length-1].sceneNumber:1,tt={frameNumber:ze,sceneNumber:Je,sceneTitle:"",prompt:"",videoPrompt:"",shotType:"WS",characters:[],duration:3,isCollapsed:!0};if(be!==void 0&&be!==-1){const Qe=Ge.findIndex(lt=>lt.frameNumber===be);if(Qe!==-1){Ge.splice(Qe+1,0,tt);const lt=Ge.map((ct,Ht)=>({...ct,frameNumber:Ht+1}));Ae({prompts:lt});return}}Ae({prompts:[...Ge,tt]}),setTimeout(()=>{var Qe;return(Qe=R.current)==null?void 0:Qe.scrollToBottom()},100)},[Ae]),Pt=v.useCallback(()=>{const be=[...oe.current.prompts||[]],ze=(be.length>0?Math.max(...be.map(Qe=>Qe.sceneNumber||1)):0)+1,tt={frameNumber:be.length>0?Math.max(...be.map(Qe=>Qe.frameNumber))+1:1,sceneNumber:ze,sceneTitle:`Scene ${ze}`,prompt:"",videoPrompt:"",shotType:"WS",characters:[],duration:3,isCollapsed:!1};Ae({prompts:[...be,tt]}),setTimeout(()=>{var Qe;return(Qe=R.current)==null?void 0:Qe.scrollToBottom()},100)},[Ae]),je=v.useCallback(be=>{if(!B||!F)return;const Ge=T==null?void 0:T.find(ze=>ze.toNodeId===e.id&&ze.toHandleId==="prompt_input");Ge&&F(Ge.fromNodeId,be)},[B,F,T,e.id]),Ve=v.useCallback(be=>{const Ge=oe.current.prompts||[],ze=oe.current.collapsedScenes||[],Je=Ge.find(ct=>ct.frameNumber===be);if(!Je)return;const tt=Je.sceneNumber||1;let Qe=[...ze];Qe.includes(tt)&&(Qe=Qe.filter(ct=>ct!==tt));let lt=Ge;Je.isCollapsed&&(lt=Ge.map(ct=>ct.frameNumber===be?{...ct,isCollapsed:!1}:ct)),Ae({collapsedScenes:Qe,prompts:lt,selectedFrameNumber:be}),R.current&&setTimeout(()=>{R.current.scrollToFrame(be)},50)},[Ae]),Ke=v.useCallback(()=>{z&&e.id&&(z(be=>be.filter(Ge=>!(Ge.toNodeId===e.id&&Ge.toHandleId==="prompt_input"))),M&&M("Unlinked from source. Data copied to local.","info"))},[z,e.id,M]),Xe=(be,Ge)=>{if(!be)return null;const ze=tt=>String(tt).toLowerCase().replace(/[^a-z0-9]/g,""),Je=ze(be);return Ge.find(tt=>!!(tt.index&&ze(tt.index)===Je||tt.alias&&ze(tt.alias)===Je||tt.name&&ze(tt.name)===Je||tt.id&&ze(tt.id)===Je))},rt=v.useCallback(be=>{const Ge=K.find(lt=>lt.frameNumber===be);if(!Ge)return;const ze=ie.integrationPrompt||_s,Je=Ge.shotType?u(`image_sequence.shot_type.${Ge.shotType}`):"";let tt=`${ze}
${Je}`;if(ie.isSceneContextInserted){const lt=Ce[String(Ge.sceneNumber||1)];lt&&lt.trim()&&(tt+=`

${lt.trim()}`)}let Qe=Ge.prompt;ie.characterPromptCombination==="replace"&&(Qe=Qe.replace(/((?:Character|Entity)[-\s]?\d+|(?:Character|Entity)[-\s]?\w+)/gi,lt=>{const ct=Xe(lt,He);return ct&&ct.prompt?`${lt} (${ct.prompt})`:lt})),tt+=`

${Qe}`,ie.isStyleInserted&&ie.styleOverride&&(tt+=`

[Visual Style]: ${ie.styleOverride}`),navigator.clipboard.writeText(tt),M&&M("Combined prompt copied to clipboard","success")},[K,ie,He,Ce,u,M]),ot=v.useCallback(be=>{if(m(e.id,1e3+be)||Z[be]){const Je=K.filter(lt=>m(e.id,1e3+lt.frameNumber)||Z[lt.frameNumber]),tt=Je.map(lt=>({src:m(e.id,1e3+lt.frameNumber)||Z[lt.frameNumber],frameNumber:lt.frameNumber,prompt:lt.prompt})),Qe=Je.findIndex(lt=>lt.frameNumber===be);Qe!==-1&&g({sources:tt,initialIndex:Qe})}},[Z,K,g,m,e.id]),et=v.useCallback(be=>{if(!N)return;let Ge=null;if(H.current){const ze=I==null?void 0:I.find(Je=>Je.id===H.current);ze&&ze.type===L.IMAGE_EDITOR?Ge=ze.id:H.current=null}if(Ge){const ze=I==null?void 0:I.find(Je=>Je.id===Ge);if(ze){const Je=JSON.parse(ze.value||"{}"),tt=Je.inputImages||[];Rt(be,256,256).then(Qe=>{const lt=[...tt,Qe];t(Ge,JSON.stringify({...Je,inputImages:lt})),x(Ge,tt.length+1,be)})}}else{const ze={x:e.position.x+e.width+100,y:e.position.y};Ge=N(L.IMAGE_EDITOR,ze),H.current=Ge,t(Ge,JSON.stringify({inputImages:[be],prompt:"",aspectRatio:ce,enableAspectRatio:!0,model:"gemini-2.5-flash-image"})),x(Ge,1,be),Rt(be,256,256).then(Je=>{t(Ge,JSON.stringify({inputImages:[Je],prompt:"",aspectRatio:ce,enableAspectRatio:!0,model:"gemini-2.5-flash-image"}))})}Ge&&G&&G([Ge])},[N,e,I,t,x,G,ce]),bt=v.useCallback(be=>{const Ge=oe.current.imageDimensions||{},ze=K.filter(Je=>{const tt=Ge[Je.frameNumber];if(!tt)return!1;const Qe=tt.width/tt.height;return be==="landscape"?Qe>1.2:be==="portrait"?Qe<.85:be==="square"?Qe>=.85&&Qe<=1.2:!1}).map(Je=>Je.frameNumber);ze.length===0?M&&M("No images match this aspect ratio","info"):Ae({checkedFrameNumbers:ze})},[K,Ae,M]),_t=v.useCallback((be,Ge)=>{const ze=oe.current.imageDimensions||{},tt=K.filter(Qe=>(Qe.sceneNumber||1)===be).filter(Qe=>{const lt=ze[Qe.frameNumber];if(!lt)return!1;const ct=lt.width/lt.height;return Ge==="landscape"?ct>1.2:Ge==="portrait"?ct<.85:Ge==="square"?ct>=.85&&ct<=1.2:!1}).map(Qe=>Qe.frameNumber);tt.length===0?M&&M(`No ${Ge} images found in Scene ${be}`,"info"):Ae({checkedFrameNumbers:tt})},[K,Ae,M]),xt=v.useCallback(async()=>{var ze,Je;const be=[...ae].sort((tt,Qe)=>tt-Qe);if(be.length===0)return;const Ge=sessionStorage.getItem("download_permission_shown");if(!Re&&be.length>1&&!Ge&&se(!0),Re){le(0);try{const tt=Li.default||Li,Qe=new tt,lt=new Date,ct=lt.toISOString().split("T")[0],Ht=lt.toTimeString().split(" ")[0].replace(/:/g,"-");let At=0;for(const an of be){const Xo=m(e.id,1e3+an)||Z[an];if(Xo&&Xo.startsWith("data:image")){const Va=String(an).padStart(3,"0"),fc=((ze=Xo.match(/image\/(png|jpeg|jpg)/))==null?void 0:ze[1])||"png",xc=await(await fetch(Xo)).blob();Qe.file(`Frame_${Va}_seq_gen_${ct}_${Ht}.${fc}`,xc),At++}}if(At===0){M&&M("No valid images found to ZIP","error"),le(null);return}const qt=await Qe.generateAsync({type:"blob",compression:"STORE"},an=>{le(an.percent)}),kn=document.createElement("a");kn.href=URL.createObjectURL(qt),kn.download=`Image_Sequence_${ct}_${Ht}.zip`,document.body.appendChild(kn),kn.click(),document.body.removeChild(kn),URL.revokeObjectURL(kn.href),M&&M("ZIP archive downloaded","success")}catch(tt){console.error("ZIP Error:",tt),M&&M("Failed to create ZIP","error")}finally{le(null)}}else{const tt=new Date,Qe=tt.toISOString().split("T")[0],lt=tt.toTimeString().split(" ")[0].replace(/:/g,"-");for(const ct of be){const Ht=m(e.id,1e3+ct)||Z[ct];if(Ht){const At=((Je=K.find(an=>an.frameNumber===ct))==null?void 0:Je.prompt)||"",kn=`Frame_${String(ct).padStart(3,"0")}_seq_gen_${Qe}_${lt}.png`;c(Ht,ct,At,kn),M&&M(u("toast.downloadStarted"),"success"),await new Promise(an=>setTimeout(an,300))}}}},[ae,Re,m,e.id,Z,K,c,M,u]),Nt=v.useCallback(()=>{const be={...Q};Object.keys(be).forEach(Ge=>{be[Number(Ge)]!=="done"&&(be[Number(Ge)]="idle")}),Ae({frameStatuses:be}),S&&S(e.id)},[Q,Ae,S,e.id]),It=v.useCallback(async(be,Ge)=>{var tt;const ze=m(e.id,1e3+be)||Z[be];if(!ze)return;const Je=((tt=K.find(Qe=>Qe.frameNumber===be))==null?void 0:tt.prompt)||"";try{const Qe={...oe.current.frameStatuses};Qe[be]="generating",Ae({frameStatuses:Qe});const lt=oe.current.model||"gemini-2.5-flash-image",ct=await Bp(ze,Ge,Je,lt),Ht=await Rt(ct,128,128);x(e.id,1e3+be,ct);const At={...oe.current.images,[be]:Ht},qt={...oe.current.frameStatuses,[be]:"done"};Ae({images:At,frameStatuses:qt})}catch(Qe){M&&M(`Expansion failed: ${Qe.message}`,"error");const lt={...oe.current.frameStatuses,[be]:"error"};Ae({frameStatuses:lt})}},[m,e.id,Z,K,Ae,M,x]),Zo=v.useCallback(async be=>{const Ge=[...ae].sort((ze,Je)=>ze-Je);if(Ge.length!==0)for(const ze of Ge)await It(ze,be)},[ae,It]),tc=v.useCallback(be=>{be.preventDefault(),be.stopPropagation();const Ge=(O==null?void 0:O.scale)||1;q.current={startX:be.clientX,startWidth:oe.current.leftPaneWidth||Ro};const ze=tt=>{const Qe=q.current;if(!Qe)return;const lt=(tt.clientX-Qe.startX)/Ge,ct=Qe.startWidth+lt,Ht=e.width-u0,At=Math.max(Ro,Math.min(ct,Ht));Ae({leftPaneWidth:At})},Je=()=>{q.current=null,window.removeEventListener("mousemove",ze),window.removeEventListener("mouseup",Je)};window.addEventListener("mousemove",ze),window.addEventListener("mouseup",Je)},[Ae,O,e.width]),Gi=v.useCallback(()=>{if(!j)return null;const be=j(e.id,"prompt_input");if(!be||be.length===0)return null;const Ge=new Map;let ze=ue,Je=Se,tt=Ce,Qe=1;return be.forEach(lt=>{if(typeof lt=="string")try{const ct=JSON.parse(lt);let Ht=[];if(ct.type==="script-prompt-modifier-data"){if(Ht=ct.finalPrompts||ct.prompts||[],ct.styleOverride&&(ze=ct.styleOverride),ct.usedCharacters&&(Je=ct.usedCharacters),ct.sceneContexts&&(tt=ct.sceneContexts),ct.videoPrompts){const At=new Map(ct.videoPrompts.map(qt=>[qt.frameNumber,qt]));Ht=Ht.map(qt=>({...qt,videoPrompt:qt.videoPrompt||At.get(qt.frameNumber)||""}))}}else if(ct.sourcePrompts||ct.modifiedPrompts){const At=ct.sourcePrompts||[],qt=ct.modifiedPrompts||[],kn=new Map;At.forEach(an=>kn.set(an.frameNumber,an)),qt.forEach(an=>kn.set(an.frameNumber,{...kn.get(an.frameNumber),...an})),Ht=Array.from(kn.values()),ct.styleOverride&&(ze=ct.styleOverride),ct.usedCharacters&&(Je=ct.usedCharacters),ct.sceneContexts&&(tt=ct.sceneContexts)}else Array.isArray(ct)&&(Ht=ct);Ht.length>0&&Ht.forEach(At=>{const qt=At.frameNumber!==void 0?At.frameNumber:Qe++,an=(oe.current.prompts||[]).find(Va=>Va.frameNumber===qt),Xo=an?an.isCollapsed:!0;Ge.set(qt,{frameNumber:qt,sceneNumber:At.sceneNumber||1,sceneTitle:At.sceneTitle||"",prompt:At.prompt||"",videoPrompt:At.videoPrompt||"",shotType:At.shotType||At.ShotType||"WS",characters:At.characters||[],duration:At.duration||3,isCollapsed:Xo})})}catch{}}),Ge.size>0?{prompts:Array.from(Ge.values()).sort((lt,ct)=>lt.frameNumber-ct.frameNumber),styleOverride:ze,usedCharacters:Je,sceneContexts:tt}:null},[j,e.id,ue,Se,Ce]);v.useEffect(()=>{if(B&&!s){const be=Gi();if(be){const Ge=JSON.stringify(oe.current.prompts),ze=JSON.stringify(be.prompts),Je=oe.current.styleOverride,tt=JSON.stringify(oe.current.usedCharacters),Qe=JSON.stringify(be.usedCharacters),lt=JSON.stringify(oe.current.sceneContexts),ct=JSON.stringify(be.sceneContexts);(Ge!==ze||Je!==be.styleOverride||tt!==Qe||lt!==ct)&&Ae(be)}}},[B,Gi,Ae,s]);const nc=be=>{const Ge=ge.current;Ge!==null&&(x(e.id,1e3+Ge,be),Rt(be,128,128).then(ze=>Ae({images:{...Z,[Ge]:ze}})))},oc=(be,Ge)=>{const ze=Ie[be].originalIndex,Je=[...Se];Je[ze]&&(Je[ze]={...Je[ze],name:Ge},Ae({usedCharacters:Je}))},rc=()=>Ae({isUsedCharsCollapsed:!me}),ac=()=>Ae({isStyleCollapsed:!he}),ic=be=>Ae({isStyleInserted:be}),sc=be=>Ae({isSceneContextInserted:be}),lc=()=>Ae({isIntegrationSettingsCollapsed:!_e}),cc=()=>Ae({isCharacterPromptCombinationCollapsed:!pe}),dc=v.useCallback(be=>{navigator.clipboard.writeText(be),M&&M(u("toast.copiedToClipboard"),"info")},[M,u]),uc=v.useCallback(be=>{navigator.clipboard.writeText(be),M&&M(u("toast.copiedToClipboard"),"info")},[M,u]),pc=v.useCallback((be,Ge,ze)=>{var tt,Qe;const Je=oe.current.imageDimensions||{};((tt=Je[be])==null?void 0:tt.width)===Ge&&((Qe=Je[be])==null?void 0:Qe.height)===ze||Ae({imageDimensions:{...Je,[be]:{width:Ge,height:ze}}})},[Ae]),hc=(be,Ge)=>{const ze={...Ce,[be]:Ge};Ae({sceneContexts:ze})},mc=be=>{const Ge=qe||[],ze=Ge.includes(be)?Ge.filter(Je=>Je!==be):[...Ge,be];Ae({expandedSceneContexts:ze})},gc=be=>{const Ge=Be||[],ze=Ge.includes(be)?Ge.filter(Je=>Je!==be):[...Ge,be];Ae({checkedContextScenes:ze})};return n.jsxs("div",{className:"flex h-full w-full space-x-2",onWheel:be=>be.stopPropagation(),children:[n.jsx(ec,{isOpen:ne,onClose:()=>{X(!1),ge.current=null},onApply:nc,imageSrc:re}),n.jsxs("div",{ref:U,className:"h-full flex flex-col flex-shrink-0",style:{width:`${Te}px`},children:[n.jsx("div",{className:"flex-shrink-0 flex flex-col transition-all duration-300 ease-in-out relative z-10",style:{height:typeof Jt=="string"?Jt:`${Jt}px`},children:n.jsx(qj,{allConcepts:He,characterConcepts:$,conceptSortOrder:[],onUpdateConcept:st,onDeleteConcept:ht,onMoveConcept:kt,onAddConcept:ft,onDetachConnectedConcept:be=>dt(be),onClearConcepts:mt,handleViewImage:be=>g({sources:[{src:be,frameNumber:0}],initialIndex:0}),t:u,deselectAllNodes:p,conceptsMode:Le,onToggleMode:Ct,duplicateIndices:$e})}),Le!=="expanded"&&n.jsxs("div",{className:"flex-grow flex flex-col min-h-0 pt-2",children:[n.jsxs("div",{className:"flex flex-col space-y-1 mb-1 flex-shrink-0",children:[n.jsxs("div",{className:`flex justify-between items-center cursor-pointer hover:bg-gray-700/50 rounded-md px-1 transition-colors group ${Fe.hasError?"bg-red-900/30":Fe.allValid?"bg-accent-secondary/20":""}`,onClick:rc,children:[n.jsxs("label",{className:`text-[10px] font-bold uppercase cursor-pointer py-1 flex-grow flex items-center gap-2 ${Fe.hasError?"text-red-400":Fe.allValid?"text-connection-text":"text-gray-400"}`,children:[Fe.hasError?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}):Fe.allValid?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-connection-text",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):null," ",Fe.allValid&&n.jsx("span",{className:"text-[9px] font-normal text-connection-text ml-1",children:"( )"})]}),n.jsx("div",{className:"text-gray-500 group-hover:text-gray-300 p-1",children:me?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!me&&n.jsx("div",{onWheel:be=>be.stopPropagation(),className:"bg-gray-700/50 p-2 rounded-md border border-gray-600 max-h-32 overflow-y-auto custom-scrollbar",children:Ie.length>0?Ie.map((be,Ge)=>{const ze=Fe.results[Ge]||{status:"missing"};let Je=null,tt="text-gray-400",Qe="";return ze.status==="match"?(Je=n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-accent-secondary",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),tt="text-connection-text",Qe="   "):ze.status==="mismatch_name"?(Je=n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),tt="text-red-400",Qe=`  (${be.index}),   . : "${ze.expectedName}"`):ze.status==="mismatch_index"?(Je=n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),tt="text-red-400",Qe=`  ("${be.name}"),   .   : ${ze.expectedIndex}`):(Je=n.jsx("span",{className:"text-gray-600 text-[10px]",children:""}),Qe="    "),n.jsxs("div",{className:"flex items-center gap-2 mb-1 last:mb-0 group/item",title:Qe,children:[n.jsx("div",{className:"w-4 flex-shrink-0 flex items-center justify-center",children:Je}),n.jsxs("span",{className:`text-[10px] font-mono w-20 shrink-0 truncate ${tt}`,children:[be.index,":"]}),n.jsx("input",{type:"text",value:be.name,onChange:lt=>oc(Ge,lt.target.value),className:`flex-grow bg-gray-800 border-none rounded px-1.5 py-0.5 text-[10px] outline-none focus:ring-1 focus:ring-cyan-500 ${ze.status.startsWith("mismatch")?"text-red-200 bg-red-900/20":"text-gray-200"}`,onMouseDown:lt=>lt.stopPropagation()})]},Ge)}):n.jsx("div",{className:"text-[10px] text-gray-500 italic",children:"  ."})})]}),n.jsxs("div",{className:"flex flex-col space-y-1 mb-2 flex-shrink-0",children:[n.jsxs("div",{className:"flex justify-between items-center cursor-pointer hover:bg-gray-700/50 rounded-md px-1 transition-colors group",onClick:lc,children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase cursor-pointer py-1 flex-grow",children:" "}),n.jsx("div",{className:"text-gray-500 group-hover:text-gray-300 p-1",children:_e?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!_e&&n.jsx(Tn,{value:xe,onDebouncedChange:be=>Ae({integrationPrompt:be}),placeholder:"Integrate these Entities into the scene...",className:"w-full p-2 bg-gray-700 border-none rounded-md resize-none focus:outline-none text-xs",style:{minHeight:"60px"},onMouseDown:be=>be.stopPropagation(),onWheel:be=>be.stopPropagation()})]}),n.jsx("div",{onWheel:be=>be.stopPropagation(),className:"flex-shrink-0 flex flex-col space-y-2 mb-2",children:n.jsxs("div",{className:"flex flex-col space-y-1",children:[n.jsxs("div",{className:"flex justify-between items-center cursor-pointer hover:bg-gray-700/50 rounded-md px-1 transition-colors group",onClick:cc,children:[n.jsxs("label",{className:"text-[10px] font-bold text-gray-400 uppercase cursor-pointer py-1 flex-grow",children:[u("image_sequence.character_prompt_combination"),J!=="none"&&n.jsxs("span",{className:"text-connection-text font-normal ml-1 normal-case",children:["(",u(J==="combine"?"image_sequence.combination_combine":"image_sequence.combination_replace"),")"]})]}),n.jsx("div",{className:"text-gray-500 group-hover:text-gray-300 p-1",children:pe?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!pe&&n.jsxs("div",{className:"flex items-center space-x-4 bg-gray-800/50 p-2 rounded-md border border-gray-700",children:[n.jsx(Ot,{checked:J==="combine",onChange:be=>Ae({characterPromptCombination:be?"combine":"none"}),label:u("image_sequence.combination_combine"),title:"     ."}),n.jsx(Ot,{checked:J==="replace",onChange:be=>Ae({characterPromptCombination:be?"replace":"none"}),label:u("image_sequence.combination_replace"),title:"  (. Character-1)     ."})]})]})}),n.jsxs("div",{className:"flex flex-col space-y-1 mb-2 flex-shrink-0",children:[n.jsxs("div",{className:"flex justify-between items-center cursor-pointer hover:bg-gray-700/50 rounded-md px-1 transition-colors group",onClick:ac,children:[n.jsxs("div",{className:"flex items-center gap-2 flex-grow",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase cursor-pointer py-1",children:u("node.content.style")}),n.jsx("div",{onClick:be=>be.stopPropagation(),children:n.jsx(Ot,{checked:ye,onChange:ic,title:"      .",label:" "})}),n.jsx("div",{onClick:be=>be.stopPropagation(),className:"ml-2",children:n.jsx(Ot,{checked:ve,onChange:sc,title:"         .",label:u("node.content.insertSceneContext")})})]}),n.jsx("div",{className:"text-gray-500 group-hover:text-gray-300 p-1",children:he?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!he&&n.jsx(Tn,{value:ue,onDebouncedChange:be=>Ae({styleOverride:be}),className:"w-full p-2 bg-gray-700 border-none rounded-md resize-none focus:outline-none text-xs",style:{minHeight:"60px"},onMouseDown:be=>be.stopPropagation(),onWheel:be=>be.stopPropagation()})]}),n.jsx("div",{className:"w-full h-0.5 bg-gray-600/80 my-3 flex-shrink-0"}),n.jsx(Wj,{ref:R,prompts:K,collapsedScenes:Ee,checkedFrameNumbers:ae,selectionKey:"checkedFrameNumbers",selectedFrameNumber:W,isLinked:!!B,onUpdatePrompts:Ae,onLoadFile:()=>o(e.id),onSaveToCatalog:()=>b(e.id),onSaveToDisk:()=>D(e.id),t:u,onSelect:be=>Ae({selectedFrameNumber:be}),onToggleCollapse:be=>{const Ge=K.map(ze=>ze.frameNumber===be?{...ze,isCollapsed:!ze.isCollapsed}:ze);Ae({prompts:Ge})},onToggleScene:be=>{const Ge=Ee.includes(be)?Ee.filter(ze=>ze!==be):[...Ee,be];Ae({collapsedScenes:Ge})},onDetachToEditor:vt,onClearAll:yt,onAddPrompt:Cn,onAddScene:Pt,onDeletePrompt:be=>{const Ge=K.filter(ze=>ze.frameNumber!==be);Ae({prompts:Ge})},onMovePromptUp:()=>{},onMovePromptDown:()=>{},onMoveToStart:()=>{},onMoveToEnd:()=>{},onRegenerate:be=>l(e.id,be),isAnyGenerationInProgress:at,onEditInSource:je,onEditPrompt:Ve,isGeneratingSequence:!!s,allConceptsLength:He.length,onUnlink:Ke,addToast:M,onClearTextOnly:qn,sceneContexts:Ce,onUpdateSceneContext:hc,expandedSceneContexts:qe,onToggleSceneContext:mc,onCopyCombinedPrompt:rt,checkedContextScenes:Be,onToggleContextCheck:gc})]})]}),n.jsx("div",{onMouseDown:tc,className:"w-2 h-full bg-gray-700/50 hover:bg-cyan-600 cursor-col-resize rounded transition-colors flex-shrink-0"}),n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-w-0",style:{width:"0",flexGrow:1,position:"relative"},children:[te!==null&&n.jsxs("div",{className:"absolute inset-0 z-50 bg-gray-900/90 backdrop-blur-sm flex flex-col items-center justify-center rounded-md",children:[n.jsx("div",{className:"text-cyan-400 font-bold text-lg mb-4 animate-pulse",children:"Archiving Sequence..."}),n.jsx("div",{className:"w-64 h-4 bg-gray-700 rounded-full overflow-hidden border border-gray-600 shadow-inner",children:n.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-600 to-blue-500 transition-all duration-100 ease-out relative",style:{width:`${te}%`},children:n.jsx("div",{className:"absolute inset-0 bg-white/20 animate-[progress-bar-stripes_1s_linear_infinite]",style:{backgroundImage:"linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent)",backgroundSize:"1rem 1rem"}})})}),n.jsxs("div",{className:"text-gray-300 font-mono mt-2",children:[te.toFixed(0),"%"]})]}),ee&&Ba.createPortal(n.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 backdrop-blur-sm flex flex-col items-center justify-start pt-20 text-center animate-fade-in",onClick:be=>be.stopPropagation(),children:n.jsxs("div",{className:"bg-gray-800 p-6 rounded-xl border border-cyan-500 shadow-2xl max-w-md mx-4 relative",children:[n.jsx("div",{className:"absolute -top-12 right-4 md:right-1/4 animate-bounce text-cyan-400",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 10l7-7m0 0l7 7m-7-7v18"})})}),n.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:" "}),n.jsxs("p",{className:"text-gray-300 mb-6 text-sm leading-relaxed",children:["    .",n.jsx("br",{}),",             ",n.jsx("b",{children:'" "'})," (Allow automatic downloads)."]}),n.jsx("button",{onClick:()=>{se(!1),sessionStorage.setItem("download_permission_shown","true")},className:"w-full py-2 bg-cyan-600 hover:bg-cyan-700 text-white font-bold rounded transition-colors",children:""})]})}),document.body),n.jsx(Jj,{prompts:K,images:Z,frameStatuses:Q,selectedFrameNumber:W,checkedFrameNumbers:ae,collapsedOutputScenes:Me,isGeneratingSequence:!!s,isAnyFrameGenerating:We,t:u,onUpdateState:be=>{be.sequenceOutputs&&be.sequenceOutputs.length===0?wt():Ae(be)},groupedPrompts:Oe,onRegenerate:be=>l(e.id,be),onDownload:(be,Ge)=>{const ze=m(e.id,1e3+be)||Z[be];if(ze){const Je=new Date,tt=Je.toISOString().split("T")[0],Qe=Je.toTimeString().split(" ")[0].replace(/:/g,"-"),ct=`Frame_${String(be).padStart(3,"0")}_seq_gen_${tt}_${Qe}.png`;c(ze,be,Ge,ct),M&&M(u("toast.downloadStarted"),"success")}},onCopy:be=>d(m(e.id,1e3+be)||Z[be]),onCopyPrompt:dc,onCopyVideoPrompt:uc,onStopFrame:be=>i(),onFrameSelect:be=>Ae({selectedFrameNumber:be}),onFrameDoubleClick:ot,onCheckFrame:(be,Ge)=>{if(Ge)Ae({checkedFrameNumbers:[be]});else{const ze=oe.current.checkedFrameNumbers||[],Je=ze.includes(be)?ze.filter(tt=>tt!==be):[...ze,be];Ae({checkedFrameNumbers:Je})}},onOpenRaster:(be,Ge)=>{de(Ge),ge.current=be,X(!0)},onOpenAI:et,onReplaceImage:(be,Ge)=>{x(e.id,1e3+be,Ge),Ae({images:{...Z,[be]:Ge}})},onEditPrompt:Ve,onEditInSource:je,readOnlyPrompt:!!B,getFullSizeImage:be=>m(e.id,be),onSelectByAspectRatio:bt,onSelectSceneByAspectRatio:_t,onSelectAll:()=>Ae({checkedFrameNumbers:K.map(be=>be.frameNumber)}),onSelectNone:()=>Ae({checkedFrameNumbers:[]}),onInvertSelection:()=>{const be=oe.current.checkedFrameNumbers||[],ze=K.map(Je=>Je.frameNumber).filter(Je=>!be.includes(Je));Ae({checkedFrameNumbers:ze})},onRunSelected:()=>a(e.id),onDownloadSelected:xt,onForceRefresh:Nt,onExpandFrame:It,onExpandSelected:Zo,onReportDimensions:pc,onClearImages:wt,onCopyCombinedPrompt:rt}),n.jsx(Yj,{model:V,autoCrop169:De,autoDownload:fe,createZip:Re,isGeneratingSequence:!!s,isAnyFrameGenerating:We,checkedCount:ae.length,promptsLength:K.length,onUpdateState:Ae,onGenerateSelected:()=>a(e.id),onDownloadSelected:xt,onStartQueue:()=>r(e.id,0),onExpandSelected:Zo,t:u})]})]})},eT=({instruction:e,onInstructionChange:t,targetLanguage:o,onLanguageChange:r,modificationModel:a,onModelChange:i,includeVideoPrompts:s,onToggleVideoPrompts:l,isModifying:c,onModify:d,checkedCount:u,checkedContextCount:p=0,totalPrompts:h,instructionInputId:w,t:k})=>{const{secondaryLanguage:b}=St(),y=c||h===0||u===0&&p===0;return n.jsxs("div",{className:"flex-shrink-0 space-y-2",children:[n.jsx(Tn,{id:w,value:e,onDebouncedChange:t,placeholder:k("prompt_sequence_editor.instructionPlaceholder"),className:"w-full p-2 bg-gray-700 border-none rounded-md resize-y focus:ring-2 focus:ring-accent focus:outline-none",rows:2,style:{minHeight:"80px",maxHeight:"200px"},onWheel:g=>g.stopPropagation()}),n.jsx("div",{className:"flex flex-col space-y-2",children:n.jsxs("div",{className:"flex items-center space-x-2 h-10",children:[n.jsx("button",{onClick:()=>r("en"),className:`h-10 px-3 rounded-md text-xs font-bold transition-colors flex items-center justify-center ${o==="en"?"bg-accent text-white":"bg-gray-900 text-gray-400 hover:text-white hover:bg-gray-700"}`,children:"EN"}),n.jsx("button",{onClick:()=>r(b),className:`h-10 px-3 rounded-md text-xs font-bold transition-colors flex items-center justify-center ${o===b?"bg-accent text-white":"bg-gray-900 text-gray-400 hover:text-white hover:bg-gray-700"}`,title:fn[b].name,children:fn[b].short}),n.jsx("button",{onClick:()=>i("gemini-3-flash-preview"),className:`h-10 px-3 rounded-md text-xs font-bold transition-colors flex items-center justify-center ${a==="gemini-3-flash-preview"?"bg-accent text-white":"bg-gray-900 text-gray-400 hover:text-white hover:bg-gray-700"}`,title:"Gemini 3.0 Flash",children:"Flash"}),n.jsx("button",{onClick:()=>i("gemini-3-pro-preview"),className:`h-10 px-3 rounded-md text-xs font-bold transition-colors flex items-center justify-center ${a==="gemini-3-pro-preview"?"bg-accent text-white":"bg-gray-900 text-gray-400 hover:text-white hover:bg-gray-700"}`,title:"Gemini 3.0 Pro",children:"Pro"}),n.jsx("button",{onClick:l,className:`h-10 w-10 rounded-md transition-colors flex items-center justify-center ${s?"bg-accent text-white":"bg-gray-900 text-gray-400 hover:text-white hover:bg-gray-700"}`,title:"Generate/Modify Video Prompts",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),n.jsx("button",{onClick:d,disabled:y,className:"flex-grow h-10 px-4 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed flex items-center justify-center",children:c?k("prompt_sequence_editor.modifying"):k("prompt_sequence_editor.modifySelected",{count:u})})]})})]})},Su=260,Nu=180,ly=44,p0=36,tT=160,nT=32,cy={WS:"Integrate the character/object with a Wide Shot (WS) into the scene and action. Show the environment.",MS:"Integrate the character/object with a Medium Shot (MS) into the scene. Character from waist up.",CU:"Integrate the character/object with a Close-Up (CU) into the scene.",ECU:"Integrate the character/object with an Extreme Close-Up (ECU) into the scene. Maximum detail.",LS:"Integrate the character/object with a Long Shot (LS) into the scene to show scale."},Ws=({value:e,onChange:t,min:o,className:r,placeholder:a,title:i})=>{const s=c=>{const d=parseInt(e,10);let u=isNaN(d)?o||0:d+c;o!==void 0&&u<o&&(u=o),t(u.toString())},l=c=>{const d=c.target.value;if(d===""){t("");return}const u=parseInt(d,10);isNaN(u)||t(d)};return n.jsxs("div",{className:`flex items-center bg-gray-600 rounded px-1 h-5 ${r}`,title:i,children:[n.jsx("input",{type:"number",min:o,value:e,onChange:l,placeholder:a,className:"w-6 bg-transparent text-[10px] text-white text-center border-none p-0 focus:outline-none focus:ring-1 focus:ring-cyan-500 rounded-sm [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",onClick:c=>c.stopPropagation(),onMouseDown:c=>c.stopPropagation()}),n.jsxs("div",{className:"flex flex-col h-full ml-0.5 -mr-0.5",children:[n.jsx("button",{className:"h-2.5 flex items-center justify-center hover:text-white text-gray-300 transition-colors",onClick:c=>{c.stopPropagation(),s(1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),n.jsx("button",{className:"h-2.5 flex items-center justify-center hover:text-white text-gray-300 transition-colors",onClick:c=>{c.stopPropagation(),s(-1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})},oT=["WS","MS","CU","ECU","LS"],dy=jt.memo(({index:e,frameNumber:t,sceneNumber:o,prompt:r,videoPrompt:a,shotType:i,characters:s,duration:l,isSelected:c,isCollapsed:d,onToggleCollapse:u,onSelect:p,onChange:h,onDelete:w,onAddAfter:k,onCopy:b,onCopyVideo:y,onMoveUp:g,onMoveDown:m,onMoveToSource:x,onMoveToStart:_,onMoveToEnd:S,isFirst:P,isLast:j,t:M,readOnly:D=!1,isChecked:O,onCheck:B,style:E,onEditInSource:I,onEditPrompt:N,showVideoPrompts:T=!0,showSceneInfo:F=!0,onCopyCombinedPrompt:z})=>{const G=v.useCallback((te,le)=>{if(D||le<1)return;const ee=(s||[])[te],se=`Entity-${le}`,ie=[...s||[]];ie[te]=se;const oe=ee.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),A=new RegExp(`\\(${oe}\\)`,"gi"),K=r.replace(A,`(${se})`);h(t,{characters:ie,prompt:K})},[D,s,r,h,t]),U=v.useCallback(te=>{if(D)return;const le=(s||[])[te],ee=(s||[]).filter((A,K)=>K!==te),se=le.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),ie=new RegExp(`\\s*\\(${se}\\)`,"gi"),oe=r.replace(ie,"").trim().replace(/,\s*$/,"");h(t,{characters:ee,prompt:oe})},[D,s,r,h,t]),R=v.useCallback(te=>{if(D)return;const le=`[${te}] ${r}`;h(t,{prompt:le})},[D,r,h,t]),q=v.useCallback(()=>{if(D)return;const te=s||[],le=te.map(oe=>parseInt(oe.replace(/(?:character|entity)-/i,""),10)).filter(oe=>!isNaN(oe));let ee=1;for(;le.includes(ee);)ee++;const se=`Entity-${ee}`,ie=[...te,se];h(t,{characters:ie})},[D,s,h,t]),H=te=>{if(D)return;const le=te,ee=K=>(K.match(/(?:character|entity)-\d+/gi)||[]).map(W=>W.toLowerCase()).sort().join(","),se=ee(r),ie=ee(le),oe=se!==ie,A={prompt:le};if(oe){const K=le.match(/(?:character|entity)-\d+/gi)||[],Z=[...new Set(K.map(W=>W.replace(/character-/i,"Entity-").replace(/entity-/i,"Entity-")))];A.characters=Z}h(t,A)},ne=te=>{D||h(t,{videoPrompt:te})},X=te=>{D||h(t,{shotType:te.target.value})},de=`FRAME-${String(t).padStart(3,"0")}${i?`, [${i}]`:""}`,ge=i?cy[i]:void 0;return n.jsxs("div",{onClick:()=>p(t),style:{...E,height:d?`${ly}px`:T?ge?`${Su+30}px`:`${Su}px`:ge?`${Nu+30}px`:`${Nu}px`},className:`relative group bg-gray-700 p-2 rounded-lg border-2 overflow-hidden mb-1 ${c?"border-connection-text shadow-[0_0_15px_var(--color-connection-text)]":"border-transparent hover:border-gray-600"}`,children:[n.jsxs("div",{className:"flex justify-between items-center mb-1 h-[28px] gap-2 cursor-pointer",onClick:te=>{te.stopPropagation(),u(t)},children:[n.jsxs("div",{className:"flex items-center space-x-2 flex-1 overflow-hidden",children:[B&&n.jsx("div",{className:"flex-shrink-0",onClick:te=>te.stopPropagation(),title:"Select frame for batch modification",children:n.jsx(Ot,{checked:!!O,onChange:(te,le)=>B(t,le.shiftKey),className:"h-5 w-5"})}),n.jsx(Pe,{tooltipPosition:"right",title:M(d?"node.action.expand":"node.action.collapse"),onClick:te=>{te.stopPropagation(),u(t)},children:d?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7M19 5l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),n.jsx("h4",{className:"text-[10px] font-black text-gray-200 flex-shrink-0 whitespace-nowrap uppercase tracking-tighter",title:de,children:de}),n.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0 ml-1",children:[n.jsx("span",{className:"text-[10px] text-gray-500 font-semibold uppercase",children:"ENT:"}),(s||[]).map((te,le)=>{const ee=parseInt(te.replace(/(?:character|entity)-/i,""),10);return isNaN(ee)?null:n.jsxs("div",{className:"flex items-center bg-gray-600 rounded text-gray-200 border border-gray-500",onClick:se=>se.stopPropagation(),children:[n.jsx("span",{className:"text-[10px] font-semibold px-1.5",children:ee}),n.jsxs("div",{className:"flex flex-col border-l border-gray-500",children:[n.jsx("button",{onClick:se=>{se.stopPropagation(),G(le,ee+1)},className:"px-0.5 text-gray-300 hover:text-white text-[8px] middle-none disabled:text-gray-500 disabled:cursor-not-allowed",disabled:D,children:""}),n.jsx("button",{onClick:se=>{se.stopPropagation(),G(le,ee-1)},className:"px-0.5 text-gray-300 hover:text-white text-[8px] border-t border-gray-600 disabled:text-gray-500 disabled:cursor-not-allowed",disabled:D||ee<=1,children:""})]}),n.jsx("button",{onClick:se=>{se.stopPropagation(),R(te)},disabled:D,className:"px-1 text-cyan-300 hover:text-cyan-100 border-l border-gray-500 text-[10px] disabled:text-gray-500 disabled:cursor-not-allowed",title:"Insert at start: [Entity-N]",children:""}),n.jsx("button",{onClick:se=>{se.stopPropagation(),U(le)},disabled:D,className:"px-1 text-red-300 hover:text-red-100 border-l border-gray-500 text-[10px] disabled:text-gray-500 disabled:cursor-not-allowed",children:""})]},le)}),n.jsx("button",{onClick:te=>{te.stopPropagation(),q()},disabled:D,className:"flex items-center justify-center w-4 h-4 bg-gray-600 hover:bg-gray-500 rounded text-[10px] text-gray-300 disabled:bg-gray-700 disabled:cursor-not-allowed",children:"+"})]})]}),n.jsxs("div",{className:"flex items-center flex-shrink-0 space-x-1",children:[x&&n.jsx(Pe,{tooltipPosition:"left",title:"Move to Source",onClick:te=>{te.stopPropagation(),x(t)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),!D&&n.jsxs("div",{className:"flex p-0.5",children:[_&&n.jsx(Pe,{tooltipPosition:"left",title:"Move to Start",onClick:te=>{te.stopPropagation(),_(e)},disabled:P,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),g&&n.jsx(Pe,{tooltipPosition:"left",title:"Move Up",onClick:te=>{te.stopPropagation(),g(e)},disabled:P,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),m&&n.jsx(Pe,{tooltipPosition:"left",title:"Move Down",onClick:te=>{te.stopPropagation(),m(e)},disabled:j,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),S&&n.jsx(Pe,{tooltipPosition:"left",title:"Move to End",onClick:te=>{te.stopPropagation(),S(e)},disabled:j,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})})]}),!D&&k&&n.jsx(Pe,{tooltipPosition:"left",title:"Add Frame After",onClick:te=>{te.stopPropagation(),k(t)},className:"p-1 rounded-md text-[#dad5cf] hover:bg-gray-600 hover:text-white transition-colors focus:outline-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),z&&n.jsx(Pe,{title:"Copy Combined Prompt",tooltipPosition:"bottom",tooltipAlign:"center",onClick:te=>{te.stopPropagation(),z(t)},className:"p-1 rounded-md text-[#dad5cf] hover:bg-gray-600 hover:text-white transition-colors focus:outline-none",children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-orange-400 hover:text-orange-200",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})]})}),n.jsx(Pe,{tooltipPosition:"left",title:M("node.action.copyImagePrompt"),onClick:te=>{te.stopPropagation(),b(r)},children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Pe,{tooltipPosition:"left",title:M("node.action.copyVideoPrompt"),onClick:te=>{te.stopPropagation(),a&&y&&y(a)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})})}),!D&&w&&n.jsx(Pe,{tooltipPosition:"left",title:M("image_sequence.delete_frame"),onClick:te=>{te.stopPropagation(),w(t)},className:"p-1 rounded-md text-gray-500 hover:text-red-400 hover:bg-gray-600 transition-colors focus:outline-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),(!D&&N||D&&I)&&n.jsx(Pe,{title:M(D?"image_sequence.edit_in_source":"image_sequence.edit_prompt"),tooltipPosition:"left",onClick:te=>{te.stopPropagation(),D&&I?I(t):N&&N(t)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})})]})]}),!d&&n.jsxs("div",{className:"flex flex-col space-y-1 mt-1",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1 bg-gray-800 p-1 rounded",children:[n.jsx("select",{value:i||"WS",onChange:X,disabled:D,className:"bg-gray-700 text-white text-[10px] rounded border border-gray-600 px-1 py-0.5 focus:outline-none focus:ring-1 focus:ring-cyan-500 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed w-20 shrink-0",onClick:te=>te.stopPropagation(),onMouseDown:te=>te.stopPropagation(),children:oT.map(te=>n.jsx("option",{value:te,children:te},te))}),n.jsx("div",{className:"text-[10px] text-gray-400 italic flex-grow truncate",title:ge||"No Shot Type",children:ge||n.jsx("span",{className:"opacity-50",children:"No shot type selected"})}),!D&&n.jsxs("div",{className:"flex items-center flex-shrink-0 border-l border-gray-600 pl-2",children:[n.jsx(Ws,{value:l.toString(),onChange:te=>h(t,{duration:Math.max(0,parseInt(te,10)||0)}),min:0}),n.jsx("span",{className:"text-[9px] text-gray-500 ml-1",children:"s"})]})]}),n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase",children:"IMAGE PROMPT"}),n.jsx(Pl,{value:r,onDebouncedChange:H,readOnly:D,style:{height:T?"100px":"120px"},className:`w-full text-xs p-1 bg-gray-800 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-2 focus:ring-cyan-500 ${D?"cursor-default":"cursor-text"}`,onClick:te=>te.stopPropagation(),onMouseDown:te=>te.stopPropagation(),onWheel:te=>te.stopPropagation()})]}),T&&n.jsxs("div",{className:"flex flex-col mt-1 pt-1 border-t border-gray-600/30",children:[n.jsx("div",{className:"flex justify-between items-center mb-0.5",children:n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase",children:"VIDEO PROMPT"})}),n.jsx(Pl,{value:a||"",onDebouncedChange:ne,readOnly:D,style:{height:"60px"},className:`w-full text-xs p-1 bg-gray-800 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-2 focus:ring-cyan-500 ${D?"cursor-default":"cursor-text"}`,onClick:te=>te.stopPropagation(),onMouseDown:te=>te.stopPropagation(),onWheel:te=>te.stopPropagation()})]})]})]})}),uy=(e,t,o,r=800,a=!0,i=!0,s={},l=[],c=[])=>{const d=v.useMemo(()=>{const k=[...e].sort((m,x)=>m.frameNumber-x.frameNumber),b=[];let y=-1,g=null;return k.forEach(m=>{const x=m.sceneNumber||1;if(x!==y){y=x;const _=m.sceneTitle||"";g={scene:x,title:_,prompts:[]},b.push(g)}g&&g.prompts.push(m)}),b},[e]),u=v.useMemo(()=>{const k=[];let b=0;return d.forEach(y=>{if(i&&(k.push({type:"scene_header",h:p0,top:b,data:y,scene:y.scene}),b+=p0),!i||!t.includes(y.scene)){const g=s[String(y.scene)]||"",m=l.includes(y.scene)?tT:nT;k.push({type:"scene_context",h:m+8,top:b,data:g,scene:y.scene}),b+=m+8,y.prompts.forEach(x=>{const S=(x.shotType?cy[x.shotType]:void 0)?30:0,P=(a?Su:Nu)+S,j=(x.isCollapsed?ly:P)+8;k.push({type:"prompt",h:j,top:b,data:x,scene:y.scene}),b+=j})}}),{items:k,totalHeight:b}},[d,t,a,i,s,l,c]),p=v.useMemo(()=>{const b=Math.max(0,o-800),y=o+r+800;return u.items.filter(g=>g.top+g.h>b&&g.top<y)},[u,o,r]),h=k=>{const b=u.items.find(y=>y.type==="prompt"&&y.data.frameNumber===k);return b?b.top:null},w=k=>{if(!i)return null;const b=u.items.find(y=>y.type==="scene_header"&&y.scene===k);return b?b.top:null};return{groupedPrompts:d,virtualItems:u,visibleItems:p,totalHeight:u.totalHeight,getScrollPositionForFrame:h,getScrollPositionForScene:w}},rT=v.forwardRef(({prompts:e,collapsedScenes:t,checkedFrameNumbers:o,selectedFrameNumber:r,isLinked:a,onUpdatePrompts:i,onLoadFile:s,onSaveToCatalog:l,onSaveToDisk:c,t:d,onSelect:u,onToggleCollapse:p,onToggleScene:h,onDetachToEditor:w,onClearAll:k,onAddPrompt:b,onAddScene:y,onDeletePrompt:g,onMovePromptUp:m,onMovePromptDown:x,onMoveToStart:_,onMoveToEnd:S,onRegenerate:P,isAnyGenerationInProgress:j,onEditInSource:M,onEditPrompt:D,isGeneratingSequence:O,allConceptsLength:B,selectionKey:E="checkedSourceFrameNumbers",onUnlink:I,addToast:N,onClearTextOnly:T,sceneContexts:F={},onUpdateSceneContext:z,expandedSceneContexts:G=[],onToggleSceneContext:U,checkedContextScenes:R=[],onToggleContextCheck:q,onCopyCombinedPrompt:H},ne)=>{const X=v.useRef(null),[re,de]=v.useState(0),[ge,te]=v.useState(800),[le,ee]=v.useState(!1),[se,ie]=v.useState(""),[oe,A]=v.useState(""),[K,Z]=v.useState(""),[W,Q]=v.useState(!0),[ce,fe]=v.useState(!0);v.useEffect(()=>{if(!X.current)return;const we=()=>{X.current&&requestAnimationFrame(()=>{X.current&&(te(X.current.clientHeight),de(X.current.scrollTop))})},Ce=new ResizeObserver(we);return Ce.observe(X.current),we(),()=>Ce.disconnect()},[]);const{groupedPrompts:$,totalHeight:V,visibleItems:J,getScrollPositionForFrame:Y}=uy(e,t,re,ge,W,ce,F,G,R);v.useImperativeHandle(ne,()=>({scrollToFrame:we=>{const Ce=Y(we);Ce!==null&&X.current&&X.current.scrollTo({top:Math.max(0,Ce-100),behavior:"smooth"})},scrollToBottom:()=>{X.current&&X.current.scrollTo({top:X.current.scrollHeight,behavior:"smooth"})}}));const ae=we=>{const Ce=parseInt(we||se,10);if(isNaN(Ce))return;const qe=e.find(at=>at.frameNumber===Ce);if(!qe)return;const Be=qe.sceneNumber||1;let Ie=[...t];Ie.includes(Be)&&(Ie=Ie.filter(at=>at!==Be));const We=e.map(at=>at.frameNumber===Ce?{...at,isCollapsed:!1}:at);i({prompts:We,sourcePrompts:We,collapsedScenes:Ie,collapsedSourceScenes:Ie,selectedFrameNumber:Ce}),setTimeout(()=>{const at=Y(Ce);at!==null&&X.current&&X.current.scrollTo({top:at,behavior:"smooth"})},100)},ue=we=>{if(we.preventDefault(),we.stopPropagation(),ee(!1),a)return;const Ce=we.dataTransfer.files[0];if(Ce&&Ce.type==="application/json"){const qe=new FileReader;qe.onload=Be=>{var Ie;if((Ie=Be.target)!=null&&Ie.result)try{const We=JSON.parse(Be.target.result);let at=We.finalPrompts||We.prompts||(Array.isArray(We)?We:[]),Jt=We.sceneContexts||{};at.length>0&&i({sourcePrompts:at,prompts:at,sceneContexts:Jt})}catch(We){console.error(We)}},qe.readAsText(Ce)}},he=()=>{const we=parseInt(oe,10),Ce=parseInt(K,10);if(isNaN(we)||isNaN(Ce))return;const qe=Math.max(1,we),Be=Math.min(e.length,Ce);if(qe>Be)return;const Ie=[];for(let We=qe;We<=Be;We++)Ie.push(We);i({[E]:Ie})},ye=()=>i({[E]:e.map(we=>we.frameNumber)}),ve=()=>i({[E]:[]}),me=()=>{const Ce=e.map(qe=>qe.frameNumber).filter(qe=>!o.includes(qe));i({[E]:Ce})},_e=$.length>0&&$.every(we=>t.includes(we.scene)),pe=()=>{const we=$.map(qe=>qe.scene),Ce=_e?[]:we;i({collapsedScenes:Ce,collapsedSourceScenes:Ce})},xe=e.every(we=>we.isCollapsed),Se=()=>{const we=e.map(Ce=>({...Ce,isCollapsed:!xe}));i({prompts:we,sourcePrompts:we})},Le=(we,Ce)=>{if(a)return;const qe=e.map(Be=>Be.frameNumber===we?{...Be,...Ce}:Be);i({prompts:qe,sourcePrompts:qe})},Ee=(we,Ce)=>{if(Ce){i({[E]:[we]});return}const qe=o.includes(we)?o.filter(Be=>Be!==we):[...o,we];i({[E]:qe})},Me=we=>{navigator.clipboard.writeText(we),N&&N(d("toast.copiedToClipboard"))},De=()=>{T?T():k()},Te=we=>{const Ce=$.find(We=>We.scene===we);if(!Ce)return;const qe=Ce.prompts.map(We=>We.frameNumber),Be=qe.every(We=>o.includes(We));let Ie;Be?Ie=o.filter(We=>!qe.includes(We)):Ie=[...new Set([...o,...qe])],i({[E]:Ie})},Re=we=>{const Ce=$.find(qe=>qe.scene===we);return!Ce||Ce.prompts.length===0?!1:Ce.prompts.every(qe=>o.includes(qe.frameNumber))};return n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-h-0",children:[n.jsxs("div",{className:"flex justify-between items-center flex-shrink-0 bg-gray-900/50 p-1 rounded-md border border-gray-700 h-9",onWheel:we=>we.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center space-x-1 h-full",children:[a&&n.jsx("button",{className:"text-cyan-400 hover:text-white transition-colors",title:"Linked to Upstream (Click to Unlink and Copy)",onClick:we=>{we.stopPropagation(),I&&I()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),!a&&e.length>0&&w&&n.jsx(Pe,{title:"Detach and Edit",onClick:w,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-400 hover:text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),n.jsx("h3",{className:"text-sm font-bold text-gray-300 px-1 whitespace-nowrap",children:d("image_sequence.prompts_list_title")||"Prompts"}),n.jsx("div",{className:"flex items-center",children:n.jsx(Ws,{value:se,placeholder:"#",onChange:we=>{ie(we),ae(we)},min:1,className:"w-12 border-none",title:"Go to Frame"})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsxs("div",{className:"flex items-center gap-1 bg-gray-800 rounded p-0.5 h-6",children:[n.jsx("span",{className:"text-[9px] text-gray-400 px-1 whitespace-nowrap",children:d("image_sequence.range_from")}),n.jsx(Ws,{value:oe,placeholder:"1",onChange:A,min:1,className:"w-10 border-none"}),n.jsx("span",{className:"text-[9px] text-gray-400 px-1 whitespace-nowrap",children:d("image_sequence.range_to")}),n.jsx(Ws,{value:K,placeholder:"N",onChange:Z,min:1,className:"w-10 border-none"}),n.jsx(Pe,{title:"Select range",onClick:we=>{we.stopPropagation(),he()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-800 rounded p-0.5 h-6",children:[n.jsx(Pe,{title:d("image_sequence.select_all"),onClick:ye,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600"}),n.jsx(Pe,{title:d("image_sequence.select_none"),onClick:ve,disabled:o.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600"}),n.jsx(Pe,{title:d("image_sequence.invert_selection"),onClick:me,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})})]})]}),n.jsxs("div",{className:"flex items-center space-x-1 h-full",children:[n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-900/50 rounded p-0.5",children:[n.jsx(Pe,{title:"Add Scene",onClick:y,disabled:a,children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m-3-3h6"})]})}),n.jsx(Pe,{title:d("image_sequence.add_frame"),onClick:()=>b(-1),disabled:a,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Pe,{title:W?" -":" -",onClick:()=>Q(!W),children:W?n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})}),n.jsx(Pe,{title:ce?" ":" ",onClick:()=>fe(!ce),children:ce?n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Pe,{title:_e?"Expand Scenes":"Collapse Scenes",onClick:pe,children:_e?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})}),n.jsx(Pe,{title:xe?"Expand Prompts":"Collapse Prompts",onClick:Se,disabled:_e,children:xe?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),!a&&n.jsx(Pe,{title:d("image_sequence.clear_prompts_only"),onClick:De,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),n.jsx("div",{ref:X,className:`flex-grow min-h-0 bg-gray-900/50 p-2 rounded-md border-2 border-dashed transition-colors overflow-y-auto scrollbar-gutter-stable ${le?"border-cyan-500 bg-gray-700/50":"border-transparent"} ${le?"bg-cyan-900/20":""}`,onScroll:we=>de(we.currentTarget.scrollTop),onDragOver:we=>{we.preventDefault(),we.stopPropagation(),ee(!0)},onDragLeave:()=>ee(!1),onDrop:ue,onWheel:we=>we.stopPropagation(),style:{overscrollBehaviorY:"contain"},children:e.length===0?n.jsx("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500 p-4 cursor-pointer",onClick:()=>!a&&b(-1),children:a?n.jsxs(n.Fragment,{children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-gray-400 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),n.jsx("p",{className:"font-semibold text-sm",children:"Linked to References"}),n.jsx("p",{className:"text-xs",children:"Waiting for data..."})]}):n.jsxs(n.Fragment,{children:[n.jsx("h4",{className:"font-semibold text-sm",children:d("image_sequence.drop_or_add_title")}),n.jsx("p",{className:"text-xs",children:d("image_sequence.drop_or_add_desc")})]})}):n.jsx("div",{style:{height:V,position:"relative"},children:J.map(we=>{if(we.type==="scene_header"){const Ce=we.data,qe=t.includes(Ce.scene);return n.jsx("div",{style:{position:"absolute",top:we.top,left:0,right:0,height:we.h,paddingBottom:4},children:n.jsx("div",{className:"flex items-center justify-between bg-gray-800 p-1 rounded select-none cursor-pointer hover:bg-gray-700 transition-colors h-full",onClick:Be=>{Be.stopPropagation(),h(Ce.scene)},children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"text-gray-400",children:qe?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),n.jsxs("div",{className:"flex items-center gap-2",onClick:Be=>Be.stopPropagation(),children:[n.jsx(Ot,{checked:q&&R?R.includes(Ce.scene):!1,onChange:()=>q&&q(Ce.scene),title:"Include Context in Modification"}),n.jsx(Ot,{checked:Re(Ce.scene),onChange:()=>Te(Ce.scene),title:"Select All Frames in Scene",className:"text-cyan-400"})]}),n.jsxs("span",{className:"text-xs font-bold text-gray-300 uppercase tracking-wider bg-gray-800 px-2 py-1 rounded",children:[d("image_sequence.scene_input_label")," ",Ce.scene,Ce.title?`: ${Ce.title}`:""]}),n.jsxs("span",{className:"text-[10px] text-gray-500",children:["(",Ce.prompts.length," frames)"]})]})})},`header-${Ce.scene}`)}else if(we.type==="scene_context"){const Ce=we.data,qe=we.scene,Be=G.includes(qe);return n.jsx("div",{style:{position:"absolute",top:we.top,left:0,right:0,height:we.h},className:"pl-2 border-l-2 border-connection-text ml-2 pb-2",children:n.jsxs("div",{className:"bg-gray-800/80 rounded border border-connection-text p-2 h-full flex flex-col",children:[n.jsx("div",{className:"flex justify-between items-center cursor-pointer select-none",onClick:Ie=>{Ie.stopPropagation(),U&&U(qe)},children:n.jsx("div",{className:"flex items-center gap-2",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{onClick:Ie=>Ie.stopPropagation(),children:n.jsx(Ot,{checked:q&&R?R.includes(qe):!1,onChange:()=>q&&q(qe),title:"Include Context in Modification"})}),n.jsx("div",{className:"text-connection-text",children:Be?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})}),n.jsx("label",{className:"text-[10px] font-bold text-connection-text uppercase tracking-wider cursor-pointer",children:"SCENE CONTEXT"})]})})}),Be&&n.jsx("div",{className:"flex-grow min-h-0 mt-2",children:n.jsx(Tn,{value:Ce,onDebouncedChange:Ie=>z&&z(qe,Ie),readOnly:a,className:`w-full h-full text-xs p-1.5 bg-gray-900/50 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-1 focus:ring-accent ${a?"cursor-default":"cursor-text"}`,placeholder:"Describe scene environment and context...",onMouseDown:Ie=>Ie.stopPropagation(),onWheel:Ie=>Ie.stopPropagation()})})]})},`context-${qe}`)}else{const Ce=we.data,qe=e.findIndex(Ie=>Ie.frameNumber===Ce.frameNumber),Be=r===Ce.frameNumber;return n.jsx("div",{style:{position:"absolute",top:we.top,left:0,right:0,height:we.h},className:"pl-2 border-l-2 border-gray-700 ml-2",children:n.jsx(dy,{index:qe,frameNumber:Ce.frameNumber,sceneNumber:Ce.sceneNumber,prompt:Ce.prompt,videoPrompt:Ce.videoPrompt,shotType:Ce.shotType,characters:Ce.characters,duration:Ce.duration||0,isSelected:Be,isCollapsed:Ce.isCollapsed??!1,onToggleCollapse:()=>p(Ce.frameNumber),onSelect:()=>u(Ce.frameNumber),onChange:Le,onCopy:Ie=>Me(Ie),onCopyVideo:Ie=>Me(Ie),t:d,readOnly:a,isChecked:o.includes(Ce.frameNumber),onCheck:(Ie,We)=>Ee(Ie,We),onDelete:()=>g(Ce.frameNumber),onAddAfter:()=>b(Ce.frameNumber),onMoveUp:()=>m(qe),onMoveDown:()=>x(qe),onMoveToStart:()=>_(qe),onMoveToEnd:()=>S(qe),isFirst:qe===0,isLast:qe===e.length-1,showVideoPrompts:W,onRegenerate:P,isAnyGenerationInProgress:j||O,onEditInSource:M,onEditPrompt:D,maxCharacters:B,onCopyCombinedPrompt:H})},`prompt-${Ce.frameNumber}`)}})})}),!a&&n.jsxs("div",{className:"flex-shrink-0 flex space-x-2",children:[n.jsx("div",{className:"flex-1 flex space-x-1",children:n.jsx("button",{onClick:s,className:"flex-1 px-3 py-2 text-sm font-semibold text-white bg-accent-secondary hover:bg-accent-secondary-hover rounded-md",children:d("image_sequence.load_prompts")})}),n.jsx("button",{onClick:l,disabled:e.length===0,className:"flex-1 px-3 py-2 text-sm font-semibold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",title:d("catalog.saveTo"),children:d("catalog.saveTo")}),n.jsx(Pe,{title:d("group.saveToDisk"),onClick:c,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]})]})}),aT=({prompts:e,collapsedScenes:t,isLinked:o,onUpdatePrompts:r,t:a,onToggleCollapse:i,onToggleScene:s,onMoveToSource:l,onMoveAllToSource:c,onClear:d,sceneContexts:u={},modifiedSceneContexts:p={},expandedSceneContexts:h=[],onToggleSceneContext:w,onUpdateSceneContext:k})=>{const b=v.useRef(null),[y,g]=v.useState(0),[m,x]=v.useState(800);v.useEffect(()=>{if(!b.current)return;const I=()=>{b.current&&requestAnimationFrame(()=>{b.current&&(x(b.current.clientHeight),g(b.current.scrollTop))})},N=new ResizeObserver(I);return N.observe(b.current),I(),()=>N.disconnect()},[]);const _=v.useMemo(()=>({...u,...p}),[u,p]),{groupedPrompts:S,totalHeight:P,visibleItems:j}=uy(e,t,y,m,!0,!0,_,h),M=S.length>0&&S.every(I=>t.includes(I.scene)),D=()=>{const I=S.map(N=>N.scene);r({collapsedModifiedScenes:M?[]:I})},O=e.every(I=>I.isCollapsed),B=()=>{r({modifiedPrompts:e.map(I=>({...I,isCollapsed:!O}))})},E=(I,N)=>{const T=e.map(F=>F.frameNumber===I?{...F,...N}:F);r({modifiedPrompts:T})};return n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-h-0",children:[n.jsxs("div",{className:"flex justify-between items-center flex-shrink-0",children:[n.jsx("h3",{className:"text-sm font-bold text-gray-300",children:a("prompt_sequence_editor.finalPrompts")}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(Pe,{title:"Move All to Source",onClick:c,disabled:e.length===0||!!o,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),n.jsx(Pe,{title:M?"Expand Scenes":"Collapse Scenes",onClick:D,children:M?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})}),n.jsx(Pe,{title:O?"Expand Prompts":"Collapse Prompts",onClick:B,disabled:M,children:O?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),n.jsx(Pe,{title:"Clear Modified",onClick:d,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),n.jsx("div",{ref:b,onScroll:I=>g(I.currentTarget.scrollTop),className:"flex-grow min-h-0 bg-gray-900/50 p-2 rounded-md overflow-y-auto scrollbar-gutter-stable",onWheel:I=>I.stopPropagation(),children:e.length===0?n.jsx("div",{className:"h-full flex items-center justify-center text-gray-500",children:"  ."}):n.jsx("div",{style:{height:P,position:"relative"},children:j.map(I=>{if(I.type==="scene_header"){const N=I.data,T=t.includes(N.scene);return n.jsx("div",{style:{position:"absolute",top:I.top,left:0,right:0,height:I.h,paddingBottom:4},children:n.jsx("div",{className:"flex items-center justify-between bg-gray-800 p-1 rounded select-none cursor-pointer hover:bg-gray-700 transition-colors h-full",onClick:F=>{F.stopPropagation(),s(N.scene)},children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"text-gray-400",children:T?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),n.jsxs("span",{className:"text-xs font-bold text-gray-300 uppercase tracking-wider bg-gray-800 px-2 py-1 rounded",children:[a("image_sequence.scene_input_label")," ",N.scene,N.title?`: ${N.title}`:""]}),n.jsxs("span",{className:"text-[10px] text-gray-500",children:["(",N.prompts.length," frames)"]})]})})},`mod-header-${N.scene}`)}else if(I.type==="scene_context"){const N=I.data,T=I.scene,F=h==null?void 0:h.includes(T),z=p[String(T)]!==void 0;return n.jsx("div",{style:{position:"absolute",top:I.top,left:0,right:0,height:I.h},className:"pl-2 border-l-2 border-connection-text ml-2 pb-2",children:n.jsxs("div",{className:"bg-gray-800/80 rounded border border-connection-text p-2 h-full flex flex-col",children:[n.jsx("div",{className:"flex justify-between items-center cursor-pointer select-none",onClick:G=>{G.stopPropagation(),w&&w(T)},children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:z?"text-orange-500":"text-connection-text",children:F?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})}),n.jsxs("label",{className:`text-[10px] font-bold uppercase tracking-wider cursor-pointer ${z?"text-orange-400":"text-connection-text"}`,children:["SCENE CONTEXT ",z&&"(Modified)"]})]})}),F&&n.jsx("div",{className:"flex-grow min-h-0 mt-2",children:n.jsx(Tn,{value:N,onDebouncedChange:G=>k&&k(T,G),className:"w-full h-full text-xs p-1.5 bg-gray-900/50 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-1 focus:ring-accent cursor-text",placeholder:"Describe scene environment and context...",onMouseDown:G=>G.stopPropagation(),onWheel:G=>G.stopPropagation()})})]})},`mod-context-${T}`)}else{const N=I.data;return n.jsx("div",{style:{position:"absolute",top:I.top,left:0,right:0,height:I.h},className:"pl-2 border-l-2 border-gray-700 ml-2",children:n.jsx(dy,{index:N.frameNumber,frameNumber:N.frameNumber,sceneNumber:N.sceneNumber,prompt:N.prompt,videoPrompt:N.videoPrompt,shotType:N.shotType,characters:N.characters,duration:N.duration||0,isModified:!0,isSelected:!1,isCollapsed:N.isCollapsed??!1,onSelect:()=>{},onChange:E,onCopy:T=>navigator.clipboard.writeText(T),t:a,readOnly:!1,onToggleCollapse:()=>i(N.frameNumber),onMoveToSource:()=>l(N.frameNumber)})},`modified-${N.frameNumber}`)}})})})]})},rr=620,h0=400,iT=({node:e,onValueChange:t,onModifyPromptSequence:o,isModifyingPromptSequence:r,t:a,onLoadPromptSequenceFile:i,onSaveSequenceToCatalog:s,onSaveScriptToDisk:l,setError:c,connectedInputs:d,getUpstreamNodeValues:u,addToast:p,viewTransform:h})=>{const{setConnections:w}=Ut(),k=v.useRef(null),b=v.useRef(null),y=v.useRef(null),g=`instruction-input-${e.id}`,m=d==null?void 0:d.has("prompts_sequence"),x=v.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{instruction:"",sourcePrompts:[],modifiedPrompts:[],leftPaneWidth:rr,checkedSourceFrameNumbers:[],selectedFrameNumber:null,styleOverride:"",isStyleSelected:!1,isStyleCollapsed:!0,isUsedCharsCollapsed:!0,usedCharacters:[],collapsedSourceScenes:[],collapsedModifiedScenes:[],targetLanguage:"en",modificationModel:"gemini-3-flash-preview",includeVideoPrompts:!1,sceneContexts:{},modifiedSceneContexts:{},expandedSceneContexts:[],checkedContextScenes:[]}}},[e.value]),_=v.useRef(x);v.useEffect(()=>{_.current=x},[x]);let S=x.leftPaneWidth;!S&&x.leftPaneRatio?S=Math.max(rr,(e.width||1200)*x.leftPaneRatio):S||(S=rr);const{instruction:P="",sourcePrompts:j=[],modifiedPrompts:M=[],checkedSourceFrameNumbers:D=[],selectedFrameNumber:O=null,styleOverride:B="",isStyleCollapsed:E=!0,isUsedCharsCollapsed:I=!0,usedCharacters:N=[],collapsedSourceScenes:T=[],collapsedModifiedScenes:F=[],targetLanguage:z="en",modificationModel:G="gemini-3-flash-preview",includeVideoPrompts:U=!1,sceneContexts:R={},modifiedSceneContexts:q={},expandedSceneContexts:H=[],checkedContextScenes:ne=[]}=x,X=S,re=v.useCallback(J=>{const ae={..._.current,...J};_.current=ae,t(e.id,JSON.stringify(ae))},[e.id,t]);v.useEffect(()=>{O!==null&&setTimeout(()=>{var J;(J=b.current)==null||J.scrollToFrame(O)},100)},[O]);const de=v.useCallback(J=>{const Y=[..._.current.sourcePrompts||[]],ae=Y.length>0?Math.max(...Y.map(ye=>ye.frameNumber))+1:1,ue=Y.length>0?Y[Y.length-1].sceneNumber:1,he={frameNumber:ae,sceneNumber:ue,sceneTitle:"",prompt:"",videoPrompt:"",shotType:"WS",characters:[],duration:3,isCollapsed:!1};if(J!==void 0&&J!==-1){const ye=Y.findIndex(ve=>ve.frameNumber===J);if(ye!==-1){Y.splice(ye+1,0,he);const ve=Y.map((me,_e)=>({...me,frameNumber:_e+1}));re({sourcePrompts:ve});return}}re({sourcePrompts:[...Y,he]})},[re]),ge=v.useCallback(()=>{const J=[..._.current.sourcePrompts||[]],ae=(J.length>0?Math.max(...J.map(ye=>ye.sceneNumber||1)):0)+1,he={frameNumber:J.length>0?Math.max(...J.map(ye=>ye.frameNumber))+1:1,sceneNumber:ae,sceneTitle:`Scene ${ae}`,prompt:"",videoPrompt:"",shotType:"WS",characters:[],duration:3,isCollapsed:!1};re({sourcePrompts:[...J,he]})},[re]),te=v.useCallback(J=>{const ue=(_.current.sourcePrompts||[]).filter(he=>he.frameNumber!==J).map((he,ye)=>({...he,frameNumber:ye+1}));re({sourcePrompts:ue})},[re]),le=v.useCallback(J=>{if(J<=0)return;const ae=[..._.current.sourcePrompts||[]];[ae[J-1],ae[J]]=[ae[J],ae[J-1]],re({sourcePrompts:ae.map((ue,he)=>({...ue,frameNumber:he+1}))})},[re]),ee=v.useCallback(J=>{const Y=_.current.sourcePrompts||[];if(J>=Y.length-1)return;const ae=[...Y];[ae[J],ae[J+1]]=[ae[J+1],ae[J]],re({sourcePrompts:ae.map((ue,he)=>({...ue,frameNumber:he+1}))})},[re]),se=v.useCallback(J=>{const ae=[..._.current.sourcePrompts||[]],[ue]=ae.splice(J,1);ae.unshift(ue),re({sourcePrompts:ae.map((he,ye)=>({...he,frameNumber:ye+1}))})},[re]),ie=v.useCallback(J=>{const ae=[..._.current.sourcePrompts||[]],[ue]=ae.splice(J,1);ae.push(ue),re({sourcePrompts:ae.map((he,ye)=>({...he,frameNumber:ye+1}))})},[re]),oe=v.useCallback(J=>{b.current&&(b.current.scrollToFrame(J),re({selectedFrameNumber:J}))},[re]),A=v.useCallback(J=>{const Y=_.current.sourcePrompts||[],ae=_.current.modifiedPrompts||[],ue=ae.find(ve=>ve.frameNumber===J);if(!ue)return;const he=Y.map(ve=>ve.frameNumber===J?{...ve,...ue}:ve),ye=ae.filter(ve=>ve.frameNumber!==J);re({sourcePrompts:he,modifiedPrompts:ye})},[re]),K=v.useCallback(()=>{const J=_.current.sourcePrompts||[],Y=_.current.modifiedPrompts||[],ae=new Map(Y.map(me=>[me.frameNumber,me])),ue=J.map(me=>{const _e=ae.get(me.frameNumber);return _e?{...me,..._e}:me}),he=_.current.sceneContexts||{},ye=_.current.modifiedSceneContexts||{},ve={...he,...ye};re({sourcePrompts:ue,modifiedPrompts:[],sceneContexts:ve,modifiedSceneContexts:{}})},[re]);v.useEffect(()=>{if(!e.width)return;const J=e.width-h0;X>J?re({leftPaneWidth:Math.max(rr,J)}):X<rr&&re({leftPaneWidth:rr})},[e.width,X,re]),v.useEffect(()=>{if(m){const Y=u(e.id,"prompts_sequence")[0];if(typeof Y=="string"&&Y.trim()!=="")try{const ae=JSON.parse(Y);if(ae.type==="script-prompt-modifier-data"&&Array.isArray(ae.finalPrompts)){const ue=ae.finalPrompts,he=ae.usedCharacters||[],ye=ae.sceneContexts||{},ve=[];let me=!1;ue.forEach(_e=>{const pe=j.find(Se=>Se.frameNumber===_e.frameNumber),xe={frameNumber:_e.frameNumber,sceneNumber:_e.sceneNumber||1,sceneTitle:_e.sceneTitle||"",prompt:_e.prompt||"",videoPrompt:_e.videoPrompt||"",shotType:_e.shotType||_e.ShotType||"WS",characters:_e.characters||[],duration:_e.duration||3,isCollapsed:pe?pe.isCollapsed:!0};(!pe||pe.prompt!==xe.prompt||pe.videoPrompt!==xe.videoPrompt||pe.shotType!==xe.shotType||JSON.stringify(pe.characters)!==JSON.stringify(xe.characters))&&(me=!0),ve.push(xe)}),(j.length!==ve.length||JSON.stringify(N)!==JSON.stringify(he)||JSON.stringify(R)!==JSON.stringify(ye))&&(me=!0),me&&re({sourcePrompts:ve,usedCharacters:he,sceneContexts:ye})}}catch{}}},[m,u,e.id,re,j,N,R]);const Z=v.useCallback(J=>{J.preventDefault(),J.stopPropagation();const Y=(h==null?void 0:h.scale)||1;y.current={startX:J.clientX,startWidth:_.current.leftPaneWidth||rr};const ae=he=>{const ye=y.current;if(!ye)return;const ve=(he.clientX-ye.startX)/Y,me=ye.startWidth+ve,_e=e.width-h0,pe=Math.max(rr,Math.min(me,_e));re({leftPaneWidth:pe})},ue=()=>{y.current=null,window.removeEventListener("mousemove",ae),window.removeEventListener("mouseup",ue)};window.addEventListener("mousemove",ae),window.addEventListener("mouseup",ue)},[re,h,e.width]),W=()=>re({isStyleCollapsed:!E}),Q=()=>re({isUsedCharsCollapsed:!I}),ce=(J,Y)=>{const ae=[...N];ae[J]={...ae[J],name:Y},re({usedCharacters:ae})},fe=(J,Y)=>{const ae={...R,[J]:Y};re({sceneContexts:ae})},$=J=>{const Y=H||[],ae=Y.includes(J)?Y.filter(ue=>ue!==J):[...Y,J];re({expandedSceneContexts:ae})},V=J=>{const Y=ne||[],ae=Y.includes(J)?Y.filter(ue=>ue!==J):[...Y,J];re({checkedContextScenes:ae})};return n.jsxs("div",{ref:k,className:"relative h-full w-full flex space-x-2",onMouseDown:J=>J.stopPropagation(),onWheel:J=>J.stopPropagation(),children:[n.jsxs("div",{className:"h-full flex flex-col space-y-2 flex-shrink-0",style:{width:`${X}px`},children:[n.jsx(eT,{instruction:P,onInstructionChange:J=>re({instruction:J}),targetLanguage:z,onLanguageChange:J=>re({targetLanguage:J}),modificationModel:G,onModelChange:J=>re({modificationModel:J}),includeVideoPrompts:U,onToggleVideoPrompts:()=>re({includeVideoPrompts:!U}),includeSceneContext:!1,onToggleSceneContextOption:()=>{},isModifying:r,onModify:()=>o(e.id),checkedCount:D.length,checkedContextCount:ne.length,totalPrompts:j.length,instructionInputId:g,t:a}),n.jsxs("div",{className:"flex flex-col space-y-1 mb-1 flex-shrink-0",children:[n.jsxs("div",{className:"flex justify-between items-center cursor-pointer hover:bg-gray-700/50 rounded-md px-1 transition-colors group",onClick:Q,children:[n.jsx("label",{className:"text-[10px] font-bold text-connection-text uppercase cursor-pointer py-1 flex-grow",children:" "}),n.jsx("div",{className:"text-gray-500 group-hover:text-gray-300 p-1",children:I?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!I&&n.jsx("div",{className:"bg-gray-700/50 p-2 rounded-md border border-gray-600 max-h-40 overflow-y-auto custom-scrollbar",children:N.length>0?N.map((J,Y)=>n.jsxs("div",{className:"flex items-center gap-1 mb-1 last:mb-0 group/item",children:[n.jsxs("div",{className:"flex items-center gap-1 min-w-[100px] shrink-0 bg-gray-800/50 rounded px-1 border border-gray-600/50",children:[n.jsxs("span",{className:"text-[10px] font-mono text-connection-text truncate w-16",children:[J.index,":"]}),n.jsx("button",{onClick:ae=>{ae.stopPropagation(),navigator.clipboard.writeText(`[${J.index}]`),p&&p(a("toast.copiedToClipboard"))},className:"text-gray-500 hover:text-white p-0.5 transition-colors opacity-0 group-hover/item:opacity-100",title:"Copy as [Tag]",children:n.jsx(Dt,{className:"h-3 w-3"})})]}),n.jsxs("div",{className:"flex-grow flex items-center bg-gray-800 border-none rounded px-1.5 py-0.5 relative",children:[n.jsx("input",{type:"text",value:J.name,onChange:ae=>ce(Y,ae.target.value),placeholder:" ...",className:"w-full bg-transparent border-none text-[10px] text-gray-200 focus:outline-none focus:ring-0",onMouseDown:ae=>ae.stopPropagation()}),n.jsx("button",{onClick:ae=>{ae.stopPropagation(),navigator.clipboard.writeText(J.name),p&&p(a("toast.copiedToClipboard"))},className:"text-gray-500 hover:text-white p-0.5 transition-colors opacity-0 group-hover/item:opacity-100 absolute right-1",title:"Copy Name",children:n.jsx(Dt,{className:"h-3 w-3"})})]})]},Y)):n.jsx("div",{className:"text-[10px] text-gray-500 italic",children:"  ."})})]}),n.jsxs("div",{className:"flex flex-col space-y-1 mb-2 flex-shrink-0",children:[n.jsxs("div",{className:"flex justify-between items-center cursor-pointer hover:bg-gray-700/50 rounded-md px-1 transition-colors group",onClick:W,children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase cursor-pointer py-1 flex-grow",children:a("node.content.style")}),n.jsx("div",{className:"text-gray-500 group-hover:text-gray-300 p-1",children:E?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!E&&n.jsx(Tn,{value:B,onDebouncedChange:J=>re({styleOverride:J}),className:"w-full p-2 bg-gray-700 border-none rounded-md resize-none focus:outline-none text-xs",style:{minHeight:"60px"},onMouseDown:J=>J.stopPropagation(),onWheel:J=>J.stopPropagation()})]}),n.jsx(rT,{ref:b,prompts:j,collapsedScenes:T,checkedFrameNumbers:D,selectedFrameNumber:O,selectionKey:"checkedSourceFrameNumbers",isLinked:!!m,onUpdatePrompts:re,onLoadFile:()=>i(e.id),onSaveToCatalog:()=>s(e.id),onSaveToDisk:()=>l(e.id),t:a,setError:c,onSelect:J=>re({selectedFrameNumber:J}),onToggleCollapse:J=>{const Y=j.map(ae=>ae.frameNumber===J?{...ae,isCollapsed:!ae.isCollapsed}:ae);re({sourcePrompts:Y})},onToggleScene:J=>{const Y=T.includes(J)?T.filter(ae=>ae!==J):[...T,J];re({collapsedSourceScenes:Y})},onClearAll:()=>re({sourcePrompts:[],styleOverride:"",usedCharacters:[],sceneContexts:{}}),onAddPrompt:de,onAddScene:ge,onDeletePrompt:te,onMovePromptUp:le,onMovePromptDown:ee,onMoveToStart:se,onMoveToEnd:ie,onRegenerate:()=>{},isAnyGenerationInProgress:r,onEditInSource:()=>{},onEditPrompt:oe,isGeneratingSequence:r,allConceptsLength:0,sceneContexts:R,onUpdateSceneContext:fe,expandedSceneContexts:H,onToggleSceneContext:$,checkedContextScenes:ne,onToggleContextCheck:V})]}),n.jsx("div",{onMouseDown:Z,className:"w-2 h-full bg-gray-700/50 hover:bg-cyan-600 cursor-col-resize rounded transition-colors flex-shrink-0"}),n.jsx("div",{className:"h-full flex flex-col space-y-2 min-w-0",style:{width:"0",flexGrow:1},children:n.jsx(aT,{prompts:M,collapsedScenes:F,isLinked:!!m,onUpdatePrompts:re,t:a,onMoveAllToSource:K,onClear:()=>re({modifiedPrompts:[]}),onMoveToSource:A,onToggleCollapse:J=>{const Y=M.map(ae=>ae.frameNumber===J?{...ae,isCollapsed:!ae.isCollapsed}:ae);re({modifiedPrompts:Y})},onToggleScene:J=>{const Y=F.includes(J)?F.filter(ae=>ae!==J):[...F,J];re({collapsedModifiedScenes:Y})},sceneContexts:R,modifiedSceneContexts:q,expandedSceneContexts:H,onToggleSceneContext:$,onUpdateSceneContext:fe})})]})},m0=jt.memo(({node:e,contentProps:t})=>{switch(e.type){case L.REROUTE_DOT:return n.jsx(pP,{...t});case L.NOTE:return n.jsx(uP,{...t});case L.TRANSLATOR:return n.jsx(SP,{...t});case L.GEMINI_CHAT:return n.jsx(TP,{...t});case L.SCRIPT_GENERATOR:return n.jsx(UP,{...t});case L.SCRIPT_VIEWER:return n.jsx(WP,{...t});case L.CHARACTER_GENERATOR:return n.jsx(JP,{...t});case L.CHARACTER_CARD:return n.jsx(oj,{...t});case L.TEXT_INPUT:return n.jsx(hP,{...t});case L.IMAGE_INPUT:return n.jsx(_P,{...t});case L.IMAGE_EDITOR:return n.jsx(DP,{...t});case L.IMAGE_ANALYZER:return n.jsx(zP,{...t});case L.PROMPT_ANALYZER:return n.jsx(qP,{...t});case L.CHARACTER_ANALYZER:return n.jsx(OP,{...t});case L.PROMPT_PROCESSOR:return n.jsx(FP,{...t});case L.PROMPT_SANITIZER:return n.jsx(rj,{...t});case L.VIDEO_PROMPT_PROCESSOR:return n.jsx(GP,{...t});case L.IMAGE_OUTPUT:return n.jsx(BP,{...t});case L.VIDEO_OUTPUT:return n.jsx(HP,{...t});case L.IMAGE_SEQUENCE_GENERATOR:return n.jsx(Qj,{...t});case L.PROMPT_SEQUENCE_EDITOR:return n.jsx(iT,{...t});case L.DATA_READER:return n.jsx(aj,{...t});case L.VIDEO_EDITOR:return n.jsx(gj,{...t});case L.MEDIA_VIEWER:return n.jsx(_j,{...t});case L.DATA_PROTECTION:return n.jsx(Ij,{...t});case L.POSE_CREATOR:return n.jsx(Rj,{...t});default:return null}}),sT=({node:e,onMouseDown:t,onTouchStart:o,onResizeMouseDown:r,onNodeClick:a,onDetachNodeFromGroup:i,activeTool:s,connectingInfo:l,isDockedWindow:c,isProxyMode:d})=>{const u=v.useCallback(g=>{c||t(g,e.id)},[c,t,e.id]),p=v.useCallback(g=>{c||o(g,e.id)},[c,o,e.id]),h=v.useCallback((g,m)=>{d||r(g,e.id,m)},[d,r,e.id]),w=v.useCallback(g=>{},[]),k=v.useCallback(g=>{if(s==="cutter"){if(l)return;g.stopPropagation(),g.preventDefault(),a(e.id)}},[s,l,a,e.id]),b=v.useCallback(g=>{c||(g.altKey&&i(e.id),u(g))},[c,i,u,e.id]),y=v.useCallback((g,m)=>{g.altKey?(g.stopPropagation(),i(e.id)):c||e.type!==L.REROUTE_DOT&&m(e.id)},[c,i,e.id,e.type]);return{handleDragMouseDown:u,handleDragTouchStart:p,handleResizeMouseDown:h,handleMouseUp:w,handleHeaderMouseUp:k,handleHeaderMouseDown:b,handleHeaderDoubleClick:y}},lT=(e,t,o,r,a,i,s,l,c,d)=>{if(l)return{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:1e3,borderRadius:0,border:"none"};const u=Number.isFinite(e.position.x)?e.position.x:0,p=Number.isFinite(e.position.y)?e.position.y:0;let h=10;d?h=500:e.isPinned?h=100:a?h=90:i?h=80:c&&(h=6);const w={position:"absolute",top:0,left:0,transform:`translate(${u}px, ${p}px)`,width:o?160:Number.isFinite(e.width)?e.width:s.minWidth,height:o?48:e.isCollapsed?`${En}px`:Number.isFinite(e.height)?e.height:s.minHeight,minWidth:r||o?void 0:`${s.minWidth}px`,minHeight:e.isCollapsed||o||r?void 0:`${s.minHeight}px`,zIndex:h,contain:"none"};if(t&&e.dockState){const b="56px",y=e.width&&Number.isFinite(e.width)?`${e.width}px`:"auto",g=e.height&&Number.isFinite(e.height)?`${e.height}px`:"auto",m=`(100vw - ${56*2}px)`,x=`${s.minWidth}px`,_=`${s.minHeight}px`,S={position:"fixed",transform:"none",zIndex:100,minWidth:x,minHeight:_,contain:"none"};switch(e.dockState.mode){case"full":return{...S,top:b,left:b,right:b,bottom:b,width:"auto",height:"auto"};case"left":return{...S,top:b,left:b,width:y,bottom:b,height:"auto"};case"right":return{...S,top:b,right:b,width:y,bottom:b,height:"auto"};case"tl":return{...S,top:b,left:b,width:y,height:g};case"tr":return{...S,top:b,right:b,width:y,height:g};case"bl":return{...S,bottom:b,left:b,width:y,height:g};case"br":return{...S,bottom:b,right:b,width:y,height:g};case"q1":return{...S,top:b,bottom:b,left:b,width:y,height:"auto"};case"q2":return{...S,top:b,bottom:b,left:`calc(${b} + ${m} * 0.25)`,width:y,height:"auto"};case"q3":return{...S,top:b,bottom:b,right:`calc(${b} + ${m} * 0.25)`,width:y,height:"auto"};case"q4":return{...S,top:b,bottom:b,right:b,width:y,height:"auto"}}}return w},cT=(e,t,o,r,a,i,s,l,c,d,u,p,h=!0)=>{let w="border-gray-700";s||l?w="border-node-selected":c?w="border-teal-600":d?w="border-yellow-500":a?w="border-node-selected":i&&h===!0&&!r&&!o?w="border-node-hover ring-1 ring-node-hover/50 shadow-[0_0_15px_var(--color-border-hover)]":e.isPinned?w="border-node-hover":r&&(u==="text"?w="border-connection-text":u==="image"?w="border-connection-image":u==="character_data"?w="border-connection-character":u==="video"?w="border-connection-video":u==="audio"&&(w="border-connection-audio")),t&&(w="border-gray-600 shadow-2xl hover:border-node-hover"),o&&(w="border-gray-600 border-dashed opacity-80");let k=r?"bg-gray-600":e.type===L.NOTE?"bg-gray-900/70 backdrop-blur-sm":"bg-gray-800";o&&(k="bg-gray-800/80 backdrop-blur-sm"),p&&(k="bg-gray-900",w="border-none");const b=r?"bg-transparent":e.type===L.NOTE?"bg-transparent border-b border-gray-700/50":"bg-gray-700";return{container:`node-view absolute flex flex-col transition-[border-color,background-color,box-shadow] duration-200 ease-out ${k} border-2 ${p?"":r||o?"rounded-lg":"rounded-lg shadow-2xl"} ${w} ${s?"pointer-events-none":""}`,header:b,dockResizer:m=>m==="left"?"cursor-ew-resize right-0 top-0 w-2 h-full":m==="right"?"cursor-ew-resize left-0 top-0 w-2 h-full":m==="tl"?"cursor-nwse-resize bottom-0 right-0 w-4 h-4":m==="tr"?"cursor-nesw-resize bottom-0 left-0 w-4 h-4":m==="bl"?"cursor-nesw-resize top-0 right-0 w-4 h-4":m==="br"?"cursor-nwse-resize top-0 left-0 w-4 h-4":""}},dT=(e,t,o,r,a,i,s,l)=>{let c=e;o.type===L.IMAGE_EDITOR&&!e&&(c=t==="image"||t==="image_b"?"image":"text"),r&&(c=a);let d="bg-gray-400";switch(c){case"text":d="bg-connection-text";break;case"image":d="bg-connection-image";break;case"character_data":d="bg-connection-character";break;case"video":d="bg-connection-video";break;case"audio":d="bg-connection-audio";break}return!s||!i&&!r?d:(l==null?void 0:l.nodeId)===o.id&&(o.type===L.REROUTE_DOT||o.type===L.DATA_READER||l.handleId===t)?"bg-teal-600 ring-2 ring-white":i?"bg-red-500 cursor-not-allowed":d},uT=e=>{var oe;const{node:t,activeTool:o,onOutputHandleMouseDown:r,onOutputHandleTouchStart:a,isHovered:i,isSelected:s,onNodeMouseEnter:l,onNodeMouseLeave:c,onDeleteNode:d,connectingInfo:u,connectionTarget:p,onDetachNodeFromGroup:h,isGlobalProcessing:w,isProxy:k,isFocused:b,isGrouped:y,isGroupDragging:g}=e,m=Ut(),{handleOpenNodeContextMenu:x,requestDeleteNodes:_,handleUndockNode:S,selectNode:P,nodeAnimationMode:j,connectedInputTypes:M,handleClearNodeNewFlag:D,isHoverHighlightEnabled:O=!0}=m||{},{t:B}=St(),E=t.type===L.REROUTE_DOT,I=t.type===L.MEDIA_VIEWER,{rerouteType:N,rerouteDirection:T}=jt.useMemo(()=>{if(!E)return{rerouteType:null,rerouteDirection:"LR"};try{const A=JSON.parse(t.value||"{}");return{rerouteType:A.type||null,rerouteDirection:A.direction||"LR"}}catch{return{rerouteType:null,rerouteDirection:"LR"}}},[E,t.value]),F=v.useMemo(()=>Ri(t.type),[t.type]),z=!!t.dockState&&!k,G=!!t.dockState&&k,U=M==null?void 0:M.get(t.id),R=sT({node:t,onMouseDown:e.onMouseDown,onTouchStart:e.onTouchStart,onResizeMouseDown:e.onResizeMouseDown,onNodeClick:e.onNodeClick,onDetachNodeFromGroup:h,activeTool:o,connectingInfo:u,isDockedWindow:z,isProxyMode:G}),q=lT(t,z,G,E,s,i,F,b,y,g),H=cT(t,z,G,E,s,i,!!e.isDragging,!!e.isDragOverTarget,(p==null?void 0:p.nodeId)===t.id,!!e.isExecuting,N,b,O),ne=o==="edit"?z?"default":"crosshair":"inherit",X=o==="cutter"?`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="%23ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>') 12 12, auto`:"default",re=A=>{if(A.stopPropagation(),A.shiftKey||e.isInstantCloseEnabled){d(t.id);return}_?_([t.id],{x:A.clientX,y:A.clientY}):d(t.id)},de=A=>{if(A.stopPropagation(),E&&e.onValueChange)try{const K=JSON.parse(t.value||"{}"),Z=K.direction==="RL"?"LR":"RL";e.onValueChange(t.id,JSON.stringify({...K,direction:Z}))}catch{}},ge=v.useCallback(()=>{t.isNewlyCreated&&D&&D(t.id)},[t.isNewlyCreated,t.id,D]),te=jt.useCallback((A,K)=>dT(A,K,t,E,N,i,u,p),[t,E,N,u,i,p]),le=v.useMemo(()=>({...e,onOutputHandleTouchStart:a,onSaveGeneratedCharacterToCatalog:e.onSaveGeneratedCharacterToCatalog,t:B,getHandleColor:te,handleCursor:ne,isGlobalProcessing:w,onSelectNode:()=>P&&P(t.id)}),[e,a,B,te,ne,w,P,t.id]),ee=v.useMemo(()=>{if(t.type!==L.CHARACTER_CARD)return!1;try{const A=JSON.parse(t.value||"[]"),K=Array.isArray(A)?A:[A];return K.length===0?!1:K.every(Z=>Z.isImageCollapsed)}catch{return!1}},[t.value,t.type]),se=v.useCallback(()=>{if(t.type===L.CHARACTER_CARD)try{const A=JSON.parse(t.value||"[]"),K=Array.isArray(A)?A:[A],Z=!ee,W=K.map(Q=>({...Q,isImageCollapsed:Z}));e.onValueChange(t.id,JSON.stringify(W))}catch(A){console.error("Failed to toggle images",A)}},[t.value,t.type,t.id,e.onValueChange,ee]);if(G)return n.jsxs("div",{className:`node-view absolute flex items-center justify-center rounded-lg border-2 border-gray-600 bg-gray-800 text-gray-400 px-4 py-2 shadow-lg select-none cursor-move ${s?"border-node-selected text-accent-text":""}`,style:{...q,zIndex:s?12:10},onMouseUp:R.handleMouseUp,onMouseEnter:()=>l(t.id),onMouseLeave:c,onMouseDown:R.handleDragMouseDown,onTouchStart:R.handleDragTouchStart,onContextMenu:A=>{x&&x(A,t.id)},onWheel:A=>A.stopPropagation(),children:[n.jsx("span",{className:"font-bold text-xs truncate max-w-[140px] pointer-events-none",children:t.title}),n.jsx(Gg,{node:t,getHandleColor:te,handleCursor:ne,t:B,isHovered:i,isCollapsed:!0,isProxy:!0,connectedInputType:U}),n.jsx(Ug,{node:t,getHandleColor:te,handleCursor:ne,onOutputHandleMouseDown:r,onOutputHandleTouchStart:a,t:B,isHovered:i,isCollapsed:!0,isProxy:!0})]});(oe=t.dockState)==null||oe.mode;const ie=t.isNewlyCreated&&j==="pulse"?"node-pulse-animation":"";return n.jsxs("div",{className:`${H.container} ${ie}`,style:{...q,cursor:E&&!z?"move":X},onMouseUp:R.handleMouseUp,onMouseEnter:()=>l(t.id),onMouseLeave:c,onMouseDown:E?R.handleDragMouseDown:void 0,onMouseDownCapture:ge,onTouchStartCapture:ge,onTouchStart:E?R.handleDragTouchStart:void 0,onWheel:A=>A.stopPropagation(),children:[t.isNewlyCreated&&j==="blade-runner"&&!z&&!G&&n.jsx("div",{className:"new-node-ring"}),E&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none transition-transform duration-300",style:{transform:T==="RL"?"rotate(180deg)":"rotate(0deg)"},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})}),n.jsx(aP,{node:t,isDockedWindow:z,isRerouteDot:E,headerBgClass:H.header,onMouseDown:R.handleHeaderMouseDown,onTouchStart:!E&&!z?R.handleDragTouchStart:void 0,onMouseUp:R.handleHeaderMouseUp,onDoubleClick:E?de:A=>R.handleHeaderDoubleClick(A,e.onToggleCollapse),onToggleCollapse:e.onToggleCollapse,onRenameNode:e.onRenameNode,onDeleteNode:d,onCutConnections:e.onCutConnections,onDuplicateNode:e.onDuplicateNode,onDuplicateNodeWithContent:e.onDuplicateNodeWithContent,onCopyNodeValue:e.onCopyNodeValue,onPasteNodeValue:e.onPasteNodeValue,onPasteImage:e.onPasteImage,onDownloadImage:e.onDownloadImage,onRefreshImageEditor:e.onRefreshImageEditor,onRefreshChat:e.onRefreshChat,onValueChange:e.onValueChange,clearImagesForNodeFromCache:e.clearImagesForNodeFromCache,addToast:e.addToast,getEmptyValueForNodeType:Hi,onSaveSequenceToCatalog:e.onSaveSequenceToCatalog,onSaveScriptToDisk:e.onSaveScriptToDisk,onSaveCharacterToCatalog:e.onSaveCharacterToCatalog,onSaveCharacterCard:e.onSaveCharacterCard,handleUndockNode:S,handleOpenNodeContextMenu:x,handleRequestDelete:re,handleDetachNodeFromGroup:h,isInstantCloseEnabled:e.isInstantCloseEnabled,onToggleCharacterImages:se,allImagesCollapsed:ee}),I?n.jsx("div",{className:`p-3 flex-grow min-h-0 flex flex-col ${t.isCollapsed?"hidden":"flex"}`,onMouseDown:A=>{A.stopPropagation(),P&&P(t.id)},children:n.jsx(m0,{node:t,contentProps:le})}):!E&&!t.isCollapsed&&n.jsx("div",{className:"p-3 flex-grow min-h-0",onMouseDown:A=>{A.stopPropagation(),P&&P(t.id)},children:n.jsx(m0,{node:t,contentProps:le})}),!z&&!b&&n.jsx(Gg,{node:t,getHandleColor:te,handleCursor:ne,t:B,isHovered:i,isCollapsed:t.isCollapsed,isProxy:G,connectedInputType:U}),!z&&!b&&n.jsx(Ug,{node:t,getHandleColor:te,handleCursor:ne,onOutputHandleMouseDown:r,onOutputHandleTouchStart:a,t:B,isHovered:i,isCollapsed:t.isCollapsed,isProxy:G}),!E&&!t.isCollapsed&&(!z&&!b?n.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 cursor-se-resize group",onPointerDown:A=>R.handleResizeMouseDown(A,void 0),children:n.jsxs("svg",{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-full h-full text-gray-700 group-hover:text-accent-text transition-colors",children:[n.jsx("path",{d:"M12 6L6 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),n.jsx("path",{d:"M14 10L10 14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}):z&&!b&&n.jsxs(n.Fragment,{children:[n.jsx("div",{onPointerDown:A=>R.handleResizeMouseDown(A,"n"),className:"absolute top-0 left-0 w-full h-2 cursor-ns-resize z-20"}),n.jsx("div",{onPointerDown:A=>R.handleResizeMouseDown(A,"s"),className:"absolute bottom-0 left-0 w-full h-2 cursor-ns-resize z-20"}),n.jsx("div",{onPointerDown:A=>R.handleResizeMouseDown(A,"w"),className:"absolute top-0 left-0 w-2 h-full cursor-ew-resize z-20"}),n.jsx("div",{onPointerDown:A=>R.handleResizeMouseDown(A,"e"),className:"absolute top-0 right-0 w-2 h-full cursor-ew-resize z-20"}),n.jsx("div",{onPointerDown:A=>R.handleResizeMouseDown(A,"nw"),className:"absolute top-0 left-0 w-4 h-4 cursor-nwse-resize z-30"}),n.jsx("div",{onPointerDown:A=>R.handleResizeMouseDown(A,"ne"),className:"absolute top-0 right-0 w-4 h-4 cursor-nesw-resize z-30"}),n.jsx("div",{onPointerDown:A=>R.handleResizeMouseDown(A,"sw"),className:"absolute bottom-0 left-0 w-4 h-4 cursor-nesw-resize z-30"}),n.jsx("div",{onPointerDown:A=>R.handleResizeMouseDown(A,"se"),className:"absolute bottom-0 right-0 w-4 h-4 cursor-nwse-resize z-30"})]}))]})},sd=jt.memo(uT),pT=({connection:e,fromNode:t,toNode:o,start:r,end:a,isNodeHovered:i,activeTool:s,onDelete:l,onSplit:c,lineStyle:d})=>{const{isConnectionAnimationEnabled:u,connectionOpacity:p}=Ut()||{isConnectionAnimationEnabled:!0,connectionOpacity:.4},[h,w]=v.useState(!1),k=E=>{const I=E.isCollapsed?En:E.height;return{x:E.position.x,y:E.position.y,width:E.width,height:I,right:E.position.x+E.width,bottom:E.position.y+I}},y=d==="orthogonal"?((E,I,N,T)=>{const F=k(N),z=k(T),G=A=>{if(A.type!==L.REROUTE_DOT)return 1;try{return JSON.parse(A.value||"{}").direction==="RL"?-1:1}catch{return 1}},U=A=>{if(A.type!==L.REROUTE_DOT)return-1;try{return JSON.parse(A.value||"{}").direction==="RL"?1:-1}catch{return-1}},R=G(N),q=U(T),H=20,ne=I.x>E.x&&R===1&&q===-1,X=I.x<E.x&&R===-1&&q===1,re=N.type===L.REROUTE_DOT||T.type===L.REROUTE_DOT,de=re?30:150;if(ne&&I.x<E.x+de||!re&&X&&I.x>E.x-400){const A=(E.x+I.x)/2;return`M ${E.x} ${E.y} L ${A} ${E.y} L ${A} ${I.y} L ${I.x} ${I.y}`}const ge=0,te=[`M ${E.x} ${E.y}`];let le=E.x+R*H,ee=E.y;te.push(`L ${le} ${ee}`);const se=I.x+q*H,ie=I.y;if(R===1&&q===-1&&se>le||R===-1&&q===1&&se<le)if(T.type===L.REROUTE_DOT)te.push(`L ${le} ${ie}`),te.push(`L ${se} ${ie}`);else if(N.type===L.REROUTE_DOT)te.push(`L ${se} ${ee}`),te.push(`L ${se} ${ie}`);else{const A=(le+se)/2;te.push(`L ${A} ${ee}`),te.push(`L ${A} ${ie}`),te.push(`L ${se} ${ie}`)}else if(re&&R===q){let A=0;R===-1?A=Math.min(le,se):A=Math.max(le,se),te.push(`L ${A} ${ee}`),te.push(`L ${A} ${ie}`),te.push(`L ${se} ${ie}`)}else{let A=0;z.bottom+ge<F.y?A=(z.bottom+F.y)/2:z.y>F.bottom+ge?A=(F.bottom+z.y)/2:I.y<E.y?A=Math.min(F.y,z.y)-H:A=Math.max(F.bottom,z.bottom)+H,te.push(`L ${le} ${A}`),te.push(`L ${se} ${A}`),te.push(`L ${se} ${ie}`)}return te.push(`L ${I.x} ${I.y}`),te.join(" ")})(r,a,t,o):`M ${r.x} ${r.y} C ${r.x+80} ${r.y}, ${a.x-80} ${a.y}, ${a.x} ${a.y}`,g=Yn(t,e.fromHandleId),m="#6b7280";let x;switch(g){case"text":x="var(--color-connection-text)";break;case"image":x="var(--color-connection-image)";break;case"character_data":x="var(--color-connection-character)";break;case"video":x="var(--color-connection-video)";break;case"audio":x="var(--color-connection-audio)";break;default:x=m}const _=s==="cutter",S=s==="reroute",P=(_||S)&&(h||i),j=_&&P?"#ef4444":S&&P?"#06b6d4":x,M=P?1:p,D=P?5:3;let O="default";_&&(h||i)?O=`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="%23ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>') 12 12, auto`:S&&h?O="crosshair":(_||S)&&(O="pointer");const B=E=>{E.stopPropagation(),_?l(e.id):S&&c(e.id)};return n.jsxs("g",{className:"connection-view",onMouseEnter:()=>w(!0),onMouseLeave:()=>w(!1),onMouseDown:B,onTouchStart:B,style:{cursor:O,pointerEvents:"auto"},children:[n.jsx("path",{d:y,stroke:"transparent",strokeWidth:"20",fill:"none",style:{pointerEvents:"stroke"}}),n.jsx("path",{d:y,stroke:j,strokeWidth:D,fill:"none",style:{pointerEvents:"none",opacity:M,transition:"stroke 0.2s ease-in-out, stroke-width 0.2s ease-in-out, opacity 0.2s ease-in-out"}}),u&&n.jsx("path",{d:y,stroke:x,strokeWidth:3,fill:"none",className:"connection-flow",style:{pointerEvents:"none",opacity:1}})]})},hT=jt.memo(pT),mT=({group:e,onMouseDown:t,onTouchStart:o,onClose:r,onRename:a,onSaveToCatalog:i,onSaveToDisk:s,onCopy:l,onDuplicate:c,isHoveredForDrop:d,isDragging:u})=>{const{t:p}=St(),w=d||u?"border-solid border-node-selected shadow-[0_0_15px_rgba(34,211,238,0.15)]":"border-dashed border-gray-500";return n.jsx("div",{className:`group-view absolute bg-white/5 border-2 ${w} rounded-lg transition-colors duration-200 pointer-events-none`,style:{left:e.position.x,top:e.position.y,width:e.width,height:e.height,zIndex:u?490:5},children:n.jsxs("div",{className:"bg-gray-700/50 text-white font-bold p-2 rounded-t-md flex justify-between items-center cursor-move pointer-events-auto",onMouseDown:t,onTouchStart:o,onDoubleClick:()=>a(e.id,e.title),children:[n.jsx("span",{className:"truncate pr-2",children:e.title}),n.jsxs("div",{className:"flex items-center space-x-1",onMouseDown:b=>b.stopPropagation(),onTouchStart:b=>b.stopPropagation(),onDoubleClick:b=>b.stopPropagation(),children:[n.jsx(Pe,{title:p("group.rename"),onClick:()=>a(e.id,e.title),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),n.jsx(Pe,{title:p("node.action.copy"),onClick:()=>l&&l(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),n.jsx(Pe,{title:p("group.duplicate"),onClick:()=>c&&c(e.id),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("rect",{x:"5",y:"5",width:"14",height:"14",rx:"2",ry:"2"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m-3-3h6"})]})}),n.jsx(Pe,{title:p("group.saveToCatalog"),onClick:()=>i(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})}),n.jsx(Pe,{title:p("group.saveToDisk"),onClick:()=>s(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Pe,{title:p("group.ungroup"),onClick:b=>r(e.id,b),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})})},gT=jt.memo(mT),_o=({title:e,onClick:t,isActive:o=!1,children:r,hoverColor:a,vertical:i=!1})=>{const s=o?"bg-accent text-white shadow-md shadow-accent/20":`bg-gray-700 ${a||"hover:bg-accent hover:text-white"} text-gray-300`;return n.jsxs("div",{className:"relative group flex items-center",children:[n.jsx("button",{onClick:t,className:`p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 ${s}`,children:r}),n.jsx("div",{className:`absolute ${i?"left-full ml-2 top-1/2 -translate-y-1/2":"bottom-full left-1/2 -translate-x-1/2 mb-2"} px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 opacity-0 pointer-events-none group-hover:opacity-100`,role:"tooltip",children:e})]})},fT=({isSnapToGrid:e,onSnapToGridChange:t,lineStyle:o,onLineStyleChange:r,zoom:a,onZoomChange:i,scaleToSliderValue:s,sliderValueToScale:l,onClearCanvas:c,onSaveCanvas:d,onLoadCanvas:u,activeTool:p,onToolChange:h,isSmartGuidesEnabled:w,onSmartGuidesChange:k,onResetView:b,vertical:y=!1})=>{const{t:g}=St(),m=s(a),x=P=>{i(l(Number(P.target.value)))},_=y?"flex flex-col-reverse items-center gap-2 select-none":"flex items-center space-x-2 select-none",S=y?"flex flex-col-reverse items-center gap-1":"flex items-center space-x-1";return n.jsxs("div",{className:_,children:[n.jsxs("div",{className:S,children:[b&&n.jsx(_o,{title:g("toolbar.resetCamera"),onClick:b,vertical:y,children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),n.jsx(_o,{title:g("toolbar.zoom"),onClick:()=>h("zoom"),isActive:p==="zoom",vertical:y,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),!y&&n.jsxs("div",{className:"relative group flex items-center",children:[n.jsx("input",{type:"range",min:"-100",max:"100",step:"1",value:m,onChange:x,className:"w-24 h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-accent"}),n.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 opacity-0 pointer-events-none group-hover:opacity-100",role:"tooltip",children:"Zoom"})]}),n.jsx(_o,{title:g("toolbar.resetZoom"),onClick:()=>i(1),vertical:y,children:n.jsxs("span",{className:"text-xs font-semibold select-none",children:[Math.round(a*100),"%"]})})]}),!y&&n.jsx("div",{className:"w-px h-6 bg-gray-700 mx-1"}),y&&n.jsx("div",{className:"h-px w-6 bg-gray-700 my-1"}),n.jsxs("div",{className:S,children:[n.jsx(_o,{title:`${g("toolbar.snapToGrid")} (Shift+W)`,onClick:t,isActive:e,vertical:y,children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 24 24",children:[n.jsx("circle",{cx:"6",cy:"6",r:"1.5"}),n.jsx("circle",{cx:"12",cy:"6",r:"1.5"}),n.jsx("circle",{cx:"18",cy:"6",r:"1.5"}),n.jsx("circle",{cx:"6",cy:"12",r:"1.5"}),n.jsx("circle",{cx:"12",cy:"12",r:"1.5"}),n.jsx("circle",{cx:"18",cy:"12",r:"1.5"}),n.jsx("circle",{cx:"6",cy:"18",r:"1.5"}),n.jsx("circle",{cx:"12",cy:"18",r:"1.5"}),n.jsx("circle",{cx:"18",cy:"18",r:"1.5"})]})}),n.jsx(_o,{title:`${g("toolbar.smartGuides")} (Shift+L)`,onClick:k,isActive:w,vertical:y,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"4 4",d:"M12 3v18M3 12h18"})})}),n.jsx(_o,{title:`${g("toolbar.lineStyleSpaghetti")} (Shift+E)`,onClick:()=>r("spaghetti"),isActive:o==="spaghetti",vertical:y,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4c16 0 0 16 16 16"})})}),n.jsx(_o,{title:`${g("toolbar.lineStyleOrthogonal")} (Shift+E)`,onClick:()=>r("orthogonal"),isActive:o==="orthogonal",vertical:y,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8h8v8h8"})})})]}),!y&&n.jsx("div",{className:"w-px h-6 bg-gray-700 mx-1"}),y&&n.jsx("div",{className:"h-px w-6 bg-gray-700 my-1"}),n.jsxs("div",{className:S,children:[n.jsx(_o,{title:g("toolbar.clearCanvas"),onClick:c,hoverColor:"hover:bg-red-600",vertical:y,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})}),!y&&n.jsx("div",{className:"w-px h-6 bg-gray-700 mx-1"}),y&&n.jsx("div",{className:"h-px w-6 bg-gray-700 my-1"}),n.jsx(_o,{title:g("toolbar.saveCanvas"),onClick:d,vertical:y,children:n.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"square",strokeLinejoin:"miter",children:[n.jsx("path",{d:"M17.2928932,3.29289322 L21,7 L21,20 C21,20.5522847 20.5522847,21 20,21 L4,21 C3.44771525,21 3,20.5522847 3,20 L3,4 C3,3.44771525 3.44771525,3 4,3 L16.5857864,3 C16.8510029,3 17.1053568,3.10535684 17.2928932,3.29289322 Z"}),n.jsx("rect",{width:"10",height:"8",x:"7",y:"13"}),n.jsx("rect",{width:"8",height:"5",x:"8",y:"3"})]})}),n.jsx(_o,{title:g("toolbar.loadCanvas"),onClick:u,vertical:y,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z"})})})]})]})},Ss=({title:e,onClick:t,isActive:o=!1,children:r})=>{const a=o?"bg-accent text-white shadow-md shadow-accent/20":"bg-gray-700 hover:bg-accent hover:text-white text-gray-300";return n.jsxs("div",{className:"relative group flex items-center",children:[n.jsx("button",{onClick:t,"aria-label":e,className:`p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 ${a}`,children:r}),n.jsx("div",{className:"absolute left-full ml-3 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 opacity-0 pointer-events-none group-hover:opacity-100",role:"tooltip",children:e})]})},xT=({activeTool:e,onToolChange:t})=>{const{t:o}=St(),[r,a]=v.useState(56),i=v.useRef(!1),s=v.useRef({y:0,initialTop:0}),l=v.useRef(null),c=p=>{p.preventDefault(),p.stopPropagation(),i.current=!0,s.current={y:p.clientY,initialTop:r},p.currentTarget.setPointerCapture(p.pointerId)},d=p=>{var g;if(!i.current)return;const h=p.clientY-s.current.y;let w=s.current.initialTop+h;const k=56,b=window.innerHeight,y=((g=l.current)==null?void 0:g.offsetHeight)||0;w<k&&(w=k),w+y>b-k&&(w=b-y-k),a(w)},u=p=>{i.current=!1,p.currentTarget.releasePointerCapture(p.pointerId)};return n.jsxs("div",{ref:l,onMouseDown:p=>p.stopPropagation(),style:{top:`${r}px`},className:"absolute left-2 z-20 bg-gray-900/50 backdrop-blur-md p-1 rounded-lg shadow-lg flex flex-col items-center gap-1 border border-gray-700",children:[n.jsx("div",{onPointerDown:c,onPointerMove:d,onPointerUp:u,className:"w-full h-3 flex items-center justify-center cursor-ns-resize group hover:bg-gray-800/50 rounded-t-lg -mt-0.5",title:"Drag vertically",children:n.jsx("div",{className:"w-6 h-1 bg-gray-600 rounded-full group-hover:bg-gray-400 transition-colors"})}),n.jsx(Ss,{title:o("toolbar.edit"),onClick:()=>t("edit"),isActive:e==="edit",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})}),n.jsx(Ss,{title:o("toolbar.cutter"),onClick:()=>t("cutter"),isActive:e==="cutter",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(Ss,{title:o("toolbar.selection"),onClick:()=>t("selection"),isActive:e==="selection",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"4 4",d:"M3.75 3.75h16.5v16.5H3.75z"})})}),n.jsx(Ss,{title:o("toolbar.reroute"),onClick:()=>t("reroute"),isActive:e==="reroute",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})})]})},Gt=({title:e,onClick:t,isActive:o=!1,children:r,hoverColorClass:a})=>{const i="p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9",s="bg-accent text-white shadow-lg shadow-accent/20",l=`bg-gray-700 ${a||"hover:bg-accent hover:text-white"} text-gray-300`;return n.jsxs("div",{className:"relative group flex items-center",children:[n.jsx("button",{onClick:t,"aria-label":e,className:`${i} ${o?s:l}`,children:r}),n.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 opacity-0 pointer-events-none group-hover:opacity-100",role:"tooltip",children:e})]})},So=({title:e,children:t,isDetached:o,hoverColorClass:r,titleColorClass:a,isCompact:i})=>n.jsxs("div",{className:"flex flex-col items-center",children:[!o&&!i&&n.jsx("span",{className:`text-xs font-semibold mb-1 select-none ${a||"text-gray-400"}`,children:e}),n.jsx("div",{className:"flex items-center space-x-1",children:jt.Children.map(t,l=>jt.isValidElement(l)?jt.cloneElement(l,{hoverColorClass:r}):l)})]}),yT=({onAddNode:e,onOpenSearch:t,onToggleCatalog:o,onSaveCanvas:r,onLoadCanvas:a,isDetached:i,onSaveProject:s,isCompact:l})=>{const{t:c}=St(),d=Ut(),{tutorialStep:u,advanceTutorial:p,skipTutorial:h,handleSaveToDrive:w,isGoogleDriveSaving:k}=d||{},b=i?"grid grid-cols-3 gap-2":"flex items-center flex-wrap justify-center gap-2";return n.jsxs("div",{className:b,children:[n.jsx(Fn,{content:c("tutorial.group.catalog"),isActive:u==="toolbar_group_catalog",position:"top",onNext:p,onSkip:h,children:n.jsxs(So,{title:c("toolbar.group.catalog"),isDetached:i,isCompact:l,children:[n.jsx(Gt,{title:c("toolbar.addNode"),onClick:t,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),n.jsx(Gt,{title:c("toolbar.catalog"),onClick:o,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})})})]})}),n.jsx(Fn,{content:c("tutorial.group.general"),isActive:u==="toolbar_group_general",position:"top",onNext:p,onSkip:h,children:n.jsxs(So,{title:c("toolbar.group.general"),isDetached:i,isCompact:l,children:[n.jsx(Gt,{title:c("toolbar.addNote"),onClick:y=>e(L.NOTE,y),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),n.jsx(Gt,{title:c("toolbar.addDataReader"),onClick:y=>e(L.DATA_READER,y),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})}),n.jsx(Fn,{content:c("tutorial.group.input"),isActive:u==="toolbar_group_input",position:"top",onNext:p,onSkip:h,children:n.jsxs(So,{title:c("toolbar.group.input"),isDetached:i,isCompact:l,children:[n.jsx(Gt,{title:c("toolbar.addTextInput"),onClick:y=>e(L.TEXT_INPUT,y),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 6h10M12 6v12"})})}),n.jsx(Gt,{title:c("toolbar.addImageInput"),onClick:y=>e(L.IMAGE_INPUT,y),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{d:"M21 15l-5-5L5 21"})]})}),n.jsx(Gt,{title:c("search.node.media_viewer.title"),onClick:y=>e(L.MEDIA_VIEWER,y),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})}),n.jsx(Gt,{title:c("toolbar.addPromptSequenceEditor"),onClick:y=>e(L.PROMPT_SEQUENCE_EDITOR,y),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z"})})})]})}),n.jsx(Fn,{content:c("tutorial.group.processing"),isActive:u==="toolbar_group_processing",position:"top",onNext:p,onSkip:h,children:n.jsxs(So,{title:c("toolbar.group.processing"),isDetached:i,isCompact:l,children:[n.jsx(Gt,{title:c("toolbar.addImageAnalyzer"),onClick:y=>e(L.IMAGE_ANALYZER,y),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12.792V5.25a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 5.25v13.5A2.25 2.25 0 005.25 21h7.55"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 18.375L21 21"})]})}),n.jsx(Gt,{title:c("toolbar.addPromptAnalyzer"),onClick:y=>e(L.PROMPT_ANALYZER,y),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})}),n.jsx(Gt,{title:c("toolbar.addPromptProcessor"),onClick:y=>e(L.PROMPT_PROCESSOR,y),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})})]})}),n.jsx(Fn,{content:c("tutorial.group.character"),isActive:u==="toolbar_group_character",position:"top",onNext:p,onSkip:h,children:n.jsxs(So,{title:c("toolbar.group.character"),isDetached:i,isCompact:l,children:[n.jsx(Gt,{title:c("toolbar.addCharacterGenerator"),onClick:y=>e(L.CHARACTER_GENERATOR,y),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})})}),n.jsx(Gt,{title:c("toolbar.addCharacterAnalyzer"),onClick:y=>e(L.CHARACTER_ANALYZER,y),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})}),n.jsx(Gt,{title:c("toolbar.addCharacterCard"),onClick:y=>e(L.CHARACTER_CARD,y),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 8a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5a7.5 7.5 0 0115 0"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.5a.75.75 0 00-.75.75v13.5c0 .414.336.75.75.75h16.5a.75.75 0 00.75-.75V5.25a.75.75 0 00-.75-.75H3.75z"})]})}),n.jsx(Gt,{title:c("search.node.pose_creator.title"),onClick:y=>e(L.POSE_CREATOR,y),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})})]})}),n.jsx(Fn,{content:c("tutorial.group.output"),isActive:u==="toolbar_group_output",position:"top",onNext:p,onSkip:h,children:n.jsxs(So,{title:c("toolbar.group.output"),isDetached:i,isCompact:l,children:[n.jsx(Gt,{title:c("toolbar.addImageOutput"),onClick:y=>e(L.IMAGE_OUTPUT,y),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})}),n.jsx(Gt,{title:c("toolbar.addImageEditor"),onClick:y=>e(L.IMAGE_EDITOR,y),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-5 h-5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]})}),n.jsx(Gt,{title:c("toolbar.addImageSequenceGenerator"),onClick:y=>e(L.IMAGE_SEQUENCE_GENERATOR,y),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})})})]})}),n.jsx(Fn,{content:c("tutorial.group.ai"),isActive:u==="toolbar_group_ai",position:"top",onNext:p,onSkip:h,children:n.jsxs(So,{title:c("toolbar.group.aiTools"),isDetached:i,isCompact:l,children:[n.jsx(Gt,{title:c("toolbar.addTranslator"),onClick:y=>e(L.TRANSLATOR,y),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})}),n.jsx(Gt,{title:c("toolbar.addGeminiChat"),onClick:y=>e(L.GEMINI_CHAT,y),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})}),n.jsx(Fn,{content:c("tutorial.group.scripts"),isActive:u==="toolbar_group_scripts",position:"top",onNext:p,onSkip:h,children:n.jsxs(So,{title:c("toolbar.group.scripts"),isDetached:i,isCompact:l,children:[n.jsx(Gt,{title:c("toolbar.addScriptGenerator"),onClick:y=>e(L.SCRIPT_GENERATOR,y),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})}),n.jsx(Gt,{title:c("toolbar.addScriptViewer"),onClick:y=>e(L.SCRIPT_VIEWER,y),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 19.82a2.25 2.25 0 01-1.897 1.13l-2.685.8.8-2.685a2.25 2.25 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})})]})}),n.jsx(Fn,{content:c("tutorial.group.video"),isActive:u==="toolbar_group_video",position:"top",onNext:p,onSkip:h,children:n.jsxs(So,{title:c("toolbar.group.video"),isDetached:i,isCompact:l,children:[n.jsx(Gt,{title:c("toolbar.addVideoPromptProcessor"),onClick:y=>e(L.VIDEO_PROMPT_PROCESSOR,y),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7l-2 4 4 2-4 2-2 4-2-4-4-2 4-2z"})]})}),n.jsx(Gt,{title:c("toolbar.addVideoOutput"),onClick:y=>e(L.VIDEO_OUTPUT,y),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9A2.25 2.25 0 0013.5 5.25h-9A2.25 2.25 0 002.25 7.5v9A2.25 2.25 0 004.5 18.75z"})})}),n.jsx(Gt,{title:c("node.title.video_editor"),onClick:y=>e(L.VIDEO_EDITOR,y),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})]})})]})}),n.jsx(Fn,{content:c("tutorial.group.file"),isActive:u==="toolbar_group_file",position:"top",onNext:p,onSkip:h,children:n.jsxs(So,{title:c("toolbar.group.file"),isDetached:i,isCompact:l,children:[n.jsx(Gt,{title:c("toolbar.saveProject"),onClick:()=>s&&s(),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"})})}),n.jsx(Gt,{title:c("toolbar.saveCanvas"),onClick:r,children:n.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"square",strokeLinejoin:"miter",children:[n.jsx("path",{d:"M17.2928932,3.29289322 L21,7 L21,20 C21,20.5522847 20.5522847,21 20,21 L4,21 C3.44771525,21 3,20.5522847 3,20 L3,4 C3,3.44771525 3.44771525,3 4,3 L16.5857864,3 C16.8510029,3 17.1053568,3.10535684 17.2928932,3.29289322 Z"}),n.jsx("rect",{width:"10",height:"8",x:"7",y:"13"}),n.jsx("rect",{width:"8",height:"5",x:"8",y:"3"})]})}),n.jsx(Gt,{title:c("toolbar.loadCanvas"),onClick:a,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z"})})})]})})]})},vT=jt.memo(yT),wT=({title:e,children:t,align:o="center"})=>{const r=o==="left"?"left-0 bottom-full mb-2 origin-bottom-left":"left-1/2 -translate-x-1/2 bottom-full mb-2 origin-bottom";return n.jsxs("div",{className:"relative group flex items-center justify-center",children:[t,n.jsx("div",{className:`absolute px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 ease-in-out transform ${r} opacity-0 pointer-events-none group-hover:opacity-100`,role:"tooltip",children:e})]})},bT=()=>{const e=Ut(),{t}=St(),[o,r]=v.useState(!1),[a,i]=v.useState(!1),[s,l]=v.useState(!1),[c,d]=v.useState(!1),[u,p]=v.useState(0),[h,w]=v.useState({width:window.innerWidth,height:window.innerHeight}),k=v.useCallback(Ze=>{Ze!==null&&p(Ze.getBoundingClientRect().height)},[]);if(v.useEffect(()=>{const Ze=()=>{w({width:window.innerWidth,height:window.innerHeight});const cn=800+450*2;i(window.innerWidth<cn)};return window.addEventListener("resize",Ze),()=>window.removeEventListener("resize",Ze)},[]),!e)return null;const{nodes:b,connections:y,groups:g,viewTransform:m,handleCanvasMouseDown:x,handleCanvasContextMenu:_,handleCanvasTouchStart:S,handleCanvasTouchMove:P,handleCanvasTouchEnd:j,updatePointerPosition:M,handleWheel:D,handleCanvasDoubleClick:O,handleDrop:B,handleDragOver:E,handleDragEnter:I,handleDragLeave:N,getCanvasCursor:T,setCanvasRef:F,dockHoverMode:z,handleDockNode:G,handleUndockNode:U,focusedNodeId:R,selectedNodeIds:q,hoveredNodeId:H,setHoveredNodeId:ne,dragOverNodeId:X,draggingInfo:re,connectingInfo:de,connectionTarget:ge,spawnLine:te,activeTool:le,setActiveTool:ee,effectiveTool:se,deleteNodeAndConnections:ie,removeConnectionsByNodeId:oe,copyNodeValue:A,pasteNodeValue:K,pasteImageToNode:Z,handleDownloadImage:W,handleDuplicateNode:Q,handleDuplicateNodeWithContent:ce,handleToggleNodeCollapse:fe,handleDetachNodeFromGroup:$,handleStartConnection:V,handleStartConnectionTouch:J,handleNodeCutConnections:Y,handleNodeTouchStart:ae,handleGroupMouseDown:ue,handleGroupTouchStart:he,handleRemoveGroup:ye,handleSaveGroupToCatalog:ve,handleSaveGroupToDisk:me,copyGroup:_e,duplicateGroup:pe,hoveredGroupIdForDrop:xe,handleGroupSelection:Se,handleAlignNodes:Le,undoPosition:Ee,redoPosition:Me,canUndo:De,canRedo:Te,handleValueChange:Re,handleEnhance:we,isEnhancing:Ce,handleEnhanceVideo:qe,isEnhancingVideo:Be,onSanitize:Ie,isSanitizing:We,handleAnalyzePrompt:at,isAnalyzing:Jt,handleAnalyzeCharacter:Oe,isAnalyzingCharacter:Ae,handleAnalyzeImage:Ue,isAnalyzingImage:ke,handleGenerateImage:Ne,isGeneratingImage:He,handleExecuteChain:Fe,isExecutingChain:$e,stopChainExecution:Ye,executingNodeId:st,handleEditImage:ht,isEditingImage:ft,handleSendMessage:mt,isChatting:dt,handleTranslate:kt,isTranslating:Ct,handleGenerateScript:vt,isGeneratingScript:yt,triggerLoadScriptFile:wt,handleGenerateCharacters:qn,isGeneratingCharacters:Cn,handleGenerateVideo:Pt,isGeneratingVideo:je,handleGenerateImageSequence:Ve,onGenerateSelectedFrames:Ke,isGeneratingSequence:Xe,handleStopImageSequence:rt,isStoppingSequence:ot,handleRegenerateFrame:et,onDownloadImageFromUrl:bt,onCopyImageToClipboard:_t,triggerLoadImageSequenceFile:xt,triggerLoadPromptSequenceFile:Nt,handleProcessImage:It,isProcessingImage:Zo,handleSetImageEditorOutputToInput:tc,connectedInputs:Gi,connectedImageSources:nc,connectedCharacterData:oc,libraryItems:rc,handleProcessChainForward:ac,handleSaveCharacterCard:ic,triggerLoadCharacterCard:sc,handleDetachAndPasteConcept:lc,onDetachImageToNode:cc,onSaveCharacterToCatalog:dc,onSaveScriptToCatalog:uc,onSaveSequenceToCatalog:pc,setError:hc,setImageViewer:mc,addToast:gc,getFullSizeImage:be,setFullSizeImage:Ge,clearImagesForNodeFromCache:ze,onTranslateScript:Je,isTranslatingScript:tt,onReadData:Qe,getUpstreamNodeValues:lt,onRefreshUpstreamData:ct,onModifyPromptSequence:Ht,isModifyingPromptSequence:At,onSavePromptToLibrary:qt,onSaveToLibrary:kn,onGenerateCharacterImage:an,isGeneratingCharacterImage:Xo,onDetachCharacter:Va,onStopGeneration:fc,isStopping:xc,clearSelectionsSignal:my,onSaveScriptToDisk:gy,onSaveMediaToDisk:fy,onSaveGeneratedCharacterToCatalog:xy,isGlobalProcessing:yy,isInstantCloseEnabled:vy,onImageToText:wy,onUpdateCharacterDescription:by,isUpdatingDescription:Cy,isSnapToGrid:ky,setIsSnapToGrid:_y,lineStyle:Hp,setLineStyle:Sy,handleZoomChange:Ny,scaleToSliderValue:Ey,sliderValueToScale:Py,handleClearCanvas:jy,isSmartGuidesEnabled:Ty,setIsSmartGuidesEnabled:Iy,resetView:Ay,smartGuides:My,selectionRect:Ao,groupButtonPosition:yc,getConnectionPoints:Ry,removeConnectionById:Ly,handleSplitConnection:Dy,onRefreshChat:zy,handleRefreshImageEditor:qy,handleAutoDownloadChange:Oy,handleModelChange:Fy,handleResolutionChange:By,handleAspectRatioChange:Hy,onRenameCharacter:pI,onRenameScript:hI,onRenameSequence:mI,handleRenameNode:gI,setRenameInfo:Gy,handleToggleNodePin:Uy,onAddNode:Vy,handleOpenQuickSearch:Wy,handleToggleCatalog:$y,handleSaveCanvas:Gp,handleLoadCanvas:Up,handleSaveProject:Ky,getTransformedPoint:Vp,setSpawnLine:vc,tutorialStep:Jy,advanceTutorial:Yy}=e,Zy=v.useMemo(()=>{const Ze=new Map;return g.forEach(Ft=>{Ft.nodeIds.forEach(nn=>{Ze.set(nn,Ft.id)})}),Ze},[g]),Wp=(re==null?void 0:re.type)==="group"?re.id:null,wc=v.useMemo(()=>{const{scale:Ze,translate:Ft}=m,nn=300/Ze,cn={left:-Ft.x/Ze-nn,top:-Ft.y/Ze-nn,right:(h.width-Ft.x)/Ze+nn,bottom:(h.height-Ft.y)/Ze+nn},uo=on=>{if(on.dockState||on.isPinned||(re==null?void 0:re.type)==="node"&&re.offsets.has(on.id))return!0;const o2=on.isCollapsed?En:on.height;return on.position.x<cn.right&&on.position.x+on.width>cn.left&&on.position.y<cn.bottom&&on.position.y+o2>cn.top},to=b.filter(uo),Er=new Set(to.map(on=>on.id)),t2=y.filter(on=>Er.has(on.fromNodeId)||Er.has(on.toNodeId)),n2=g.filter(on=>on.position.x<cn.right&&on.position.x+on.width>cn.left&&on.position.y<cn.bottom&&on.position.y+on.height>cn.top);return{visibleNodes:to,visibleConnections:t2,visibleGroups:n2}},[b,y,g,m,h,re]),bc=Ze=>{const Ft=Zy.get(Ze.id),nn=!!Ft,cn=!!Wp&&Ft===Wp;return{key:Ze.id,node:Ze,isGrouped:nn,isGroupDragging:cn,onMouseDown:uo=>e.handleNodeMouseDown(uo,Ze.id),onTouchStart:ae,onResizeMouseDown:e.handleNodeResizeMouseDown,onValueChange:Re,onEnhance:we,isEnhancing:Ce===Ze.id,onEnhanceVideo:qe,isEnhancingVideo:Be===Ze.id,onSanitize:Ie,isSanitizing:We===Ze.id,onAnalyze:at,isAnalyzing:Jt===Ze.id,onAnalyzeCharacter:Oe,isAnalyzingCharacter:Ae===Ze.id,onAnalyzeImage:Ue,isAnalyzingImage:ke===Ze.id,onImageToText:wy,onGenerateImage:Ne,isGeneratingImage:He===Ze.id,onExecuteChain:Fe,isExecutingChain:$e,isExecuting:st===Ze.id,onStopChainExecution:Ye,onEditImage:ht,isEditingImage:ft,onSendMessage:mt,isChatting:dt===Ze.id,onTranslate:kt,isTranslating:Ct===Ze.id,onGenerateScript:vt,isGeneratingScript:yt===Ze.id,onLoadScriptFile:wt,onGenerateCharacters:qn,isGeneratingCharacters:Cn===Ze.id,onGenerateVideo:Pt,isGeneratingVideo:je===Ze.id,onGenerateImageSequence:Ve,onGenerateSelectedFrames:Ke,isGeneratingSequence:Xe===Ze.id,onStopImageSequence:rt,isStoppingSequence:ot,onRegenerateFrame:et,onDownloadImageFromUrl:bt,onCopyImageToClipboard:_t,onLoadImageSequenceFile:xt,onLoadPromptSequenceFile:Nt,onProcessImage:It,isProcessingImage:Zo===Ze.id,activeTool:se,onOutputHandleMouseDown:V,onOutputHandleTouchStart:J,onNodeClick:Y,isHovered:H===Ze.id,isSelected:q.includes(Ze.id),onNodeMouseEnter:()=>ne(Ze.id),onNodeMouseLeave:()=>ne(null),onDeleteNode:ie,onCutConnections:oe,onCopyNodeValue:A,onPasteNodeValue:K,onPasteImage:Z,onDownloadImage:W,onDuplicateNode:Q,onDuplicateNodeWithContent:ce,onAspectRatioChange:Hy,onResolutionChange:By,onModelChange:Fy,onAutoDownloadChange:Oy,onRefreshChat:zy,onRefreshImageEditor:qy,connectedInputs:Gi.get(Ze.id),onSetImageEditorOutputToInput:tc,connectingInfo:de,connectionTarget:ge,connectedImageSources:nc.get(Ze.id),connectedCharacterData:oc.get(Ze.id),libraryItems:rc,onToggleCollapse:fe,deselectAllNodes:e.deselectAllNodes,isDragOverTarget:X===Ze.id,onProcessChainForward:ac,onSaveCharacterCard:ic,onLoadCharacterCard:sc,onDetachAndPasteConcept:lc,onDetachImageToNode:cc,onSaveCharacterToCatalog:dc,onSaveScriptToCatalog:uc,onSaveSequenceToCatalog:pc,setError:hc,setImageViewer:mc,addToast:gc,getFullSizeImage:be,setFullSizeImage:Ge,clearImagesForNodeFromCache:ze,onTranslateScript:Je,isTranslatingScript:tt,onReadData:Qe,getUpstreamNodeValues:lt,onRefreshUpstreamData:ct,onModifyPromptSequence:Ht,isModifyingPromptSequence:At===Ze.id,onDetachNodeFromGroup:$,viewTransform:Ze.type===L.IMAGE_EDITOR||Ze.type===L.PROMPT_SEQUENCE_EDITOR||Ze.type===L.IMAGE_SEQUENCE_GENERATOR?m:void 0,onSavePromptToLibrary:qt,onSaveToLibrary:kn,onRenameNode:(uo,to)=>Gy({type:"node",id:uo,currentTitle:to}),onGenerateCharacterImage:an,isGeneratingCharacterImage:Xo,onDetachCharacter:Va,onStopGeneration:fc,isStopping:xc,clearSelectionsSignal:my,onSaveScriptToDisk:gy,onSaveMediaToDisk:fy,onSaveGeneratedCharacterToCatalog:xy,isDragging:(re==null?void 0:re.type)==="node"&&re.offsets.has(Ze.id),isGlobalProcessing:yy,isInstantCloseEnabled:vy,handleDockNode:G,handleUndockNode:U,onToggleNodePin:Uy,onUpdateCharacterDescription:by,isUpdatingDescription:Cy}},{dockedNodes:Xy}=v.useMemo(()=>({dockedNodes:b.filter(Ft=>Ft.dockState)}),[b]),Ui=R?b.find(Ze=>Ze.id===R):null,Qy=(Ze,Ft)=>{const nn={x:window.innerWidth/2,y:window.innerHeight*.25},cn=Vp(nn);Vy(Ze,cn);const uo=Ft?{x:Ft.clientX,y:Ft.clientY}:{x:window.innerWidth/2,y:window.innerHeight-80},to=Vp(uo);vc({start:to,end:cn,fading:!1}),setTimeout(()=>{vc(Er=>Er?{...Er,fading:!0}:null),setTimeout(()=>vc(null),500)},100)},e2=Ze=>{switch(Ze){case"text":return"var(--color-connection-text)";case"image":return"var(--color-connection-image)";case"character_data":return"var(--color-connection-character)";case"video":return"var(--color-connection-video)";case"audio":return"var(--color-connection-audio)";default:return"var(--color-border)"}};return n.jsxs("div",{id:"app-container",className:`relative w-full h-full overflow-hidden select-none ${R?"bg-gray-700":""}`,onMouseDown:x,onContextMenu:_,onTouchStart:S,onTouchMove:P,onTouchEnd:j,onMouseMove:M,onWheel:D,onDoubleClick:O,onDrop:B,onDragOver:E,onDragEnter:I,onDragLeave:N,style:{cursor:T()},children:[!R&&n.jsx(xT,{activeTool:se,onToolChange:ee}),!R&&Xy.map(Ze=>n.jsx(sd,{node:Ze,...bc(Ze)},`${Ze.id}-docked`)),!R&&n.jsxs("div",{id:"canvas-transform-layer",style:{width:"1px",height:"1px",transform:`translate(${m.translate.x}px, ${m.translate.y}px) scale(${m.scale})`,transformOrigin:"0 0"},children:[n.jsxs("div",{className:"absolute top-0 left-0 w-0 h-0 overflow-visible pointer-events-none z-0",children:[n.jsx("div",{className:"absolute top-0 left-[-50000px] w-[100000px] h-[1px] bg-cyan-900/30 -translate-y-1/2"}),n.jsx("div",{className:"absolute left-0 top-[-50000px] w-[1px] h-[100000px] bg-cyan-900/30 -translate-x-1/2"}),n.jsxs("div",{className:"absolute top-0 left-0 w-4 h-4 -translate-x-1/2 -translate-y-1/2 flex items-center justify-center",children:[n.jsx("div",{className:"absolute w-3 h-[2px] bg-accent shadow-[0_0_5px_var(--color-accent)]"}),n.jsx("div",{className:"absolute h-3 w-[2px] bg-accent shadow-[0_0_5px_var(--color-accent)]"})]})]}),Ao&&n.jsx("div",{className:"absolute border-2 border-dashed border-accent-text pointer-events-none",style:{left:Math.min(Ao.start.x,Ao.end.x),top:Math.min(Ao.start.y,Ao.end.y),width:Math.abs(Ao.start.x-Ao.end.x),height:Math.abs(Ao.start.y-Ao.end.y),zIndex:100,backgroundColor:"var(--color-selection)"}}),yc&&n.jsxs("div",{className:"absolute z-20 flex items-center gap-2 -translate-x-1/2",style:{left:yc.x,top:yc.y},onMouseDown:Ze=>Ze.stopPropagation(),onTouchStart:Ze=>Ze.stopPropagation(),children:[n.jsx(ut,{content:t("hotkeys.tools.group"),position:"top",children:n.jsxs("button",{onClick:Se,className:"px-4 py-2 font-bold text-white bg-accent rounded-md hover:bg-accent-hover transition-all duration-200 shadow-lg flex items-center space-x-2 whitespace-nowrap shadow-accent/20",children:[n.jsx(J3,{}),n.jsx("span",{children:t("group.button.create",{count:q.length})})]})}),n.jsxs("div",{className:"flex bg-gray-800/90 backdrop-blur-md rounded-lg shadow-lg p-1 space-x-1 border border-gray-700",children:[n.jsxs("div",{className:"flex items-center space-x-1 pr-1 border-r border-gray-600 mr-1",children:[n.jsx(ut,{content:t("contextMenu.undoPosition"),position:"top",children:n.jsx("button",{onClick:()=>Ee&&Ee(b),disabled:!De,className:`p-1.5 rounded transition-colors ${De?"text-gray-300 hover:bg-gray-700 hover:text-white":"text-gray-600 cursor-not-allowed"}`,children:n.jsx(H3,{})})}),n.jsx(ut,{content:t("contextMenu.redoPosition"),position:"top",children:n.jsx("button",{onClick:()=>Me&&Me(b),disabled:!Te,className:`p-1.5 rounded transition-colors ${Te?"text-gray-300 hover:bg-gray-700 hover:text-white":"text-gray-600 cursor-not-allowed"}`,children:n.jsx(G3,{})})})]}),n.jsx(ut,{content:t("contextMenu.align.left"),position:"top",children:n.jsx("button",{onClick:()=>Le(q,"left"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(J1,{})})}),n.jsx(ut,{content:t("contextMenu.align.centerX"),position:"top",children:n.jsx("button",{onClick:()=>Le(q,"center-x"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(Y1,{})})}),n.jsx(ut,{content:t("contextMenu.align.right"),position:"top",children:n.jsx("button",{onClick:()=>Le(q,"right"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(Z1,{})})}),n.jsx("div",{className:"w-px bg-gray-600 mx-1"}),n.jsx(ut,{content:t("contextMenu.align.top"),position:"top",children:n.jsx("button",{onClick:()=>Le(q,"top"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(U3,{})})}),n.jsx(ut,{content:t("contextMenu.align.centerY"),position:"top",children:n.jsx("button",{onClick:()=>Le(q,"center-y"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(V3,{})})}),n.jsx(ut,{content:t("contextMenu.align.bottom"),position:"top",children:n.jsx("button",{onClick:()=>Le(q,"bottom"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(W3,{})})}),q.length>=3&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"w-px bg-gray-600 mx-1"}),n.jsx(ut,{content:t("contextMenu.distribute.horizontal"),position:"top",children:n.jsx("button",{onClick:()=>Le(q,"distribute-horizontal"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx($3,{})})}),n.jsx(ut,{content:t("contextMenu.distribute.vertical"),position:"top",children:n.jsx("button",{onClick:()=>Le(q,"distribute-vertical"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(K3,{})})})]})]})]}),n.jsxs("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none z-0 overflow-visible",children:[wc.visibleConnections.map(Ze=>{const Ft=b.find(to=>to.id===Ze.fromNodeId),nn=b.find(to=>to.id===Ze.toNodeId);if(!Ft||!nn)return null;const{start:cn,end:uo}=Ry(Ft,nn,Ze);return n.jsx(hT,{connection:Ze,fromNode:Ft,toNode:nn,start:cn,end:uo,isNodeHovered:se==="cutter"&&(H===Ze.fromNodeId||H===Ze.toNodeId),activeTool:se,onDelete:Ly,onSplit:Dy,lineStyle:Hp},Ze.id)}),de&&n.jsx("path",{d:`M ${de.fromPoint.x} ${de.fromPoint.y} C ${de.fromPoint.x+80} ${de.fromPoint.y}, ${e.pointerPosition.x-80} ${e.pointerPosition.y}, ${e.pointerPosition.x} ${e.pointerPosition.y}`,stroke:e2(de.fromType),strokeWidth:"3",fill:"none",style:{strokeDasharray:"8 4",pointerEvents:"none"}}),My.map((Ze,Ft)=>{const nn=Ze.type==="vertical",cn=nn?Ze.position:Ze.start,uo=nn?Ze.start:Ze.position,to=nn?Ze.position:Ze.end,Er=nn?Ze.end:Ze.position;return n.jsx("line",{x1:cn,y1:uo,x2:to,y2:Er,stroke:"#ec4899",strokeWidth:"1",strokeDasharray:"4 2"},`guide-${Ft}`)})]}),wc.visibleGroups.map(Ze=>n.jsx(gT,{group:Ze,onMouseDown:Ft=>e.handleGroupMouseDown(Ft,Ze.id),onTouchStart:Ft=>e.handleGroupTouchStart(Ft,Ze.id),onClose:ye,onRename:(Ft,nn)=>e.setRenameInfo({type:"group",id:Ft,currentTitle:nn}),onSaveToCatalog:()=>ve(Ze.id),onSaveToDisk:()=>me(Ze.id),onCopy:_e,onDuplicate:pe,isHoveredForDrop:xe===Ze.id,isDragging:(re==null?void 0:re.type)==="group"&&re.id===Ze.id},Ze.id)),wc.visibleNodes.map(Ze=>n.jsx(sd,{node:Ze,...bc(Ze),isProxy:!!Ze.dockState},Ze.id)),n.jsx("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none z-[15] overflow-visible",children:te&&n.jsx("path",{d:`M ${te.start.x} ${te.start.y} L ${te.end.x} ${te.end.y}`,stroke:"var(--color-text-accent)",strokeWidth:"2",fill:"none",style:{strokeDasharray:"6 4",transition:"opacity 0.5s ease-out",opacity:te.fading?0:1}})})]}),Ui&&n.jsx(sd,{node:Ui,...bc(Ui),isFocused:!0},`${Ui.id}-focused`),!R&&n.jsxs("div",{className:"absolute left-1/2 z-20 flex flex-col items-center transition-transform duration-300 ease-in-out",style:{bottom:"8px",transform:s?`translate(-50%, calc(100% - ${u>0?u:32}px))`:"translate(-50%, 0)",maxWidth:"calc(100% - 112px)",width:"max-content"},onMouseDown:Ze=>Ze.stopPropagation(),children:[n.jsxs("div",{ref:k,className:"flex items-center justify-center bg-gray-800/90 backdrop-blur-md border border-gray-600 border-b-0 rounded-t-lg shadow-sm overflow-hidden",children:[n.jsx("button",{onClick:Ze=>{Ze.stopPropagation(),d(!c)},className:`px-3 py-1 transition-colors flex items-center justify-center hover:bg-gray-700 focus:outline-none ${c?"text-accent-text":"text-gray-400 hover:text-gray-200"}`,title:c?"Expand Titles":"Compact Mode (Hide Titles)",children:c?n.jsx(Nl,{className:"h-3.5 w-3.5"}):n.jsx(Sl,{className:"h-3.5 w-3.5"})}),n.jsx("div",{className:"w-px h-3 bg-gray-600"}),n.jsx("button",{onClick:Ze=>{Ze.stopPropagation(),l(!s)},className:"px-3 py-1 transition-colors flex items-center justify-center hover:bg-gray-700 focus:outline-none text-gray-400 hover:text-gray-200",title:t(s?"toolbar.expandPanel":"toolbar.collapsePanel"),children:n.jsx("div",{className:`transform transition-transform duration-300 ${s?"rotate-180":"rotate-0"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})})]}),n.jsx("div",{className:"bg-gray-900/50 backdrop-blur-md border border-gray-700 rounded-lg p-1 shadow-2xl w-full",children:n.jsx(vT,{onAddNode:Qy,onOpenSearch:()=>Wy({x:window.innerWidth/2,y:window.innerHeight/2}),onToggleCatalog:$y,onSaveCanvas:Gp,onLoadCanvas:Up,onSaveProject:Ky,isDetached:!1,isCompact:c})})]}),!R&&n.jsx("div",{className:"absolute bottom-2 left-2 z-20 pointer-events-auto",onMouseDown:Ze=>Ze.stopPropagation(),children:n.jsx("div",{className:"bg-gray-900/50 backdrop-blur-md p-1 rounded-lg border border-gray-700 shadow-lg",children:n.jsxs("div",{className:`flex ${a?"flex-col-reverse items-start gap-2":"flex-row items-center space-x-2"}`,children:[n.jsx(wT,{title:t(o?"toolbar.expandPanel":"toolbar.collapsePanel"),align:"left",children:n.jsx("button",{onClick:()=>r(Ze=>!Ze),className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300",children:o?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})})}),!o&&n.jsx(fT,{isSnapToGrid:ky,onSnapToGridChange:()=>_y(Ze=>!Ze),lineStyle:Hp,onLineStyleChange:Sy,zoom:m.scale,onZoomChange:Ny,scaleToSliderValue:Ey,sliderValueToScale:Py,onClearCanvas:jy,onSaveCanvas:Gp,onLoadCanvas:Up,activeTool:se,onToolChange:ee,isSmartGuidesEnabled:Ty,onSmartGuidesChange:()=>Iy(Ze=>!Ze),onResetView:Ay,vertical:a})]})})}),Jy==="tutorial_success_message"&&n.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/70 backdrop-blur-sm animate-fade-in",children:n.jsxs("div",{className:"bg-gray-800 rounded-2xl shadow-2xl border-2 border-cyan-500 p-8 max-w-md text-center transform scale-100 transition-all",children:[n.jsx("div",{className:"w-20 h-20 bg-cyan-900/50 rounded-full flex items-center justify-center mx-auto mb-6 ring-4 ring-cyan-500/30",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-cyan-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),n.jsx("h2",{className:"text-3xl font-bold text-white mb-4",children:t("tutorial.success.title")}),n.jsx("p",{className:"text-gray-300 mb-8 text-lg leading-relaxed",children:t("tutorial.success.message")}),n.jsx("button",{onClick:Yy,className:"w-full py-4 text-xl font-bold text-white bg-gradient-to-r from-cyan-600 to-blue-600 rounded-xl hover:from-cyan-500 hover:to-blue-500 transition-all transform hover:scale-105 shadow-lg shadow-cyan-900/50",children:t("tutorial.success.button")})]})})]})},g0="helpPanelPosition",On=({title:e,url:t,icon:o,colorClass:r,description:a,hoverClass:i})=>{const{t:s}=St(),[l,c]=v.useState(!1),d=p=>{p.stopPropagation(),navigator.clipboard.writeText(t),c(!0),setTimeout(()=>c(!1),2e3)},u=()=>{window.open(t,"_blank","noopener,noreferrer")};return n.jsxs("div",{onClick:u,className:"group relative flex items-center justify-between bg-gray-900/40 p-3 rounded-xl border border-gray-700/50 hover:border-gray-600 transition-all duration-200 hover:bg-gray-800/60 cursor-pointer",children:[n.jsxs("div",{className:"flex items-center gap-4 overflow-hidden",children:[n.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center bg-gray-800 border border-gray-700 shadow-sm shrink-0 ${r}`,children:o}),n.jsxs("div",{className:"flex flex-col min-w-0",children:[n.jsx("span",{className:`font-bold text-gray-200 text-sm truncate transition-colors ${i||"group-hover:text-cyan-400"}`,children:e}),a&&n.jsx("span",{className:"text-[10px] text-gray-500 uppercase font-bold tracking-wider",children:a}),n.jsx("span",{className:"text-[10px] text-gray-600 truncate font-mono mt-0.5 group-hover:text-gray-500 transition-colors",children:t})]})]}),n.jsxs("div",{className:"flex items-center gap-2 pl-2",children:[n.jsx(ut,{content:s(l?"help.copied":"help.copyLink"),position:"top",children:n.jsx("button",{onClick:d,className:"p-2 rounded-lg bg-gray-800 text-gray-400 hover:text-white hover:bg-gray-700 border border-transparent hover:border-gray-600 transition-all focus:outline-none",children:l?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):n.jsx(Dt,{className:"h-4 w-4"})})}),n.jsx("div",{className:`p-2 text-gray-600 transition-colors ${i?i.replace("text-","text-opacity-80 text-"):"group-hover:text-cyan-500"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})})]})]})},ea=({title:e,colorClass:t})=>n.jsxs("div",{className:"flex items-center gap-2 mb-3 mt-4 first:mt-0",children:[n.jsx("div",{className:"h-px bg-gray-700 flex-grow"}),n.jsx("span",{className:`text-xs font-bold uppercase tracking-widest ${t||"text-gray-500"}`,children:e}),n.jsx("div",{className:"h-px bg-gray-700 flex-grow"})]}),Ns=n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{d:"M12.48 10.92v3.28h7.84c-.24 1.84-.853 3.187-1.787 4.133-1.147 1.147-2.933 2.4-6.053 2.4-4.827 0-8.6-3.893-8.6-8.72s3.773-8.72 8.6-8.72c2.6 0 4.507 1.027 5.907 2.347l2.307-2.307C18.747 1.44 16.133 0 12.48 0 5.867 0 .307 5.387.307 12s5.56 12 12.173 12c3.573 0 6.267-1.173 8.373-3.36 2.16-2.16 2.84-5.213 2.84-7.667 0-.76-.053-1.467-.173-2.053H12.48z"})}),CT=()=>{const{t:e}=St(),[t,o]=v.useState(!1),[r,a]=v.useState(!1),[i,s]=v.useState("hotkeys"),[l,c]=v.useState(!1),d=v.useRef(null),u=v.useRef(null),[p,h]=v.useState({x:0,y:0}),w=v.useRef({x:0,y:0}),k=v.useRef(!1),b=v.useRef(p);v.useEffect(()=>{b.current=p},[p]),v.useEffect(()=>{if(t){a(!0);const S=localStorage.getItem(g0);if(S)try{const P=JSON.parse(S);if(typeof P.x=="number"&&typeof P.y=="number")h(P);else throw new Error("Invalid pos")}catch{h({x:Math.max(0,window.innerWidth/2-300),y:Math.max(0,window.innerHeight/2-360)})}else if(u.current){const P=u.current.getBoundingClientRect(),j=window.innerWidth,M=window.innerHeight,D=600,O=720;let B=P.left;B+D>j&&(B=j-D-20),B=Math.max(20,B);let E=P.bottom+10;E+O>M&&(E=Math.max(20,M-O-20)),h({x:B,y:E})}else h({x:Math.max(0,window.innerWidth/2-300),y:Math.max(0,window.innerHeight/2-360)})}else{const S=setTimeout(()=>a(!1),200);return()=>clearTimeout(S)}},[t]),v.useEffect(()=>{if(!t)return;const S=P=>{d.current&&d.current.contains(P.target)||u.current&&u.current.contains(P.target)||o(!1)};return document.addEventListener("mousedown",S),()=>{document.removeEventListener("mousedown",S)}},[t]),v.useEffect(()=>{const S=P=>{P.key==="F1"&&(P.preventDefault(),o(j=>!j))};return window.addEventListener("keydown",S),()=>window.removeEventListener("keydown",S)},[]);const y=S=>{S.target.closest("button")||(S.preventDefault(),S.stopPropagation(),k.current=!0,w.current={x:S.clientX-p.x,y:S.clientY-p.y},S.currentTarget.setPointerCapture(S.pointerId))},g=S=>{k.current&&(S.preventDefault(),S.stopPropagation(),h({x:S.clientX-w.current.x,y:S.clientY-w.current.y}))},m=S=>{k.current&&(k.current=!1,S.currentTarget.releasePointerCapture(S.pointerId),localStorage.setItem(g0,JSON.stringify(b.current)))},x={tools:[{key:"V",description:e("hotkeys.tools.edit")},{key:"C",description:e("hotkeys.tools.cutter")},{key:"S",description:e("hotkeys.tools.selection")},{key:"R",description:e("hotkeys.tools.reroute")},{key:"Z",description:e("hotkeys.tools.zoom")},{key:"Shift + W",description:e("toolbar.snapToGrid")},{key:"Shift + E",description:e("hotkeys.tools.toggleLineStyle")},{key:"G",description:`${e("hotkeys.tools.group")} / ${e("node.title.gemini_chat")}`},{key:"X",description:e("hotkeys.tools.closeNode")},{key:"D",description:e("hotkeys.tools.duplicate")},{key:"Ctrl + D",description:e("hotkeys.tools.duplicateWithContent")},{key:"Shift+Click",description:e("hotkeys.tools.deleteGroup")}],windows:[{key:"Space",description:e("hotkeys.windows.search")},{key:"Ctrl+Space",description:e("hotkeys.windows.catalog")},{key:"F1",description:e("help.panelTitle")}],alignment:[{key:"F",description:e("contextMenu.align.left")},{key:"E",description:e("contextMenu.align.centerX")},{key:"R",description:e("contextMenu.align.right")},{key:"T",description:e("contextMenu.align.top")},{key:"D",description:e("contextMenu.align.centerY")},{key:"B",description:e("contextMenu.align.bottom")},{key:"Ctrl + D",description:e("contextMenu.distribute.horizontal")},{key:"Ctrl + E",description:e("contextMenu.distribute.vertical")}],createNode:[{key:"T",description:e("node.title.text_input")},{key:"I",description:e("node.title.image_input")},{key:"P",description:e("node.title.prompt_processor")},{key:"O",description:e("node.title.image_output")},{key:"A",description:e("node.title.prompt_analyzer")},{key:"M",description:e("node.title.media_viewer")},{key:"L",description:e("node.title.translator")},{key:"N",description:e("node.title.note")},{key:"Q",description:e("node.title.prompt_sequence_editor")},{key:"E",description:e("node.title.video_editor")},{key:"Shift+P",description:e("node.title.video_prompt_processor")},{key:"Shift+O",description:e("node.title.video_output")},{key:"Shift+I",description:e("node.title.image_editor")},{key:"Shift+A",description:e("node.title.image_analyzer")},{key:"Shift+C",description:e("node.title.character_generator")},{key:"Shift+R",description:e("node.title.data_reader")},{key:"Shift+V",description:e("node.title.script_viewer")},{key:"Shift+Q",description:e("node.title.image_sequence_generator")},{key:"Ctrl+Shift+C",description:e("node.title.character_card")},{key:"Ctrl+Shift+A",description:e("node.title.character_analyzer")}]},_=(S,P)=>n.jsxs("div",{children:[n.jsx("h4",{className:"font-bold text-gray-300 mb-2 border-b border-gray-600 pb-1",children:S}),n.jsx("ul",{className:"space-y-1.5",children:P.map(({key:j,description:M})=>n.jsxs("li",{className:"flex justify-between items-center",children:[n.jsx("span",{children:M}),n.jsx("kbd",{className:"font-mono bg-gray-700 px-2 py-1 rounded-md text-gray-300 text-xs",children:j})]},j))})]});return n.jsxs("div",{ref:u,className:"relative select-none",children:[n.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[n.jsx("button",{onClick:()=>o(!t),className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":e("hotkeys.show"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsxs("div",{className:`absolute top-full left-1/2 -translate-x-1/2 mt-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 ease-in-out origin-top ${l?"opacity-100":"opacity-0 pointer-events-none"}`,role:"tooltip",children:[e("hotkeys.show")," (F1)"]})]}),r&&n.jsxs("div",{ref:d,className:`fixed bg-gray-800 rounded-lg shadow-2xl w-[600px] h-[720px] z-[100] flex flex-col overflow-hidden border border-gray-700 transition-opacity duration-200 ease-in-out ${t?"opacity-100":"opacity-0 pointer-events-none"}`,style:{left:p.x,top:p.y},onMouseDown:S=>S.stopPropagation(),children:[n.jsxs("div",{className:"bg-[#18202f] border-b border-gray-600 cursor-move",onPointerDown:y,onPointerMove:g,onPointerUp:m,children:[n.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[n.jsxs("h2",{className:"text-xl font-bold text-accent-text flex items-center gap-2 pointer-events-none",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e("app.title")," ",n.jsx("span",{className:"text-xs text-accent-text/70 font-normal ml-2",children:e("help.subtitle")})]}),n.jsx("button",{onClick:()=>o(!1),className:"text-gray-400 hover:text-white transition-colors p-1 hover:bg-white/10 rounded-full",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),n.jsxs("div",{className:"flex px-6 gap-6",children:[n.jsxs("button",{onClick:()=>s("hotkeys"),className:`pb-3 text-sm font-semibold transition-colors relative ${i==="hotkeys"?"text-accent-text":"text-gray-400 hover:text-gray-200"}`,children:[e("help.panelTitle"),i==="hotkeys"&&n.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-accent rounded-t-full"})]}),n.jsxs("button",{onClick:()=>s("links"),className:`pb-3 text-sm font-semibold transition-colors relative ${i==="links"?"text-accent-text":"text-gray-400 hover:text-gray-200"}`,children:[e("help.tab.links"),i==="links"&&n.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-accent rounded-t-full"})]})]})]}),n.jsx("div",{className:"p-6 overflow-y-auto custom-scrollbar flex-grow bg-gray-800",children:i==="hotkeys"?n.jsxs("div",{className:"flex flex-col space-y-6 text-sm text-gray-400",children:[n.jsx("div",{children:_(e("hotkeys.tools.title"),x.tools)}),n.jsx("div",{children:_(e("hotkeys.windows.title"),x.windows)}),n.jsx("div",{children:_("Alignment (2+ Selected)",x.alignment)}),n.jsx("div",{children:_(e("hotkeys.createNode.title"),x.createNode)})]}):n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsx(ea,{title:e("help.section.socials"),colorClass:"text-red-400"}),n.jsx(On,{title:"MurcelloNovaes",description:"YouTube Channel",url:"https://www.youtube.com/@MurcelloNovaes",colorClass:"text-red-500",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{d:"M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"})})}),n.jsx(On,{title:"MeowMasterArt",description:"Linktree",url:"https://linktr.ee/meowmasterart",colorClass:"text-green-500",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-6 h-6",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 10v12m0-12c-2 0-3-1-3-3 0-1 0-2 1-3m2 6c2 0 3-1 3-3 0-1 0-2-1-3M7 7c0 2 1 3 2 5m8-5c0 2-1 3-2 5M9 2h6"})})}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(On,{title:"Telegram Channel",url:"https://t.me/+h0YEu0nx9QdhMDNi",colorClass:"text-sky-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"})})}),n.jsx(On,{title:"Telegram Group",url:"https://t.me/+tyQLGFxiEbRhMDdi",colorClass:"text-sky-500",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-6 h-6",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})})]}),n.jsx(ea,{title:e("help.section.githubPages"),colorClass:"text-purple-400"}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(On,{title:"Script Modifier",description:"GitHub Pages",url:"https://neytrino2134.github.io/Script-Modifier/",colorClass:"text-green-500",hoverClass:"group-hover:text-green-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-6 h-6",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"})})}),n.jsx(On,{title:"Prompt Modifier",description:"GitHub Pages",url:"https://neytrino2134.github.io/Prompt-Modifier/",colorClass:"text-cyan-500",hoverClass:"group-hover:text-cyan-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-6 h-6",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"})})})]}),n.jsx(ea,{title:e("help.section.netlify"),colorClass:"text-cyan-400"}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(On,{title:"Script Modifier",url:"https://scriptmodifier2.netlify.app/",colorClass:"text-green-500",hoverClass:"group-hover:text-green-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{d:"M12 2L2 19.777h20L12 2zm0 3.7l6.6 11.677H5.4L12 5.7z"})})}),n.jsx(On,{title:"Prompt Modifier",url:"https://promptmodifier2.netlify.app/",colorClass:"text-cyan-500",hoverClass:"group-hover:text-cyan-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{d:"M12 2L2 19.777h20L12 2zm0 3.7l6.6 11.677H5.4L12 5.7z"})})})]}),n.jsx(ea,{title:e("help.section.studioStable"),colorClass:"text-blue-500"}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(On,{title:"Script Modifier 0.1.3",description:"Stable Version",url:"https://ai.studio/apps/drive/1enTmQ5Wz9RBArkZMZm5s5nYQcKxQ9L8M?fullscreenApplet=true",colorClass:"text-green-500",hoverClass:"group-hover:text-green-400",icon:Ns}),n.jsx(On,{title:"Prompt Modifier 0.1.7",description:"Stable Version",url:"https://ai.studio/apps/drive/1YCO0DaA4BTm9p0j5XqvpBhX_XTg9ClwC?fullscreenApplet=true",colorClass:"text-cyan-500",hoverClass:"group-hover:text-cyan-400",icon:Ns})]}),n.jsx(ea,{title:e("help.section.studioAlpha"),colorClass:"text-blue-500"}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(On,{title:"Script Modifier 0.1.4 Alpha",description:"Latest Alpha",url:"https://aistudio.google.com/apps/drive/1y9CSUmlVQK2xq7ckses7fpM6wpbZdBnB?showAssistant=true&resourceKey=&showPreview=true",colorClass:"text-green-500",hoverClass:"group-hover:text-green-400",icon:Ns}),n.jsx(On,{title:"Prompt Modifier 0.1.8 Alpha",description:"Latest Alpha",url:"https://aistudio.google.com/apps/drive/1OJfPP9wUKlnjvZ5_2_Fxq_v1dW0iftlW?showAssistant=true&resourceKey=&showPreview=true",colorClass:"text-cyan-500",hoverClass:"group-hover:text-cyan-400",icon:Ns})]}),n.jsx(ea,{title:e("help.section.github"),colorClass:"text-yellow-400"}),n.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[n.jsx(On,{title:"Script Modifier",url:"https://github.com/Neytrino2134/Script-Modifier",colorClass:"text-green-500",hoverClass:"group-hover:text-green-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"})})}),n.jsx(On,{title:"Prompt Modifier",url:"https://github.com/Neytrino2134/Prompt-Modifier",colorClass:"text-cyan-500",hoverClass:"group-hover:text-cyan-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"})})})]}),n.jsx("div",{className:"h-4"})]})}),n.jsxs("div",{className:"p-4 bg-gray-900 border-t border-gray-700 text-xs flex-shrink-0",children:[n.jsxs("div",{className:"flex justify-between items-baseline",children:[n.jsx("span",{className:"font-bold text-gray-600 text-sm",children:e("app.title")}),n.jsx("span",{className:"text-gray-600",children:e("help.license")})]}),n.jsx("div",{className:"w-full h-px bg-gray-700 my-3"}),n.jsxs("div",{className:"flex justify-between items-end",children:[n.jsxs("div",{className:"grid grid-cols-[auto_1fr] gap-x-2 gap-y-1 text-sm",children:[n.jsxs("span",{className:"text-gray-500",children:[e("help.author"),":"]}),n.jsx("span",{className:"text-gray-400 font-medium",children:"MeowMaster"}),n.jsx("span",{className:"text-gray-500",children:"Email:"}),n.jsx("a",{href:"mailto:MeowMasterArt@gmail.com",className:"text-gray-400 hover:text-accent-text transition-colors",children:"MeowMasterArt@gmail.com"}),n.jsx("span",{className:"text-gray-500",children:"GitHub:"}),n.jsx("a",{href:"https://github.com/Neytrino2134/Prompt-Modifier",target:"_blank",rel:"noopener noreferrer",className:"text-gray-400 hover:text-accent-text transition-colors underline",children:"Neytrino2134/Prompt-Modifier"})]}),n.jsx("a",{href:"https://www.netlify.com",target:"_blank",rel:"noopener noreferrer",className:"opacity-80 hover:opacity-100 transition-opacity",children:n.jsx("img",{src:"https://www.netlify.com/assets/badges/netlify-badge-color-accent.svg",alt:"Deploys by Netlify",className:"h-10"})})]})]})]})]})},kT=()=>{const{language:e,setLanguage:t,secondaryLanguage:o,setSecondaryLanguage:r}=St(),[a,i]=v.useState(!1),s=v.useRef(null),l=fn[o],c=fn.en;v.useEffect(()=>{const u=p=>{s.current&&!s.current.contains(p.target)&&i(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]);const d=u=>{r(u),t(u),i(!1)};return n.jsxs("div",{className:"flex items-center h-9 space-x-1 select-none relative",ref:s,children:[n.jsx(ut,{content:c.name,position:"bottom",className:"h-full",children:n.jsx("button",{onClick:()=>t("en"),className:`px-3 py-1 rounded-md text-xs font-bold transition-colors h-full flex items-center justify-center focus:outline-none min-w-[36px] ${e==="en"?"bg-accent text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-white"}`,children:c.short})}),n.jsxs("div",{className:"relative flex items-center h-full",children:[n.jsx(ut,{content:l.name,position:"bottom",className:"h-full",children:n.jsx("button",{onClick:()=>t(o),className:`px-3 py-1 rounded-l-md text-xs font-bold transition-colors h-full flex items-center justify-center focus:outline-none min-w-[36px] ${e===o?"bg-accent text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-white"}`,children:l.short})}),n.jsx("button",{onClick:u=>{u.stopPropagation(),i(!a)},className:`h-full px-1 rounded-r-md flex items-center justify-center transition-colors focus:outline-none border-l border-gray-600/50 ${e===o?"bg-accent text-white hover:bg-accent-hover":"bg-gray-700 text-gray-400 hover:bg-gray-600 hover:text-white"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 transition-transform duration-200 ${a?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),a&&n.jsx("div",{className:"absolute top-full right-0 mt-1 bg-gray-800 border border-gray-600 rounded-md shadow-xl z-50 py-1 min-w-[140px] max-h-60 overflow-y-auto custom-scrollbar animate-fade-in-drop origin-top-right",children:Object.entries(fn).filter(([u])=>u!=="en").map(([u,p])=>n.jsxs("button",{onClick:()=>d(u),className:`w-full text-left px-3 py-2 text-xs flex items-center justify-between hover:bg-gray-700 transition-colors ${o===u?"bg-gray-700/50":""}`,children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:`font-medium ${o===u?"text-accent-text":"text-gray-200"}`,children:p.nativeName}),n.jsx("span",{className:"text-[10px] text-gray-500",children:p.name})]}),n.jsx("span",{className:"text-[10px] text-gray-500 font-mono ml-2 border border-gray-600 rounded px-1",children:p.short})]},u))})]})]})},_T=({tab:e,isActive:t,onSwitchTab:o,onStartEditing:r,onCloseTab:a,t:i})=>{const s=v.useRef(null),l=v.useRef(null),[c,d]=v.useState(0),u=()=>{if(s.current&&l.current){const p=l.current.clientWidth-s.current.offsetWidth;d(p<0?p:0)}};return v.useLayoutEffect(()=>{u()},[e.name]),n.jsxs("div",{onClick:()=>o(e.id),onDoubleClick:()=>r(e),onDragOver:p=>{p.preventDefault(),t||o(e.id)},onMouseEnter:u,className:`flex items-center justify-between px-4 h-full rounded-md cursor-pointer transition-colors duration-150 group flex-shrink-0 ${t?"bg-accent text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"} max-w-[200px] overflow-hidden select-none`,children:[n.jsx(ut,{content:e.name,position:"bottom",delay:800,className:"flex-grow min-w-0",children:n.jsx("div",{ref:l,className:"flex-grow min-w-0 overflow-hidden relative mask-fade",children:n.jsx("div",{className:`inline-block whitespace-nowrap ${c<0?"group-hover:animate-swing":""}`,style:{"--scroll-dist":`${c}px`},children:n.jsx("span",{ref:s,className:"text-sm pr-1 block",children:e.name})})})}),n.jsx(ut,{content:i("node.action.close"),position:"bottom",children:n.jsx("button",{onClick:p=>{p.stopPropagation(),a(e.id,p)},className:`ml-3 p-0.5 rounded-full transition-opacity focus:outline-none opacity-50 group-hover:opacity-100 ${t?"text-white hover:bg-accent-hover":"text-gray-500 hover:bg-gray-600 hover:text-white"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})})]})},ST=({tabs:e,activeTabId:t,onSwitchTab:o,onAddTab:r,onCloseTab:a,onRenameTab:i})=>{const{t:s}=St(),[l,c]=v.useState(null),[d,u]=v.useState(""),p=v.useRef(null),h=v.useRef(null);v.useEffect(()=>{l&&p.current&&(p.current.focus(),p.current.select())},[l]);const w=g=>{c(g.id),u(g.name)},k=()=>{l&&d.trim()&&i(l,d.trim()),c(null)},b=g=>{g.key==="Enter"?k():g.key==="Escape"&&c(null)},y=g=>{h.current&&(h.current.scrollLeft+=g.deltaY)};return n.jsx("div",{onMouseDown:g=>g.stopPropagation(),className:"flex-shrink-0 pointer-events-auto max-w-[calc(100vw-350px)]",children:n.jsxs("div",{ref:h,onWheel:y,className:"flex items-center h-9 space-x-1 overflow-x-auto overflow-y-hidden hide-scrollbar [&::-webkit-scrollbar]:hidden",children:[e.map(g=>l===g.id?n.jsx("div",{className:"flex items-center justify-between px-4 h-full rounded-md bg-gray-700 max-w-[200px]",children:n.jsx("input",{ref:p,type:"text",value:d,onChange:m=>u(m.target.value),onBlur:k,onKeyDown:b,className:"bg-transparent border-b border-accent-text focus:outline-none text-sm w-full text-white",onClick:m=>m.stopPropagation()})},g.id):n.jsx(_T,{tab:g,isActive:g.id===t,onSwitchTab:o,onStartEditing:w,onCloseTab:a,t:s},g.id)),n.jsx(ut,{content:"New Canvas",position:"bottom",className:"h-full",children:n.jsx("button",{onClick:r,className:"flex-shrink-0 flex items-center justify-center w-8 h-full rounded-md bg-gray-700 text-gray-300 hover:bg-accent hover:text-white transition-colors focus:outline-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})})]})})},f0=({language:e,globalLanguage:t,apiKey:o,setApiKey:r,onSelectLanguage:a,onStart:i,onDeveloperStart:s,onStartNew:l,measureRef:c,onCycleLanguage:d,exitPhase:u,isResumable:p,animationStage:h,triggerHeartbeat:w})=>{const k=v.useCallback((j,M)=>qo(e,j,M),[e]),[b,y]=v.useState(!1),g=v.useRef(null),m=v.useRef(null);v.useEffect(()=>{if(h>=4){const j=setTimeout(()=>{m.current&&m.current.focus()},300);return()=>clearTimeout(j)}},[h]),v.useEffect(()=>{const j=M=>{g.current&&!g.current.contains(M.target)&&y(!1)};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[]);const x=fn[t],_=()=>u==="window-exit"?"-translate-y-[150vh] scale-75 opacity-0":u==="button-exit"?"scale-95":h>=4?"opacity-100 translate-y-0 scale-100 blur-0":"opacity-0 translate-y-12 scale-95 blur-sm pointer-events-none",S=h<=1?"ease-[cubic-bezier(0.34,1.56,0.64,1)]":"ease-in-out",P=(h<=1,"duration-1000");return n.jsxs("div",{ref:c,className:"w-full flex flex-col items-center text-center select-none",children:[n.jsxs("div",{className:`
                w-full flex items-center justify-between md:justify-center gap-2 md:gap-12 mb-6 px-1 md:px-4 
                transition-all ${P} ${S}
                ${h>=1?"opacity-100":"opacity-0"}
                ${h<=2?"translate-y-[35vh] scale-125":"translate-y-0 scale-100"}
                ${u!=="idle"?"opacity-0 scale-90 blur-sm":""}
            `,children:[n.jsx("button",{onClick:()=>d(-1),className:`w-10 h-10 md:w-16 md:h-16 flex-shrink-0 rounded-full border border-cyan-500/30 bg-gray-900/40 backdrop-blur-md text-cyan-400 hover:text-white hover:bg-cyan-500/20 hover:border-cyan-400 transition-all duration-700 shadow-[0_0_15px_rgba(6,182,212,0.1)] hover:shadow-[0_0_25px_rgba(6,182,212,0.4)] flex items-center justify-center group z-30 
                        ${h>=5?"opacity-100 scale-100":"opacity-0 scale-50 pointer-events-none"}
                    `,"aria-label":"Previous Language",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 md:h-8 md:w-8 transform transition-transform group-hover:-translate-x-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),n.jsxs("div",{className:`flex flex-col items-center justify-center z-20 gap-3 md:gap-8 py-2 ${w?"animate-heartbeat":""}`,children:[n.jsx("h1",{className:"font-black tracking-tighter leading-none text-center animate-gradient-x bg-size-200 bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 via-sky-500 to-cyan-400 px-1 md:px-4 whitespace-nowrap",style:{fontSize:"clamp(2rem, 7vw, 120px)"},children:k("welcome.title")}),n.jsx("h1",{className:"font-black tracking-tighter leading-none text-center animate-gradient-x bg-size-200 bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 via-sky-500 to-cyan-400 px-1 md:px-4 whitespace-nowrap",style:{fontSize:"clamp(2rem, 7vw, 120px)"},children:k("app.title")})]}),n.jsx("button",{onClick:()=>d(1),className:`w-10 h-10 md:w-16 md:h-16 flex-shrink-0 rounded-full border border-cyan-500/30 bg-gray-900/40 backdrop-blur-md text-cyan-400 hover:text-white hover:bg-cyan-500/20 hover:border-cyan-400 transition-all duration-700 shadow-[0_0_15px_rgba(6,182,212,0.1)] hover:shadow-[0_0_25px_rgba(6,182,212,0.4)] flex items-center justify-center group z-30
                         ${h>=5?"opacity-100 scale-100":"opacity-0 scale-50 pointer-events-none"}
                    `,"aria-label":"Next Language",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 md:h-8 md:w-8 transform transition-transform group-hover:translate-x-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]}),n.jsx("div",{className:`mb-8 h-6 flex items-center justify-center transition-all duration-1000 ease-out delay-100 ${h>=5?"opacity-100 translate-y-0":"opacity-0 -translate-y-8"}`,children:n.jsx("p",{className:"text-gray-400 text-sm font-medium tracking-wide bg-gray-900/40 px-3 py-1 rounded-full border border-gray-700/50 backdrop-blur-sm",children:k("welcome.navHint")})}),n.jsxs("div",{className:`relative w-full max-w-[860px] mx-auto transition-all duration-1000 ease-out delay-100 ${_()}`,children:[n.jsx("div",{className:"welcome-ring"}),n.jsx("div",{className:"relative z-10 w-full bg-gray-800/80 backdrop-blur-xl rounded-3xl border border-gray-700 shadow-2xl overflow-visible",children:n.jsxs("div",{className:"p-8 md:p-10 space-y-8 text-left",children:[n.jsxs("div",{className:"space-y-4 w-full",children:[n.jsx("p",{className:"text-xl md:text-2xl text-gray-200 leading-relaxed font-light",children:k("welcome.description")}),n.jsx("div",{className:"h-px w-full bg-gradient-to-r from-transparent via-cyan-500/30 to-transparent"})]}),n.jsxs("div",{className:"space-y-2 relative z-50",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400 ml-1 uppercase tracking-wide",children:k("welcome.selectLanguage")||"Language"}),n.jsxs("div",{ref:g,className:"relative",children:[n.jsxs("button",{onClick:()=>y(!b),className:"w-full py-3 px-4 rounded-xl bg-gray-900/60 border border-gray-600 hover:border-cyan-500 hover:bg-gray-800/80 transition-all duration-200 text-left flex items-center justify-between group outline-none focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500/50",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center text-xs font-bold text-gray-300 border border-gray-600 group-hover:border-cyan-400/50 transition-colors",children:x.short}),n.jsxs("span",{className:"text-lg text-white font-medium",children:[x.nativeName," ",n.jsxs("span",{className:"text-gray-500 text-sm ml-1",children:["(",x.name,")"]})]})]}),n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 text-gray-400 transition-transform duration-300 ${b?"rotate-180 text-cyan-400":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),b&&n.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-gray-800/95 backdrop-blur-xl border border-gray-600 rounded-xl shadow-2xl max-h-60 overflow-y-auto custom-scrollbar p-1 animate-fade-in-drop origin-top z-[100]",children:Object.entries(fn).map(([j,M])=>n.jsxs("button",{onClick:()=>{a(j),y(!1)},className:`w-full text-left px-4 py-3 rounded-lg flex items-center justify-between transition-colors ${t===j?"bg-cyan-600/20 text-cyan-400":"text-gray-300 hover:bg-gray-700 hover:text-white"}`,children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("span",{className:"text-xs font-bold w-6 text-gray-500",children:M.short}),n.jsx("span",{className:"font-medium",children:M.nativeName})]}),t===j&&n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-cyan-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},j))})]})]}),n.jsx("div",{className:"space-y-4 text-left w-full pt-4 border-t border-gray-700/50",children:n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex justify-between items-center px-1 mb-1",children:[n.jsx("label",{htmlFor:"welcome-api-key",className:"block text-sm font-medium text-gray-400",children:k("welcome.apiKeyLabel")}),n.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-xs text-cyan-400 hover:text-cyan-300 underline",children:k("welcome.getKeyLink")})]}),n.jsx("div",{className:"relative",children:n.jsx("input",{ref:m,type:"password",id:"welcome-api-key",value:o,onChange:j=>r(j.target.value),placeholder:k("welcome.apiKeyPlaceholder"),className:"w-full p-4 bg-gray-900/60 border border-gray-500 rounded-xl text-white outline-none focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition-all duration-200 shadow-inner select-text"})}),n.jsx("div",{className:"flex items-center justify-center pt-2",children:n.jsxs("div",{className:"flex items-center space-x-1.5 text-gray-500 bg-gray-900/30 px-3 py-1 rounded-full border border-gray-700/30",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),n.jsx("span",{className:"text-[10px] md:text-xs font-medium",children:k("welcome.apiKeyHelp")})]})})]})}),n.jsxs("div",{className:"pt-2 flex flex-col gap-3",children:[n.jsx("button",{onClick:i,className:"w-full py-4 text-lg font-bold text-white bg-gradient-to-r from-cyan-600 via-blue-600 to-cyan-600 bg-size-200 animate-gradient-x shadow-cyan-900/30 rounded-xl shadow-lg transform hover:scale-105 active:scale-95 transition-all duration-200 flex items-center justify-center gap-3 group relative overflow-hidden",children:n.jsxs("div",{className:`flex items-center gap-3 transition-all duration-500 ease-[cubic-bezier(0.68,-0.55,0.27,1.55)] ${u!=="idle"?"translate-x-[200px] opacity-0":"translate-x-0 opacity-100"}`,children:[n.jsx("span",{children:k(p?"welcome.resume":"welcome.letsGo")}),n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 transform group-hover:translate-x-1 transition-transform",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 7l5 5m0 0l-5 5m5-5H6"})})]})}),p&&l&&n.jsx("div",{className:"mt-2 w-full",children:n.jsx("button",{onClick:l,className:"w-full py-3 border border-gray-600 hover:border-gray-400 text-gray-400 hover:text-white rounded-xl transition-all duration-200 text-sm font-semibold",children:k("welcome.startNew")})}),n.jsx("div",{children:n.jsx("button",{onClick:s,className:"w-full py-3 border border-gray-700 hover:border-cyan-500/50 text-gray-500 hover:text-cyan-400 rounded-xl transition-all duration-200 text-xs font-semibold tracking-wide bg-transparent hover:bg-gray-800/30",children:k("welcome.iAmDeveloper")})})]})]})})]}),n.jsxs("div",{className:`mt-10 flex flex-col md:flex-row gap-4 transition-all duration-1000 ease-out ${h>=5?"opacity-100 translate-y-0 scale-100":"opacity-0 translate-y-8 scale-95 pointer-events-none"}`,children:[n.jsxs("a",{href:"https://scriptmodifier2.netlify.app/",target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-3 px-6 py-3 rounded-full bg-gray-900/60 hover:bg-gray-800 border border-gray-700 hover:border-cyan-500/50 text-gray-400 hover:text-cyan-400 transition-all duration-300 backdrop-blur-sm shadow-lg hover:shadow-cyan-500/10",children:[n.jsx("span",{className:"font-semibold tracking-wide text-sm",children:"Go to Script Modifier on Netlify"}),n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:n.jsx("path",{d:"M12 2L2 19.777h20L12 2zm0 3.7l6.6 11.677H5.4L12 5.7z"})})]}),n.jsxs("a",{href:"https://github.com/Neytrino2134/Script-Modifier",target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-3 px-6 py-3 rounded-full bg-gray-900/60 hover:bg-gray-800 border border-gray-700 hover:border-purple-500/50 text-gray-400 hover:text-purple-400 transition-all duration-300 backdrop-blur-sm shadow-lg hover:shadow-purple-500/10",children:[n.jsx("span",{className:"font-semibold tracking-wide text-sm",children:"Go to Script Modifier on GitHub"}),n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:n.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"})})]})]})]})},NT=({onClose:e,isResumable:t=!1})=>{const o=Ut(),{language:r,setSecondaryLanguage:a,setLanguage:i,t:s}=St(),[l,c]=v.useState(""),[d,u]=v.useState(!1),[p,h]=v.useState("idle"),[w,k]=v.useState(0),[b,y]=v.useState(!1),[g,m]=v.useState(r),[x,_]=v.useState(null),[S,P]=v.useState(0),[j,M]=v.useState(void 0),D=v.useRef(null),O=v.useRef(null);v.useEffect(()=>{x||m(r)},[r,x]),v.useEffect(()=>{if(!D.current)return;const G=()=>{D.current&&M(D.current.offsetHeight)},U=new ResizeObserver(G);return U.observe(D.current),G(),()=>U.disconnect()},[g,w]),v.useEffect(()=>{const G=localStorage.getItem("settings_userApiKey");G&&c(G),requestAnimationFrame(()=>u(!0)),setTimeout(()=>k(1),100),setTimeout(()=>y(!0),1600),setTimeout(()=>{y(!1),k(3)},3600),setTimeout(()=>k(4),4400),setTimeout(()=>k(5),5e3)},[]);const B=()=>{window.location.reload()},E=G=>{G!==r&&(O.current&&clearTimeout(O.current),_(g),P(1),m(G),G==="en"?i("en"):(a(G),i(G)),requestAnimationFrame(()=>{requestAnimationFrame(()=>{P(0)})}),O.current=setTimeout(()=>{_(null)},200))},I=v.useCallback(G=>{const U=Object.keys(fn);let q=U.indexOf(g)+G;q<0&&(q=U.length-1),q>=U.length&&(q=0),E(U[q])},[g,r]);v.useEffect(()=>{const G=U=>{U.key==="ArrowLeft"?I(-1):U.key==="ArrowRight"&&I(1)};return window.addEventListener("keydown",G),()=>window.removeEventListener("keydown",G)},[I]);const N=(G,U=!1,R)=>{localStorage.setItem("hasVisited","true"),h("button-exit"),G&&o&&(o.resetCanvasToDefault&&o.resetCanvasToDefault(R||g),U?localStorage.setItem("tutorial_completed","true"):(localStorage.removeItem("tutorial_completed"),setTimeout(()=>{o.startTutorial&&o.startTutorial()},500))),setTimeout(()=>{},200),setTimeout(()=>{h("window-exit")},400),setTimeout(()=>{e()},1e3)},T=()=>{localStorage.setItem("settings_useDevKey","false"),l.trim()&&localStorage.setItem("settings_userApiKey",l.trim()),N(!t,!1)},F=()=>{localStorage.setItem("settings_useDevKey","false"),l.trim()&&localStorage.setItem("settings_userApiKey",l.trim()),N(!0,!1)},z=()=>{localStorage.setItem("settings_useDevKey","true"),o&&o.setIsInstantCloseEnabled(!0),a("ru"),i("ru"),m("ru"),N(!0,!0,"ru")};return n.jsxs("div",{className:`fixed inset-0 bg-[#111827] z-[200] flex flex-col items-center justify-center overflow-hidden text-white px-4 custom-scrollbar transition-all duration-700 select-none ${p==="window-exit"?"opacity-0":"opacity-100"}`,onMouseDown:G=>{G.target instanceof HTMLInputElement||G.target instanceof HTMLTextAreaElement||G.preventDefault()},children:[n.jsx("style",{children:`
            .bg-size-200 { background-size: 200% auto; }
            @keyframes gradient-x {
                0% { background-position: 0% 50%; }
                100% { background-position: -200% 50%; }
            }
            .animate-gradient-x {
                animation: gradient-x 3s linear infinite;
            }
            @keyframes heartbeat {
                0% { transform: scale(1); }
                25% { transform: scale(0.95); }
                50% { transform: scale(1.05); }
                75% { transform: scale(0.95); }
                100% { transform: scale(1); }
            }
            .animate-heartbeat {
                animation: heartbeat 1.5s ease-in-out; 
            }
        `}),n.jsxs("div",{className:`absolute top-4 right-4 z-50 flex items-center gap-4 transition-opacity duration-700 ${w>=3?"opacity-100":"opacity-0"}`,children:[n.jsx("button",{onClick:B,className:"transition-all duration-300 hover:opacity-100 opacity-60 hover:scale-110 p-1",title:s("dialog.settings.reload"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,className:"text-white",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),n.jsx("a",{href:"https://github.com/Neytrino2134/Prompt-Modifier",target:"_blank",rel:"noopener noreferrer",className:"transition-all duration-300 hover:opacity-100 opacity-60 hover:scale-110",title:"View Source on GitHub",children:n.jsx("svg",{width:"32",height:"32",viewBox:"0 0 98 96",xmlns:"http://www.w3.org/2000/svg",className:"fill-white",children:n.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z"})})}),n.jsx("div",{className:"transition-opacity hover:opacity-100 opacity-80",children:n.jsx("a",{href:"https://www.netlify.com",target:"_blank",rel:"noopener noreferrer",children:n.jsx("img",{src:"https://www.netlify.com/assets/badges/netlify-badge-color-accent.svg",alt:"Deploys by Netlify"})})})]}),n.jsx("div",{className:`absolute -bottom-20 -right-20 pointer-events-none fixed transition-all duration-1000 ${w>=5?"opacity-5 translate-x-0":"opacity-0 translate-x-20"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-[600px] h-[600px] text-white transform rotate-[-15deg]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"0.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),n.jsx("div",{className:`relative z-10 w-full flex flex-col items-center text-center transition-all duration-700 ease-out transform ${d?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:n.jsxs("div",{className:"relative w-full transition-[height] duration-200 ease-in-out",style:{height:j?`${j}px`:"auto"},children:[n.jsx("div",{className:"relative w-full z-10",children:n.jsx(f0,{language:g,globalLanguage:r,apiKey:l,setApiKey:c,onSelectLanguage:E,onStart:T,onDeveloperStart:z,onStartNew:F,measureRef:D,onCycleLanguage:I,exitPhase:p,isResumable:t,animationStage:w,triggerHeartbeat:b})}),x&&n.jsx("div",{className:"absolute top-0 left-0 w-full z-20 pointer-events-none transition-opacity duration-200 ease-linear",style:{opacity:S},children:n.jsx(f0,{language:x,globalLanguage:r,apiKey:l,setApiKey:c,onSelectLanguage:E,onStart:T,onDeveloperStart:z,onCycleLanguage:I,exitPhase:"idle",isResumable:t,animationStage:5,triggerHeartbeat:!1})})]})})]})},ET="v0.1.9 Alpha.3",Lo=({title:e,children:t,align:o="center"})=>{const[r,a]=v.useState(!1);let i="left-1/2 -translate-x-1/2 top-full mt-2 origin-top";return o==="left"&&(i="left-0 top-full mt-2 origin-top-left"),o==="right"&&(i="right-0 top-full mt-2 origin-top-right"),n.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[t,n.jsx("div",{className:`absolute px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-lg shadow-xl z-50 transition-all duration-200 ease-out transform ${i} ${r?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,role:"tooltip",children:e})]})},PT=()=>{const e=Ut(),[t,o]=v.useState(!1),[r,a]=v.useState(!1),[i,s]=v.useState(!1);v.useEffect(()=>{const T=()=>{a(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",T),()=>document.removeEventListener("fullscreenchange",T)},[]),v.useEffect(()=>{if(!i)return;const T=()=>s(!1);return document.addEventListener("click",T),()=>document.removeEventListener("click",T)},[i]);const l=()=>{document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen().catch(T=>{console.error(`Error attempting to enable full-screen mode: ${T.message} (${T.name})`)})};if(!e)return null;const{t:c,clearUnusedFullSizeImages:d,handleResetCanvas:u,tabs:p,activeTabId:h,handleSwitchTab:w,handleAddTab:k,handleCloseTab:b,handleRenameTab:y,showWelcome:g,setShowWelcome:m,nodes:x,loadCanvasState:_,setConfirmInfo:S,currentTheme:P,setTheme:j,resetTabs:M}=e,D=T=>{const F=T.currentTarget.getBoundingClientRect();window.dispatchEvent(new CustomEvent("open-settings",{detail:{x:F.left,y:F.bottom}}))},O=()=>{m(!0)},B=()=>{S({title:c("dialog.exitApp.title"),message:c("dialog.exitApp.message"),onConfirm:()=>{_({nodes:[],connections:[],groups:[],viewTransform:{scale:1,translate:{x:0,y:0}},nodeIdCounter:1,fullSizeImageCache:{}}),m(!0)}})},E=()=>{S({title:c("dialog.reload.title"),message:c("dialog.reload.message"),onConfirm:()=>{_({nodes:[],connections:[],groups:[],viewTransform:{scale:1,translate:{x:0,y:0}},nodeIdCounter:1,fullSizeImageCache:{}}),M&&M("en"),setTimeout(()=>{window.location.reload()},100)}})},I=x&&x.length>0&&localStorage.getItem("hasVisited")==="true",N=[{id:"cyan",color:"#06b6d4",label:"Cyan"},{id:"azure",color:"#0ea5e9",label:"Azure"},{id:"purple",color:"#9333ea",label:"Purple"},{id:"pink",color:"#ec4899",label:"Pink"},{id:"red",color:"#dc2626",label:"Red"},{id:"orange",color:"#f97316",label:"Orange"},{id:"lime",color:"#84cc16",label:"Lime"},{id:"emerald",color:"#10b981",label:"Emerald"},{id:"gray",color:"#71717a",label:"Gray"}];return n.jsxs(n.Fragment,{children:[g&&n.jsx(NT,{onClose:()=>m(!1),isResumable:I}),n.jsx("header",{className:"absolute top-0 left-0 w-full flex justify-start p-2 z-30 pointer-events-none",children:n.jsxs("div",{className:"bg-gray-900 rounded-lg shadow-lg p-1 flex items-center gap-1 pointer-events-auto border border-gray-700",onMouseDown:T=>T.stopPropagation(),children:[n.jsx(Lo,{title:c(t?"toolbar.expandPanel":"toolbar.collapsePanel"),align:"left",children:n.jsx("button",{onClick:()=>o(T=>!T),className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":c(t?"toolbar.expandPanel":"toolbar.collapsePanel"),children:t?n.jsx(L3,{}):n.jsx(D3,{})})}),!t&&n.jsxs(n.Fragment,{children:[n.jsx(Lo,{title:c("toolbar.home"),children:n.jsx("button",{onClick:O,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":c("toolbar.home"),children:n.jsx(z3,{})})}),n.jsx(CT,{}),n.jsx(Lo,{title:c("toolbar.clearCache"),children:n.jsx("button",{onClick:d,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":c("toolbar.clearCache"),children:n.jsx(q3,{})})}),n.jsx(Lo,{title:c("toolbar.settings"),children:n.jsx("button",{onClick:D,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":c("toolbar.settings"),children:n.jsx($1,{})})}),n.jsx(Lo,{title:c(r?"toolbar.exitFullScreen":"toolbar.enterFullScreen"),children:n.jsx("button",{onClick:l,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":c(r?"toolbar.exitFullScreen":"toolbar.enterFullScreen"),children:r?n.jsx(qp,{}):n.jsx(zp,{})})}),n.jsx(Lo,{title:c("toolbar.resetCanvas"),children:n.jsx("button",{onClick:u,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":c("toolbar.resetCanvas"),children:n.jsx(O3,{})})}),n.jsx(kT,{}),n.jsx(ST,{tabs:p,activeTabId:h,onSwitchTab:w,onAddTab:k,onCloseTab:b,onRenameTab:y}),n.jsxs("h1",{className:"text-lg font-bold text-accent-text whitespace-nowrap flex items-center space-x-2 select-none ml-2",children:[n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{d:"M21 15l-5-5L5 21"})]}),n.jsx("span",{children:c("app.title")})]}),n.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[n.jsx("div",{className:"px-2 py-0.5 bg-gray-800 rounded border border-gray-600 text-[10px] font-mono text-gray-400 select-none",children:ET}),n.jsxs("div",{className:"relative",children:[n.jsx(Lo,{title:c("settings.themeLabel"),children:n.jsx("button",{onClick:T=>{T.stopPropagation(),s(!i)},className:`p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 ${i?"bg-accent text-white":"bg-gray-700 text-gray-300 hover:bg-accent hover:text-white"}`,children:n.jsx(F3,{})})}),i&&n.jsx("div",{className:"absolute top-full right-0 mt-2 bg-gray-800 border border-gray-600 rounded-lg shadow-xl p-2 z-50 flex flex-col gap-1 min-w-[120px] animate-fade-in-drop origin-top-right",children:N.map(T=>n.jsxs("button",{onClick:()=>j(T.id),className:`flex items-center gap-2 px-2 py-1.5 rounded hover:bg-gray-700 w-full text-left transition-colors ${P===T.id?"bg-gray-700":""}`,children:[n.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:T.color}}),n.jsx("span",{className:`text-xs ${P===T.id?"text-white font-bold":"text-gray-300"}`,children:T.label})]},T.id))})]}),n.jsx(Lo,{title:c("dialog.settings.reload"),children:n.jsx("button",{onClick:E,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 text-gray-300 hover:bg-red-600 hover:text-white","aria-label":c("dialog.settings.reload"),children:n.jsx(K1,{})})}),n.jsx(Lo,{title:c("toolbar.exitApp"),align:"right",children:n.jsx("button",{onClick:B,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-red-600 hover:text-white text-gray-300","aria-label":c("toolbar.exitApp"),children:n.jsx(B3,{})})})]})]})]})})]})},x0="prompt_modifier_recent_nodes",jT=({isOpen:e,position:t,onClose:o,onAddNode:r})=>{const{t:a}=St(),[i,s]=v.useState(""),[l,c]=v.useState(0),[d,u]=v.useState([]),p=v.useRef(null),h=v.useRef(null),w=v.useRef(null),[k,b]=v.useState({x:0,y:0}),[y,g]=v.useState(!1),m=v.useRef(!1),x=v.useRef({x:0,y:0}),_=v.useRef({x:0,y:0});v.useEffect(()=>{try{const F=localStorage.getItem(x0);F&&u(JSON.parse(F))}catch(F){console.error("Failed to load recent nodes",F)}},[]);const S=F=>{u(z=>{const G=z.filter(R=>R!==F),U=[F,...G].slice(0,3);return localStorage.setItem(x0,JSON.stringify(U)),U})},P=v.useMemo(()=>[{group:"input",type:L.TEXT_INPUT,title:a("search.node.text_input.title"),englishTitle:"Text Input",description:a("search.node.text_input.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 6h10M12 6v12"})})},{group:"input",type:L.IMAGE_INPUT,title:a("search.node.image_input.title"),englishTitle:"Image Input",description:a("search.node.image_input.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{d:"M21 15l-5-5L5 21"})]})},{group:"input",type:L.MEDIA_VIEWER,title:a("search.node.media_viewer.title"),englishTitle:"Media Viewer",description:a("search.node.media_viewer.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})},{group:"input",type:L.PROMPT_SEQUENCE_EDITOR,title:a("search.node.prompt_sequence_editor.title"),englishTitle:"Prompt Sequence Editor",description:a("search.node.prompt_sequence_editor.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z"})})},{group:"input",type:L.DATA_READER,title:a("search.node.data_reader.title"),englishTitle:"Data Reader",description:a("search.node.data_reader.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})},{group:"input",type:L.NOTE,title:a("search.node.note.title"),englishTitle:"Note",description:a("search.node.note.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})},{group:"process",type:L.PROMPT_PROCESSOR,title:a("search.node.prompt_processor.title"),englishTitle:"Prompt Processor",description:a("search.node.prompt_processor.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})},{group:"process",type:L.PROMPT_ANALYZER,title:a("search.node.prompt_analyzer.title"),englishTitle:"Prompt Analyzer",description:a("search.node.prompt_analyzer.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})},{group:"character",type:L.CHARACTER_CARD,title:a("search.node.character_card.title"),englishTitle:"Character Card",description:a("search.node.character_card.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 8a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5a7.5 7.5 0 0115 0"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.5a.75.75 0 00-.75.75v13.5c0 .414.336.75.75.75h16.5a.75.75 0 00.75-.75V5.25a.75.75 0 00-.75-.75H3.75z"})]})},{group:"character",type:L.CHARACTER_ANALYZER,title:a("search.node.character_analyzer.title"),englishTitle:"Character Analyzer",description:a("search.node.character_analyzer.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})},{group:"character",type:L.CHARACTER_GENERATOR,title:a("search.node.character_generator.title"),englishTitle:"Character Generator",description:a("search.node.character_generator.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})})},{group:"character",type:L.POSE_CREATOR,title:a("search.node.pose_creator.title"),englishTitle:"Pose Creator",description:a("search.node.pose_creator.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})},{group:"process",type:L.IMAGE_ANALYZER,title:a("search.node.image_analyzer.title"),englishTitle:"Image Analyzer",description:a("search.node.image_analyzer.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0z"})})},{group:"process",type:L.IMAGE_EDITOR,title:a("search.node.image_editor.title"),englishTitle:"AI Image Editor",description:a("search.node.image_editor.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]})},{group:"ai",type:L.TRANSLATOR,title:a("search.node.translator.title"),englishTitle:"Translator",description:a("search.node.translator.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})},{group:"ai",type:L.GEMINI_CHAT,title:a("search.node.gemini_chat.title"),englishTitle:"Gemini Chat",description:a("search.node.gemini_chat.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{group:"ai",type:L.PROMPT_SANITIZER,title:a("search.node.prompt_sanitizer.title"),englishTitle:"Prompt Sanitizer",description:a("search.node.prompt_sanitizer.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})},{group:"video",type:L.VIDEO_PROMPT_PROCESSOR,title:a("search.node.video_prompt_processor.title"),englishTitle:"Video Prompt Processor",description:a("search.node.video_prompt_processor.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})})},{group:"video",type:L.VIDEO_OUTPUT,title:a("search.node.video_output.title"),englishTitle:"Video Output",description:a("search.node.video_output.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9A2.25 2.25 0 0013.5 5.25h-9A2.25 2.25 0 002.25 7.5v9A2.25 2.25 0 004.5 18.75z"})})},{group:"video",type:L.VIDEO_EDITOR,title:a("node.title.video_editor"),englishTitle:"Video Editor",description:a("node.help.video_editor"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})},{group:"scripts",type:L.SCRIPT_GENERATOR,title:a("search.node.script_generator.title"),englishTitle:"Script Generator",description:a("search.node.script_generator.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})},{group:"scripts",type:L.SCRIPT_VIEWER,title:a("search.node.script_viewer.title"),englishTitle:"Script Viewer",description:a("search.node.script_viewer.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 19.82a2.25 2.25 0 01-1.897 1.13l-2.685.8.8-2.685a2.25 2.25 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})},{group:"output",type:L.IMAGE_OUTPUT,title:a("search.node.image_output.title"),englishTitle:"Image Output",description:a("search.node.image_output.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})},{group:"output",type:L.IMAGE_SEQUENCE_GENERATOR,title:a("search.node.image_sequence_generator.title"),englishTitle:"Image Sequence Generator",description:a("search.node.image_sequence_generator.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})})},{group:"output",type:L.IMAGE_EDITOR,title:a("search.node.image_editor.title"),englishTitle:"AI Image Editor",description:a("search.node.image_editor.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]})},{group:"game",type:L.DATA_PROTECTION,title:a("search.node.data_protection.title"),englishTitle:"Data Protection",description:a("search.node.data_protection.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})}],[a]),j=v.useMemo(()=>({input:a("search.group.input"),process:a("search.group.process"),character:a("quickadd.group.character"),output:a("search.group.output"),ai:a("search.group.ai"),video:a("search.group.video"),scripts:a("search.group.scripts"),game:"Games"}),[a]),M={input:"bg-emerald-800/50 text-emerald-300",process:"bg-green-800/50 text-green-300",character:"bg-pink-800/50 text-pink-300",output:"bg-blue-800/50 text-blue-300",ai:"bg-amber-800/50 text-amber-300",video:"bg-red-800/50 text-red-300",scripts:"bg-lime-800/50 text-lime-300",game:"bg-cyan-800/50 text-cyan-300"},D=v.useMemo(()=>{const F=i.toLowerCase().trim(),z=P.filter(G=>G.title.toLowerCase().includes(F)||G.englishTitle.toLowerCase().includes(F)||G.description.toLowerCase().includes(F));return F===""?{recents:d.map(U=>P.find(R=>R.type===U)).filter(Boolean),all:P}:{recents:[],all:z}},[i,P,d]),O=v.useMemo(()=>{const{recents:F,all:z}=D;return[...F.map(G=>({...G,isRecent:!0})),...z.map(G=>({...G,isRecent:!1}))]},[D]);v.useEffect(()=>{if(e){if(s(""),c(0),g(!0),w.current){const F=w.current.getBoundingClientRect();let z=t.x-F.width/2,G=t.y+10;z+F.width>window.innerWidth-10&&(z=window.innerWidth-F.width-10),z<10&&(z=10),G+400>window.innerHeight-10&&(G=t.y-400-10),G<10&&(G=10),b({x:z,y:G}),_.current={x:z,y:G}}setTimeout(()=>{var F;return(F=p.current)==null?void 0:F.focus()},50)}else g(!1)},[e,t]),v.useEffect(()=>{var F;if(l>=0&&l<O.length){const z=(F=h.current)==null?void 0:F.querySelector(`[data-index="${l}"]`);z==null||z.scrollIntoView({block:"nearest"})}},[l,O]);const B=F=>{F.preventDefault(),F.stopPropagation(),m.current=!0,x.current={x:F.clientX,y:F.clientY},_.current={...k},F.currentTarget.setPointerCapture(F.pointerId)},E=F=>{if(m.current&&w.current){const z=F.clientX-x.current.x,G=F.clientY-x.current.y;w.current.style.transform=`translate(${z}px, ${G}px)`}},I=F=>{if(m.current&&w.current){m.current=!1;const z=F.clientX-x.current.x,G=F.clientY-x.current.y;b(U=>({x:U.x+z,y:U.y+G})),w.current.style.transform="",F.currentTarget.releasePointerCapture(F.pointerId)}},N=F=>{if(F.key==="Escape")F.stopPropagation(),o();else if(F.key==="ArrowDown")F.preventDefault(),c(z=>Math.min(z+1,O.length-1));else if(F.key==="ArrowUp")F.preventDefault(),c(z=>Math.max(z-1,0));else if(F.key==="Enter"&&(F.preventDefault(),O[l])){const z=O[l].type;r(z),S(z),o()}},T=F=>{r(F),S(F),o()};return!e&&!y?null:n.jsx("div",{className:"fixed inset-0 z-50 bg-transparent pointer-events-none",children:n.jsxs("div",{ref:w,className:`bg-gray-800 rounded-lg shadow-2xl w-full max-w-md border border-gray-700 flex flex-col pointer-events-auto transition-opacity duration-150 ${y?"opacity-100":"opacity-0"}`,style:{left:k.x,top:k.y,position:"absolute"},onMouseDown:F=>F.stopPropagation(),onKeyDown:N,children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-700 cursor-move bg-gray-900/50 rounded-t-lg select-none",onPointerDown:B,onPointerMove:E,onPointerUp:I,children:[n.jsx("span",{className:"font-bold text-gray-200",children:a("hotkeys.windows.search")}),n.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[n.jsx("span",{children:"ESC to close"}),n.jsx("button",{onClick:o,onPointerDown:F=>F.stopPropagation(),className:"hover:text-white transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),n.jsx("div",{className:"p-4 border-b border-gray-700",children:n.jsx("input",{ref:p,type:"text",placeholder:a("search.placeholder"),value:i,onChange:F=>{s(F.target.value),c(0)},className:"w-full px-3 py-2 bg-gray-900 text-white rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-accent",onKeyDown:F=>{F.key==="Escape"&&(F.preventDefault(),o()),F.stopPropagation()}})}),n.jsx("ul",{ref:h,className:"max-h-80 overflow-y-auto p-2",onWheel:F=>F.stopPropagation(),children:O.length>0?O.map((F,z)=>{const G=z>0?O[z-1]:null,U=F.isRecent,R=G?G.isRecent:!1;let q=!1,H="",ne="";return U?z===0&&(q=!0,H="Recent",ne="bg-gray-700 text-gray-300"):(!G||R||F.group!==G.group)&&(q=!0,H=j[F.group],ne=M[F.group]),n.jsxs(jt.Fragment,{children:[q&&n.jsx("li",{className:`px-3 py-1 mt-2 mb-1 text-xs font-bold rounded ${ne} select-none list-none uppercase tracking-wider`,"aria-hidden":"true",children:H}),n.jsxs("li",{"data-index":z,onClick:()=>T(F.type),onMouseEnter:()=>c(z),className:`flex items-center space-x-4 p-3 rounded-md cursor-pointer transition-colors duration-150 ${z===l?"bg-accent":"hover:bg-gray-700"}`,children:[n.jsx("div",{className:`flex-shrink-0 w-8 h-8 flex items-center justify-center rounded ${z===l?"text-white":"text-gray-300"}`,children:F.icon}),n.jsxs("div",{children:[n.jsx("p",{className:`font-semibold ${z===l?"text-white":"text-gray-100"}`,children:F.title}),n.jsx("p",{className:`text-sm ${z===l?"text-white/80":"text-gray-400"}`,children:F.description})]})]})]},`${F.type}-${z}`)}):n.jsx("li",{className:"p-4 text-center text-gray-500",children:a("search.noResults")})})]})})},TT=({title:e,onClick:t,children:o,isActive:r})=>{const[a,i]=v.useState(!1);return n.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:[n.jsx("button",{onClick:t,"aria-label":e,className:`flex items-center justify-center w-9 h-9 p-2 rounded-md transition-colors text-gray-300 hover:text-white ${r?"bg-accent text-white":"bg-gray-700 hover:bg-accent"}`,children:o}),n.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 opacity-0 pointer-events-none group-hover:opacity-100",role:"tooltip",children:e})]})},IT=({isOpen:e,position:t,onClose:o,onAddNode:r,onToolChange:a,activeTool:i,isPinned:s,onPinToggle:l,onPaste:c})=>{const{t:d}=St(),u=v.useRef(null),[p,h]=v.useState({opacity:0,pointerEvents:"none"}),[w,k]=v.useState(!1),[b,y]=v.useState({x:0,y:0}),g=v.useRef(null),m=v.useRef(!1);v.useEffect(()=>{if(e){if(y({x:0,y:0}),u.current){const I=u.current.getBoundingClientRect(),N=window.innerWidth,T=window.innerHeight,F=20,z=[{left:t.x+F,top:t.y+F},{left:t.x-I.width-F,top:t.y+F},{left:t.x+F,top:t.y-I.height-F},{left:t.x-I.width-F,top:t.y-I.height-F}];let G=null;for(const U of z){const R={left:U.left,top:U.top,right:U.left+I.width,bottom:U.top+I.height};if(R.left>=F&&R.right<=N-F&&R.top>=F&&R.bottom<=T-F){G=U;break}}G||(G=z.find(U=>{const R={left:U.left,top:U.top,right:U.left+I.width,bottom:U.top+I.height};return R.left>=0&&R.right<=N&&R.top>=0&&R.bottom<=T})||z[0]),G.left+I.width>N&&(G.left=N-I.width-F),G.top+I.height>T&&(G.top=T-I.height-F),G.left<0&&(G.left=F),G.top<0&&(G.top=F),h({left:G.left,top:G.top,position:"fixed",opacity:1,transition:"opacity 150ms ease-in-out"})}}else h({opacity:0,pointerEvents:"none"})},[e,t]);const x=I=>{I.stopPropagation(),!I.target.closest("button")&&(I.preventDefault(),I.currentTarget.setPointerCapture(I.pointerId),g.current={x:I.clientX-b.x,y:I.clientY-b.y},m.current=!0)},_=I=>{g.current&&y({x:I.clientX-g.current.x,y:I.clientY-g.current.y})},S=I=>{m.current=!1,g.current=null,I.currentTarget.releasePointerCapture(I.pointerId)},P=()=>{c&&(c(),o())},j=v.useMemo(()=>({tools:{items:[{type:"tool",id:"edit",title:d("quickadd.tool.edit"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})},{type:"tool",id:"cutter",title:d("quickadd.tool.cutter"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{type:"tool",id:"selection",title:d("quickadd.tool.selection"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"4 4",d:"M3.75 3.75h16.5v16.5H3.75z"})})}]},inputs:{items:[{type:"node",id:L.TEXT_INPUT,title:d("search.node.text_input.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 6h10M12 6v12"})})},{type:"node",id:L.IMAGE_INPUT,title:d("search.node.image_input.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{d:"M21 15l-5-5L5 21"})]})},{type:"node",id:L.MEDIA_VIEWER,title:d("search.node.media_viewer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})}]},processing:{items:[{type:"node",id:L.PROMPT_PROCESSOR,title:d("search.node.prompt_processor.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})},{type:"node",id:L.PROMPT_ANALYZER,title:d("search.node.prompt_analyzer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})},{type:"node",id:L.IMAGE_ANALYZER,title:d("search.node.image_analyzer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12.792V5.25a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 5.25v13.5A2.25 2.25 0 005.25 21h7.55"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 18.375L21 21"})]})}]},character:{items:[{type:"node",id:L.CHARACTER_GENERATOR,title:d("search.node.character_generator.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})})},{type:"node",id:L.CHARACTER_ANALYZER,title:d("search.node.character_analyzer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})},{type:"node",id:L.CHARACTER_CARD,title:d("search.node.character_card.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 8a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5a7.5 7.5 0 0115 0"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.5a.75.75 0 00-.75.75v13.5c0 .414.336.75.75.75h16.5a.75.75 0 00.75-.75V5.25a.75.75 0 00-.75-.75H3.75z"})]})}]},outputs:{items:[{type:"node",id:L.IMAGE_OUTPUT,title:d("search.node.image_output.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})},{type:"node",id:L.IMAGE_EDITOR,title:d("search.node.image_editor.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]})},{type:"node",id:L.IMAGE_SEQUENCE_GENERATOR,title:d("search.node.image_sequence_generator.title").replace("Sequence","Seq.").replace("","."),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})})}]},ai:{items:[{type:"node",id:L.GEMINI_CHAT,title:d("search.node.gemini_chat.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{type:"node",id:L.TRANSLATOR,title:d("search.node.translator.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})},{type:"node",id:L.PROMPT_SANITIZER,title:d("search.node.prompt_sanitizer.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})}]},video:{items:[{type:"node",id:L.VIDEO_PROMPT_PROCESSOR,title:d("search.node.video_prompt_processor.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7l-2 4 4 2-4 2-2 4-2-4-4-2 4-2z"})]})},{type:"node",id:L.VIDEO_OUTPUT,title:d("search.node.video_output.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9A2.25 2.25 0 0013.5 5.25h-9A2.25 2.25 0 002.25 7.5v9A2.25 2.25 0 004.5 18.75z"})})},{type:"node",id:L.VIDEO_EDITOR,title:d("node.title.video_editor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})]})}]},scripts:{items:[{type:"node",id:L.SCRIPT_GENERATOR,title:d("search.node.script_generator.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})},{type:"node",id:L.SCRIPT_VIEWER,title:d("search.node.script_viewer.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 19.82a2.25 2.25 0 01-1.897 1.13l-2.685.8.8-2.685a2.25 2.25 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})}]},general:{items:[{type:"node",id:L.NOTE,title:d("search.node.note.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})},{type:"node",id:L.DATA_READER,title:d("search.node.data_reader.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})},{type:"node",id:L.PROMPT_SEQUENCE_EDITOR,title:d("search.node.prompt_sequence_editor.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z"})})}]}}),[d]),M=I=>{I.type==="tool"?a(I.id):I.type==="node"&&r(I.id),o()},D=Object.keys(j),O=D.slice(0,5),B=D.slice(5),E=I=>{const N=j[I];return n.jsxs("div",{children:[n.jsx("h3",{className:"text-xs text-gray-400 uppercase font-bold mb-1 px-1 select-none",children:d(`quickadd.group.${I}`)}),n.jsx("div",{className:"flex flex-wrap gap-1",children:N.items.map(T=>n.jsx(TT,{title:T.title,onClick:()=>M(T),isActive:T.type==="tool"&&T.id===i,children:T.icon},T.id))})]},I)};return n.jsxs("div",{ref:u,className:"fixed bg-gray-800 rounded-lg shadow-2xl p-2 flex flex-col w-auto z-[51]",style:{...p,transform:`translate(${b.x}px, ${b.y}px)`},onMouseDown:I=>I.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center justify-between px-1 pb-2 mb-1 border-b border-gray-700 cursor-move",onPointerDown:x,onPointerMove:_,onPointerUp:S,children:[n.jsx("span",{className:"text-sm font-bold text-gray-300 select-none",children:d("quickadd.title")}),n.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),children:[n.jsx("button",{onClick:I=>{I.stopPropagation(),l&&l()},className:`p-1 rounded hover:bg-white/10 transition-colors ${s?"text-accent":"text-gray-500 hover:text-gray-300"}`,onMouseDown:I=>I.stopPropagation(),children:n.jsx(Op,{className:"h-4 w-4"})}),n.jsx("div",{className:`absolute top-full right-0 mt-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 opacity-0 pointer-events-none origin-top-right transform ${w?"opacity-100 scale-100":"scale-90"}`,role:"tooltip",children:s?"Unpin menu":"Pin menu to screen"})]})]}),n.jsxs("div",{className:"flex space-x-4 p-1",children:[n.jsx("div",{className:"flex flex-col space-y-3",children:O.map(E)}),n.jsx("div",{className:"flex flex-col space-y-3",children:B.map(E)})]}),c&&n.jsx("div",{className:"mt-2 pt-2 border-t border-gray-700",children:n.jsxs("button",{onClick:P,className:"w-full flex items-center justify-center p-2 rounded-md bg-input hover:bg-accent text-gray-300 hover:text-white transition-colors gap-2 group",title:d("node.action.paste"),children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400 group-hover:text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),n.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:d("node.action.paste")})]})})]})},y0=150,v0=50,si=400,ta=si/2,AT=184,w0=116,MT=60,RT=({isOpen:e,position:t,onClose:o,onAddNode:r,onSelectItem:a})=>{const{t:i}=St(),[s,l]=v.useState(null),c=v.useMemo(()=>[{name:i("quickadd.group.inputs"),color:"bg-blue-600",textColor:"text-blue-400",options:[{type:L.TEXT_INPUT,title:i("search.node.text_input.title"),icon:n.jsx("span",{className:"font-bold text-xl leading-none",children:"[T]"}),hotkey:"T"},{type:L.IMAGE_INPUT,title:i("search.node.image_input.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:[n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{d:"M21 15l-5-5L5 21"})]}),hotkey:"I"},{type:L.MEDIA_VIEWER,title:i("search.node.media_viewer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),hotkey:"M"},{type:L.PROMPT_SEQUENCE_EDITOR,title:i("search.node.prompt_sequence_editor.title").replace("Sequence","Seq.").replace("","."),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z"})}),hotkey:"Q"}]},{name:i("quickadd.group.processing"),color:"bg-purple-600",textColor:"text-purple-400",options:[{type:L.IMAGE_ANALYZER,title:i("search.node.image_analyzer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12.792V5.25a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 5.25v13.5A2.25 2.25 0 005.25 21h7.55"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 18.375L21 21"})]}),hotkey:"Shift + A"},{type:L.PROMPT_ANALYZER,title:i("search.node.prompt_analyzer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]}),hotkey:"A"},{type:L.PROMPT_PROCESSOR,title:i("search.node.prompt_processor.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})}),hotkey:"P"}]},{name:i("quickadd.group.character"),color:"bg-pink-600",textColor:"text-pink-400",options:[{type:L.CHARACTER_GENERATOR,title:i("search.node.character_generator.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})}),hotkey:"Shift + C"},{type:L.CHARACTER_ANALYZER,title:i("search.node.character_analyzer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]}),hotkey:"Ctrl + Shift + A"},{type:L.CHARACTER_CARD,title:i("search.node.character_card.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 8a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5a7.5 7.5 0 0115 0"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.5a.75.75 0 00-.75.75v13.5c0 .414.336.75.75.75h16.5a.75.75 0 00.75-.75V5.25a.75.75 0 00-.75-.75H3.75z"})]}),hotkey:"Ctrl + Shift + C"}]},{name:i("quickadd.group.outputs"),color:"bg-teal-600",textColor:"text-teal-400",options:[{type:L.IMAGE_OUTPUT,title:i("search.node.image_output.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]}),hotkey:"O"},{type:L.IMAGE_EDITOR,title:i("search.node.image_editor.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]}),hotkey:"Shift + I"},{type:L.IMAGE_SEQUENCE_GENERATOR,title:i("search.node.image_sequence_generator.title").replace("Sequence","Seq.").replace("","."),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})}),hotkey:"Shift + Q"}]},{name:i("quickadd.group.ai"),color:"bg-green-600",textColor:"text-green-400",options:[{type:L.GEMINI_CHAT,title:i("search.node.gemini_chat.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),hotkey:"G"},{type:L.TRANSLATOR,title:i("search.node.translator.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})}),hotkey:"L"}]},{name:i("quickadd.group.scripts"),color:"bg-lime-600",textColor:"text-lime-400",options:[{type:L.SCRIPT_VIEWER,title:i("search.node.script_viewer.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 19.82a2.25 2.25 0 01-1.897 1.13l-2.685.8.8-2.685a2.25 2.25 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})}),hotkey:"Shift + V"}]},{name:i("quickadd.group.video"),color:"bg-red-600",textColor:"text-red-400",options:[{type:L.VIDEO_PROMPT_PROCESSOR,title:i("search.node.video_prompt_processor.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7l-2 4 4 2-4 2-2 4-2-4-4-2 4-2z"})]}),hotkey:"Shift + P"},{type:L.VIDEO_OUTPUT,title:i("search.node.video_output.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9A2.25 2.25 0 0013.5 5.25h-9A2.25 2.25 0 002.25 7.5v9A2.25 2.25 0 004.5 18.75z"})}),hotkey:"Shift + O"},{type:L.VIDEO_EDITOR,title:i("node.title.video_editor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})]}),hotkey:"E"}]}],[i]),d=v.useMemo(()=>c.flatMap(k=>k.options.map(b=>({...b,groupColor:k.color,textColor:k.textColor}))),[c]),u=2*Math.PI/d.length,p=v.useCallback((k,b)=>{const y=k-t.x,g=b-t.y;if(Math.sqrt(y*y+g*g)<MT){s!==null&&(l(null),a(null));return}let x=Math.atan2(g,y);x<0&&(x+=2*Math.PI);const _=d.length,S=2*Math.PI/_,P=Math.PI-S/2;let j=x-P;j<0&&(j+=2*Math.PI);const M=Math.floor(j/S)%_,D=d[M];(s==null?void 0:s.type)!==D.type&&(l(D),a(D.type))},[d,s,a,t.x,t.y]),h=v.useCallback(()=>{s?r(s.type):o()},[s,r,o]);v.useEffect(()=>{if(!e){l(null),a(null);return}const k=g=>{g.key==="Escape"&&o()},b=g=>{g.touches.length>0&&p(g.touches[0].clientX,g.touches[0].clientY)},y=()=>{h()};return window.addEventListener("keydown",k),window.addEventListener("touchmove",b),window.addEventListener("touchend",y),window.addEventListener("touchcancel",y),()=>{window.removeEventListener("keydown",k),window.removeEventListener("touchmove",b),window.removeEventListener("touchend",y),window.removeEventListener("touchcancel",y)}},[e,o,p,h,a]);const w=k=>{p(k.clientX,k.clientY)};return e?n.jsx("div",{className:"fixed inset-0 z-40",onMouseUp:()=>h(),onMouseMove:w,onMouseDown:k=>k.stopPropagation(),onContextMenu:k=>k.preventDefault(),children:n.jsxs("div",{className:"absolute pointer-events-none",style:{left:t.x,top:t.y},children:[n.jsxs("svg",{width:si,height:si,className:"absolute top-0 left-0 -translate-x-1/2 -translate-y-1/2",viewBox:`0 0 ${si} ${si}`,style:{filter:"drop-shadow(0 10px 15px rgba(0,0,0,0.1))"},children:[n.jsx("defs",{children:n.jsxs("mask",{id:"donut-mask",children:[n.jsx("rect",{width:"100%",height:"100%",fill:"white"}),n.jsx("circle",{cx:ta,cy:ta,r:w0,fill:"black"})]})}),n.jsx("circle",{cx:ta,cy:ta,r:AT,fill:"rgba(17, 24, 39, 0.85)",mask:"url(#donut-mask)",stroke:"rgb(75, 85, 99)",strokeWidth:"1"}),n.jsx("circle",{cx:ta,cy:ta,r:w0,fill:"none",stroke:"rgb(75, 85, 99)",strokeWidth:"1"})]}),n.jsxs("div",{className:"absolute top-0 left-0 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-center pointer-events-none w-48 h-48",children:[n.jsx("div",{className:`flex items-center justify-center w-20 h-20 rounded-lg mb-2 transition-all duration-200 ease-in-out shadow-lg border-2 border-white/10 ${s?`opacity-100 scale-100 ${s.groupColor}`:"opacity-0 scale-90"}`,children:s&&n.jsx("div",{className:"text-white",children:s.icon})}),n.jsxs("div",{className:"bg-gray-900/80 backdrop-blur-sm text-white px-4 py-2 rounded-lg text-center transition-opacity duration-200 flex flex-col items-center",style:{opacity:s?1:0},children:[n.jsx("span",{className:"text-sm font-semibold whitespace-nowrap",children:s==null?void 0:s.title}),(s==null?void 0:s.hotkey)&&n.jsx("span",{className:"text-xs text-gray-400 font-mono mt-0.5",children:s.hotkey})]})]}),d.map((k,b)=>{const y=u*b+Math.PI,g=y0*Math.cos(y),m=y0*Math.sin(y),x=(s==null?void 0:s.type)===k.type;return n.jsx("div",{className:`absolute flex items-center justify-center rounded-full transition-all duration-200 ease-in-out ${x?k.groupColor:""} ${x?"text-white":k.textColor}`,style:{width:v0,height:v0,top:0,left:0,transform:`translate(-50%, -50%) translate(${g}px, ${m}px) scale(${x?1.25:1})`,zIndex:x?10:1},children:k.icon},k.type)})]})}):null},Do=({tooltip:e,tooltipPosition:t="top",children:o,className:r,onMouseDown:a,...i})=>{const[s,l]=v.useState(!1);return n.jsxs("button",{className:`relative ${r}`,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),onMouseDown:a,...i,children:[o,e&&n.jsx("div",{className:`absolute ${t==="top"?"bottom-full mb-2 origin-bottom":"top-full mt-2 origin-top"} left-1/2 -translate-x-1/2 px-2 py-1 bg-slate-700 text-slate-200 text-xs whitespace-nowrap rounded shadow-xl z-[70] pointer-events-none transition-all duration-100 ease-out transform ${s?"opacity-100 scale-100":"opacity-0 scale-90"}`,children:e})]})},Es=e=>{switch(e){case"edit":return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})});case"cutter":return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});case"selection":return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"4 4",d:"M3.75 3.75h16.5v16.5H3.75z"})});case"reroute":return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})});default:return null}},py=e=>{if(!e)return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})});switch(e){case L.TEXT_INPUT:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 6h10M12 6v12"})});case L.IMAGE_INPUT:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{d:"M21 15l-5-5L5 21"})]});case L.MEDIA_VIEWER:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]});case L.PROMPT_SEQUENCE_EDITOR:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z"})});case L.PROMPT_PROCESSOR:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]});case L.PROMPT_ANALYZER:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]});case L.IMAGE_ANALYZER:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12.792V5.25a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 5.25v13.5A2.25 2.25 0 005.25 21h7.55"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 18.375L21 21"})]});case L.CHARACTER_GENERATOR:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})});case L.CHARACTER_ANALYZER:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]});case L.CHARACTER_CARD:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 8a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5a7.5 7.5 0 0115 0"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.5a.75.75 0 00-.75.75v13.5c0 .414.336.75.75.75h16.5a.75.75 0 00.75-.75V5.25a.75.75 0 00-.75-.75H3.75z"})]});case L.IMAGE_OUTPUT:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]});case L.IMAGE_EDITOR:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]});case L.IMAGE_SEQUENCE_GENERATOR:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})});case L.GEMINI_CHAT:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});case L.TRANSLATOR:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})});case L.PROMPT_SANITIZER:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})});case L.VIDEO_PROMPT_PROCESSOR:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7l-2 4 4 2-4 2-2 4-2-4-4-2 4-2z"})]});case L.VIDEO_OUTPUT:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9A2.25 2.25 0 0013.5 5.25h-9A2.25 2.25 0 002.25 7.5v9A2.25 2.25 0 004.5 18.75z"})});case L.SCRIPT_GENERATOR:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})});case L.SCRIPT_VIEWER:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 19.82a2.25 2.25 0 01-1.897 1.13l-2.685.8.8-2.685a2.25 2.25 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})});case L.NOTE:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})});case L.DATA_READER:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]});case L.VIDEO_EDITOR:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})]});default:return n.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-500"})}},Eu=(e,t)=>t(`search.node.${e.toLowerCase()}.title`)||e,LT=({onClose:e,slotIndex:t,onSelect:o,nodeGroups:r,t:a})=>{const[i,s]=v.useState(""),l=v.useRef(null);v.useEffect(()=>{l.current&&l.current.focus()},[]);const c=v.useMemo(()=>{if(!i)return r;const d={},u=i.toLowerCase();return Object.keys(r).forEach(p=>{const h=r[p].filter(w=>Eu(w,a).toLowerCase().includes(u));h.length>0&&(d[p]=h)}),d},[r,i,a]);return n.jsxs("div",{className:"absolute top-0 left-0 w-full max-h-[340px] bg-gray-900/95 backdrop-blur-md rounded-lg shadow-2xl border border-node-border flex flex-col overflow-hidden z-20",children:[n.jsxs("div",{className:"flex flex-col p-2 border-b border-node-border flex-shrink-0 bg-input/30",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("span",{className:"text-xs font-bold text-gray-300",children:["Assign Slot ",t+1]}),n.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414-1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),n.jsx("input",{ref:l,type:"text",placeholder:"Search...",className:"w-full bg-input text-xs text-gray-200 border border-node-border rounded px-2 py-1 focus:outline-none focus:border-accent",value:i,onChange:d=>s(d.target.value),onKeyDown:d=>d.stopPropagation()})]}),n.jsx("div",{className:"overflow-y-auto p-2 space-y-3 custom-scrollbar flex-grow",children:Object.keys(c).length>0?Object.keys(c).map(d=>n.jsxs("div",{children:[n.jsx("h4",{className:"text-[10px] uppercase font-bold text-gray-500 mb-1 px-1",children:a(`quickadd.group.${d}`)}),n.jsx("div",{className:"grid grid-cols-1 gap-1",children:c[d].map(u=>n.jsxs("button",{onClick:()=>o(u),className:"flex items-center space-x-2 p-2 rounded hover:bg-accent/30 text-left transition-colors group",children:[n.jsx("div",{className:"text-gray-400 group-hover:text-accent",children:py(u)}),n.jsx("span",{className:"text-xs text-gray-200 group-hover:text-white truncate",children:Eu(u,a)})]},u))})]},d)):n.jsx("div",{className:"p-2 text-xs text-gray-500 text-center",children:"No results found"})})]})},b0=280,C0=176,DT=({isOpen:e,position:t,onClose:o,onToolSelect:r,slots:a,onSlotUpdate:i,onSetSlots:s,onAddNode:l,isPinned:c,onPinToggle:d,zoom:u,onZoomChange:p,scaleToSliderValue:h,sliderValueToScale:w,onPaste:k})=>{const{t:b}=St(),[y,g]=v.useState(null),m=v.useRef(null),[x,_]=v.useState({opacity:0,pointerEvents:"none",transform:"scale(0.95)",transition:"opacity 0.15s ease-out, transform 0.15s ease-out"}),[S,P]=v.useState({x:0,y:0}),j=v.useRef(null),M=v.useRef(!1),D=v.useRef(null);v.useEffect(()=>{e?(g(null),P({x:0,y:0}),t.x,t.y,requestAnimationFrame(()=>{_({opacity:1,pointerEvents:"auto",transform:"scale(1)",transition:"opacity 0.15s ease-out, transform 0.15s ease-out"})})):_({opacity:0,pointerEvents:"none",transform:"scale(0.95)",transition:"opacity 0.1s ease-in, transform 0.1s ease-in"})},[e,t]),v.useEffect(()=>{const ee=se=>{m.current&&!m.current.contains(se.target)&&!M.current&&o()};return e&&!c&&window.addEventListener("mousedown",ee),()=>window.removeEventListener("mousedown",ee)},[e,o,c]);const O=ee=>{ee.preventDefault(),ee.stopPropagation(),ee.currentTarget.setPointerCapture(ee.pointerId),j.current={x:ee.clientX-S.x,y:ee.clientY-S.y},M.current=!0},B=ee=>{j.current&&P({x:ee.clientX-j.current.x,y:ee.clientY-j.current.y})},E=ee=>{M.current=!1,j.current=null,ee.currentTarget.releasePointerCapture(ee.pointerId)},I=ee=>{p&&w&&p(w(Number(ee.target.value)))},N=()=>{p&&p(1)},T=ee=>{r(ee),o()},F=()=>{k&&(k(),o())},z=(ee,se)=>{se.stopPropagation();const ie=a[ee];ie?(l(ie),o()):g(ee)},G=(ee,se)=>{se.preventDefault(),se.stopPropagation(),g(ee)},U=ee=>{y!==null&&(i(y,ee),g(null))},R=()=>{const ee=JSON.stringify(a,null,2),se=new Blob([ee],{type:"application/json"}),ie=URL.createObjectURL(se),oe=document.createElement("a");oe.href=ie,oe.download="prompt-modifier-slots.json",document.body.appendChild(oe),oe.click(),document.body.removeChild(oe),URL.revokeObjectURL(ie)},q=()=>{var ee;(ee=D.current)==null||ee.click()},H=ee=>{var oe;const se=(oe=ee.target.files)==null?void 0:oe[0];if(!se)return;const ie=new FileReader;ie.onload=A=>{var K;try{const Z=JSON.parse((K=A.target)==null?void 0:K.result);Array.isArray(Z)&&Z.length===8&&s?s(Z):alert("Invalid slots file format")}catch(Z){console.error(Z),alert("Failed to load slots file")}D.current&&(D.current.value="")},ie.readAsText(se)},ne=v.useMemo(()=>({inputs:[L.TEXT_INPUT,L.IMAGE_INPUT,L.PROMPT_SEQUENCE_EDITOR,L.DATA_READER,L.NOTE,L.MEDIA_VIEWER],processing:[L.PROMPT_PROCESSOR,L.PROMPT_ANALYZER,L.IMAGE_ANALYZER,L.PROMPT_SANITIZER],character:[L.CHARACTER_GENERATOR,L.CHARACTER_ANALYZER,L.CHARACTER_CARD,L.POSE_CREATOR],outputs:[L.IMAGE_OUTPUT,L.IMAGE_EDITOR,L.IMAGE_SEQUENCE_GENERATOR],ai:[L.GEMINI_CHAT,L.TRANSLATOR],video:[L.VIDEO_PROMPT_PROCESSOR,L.VIDEO_OUTPUT,L.SCRIPT_GENERATOR,L.SCRIPT_VIEWER,L.VIDEO_EDITOR]}),[]);let X=t.x,re=t.y;X+C0>window.innerWidth&&(X=X-C0),re+b0>window.innerHeight&&(re=re-b0);const de=X+S.x,ge=re+S.y,te=h&&u?h(u):0,le=Math.round((u||1)*100);return e?n.jsx("div",{ref:m,className:"fixed z-[60] w-44",style:{...x,left:de,top:ge},onMouseDown:ee=>ee.stopPropagation(),onWheel:ee=>ee.stopPropagation(),onContextMenu:ee=>ee.preventDefault(),children:n.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-2xl w-full relative z-10 flex flex-col",children:[n.jsxs("div",{className:"flex items-center justify-between px-2 py-2 cursor-move select-none border-b border-gray-700 rounded-t-lg",onPointerDown:O,onPointerMove:B,onPointerUp:E,children:[n.jsx("span",{className:"text-xs font-bold text-gray-400 pl-1",children:b("quickadd.group.tools")}),n.jsx(Do,{onClick:ee=>{ee.stopPropagation(),d&&d()},onPointerDown:ee=>ee.stopPropagation(),onMouseDown:ee=>ee.stopPropagation(),className:`p-1 rounded hover:bg-white/10 transition-colors ${c?"text-accent":"text-gray-500 hover:text-gray-300"}`,tooltip:c?"Unpin menu":"Pin menu to screen",tooltipPosition:"bottom",children:n.jsx(Op,{className:"h-4 w-4"})})]}),n.jsxs("div",{className:"p-2 grid grid-cols-4 gap-1",children:[n.jsx(Do,{onClick:()=>T("edit"),className:"flex items-center justify-center rounded-md bg-input/50 text-gray-300 hover:bg-accent hover:text-white transition-colors h-9 w-9",tooltip:b("toolbar.edit"),children:Es("edit")}),n.jsx(Do,{onClick:()=>T("cutter"),className:"flex items-center justify-center rounded-md bg-input/50 text-gray-300 hover:bg-accent hover:text-white transition-colors h-9 w-9",tooltip:b("toolbar.cutter"),children:Es("cutter")}),n.jsx(Do,{onClick:()=>T("selection"),className:"flex items-center justify-center rounded-md bg-input/50 text-gray-300 hover:bg-accent hover:text-white transition-colors h-9 w-9",tooltip:b("toolbar.selection"),children:Es("selection")}),n.jsx(Do,{onClick:()=>T("reroute"),className:"flex items-center justify-center rounded-md bg-input/50 text-gray-300 hover:bg-accent hover:text-white transition-colors h-9 w-9",tooltip:b("toolbar.reroute"),children:Es("reroute")})]}),n.jsx("div",{className:"h-px bg-gray-700 w-full"}),n.jsx("div",{className:"p-2 grid grid-cols-4 gap-1",children:a.map((ee,se)=>n.jsxs("div",{className:"relative group",onContextMenu:ie=>G(se,ie),onClick:ie=>z(se,ie),children:[n.jsx("button",{className:`w-9 h-9 rounded-md flex items-center justify-center border transition-colors ${ee?"bg-input/50 border-node-border text-gray-200 hover:bg-accent hover:text-white hover:border-accent":"bg-input/30 border-node-border border-dashed text-gray-600 hover:border-gray-500"}`,children:ee?py(ee):n.jsx("span",{className:"text-[10px] font-mono",children:se+1})}),n.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-slate-700 text-slate-200 text-xs whitespace-nowrap rounded shadow-xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-[70]",children:ee?Eu(ee,b):b("contextMenu.emptySlot")})]},se))}),y!==null&&n.jsx(LT,{onClose:()=>g(null),slotIndex:y,onSelect:U,nodeGroups:ne,t:b}),n.jsx("div",{className:"h-px bg-gray-700 w-full"}),n.jsxs("div",{className:"p-2 space-y-2",children:[p&&w&&n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs(Do,{onClick:N,className:"flex items-center space-x-1 px-1.5 py-1 rounded bg-input/50 hover:bg-white/10 text-gray-400 hover:text-white transition-colors border border-transparent hover:border-node-border",tooltip:b("toolbar.resetZoom"),children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),n.jsxs("span",{className:"text-[10px] font-mono min-w-[3ch] text-right",children:[le,"%"]})]}),n.jsx("input",{type:"range",min:"-100",max:"100",step:"1",value:te,onChange:I,className:"w-full h-1.5 bg-node-border rounded-lg appearance-none cursor-pointer accent-accent"})]}),n.jsxs("div",{className:"flex justify-between items-center pt-1",children:[n.jsxs("div",{className:"flex space-x-1",children:[n.jsx(Do,{onClick:R,className:"p-1.5 rounded bg-input hover:bg-white/10 text-gray-400 hover:text-white transition-colors",tooltip:b("contextMenu.saveSlots"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Do,{onClick:q,className:"p-1.5 rounded bg-input hover:bg-white/10 text-gray-400 hover:text-white transition-colors",tooltip:b("contextMenu.loadSlots"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0l-4 4m4-4v12"})})}),n.jsx("input",{ref:D,type:"file",accept:".json",className:"hidden",onChange:H})]}),k&&n.jsxs(Do,{onClick:F,className:"px-2 py-1 rounded bg-input hover:bg-accent text-gray-300 hover:text-white text-xs font-semibold flex items-center gap-1 transition-colors",tooltip:b("node.action.paste"),children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),b("node.action.paste")]})]})]})]})}):null},dn=({title:e,icon:t,onClick:o,disabled:r})=>{const[a,i]=v.useState(!1);return n.jsxs("div",{className:"relative flex items-center justify-center",onMouseEnter:()=>!r&&i(!0),onMouseLeave:()=>i(!1),children:[n.jsx("button",{onClick:s=>{s.stopPropagation(),r||o()},disabled:r,className:`group flex items-center justify-center p-2 text-sm rounded-md transition-colors ${r?"text-gray-600 cursor-not-allowed":"text-gray-200 hover:bg-accent hover:text-white"}`,children:n.jsx("div",{className:`${r?"text-gray-600":"text-gray-400 group-hover:text-white"}`,children:t})}),n.jsx("div",{className:`absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-xs whitespace-nowrap rounded-md shadow-xl z-[70] pointer-events-none transition-opacity duration-200 ease-in-out ${a?"opacity-100":"opacity-0"}`,children:e})]})},zT=({isOpen:e,position:t,onClose:o,onAlign:r})=>{const{t:a}=St(),i=v.useRef(null),s=Ut(),[l,c]=v.useState({opacity:0,pointerEvents:"none",transform:"scale(0.95)",transition:"opacity 0.15s ease-out, transform 0.15s ease-out"});if(v.useEffect(()=>{const g=m=>{i.current&&!i.current.contains(m.target)&&o()};return e&&window.addEventListener("mousedown",g),()=>window.removeEventListener("mousedown",g)},[e,o]),v.useEffect(()=>{if(e){let g=t.x,m=t.y;const x=240,_=100;g+x>window.innerWidth&&(g=g-x),m+_>window.innerHeight&&(m=m-_),requestAnimationFrame(()=>{c({left:g,top:m,opacity:1,pointerEvents:"auto",transform:"scale(1)",transition:"opacity 0.15s ease-out, transform 0.15s ease-out"})})}else c(g=>({...g,opacity:0,pointerEvents:"none",transform:"scale(0.95)"}))},[e,t]),!e&&l.opacity===0)return null;let d=!1;s&&s.selectedNodeIds.length>0&&(d=s.selectedNodeIds.some(g=>{const m=s.nodes.find(x=>x.id===g);return m?Vl(m.type):!1}));const u=g=>{r(g),o()},p=()=>{s&&s.undoPosition&&s.undoPosition(s.nodes)},h=()=>{s&&s.redoPosition&&s.redoPosition(s.nodes)},w=()=>{s&&s.selectedNodeIds.length>0&&(s.copyNodeValue(s.selectedNodeIds[s.selectedNodeIds.length-1]),o())},k=()=>{s&&(s.handlePaste(),o())},b=()=>{s&&(s.selectedNodeIds.forEach(g=>s.handleToggleNodeCollapse(g)),o())},y=g=>{s&&s.handleDockNode&&(s.selectedNodeIds.forEach(m=>s.handleDockNode(m,g)),o())};return n.jsxs("div",{ref:i,className:"fixed z-[70] bg-gray-800 rounded-lg shadow-2xl p-1 flex flex-col space-y-1",style:l,onContextMenu:g=>g.preventDefault(),onMouseDown:g=>g.stopPropagation(),children:[n.jsxs("div",{className:"flex flex-row space-x-1",children:[n.jsxs("div",{className:"flex items-center space-x-1 pr-1 border-r border-gray-600 mr-1",children:[n.jsx(dn,{title:a("contextMenu.undoPosition"),onClick:p,disabled:!(s!=null&&s.canUndo),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),n.jsx(dn,{title:a("contextMenu.redoPosition"),onClick:h,disabled:!(s!=null&&s.canRedo),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"})})})]}),n.jsx(dn,{title:a("contextMenu.align.left"),onClick:()=>u("left"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"4",width:"6",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"8",width:"8",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"12",width:"4",height:"2",fill:"currentColor",rx:"1"})]})}),n.jsx(dn,{title:a("contextMenu.align.centerX"),onClick:()=>u("center-x"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"7",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1",opacity:"0.5"}),n.jsx("rect",{x:"3",y:"4",width:"10",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"8",width:"6",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"2",y:"12",width:"12",height:"2",fill:"currentColor",rx:"1"})]})}),n.jsx(dn,{title:a("contextMenu.align.right"),onClick:()=>u("right"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"12",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"4",width:"6",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"3",y:"8",width:"8",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"7",y:"12",width:"4",height:"2",fill:"currentColor",rx:"1"})]})}),n.jsx("div",{className:"w-px bg-gray-600 my-1 mx-1"}),n.jsx(dn,{title:a("contextMenu.align.top"),onClick:()=>u("top"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"4",y:"5",width:"2",height:"6",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"8",y:"5",width:"2",height:"8",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"5",width:"2",height:"4",fill:"currentColor",rx:"1"})]})}),n.jsx(dn,{title:a("contextMenu.align.centerY"),onClick:()=>u("center-y"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"7",width:"12",height:"2",fill:"currentColor",rx:"1",opacity:"0.5"}),n.jsx("rect",{x:"4",y:"3",width:"2",height:"10",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"8",y:"5",width:"2",height:"6",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"})]})}),n.jsx(dn,{title:a("contextMenu.align.bottom"),onClick:()=>u("bottom"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"12",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"4",y:"5",width:"2",height:"6",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"8",y:"3",width:"2",height:"8",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"7",width:"2",height:"4",fill:"currentColor",rx:"1"})]})}),n.jsx("div",{className:"w-px bg-gray-600 my-1 mx-1"}),n.jsx(dn,{title:a("contextMenu.distribute.horizontal"),onClick:()=>u("distribute-horizontal"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"7",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"})]})}),n.jsx(dn,{title:a("contextMenu.distribute.vertical"),onClick:()=>u("distribute-vertical"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"2",y:"7",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"2",y:"12",width:"12",height:"2",fill:"currentColor",rx:"1"})]})})]}),n.jsx("div",{className:"h-px bg-gray-600 w-full my-1"}),n.jsxs("div",{className:"flex flex-row space-x-1 justify-center",children:[n.jsx(dn,{title:a("node.action.copy"),onClick:w,icon:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(dn,{title:a("node.action.paste"),onClick:k,icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),n.jsx(dn,{title:"Toggle Collapse",onClick:b,icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"w-px bg-gray-600 my-1 mx-1"}),!d&&n.jsxs(n.Fragment,{children:[n.jsx(dn,{title:a("toolbar.dock.q1"),onClick:()=>y("q1"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"1",y:"2",width:"3",height:"12",fill:"currentColor",opacity:"0.8"}),n.jsx("rect",{x:"0.5",y:"1.5",width:"15",height:"13",rx:"1.5",stroke:"currentColor",strokeOpacity:"0.3"})]})}),n.jsx(dn,{title:a("toolbar.dock.q2"),onClick:()=>y("q2"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"4.5",y:"2",width:"3",height:"12",fill:"currentColor",opacity:"0.8"}),n.jsx("rect",{x:"0.5",y:"1.5",width:"15",height:"13",rx:"1.5",stroke:"currentColor",strokeOpacity:"0.3"})]})})]}),n.jsx(dn,{title:a("toolbar.dock.left"),onClick:()=>y("left"),icon:n.jsx(Q1,{className:"h-4 w-4"})}),n.jsx(dn,{title:a("toolbar.dock.right"),onClick:()=>y("right"),icon:n.jsx(ey,{className:"h-4 w-4"})}),!d&&n.jsxs(n.Fragment,{children:[n.jsx(dn,{title:a("toolbar.dock.q3"),onClick:()=>y("q3"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"8.5",y:"2",width:"3",height:"12",fill:"currentColor",opacity:"0.8"}),n.jsx("rect",{x:"0.5",y:"1.5",width:"15",height:"13",rx:"1.5",stroke:"currentColor",strokeOpacity:"0.3"})]})}),n.jsx(dn,{title:a("toolbar.dock.q4"),onClick:()=>y("q4"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"12",y:"2",width:"3",height:"12",fill:"currentColor",opacity:"0.8"}),n.jsx("rect",{x:"0.5",y:"1.5",width:"15",height:"13",rx:"1.5",stroke:"currentColor",strokeOpacity:"0.3"})]})})]})]})]})},qT=({isOpen:e,info:t,onClose:o,onSelect:r})=>{const{t:a}=St(),i=v.useRef(null),[s,l]=v.useState({opacity:0,pointerEvents:"none"}),c=v.useMemo(()=>({text:[{type:L.PROMPT_ANALYZER,title:a("toolbar.addPromptAnalyzer"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})},{type:L.PROMPT_PROCESSOR,title:a("toolbar.addPromptProcessor"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})},{type:L.VIDEO_PROMPT_PROCESSOR,title:a("toolbar.addVideoPromptProcessor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7l-2 4 4 2-4 2-2 4-2-4-4-2 4-2z"})]})},{type:L.TRANSLATOR,title:a("toolbar.addTranslator"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})},{type:L.IMAGE_OUTPUT,title:a("toolbar.addImageOutput"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})},{type:L.IMAGE_EDITOR,title:a("toolbar.addImageEditor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-6 w-6",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]})},{type:L.REROUTE_DOT,title:a("node.title.reroute_dot"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})},{type:L.DATA_READER,title:a("toolbar.addDataReader"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}],image:[{type:L.IMAGE_ANALYZER,title:a("toolbar.addImageAnalyzer"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12.792V5.25a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 5.25v13.5A2.25 2.25 0 005.25 21h7.55"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 18.375L21 21"})]})},{type:L.IMAGE_EDITOR,title:a("toolbar.addImageEditor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-6 w-6",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]})},{type:L.REROUTE_DOT,title:a("node.title.reroute_dot"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})},{type:L.DATA_READER,title:a("toolbar.addDataReader"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}],video:[{type:L.VIDEO_EDITOR,title:a("node.title.video_editor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})]})},{type:L.REROUTE_DOT,title:a("node.title.reroute_dot"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})},{type:L.DATA_READER,title:a("toolbar.addDataReader"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}],audio:[{type:L.VIDEO_EDITOR,title:a("node.title.video_editor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})]})},{type:L.REROUTE_DOT,title:a("node.title.reroute_dot"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})},{type:L.DATA_READER,title:a("toolbar.addDataReader"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}],character_data:[{type:L.IMAGE_SEQUENCE_GENERATOR,title:a("toolbar.addImageSequenceGenerator"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})})},{type:L.REROUTE_DOT,title:a("node.title.reroute_dot"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})},{type:L.DATA_READER,title:a("toolbar.addDataReader"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}],prompt_sequence:[{type:L.IMAGE_SEQUENCE_GENERATOR,title:a("toolbar.addImageSequenceGenerator"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})})},{type:L.DATA_READER,title:a("toolbar.addDataReader"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})},{type:L.REROUTE_DOT,title:a("node.title.reroute_dot"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})}]}),[a]),d=v.useMemo(()=>t?t.sourceNodeType===L.PROMPT_SEQUENCE_EDITOR?c.prompt_sequence:(t.connectingInfo.fromType?c[t.connectingInfo.fromType]:[])||[]:[],[t,c]);return v.useEffect(()=>{const u=h=>{i.current&&!i.current.contains(h.target)&&o()},p=h=>{const w=parseInt(h.key);if(!isNaN(w)&&w>0&&w<=9){const k=w-1;d[k]&&(h.preventDefault(),h.stopPropagation(),r(d[k].type))}else h.key==="Escape"&&o()};return e&&(document.addEventListener("mousedown",u),window.addEventListener("keydown",p)),()=>{document.removeEventListener("mousedown",u),window.removeEventListener("keydown",p)}},[e,o,d,r]),v.useEffect(()=>{if(e&&i.current&&t){const{position:u}=t;if(d.length===0){o();return}const p=i.current.getBoundingClientRect();let h=u.x+10,w=u.y+10;h+p.width>window.innerWidth&&(h=u.x-p.width-10),w+p.height>window.innerHeight&&(w=u.y-p.height-10),l({left:Math.max(0,h),top:Math.max(0,w),position:"fixed",opacity:1,transition:"opacity 150ms ease-in-out"})}else e||l({opacity:0,pointerEvents:"none"})},[e,t,d,o]),n.jsx("div",{ref:i,className:"fixed bg-gray-800 rounded-lg shadow-2xl p-2 flex flex-col space-y-1 z-50",style:s,onMouseDown:u=>u.stopPropagation(),children:d.map((u,p)=>n.jsxs("button",{onClick:()=>r(u.type),className:"flex items-center space-x-3 p-2 rounded-md text-left w-full text-gray-200 hover:bg-accent hover:text-white transition-colors group",children:[n.jsxs("span",{className:"text-xs font-mono font-bold text-gray-500 group-hover:text-white w-4 text-right",children:[p+1,"."]}),n.jsx("div",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center",children:u.icon}),n.jsx("span",{className:"text-sm font-semibold",children:u.title})]},u.type))})},OT=({isOpen:e,initialValue:t,onConfirm:o,onClose:r,title:a,label:i,confirmButtonText:s,cancelButtonText:l,deselectAllNodes:c})=>{const{t:d}=St(),[u,p]=v.useState(t),h=v.useRef(null),[w,k]=v.useState(!1);v.useEffect(()=>{if(e)p(t),k(!0),setTimeout(()=>{var g,m;(g=h.current)==null||g.focus(),(m=h.current)==null||m.select()},100);else{const g=setTimeout(()=>k(!1),300);return()=>clearTimeout(g)}},[e,t]);const b=()=>{u.trim()&&o(u.trim()),r()},y=g=>{g.key==="Enter"?b():g.key==="Escape"&&r()};return!e&&!w?null:n.jsx("div",{className:`fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300 ease-in-out ${e?"opacity-100":"opacity-0"}`,onMouseDown:r,children:n.jsxs("div",{className:`bg-gray-800 border border-gray-700 rounded-xl shadow-2xl w-full max-w-sm flex flex-col select-none transform transition-all duration-300 ease-in-out ${e?"opacity-100 scale-100":"opacity-0 scale-95"}`,onMouseDown:g=>g.stopPropagation(),onKeyDown:y,children:[n.jsx("div",{className:"px-6 py-4 border-b border-gray-700 bg-[#18202f] rounded-t-xl",children:n.jsx("h2",{className:"text-lg font-bold text-accent-text",children:a||d("dialog.rename.title")})}),n.jsxs("div",{className:"p-6 space-y-4",children:[n.jsx("label",{htmlFor:"rename-input",className:"block text-sm font-medium text-gray-400",children:i||d("dialog.rename.label")}),n.jsx("input",{id:"rename-input",ref:h,type:"text",value:u,onChange:g=>p(g.target.value),onBlur:b,className:"w-full px-3 py-2 bg-gray-900 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent transition-colors",onFocus:c})]}),n.jsxs("div",{className:"px-6 py-4 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-900 rounded-b-xl",children:[n.jsx("button",{onClick:r,className:"px-4 py-2 font-semibold text-gray-400 bg-gray-800 hover:bg-gray-700 hover:text-white rounded-lg transition-colors border border-gray-600",children:l||d("dialog.rename.cancel")}),n.jsx("button",{onClick:b,className:"px-4 py-2 font-bold text-white bg-accent rounded-lg hover:bg-accent-hover transition-colors shadow-lg shadow-accent/20",children:s||d("dialog.rename.confirm")})]})]})})},FT=({isOpen:e,onAllow:t,onDecline:o})=>{const{t:r}=St(),[a,i]=v.useState(!1);return v.useEffect(()=>{if(e)i(!0);else{const s=setTimeout(()=>i(!1),300);return()=>clearTimeout(s)}},[e]),!e&&!a?null:n.jsx("div",{className:`fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300 ease-in-out ${e?"opacity-100":"opacity-0"}`,children:n.jsxs("div",{className:`bg-gray-800 border border-gray-700 rounded-xl shadow-2xl w-full max-w-md flex flex-col select-none transform transition-all duration-300 ease-in-out ${e?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:[n.jsx("div",{className:"px-6 py-4 border-b border-gray-700 bg-[#18202f] rounded-t-xl",children:n.jsx("h2",{className:"text-lg font-bold text-accent-text",children:r("dialog.permission.title")})}),n.jsx("div",{className:"p-6 space-y-4",children:n.jsx("p",{className:"text-sm text-gray-400 leading-relaxed",children:r("dialog.permission.description")})}),n.jsxs("div",{className:"px-6 py-4 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-900 rounded-b-xl",children:[n.jsx("button",{onClick:o,className:"px-4 py-2 font-semibold text-gray-400 bg-gray-800 hover:bg-gray-700 hover:text-white rounded-lg transition-colors border border-gray-600",children:r("dialog.permission.decline")}),n.jsx("button",{onClick:t,className:"px-4 py-2 font-bold text-white bg-accent rounded-lg hover:bg-accent-hover transition-colors shadow-lg shadow-accent/20",children:r("dialog.permission.allow")})]})]})})},BT=({isOpen:e,onConfirm:t,onClose:o,title:r,message:a})=>{const{t:i}=St(),[s,l]=v.useState(!1);v.useEffect(()=>{if(e)l(!0);else{const u=setTimeout(()=>l(!1),300);return()=>clearTimeout(u)}},[e]);const c=()=>{t(),o()},d=u=>{u.key==="Enter"?c():u.key==="Escape"&&o()};return!e&&!s?null:n.jsx("div",{className:`fixed inset-0 bg-black/60 z-[200] flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300 ease-in-out ${e?"opacity-100":"opacity-0"}`,onMouseDown:o,children:n.jsxs("div",{className:`bg-gray-800 border border-gray-700 rounded-xl shadow-2xl w-full max-w-sm flex flex-col select-none transform transition-all duration-300 ease-in-out ${e?"opacity-100 scale-100":"opacity-0 scale-95"}`,onMouseDown:u=>u.stopPropagation(),onKeyDown:d,children:[n.jsx("div",{className:"px-6 py-4 border-b border-gray-700 bg-[#18202f] rounded-t-xl",children:n.jsx("h2",{className:"text-lg font-bold text-accent-text",children:r})}),n.jsx("div",{className:"p-6 space-y-4",children:n.jsx("p",{className:"text-sm text-gray-400 leading-relaxed",children:a})}),n.jsxs("div",{className:"px-6 py-4 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-900 rounded-b-xl",children:[n.jsx("button",{onClick:o,className:"px-4 py-2 font-semibold text-gray-400 bg-gray-800 hover:bg-gray-700 hover:text-white rounded-lg transition-colors border border-gray-600",children:i("dialog.confirmDelete.cancel")}),n.jsx("button",{onClick:c,className:"px-4 py-2 font-bold text-white bg-accent rounded-lg hover:bg-accent-hover transition-colors shadow-lg shadow-accent/20",children:i("dialog.confirmDelete.confirm")})]})]})})},HT=({isOpen:e,initialName:t,initialContent:o,onConfirm:r,onClose:a,deselectAllNodes:i})=>{const{t:s}=St(),[l,c]=v.useState(t),[d,u]=v.useState(o),p=v.useRef(null),[h,w]=v.useState(!1);v.useEffect(()=>{if(e)c(t),u(o),w(!0),setTimeout(()=>{var y;return(y=p.current)==null?void 0:y.focus()},100);else{const y=setTimeout(()=>w(!1),300);return()=>clearTimeout(y)}},[e,t,o]);const k=()=>{l.trim()&&r(l.trim(),d)},b=y=>{y.key==="Escape"&&a()};return!e&&!h?null:n.jsx("div",{className:`fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300 ease-in-out ${e?"opacity-100":"opacity-0"}`,onMouseDown:a,children:n.jsxs("div",{className:`bg-gray-800 border border-gray-700 rounded-xl shadow-2xl w-full max-w-lg flex flex-col select-none transform transition-all duration-300 ease-in-out ${e?"opacity-100 scale-100":"opacity-0 scale-95"}`,onMouseDown:y=>y.stopPropagation(),onKeyDown:b,children:[n.jsx("div",{className:"px-6 py-4 border-b border-gray-700 bg-[#18202f] rounded-t-xl",children:n.jsx("h2",{className:"text-lg font-bold text-accent-text",children:s("dialog.promptEdit.title")})}),n.jsxs("div",{className:"p-6 space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"prompt-name-input",className:"block text-sm font-medium text-gray-400 mb-2",children:s("dialog.promptEdit.nameLabel")}),n.jsx("input",{id:"prompt-name-input",ref:p,type:"text",value:l,onChange:y=>c(y.target.value),className:"w-full px-3 py-2 bg-gray-900 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent transition-colors",onFocus:i})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"prompt-content-input",className:"block text-sm font-medium text-gray-400 mb-2",children:s("dialog.promptEdit.contentLabel")}),n.jsx("textarea",{id:"prompt-content-input",value:d,onChange:y=>u(y.target.value),className:"w-full h-40 px-3 py-2 bg-gray-900 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent resize-none custom-scrollbar",onWheel:y=>y.stopPropagation(),onFocus:i})]})]}),n.jsxs("div",{className:"px-6 py-4 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-900 rounded-b-xl",children:[n.jsx("button",{onClick:a,className:"px-4 py-2 font-semibold text-gray-400 bg-gray-800 hover:bg-gray-700 hover:text-white rounded-lg transition-colors border border-gray-600",children:s("dialog.promptEdit.cancel")}),n.jsx("button",{onClick:k,className:"px-4 py-2 font-bold text-white bg-accent rounded-lg hover:bg-accent-hover transition-colors shadow-lg shadow-accent/20",children:s("dialog.promptEdit.confirm")})]})]})})},Gn=({title:e,onClick:t,children:o,disabled:r=!1})=>{const[a,i]=v.useState(!1);return n.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>!r&&i(!0),onMouseLeave:()=>i(!1),children:[n.jsx("button",{onClick:t,onMouseDown:s=>s.stopPropagation(),"aria-label":e,disabled:r,className:"p-2 text-gray-300 rounded-full hover:bg-gray-600 hover:text-white transition-colors duration-150 focus:outline-none focus:ring-1 focus:ring-cyan-500 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent",children:o}),n.jsx("div",{className:`absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-lg shadow-xl z-50 transition-all duration-200 ease-out origin-bottom transform ${a?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,role:"tooltip",children:e})]})},Ar=({title:e,children:t})=>{const[o,r]=v.useState(!1);return n.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[t,n.jsx("div",{className:`absolute top-full left-1/2 -translate-x-1/2 mt-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-lg shadow-xl z-50 transition-all duration-200 ease-out origin-top transform ${o?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,role:"tooltip",children:e})]})},GT=({item:e,onAddToCanvas:t,onNavigate:o,onRename:r,onSave:a,onDelete:i,draggedItem:s,onDragStart:l,onDragEnd:c,onMoveItem:d,isDragOver:u,setIsDragOver:p})=>{const{t:h}=St(),w=e.type===yl.FOLDER,k=w?()=>o(e.id):()=>{},b=m=>{l(),e.type===yl.GROUP&&(m.dataTransfer.setData("application/prompt-modifier-drag-item",JSON.stringify({type:"catalog-group",itemId:e.id})),m.dataTransfer.effectAllowed="copyMove")},y=m=>{w&&s&&s.tab==="groups"&&s.id!==e.id&&(m.preventDefault(),p(!0))},g=m=>{w&&(m.preventDefault(),m.stopPropagation(),p(!1),d(e.id))};return n.jsxs("div",{draggable:!0,onDragStart:b,onDragEnd:c,onDragOver:y,onDragLeave:()=>p(!1),onDrop:g,className:`bg-gray-700 rounded-lg p-4 flex flex-col items-center justify-between space-y-3 border border-gray-600 hover:border-cyan-500 transition-all duration-200 transform hover:-translate-y-1 ${u?"ring-2 ring-cyan-400":""}`,children:[n.jsx("div",{className:"relative w-24 h-20 mx-auto mb-2 group",onClick:k,style:{cursor:w?"pointer":"default"},children:n.jsx("div",{className:`absolute w-full h-full ${w?"group-hover:scale-110":""} bg-gray-800 rounded-lg flex items-center justify-center shadow-lg transition-transform`,children:w?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})})}),n.jsx("p",{className:"font-semibold text-gray-100 text-center break-all w-full truncate",title:e.name,children:e.name}),n.jsxs("div",{className:"flex justify-center space-x-2 w-full pt-2 border-t border-gray-600/50",children:[!w&&n.jsx(Gn,{title:h("catalog.card.addToCanvas"),onClick:()=>t(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(Gn,{title:h("catalog.card.rename"),onClick:()=>r(e.id,e.name),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),n.jsx(Gn,{title:h("catalog.card.save"),onClick:()=>a(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Gn,{title:h("catalog.card.delete"),onClick:()=>i(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},UT=({item:e,onNavigate:t,onEdit:o,onRename:r,onSave:a,onDelete:i,draggedItem:s,onDragStart:l,onDragEnd:c,onMoveItem:d,isDragOver:u,setIsDragOver:p})=>{const{t:h}=St(),w=e.type===Vt.FOLDER,k=()=>{e.content&&navigator.clipboard.writeText(e.content).catch(x=>console.error("Copy failed",x))},b=w?()=>t(e.id):()=>o(e),y=x=>{l(),x.dataTransfer.setData("application/prompt-modifier-drag-item",JSON.stringify({type:e.type===Vt.FOLDER?"library-folder":"library-prompt",itemId:e.id})),x.dataTransfer.effectAllowed="copyMove"},g=x=>{w&&s&&s.tab==="library"&&s.id!==e.id&&(x.preventDefault(),p(!0))},m=x=>{w&&(x.preventDefault(),x.stopPropagation(),p(!1),d(e.id))};return n.jsxs("div",{draggable:!0,onDragStart:y,onDragEnd:c,onDragOver:g,onDragLeave:()=>p(!1),onDrop:m,className:`bg-gray-700 rounded-lg p-4 flex flex-col items-center justify-between space-y-3 border border-gray-600 hover:border-cyan-500 transition-all duration-200 transform hover:-translate-y-1 ${u?"ring-2 ring-cyan-400":""}`,children:[n.jsx("div",{className:"relative w-24 h-20 mx-auto mb-2 group",onClick:b,style:{cursor:"pointer"},children:n.jsx("div",{className:`absolute w-full h-full ${w?"group-hover:scale-110":""} bg-gray-800 rounded-lg flex items-center justify-center shadow-lg transition-transform`,children:w?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})}),n.jsxs("div",{className:"text-center w-full min-h-[4rem]",children:[n.jsx("p",{className:"font-semibold text-gray-100 break-all w-full truncate",title:e.name,children:e.name}),!w&&n.jsx("p",{className:"text-xs text-gray-400 mt-1 line-clamp-2",children:e.content||h("library.emptyPrompt")})]}),n.jsxs("div",{className:"flex justify-center space-x-2 w-full pt-2 border-t border-gray-600/50",children:[!w&&n.jsx(Gn,{title:h("library.actions.copy"),onClick:k,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),w&&n.jsx(Gn,{title:h("catalog.card.rename"),onClick:()=>r(e.id,e.name),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),n.jsx(Gn,{title:h("catalog.card.save"),onClick:()=>a(e),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Gn,{title:h("catalog.card.delete"),onClick:()=>i(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},VT=({item:e,dragItemType:t,onNavigate:o,onRename:r,onSave:a,onDelete:i,draggedItem:s,onDragStart:l,onDragEnd:c,onMoveItem:d,isDragOver:u,setIsDragOver:p,t:h})=>{const w=e.type===kp.FOLDER,k=w?()=>o(e.id):()=>{},b=v.useMemo(()=>{if(!w&&e.content)try{const _=JSON.parse(e.content);if(_.image&&typeof _.image=="string"&&_.image.startsWith("data:"))return _.image;if(_.imageBase64&&typeof _.imageBase64=="string")return`data:image/png;base64,${_.imageBase64}`;if(_.imageSources&&_.imageSources["1:1"])return _.imageSources["1:1"]}catch{}return null},[e.content,w]),y=_=>{l();const S={itemId:e.id,type:w?"content-catalog-folder":"content-catalog-item",itemType:t,content:e.content};_.dataTransfer.setData("application/prompt-modifier-drag-item",JSON.stringify(S)),_.dataTransfer.effectAllowed="copyMove"},g=_=>{w&&s&&s.tab===t&&s.id!==e.id&&(_.preventDefault(),p(!0))},m=_=>{w&&(_.preventDefault(),_.stopPropagation(),p(!1),d(e.id))},x=v.useMemo(()=>{if(w)return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})});if(b)return n.jsx("img",{src:b,alt:e.name,className:"w-full h-full object-cover rounded"});switch(t){case"CHARACTER":return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 3h15a1.5 1.5 0 011.5 1.5v15a1.5 1.5 0 01-1.5 1.5h-15a1.5 1.5 0 01-1.5-1.5v-15A1.5 1.5 0 014.5 3z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 17.25h7.5a6 6 0 00-7.5 0z"})]});case"SCRIPT":return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})});case"PROMPT_SEQUENCE":return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})});default:return null}},[w,t,b]);return n.jsxs("div",{draggable:!0,onDragStart:y,onDragEnd:c,onDragOver:g,onDragLeave:()=>p(!1),onDrop:m,className:`bg-gray-700 rounded-lg p-4 flex flex-col items-center justify-between space-y-3 border border-gray-600 hover:border-cyan-500 transition-all duration-200 transform hover:-translate-y-1 ${u?"ring-2 ring-cyan-400":""}`,children:[n.jsx("div",{className:"relative w-24 h-20 mx-auto mb-2 group",onClick:k,style:{cursor:w?"pointer":"default"},children:n.jsx("div",{className:`absolute w-full h-full ${w?"group-hover:scale-110":""} bg-gray-800 rounded-lg flex items-center justify-center shadow-lg transition-transform overflow-hidden`,children:x})}),n.jsx("p",{className:"font-semibold text-gray-100 text-center break-all w-full truncate",title:e.name,children:e.name}),n.jsxs("div",{className:"flex justify-center space-x-2 w-full pt-2 border-t border-gray-600/50",children:[n.jsx(Gn,{title:h("catalog.card.rename"),onClick:()=>r(e.id,e.name),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),n.jsx(Gn,{title:h("catalog.card.save"),onClick:()=>a(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Gn,{title:h("catalog.card.delete"),onClick:()=>i(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},ld=({catalog:e,draggedItem:t,setDraggedItem:o,dragOverTarget:r,setDragOverTarget:a,dragItemType:i,onRenameItem:s,t:l})=>n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"p-3 border-b border-gray-700 flex items-center justify-between space-x-2 flex-shrink-0",children:[n.jsxs("div",{className:"flex items-center space-x-1 min-w-0",children:[n.jsx("div",{className:`rounded-full transition-colors ${r===`back-${i}`?"ring-2 ring-cyan-500 ring-offset-2 ring-offset-gray-800":""}`,onDragOver:c=>{(t==null?void 0:t.tab)===i&&e.path.length>1&&(c.preventDefault(),a(`back-${i}`))},onDragLeave:()=>a(null),onDrop:c=>{if(c.preventDefault(),c.stopPropagation(),a(null),!t||t.tab!==i||e.path.length<=1)return;const d=e.path[e.path.length-2].id;e.moveItem(t.id,d)},children:n.jsx(Gn,{title:l("catalog.back"),onClick:e.navigateBack,disabled:e.path.length<=1,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})})}),n.jsx("div",{className:"flex items-center text-sm text-gray-400 truncate",children:e.path.map((c,d)=>n.jsxs(jt.Fragment,{children:[n.jsx("span",{onClick:()=>e.navigateToFolder(c.id),className:"px-1 hover:text-white cursor-pointer truncate",children:c.name}),d<e.path.length-1&&n.jsx("span",{className:"px-1 select-none",children:"/"})]},c.id||"root"))})]}),n.jsxs("div",{className:"flex space-x-2 flex-shrink-0",children:[n.jsx(Ar,{title:l("catalog.load"),children:n.jsxs("button",{onClick:e.triggerLoadFromFile,className:"px-3 py-2 text-sm font-semibold bg-teal-600 hover:bg-teal-700 rounded-md flex items-center space-x-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})}),n.jsx("span",{children:l("library.loadFromFile")})]})}),n.jsx(Ar,{title:l("catalog.newFolder"),children:n.jsxs("button",{onClick:()=>e.createItem(kp.FOLDER,l("library.actions.newFolder")),className:"px-3 py-2 text-sm font-semibold bg-gray-600 hover:bg-gray-500 rounded-md flex items-center space-x-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),n.jsx("span",{children:l("library.actions.newFolder")})]})})]})]}),n.jsx("div",{className:"flex-grow overflow-y-auto p-4",children:e.currentItems.length>0?n.jsx("div",{className:"grid grid-cols-3 gap-4",children:e.currentItems.map(c=>n.jsx(VT,{item:c,dragItemType:i,onNavigate:e.navigateToFolder,onRename:s,onSave:e.saveItemToDisk,onDelete:e.deleteItem,draggedItem:t,onDragStart:()=>o({id:c.id,tab:i}),onDragEnd:()=>{o(null),a(null)},onMoveItem:d=>e.moveItem(t.id,d),isDragOver:r===c.id,setIsDragOver:d=>a(d?c.id:null),t:l},c.id))}):n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),n.jsx("p",{className:"font-semibold",children:l("library.empty.title")}),n.jsx("p",{className:"text-sm",children:l("catalog.empty.description")})]})})]}),WT=e=>{const{isOpen:t,onClose:o,currentCatalogItems:r,catalogPath:a,onCatalogNavigateBack:i,onCatalogNavigateToFolder:s,onCreateCatalogFolder:l,onAddGroupFromCatalog:c,onRenameCatalogItem:d,onSaveCatalogItem:u,onDeleteCatalogItem:p,onLoadCatalogItemFromFile:h,onMoveCatalogItem:w,libraryItems:k,libraryPath:b,onNavigateBack:y,onNavigateToFolder:g,onCreateLibraryItem:m,onEditLibraryItem:x,onRenameLibraryItem:_,onDeleteLibraryItem:S,onSaveLibraryItem:P,onLoadLibraryItemFromFile:j,onMoveLibraryItem:M,onRenameCharacter:D,onRenameScript:O,onRenameSequence:B}=e,{t:E}=St(),[I,N]=v.useState("groups"),[T,F]=v.useState(null),[z,G]=v.useState(null);if(!t)return null;const U=()=>{F(null),G(null)},R=()=>n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"p-3 border-b border-gray-700 flex items-center justify-between space-x-2 flex-shrink-0",children:[n.jsxs("div",{className:"flex items-center space-x-1 min-w-0",children:[n.jsx("div",{className:`rounded-full transition-colors ${z==="back-groups"?"ring-2 ring-cyan-500 ring-offset-2 ring-offset-gray-800":""}`,onDragOver:H=>{(T==null?void 0:T.tab)==="groups"&&a.length>1&&(H.preventDefault(),G("back-groups"))},onDragLeave:()=>G(null),onDrop:H=>{if(H.preventDefault(),H.stopPropagation(),G(null),!T||T.tab!=="groups"||a.length<=1)return;const ne=a[a.length-2].id;w(T.id,ne)},children:n.jsx(Gn,{title:E("catalog.back"),onClick:i,disabled:a.length<=1,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})})}),n.jsx("div",{className:"flex items-center text-sm text-gray-400 truncate",children:a.map((H,ne)=>n.jsxs(jt.Fragment,{children:[n.jsx("span",{onClick:()=>s(H.id),className:"px-1 hover:text-white cursor-pointer truncate",children:H.name}),ne<a.length-1&&n.jsx("span",{className:"px-1 select-none",children:"/"})]},H.id||"root"))})]}),n.jsxs("div",{className:"flex space-x-2 flex-shrink-0",children:[n.jsx(Ar,{title:E("catalog.load"),children:n.jsxs("button",{onClick:h,className:"px-3 py-2 text-sm font-semibold bg-teal-600 hover:bg-teal-700 rounded-md flex items-center space-x-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})}),n.jsx("span",{children:E("library.loadFromFile")})]})}),n.jsx(Ar,{title:E("catalog.newFolder"),children:n.jsxs("button",{onClick:l,className:"px-3 py-2 text-sm font-semibold bg-gray-600 hover:bg-gray-500 rounded-md flex items-center space-x-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),n.jsx("span",{children:E("library.actions.newFolder")})]})})]})]}),n.jsx("div",{className:"flex-grow overflow-y-auto p-4",children:r.length>0?n.jsx("div",{className:"grid grid-cols-3 gap-4",children:r.map(H=>n.jsx(GT,{item:H,onAddToCanvas:c,onNavigate:ne=>s(ne),onRename:d,onSave:u,onDelete:p,draggedItem:T,onDragStart:()=>F({id:H.id,tab:"groups"}),onDragEnd:U,onMoveItem:ne=>w(T.id,ne),isDragOver:z===H.id,setIsDragOver:ne=>G(ne?H.id:null)},H.id))}):n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),n.jsx("p",{className:"font-semibold",children:E("library.empty.title")}),n.jsx("p",{className:"text-sm",children:E("catalog.empty.description")})]})})]}),q=()=>n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"p-3 border-b border-gray-700 flex items-center justify-between space-x-2 flex-shrink-0",children:[n.jsxs("div",{className:"flex items-center space-x-1 min-w-0",children:[n.jsx("div",{className:`rounded-full transition-colors ${z==="back-library"?"ring-2 ring-cyan-500 ring-offset-2 ring-offset-gray-800":""}`,onDragOver:H=>{(T==null?void 0:T.tab)==="library"&&b.length>1&&(H.preventDefault(),G("back-library"))},onDragLeave:()=>G(null),onDrop:H=>{if(H.preventDefault(),H.stopPropagation(),G(null),!T||T.tab!=="library"||b.length<=1)return;const ne=b[b.length-2].id;M(T.id,ne)},children:n.jsx(Gn,{title:E("catalog.back"),onClick:y,disabled:b.length<=1,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})})}),n.jsx("div",{className:"flex items-center text-sm text-gray-400 truncate",children:b.map((H,ne)=>n.jsxs(jt.Fragment,{children:[n.jsx("span",{onClick:()=>g(H.id),className:"px-1 hover:text-white cursor-pointer truncate",children:H.name}),ne<b.length-1&&n.jsx("span",{className:"px-1 select-none",children:"/"})]},H.id||"root"))})]}),n.jsxs("div",{className:"flex space-x-2 flex-shrink-0",children:[n.jsx(Ar,{title:E("catalog.load"),children:n.jsxs("button",{onClick:j,className:"px-3 py-2 text-sm font-semibold bg-teal-600 hover:bg-teal-700 rounded-md flex items-center space-x-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})}),n.jsx("span",{children:E("library.loadFromFile")})]})}),n.jsx(Ar,{title:E("catalog.newFolder"),children:n.jsxs("button",{onClick:()=>m(Vt.FOLDER),className:"px-3 py-2 text-sm font-semibold bg-gray-600 hover:bg-gray-500 rounded-md flex items-center space-x-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),n.jsx("span",{children:E("library.actions.newFolder")})]})}),n.jsx(Ar,{title:E("library.actions.newPrompt"),children:n.jsxs("button",{onClick:()=>m(Vt.PROMPT),className:"px-3 py-2 text-sm font-semibold bg-cyan-600 hover:bg-cyan-700 rounded-md flex items-center space-x-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),n.jsx("span",{children:E("library.actions.newPrompt")})]})})]})]}),n.jsx("div",{className:"flex-grow overflow-y-auto p-4",children:k.length>0?n.jsx("div",{className:"grid grid-cols-3 gap-4",children:k.map(H=>n.jsx(UT,{item:H,onNavigate:g,onEdit:x,onRename:_,onSave:P,onDelete:S,draggedItem:T,onDragStart:()=>F({id:H.id,tab:"library"}),onDragEnd:U,onMoveItem:ne=>M(T.id,ne),isDragOver:z===H.id,setIsDragOver:ne=>G(ne?H.id:null)},H.id))}):n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),n.jsx("p",{className:"font-semibold",children:E("library.empty.title")}),n.jsx("p",{className:"text-sm",children:E("library.empty.description")})]})})]});return n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",children:n.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-2xl w-full max-w-4xl border border-gray-700 flex flex-col h-[80vh] pointer-events-auto",onMouseDown:H=>H.stopPropagation(),children:[n.jsxs("div",{className:"p-4 pb-0 border-b border-gray-700 flex justify-between items-center flex-shrink-0",children:[n.jsxs("div",{className:"flex items-end space-x-4",children:[n.jsx("button",{onClick:()=>N("groups"),className:`px-4 py-2 text-lg font-bold ${I==="groups"?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-white"}`,children:E("catalog.tabs.groups")}),n.jsx("button",{onClick:()=>N("library"),className:`px-4 py-2 text-lg font-bold ${I==="library"?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-white"}`,children:E("catalog.tabs.library")}),n.jsx("button",{onClick:()=>N("characters"),className:`px-4 py-2 text-lg font-bold ${I==="characters"?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-white"}`,children:E("catalog.tabs.characters")}),n.jsx("button",{onClick:()=>N("scripts"),className:`px-4 py-2 text-lg font-bold ${I==="scripts"?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-white"}`,children:E("catalog.tabs.scripts")}),n.jsx("button",{onClick:()=>N("sequences"),className:`px-4 py-2 text-lg font-bold ${I==="sequences"?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-white"}`,children:E("catalog.tabs.sequences")})]}),n.jsx("button",{onClick:o,className:"p-1 text-gray-400 rounded hover:bg-gray-600 hover:text-white",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),I==="groups"&&R(),I==="library"&&q(),I==="characters"&&n.jsx(ld,{catalog:e.characterCatalog,dragItemType:"CHARACTER",onRenameItem:D,t:E,draggedItem:T,setDraggedItem:F,dragOverTarget:z,setDragOverTarget:G}),I==="scripts"&&n.jsx(ld,{catalog:e.scriptCatalog,dragItemType:"SCRIPT",onRenameItem:O,t:E,draggedItem:T,setDraggedItem:F,dragOverTarget:z,setDragOverTarget:G}),I==="sequences"&&n.jsx(ld,{catalog:e.sequenceCatalog,dragItemType:"PROMPT_SEQUENCE",onRenameItem:B,t:E,draggedItem:T,setDraggedItem:F,dragOverTarget:z,setDragOverTarget:G})]})})},$T=({isOpen:e,onSelectKey:t,onClose:o})=>{const{t:r}=St(),[a,i]=v.useState(!1);return v.useEffect(()=>{if(e)i(!0);else{const s=setTimeout(()=>i(!1),300);return()=>clearTimeout(s)}},[e]),!e&&!a?null:n.jsx("div",{className:`fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300 ease-in-out ${e?"opacity-100":"opacity-0"}`,onMouseDown:o,children:n.jsxs("div",{className:`bg-gray-800 border border-gray-700 rounded-xl shadow-2xl w-full max-w-md flex flex-col select-none transform transition-all duration-300 ease-in-out ${e?"opacity-100 scale-100":"opacity-0 scale-95"}`,onMouseDown:s=>s.stopPropagation(),children:[n.jsx("div",{className:"px-6 py-4 border-b border-gray-700 bg-[#18202f] rounded-t-xl",children:n.jsx("h2",{className:"text-lg font-bold text-accent-text",children:r("dialog.apiKey.title")})}),n.jsxs("div",{className:"p-6 space-y-4",children:[n.jsx("p",{className:"text-sm text-gray-400 leading-relaxed",children:r("dialog.apiKey.description")}),n.jsx("a",{href:"https://ai.google.dev/gemini-api/docs/billing",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-accent-text hover:text-accent-hover underline",children:r("dialog.apiKey.billingLink")})]}),n.jsxs("div",{className:"px-6 py-4 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-900 rounded-b-xl",children:[n.jsx("button",{onClick:o,className:"px-4 py-2 font-semibold text-gray-400 bg-gray-800 hover:bg-gray-700 hover:text-white rounded-lg transition-colors border border-gray-600",children:r("dialog.rename.cancel")}),n.jsx("button",{onClick:t,className:"px-4 py-2 font-bold text-white bg-accent rounded-lg hover:bg-accent-hover transition-colors shadow-lg shadow-accent/20",children:r("dialog.apiKey.button")})]})]})})},KT=({position:e,onConfirm:t,onCancel:o,count:r=1})=>{const{t:a}=St(),i=v.useRef(null),[s,l]=v.useState(!1),[c,d]=v.useState(e),u=v.useRef(null),p=v.useRef(!1);v.useEffect(()=>{const b=Math.min(Math.max(0,e.x),window.innerWidth-220),y=Math.min(Math.max(0,e.y),window.innerHeight-150);d({x:b,y})},[]),v.useEffect(()=>{const b=g=>{g.code==="Space"||g.code==="Enter"?(g.preventDefault(),g.stopPropagation(),t(s)):g.code==="KeyX"?(g.preventDefault(),g.stopPropagation(),t(!0)):g.code==="Escape"&&(g.preventDefault(),g.stopPropagation(),o())},y=g=>{p.current||i.current&&!i.current.contains(g.target)&&o()};return window.addEventListener("keydown",b,!0),document.addEventListener("mousedown",y),()=>{window.removeEventListener("keydown",b,!0),document.removeEventListener("mousedown",y)}},[t,o,s]);const h=b=>{b.stopPropagation();const y=b.target;y.closest("button")||y.closest(".checkbox-container")||b.button===0&&(p.current=!0,u.current={x:b.clientX-c.x,y:b.clientY-c.y},window.addEventListener("mousemove",w),window.addEventListener("mouseup",k))},w=b=>{!p.current||!u.current||d({x:b.clientX-u.current.x,y:b.clientY-u.current.y})},k=()=>{p.current=!1,u.current=null,window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",k)};return n.jsxs("div",{ref:i,className:"fixed z-[100] bg-gray-800/95 backdrop-blur-md shadow-2xl rounded-xl p-4 flex flex-col items-center justify-center space-y-4 select-none animate-fade-in-up min-w-[220px] cursor-move border border-gray-700/50",style:{left:c.x,top:c.y},onMouseDown:h,children:[n.jsx("span",{className:"text-sm font-semibold text-gray-200 whitespace-nowrap mt-1 pointer-events-none",children:r>1?a("dialog.deleteNode.titlePlural"):a("dialog.deleteNode.title")}),n.jsxs("div",{className:"flex items-center justify-center space-x-3 w-full pb-1",children:[n.jsxs("button",{onClick:b=>{b.stopPropagation(),t(s)},className:"flex flex-row items-center space-x-2 group focus:outline-none px-5 py-2 rounded-lg bg-transparent hover:bg-gray-700 transition-all",title:a("dialog.deleteNode.confirmTooltip"),onMouseDown:b=>b.stopPropagation(),children:[n.jsx("div",{className:"text-cyan-400 group-hover:text-white transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),n.jsx("span",{className:"text-xs text-gray-200 group-hover:text-white transition-colors uppercase font-bold tracking-wider",children:a("dialog.deleteNode.confirm")})]}),n.jsxs("button",{onClick:b=>{b.stopPropagation(),o()},className:"flex flex-row items-center space-x-2 group focus:outline-none px-5 py-2 rounded-lg bg-transparent hover:bg-gray-700 transition-all",title:a("dialog.deleteNode.cancelTooltip"),onMouseDown:b=>b.stopPropagation(),children:[n.jsx("div",{className:"text-gray-400 group-hover:text-white transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),n.jsx("span",{className:"text-xs text-gray-400 group-hover:text-white transition-colors uppercase font-bold tracking-wider",children:a("dialog.deleteNode.cancel")})]})]}),n.jsxs("div",{className:"flex items-center space-x-2 pt-2 border-t border-gray-700/50 w-full justify-center cursor-pointer checkbox-container",onClick:b=>{b.stopPropagation(),l(!s)},onMouseDown:b=>b.stopPropagation(),children:[n.jsx("div",{className:`w-4 h-4 rounded flex items-center justify-center transition-all duration-200 border ${s?"bg-cyan-600 border-cyan-600":"bg-gray-700/50 border-gray-600 hover:border-gray-500"}`,children:n.jsx("svg",{className:`w-3 h-3 text-white transition-transform duration-200 ${s?"scale-100":"scale-0"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),n.jsxs("label",{className:"text-xs text-gray-400 select-none cursor-pointer hover:text-gray-300 transition-colors",children:[a("dialog.deleteNode.dontShowAgain")," ",n.jsx("span",{className:"text-gray-500 font-mono ml-1 opacity-50",children:"(X)"})]})]})]})},k0="settingsDialogPosition",JT=({isOpen:e,onClose:t,addToast:o,setIsInstantCloseEnabled:r,anchorPosition:a})=>{const{t:i}=St(),s=Ut(),[l,c]=v.useState(!1),[d,u]=v.useState({x:0,y:0}),p=v.useRef({x:0,y:0}),h=v.useRef(!1),w=v.useRef(d);if(v.useEffect(()=>{w.current=d},[d]),v.useEffect(()=>{if(e){c(!0);const K=localStorage.getItem(k0);if(K)try{const Z=JSON.parse(K);if(typeof Z.x=="number"&&typeof Z.y=="number"){u(Z);return}}catch{}if(a){let Q=a.x,ce=a.y+10;Q+512>window.innerWidth&&(Q=window.innerWidth-512-20),ce+600>window.innerHeight&&(ce=window.innerHeight-600-20),Q<20&&(Q=20),u({x:Q,y:ce})}else u({x:Math.max(0,window.innerWidth/2-256),y:Math.max(0,window.innerHeight/2-300)})}else{const K=setTimeout(()=>c(!1),200);return()=>clearTimeout(K)}},[e]),!s)return null;const{setNodeAnimationMode:k,nodeAnimationMode:b,googleClientId:y,setGoogleClientId:g,handleGoogleSignIn:m,isGoogleDriveReady:x,currentTheme:_,setTheme:S,setConfirmInfo:P,loadCanvasState:j,resetTabs:M,setIsHoverHighlightEnabled:D,isHoverHighlightEnabled:O,isConnectionAnimationEnabled:B,setIsConnectionAnimationEnabled:E,connectionOpacity:I,setConnectionOpacity:N}=s,[T,F]=v.useState(""),[z,G]=v.useState(""),[U,R]=v.useState(!0),[q,H]=v.useState(!1),[ne,X]=v.useState(!0),[re,de]=v.useState("pulse");v.useEffect(()=>{if(e){const K=localStorage.getItem("settings_userApiKey")||"",Z=localStorage.getItem("settings_useDevKey"),W=localStorage.getItem("settings_instantNodeClose"),Q=localStorage.getItem("settings_nodeAnimationMode"),ce=localStorage.getItem("settings_hoverHighlight"),fe=localStorage.getItem("settings_nodeAnimation");F(K),G(y||""),R(Z===null?!0:Z==="true"),H(W==="true"),X(ce===null?!0:ce==="true"),de(Q||(fe==="false"?"none":b||"pulse"))}},[e,b,y]);const ge=K=>{const Z=K.target.value;F(Z),Z&&U&&R(!1)},te=()=>{localStorage.setItem("settings_userApiKey",T),localStorage.setItem("settings_useDevKey",String(U)),localStorage.setItem("settings_instantNodeClose",String(q)),localStorage.setItem("settings_nodeAnimationMode",re),localStorage.setItem("settings_hoverHighlight",String(ne)),g&&g(z.trim()),r(q),k&&k(re),D&&D(ne),o(i("toast.apiKeySaved"),"success"),t()},le=()=>{P({title:i("dialog.reload.title"),message:i("dialog.reload.message"),onConfirm:()=>{j({nodes:[],connections:[],groups:[],viewTransform:{scale:1,translate:{x:0,y:0}},nodeIdCounter:1,fullSizeImageCache:{}}),M&&M("en"),setTimeout(()=>{window.location.reload()},100)}})},ee=K=>{const Z=K.target;Z.closest("button")||Z.closest("input")||(K.preventDefault(),K.stopPropagation(),h.current=!0,p.current={x:K.clientX-d.x,y:K.clientY-d.y},K.currentTarget.setPointerCapture(K.pointerId))},se=K=>{h.current&&(K.preventDefault(),K.stopPropagation(),u({x:K.clientX-p.current.x,y:K.clientY-p.current.y}))},ie=K=>{h.current=!1,K.currentTarget.releasePointerCapture(K.pointerId),localStorage.setItem(k0,JSON.stringify(w.current))};if(!e&&!l)return null;const oe=[{id:"cyan",color:"#06b6d4",label:"Cyan"},{id:"azure",color:"#0ea5e9",label:"Azure"},{id:"purple",color:"#9333ea",label:"Purple"},{id:"pink",color:"#ec4899",label:"Pink"},{id:"red",color:"#dc2626",label:"Red"},{id:"orange",color:"#f97316",label:"Orange"},{id:"lime",color:"#84cc16",label:"Lime"},{id:"emerald",color:"#10b981",label:"Emerald"},{id:"gray",color:"#71717a",label:"Gray"}],A={pulse:"pulse","blade-runner":"bladeRunner",none:"none"};return n.jsx("div",{className:`fixed inset-0 z-[100] pointer-events-none transition-opacity duration-200 ease-out ${l&&e?"opacity-100":"opacity-0"}`,children:n.jsxs("div",{className:"absolute bg-gray-800 rounded-xl shadow-2xl w-full max-w-lg flex flex-col cursor-default max-h-[90vh] overflow-hidden pointer-events-auto border border-gray-700 transition-transform duration-200 ease-out",style:{left:d.x,top:d.y,transform:l&&e?"scale(1)":"scale(0.95)"},onMouseDown:K=>K.stopPropagation(),children:[n.jsxs("div",{className:"px-6 py-4 flex justify-between items-center bg-[#18202f] cursor-move border-b border-gray-600",onPointerDown:ee,onPointerMove:se,onPointerUp:ie,children:[n.jsxs("h2",{className:"text-xl font-bold text-accent-text flex items-center gap-2 pointer-events-none",children:[n.jsx($1,{}),i("dialog.settings.title")]}),n.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors p-1 hover:bg-white/10 rounded-full",onPointerDown:K=>K.stopPropagation(),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),n.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto custom-scrollbar bg-gray-800",children:[n.jsx("p",{className:"text-sm text-gray-400 mb-2",children:i("dialog.settings.description")}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest border-b border-gray-700 pb-1 mb-2",children:i("settings.group.api")}),n.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg space-y-3",children:[n.jsxs("div",{className:"space-y-2 transition-opacity duration-200",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("label",{htmlFor:"apiKey",className:"block text-xs font-medium text-gray-400",children:i("dialog.settings.apiKeyLabel")}),n.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-xs text-cyan-400 hover:text-cyan-300 underline",children:i("dialog.settings.getKeyLink")})]}),n.jsx("input",{type:"password",id:"apiKey",value:T,onChange:ge,placeholder:U?"Using Free/Dev Key":"AIzaSy...",className:`w-full p-2.5 rounded-md text-sm border focus:ring-1 focus:ring-accent focus:border-accent focus:outline-none placeholder-gray-600 transition-colors
                        ${U?"bg-gray-800 border-gray-700 text-gray-500":"bg-gray-900 border-gray-600 text-white"}
                      `})]}),n.jsx("div",{className:"pt-1",children:n.jsx(Ot,{id:"useDevKey",checked:U,onChange:K=>{R(K)},label:i("dialog.settings.useDevKeyLabel"),className:"text-sm text-gray-400"})})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest border-b border-gray-700 pb-1 mb-2",children:i("settings.group.style")}),n.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400",children:i("settings.themeLabel")}),n.jsx("div",{className:"flex flex-wrap gap-3",children:oe.map(K=>n.jsx("button",{onClick:()=>S(K.id),className:`w-8 h-8 rounded-full border-2 transition-all flex items-center justify-center ${_===K.id?"border-white scale-110 shadow-md":"border-transparent hover:scale-105"}`,style:{backgroundColor:K.color},title:K.label,children:_===K.id&&n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white drop-shadow-md",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})},K.id))})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400",children:i("dialog.settings.animationModeLabel")}),n.jsx("div",{className:"flex bg-gray-800 rounded-md p-1 border border-gray-700",children:["pulse","blade-runner","none"].map(K=>n.jsx("button",{onClick:()=>de(K),className:`flex-1 py-1.5 text-xs font-medium rounded transition-colors ${re===K?"bg-gray-700 text-white shadow-sm":"text-gray-500 hover:text-gray-300"}`,children:i(`dialog.settings.anim.${A[K]||K}`)},K))})]}),n.jsxs("div",{className:"pt-1 flex flex-col gap-2",children:[n.jsx(Ot,{id:"instantNodeClose",checked:q,onChange:K=>H(K),label:i("dialog.settings.instantNodeCloseLabel"),className:"text-sm text-gray-400"}),n.jsx(Ot,{id:"hoverHighlight",checked:ne,onChange:K=>X(K),label:i("dialog.settings.hoverHighlightLabel"),className:"text-sm text-gray-400"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400",children:i("dialog.settings.connectionsLabel")}),n.jsxs("div",{className:"flex flex-col gap-2 p-2 bg-gray-800 rounded-md border border-gray-700",children:[n.jsx(Ot,{id:"connectionAnimation",checked:B,onChange:K=>E(K),label:i("dialog.settings.connectionAnimationLabel"),className:"text-sm text-gray-300"}),n.jsxs("div",{className:"space-y-1 pt-1",children:[n.jsxs("div",{className:"flex justify-between text-xs text-gray-400",children:[n.jsx("span",{children:i("dialog.settings.connectionOpacityLabel")}),n.jsxs("span",{children:[Math.round(I*100),"%"]})]}),n.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:I,onChange:K=>N(parseFloat(K.target.value)),className:"w-full h-1.5 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-accent"})]})]})]})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("div",{className:"flex justify-between items-end border-b border-gray-700 pb-1 mb-2",children:n.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest",children:i("settings.group.drive")})}),n.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{htmlFor:"googleClientId",className:"block text-xs font-medium text-gray-400",children:i("settings.googleClientIdLabel")}),n.jsx("input",{type:"text",id:"googleClientId",value:z,onChange:K=>G(K.target.value),placeholder:"Google Cloud Client ID",className:"w-full p-2.5 bg-gray-800 border border-gray-700 rounded-md text-white text-sm focus:ring-1 focus:ring-accent focus:border-accent focus:outline-none placeholder-gray-600"})]}),n.jsxs("button",{onClick:()=>m&&m(),disabled:!x,className:`w-full py-2 px-4 rounded-md text-sm font-bold text-white transition-all flex items-center justify-center gap-2 ${x?"bg-blue-600 hover:bg-blue-700 shadow-md shadow-blue-900/20":"bg-gray-700 text-gray-500 cursor-not-allowed"}`,title:x?"":"Enter Client ID and Save first",children:[n.jsx(nP,{className:"w-4 h-4"}),i("settings.signInWithGoogle")]})]})]})]}),n.jsxs("div",{className:"p-4 bg-gray-900 border-t border-gray-700 flex justify-between items-center",children:[n.jsxs("button",{onClick:le,className:"flex items-center gap-2 px-4 py-2 text-red-400 hover:text-red-300 hover:bg-red-900/30 rounded-lg transition-colors border border-transparent hover:border-red-900/50",title:i("dialog.settings.reload"),children:[n.jsx(K1,{}),n.jsx("span",{className:"text-sm font-bold",children:i("dialog.settings.reload")})]}),n.jsx("button",{onClick:te,className:"px-6 py-2 bg-accent hover:bg-accent-hover text-white font-bold rounded-lg transition-all shadow-lg shadow-accent/40 transform hover:-translate-y-0.5 active:translate-y-0",children:i("dialog.settings.save")})]})]})})},YT=({isOpen:e,message:t,onClose:o})=>{const{t:r}=St(),[a,i]=v.useState(!1),[s,l]=v.useState(!1);if(v.useEffect(()=>{if(e)l(!0),i(!1);else{const d=setTimeout(()=>l(!1),300);return()=>clearTimeout(d)}},[e]),v.useEffect(()=>{const d=u=>{u.key==="Escape"&&o()};return e&&window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[e,o]),!e&&!s)return null;const c=()=>{t&&(navigator.clipboard.writeText(t),i(!0),setTimeout(()=>i(!1),2e3))};return n.jsx("div",{className:`fixed top-20 left-1/2 -translate-x-1/2 z-[200] w-full max-w-lg px-4 pointer-events-none transition-all duration-300 ease-out transform ${e?"opacity-100 translate-y-0":"opacity-0 -translate-y-4"}`,children:n.jsxs("div",{className:"bg-[#20293c] bg-opacity-95 backdrop-blur-xl rounded-xl shadow-2xl flex flex-col pointer-events-auto overflow-hidden border border-gray-600/50",role:"alert",children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-black/20 border-b border-white/5 select-none",children:[n.jsxs("div",{className:"flex items-center space-x-2.5",children:[n.jsx("div",{className:"p-1.5 bg-accent/20 rounded-full text-accent-text",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("h2",{className:"text-sm font-bold text-accent-text tracking-wide",children:r("app.error.title")})]}),n.jsx("button",{onClick:o,className:"text-text-secondary hover:text-white transition-colors p-1 hover:bg-white/10 rounded-lg",title:"Close",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),n.jsx("div",{className:"p-5 max-h-[300px] overflow-y-auto custom-scrollbar",children:n.jsx("p",{className:"text-gray-300 text-sm whitespace-pre-wrap break-words leading-relaxed font-medium select-none",children:t})}),n.jsx("div",{className:"px-4 py-3 bg-black/20 border-t border-white/5 flex justify-end",children:n.jsx("button",{onClick:c,className:`px-4 py-2 text-xs font-bold rounded-lg transition-all duration-200 flex items-center gap-2 ${a?"bg-green-600/20 text-green-300":"bg-gray-700 hover:bg-gray-600 text-gray-300 hover:text-white"}`,children:a?n.jsxs(n.Fragment,{children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),r("app.error.copied")]}):n.jsxs(n.Fragment,{children:[n.jsx(Dt,{className:"h-3.5 w-3.5"}),r("app.error.copy")]})})})]})})},ZT=()=>{const e=Ut(),[t,o]=v.useState(!1),r=v.useRef(null);if(!e)return null;const{logs:a,isDebugConsoleOpen:i,setIsDebugConsoleOpen:s,clearLogs:l}=e;if(v.useEffect(()=>{i&&r.current&&(r.current.scrollTop=r.current.scrollHeight)},[a,i]),!i)return null;const c=d=>{const u=`[${new Date(d.timestamp).toLocaleTimeString()}] ${d.level.toUpperCase()}: ${d.message}
${d.details?JSON.stringify(d.details,null,2):""}`;navigator.clipboard.writeText(u)};return n.jsxs("div",{className:"fixed bottom-[60px] left-1/2 -translate-x-1/2 bg-gray-900 border border-gray-700 shadow-2xl rounded-t-lg flex flex-col z-[300] transition-all duration-300 w-full max-w-4xl",style:{height:t?"80vh":"300px"},children:[n.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-800 rounded-t-lg border-b border-gray-700 select-none cursor-pointer",onClick:()=>o(!t),children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"text-xs font-bold text-gray-300 uppercase tracking-widest flex items-center gap-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-accent-text",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"System Logs"]}),n.jsxs("span",{className:"text-[10px] bg-gray-700 px-1.5 rounded text-gray-400",children:[a.length," events"]})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{onClick:d=>{d.stopPropagation(),l()},className:"p-1 hover:bg-gray-700 rounded text-gray-400 hover:text-white",title:"Clear",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),n.jsx("button",{onClick:d=>{d.stopPropagation(),o(!t)},className:"p-1 hover:bg-gray-700 rounded text-gray-400 hover:text-white",title:t?"Collapse":"Expand",children:t?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),n.jsx("button",{onClick:d=>{d.stopPropagation(),s(!1)},className:"p-1 hover:bg-gray-700 rounded text-gray-400 hover:text-white",title:"Close",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),n.jsxs("div",{ref:r,className:"flex-grow overflow-y-auto p-2 font-mono text-xs bg-[#0d1117] custom-scrollbar space-y-1",children:[a.length===0&&n.jsx("div",{className:"text-gray-600 italic p-2 text-center",children:"No logs recorded."}),a.map(d=>n.jsxs("div",{className:`p-2 rounded border-l-2 ${d.level==="error"?"border-red-500 bg-red-900/10":d.level==="warning"?"border-yellow-500 bg-yellow-900/10":"border-blue-500 bg-blue-900/10"} hover:bg-gray-800/50 transition-colors group relative`,children:[n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsx("span",{className:"text-gray-500 shrink-0 mr-2",children:new Date(d.timestamp).toLocaleTimeString()}),n.jsxs("span",{className:`font-bold shrink-0 mr-2 ${d.level==="error"?"text-red-400":d.level==="warning"?"text-yellow-400":"text-blue-400"}`,children:["[",d.level.toUpperCase(),"]"]}),n.jsx("span",{className:"flex-grow text-gray-300 break-words whitespace-pre-wrap",children:d.message}),n.jsx("button",{onClick:()=>c(d),className:"opacity-0 group-hover:opacity-100 text-gray-500 hover:text-white transition-opacity ml-2",children:n.jsx(Dt,{className:"h-3 w-3"})})]}),d.details&&n.jsx("div",{className:"mt-1 ml-16 text-gray-400 bg-black/30 p-2 rounded overflow-x-auto",children:n.jsx("pre",{children:JSON.stringify(d.details,null,2)})})]},d.id))]})]})},XT=()=>{const e=Ut(),[t,o]=jt.useState(!1),[r,a]=jt.useState(null);if(jt.useEffect(()=>{const mt=dt=>{dt.detail&&a(dt.detail),o(!0)};return window.addEventListener("open-settings",mt),()=>window.removeEventListener("open-settings",mt)},[]),v.useEffect(()=>{(()=>{if(!localStorage.getItem("hasVisited"))return;const kt=localStorage.getItem("settings_useDevKey")==="true",Ct=localStorage.getItem("settings_userApiKey");!kt&&!Ct&&o(!0)})()},[]),!e)return null;const{isQuickSearchOpen:i,quickSearchPosition:s,handleCloseAddNodeMenus:l,onAddNode:c,getTransformedPoint:d,isQuickAddOpen:u,isQuickAddMenuPinned:p,quickAddPosition:h,effectiveTool:w,setActiveTool:k,toggleQuickAddMenuPin:b,isRadialMenuOpen:y,radialMenuPosition:g,setIsRadialMenuOpen:m,radialMenuSelectedItem:x,setRadialMenuSelectedItem:_,contextMenu:S,handleCloseContextMenu:P,quickSlots:j,updateQuickSlot:M,setAllQuickSlots:D,isContextMenuPinned:O,toggleContextMenuPin:B,viewTransform:E,handleZoomChange:I,scaleToSliderValue:N,sliderValueToScale:T,nodeContextMenu:F,handleCloseNodeContextMenu:z,handleAlignNodes:G,selectedNodeIds:U,isConnectionQuickAddOpen:R,connectionQuickAddInfo:q,handleCloseConnectionQuickAdd:H,handleAddNodeAndConnect:ne,nodeDeleteConfirm:X,deleteNodeAndConnections:re,setIsInstantCloseEnabled:de,cancelDeleteNodes:ge,renameInfo:te,confirmRename:le,setRenameInfo:ee,deselectAllNodes:se,t:ie,showDialog:oe,requestPermission:A,declinePermission:K,confirmInfo:Z,setConfirmInfo:W,promptEditInfo:Q,confirmPromptEdit:ce,setPromptEditInfo:fe,isCatalogOpen:$,handleCloseCatalog:V,currentCatalogItems:J,catalogPath:Y,navigateCatalogBack:ae,navigateCatalogToFolder:ue,createCatalogItem:he,handleAddGroupFromCatalog:ye,renameCatalogItem:ve,saveCatalogItemToDisk:me,deleteCatalogItem:_e,triggerLoadFromFile:pe,moveCatalogItem:xe,libraryItems:Se,currentLibraryItems:Le,libraryPath:Ee,navigateBack:Me,navigateToFolder:De,createLibraryItem:Te,setPromptEditInfo:Re,updateLibraryItem:we,deleteLibraryItem:Ce,saveLibraryItemToDisk:qe,triggerLoadLibraryFromFile:Be,moveLibraryItem:Ie,characterCatalog:We,scriptCatalog:at,sequenceCatalog:Jt,onRenameCharacter:Oe,onRenameScript:Ae,onRenameSequence:Ue,isApiKeyDialogOpen:ke,handleApiKeySelect:Ne,handleApiKeyDialogClose:He,addToast:Fe,handlePaste:$e,error:Ye,setError:st}=e,ht=mt=>{let dt=h;i&&(dt=s);const kt=d(dt);c(mt,kt),l()},ft=mt=>{const dt=d(g);c(mt,dt),m(!1),_(null)};return n.jsxs(n.Fragment,{children:[n.jsx(jT,{isOpen:i,position:s,onClose:l,onAddNode:mt=>{const dt=d(s);c(mt,dt),l()}}),n.jsx(IT,{isOpen:u||p,position:h,onClose:l,onAddNode:ht,onToolChange:k,activeTool:w,isPinned:p,onPinToggle:b,onPaste:$e}),n.jsx(RT,{isOpen:y,position:g,onClose:()=>m(!1),onAddNode:ft,onSelectItem:_}),n.jsx(DT,{isOpen:!!(S!=null&&S.isOpen),position:(S==null?void 0:S.position)||{x:0,y:0},onClose:P,onToolSelect:k,slots:j,onSlotUpdate:M,onSetSlots:D,onAddNode:mt=>{const dt=d((S==null?void 0:S.position)||{x:0,y:0});c(mt,dt)},isPinned:O,onPinToggle:B,zoom:E.scale,onZoomChange:I,scaleToSliderValue:N,sliderValueToScale:T,onPaste:$e}),n.jsx(zT,{isOpen:!!(F!=null&&F.isOpen),position:(F==null?void 0:F.position)||{x:0,y:0},onClose:z,onAlign:mt=>G(U,mt)}),n.jsx(qT,{isOpen:R,info:q,onClose:H,onSelect:ne}),X&&n.jsx(KT,{position:X.position,onConfirm:mt=>{X.nodeIds.forEach(dt=>re(dt)),mt&&(localStorage.setItem("settings_instantNodeClose","true"),de(!0)),ge()},onCancel:ge,count:X.nodeIds.length}),n.jsx(OT,{isOpen:!!te,initialValue:(te==null?void 0:te.currentTitle)||"",onConfirm:le,onClose:()=>ee(null),title:(te==null?void 0:te.type)==="group"?ie("dialog.rename.group.title"):(te==null?void 0:te.type)==="catalog"?ie("dialog.rename.catalog.title"):(te==null?void 0:te.type)==="node"?ie("dialog.rename.node.title"):ie("dialog.rename.title"),deselectAllNodes:se}),n.jsx(FT,{isOpen:oe,onAllow:A,onDecline:K}),n.jsx(BT,{isOpen:!!Z,title:(Z==null?void 0:Z.title)||"",message:(Z==null?void 0:Z.message)||"",onConfirm:(Z==null?void 0:Z.onConfirm)||(()=>{}),onClose:()=>W(null)}),n.jsx(YT,{isOpen:!!Ye,message:Ye,onClose:()=>st(null)}),n.jsx(ZT,{}),n.jsx(HT,{isOpen:!!Q,initialName:(Q==null?void 0:Q.name)||"",initialContent:(Q==null?void 0:Q.content)||"",onConfirm:ce,onClose:()=>fe(null),deselectAllNodes:se}),n.jsx(WT,{isOpen:$,onClose:V,currentCatalogItems:J,catalogPath:Y,onCatalogNavigateBack:ae,onCatalogNavigateToFolder:ue,onCreateCatalogFolder:()=>he(yl.FOLDER),onAddGroupFromCatalog:mt=>ye(mt),onRenameCatalogItem:(mt,dt)=>ee({type:"catalog",id:mt,currentTitle:dt}),onSaveCatalogItem:me,onDeleteCatalogItem:_e,onLoadCatalogItemFromFile:pe,onMoveCatalogItem:xe,libraryItems:Le,libraryPath:Ee,onNavigateBack:Me,onNavigateToFolder:De,onCreateLibraryItem:Te,onEditLibraryItem:fe,onRenameLibraryItem:(mt,dt)=>ee({type:"library",id:mt,currentTitle:dt}),onDeleteLibraryItem:Ce,onSaveLibraryItem:qe,onLoadLibraryItemFromFile:Be,onMoveLibraryItem:Ie,characterCatalog:We,scriptCatalog:at,sequenceCatalog:Jt,onRenameCharacter:(mt,dt)=>ee({type:"character",id:mt,currentTitle:dt}),onRenameScript:(mt,dt)=>ee({type:"script",id:mt,currentTitle:dt}),onRenameSequence:(mt,dt)=>ee({type:"sequence",id:mt,currentTitle:dt})}),n.jsx($T,{isOpen:ke,onSelectKey:Ne,onClose:He}),n.jsx(JT,{isOpen:t,onClose:()=>o(!1),addToast:Fe,setIsInstantCloseEnabled:de,anchorPosition:r})]})},QT=()=>{const[e,t]=v.useState(0),o=v.useRef(0),r=v.useRef(performance.now()),a=v.useRef(0);return v.useEffect(()=>{const i=()=>{const s=performance.now();o.current++,s>=r.current+1e3&&(t(o.current),o.current=0,r.current=s),a.current=requestAnimationFrame(i)};return a.current=requestAnimationFrame(i),()=>{cancelAnimationFrame(a.current)}},[]),e},eI=e=>{const t=Math.floor(e/1e3),o=Math.floor(e%1e3/10);return`${t}.${o.toString().padStart(2,"0")}s`},tI=()=>{const e=Ut(),t=QT(),[o,r]=v.useState(!1),{language:a}=St(),[i,s]=v.useState(0),[l,c]=v.useState(0),d=v.useRef(null),u=v.useRef(null),[p,h]=v.useState(null),[w,k]=v.useState(!1),b=v.useRef(!1);if(!e)return null;const{activeOperations:y,t:g,tutorialStep:m,skipTutorial:x,advanceTutorial:_,nextAutoSaveTime:S,isAutoSaving:P,logs:j,isDebugConsoleOpen:M,setIsDebugConsoleOpen:D}=e,O=Array.from(y.values()),B=O.length>0?O[O.length-1]:null,E=O.length>0,I=j.filter(F=>F.level==="error").length,N=m==="image_output_generating";v.useEffect(()=>{if(E){d.current===null&&(d.current=performance.now(),s(0));const F=()=>{d.current!==null&&(s(performance.now()-d.current),u.current=requestAnimationFrame(F))};u.current=requestAnimationFrame(F)}else{if(d.current!==null){const F=performance.now()-d.current;c(F),s(0),d.current=null}u.current&&(cancelAnimationFrame(u.current),u.current=null)}return()=>{u.current&&cancelAnimationFrame(u.current)}},[E]),v.useEffect(()=>{if(!S){h(null);return}const F=setInterval(()=>{const z=Date.now(),G=S-z;G>0&&G<=1e4?h(Math.ceil(G/1e3)):h(null)},200);return()=>clearInterval(F)},[S]),v.useEffect(()=>{if(b.current&&!P){k(!0);const F=setTimeout(()=>k(!1),2e3);return()=>clearTimeout(F)}b.current=P},[P]);const T=E?i:l;return n.jsx("div",{className:"fixed top-2 right-2 z-50 flex flex-col items-end pointer-events-none select-none",children:n.jsx(Fn,{content:g("tutorial.step3b"),isActive:!!N,position:"bottom",onSkip:x,onNext:_,children:n.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-md rounded-lg shadow-lg border border-gray-700 p-1 flex items-center space-x-2 pointer-events-auto transition-all duration-300",children:[!o&&n.jsxs(n.Fragment,{children:[n.jsx(ut,{content:"Debug Console",position:"bottom",children:n.jsxs("button",{onClick:()=>D(!M),className:`p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center relative ${M?"text-accent-text bg-gray-800":"text-gray-400 hover:text-white hover:bg-gray-800"}`,children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),I>0&&!M&&n.jsxs("span",{className:"absolute top-1 right-1 flex h-2 w-2",children:[n.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),n.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-red-500"})]})]})}),n.jsx("div",{className:"w-px h-8 bg-gray-700 mx-1"}),n.jsx("div",{className:"flex items-center space-x-3 px-2 min-w-[140px]",children:B?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"relative flex h-3 w-3 flex-shrink-0",children:[n.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-accent opacity-75"}),n.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-accent"})]}),n.jsxs("div",{className:"flex flex-col leading-tight min-w-0",children:[n.jsx("span",{className:"text-[10px] font-bold text-accent-text uppercase tracking-wider truncate",children:"Processing"}),n.jsx("span",{className:"text-xs text-gray-300 whitespace-nowrap truncate max-w-[150px]",title:B.description,children:B.description})]})]}):P?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"relative flex h-3.5 w-3.5 flex-shrink-0 text-accent-text animate-pulse",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-full h-full",children:n.jsx("path",{fillRule:"evenodd",d:"M19.5 21a3 3 0 003-3V9a3 3 0 00-3-3h-5.379a.75.75 0 01-.53-.22L11.47 3.66A2.25 2.25 0 009.879 3H4.5a3 3 0 00-3 3v12a3 3 0 003 3h15zm-6.75-10.5a.75.75 0 00-1.5 0v4.19l-1.72-1.72a.75.75 0 00-1.06 1.06l3 3a.75.75 0 001.06 0l3-3a.75.75 0 10-1.06-1.06l-1.72 1.72V10.5z",clipRule:"evenodd"})})}),n.jsxs("div",{className:"flex flex-col leading-tight",children:[n.jsx("span",{className:"text-[10px] font-bold text-accent-text uppercase tracking-wider",children:"System"}),n.jsx("span",{className:"text-xs text-accent-text",children:"Saving..."})]})]}):w?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"relative flex h-3.5 w-3.5 flex-shrink-0 text-accent-text",children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-full h-full",children:[n.jsx("path",{d:"M11.47 3.84a.75.75 0 011.06 0l8.635 8.635a.75.75 0 11-1.06 1.06l-8.635-8.635a.75.75 0 010-1.06z"}),n.jsx("path",{d:"M19.5 21a3 3 0 003-3V9a3 3 0 00-3-3h-5.379a.75.75 0 01-.53-.22L11.47 3.66A2.25 2.25 0 009.879 3H4.5a3 3 0 00-3 3v12a3 3 0 003 3h15z",opacity:"0.5"}),n.jsx("path",{fillRule:"evenodd",d:"M19.916 4.626a.75.75 0 01.208 1.04l-9 13.5a.75.75 0 01-1.154.114l-6-6a.75.75 0 011.06-1.06l5.353 5.353 8.493-12.739a.75.75 0 011.04-.208z",clipRule:"evenodd"})]})}),n.jsxs("div",{className:"flex flex-col leading-tight",children:[n.jsx("span",{className:"text-[10px] font-bold text-accent-text uppercase tracking-wider",children:"System"}),n.jsx("span",{className:"text-xs text-white",children:"Saved"})]})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"h-2.5 w-2.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)] flex-shrink-0"}),n.jsxs("div",{className:"flex flex-col leading-tight",children:[n.jsx("span",{className:"text-[10px] font-bold text-emerald-400 uppercase tracking-wider",children:"System"}),n.jsx("span",{className:"text-xs text-gray-300",children:p!==null?`Saving in ${p}s...`:"Ready"})]})]})}),n.jsx("div",{className:"w-px h-8 bg-gray-700 mx-1"}),n.jsxs("div",{className:"flex flex-col items-center justify-center px-2 min-w-[60px]",children:[n.jsx("span",{className:`text-lg font-bold font-mono leading-none ${E?"text-accent-text":"text-gray-400"}`,children:eI(T)}),n.jsx("span",{className:"text-[10px] font-medium text-gray-500 uppercase tracking-wider leading-none mt-0.5",children:"Time"})]}),n.jsx("div",{className:"w-px h-8 bg-gray-700 mx-1"}),n.jsxs("div",{className:"flex flex-col items-center justify-center px-2 min-w-[50px]",children:[n.jsx("span",{className:"text-lg font-bold text-accent-text font-mono leading-none",children:t}),n.jsx("span",{className:"text-[10px] font-medium text-gray-500 uppercase tracking-wider leading-none mt-0.5",children:"FPS"})]})]}),n.jsx(ut,{content:g(o?"toolbar.expandPanel":"toolbar.collapsePanel"),position:"bottom",children:n.jsx("button",{onClick:()=>r(!o),className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300 ml-1","aria-label":o?"Expand Panel":"Collapse Panel",children:o?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})})]})})})},nI=(e,t=2)=>{if(e===0)return"0 Bytes";const o=1024,r=t<0?0:t,a=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(o));return parseFloat((e/Math.pow(o,i)).toFixed(r))+" "+a[i]},cd="imageViewerPosition",dd="imageViewerSize",oI=({sources:e,initialIndex:t,initialPosition:o,onClose:r,onDownloadImageFromUrl:a,onCopyImageToClipboard:i,onOpenInEditor:s,addToast:l})=>{const{t:c}=St(),[d,u]=v.useState(El()),[p,h]=v.useState(!1),[w,k]=v.useState(()=>{try{const K=localStorage.getItem(cd);if(K){const Z=JSON.parse(K);if(typeof Z.x=="number"&&typeof Z.y=="number")return Z}}catch(K){console.error("Failed to load ImageViewer position",K)}return o}),[b,y]=v.useState(()=>{try{const K=localStorage.getItem(dd);if(K){const Z=JSON.parse(K);if(Z.width&&Z.height)return Z}}catch(K){console.error("Failed to load ImageViewer size",K)}return{width:"80vw",height:"80vh"}}),[g,m]=v.useState(!1),x=v.useRef(w);v.useEffect(()=>{x.current=w},[w]);const[_,S]=v.useState(t),P=v.useRef(null),j=v.useRef(null),M=v.useRef(null),[D,O]=v.useState(1),[B,E]=v.useState({x:0,y:0}),[I,N]=v.useState(!1),T=v.useRef(null),[F,z]=v.useState({width:0,height:0,size:null}),G=e[_],U=K=>{if(K.startsWith("data:")){const Z=K.length-(K.indexOf(",")+1),W=K.charAt(K.length-1)==="="?K.charAt(K.length-2)==="="?2:1:0,Q=Z*.75-W;return nI(Q)}return null};v.useEffect(()=>{requestAnimationFrame(()=>m(!0)),R()},[]),v.useEffect(()=>{if(!G)return;const K=new Image;K.onload=()=>{z({width:K.naturalWidth,height:K.naturalHeight,size:U(G.src)});const Z=localStorage.getItem(cd),W=localStorage.getItem(dd);if(!Z||!W){const fe=window.innerWidth,$=window.innerHeight,V=fe*.95,J=$*.95;let Y=K.naturalWidth+20,ae=K.naturalHeight+100;if(Y>V||ae>J){const ue=Math.min((V-20)/K.naturalWidth,(J-100)/K.naturalHeight);Y=K.naturalWidth*ue+20,ae=K.naturalHeight*ue+100}Y=Math.max(Y,800),ae=Math.max(ae,456),y({width:Y,height:ae}),k({x:(fe-Y)/2,y:($-ae)/2})}if(j.current){const{width:Q,height:ce}=j.current.getBoundingClientRect(),fe=Q-20,$=ce-20;if(fe>0&&$>0){const V=fe/K.naturalWidth,J=$/K.naturalHeight,Y=Math.min(V,J);O(Math.min(Y,1))}else O(1)}else O(1);E({x:0,y:0})},K.src=G.src},[G]);const R=()=>{u(El())},q=K=>{K.stopPropagation(),h(!p)},H=K=>{K==null||K.stopPropagation(),S(Z=>Z>0?Z-1:e.length-1)},ne=K=>{K==null||K.stopPropagation(),S(Z=>Z<e.length-1?Z+1:0)},X=()=>{O(1),E({x:0,y:0})};v.useEffect(()=>{const K=Z=>{Z.stopPropagation(),Z.key==="ArrowLeft"?H():Z.key==="ArrowRight"?ne():Z.key==="Escape"&&r()};return window.addEventListener("keydown",K,!0),()=>{window.removeEventListener("keydown",K,!0)}},[r,e.length]);const re=K=>{K.target.closest("button")||(R(),K.preventDefault(),K.stopPropagation(),!p&&(K.currentTarget.setPointerCapture(K.pointerId),P.current={offset:{x:K.clientX-w.x,y:K.clientY-w.y}}))},de=K=>{if(!P.current)return;const Z=K.clientX-P.current.offset.x,W=K.clientY-P.current.offset.y;k({x:Z,y:W})},ge=K=>{P.current=null,K.currentTarget.releasePointerCapture(K.pointerId),localStorage.setItem(cd,JSON.stringify(x.current))},te=()=>{if(M.current&&!p){const K=M.current.getBoundingClientRect(),Z={width:K.width,height:K.height};y(Z),localStorage.setItem(dd,JSON.stringify(Z))}},le=K=>{if(K.stopPropagation(),!j.current)return;const Z=Math.pow(1.0005,-K.deltaY),W=Math.max(.1,Math.min(10,D*Z)),Q=j.current.getBoundingClientRect(),ce=K.clientX-Q.left,fe=K.clientY-Q.top,$=ce-Q.width/2,V=fe-Q.height/2,J=W/D,Y=$-($-B.x)*J,ae=V-(V-B.y)*J;O(W),E({x:Y,y:ae})},ee=()=>{if(!j.current||F.width===0)return!1;const{width:K,height:Z}=j.current.getBoundingClientRect(),W=F.width*D,Q=F.height*D;return W>K||Q>Z},se=D>1||ee(),ie=K=>{R(),(se||K.button===1)&&(K.preventDefault(),K.stopPropagation(),N(!0),T.current={x:K.clientX-B.x,y:K.clientY-B.y},window.addEventListener("mousemove",oe),window.addEventListener("mouseup",A))},oe=K=>{T.current&&(K.preventDefault(),K.stopPropagation(),E({x:K.clientX-T.current.x,y:K.clientY-T.current.y}))},A=()=>{N(!1),T.current=null,window.removeEventListener("mousemove",oe),window.removeEventListener("mouseup",A)};return v.useEffect(()=>()=>{window.removeEventListener("mousemove",oe),window.removeEventListener("mouseup",A)},[]),G?n.jsxs("div",{ref:M,className:`fixed bg-gray-800 rounded-lg shadow-2xl border-2 border-gray-700 flex flex-col z-[${d}] group transition-opacity duration-300 ease-out ${g?"opacity-100":"opacity-0"}`,style:p?{left:0,top:0,width:"100%",height:"100%",maxWidth:"100vw",maxHeight:"100vh",borderRadius:0,border:"none"}:{left:w.x,top:w.y,width:b.width,height:b.height,maxWidth:"98vw",maxHeight:"98vh",minWidth:"800px",minHeight:"456px",resize:"both",overflow:"hidden"},onMouseDown:K=>{K.stopPropagation(),R()},onMouseUp:te,children:[n.jsxs("div",{onPointerDown:re,onPointerMove:de,onPointerUp:ge,className:"bg-gray-700 text-white font-bold p-2 rounded-t-md flex justify-between items-center cursor-move flex-shrink-0",children:[n.jsxs("span",{children:[c("imageViewer.title")," - Frame ",G.frameNumber]}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(Pe,{title:"Copy Image",onClick:K=>{K.stopPropagation(),i(G.src)},children:n.jsx(Dt,{className:"h-5 w-5"})}),n.jsx(Pe,{title:"Download Image",onClick:K=>{K.stopPropagation(),a(G.src,G.frameNumber,G.prompt||""),l&&l(c("toast.downloadStarted"),"success")},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-500 mx-1"}),n.jsx("button",{onClick:q,className:"p-1 text-gray-400 rounded-full hover:bg-gray-600 hover:text-white transition-colors",title:p?"Restore":"Full Screen",children:p?n.jsx(qp,{}):n.jsx(zp,{})}),n.jsx("button",{onClick:K=>{K.stopPropagation(),r()},className:"p-1 text-gray-400 rounded-full hover:bg-gray-600 hover:text-white",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),n.jsxs("div",{ref:j,className:"p-1 flex-grow min-h-0 bg-gray-900 relative overflow-hidden flex items-center justify-center",onWheel:le,onMouseDown:ie,children:[n.jsx("img",{src:G.src,alt:`Full-size view of frame ${G.frameNumber}`,className:"shrink-0",style:{width:F.width||"auto",height:F.height||"auto",maxWidth:"none",maxHeight:"none",transform:`translate(${B.x}px, ${B.y}px) scale(${D})`,cursor:se?I?"grabbing":"grab":"default",pointerEvents:"auto",transformOrigin:"center"},draggable:!1,onMouseDown:K=>K.preventDefault()}),n.jsxs("div",{className:"absolute bottom-12 left-1/2 -translate-x-1/2 bg-gray-800/90 backdrop-blur-sm p-2 rounded-full flex items-center space-x-3 border border-gray-600 shadow-lg z-20",onMouseDown:K=>K.stopPropagation(),children:[n.jsx("button",{onClick:X,className:"w-8 h-8 rounded-full bg-gray-700 hover:bg-gray-600 text-xs font-bold text-white flex items-center justify-center border border-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500",title:"Reset to 100% (Actual Size)",children:"1:1"}),n.jsx("input",{type:"range",min:"0.1",max:"5",step:"0.01",value:D,onChange:K=>O(parseFloat(K.target.value)),className:"w-32 h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-500"}),n.jsxs("span",{className:"text-xs font-mono text-gray-300 w-12 text-right",children:[Math.round(D*100),"%"]})]}),e.length>1&&n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:H,className:"absolute left-4 top-1/2 -translate-y-1/2 p-2 bg-black/40 rounded-full text-white opacity-0 group-hover:opacity-100 transition-opacity focus:outline-none focus:ring-2 focus:ring-cyan-500 z-10","aria-label":"Previous image",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),n.jsx("button",{onClick:ne,className:"absolute right-4 top-1/2 -translate-y-1/2 p-2 bg-black/40 rounded-full text-white opacity-0 group-hover:opacity-100 transition-opacity focus:outline-none focus:ring-2 focus:ring-cyan-500 z-10","aria-label":"Next image",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]})]}),n.jsxs("div",{className:"bg-gray-800 text-gray-400 text-xs px-3 py-1 border-t border-gray-700 flex justify-between items-center rounded-b-lg select-none",children:[n.jsx("div",{children:F.width>0&&n.jsxs("span",{children:[F.width," x ",F.height," px"]})}),s&&n.jsx("button",{onClick:K=>{K.stopPropagation(),s(G.src)},className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors font-semibold",children:c("node.action.editor")}),n.jsx("div",{children:F.size&&n.jsx("span",{children:F.size})})]})]}):(r(),null)},ho=({mode:e,icon:t,label:o,isActive:r,onHover:a,className:i})=>n.jsxs("div",{"data-dock-mode":e,className:`relative flex items-center justify-center transition-all duration-200 cursor-pointer group ${i} ${r?"bg-accent/30 border-accent text-accent-text":"bg-gray-800/80 border-gray-600 text-gray-400 hover:bg-gray-700"}`,onMouseEnter:()=>a(e),onMouseLeave:()=>a(null),style:{pointerEvents:"auto"},children:[n.jsx("div",{className:"transform scale-90 group-hover:scale-100 transition-transform pointer-events-none",children:t}),n.jsx("div",{className:"absolute top-full mt-2 bg-gray-900 text-white text-[10px] px-2 py-1 rounded-md opacity-0 group-hover:opacity-100 whitespace-nowrap z-50 pointer-events-none border border-gray-700 transition-opacity duration-200 ease-in-out",children:o})]}),rI=({isVisible:e,hoveredMode:t})=>{const{setDockHoverMode:o,draggingInfo:r,nodes:a}=Ut()||{},{t:i}=St();if(!e||!o)return null;let s=!1;if((r==null?void 0:r.type)==="node"){const c=a==null?void 0:a.find(d=>d.id===r.id);c&&(s=Vl(c.type))}const l=c=>{o(c)};return n.jsx("div",{className:"fixed top-6 left-1/2 -translate-x-1/2 z-[200] animate-fade-in-down pointer-events-none select-none",children:n.jsxs("div",{className:"bg-gray-900/90 backdrop-blur-xl p-1.5 rounded-lg border border-gray-600 shadow-2xl flex items-center gap-1 pointer-events-auto",children:[!s&&n.jsx(ho,{mode:"q1",label:i("toolbar.dock.q1"),isActive:t==="q1",onHover:l,className:"h-16 w-8 rounded border-2",icon:n.jsxs("svg",{width:"12",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M2 4h5v16H2z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})}),!s&&n.jsx(ho,{mode:"q2",label:i("toolbar.dock.q2"),isActive:t==="q2",onHover:l,className:"h-16 w-8 rounded border-2",icon:n.jsxs("svg",{width:"12",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M7 4h5v16H7z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})}),!s&&n.jsxs("div",{className:"flex flex-col gap-1 h-16 w-12",children:[n.jsx(ho,{mode:"tl",label:i("toolbar.dock.tl"),isActive:t==="tl",onHover:l,className:"flex-1 rounded-t border-2",icon:n.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"currentColor",children:[n.jsx("path",{d:"M2 2h6v6H2z",opacity:"0.9"}),n.jsx("path",{d:"M2 2h12v12H2z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.5"})]})}),n.jsx(ho,{mode:"bl",label:i("toolbar.dock.bl"),isActive:t==="bl",onHover:l,className:"flex-1 rounded-b border-2",icon:n.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"currentColor",children:[n.jsx("path",{d:"M2 8h6v6H2z",opacity:"0.9"}),n.jsx("path",{d:"M2 2h12v12H2z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.5"})]})})]}),n.jsx(ho,{mode:"left",label:i("toolbar.dock.left"),isActive:t==="left",onHover:l,className:"h-16 w-12 rounded border-2",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M4 4h8v16H4z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})}),n.jsx(ho,{mode:"full",label:i("toolbar.dock.full"),isActive:t==="full",onHover:l,className:"h-16 w-16 rounded-lg border-2 bg-gray-800",icon:n.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"1",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})}),n.jsx(ho,{mode:"right",label:i("toolbar.dock.right"),isActive:t==="right",onHover:l,className:"h-16 w-12 rounded border-2",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M12 4h8v16h-8z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})}),!s&&n.jsxs("div",{className:"flex flex-col gap-1 h-16 w-12",children:[n.jsx(ho,{mode:"tr",label:i("toolbar.dock.tr"),isActive:t==="tr",onHover:l,className:"flex-1 rounded-t border-2",icon:n.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"currentColor",children:[n.jsx("path",{d:"M8 2h6v6H8z",opacity:"0.9"}),n.jsx("path",{d:"M2 2h12v12H2z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.5"})]})}),n.jsx(ho,{mode:"br",label:i("toolbar.dock.br"),isActive:t==="br",onHover:l,className:"flex-1 rounded-b border-2",icon:n.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"currentColor",children:[n.jsx("path",{d:"M8 8h6v6H8z",opacity:"0.9"}),n.jsx("path",{d:"M2 2h12v12H2z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.5"})]})})]}),!s&&n.jsx(ho,{mode:"q3",label:i("toolbar.dock.q3"),isActive:t==="q3",onHover:l,className:"h-16 w-8 rounded border-2",icon:n.jsxs("svg",{width:"12",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M12 4h5v16h-5z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})}),!s&&n.jsx(ho,{mode:"q4",label:i("toolbar.dock.q4"),isActive:t==="q4",onHover:l,className:"h-16 w-8 rounded border-2",icon:n.jsxs("svg",{width:"12",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M17 4h5v16h-5z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})})]})})},na=({mode:e,isActive:t,icon:o,className:r})=>{const a=r?r.replace("border-b",""):"";return n.jsx("div",{"data-dock-mode":e,className:`
                w-12 h-16 flex items-center justify-center 
                transition-all duration-200 cursor-pointer flex-shrink-0
                ${t?`bg-gray-800 border-2 border-accent text-accent shadow-[0_0_15px_var(--color-accent)] z-20 scale-110 ${a}`:`bg-gray-900/95 text-gray-500 hover:bg-gray-800 hover:text-gray-300 border-gray-600 ${r||""}`}
            `,children:n.jsx("div",{className:"pointer-events-none",children:o})})},aI=()=>{const e=Ut();if(!e)return null;const{draggingInfo:t,dockHoverMode:o,nodes:r}=e,a=(t==null?void 0:t.type)==="node",i=o;let s=!1;if(a&&t){const d=r.find(u=>u.id===t.id);d&&(s=Vl(d.type))}const l=i==="tl"||i==="q1"||i==="bl",c=i==="tr"||i==="q4"||i==="br";return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed top-0 left-0 bottom-0 z-[190] flex flex-col justify-center pointer-events-none",children:n.jsxs("div",{className:`
                        absolute left-0 flex flex-col shadow-2xl rounded-r-xl overflow-hidden border-y border-r border-gray-600
                        transition-transform duration-300 ease-[cubic-bezier(0.2,0.8,0.2,1)] origin-left pointer-events-auto
                        ${l?"translate-x-0":"-translate-x-full"}
                    `,children:[!s&&n.jsx(na,{mode:"tl",isActive:i==="tl",className:"border-b",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M4 4h8v10H4z",opacity:"0.9"}),n.jsx("path",{d:"M4 4h16v16H4z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.3"})]})}),!s&&n.jsx(na,{mode:"q1",isActive:i==="q1",className:"border-b h-20",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M4 3h6v18H4z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",fill:"none",stroke:"currentColor",strokeWidth:"2",opacity:"0.3"})]})}),!s&&n.jsx(na,{mode:"bl",isActive:i==="bl",className:"",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M4 10h8v10H4z",opacity:"0.9"}),n.jsx("path",{d:"M4 4h16v16H4z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.3"})]})})]})}),n.jsx("div",{className:"fixed top-0 right-0 bottom-0 z-[190] flex flex-col justify-center pointer-events-none",children:n.jsxs("div",{className:`
                        absolute right-0 flex flex-col shadow-2xl rounded-l-xl overflow-hidden border-y border-l border-gray-600
                        transition-transform duration-300 ease-[cubic-bezier(0.2,0.8,0.2,1)] origin-right pointer-events-auto
                        ${c?"translate-x-0":"translate-x-full"}
                    `,children:[!s&&n.jsx(na,{mode:"tr",isActive:i==="tr",className:"border-b",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M12 4h8v10h-8z",opacity:"0.9"}),n.jsx("path",{d:"M4 4h16v16H4z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.3"})]})}),!s&&n.jsx(na,{mode:"q4",isActive:i==="q4",className:"border-b h-20",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M14 3h6v18h-6z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",fill:"none",stroke:"currentColor",strokeWidth:"2",opacity:"0.3"})]})}),!s&&n.jsx(na,{mode:"br",isActive:i==="br",className:"",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M12 10h8v10h-8z",opacity:"0.9"}),n.jsx("path",{d:"M4 4h16v16H4z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.3"})]})})]})})]})},iI=e=>{if(isNaN(e))return"0:00";const t=Math.floor(e/60),o=Math.floor(e%60);return`${t}:${o.toString().padStart(2,"0")}`},sI=()=>{const e=Ut(),[t,o]=v.useState(!1);if(!e||!e.globalMedia)return null;const{globalMedia:r,setGlobalMedia:a,selectNode:i}=e,{name:s,isPlaying:l,currentTime:c,duration:d,nodeId:u}=r,p=g=>{g.stopPropagation(),a(m=>{if(!m)return null;const x=!m.isPlaying;return{...m,isPlaying:x,command:x?"play":"pause",commandTimestamp:Date.now()}})},h=g=>{const m=parseFloat(g.target.value);a(x=>x?{...x,currentTime:m,command:void 0}:null)},w=g=>{const m=parseFloat(g.currentTarget.value);a(x=>x?{...x,command:"seek",seekTarget:m,currentTime:m,commandTimestamp:Date.now()}:null)},k=g=>{g.stopPropagation(),a(m=>m?{...m,command:"pause",commandTimestamp:Date.now()}:null),setTimeout(()=>a(null),100)},b=()=>{i(u)},y=g=>{g.stopPropagation(),o(!t)};return t?n.jsx("div",{className:"fixed bottom-4 right-4 z-50 animate-fade-in-up",children:n.jsxs("div",{className:"bg-gray-900/90 backdrop-blur-md border border-gray-700 rounded-lg shadow-2xl p-2 flex flex-col items-center space-y-2 cursor-pointer hover:bg-gray-800/90 transition-colors",onClick:b,title:s,children:[n.jsx("button",{onClick:y,className:"p-1 text-gray-400 hover:text-white hover:bg-gray-700 rounded transition-colors",title:"Expand",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),n.jsx("div",{className:"w-8 h-8 rounded bg-gray-800 flex items-center justify-center border border-gray-600 flex-shrink-0",children:r.type==="audio"?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z",clipRule:"evenodd"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-purple-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"})})}),n.jsx("button",{onClick:p,className:"text-cyan-400 hover:text-white transition-colors focus:outline-none p-1",children:l?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),n.jsx("button",{onClick:k,className:"text-gray-500 hover:text-red-400 p-1.5 hover:bg-gray-700 rounded-full transition-colors",title:"Close",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}):n.jsx("div",{className:"fixed bottom-4 right-4 z-50 animate-fade-in-up",children:n.jsxs("div",{className:"bg-gray-900/90 backdrop-blur-md border border-gray-700 rounded-lg shadow-2xl p-2 flex items-center space-x-3 w-[330px] cursor-pointer hover:bg-gray-800/90 transition-colors",onClick:b,children:[n.jsx("button",{onClick:y,className:"p-1 text-gray-500 hover:text-white hover:bg-gray-700 rounded transition-colors flex-shrink-0",title:"Collapse",onMouseDown:g=>g.stopPropagation(),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})}),n.jsx("div",{className:"w-8 h-8 rounded bg-gray-800 flex items-center justify-center border border-gray-600 flex-shrink-0",children:r.type==="audio"?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z",clipRule:"evenodd"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-purple-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"})})}),n.jsxs("div",{className:"flex-grow min-w-0 flex flex-col justify-center",children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsx("span",{className:"text-xs font-bold text-gray-200 truncate pr-2",title:s,children:s}),n.jsx("button",{onClick:k,className:"text-gray-500 hover:text-white p-0.5 rounded",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:p,className:"text-cyan-400 hover:text-white transition-colors focus:outline-none",children:l?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),n.jsx("input",{type:"range",min:"0",max:d||100,value:c,onChange:h,onMouseUp:w,onTouchEnd:w,onClick:g=>g.stopPropagation(),onMouseDown:g=>g.stopPropagation(),className:"w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-500"}),n.jsx("span",{className:"text-[9px] font-mono text-gray-400 whitespace-nowrap min-w-[24px]",children:iI(c)})]})]})]})})},lI=({children:e})=>{const[t,o]=v.useState("ru"),[r,a]=v.useState("en");v.useEffect(()=>{const s=localStorage.getItem("settings_secondaryLanguage");s&&["ru","es"].includes(s)&&o(s)},[]),v.useEffect(()=>{localStorage.setItem("settings_secondaryLanguage",t)},[t]);const i=v.useCallback((s,l)=>qo(r,s,l),[r]);return n.jsx(zx.Provider,{value:{language:r,setLanguage:a,secondaryLanguage:t,setSecondaryLanguage:o,t:i},children:e})},cI=()=>{const e=Ut(),[t,o]=v.useState(!1),[r,a]=v.useState(!1),i=v.useRef(!1);if(v.useEffect(()=>{e&&(i.current=e.nodes.length>0||e.tabs.length>1)},[e]),v.useEffect(()=>{const N=T=>{/Electron/i.test(navigator.userAgent)||i.current&&(T.preventDefault(),T.returnValue="")};return window.addEventListener("beforeunload",N),()=>window.removeEventListener("beforeunload",N)},[]),v.useEffect(()=>{const N=setTimeout(()=>{o(!0)},150),T=setTimeout(()=>{a(!0)},500);return()=>{clearTimeout(N),clearTimeout(T)}},[]),!e)return null;const{fileInputRef:s,handleFileChange:l,catalogFileInputRef:c,handleCatalogFileChange:d,libraryFileInputRef:u,handleLibraryFileChange:p,imageSequenceFileInputRef:h,handleImageSequenceFileChange:w,promptSequenceEditorFileInputRef:k,handlePromptSequenceFileChange:b,characterCardFileInputRef:y,handleCharacterCardFileChange:g,scriptFileInputRef:m,handleScriptFileChange:x,toasts:_,addToast:S,imageViewer:P,setImageViewer:j,onDownloadImageFromUrl:M,onCopyImageToClipboard:D,isDockingMenuVisible:O,dockHoverMode:B,clientPointerPositionRef:E,t:I}=e;return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:`fixed inset-0 bg-[#111827] z-[9999] flex flex-col items-center justify-center transition-opacity duration-700 pointer-events-none ${r?"opacity-0":"opacity-100"}`,children:n.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[n.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin"}),n.jsx("div",{className:"text-cyan-400 font-bold tracking-widest uppercase text-sm animate-pulse",children:"..."})]})}),n.jsxs("div",{className:`relative w-screen h-screen flex flex-col overflow-hidden bg-canvas transition-opacity duration-700 delay-300 ${r?"opacity-100":"opacity-0"}`,style:{backgroundImage:"radial-gradient(hsla(215, 14%, 34%, 0.5) 1px, transparent 1px)",backgroundSize:"20px 20px"},children:[n.jsx("div",{className:`absolute inset-0 transition-opacity duration-700 ease-in-out ${t?"opacity-100":"opacity-0"}`,children:t&&n.jsx(bT,{})}),n.jsx(PT,{}),n.jsx(tI,{}),n.jsx(sI,{}),n.jsxs("div",{className:"absolute bottom-2 right-4 pointer-events-none z-[5] text-xs text-white/10 hover:text-white/50 transition-colors duration-300 flex flex-col items-end leading-tight select-none font-mono",children:[n.jsxs("span",{className:"font-bold",children:[I("help.author"),": MeowMaster"]}),n.jsx("span",{children:"MeowMasterArt@gmail.com"}),n.jsx("a",{href:"https://www.netlify.com",target:"_blank",rel:"noopener noreferrer",className:"pointer-events-auto hover:text-cyan-400 transition-colors mt-1",children:"Powered by Netlify"})]}),n.jsx(rI,{isVisible:O,hoveredMode:B,mousePosition:E.current}),n.jsx(aI,{}),n.jsx(XT,{}),P&&n.jsx(oI,{sources:P.sources,initialIndex:P.initialIndex,initialPosition:{x:window.innerWidth/2-512,y:window.innerHeight/2-400},onClose:()=>j(null),onDownloadImageFromUrl:M,onCopyImageToClipboard:D,addToast:S}),n.jsx("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-[101] flex flex-col items-center space-y-2 pointer-events-none",children:_.map(N=>{let T="font-bold px-6 py-3 rounded-xl shadow-xl animate-fade-in-out text-sm flex items-center justify-center text-center border pointer-events-auto";return N.type==="success"?T+=" bg-accent text-white border-accent-hover":N.type==="error"?T+=" bg-red-600 text-white border-red-500":T+=" bg-accent-secondary text-white border-accent-secondary-hover",n.jsx("div",{className:T,children:N.message},N.id)})}),n.jsx("input",{type:"file",ref:s,className:"hidden",accept:".json,.PMC,.PMP",onChange:l}),n.jsx("input",{type:"file",ref:c,className:"hidden",accept:".json",onChange:d}),n.jsx("input",{type:"file",ref:u,className:"hidden",accept:".json,.txt",onChange:p}),n.jsx("input",{type:"file",ref:h,className:"hidden",accept:".json",onChange:w}),n.jsx("input",{type:"file",ref:k,className:"hidden",accept:".json",onChange:b}),n.jsx("input",{type:"file",ref:y,className:"hidden",accept:".json,.CHAR",onChange:g}),n.jsx("input",{type:"file",ref:m,className:"hidden",accept:".json",onChange:x})]})]})},dI=()=>n.jsx(lI,{children:n.jsx(R3,{children:n.jsx(cI,{})})}),hy=document.getElementById("root");if(!hy)throw new Error("Could not find root element to mount to");const uI=ud.createRoot(hy);uI.render(n.jsx(jt.StrictMode,{children:n.jsx(dI,{})}));
