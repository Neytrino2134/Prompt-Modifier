(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function o(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=o(a);fetch(a.href,i)}})();var Ui=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vu(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var g0={exports:{}},Sl={},f0={exports:{}},Pt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Di=Symbol.for("react.element"),Jy=Symbol.for("react.portal"),Yy=Symbol.for("react.fragment"),Xy=Symbol.for("react.strict_mode"),Zy=Symbol.for("react.profiler"),Qy=Symbol.for("react.provider"),ev=Symbol.for("react.context"),tv=Symbol.for("react.forward_ref"),nv=Symbol.for("react.suspense"),ov=Symbol.for("react.memo"),rv=Symbol.for("react.lazy"),qp=Symbol.iterator;function av(e){return e===null||typeof e!="object"?null:(e=qp&&e[qp]||e["@@iterator"],typeof e=="function"?e:null)}var x0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y0=Object.assign,v0={};function qa(e,t,o){this.props=e,this.context=t,this.refs=v0,this.updater=o||x0}qa.prototype.isReactComponent={};qa.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};qa.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function w0(){}w0.prototype=qa.prototype;function wu(e,t,o){this.props=e,this.context=t,this.refs=v0,this.updater=o||x0}var bu=wu.prototype=new w0;bu.constructor=wu;y0(bu,qa.prototype);bu.isPureReactComponent=!0;var Op=Array.isArray,b0=Object.prototype.hasOwnProperty,Cu={current:null},C0={key:!0,ref:!0,__self:!0,__source:!0};function k0(e,t,o){var r,a={},i=null,s=null;if(t!=null)for(r in t.ref!==void 0&&(s=t.ref),t.key!==void 0&&(i=""+t.key),t)b0.call(t,r)&&!C0.hasOwnProperty(r)&&(a[r]=t[r]);var l=arguments.length-2;if(l===1)a.children=o;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];a.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps,l)a[r]===void 0&&(a[r]=l[r]);return{$$typeof:Di,type:e,key:i,ref:s,props:a,_owner:Cu.current}}function iv(e,t){return{$$typeof:Di,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function ku(e){return typeof e=="object"&&e!==null&&e.$$typeof===Di}function sv(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(o){return t[o]})}var Fp=/\/+/g;function mc(e,t){return typeof e=="object"&&e!==null&&e.key!=null?sv(""+e.key):t.toString(36)}function Ss(e,t,o,r,a){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var s=!1;if(e===null)s=!0;else switch(i){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case Di:case Jy:s=!0}}if(s)return s=e,a=a(s),e=r===""?"."+mc(s,0):r,Op(a)?(o="",e!=null&&(o=e.replace(Fp,"$&/")+"/"),Ss(a,t,o,"",function(d){return d})):a!=null&&(ku(a)&&(a=iv(a,o+(!a.key||s&&s.key===a.key?"":(""+a.key).replace(Fp,"$&/")+"/")+e)),t.push(a)),1;if(s=0,r=r===""?".":r+":",Op(e))for(var l=0;l<e.length;l++){i=e[l];var c=r+mc(i,l);s+=Ss(i,t,o,c,a)}else if(c=av(e),typeof c=="function")for(e=c.call(e),l=0;!(i=e.next()).done;)i=i.value,c=r+mc(i,l++),s+=Ss(i,t,o,c,a);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function Vi(e,t,o){if(e==null)return e;var r=[],a=0;return Ss(e,r,"","",function(i){return t.call(o,i,a++)}),r}function lv(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(o){(e._status===0||e._status===-1)&&(e._status=1,e._result=o)},function(o){(e._status===0||e._status===-1)&&(e._status=2,e._result=o)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Ln={current:null},Ns={transition:null},cv={ReactCurrentDispatcher:Ln,ReactCurrentBatchConfig:Ns,ReactCurrentOwner:Cu};function _0(){throw Error("act(...) is not supported in production builds of React.")}Pt.Children={map:Vi,forEach:function(e,t,o){Vi(e,function(){t.apply(this,arguments)},o)},count:function(e){var t=0;return Vi(e,function(){t++}),t},toArray:function(e){return Vi(e,function(t){return t})||[]},only:function(e){if(!ku(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Pt.Component=qa;Pt.Fragment=Yy;Pt.Profiler=Zy;Pt.PureComponent=wu;Pt.StrictMode=Xy;Pt.Suspense=nv;Pt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cv;Pt.act=_0;Pt.cloneElement=function(e,t,o){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=y0({},e.props),a=e.key,i=e.ref,s=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,s=Cu.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)b0.call(t,c)&&!C0.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=o;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:Di,type:e.type,key:a,ref:i,props:r,_owner:s}};Pt.createContext=function(e){return e={$$typeof:ev,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Qy,_context:e},e.Consumer=e};Pt.createElement=k0;Pt.createFactory=function(e){var t=k0.bind(null,e);return t.type=e,t};Pt.createRef=function(){return{current:null}};Pt.forwardRef=function(e){return{$$typeof:tv,render:e}};Pt.isValidElement=ku;Pt.lazy=function(e){return{$$typeof:rv,_payload:{_status:-1,_result:e},_init:lv}};Pt.memo=function(e,t){return{$$typeof:ov,type:e,compare:t===void 0?null:t}};Pt.startTransition=function(e){var t=Ns.transition;Ns.transition={};try{e()}finally{Ns.transition=t}};Pt.unstable_act=_0;Pt.useCallback=function(e,t){return Ln.current.useCallback(e,t)};Pt.useContext=function(e){return Ln.current.useContext(e)};Pt.useDebugValue=function(){};Pt.useDeferredValue=function(e){return Ln.current.useDeferredValue(e)};Pt.useEffect=function(e,t){return Ln.current.useEffect(e,t)};Pt.useId=function(){return Ln.current.useId()};Pt.useImperativeHandle=function(e,t,o){return Ln.current.useImperativeHandle(e,t,o)};Pt.useInsertionEffect=function(e,t){return Ln.current.useInsertionEffect(e,t)};Pt.useLayoutEffect=function(e,t){return Ln.current.useLayoutEffect(e,t)};Pt.useMemo=function(e,t){return Ln.current.useMemo(e,t)};Pt.useReducer=function(e,t,o){return Ln.current.useReducer(e,t,o)};Pt.useRef=function(e){return Ln.current.useRef(e)};Pt.useState=function(e){return Ln.current.useState(e)};Pt.useSyncExternalStore=function(e,t,o){return Ln.current.useSyncExternalStore(e,t,o)};Pt.useTransition=function(){return Ln.current.useTransition()};Pt.version="18.3.1";f0.exports=Pt;var y=f0.exports;const Et=vu(y);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dv=y,uv=Symbol.for("react.element"),pv=Symbol.for("react.fragment"),hv=Object.prototype.hasOwnProperty,mv=dv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,gv={key:!0,ref:!0,__self:!0,__source:!0};function S0(e,t,o){var r,a={},i=null,s=null;o!==void 0&&(i=""+o),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(s=t.ref);for(r in t)hv.call(t,r)&&!gv.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:uv,type:e,key:i,ref:s,props:a,_owner:mv.current}}Sl.Fragment=pv;Sl.jsx=S0;Sl.jsxs=S0;g0.exports=Sl;var n=g0.exports,nd={},N0={exports:{}},Xn={},E0={exports:{}},P0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(V,H){var F=V.length;V.push(H);e:for(;0<F;){var G=F-1>>>1,B=V[G];if(0<a(B,H))V[G]=H,V[F]=B,F=G;else break e}}function o(V){return V.length===0?null:V[0]}function r(V){if(V.length===0)return null;var H=V[0],F=V.pop();if(F!==H){V[0]=F;e:for(var G=0,B=V.length,Y=B>>>1;G<Y;){var ee=2*(G+1)-1,ie=V[ee],ce=ee+1,pe=V[ce];if(0>a(ie,F))ce<B&&0>a(pe,ie)?(V[G]=pe,V[ce]=F,G=ce):(V[G]=ie,V[ee]=F,G=ee);else if(ce<B&&0>a(pe,F))V[G]=pe,V[ce]=F,G=ce;else break e}}return H}function a(V,H){var F=V.sortIndex-H.sortIndex;return F!==0?F:V.id-H.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var s=Date,l=s.now();e.unstable_now=function(){return s.now()-l}}var c=[],d=[],u=1,p=null,h=3,x=!1,k=!1,C=!1,w=typeof setTimeout=="function"?setTimeout:null,f=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(V){for(var H=o(d);H!==null;){if(H.callback===null)r(d);else if(H.startTime<=V)r(d),H.sortIndex=H.expirationTime,t(c,H);else break;H=o(d)}}function _(V){if(C=!1,v(V),!k)if(o(c)!==null)k=!0,L(S);else{var H=o(d);H!==null&&M(_,H.startTime-V)}}function S(V,H){k=!1,C&&(C=!1,f(R),R=-1),x=!0;var F=h;try{for(v(H),p=o(c);p!==null&&(!(p.expirationTime>H)||V&&!O());){var G=p.callback;if(typeof G=="function"){p.callback=null,h=p.priorityLevel;var B=G(p.expirationTime<=H);H=e.unstable_now(),typeof B=="function"?p.callback=B:p===o(c)&&r(c),v(H)}else r(c);p=o(c)}if(p!==null)var Y=!0;else{var ee=o(d);ee!==null&&M(_,ee.startTime-H),Y=!1}return Y}finally{p=null,h=F,x=!1}}var T=!1,P=null,R=-1,D=5,q=-1;function O(){return!(e.unstable_now()-q<D)}function E(){if(P!==null){var V=e.unstable_now();q=V;var H=!0;try{H=P(!0,V)}finally{H?A():(T=!1,P=null)}}else T=!1}var A;if(typeof g=="function")A=function(){g(E)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,j=N.port2;N.port1.onmessage=E,A=function(){j.postMessage(null)}}else A=function(){w(E,0)};function L(V){P=V,T||(T=!0,A())}function M(V,H){R=w(function(){V(e.unstable_now())},H)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(V){V.callback=null},e.unstable_continueExecution=function(){k||x||(k=!0,L(S))},e.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<V?Math.floor(1e3/V):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return o(c)},e.unstable_next=function(V){switch(h){case 1:case 2:case 3:var H=3;break;default:H=h}var F=h;h=H;try{return V()}finally{h=F}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(V,H){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var F=h;h=V;try{return H()}finally{h=F}},e.unstable_scheduleCallback=function(V,H,F){var G=e.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?G+F:G):F=G,V){case 1:var B=-1;break;case 2:B=250;break;case 5:B=1073741823;break;case 4:B=1e4;break;default:B=5e3}return B=F+B,V={id:u++,callback:H,priorityLevel:V,startTime:F,expirationTime:B,sortIndex:-1},F>G?(V.sortIndex=F,t(d,V),o(c)===null&&V===o(d)&&(C?(f(R),R=-1):C=!0,M(_,F-G))):(V.sortIndex=B,t(c,V),k||x||(k=!0,L(S))),V},e.unstable_shouldYield=O,e.unstable_wrapCallback=function(V){var H=h;return function(){var F=h;h=H;try{return V.apply(this,arguments)}finally{h=F}}}})(P0);E0.exports=P0;var fv=E0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xv=y,Yn=fv;function Ye(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,o=1;o<arguments.length;o++)t+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var T0=new Set,xi={};function Ur(e,t){Ea(e,t),Ea(e+"Capture",t)}function Ea(e,t){for(xi[e]=t,e=0;e<t.length;e++)T0.add(t[e])}var Ho=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),od=Object.prototype.hasOwnProperty,yv=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Bp={},Gp={};function vv(e){return od.call(Gp,e)?!0:od.call(Bp,e)?!1:yv.test(e)?Gp[e]=!0:(Bp[e]=!0,!1)}function wv(e,t,o,r){if(o!==null&&o.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:o!==null?!o.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function bv(e,t,o,r){if(t===null||typeof t>"u"||wv(e,t,o,r))return!0;if(r)return!1;if(o!==null)switch(o.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Dn(e,t,o,r,a,i,s){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=o,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=s}var vn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){vn[e]=new Dn(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];vn[t]=new Dn(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){vn[e]=new Dn(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){vn[e]=new Dn(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){vn[e]=new Dn(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){vn[e]=new Dn(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){vn[e]=new Dn(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){vn[e]=new Dn(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){vn[e]=new Dn(e,5,!1,e.toLowerCase(),null,!1,!1)});var _u=/[\-:]([a-z])/g;function Su(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(_u,Su);vn[t]=new Dn(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(_u,Su);vn[t]=new Dn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(_u,Su);vn[t]=new Dn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){vn[e]=new Dn(e,1,!1,e.toLowerCase(),null,!1,!1)});vn.xlinkHref=new Dn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){vn[e]=new Dn(e,1,!1,e.toLowerCase(),null,!0,!0)});function Nu(e,t,o,r){var a=vn.hasOwnProperty(t)?vn[t]:null;(a!==null?a.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(bv(t,o,a,r)&&(o=null),r||a===null?vv(t)&&(o===null?e.removeAttribute(t):e.setAttribute(t,""+o)):a.mustUseProperty?e[a.propertyName]=o===null?a.type===3?!1:"":o:(t=a.attributeName,r=a.attributeNamespace,o===null?e.removeAttribute(t):(a=a.type,o=a===3||a===4&&o===!0?"":""+o,r?e.setAttributeNS(r,t,o):e.setAttribute(t,o))))}var Ko=xv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Wi=Symbol.for("react.element"),ra=Symbol.for("react.portal"),aa=Symbol.for("react.fragment"),Eu=Symbol.for("react.strict_mode"),rd=Symbol.for("react.profiler"),I0=Symbol.for("react.provider"),j0=Symbol.for("react.context"),Pu=Symbol.for("react.forward_ref"),ad=Symbol.for("react.suspense"),id=Symbol.for("react.suspense_list"),Tu=Symbol.for("react.memo"),rr=Symbol.for("react.lazy"),A0=Symbol.for("react.offscreen"),Hp=Symbol.iterator;function Wa(e){return e===null||typeof e!="object"?null:(e=Hp&&e[Hp]||e["@@iterator"],typeof e=="function"?e:null)}var tn=Object.assign,gc;function ni(e){if(gc===void 0)try{throw Error()}catch(o){var t=o.stack.trim().match(/\n( *(at )?)/);gc=t&&t[1]||""}return`
`+gc+e}var fc=!1;function xc(e,t){if(!e||fc)return"";fc=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var r=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){r=d}e.call(t.prototype)}else{try{throw Error()}catch(d){r=d}e()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var a=d.stack.split(`
`),i=r.stack.split(`
`),s=a.length-1,l=i.length-1;1<=s&&0<=l&&a[s]!==i[l];)l--;for(;1<=s&&0<=l;s--,l--)if(a[s]!==i[l]){if(s!==1||l!==1)do if(s--,l--,0>l||a[s]!==i[l]){var c=`
`+a[s].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=s&&0<=l);break}}}finally{fc=!1,Error.prepareStackTrace=o}return(e=e?e.displayName||e.name:"")?ni(e):""}function Cv(e){switch(e.tag){case 5:return ni(e.type);case 16:return ni("Lazy");case 13:return ni("Suspense");case 19:return ni("SuspenseList");case 0:case 2:case 15:return e=xc(e.type,!1),e;case 11:return e=xc(e.type.render,!1),e;case 1:return e=xc(e.type,!0),e;default:return""}}function sd(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case aa:return"Fragment";case ra:return"Portal";case rd:return"Profiler";case Eu:return"StrictMode";case ad:return"Suspense";case id:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case j0:return(e.displayName||"Context")+".Consumer";case I0:return(e._context.displayName||"Context")+".Provider";case Pu:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Tu:return t=e.displayName||null,t!==null?t:sd(e.type)||"Memo";case rr:t=e._payload,e=e._init;try{return sd(e(t))}catch{}}return null}function kv(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return sd(t);case 8:return t===Eu?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function vr(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function M0(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function _v(e){var t=M0(e)?"checked":"value",o=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var a=o.get,i=o.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(s){r=""+s,i.call(this,s)}}),Object.defineProperty(e,t,{enumerable:o.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function $i(e){e._valueTracker||(e._valueTracker=_v(e))}function R0(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var o=t.getValue(),r="";return e&&(r=M0(e)?e.checked?"true":"false":e.value),e=r,e!==o?(t.setValue(e),!0):!1}function Us(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function ld(e,t){var o=t.checked;return tn({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??e._wrapperState.initialChecked})}function Up(e,t){var o=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;o=vr(t.value!=null?t.value:o),e._wrapperState={initialChecked:r,initialValue:o,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function L0(e,t){t=t.checked,t!=null&&Nu(e,"checked",t,!1)}function cd(e,t){L0(e,t);var o=vr(t.value),r=t.type;if(o!=null)r==="number"?(o===0&&e.value===""||e.value!=o)&&(e.value=""+o):e.value!==""+o&&(e.value=""+o);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?dd(e,t.type,o):t.hasOwnProperty("defaultValue")&&dd(e,t.type,vr(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Vp(e,t,o){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,o||t===e.value||(e.value=t),e.defaultValue=t}o=e.name,o!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,o!==""&&(e.name=o)}function dd(e,t,o){(t!=="number"||Us(e.ownerDocument)!==e)&&(o==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+o&&(e.defaultValue=""+o))}var oi=Array.isArray;function ya(e,t,o,r){if(e=e.options,t){t={};for(var a=0;a<o.length;a++)t["$"+o[a]]=!0;for(o=0;o<e.length;o++)a=t.hasOwnProperty("$"+e[o].value),e[o].selected!==a&&(e[o].selected=a),a&&r&&(e[o].defaultSelected=!0)}else{for(o=""+vr(o),t=null,a=0;a<e.length;a++){if(e[a].value===o){e[a].selected=!0,r&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function ud(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Ye(91));return tn({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Wp(e,t){var o=t.value;if(o==null){if(o=t.children,t=t.defaultValue,o!=null){if(t!=null)throw Error(Ye(92));if(oi(o)){if(1<o.length)throw Error(Ye(93));o=o[0]}t=o}t==null&&(t=""),o=t}e._wrapperState={initialValue:vr(o)}}function D0(e,t){var o=vr(t.value),r=vr(t.defaultValue);o!=null&&(o=""+o,o!==e.value&&(e.value=o),t.defaultValue==null&&e.defaultValue!==o&&(e.defaultValue=o)),r!=null&&(e.defaultValue=""+r)}function $p(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function z0(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function pd(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?z0(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Ki,q0=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,o,r,a){MSApp.execUnsafeLocalFunction(function(){return e(t,o,r,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Ki=Ki||document.createElement("div"),Ki.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Ki.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function yi(e,t){if(t){var o=e.firstChild;if(o&&o===e.lastChild&&o.nodeType===3){o.nodeValue=t;return}}e.textContent=t}var li={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Sv=["Webkit","ms","Moz","O"];Object.keys(li).forEach(function(e){Sv.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),li[t]=li[e]})});function O0(e,t,o){return t==null||typeof t=="boolean"||t===""?"":o||typeof t!="number"||t===0||li.hasOwnProperty(e)&&li[e]?(""+t).trim():t+"px"}function F0(e,t){e=e.style;for(var o in t)if(t.hasOwnProperty(o)){var r=o.indexOf("--")===0,a=O0(o,t[o],r);o==="float"&&(o="cssFloat"),r?e.setProperty(o,a):e[o]=a}}var Nv=tn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function hd(e,t){if(t){if(Nv[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Ye(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Ye(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Ye(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Ye(62))}}function md(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var gd=null;function Iu(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var fd=null,va=null,wa=null;function Kp(e){if(e=Oi(e)){if(typeof fd!="function")throw Error(Ye(280));var t=e.stateNode;t&&(t=Il(t),fd(e.stateNode,e.type,t))}}function B0(e){va?wa?wa.push(e):wa=[e]:va=e}function G0(){if(va){var e=va,t=wa;if(wa=va=null,Kp(e),t)for(e=0;e<t.length;e++)Kp(t[e])}}function H0(e,t){return e(t)}function U0(){}var yc=!1;function V0(e,t,o){if(yc)return e(t,o);yc=!0;try{return H0(e,t,o)}finally{yc=!1,(va!==null||wa!==null)&&(U0(),G0())}}function vi(e,t){var o=e.stateNode;if(o===null)return null;var r=Il(o);if(r===null)return null;o=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(o&&typeof o!="function")throw Error(Ye(231,t,typeof o));return o}var xd=!1;if(Ho)try{var $a={};Object.defineProperty($a,"passive",{get:function(){xd=!0}}),window.addEventListener("test",$a,$a),window.removeEventListener("test",$a,$a)}catch{xd=!1}function Ev(e,t,o,r,a,i,s,l,c){var d=Array.prototype.slice.call(arguments,3);try{t.apply(o,d)}catch(u){this.onError(u)}}var ci=!1,Vs=null,Ws=!1,yd=null,Pv={onError:function(e){ci=!0,Vs=e}};function Tv(e,t,o,r,a,i,s,l,c){ci=!1,Vs=null,Ev.apply(Pv,arguments)}function Iv(e,t,o,r,a,i,s,l,c){if(Tv.apply(this,arguments),ci){if(ci){var d=Vs;ci=!1,Vs=null}else throw Error(Ye(198));Ws||(Ws=!0,yd=d)}}function Vr(e){var t=e,o=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(o=t.return),e=t.return;while(e)}return t.tag===3?o:null}function W0(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Jp(e){if(Vr(e)!==e)throw Error(Ye(188))}function jv(e){var t=e.alternate;if(!t){if(t=Vr(e),t===null)throw Error(Ye(188));return t!==e?null:e}for(var o=e,r=t;;){var a=o.return;if(a===null)break;var i=a.alternate;if(i===null){if(r=a.return,r!==null){o=r;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===o)return Jp(a),e;if(i===r)return Jp(a),t;i=i.sibling}throw Error(Ye(188))}if(o.return!==r.return)o=a,r=i;else{for(var s=!1,l=a.child;l;){if(l===o){s=!0,o=a,r=i;break}if(l===r){s=!0,r=a,o=i;break}l=l.sibling}if(!s){for(l=i.child;l;){if(l===o){s=!0,o=i,r=a;break}if(l===r){s=!0,r=i,o=a;break}l=l.sibling}if(!s)throw Error(Ye(189))}}if(o.alternate!==r)throw Error(Ye(190))}if(o.tag!==3)throw Error(Ye(188));return o.stateNode.current===o?e:t}function $0(e){return e=jv(e),e!==null?K0(e):null}function K0(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=K0(e);if(t!==null)return t;e=e.sibling}return null}var J0=Yn.unstable_scheduleCallback,Yp=Yn.unstable_cancelCallback,Av=Yn.unstable_shouldYield,Mv=Yn.unstable_requestPaint,sn=Yn.unstable_now,Rv=Yn.unstable_getCurrentPriorityLevel,ju=Yn.unstable_ImmediatePriority,Y0=Yn.unstable_UserBlockingPriority,$s=Yn.unstable_NormalPriority,Lv=Yn.unstable_LowPriority,X0=Yn.unstable_IdlePriority,Nl=null,Po=null;function Dv(e){if(Po&&typeof Po.onCommitFiberRoot=="function")try{Po.onCommitFiberRoot(Nl,e,void 0,(e.current.flags&128)===128)}catch{}}var go=Math.clz32?Math.clz32:Ov,zv=Math.log,qv=Math.LN2;function Ov(e){return e>>>=0,e===0?32:31-(zv(e)/qv|0)|0}var Ji=64,Yi=4194304;function ri(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Ks(e,t){var o=e.pendingLanes;if(o===0)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,s=o&268435455;if(s!==0){var l=s&~a;l!==0?r=ri(l):(i&=s,i!==0&&(r=ri(i)))}else s=o&~a,s!==0?r=ri(s):i!==0&&(r=ri(i));if(r===0)return 0;if(t!==0&&t!==r&&!(t&a)&&(a=r&-r,i=t&-t,a>=i||a===16&&(i&4194240)!==0))return t;if(r&4&&(r|=o&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)o=31-go(t),a=1<<o,r|=e[o],t&=~a;return r}function Fv(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Bv(e,t){for(var o=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var s=31-go(i),l=1<<s,c=a[s];c===-1?(!(l&o)||l&r)&&(a[s]=Fv(l,t)):c<=t&&(e.expiredLanes|=l),i&=~l}}function vd(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Z0(){var e=Ji;return Ji<<=1,!(Ji&4194240)&&(Ji=64),e}function vc(e){for(var t=[],o=0;31>o;o++)t.push(e);return t}function zi(e,t,o){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-go(t),e[t]=o}function Gv(e,t){var o=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<o;){var a=31-go(o),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,o&=~i}}function Au(e,t){var o=e.entangledLanes|=t;for(e=e.entanglements;o;){var r=31-go(o),a=1<<r;a&t|e[r]&t&&(e[r]|=t),o&=~a}}var Bt=0;function Q0(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var ef,Mu,tf,nf,of,wd=!1,Xi=[],dr=null,ur=null,pr=null,wi=new Map,bi=new Map,ir=[],Hv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Xp(e,t){switch(e){case"focusin":case"focusout":dr=null;break;case"dragenter":case"dragleave":ur=null;break;case"mouseover":case"mouseout":pr=null;break;case"pointerover":case"pointerout":wi.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":bi.delete(t.pointerId)}}function Ka(e,t,o,r,a,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:o,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},t!==null&&(t=Oi(t),t!==null&&Mu(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function Uv(e,t,o,r,a){switch(t){case"focusin":return dr=Ka(dr,e,t,o,r,a),!0;case"dragenter":return ur=Ka(ur,e,t,o,r,a),!0;case"mouseover":return pr=Ka(pr,e,t,o,r,a),!0;case"pointerover":var i=a.pointerId;return wi.set(i,Ka(wi.get(i)||null,e,t,o,r,a)),!0;case"gotpointercapture":return i=a.pointerId,bi.set(i,Ka(bi.get(i)||null,e,t,o,r,a)),!0}return!1}function rf(e){var t=Mr(e.target);if(t!==null){var o=Vr(t);if(o!==null){if(t=o.tag,t===13){if(t=W0(o),t!==null){e.blockedOn=t,of(e.priority,function(){tf(o)});return}}else if(t===3&&o.stateNode.current.memoizedState.isDehydrated){e.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Es(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var o=bd(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(o===null){o=e.nativeEvent;var r=new o.constructor(o.type,o);gd=r,o.target.dispatchEvent(r),gd=null}else return t=Oi(o),t!==null&&Mu(t),e.blockedOn=o,!1;t.shift()}return!0}function Zp(e,t,o){Es(e)&&o.delete(t)}function Vv(){wd=!1,dr!==null&&Es(dr)&&(dr=null),ur!==null&&Es(ur)&&(ur=null),pr!==null&&Es(pr)&&(pr=null),wi.forEach(Zp),bi.forEach(Zp)}function Ja(e,t){e.blockedOn===t&&(e.blockedOn=null,wd||(wd=!0,Yn.unstable_scheduleCallback(Yn.unstable_NormalPriority,Vv)))}function Ci(e){function t(a){return Ja(a,e)}if(0<Xi.length){Ja(Xi[0],e);for(var o=1;o<Xi.length;o++){var r=Xi[o];r.blockedOn===e&&(r.blockedOn=null)}}for(dr!==null&&Ja(dr,e),ur!==null&&Ja(ur,e),pr!==null&&Ja(pr,e),wi.forEach(t),bi.forEach(t),o=0;o<ir.length;o++)r=ir[o],r.blockedOn===e&&(r.blockedOn=null);for(;0<ir.length&&(o=ir[0],o.blockedOn===null);)rf(o),o.blockedOn===null&&ir.shift()}var ba=Ko.ReactCurrentBatchConfig,Js=!0;function Wv(e,t,o,r){var a=Bt,i=ba.transition;ba.transition=null;try{Bt=1,Ru(e,t,o,r)}finally{Bt=a,ba.transition=i}}function $v(e,t,o,r){var a=Bt,i=ba.transition;ba.transition=null;try{Bt=4,Ru(e,t,o,r)}finally{Bt=a,ba.transition=i}}function Ru(e,t,o,r){if(Js){var a=bd(e,t,o,r);if(a===null)Tc(e,t,r,Ys,o),Xp(e,r);else if(Uv(a,e,t,o,r))r.stopPropagation();else if(Xp(e,r),t&4&&-1<Hv.indexOf(e)){for(;a!==null;){var i=Oi(a);if(i!==null&&ef(i),i=bd(e,t,o,r),i===null&&Tc(e,t,r,Ys,o),i===a)break;a=i}a!==null&&r.stopPropagation()}else Tc(e,t,r,null,o)}}var Ys=null;function bd(e,t,o,r){if(Ys=null,e=Iu(r),e=Mr(e),e!==null)if(t=Vr(e),t===null)e=null;else if(o=t.tag,o===13){if(e=W0(t),e!==null)return e;e=null}else if(o===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Ys=e,null}function af(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Rv()){case ju:return 1;case Y0:return 4;case $s:case Lv:return 16;case X0:return 536870912;default:return 16}default:return 16}}var lr=null,Lu=null,Ps=null;function sf(){if(Ps)return Ps;var e,t=Lu,o=t.length,r,a="value"in lr?lr.value:lr.textContent,i=a.length;for(e=0;e<o&&t[e]===a[e];e++);var s=o-e;for(r=1;r<=s&&t[o-r]===a[i-r];r++);return Ps=a.slice(e,1<r?1-r:void 0)}function Ts(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Zi(){return!0}function Qp(){return!1}function Zn(e){function t(o,r,a,i,s){this._reactName=o,this._targetInst=a,this.type=r,this.nativeEvent=i,this.target=s,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(o=e[l],this[l]=o?o(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Zi:Qp,this.isPropagationStopped=Qp,this}return tn(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=Zi)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=Zi)},persist:function(){},isPersistent:Zi}),t}var Oa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Du=Zn(Oa),qi=tn({},Oa,{view:0,detail:0}),Kv=Zn(qi),wc,bc,Ya,El=tn({},qi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zu,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ya&&(Ya&&e.type==="mousemove"?(wc=e.screenX-Ya.screenX,bc=e.screenY-Ya.screenY):bc=wc=0,Ya=e),wc)},movementY:function(e){return"movementY"in e?e.movementY:bc}}),eh=Zn(El),Jv=tn({},El,{dataTransfer:0}),Yv=Zn(Jv),Xv=tn({},qi,{relatedTarget:0}),Cc=Zn(Xv),Zv=tn({},Oa,{animationName:0,elapsedTime:0,pseudoElement:0}),Qv=Zn(Zv),e2=tn({},Oa,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),t2=Zn(e2),n2=tn({},Oa,{data:0}),th=Zn(n2),o2={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},r2={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},a2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function i2(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=a2[e])?!!t[e]:!1}function zu(){return i2}var s2=tn({},qi,{key:function(e){if(e.key){var t=o2[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Ts(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?r2[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zu,charCode:function(e){return e.type==="keypress"?Ts(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Ts(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),l2=Zn(s2),c2=tn({},El,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),nh=Zn(c2),d2=tn({},qi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zu}),u2=Zn(d2),p2=tn({},Oa,{propertyName:0,elapsedTime:0,pseudoElement:0}),h2=Zn(p2),m2=tn({},El,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),g2=Zn(m2),f2=[9,13,27,32],qu=Ho&&"CompositionEvent"in window,di=null;Ho&&"documentMode"in document&&(di=document.documentMode);var x2=Ho&&"TextEvent"in window&&!di,lf=Ho&&(!qu||di&&8<di&&11>=di),oh=" ",rh=!1;function cf(e,t){switch(e){case"keyup":return f2.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function df(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ia=!1;function y2(e,t){switch(e){case"compositionend":return df(t);case"keypress":return t.which!==32?null:(rh=!0,oh);case"textInput":return e=t.data,e===oh&&rh?null:e;default:return null}}function v2(e,t){if(ia)return e==="compositionend"||!qu&&cf(e,t)?(e=sf(),Ps=Lu=lr=null,ia=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return lf&&t.locale!=="ko"?null:t.data;default:return null}}var w2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ah(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!w2[e.type]:t==="textarea"}function uf(e,t,o,r){B0(r),t=Xs(t,"onChange"),0<t.length&&(o=new Du("onChange","change",null,o,r),e.push({event:o,listeners:t}))}var ui=null,ki=null;function b2(e){Cf(e,0)}function Pl(e){var t=ca(e);if(R0(t))return e}function C2(e,t){if(e==="change")return t}var pf=!1;if(Ho){var kc;if(Ho){var _c="oninput"in document;if(!_c){var ih=document.createElement("div");ih.setAttribute("oninput","return;"),_c=typeof ih.oninput=="function"}kc=_c}else kc=!1;pf=kc&&(!document.documentMode||9<document.documentMode)}function sh(){ui&&(ui.detachEvent("onpropertychange",hf),ki=ui=null)}function hf(e){if(e.propertyName==="value"&&Pl(ki)){var t=[];uf(t,ki,e,Iu(e)),V0(b2,t)}}function k2(e,t,o){e==="focusin"?(sh(),ui=t,ki=o,ui.attachEvent("onpropertychange",hf)):e==="focusout"&&sh()}function _2(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Pl(ki)}function S2(e,t){if(e==="click")return Pl(t)}function N2(e,t){if(e==="input"||e==="change")return Pl(t)}function E2(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var vo=typeof Object.is=="function"?Object.is:E2;function _i(e,t){if(vo(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var o=Object.keys(e),r=Object.keys(t);if(o.length!==r.length)return!1;for(r=0;r<o.length;r++){var a=o[r];if(!od.call(t,a)||!vo(e[a],t[a]))return!1}return!0}function lh(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ch(e,t){var o=lh(e);e=0;for(var r;o;){if(o.nodeType===3){if(r=e+o.textContent.length,e<=t&&r>=t)return{node:o,offset:t-e};e=r}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=lh(o)}}function mf(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?mf(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function gf(){for(var e=window,t=Us();t instanceof e.HTMLIFrameElement;){try{var o=typeof t.contentWindow.location.href=="string"}catch{o=!1}if(o)e=t.contentWindow;else break;t=Us(e.document)}return t}function Ou(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function P2(e){var t=gf(),o=e.focusedElem,r=e.selectionRange;if(t!==o&&o&&o.ownerDocument&&mf(o.ownerDocument.documentElement,o)){if(r!==null&&Ou(o)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in o)o.selectionStart=t,o.selectionEnd=Math.min(e,o.value.length);else if(e=(t=o.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=o.textContent.length,i=Math.min(r.start,a);r=r.end===void 0?i:Math.min(r.end,a),!e.extend&&i>r&&(a=r,r=i,i=a),a=ch(o,i);var s=ch(o,r);a&&s&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}}for(t=[],e=o;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<t.length;o++)e=t[o],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var T2=Ho&&"documentMode"in document&&11>=document.documentMode,sa=null,Cd=null,pi=null,kd=!1;function dh(e,t,o){var r=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;kd||sa==null||sa!==Us(r)||(r=sa,"selectionStart"in r&&Ou(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),pi&&_i(pi,r)||(pi=r,r=Xs(Cd,"onSelect"),0<r.length&&(t=new Du("onSelect","select",null,t,o),e.push({event:t,listeners:r}),t.target=sa)))}function Qi(e,t){var o={};return o[e.toLowerCase()]=t.toLowerCase(),o["Webkit"+e]="webkit"+t,o["Moz"+e]="moz"+t,o}var la={animationend:Qi("Animation","AnimationEnd"),animationiteration:Qi("Animation","AnimationIteration"),animationstart:Qi("Animation","AnimationStart"),transitionend:Qi("Transition","TransitionEnd")},Sc={},ff={};Ho&&(ff=document.createElement("div").style,"AnimationEvent"in window||(delete la.animationend.animation,delete la.animationiteration.animation,delete la.animationstart.animation),"TransitionEvent"in window||delete la.transitionend.transition);function Tl(e){if(Sc[e])return Sc[e];if(!la[e])return e;var t=la[e],o;for(o in t)if(t.hasOwnProperty(o)&&o in ff)return Sc[e]=t[o];return e}var xf=Tl("animationend"),yf=Tl("animationiteration"),vf=Tl("animationstart"),wf=Tl("transitionend"),bf=new Map,uh="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Cr(e,t){bf.set(e,t),Ur(t,[e])}for(var Nc=0;Nc<uh.length;Nc++){var Ec=uh[Nc],I2=Ec.toLowerCase(),j2=Ec[0].toUpperCase()+Ec.slice(1);Cr(I2,"on"+j2)}Cr(xf,"onAnimationEnd");Cr(yf,"onAnimationIteration");Cr(vf,"onAnimationStart");Cr("dblclick","onDoubleClick");Cr("focusin","onFocus");Cr("focusout","onBlur");Cr(wf,"onTransitionEnd");Ea("onMouseEnter",["mouseout","mouseover"]);Ea("onMouseLeave",["mouseout","mouseover"]);Ea("onPointerEnter",["pointerout","pointerover"]);Ea("onPointerLeave",["pointerout","pointerover"]);Ur("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ur("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ur("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ur("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ur("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ur("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ai="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),A2=new Set("cancel close invalid load scroll toggle".split(" ").concat(ai));function ph(e,t,o){var r=e.type||"unknown-event";e.currentTarget=o,Iv(r,t,void 0,e),e.currentTarget=null}function Cf(e,t){t=(t&4)!==0;for(var o=0;o<e.length;o++){var r=e[o],a=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var s=r.length-1;0<=s;s--){var l=r[s],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&a.isPropagationStopped())break e;ph(a,l,d),i=c}else for(s=0;s<r.length;s++){if(l=r[s],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&a.isPropagationStopped())break e;ph(a,l,d),i=c}}}if(Ws)throw e=yd,Ws=!1,yd=null,e}function Kt(e,t){var o=t[Pd];o===void 0&&(o=t[Pd]=new Set);var r=e+"__bubble";o.has(r)||(kf(t,e,2,!1),o.add(r))}function Pc(e,t,o){var r=0;t&&(r|=4),kf(o,e,r,t)}var es="_reactListening"+Math.random().toString(36).slice(2);function Si(e){if(!e[es]){e[es]=!0,T0.forEach(function(o){o!=="selectionchange"&&(A2.has(o)||Pc(o,!1,e),Pc(o,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[es]||(t[es]=!0,Pc("selectionchange",!1,t))}}function kf(e,t,o,r){switch(af(t)){case 1:var a=Wv;break;case 4:a=$v;break;default:a=Ru}o=a.bind(null,t,o,e),a=void 0,!xd||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),r?a!==void 0?e.addEventListener(t,o,{capture:!0,passive:a}):e.addEventListener(t,o,!0):a!==void 0?e.addEventListener(t,o,{passive:a}):e.addEventListener(t,o,!1)}function Tc(e,t,o,r,a){var i=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var l=r.stateNode.containerInfo;if(l===a||l.nodeType===8&&l.parentNode===a)break;if(s===4)for(s=r.return;s!==null;){var c=s.tag;if((c===3||c===4)&&(c=s.stateNode.containerInfo,c===a||c.nodeType===8&&c.parentNode===a))return;s=s.return}for(;l!==null;){if(s=Mr(l),s===null)return;if(c=s.tag,c===5||c===6){r=i=s;continue e}l=l.parentNode}}r=r.return}V0(function(){var d=i,u=Iu(o),p=[];e:{var h=bf.get(e);if(h!==void 0){var x=Du,k=e;switch(e){case"keypress":if(Ts(o)===0)break e;case"keydown":case"keyup":x=l2;break;case"focusin":k="focus",x=Cc;break;case"focusout":k="blur",x=Cc;break;case"beforeblur":case"afterblur":x=Cc;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=eh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=Yv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=u2;break;case xf:case yf:case vf:x=Qv;break;case wf:x=h2;break;case"scroll":x=Kv;break;case"wheel":x=g2;break;case"copy":case"cut":case"paste":x=t2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=nh}var C=(t&4)!==0,w=!C&&e==="scroll",f=C?h!==null?h+"Capture":null:h;C=[];for(var g=d,v;g!==null;){v=g;var _=v.stateNode;if(v.tag===5&&_!==null&&(v=_,f!==null&&(_=vi(g,f),_!=null&&C.push(Ni(g,_,v)))),w)break;g=g.return}0<C.length&&(h=new x(h,k,null,o,u),p.push({event:h,listeners:C}))}}if(!(t&7)){e:{if(h=e==="mouseover"||e==="pointerover",x=e==="mouseout"||e==="pointerout",h&&o!==gd&&(k=o.relatedTarget||o.fromElement)&&(Mr(k)||k[Uo]))break e;if((x||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,x?(k=o.relatedTarget||o.toElement,x=d,k=k?Mr(k):null,k!==null&&(w=Vr(k),k!==w||k.tag!==5&&k.tag!==6)&&(k=null)):(x=null,k=d),x!==k)){if(C=eh,_="onMouseLeave",f="onMouseEnter",g="mouse",(e==="pointerout"||e==="pointerover")&&(C=nh,_="onPointerLeave",f="onPointerEnter",g="pointer"),w=x==null?h:ca(x),v=k==null?h:ca(k),h=new C(_,g+"leave",x,o,u),h.target=w,h.relatedTarget=v,_=null,Mr(u)===d&&(C=new C(f,g+"enter",k,o,u),C.target=v,C.relatedTarget=w,_=C),w=_,x&&k)t:{for(C=x,f=k,g=0,v=C;v;v=$r(v))g++;for(v=0,_=f;_;_=$r(_))v++;for(;0<g-v;)C=$r(C),g--;for(;0<v-g;)f=$r(f),v--;for(;g--;){if(C===f||f!==null&&C===f.alternate)break t;C=$r(C),f=$r(f)}C=null}else C=null;x!==null&&hh(p,h,x,C,!1),k!==null&&w!==null&&hh(p,w,k,C,!0)}}e:{if(h=d?ca(d):window,x=h.nodeName&&h.nodeName.toLowerCase(),x==="select"||x==="input"&&h.type==="file")var S=C2;else if(ah(h))if(pf)S=N2;else{S=_2;var T=k2}else(x=h.nodeName)&&x.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(S=S2);if(S&&(S=S(e,d))){uf(p,S,o,u);break e}T&&T(e,h,d),e==="focusout"&&(T=h._wrapperState)&&T.controlled&&h.type==="number"&&dd(h,"number",h.value)}switch(T=d?ca(d):window,e){case"focusin":(ah(T)||T.contentEditable==="true")&&(sa=T,Cd=d,pi=null);break;case"focusout":pi=Cd=sa=null;break;case"mousedown":kd=!0;break;case"contextmenu":case"mouseup":case"dragend":kd=!1,dh(p,o,u);break;case"selectionchange":if(T2)break;case"keydown":case"keyup":dh(p,o,u)}var P;if(qu)e:{switch(e){case"compositionstart":var R="onCompositionStart";break e;case"compositionend":R="onCompositionEnd";break e;case"compositionupdate":R="onCompositionUpdate";break e}R=void 0}else ia?cf(e,o)&&(R="onCompositionEnd"):e==="keydown"&&o.keyCode===229&&(R="onCompositionStart");R&&(lf&&o.locale!=="ko"&&(ia||R!=="onCompositionStart"?R==="onCompositionEnd"&&ia&&(P=sf()):(lr=u,Lu="value"in lr?lr.value:lr.textContent,ia=!0)),T=Xs(d,R),0<T.length&&(R=new th(R,e,null,o,u),p.push({event:R,listeners:T}),P?R.data=P:(P=df(o),P!==null&&(R.data=P)))),(P=x2?y2(e,o):v2(e,o))&&(d=Xs(d,"onBeforeInput"),0<d.length&&(u=new th("onBeforeInput","beforeinput",null,o,u),p.push({event:u,listeners:d}),u.data=P))}Cf(p,t)})}function Ni(e,t,o){return{instance:e,listener:t,currentTarget:o}}function Xs(e,t){for(var o=t+"Capture",r=[];e!==null;){var a=e,i=a.stateNode;a.tag===5&&i!==null&&(a=i,i=vi(e,o),i!=null&&r.unshift(Ni(e,i,a)),i=vi(e,t),i!=null&&r.push(Ni(e,i,a))),e=e.return}return r}function $r(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function hh(e,t,o,r,a){for(var i=t._reactName,s=[];o!==null&&o!==r;){var l=o,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,a?(c=vi(o,i),c!=null&&s.unshift(Ni(o,c,l))):a||(c=vi(o,i),c!=null&&s.push(Ni(o,c,l)))),o=o.return}s.length!==0&&e.push({event:t,listeners:s})}var M2=/\r\n?/g,R2=/\u0000|\uFFFD/g;function mh(e){return(typeof e=="string"?e:""+e).replace(M2,`
`).replace(R2,"")}function ts(e,t,o){if(t=mh(t),mh(e)!==t&&o)throw Error(Ye(425))}function Zs(){}var _d=null,Sd=null;function Nd(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Ed=typeof setTimeout=="function"?setTimeout:void 0,L2=typeof clearTimeout=="function"?clearTimeout:void 0,gh=typeof Promise=="function"?Promise:void 0,D2=typeof queueMicrotask=="function"?queueMicrotask:typeof gh<"u"?function(e){return gh.resolve(null).then(e).catch(z2)}:Ed;function z2(e){setTimeout(function(){throw e})}function Ic(e,t){var o=t,r=0;do{var a=o.nextSibling;if(e.removeChild(o),a&&a.nodeType===8)if(o=a.data,o==="/$"){if(r===0){e.removeChild(a),Ci(t);return}r--}else o!=="$"&&o!=="$?"&&o!=="$!"||r++;o=a}while(o);Ci(t)}function hr(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function fh(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var o=e.data;if(o==="$"||o==="$!"||o==="$?"){if(t===0)return e;t--}else o==="/$"&&t++}e=e.previousSibling}return null}var Fa=Math.random().toString(36).slice(2),So="__reactFiber$"+Fa,Ei="__reactProps$"+Fa,Uo="__reactContainer$"+Fa,Pd="__reactEvents$"+Fa,q2="__reactListeners$"+Fa,O2="__reactHandles$"+Fa;function Mr(e){var t=e[So];if(t)return t;for(var o=e.parentNode;o;){if(t=o[Uo]||o[So]){if(o=t.alternate,t.child!==null||o!==null&&o.child!==null)for(e=fh(e);e!==null;){if(o=e[So])return o;e=fh(e)}return t}e=o,o=e.parentNode}return null}function Oi(e){return e=e[So]||e[Uo],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ca(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Ye(33))}function Il(e){return e[Ei]||null}var Td=[],da=-1;function kr(e){return{current:e}}function Yt(e){0>da||(e.current=Td[da],Td[da]=null,da--)}function $t(e,t){da++,Td[da]=e.current,e.current=t}var wr={},Tn=kr(wr),Gn=kr(!1),Or=wr;function Pa(e,t){var o=e.type.contextTypes;if(!o)return wr;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a={},i;for(i in o)a[i]=t[i];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Hn(e){return e=e.childContextTypes,e!=null}function Qs(){Yt(Gn),Yt(Tn)}function xh(e,t,o){if(Tn.current!==wr)throw Error(Ye(168));$t(Tn,t),$t(Gn,o)}function _f(e,t,o){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return o;r=r.getChildContext();for(var a in r)if(!(a in t))throw Error(Ye(108,kv(e)||"Unknown",a));return tn({},o,r)}function el(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||wr,Or=Tn.current,$t(Tn,e),$t(Gn,Gn.current),!0}function yh(e,t,o){var r=e.stateNode;if(!r)throw Error(Ye(169));o?(e=_f(e,t,Or),r.__reactInternalMemoizedMergedChildContext=e,Yt(Gn),Yt(Tn),$t(Tn,e)):Yt(Gn),$t(Gn,o)}var Oo=null,jl=!1,jc=!1;function Sf(e){Oo===null?Oo=[e]:Oo.push(e)}function F2(e){jl=!0,Sf(e)}function _r(){if(!jc&&Oo!==null){jc=!0;var e=0,t=Bt;try{var o=Oo;for(Bt=1;e<o.length;e++){var r=o[e];do r=r(!0);while(r!==null)}Oo=null,jl=!1}catch(a){throw Oo!==null&&(Oo=Oo.slice(e+1)),J0(ju,_r),a}finally{Bt=t,jc=!1}}return null}var ua=[],pa=0,tl=null,nl=0,eo=[],to=0,Fr=null,Fo=1,Bo="";function Tr(e,t){ua[pa++]=nl,ua[pa++]=tl,tl=e,nl=t}function Nf(e,t,o){eo[to++]=Fo,eo[to++]=Bo,eo[to++]=Fr,Fr=e;var r=Fo;e=Bo;var a=32-go(r)-1;r&=~(1<<a),o+=1;var i=32-go(t)+a;if(30<i){var s=a-a%5;i=(r&(1<<s)-1).toString(32),r>>=s,a-=s,Fo=1<<32-go(t)+a|o<<a|r,Bo=i+e}else Fo=1<<i|o<<a|r,Bo=e}function Fu(e){e.return!==null&&(Tr(e,1),Nf(e,1,0))}function Bu(e){for(;e===tl;)tl=ua[--pa],ua[pa]=null,nl=ua[--pa],ua[pa]=null;for(;e===Fr;)Fr=eo[--to],eo[to]=null,Bo=eo[--to],eo[to]=null,Fo=eo[--to],eo[to]=null}var Jn=null,$n=null,Xt=!1,mo=null;function Ef(e,t){var o=no(5,null,null,0);o.elementType="DELETED",o.stateNode=t,o.return=e,t=e.deletions,t===null?(e.deletions=[o],e.flags|=16):t.push(o)}function vh(e,t){switch(e.tag){case 5:var o=e.type;return t=t.nodeType!==1||o.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Jn=e,$n=hr(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Jn=e,$n=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(o=Fr!==null?{id:Fo,overflow:Bo}:null,e.memoizedState={dehydrated:t,treeContext:o,retryLane:1073741824},o=no(18,null,null,0),o.stateNode=t,o.return=e,e.child=o,Jn=e,$n=null,!0):!1;default:return!1}}function Id(e){return(e.mode&1)!==0&&(e.flags&128)===0}function jd(e){if(Xt){var t=$n;if(t){var o=t;if(!vh(e,t)){if(Id(e))throw Error(Ye(418));t=hr(o.nextSibling);var r=Jn;t&&vh(e,t)?Ef(r,o):(e.flags=e.flags&-4097|2,Xt=!1,Jn=e)}}else{if(Id(e))throw Error(Ye(418));e.flags=e.flags&-4097|2,Xt=!1,Jn=e}}}function wh(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Jn=e}function ns(e){if(e!==Jn)return!1;if(!Xt)return wh(e),Xt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Nd(e.type,e.memoizedProps)),t&&(t=$n)){if(Id(e))throw Pf(),Error(Ye(418));for(;t;)Ef(e,t),t=hr(t.nextSibling)}if(wh(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Ye(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var o=e.data;if(o==="/$"){if(t===0){$n=hr(e.nextSibling);break e}t--}else o!=="$"&&o!=="$!"&&o!=="$?"||t++}e=e.nextSibling}$n=null}}else $n=Jn?hr(e.stateNode.nextSibling):null;return!0}function Pf(){for(var e=$n;e;)e=hr(e.nextSibling)}function Ta(){$n=Jn=null,Xt=!1}function Gu(e){mo===null?mo=[e]:mo.push(e)}var B2=Ko.ReactCurrentBatchConfig;function Xa(e,t,o){if(e=o.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(Ye(309));var r=o.stateNode}if(!r)throw Error(Ye(147,e));var a=r,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(s){var l=a.refs;s===null?delete l[i]:l[i]=s},t._stringRef=i,t)}if(typeof e!="string")throw Error(Ye(284));if(!o._owner)throw Error(Ye(290,e))}return e}function os(e,t){throw e=Object.prototype.toString.call(t),Error(Ye(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function bh(e){var t=e._init;return t(e._payload)}function Tf(e){function t(f,g){if(e){var v=f.deletions;v===null?(f.deletions=[g],f.flags|=16):v.push(g)}}function o(f,g){if(!e)return null;for(;g!==null;)t(f,g),g=g.sibling;return null}function r(f,g){for(f=new Map;g!==null;)g.key!==null?f.set(g.key,g):f.set(g.index,g),g=g.sibling;return f}function a(f,g){return f=xr(f,g),f.index=0,f.sibling=null,f}function i(f,g,v){return f.index=v,e?(v=f.alternate,v!==null?(v=v.index,v<g?(f.flags|=2,g):v):(f.flags|=2,g)):(f.flags|=1048576,g)}function s(f){return e&&f.alternate===null&&(f.flags|=2),f}function l(f,g,v,_){return g===null||g.tag!==6?(g=qc(v,f.mode,_),g.return=f,g):(g=a(g,v),g.return=f,g)}function c(f,g,v,_){var S=v.type;return S===aa?u(f,g,v.props.children,_,v.key):g!==null&&(g.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===rr&&bh(S)===g.type)?(_=a(g,v.props),_.ref=Xa(f,g,v),_.return=f,_):(_=Ds(v.type,v.key,v.props,null,f.mode,_),_.ref=Xa(f,g,v),_.return=f,_)}function d(f,g,v,_){return g===null||g.tag!==4||g.stateNode.containerInfo!==v.containerInfo||g.stateNode.implementation!==v.implementation?(g=Oc(v,f.mode,_),g.return=f,g):(g=a(g,v.children||[]),g.return=f,g)}function u(f,g,v,_,S){return g===null||g.tag!==7?(g=zr(v,f.mode,_,S),g.return=f,g):(g=a(g,v),g.return=f,g)}function p(f,g,v){if(typeof g=="string"&&g!==""||typeof g=="number")return g=qc(""+g,f.mode,v),g.return=f,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Wi:return v=Ds(g.type,g.key,g.props,null,f.mode,v),v.ref=Xa(f,null,g),v.return=f,v;case ra:return g=Oc(g,f.mode,v),g.return=f,g;case rr:var _=g._init;return p(f,_(g._payload),v)}if(oi(g)||Wa(g))return g=zr(g,f.mode,v,null),g.return=f,g;os(f,g)}return null}function h(f,g,v,_){var S=g!==null?g.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return S!==null?null:l(f,g,""+v,_);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Wi:return v.key===S?c(f,g,v,_):null;case ra:return v.key===S?d(f,g,v,_):null;case rr:return S=v._init,h(f,g,S(v._payload),_)}if(oi(v)||Wa(v))return S!==null?null:u(f,g,v,_,null);os(f,v)}return null}function x(f,g,v,_,S){if(typeof _=="string"&&_!==""||typeof _=="number")return f=f.get(v)||null,l(g,f,""+_,S);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case Wi:return f=f.get(_.key===null?v:_.key)||null,c(g,f,_,S);case ra:return f=f.get(_.key===null?v:_.key)||null,d(g,f,_,S);case rr:var T=_._init;return x(f,g,v,T(_._payload),S)}if(oi(_)||Wa(_))return f=f.get(v)||null,u(g,f,_,S,null);os(g,_)}return null}function k(f,g,v,_){for(var S=null,T=null,P=g,R=g=0,D=null;P!==null&&R<v.length;R++){P.index>R?(D=P,P=null):D=P.sibling;var q=h(f,P,v[R],_);if(q===null){P===null&&(P=D);break}e&&P&&q.alternate===null&&t(f,P),g=i(q,g,R),T===null?S=q:T.sibling=q,T=q,P=D}if(R===v.length)return o(f,P),Xt&&Tr(f,R),S;if(P===null){for(;R<v.length;R++)P=p(f,v[R],_),P!==null&&(g=i(P,g,R),T===null?S=P:T.sibling=P,T=P);return Xt&&Tr(f,R),S}for(P=r(f,P);R<v.length;R++)D=x(P,f,R,v[R],_),D!==null&&(e&&D.alternate!==null&&P.delete(D.key===null?R:D.key),g=i(D,g,R),T===null?S=D:T.sibling=D,T=D);return e&&P.forEach(function(O){return t(f,O)}),Xt&&Tr(f,R),S}function C(f,g,v,_){var S=Wa(v);if(typeof S!="function")throw Error(Ye(150));if(v=S.call(v),v==null)throw Error(Ye(151));for(var T=S=null,P=g,R=g=0,D=null,q=v.next();P!==null&&!q.done;R++,q=v.next()){P.index>R?(D=P,P=null):D=P.sibling;var O=h(f,P,q.value,_);if(O===null){P===null&&(P=D);break}e&&P&&O.alternate===null&&t(f,P),g=i(O,g,R),T===null?S=O:T.sibling=O,T=O,P=D}if(q.done)return o(f,P),Xt&&Tr(f,R),S;if(P===null){for(;!q.done;R++,q=v.next())q=p(f,q.value,_),q!==null&&(g=i(q,g,R),T===null?S=q:T.sibling=q,T=q);return Xt&&Tr(f,R),S}for(P=r(f,P);!q.done;R++,q=v.next())q=x(P,f,R,q.value,_),q!==null&&(e&&q.alternate!==null&&P.delete(q.key===null?R:q.key),g=i(q,g,R),T===null?S=q:T.sibling=q,T=q);return e&&P.forEach(function(E){return t(f,E)}),Xt&&Tr(f,R),S}function w(f,g,v,_){if(typeof v=="object"&&v!==null&&v.type===aa&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case Wi:e:{for(var S=v.key,T=g;T!==null;){if(T.key===S){if(S=v.type,S===aa){if(T.tag===7){o(f,T.sibling),g=a(T,v.props.children),g.return=f,f=g;break e}}else if(T.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===rr&&bh(S)===T.type){o(f,T.sibling),g=a(T,v.props),g.ref=Xa(f,T,v),g.return=f,f=g;break e}o(f,T);break}else t(f,T);T=T.sibling}v.type===aa?(g=zr(v.props.children,f.mode,_,v.key),g.return=f,f=g):(_=Ds(v.type,v.key,v.props,null,f.mode,_),_.ref=Xa(f,g,v),_.return=f,f=_)}return s(f);case ra:e:{for(T=v.key;g!==null;){if(g.key===T)if(g.tag===4&&g.stateNode.containerInfo===v.containerInfo&&g.stateNode.implementation===v.implementation){o(f,g.sibling),g=a(g,v.children||[]),g.return=f,f=g;break e}else{o(f,g);break}else t(f,g);g=g.sibling}g=Oc(v,f.mode,_),g.return=f,f=g}return s(f);case rr:return T=v._init,w(f,g,T(v._payload),_)}if(oi(v))return k(f,g,v,_);if(Wa(v))return C(f,g,v,_);os(f,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,g!==null&&g.tag===6?(o(f,g.sibling),g=a(g,v),g.return=f,f=g):(o(f,g),g=qc(v,f.mode,_),g.return=f,f=g),s(f)):o(f,g)}return w}var Ia=Tf(!0),If=Tf(!1),ol=kr(null),rl=null,ha=null,Hu=null;function Uu(){Hu=ha=rl=null}function Vu(e){var t=ol.current;Yt(ol),e._currentValue=t}function Ad(e,t,o){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===o)break;e=e.return}}function Ca(e,t){rl=e,Hu=ha=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Fn=!0),e.firstContext=null)}function ao(e){var t=e._currentValue;if(Hu!==e)if(e={context:e,memoizedValue:t,next:null},ha===null){if(rl===null)throw Error(Ye(308));ha=e,rl.dependencies={lanes:0,firstContext:e}}else ha=ha.next=e;return t}var Rr=null;function Wu(e){Rr===null?Rr=[e]:Rr.push(e)}function jf(e,t,o,r){var a=t.interleaved;return a===null?(o.next=o,Wu(t)):(o.next=a.next,a.next=o),t.interleaved=o,Vo(e,r)}function Vo(e,t){e.lanes|=t;var o=e.alternate;for(o!==null&&(o.lanes|=t),o=e,e=e.return;e!==null;)e.childLanes|=t,o=e.alternate,o!==null&&(o.childLanes|=t),o=e,e=e.return;return o.tag===3?o.stateNode:null}var ar=!1;function $u(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Af(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Go(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function mr(e,t,o){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Mt&2){var a=r.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Vo(e,o)}return a=r.interleaved,a===null?(t.next=t,Wu(r)):(t.next=a.next,a.next=t),r.interleaved=t,Vo(e,o)}function Is(e,t,o){if(t=t.updateQueue,t!==null&&(t=t.shared,(o&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,o|=r,t.lanes=o,Au(e,o)}}function Ch(e,t){var o=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,o===r)){var a=null,i=null;if(o=o.firstBaseUpdate,o!==null){do{var s={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};i===null?a=i=s:i=i.next=s,o=o.next}while(o!==null);i===null?a=i=t:i=i.next=t}else a=i=t;o={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},e.updateQueue=o;return}e=o.lastBaseUpdate,e===null?o.firstBaseUpdate=t:e.next=t,o.lastBaseUpdate=t}function al(e,t,o,r){var a=e.updateQueue;ar=!1;var i=a.firstBaseUpdate,s=a.lastBaseUpdate,l=a.shared.pending;if(l!==null){a.shared.pending=null;var c=l,d=c.next;c.next=null,s===null?i=d:s.next=d,s=c;var u=e.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==s&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(i!==null){var p=a.baseState;s=0,u=d=c=null,l=i;do{var h=l.lane,x=l.eventTime;if((r&h)===h){u!==null&&(u=u.next={eventTime:x,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var k=e,C=l;switch(h=t,x=o,C.tag){case 1:if(k=C.payload,typeof k=="function"){p=k.call(x,p,h);break e}p=k;break e;case 3:k.flags=k.flags&-65537|128;case 0:if(k=C.payload,h=typeof k=="function"?k.call(x,p,h):k,h==null)break e;p=tn({},p,h);break e;case 2:ar=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,h=a.effects,h===null?a.effects=[l]:h.push(l))}else x={eventTime:x,lane:h,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=x,c=p):u=u.next=x,s|=h;if(l=l.next,l===null){if(l=a.shared.pending,l===null)break;h=l,l=h.next,h.next=null,a.lastBaseUpdate=h,a.shared.pending=null}}while(!0);if(u===null&&(c=p),a.baseState=c,a.firstBaseUpdate=d,a.lastBaseUpdate=u,t=a.shared.interleaved,t!==null){a=t;do s|=a.lane,a=a.next;while(a!==t)}else i===null&&(a.shared.lanes=0);Gr|=s,e.lanes=s,e.memoizedState=p}}function kh(e,t,o){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(a!==null){if(r.callback=null,r=o,typeof a!="function")throw Error(Ye(191,a));a.call(r)}}}var Fi={},To=kr(Fi),Pi=kr(Fi),Ti=kr(Fi);function Lr(e){if(e===Fi)throw Error(Ye(174));return e}function Ku(e,t){switch($t(Ti,t),$t(Pi,e),$t(To,Fi),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:pd(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=pd(t,e)}Yt(To),$t(To,t)}function ja(){Yt(To),Yt(Pi),Yt(Ti)}function Mf(e){Lr(Ti.current);var t=Lr(To.current),o=pd(t,e.type);t!==o&&($t(Pi,e),$t(To,o))}function Ju(e){Pi.current===e&&(Yt(To),Yt(Pi))}var Qt=kr(0);function il(e){for(var t=e;t!==null;){if(t.tag===13){var o=t.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Ac=[];function Yu(){for(var e=0;e<Ac.length;e++)Ac[e]._workInProgressVersionPrimary=null;Ac.length=0}var js=Ko.ReactCurrentDispatcher,Mc=Ko.ReactCurrentBatchConfig,Br=0,en=null,un=null,mn=null,sl=!1,hi=!1,Ii=0,G2=0;function kn(){throw Error(Ye(321))}function Xu(e,t){if(t===null)return!1;for(var o=0;o<t.length&&o<e.length;o++)if(!vo(e[o],t[o]))return!1;return!0}function Zu(e,t,o,r,a,i){if(Br=i,en=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,js.current=e===null||e.memoizedState===null?W2:$2,e=o(r,a),hi){i=0;do{if(hi=!1,Ii=0,25<=i)throw Error(Ye(301));i+=1,mn=un=null,t.updateQueue=null,js.current=K2,e=o(r,a)}while(hi)}if(js.current=ll,t=un!==null&&un.next!==null,Br=0,mn=un=en=null,sl=!1,t)throw Error(Ye(300));return e}function Qu(){var e=Ii!==0;return Ii=0,e}function _o(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return mn===null?en.memoizedState=mn=e:mn=mn.next=e,mn}function io(){if(un===null){var e=en.alternate;e=e!==null?e.memoizedState:null}else e=un.next;var t=mn===null?en.memoizedState:mn.next;if(t!==null)mn=t,un=e;else{if(e===null)throw Error(Ye(310));un=e,e={memoizedState:un.memoizedState,baseState:un.baseState,baseQueue:un.baseQueue,queue:un.queue,next:null},mn===null?en.memoizedState=mn=e:mn=mn.next=e}return mn}function ji(e,t){return typeof t=="function"?t(e):t}function Rc(e){var t=io(),o=t.queue;if(o===null)throw Error(Ye(311));o.lastRenderedReducer=e;var r=un,a=r.baseQueue,i=o.pending;if(i!==null){if(a!==null){var s=a.next;a.next=i.next,i.next=s}r.baseQueue=a=i,o.pending=null}if(a!==null){i=a.next,r=r.baseState;var l=s=null,c=null,d=i;do{var u=d.lane;if((Br&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:e(r,d.action);else{var p={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=p,s=r):c=c.next=p,en.lanes|=u,Gr|=u}d=d.next}while(d!==null&&d!==i);c===null?s=r:c.next=l,vo(r,t.memoizedState)||(Fn=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,o.lastRenderedState=r}if(e=o.interleaved,e!==null){a=e;do i=a.lane,en.lanes|=i,Gr|=i,a=a.next;while(a!==e)}else a===null&&(o.lanes=0);return[t.memoizedState,o.dispatch]}function Lc(e){var t=io(),o=t.queue;if(o===null)throw Error(Ye(311));o.lastRenderedReducer=e;var r=o.dispatch,a=o.pending,i=t.memoizedState;if(a!==null){o.pending=null;var s=a=a.next;do i=e(i,s.action),s=s.next;while(s!==a);vo(i,t.memoizedState)||(Fn=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),o.lastRenderedState=i}return[i,r]}function Rf(){}function Lf(e,t){var o=en,r=io(),a=t(),i=!vo(r.memoizedState,a);if(i&&(r.memoizedState=a,Fn=!0),r=r.queue,ep(qf.bind(null,o,r,e),[e]),r.getSnapshot!==t||i||mn!==null&&mn.memoizedState.tag&1){if(o.flags|=2048,Ai(9,zf.bind(null,o,r,a,t),void 0,null),gn===null)throw Error(Ye(349));Br&30||Df(o,t,a)}return a}function Df(e,t,o){e.flags|=16384,e={getSnapshot:t,value:o},t=en.updateQueue,t===null?(t={lastEffect:null,stores:null},en.updateQueue=t,t.stores=[e]):(o=t.stores,o===null?t.stores=[e]:o.push(e))}function zf(e,t,o,r){t.value=o,t.getSnapshot=r,Of(t)&&Ff(e)}function qf(e,t,o){return o(function(){Of(t)&&Ff(e)})}function Of(e){var t=e.getSnapshot;e=e.value;try{var o=t();return!vo(e,o)}catch{return!0}}function Ff(e){var t=Vo(e,1);t!==null&&fo(t,e,1,-1)}function _h(e){var t=_o();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ji,lastRenderedState:e},t.queue=e,e=e.dispatch=V2.bind(null,en,e),[t.memoizedState,e]}function Ai(e,t,o,r){return e={tag:e,create:t,destroy:o,deps:r,next:null},t=en.updateQueue,t===null?(t={lastEffect:null,stores:null},en.updateQueue=t,t.lastEffect=e.next=e):(o=t.lastEffect,o===null?t.lastEffect=e.next=e:(r=o.next,o.next=e,e.next=r,t.lastEffect=e)),e}function Bf(){return io().memoizedState}function As(e,t,o,r){var a=_o();en.flags|=e,a.memoizedState=Ai(1|t,o,void 0,r===void 0?null:r)}function Al(e,t,o,r){var a=io();r=r===void 0?null:r;var i=void 0;if(un!==null){var s=un.memoizedState;if(i=s.destroy,r!==null&&Xu(r,s.deps)){a.memoizedState=Ai(t,o,i,r);return}}en.flags|=e,a.memoizedState=Ai(1|t,o,i,r)}function Sh(e,t){return As(8390656,8,e,t)}function ep(e,t){return Al(2048,8,e,t)}function Gf(e,t){return Al(4,2,e,t)}function Hf(e,t){return Al(4,4,e,t)}function Uf(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Vf(e,t,o){return o=o!=null?o.concat([e]):null,Al(4,4,Uf.bind(null,t,e),o)}function tp(){}function Wf(e,t){var o=io();t=t===void 0?null:t;var r=o.memoizedState;return r!==null&&t!==null&&Xu(t,r[1])?r[0]:(o.memoizedState=[e,t],e)}function $f(e,t){var o=io();t=t===void 0?null:t;var r=o.memoizedState;return r!==null&&t!==null&&Xu(t,r[1])?r[0]:(e=e(),o.memoizedState=[e,t],e)}function Kf(e,t,o){return Br&21?(vo(o,t)||(o=Z0(),en.lanes|=o,Gr|=o,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Fn=!0),e.memoizedState=o)}function H2(e,t){var o=Bt;Bt=o!==0&&4>o?o:4,e(!0);var r=Mc.transition;Mc.transition={};try{e(!1),t()}finally{Bt=o,Mc.transition=r}}function Jf(){return io().memoizedState}function U2(e,t,o){var r=fr(e);if(o={lane:r,action:o,hasEagerState:!1,eagerState:null,next:null},Yf(e))Xf(t,o);else if(o=jf(e,t,o,r),o!==null){var a=An();fo(o,e,r,a),Zf(o,t,r)}}function V2(e,t,o){var r=fr(e),a={lane:r,action:o,hasEagerState:!1,eagerState:null,next:null};if(Yf(e))Xf(t,a);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var s=t.lastRenderedState,l=i(s,o);if(a.hasEagerState=!0,a.eagerState=l,vo(l,s)){var c=t.interleaved;c===null?(a.next=a,Wu(t)):(a.next=c.next,c.next=a),t.interleaved=a;return}}catch{}finally{}o=jf(e,t,a,r),o!==null&&(a=An(),fo(o,e,r,a),Zf(o,t,r))}}function Yf(e){var t=e.alternate;return e===en||t!==null&&t===en}function Xf(e,t){hi=sl=!0;var o=e.pending;o===null?t.next=t:(t.next=o.next,o.next=t),e.pending=t}function Zf(e,t,o){if(o&4194240){var r=t.lanes;r&=e.pendingLanes,o|=r,t.lanes=o,Au(e,o)}}var ll={readContext:ao,useCallback:kn,useContext:kn,useEffect:kn,useImperativeHandle:kn,useInsertionEffect:kn,useLayoutEffect:kn,useMemo:kn,useReducer:kn,useRef:kn,useState:kn,useDebugValue:kn,useDeferredValue:kn,useTransition:kn,useMutableSource:kn,useSyncExternalStore:kn,useId:kn,unstable_isNewReconciler:!1},W2={readContext:ao,useCallback:function(e,t){return _o().memoizedState=[e,t===void 0?null:t],e},useContext:ao,useEffect:Sh,useImperativeHandle:function(e,t,o){return o=o!=null?o.concat([e]):null,As(4194308,4,Uf.bind(null,t,e),o)},useLayoutEffect:function(e,t){return As(4194308,4,e,t)},useInsertionEffect:function(e,t){return As(4,2,e,t)},useMemo:function(e,t){var o=_o();return t=t===void 0?null:t,e=e(),o.memoizedState=[e,t],e},useReducer:function(e,t,o){var r=_o();return t=o!==void 0?o(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=U2.bind(null,en,e),[r.memoizedState,e]},useRef:function(e){var t=_o();return e={current:e},t.memoizedState=e},useState:_h,useDebugValue:tp,useDeferredValue:function(e){return _o().memoizedState=e},useTransition:function(){var e=_h(!1),t=e[0];return e=H2.bind(null,e[1]),_o().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,o){var r=en,a=_o();if(Xt){if(o===void 0)throw Error(Ye(407));o=o()}else{if(o=t(),gn===null)throw Error(Ye(349));Br&30||Df(r,t,o)}a.memoizedState=o;var i={value:o,getSnapshot:t};return a.queue=i,Sh(qf.bind(null,r,i,e),[e]),r.flags|=2048,Ai(9,zf.bind(null,r,i,o,t),void 0,null),o},useId:function(){var e=_o(),t=gn.identifierPrefix;if(Xt){var o=Bo,r=Fo;o=(r&~(1<<32-go(r)-1)).toString(32)+o,t=":"+t+"R"+o,o=Ii++,0<o&&(t+="H"+o.toString(32)),t+=":"}else o=G2++,t=":"+t+"r"+o.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},$2={readContext:ao,useCallback:Wf,useContext:ao,useEffect:ep,useImperativeHandle:Vf,useInsertionEffect:Gf,useLayoutEffect:Hf,useMemo:$f,useReducer:Rc,useRef:Bf,useState:function(){return Rc(ji)},useDebugValue:tp,useDeferredValue:function(e){var t=io();return Kf(t,un.memoizedState,e)},useTransition:function(){var e=Rc(ji)[0],t=io().memoizedState;return[e,t]},useMutableSource:Rf,useSyncExternalStore:Lf,useId:Jf,unstable_isNewReconciler:!1},K2={readContext:ao,useCallback:Wf,useContext:ao,useEffect:ep,useImperativeHandle:Vf,useInsertionEffect:Gf,useLayoutEffect:Hf,useMemo:$f,useReducer:Lc,useRef:Bf,useState:function(){return Lc(ji)},useDebugValue:tp,useDeferredValue:function(e){var t=io();return un===null?t.memoizedState=e:Kf(t,un.memoizedState,e)},useTransition:function(){var e=Lc(ji)[0],t=io().memoizedState;return[e,t]},useMutableSource:Rf,useSyncExternalStore:Lf,useId:Jf,unstable_isNewReconciler:!1};function po(e,t){if(e&&e.defaultProps){t=tn({},t),e=e.defaultProps;for(var o in e)t[o]===void 0&&(t[o]=e[o]);return t}return t}function Md(e,t,o,r){t=e.memoizedState,o=o(r,t),o=o==null?t:tn({},t,o),e.memoizedState=o,e.lanes===0&&(e.updateQueue.baseState=o)}var Ml={isMounted:function(e){return(e=e._reactInternals)?Vr(e)===e:!1},enqueueSetState:function(e,t,o){e=e._reactInternals;var r=An(),a=fr(e),i=Go(r,a);i.payload=t,o!=null&&(i.callback=o),t=mr(e,i,a),t!==null&&(fo(t,e,a,r),Is(t,e,a))},enqueueReplaceState:function(e,t,o){e=e._reactInternals;var r=An(),a=fr(e),i=Go(r,a);i.tag=1,i.payload=t,o!=null&&(i.callback=o),t=mr(e,i,a),t!==null&&(fo(t,e,a,r),Is(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var o=An(),r=fr(e),a=Go(o,r);a.tag=2,t!=null&&(a.callback=t),t=mr(e,a,r),t!==null&&(fo(t,e,r,o),Is(t,e,r))}};function Nh(e,t,o,r,a,i,s){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,i,s):t.prototype&&t.prototype.isPureReactComponent?!_i(o,r)||!_i(a,i):!0}function Qf(e,t,o){var r=!1,a=wr,i=t.contextType;return typeof i=="object"&&i!==null?i=ao(i):(a=Hn(t)?Or:Tn.current,r=t.contextTypes,i=(r=r!=null)?Pa(e,a):wr),t=new t(o,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Ml,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function Eh(e,t,o,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(o,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(o,r),t.state!==e&&Ml.enqueueReplaceState(t,t.state,null)}function Rd(e,t,o,r){var a=e.stateNode;a.props=o,a.state=e.memoizedState,a.refs={},$u(e);var i=t.contextType;typeof i=="object"&&i!==null?a.context=ao(i):(i=Hn(t)?Or:Tn.current,a.context=Pa(e,i)),a.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(Md(e,t,i,o),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&Ml.enqueueReplaceState(a,a.state,null),al(e,o,a,r),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function Aa(e,t){try{var o="",r=t;do o+=Cv(r),r=r.return;while(r);var a=o}catch(i){a=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:a,digest:null}}function Dc(e,t,o){return{value:e,source:null,stack:o??null,digest:t??null}}function Ld(e,t){try{console.error(t.value)}catch(o){setTimeout(function(){throw o})}}var J2=typeof WeakMap=="function"?WeakMap:Map;function ex(e,t,o){o=Go(-1,o),o.tag=3,o.payload={element:null};var r=t.value;return o.callback=function(){dl||(dl=!0,Vd=r),Ld(e,t)},o}function tx(e,t,o){o=Go(-1,o),o.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var a=t.value;o.payload=function(){return r(a)},o.callback=function(){Ld(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(o.callback=function(){Ld(e,t),typeof r!="function"&&(gr===null?gr=new Set([this]):gr.add(this));var s=t.stack;this.componentDidCatch(t.value,{componentStack:s!==null?s:""})}),o}function Ph(e,t,o){var r=e.pingCache;if(r===null){r=e.pingCache=new J2;var a=new Set;r.set(t,a)}else a=r.get(t),a===void 0&&(a=new Set,r.set(t,a));a.has(o)||(a.add(o),e=cw.bind(null,e,t,o),t.then(e,e))}function Th(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Ih(e,t,o,r,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(t=Go(-1,1),t.tag=2,mr(o,t,1))),o.lanes|=1),e)}var Y2=Ko.ReactCurrentOwner,Fn=!1;function jn(e,t,o,r){t.child=e===null?If(t,null,o,r):Ia(t,e.child,o,r)}function jh(e,t,o,r,a){o=o.render;var i=t.ref;return Ca(t,a),r=Zu(e,t,o,r,i,a),o=Qu(),e!==null&&!Fn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Wo(e,t,a)):(Xt&&o&&Fu(t),t.flags|=1,jn(e,t,r,a),t.child)}function Ah(e,t,o,r,a){if(e===null){var i=o.type;return typeof i=="function"&&!cp(i)&&i.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(t.tag=15,t.type=i,nx(e,t,i,r,a)):(e=Ds(o.type,null,r,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&a)){var s=i.memoizedProps;if(o=o.compare,o=o!==null?o:_i,o(s,r)&&e.ref===t.ref)return Wo(e,t,a)}return t.flags|=1,e=xr(i,r),e.ref=t.ref,e.return=t,t.child=e}function nx(e,t,o,r,a){if(e!==null){var i=e.memoizedProps;if(_i(i,r)&&e.ref===t.ref)if(Fn=!1,t.pendingProps=r=i,(e.lanes&a)!==0)e.flags&131072&&(Fn=!0);else return t.lanes=e.lanes,Wo(e,t,a)}return Dd(e,t,o,r,a)}function ox(e,t,o){var r=t.pendingProps,a=r.children,i=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},$t(ga,Wn),Wn|=o;else{if(!(o&1073741824))return e=i!==null?i.baseLanes|o:o,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,$t(ga,Wn),Wn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:o,$t(ga,Wn),Wn|=r}else i!==null?(r=i.baseLanes|o,t.memoizedState=null):r=o,$t(ga,Wn),Wn|=r;return jn(e,t,a,o),t.child}function rx(e,t){var o=t.ref;(e===null&&o!==null||e!==null&&e.ref!==o)&&(t.flags|=512,t.flags|=2097152)}function Dd(e,t,o,r,a){var i=Hn(o)?Or:Tn.current;return i=Pa(t,i),Ca(t,a),o=Zu(e,t,o,r,i,a),r=Qu(),e!==null&&!Fn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Wo(e,t,a)):(Xt&&r&&Fu(t),t.flags|=1,jn(e,t,o,a),t.child)}function Mh(e,t,o,r,a){if(Hn(o)){var i=!0;el(t)}else i=!1;if(Ca(t,a),t.stateNode===null)Ms(e,t),Qf(t,o,r),Rd(t,o,r,a),r=!0;else if(e===null){var s=t.stateNode,l=t.memoizedProps;s.props=l;var c=s.context,d=o.contextType;typeof d=="object"&&d!==null?d=ao(d):(d=Hn(o)?Or:Tn.current,d=Pa(t,d));var u=o.getDerivedStateFromProps,p=typeof u=="function"||typeof s.getSnapshotBeforeUpdate=="function";p||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==r||c!==d)&&Eh(t,s,r,d),ar=!1;var h=t.memoizedState;s.state=h,al(t,r,s,a),c=t.memoizedState,l!==r||h!==c||Gn.current||ar?(typeof u=="function"&&(Md(t,o,u,r),c=t.memoizedState),(l=ar||Nh(t,o,l,r,h,c,d))?(p||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(t.flags|=4194308)):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),s.props=r,s.state=c,s.context=d,r=l):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,Af(e,t),l=t.memoizedProps,d=t.type===t.elementType?l:po(t.type,l),s.props=d,p=t.pendingProps,h=s.context,c=o.contextType,typeof c=="object"&&c!==null?c=ao(c):(c=Hn(o)?Or:Tn.current,c=Pa(t,c));var x=o.getDerivedStateFromProps;(u=typeof x=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==p||h!==c)&&Eh(t,s,r,c),ar=!1,h=t.memoizedState,s.state=h,al(t,r,s,a);var k=t.memoizedState;l!==p||h!==k||Gn.current||ar?(typeof x=="function"&&(Md(t,o,x,r),k=t.memoizedState),(d=ar||Nh(t,o,d,r,h,k,c)||!1)?(u||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,k,c),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,k,c)),typeof s.componentDidUpdate=="function"&&(t.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof s.componentDidUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=k),s.props=r,s.state=k,s.context=c,r=d):(typeof s.componentDidUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return zd(e,t,o,r,i,a)}function zd(e,t,o,r,a,i){rx(e,t);var s=(t.flags&128)!==0;if(!r&&!s)return a&&yh(t,o,!1),Wo(e,t,i);r=t.stateNode,Y2.current=t;var l=s&&typeof o.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&s?(t.child=Ia(t,e.child,null,i),t.child=Ia(t,null,l,i)):jn(e,t,l,i),t.memoizedState=r.state,a&&yh(t,o,!0),t.child}function ax(e){var t=e.stateNode;t.pendingContext?xh(e,t.pendingContext,t.pendingContext!==t.context):t.context&&xh(e,t.context,!1),Ku(e,t.containerInfo)}function Rh(e,t,o,r,a){return Ta(),Gu(a),t.flags|=256,jn(e,t,o,r),t.child}var qd={dehydrated:null,treeContext:null,retryLane:0};function Od(e){return{baseLanes:e,cachePool:null,transitions:null}}function ix(e,t,o){var r=t.pendingProps,a=Qt.current,i=!1,s=(t.flags&128)!==0,l;if((l=s)||(l=e!==null&&e.memoizedState===null?!1:(a&2)!==0),l?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),$t(Qt,a&1),e===null)return jd(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(s=r.children,e=r.fallback,i?(r=t.mode,i=t.child,s={mode:"hidden",children:s},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=s):i=Dl(s,r,0,null),e=zr(e,r,o,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=Od(o),t.memoizedState=qd,e):np(t,s));if(a=e.memoizedState,a!==null&&(l=a.dehydrated,l!==null))return X2(e,t,s,r,l,a,o);if(i){i=r.fallback,s=t.mode,a=e.child,l=a.sibling;var c={mode:"hidden",children:r.children};return!(s&1)&&t.child!==a?(r=t.child,r.childLanes=0,r.pendingProps=c,t.deletions=null):(r=xr(a,c),r.subtreeFlags=a.subtreeFlags&14680064),l!==null?i=xr(l,i):(i=zr(i,s,o,null),i.flags|=2),i.return=t,r.return=t,r.sibling=i,t.child=r,r=i,i=t.child,s=e.child.memoizedState,s=s===null?Od(o):{baseLanes:s.baseLanes|o,cachePool:null,transitions:s.transitions},i.memoizedState=s,i.childLanes=e.childLanes&~o,t.memoizedState=qd,r}return i=e.child,e=i.sibling,r=xr(i,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=o),r.return=t,r.sibling=null,e!==null&&(o=t.deletions,o===null?(t.deletions=[e],t.flags|=16):o.push(e)),t.child=r,t.memoizedState=null,r}function np(e,t){return t=Dl({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function rs(e,t,o,r){return r!==null&&Gu(r),Ia(t,e.child,null,o),e=np(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function X2(e,t,o,r,a,i,s){if(o)return t.flags&256?(t.flags&=-257,r=Dc(Error(Ye(422))),rs(e,t,s,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=r.fallback,a=t.mode,r=Dl({mode:"visible",children:r.children},a,0,null),i=zr(i,a,s,null),i.flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,t.mode&1&&Ia(t,e.child,null,s),t.child.memoizedState=Od(s),t.memoizedState=qd,i);if(!(t.mode&1))return rs(e,t,s,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(Ye(419)),r=Dc(i,r,void 0),rs(e,t,s,r)}if(l=(s&e.childLanes)!==0,Fn||l){if(r=gn,r!==null){switch(s&-s){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|s)?0:a,a!==0&&a!==i.retryLane&&(i.retryLane=a,Vo(e,a),fo(r,e,a,-1))}return lp(),r=Dc(Error(Ye(421))),rs(e,t,s,r)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=dw.bind(null,e),a._reactRetry=t,null):(e=i.treeContext,$n=hr(a.nextSibling),Jn=t,Xt=!0,mo=null,e!==null&&(eo[to++]=Fo,eo[to++]=Bo,eo[to++]=Fr,Fo=e.id,Bo=e.overflow,Fr=t),t=np(t,r.children),t.flags|=4096,t)}function Lh(e,t,o){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),Ad(e.return,t,o)}function zc(e,t,o,r,a){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:o,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=o,i.tailMode=a)}function sx(e,t,o){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(jn(e,t,r.children,o),r=Qt.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Lh(e,o,t);else if(e.tag===19)Lh(e,o,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if($t(Qt,r),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(o=t.child,a=null;o!==null;)e=o.alternate,e!==null&&il(e)===null&&(a=o),o=o.sibling;o=a,o===null?(a=t.child,t.child=null):(a=o.sibling,o.sibling=null),zc(t,!1,a,o,i);break;case"backwards":for(o=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&il(e)===null){t.child=a;break}e=a.sibling,a.sibling=o,o=a,a=e}zc(t,!0,o,null,i);break;case"together":zc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ms(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Wo(e,t,o){if(e!==null&&(t.dependencies=e.dependencies),Gr|=t.lanes,!(o&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Ye(153));if(t.child!==null){for(e=t.child,o=xr(e,e.pendingProps),t.child=o,o.return=t;e.sibling!==null;)e=e.sibling,o=o.sibling=xr(e,e.pendingProps),o.return=t;o.sibling=null}return t.child}function Z2(e,t,o){switch(t.tag){case 3:ax(t),Ta();break;case 5:Mf(t);break;case 1:Hn(t.type)&&el(t);break;case 4:Ku(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;$t(ol,r._currentValue),r._currentValue=a;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?($t(Qt,Qt.current&1),t.flags|=128,null):o&t.child.childLanes?ix(e,t,o):($t(Qt,Qt.current&1),e=Wo(e,t,o),e!==null?e.sibling:null);$t(Qt,Qt.current&1);break;case 19:if(r=(o&t.childLanes)!==0,e.flags&128){if(r)return sx(e,t,o);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),$t(Qt,Qt.current),r)break;return null;case 22:case 23:return t.lanes=0,ox(e,t,o)}return Wo(e,t,o)}var lx,Fd,cx,dx;lx=function(e,t){for(var o=t.child;o!==null;){if(o.tag===5||o.tag===6)e.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===t)break;for(;o.sibling===null;){if(o.return===null||o.return===t)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};Fd=function(){};cx=function(e,t,o,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,Lr(To.current);var i=null;switch(o){case"input":a=ld(e,a),r=ld(e,r),i=[];break;case"select":a=tn({},a,{value:void 0}),r=tn({},r,{value:void 0}),i=[];break;case"textarea":a=ud(e,a),r=ud(e,r),i=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=Zs)}hd(o,r);var s;o=null;for(d in a)if(!r.hasOwnProperty(d)&&a.hasOwnProperty(d)&&a[d]!=null)if(d==="style"){var l=a[d];for(s in l)l.hasOwnProperty(s)&&(o||(o={}),o[s]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(xi.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=a!=null?a[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(o||(o={}),o[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(o||(o={}),o[s]=c[s])}else o||(i||(i=[]),i.push(d,o)),o=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(xi.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Kt("scroll",e),i||l===c||(i=[])):(i=i||[]).push(d,c))}o&&(i=i||[]).push("style",o);var d=i;(t.updateQueue=d)&&(t.flags|=4)}};dx=function(e,t,o,r){o!==r&&(t.flags|=4)};function Za(e,t){if(!Xt)switch(e.tailMode){case"hidden":t=e.tail;for(var o=null;t!==null;)t.alternate!==null&&(o=t),t=t.sibling;o===null?e.tail=null:o.sibling=null;break;case"collapsed":o=e.tail;for(var r=null;o!==null;)o.alternate!==null&&(r=o),o=o.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function _n(e){var t=e.alternate!==null&&e.alternate.child===e.child,o=0,r=0;if(t)for(var a=e.child;a!==null;)o|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)o|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=o,t}function Q2(e,t,o){var r=t.pendingProps;switch(Bu(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return _n(t),null;case 1:return Hn(t.type)&&Qs(),_n(t),null;case 3:return r=t.stateNode,ja(),Yt(Gn),Yt(Tn),Yu(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(ns(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,mo!==null&&(Kd(mo),mo=null))),Fd(e,t),_n(t),null;case 5:Ju(t);var a=Lr(Ti.current);if(o=t.type,e!==null&&t.stateNode!=null)cx(e,t,o,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(Ye(166));return _n(t),null}if(e=Lr(To.current),ns(t)){r=t.stateNode,o=t.type;var i=t.memoizedProps;switch(r[So]=t,r[Ei]=i,e=(t.mode&1)!==0,o){case"dialog":Kt("cancel",r),Kt("close",r);break;case"iframe":case"object":case"embed":Kt("load",r);break;case"video":case"audio":for(a=0;a<ai.length;a++)Kt(ai[a],r);break;case"source":Kt("error",r);break;case"img":case"image":case"link":Kt("error",r),Kt("load",r);break;case"details":Kt("toggle",r);break;case"input":Up(r,i),Kt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Kt("invalid",r);break;case"textarea":Wp(r,i),Kt("invalid",r)}hd(o,i),a=null;for(var s in i)if(i.hasOwnProperty(s)){var l=i[s];s==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&ts(r.textContent,l,e),a=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&ts(r.textContent,l,e),a=["children",""+l]):xi.hasOwnProperty(s)&&l!=null&&s==="onScroll"&&Kt("scroll",r)}switch(o){case"input":$i(r),Vp(r,i,!0);break;case"textarea":$i(r),$p(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Zs)}r=a,t.updateQueue=r,r!==null&&(t.flags|=4)}else{s=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=z0(o)),e==="http://www.w3.org/1999/xhtml"?o==="script"?(e=s.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=s.createElement(o,{is:r.is}):(e=s.createElement(o),o==="select"&&(s=e,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):e=s.createElementNS(e,o),e[So]=t,e[Ei]=r,lx(e,t,!1,!1),t.stateNode=e;e:{switch(s=md(o,r),o){case"dialog":Kt("cancel",e),Kt("close",e),a=r;break;case"iframe":case"object":case"embed":Kt("load",e),a=r;break;case"video":case"audio":for(a=0;a<ai.length;a++)Kt(ai[a],e);a=r;break;case"source":Kt("error",e),a=r;break;case"img":case"image":case"link":Kt("error",e),Kt("load",e),a=r;break;case"details":Kt("toggle",e),a=r;break;case"input":Up(e,r),a=ld(e,r),Kt("invalid",e);break;case"option":a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=tn({},r,{value:void 0}),Kt("invalid",e);break;case"textarea":Wp(e,r),a=ud(e,r),Kt("invalid",e);break;default:a=r}hd(o,a),l=a;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?F0(e,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&q0(e,c)):i==="children"?typeof c=="string"?(o!=="textarea"||c!=="")&&yi(e,c):typeof c=="number"&&yi(e,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(xi.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Kt("scroll",e):c!=null&&Nu(e,i,c,s))}switch(o){case"input":$i(e),Vp(e,r,!1);break;case"textarea":$i(e),$p(e);break;case"option":r.value!=null&&e.setAttribute("value",""+vr(r.value));break;case"select":e.multiple=!!r.multiple,i=r.value,i!=null?ya(e,!!r.multiple,i,!1):r.defaultValue!=null&&ya(e,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=Zs)}switch(o){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return _n(t),null;case 6:if(e&&t.stateNode!=null)dx(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(Ye(166));if(o=Lr(Ti.current),Lr(To.current),ns(t)){if(r=t.stateNode,o=t.memoizedProps,r[So]=t,(i=r.nodeValue!==o)&&(e=Jn,e!==null))switch(e.tag){case 3:ts(r.nodeValue,o,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&ts(r.nodeValue,o,(e.mode&1)!==0)}i&&(t.flags|=4)}else r=(o.nodeType===9?o:o.ownerDocument).createTextNode(r),r[So]=t,t.stateNode=r}return _n(t),null;case 13:if(Yt(Qt),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Xt&&$n!==null&&t.mode&1&&!(t.flags&128))Pf(),Ta(),t.flags|=98560,i=!1;else if(i=ns(t),r!==null&&r.dehydrated!==null){if(e===null){if(!i)throw Error(Ye(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Ye(317));i[So]=t}else Ta(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;_n(t),i=!1}else mo!==null&&(Kd(mo),mo=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=o,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||Qt.current&1?pn===0&&(pn=3):lp())),t.updateQueue!==null&&(t.flags|=4),_n(t),null);case 4:return ja(),Fd(e,t),e===null&&Si(t.stateNode.containerInfo),_n(t),null;case 10:return Vu(t.type._context),_n(t),null;case 17:return Hn(t.type)&&Qs(),_n(t),null;case 19:if(Yt(Qt),i=t.memoizedState,i===null)return _n(t),null;if(r=(t.flags&128)!==0,s=i.rendering,s===null)if(r)Za(i,!1);else{if(pn!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(s=il(e),s!==null){for(t.flags|=128,Za(i,!1),r=s.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=o,o=t.child;o!==null;)i=o,e=r,i.flags&=14680066,s=i.alternate,s===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=s.childLanes,i.lanes=s.lanes,i.child=s.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=s.memoizedProps,i.memoizedState=s.memoizedState,i.updateQueue=s.updateQueue,i.type=s.type,e=s.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),o=o.sibling;return $t(Qt,Qt.current&1|2),t.child}e=e.sibling}i.tail!==null&&sn()>Ma&&(t.flags|=128,r=!0,Za(i,!1),t.lanes=4194304)}else{if(!r)if(e=il(s),e!==null){if(t.flags|=128,r=!0,o=e.updateQueue,o!==null&&(t.updateQueue=o,t.flags|=4),Za(i,!0),i.tail===null&&i.tailMode==="hidden"&&!s.alternate&&!Xt)return _n(t),null}else 2*sn()-i.renderingStartTime>Ma&&o!==1073741824&&(t.flags|=128,r=!0,Za(i,!1),t.lanes=4194304);i.isBackwards?(s.sibling=t.child,t.child=s):(o=i.last,o!==null?o.sibling=s:t.child=s,i.last=s)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=sn(),t.sibling=null,o=Qt.current,$t(Qt,r?o&1|2:o&1),t):(_n(t),null);case 22:case 23:return sp(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?Wn&1073741824&&(_n(t),t.subtreeFlags&6&&(t.flags|=8192)):_n(t),null;case 24:return null;case 25:return null}throw Error(Ye(156,t.tag))}function ew(e,t){switch(Bu(t),t.tag){case 1:return Hn(t.type)&&Qs(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return ja(),Yt(Gn),Yt(Tn),Yu(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Ju(t),null;case 13:if(Yt(Qt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Ye(340));Ta()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Yt(Qt),null;case 4:return ja(),null;case 10:return Vu(t.type._context),null;case 22:case 23:return sp(),null;case 24:return null;default:return null}}var as=!1,Sn=!1,tw=typeof WeakSet=="function"?WeakSet:Set,lt=null;function ma(e,t){var o=e.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(r){rn(e,t,r)}else o.current=null}function Bd(e,t,o){try{o()}catch(r){rn(e,t,r)}}var Dh=!1;function nw(e,t){if(_d=Js,e=gf(),Ou(e)){if("selectionStart"in e)var o={start:e.selectionStart,end:e.selectionEnd};else e:{o=(o=e.ownerDocument)&&o.defaultView||window;var r=o.getSelection&&o.getSelection();if(r&&r.rangeCount!==0){o=r.anchorNode;var a=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{o.nodeType,i.nodeType}catch{o=null;break e}var s=0,l=-1,c=-1,d=0,u=0,p=e,h=null;t:for(;;){for(var x;p!==o||a!==0&&p.nodeType!==3||(l=s+a),p!==i||r!==0&&p.nodeType!==3||(c=s+r),p.nodeType===3&&(s+=p.nodeValue.length),(x=p.firstChild)!==null;)h=p,p=x;for(;;){if(p===e)break t;if(h===o&&++d===a&&(l=s),h===i&&++u===r&&(c=s),(x=p.nextSibling)!==null)break;p=h,h=p.parentNode}p=x}o=l===-1||c===-1?null:{start:l,end:c}}else o=null}o=o||{start:0,end:0}}else o=null;for(Sd={focusedElem:e,selectionRange:o},Js=!1,lt=t;lt!==null;)if(t=lt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,lt=e;else for(;lt!==null;){t=lt;try{var k=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(k!==null){var C=k.memoizedProps,w=k.memoizedState,f=t.stateNode,g=f.getSnapshotBeforeUpdate(t.elementType===t.type?C:po(t.type,C),w);f.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var v=t.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ye(163))}}catch(_){rn(t,t.return,_)}if(e=t.sibling,e!==null){e.return=t.return,lt=e;break}lt=t.return}return k=Dh,Dh=!1,k}function mi(e,t,o){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,i!==void 0&&Bd(t,o,i)}a=a.next}while(a!==r)}}function Rl(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var o=t=t.next;do{if((o.tag&e)===e){var r=o.create;o.destroy=r()}o=o.next}while(o!==t)}}function Gd(e){var t=e.ref;if(t!==null){var o=e.stateNode;switch(e.tag){case 5:e=o;break;default:e=o}typeof t=="function"?t(e):t.current=e}}function ux(e){var t=e.alternate;t!==null&&(e.alternate=null,ux(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[So],delete t[Ei],delete t[Pd],delete t[q2],delete t[O2])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function px(e){return e.tag===5||e.tag===3||e.tag===4}function zh(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||px(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Hd(e,t,o){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?o.nodeType===8?o.parentNode.insertBefore(e,t):o.insertBefore(e,t):(o.nodeType===8?(t=o.parentNode,t.insertBefore(e,o)):(t=o,t.appendChild(e)),o=o._reactRootContainer,o!=null||t.onclick!==null||(t.onclick=Zs));else if(r!==4&&(e=e.child,e!==null))for(Hd(e,t,o),e=e.sibling;e!==null;)Hd(e,t,o),e=e.sibling}function Ud(e,t,o){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?o.insertBefore(e,t):o.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Ud(e,t,o),e=e.sibling;e!==null;)Ud(e,t,o),e=e.sibling}var xn=null,ho=!1;function Zo(e,t,o){for(o=o.child;o!==null;)hx(e,t,o),o=o.sibling}function hx(e,t,o){if(Po&&typeof Po.onCommitFiberUnmount=="function")try{Po.onCommitFiberUnmount(Nl,o)}catch{}switch(o.tag){case 5:Sn||ma(o,t);case 6:var r=xn,a=ho;xn=null,Zo(e,t,o),xn=r,ho=a,xn!==null&&(ho?(e=xn,o=o.stateNode,e.nodeType===8?e.parentNode.removeChild(o):e.removeChild(o)):xn.removeChild(o.stateNode));break;case 18:xn!==null&&(ho?(e=xn,o=o.stateNode,e.nodeType===8?Ic(e.parentNode,o):e.nodeType===1&&Ic(e,o),Ci(e)):Ic(xn,o.stateNode));break;case 4:r=xn,a=ho,xn=o.stateNode.containerInfo,ho=!0,Zo(e,t,o),xn=r,ho=a;break;case 0:case 11:case 14:case 15:if(!Sn&&(r=o.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var i=a,s=i.destroy;i=i.tag,s!==void 0&&(i&2||i&4)&&Bd(o,t,s),a=a.next}while(a!==r)}Zo(e,t,o);break;case 1:if(!Sn&&(ma(o,t),r=o.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=o.memoizedProps,r.state=o.memoizedState,r.componentWillUnmount()}catch(l){rn(o,t,l)}Zo(e,t,o);break;case 21:Zo(e,t,o);break;case 22:o.mode&1?(Sn=(r=Sn)||o.memoizedState!==null,Zo(e,t,o),Sn=r):Zo(e,t,o);break;default:Zo(e,t,o)}}function qh(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var o=e.stateNode;o===null&&(o=e.stateNode=new tw),t.forEach(function(r){var a=uw.bind(null,e,r);o.has(r)||(o.add(r),r.then(a,a))})}}function co(e,t){var o=t.deletions;if(o!==null)for(var r=0;r<o.length;r++){var a=o[r];try{var i=e,s=t,l=s;e:for(;l!==null;){switch(l.tag){case 5:xn=l.stateNode,ho=!1;break e;case 3:xn=l.stateNode.containerInfo,ho=!0;break e;case 4:xn=l.stateNode.containerInfo,ho=!0;break e}l=l.return}if(xn===null)throw Error(Ye(160));hx(i,s,a),xn=null,ho=!1;var c=a.alternate;c!==null&&(c.return=null),a.return=null}catch(d){rn(a,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)mx(t,e),t=t.sibling}function mx(e,t){var o=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(co(t,e),bo(e),r&4){try{mi(3,e,e.return),Rl(3,e)}catch(C){rn(e,e.return,C)}try{mi(5,e,e.return)}catch(C){rn(e,e.return,C)}}break;case 1:co(t,e),bo(e),r&512&&o!==null&&ma(o,o.return);break;case 5:if(co(t,e),bo(e),r&512&&o!==null&&ma(o,o.return),e.flags&32){var a=e.stateNode;try{yi(a,"")}catch(C){rn(e,e.return,C)}}if(r&4&&(a=e.stateNode,a!=null)){var i=e.memoizedProps,s=o!==null?o.memoizedProps:i,l=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&L0(a,i),md(l,s);var d=md(l,i);for(s=0;s<c.length;s+=2){var u=c[s],p=c[s+1];u==="style"?F0(a,p):u==="dangerouslySetInnerHTML"?q0(a,p):u==="children"?yi(a,p):Nu(a,u,p,d)}switch(l){case"input":cd(a,i);break;case"textarea":D0(a,i);break;case"select":var h=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!i.multiple;var x=i.value;x!=null?ya(a,!!i.multiple,x,!1):h!==!!i.multiple&&(i.defaultValue!=null?ya(a,!!i.multiple,i.defaultValue,!0):ya(a,!!i.multiple,i.multiple?[]:"",!1))}a[Ei]=i}catch(C){rn(e,e.return,C)}}break;case 6:if(co(t,e),bo(e),r&4){if(e.stateNode===null)throw Error(Ye(162));a=e.stateNode,i=e.memoizedProps;try{a.nodeValue=i}catch(C){rn(e,e.return,C)}}break;case 3:if(co(t,e),bo(e),r&4&&o!==null&&o.memoizedState.isDehydrated)try{Ci(t.containerInfo)}catch(C){rn(e,e.return,C)}break;case 4:co(t,e),bo(e);break;case 13:co(t,e),bo(e),a=e.child,a.flags&8192&&(i=a.memoizedState!==null,a.stateNode.isHidden=i,!i||a.alternate!==null&&a.alternate.memoizedState!==null||(ap=sn())),r&4&&qh(e);break;case 22:if(u=o!==null&&o.memoizedState!==null,e.mode&1?(Sn=(d=Sn)||u,co(t,e),Sn=d):co(t,e),bo(e),r&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!u&&e.mode&1)for(lt=e,u=e.child;u!==null;){for(p=lt=u;lt!==null;){switch(h=lt,x=h.child,h.tag){case 0:case 11:case 14:case 15:mi(4,h,h.return);break;case 1:ma(h,h.return);var k=h.stateNode;if(typeof k.componentWillUnmount=="function"){r=h,o=h.return;try{t=r,k.props=t.memoizedProps,k.state=t.memoizedState,k.componentWillUnmount()}catch(C){rn(r,o,C)}}break;case 5:ma(h,h.return);break;case 22:if(h.memoizedState!==null){Fh(p);continue}}x!==null?(x.return=h,lt=x):Fh(p)}u=u.sibling}e:for(u=null,p=e;;){if(p.tag===5){if(u===null){u=p;try{a=p.stateNode,d?(i=a.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=p.stateNode,c=p.memoizedProps.style,s=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=O0("display",s))}catch(C){rn(e,e.return,C)}}}else if(p.tag===6){if(u===null)try{p.stateNode.nodeValue=d?"":p.memoizedProps}catch(C){rn(e,e.return,C)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===e)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===e)break e;for(;p.sibling===null;){if(p.return===null||p.return===e)break e;u===p&&(u=null),p=p.return}u===p&&(u=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:co(t,e),bo(e),r&4&&qh(e);break;case 21:break;default:co(t,e),bo(e)}}function bo(e){var t=e.flags;if(t&2){try{e:{for(var o=e.return;o!==null;){if(px(o)){var r=o;break e}o=o.return}throw Error(Ye(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(yi(a,""),r.flags&=-33);var i=zh(e);Ud(e,i,a);break;case 3:case 4:var s=r.stateNode.containerInfo,l=zh(e);Hd(e,l,s);break;default:throw Error(Ye(161))}}catch(c){rn(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function ow(e,t,o){lt=e,gx(e)}function gx(e,t,o){for(var r=(e.mode&1)!==0;lt!==null;){var a=lt,i=a.child;if(a.tag===22&&r){var s=a.memoizedState!==null||as;if(!s){var l=a.alternate,c=l!==null&&l.memoizedState!==null||Sn;l=as;var d=Sn;if(as=s,(Sn=c)&&!d)for(lt=a;lt!==null;)s=lt,c=s.child,s.tag===22&&s.memoizedState!==null?Bh(a):c!==null?(c.return=s,lt=c):Bh(a);for(;i!==null;)lt=i,gx(i),i=i.sibling;lt=a,as=l,Sn=d}Oh(e)}else a.subtreeFlags&8772&&i!==null?(i.return=a,lt=i):Oh(e)}}function Oh(e){for(;lt!==null;){var t=lt;if(t.flags&8772){var o=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Sn||Rl(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Sn)if(o===null)r.componentDidMount();else{var a=t.elementType===t.type?o.memoizedProps:po(t.type,o.memoizedProps);r.componentDidUpdate(a,o.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&kh(t,i,r);break;case 3:var s=t.updateQueue;if(s!==null){if(o=null,t.child!==null)switch(t.child.tag){case 5:o=t.child.stateNode;break;case 1:o=t.child.stateNode}kh(t,s,o)}break;case 5:var l=t.stateNode;if(o===null&&t.flags&4){o=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&o.focus();break;case"img":c.src&&(o.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var p=u.dehydrated;p!==null&&Ci(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ye(163))}Sn||t.flags&512&&Gd(t)}catch(h){rn(t,t.return,h)}}if(t===e){lt=null;break}if(o=t.sibling,o!==null){o.return=t.return,lt=o;break}lt=t.return}}function Fh(e){for(;lt!==null;){var t=lt;if(t===e){lt=null;break}var o=t.sibling;if(o!==null){o.return=t.return,lt=o;break}lt=t.return}}function Bh(e){for(;lt!==null;){var t=lt;try{switch(t.tag){case 0:case 11:case 15:var o=t.return;try{Rl(4,t)}catch(c){rn(t,o,c)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var a=t.return;try{r.componentDidMount()}catch(c){rn(t,a,c)}}var i=t.return;try{Gd(t)}catch(c){rn(t,i,c)}break;case 5:var s=t.return;try{Gd(t)}catch(c){rn(t,s,c)}}}catch(c){rn(t,t.return,c)}if(t===e){lt=null;break}var l=t.sibling;if(l!==null){l.return=t.return,lt=l;break}lt=t.return}}var rw=Math.ceil,cl=Ko.ReactCurrentDispatcher,op=Ko.ReactCurrentOwner,oo=Ko.ReactCurrentBatchConfig,Mt=0,gn=null,ln=null,yn=0,Wn=0,ga=kr(0),pn=0,Mi=null,Gr=0,Ll=0,rp=0,gi=null,On=null,ap=0,Ma=1/0,zo=null,dl=!1,Vd=null,gr=null,is=!1,cr=null,ul=0,fi=0,Wd=null,Rs=-1,Ls=0;function An(){return Mt&6?sn():Rs!==-1?Rs:Rs=sn()}function fr(e){return e.mode&1?Mt&2&&yn!==0?yn&-yn:B2.transition!==null?(Ls===0&&(Ls=Z0()),Ls):(e=Bt,e!==0||(e=window.event,e=e===void 0?16:af(e.type)),e):1}function fo(e,t,o,r){if(50<fi)throw fi=0,Wd=null,Error(Ye(185));zi(e,o,r),(!(Mt&2)||e!==gn)&&(e===gn&&(!(Mt&2)&&(Ll|=o),pn===4&&sr(e,yn)),Un(e,r),o===1&&Mt===0&&!(t.mode&1)&&(Ma=sn()+500,jl&&_r()))}function Un(e,t){var o=e.callbackNode;Bv(e,t);var r=Ks(e,e===gn?yn:0);if(r===0)o!==null&&Yp(o),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(o!=null&&Yp(o),t===1)e.tag===0?F2(Gh.bind(null,e)):Sf(Gh.bind(null,e)),D2(function(){!(Mt&6)&&_r()}),o=null;else{switch(Q0(r)){case 1:o=ju;break;case 4:o=Y0;break;case 16:o=$s;break;case 536870912:o=X0;break;default:o=$s}o=kx(o,fx.bind(null,e))}e.callbackPriority=t,e.callbackNode=o}}function fx(e,t){if(Rs=-1,Ls=0,Mt&6)throw Error(Ye(327));var o=e.callbackNode;if(ka()&&e.callbackNode!==o)return null;var r=Ks(e,e===gn?yn:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=pl(e,r);else{t=r;var a=Mt;Mt|=2;var i=yx();(gn!==e||yn!==t)&&(zo=null,Ma=sn()+500,Dr(e,t));do try{sw();break}catch(l){xx(e,l)}while(!0);Uu(),cl.current=i,Mt=a,ln!==null?t=0:(gn=null,yn=0,t=pn)}if(t!==0){if(t===2&&(a=vd(e),a!==0&&(r=a,t=$d(e,a))),t===1)throw o=Mi,Dr(e,0),sr(e,r),Un(e,sn()),o;if(t===6)sr(e,r);else{if(a=e.current.alternate,!(r&30)&&!aw(a)&&(t=pl(e,r),t===2&&(i=vd(e),i!==0&&(r=i,t=$d(e,i))),t===1))throw o=Mi,Dr(e,0),sr(e,r),Un(e,sn()),o;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(Ye(345));case 2:Ir(e,On,zo);break;case 3:if(sr(e,r),(r&130023424)===r&&(t=ap+500-sn(),10<t)){if(Ks(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){An(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=Ed(Ir.bind(null,e,On,zo),t);break}Ir(e,On,zo);break;case 4:if(sr(e,r),(r&4194240)===r)break;for(t=e.eventTimes,a=-1;0<r;){var s=31-go(r);i=1<<s,s=t[s],s>a&&(a=s),r&=~i}if(r=a,r=sn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*rw(r/1960))-r,10<r){e.timeoutHandle=Ed(Ir.bind(null,e,On,zo),r);break}Ir(e,On,zo);break;case 5:Ir(e,On,zo);break;default:throw Error(Ye(329))}}}return Un(e,sn()),e.callbackNode===o?fx.bind(null,e):null}function $d(e,t){var o=gi;return e.current.memoizedState.isDehydrated&&(Dr(e,t).flags|=256),e=pl(e,t),e!==2&&(t=On,On=o,t!==null&&Kd(t)),e}function Kd(e){On===null?On=e:On.push.apply(On,e)}function aw(e){for(var t=e;;){if(t.flags&16384){var o=t.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var r=0;r<o.length;r++){var a=o[r],i=a.getSnapshot;a=a.value;try{if(!vo(i(),a))return!1}catch{return!1}}}if(o=t.child,t.subtreeFlags&16384&&o!==null)o.return=t,t=o;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function sr(e,t){for(t&=~rp,t&=~Ll,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var o=31-go(t),r=1<<o;e[o]=-1,t&=~r}}function Gh(e){if(Mt&6)throw Error(Ye(327));ka();var t=Ks(e,0);if(!(t&1))return Un(e,sn()),null;var o=pl(e,t);if(e.tag!==0&&o===2){var r=vd(e);r!==0&&(t=r,o=$d(e,r))}if(o===1)throw o=Mi,Dr(e,0),sr(e,t),Un(e,sn()),o;if(o===6)throw Error(Ye(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Ir(e,On,zo),Un(e,sn()),null}function ip(e,t){var o=Mt;Mt|=1;try{return e(t)}finally{Mt=o,Mt===0&&(Ma=sn()+500,jl&&_r())}}function Hr(e){cr!==null&&cr.tag===0&&!(Mt&6)&&ka();var t=Mt;Mt|=1;var o=oo.transition,r=Bt;try{if(oo.transition=null,Bt=1,e)return e()}finally{Bt=r,oo.transition=o,Mt=t,!(Mt&6)&&_r()}}function sp(){Wn=ga.current,Yt(ga)}function Dr(e,t){e.finishedWork=null,e.finishedLanes=0;var o=e.timeoutHandle;if(o!==-1&&(e.timeoutHandle=-1,L2(o)),ln!==null)for(o=ln.return;o!==null;){var r=o;switch(Bu(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Qs();break;case 3:ja(),Yt(Gn),Yt(Tn),Yu();break;case 5:Ju(r);break;case 4:ja();break;case 13:Yt(Qt);break;case 19:Yt(Qt);break;case 10:Vu(r.type._context);break;case 22:case 23:sp()}o=o.return}if(gn=e,ln=e=xr(e.current,null),yn=Wn=t,pn=0,Mi=null,rp=Ll=Gr=0,On=gi=null,Rr!==null){for(t=0;t<Rr.length;t++)if(o=Rr[t],r=o.interleaved,r!==null){o.interleaved=null;var a=r.next,i=o.pending;if(i!==null){var s=i.next;i.next=a,r.next=s}o.pending=r}Rr=null}return e}function xx(e,t){do{var o=ln;try{if(Uu(),js.current=ll,sl){for(var r=en.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}sl=!1}if(Br=0,mn=un=en=null,hi=!1,Ii=0,op.current=null,o===null||o.return===null){pn=1,Mi=t,ln=null;break}e:{var i=e,s=o.return,l=o,c=t;if(t=yn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,p=u.tag;if(!(u.mode&1)&&(p===0||p===11||p===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var x=Th(s);if(x!==null){x.flags&=-257,Ih(x,s,l,i,t),x.mode&1&&Ph(i,d,t),t=x,c=d;var k=t.updateQueue;if(k===null){var C=new Set;C.add(c),t.updateQueue=C}else k.add(c);break e}else{if(!(t&1)){Ph(i,d,t),lp();break e}c=Error(Ye(426))}}else if(Xt&&l.mode&1){var w=Th(s);if(w!==null){!(w.flags&65536)&&(w.flags|=256),Ih(w,s,l,i,t),Gu(Aa(c,l));break e}}i=c=Aa(c,l),pn!==4&&(pn=2),gi===null?gi=[i]:gi.push(i),i=s;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var f=ex(i,c,t);Ch(i,f);break e;case 1:l=c;var g=i.type,v=i.stateNode;if(!(i.flags&128)&&(typeof g.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(gr===null||!gr.has(v)))){i.flags|=65536,t&=-t,i.lanes|=t;var _=tx(i,l,t);Ch(i,_);break e}}i=i.return}while(i!==null)}wx(o)}catch(S){t=S,ln===o&&o!==null&&(ln=o=o.return);continue}break}while(!0)}function yx(){var e=cl.current;return cl.current=ll,e===null?ll:e}function lp(){(pn===0||pn===3||pn===2)&&(pn=4),gn===null||!(Gr&268435455)&&!(Ll&268435455)||sr(gn,yn)}function pl(e,t){var o=Mt;Mt|=2;var r=yx();(gn!==e||yn!==t)&&(zo=null,Dr(e,t));do try{iw();break}catch(a){xx(e,a)}while(!0);if(Uu(),Mt=o,cl.current=r,ln!==null)throw Error(Ye(261));return gn=null,yn=0,pn}function iw(){for(;ln!==null;)vx(ln)}function sw(){for(;ln!==null&&!Av();)vx(ln)}function vx(e){var t=Cx(e.alternate,e,Wn);e.memoizedProps=e.pendingProps,t===null?wx(e):ln=t,op.current=null}function wx(e){var t=e;do{var o=t.alternate;if(e=t.return,t.flags&32768){if(o=ew(o,t),o!==null){o.flags&=32767,ln=o;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{pn=6,ln=null;return}}else if(o=Q2(o,t,Wn),o!==null){ln=o;return}if(t=t.sibling,t!==null){ln=t;return}ln=t=e}while(t!==null);pn===0&&(pn=5)}function Ir(e,t,o){var r=Bt,a=oo.transition;try{oo.transition=null,Bt=1,lw(e,t,o,r)}finally{oo.transition=a,Bt=r}return null}function lw(e,t,o,r){do ka();while(cr!==null);if(Mt&6)throw Error(Ye(327));o=e.finishedWork;var a=e.finishedLanes;if(o===null)return null;if(e.finishedWork=null,e.finishedLanes=0,o===e.current)throw Error(Ye(177));e.callbackNode=null,e.callbackPriority=0;var i=o.lanes|o.childLanes;if(Gv(e,i),e===gn&&(ln=gn=null,yn=0),!(o.subtreeFlags&2064)&&!(o.flags&2064)||is||(is=!0,kx($s,function(){return ka(),null})),i=(o.flags&15990)!==0,o.subtreeFlags&15990||i){i=oo.transition,oo.transition=null;var s=Bt;Bt=1;var l=Mt;Mt|=4,op.current=null,nw(e,o),mx(o,e),P2(Sd),Js=!!_d,Sd=_d=null,e.current=o,ow(o),Mv(),Mt=l,Bt=s,oo.transition=i}else e.current=o;if(is&&(is=!1,cr=e,ul=a),i=e.pendingLanes,i===0&&(gr=null),Dv(o.stateNode),Un(e,sn()),t!==null)for(r=e.onRecoverableError,o=0;o<t.length;o++)a=t[o],r(a.value,{componentStack:a.stack,digest:a.digest});if(dl)throw dl=!1,e=Vd,Vd=null,e;return ul&1&&e.tag!==0&&ka(),i=e.pendingLanes,i&1?e===Wd?fi++:(fi=0,Wd=e):fi=0,_r(),null}function ka(){if(cr!==null){var e=Q0(ul),t=oo.transition,o=Bt;try{if(oo.transition=null,Bt=16>e?16:e,cr===null)var r=!1;else{if(e=cr,cr=null,ul=0,Mt&6)throw Error(Ye(331));var a=Mt;for(Mt|=4,lt=e.current;lt!==null;){var i=lt,s=i.child;if(lt.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(lt=d;lt!==null;){var u=lt;switch(u.tag){case 0:case 11:case 15:mi(8,u,i)}var p=u.child;if(p!==null)p.return=u,lt=p;else for(;lt!==null;){u=lt;var h=u.sibling,x=u.return;if(ux(u),u===d){lt=null;break}if(h!==null){h.return=x,lt=h;break}lt=x}}}var k=i.alternate;if(k!==null){var C=k.child;if(C!==null){k.child=null;do{var w=C.sibling;C.sibling=null,C=w}while(C!==null)}}lt=i}}if(i.subtreeFlags&2064&&s!==null)s.return=i,lt=s;else e:for(;lt!==null;){if(i=lt,i.flags&2048)switch(i.tag){case 0:case 11:case 15:mi(9,i,i.return)}var f=i.sibling;if(f!==null){f.return=i.return,lt=f;break e}lt=i.return}}var g=e.current;for(lt=g;lt!==null;){s=lt;var v=s.child;if(s.subtreeFlags&2064&&v!==null)v.return=s,lt=v;else e:for(s=g;lt!==null;){if(l=lt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Rl(9,l)}}catch(S){rn(l,l.return,S)}if(l===s){lt=null;break e}var _=l.sibling;if(_!==null){_.return=l.return,lt=_;break e}lt=l.return}}if(Mt=a,_r(),Po&&typeof Po.onPostCommitFiberRoot=="function")try{Po.onPostCommitFiberRoot(Nl,e)}catch{}r=!0}return r}finally{Bt=o,oo.transition=t}}return!1}function Hh(e,t,o){t=Aa(o,t),t=ex(e,t,1),e=mr(e,t,1),t=An(),e!==null&&(zi(e,1,t),Un(e,t))}function rn(e,t,o){if(e.tag===3)Hh(e,e,o);else for(;t!==null;){if(t.tag===3){Hh(t,e,o);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(gr===null||!gr.has(r))){e=Aa(o,e),e=tx(t,e,1),t=mr(t,e,1),e=An(),t!==null&&(zi(t,1,e),Un(t,e));break}}t=t.return}}function cw(e,t,o){var r=e.pingCache;r!==null&&r.delete(t),t=An(),e.pingedLanes|=e.suspendedLanes&o,gn===e&&(yn&o)===o&&(pn===4||pn===3&&(yn&130023424)===yn&&500>sn()-ap?Dr(e,0):rp|=o),Un(e,t)}function bx(e,t){t===0&&(e.mode&1?(t=Yi,Yi<<=1,!(Yi&130023424)&&(Yi=4194304)):t=1);var o=An();e=Vo(e,t),e!==null&&(zi(e,t,o),Un(e,o))}function dw(e){var t=e.memoizedState,o=0;t!==null&&(o=t.retryLane),bx(e,o)}function uw(e,t){var o=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(o=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(Ye(314))}r!==null&&r.delete(t),bx(e,o)}var Cx;Cx=function(e,t,o){if(e!==null)if(e.memoizedProps!==t.pendingProps||Gn.current)Fn=!0;else{if(!(e.lanes&o)&&!(t.flags&128))return Fn=!1,Z2(e,t,o);Fn=!!(e.flags&131072)}else Fn=!1,Xt&&t.flags&1048576&&Nf(t,nl,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ms(e,t),e=t.pendingProps;var a=Pa(t,Tn.current);Ca(t,o),a=Zu(null,t,r,e,a,o);var i=Qu();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Hn(r)?(i=!0,el(t)):i=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,$u(t),a.updater=Ml,t.stateNode=a,a._reactInternals=t,Rd(t,r,e,o),t=zd(null,t,r,!0,i,o)):(t.tag=0,Xt&&i&&Fu(t),jn(null,t,a,o),t=t.child),t;case 16:r=t.elementType;e:{switch(Ms(e,t),e=t.pendingProps,a=r._init,r=a(r._payload),t.type=r,a=t.tag=hw(r),e=po(r,e),a){case 0:t=Dd(null,t,r,e,o);break e;case 1:t=Mh(null,t,r,e,o);break e;case 11:t=jh(null,t,r,e,o);break e;case 14:t=Ah(null,t,r,po(r.type,e),o);break e}throw Error(Ye(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:po(r,a),Dd(e,t,r,a,o);case 1:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:po(r,a),Mh(e,t,r,a,o);case 3:e:{if(ax(t),e===null)throw Error(Ye(387));r=t.pendingProps,i=t.memoizedState,a=i.element,Af(e,t),al(t,r,null,o);var s=t.memoizedState;if(r=s.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){a=Aa(Error(Ye(423)),t),t=Rh(e,t,r,o,a);break e}else if(r!==a){a=Aa(Error(Ye(424)),t),t=Rh(e,t,r,o,a);break e}else for($n=hr(t.stateNode.containerInfo.firstChild),Jn=t,Xt=!0,mo=null,o=If(t,null,r,o),t.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(Ta(),r===a){t=Wo(e,t,o);break e}jn(e,t,r,o)}t=t.child}return t;case 5:return Mf(t),e===null&&jd(t),r=t.type,a=t.pendingProps,i=e!==null?e.memoizedProps:null,s=a.children,Nd(r,a)?s=null:i!==null&&Nd(r,i)&&(t.flags|=32),rx(e,t),jn(e,t,s,o),t.child;case 6:return e===null&&jd(t),null;case 13:return ix(e,t,o);case 4:return Ku(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Ia(t,null,r,o):jn(e,t,r,o),t.child;case 11:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:po(r,a),jh(e,t,r,a,o);case 7:return jn(e,t,t.pendingProps,o),t.child;case 8:return jn(e,t,t.pendingProps.children,o),t.child;case 12:return jn(e,t,t.pendingProps.children,o),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,i=t.memoizedProps,s=a.value,$t(ol,r._currentValue),r._currentValue=s,i!==null)if(vo(i.value,s)){if(i.children===a.children&&!Gn.current){t=Wo(e,t,o);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var l=i.dependencies;if(l!==null){s=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=Go(-1,o&-o),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}i.lanes|=o,c=i.alternate,c!==null&&(c.lanes|=o),Ad(i.return,o,t),l.lanes|=o;break}c=c.next}}else if(i.tag===10)s=i.type===t.type?null:i.child;else if(i.tag===18){if(s=i.return,s===null)throw Error(Ye(341));s.lanes|=o,l=s.alternate,l!==null&&(l.lanes|=o),Ad(s,o,t),s=i.sibling}else s=i.child;if(s!==null)s.return=i;else for(s=i;s!==null;){if(s===t){s=null;break}if(i=s.sibling,i!==null){i.return=s.return,s=i;break}s=s.return}i=s}jn(e,t,a.children,o),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Ca(t,o),a=ao(a),r=r(a),t.flags|=1,jn(e,t,r,o),t.child;case 14:return r=t.type,a=po(r,t.pendingProps),a=po(r.type,a),Ah(e,t,r,a,o);case 15:return nx(e,t,t.type,t.pendingProps,o);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:po(r,a),Ms(e,t),t.tag=1,Hn(r)?(e=!0,el(t)):e=!1,Ca(t,o),Qf(t,r,a),Rd(t,r,a,o),zd(null,t,r,!0,e,o);case 19:return sx(e,t,o);case 22:return ox(e,t,o)}throw Error(Ye(156,t.tag))};function kx(e,t){return J0(e,t)}function pw(e,t,o,r){this.tag=e,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function no(e,t,o,r){return new pw(e,t,o,r)}function cp(e){return e=e.prototype,!(!e||!e.isReactComponent)}function hw(e){if(typeof e=="function")return cp(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Pu)return 11;if(e===Tu)return 14}return 2}function xr(e,t){var o=e.alternate;return o===null?(o=no(e.tag,t,e.key,e.mode),o.elementType=e.elementType,o.type=e.type,o.stateNode=e.stateNode,o.alternate=e,e.alternate=o):(o.pendingProps=t,o.type=e.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=e.flags&14680064,o.childLanes=e.childLanes,o.lanes=e.lanes,o.child=e.child,o.memoizedProps=e.memoizedProps,o.memoizedState=e.memoizedState,o.updateQueue=e.updateQueue,t=e.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},o.sibling=e.sibling,o.index=e.index,o.ref=e.ref,o}function Ds(e,t,o,r,a,i){var s=2;if(r=e,typeof e=="function")cp(e)&&(s=1);else if(typeof e=="string")s=5;else e:switch(e){case aa:return zr(o.children,a,i,t);case Eu:s=8,a|=8;break;case rd:return e=no(12,o,t,a|2),e.elementType=rd,e.lanes=i,e;case ad:return e=no(13,o,t,a),e.elementType=ad,e.lanes=i,e;case id:return e=no(19,o,t,a),e.elementType=id,e.lanes=i,e;case A0:return Dl(o,a,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case I0:s=10;break e;case j0:s=9;break e;case Pu:s=11;break e;case Tu:s=14;break e;case rr:s=16,r=null;break e}throw Error(Ye(130,e==null?e:typeof e,""))}return t=no(s,o,t,a),t.elementType=e,t.type=r,t.lanes=i,t}function zr(e,t,o,r){return e=no(7,e,r,t),e.lanes=o,e}function Dl(e,t,o,r){return e=no(22,e,r,t),e.elementType=A0,e.lanes=o,e.stateNode={isHidden:!1},e}function qc(e,t,o){return e=no(6,e,null,t),e.lanes=o,e}function Oc(e,t,o){return t=no(4,e.children!==null?e.children:[],e.key,t),t.lanes=o,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function mw(e,t,o,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vc(0),this.expirationTimes=vc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vc(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function dp(e,t,o,r,a,i,s,l,c){return e=new mw(e,t,o,l,c),t===1?(t=1,i===!0&&(t|=8)):t=0,i=no(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},$u(i),e}function gw(e,t,o){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ra,key:r==null?null:""+r,children:e,containerInfo:t,implementation:o}}function _x(e){if(!e)return wr;e=e._reactInternals;e:{if(Vr(e)!==e||e.tag!==1)throw Error(Ye(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Hn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Ye(171))}if(e.tag===1){var o=e.type;if(Hn(o))return _f(e,o,t)}return t}function Sx(e,t,o,r,a,i,s,l,c){return e=dp(o,r,!0,e,a,i,s,l,c),e.context=_x(null),o=e.current,r=An(),a=fr(o),i=Go(r,a),i.callback=t??null,mr(o,i,a),e.current.lanes=a,zi(e,a,r),Un(e,r),e}function zl(e,t,o,r){var a=t.current,i=An(),s=fr(a);return o=_x(o),t.context===null?t.context=o:t.pendingContext=o,t=Go(i,s),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=mr(a,t,s),e!==null&&(fo(e,a,s,i),Is(e,a,s)),s}function hl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Uh(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var o=e.retryLane;e.retryLane=o!==0&&o<t?o:t}}function up(e,t){Uh(e,t),(e=e.alternate)&&Uh(e,t)}function fw(){return null}var Nx=typeof reportError=="function"?reportError:function(e){console.error(e)};function pp(e){this._internalRoot=e}ql.prototype.render=pp.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Ye(409));zl(e,t,null,null)};ql.prototype.unmount=pp.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Hr(function(){zl(null,e,null,null)}),t[Uo]=null}};function ql(e){this._internalRoot=e}ql.prototype.unstable_scheduleHydration=function(e){if(e){var t=nf();e={blockedOn:null,target:e,priority:t};for(var o=0;o<ir.length&&t!==0&&t<ir[o].priority;o++);ir.splice(o,0,e),o===0&&rf(e)}};function hp(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Ol(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Vh(){}function xw(e,t,o,r,a){if(a){if(typeof r=="function"){var i=r;r=function(){var d=hl(s);i.call(d)}}var s=Sx(t,r,e,0,null,!1,!1,"",Vh);return e._reactRootContainer=s,e[Uo]=s.current,Si(e.nodeType===8?e.parentNode:e),Hr(),s}for(;a=e.lastChild;)e.removeChild(a);if(typeof r=="function"){var l=r;r=function(){var d=hl(c);l.call(d)}}var c=dp(e,0,!1,null,null,!1,!1,"",Vh);return e._reactRootContainer=c,e[Uo]=c.current,Si(e.nodeType===8?e.parentNode:e),Hr(function(){zl(t,c,o,r)}),c}function Fl(e,t,o,r,a){var i=o._reactRootContainer;if(i){var s=i;if(typeof a=="function"){var l=a;a=function(){var c=hl(s);l.call(c)}}zl(t,s,e,a)}else s=xw(o,t,e,a,r);return hl(s)}ef=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var o=ri(t.pendingLanes);o!==0&&(Au(t,o|1),Un(t,sn()),!(Mt&6)&&(Ma=sn()+500,_r()))}break;case 13:Hr(function(){var r=Vo(e,1);if(r!==null){var a=An();fo(r,e,1,a)}}),up(e,1)}};Mu=function(e){if(e.tag===13){var t=Vo(e,134217728);if(t!==null){var o=An();fo(t,e,134217728,o)}up(e,134217728)}};tf=function(e){if(e.tag===13){var t=fr(e),o=Vo(e,t);if(o!==null){var r=An();fo(o,e,t,r)}up(e,t)}};nf=function(){return Bt};of=function(e,t){var o=Bt;try{return Bt=e,t()}finally{Bt=o}};fd=function(e,t,o){switch(t){case"input":if(cd(e,o),t=o.name,o.type==="radio"&&t!=null){for(o=e;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<o.length;t++){var r=o[t];if(r!==e&&r.form===e.form){var a=Il(r);if(!a)throw Error(Ye(90));R0(r),cd(r,a)}}}break;case"textarea":D0(e,o);break;case"select":t=o.value,t!=null&&ya(e,!!o.multiple,t,!1)}};H0=ip;U0=Hr;var yw={usingClientEntryPoint:!1,Events:[Oi,ca,Il,B0,G0,ip]},Qa={findFiberByHostInstance:Mr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},vw={bundleType:Qa.bundleType,version:Qa.version,rendererPackageName:Qa.rendererPackageName,rendererConfig:Qa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ko.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=$0(e),e===null?null:e.stateNode},findFiberByHostInstance:Qa.findFiberByHostInstance||fw,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ss=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ss.isDisabled&&ss.supportsFiber)try{Nl=ss.inject(vw),Po=ss}catch{}}Xn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yw;Xn.createPortal=function(e,t){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!hp(t))throw Error(Ye(200));return gw(e,t,null,o)};Xn.createRoot=function(e,t){if(!hp(e))throw Error(Ye(299));var o=!1,r="",a=Nx;return t!=null&&(t.unstable_strictMode===!0&&(o=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=dp(e,1,!1,null,null,o,!1,r,a),e[Uo]=t.current,Si(e.nodeType===8?e.parentNode:e),new pp(t)};Xn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Ye(188)):(e=Object.keys(e).join(","),Error(Ye(268,e)));return e=$0(t),e=e===null?null:e.stateNode,e};Xn.flushSync=function(e){return Hr(e)};Xn.hydrate=function(e,t,o){if(!Ol(t))throw Error(Ye(200));return Fl(null,e,t,!0,o)};Xn.hydrateRoot=function(e,t,o){if(!hp(e))throw Error(Ye(405));var r=o!=null&&o.hydratedSources||null,a=!1,i="",s=Nx;if(o!=null&&(o.unstable_strictMode===!0&&(a=!0),o.identifierPrefix!==void 0&&(i=o.identifierPrefix),o.onRecoverableError!==void 0&&(s=o.onRecoverableError)),t=Sx(t,null,e,1,o??null,a,!1,i,s),e[Uo]=t.current,Si(e),r)for(e=0;e<r.length;e++)o=r[e],a=o._getVersion,a=a(o._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[o,a]:t.mutableSourceEagerHydrationData.push(o,a);return new ql(t)};Xn.render=function(e,t,o){if(!Ol(t))throw Error(Ye(200));return Fl(null,e,t,!1,o)};Xn.unmountComponentAtNode=function(e){if(!Ol(e))throw Error(Ye(40));return e._reactRootContainer?(Hr(function(){Fl(null,null,e,!1,function(){e._reactRootContainer=null,e[Uo]=null})}),!0):!1};Xn.unstable_batchedUpdates=ip;Xn.unstable_renderSubtreeIntoContainer=function(e,t,o,r){if(!Ol(o))throw Error(Ye(200));if(e==null||e._reactInternals===void 0)throw Error(Ye(38));return Fl(e,t,o,!1,r)};Xn.version="18.3.1-next-f1338f8080-20240426";function Ex(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Ex)}catch(e){console.error(e)}}Ex(),N0.exports=Xn;var Ba=N0.exports;const ww=vu(Ba);var Wh=Ba;nd.createRoot=Wh.createRoot,nd.hydrateRoot=Wh.hydrateRoot;const bw={"app.title":"Prompt Modifier","app.subtitle":"Connect ideas to create a masterpiece","app.error.title":"Notification","app.error.copy":"Copy Message","app.error.copied":"Copied!","error.apiKey":"Your API key is invalid or missing permissions. Please select a valid API key.","error.scriptModifierCanvas":"This canvas belongs to another application - Script Modifier. Please use Script Modifier to open this file.","welcome.title":"Welcome to","welcome.description":"Welcome to Prompt Modifier. Connect ideas to create masterpieces. Use nodes to generate and edit content.","welcome.apiKeyLabel":"API Key","welcome.apiKeyPlaceholder":"Enter your API key","welcome.apiKeyHelp":"Your API key is stored locally in your browser.","welcome.getKeyLink":"Get API Key","welcome.iAmDeveloper":"I am a Developer","welcome.letsGo":"Let's Go","welcome.resume":"Resume","welcome.startNew":"Start New Canvas","welcome.freeModeActive":"Free Mode Active","welcome.selectLanguage":"Select your primary language","welcome.navHint":"Use keyboard keys  and  to change language","toast.contentCleared":"Content cleared","toast.downloadStarted":"Download started","toast.characterLoaded":"Character card loaded","toast.characterSavedDisk":"Character card saved to disk","toast.copiedToClipboard":"Copied to clipboard","toast.pastedFromClipboard":"Pasted from clipboard","toast.pasteFailed":"Paste failed","toast.nodeDuplicated":"Node duplicated","toast.groupSavedToDisk":'Group "{groupTitle}" saved to disk',"toast.groupDeleted":"Group and contents deleted","toast.characterSavedCatalog":"Character saved to catalog","toast.promptSaved":"Prompt saved to library: {promptName}...","toast.connectionsCut":"Connections removed","toast.apiKeySaved":"API Key saved successfully","toast.cacheCleared":"Cleared {count} unused items from cache","toast.cacheEmpty":"Cache is already optimized","toast.scriptSaved":"Script saved to disk","toast.modificationComplete":"Character modified successfully","toast.canvasSaved":"Canvas saved successfully","toast.projectSaved":"Project saved successfully","alert.groupSaved":'Group "{groupTitle}" saved to catalog.',"alert.loadCatalogFailed":"Failed to load catalog file","alert.invalidCatalogFile":"Invalid catalog file format","alert.fileNotSupported":'File not supported. Missing or incorrect "appName".',"alert.invalidCatalogStructure":'Invalid catalog structure. Missing "root".',"tutorial.step1":"Click here to add a random word to the prompt.","tutorial.step2":'Click "Process Prompt" to combine inputs using AI.',"tutorial.step2_waiting":"The AI is currently analyzing your inputs and generating a technical prompt specification...","tutorial.step3":"Finally, click here to generate the image.","tutorial.step3b":"Generation takes some time. You can monitor the progress here.","tutorial.step4":"You can add new nodes manually from this toolbar.","tutorial.group.catalog":"Use the Catalog to search for nodes or manage groups.","tutorial.group.general":"Add Sticky Notes and Data Readers for debugging.","tutorial.group.input":"Basic inputs for text, images, and sequences.","tutorial.group.processing":"Analyze and process prompts or images with AI.","tutorial.group.character":"Create, analyze, and store detailed characters.","tutorial.group.output":"Display results and generate sequences.","tutorial.group.ai":"Chat with Gemini and translate text.","tutorial.group.video":"Tools for video prompts and editing.","tutorial.group.scripts":"Generate and view scripts for complex stories.","tutorial.group.file":"Save your work, load projects, or download the canvas.","tutorial.success.title":"Tutorial Completed!","tutorial.success.message":"You have successfully learned the basics of Prompt Modifier. Good luck creating masterpieces!","tutorial.success.button":"Start Creating","tutorial.skip":"Skip","tutorial.next":"Next","tutorial.finish":"Got it"},Cw={"toolbar.settings":"Settings","toolbar.resetCanvas":"Reset to Default","toolbar.clearCache":"Clear Unused Cache","toolbar.home":"Home","toolbar.exitApp":"Close Project","toolbar.edit":"Edit (V)","toolbar.cutter":"Cut Connection (C) / (Hold Ctrl)","toolbar.selection":"Selection (S) / (Hold Shift)","toolbar.reroute":"Reroute (R) / (Hold Ctrl+Alt)","toolbar.zoom":"Zoom (Hold Z)","toolbar.snapToGrid":"Snap to Grid","toolbar.smartGuides":"Smart Guides (Magnet)","toolbar.lineStyleSpaghetti":"Spaghetti Lines","toolbar.lineStyleOrthogonal":"Orthogonal Lines","toolbar.resetZoom":"Reset Zoom","toolbar.resetCamera":"Reset Camera Position","toolbar.clearCanvas":"Clear Canvas","toolbar.addNode":"Add Node (F)","toolbar.catalog":"Open Catalog (Ctrl + Space)","toolbar.addNote":"Add Note (N)","toolbar.addDataReader":"Add Data Reader (Shift + R)","toolbar.addTextInput":"Add Text Input (T)","toolbar.addImageInput":"Add Image Input (I)","toolbar.addPromptSequenceEditor":"Add Prompt Sequence Editor (Q)","toolbar.addImageAnalyzer":"Add Image Analyzer (Shift+A)","toolbar.addPromptAnalyzer":"Add Prompt Analyzer (A)","toolbar.addPromptProcessor":"Add Prompt Processor (P)","toolbar.addCharacterGenerator":"Add Character Generator (Shift+C)","toolbar.addCharacterAnalyzer":"Add Character Analyzer (Ctrl+Shift+A)","toolbar.addCharacterCard":"Add Character Card (Ctrl+Shift+C)","toolbar.addImageOutput":"Add Image Output (O)","toolbar.addImageEditor":"Add AI Image Editor (Shift+I)","toolbar.addImageSequenceGenerator":"Add Image Sequence Generator (Shift+Q)","toolbar.addTranslator":"Add Translator (L)","toolbar.addGeminiChat":"Add Gemini Chat (M)","toolbar.addVideoPromptProcessor":"Add Video Prompt Processor (Shift+P)","toolbar.addVideoOutput":"Add Video Output (Shift+O)","toolbar.addScriptGenerator":"Add Script Generator","toolbar.addScriptViewer":"Add Script Viewer (Shift + V)","toolbar.saveCanvas":"Save Canvas (Ctrl + S)","toolbar.saveProject":"Save Project","toolbar.saveToDrive":"Save to Google Drive","toolbar.loadCanvas":"Load Project/Canvas (Ctrl + O)","toolbar.group.general":"General","toolbar.group.catalog":"Catalog","toolbar.group.input":"Input","toolbar.group.processing":"Processing","toolbar.group.character":"Character","toolbar.group.output":"Output","toolbar.group.aiTools":"AI Tools","toolbar.group.video":"Video","toolbar.group.scripts":"Scripts","toolbar.group.file":"File","toolbar.title":"Toolbar","toolbar.dock":"Dock Toolbar","toolbar.detach":"Detach Toolbar","toolbar.expandPanel":"Expand Panel","toolbar.collapsePanel":"Collapse Panel","toolbar.dockArea.title":"Dock Toolbar Here","toolbar.duplicate":"Duplicate Node","toolbar.duplicateWithContent":"Duplicate with Content","toolbar.dock.q1":"Left 1st Qtr","toolbar.dock.q2":"Left 2nd Qtr","toolbar.dock.q3":"Right 3rd Qtr","toolbar.dock.q4":"Right 4th Qtr","toolbar.dock.tl":"Top Left","toolbar.dock.bl":"Bottom Left","toolbar.dock.tr":"Top Right","toolbar.dock.br":"Bottom Right","toolbar.dock.left":"Left Half","toolbar.dock.right":"Right Half","toolbar.dock.full":"Full Screen","toolbar.dock.exitFull":"Exit Full Screen","toolbar.dock.fullFocus":"Full Screen Focus","hotkeys.show":"Show Hotkeys","hotkeys.tools.title":"Tools","hotkeys.tools.edit":"Edit Mode","hotkeys.tools.cutter":"Cutter Tool","hotkeys.tools.selection":"Selection Tool","hotkeys.tools.reroute":"Reroute Tool","hotkeys.tools.zoom":"Zoom Tool","hotkeys.tools.toggleLineStyle":"Toggle Line Style","hotkeys.tools.group":"Group Selection","hotkeys.tools.closeNode":"Delete Selected","hotkeys.tools.duplicate":"Duplicate Node","hotkeys.tools.duplicateWithContent":"Duplicate with Content","hotkeys.tools.deleteGroup":"Delete Group (Shift+Click)","hotkeys.windows.title":"Windows","hotkeys.windows.search":"Quick Search","hotkeys.windows.catalog":"Catalog","hotkeys.createNode.title":"Create Node","help.panelTitle":"Help & Hotkeys","help.subtitle":"Help Center","help.title":"Keyboard Shortcuts","help.howToUse.title":"How to Use","help.howToUse.content":"Welcome to Prompt Modifier! Use the toolbar or hotkeys to add nodes. Connect nodes to pass data. Use the Edit tool to move nodes and pan the canvas. Double-click on empty space to open Quick Add menu. Right-click for context menu.","help.author":"Author","help.tab.links":"Other Apps & Links","help.section.socials":"Socials","help.section.studioStable":"Google AI Studio (Stable)","help.section.studioAlpha":"Google AI Studio (Alpha)","help.section.netlify":"Netlify Apps","help.section.github":"GitHub Repos","help.section.githubPages":"Applications on GitHub","help.license":"Licensed under GNU GPLv3","help.copyLink":"Copy Link","help.copied":"Copied!","contextMenu.undoPosition":"Undo Position","contextMenu.redoPosition":"Redo Position","contextMenu.align.left":"Align Left (F)","contextMenu.align.centerX":"Align Center X (E)","contextMenu.align.right":"Align Right (R)","contextMenu.align.top":"Align Top (T)","contextMenu.align.centerY":"Align Center Y (D)","contextMenu.align.bottom":"Align Bottom (B)","contextMenu.distribute.horizontal":"Distribute Horiz. (Ctrl+D)","contextMenu.distribute.vertical":"Distribute Vert. (Ctrl+E)","contextMenu.emptySlot":"Empty Slot (Right-click to assign)","contextMenu.saveSlots":"Save Slots Config","contextMenu.loadSlots":"Load Slots Config","quickadd.title":"Quick Add","quickadd.group.tools":"Tools","quickadd.group.inputs":"Inputs","quickadd.group.processing":"Processing","quickadd.group.character":"Character","quickadd.group.outputs":"Outputs","quickadd.group.ai":"AI Tools","quickadd.group.video":"Video","quickadd.group.scripts":"Scripts","quickadd.group.general":"General","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"Edit","quickadd.tool.cutter":"Cutter","quickadd.tool.selection":"Selection","search.placeholder":"Search for a node to add...","search.noResults":"No nodes found.","search.group.input":"Input & Basic","search.group.process":"Processing & Character","search.group.output":"Image & Sequence","search.group.ai":"AI Tools","search.group.video":"Video & Scripting","search.group.scripts":"Scripts","toolbar.enterFullScreen":"Full Screen","toolbar.exitFullScreen":"Exit Full Screen","dialog.settings.hoverHighlightLabel":"Node Hover Highlight"},kw={"node.title.text_input":"Text Input","node.title.image_input":"Image Input","node.title.prompt_processor":"Prompt Processor","node.title.prompt_sanitizer":"Prompt Sanitizer","node.title.video_prompt_processor":"Video Prompt Processor","node.title.image_output":"Image Output","node.title.video_output":"Video Output","node.title.prompt_analyzer":"Prompt Analyzer","node.title.character_analyzer":"Character Analyzer","node.title.character_generator":"Character Generator","node.title.character_card":"Character Card","node.title.image_analyzer":"Image Analyzer","node.title.image_editor":"AI Image Editor","node.title.image_sequence_generator":"Image Sequence Generator","node.title.prompt_sequence_editor":"Prompt Sequence Editor","node.title.gemini_chat":"Gemini Chat","node.title.translator":"Translator","node.title.script_generator":"Script Generator","node.title.script_viewer":"Script Viewer","node.title.note":"Note","node.title.reroute_dot":"Reroute Dot","node.title.data_reader":"Data Reader","node.title.video_editor":"Video Editor Alpha","node.title.media_viewer":"Media Viewer","node.title.data_protection":"Data Protection","node.title.pose_creator":"Pose Creator","node.help.text_input":"A simple multiline text field for entering prompts or notes.","node.help.image_input":"Allows you to upload or paste an image to use as input for other nodes.","node.help.prompt_processor":"Combines multiple text inputs into a single, technical prompt specification using AI.","node.help.prompt_sanitizer":"Rewrites the input prompt to be safer for image generation policies while preserving artistic intent.","node.help.video_prompt_processor":"Specialized processor for creating detailed video generation prompts.","node.help.image_output":"Displays the result of image generation. Supports downloading and viewing.","node.help.video_output":"Displays the result of video generation using the Veo model.","node.help.prompt_analyzer":"Deconstructs a prompt into components like subject, style, and environment.","node.help.character_analyzer":"Analyses a character description and splits it into appearance and clothing.","node.help.character_generator":"Generates detailed character descriptions based on a short prompt.","node.help.character_card":"Stores comprehensive character data including image and description.","node.help.image_analyzer":"Uses AI to describe the content of an input image.","node.help.image_editor":"Advanced tool for editing images using text prompts and inpainting/outpainting.","node.help.image_sequence_generator":"Generates a sequence of images based on a list of prompts.","node.help.prompt_sequence_editor":"Allows bulk editing of prompt sequences using AI instructions.","node.help.gemini_chat":"A general-purpose chat interface with Gemini for brainstorming or assistance.","node.help.translator":"Translates text between languages using AI models.","node.help.script_generator":"Generates a structured script (scenes, characters) from a story idea.","node.help.script_viewer":"Visualizes and manages script data for frame-by-frame generation.","node.help.note":"A sticky note for adding comments or instructions to the canvas.","node.help.reroute_dot":"A small dot used to organize connections and create cleaner layouts.","node.help.data_reader":"Debug tool for inspecting raw data flowing through connections.","node.help.video_editor":"A timeline-based tool for editing video clips and images.","node.help.media_viewer":"A player for viewing video and audio files with playback controls.","node.help.data_protection":"An interactive Tower Defense game node. Defend your data stream from corruption.","node.help.pose_creator":"Visual rig to define and generate character poses for consistency.","node.action.expand":"Expand","node.action.collapse":"Collapse","node.action.help":"Help","node.action.download":"Download","node.action.clear":"Clear Content","node.action.refreshChat":"Clear and Restart Chat","node.action.paste":"Paste","node.action.resetEditor":"Reset Editor","node.action.saveCharacter":"Save to Disk","node.action.loadCharacter":"Load from Disk","node.action.copy":"Copy","node.action.copyImage":"Copy Image","node.action.copyTextPrompt":"Copy Prompt","node.action.copyImagePrompt":"Copy Image Prompt","node.action.copyVideoPrompt":"Copy Video Prompt","node.action.cutConnections":"Cut Connections","node.action.close":"Close","node.action.closeNode":"Close Node (Shift+Click for instant close)","node.action.closeNodeSimple":"Close Node","node.action.randomWord":"Add Random Word","node.action.processImage":"Remove Watermarks","node.action.processImageTitle":"Uses Gemini to remove watermarks and text from the image.","node.action.editor":"Editor","node.action.rasterEditor":"Raster Editor","node.action.openInAIEditor":"Open in AI Editor","node.action.openInAnalyzer":"Open in Analyzer","node.action.outputToInput":"Use Output as Input","node.action.processChainForward":"Process Forward","node.action.executeChain":"Execute Chain","node.action.executeChainTitle":"Execute all upstream nodes to generate the final result.","node.action.sanitize":"Sanitize","node.action.rename":"Rename","node.action.stop":"Stop","node.action.stopping":"Stopping...","node.action.deleteItem":"Delete Item","node.action.detachAndPaste":"Detach and Paste","node.action.delete":"Delete","node.action.flipImage":"Flip Image","node.action.pin":"Pin Node to Top","node.action.unpin":"Unpin Node","node.action.updateDescription":"Update description from prompt","node.action.modifyCharacter":"Request Changes","node.action.updateDataFormat":"Update data format","node.action.expand169":"Expand to 16:9","node.action.expand916":"Expand to 9:16","node.action.sync":"Sync from connections","node.action.expandRatio":"Extend Aspect Ratio","node.action.markPrimary":"Mark as Primary","node.action.addCard":"Add Card","node.action.removeCard":"Remove Card","node.action.showOutputs":"Show Outputs","node.action.hideOutputs":"Hide Outputs","node.action.characterConcept":"Character Concept","node.action.objectConcept":"Object Concept","node.action.downloadTxt":"Download .txt","node.action.downloadDoc":"Download .doc","node.mediaViewer.play":"Play","node.mediaViewer.pause":"Pause","node.mediaViewer.stop":"Stop","node.mediaViewer.addMarker":"Add Marker","node.mediaViewer.exportSRT":"Export Markers (SRT)","node.mediaViewer.deleteAllMarkers":"Delete All Markers","node.mediaViewer.saveMarkers":"Save Markers to Disk","node.mediaViewer.loadMarkers":"Load Markers from Disk","node.mediaViewer.relink":"Relink File","node.content.notePlaceholder":"Type your notes here...","node.content.dropImage":"Drop image here or click to upload","node.content.dropMedia":"Drop video or audio here","node.content.processing":"Processing...","node.content.processingChain":"Processing Chain...","node.content.metadataPrompt":"Prompt from Image Metadata:","node.content.metadataPromptPlaceholder":"No prompt found in image.","node.content.copyPrompt":"Use","node.content.prompt":"Prompt","node.content.inputPrompt":"Input Prompt","node.content.enhancedResult":"Processed Result","node.content.videoPrompt":"Video Prompt","node.content.editPromptPlaceholder":"Add to or edit the prompt...","node.content.enhancedPromptHere":"Processed prompt will appear here...","node.content.safePrompt":"Safe for commercial use","node.content.generating":"Generating...","node.content.imageHere":"Image will appear here","node.content.generationMode":"Generation Model","node.content.aspectRatio":"Aspect Ratio","node.content.aspectRatioHelp":"Set aspect ratio for image generation","node.content.aspectRatioNotSupportedFast":"Aspect ratio only available for Imagen models.","node.content.enableAspectRatioFormatting":"Enable Aspect Ratio Formatting","node.content.autoDownload":"Auto Download","node.content.generateImage":"Generate Image","node.content.enhancing":"Processing...","node.content.enhancePrompt":"Process Prompt","node.content.sanitizing":"Sanitizing...","node.content.sanitizedPromptHere":"Sanitized prompt will appear here...","node.content.analyzing":"Analyzing...","node.content.analyzePrompt":"Analyze Prompt","node.content.analyzeImage":"Analyze Image","node.content.imageToText":"Image to Text","node.content.updatePromptFromImage":"Update prompt from image","node.content.analyzeCharacter":"Analyze Character","node.content.generateCharacters":"Generate Characters","node.content.characterPromptPlaceholder":"Describe character(s) to generate...","node.content.character":"Character","node.content.clothing":"Clothing","node.content.characterPlaceholder":"Character description will appear here...","node.content.clothingPlaceholder":"Clothing description will appear here...","node.content.appearance":"Appearance","node.content.personality":"Personality","node.content.environment":"Environment/Setting","node.content.action":"Action","node.content.emotion":"Emotion","node.content.style":"Style","node.content.environmentPlaceholder":"Detailed description of the environment...","node.content.charactersPlaceholder":"List of main characters...","node.content.characters":"Characters","node.content.characterConcepts":"Character Concepts","node.content.actionPlaceholder":"Description of the action...","node.content.emotionPlaceholder":"Description of the emotion...","node.content.stylePlaceholder":"Description of the art style...","node.content.descriptionHere":"Description will appear here...","node.content.enableOutpainting":"Enable Outpainting","node.content.outpaintingPromptPlaceholder":"Outpainting prompt...","node.content.inputImage":"Input Images","node.content.dropOrClick":"Drop or Click","node.content.outputImage":"Output Image","node.content.applyEdit":"Apply Edit","node.content.editing":"Editing...","node.content.chatPlaceholder":"Type your message...","node.content.connectedPlaceholder":"Connected to node, edit in source.","node.content.connectedNode":"Connected via node","node.content.connectedEmpty":"Connected node has no image.","node.content.translatePlaceholder":"Text to translate...","node.content.translatedTextPlaceholder":"Text translated...","node.content.targetLanguage":"Target Language","node.content.translate":"Translate","node.content.translating":"Translating...","node.content.scriptPromptPlaceholder":"Enter a story idea or plot...","node.content.generateScript":"Generate Script","node.content.loadScript":"Load Script File","node.content.summary":"Summary","node.content.scenes":"Scenes","node.content.unrecognizedFormat":"Unrecognized script format.","node.content.frames":"Frames","node.content.characterIndex":"Index","node.content.readData":"Read Data","node.content.textDataHere":"Text data will appear here.","node.content.noDataRead":'Connect a node and click "Read Data" to view its contents.',"node.content.previewError":"Preview Error","node.content.previewPlaceholder":"Preview will appear here","node.content.imagePrompt":"Image Prompt","node.output.allPromptData":"All Prompt Data","node.note.tab.note":"Note","node.note.tab.references":"References","node.note.nestedImages":"Nested Images","node.note.dropPlaceholder":"Drop images or click to add","node.note.addCaption":"Caption","node.note.action.shuffle":"Shuffle","node.note.action.undoShuffle":"Undo Shuffle","node.content.characterTypeShort":"Type:","node.content.numberOfCharactersShort":"Qty:","node.content.characterType.simple":"Simple","node.content.characterType.anthro":"Anthro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Key Item","node.content.style.simple":"Simple","node.content.style.realistic":"Realistic","node.content.style.3d_cartoon":"3D Cartoon","node.content.style.3d_realistic":"3D Realistic","node.content.style.2d_animation":"2D Animation","node.content.style.anime":"Anime","node.content.style.comics":"Comics","node.content.style.custom":"Custom","node.content.fullDescriptionTitle":"Full character description","node.content.integrationInstruction":"Integration Instruction","node.content.additionalPromptSuffix":"Additional Prompt (Suffix)","node.content.insertSceneContext":"Insert Scene Context","search.node.text_input.title":"Text Input","search.node.text_input.description":"A simple multiline text field.","search.node.image_input.title":"Image Input","search.node.image_input.description":"Allows you to upload or paste an image.","search.node.media_viewer.title":"Media Viewer","search.node.media_viewer.description":"Player for viewing video and audio files with playback controls.","search.node.prompt_sequence_editor.title":"Prompt Sequence Editor","search.node.prompt_sequence_editor.description":"Edits a list of prompts using a single instruction, allowing for batch modifications.","search.node.data_reader.title":"Data Reader","search.node.data_reader.description":"Reads and displays the raw output (text or image) from any connected node for debugging purposes.","search.node.note.title":"Note","search.node.note.description":"A sticky note for comments.","search.node.prompt_processor.title":"Prompt Processor","search.node.prompt_processor.description":"Combines inputs into an enhanced prompt.","search.node.prompt_analyzer.title":"Prompt Analyzer","search.node.prompt_analyzer.description":"Deconstructs a prompt into components.","search.node.prompt_sanitizer.title":"Prompt Sanitizer","search.node.prompt_sanitizer.description":"Rewrites the prompt to be safer for AI models.","search.node.character_card.title":"Character Card","search.node.character_card.description":"Stores detailed information about a character.","search.node.character_analyzer.title":"Character Analyzer","search.node.character_analyzer.description":"Splits a description into appearance and clothing.","search.node.character_generator.title":"Character Generator","search.node.character_generator.description":"Generates one or more detailed character descriptions based on a prompt.","search.node.image_analyzer.title":"Image Analyzer","search.node.image_analyzer.description":"Describes an image using AI.","search.node.image_editor.title":"AI Image Editor","search.node.image_editor.description":"Edits or combines images with a prompt.","search.node.image_sequence_generator.title":"Image Sequence Generator","search.node.image_sequence_generator.description":"Generates a sequence of images based on a list of prompts.","search.node.gemini_chat.title":"Gemini Chat","search.node.gemini_chat.description":"A conversational interface to chat with Gemini, useful for brainstorming or assistance.","search.node.translator.title":"Translator","search.node.translator.description":"Translates text between languages using AI models.","search.node.script_generator.title":"Script Generator","search.node.script_generator.description":"Generates a structured script (scenes, characters) from a story idea.","search.node.script_viewer.title":"Script Viewer","search.node.script_viewer.description":"Visualizes and manages script data for frame-by-frame generation.","search.node.note":"A simple text box for leaving notes and comments on the canvas.","search.node.reroute_dot":"A small dot used to organize connections and create cleaner layouts.","search.node.video_prompt_processor.title":"Video Prompt Processor","search.node.video_prompt_processor.description":"Creates detailed prompts for video generation.","search.node.video_output.title":"Video Output","search.node.video_output.description":"Generates a video using the Veo model.","search.node.image_output.title":"Image Output","search.node.image_output.description":"Displays and allows downloading of generated images.","search.node.data_protection.title":"Data Protection","search.node.data_protection.description":"Defend your data stream from corruption in this mini-game node.","search.node.pose_creator.title":"Pose Creator","search.node.pose_creator.description":"Visually rig and create character poses for generation guidance.","prompt_sequence_editor.instructionPlaceholder":"Enter instruction to modify prompts...","prompt_sequence_editor.modifying":"Modifying...","prompt_sequence_editor.modifySelected":"Modify Selected ({count})","prompt_sequence_editor.sourcePrompts":"Source Prompts","prompt_sequence_editor.finalPrompts":"Modified Prompts","prompt_sequence_editor.error.invalidInput":"Invalid data format. Please connect a prompt sequence array.","geminiChat.mode.general":"General","geminiChat.mode.prompt":"Prompt Expert","geminiChat.mode.script":"Script Writer","geminiChat.mode.youtube":"YouTube Analyst","image_sequence.deselect_scene":"Deselect all frames in this scene","image_sequence.clear_prompts_only":"Clear Text Prompts Only","image_sequence.prev_scene":"Previous Scene","image_sequence.next_scene":"Next Scene","image_sequence.frames_hidden":"({count} frames hidden)","image_sequence.frames_count":"({count} frames)","node.content.modificationRequest":"Modification Request","node.content.technicalPrompt":"Technical Prompt","node.promptProcessor.safePromptTooltip":"Rewrites the prompt to comply with safety guidelines and avoid policy violations.","node.promptProcessor.technicalPromptTooltip":"Converts the prompt into a highly detailed technical specification (lighting, camera, render settings).","node.promptProcessor.enhanceTooltip":"Uses AI to expand and enrich the prompt with descriptive details.","node.promptProcessor.chainTooltip":"Executes this node and triggers all connected downstream nodes.","image_sequence.tooltip.autoCrop":"Automatically crops generated images to 16:9 ratio.","image_sequence.tooltip.autoDownload":"Automatically saves each image to your device upon generation.","image_sequence.tooltip.createZip":"Packages all selected images into a single ZIP archive for download."},_w={"imageEditor.title":"Image Editor","imageEditor.canvasResolution":"Canvas Resolution","imageEditor.background":"Background","imageEditor.toolSettings":"Tool Settings","imageEditor.snapToEdges":"Snap to Edges","imageEditor.freeAspect":"Free Aspect Ratio","imageEditor.section.aiRequest":"AI Modification Request","imageEditor.input.modificationPlaceholder":'Describe changes, e.g., "change background to blue"',"imageEditor.action.sendRequest":"Send Request","imageEditor.tooltip.removeObject":"Remove (Red) / Keep (Green)","imageEditor.action.removeObject":"Remove Object","imageEditor.action.removeBackground":"Remove Background","imageEditor.tool.transform":"Transform","imageEditor.tool.hand":"Hand (Pan)","imageEditor.tool.zoom":"Zoom","imageEditor.tool.pencil":"Pencil","imageEditor.tool.rectangle":"Rectangle","imageEditor.action.fit":"Fit to Canvas","imageEditor.action.fill":"Fill Canvas","imageEditor.action.cancel":"Cancel","imageEditor.action.resetEdits":"Reset Edits","imageEditor.action.apply":"Apply","imageViewer.title":"Image Viewer","imageEditor.outputResolution":"Output Resolution","imageEditor.outputResolutionHelp":'Set output resolution. If "Auto", uses canvas resolution.',"imageEditor.currentSize":"Current Size: {width}x{height}","imageEditor.sequenceMode":"Sequence Mode","imageEditor.sequenceModeHelp":"Process input images from Input A sequentially.","imageEditor.sequentialCombination":"Sequential Image Combination","imageEditor.sequentialCombinationHelp":"For each frame: Sends current Input A image + All Input B images.","imageEditor.sequentialPrompt":"Sequential Prompt Combination","imageEditor.sequentialPromptHelp":"For each frame: Uses a unique prompt from the list + current image.","imageEditor.sequentialEditingWithPrompts":"Sequential Editing with Prompts","imageEditor.sequentialEditingWithPromptsHelp":"For each frame: Uses Input B image + unique prompt. Input A is ignored.","imageEditor.input":"Input","imageEditor.inputA":"Input A","imageEditor.inputB":"Input B","imageEditor.status.queued":"Queued","imageEditor.status.generating":"Generating...","imageEditor.action.regenerate":"Regenerate","imageEditor.tooltip.fit":"Fit image to canvas boundaries (contain).","imageEditor.tooltip.fill":"Scale image to fill canvas (cover).","imageEditor.tooltip.flip":"Flip image horizontally.","imageEditor.background.white":"White","imageEditor.background.gray":"Gray","imageEditor.background.black":"Black","imageEditor.background.dark":"Dark","image_sequence.regenerate":"Regenerate","image_sequence.stop_queue":"Stop Queue","image_sequence.move_up":"Move Up","image_sequence.move_down":"Move Down","image_sequence.copy_prompt":"Copy Prompt","image_sequence.add_frame":"Add Frame","image_sequence.delete_frame":"Delete Frame","image_sequence.expand_all_frames":"Expand/Collapse All Frames","image_sequence.collapse_all_frames":"Collapse All Frames","image_sequence.expand_all_scenes":"Expand/Collapse All Scenes","image_sequence.collapse_all_scenes":"Collapse All Scenes","image_sequence.expand_all":"Expand All","image_sequence.collapse_all":"Collapse All","image_sequence.clear_all_prompts":"Clear All Prompts","image_sequence.add_first_frame":"Add First Frame","image_sequence.drop_or_add_title":"Drop Sequence JSON or Add Frame","image_sequence.drop_or_add_desc":"Drop a JSON file here or click to add a frame manually.","image_sequence.load_prompts":"Load Prompts","image_sequence.output_images_title":"Output Images","image_sequence.prompts_list_title":"Source Prompts","image_sequence.download_selected":"Download Selected","image_sequence.select_all":"Select All","image_sequence.select_none":"Select None","image_sequence.invert_selection":"Invert Selection","image_sequence.run_selected":"Run Selected","image_sequence.start_queue":"Start Queue","image_sequence.character_prompt_combination":"Character Prompt Combination","image_sequence.combination_none":"None","image_sequence.combination_combine":"Combine","image_sequence.combination_replace":"Replace Tags","image_sequence.status.error":"Error","image_sequence.status.pending":"Queued","image_sequence.clear_selected_prompts":"Clear Selected Prompts","image_sequence.range_from":"From:","image_sequence.range_to":"To:","image_sequence.stats.total":"Total Frames: {count}","image_sequence.stats.generated":"Generated: {count}","image_sequence.stats.queue":"Queue: {count}","image_sequence.edit_in_source":"Edit in Source","image_sequence.edit_prompt":"Edit Prompt","image_sequence.select_scene":"Select Scene","image_sequence.next_scene":"Next Scene","image_sequence.prev_scene":"Previous Scene","image_sequence.scene_input_label":"Scene","image_sequence.select_square":"Select Square (1:1)","image_sequence.select_landscape":"Select Landscape (16:9)","image_sequence.select_portrait":"Select Portrait (9:16)","image_sequence.select_range":"Select Range","image_sequence.force_refresh":"Force Refresh","image_sequence.select_scene_frames":"Select all frames in this scene","image_sequence.collapse_other_scenes":"Collapse other scenes","prompt_sequence_editor.instructionPlaceholder":"Enter instruction to modify prompts...","prompt_sequence_editor.modifying":"Modifying...","prompt_sequence_editor.modifySelected":"Modify Selected ({count})","prompt_sequence_editor.sourcePrompts":"Source Prompts","prompt_sequence_editor.finalPrompts":"Modified Prompts","prompt_sequence_editor.error.invalidInput":"Invalid data format. Please connect a prompt sequence array.","geminiChat.mode.general":"General","geminiChat.mode.prompt":"Prompt Expert","geminiChat.mode.script":"Script Writer","geminiChat.mode.youtube":"YouTube Analyst","geminiChat.mode.developer":"Developer","image_sequence.shot_type.WS":"Integrate the Entity with a Wide Shot (WS) into the scene and action. Show the environment.","image_sequence.shot_type.MS":"Integrate the Entity with a Medium Shot (MS) into the scene. Character from waist up.","image_sequence.shot_type.CU":"Integrate the Entity with a Close-Up (CU) into the scene.","image_sequence.shot_type.ECU":"Integrate the Entity with an Extreme Close-Up (ECU) into the scene. Maximum detail.","image_sequence.shot_type.LS":"Integrate the Entity with a Long Shot (LS) into the scene to show scale."},Sw={"dialog.permission.title":"Permission Required","dialog.permission.description":"This app needs permission to read from your clipboard to allow pasting content into nodes. Your data is not stored or sent anywhere.","dialog.permission.allow":"Allow","dialog.permission.decline":"Decline","dialog.rename.title":"Rename Item","dialog.rename.group.title":"Rename Group","dialog.rename.catalog.title":"Rename Catalog Item","dialog.rename.node.title":"Rename Node","dialog.rename.label":"New Name:","dialog.rename.confirm":"Rename","dialog.rename.cancel":"Cancel","dialog.promptEdit.title":"Edit Prompt","dialog.promptEdit.nameLabel":"Name:","dialog.promptEdit.contentLabel":"Content:","dialog.promptEdit.confirm":"Save","dialog.promptEdit.cancel":"Cancel","dialog.confirmDelete.title":"Confirm Deletion","dialog.confirmDelete.message":"Are you sure you want to delete this item? This action cannot be undone.","dialog.confirmDelete.confirm":"Delete","dialog.confirmDelete.cancel":"Cancel","dialog.confirmCloseTab.title":"Close Tab","dialog.confirmCloseTab.message":'Are you sure you want to close the tab "{tabName}"? Unsaved changes will be lost.',"dialog.confirmClear.title":"Clear Canvas","dialog.confirmClear.message":"Are you sure you want to clear the entire canvas? This action cannot be undone.","dialog.confirmReset.title":"Reset to Default","dialog.confirmReset.message":"Are you sure you want to reset the canvas to the default state? All current work will be lost.","dialog.confirmReset.confirm":"Reset","dialog.confirmLoad.title":"Confirm Load","dialog.confirmLoad.message":"Loading a new file will replace the current content. Any unsaved changes will be lost. Continue?","dialog.apiKey.title":"Select API Key","dialog.apiKey.description":'This feature requires a Project API key with the "AI Platform" API enabled. Video generation can take a few minutes.',"dialog.apiKey.billingLink":"Learn more about billing","dialog.apiKey.button":"Select API Key","dialog.settings.title":"Settings","dialog.settings.apiKeyLabel":"Google Gemini API Key","settings.googleClientIdLabel":"Client ID","settings.googleDriveTitle":"Google Drive Integration","settings.signInWithGoogle":"Sign In with Google","dialog.settings.useDevKeyLabel":"Use free API key (for development)","dialog.settings.instantNodeCloseLabel":"Instant node closing","dialog.settings.nodeAnimationLabel":"Node Addition Animation","dialog.settings.animationModeLabel":"Creation Animation Mode","dialog.settings.anim.pulse":"Pulse","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"None","dialog.settings.description":"Configure your environment preferences and API access below.","dialog.settings.getKeyLink":"Get an API Key here","dialog.settings.save":"Save & Close","dialog.settings.reload":"Restart App","dialog.deleteNode.title":"Close node?","dialog.deleteNode.titlePlural":"Close nodes?","dialog.deleteNode.confirm":"Yes","dialog.deleteNode.cancel":"No","dialog.deleteNode.confirmTooltip":"Close node - lost data cannot be recovered","dialog.deleteNode.cancelTooltip":"Do not close - continue working with the node","dialog.deleteNode.dontShowAgain":"Don't show again","dialog.exitApp.title":"Close Project?","dialog.exitApp.message":"Are you sure you want to close the project? All current work will be lost and the canvas will be reset.","toast.driveSaved":"Project saved to Google Drive successfully","toast.driveSaveFailed":"Failed to save to Google Drive","error.googleDriveInit":"Google Drive Client ID not set. Please configure it in Settings.","settings.group.api":"API & Access","settings.group.style":"Appearance & Behavior","settings.group.drive":"Cloud Storage","settings.themeLabel":"Interface Theme","dialog.reload.title":"Restart Application?","dialog.reload.message":"This will clear the current canvas completely and reload the page. Any unsaved changes will be lost.","dialog.settings.connectionsLabel":"Connections Style","dialog.settings.connectionAnimationLabel":"Data Flow Animation","dialog.settings.connectionOpacityLabel":"Line Opacity"},Nw={"group.button.create":"Create Group ({count})","group.rename":"Rename Group","group.saveToCatalog":"Save to Catalog","group.saveToDisk":"Save to Disk","group.ungroup":"Ungroup (Shift+Click to delete with content)","group.duplicate":"Duplicate group with content","catalog.tabs.groups":"Groups","catalog.tabs.library":"Library","catalog.tabs.characters":"Characters","catalog.tabs.scripts":"Scripts","catalog.tabs.sequences":"Sequences","catalog.back":"Back","catalog.load":"Load from File","catalog.newFolder":"New Folder","catalog.saveTo":"Save to Catalog","catalog.card.addToCanvas":"Add to Canvas","catalog.card.rename":"Rename","catalog.card.save":"Save","catalog.card.delete":"Delete","catalog.empty.description":"This folder is empty. You can add items or create new folders.","library.loadFromFile":"Load","library.actions.newFolder":"New Folder","library.actions.newPrompt":"New Prompt","library.actions.copy":"Copy","library.actions.edit":"Edit","library.empty.title":"Empty Folder","library.empty.description":"Create prompts and folders to get started.","library.emptyPrompt":"Empty prompt"},Ew={...bw,...Cw,...kw,..._w,...Sw,...Nw},Pw={"app.title":" ","app.subtitle":"    ","app.error.title":"","app.error.copy":" ","app.error.copied":"!","error.apiKey":" API-   . ,   API-.","error.scriptModifierCanvas":'      - " ". ,  " "    .',"welcome.title":"  ","welcome.description":"    .     .       .","welcome.apiKeyLabel":" API  Google Gemini","welcome.apiKeyPlaceholder":"  API  ...","welcome.apiKeyHelp":" API     .","welcome.getKeyLink":"  API ","welcome.iAmDeveloper":" ","welcome.letsGo":"","welcome.resume":"","welcome.startNew":" ","welcome.freeModeActive":"  ","welcome.selectLanguage":"Select your primary language","welcome.navHint":"        ","toast.contentCleared":" ","toast.downloadStarted":" ","toast.characterLoaded":"  ","toast.characterSavedDisk":"    ","toast.copiedToClipboard":"   ","toast.pastedFromClipboard":"   ","toast.pasteFailed":" ","toast.nodeDuplicated":" ","toast.groupSavedToDisk":' "{groupTitle}" .  ',"toast.groupDeleted":"   ","toast.characterSavedCatalog":"   ","toast.promptSaved":"   : {promptName}...","toast.connectionsCut":" ","toast.apiKeySaved":"API   ","toast.cacheCleared":" {count}    ","toast.cacheEmpty":"  ","toast.scriptSaved":"   ","toast.modificationComplete":"  ","toast.canvasSaved":"  ","toast.projectSaved":"  ","alert.groupSaved":' "{groupTitle}" .  .',"alert.loadCatalogFailed":"    ","alert.invalidCatalogFile":"   ","alert.fileNotSupported":'  .    "appName".',"alert.invalidCatalogStructure":'  .  "root".',"tutorial.step1":" ,      .","tutorial.step2":' " ",      .',"tutorial.step2_waiting":"       ...","tutorial.step3":",     .","tutorial.step3b":"   .      .","tutorial.step4":"          .","tutorial.group.catalog":"       .","tutorial.group.general":"      .","tutorial.group.input":"   ,   .","tutorial.group.processing":"        .","tutorial.group.character":",     .","tutorial.group.output":"    .","tutorial.group.ai":"  Gemini   .","tutorial.group.video":"     .","tutorial.group.scripts":"      .","tutorial.group.file":" ,     .","tutorial.success.title":" !","tutorial.success.message":"     .    !","tutorial.success.button":" ","tutorial.skip":"","tutorial.next":"","tutorial.finish":""},Tw={"toolbar.settings":"","toolbar.resetCanvas":" ","toolbar.clearCache":"  ","toolbar.home":"","toolbar.exitApp":" ","toolbar.edit":" (V)","toolbar.cutter":"  (C) / ( Ctrl)","toolbar.selection":" (S) / ( Shift)","toolbar.reroute":" (R) / ( Ctrl+Alt)","toolbar.zoom":" ( Z)","toolbar.snapToGrid":"  ","toolbar.smartGuides":" ","toolbar.lineStyleSpaghetti":' ""',"toolbar.lineStyleOrthogonal":" ","toolbar.resetZoom":" ","toolbar.resetCamera":"  ","toolbar.clearCanvas":" ","toolbar.addNode":"  (F)","toolbar.catalog":"  (Ctrl + )","toolbar.addNote":"  (N)","toolbar.addDataReader":"   (Shift + R)","toolbar.addTextInput":"   (T)","toolbar.addImageInput":"   (I)","toolbar.addPromptSequenceEditor":"   (Q)","toolbar.addImageAnalyzer":"   (Shift+A)","toolbar.addPromptAnalyzer":"   (A)","toolbar.addPromptProcessor":"   (P)","toolbar.addCharacterGenerator":"  (Shift+C)","toolbar.addCharacterAnalyzer":"  (Ctrl+Shift+A)","toolbar.addCharacterCard":"  (Ctrl+Shift+C)","toolbar.addImageOutput":"   (O)","toolbar.addImageEditor":"    (Shift+I)","toolbar.addImageSequenceGenerator":"   (Shift+Q)","toolbar.addTranslator":"  (L)","toolbar.addGeminiChat":"   Gemini (M)","toolbar.addVideoPromptProcessor":"    (Shift+P)","toolbar.addVideoOutput":"   (Shift+O)","toolbar.addScriptGenerator":"  ","toolbar.addScriptViewer":"   (Shift + V)","toolbar.saveCanvas":"  (Ctrl + S)","toolbar.saveProject":" ","toolbar.saveToDrive":"  Google ","toolbar.loadCanvas":" / (Ctrl + O)","toolbar.group.general":"","toolbar.group.catalog":"","toolbar.group.input":"","toolbar.group.processing":"","toolbar.group.character":"","toolbar.group.output":"","toolbar.group.aiTools":" ","toolbar.group.video":"","toolbar.group.scripts":"","toolbar.group.file":"","toolbar.title":" ","toolbar.dock":" ","toolbar.detach":" ","toolbar.expandPanel":" ","toolbar.collapsePanel":" ","toolbar.dockArea.title":"  ","toolbar.duplicate":" ","toolbar.duplicateWithContent":"  ","toolbar.dock.q1":" 1- .","toolbar.dock.q2":" 2- .","toolbar.dock.q3":" 3- .","toolbar.dock.q4":" 4- .","toolbar.dock.tl":" ","toolbar.dock.bl":" ","toolbar.dock.tr":" ","toolbar.dock.br":" ","toolbar.dock.left":" ","toolbar.dock.right":" ","toolbar.dock.full":" ","toolbar.dock.exitFull":"   ","toolbar.dock.fullFocus":"   ","hotkeys.show":"  ","hotkeys.tools.title":"","hotkeys.tools.edit":" ","hotkeys.tools.cutter":" ","hotkeys.tools.selection":" ","hotkeys.tools.reroute":" ","hotkeys.tools.zoom":" ","hotkeys.tools.toggleLineStyle":"  ","hotkeys.tools.group":"","hotkeys.tools.closeNode":" ","hotkeys.tools.duplicate":" ","hotkeys.tools.duplicateWithContent":"  ","hotkeys.tools.deleteGroup":"  (Shift+)","hotkeys.windows.title":"","hotkeys.windows.search":" ","hotkeys.windows.catalog":"","hotkeys.createNode.title":" ","help.panelTitle":"   ","help.subtitle":" ","help.title":" ","help.howToUse.title":" ","help.howToUse.content":"   Prompt Modifier!         .     .         .         .   -  .","help.author":"","help.tab.links":"   ","help.section.socials":" ","help.section.studioStable":"Google AI Studio ()","help.section.studioAlpha":"Google AI Studio ()","help.section.netlify":" Netlify","help.section.github":" GitHub","help.section.githubPages":"  GitHub","help.license":" GNU GPLv3","help.copyLink":" ","help.copied":"!","contextMenu.undoPosition":" ","contextMenu.redoPosition":" ","contextMenu.align.left":"   (F)","contextMenu.align.centerX":"  . (E)","contextMenu.align.right":"   (R)","contextMenu.align.top":"  (T)","contextMenu.align.centerY":"  . (D)","contextMenu.align.bottom":"  (B)","contextMenu.distribute.horizontal":".  . (Ctrl+D)","contextMenu.distribute.vertical":".  . (Ctrl+E)","contextMenu.emptySlot":"  (  )","contextMenu.saveSlots":"  ","contextMenu.loadSlots":"  ","quickadd.title":" ","quickadd.group.tools":"","quickadd.group.inputs":"","quickadd.group.processing":"","quickadd.group.character":"","quickadd.group.outputs":"","quickadd.group.ai":"","quickadd.group.video":"","quickadd.group.scripts":"","quickadd.group.general":"","quickadd.group.youtube":"","quickadd.tool.edit":"","quickadd.tool.cutter":"","quickadd.tool.selection":"","search.placeholder":"   ...","search.noResults":"  .","search.group.input":"  ","search.group.process":"  ","search.group.output":"  ","search.group.ai":" ","search.group.video":"  ","search.group.scripts":"","toolbar.enterFullScreen":"  ","toolbar.exitFullScreen":"   ","dialog.settings.hoverHighlightLabel":"   "},Iw={"node.title.text_input":" ","node.title.image_input":" ","node.title.prompt_processor":" ","node.title.prompt_sanitizer":" ","node.title.video_prompt_processor":"  ","node.title.image_output":" ","node.title.video_output":" ","node.title.prompt_analyzer":" ","node.title.character_analyzer":" ","node.title.character_generator":" ","node.title.character_card":" ","node.title.image_analyzer":" ","node.title.image_editor":"  ","node.title.image_sequence_generator":"  ","node.title.prompt_sequence_editor":"  ","node.title.gemini_chat":"  Gemini","node.title.translator":"","node.title.script_generator":" ","node.title.script_viewer":" ","node.title.note":"","node.title.reroute_dot":" ","node.title.data_reader":" ","node.title.video_editor":"   ","node.title.media_viewer":"  ","node.title.data_protection":" ","node.title.pose_creator":" ","node.help.text_input":"        .","node.help.image_input":"         .","node.help.prompt_processor":"           .","node.help.prompt_sanitizer":"  ,       ,   .","node.help.video_prompt_processor":"        .","node.help.image_output":"   .    .","node.help.video_output":"       Veo.","node.help.prompt_analyzer":"   : , ,   ..","node.help.character_analyzer":"         .","node.help.character_generator":"       .","node.help.character_card":"    ,    .","node.help.image_analyzer":"      .","node.help.image_editor":"          inpainting/outpainting.","node.help.image_sequence_generator":"      .","node.help.prompt_sequence_editor":"       -.","node.help.gemini_chat":" -  Gemini     .","node.help.translator":"   ,   .","node.help.script_generator":"   (, )   .","node.help.script_viewer":"       .","node.help.note":"       .","node.help.reroute_dot":" ,         .","node.help.data_reader":"     ,   .","node.help.video_editor":"        .","node.help.media_viewer":"         .","node.help.data_protection":"  Tower Defense.      ,   .","node.help.pose_creator":"     .","node.action.expand":"","node.action.collapse":"","node.action.help":"","node.action.download":"","node.action.clear":" ","node.action.refreshChat":"   ","node.action.paste":"","node.action.resetEditor":" ","node.action.saveCharacter":"  ","node.action.loadCharacter":"  ","node.action.copy":"","node.action.copyImage":" ","node.action.copyTextPrompt":" ","node.action.copyImagePrompt":"  ","node.action.copyVideoPrompt":"  ","node.action.cutConnections":" ","node.action.close":"","node.action.closeNode":"  (Shift+   )","node.action.closeNodeSimple":" ","node.action.randomWord":"  ","node.action.processImage":"  ","node.action.processImageTitle":" Gemini        .","node.action.editor":"","node.action.rasterEditor":" ","node.action.openInAIEditor":"   ","node.action.openInAnalyzer":"  ","node.action.outputToInput":"   ","node.action.processChainForward":" ","node.action.executeChain":" ","node.action.executeChainTitle":"       .","node.action.sanitize":"","node.action.rename":"","node.action.stop":"","node.action.stopping":"...","node.action.deleteItem":" ","node.action.detachAndPaste":"  ","node.action.delete":"","node.action.flipImage":"","node.action.pin":"  ","node.action.unpin":" ","node.action.updateDescription":"   ","node.action.modifyCharacter":" ","node.action.updateDataFormat":"  ","node.action.expand169":"  16:9","node.action.expand916":"  9:16","node.action.sync":" ","node.action.expandRatio":" ","node.action.markPrimary":" ","node.action.addCard":" ","node.action.removeCard":" ","node.action.showOutputs":" ","node.action.hideOutputs":" ","node.action.characterConcept":" ","node.action.objectConcept":" ","node.action.downloadTxt":" .txt","node.action.downloadDoc":" .doc","node.mediaViewer.play":"","node.mediaViewer.pause":"","node.mediaViewer.stop":"","node.mediaViewer.addMarker":" ","node.mediaViewer.exportSRT":"  (SRT)","node.mediaViewer.deleteAllMarkers":"  ","node.mediaViewer.saveMarkers":" ","node.mediaViewer.loadMarkers":" ","node.mediaViewer.relink":" ","node.content.notePlaceholder":"   ...","node.content.dropImage":"      ","node.content.dropMedia":"    ","node.content.processing":"...","node.content.processingChain":" ...","node.content.metadataPrompt":"   :","node.content.metadataPromptPlaceholder":"    .","node.content.copyPrompt":".","node.content.prompt":"","node.content.inputPrompt":" ","node.content.enhancedResult":" ","node.content.videoPrompt":"Video Prompt","node.content.editPromptPlaceholder":"   ...","node.content.enhancedPromptHere":"   ...","node.content.safePrompt":"   ","node.content.generating":"...","node.content.imageHere":"  ","node.content.generationMode":" ","node.content.aspectRatio":" ","node.content.aspectRatioHelp":"     ","node.content.aspectRatioNotSupportedFast":"      Imagen.","node.content.enableAspectRatioFormatting":"   ","node.content.autoDownload":"","node.content.generateImage":" ","node.content.enhancing":"...","node.content.enhancePrompt":" ","node.content.sanitizing":"...","node.content.sanitizedPromptHere":"   ...","node.content.analyzing":"...","node.content.analyzePrompt":" ","node.content.analyzeImage":" ","node.content.imageToText":"  ","node.content.updatePromptFromImage":"   ","node.content.analyzeCharacter":" ","node.content.generateCharacters":" ","node.content.characterPromptPlaceholder":" ()  ...","node.content.character":"","node.content.clothing":"","node.content.characterPlaceholder":"   ...","node.content.clothingPlaceholder":"   ...","node.content.appearance":"","node.content.personality":"","node.content.environment":"/","node.content.action":"","node.content.emotion":"","node.content.style":"","node.content.environmentPlaceholder":"  ...","node.content.charactersPlaceholder":"  ...","node.content.characters":"","node.content.characterConcepts":" ","node.content.actionPlaceholder":" ...","node.content.emotionPlaceholder":" ...","node.content.stylePlaceholder":"  ...","node.content.descriptionHere":"  ...","node.content.enableOutpainting":" Outpainting","node.content.outpaintingPromptPlaceholder":"  Outpainting...","node.content.inputImage":" ","node.content.dropOrClick":"  ","node.content.outputImage":" ","node.content.applyEdit":"","node.content.editing":"...","node.content.chatPlaceholder":"  ...","node.content.connectedPlaceholder":"  ,   .","node.content.connectedNode":"  ","node.content.connectedEmpty":"    .","node.content.translatePlaceholder":"  ...","node.content.translatedTextPlaceholder":" ...","node.content.targetLanguage":" ","node.content.translate":"","node.content.translating":"...","node.content.scriptPromptPlaceholder":"    ...","node.content.generateScript":" ","node.content.loadScript":"  ","node.content.summary":" ","node.content.scenes":"","node.content.unrecognizedFormat":"  .","node.content.frames":"","node.content.characterIndex":"","node.content.readData":" ","node.content.textDataHere":"   .","node.content.noDataRead":'    " ",   .',"node.content.previewError":" ","node.content.previewPlaceholder":"  ","node.content.imagePrompt":" ","node.output.allPromptData":"  ","node.note.tab.note":"","node.note.tab.references":"","node.note.nestedImages":" ","node.note.dropPlaceholder":"     ","node.note.addCaption":"","node.note.action.shuffle":"","node.note.action.undoShuffle":" ","node.content.characterTypeShort":":","node.content.numberOfCharactersShort":"-:","node.content.characterType.simple":"","node.content.characterType.anthro":"","node.content.characterType.chibi":"","node.content.characterType.key_item":" ","node.content.style.simple":"","node.content.style.realistic":"","node.content.style.3d_cartoon":"3D ","node.content.style.3d_realistic":"3D ","node.content.style.2d_animation":"2D ","node.content.style.anime":"","node.content.style.comics":"","node.content.style.custom":" ","node.content.fullDescriptionTitle":"  ","node.content.integrationInstruction":" ","node.content.additionalPromptSuffix":".  ()","node.content.insertSceneContext":"  ","node.content.modificationRequest":"  ","search.node.text_input.title":" ","search.node.text_input.description":"   .","search.node.image_input.title":" ","search.node.image_input.description":"   .","search.node.prompt_sequence_editor.title":"  ","search.node.prompt_sequence_editor.description":"      ,   .","search.node.data_reader.title":" ","search.node.data_reader.description":"     (  )       .","search.node.note.title":"","search.node.note.description":"  .","search.node.prompt_processor.title":" ","search.node.prompt_processor.description":"     .","search.node.prompt_analyzer.title":" ","search.node.prompt_analyzer.description":"   .","search.node.prompt_sanitizer.title":" ","search.node.prompt_sanitizer.description":" ,       .","search.node.character_card.title":" ","search.node.character_card.description":"    .","search.node.character_analyzer.title":" ","search.node.character_analyzer.description":"     .","search.node.character_generator.title":" ","search.node.character_generator.description":"         .","search.node.image_analyzer.title":" ","search.node.image_analyzer.description":"    .","search.node.image_editor.title":"  ","search.node.image_editor.description":"    con .","search.node.image_sequence_generator.title":"  ","search.node.image_sequence_generator.description":"      .","search.node.gemini_chat.title":"  Gemini","search.node.gemini_chat.description":"    con Gemini,       .","search.node.translator.title":"","search.node.translator.description":"         .","search.node.script_generator.title":" ","search.node.script_generator.description":"   (, )   .","search.node.script_viewer.title":" ","search.node.script_viewer.description":"       .","search.node.note":"        .","search.node.reroute_dot":" ,         .","search.node.video_prompt_processor.title":"  ","search.node.video_prompt_processor.description":"     .","search.node.video_output.title":" ","search.node.video_output.description":"     Veo.","search.node.image_output.title":" ","search.node.image_output.description":"     .","search.node.media_viewer.title":"  ","search.node.media_viewer.description":"         .","search.node.data_protection.title":" ","search.node.data_protection.description":"- Tower Defense.     ,     .","search.node.pose_creator.title":" ","search.node.pose_creator.description":"     .","prompt_sequence_editor.instructionPlaceholder":"    ...","prompt_sequence_editor.modifying":"...","prompt_sequence_editor.modifySelected":"  ({count})","prompt_sequence_editor.sourcePrompts":" ","prompt_sequence_editor.finalPrompts":" ","prompt_sequence_editor.error.invalidInput":"  . ,    .","geminiChat.mode.general":"","geminiChat.mode.prompt":"  ","geminiChat.mode.script":"","geminiChat.mode.youtube":" ","image_sequence.shot_type.WS":"     (WS)    .  .","image_sequence.shot_type.MS":"     (MS)  .   .","image_sequence.shot_type.CU":"     (CU)  .","image_sequence.shot_type.ECU":"      (ECU)  .  .","image_sequence.shot_type.LS":"     (LS)  ,   ."},jw={"imageEditor.title":" ","imageEditor.canvasResolution":" ","imageEditor.background":"","imageEditor.toolSettings":" ","imageEditor.snapToEdges":"  ","imageEditor.freeAspect":" ","imageEditor.section.aiRequest":"  ","imageEditor.input.modificationPlaceholder":" , :      ...","imageEditor.action.sendRequest":" ","imageEditor.tooltip.removeObject":" () /  ()","imageEditor.action.removeObject":" ","imageEditor.action.removeBackground":" ","imageEditor.tool.transform":"","imageEditor.tool.hand":" ()","imageEditor.tool.zoom":"","imageEditor.tool.pencil":"","imageEditor.tool.rectangle":"","imageEditor.action.fit":"  ","imageEditor.action.fill":" ","imageEditor.action.cancel":"","imageEditor.action.resetEdits":" ","imageEditor.action.apply":"","imageViewer.title":" ","imageEditor.outputResolution":" ","imageEditor.outputResolutionHelp":'    .  "Auto",   .',"imageEditor.currentSize":" : {width}x{height}","imageEditor.sequenceMode":" ","imageEditor.sequenceModeHelp":"     .","imageEditor.sequentialCombination":"  ","imageEditor.sequentialCombinationHelp":"  :     +    .","imageEditor.sequentialPrompt":"  ","imageEditor.sequentialPromptHelp":"  :      +  .","imageEditor.sequentialEditingWithPrompts":"   ","imageEditor.sequentialEditingWithPromptsHelp":"  :     +  .   .","imageEditor.input":"","imageEditor.inputA":" A","imageEditor.inputB":" B","imageEditor.status.queued":" ","imageEditor.status.generating":"...","imageEditor.action.regenerate":"","imageEditor.tooltip.fit":"     (contain).","imageEditor.tooltip.fill":"     (cover).","imageEditor.tooltip.flip":"   .","imageEditor.background.white":"","imageEditor.background.gray":"","imageEditor.background.black":"","imageEditor.background.dark":"","image_sequence.regenerate":"","image_sequence.stop_queue":" ","image_sequence.move_up":"","image_sequence.move_down":"","image_sequence.copy_prompt":" ","image_sequence.add_frame":" ","image_sequence.delete_frame":" ","image_sequence.expand_all_frames":"/  ","image_sequence.collapse_all_frames":"  ","image_sequence.expand_all_scenes":"/  ","image_sequence.collapse_all_scenes":"  ","image_sequence.expand_all":" ","image_sequence.collapse_all":" ","image_sequence.clear_all_prompts":"  ","image_sequence.add_first_frame":"  ","image_sequence.drop_or_add_title":" JSON    ","image_sequence.drop_or_add_desc":" JSON  ,       .","image_sequence.load_prompts":" ","image_sequence.output_images_title":" ","image_sequence.prompts_list_title":" ","image_sequence.download_selected":" ","image_sequence.select_all":" ","image_sequence.select_none":" ","image_sequence.invert_selection":"","image_sequence.run_selected":" ","image_sequence.start_queue":" ","image_sequence.character_prompt_combination":"  ","image_sequence.combination_none":"","image_sequence.combination_combine":"","image_sequence.combination_replace":" ","image_sequence.status.error":"","image_sequence.status.pending":" ","image_sequence.clear_selected_prompts":"  ","image_sequence.range_from":":","image_sequence.range_to":":","image_sequence.stats.total":" : {count}","image_sequence.stats.generated":": {count}","image_sequence.stats.queue":" : {count}","image_sequence.edit_in_source":"  ","image_sequence.edit_prompt":" ","image_sequence.select_scene":" ","image_sequence.next_scene":" ","image_sequence.prev_scene":" ","image_sequence.scene_input_label":"","image_sequence.select_square":"  (1:1)","image_sequence.select_landscape":"  (16:9)","image_sequence.select_portrait":"  (9:16)","image_sequence.select_range":" ","image_sequence.force_refresh":" ","image_sequence.select_scene_frames":"   ","image_sequence.collapse_other_scenes":"  ","prompt_sequence_editor.instructionPlaceholder":"    ...","prompt_sequence_editor.modifying":"...","prompt_sequence_editor.modifySelected":"  ({count})","prompt_sequence_editor.sourcePrompts":" ","prompt_sequence_editor.finalPrompts":" ","prompt_sequence_editor.error.invalidInput":"  . ,    .","geminiChat.mode.general":"","geminiChat.mode.prompt":"  ","geminiChat.mode.script":"","geminiChat.mode.youtube":" ","geminiChat.mode.developer":"","image_sequence.shot_type.WS":"     (WS)    .  .","image_sequence.shot_type.MS":"     (MS)  .   .","image_sequence.shot_type.CU":"     (CU)  .","image_sequence.shot_type.ECU":"      (ECU)  .  .","image_sequence.shot_type.LS":"     (LS)  ,   ."},Aw={"dialog.permission.title":" ","dialog.permission.description":"        ,     .        .","dialog.permission.allow":"","dialog.permission.decline":"","dialog.rename.title":" ","dialog.rename.group.title":" ","dialog.rename.catalog.title":"  ","dialog.rename.node.title":" ","dialog.rename.label":" :","dialog.rename.confirm":"","dialog.rename.cancel":"","dialog.promptEdit.title":" ","dialog.promptEdit.nameLabel":":","dialog.promptEdit.contentLabel":":","dialog.promptEdit.confirm":"","dialog.promptEdit.cancel":"","dialog.confirmDelete.title":" ","dialog.confirmDelete.message":" ,     ?    .","dialog.confirmDelete.confirm":"","dialog.confirmDelete.cancel":"","dialog.confirmCloseTab.title":" ","dialog.confirmCloseTab.message":' ,     "{tabName}"?    .',"dialog.confirmClear.title":" ","dialog.confirmClear.message":" ,     ?    .","dialog.confirmReset.title":"  ","dialog.confirmReset.message":" ,        ?     .","dialog.confirmReset.confirm":"","dialog.confirmLoad.title":" ","dialog.confirmLoad.message":"     .     . ?","dialog.apiKey.title":" API-","dialog.apiKey.description":'    API-    API "AI Platform".      .',"dialog.apiKey.billingLink":"   ","dialog.apiKey.button":" API-","dialog.settings.title":"","dialog.settings.apiKeyLabel":"API  Google Gemini","settings.googleClientIdLabel":"Client ID","settings.googleDriveTitle":"  Google Drive","settings.signInWithGoogle":"  Google","dialog.settings.useDevKeyLabel":"  ( )","dialog.settings.instantNodeCloseLabel":"  ","dialog.settings.nodeAnimationLabel":"   ","dialog.settings.animationModeLabel":"  ","dialog.settings.anim.pulse":"","dialog.settings.anim.bladeRunner":"  ","dialog.settings.anim.none":"","dialog.settings.description":"    API    .","dialog.settings.getKeyLink":" API  ","dialog.settings.save":"","dialog.settings.reload":"","dialog.deleteNode.title":" ?","dialog.deleteNode.titlePlural":" ?","dialog.deleteNode.confirm":"","dialog.deleteNode.cancel":"","dialog.deleteNode.confirmTooltip":"  -     ","dialog.deleteNode.cancelTooltip":"  -    ","dialog.deleteNode.dontShowAgain":"  ","dialog.exitApp.title":" ?","dialog.exitApp.message":" ,    ?     ,   .","toast.driveSaved":"    Google ","toast.driveSaveFailed":"   Google ","error.googleDriveInit":"Google Drive Client ID  . ,    .","settings.group.api":"API  ","settings.group.style":"   ","settings.group.drive":" ","settings.themeLabel":" ","dialog.reload.title":" ?","dialog.reload.message":"       .     .","dialog.settings.connectionsLabel":" ","dialog.settings.connectionAnimationLabel":"  ","dialog.settings.connectionOpacityLabel":" "},Mw={"group.button.create":"  ({count})","group.rename":" ","group.saveToCatalog":"  ","group.saveToDisk":"  ","group.ungroup":" (shift +    )","group.duplicate":"   ","catalog.tabs.groups":"","catalog.tabs.library":"","catalog.tabs.characters":"","catalog.tabs.scripts":"","catalog.tabs.sequences":"","catalog.back":"","catalog.load":"  ","catalog.newFolder":" ","catalog.saveTo":"  ","catalog.card.addToCanvas":"  ","catalog.card.rename":"","catalog.card.save":"","catalog.card.delete":"","catalog.empty.description":"  .        .","library.loadFromFile":"","library.actions.newFolder":" ","library.actions.newPrompt":" ","library.actions.copy":"","library.actions.edit":"","library.empty.title":" ","library.empty.description":"   ,  .","library.emptyPrompt":" "},Rw={...Pw,...Tw,...Iw,...jw,...Aw,...Mw},Lw={"app.title":"Modificador de Prompt","app.subtitle":"Conecta ideas para crear una obra maestra","app.error.title":"Notificacin","app.error.copy":"Copiar Mensaje","app.error.copied":"Copiado!","error.apiKey":"Tu clave API es invlida o le faltan permisos. Por favor selecciona una clave API vlida.","error.scriptModifierCanvas":"Este lienzo pertenece a otra aplicacin: Modificador de Guiones. Por favor usa esa aplicacin para abrir este archivo.","welcome.title":"Bienvenido a","welcome.description":"Bienvenido a Prompt Modifier. Conecta ideas para crear obras maestras. Usa nodos para generar y editar contenido.","welcome.apiKeyLabel":"Tu Clave API de Google Gemini","welcome.apiKeyPlaceholder":"Ingresa tu clave API aqu...","welcome.apiKeyHelp":"Tu clave API se almacena localmente.","welcome.getKeyLink":"Obtener Clave API","welcome.iAmDeveloper":"Soy Desarrollador","welcome.letsGo":"Vamos!","welcome.resume":"Continuar","welcome.startNew":"Nueva Tela","welcome.freeModeActive":"Modo Gratuito Activo","welcome.selectLanguage":"Selecciona tu idioma principal","welcome.navHint":"Usa las teclas del teclado  y  para cambiar el idioma","toast.contentCleared":"Contenido borrado","toast.downloadStarted":"Descarga iniciada","toast.characterLoaded":"Tarjeta de personaje cargada","toast.characterSavedDisk":"Tarjeta de personaje guardada en disco","toast.copiedToClipboard":"Copiado al portapapeles","toast.pastedFromClipboard":"Pegado desde el portapapeles","toast.pasteFailed":"Fallo al pegar","toast.nodeDuplicated":"Nodo duplicado","toast.groupSavedToDisk":'Grupo "{groupTitle}" guardado en disco',"toast.groupDeleted":"Grupo y contenido eliminados","toast.characterSavedCatalog":"Personaje guardado en catlogo","toast.promptSaved":"Prompt guardado en biblioteca: {promptName}...","toast.connectionsCut":"Conexiones eliminadas","toast.apiKeySaved":"Clave API guardada exitosamente","toast.cacheCleared":"Se limpiaron {count} elementos no usados de la cach","toast.cacheEmpty":"La cach ya est optimizada","toast.scriptSaved":"Guion guardado en disco","alert.groupSaved":'Grupo "{groupTitle}" guardado en catlogo.',"alert.loadCatalogFailed":"Fallo al cargar archivo de catlogo","alert.invalidCatalogFile":"Formato de archivo de catlogo invlido","alert.fileNotSupported":'Archivo no soportado. Falta o es incorrecto "appName".',"alert.invalidCatalogStructure":'Estructura de catlogo invlida. Falta "root".'},Dw={"toolbar.settings":"Ajustes","toolbar.resetCanvas":"Restablecer Lienzo","toolbar.clearCache":"Borrar Cach No Usada","toolbar.home":"Inicio","toolbar.edit":"Editar (V)","toolbar.cutter":"Cortar Conexin (C) / (Mantener Ctrl)","toolbar.selection":"Seleccin (S) / (Mantener Shift)","toolbar.reroute":"Redirigir (R) / (Mantener Ctrl+Alt)","toolbar.zoom":"Zoom (Mantener Z)","toolbar.snapToGrid":"Ajustar a la Cuadrcula","toolbar.smartGuides":"Guas Inteligentes","toolbar.lineStyleSpaghetti":"Lneas Espagueti","toolbar.lineStyleOrthogonal":"Lneas Ortogonales","toolbar.resetZoom":"Restablecer Zoom","toolbar.resetCamera":"Restablecer Cmara","toolbar.clearCanvas":"Limpiar Lienzo","toolbar.addNode":"Aadir Nodo (F)","toolbar.catalog":"Abrir Catlogo (Ctrl + Espacio)","toolbar.addNote":"Aadir Nota (N)","toolbar.addDataReader":"Aadir Lector de Datos (Shift + R)","toolbar.addTextInput":"Aadir Entrada de Texto (T)","toolbar.addImageInput":"Aadir Entrada de Imagen (I)","toolbar.addPromptSequenceEditor":"Aadir Editor de Secuencia de Prompts (Q)","toolbar.addImageAnalyzer":"Aadir Analizador de Imagen (Shift+A)","toolbar.addPromptAnalyzer":"Aadir Analizador de Prompt (A)","toolbar.addPromptProcessor":"Aadir Procesador de Prompt (P)","toolbar.addCharacterGenerator":"Aadir Generador de Personajes (Shift+C)","toolbar.addCharacterAnalyzer":"Aadir Analizador de Personajes (Ctrl+Shift+A)","toolbar.addCharacterCard":"Aadir Tarjeta de Personaje (Ctrl+Shift+C)","toolbar.addImageOutput":"Aadir Salida de Imagen (O)","toolbar.addImageEditor":"Aadir Editor de Imagen IA (Shift+I)","toolbar.addImageSequenceGenerator":"Aadir Generador de Secuencia de Imgenes (Shift+Q)","toolbar.addTranslator":"Aadir Traductor (L)","toolbar.addGeminiChat":"Aadir Chat Gemini (M)","toolbar.addVideoPromptProcessor":"Aadir Procesador de Prompt de Video (Shift+P)","toolbar.addVideoOutput":"Aadir Salida de Video (Shift+O)","toolbar.addScriptGenerator":"Aadir Generador de Guiones","toolbar.addScriptViewer":"Aadir Visor de Guiones (Shift + V)","toolbar.saveCanvas":"Guardar Lienzo (Ctrl + S)","toolbar.saveProject":"Guardar Proyecto","toolbar.loadCanvas":"Cargar Proyecto/Lienzo (Ctrl + O)","toolbar.group.general":"General","toolbar.group.catalog":"Catlogo","toolbar.group.input":"Entrada","toolbar.group.processing":"Procesamiento","toolbar.group.character":"Personaje","toolbar.group.output":"Salida","toolbar.group.aiTools":"Herramientas IA","toolbar.group.video":"Video","toolbar.group.scripts":"Guiones","toolbar.group.file":"Archivo","toolbar.title":"Barra de Herramientas","toolbar.dock":"Acoplar Barra","toolbar.detach":"Desacoplar Barra","toolbar.expandPanel":"Expandir Panel","toolbar.collapsePanel":"Colapsar Panel","toolbar.dockArea.title":"Acoplar Barra Aqu","toolbar.duplicate":"Duplicar Nodo","toolbar.duplicateWithContent":"Duplicar con Contenido","toolbar.dock.q1":"Izq. 1er Cto","toolbar.dock.q2":"Izq. 2do Cto","toolbar.dock.q3":"Der. 3er Cto","toolbar.dock.q4":"Der. 4to Cto","toolbar.dock.tl":"Arriba Izq.","toolbar.dock.bl":"Abajo Izq.","toolbar.dock.tr":"Arriba Der.","toolbar.dock.br":"Abajo Der.","toolbar.dock.left":"Mitad Izq.","toolbar.dock.right":"Mitad Der.","toolbar.dock.full":"Pantalla Completa","toolbar.dock.exitFull":"Salir Pantalla Completa","toolbar.dock.fullFocus":"Enfoque Pantalla Completa","hotkeys.show":"Mostrar Atajos","hotkeys.tools.title":"Herramientas","hotkeys.tools.edit":"Modo Edicin","hotkeys.tools.cutter":"Herramienta de Corte","hotkeys.tools.selection":"Herramienta de Seleccin","hotkeys.tools.reroute":"Herramienta de Redireccin","hotkeys.tools.zoom":"Herramienta de Zoom","hotkeys.tools.toggleLineStyle":"Cambiar Estilo de Lnea","hotkeys.tools.group":"Seleccin de Grupo","hotkeys.tools.closeNode":"Eliminar Seleccionado","hotkeys.tools.duplicate":"Duplicar Nodo","hotkeys.tools.duplicateWithContent":"Duplicar con Contenido","hotkeys.tools.deleteGroup":"Eliminar Grupo (Shift+Clic)","hotkeys.windows.title":"Ventanas","hotkeys.windows.search":"Bsqueda Rpida","hotkeys.windows.catalog":"Catlogo","hotkeys.createNode.title":"Crear Nodo","help.panelTitle":"Ayuda y Atajos","help.subtitle":"Centro de Ayuda","help.title":"Atajos de Teclado","help.howToUse.title":"Cmo Usar","help.howToUse.content":"Bienvenido a Prompt Modifier! Usa la barra de herramientas o atajos para aadir nodos. Conecta nodos para pasar datos. Usa la herramienta Editar para mover nodos y el lienzo. Haz doble clic en el espacio vaco para abrir el men de adicin rpida. Clic derecho para el men contextual.","help.author":"Autor","help.tab.links":"Otras Apps y Enlaces","help.section.socials":"Redes Sociales","help.section.studioStable":"Google AI Studio (Estable)","help.section.studioAlpha":"Google AI Studio (Alpha)","help.section.netlify":"Apps Netlify","help.section.github":"Repositorios GitHub","help.license":"Licencia GNU GPLv3","help.copyLink":"Copiar Enlace","help.copied":"Copiado!","contextMenu.undoPosition":"Deshacer Posicin","contextMenu.redoPosition":"Rehacer Posicin","contextMenu.align.left":"Alinear Izquierda (F)","contextMenu.align.centerX":"Alinear Centro X (E)","contextMenu.align.right":"Alinear Derecha (R)","contextMenu.align.top":"Alinear Arriba (T)","contextMenu.align.centerY":"Alinear Centro Y (D)","contextMenu.align.bottom":"Alinear Abajo (B)","contextMenu.distribute.horizontal":"Distribuir Horiz. (Ctrl+D)","contextMenu.distribute.vertical":"Distribuir Vert. (Ctrl+E)","contextMenu.emptySlot":"Ranura Vaca (Click Der. para asignar)","contextMenu.saveSlots":"Guardar Config. Ranuras","contextMenu.loadSlots":"Cargar Config. Ranuras","quickadd.title":"Aadir Rpido","quickadd.group.tools":"Herramientas","quickadd.group.inputs":"Entradas","quickadd.group.processing":"Procesamiento","quickadd.group.character":"Personaje","quickadd.group.outputs":"Salidas","quickadd.group.ai":"Herramientas IA","quickadd.group.video":"Video","quickadd.group.scripts":"Guiones","quickadd.group.general":"General","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"Editar","quickadd.tool.cutter":"Cortar","quickadd.tool.selection":"Seleccin","search.placeholder":"Buscar un nodo para aadir...","search.noResults":"No se encontraron nodos.","search.group.input":"Entrada y Bsico","search.group.process":"Procesamiento y Personaje","search.group.output":"Imagen y Secuencia","search.group.ai":"Herramientas IA","search.group.video":"Video y Guion","search.group.scripts":"Guiones","toolbar.exitApp":"Cerrar Proyecto","toolbar.enterFullScreen":"Pantalla Completa","toolbar.exitFullScreen":"Salir Pantalla Completa"},zw={"node.title.text_input":"Entrada de Texto","node.title.image_input":"Entrada de Imagen","node.title.prompt_processor":"Procesador de Prompt","node.title.prompt_sanitizer":"Sanitizador de Prompt","node.title.video_prompt_processor":"Proc. de Prompt de Video","node.title.image_output":"Salida de Imagen","node.title.video_output":"Salida de Video","node.title.prompt_analyzer":"Analizador de Prompt","node.title.character_analyzer":"Analizador de Personaje","node.title.character_generator":"Generador de Personajes","node.title.character_card":"Tarjeta de Personaje","node.title.image_analyzer":"Analizador de Imagen","node.title.image_editor":"Editor de Imagen IA","node.title.image_sequence_generator":"Generador de Secuencia de Imgenes","node.title.prompt_sequence_editor":"Editor de Secuencia de Prompts","node.title.gemini_chat":"Chat Gemini","node.title.translator":"Traductor","node.title.script_generator":"Generador de Guiones","node.title.script_viewer":"Visor de Guiones","node.title.note":"Nota","node.title.reroute_dot":"Punto de Redireccin","node.title.data_reader":"Lector de Datos","node.title.video_editor":"Editor de Video Versin Alfa","node.title.media_viewer":"Visor Multimedia","node.title.data_protection":"Proteccin de Datos","node.title.pose_creator":"Pose Creator","node.help.text_input":"Un campo de texto multilnea simple para ingresar prompts o notas.","node.help.image_input":"Permite subir o pegar una imagen para usarla como entrada en otros nodos.","node.help.prompt_processor":"Combina mltiples entradas de texto en un solo prompt mejorado usando IA.","node.help.prompt_sanitizer":"Reescribe el prompt de entrada para que sea ms seguro para las polticas de generacin de imgenes.","node.help.video_prompt_processor":"Procesador especializado para crear prompts detallados de generacin de video.","node.help.image_output":"Muestra el resultado de la generacin de imagen. Permite descargar y ver.","node.help.video_output":"Muestra el resultado de la generacin de video usando el modelo Veo.","node.help.prompt_analyzer":"Deconstruye un prompt en componentes como sujeto, estilo y entorno.","node.help.character_analyzer":"Analiza una descripcin de personaje y la divide en apariencia y ropa.","node.help.character_generator":"Genera descripciones detalladas de personajes basadas en un prompt corto.","node.help.character_card":"Almacena datos completos del personaje, incluyendo imagen y descripcin.","node.help.image_analyzer":"Usa IA para describir el contenido de una imagen de entrada.","node.help.image_editor":"Herramienta avanzada para editar imgenes usando prompts de texto e inpainting/outpainting.","node.help.image_sequence_generator":"Genera una secuencia de imgenes basada en una lista de prompts.","node.help.prompt_sequence_editor":"Permite la edicin masiva de secuencias de prompts usando instrucciones de IA.","node.help.gemini_chat":"Una interfaz de chat de propsito general con Gemini para lluvia de ideas o asistencia.","node.help.translator":"Traduce texto entre idiomas usando modelos de IA.","node.help.script_generator":"Genera un guion estructurado (escenas, personajes) a partir de una idea de historia.","node.help.script_viewer":"Visualiza y gestiona datos de guiones para la generacin cuadro por cuadro.","node.help.note":"Una nota adhesiva para agregar comentarios o instrucciones al lienzo.","node.help.reroute_dot":"Un punto pequeo usado para organizar conexiones y crear diseos ms limpios.","node.help.data_reader":"Herramienta de depuracin para inspeccionar los datos brutos que fluyen a travs de las conexiones.","node.help.video_editor":"Una herramienta basada en lnea de tiempo para editar clips de video e imgenes.","node.help.media_viewer":"Un reproductor para ver archivos de video y audio con controles de reproduccin.","node.help.data_protection":"Un nodo de mini-juego interactivo de Defensa de Torres. Defiende tus datos.","node.help.pose_creator":"Visual rig to define and generate character poses for consistency.","node.action.expand":"Expandir","node.action.collapse":"Colapsar","node.action.help":"Ayuda","node.action.download":"Descargar","node.action.clear":"Borrar Contenido","node.action.refreshChat":"Borrar y Reiniciar Chat","node.action.paste":"Pegar","node.action.resetEditor":"Restablecer Editor","node.action.saveCharacter":"Guardar Tarjeta","node.action.loadCharacter":"Cargar Tarjeta","node.action.copy":"Copiar","node.action.copyImage":"Copiar Imagen","node.action.copyTextPrompt":"Copiar Prompt","node.action.copyImagePrompt":"Copiar Prompt de Imagen","node.action.copyVideoPrompt":"Copiar Prompt de Video","node.action.cutConnections":"Cortar Conexiones","node.action.close":"Cerrar","node.action.closeNode":"Cerrar Nodo (Shift+Clic para cierre instantneo)","node.action.closeNodeSimple":"Cerrar Nodo","node.action.randomWord":"Aadir Palabra Aleatoria","node.action.processImage":"Eliminar Marcas de Agua","node.action.processImageTitle":"Usa Gemini para eliminar marcas de agua y texto de la imagen.","node.action.editor":"Editor","node.action.rasterEditor":"Editor Raster","node.action.openInAIEditor":"Abrir en Editor IA","node.action.openInAnalyzer":"Abrir en Analizador","node.action.outputToInput":"Usar Salida como Entrada","node.action.processChainForward":"Procesar Hacia Adelante","node.action.executeChain":"Ejecutar Cadena","node.action.executeChainTitle":"Ejecutar todos los nodos anteriores para generar el resultado final.","node.action.sanitize":"Sanitizar","node.action.rename":"Renombrar","node.action.stop":"Parar","node.action.stopping":"Parando...","node.action.deleteItem":"Eliminar Elemento","node.action.detachAndPaste":"Despegar y Pegar","node.action.delete":"Eliminar","node.action.flipImage":"Voltear Imagen","node.action.pin":"Fijar Nodo Arriba","node.action.unpin":"Desfijar Nodo","node.action.updateDescription":"Actualizar descripcin desde prompt","node.action.modifyCharacter":"Solicitar Cambios","node.action.updateDataFormat":"Actualizar formato de datos","node.action.expand169":"Expandir a 16:9","node.action.expand916":"Expandir a 9:16","node.action.sync":"Sincronizar desde conexiones","node.action.expandRatio":"Extender Relacin de Aspecto","node.action.markPrimary":"Marcar como Principal","node.action.addCard":"Aadir Tarjeta","node.action.removeCard":"Eliminar Tarjeta","node.action.showOutputs":"Mostrar Salidas","node.action.hideOutputs":"Ocultar Salidas","node.action.characterConcept":"Concepto de Personaje","node.action.objectConcept":"Concepto de Objeto","node.mediaViewer.play":"Reproducir","node.mediaViewer.pause":"Pausa","node.mediaViewer.stop":"Parar","node.mediaViewer.addMarker":"Aadir Marcador","node.mediaViewer.exportSRT":"Exportar Marcadores (SRT)","node.mediaViewer.deleteAllMarkers":"Eliminar Todos los Marcadores","node.mediaViewer.saveMarkers":"Guardar Marcadores en Disco","node.mediaViewer.loadMarkers":"Cargar Marcadores desde Disco","node.mediaViewer.relink":"Revincular Archivo","node.content.notePlaceholder":"Escribe tus notas aqu...","node.content.dropImage":"Suelta imagen aqu o clic para subir","node.content.dropMedia":"Suelta video o audio aqu","node.content.processing":"Procesando...","node.content.processingChain":"Procesando Cadena...","node.content.metadataPrompt":"Prompt de Metadatos:","node.content.metadataPromptPlaceholder":"No se encontr prompt en la imagen.","node.content.copyPrompt":"Usar","node.content.prompt":"Prompt","node.content.inputPrompt":"Prompt de Entrada","node.content.enhancedResult":"Resultado Mejorado","node.content.videoPrompt":"Prompt de Video","node.content.editPromptPlaceholder":"Aade o edita el prompt...","node.content.enhancedPromptHere":"El prompt mejorado aparecer aqu...","node.content.safePrompt":"Seguro para uso comercial","node.content.generating":"Generando...","node.content.imageHere":"La imagen aparecer aqu","node.content.generationMode":"Modelo de Generacin","node.content.aspectRatio":"Relacin de Aspecto","node.content.aspectRatioHelp":"Establecer relacin de aspecto para generacin de imagen","node.content.aspectRatioNotSupportedFast":"Relacin de aspecto solo disponible para modelos Imagen.","node.content.enableAspectRatioFormatting":"Habilitar Formato de Relacin de Aspecto","node.content.autoDownload":"Auto Descarga","node.content.generateImage":"Generar Imagen","node.content.enhancing":"Mejorando...","node.content.enhancePrompt":"Mejorar Prompt","node.content.sanitizing":"Sanitizando...","node.content.sanitizedPromptHere":"El prompt sanitizado aparecer aqu...","node.content.analyzing":"Analizando...","node.content.analyzePrompt":"Analizar Prompt","node.content.analyzeImage":"Analizar Imagen","node.content.imageToText":"Imagen a Texto","node.content.updatePromptFromImage":"Actualizar prompt desde imagen","node.content.analyzeCharacter":"Analizar Personaje","node.content.generateCharacters":"Generar Personajes","node.content.characterPromptPlaceholder":"Describe personaje(s) para generar...","node.content.character":"Personaje","node.content.clothing":"Ropa","node.content.characterPlaceholder":"La descripcin del personaje aparecer aqu...","node.content.clothingPlaceholder":"La descripcin de la ropa aparecer aqu...","node.content.appearance":"Apariencia","node.content.personality":"Personalidad","node.content.environment":"Entorno/Escenario","node.content.action":"Accin","node.content.emotion":"Emocin","node.content.style":"Estilo","node.content.environmentPlaceholder":"Descripcin detallada del entorno...","node.content.charactersPlaceholder":"Lista de personajes principales...","node.content.characters":"Personajes","node.content.characterConcepts":"Conceptos de Personaje","node.content.actionPlaceholder":"Descripcin de la accin...","node.content.emotionPlaceholder":"Descripcin de la emocin...","node.content.stylePlaceholder":"Descripcin del estilo artstico...","node.content.descriptionHere":"La descripcin aparecer aqu...","node.content.enableOutpainting":"Habilitar Outpainting","node.content.outpaintingPromptPlaceholder":"Prompt de Outpainting...","node.content.inputImage":"Imgenes de Entrada","node.content.dropOrClick":"Soltar o Clic","node.content.outputImage":"Imagen de Salida","node.content.applyEdit":"Aplicar Edicin","node.content.editing":"Editando...","node.content.chatPlaceholder":"Escribe tu mensaje...","node.content.connectedPlaceholder":"Conectado a nodo, editar en fuente.","node.content.connectedNode":"Conectado va nodo","node.content.connectedEmpty":"El nodo conectado no tiene imagen.","node.content.translatePlaceholder":"Texto a traducir...","node.content.translatedTextPlaceholder":"Texto traducido...","node.content.targetLanguage":"Idioma de Destino","node.content.translate":"Traducir","node.content.translating":"Traduciendo...","node.content.scriptPromptPlaceholder":"Introduce una idea de historia o trama...","node.content.generateScript":"Generar Guion","node.content.loadScript":"Cargar Archivo de Guion","node.content.summary":"Resumen","node.content.scenes":"Escenas","node.content.unrecognizedFormat":"Formato de guion no reconocido.","node.content.frames":"Cuadros","node.content.characterIndex":"ndice","node.content.readData":"Leer Datos","node.content.textDataHere":"Los datos de texto aparecern aqu.","node.content.noDataRead":'Conecta un nodo y haz clic en "Leer Datos" para ver su contenido.',"node.content.previewError":"Error de Previsualizacin","node.content.previewPlaceholder":"La previsualizacin aparecer aqu","node.content.imagePrompt":"Prompt de Imagen","node.output.allPromptData":"Todos los Datos del Prompt","node.note.tab.note":"Nota","node.note.tab.references":"Referencias","node.note.nestedImages":"Imgenes Anidadas","node.note.dropPlaceholder":"Suelta imgenes o clic para aadir","node.note.addCaption":"Leyenda","node.note.action.shuffle":"Mezclar","node.note.action.undoShuffle":"Deshacer Mezcla","node.content.characterTypeShort":"Tipo:","node.content.numberOfCharactersShort":"Cant:","node.content.characterType.simple":"Simple","node.content.characterType.anthro":"Anthro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Objeto Clave","node.content.style.simple":"Simple","node.content.style.realistic":"Realista","node.content.style.3d_cartoon":"3D Cartoon","node.content.style.3d_realistic":"3D Realista","node.content.style.2d_animation":"Animacin 2D","node.content.style.anime":"Anime","node.content.style.comics":"Comics","node.content.style.custom":"Personalizado","node.content.fullDescriptionTitle":"Descripcin completa del personaje","node.content.integrationInstruction":"Instruccin de integracin","node.content.additionalPromptSuffix":"Prompt Adicional (Sufijo)","search.node.text_input.title":"Entrada de Texto","search.node.text_input.description":"Un campo de texto multilnea simple.","search.node.image_input.title":"Entrada de Imagen","search.node.image_input.description":"Sube o pega una imagen.","search.node.prompt_sequence_editor.title":"Editor de Secuencia de Prompts","search.node.prompt_sequence_editor.description":"Edita una lista de prompts usando una sola instruccin, permitiendo modificaciones por lotes.","search.node.data_reader.title":"Lector de Datos","search.node.data_reader.description":"Lee y muestra la salida sin procesar (texto o imagen) de cualquier nodo conectado para depuracin.","search.node.note.title":"Nota","search.node.note.description":"Una nota adhesiva para comentarios.","search.node.prompt_processor.title":"Procesador de Prompt","search.node.prompt_processor.description":"Combina entradas en un prompt mejorado.","search.node.prompt_analyzer.title":"Analizador de Prompt","search.node.prompt_analyzer.description":"Deconstruye un prompt en componentes.","search.node.prompt_sanitizer.title":"Sanitizador de Prompt","search.node.prompt_sanitizer.description":"Reescribe el prompt para ser ms seguro para modelos IA.","search.node.character_card.title":"Tarjeta de Personaje","search.node.character_card.description":"Almacena informacin detallada sobre un personaje.","search.node.character_analyzer.title":"Analizador de Personaje","search.node.character_analyzer.description":"Divide una descripcin en apariencia y ropa.","search.node.character_generator.title":"Generador de Personajes","search.node.character_generator.description":"Genera una o ms descripciones detalladas de personajes basadas en un prompt.","search.node.image_analyzer.title":"Analizador de Imagen","search.node.image_analyzer.description":"Describe una imagen usando IA.","search.node.image_editor.title":"Editor de Imagen IA","search.node.image_editor.description":"Edita o combina imgenes con un prompt.","search.node.image_sequence_generator.title":"Generador de Secuencia de Imgenes","search.node.image_sequence_generator.description":"Genera una secuencia de imgenes basada en una lista de prompts.","search.node.gemini_chat.title":"Chat Gemini","search.node.gemini_chat.description":"Una interfaz conversacional para chatear con Gemini, til para lluvia de ideas.","search.node.translator.title":"Traductor","search.node.translator.description":"Traduce texto entre idiomas usando modelos de IA.","search.node.script_generator.title":"Generador de Guiones","search.node.script_generator.description":"Genera un guion estructurado (escenas, personajes) a partir de una historia.","search.node.script_viewer.title":"Visor de Guiones","search.node.script_viewer.description":"Visualiza y gestiona datos de guiones para generacin cuadro por cuadro.","search.node.note":"Un cuadro de texto simple para dejar notas y comentarios en el lienzo.","search.node.reroute_dot":"Un punto pequeo usado para organizar conexiones.","search.node.video_prompt_processor.title":"Procesador de Prompt de Video","search.node.video_prompt_processor.description":"Crea prompts detallados para generacin de video.","search.node.video_output.title":"Salida de Video","search.node.video_output.description":"Genera un video usando el modelo Veo.","search.node.image_output.title":"Salida de Imagen","search.node.image_output.description":"Muestra y permite descargar imgenes generadas.","search.node.media_viewer.title":"Visor Multimedia","search.node.media_viewer.description":"Reproductor para ver archivos de video y audio con controles.","search.node.data_protection.title":"Proteccin de Datos","search.node.data_protection.description":"Defiende tu flujo de datos de la corrupcin en este nodo de mini-juego.","search.node.pose_creator.title":"Pose Creator","search.node.pose_creator.description":"Visually rig and create character poses for generation guidance.","prompt_sequence_editor.instructionPlaceholder":"Introduce instruccin para modificar prompts...","prompt_sequence_editor.modifying":"Modificando...","prompt_sequence_editor.modifySelected":"Modificar Seleccionados ({count})","prompt_sequence_editor.sourcePrompts":"Prompts de Origen","prompt_sequence_editor.finalPrompts":"Prompts Modificados","prompt_sequence_editor.error.invalidInput":"Formato de datos invlido. Por favor conecta un array de secuencia de prompts.","geminiChat.mode.general":"General","geminiChat.mode.prompt":"Experto en Prompts","geminiChat.mode.script":"Guionista","geminiChat.mode.youtube":"Analista de YouTube","image_sequence.deselect_scene":"Deseleccionar todos los cuadros en esta escena","image_sequence.clear_prompts_only":"Borrar Solo Prompts de Texto","image_sequence.prev_scene":"Escena Anterior","image_sequence.next_scene":"Siguiente Escena","image_sequence.frames_hidden":"({count} cuadros ocultos)","image_sequence.frames_count":"({count} cuadros)","node.content.modificationRequest":"Solicitud de modificacin","node.content.technicalPrompt":"Prompt Tcnico","node.promptProcessor.safePromptTooltip":"Reescribe el prompt para cumplir con las pautas de seguridad y evitar infracciones de polticas.","node.promptProcessor.technicalPromptTooltip":"Convierte el prompt en una especificacin tcnica altamente detallada (iluminacin, cmara, ajustes de renderizado).","node.promptProcessor.enhanceTooltip":"Usa IA para expandir y enriquecer el prompt con detalles descriptivos.","node.promptProcessor.chainTooltip":"Ejecuta este nodo y activa todos los nodos posteriores conectados.","image_sequence.tooltip.autoCrop":"Recorta automticamente las imgenes generadas a una proporcin de 16:9.","image_sequence.tooltip.autoDownload":"Guarda automticamente cada imagen en tu dispositivo tras la generacin.","image_sequence.tooltip.createZip":"Empaqueta todas las imgenes seleccionadas en un nico archivo ZIP para su descarga."},qw={"imageEditor.title":"Editor de Imagen","imageEditor.canvasResolution":"Resolucin del Lienzo","imageEditor.background":"Fondo","imageEditor.toolSettings":"Ajustes de Herramienta","imageEditor.snapToEdges":"Ajustar a Bordes","imageEditor.freeAspect":"Relacin de Aspecto Libre","imageEditor.section.aiRequest":"Solicitud de Modificacin IA","imageEditor.input.modificationPlaceholder":'Describe cambios, ej. "cambiar fondo a azul"',"imageEditor.action.sendRequest":"Enviar Solicitud","imageEditor.tooltip.removeObject":"Eliminar (Rojo) / Mantener (Verde)","imageEditor.action.removeObject":"Eliminar Objeto","imageEditor.tool.transform":"Transformar","imageEditor.tool.hand":"Mano (Panormica)","imageEditor.tool.zoom":"Zoom","imageEditor.tool.pencil":"Lpiz","imageEditor.tool.rectangle":"Rectngulo","imageEditor.action.fit":"Ajustar al Lienzo","imageEditor.action.fill":"Llenar Lienzo","imageEditor.action.cancel":"Cancelar","imageEditor.action.resetEdits":"Restablecer Ediciones","imageEditor.action.apply":"Aplicar","imageViewer.title":"Visor de Imagen","imageEditor.outputResolution":"Resolucin de Salida","imageEditor.outputResolutionHelp":'Establecer resolucin de salida. Si es "Auto", usa la resolucin del lienzo.',"imageEditor.currentSize":"Tamao Actual: {width}x{height}","imageEditor.sequenceMode":"Modo Secuencia","imageEditor.sequenceModeHelp":"Procesar imgenes de entrada desde Entrada A secuencialmente.","imageEditor.sequentialCombination":"Combinacin Secuencial de Imgenes","imageEditor.sequentialCombinationHelp":"Para cada cuadro: Enve la imagen actual de A + Todas las imgenes de B.","imageEditor.sequentialPrompt":"Combinacin Secuencial de Prompts","imageEditor.sequentialPromptHelp":"Para cada cuadro: Usa un prompt nico de la lista + imagen actual.","imageEditor.sequentialEditingWithPrompts":"Edicin Secuencial con Prompts","imageEditor.sequentialEditingWithPromptsHelp":"Para cada cuadro: Usa imagen de B + prompt nico. La Entrada A se ignora.","imageEditor.input":"Entrada","imageEditor.inputA":"Entrada A","imageEditor.inputB":"Entrada B","imageEditor.status.queued":"En cola","imageEditor.status.generating":"Generando...","imageEditor.action.regenerate":"Regenerar","imageEditor.tooltip.fit":"Ajustar imagen a lmites del lienzo (contener).","imageEditor.tooltip.fill":"Escalar imagen para llenar lienzo (cubrir).","imageEditor.tooltip.flip":"Voltear imagen horizontalmente.","imageEditor.background.white":"Blanco","imageEditor.background.gray":"Gris","imageEditor.background.black":"Negro","imageEditor.background.dark":"Oscuro","image_sequence.regenerate":"Regenerar","image_sequence.stop_queue":"Detener Cola","image_sequence.move_up":"Mover Arriba","image_sequence.move_down":"Mover Abajo","image_sequence.copy_prompt":"Copiar Prompt","image_sequence.add_frame":"Aadir Cuadro","image_sequence.delete_frame":"Eliminar Cuadro","image_sequence.expand_all_frames":"Expandir/Colapsar Todos los Cuadros","image_sequence.collapse_all_frames":"Colapsar Todos los Cuadros","image_sequence.expand_all_scenes":"Expandir/Colapsar Todas las Escenas","image_sequence.collapse_all_scenes":"Colapsar Todas las Escenas","image_sequence.expand_all":"Expandir Todo","image_sequence.collapse_all":"Colapsar Todo","image_sequence.clear_all_prompts":"Borrar Todos los Prompts","image_sequence.add_first_frame":"Aadir Primer Cuadro","image_sequence.drop_or_add_title":"Soltar JSON de Secuencia o Aadir Cuadro","image_sequence.drop_or_add_desc":"Suelta un archivo JSON aqu o haz clic para aadir un cuadro manualmente.","image_sequence.load_prompts":"Cargar Prompts","image_sequence.output_images_title":"Imgenes de Salida","image_sequence.prompts_list_title":"Prompts de Origen","image_sequence.download_selected":"Descargar Seleccionados","image_sequence.select_all":"Seleccionar Todo","image_sequence.select_none":"Deseleccionar","image_sequence.invert_selection":"Invertir Seleccin","image_sequence.run_selected":"Ejecutar Seleccionados","image_sequence.start_queue":"Iniciar Cola","image_sequence.character_prompt_combination":"Combinacin de Prompt de Personaje","image_sequence.combination_none":"Ninguna","image_sequence.combination_combine":"Combinar","image_sequence.combination_replace":"Reemplazar Etiquetas","image_sequence.status.error":"Error","image_sequence.status.pending":"En cola","image_sequence.clear_selected_prompts":"Borrar Prompts Seleccionados","image_sequence.range_from":"De:","image_sequence.range_to":"A:","image_sequence.stats.total":"Total Cuadros: {count}","image_sequence.stats.generated":"Generados: {count}","image_sequence.stats.queue":"Cola: {count}","image_sequence.edit_in_source":"Editar en Fuente","image_sequence.edit_prompt":"Editar Prompt","image_sequence.select_scene":"Seleccionar Escena","image_sequence.next_scene":"Siguiente Escena","image_sequence.prev_scene":"Escena Anterior","image_sequence.scene_input_label":"Escena","image_sequence.select_square":"Seleccionar Cuadradas (1:1)","image_sequence.select_landscape":"Seleccionar Paisaje (16:9)","image_sequence.select_portrait":"Seleccionar Retrato (9:16)","image_sequence.select_range":"Seleccionar Rango","image_sequence.force_refresh":"Forzar Actualizacin","image_sequence.select_scene_frames":"Seleccionar todos los cuadros en esta escena","image_sequence.collapse_other_scenes":"Colapsar otras escenas","prompt_sequence_editor.instructionPlaceholder":"Introducir instruccin para modificar prompts...","prompt_sequence_editor.modifying":"Modificando...","prompt_sequence_editor.modifySelected":"Modificar Seleccionados ({count})","prompt_sequence_editor.sourcePrompts":"Prompts de Origen","prompt_sequence_editor.finalPrompts":"Prompts Modificados","prompt_sequence_editor.error.invalidInput":"Formato de datos invlido. Por favor conecte un array de secuencia de prompts.","geminiChat.mode.general":"General","geminiChat.mode.prompt":"Experto en Prompts","geminiChat.mode.script":"Guionista","geminiChat.mode.youtube":"Analista de YouTube","image_sequence.shot_type.WS":"Integra la Entidad con un Plano General (WS) en la escena y la accin. Muestra el entorno.","image_sequence.shot_type.MS":"Integra la Entidad con un Plano Medio (MS) en la escena. Personaje desde la cintura hacia arriba.","image_sequence.shot_type.CU":"Integra la Entidad con un Primer Plano (CU) en la escena.","image_sequence.shot_type.ECU":"Integra la Entidad con un Primersimo Primer Plano (ECU) en la escena. Mximo detalle.","image_sequence.shot_type.LS":"Integra la Entidad con un Plano Largo (LS) en la escena para mostrar escala."},Ow={"dialog.permission.title":"Permiso Requerido","dialog.permission.description":"Esta aplicacin necesita permiso para leer tu portapapeles y permitir pegar contenido en los nodos. Tus datos no se almacenan ni se envan a ningn lado.","dialog.permission.allow":"Permitir","dialog.permission.decline":"Rechazar","dialog.rename.title":"Renombrar Elemento","dialog.rename.group.title":"Renombrar Grupo","dialog.rename.catalog.title":"Renombrar Elemento de Catlogo","dialog.rename.node.title":"Renombrar Nodo","dialog.rename.label":"Nuevo Nombre:","dialog.rename.confirm":"Renombrar","dialog.rename.cancel":"Cancelar","dialog.promptEdit.title":"Editar Prompt","dialog.promptEdit.nameLabel":"Nombre:","dialog.promptEdit.contentLabel":"Contenido:","dialog.promptEdit.confirm":"Guardar","dialog.promptEdit.cancel":"Cancelar","dialog.confirmDelete.title":"Confirmar Eliminacin","dialog.confirmDelete.message":"Ests seguro de que quieres eliminar este elemento? Esta accin no se puede deshacer.","dialog.confirmDelete.confirm":"Eliminar","dialog.confirmDelete.cancel":"Cancelar","dialog.confirmCloseTab.title":"Cerrar Pestaa","dialog.confirmCloseTab.message":'Ests seguro de que quieres cerrar la pestaa "{tabName}"? Se perdern los cambios no guardados.',"dialog.confirmClear.title":"Limpiar Lienzo","dialog.confirmClear.message":"Ests seguro de que quieres limpiar todo el lienzo? Esta accin no se puede deshacer.","dialog.confirmReset.title":"Restablecer a Predeterminado","dialog.confirmReset.message":"Ests seguro de que quieres restablecer el lienzo al estado predeterminado? Se perder todo el trabajo actual.","dialog.confirmReset.confirm":"Restablecer","dialog.confirmLoad.title":"Confirmar Carga","dialog.confirmLoad.message":"Cargar un nuevo archivo reemplazar el contenido actual. Se perder cualquier cambio no guardado. Continuar?","dialog.apiKey.title":"Seleccionar Clave API","dialog.apiKey.description":'Esta funcin requiere una clave API de proyecto con la API "AI Platform" habilitada. La generacin de video puede tardar unos minutos.',"dialog.apiKey.billingLink":"Aprende ms sobre facturacin","dialog.apiKey.button":"Seleccionar Clave API","dialog.settings.title":"Ajustes","dialog.settings.apiKeyLabel":"Tu Clave API de Google Gemini:","dialog.settings.useDevKeyLabel":"Usar clave API gratuita (para desarrollo)","dialog.settings.instantNodeCloseLabel":"Cierre instantneo de nodos","dialog.settings.nodeAnimationLabel":"Animacin de Adicin de Nodo","dialog.settings.animationModeLabel":"Modo de Animacin de Creacin","dialog.settings.anim.pulse":"Pulso","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"Ninguna","dialog.settings.description":"Para usar tus propias cuotas y acceder a modelos especficos, ingresa tu clave API personal. La clave se almacena localmente en tu navegador.","dialog.settings.getKeyLink":"Obtn una Clave API aqu","dialog.settings.save":"Guardar","dialog.settings.reload":"Recargar App","dialog.deleteNode.title":"Cerrar nodo?","dialog.deleteNode.titlePlural":"Cerrar nodos?","dialog.deleteNode.confirm":"S","dialog.deleteNode.cancel":"No","dialog.deleteNode.confirmTooltip":"Cerrar nodo - los datos perdidos no se pueden recuperar","dialog.deleteNode.cancelTooltip":"No cerrar - continuar trabajando con el nodo","dialog.deleteNode.dontShowAgain":"No mostrar de nuevo","dialog.exitApp.title":"Cerrar Proyecto?","dialog.exitApp.message":"Ests seguro de que quieres cerrar el proyecto? Todo el trabajo actual se perder y el lienzo se reiniciar."},Fw={"group.button.create":"Crear Grupo ({count})","group.rename":"Renombrar Grupo","group.saveToCatalog":"Guardar en Catlogo","group.saveToDisk":"Guardar en Disco","group.ungroup":"Desagrupar (Shift+Clic para eliminar con contenido)","group.duplicate":"Duplicar grupo con contenido","catalog.tabs.groups":"Grupos","catalog.tabs.library":"Biblioteca","catalog.tabs.characters":"Personajes","catalog.tabs.scripts":"Guiones","catalog.tabs.sequences":"Secuencias","catalog.back":"Atrs","catalog.load":"Cargar desde Archivo","catalog.newFolder":"Nueva Carpeta","catalog.saveTo":"Guardar en Catlogo","catalog.card.addToCanvas":"Aadir al Lienzo","catalog.card.rename":"Renombrar","catalog.card.save":"Guardar","catalog.card.delete":"Eliminar","catalog.empty.description":"Esta carpeta est vaca. Puedes aadir elementos o crear nuevas carpetas.","library.loadFromFile":"Cargar","library.actions.newFolder":"Nueva Carpeta","library.actions.newPrompt":"Nuevo Prompt","library.actions.copy":"Copiar","library.actions.edit":"Editar","library.empty.title":"Carpeta Vaca","library.empty.description":"Crea prompts y carpetas para empezar.","library.emptyPrompt":"Prompt vaco"},Bw={...Lw,...Dw,...zw,...qw,...Ow,...Fw},Gw={"app.title":"Prompt Modifikatori","app.subtitle":"G'oyalarni bog'lab, shoh asar yarating","app.error.title":"Bildirishnoma","app.error.copy":"Xabarni nusxalash","app.error.copied":"Nusxalandi!","error.apiKey":"API kalitingiz yaroqsiz yoki ruxsatlar yetishmayapti. Iltimos, to'g'ri API kalitini tanlang.","error.scriptModifierCanvas":"Bu xolst boshqa ilovaga tegishli - Script Modifier. Iltimos, ushbu faylni ochish uchun Script Modifier-dan foydalaning.","welcome.title":"Xush kelibsiz","welcome.description":"Prompt Modifier-ga xush kelibsiz. G'oyalarni bog'lab, shoh asar yarating. Tarkibni yaratish va tahrirlash uchun tugunlardan foydalaning.","welcome.apiKeyLabel":"Sizning Google Gemini API Kalitingiz","welcome.apiKeyPlaceholder":"API kalitingizni shu yerga kiriting...","welcome.apiKeyHelp":"Sizning API kalitingiz lokal tarzda saqlanadi.","welcome.getKeyLink":"API Kalitini Olish","welcome.iAmDeveloper":"Men Dasturchiman","welcome.letsGo":"Boshladik","welcome.freeModeActive":"Bepul Rejim Faol","welcome.selectLanguage":"Asosiy tilingizni tanlang","welcome.navHint":"Tilni o'zgartirish uchun klaviatura tugmalari  va  dan foydalaning","toast.contentCleared":"Tarkib tozalandi","toast.downloadStarted":"Yuklab olish boshlandi","toast.characterLoaded":"Personaj kartasi yuklandi","toast.characterSavedDisk":"Personaj kartasi diskka saqlandi","toast.copiedToClipboard":"Buferga nusxalandi","toast.pastedFromClipboard":"Buferdan joylandi","toast.pasteFailed":"Joylash amalga oshmadi","toast.nodeDuplicated":"Tugun nusxalandi","toast.groupSavedToDisk":'"{groupTitle}" guruhi diskka saqlandi',"toast.groupDeleted":"Guruh va uning tarkibi o'chirildi","toast.characterSavedCatalog":"Personaj katalogga saqlandi","toast.promptSaved":"Prompt kutubxonaga saqlandi: {promptName}...","toast.connectionsCut":"Ulanishlar uzildi","toast.apiKeySaved":"API Kaliti muvaffaqiyatli saqlandi","toast.cacheCleared":"{count} ta foydalanilmagan element keshdan tozalandi","toast.cacheEmpty":"Kesh allaqachon optimallashtirilgan","toast.scriptSaved":"Ssenariy diskka saqlandi","alert.groupSaved":'"{groupTitle}" guruhi katalogga saqlandi.',"alert.loadCatalogFailed":"Katalog faylini yuklashda xatolik","alert.invalidCatalogFile":"Katalog fayli formati noto'g'ri","alert.fileNotSupported":`Fayl qo'llab-quvvatlanmaydi. "appName" yetishmayapti yoki noto'g'ri.`,"alert.invalidCatalogStructure":`Katalog tuzilishi noto'g'ri. "root" yetishmayapti.`},Hw={"toolbar.settings":"Sozlamalar","toolbar.resetCanvas":"Xolstni tiklash","toolbar.clearCache":"Foydalanilmagan keshni tozalash","toolbar.home":"Bosh sahifa","toolbar.edit":"Tahrirlash (V)","toolbar.cutter":"Ulanishni qirqish (C) / (Ctrl bosib turing)","toolbar.selection":"Tanlash (S) / (Shift bosib turing)","toolbar.reroute":"Yo'naltirish (R) / (Ctrl+Alt bosib turing)","toolbar.zoom":"Kattalashtirish (Z bosib turing)","toolbar.snapToGrid":"To'rga yopishtirish","toolbar.smartGuides":"Aqlli qo'llanmalar","toolbar.lineStyleSpaghetti":"Spagetti chiziqlar","toolbar.lineStyleOrthogonal":"To'g'ri chiziqlar","toolbar.resetZoom":"Masshtabni tiklash","toolbar.resetCamera":"Kamera holatini tiklash","toolbar.clearCanvas":"Xolstni tozalash","toolbar.addNode":"Tugun qo'shish (F)","toolbar.catalog":"Katalogni ochish (Ctrl + Space)","toolbar.addNote":"Eslatma qo'shish (N)","toolbar.addDataReader":"Ma'lumot o'quvchi qo'shish (Shift + R)","toolbar.addTextInput":"Matn kiritish qo'shish (T)","toolbar.addImageInput":"Rasm kiritish qo'shish (I)","toolbar.addPromptSequenceEditor":"Prompt ketma-ketligi muharriri (Q)","toolbar.addImageAnalyzer":"Rasm analizatorini qo'shish (Shift+A)","toolbar.addPromptAnalyzer":"Prompt analizatorini qo'shish (A)","toolbar.addPromptProcessor":"Prompt protsessorini qo'shish (P)","toolbar.addCharacterGenerator":"Personaj generatorini qo'shish (Shift+C)","toolbar.addCharacterAnalyzer":"Personaj analizatorini qo'shish (Ctrl+Shift+A)","toolbar.addCharacterCard":"Personaj kartasini qo'shish (Ctrl+Shift+C)","toolbar.addImageOutput":"Rasm natijasini qo'shish (O)","toolbar.addImageEditor":"AI Rasm muharririni qo'shish (Shift+I)","toolbar.addImageSequenceGenerator":"Rasm ketma-ketligi generatorini qo'shish (Shift+Q)","toolbar.addTranslator":"Tarjimon qo'shish (L)","toolbar.addGeminiChat":"Gemini Chat qo'shish (M)","toolbar.addVideoPromptProcessor":"Video prompt protsessorini qo'shish (Shift+P)","toolbar.addVideoOutput":"Video natijasini qo'shish (Shift+O)","toolbar.addScriptGenerator":"Ssenariy generatorini qo'shish","toolbar.addScriptViewer":"Ssenariy ko'ruvchisini qo'shish (Shift + V)","toolbar.saveCanvas":"Xolstni saqlash (Ctrl + S)","toolbar.saveProject":"Loyihani saqlash","toolbar.loadCanvas":"Loyiha/Xolstni yuklash (Ctrl + O)","toolbar.group.general":"Umumiy","toolbar.group.catalog":"Katalog","toolbar.group.input":"Kiritish","toolbar.group.processing":"Qayta ishlash","toolbar.group.character":"Personaj","toolbar.group.output":"Chiqarish","toolbar.group.aiTools":"AI Vositalari","toolbar.group.video":"Video","toolbar.group.scripts":"Ssenariylar","toolbar.group.file":"Fayl","toolbar.title":"Asboblar paneli","toolbar.dock":"Panelni mahkamlash","toolbar.detach":"Panelni ajratish","toolbar.expandPanel":"Panelni kengaytirish","toolbar.collapsePanel":"Panelni yig'ish","toolbar.dockArea.title":"Panelni shu yerga mahkamlash","toolbar.duplicate":"Tugunni nusxalash","toolbar.duplicateWithContent":"Tarkib bilan nusxalash","toolbar.dock.q1":"Chap 1-chorak","toolbar.dock.q2":"Chap 2-chorak","toolbar.dock.q3":"O'ng 3-chorak","toolbar.dock.q4":"O'ng 4-chorak","toolbar.dock.tl":"Yuqori Chap","toolbar.dock.bl":"Pastki Chap","toolbar.dock.tr":"Yuqori O'ng","toolbar.dock.br":"Pastki O'ng","toolbar.dock.left":"Chap Yarim","toolbar.dock.right":"O'ng Yarim","toolbar.dock.full":"To'liq Ekran","toolbar.dock.exitFull":"To'liq ekrandan chiqish","toolbar.dock.fullFocus":"To'liq ekran fokusi","hotkeys.show":"Tugmalar birikmasini ko'rsatish","hotkeys.tools.title":"Vositalar","hotkeys.tools.edit":"Tahrirlash rejimi","hotkeys.tools.cutter":"Qirqish vositasi","hotkeys.tools.selection":"Tanlash vositasi","hotkeys.tools.reroute":"Yo'naltirish vositasi","hotkeys.tools.zoom":"Kattalashtirish vositasi","hotkeys.tools.toggleLineStyle":"Chiziq uslubini o'zgartirish","hotkeys.tools.group":"Guruh tanlash","hotkeys.tools.closeNode":"Tanlanganni o'chirish","hotkeys.tools.duplicate":"Tugunni nusxalash","hotkeys.tools.duplicateWithContent":"Tarkib bilan nusxalash","hotkeys.tools.deleteGroup":"Guruhni o'chirish (Shift+Click)","hotkeys.windows.title":"Oynalar","hotkeys.windows.search":"Tezkor qidiruv","hotkeys.windows.catalog":"Katalog","hotkeys.createNode.title":"Tugun yaratish","help.panelTitle":"Yordam va Tugmalar","help.title":"Klaviatura tugmalari","help.howToUse.title":"Qanday ishlatiladi","help.howToUse.content":"Prompt Modifier-ga xush kelibsiz! Tugunlarni qo'shish uchun asboblar paneli yoki tugmalar birikmasidan foydalaning. Ma'lumot uzatish uchun tugunlarni ulang. Tugunlarni ko'chirish va xolstni surish uchun Tahrirlash vositasidan foydalaning. Tezkor qo'shish menyusini ochish uchun bo'sh joyga ikki marta bosing. O'ng tugma kontekst menyusi uchun.","help.author":"Muallif","contextMenu.undoPosition":"Joylashuvni bekor qilish","contextMenu.redoPosition":"Joylashuvni qaytarish","contextMenu.align.left":"Chapga tekislash (F)","contextMenu.align.centerX":"Markazga (X) tekislash (E)","contextMenu.align.right":"O'ngga tekislash (R)","contextMenu.align.top":"Yuqoriga tekislash (T)","contextMenu.align.centerY":"Markazga (Y) tekislash (D)","contextMenu.align.bottom":"Pastga tekislash (B)","contextMenu.distribute.horizontal":"Gorizontal taqsimlash (Ctrl+D)","contextMenu.distribute.vertical":"Vertikal taqsimlash (Ctrl+E)","contextMenu.emptySlot":"Bo'sh slot (Tayinlash uchun o'ng tugma)","contextMenu.saveSlots":"Slotlar konfiguratsiyasini saqlash","contextMenu.loadSlots":"Slotlar konfiguratsiyasini yuklash","quickadd.title":"Tezkor Qo'shish","quickadd.group.tools":"Vositalar","quickadd.group.inputs":"Kiritish","quickadd.group.processing":"Qayta ishlash","quickadd.group.character":"Personaj","quickadd.group.outputs":"Chiqarish","quickadd.group.ai":"AI Vositalari","quickadd.group.video":"Video","quickadd.group.scripts":"Ssenariylar","quickadd.group.general":"Umumiy","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"Tahrirlash","quickadd.tool.cutter":"Qirqish","quickadd.tool.selection":"Tanlash","search.placeholder":"Qo'shish uchun tugunni qidiring...","search.noResults":"Tugunlar topilmadi.","search.group.input":"Kiritish va Asosiy","search.group.process":"Qayta ishlash va Personaj","search.group.output":"Rasm va Ketma-ketlik","search.group.ai":"AI Vositalari","search.group.video":"Video va Skriptlash","search.group.scripts":"Ssenariylar","toolbar.exitApp":"Loyihani yopish"},Uw={"node.title.text_input":"Matn Kiritish","node.title.image_input":"Rasm Kiritish","node.title.prompt_processor":"Prompt Protsessori","node.title.prompt_sanitizer":"Prompt Tozalagich","node.title.video_prompt_processor":"Video Prompt Protsessori","node.title.image_output":"Rasm Natijasi","node.title.video_output":"Video Natijasi","node.title.prompt_analyzer":"Prompt Analizatori","node.title.character_analyzer":"Personaj Analizatori","node.title.character_generator":"Personaj Generatori","node.title.character_card":"Personaj Kartasi","node.title.image_analyzer":"Rasm Analizatori","node.title.image_editor":"AI Rasm Muharriri","node.title.image_sequence_generator":"Rasm Ketma-ketligi Generatori","node.title.prompt_sequence_editor":"Prompt Ketma-ketligi Muharriri","node.title.gemini_chat":"Gemini Chat","node.title.translator":"Tarjimon","node.title.script_generator":"Ssenariy Generatori","node.title.script_viewer":"Ssenariy Ko'ruvchisi","node.title.note":"Eslatma","node.title.reroute_dot":"Yo'naltirish Nuqtasi","node.title.data_reader":"Ma'lumot O'quvchi","node.title.video_editor":"Video Muharriri Alfa Versiyasi","node.title.media_viewer":"Media Ko'ruvchi","node.title.data_protection":"Ma'lumotlarni Himoyalash","node.title.pose_creator":"Pose Creator","node.help.text_input":"Promptlar yoki eslatmalar kiritish uchun oddiy ko'p qatorli matn maydoni.","node.help.image_input":"Boshqa tugunlarda ishlatish uchun rasm yuklash yoki joylash imkonini beradi.","node.help.prompt_processor":"AI yordamida bir nechta matnli kiritmalarni bitta yaxshilangan promptga birlashtiradi.","node.help.prompt_sanitizer":"San'at maqsadini saqlagan holda rasm yaratish siyosati uchun xavfsizroq bo'lishi uchun kirish promptini qayta yozadi.","node.help.video_prompt_processor":"Video yaratish uchun batafsil promptlar yaratishga ixtisoslashgan protsessor.","node.help.image_output":"Rasm yaratish natijasini ko'rsatadi. Yuklab olish va ko'rishni qo'llab-quvvatlaydi.","node.help.video_output":"Veo modeli yordamida video yaratish natijasini ko'rsatadi.","node.help.prompt_analyzer":"Promptni mavzu, uslub va muhit kabi tarkibiy qismlarga ajratadi.","node.help.character_analyzer":"Personaj tavsifini tahlil qiladi va uni tashqi ko'rinish va kiyimga ajratadi.","node.help.character_generator":"Qisqa prompt asosida batafsil personaj tavsiflarini yaratadi.","node.help.character_card":"Rasm va tavsifni o'z ichiga olgan to'liq personaj ma'lumotlarini saqlaydi.","node.help.image_analyzer":"Kiritilgan rasmning mazmunini tasvirlash uchun AIdan foydalanadi.","node.help.image_editor":"Matn promptlari va inpainting/outpainting yordamida rasmlarni tahrirlash uchun ilg'or vosita.","node.help.image_sequence_generator":"Promptlar ro'yxati asosida rasmlar ketma-ketligini yaratadi.","node.help.prompt_sequence_editor":"AI ko'rsatmalari yordamida promptlar ketma-ketligini ommaviy tahrirlash imkonini beradi.","node.help.gemini_chat":"Fikr almashish yoki yordam olish uchun Gemini bilan umumiy maqsadli suhbat interfeysi.","node.help.translator":"AI modellari yordamida matnni tillar o'rtasida tarjima qiladi.","node.help.script_generator":"Hikoya g'oyasidan tuzilgan ssenariy (sahnalar, personajlar) yaratadi.","node.help.script_viewer":"Kadrlar bo'yicha generatsiya qilish uchun ssenariy ma'lumotlarini vizualizatsiya qiladi va boshqaradi.","node.help.note":"Xolstga izohlar yoki ko'rsatmalar qo'shish uchun yopishqoq eslatma.","node.help.reroute_dot":"Ulanishlarni tashkil qilish va toza chizmalar yaratish uchun kichik nuqta.","node.help.data_reader":"Ulanishlar orqali oqayotgan xom ma'lumotlarni tekshirish uchun disk raskadrovka vositasi.","node.help.video_editor":"Video kliplar va rasmlarni tahrirlash uchun vaqt shkalasi asosidagi vosita.","node.help.media_viewer":"Video va audio fayllarni ijro etish boshqaruvlari bilan ko'rish uchun pleyer.","node.help.data_protection":"Ma'lumotlar oqimini buzilishdan himoya qiluvchi mini-o'yin tuguni.","node.help.pose_creator":"Vizual rig yordamida personaj pozalarini yaratish va generatsiya uchun yo'riqnoma sifatida foydalanish.","node.action.expand":"Kengaytirish","node.action.collapse":"Yig'ish","node.action.help":"Yordam","node.action.download":"Yuklab olish","node.action.clear":"Tarkibni tozalash","node.action.refreshChat":"Chatni tozalash va qayta boshlash","node.action.paste":"Joylash","node.action.resetEditor":"Muharrirni tiklash","node.action.saveCharacter":"Diskka saqlash","node.action.loadCharacter":"Diskdan yuklash","node.action.copy":"Nusxalash","node.action.copyImage":"Rasmni nusxalash","node.action.copyTextPrompt":"Promptni nusxalash","node.action.copyImagePrompt":"Rasm promptini nusxalash","node.action.copyVideoPrompt":"Video promptini nusxalash","node.action.cutConnections":"Ulanishlarni uzish","node.action.close":"Yopish","node.action.closeNode":"Tugunni yopish (Shift+Click)","node.action.closeNodeSimple":"Tugunni yopish","node.action.randomWord":"Tasodifiy so'z qo'shish","node.action.processImage":"Belgilarni olib tashlash","node.action.processImageTitle":"Rasm va matn belgilarini olib tashlash uchun Gemini-dan foydalanadi.","node.action.editor":"Muharrir","node.action.rasterEditor":"Raster Muharriri","node.action.openInAIEditor":"AI Muharririda ochish","node.action.openInAnalyzer":"Analizatorda ochish","node.action.outputToInput":"Chiqishni kirish sifatida ishlatish","node.action.processChainForward":"Oldinga qayta ishlash","node.action.executeChain":"Zanjirni bajarish","node.action.executeChainTitle":"Yakuniy natijani yaratish uchun barcha yuqori oqim tugunlarini bajaring.","node.action.sanitize":"Tozalash","node.action.rename":"Nomini o'zgartirish","node.action.stop":"To'xtatish","node.action.stopping":"To'xtatilmoqda...","node.action.deleteItem":"Elementni o'chirish","node.action.detachAndPaste":"Ajratish va joylash","node.action.delete":"O'chirish","node.action.flipImage":"Rasmni aylantirish","node.action.pin":"Tugunni yuqoriga mahkamlash","node.action.unpin":"Tugunni bo'shatish","node.action.updateDescription":"Tavsifni yangilash","node.action.modifyCharacter":"O'zgarishlarni so'rash","node.action.updateDataFormat":"Ma'lumot formatini yangilash","node.action.expand169":"16:9 ga kengaytirish","node.action.expand916":"9:16 ga kengaytirish","node.action.sync":"Ulanishlardan sinxronlash","node.action.expandRatio":"Nisbatni kengaytirish","node.action.markPrimary":"Asosiy qilib belgilash","node.action.addCard":"Karta qo'shish","node.action.removeCard":"Kartani o'chirish","node.action.showOutputs":"Chiqishlarni ko'rsatish","node.action.hideOutputs":"Chiqishlarni yashirish","node.mediaViewer.play":"Ijro etish","node.mediaViewer.pause":"Pauza","node.mediaViewer.stop":"To'xtatish","node.mediaViewer.addMarker":"Marker qo'shish","node.mediaViewer.exportSRT":"Markerlarni eksport qilish (SRT)","node.mediaViewer.deleteAllMarkers":"Barcha markerlarni o'chirish","node.mediaViewer.saveMarkers":"Markerlarni saqlash","node.mediaViewer.loadMarkers":"Markerlarni yuklash","node.mediaViewer.relink":"Faylni qayta ulash","node.content.notePlaceholder":"Matningizni shu yerga kiriting...","node.content.dropImage":"Rasmni shu yerga tashlang yoki yuklash uchun bosing","node.content.dropMedia":"Video yoki audioni shu yerga tashlang","node.content.processing":"Qayta ishlanmoqda...","node.content.processingChain":"Zanjir qayta ishlanmoqda...","node.content.metadataPrompt":"Rasm metama'lumotlaridan prompt:","node.content.metadataPromptPlaceholder":"Rasmda prompt topilmadi.","node.content.copyPrompt":"Ishlatish","node.content.prompt":"Prompt","node.content.inputPrompt":"Kirish Prompti","node.content.enhancedResult":"Yaxshilangan Natija","node.content.videoPrompt":"Video Prompt","node.content.editPromptPlaceholder":"Promptga qo'shing yoki tahrirlang...","node.content.enhancedPromptHere":"Yaxshilangan prompt shu yerda paydo bo'ladi...","node.content.safePrompt":"Tijorat uchun xavfsiz","node.content.generating":"Yaratilmoqda...","node.content.imageHere":"Rasm shu yerda paydo bo'ladi","node.content.generationMode":"Yaratish Modeli","node.content.aspectRatio":"Tomonlar nisbati","node.content.aspectRatioHelp":"Rasm yaratish uchun tomonlar nisbatini o'rnating","node.content.aspectRatioNotSupportedFast":"Tomonlar nisbati faqat Imagen modellari uchun mavjud.","node.content.enableAspectRatioFormatting":"Nisbatni formatlashni yoqish","node.content.autoDownload":"Avto Yuklash","node.content.generateImage":"Rasm Yaratish","node.content.enhancing":"Yaxshilanmoqda...","node.content.enhancePrompt":"Promptni Yaxshilash","node.content.sanitizing":"Tozalanmoqda...","node.content.sanitizedPromptHere":"Tozalangan prompt shu yerda paydo bo'ladi...","node.content.analyzing":"Tahlil qilinmoqda...","node.content.analyzePrompt":"Promptni Tahlil Qilish","node.content.analyzeImage":"Rasmni Tahlil Qilish","node.content.imageToText":"Rasmdan Matnga","node.content.updatePromptFromImage":"Rasmdan promptni yangilash","node.content.analyzeCharacter":"Personajni Tahlil Qilish","node.content.generateCharacters":"Personajlarni Yaratish","node.content.characterPromptPlaceholder":"Yaratish uchun personaj(lar)ni tasvirlang...","node.content.character":"Personaj","node.content.clothing":"Kiyim","node.content.characterPlaceholder":"Personaj tavsifi shu yerda paydo bo'ladi...","node.content.clothingPlaceholder":"Kiyim tavsifi shu yerda paydo bo'ladi...","node.content.appearance":"Tashqi ko'rinish","node.content.personality":"Shaxsiyat","node.content.environment":"Muhit/Sozlama","node.content.action":"Harakat","node.content.emotion":"Hissiyot","node.content.style":"Uslub","node.content.environmentPlaceholder":"Muhitning batafsil tavsifi...","node.content.charactersPlaceholder":"Asosiy personajlar ro'yxati...","node.content.characters":"Personajlar","node.content.characterConcepts":"Personaj Konseptlari","node.content.actionPlaceholder":"Harakat tavsifi...","node.content.emotionPlaceholder":"Hissiyot tavsifi...","node.content.stylePlaceholder":"San'at uslubi tavsifi...","node.content.descriptionHere":"Tavsif shu yerda paydo bo'ladi...","node.content.enableOutpainting":"Outpainting-ni yoqish","node.content.outpaintingPromptPlaceholder":"Outpainting prompti...","node.content.inputImage":"Kirish Rasmlari","node.content.dropOrClick":"Tashlang yoki Bosing","node.content.outputImage":"Chiqish Rasmi","node.content.applyEdit":"Tahrirni Qo'llash","node.content.editing":"Tahrirlanmoqda...","node.content.chatPlaceholder":"Xabaringizni kiriting...","node.content.connectedPlaceholder":"Tugunga ulangan, manbada tahrirlang.","node.content.connectedNode":"Tugun orqali ulangan","node.content.connectedEmpty":"Ulangan tugunda rasm yo'q.","node.content.translatePlaceholder":"Tarjima qilinadigan matn...","node.content.translatedTextPlaceholder":"Tarjima qilingan matn...","node.content.targetLanguage":"Maqsadli Til","node.content.translate":"Tarjima qilish","node.content.translating":"Tarjima qilinmoqda...","node.content.scriptPromptPlaceholder":"Hikoya g'oyasi yoki syujetini kiriting...","node.content.generateScript":"Ssenariy Yaratish","node.content.loadScript":"Ssenariy faylini yuklash","node.content.summary":"Xulosa","node.content.scenes":"Sahnalar","node.content.unrecognizedFormat":"Tanilmagan ssenariy formati.","node.content.frames":"Kadrlar","node.content.characterIndex":"Indeks","node.content.readData":"Ma'lumotni O'qish","node.content.textDataHere":"Matn ma'lumotlari shu yerda paydo bo'ladi.","node.content.noDataRead":`Tarkibni ko'rish uchun tugunni ulang va "Ma'lumotni O'qish" ni bosing.`,"node.content.previewError":"Ko'rib chiqish xatosi","node.content.previewPlaceholder":"Ko'rib chiqish shu yerda paydo bo'ladi","node.content.imagePrompt":"Rasm Prompti","node.output.allPromptData":"Barcha Prompt Ma'lumotlari","node.note.tab.note":"Eslatma","node.note.tab.references":"Manbalar","node.note.nestedImages":"Ichki Rasmlar","node.note.dropPlaceholder":"Rasmlarni tashlang yoki qo'shish uchun bosing","node.note.addCaption":"Sarlavha","node.note.action.shuffle":"Aralashtirish","node.note.action.undoShuffle":"Aralashtirishni bekor qilish","node.content.characterTypeShort":"Tur:","node.content.numberOfCharactersShort":"Son:","node.content.characterType.simple":"Oddiy","node.content.characterType.anthro":"Anthro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Kalit element","node.content.style.simple":"Oddiy","node.content.style.realistic":"Haqiqiy","node.content.style.3d_cartoon":"3D Multfilm","node.content.style.3d_realistic":"3D Haqiqiy","node.content.style.2d_animation":"2D Animatsiya","node.content.style.anime":"Anime","node.content.style.comics":"Komiks","node.content.style.custom":"Maxsus","node.content.fullDescriptionTitle":"To'liq personaj tavsifi","node.content.integrationInstruction":"Integratsiya bo'yicha ko'rsatma","node.content.additionalPromptSuffix":"Qo'shimcha Prompt (Suffiks)","search.node.text_input.title":"Matn Kiritish","search.node.text_input.description":"Oddiy ko'p qatorli matn maydoni.","search.node.image_input.title":"Rasm Kiritish","search.node.image_input.description":"Rasm yuklash yoki joylash.","search.node.prompt_sequence_editor.title":"Prompt Ketma-ketligi Muharriri","search.node.prompt_sequence_editor.description":"Promptlar ro'yxatini bitta ko'rsatma yordamida tahrirlash, ommaviy o'zgartirish imkonini beradi.","search.node.data_reader.title":"Ma'lumot O'quvchi","search.node.data_reader.description":"Ulanish orqali kelayotgan xom ma'lumotlarni (matn yoki rasm) o'qiydi va ko'rsatadi.","search.node.note.title":"Eslatma","search.node.note.description":"Izohlar uchun stiker.","search.node.prompt_processor.title":"Prompt Protsessori","search.node.prompt_processor.description":"Kirishlarni yaxshilangan promptga birlashtiradi.","search.node.prompt_analyzer.title":"Prompt Analizatori","search.node.prompt_analyzer.description":"Promptni tarkibiy qismlarga ajratadi.","search.node.prompt_sanitizer.title":"Prompt Tozalagich","search.node.prompt_sanitizer.description":"Promptni AI modellari uchun xavfsizroq qilish uchun qayta yozadi.","search.node.character_card.title":"Personaj Kartasi","search.node.character_card.description":"Personaj haqida batafsil ma'lumotni saqlaydi.","search.node.character_analyzer.title":"Personaj Analizatori","search.node.character_analyzer.description":"Tavsifni tashqi ko'rinish va kiyimga ajratadi.","search.node.character_generator.title":"Personaj Generatori","search.node.character_generator.description":"Prompt asosida bitta yoki bir nechta batafsil personaj tavsiflarini yaratadi.","search.node.image_analyzer.title":"Rasm Analizatori","search.node.image_analyzer.description":"Rasmni AI yordamida tasvirlaydi.","search.node.image_editor.title":"AI Rasm Muharriri","search.node.image_editor.description":"Rasmlarni prompt yordamida tahrirlaydi yoki birlashtiradi.","search.node.image_sequence_generator.title":"Rasm Ketma-ketligi Generatori","search.node.image_sequence_generator.description":"Promptlar ro'yxati asosida rasmlar ketma-ketligini yaratadi.","search.node.gemini_chat.title":"Gemini Chat","search.node.gemini_chat.description":"Fikr almashish uchun Gemini bilan suhbat interfeysi.","search.node.translator.title":"Tarjimon","search.node.translator.description":"AI yordamida matnni tillar o'rtasida tarjima qiladi.","search.node.script_generator.title":"Ssenariy Generatori","search.node.script_generator.description":"Hikoyadan tuzilgan ssenariy yaratadi.","search.node.script_viewer.title":"Ssenariy Ko'ruvchisi","search.node.script_viewer.description":"Ssenariy ma'lumotlarini vizualizatsiya qiladi va boshqaradi.","search.node.note":"Eslatmalar uchun oddiy matn maydoni.","search.node.reroute_dot":"Ulanishlarni tashkil qilish uchun nuqta.","search.node.video_prompt_processor.title":"Video Prompt Protsessori","search.node.video_prompt_processor.description":"Video yaratish uchun batafsil promptlar yaratadi.","search.node.video_output.title":"Video Natijasi","search.node.video_output.description":"Veo modeli yordamida video yaratadi.","search.node.image_output.title":"Rasm Natijasi","search.node.image_output.description":"Yaratilgan rasmlarni ko'rsatadi va yuklab olish imkonini beradi.","search.node.media_viewer.title":"Media Ko'ruvchi","search.node.media_viewer.description":"Video va audio fayllarni ko'rish uchun pleyer.","search.node.data_protection.title":"Ma'lumotlarni Himoyalash","search.node.data_protection.description":"Ma'lumotlar oqimini himoya qilish uchun mini-o'yin.","search.node.pose_creator.title":"Pose Creator","search.node.pose_creator.description":"Vizual rig yordamida personaj pozalarini yarating.","prompt_sequence_editor.instructionPlaceholder":"Promptlarni o'zgartirish uchun ko'rsatma kiriting...","prompt_sequence_editor.modifying":"O'zgartirilmoqda...","prompt_sequence_editor.modifySelected":"Tanlanganlarni O'zgartirish ({count})","prompt_sequence_editor.sourcePrompts":"Manba Promptlar","prompt_sequence_editor.finalPrompts":"O'zgartirilgan Promptlar","prompt_sequence_editor.error.invalidInput":"Ma'lumot formati noto'g'ri. Iltimos, prompt ketma-ketligi massivini ulang.","geminiChat.mode.general":"Umumiy","geminiChat.mode.prompt":"Prompt Mutaxassisi","geminiChat.mode.script":"Ssenarist","geminiChat.mode.youtube":"YouTube Analitik","image_sequence.deselect_scene":"Ushbu sahnadagi barcha kadrlarni tanlashni bekor qilish","image_sequence.clear_prompts_only":"Faqat Matn Promptlarini Tozalash","image_sequence.prev_scene":"Oldingi Sahna","image_sequence.next_scene":"Keyingi Sahna","image_sequence.frames_hidden":"({count} kadrlar yashirilgan)","image_sequence.frames_count":"({count} kadrlar)","node.content.modificationRequest":"O'zgartirish So'rovi","node.content.technicalPrompt":"Texnik Prompt","node.promptProcessor.safePromptTooltip":"Xavfsizlik qoidalariga rioya qilish va siyosat buzilishining oldini olish uchun promptni qayta yozadi.","node.promptProcessor.technicalPromptTooltip":"Promptni juda batafsil texnik spetsifikatsiyaga aylantiradi (yorug'lik, kamera, render sozlamalari).","node.promptProcessor.enhanceTooltip":"Promptni tavsiflovchi tafsilotlar bilan kengaytirish va boyitish uchun AIdan foydalanadi.","node.promptProcessor.chainTooltip":"Ushbu tugunni bajaradi va barcha ulangan quyi oqim tugunlarini ishga tushiradi.","image_sequence.tooltip.autoCrop":"Yaratilgan rasmlarni avtomatik ravishda 16:9 nisbatiga qirqadi.","image_sequence.tooltip.autoDownload":"Yaratilgandan so'ng har bir rasmni avtomatik ravishda qurilmangizga saqlaydi.","image_sequence.tooltip.createZip":"Yuklab olish uchun barcha tanlangan rasmlarni bitta ZIP arxiviga joylaydi."},Vw={"imageEditor.title":"Rasm Muharriri","imageEditor.canvasResolution":"Xolst O'lchami","imageEditor.background":"Orqa Fon","imageEditor.toolSettings":"Asbob Sozlamalari","imageEditor.snapToEdges":"Chegaralarga yopishtirish","imageEditor.freeAspect":"Erkin Nisbat","imageEditor.section.aiRequest":"AI O'zgartirish So'rovi","imageEditor.input.modificationPlaceholder":`O'zgarishlarni tavsiflang, masalan "orqa fonni ko'k rangga o'zgartir"`,"imageEditor.action.sendRequest":"So'rov yuborish","imageEditor.tooltip.removeObject":"O'chirish (Qizil) / Saqlash (Yashil)","imageEditor.action.removeObject":"Obyektni o'chirish","imageEditor.tool.transform":"Transfarmatsiya","imageEditor.tool.hand":"Qo'l (Siljitish)","imageEditor.tool.zoom":"Kattalashtirish","imageEditor.tool.pencil":"Qalam","imageEditor.tool.rectangle":"To'rtburchak","imageEditor.action.fit":"Xolstga moslashtirish","imageEditor.action.fill":"Xolstni to'ldirish","imageEditor.action.cancel":"Bekor qilish","imageEditor.action.resetEdits":"Tahrirlarni tiklash","imageEditor.action.apply":"Qo'llash","imageViewer.title":"Rasm Ko'ruvchi","imageEditor.outputResolution":"Chiqish O'lchami","imageEditor.outputResolutionHelp":`Chiqish o'lchamini o'rnating. Agar "Auto" bo'lsa, xolst o'lchamidan foydalanadi.`,"imageEditor.currentSize":"Joriy O'lcham: {width}x{height}","imageEditor.sequenceMode":"Ketma-ketlik Rejimi","imageEditor.sequenceModeHelp":"Input A dagi kirish rasmlarini ketma-ket qayta ishlash.","imageEditor.sequentialCombination":"Rasmlarni Ketma-ket Birlashtirish","imageEditor.sequentialCombinationHelp":"Har bir kadr uchun: Joriy Input A rasmi + Barcha Input B rasmlarini yuboradi.","imageEditor.sequentialPrompt":"Promptlarni Ketma-ket Birlashtirish","imageEditor.sequentialPromptHelp":"Har bir kadr uchun: Ro'yxatdagi noyob prompt + joriy rasmni ishlatadi.","imageEditor.sequentialEditingWithPrompts":"Promptlar bilan Ketma-ket Tahrirlash","imageEditor.sequentialEditingWithPromptsHelp":"Har bir kadr uchun: Input B rasmi + noyob prompt ishlatiladi. Input A e'tiborga olinmaydi.","imageEditor.input":"Kirish","imageEditor.inputA":"Kirish A","imageEditor.inputB":"Kirish B","imageEditor.status.queued":"Navbatda","imageEditor.status.generating":"Yaratilmoqda...","imageEditor.action.regenerate":"Qayta yaratish","imageEditor.tooltip.fit":"Rasmni xolst chegaralariga moslashtirish (sig'dirish).","imageEditor.tooltip.fill":"Rasmni xolstni to'ldirish uchun masshtablash (qoplash).","imageEditor.tooltip.flip":"Rasmni gorizontal aylantirish.","imageEditor.background.white":"Oq","imageEditor.background.gray":"Kulrang","imageEditor.background.black":"Qora","imageEditor.background.dark":"To'q","image_sequence.regenerate":"Qayta yaratish","image_sequence.stop_queue":"Navbatni to'xtatish","image_sequence.move_up":"Yuqoriga","image_sequence.move_down":"Pastga","image_sequence.copy_prompt":"Promptni nusxalash","image_sequence.add_frame":"Kadr qo'shish","image_sequence.delete_frame":"Kadrni o'chirish","image_sequence.expand_all_frames":"Barcha Kadrlarni Yoyish/Yig'ish","image_sequence.collapse_all_frames":"Barcha Kadrlarni Yig'ish","image_sequence.expand_all_scenes":"Barcha Sahnalarni Yoyish/Yig'ish","image_sequence.collapse_all_scenes":"Barcha Sahnalarni Yig'ish","image_sequence.expand_all":"Hammasini Yoyish","image_sequence.collapse_all":"Hammasini Yig'ish","image_sequence.clear_all_prompts":"Barcha Promptlarni Tozalash","image_sequence.add_first_frame":"Birinchi Kadrni Qo'shish","image_sequence.drop_or_add_title":"Ketma-ketlik JSON tashlang yoki Kadr qo'shing","image_sequence.drop_or_add_desc":"JSON faylni shu yerga tashlang yoki kadrni qo'lda qo'shish uchun tugmani bosing.","image_sequence.load_prompts":"Promptlarni Yuklash","image_sequence.output_images_title":"Chiqish Rasmlari","image_sequence.prompts_list_title":"Manba Promptlar","image_sequence.download_selected":"Tanlanganlarni Yuklash","image_sequence.select_all":"Hammasini Tanlash","image_sequence.select_none":"Tanlovni Bekor Qilish","image_sequence.invert_selection":"Tanlovni Teskari Qilish","image_sequence.run_selected":"Tanlanganlarni Ishga Tushirish","image_sequence.start_queue":"Navbatni Boshlash","image_sequence.character_prompt_combination":"Personaj Prompt Kombinatsiyasi","image_sequence.combination_none":"Yo'q","image_sequence.combination_combine":"Birlashtirish","image_sequence.combination_replace":"Teglarni almashtirish","image_sequence.status.error":"Xato","image_sequence.status.pending":"Navbatda","image_sequence.clear_selected_prompts":"Tanlangan Promptlarni Tozalash","image_sequence.range_from":"Dan:","image_sequence.range_to":"Gacha:","image_sequence.stats.total":"Jami Kadrlar: {count}","image_sequence.stats.generated":"Yaratildi: {count}","image_sequence.stats.queue":"Navbat: {count}","image_sequence.edit_in_source":"Manbada Tahrirlash","image_sequence.edit_prompt":"Promptni Tahrirlash","image_sequence.select_scene":"Sahnani Tanlash","image_sequence.next_scene":"Keyingi Sahna","image_sequence.prev_scene":"Oldingi Sahna","image_sequence.scene_input_label":"Sahna","image_sequence.select_square":"Kvadrat Rasmlarni Tanlash (1:1)","image_sequence.select_landscape":"Landshaft Rasmlarni Tanlash (16:9)","image_sequence.select_portrait":"Portret Rasmlarni Tanlash (9:16)","image_sequence.select_range":"Oraliqni Tanlash","image_sequence.force_refresh":"Majburiy Yangilash","image_sequence.select_scene_frames":"Ushbu sahnadagi barcha kadrlarni tanlash","image_sequence.collapse_other_scenes":"Boshqa sahnalarni yig'ish","prompt_sequence_editor.instructionPlaceholder":"Promptlarni o'zgartirish uchun ko'rsatma kiriting...","prompt_sequence_editor.modifying":"O'zgartirilmoqda...","prompt_sequence_editor.modifySelected":"Tanlanganlarni O'zgartirish ({count})","prompt_sequence_editor.sourcePrompts":"Manba Promptlar","prompt_sequence_editor.finalPrompts":"O'zgartirilgan Promptlar","prompt_sequence_editor.error.invalidInput":"Ma'lumot formati noto'g'ri. Iltimos, prompt ketma-ketligi massivini ulang.","geminiChat.mode.general":"Umumiy","geminiChat.mode.prompt":"Prompt Mutaxassisi","geminiChat.mode.script":"Ssenarist","geminiChat.mode.youtube":"YouTube Analitik","image_sequence.shot_type.WS":"Ob'ektni Keng Plan (WS) bilan sahnaga va harakatga birlashtiring. Atrof-muhitni ko'rsating.","image_sequence.shot_type.MS":"Ob'ektni O'rta Plan (MS) bilan sahnaga birlashtiring. Personaj belidan yuqori.","image_sequence.shot_type.CU":"Ob'ektni Yirik Plan (CU) bilan sahnaga birlashtiring.","image_sequence.shot_type.ECU":"Ob'ektni Juda Yirik Plan (ECU) bilan sahnaga birlashtiring. Maksimal tafsilot.","image_sequence.shot_type.LS":"Ob'ektni Uzoq Plan (LS) bilan sahnaga birlashtirib, ko'lamni ko'rsating."},Ww={"dialog.permission.title":"Ruxsat Talab Qilinadi","dialog.permission.description":"Ushbu ilova tugunlarga kontent joylash uchun buferingizni o'qishga ruxsat so'raydi. Ma'lumotlaringiz saqlanmaydi va hech qayerga yuborilmaydi.","dialog.permission.allow":"Ruxsat berish","dialog.permission.decline":"Rad etish","dialog.rename.title":"Element nomini o'zgartirish","dialog.rename.group.title":"Guruh nomini o'zgartirish","dialog.rename.catalog.title":"Katalog elementini qayta nomlash","dialog.rename.node.title":"Tugun nomini o'zgartirish","dialog.rename.label":"Yangi nom:","dialog.rename.confirm":"O'zgartirish","dialog.rename.cancel":"Bekor qilish","dialog.promptEdit.title":"Promptni Tahrirlash","dialog.promptEdit.nameLabel":"Nom:","dialog.promptEdit.contentLabel":"Tarkib:","dialog.promptEdit.confirm":"Saqlash","dialog.promptEdit.cancel":"Bekor qilish","dialog.confirmDelete.title":"O'chirishni Tasdiqlash","dialog.confirmDelete.message":"Haqiqatan ham ushbu elementni o'chirmoqchimisiz? Bu amalni bekor qilib bo'lmaydi.","dialog.confirmDelete.confirm":"O'chirish","dialog.confirmDelete.cancel":"Bekor qilish","dialog.confirmCloseTab.title":"Tabni Yopish","dialog.confirmCloseTab.message":`"{tabName}" tabini yopishni xohlaysizmi? Saqlanmagan o'zgarishlar yo'qoladi.`,"dialog.confirmClear.title":"Xolstni Tozalash","dialog.confirmClear.message":"Haqiqatan ham butun xolstni tozalamoqchimisiz? Bu amalni bekor qilib bo'lmaydi.","dialog.confirmReset.title":"Asl holatga qaytarish","dialog.confirmReset.message":"Xolstni asl holatiga qaytarishni xohlaysizmi? Barcha joriy ishlar yo'qoladi.","dialog.confirmReset.confirm":"Qaytarish","dialog.confirmLoad.title":"Yuklashni Tasdiqlash","dialog.confirmLoad.message":"Yangi faylni yuklash joriy tarkibni almashtiradi. Saqlanmagan o'zgarishlar yo'qoladi. Davom etasizmi?","dialog.apiKey.title":"API Kalitini Tanlash","dialog.apiKey.description":'Bu xususiyat "AI Platform" API yoqilgan Loyiha API kalitini talab qiladi. Video yaratish bir necha daqiqa vaqt olishi mumkin.',"dialog.apiKey.billingLink":"To'lovlar haqida ko'proq ma'lumot","dialog.apiKey.button":"API Kalitini Tanlash","dialog.settings.title":"Sozlamalar","dialog.settings.apiKeyLabel":"Sizning Google Gemini API Kalitingiz:","dialog.settings.useDevKeyLabel":"Bepul API kalitidan foydalanish (ishlab chiqish uchun)","dialog.settings.instantNodeCloseLabel":"Tugunni tezkor yopish","dialog.settings.nodeAnimationLabel":"Tugun Qo'shish Animatsiyasi","dialog.settings.animationModeLabel":"Yaratish Animatsiya Rejimi","dialog.settings.anim.pulse":"Puls","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"Yo'q","dialog.settings.description":"O'z kvotalaringizdan foydalanish va maxsus modellarga kirish uchun shaxsiy API kalitingizni kiriting. Kalit brauzeringizda lokal saqlanadi.","dialog.settings.getKeyLink":"API Kalitini bu yerdan oling","dialog.settings.save":"Saqlash","dialog.deleteNode.title":"Tugunni yopish?","dialog.deleteNode.titlePlural":"Tugunlarni yopish?","dialog.deleteNode.confirm":"Ha","dialog.deleteNode.cancel":"Yo'q","dialog.deleteNode.confirmTooltip":"Tugunni yopish - yo'qolgan ma'lumotlarni qaytarib bo'lmaydi","dialog.deleteNode.cancelTooltip":"Yopmaslik - tugun bilan ishlashni davom ettirish","dialog.deleteNode.dontShowAgain":"Qayta ko'rsatilmasin","dialog.exitApp.title":"Loyihani yopishni xohlaysizmi?","dialog.exitApp.message":"Loyihani yopishni xohlaysizmi? Barcha joriy ishlar yo'qoladi va xolst asl holatiga qaytariladi."},$w={"group.button.create":"Guruh Yaratish ({count})","group.rename":"Guruh Nomini O'zgartirish","group.saveToCatalog":"Katalogga Saqlash","group.saveToDisk":"Diskka Saqlash","group.ungroup":"Guruhdan Chiqarish (Tarkib bilan o'chirish uchun Shift+Click)","group.duplicate":"Guruhni tarkib bilan nusxalash","catalog.tabs.groups":"Guruhlar","catalog.tabs.library":"Kutubxona","catalog.tabs.characters":"Personajlar","catalog.tabs.scripts":"Ssenariylar","catalog.tabs.sequences":"Ketma-ketliklar","catalog.back":"Orqaga","catalog.load":"Fayldan Yuklash","catalog.newFolder":"Yangi Papka","catalog.saveTo":"Katalogga Saqlash","catalog.card.addToCanvas":"Xolstga Qo'shish","catalog.card.rename":"Nomini O'zgartirish","catalog.card.save":"Saqlash","catalog.card.delete":"O'chirish","catalog.empty.description":"Bu papka bo'sh. Siz elementlar qo'shishingiz yoki yangi papkalar yaratishingiz mumkin.","library.loadFromFile":"Yuklash","library.actions.newFolder":"Yangi Papka","library.actions.newPrompt":"Yangi Prompt","library.actions.copy":"Nusxalash","library.actions.edit":"Tahrirlash","library.empty.title":"Bo'sh Papka","library.empty.description":"Boshlash uchun promptlar va papkalar yarating.","library.emptyPrompt":"Bo'sh prompt"},Kw={...Gw,...Hw,...Uw,...Vw,...Ww,...$w},Jw={"app.title":"Modificateur de Prompt","app.subtitle":"Connectez des ides pour crer un chef-d'uvre","app.error.title":"Notification","app.error.copy":"Copier le message","app.error.copied":"Copi !","error.apiKey":"Votre cl API est invalide ou manque de permissions. Veuillez slectionner une cl API valide.","error.scriptModifierCanvas":"Ce canevas appartient  une autre application - Script Modifier. Veuillez utiliser Script Modifier pour ouvrir ce fichier.","welcome.title":"Bienvenue dans","welcome.description":"Bienvenue dans Prompt Modifier. Connectez des ides pour crer des chefs-d'uvre. Utilisez les nuds pour gnrer et diter du contenu.","welcome.apiKeyLabel":"Votre cl API Google Gemini","welcome.apiKeyPlaceholder":"Entrez votre cl API ici...","welcome.apiKeyHelp":"Votre cl API est stocke localement.","welcome.getKeyLink":"Obtenir une cl API","welcome.iAmDeveloper":"Je suis dveloppeur","welcome.letsGo":"C'est parti","welcome.resume":"Reprendre","welcome.startNew":"Nouveau Canevas","welcome.freeModeActive":"Mode Gratuit Actif","welcome.selectLanguage":"Slectionnez votre langue principale","welcome.navHint":"Utilisez les touches du clavier  et  pour changer de langue","toast.contentCleared":"Contenu effac","toast.downloadStarted":"Tlchargement commenc","toast.characterLoaded":"Carte de personnage charge","toast.characterSavedDisk":"Carte de personnage enregistre sur le disque","toast.copiedToClipboard":"Copi dans le presse-papiers","toast.pastedFromClipboard":"Coll depuis le presse-papiers","toast.pasteFailed":"chec du collage","toast.nodeDuplicated":"Nud dupliqu","toast.groupSavedToDisk":'Groupe "{groupTitle}" enregistr sur le disque',"toast.groupDeleted":"Groupe et contenu supprims","toast.characterSavedCatalog":"Personnage enregistr dans le catalogue","toast.promptSaved":"Prompt enregistr dans la bibliothque : {promptName}...","toast.connectionsCut":"Connexions supprimes","toast.apiKeySaved":"Cl API enregistre avec succs","toast.cacheCleared":"{count} lments inutiliss effacs du cache","toast.cacheEmpty":"Le cache est dj optimis","toast.scriptSaved":"Scnario enregistr sur le disque","alert.groupSaved":'Groupe "{groupTitle}" enregistr dans le catalogue.',"alert.loadCatalogFailed":"chec du chargement du fichier catalogue","alert.invalidCatalogFile":"Format de fichier catalogue invalide","alert.fileNotSupported":'Fichier non support. "appName" manquant ou incorrect.',"alert.invalidCatalogStructure":'Structure de catalogue invalide. "root" manquant.'},Yw={"toolbar.settings":"Paramtres","toolbar.resetCanvas":"Rinitialiser le canevas","toolbar.clearCache":"Vider le cache inutilis","toolbar.home":"Accueil","toolbar.edit":"diter (V)","toolbar.cutter":"Couper connexion (C) / (Maintenir Ctrl)","toolbar.selection":"Slection (S) / (Maintenir Shift)","toolbar.reroute":"Rediriger (R) / (Maintenir Ctrl+Alt)","toolbar.zoom":"Zoom (Maintenir Z)","toolbar.snapToGrid":"Aligner sur la grille","toolbar.smartGuides":"Guides intelligents","toolbar.lineStyleSpaghetti":"Lignes Spaghetti","toolbar.lineStyleOrthogonal":"Lignes Orthogonales","toolbar.resetZoom":"Rinitialiser le zoom","toolbar.resetCamera":"Rinitialiser la camra","toolbar.clearCanvas":"Effacer le canevas","toolbar.addNode":"Ajouter un nud (F)","toolbar.catalog":"Ouvrir le catalogue (Ctrl + Espace)","toolbar.addNote":"Ajouter une note (N)","toolbar.addDataReader":"Ajouter un lecteur de donnes (Shift + R)","toolbar.addTextInput":"Ajouter une entre texte (T)","toolbar.addImageInput":"Ajouter une entre image (I)","toolbar.addPromptSequenceEditor":"Ajouter diteur de squence (Q)","toolbar.addImageAnalyzer":"Ajouter analyseur d'image (Shift+A)","toolbar.addPromptAnalyzer":"Ajouter analyseur de prompt (A)","toolbar.addPromptProcessor":"Ajouter processeur de prompt (P)","toolbar.addCharacterGenerator":"Ajouter gnrateur de personnage (Shift+C)","toolbar.addCharacterAnalyzer":"Ajouter analyseur de personnage (Ctrl+Shift+A)","toolbar.addCharacterCard":"Ajouter carte de personnage (Ctrl+Shift+C)","toolbar.addImageOutput":"Ajouter sortie image (O)","toolbar.addImageEditor":"Ajouter diteur d'image IA (Shift+I)","toolbar.addImageSequenceGenerator":"Ajouter gnrateur de squence (Shift+Q)","toolbar.addTranslator":"Ajouter traducteur (L)","toolbar.addGeminiChat":"Ajouter Chat Gemini (M)","toolbar.addVideoPromptProcessor":"Ajouter processeur de prompt vido (Shift+P)","toolbar.addVideoOutput":"Ajouter sortie vido (Shift+O)","toolbar.addScriptGenerator":"Ajouter gnrateur de scnario","toolbar.addScriptViewer":"Ajouter visualiseur de scnario (Shift + V)","toolbar.saveCanvas":"Enregistrer le canevas (Ctrl + S)","toolbar.saveProject":"Enregistrer le projet","toolbar.loadCanvas":"Charger Projet/Canevas (Ctrl + O)","toolbar.group.general":"Gnral","toolbar.group.catalog":"Catalogue","toolbar.group.input":"Entre","toolbar.group.processing":"Traitement","toolbar.group.character":"Personnage","toolbar.group.output":"Sortie","toolbar.group.aiTools":"Outils IA","toolbar.group.video":"Vido","toolbar.group.scripts":"Scnarios","toolbar.group.file":"Fichier","toolbar.title":"Barre d'outils","toolbar.dock":"Ancrer la barre","toolbar.detach":"Dtacher la barre","toolbar.expandPanel":"Agrandir le panneau","toolbar.collapsePanel":"Rduire le panneau","toolbar.dockArea.title":"Ancrer la barre ici","toolbar.duplicate":"Dupliquer le nud","toolbar.duplicateWithContent":"Dupliquer avec contenu","toolbar.dock.q1":"1er Quart Gauche","toolbar.dock.q2":"2me Quart Gauche","toolbar.dock.q3":"3me Quart Droite","toolbar.dock.q4":"4me Quart Droite","toolbar.dock.tl":"Haut Gauche","toolbar.dock.bl":"Bas Gauche","toolbar.dock.tr":"Haut Droite","toolbar.dock.br":"Bas Droite","toolbar.dock.left":"Moiti Gauche","toolbar.dock.right":"Moiti Droite","toolbar.dock.full":"Plein cran","toolbar.dock.exitFull":"Quitter Plein cran","toolbar.dock.fullFocus":"Focus Plein cran","hotkeys.show":"Voir les raccourcis","hotkeys.tools.title":"Outils","hotkeys.tools.edit":"Mode dition","hotkeys.tools.cutter":"Outil Couteau","hotkeys.tools.selection":"Outil Slection","hotkeys.tools.reroute":"Outil Redirection","hotkeys.tools.zoom":"Outil Zoom","hotkeys.tools.toggleLineStyle":"Changer style de ligne","hotkeys.tools.group":"Slection de Groupe","hotkeys.tools.closeNode":"Supprimer la slection","hotkeys.tools.duplicate":"Dupliquer le nud","hotkeys.tools.duplicateWithContent":"Dupliquer avec contenu","hotkeys.tools.deleteGroup":"Supprimer le groupe (Shift+Clic)","hotkeys.windows.title":"Fentres","hotkeys.windows.search":"Recherche Rapide","hotkeys.windows.catalog":"Catalogue","hotkeys.createNode.title":"Crer un nud","help.panelTitle":"Aide et Raccourcis","help.title":"Raccourcis Clavier","help.howToUse.title":"Comment utiliser","help.howToUse.content":"Bienvenue dans Prompt Modifier ! Utilisez la barre d'outils ou les raccourcis pour ajouter des nuds. Connectez les nuds pour transmettre les donnes. Utilisez l'outil dition pour dplacer les nuds et le canevas. Double-cliquez sur l'espace vide pour ouvrir le menu d'ajout rapide. Clic droit pour le menu contextuel.","help.author":"Auteur","contextMenu.undoPosition":"Annuler dplacement","contextMenu.redoPosition":"Rtablir dplacement","contextMenu.align.left":"Aligner  gauche (F)","contextMenu.align.centerX":"Aligner au centre X (E)","contextMenu.align.right":"Aligner  droite (R)","contextMenu.align.top":"Aligner en haut (T)","contextMenu.align.centerY":"Aligner au centre Y (D)","contextMenu.align.bottom":"Aligner en bas (B)","contextMenu.distribute.horizontal":"Distribuer Horiz. (Ctrl+D)","contextMenu.distribute.vertical":"Distribuer Vert. (Ctrl+E)","contextMenu.emptySlot":"Emplacement vide (Clic droit pour assigner)","contextMenu.saveSlots":"Sauvegarder config slots","contextMenu.loadSlots":"Charger config slots","quickadd.title":"Ajout Rapide","quickadd.group.tools":"Outils","quickadd.group.inputs":"Entres","quickadd.group.processing":"Traitement","quickadd.group.character":"Personnage","quickadd.group.outputs":"Sorties","quickadd.group.ai":"Outils IA","quickadd.group.video":"Vido","quickadd.group.scripts":"Scnarios","quickadd.group.general":"Gnral","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"diter","quickadd.tool.cutter":"Couper","quickadd.tool.selection":"Slection","search.placeholder":"Rechercher un nud  ajouter...","search.noResults":"Aucun nud trouv.","search.group.input":"Entre & Basique","search.group.process":"Traitement & Personnage","search.group.output":"Image & Squence","search.group.ai":"Outils IA","search.group.video":"Vido & Script","search.group.scripts":"Scnarios","toolbar.exitApp":"Fermer le projet"},Xw={"node.title.text_input":"Entre de Texte","node.title.image_input":"Entre d'Image","node.title.prompt_processor":"Processeur de Prompt","node.title.prompt_sanitizer":"Nettoyeur de Prompt","node.title.video_prompt_processor":"Proc. Prompt Vido","node.title.image_output":"Sortie Image","node.title.video_output":"Sortie Vido","node.title.prompt_analyzer":"Analyseur de Prompt","node.title.character_analyzer":"Analyseur de Personnage","node.title.character_generator":"Gnrateur de Personnage","node.title.character_card":"Carte de Personnage","node.title.image_analyzer":"Analyseur d'Image","node.title.image_editor":"diteur d'Image IA","node.title.image_sequence_generator":"Gnrateur de Squence","node.title.prompt_sequence_editor":"diteur de Squence de Prompts","node.title.gemini_chat":"Chat Gemini","node.title.translator":"Traducteur","node.title.script_generator":"Gnrateur de Scnario","node.title.script_viewer":"Visualiseur de Scnario","node.title.note":"Note","node.title.reroute_dot":"Point de Redirection","node.title.data_reader":"Lecteur de Donnes","node.title.video_editor":"diteur Vido Alpha","node.title.media_viewer":"Lecteur Multimdia","node.title.data_protection":"Protection des Donnes","node.title.pose_creator":"Pose Creator","node.help.text_input":"Un champ de texte simple pour entrer des prompts ou des notes.","node.help.image_input":"Permet de tlcharger ou coller une image pour l'utiliser comme entre.","node.help.prompt_processor":"Combine plusieurs textes en un seul prompt amlior via IA.","node.help.prompt_sanitizer":"Rcrit le prompt pour le rendre plus sr pour les modles d'IA.","node.help.video_prompt_processor":"Processeur spcialis pour crer des prompts vido dtaills.","node.help.image_output":"Affiche le rsultat de la gnration d'image. Permet le tlchargement.","node.help.video_output":"Affiche le rsultat de la gnration vido via Veo.","node.help.prompt_analyzer":"Dcompose un prompt en sujet, style, environnement, etc.","node.help.character_analyzer":"Analyse une description de personnage (apparence vs vtements).","node.help.character_generator":"Gnre des descriptions dtailles bases sur un prompt court.","node.help.character_card":"Stocke les donnes compltes d'un personnage (image, description).","node.help.image_analyzer":"Utilise l'IA pour dcrire le contenu d'une image.","node.help.image_editor":"Outil avanc pour diter des images avec du texte (inpainting/outpainting).","node.help.image_sequence_generator":"Gnre une squence d'images base sur une liste de prompts.","node.help.prompt_sequence_editor":"Permet l'dition en masse de squences de prompts via instructions IA.","node.help.gemini_chat":"Interface de chat avec Gemini pour le brainstorming.","node.help.translator":"Traduit du texte entre les langues via l'IA.","node.help.script_generator":"Gnre un scnario structur (scnes, persos) depuis une ide.","node.help.script_viewer":"Visualise et gre les donnes de scnario pour la gnration.","node.help.note":"Une note adhsive pour ajouter des commentaires sur le canevas.","node.help.reroute_dot":"Un petit point pour organiser les connexions proprement.","node.help.data_reader":"Outil de dbogage pour inspecter les donnes brutes.","node.help.video_editor":"Outil de montage vido et image bas sur une timeline.","node.help.media_viewer":"Lecteur pour voir les fichiers vido et audio avec contrles.","node.help.data_protection":"Mini-jeu de Tower Defense pour protger vos donnes.","node.help.pose_creator":"Visually rig and create character poses for generation guidance.","node.action.expand":"Agrandir","node.action.collapse":"Rduire","node.action.help":"Aide","node.action.download":"Tlcharger","node.action.clear":"Effacer contenu","node.action.refreshChat":"Redmarrer le chat","node.action.paste":"Coller","node.action.resetEditor":"Rinitialiser","node.action.saveCharacter":"Sauver carte","node.action.loadCharacter":"Charger carte","node.action.copy":"Copier","node.action.copyImage":"Copier image","node.action.copyTextPrompt":"Copier prompt","node.action.copyImagePrompt":"Copier prompt image","node.action.copyVideoPrompt":"Copier prompt vido","node.action.cutConnections":"Couper connexions","node.action.close":"Fermer","node.action.closeNode":"Fermer le nud (Shift+Clic pour instantan)","node.action.closeNodeSimple":"Fermer le nud","node.action.randomWord":"Mot alatoire","node.action.processImage":"Enlever filigranes","node.action.processImageTitle":"Utilise Gemini pour enlever filigranes et textes.","node.action.editor":"diteur","node.action.rasterEditor":"diteur Raster","node.action.openInAIEditor":"Ouvrir diteur IA","node.action.openInAnalyzer":"Ouvrir Analyseur","node.action.outputToInput":"Sortie vers Entre","node.action.processChainForward":"Traiter la chane","node.action.executeChain":"Excuter la chane","node.action.executeChainTitle":"Excute tous les nuds en amont pour gnrer le rsultat.","node.action.sanitize":"Nettoyer","node.action.rename":"Renommer","node.action.stop":"Arrter","node.action.stopping":"Arrt...","node.action.deleteItem":"Supprimer lment","node.action.detachAndPaste":"Dtacher et Coller","node.action.delete":"Supprimer","node.action.flipImage":"Retourner l'image","node.action.pin":"pingler le nud","node.action.unpin":"Dspingler","node.action.updateDescription":"Mettre  jour la description","node.action.modifyCharacter":"Demander des modifications","node.action.updateDataFormat":"Mettre  jour le format des donnes","node.action.expand169":"tendre  16:9","node.action.expand916":"tendre  9:16","node.action.sync":"Synchroniser depuis les connexions","node.action.expandRatio":"tendre le ratio d'aspect","node.action.markPrimary":"Marquer comme principal","node.action.addCard":"Ajouter une carte","node.action.removeCard":"Retirer la carte","node.action.showOutputs":"Afficher les sorties","node.action.hideOutputs":"Masquer les sorties","node.mediaViewer.play":"Lecture","node.mediaViewer.pause":"Pause","node.mediaViewer.stop":"Arrt","node.mediaViewer.addMarker":"Ajouter marqueur","node.mediaViewer.exportSRT":"Exporter marqueurs (SRT)","node.mediaViewer.deleteAllMarkers":"Tout effacer","node.mediaViewer.saveMarkers":"Sauvegarder marqueurs","node.mediaViewer.loadMarkers":"Charger marqueurs","node.mediaViewer.relink":"Relier fichier","node.content.notePlaceholder":"crivez vos notes ici...","node.content.dropImage":"Dposez une image ou cliquez","node.content.dropMedia":"Dposez une vido ou un audio","node.content.processing":"Traitement...","node.content.processingChain":"Traitement chane...","node.content.metadataPrompt":"Prompt des mtadonnes :","node.content.metadataPromptPlaceholder":"Aucun prompt trouv.","node.content.copyPrompt":"Utiliser","node.content.prompt":"Prompt","node.content.inputPrompt":"Prompt d'entre","node.content.enhancedResult":"Rsultat amlior","node.content.videoPrompt":"Prompt Vido","node.content.editPromptPlaceholder":"Ajouter ou diter le prompt...","node.content.enhancedPromptHere":"Le prompt amlior apparatra ici...","node.content.safePrompt":"Sr pour usage commercial","node.content.generating":"Gnration...","node.content.imageHere":"L'image apparatra ici","node.content.generationMode":"Modle de gnration","node.content.aspectRatio":"Format","node.content.aspectRatioHelp":"Dfinir le format de l'image","node.content.aspectRatioNotSupportedFast":"Format disponible uniquement pour modles Imagen.","node.content.enableAspectRatioFormatting":"Activer le formatage du ratio","node.content.autoDownload":"Auto Tlchargement","node.content.generateImage":"Gnrer Image","node.content.enhancing":"Amlioration...","node.content.enhancePrompt":"Amliorer le prompt","node.content.sanitizing":"Nettoyage...","node.content.sanitizedPromptHere":"Le prompt nettoy apparatra ici...","node.content.analyzing":"Analyse...","node.content.analyzePrompt":"Analyser le prompt","node.content.analyzeImage":"Analyser l'image","node.content.imageToText":"Image vers Texte","node.content.updatePromptFromImage":"Mettre  jour le prompt depuis l'image","node.content.analyzeCharacter":"Analyser Personnage","node.content.generateCharacters":"Gnrer Personnages","node.content.characterPromptPlaceholder":"Dcrivez le(s) personnage(s)...","node.content.character":"Personnage","node.content.clothing":"Vtements","node.content.characterPlaceholder":"Description du personnage ici...","node.content.clothingPlaceholder":"Description des vtements ici...","node.content.appearance":"Apparence","node.content.personality":"Personnalit","node.content.environment":"Environnement","node.content.action":"Action","node.content.emotion":"motion","node.content.style":"Style","node.content.environmentPlaceholder":"Description dtaille de l'environnement...","node.content.charactersPlaceholder":"Liste des personnages principaux...","node.content.characters":"Personnages","node.content.characterConcepts":"Concepts de personnage","node.content.actionPlaceholder":"Description de l'action...","node.content.emotionPlaceholder":"Description de l'motion...","node.content.stylePlaceholder":"Description du style artistique...","node.content.descriptionHere":"La description apparatra ici...","node.content.enableOutpainting":"Activer Outpainting","node.content.outpaintingPromptPlaceholder":"Prompt d'outpainting...","node.content.inputImage":"Images d'entre","node.content.dropOrClick":"Dposer ou Cliquer","node.content.outputImage":"Image de sortie","node.content.applyEdit":"Appliquer","node.content.editing":"dition...","node.content.chatPlaceholder":"Tapez votre message...","node.content.connectedPlaceholder":"Connect  un nud, ditez  la source.","node.content.connectedNode":"Connect via nud","node.content.connectedEmpty":"Le nud connect n'a pas d'image.","node.content.translatePlaceholder":"Texte  traduire...","node.content.translatedTextPlaceholder":"Texte traduit...","node.content.targetLanguage":"Langue cible","node.content.translate":"Traduire","node.content.translating":"Traduction...","node.content.scriptPromptPlaceholder":"Entrez une ide d'histoire...","node.content.generateScript":"Gnrer Scnario","node.content.loadScript":"Charger Scnario","node.content.summary":"Rsum","node.content.scenes":"Scnes","node.content.unrecognizedFormat":"Format de scnario non reconnu.","node.content.frames":"Cadres","node.content.characterIndex":"Index","node.content.readData":"Lire les donnes","node.content.textDataHere":"Les donnes texte apparatront ici.","node.content.noDataRead":'Connectez un nud et cliquez sur "Lire les donnes".',"node.content.previewError":"Erreur Aperu","node.content.previewPlaceholder":"L'aperu apparatra ici","node.content.imagePrompt":"Prompt Image","node.output.allPromptData":"Toutes les donnes","node.note.tab.note":"Note","node.note.tab.references":"Rfrences","node.note.nestedImages":"Images Imbriques","node.note.dropPlaceholder":"Dposez des images","node.note.addCaption":"Lgende","node.note.action.shuffle":"Mlanger","node.note.action.undoShuffle":"Annuler Mlange","node.content.characterTypeShort":"Type:","node.content.numberOfCharactersShort":"Qt:","node.content.characterType.simple":"Simple","node.content.characterType.anthro":"Anthro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Objet Cl","node.content.style.simple":"Simple","node.content.style.realistic":"Raliste","node.content.style.3d_cartoon":"3D Cartoon","node.content.style.3d_realistic":"3D Raliste","node.content.style.2d_animation":"Animation 2D","node.content.style.anime":"Anime","node.content.style.comics":"Comics","node.content.style.custom":"Personnalis","node.content.fullDescriptionTitle":"Description complte du personnage","node.content.integrationInstruction":"Instruction d'intgration","node.content.additionalPromptSuffix":"Prompt Additionnel (Suffixe)","search.node.text_input.title":"Entre de Texte","search.node.text_input.description":"Un champ texte simple.","search.node.image_input.title":"Entre d'Image","search.node.image_input.description":"Charger une image.","search.node.prompt_sequence_editor.title":"diteur Squence Prompts","search.node.prompt_sequence_editor.description":"diter une liste de prompts en masse.","search.node.data_reader.title":"Lecteur de Donnes","search.node.data_reader.description":"Inspecter les donnes brutes d'un nud.","search.node.note.title":"Note","search.node.note.description":"Une note adhsive.","search.node.prompt_processor.title":"Processeur de Prompt","search.node.prompt_processor.description":"Amliore un prompt via IA.","search.node.prompt_analyzer.title":"Analyseur de Prompt","search.node.prompt_analyzer.description":"Dcompose un prompt.","search.node.prompt_sanitizer.title":"Nettoyeur de Prompt","search.node.prompt_sanitizer.description":"Rend le prompt sr pour l'IA.","search.node.character_card.title":"Carte Personnage","search.node.character_card.description":"Info dtaille d'un personnage.","search.node.character_analyzer.title":"Analyseur Personnage","search.node.character_analyzer.description":"Spare apparence et vtements.","search.node.character_generator.title":"Gnrateur Personnage","search.node.character_generator.description":"Cre des personnages depuis un prompt.","search.node.image_analyzer.title":"Analyseur d'Image","search.node.image_analyzer.description":"Dcrit une image.","search.node.image_editor.title":"diteur Image IA","search.node.image_editor.description":"dite des images avec des prompts.","search.node.image_sequence_generator.title":"Gnrateur Squence Image","search.node.image_sequence_generator.description":"Cre des squences d'images.","search.node.gemini_chat.title":"Chat Gemini","search.node.gemini_chat.description":"Discuter avec Gemini.","search.node.translator.title":"Traducteur","search.node.translator.description":"Traduit du texte.","search.node.script_generator.title":"Gnrateur Scnario","search.node.script_generator.description":"Cre un script structur.","search.node.script_viewer.title":"Visualiseur Scnario","search.node.script_viewer.description":"Gre les donnes de scnario.","search.node.note":"Bote de texte simple.","search.node.reroute_dot":"Point pour organiser les cbles.","search.node.video_prompt_processor.title":"Proc. Prompt Vido","search.node.video_prompt_processor.description":"Cre des prompts pour vido.","search.node.video_output.title":"Sortie Vido","search.node.video_output.description":"Gnre une vido avec Veo.","search.node.image_output.title":"Sortie Image","search.node.image_output.description":"Affiche les images gnres.","search.node.media_viewer.title":"Lecteur Multimdia","search.node.media_viewer.description":"Lecteur vido et audio.","search.node.data_protection.title":"Protection Donnes","search.node.data_protection.description":"Mini-jeu Tower Defense.","search.node.pose_creator.title":"Pose Creator","search.node.pose_creator.description":"Visually rig and create character poses for generation guidance.","prompt_sequence_editor.instructionPlaceholder":"Entrez une instruction pour modifier les prompts...","prompt_sequence_editor.modifying":"Modification...","prompt_sequence_editor.modifySelected":"Modifier slection ({count})","prompt_sequence_editor.sourcePrompts":"Prompts Source","prompt_sequence_editor.finalPrompts":"Prompts Modifis","prompt_sequence_editor.error.invalidInput":"Format invalide. Connectez une squence de prompts.","geminiChat.mode.general":"Gnral","geminiChat.mode.prompt":"Expert Prompt","geminiChat.mode.script":"Scnariste","geminiChat.mode.youtube":"Analyste YouTube","image_sequence.deselect_scene":"Dslectionner la scne","image_sequence.clear_prompts_only":"Effacer Textes Uniquement","image_sequence.prev_scene":"Scne Prcdente","image_sequence.next_scene":"Scne Suivante","image_sequence.frames_hidden":"({count} cadres masqus)","image_sequence.frames_count":"({count} cadres)","node.content.modificationRequest":"Demande de modification","node.content.technicalPrompt":"Prompt Technique","node.promptProcessor.safePromptTooltip":"Rcrit le prompt pour se conformer aux consignes de scurit et viter les violations de politique.","node.promptProcessor.technicalPromptTooltip":"Convertit le prompt en une spcification technique hautement dtaille (clairage, camra, paramtres de rendu).","node.promptProcessor.enhanceTooltip":"Utilise l'IA pour tendre et enrichir le prompt avec des dtails descriptifs.","node.promptProcessor.chainTooltip":"Excute ce nud et dclenche tous les nuds connects en aval.","image_sequence.tooltip.autoCrop":"Recadre automatiquement les images gnres au format 16:9.","image_sequence.tooltip.autoDownload":"Enregistre automatiquement chaque image sur votre appareil aprs sa gnration.","image_sequence.tooltip.createZip":"Regroupe toutes les images slectionnes dans une archive ZIP unique lors du tlchargement."},Zw={"imageEditor.title":"diteur d'Image","imageEditor.canvasResolution":"Rsolution Canevas","imageEditor.background":"Arrire-plan","imageEditor.toolSettings":"Paramtres Outil","imageEditor.snapToEdges":"Magntisme","imageEditor.freeAspect":"Ratio Libre","imageEditor.section.aiRequest":"Demande Modification IA","imageEditor.input.modificationPlaceholder":'Dcrivez les changements, ex: "fond bleu"',"imageEditor.action.sendRequest":"Envoyer Demande","imageEditor.tooltip.removeObject":"Supprimer (Rouge) / Garder (Vert)","imageEditor.action.removeObject":"Supprimer Objet","imageEditor.tool.transform":"Transformer","imageEditor.tool.hand":"Main (Pan)","imageEditor.tool.zoom":"Zoom","imageEditor.tool.pencil":"Crayon","imageEditor.tool.rectangle":"Rectangle","imageEditor.action.fit":"Ajuster","imageEditor.action.fill":"Remplir","imageEditor.action.cancel":"Annuler","imageEditor.action.resetEdits":"Rinitialiser","imageEditor.action.apply":"Appliquer","imageViewer.title":"Visionneuse","imageEditor.outputResolution":"Rsolution Sortie","imageEditor.outputResolutionHelp":'Dfinir rsolution de sortie. "Auto" utilise le canevas.',"imageEditor.currentSize":"Taille Actuelle : {width}x{height}","imageEditor.sequenceMode":"Mode Squence","imageEditor.sequenceModeHelp":"Traiter les images de l'Entre A squentiellement.","imageEditor.sequentialCombination":"Combinaison Squentielle","imageEditor.sequentialCombinationHelp":"Pour chaque cadre : Envoie image A actuelle + Toutes images B.","imageEditor.sequentialPrompt":"Combinaison Prompt Squentiel","imageEditor.sequentialPromptHelp":"Pour chaque cadre : Utilise un prompt unique de la liste + image actuelle.","imageEditor.sequentialEditingWithPrompts":"dition Squentielle avec Prompts","imageEditor.sequentialEditingWithPromptsHelp":"Pour chaque cadre : Utilise image B + prompt unique. Entre A ignore.","imageEditor.input":"Entre","imageEditor.inputA":"Entre A","imageEditor.inputB":"Entre B","imageEditor.status.queued":"En attente","imageEditor.status.generating":"Gnration...","imageEditor.action.regenerate":"Rgnrer","imageEditor.tooltip.fit":"Ajuster l'image aux limites (contain).","imageEditor.tooltip.fill":"Remplir le canevas (cover).","imageEditor.tooltip.flip":"Retourner horizontalement.","imageEditor.background.white":"Blanc","imageEditor.background.gray":"Gris","imageEditor.background.black":"Noir","imageEditor.background.dark":"Sombre","image_sequence.regenerate":"Rgnrer","image_sequence.stop_queue":"Arrter File","image_sequence.move_up":"Monter","image_sequence.move_down":"Descendre","image_sequence.copy_prompt":"Copier Prompt","image_sequence.add_frame":"Ajouter Cadre","image_sequence.delete_frame":"Supprimer Cadre","image_sequence.expand_all_frames":"Tout Dplier/Replier","image_sequence.collapse_all_frames":"Tout Replier (Cadres)","image_sequence.expand_all_scenes":"Tout Dplier (Scnes)","image_sequence.collapse_all_scenes":"Tout Replier (Scnes)","image_sequence.expand_all":"Tout Dplier","image_sequence.collapse_all":"Tout Replier","image_sequence.clear_all_prompts":"Effacer Tous Prompts","image_sequence.add_first_frame":"Ajouter 1er Cadre","image_sequence.drop_or_add_title":"Dposer JSON ou Ajouter","image_sequence.drop_or_add_desc":"Dposez un fichier JSON ou cliquez pour ajouter.","image_sequence.load_prompts":"Charger Prompts","image_sequence.output_images_title":"Images de Sortie","image_sequence.prompts_list_title":"Prompts Source","image_sequence.download_selected":"Tlcharger Slection","image_sequence.select_all":"Tout Slectionner","image_sequence.select_none":"Dslectionner","image_sequence.invert_selection":"Inverser","image_sequence.run_selected":"Lancer Slection","image_sequence.start_queue":"Lancer File","image_sequence.character_prompt_combination":"Combinaison Prompt Perso","image_sequence.combination_none":"Aucun","image_sequence.combination_combine":"Combiner","image_sequence.combination_replace":"Remplacer Tags","image_sequence.status.error":"Erreur","image_sequence.status.pending":"En attente","image_sequence.clear_selected_prompts":"Effacer Prompts Slectionns","image_sequence.range_from":"De :","image_sequence.range_to":" :","image_sequence.stats.total":"Total : {count}","image_sequence.stats.generated":"Gnrs : {count}","image_sequence.stats.queue":"File : {count}","image_sequence.edit_in_source":"diter Source","image_sequence.edit_prompt":"diter Prompt","image_sequence.select_scene":"Slectionner Scne","image_sequence.next_scene":"Scne Suivante","image_sequence.prev_scene":"Scne Prcdente","image_sequence.scene_input_label":"Scne","image_sequence.select_square":"Carr (1:1)","image_sequence.select_landscape":"Paysage (16:9)","image_sequence.select_portrait":"Portrait (9:16)","image_sequence.select_range":"Slectionner Plage","image_sequence.force_refresh":"Forcer Actualisation","image_sequence.select_scene_frames":"Slectionner toute la scne","image_sequence.collapse_other_scenes":"Replier autres scnes","prompt_sequence_editor.instructionPlaceholder":"Entrez une instruction...","prompt_sequence_editor.modifying":"Modification...","prompt_sequence_editor.modifySelected":"Modifier Slection ({count})","prompt_sequence_editor.sourcePrompts":"Prompts Source","prompt_sequence_editor.finalPrompts":"Prompts Modifis","prompt_sequence_editor.error.invalidInput":"Format invalide.","geminiChat.mode.general":"Gnral","geminiChat.mode.prompt":"Expert Prompt","geminiChat.mode.script":"Scnariste","geminiChat.mode.youtube":"Analyste YouTube","image_sequence.shot_type.WS":"Intgrez l'Entit avec un Plan Large (WS) dans la scne et l'action. Montrez l'environnement.","image_sequence.shot_type.MS":"Intgrez l'Entit avec un Plan Moyen (MS) dans la scne. Personnage de la taille vers le haut.","image_sequence.shot_type.CU":"Intgrez l'Entit avec un Gros Plan (CU) dans la scne.","image_sequence.shot_type.ECU":"Intgrez l'Entit avec un Trs Gros Plan (ECU) dans la scne. Dtails maximum.","image_sequence.shot_type.LS":"Intgrez l'Entit avec un Plan d'Ensemble (LS) dans la scne pour montrer l'chelle."},Qw={"dialog.permission.title":"Permission Requise","dialog.permission.description":"Cette application a besoin d'accder au presse-papiers pour coller du contenu dans les nuds. Vos donnes ne sont ni stockes ni envoyes.","dialog.permission.allow":"Autoriser","dialog.permission.decline":"Refuser","dialog.rename.title":"Renommer l'lment","dialog.rename.group.title":"Renommer le groupe","dialog.rename.catalog.title":"Renommer lment catalogue","dialog.rename.node.title":"Renommer le nud","dialog.rename.label":"Nouveau nom :","dialog.rename.confirm":"Renommer","dialog.rename.cancel":"Annuler","dialog.promptEdit.title":"diter le Prompt","dialog.promptEdit.nameLabel":"Nom :","dialog.promptEdit.contentLabel":"Contenu :","dialog.promptEdit.confirm":"Enregistrer","dialog.promptEdit.cancel":"Annuler","dialog.confirmDelete.title":"Confirmer la suppression","dialog.confirmDelete.message":"tes-vous sr de vouloir supprimer cet lment ? Cette action est irrversible.","dialog.confirmDelete.confirm":"Supprimer","dialog.confirmDelete.cancel":"Annuler","dialog.confirmCloseTab.title":"Fermer l'onglet","dialog.confirmCloseTab.message":`Voulez-vous vraiment fermer l'onglet "{tabName}" ? Les changements non sauvegards seront perdus.`,"dialog.confirmClear.title":"Effacer le canevas","dialog.confirmClear.message":"Voulez-vous vraiment tout effacer ? Cette action est irrversible.","dialog.confirmReset.title":"Rinitialiser","dialog.confirmReset.message":"Voulez-vous remettre le canevas  l'tat par dfaut ? Tout travail actuel sera perdu.","dialog.confirmReset.confirm":"Rinitialiser","dialog.confirmLoad.title":"Confirmer le chargement","dialog.confirmLoad.message":"Charger un fichier remplacera le contenu actuel. Les changements non sauvegards seront perdus. Continuer ?","dialog.apiKey.title":"Slectionner Cl API","dialog.apiKey.description":'Cette fonction ncessite une cl API Projet avec "AI Platform" activ. La gnration vido peut prendre quelques minutes.',"dialog.apiKey.billingLink":"En savoir plus sur la facturation","dialog.apiKey.button":"Slectionner Cl API","dialog.settings.title":"Paramtres","dialog.settings.apiKeyLabel":"Votre Cl API Google Gemini :","dialog.settings.useDevKeyLabel":"Utiliser la cl gratuite (dveloppement)","dialog.settings.instantNodeCloseLabel":"Fermeture instantane des nuds","dialog.settings.nodeAnimationLabel":"Animation d'ajout de nud","dialog.settings.animationModeLabel":"Mode d'animation de cration","dialog.settings.anim.pulse":"Pulsion","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"Aucune","dialog.settings.description":"Pour utiliser vos propres quotas et accder  des modles spcifiques, entrez votre cl API personnelle. Elle est stocke localement.","dialog.settings.getKeyLink":"Obtenir une cl API ici","dialog.settings.save":"Enregistrer","dialog.deleteNode.title":"Fermer le nud ?","dialog.deleteNode.titlePlural":"Fermer les nuds ?","dialog.deleteNode.confirm":"Oui","dialog.deleteNode.cancel":"Non","dialog.deleteNode.confirmTooltip":"Fermer le nud - les donnes perdues ne peuvent pas tre rcupres","dialog.deleteNode.cancelTooltip":"Ne pas fermer - continuer  travailler","dialog.deleteNode.dontShowAgain":"Ne plus afficher","dialog.exitApp.title":"Fermer le projet ?","dialog.exitApp.message":"Voulez-vous vraiment fermer le projet ? Tout travail actuel sera perdu et le canevas sera rinitialis."},eb={"group.button.create":"Crer un groupe ({count})","group.rename":"Renommer le groupe","group.saveToCatalog":"Sauver dans le catalogue","group.saveToDisk":"Sauver sur le disque","group.ungroup":"Dgrouper (Shift+Clic pour tout supprimer)","group.duplicate":"Dupliquer avec contenu","catalog.tabs.groups":"Groupes","catalog.tabs.library":"Bibliothque","catalog.tabs.characters":"Personnages","catalog.tabs.scripts":"Scnarios","catalog.tabs.sequences":"Squences","catalog.back":"Retour","catalog.load":"Charger un fichier","catalog.newFolder":"Nouveau Dossier","catalog.saveTo":"Sauver dans le catalogue","catalog.card.addToCanvas":"Ajouter au canevas","catalog.card.rename":"Renommer","catalog.card.save":"Sauvegarder","catalog.card.delete":"Supprimer","catalog.empty.description":"Ce dossier est vide. Ajoutez des lments ou crez des dossiers.","library.loadFromFile":"Charger","library.actions.newFolder":"Nouveau Dossier","library.actions.newPrompt":"Nouveau Prompt","library.actions.copy":"Copier","library.actions.edit":"diter","library.empty.title":"Dossier Vide","library.empty.description":"Crez des prompts et des dossiers pour commencer.","library.emptyPrompt":"Prompt vide"},tb={...Jw,...Yw,...Xw,...Zw,...Qw,...eb},nb={"app.title":"Prompt Modifier","app.subtitle":"Verbinden Sie Ideen, um ein Meisterwerk zu schaffen","app.error.title":"Benachrichtigung","app.error.copy":"Nachricht kopieren","app.error.copied":"Kopiert!","error.apiKey":"Ihr API-Schlssel ist ungltig oder hat keine Berechtigungen. Bitte whlen Sie einen gltigen API-Schlssel.","error.scriptModifierCanvas":"Diese Leinwand gehrt zu einer anderen Anwendung - Script Modifier. Bitte verwenden Sie Script Modifier, um diese Datei zu ffnen.","welcome.title":"Willkommen bei","welcome.description":"Willkommen beim Prompt Modifier. Verbinden Sie Ideen, um Meisterwerke zu schaffen. Verwenden Sie Knoten, um Inhalte zu generieren und zu bearbeiten.","welcome.apiKeyLabel":"Ihr Google Gemini API-Schlssel","welcome.apiKeyPlaceholder":"Geben Sie hier Ihren API-Schlssel ein...","welcome.apiKeyHelp":"Ihr API-Schlssel wird lokal gespeichert.","welcome.getKeyLink":"API-Schlssel erhalten","welcome.iAmDeveloper":"Ich bin Entwickler","welcome.letsGo":"Los geht's","welcome.resume":"Fortsetzen","welcome.startNew":"Neue Leinwand","welcome.freeModeActive":"Kostenloser Modus aktiv","welcome.selectLanguage":"Whlen Sie Ihre Hauptsprache","welcome.navHint":"Verwenden Sie die Tastaturtasten  und , um die Sprache zu ndern","toast.contentCleared":"Inhalt gelscht","toast.downloadStarted":"Download gestartet","toast.characterLoaded":"Charakterkarte geladen","toast.characterSavedDisk":"Charakterkarte auf Festplatte gespeichert","toast.copiedToClipboard":"In die Zwischenablage kopiert","toast.pastedFromClipboard":"Aus der Zwischenablage eingefgt","toast.pasteFailed":"Einfgen fehlgeschlagen","toast.nodeDuplicated":"Knoten dupliziert","toast.groupSavedToDisk":'Gruppe "{groupTitle}" auf Festplatte gespeichert',"toast.groupDeleted":"Gruppe und Inhalt gelscht","toast.characterSavedCatalog":"Charakter im Katalog gespeichert","toast.promptSaved":"Prompt in Bibliothek gespeichert: {promptName}...","toast.connectionsCut":"Verbindungen getrennt","toast.apiKeySaved":"API-Schlssel erfolgreich gespeichert","toast.cacheCleared":"{count} ungenutzte Elemente aus dem Cache gelscht","toast.cacheEmpty":"Cache ist bereits optimiert","toast.scriptSaved":"Skript auf Festplatte gespeichert","alert.groupSaved":'Gruppe "{groupTitle}" im Katalog gespeichert.',"alert.loadCatalogFailed":"Laden der Katalogdatei fehlgeschlagen","alert.invalidCatalogFile":"Ungltiges Katalogdateiformat","alert.fileNotSupported":'Datei nicht untersttzt. "appName" fehlt oder ist falsch.',"alert.invalidCatalogStructure":'Ungltige Katalogstruktur. "root" fehlt.',"tutorial.step1":"Klicken Sie hier, um dem Prompt ein zuflliges Wort hinzuzufgen.","tutorial.step2":'Klicken Sie auf "Prompt verbessern", um Eingaben mithilfe von KI zu kombinieren.',"tutorial.step2_waiting":"Die KI analysiert Ihre Eingaben und generiert einen reichhaltigeren Prompt...","tutorial.step3":"Klicken Sie schlielich hier, um das Bild zu generieren.","tutorial.step3b":"Die Generierung dauert einige Zeit. Sie knnen den Fortschritt hier berwachen.","tutorial.step4":"Sie knnen neue Knoten manuell ber diese Symbolleiste hinzufgen.","tutorial.group.catalog":"Verwenden Sie den Katalog, um nach Knoten zu suchen oder Gruppen zu verwalten.","tutorial.group.general":"Fgen Sie Haftnotizen und Datenleser zum Debuggen hinzu.","tutorial.group.input":"Grundlegende Eingaben fr Text, Bilder und Sequenzen.","tutorial.group.processing":"Analysieren und verarbeiten Sie Prompts oder Bilder mit KI.","tutorial.group.character":"Erstellen, analysieren und speichern Sie detaillierte Charaktere.","tutorial.group.output":"Ergebnisse anzeigen und Sequenzen generieren.","tutorial.group.ai":"Chatten Sie mit Gemini und bersetzen Sie Text.","tutorial.group.video":"Tools fr Videoprompts und Bearbeitung.","tutorial.group.scripts":"Generieren und betrachten Sie Skripte fr komplexe Geschichten.","tutorial.group.file":"Speichern Sie Ihre Arbeit, laden Sie Projekte oder laden Sie die Leinwand herunter.","tutorial.success.title":"Tutorial abgeschlossen!","tutorial.success.message":"Sie haben die Grundlagen von Prompt Modifier erfolgreich erlernt. Viel Glck beim Erstellen von Meisterwerken!","tutorial.success.button":"Erstellen beginnen","tutorial.skip":"berspringen","tutorial.next":"Weiter","tutorial.finish":"Verstanden"},ob={"toolbar.settings":"Einstellungen","toolbar.resetCanvas":"Leinwand zurcksetzen","toolbar.clearCache":"Ungenutzten Cache leeren","toolbar.home":"Startseite","toolbar.edit":"Bearbeiten (V)","toolbar.cutter":"Verbindung trennen (C) / (Strg halten)","toolbar.selection":"Auswahl (S) / (Umschalt halten)","toolbar.reroute":"Umlenken (R) / (Strg+Alt halten)","toolbar.zoom":"Zoom (Z halten)","toolbar.snapToGrid":"Am Raster ausrichten","toolbar.smartGuides":"Intelligente Hilfslinien","toolbar.lineStyleSpaghetti":"Spaghetti-Linien","toolbar.lineStyleOrthogonal":"Orthogonale Linien","toolbar.resetZoom":"Zoom zurcksetzen","toolbar.resetCamera":"Kameraposition zurcksetzen","toolbar.clearCanvas":"Leinwand leeren","toolbar.addNode":"Knoten hinzufgen (F)","toolbar.catalog":"Katalog ffnen (Strg + Leertaste)","toolbar.addNote":"Notiz hinzufgen (N)","toolbar.addDataReader":"Datenleser hinzufgen (Umschalt + R)","toolbar.addTextInput":"Texteingabe hinzufgen (T)","toolbar.addImageInput":"Bildeingabe hinzufgen (I)","toolbar.addPromptSequenceEditor":"Prompt-Sequenz-Editor hinzufgen (Q)","toolbar.addImageAnalyzer":"Bildanalysator hinzufgen (Umschalt+A)","toolbar.addPromptAnalyzer":"Prompt-Analysator hinzufgen (A)","toolbar.addPromptProcessor":"Prompt-Prozessor hinzufgen (P)","toolbar.addCharacterGenerator":"Charaktergenerator hinzufgen (Umschalt+C)","toolbar.addCharacterAnalyzer":"Charakteranalysator hinzufgen (Strg+Umschalt+A)","toolbar.addCharacterCard":"Charakterkarte hinzufgen (Strg+Umschalt+C)","toolbar.addImageOutput":"Bildausgabe hinzufgen (O)","toolbar.addImageEditor":"KI-Bildeditor hinzufgen (Umschalt+I)","toolbar.addImageSequenceGenerator":"Bildsequenz-Generator hinzufgen (Umschalt+Q)","toolbar.addTranslator":"bersetzer hinzufgen (L)","toolbar.addGeminiChat":"Gemini Chat hinzufgen (M)","toolbar.addVideoPromptProcessor":"Video-Prompt-Prozessor hinzufgen (Umschalt+P)","toolbar.addVideoOutput":"Videoausgabe hinzufgen (Umschalt+O)","toolbar.addScriptGenerator":"Skriptgenerator hinzufgen","toolbar.addScriptViewer":"Skript-Viewer hinzufgen (Umschalt + V)","toolbar.saveCanvas":"Leinwand speichern (Strg + S)","toolbar.saveProject":"Projekt speichern","toolbar.loadCanvas":"Projekt/Leinwand laden (Strg + O)","toolbar.group.general":"Allgemein","toolbar.group.catalog":"Katalog","toolbar.group.input":"Eingabe","toolbar.group.processing":"Verarbeitung","toolbar.group.character":"Charakter","toolbar.group.output":"Ausgabe","toolbar.group.aiTools":"KI-Tools","toolbar.group.video":"Video","toolbar.group.scripts":"Skripte","toolbar.group.file":"Datei","toolbar.title":"Symbolleiste","toolbar.dock":"Leiste andocken","toolbar.detach":"Leiste lsen","toolbar.expandPanel":"Panel erweitern","toolbar.collapsePanel":"Panel einklappen","toolbar.dockArea.title":"Leiste hier andocken","toolbar.duplicate":"Knoten duplizieren","toolbar.duplicateWithContent":"Mit Inhalt duplizieren","toolbar.dock.q1":"Links 1. Vtl.","toolbar.dock.q2":"Links 2. Vtl.","toolbar.dock.q3":"Rechts 3. Vtl.","toolbar.dock.q4":"Rechts 4. Vtl.","toolbar.dock.tl":"Oben Links","toolbar.dock.bl":"Unten Links","toolbar.dock.tr":"Oben Rechts","toolbar.dock.br":"Unten Rechts","toolbar.dock.left":"Linke Hlfte","toolbar.dock.right":"Rechte Hlfte","toolbar.dock.full":"Vollbild","toolbar.dock.exitFull":"Vollbild beenden","toolbar.dock.fullFocus":"Vollbild-Fokus","hotkeys.show":"Tastenkrzel anzeigen","hotkeys.tools.title":"Werkzeuge","hotkeys.tools.edit":"Bearbeitungsmodus","hotkeys.tools.cutter":"Schneidewerkzeug","hotkeys.tools.selection":"Auswahlwerkzeug","hotkeys.tools.reroute":"Umlenkwerkzeug","hotkeys.tools.zoom":"Zoom-Werkzeug","hotkeys.tools.toggleLineStyle":"Linienstil umschalten","hotkeys.tools.group":"Gruppenauswahl","hotkeys.tools.closeNode":"Auswahl lschen","hotkeys.tools.duplicate":"Knoten duplizieren","hotkeys.tools.duplicateWithContent":"Mit Inhalt duplizieren","hotkeys.tools.deleteGroup":"Gruppe lschen (Umschalt+Klick)","hotkeys.windows.title":"Fenster","hotkeys.windows.search":"Schnellsuche","hotkeys.windows.catalog":"Katalog","hotkeys.createNode.title":"Knoten erstellen","help.panelTitle":"Hilfe & Tastenkrzel","help.title":"Tastaturkrzel","help.howToUse.title":"Verwendung","help.howToUse.content":"Willkommen bei Prompt Modifier! Verwenden Sie die Symbolleiste oder Tastenkrzel, um Knoten hinzuzufgen. Verbinden Sie Knoten, um Daten zu bertragen. Verwenden Sie das Bearbeitungswerkzeug, um Knoten zu verschieben und die Leinwand zu schwenken. Doppelklicken Sie auf einen leeren Bereich, um das Schnellmen zu ffnen. Rechtsklick fr das Kontextmen.","help.author":"Autor","contextMenu.undoPosition":"Position rckgngig","contextMenu.redoPosition":"Position wiederherstellen","contextMenu.align.left":"Links ausrichten (F)","contextMenu.align.centerX":"Zentrieren X (E)","contextMenu.align.right":"Rechts ausrichten (R)","contextMenu.align.top":"Oben ausrichten (T)","contextMenu.align.centerY":"Zentrieren Y (D)","contextMenu.align.bottom":"Unten ausrichten (B)","contextMenu.distribute.horizontal":"Horiz. verteilen (Strg+D)","contextMenu.distribute.vertical":"Vert. verteilen (Strg+E)","contextMenu.emptySlot":"Leerer Slot (Rechtsklick zum Zuweisen)","contextMenu.saveSlots":"Slots speichern","contextMenu.loadSlots":"Slots laden","quickadd.title":"Schnell hinzufgen","quickadd.group.tools":"Werkzeuge","quickadd.group.inputs":"Eingaben","quickadd.group.processing":"Verarbeitung","quickadd.group.character":"Charakter","quickadd.group.outputs":"Ausgaben","quickadd.group.ai":"KI-Tools","quickadd.group.video":"Video","quickadd.group.scripts":"Skripte","quickadd.group.general":"Allgemein","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"Bearbeiten","quickadd.tool.cutter":"Schneiden","quickadd.tool.selection":"Auswahl","search.placeholder":"Knoten suchen...","search.noResults":"Keine Knoten gefunden.","search.group.input":"Eingabe & Basis","search.group.process":"Verarbeitung & Charakter","search.group.output":"Bild & Sequenz","search.group.ai":"KI-Tools","search.group.video":"Video & Skript","search.group.scripts":"Skripte","toolbar.exitApp":"Projekt schlieen"},rb={"node.title.text_input":"Texteingabe","node.title.image_input":"Bildeingabe","node.title.prompt_processor":"Prompt-Prozessor","node.title.prompt_sanitizer":"Prompt-Bereiniger","node.title.video_prompt_processor":"Video-Prompt-Prozessor","node.title.image_output":"Bildausgabe","node.title.video_output":"Videoausgabe","node.title.prompt_analyzer":"Prompt-Analysator","node.title.character_analyzer":"Charakter-Analysator","node.title.character_generator":"Charakter-Generator","node.title.character_card":"Charakterkarte","node.title.image_analyzer":"Bildanalysator","node.title.image_editor":"KI-Bildeditor","node.title.image_sequence_generator":"Bildsequenz-Generator","node.title.prompt_sequence_editor":"Prompt-Sequenz-Editor","node.title.gemini_chat":"Gemini Chat","node.title.translator":"bersetzer","node.title.script_generator":"Skript-Generator","node.title.script_viewer":"Skript-Viewer","node.title.note":"Notiz","node.title.reroute_dot":"Umlenkpunkt","node.title.data_reader":"Datenleser","node.title.video_editor":"Video-Editor Alpha","node.title.media_viewer":"Media Viewer","node.title.data_protection":"Datenschutz","node.title.pose_creator":"Pose Creator","node.help.text_input":"Ein einfaches mehrzeiliges Textfeld zur Eingabe von Prompts oder Notizen.","node.help.image_input":"Ermglicht das Hochladen oder Einfgen eines Bildes zur Verwendung als Eingabe fr andere Knoten.","node.help.prompt_processor":"Kombiniert mehrere Texteingaben zu einem einzigen, verbesserten Prompt mithilfe von KI.","node.help.prompt_sanitizer":"Schreibt den Eingabe-Prompt um, damit er sicherer fr Bildgenerierungsrichtlinien ist.","node.help.video_prompt_processor":"Spezialisierter Prozessor zum Erstellen detaillierter Videogenerierungs-Prompts.","node.help.image_output":"Zeigt das Ergebnis der Bildgenerierung an. Untersttzt das Herunterladen und Anzeigen.","node.help.video_output":"Zeigt das Ergebnis der Videogenerierung mit dem Veo-Modell an.","node.help.prompt_analyzer":"Zerlegt einen Prompt in Komponenten wie Subjekt, Stil und Umgebung.","node.help.character_analyzer":"Analysiert eine Charakterbeschreibung und teilt sie in Aussehen und Kleidung auf.","node.help.character_generator":"Generiert detaillierte Charakterbeschreibungen basierend auf einem kurzen Prompt.","node.help.character_card":"Speichert umfassende Charakterdaten einschlielich Bild und Beschreibung.","node.help.image_analyzer":"Verwendet KI, um den Inhalt eines Eingabebildes zu beschreiben.","node.help.image_editor":"Erweitertes Tool zum Bearbeiten von Bildern mit Text-Prompts und Inpainting/Outpainting.","node.help.image_sequence_generator":"Generiert eine Bildsequenz basierend auf einer Liste von Prompts.","node.help.prompt_sequence_editor":"Ermglicht die Massenbearbeitung von Prompt-Sequenzen mithilfe von KI-Anweisungen.","node.help.gemini_chat":"Eine universelle Chat-Schnittstelle mit Gemini fr Brainstorming oder Untersttzung.","node.help.translator":"bersetzt Text zwischen Sprachen mithilfe von KI-Modellen.","node.help.script_generator":"Generiert ein strukturiertes Skript (Szenen, Charaktere) aus einer Story-Idee.","node.help.script_viewer":"Visualisiert und verwaltet Skriptdaten fr die bildweise Generierung.","node.help.note":"Eine Haftnotiz zum Hinzufgen von Kommentaren oder Anweisungen auf der Leinwand.","node.help.reroute_dot":"Ein kleiner Punkt, um Verbindungen zu organisieren und sauberere Layouts zu erstellen.","node.help.data_reader":"Debug-Tool zum berprfen der Rohdaten, die durch Verbindungen flieen.","node.help.video_editor":"Ein zeitleistenbasiertes Tool zum Bearbeiten von Videoclips und Bildern.","node.help.media_viewer":"Ein Player zum Anzeigen von Video- und Audiodateien mit Wiedergabesteuerung.","node.help.data_protection":"Ein interaktives Tower-Defense-Spiel-Knoten. Verteidigen Sie Ihre Daten.","node.help.pose_creator":"Visual rig to define and generate character poses for consistency.","node.action.expand":"Erweitern","node.action.collapse":"Einklappen","node.action.help":"Hilfe","node.action.download":"Herunterladen","node.action.clear":"Inhalt lschen","node.action.refreshChat":"Chat leeren und neu starten","node.action.paste":"Einfgen","node.action.resetEditor":"Editor zurcksetzen","node.action.saveCharacter":"Karte speichern","node.action.loadCharacter":"Karte laden","node.action.copy":"Kopieren","node.action.copyImage":"Bild kopieren","node.action.copyTextPrompt":"Prompt kopieren","node.action.copyImagePrompt":"Bild-Prompt kopieren","node.action.copyVideoPrompt":"Video-Prompt kopieren","node.action.cutConnections":"Verbindungen trennen","node.action.close":"Schlieen","node.action.closeNode":"Knoten schlieen (Umschalt+Klick fr sofort)","node.action.closeNodeSimple":"Knoten schlieen","node.action.randomWord":"Zuflliges Wort","node.action.processImage":"Wasserzeichen entfernen","node.action.processImageTitle":"Verwendet Gemini, um Wasserzeichen und Text aus dem Bild zu entfernen.","node.action.editor":"Editor","node.action.rasterEditor":"Raster-Editor","node.action.openInAIEditor":"In KI-Editor ffnen","node.action.openInAnalyzer":"In Analysator ffnen","node.action.outputToInput":"Ausgabe als Eingabe","node.action.processChainForward":"Vorwrts verarbeiten","node.action.executeChain":"Kette ausfhren","node.action.executeChainTitle":"Fhrt alle vorgelagerten Knoten aus, um das Endergebnis zu generieren.","node.action.sanitize":"Bereinigen","node.action.rename":"Umbenennen","node.action.stop":"Stopp","node.action.stopping":"Stoppen...","node.action.deleteItem":"Element lschen","node.action.detachAndPaste":"Lsen und Einfgen","node.action.delete":"Lschen","node.action.flipImage":"Bild spiegeln","node.action.pin":"Knoten anpinnen","node.action.unpin":"Knoten lsen","node.mediaViewer.play":"Abspielen","node.mediaViewer.pause":"Pause","node.mediaViewer.stop":"Stopp","node.mediaViewer.addMarker":"Marker hinzufgen","node.mediaViewer.exportSRT":"Marker exportieren (SRT)","node.mediaViewer.deleteAllMarkers":"Alle Marker lschen","node.mediaViewer.saveMarkers":"Marker speichern","node.mediaViewer.loadMarkers":"Marker laden","node.mediaViewer.relink":"Datei neu verknpfen","node.content.notePlaceholder":"Schreiben Sie Ihre Notizen hier...","node.content.dropImage":"Bild hier ablegen oder klicken zum Hochladen","node.content.dropMedia":"Video oder Audio hier ablegen","node.content.processing":"Verarbeitung...","node.content.processingChain":"Kette wird verarbeitet...","node.content.metadataPrompt":"Prompt aus Bildmetadaten:","node.content.metadataPromptPlaceholder":"Kein Prompt im Bild gefunden.","node.content.copyPrompt":"Verwenden","node.content.prompt":"Prompt","node.content.inputPrompt":"Eingabe-Prompt","node.content.enhancedResult":"Verbessertes Ergebnis","node.content.videoPrompt":"Video-Prompt","node.content.editPromptPlaceholder":"Fgen Sie dem Prompt hinzu oder bearbeiten Sie ihn...","node.content.enhancedPromptHere":"Verbesserter Prompt erscheint hier...","node.content.safePrompt":"Sicher fr kommerzielle Nutzung","node.content.generating":"Generierung...","node.content.imageHere":"Bild erscheint hier","node.content.generationMode":"Generierungsmodell","node.content.aspectRatio":"Seitenverhltnis","node.content.aspectRatioHelp":"Seitenverhltnis fr die Bildgenerierung festlegen","node.content.aspectRatioNotSupportedFast":"Seitenverhltnis nur fr Imagen-Modelle verfgbar.","node.content.enableAspectRatioFormatting":"Seitenverhltnis-Formatierung aktivieren","node.content.autoDownload":"Autom. Download","node.content.generateImage":"Bild generieren","node.content.enhancing":"Verbesserung...","node.content.enhancePrompt":"Prompt verbessern","node.content.sanitizing":"Bereinigung...","node.content.sanitizedPromptHere":"Bereinigter Prompt erscheint hier...","node.content.analyzing":"Analyse...","node.content.analyzePrompt":"Prompt analysieren","node.content.analyzeImage":"Bild analysieren","node.content.imageToText":"Bild zu Text","node.content.updatePromptFromImage":"Prompt aus Bild aktualisieren","node.content.analyzeCharacter":"Charakter analysieren","node.content.generateCharacters":"Charaktere generieren","node.content.characterPromptPlaceholder":"Beschreiben Sie den/die Charakter(e)...","node.content.character":"Charakter","node.content.clothing":"Kleidung","node.content.characterPlaceholder":"Charakterbeschreibung erscheint hier...","node.content.clothingPlaceholder":"Kleidungsbeschreibung erscheint hier...","node.content.appearance":"Aussehen","node.content.personality":"Persnlichkeit","node.content.environment":"Umgebung/Setting","node.content.action":"Handlung","node.content.emotion":"Emotion","node.content.style":"Stil","node.content.environmentPlaceholder":"Detaillierte Beschreibung der Umgebung...","node.content.charactersPlaceholder":"Liste der Hauptcharaktere...","node.content.characters":"Charaktere","node.content.characterConcepts":"Charakterkonzepte","node.content.actionPlaceholder":"Beschreibung der Handlung...","node.content.emotionPlaceholder":"Beschreibung der Emotion...","node.content.stylePlaceholder":"Beschreibung des Kunststils...","node.content.descriptionHere":"Beschreibung erscheint hier...","node.content.enableOutpainting":"Outpainting aktivieren","node.content.outpaintingPromptPlaceholder":"Outpainting-Prompt...","node.content.inputImage":"Eingabebilder","node.content.dropOrClick":"Ablegen oder Klicken","node.content.outputImage":"Ausgabebild","node.content.applyEdit":"Bearbeitung anwenden","node.content.editing":"Bearbeitung...","node.content.chatPlaceholder":"Geben Sie Ihre Nachricht ein...","node.content.connectedPlaceholder":"Mit Knoten verbunden, in Quelle bearbeiten.","node.content.connectedNode":"ber Knoten verbunden","node.content.connectedEmpty":"Verbundener Knoten hat kein Bild.","node.content.translatePlaceholder":"Text zum bersetzen...","node.content.translatedTextPlaceholder":"bersetzter Text...","node.content.targetLanguage":"Zielsprache","node.content.translate":"bersetzen","node.content.translating":"bersetzung...","node.content.scriptPromptPlaceholder":"Geben Sie eine Story-Idee oder einen Plot ein...","node.content.generateScript":"Skript generieren","node.content.loadScript":"Skriptdatei laden","node.content.summary":"Zusammenfassung","node.content.scenes":"Szenen","node.content.unrecognizedFormat":"Nicht erkanntes Skriptformat.","node.content.frames":"Frames","node.content.characterIndex":"Index","node.content.readData":"Daten lesen","node.content.textDataHere":"Textdaten erscheinen hier.","node.content.noDataRead":'Verbinden Sie einen Knoten und klicken Sie auf "Daten lesen".',"node.content.previewError":"Vorschaufehler","node.content.previewPlaceholder":"Vorschau erscheint hier","node.content.imagePrompt":"Bild-Prompt","node.output.allPromptData":"Alle Prompt-Daten","node.note.tab.note":"Notiz","node.note.tab.references":"Referenzen","node.note.nestedImages":"Verschachtelte Bilder","node.note.dropPlaceholder":"Bilder ablegen oder klicken","node.note.addCaption":"Bildunterschrift","node.note.action.shuffle":"Mischen","node.note.action.undoShuffle":"Mischen rckgngig machen","node.content.characterTypeShort":"Typ:","node.content.numberOfCharactersShort":"Menge:","node.content.characterType.simple":"Einfach","node.content.characterType.anthro":"Anthro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Schlsselobjekt","node.content.style.simple":"Einfach","node.content.style.realistic":"Realistisch","node.content.style.3d_cartoon":"3D Cartoon","node.content.style.3d_realistic":"3D Realistisch","node.content.style.2d_animation":"2D Animation","node.content.style.anime":"Anime","node.content.style.comics":"Comics","node.content.style.custom":"Benutzerdefiniert","node.content.fullDescriptionTitle":"Detaillierte Charakterbeschreibung","node.content.integrationInstruction":"Integrationsanweisung","node.content.additionalPromptSuffix":"Zustzlicher Prompt (Suffix)","search.node.text_input.title":"Texteingabe","search.node.text_input.description":"Ein einfaches mehrzeiliges Textfeld.","search.node.image_input.title":"Bildeingabe","search.node.image_input.description":"Laden Sie ein Bild hoch oder fgen Sie es ein.","search.node.prompt_sequence_editor.title":"Prompt-Sequenz-Editor","search.node.prompt_sequence_editor.description":"Bearbeitet eine Liste von Prompts mit einer einzigen Anweisung.","search.node.data_reader.title":"Datenleser","search.node.data_reader.description":"Liest und zeigt die Rohausgabe eines verbundenen Knotens an.","search.node.note.title":"Notiz","search.node.note.description":"Eine Haftnotiz fr Kommentare.","search.node.prompt_processor.title":"Prompt-Prozessor","search.node.prompt_processor.description":"Kombiniert Eingaben zu einem verbesserten Prompt.","search.node.prompt_analyzer.title":"Prompt-Analysator","search.node.prompt_analyzer.description":"Zerlegt einen Prompt in Komponenten.","search.node.prompt_sanitizer.title":"Prompt-Bereiniger","search.node.prompt_sanitizer.description":"Schreibt den Prompt um, um ihn sicherer fr KI-Modelle zu machen.","search.node.character_card.title":"Charakterkarte","search.node.character_card.description":"Speichert detaillierte Informationen ber einen Charakter.","search.node.character_analyzer.title":"Charakter-Analysator","search.node.character_analyzer.description":"Teilt eine Beschreibung in Aussehen und Kleidung auf.","search.node.character_generator.title":"Charakter-Generator","search.node.character_generator.description":"Generiert detaillierte Charakterbeschreibungen basierend auf einem Prompt.","search.node.image_analyzer.title":"Bildanalysator","search.node.image_analyzer.description":"Beschreibt ein Bild mithilfe von KI.","search.node.image_editor.title":"KI-Bildeditor","search.node.image_editor.description":"Bearbeitet oder kombiniert Bilder mit einem Prompt.","search.node.image_sequence_generator.title":"Bildsequenz-Generator","search.node.image_sequence_generator.description":"Generiert eine Bildsequenz basierend auf einer Liste von Prompts.","search.node.gemini_chat.title":"Gemini Chat","search.node.gemini_chat.description":"Eine Konversationsschnittstelle zum Chatten mit Gemini.","search.node.translator.title":"bersetzer","search.node.translator.description":"bersetzt Text zwischen Sprachen mithilfe von KI.","search.node.script_generator.title":"Skript-Generator","search.node.script_generator.description":"Generiert ein strukturiertes Skript aus einer Story-Idee.","search.node.script_viewer.title":"Skript-Viewer","search.node.script_viewer.description":"Visualisiert und verwaltet Skriptdaten.","search.node.note":"Ein einfaches Textfeld fr Notizen.","search.node.reroute_dot":"Ein kleiner Punkt zum Organisieren von Verbindungen.","search.node.video_prompt_processor.title":"Video-Prompt-Prozessor","search.node.video_prompt_processor.description":"Erstellt detaillierte Prompts fr die Videogenerierung.","search.node.video_output.title":"Videoausgabe","search.node.video_output.description":"Generiert ein Video mit dem Veo-Modell.","search.node.image_output.title":"Bildausgabe","search.node.image_output.description":"Zeigt generierte Bilder an und ermglicht den Download.","search.node.media_viewer.title":"Media Viewer","search.node.media_viewer.description":"Player zum Anzeigen von Video- und Audiodateien.","search.node.data_protection.title":"Datenschutz","search.node.data_protection.description":"Verteidigen Sie Ihren Datenstrom in diesem Minispiel.","search.node.pose_creator.title":"Pose Creator","search.node.pose_creator.description":"Visually rig and create character poses for generation guidance.","prompt_sequence_editor.instructionPlaceholder":"Geben Sie eine Anweisung zum ndern der Prompts ein...","prompt_sequence_editor.modifying":"nderung luft...","prompt_sequence_editor.modifySelected":"Ausgewhlte ndern ({count})","prompt_sequence_editor.sourcePrompts":"Quell-Prompts","prompt_sequence_editor.finalPrompts":"Genderte Prompts","prompt_sequence_editor.error.invalidInput":"Ungltiges Format.","geminiChat.mode.general":"Allgemein","geminiChat.mode.prompt":"Prompt-Experte","geminiChat.mode.script":"Drehbuchautor","geminiChat.mode.youtube":"YouTube-Analyst","image_sequence.deselect_scene":"Alle Frames in dieser Szene abwhlen","image_sequence.clear_prompts_only":"Nur Text-Prompts lschen","image_sequence.prev_scene":"Vorherige Szene","image_sequence.next_scene":"Nchste Szene","image_sequence.frames_hidden":"({count} Frames ausgeblendet)","image_sequence.frames_count":"({count} Frames)","node.content.modificationRequest":"nderungsanfrage","node.content.technicalPrompt":"Technischer Prompt","node.promptProcessor.safePromptTooltip":"Schreibt den Prompt um, um die Sicherheitsrichtlinien einzuhalten und Richtlinienverste zu vermeiden.","node.promptProcessor.technicalPromptTooltip":"Wandelt den Prompt in eine hochdetaillierte technische Spezifikation um (Beleuchtung, Kamera, Rendereinstellungen).","node.promptProcessor.enhanceTooltip":"Nutzt KI, um den Prompt mit beschreibenden Details zu erweitern und anzureichern.","node.promptProcessor.chainTooltip":"Fhrt diesen Knoten aus und lst alle verbundenen nachgelagerten Knoten aus.","image_sequence.tooltip.autoCrop":"Schneidet generierte Bilder automatisch auf ein Seitenverhltnis von 16:9 zu.","image_sequence.tooltip.autoDownload":"Speichert jedes Bild sofort nach der Generierung automatisch auf Ihrem Gert.","image_sequence.tooltip.createZip":"Packt alle ausgewhlten Bilder beim Herunterladen in ein einziges ZIP-Archiv."},ab={"imageEditor.title":"Bildeditor","imageEditor.canvasResolution":"Leinwandauflsung","imageEditor.background":"Hintergrund","imageEditor.toolSettings":"Werkzeugeinstellungen","imageEditor.snapToEdges":"An Rndern ausrichten","imageEditor.freeAspect":"Freies Seitenverhltnis","imageEditor.section.aiRequest":"KI-nderungsanfrage","imageEditor.input.modificationPlaceholder":'Beschreiben Sie nderungen, z.B. "Hintergrund blau machen"',"imageEditor.action.sendRequest":"Anfrage senden","imageEditor.tooltip.removeObject":"Entfernen (Rot) / Behalten (Grn)","imageEditor.action.removeObject":"Objekt entfernen","imageEditor.tool.transform":"Transformieren","imageEditor.tool.hand":"Hand (Schwenken)","imageEditor.tool.zoom":"Zoom","imageEditor.tool.pencil":"Stift","imageEditor.tool.rectangle":"Rechteck","imageEditor.action.fit":"An Leinwand anpassen","imageEditor.action.fill":"Leinwand fllen","imageEditor.action.cancel":"Abbrechen","imageEditor.action.resetEdits":"nderungen zurcksetzen","imageEditor.action.apply":"Anwenden","imageViewer.title":"Bildbetrachter","imageEditor.outputResolution":"Ausgabeauflsung","imageEditor.outputResolutionHelp":'Ausgabeauflsung festlegen. Bei "Auto" wird die Leinwandauflsung verwendet.',"imageEditor.currentSize":"Aktuelle Gre: {width}x{height}","imageEditor.sequenceMode":"Sequenzmodus","imageEditor.sequenceModeHelp":"Eingabebilder von Eingang A sequenziell verarbeiten.","imageEditor.sequentialCombination":"Sequenzielle Bildkombination","imageEditor.sequentialCombinationHelp":"Fr jeden Frame: Sendet aktuelles Bild A + Alle Bilder B.","imageEditor.sequentialPrompt":"Sequenzielle Prompt-Kombination","imageEditor.sequentialPromptHelp":"Fr jeden Frame: Verwendet einen eindeutigen Prompt aus der Liste + aktuelles Bild.","imageEditor.sequentialEditingWithPrompts":"Sequenzielle Bearbeitung mit Prompts","imageEditor.sequentialEditingWithPromptsHelp":"Fr jeden Frame: Verwendet Bild B + eindeutigen Prompt. Eingang A wird ignoriert.","imageEditor.input":"Eingang","imageEditor.inputA":"Eingang A","imageEditor.inputB":"Eingang B","imageEditor.status.queued":"In Warteschlange","imageEditor.status.generating":"Generierung...","imageEditor.action.regenerate":"Neu generieren","imageEditor.tooltip.fit":"Bild in Leinwand einpassen (contain).","imageEditor.tooltip.fill":"Bild skalieren, um Leinwand zu fllen (cover).","imageEditor.tooltip.flip":"Bild horizontal spiegeln.","imageEditor.background.white":"Wei","imageEditor.background.gray":"Grau","imageEditor.background.black":"Schwarz","imageEditor.background.dark":"Dunkel","image_sequence.regenerate":"Neu generieren","image_sequence.stop_queue":"Warteschlange stoppen","image_sequence.move_up":"Nach oben","image_sequence.move_down":"Nach unten","image_sequence.copy_prompt":"Prompt kopieren","image_sequence.add_frame":"Frame hinzufgen","image_sequence.delete_frame":"Frame lschen","image_sequence.expand_all_frames":"Alle Frames erweitern/einklappen","image_sequence.collapse_all_frames":"Alle Frames einklappen","image_sequence.expand_all_scenes":"Alle Szenen erweitern/einklappen","image_sequence.collapse_all_scenes":"Alle Szenen einklappen","image_sequence.expand_all":"Alles erweitern","image_sequence.collapse_all":"Alles einklappen","image_sequence.clear_all_prompts":"Alle Prompts lschen","image_sequence.add_first_frame":"Ersten Frame hinzufgen","image_sequence.drop_or_add_title":"Sequenz-JSON ablegen oder Frame hinzufgen","image_sequence.drop_or_add_desc":"Legen Sie hier eine JSON-Datei ab oder klicken Sie auf die Schaltflche, um manuell einen Frame hinzuzufgen.","image_sequence.load_prompts":"Prompts laden","image_sequence.output_images_title":"Ausgabebilder","image_sequence.prompts_list_title":"Quell-Prompts","image_sequence.download_selected":"Auswahl herunterladen","image_sequence.select_all":"Alle auswhlen","image_sequence.select_none":"Keine auswhlen","image_sequence.invert_selection":"Auswahl umkehren","image_sequence.run_selected":"Auswahl ausfhren","image_sequence.start_queue":"Warteschlange starten","image_sequence.character_prompt_combination":"Charakter-Prompt-Kombination","image_sequence.combination_none":"Keine","image_sequence.combination_combine":"Kombinieren","image_sequence.combination_replace":"Tags ersetzen","image_sequence.status.error":"Fehler","image_sequence.status.pending":"In Warteschlange","image_sequence.clear_selected_prompts":"Ausgewhlte Prompts lschen","image_sequence.range_from":"Von:","image_sequence.range_to":"Bis:","image_sequence.stats.total":"Gesamt Frames: {count}","image_sequence.stats.generated":"Generiert: {count}","image_sequence.stats.queue":"Warteschlange: {count}","image_sequence.edit_in_source":"In Quelle bearbeiten","image_sequence.edit_prompt":"Prompt bearbeiten","image_sequence.select_scene":"Szene auswhlen","image_sequence.next_scene":"Nchste Szene","image_sequence.prev_scene":"Vorherige Szene","image_sequence.scene_input_label":"Szene","image_sequence.select_square":"Quadratisch (1:1) auswhlen","image_sequence.select_landscape":"Landschaft (16:9) auswhlen","image_sequence.select_portrait":"Portrt (9:16) auswhlen","image_sequence.select_range":"Bereich auswhlen","image_sequence.force_refresh":"Aktualisierung erzwingen","image_sequence.select_scene_frames":"Alle Frames in dieser Szene auswhlen","image_sequence.collapse_other_scenes":"Andere Szenen einklappen","prompt_sequence_editor.instructionPlaceholder":"Anweisung eingeben...","prompt_sequence_editor.modifying":"nderung luft...","prompt_sequence_editor.modifySelected":"Auswahl ndern ({count})","prompt_sequence_editor.sourcePrompts":"Quell-Prompts","prompt_sequence_editor.finalPrompts":"Genderte Prompts","prompt_sequence_editor.error.invalidInput":"Ungltiges Format.","geminiChat.mode.general":"Allgemein","geminiChat.mode.prompt":"Prompt-Experte","geminiChat.mode.script":"Drehbuchautor","geminiChat.mode.youtube":"YouTube-Analyst","image_sequence.shot_type.WS":"Integrieren Sie die Entitt mit einer Totalen (WS) in die Szene und Handlung. Zeigen Sie die Umgebung.","image_sequence.shot_type.MS":"Integrieren Sie die Entitt mit einer Halbnahaufnahme (MS) in die Szene. Charakter ab der Taille aufwrts.","image_sequence.shot_type.CU":"Integrieren Sie die Entitt mit einer Nahaufnahme (CU) in die Szene.","image_sequence.shot_type.ECU":"Integrieren Sie die Entitt mit einer extremen Nahaufnahme (ECU) in die Szene. Maximale Details.","image_sequence.shot_type.LS":"Integrieren Sie die Entitt mit einer Weitwinkeleinstellung (LS) in die Szene, um den Mastab zu zeigen."},ib={"dialog.permission.title":"Berechtigung erforderlich","dialog.permission.description":"Diese App bentigt Zugriff auf Ihre Zwischenablage, um Inhalte in Knoten einzufgen. Ihre Daten werden weder gespeichert noch gesendet.","dialog.permission.allow":"Erlauben","dialog.permission.decline":"Ablehnen","dialog.rename.title":"Element umbenennen","dialog.rename.group.title":"Gruppe umbenennen","dialog.rename.catalog.title":"Katalogelement umbenennen","dialog.rename.node.title":"Knoten umbenennen","dialog.rename.label":"Neuer Name:","dialog.rename.confirm":"Umbenennen","dialog.rename.cancel":"Abbrechen","dialog.promptEdit.title":"Prompt bearbeiten","dialog.promptEdit.nameLabel":"Name:","dialog.promptEdit.contentLabel":"Inhalt:","dialog.promptEdit.confirm":"Speichern","dialog.promptEdit.cancel":"Abbrechen","dialog.confirmDelete.title":"Lschen besttigen","dialog.confirmDelete.message":"Sind Sie sicher, dass Sie dieses Element lschen mchten? Dies kann nicht rckgngig gemacht werden.","dialog.confirmDelete.confirm":"Lschen","dialog.confirmDelete.cancel":"Abbrechen","dialog.confirmCloseTab.title":"Tab schlieen","dialog.confirmCloseTab.message":'Mchten Sie den Tab "{tabName}" wirklich schlieen? Nicht gespeicherte nderungen gehen verloren.',"dialog.confirmClear.title":"Leinwand leeren","dialog.confirmClear.message":"Mchten Sie wirklich alles lschen? Dies kann nicht rckgngig gemacht werden.","dialog.confirmReset.title":"Zurcksetzen","dialog.confirmReset.message":"Mchten Sie die Leinwand auf den Standardzustand zurcksetzen? Alle aktuellen Arbeiten gehen verloren.","dialog.confirmReset.confirm":"Zurcksetzen","dialog.confirmLoad.title":"Laden besttigen","dialog.confirmLoad.message":"Das Laden einer neuen Datei ersetzt den aktuellen Inhalt. Nicht gespeicherte nderungen gehen verloren. Fortfahren?","dialog.apiKey.title":"API-Schlssel whlen","dialog.apiKey.description":'Diese Funktion erfordert einen Projekt-API-Schlssel mit aktivierter "AI Platform"-API. Die Videogenerierung kann einige Minuten dauern.',"dialog.apiKey.billingLink":"Mehr ber Abrechnung erfahren","dialog.apiKey.button":"API-Schlssel whlen","dialog.settings.title":"Einstellungen","dialog.settings.apiKeyLabel":"Ihr Google Gemini API-Schlssel:","dialog.settings.useDevKeyLabel":"Kostenlosen Schlssel verwenden (Entwicklung)","dialog.settings.instantNodeCloseLabel":"Sofortiges Schlieen von Knoten","dialog.settings.nodeAnimationLabel":"Knoten-Hinzufge-Animation","dialog.settings.animationModeLabel":"Erstellungs-Animationsmodus","dialog.settings.anim.pulse":"Pulsieren","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"Keine","dialog.settings.description":"Um Ihre eigenen Quoten zu nutzen und auf bestimmte Modelle zuzugreifen, geben Sie Ihren persnlichen API-Schlssel ein. Er wird lokal gespeichert.","dialog.settings.getKeyLink":"Hier API-Schlssel erhalten","dialog.settings.save":"Speichern","dialog.deleteNode.title":"Knoten schlieen?","dialog.deleteNode.titlePlural":"Knoten schlieen?","dialog.deleteNode.confirm":"Ja","dialog.deleteNode.cancel":"Nein","dialog.deleteNode.confirmTooltip":"Knoten schlieen - verlorene Daten knnen nicht wiederhergestellt werden","dialog.deleteNode.cancelTooltip":"Nicht schlieen - weiterarbeiten","dialog.deleteNode.dontShowAgain":"Nicht mehr anzeigen","dialog.exitApp.title":"Projekt schlieen?","dialog.exitApp.message":"Mchten Sie das Projekt wirklich schlieen? Alle aktuellen Arbeiten gehen verloren und die Leinwand wird zurckgesetzt."},sb={"group.button.create":"Gruppe erstellen ({count})","group.rename":"Gruppe umbenennen","group.saveToCatalog":"Im Katalog speichern","group.saveToDisk":"Auf Festplatte speichern","group.ungroup":"Gruppierung aufheben (Umschalt+Klick zum Lschen inkl. Inhalt)","group.duplicate":"Mit Inhalt duplizieren","catalog.tabs.groups":"Gruppen","catalog.tabs.library":"Bibliothek","catalog.tabs.characters":"Charaktere","catalog.tabs.scripts":"Skripte","catalog.tabs.sequences":"Sequenzen","catalog.back":"Zurck","catalog.load":"Aus Datei laden","catalog.newFolder":"Neuer Ordner","catalog.saveTo":"Im Katalog speichern","catalog.card.addToCanvas":"Zur Leinwand hinzufgen","catalog.card.rename":"Umbenennen","catalog.card.save":"Speichern","catalog.card.delete":"Lschen","catalog.empty.description":"Dieser Ordner ist leer. Sie knnen Elemente hinzufgen oder Ordner erstellen.","library.loadFromFile":"Laden","library.actions.newFolder":"Neuer Ordner","library.actions.newPrompt":"Neuer Prompt","library.actions.copy":"Kopieren","library.actions.edit":"Bearbeiten","library.empty.title":"Leerer Ordner","library.empty.description":"Erstellen Sie Prompts und Ordner, um zu beginnen.","library.emptyPrompt":"Leerer Prompt"},lb={...nb,...ob,...rb,...ab,...ib,...sb},cb={"app.title":"Modificatore di Prompt","app.subtitle":"Connetti idee per creare un capolavoro","app.error.title":"Notifica","app.error.copy":"Copia Messaggio","app.error.copied":"Copiato!","error.apiKey":"La tua chiave API non  valida o mancano i permessi. Seleziona una chiave API valida.","error.scriptModifierCanvas":"Questa tela appartiene a un'altra applicazione - Script Modifier. Utilizza Script Modifier per aprire questo file.","welcome.title":"Benvenuto in","welcome.description":"Benvenuto in Prompt Modifier. Connetti idee per creare capolavori. Usa i nodi per generare e modificare contenuti.","welcome.apiKeyLabel":"La tua Chiave API Google Gemini","welcome.apiKeyPlaceholder":"Inserisci la tua chiave API qui...","welcome.apiKeyHelp":"La tua chiave API  salvata localmente.","welcome.getKeyLink":"Ottieni Chiave API","welcome.iAmDeveloper":"Sono uno Sviluppatore","welcome.letsGo":"Andiamo","welcome.resume":"Riprendi","welcome.startNew":"Nuova Tela","welcome.freeModeActive":"Modalit Gratuita Attiva","welcome.selectLanguage":"Seleziona la tua lingua principale","welcome.navHint":"Usa i tasti della tastiera  e  per cambiare lingua","toast.contentCleared":"Contenuto cancellato","toast.downloadStarted":"Download avviato","toast.characterLoaded":"Scheda personaggio caricata","toast.characterSavedDisk":"Scheda personaggio salvata su disco","toast.copiedToClipboard":"Copiato negli appunti","toast.pastedFromClipboard":"Incollato dagli appunti","toast.pasteFailed":"Incollaggio fallito","toast.nodeDuplicated":"Nodo duplicato","toast.groupSavedToDisk":'Gruppo "{groupTitle}" salvato su disco',"toast.groupDeleted":"Gruppo e contenuti eliminati","toast.characterSavedCatalog":"Personaggio salvato nel catalogo","toast.promptSaved":"Prompt salvato nella libreria: {promptName}...","toast.connectionsCut":"Connessioni rimosse","toast.apiKeySaved":"Chiave API salvata con successo","toast.cacheCleared":"{count} elementi inutilizzati rimossi dalla cache","toast.cacheEmpty":"Cache gi ottimizzata","toast.scriptSaved":"Sceneggiatura salvata su disco","alert.groupSaved":'Gruppo "{groupTitle}" salvato nel catalogo.',"alert.loadCatalogFailed":"Impossibile caricare il file del catalogo","alert.invalidCatalogFile":"Formato file catalogo non valido","alert.fileNotSupported":'File non supportato. "appName" mancante o errato.',"alert.invalidCatalogStructure":'Struttura catalogo non valida. "root" mancante.',"tutorial.step1":"Clicca qui per aggiungere una parola casuale al prompt.","tutorial.step2":`Clicca su "Migliora Prompt" per combinare gli input usando l'IA.`,"tutorial.step2_waiting":"L'IA sta analizzando i tuoi input e generando un prompt pi ricco...","tutorial.step3":"Infine, clicca qui per generare l'immagine.","tutorial.step3b":"La generazione richiede del tempo. Puoi monitorare i progressi qui.","tutorial.step4":"Puoi aggiungere nuovi nodi manualmente da questa barra degli strumenti.","tutorial.group.catalog":"Usa il Catalogo per cercare nodi o gestire gruppi.","tutorial.group.general":"Aggiungi Note Adesive e Lettori di Dati per il debug.","tutorial.group.input":"Input di base per testo, immagini e sequenze.","tutorial.group.processing":"Analizza ed elabora prompt o immagini con l'IA.","tutorial.group.character":"Crea, analizza e memorizza personaggi dettagliati.","tutorial.group.output":"Visualizza i risultati e genera sequenze.","tutorial.group.ai":"Chatta con Gemini e traduci testi.","tutorial.group.video":"Strumenti per prompt video e montaggio.","tutorial.group.scripts":"Genera e visualizza sceneggiature per storie complesse.","tutorial.group.file":"Salva il tuo lavoro, carica progetti o scarica la tela.","tutorial.success.title":"Tutorial Completato!","tutorial.success.message":"Hai imparato con successo le basi di Prompt Modifier. Buona fortuna nella creazione di capolavori!","tutorial.success.button":"Inizia a Creare","tutorial.skip":"Salta","tutorial.next":"Avanti","tutorial.finish":"Capito"},db={"toolbar.settings":"Impostazioni","toolbar.resetCanvas":"Resetta Tela","toolbar.clearCache":"Svuota Cache Inutilizzata","toolbar.home":"Home","toolbar.edit":"Modifica (V)","toolbar.cutter":"Taglia Connessione (C) / (Tieni premuto Ctrl)","toolbar.selection":"Selezione (S) / (Tieni premuto Shift)","toolbar.reroute":"Reindirizza (R) / (Tieni premuto Ctrl+Alt)","toolbar.zoom":"Zoom (Tieni premuto Z)","toolbar.snapToGrid":"Aggancia alla Griglia","toolbar.smartGuides":"Guide Intelligenti","toolbar.lineStyleSpaghetti":"Linee Spaghetti","toolbar.lineStyleOrthogonal":"Linee Ortogonali","toolbar.resetZoom":"Resetta Zoom","toolbar.resetCamera":"Resetta Posizione Camera","toolbar.clearCanvas":"Pulisci Tela","toolbar.addNode":"Aggiungi Nodo (F)","toolbar.catalog":"Apri Catalogo (Ctrl + Spazio)","toolbar.addNote":"Aggiungi Nota (N)","toolbar.addDataReader":"Aggiungi Lettore Dati (Shift + R)","toolbar.addTextInput":"Aggiungi Input Testo (T)","toolbar.addImageInput":"Aggiungi Input Immagine (I)","toolbar.addPromptSequenceEditor":"Aggiungi Editor Sequenza Prompt (Q)","toolbar.addImageAnalyzer":"Aggiungi Analizzatore Immagine (Shift+A)","toolbar.addPromptAnalyzer":"Aggiungi Analizzatore Prompt (A)","toolbar.addPromptProcessor":"Aggiungi Processore Prompt (P)","toolbar.addCharacterGenerator":"Aggiungi Generatore Personaggi (Shift+C)","toolbar.addCharacterAnalyzer":"Aggiungi Analizzatore Personaggi (Ctrl+Shift+A)","toolbar.addCharacterCard":"Aggiungi Scheda Personaggio (Ctrl+Shift+C)","toolbar.addImageOutput":"Aggiungi Output Immagine (O)","toolbar.addImageEditor":"Aggiungi Editor Immagini IA (Shift+I)","toolbar.addImageSequenceGenerator":"Aggiungi Generatore Sequenza Immagini (Shift+Q)","toolbar.addTranslator":"Aggiungi Traduttore (L)","toolbar.addGeminiChat":"Aggiungi Chat Gemini (M)","toolbar.addVideoPromptProcessor":"Aggiungi Processore Prompt Video (Shift+P)","toolbar.addVideoOutput":"Aggiungi Output Video (Shift+O)","toolbar.addScriptGenerator":"Aggiungi Generatore Sceneggiatura","toolbar.addScriptViewer":"Aggiungi Visualizzatore Sceneggiatura (Shift + V)","toolbar.saveCanvas":"Salva Tela (Ctrl + S)","toolbar.saveProject":"Salva Progetto","toolbar.loadCanvas":"Carica Progetto/Tela (Ctrl + O)","toolbar.group.general":"Generale","toolbar.group.catalog":"Catalogo","toolbar.group.input":"Input","toolbar.group.processing":"Elaborazione","toolbar.group.character":"Personaggio","toolbar.group.output":"Output","toolbar.group.aiTools":"Strumenti IA","toolbar.group.video":"Video","toolbar.group.scripts":"Sceneggiature","toolbar.group.file":"File","toolbar.title":"Barra degli Strumenti","toolbar.dock":"Ancora Barra","toolbar.detach":"Stacca Barra","toolbar.expandPanel":"Espandi Pannello","toolbar.collapsePanel":"Comprimi Pannello","toolbar.dockArea.title":"Ancora Barra Qui","toolbar.duplicate":"Duplica Nodo","toolbar.duplicateWithContent":"Duplica con Contenuto","toolbar.dock.q1":"Sinistra 1 Qrt","toolbar.dock.q2":"Sinistra 2 Qrt","toolbar.dock.q3":"Destra 3 Qrt","toolbar.dock.q4":"Destra 4 Qrt","toolbar.dock.tl":"Alto Sinistra","toolbar.dock.bl":"Basso Sinistra","toolbar.dock.tr":"Alto Destra","toolbar.dock.br":"Basso Destra","toolbar.dock.left":"Met Sinistra","toolbar.dock.right":"Met Destra","toolbar.dock.full":"Schermo Intero","toolbar.dock.exitFull":"Esci da Schermo Intero","toolbar.dock.fullFocus":"Focus Schermo Intero","hotkeys.show":"Mostra Scorciatoie","hotkeys.tools.title":"Strumenti","hotkeys.tools.edit":"Modalit Modifica","hotkeys.tools.cutter":"Strumento Taglierina","hotkeys.tools.selection":"Strumento Selezione","hotkeys.tools.reroute":"Strumento Reindirizzamento","hotkeys.tools.zoom":"Strumento Zoom","hotkeys.tools.toggleLineStyle":"Cambia Stile Linea","hotkeys.tools.group":"Selezione Gruppo","hotkeys.tools.closeNode":"Elimina Selezionati","hotkeys.tools.duplicate":"Duplica Nodo","hotkeys.tools.duplicateWithContent":"Duplica con Contenuto","hotkeys.tools.deleteGroup":"Elimina Gruppo (Shift+Click)","hotkeys.windows.title":"Finestre","hotkeys.windows.search":"Ricerca Rapida","hotkeys.windows.catalog":"Catalogo","hotkeys.createNode.title":"Crea Nodo","help.panelTitle":"Aiuto e Scorciatoie","help.title":"Scorciatoie da Tastiera","help.howToUse.title":"Come Usare","help.howToUse.content":"Benvenuto in Prompt Modifier! Usa la barra degli strumenti o le scorciatoie per aggiungere nodi. Connetti i nodi per passare i dati. Usa lo strumento Modifica per spostare i nodi e scorrere la tela. Doppio clic su uno spazio vuoto per aprire il menu di aggiunta rapida. Clic destro per il menu contestuale.","help.author":"Autore","contextMenu.undoPosition":"Annulla Posizione","contextMenu.redoPosition":"Ripeti Posizione","contextMenu.align.left":"Allinea a Sinistra (F)","contextMenu.align.centerX":"Allinea Centro X (E)","contextMenu.align.right":"Allinea a Destra (R)","contextMenu.align.top":"Allinea in Alto (T)","contextMenu.align.centerY":"Allinea Centro Y (D)","contextMenu.align.bottom":"Allinea in Basso (B)","contextMenu.distribute.horizontal":"Distribuisci Orizz. (Ctrl+D)","contextMenu.distribute.vertical":"Distribuisci Vert. (Ctrl+E)","contextMenu.emptySlot":"Slot Vuoto (Click destro per assegnare)","contextMenu.saveSlots":"Salva Config Slot","contextMenu.loadSlots":"Carica Config Slot","quickadd.title":"Aggiunta Rapida","quickadd.group.tools":"Strumenti","quickadd.group.inputs":"Input","quickadd.group.processing":"Elaborazione","quickadd.group.character":"Personaggio","quickadd.group.outputs":"Output","quickadd.group.ai":"Strumenti IA","quickadd.group.video":"Video","quickadd.group.scripts":"Sceneggiature","quickadd.group.general":"Generale","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"Modifica","quickadd.tool.cutter":"Taglierina","quickadd.tool.selection":"Selezione","search.placeholder":"Cerca un nodo da aggiungere...","search.noResults":"Nessun nodo trovato.","search.group.input":"Input & Base","search.group.process":"Elaborazione & Personaggio","search.group.output":"Immagine & Sequenza","search.group.ai":"Strumenti IA","search.group.video":"Video & Scrittura","search.group.scripts":"Sceneggiature","toolbar.exitApp":"Chiudi Progetto"},ub={"node.title.text_input":"Input Testo","node.title.image_input":"Input Immagine","node.title.prompt_processor":"Processore Prompt","node.title.prompt_sanitizer":"Sanitizzatore Prompt","node.title.video_prompt_processor":"Proc. Prompt Video","node.title.image_output":"Output Immagine","node.title.video_output":"Output Video","node.title.prompt_analyzer":"Analizzatore Prompt","node.title.character_analyzer":"Analizzatore Personaggio","node.title.character_generator":"Generatore Personaggio","node.title.character_card":"Scheda Personaggio","node.title.image_analyzer":"Analizzatore Immagine","node.title.image_editor":"Editor Immagini IA","node.title.image_sequence_generator":"Generatore Sequenza Immagini","node.title.prompt_sequence_editor":"Editor Sequenza Prompt","node.title.gemini_chat":"Chat Gemini","node.title.translator":"Traduttore","node.title.script_generator":"Generatore Sceneggiatura","node.title.script_viewer":"Visualizzatore Sceneggiatura","node.title.note":"Nota","node.title.reroute_dot":"Punto Reindirizzamento","node.title.data_reader":"Lettore Dati","node.title.video_editor":"Video Editor Alpha","node.title.media_viewer":"Visualizzatore Media","node.title.data_protection":"Protezione Dati","node.title.pose_creator":"Pose Creator","node.help.text_input":"Un semplice campo di testo multilinea per inserire prompt o note.","node.help.image_input":"Consente di caricare o incollare un'immagine da usare come input per altri nodi.","node.help.prompt_processor":"Combina pi input di testo in un singolo prompt migliorato usando l'IA.","node.help.prompt_sanitizer":"Riscrive il prompt di input per renderlo pi sicuro per le politiche di generazione immagini, preservando l'intento artistico.","node.help.video_prompt_processor":"Processore specializzato per creare prompt dettagliati per la generazione video.","node.help.image_output":"Visualizza il risultato della generazione di immagini. Supporta il download e la visualizzazione.","node.help.video_output":"Visualizza il risultato della generazione video usando il modello Veo.","node.help.prompt_analyzer":"Decostruisce un prompt in componenti come soggetto, stile e ambiente.","node.help.character_analyzer":"Analizza una descrizione del personaggio e la divide in aspetto e abbigliamento.","node.help.character_generator":"Genera descrizioni dettagliate di personaggi basate su un breve prompt.","node.help.character_card":"Memorizza dati completi del personaggio inclusi immagine e descrizione.","node.help.image_analyzer":"Usa l'IA per descrivere il contenuto di un'immagine di input.","node.help.image_editor":"Strumento avanzato per modificare immagini usando prompt di testo e inpainting/outpainting.","node.help.image_sequence_generator":"Genera una sequenza di immagini basata su una lista di prompt.","node.help.prompt_sequence_editor":"Permette la modifica in massa di sequenze di prompt usando istruzioni IA.","node.help.gemini_chat":"Un'interfaccia di chat generica con Gemini per brainstorming o assistenza.","node.help.translator":"Traduce il testo tra le lingue usando modelli IA.","node.help.script_generator":"Genera una sceneggiatura strutturata (scene, personaggi) da un'idea di storia.","node.help.script_viewer":"Visualizza e gestisce i dati della sceneggiatura per la generazione fotogramma per fotogramma.","node.help.note":"Una nota adesiva per aggiungere commenti o istruzioni sulla tela.","node.help.reroute_dot":"Un piccolo punto usato per organizzare le connessioni e creare layout pi puliti.","node.help.data_reader":"Strumento di debug per ispezionare i dati grezzi che fluiscono attraverso le connessioni.","node.help.video_editor":"Uno strumento basato su timeline per modificare clip video e immagini.","node.help.media_viewer":"Un lettore per visualizzare file video e audio con controlli di riproduzione.","node.help.data_protection":"Un nodo mini-gioco interattivo Tower Defense. Difendi il flusso di dati dalla corruzione.","node.help.pose_creator":"Visual rig to define and generate character poses for consistency.","node.action.expand":"Espandi","node.action.collapse":"Comprimi","node.action.help":"Aiuto","node.action.download":"Scarica","node.action.clear":"Pulisci Contenuto","node.action.refreshChat":"Pulisci e Riavvia Chat","node.action.paste":"Incolla","node.action.resetEditor":"Resetta Editor","node.action.saveCharacter":"Salva Scheda","node.action.loadCharacter":"Carica Scheda","node.action.copy":"Copia","node.action.copyImage":"Copia Immagine","node.action.copyTextPrompt":"Copia Prompt","node.action.copyImagePrompt":"Copia Prompt Immagine","node.action.copyVideoPrompt":"Copia Prompt Video","node.action.cutConnections":"Taglia Connessioni","node.action.close":"Chiudi","node.action.closeNode":"Chiudi Nodo (Shift+Click per chiusura istantanea)","node.action.closeNodeSimple":"Chiudi Nodo","node.action.randomWord":"Aggiungi Parola Casuale","node.action.processImage":"Rimuovi Watermark","node.action.processImageTitle":"Usa Gemini per rimuovere watermark e testo dall'immagine.","node.action.editor":"Editor","node.action.rasterEditor":"Editor Raster","node.action.openInAIEditor":"Apri in Editor IA","node.action.openInAnalyzer":"Apri in Analizzatore","node.action.outputToInput":"Usa Output come Input","node.action.processChainForward":"Processa in Avanti","node.action.executeChain":"Esegui Catena","node.action.executeChainTitle":"Esegui tutti i nodi a monte per generare il risultato finale.","node.action.sanitize":"Sanitizza","node.action.rename":"Rinomina","node.action.stop":"Stop","node.action.stopping":"Arresto...","node.action.deleteItem":"Elimina Elemento","node.action.detachAndPaste":"Stacca e Incolla","node.action.delete":"Elimina","node.action.flipImage":"Ribalta Immagine","node.action.pin":"Fissa Nodo in Alto","node.action.unpin":"Sblocca Nodo","node.action.updateDescription":"Aggiorna Descrizione","node.action.modifyCharacter":"Richiedi Modifiche","node.action.updateDataFormat":"Aggiorna Formato Dati","node.action.expand169":"Espandi a 16:9","node.action.expand916":"Espandi a 9:16","node.action.sync":"Sincronizza dalle Connessioni","node.action.expandRatio":"Espandi Proporzioni","node.action.markPrimary":"Segna come Principale","node.action.addCard":"Aggiungi Scheda","node.action.removeCard":"Rimuovi Scheda","node.action.showOutputs":"Mostra Output","node.action.hideOutputs":"Nascondi Output","node.mediaViewer.play":"Play","node.mediaViewer.pause":"Pausa","node.mediaViewer.stop":"Stop","node.mediaViewer.addMarker":"Aggiungi Marker","node.mediaViewer.exportSRT":"Esporta Marker (SRT)","node.mediaViewer.deleteAllMarkers":"Elimina Tutti i Marker","node.mediaViewer.saveMarkers":"Salva Marker su Disco","node.mediaViewer.loadMarkers":"Carica Marker da Disco","node.mediaViewer.relink":"Ricollega File","node.content.notePlaceholder":"Scrivi qui le tue note...","node.content.dropImage":"Trascina immagine qui o clicca per caricare","node.content.dropMedia":"Trascina video o audio qui","node.content.processing":"Elaborazione...","node.content.processingChain":"Elaborazione Catena...","node.content.metadataPrompt":"Prompt da Metadati Immagine:","node.content.metadataPromptPlaceholder":"Nessun prompt trovato nell'immagine.","node.content.copyPrompt":"Usa","node.content.prompt":"Prompt","node.content.inputPrompt":"Prompt di Input","node.content.enhancedResult":"Risultato Migliorato","node.content.videoPrompt":"Prompt Video","node.content.editPromptPlaceholder":"Aggiungi o modifica il prompt...","node.content.enhancedPromptHere":"Il prompt migliorato apparir qui...","node.content.safePrompt":"Sicuro per uso commerciale","node.content.generating":"Generazione...","node.content.imageHere":"L'immagine apparir qui","node.content.generationMode":"Modello di Generazione","node.content.aspectRatio":"Proporzioni","node.content.aspectRatioHelp":"Imposta le proporzioni per la generazione dell'immagine","node.content.aspectRatioNotSupportedFast":"Proporzioni disponibili solo per modelli Imagen.","node.content.enableAspectRatioFormatting":"Abilita Formattazione Proporzioni","node.content.autoDownload":"Auto Download","node.content.generateImage":"Genera Immagine","node.content.enhancing":"Miglioramento...","node.content.enhancePrompt":"Migliora Prompt","node.content.sanitizing":"Sanitizzazione...","node.content.sanitizedPromptHere":"Il prompt sanitizzato apparir qui...","node.content.analyzing":"Analisi...","node.content.analyzePrompt":"Analizza Prompt","node.content.analyzeImage":"Analizza Immagine","node.content.imageToText":"Immagine a Testo","node.content.updatePromptFromImage":"Aggiorna prompt da immagine","node.content.analyzeCharacter":"Analizza Personaggio","node.content.generateCharacters":"Genera Personaggi","node.content.characterPromptPlaceholder":"Descrivi il/i personaggio/i da generare...","node.content.character":"Personaggio","node.content.clothing":"Abbigliamento","node.content.characterPlaceholder":"La descrizione del personaggio apparir qui...","node.content.clothingPlaceholder":"La descrizione dell'abbigliamento apparir qui...","node.content.appearance":"Aspetto","node.content.personality":"Personalit","node.content.environment":"Ambiente/Setting","node.content.action":"Azione","node.content.emotion":"Emozione","node.content.style":"Stile","node.content.environmentPlaceholder":"Descrizione dettagliata dell'ambiente...","node.content.charactersPlaceholder":"Lista dei personaggi principali...","node.content.characters":"Personaggi","node.content.characterConcepts":"Concetti Personaggio","node.content.actionPlaceholder":"Descrizione dell'azione...","node.content.emotionPlaceholder":"Descrizione dell'emozione...","node.content.stylePlaceholder":"Descrizione dello stile artistico...","node.content.descriptionHere":"La descrizione apparir qui...","node.content.enableOutpainting":"Abilita Outpainting","node.content.outpaintingPromptPlaceholder":"Prompt Outpainting...","node.content.inputImage":"Immagini di Input","node.content.dropOrClick":"Trascina o Clicca","node.content.outputImage":"Immagine di Output","node.content.applyEdit":"Applica Modifica","node.content.editing":"Modifica...","node.content.chatPlaceholder":"Scrivi il tuo messaggio...","node.content.connectedPlaceholder":"Connesso al nodo, modifica nella sorgente.","node.content.connectedNode":"Connesso via nodo","node.content.connectedEmpty":"Il nodo connesso non ha immagini.","node.content.translatePlaceholder":"Testo da tradurre...","node.content.translatedTextPlaceholder":"Testo tradotto...","node.content.targetLanguage":"Lingua di Destinazione","node.content.translate":"Traduci","node.content.translating":"Traduzione...","node.content.scriptPromptPlaceholder":"Inserisci un'idea per la storia o trama...","node.content.generateScript":"Genera Sceneggiatura","node.content.loadScript":"Carica File Sceneggiatura","node.content.summary":"Riepilogo","node.content.scenes":"Scene","node.content.unrecognizedFormat":"Formato sceneggiatura non riconosciuto.","node.content.frames":"Fotogrammi","node.content.characterIndex":"Indice","node.content.readData":"Leggi Dati","node.content.textDataHere":"I dati di testo appariranno qui.","node.content.noDataRead":'Connetti un nodo e clicca "Leggi Dati" per visualizzarne il contenuto.',"node.content.previewError":"Errore Anteprima","node.content.previewPlaceholder":"L'anteprima apparir qui","node.content.imagePrompt":"Prompt Immagine","node.output.allPromptData":"Tutti i Dati Prompt","node.note.tab.note":"Nota","node.note.tab.references":"Riferimenti","node.note.nestedImages":"Immagini Nidificate","node.note.dropPlaceholder":"Trascina immagini o clicca per aggiungere","node.note.addCaption":"Didascalia","node.note.action.shuffle":"Mescola","node.note.action.undoShuffle":"Annulla Mescolamento","node.content.characterTypeShort":"Tipo:","node.content.numberOfCharactersShort":"Qt:","node.content.characterType.simple":"Semplice","node.content.characterType.anthro":"Antro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Oggetto Chiave","node.content.style.simple":"Semplice","node.content.style.realistic":"Realistico","node.content.style.3d_cartoon":"Cartone 3D","node.content.style.3d_realistic":"3D Realistico","node.content.style.2d_animation":"Animazione 2D","node.content.style.anime":"Anime","node.content.style.comics":"Fumetti","node.content.style.custom":"Personalizzato","node.content.fullDescriptionTitle":"Descrizione completa del personaggio","node.content.integrationInstruction":"Istruzione di integrazione","node.content.additionalPromptSuffix":"Prompt Aggiuntivo (Suffisso)","search.node.text_input.title":"Input Testo","search.node.text_input.description":"Un semplice campo di testo multilinea.","search.node.image_input.title":"Input Immagine","search.node.image_input.description":"Carica o incolla un'immagine.","search.node.prompt_sequence_editor.title":"Editor Sequenza Prompt","search.node.prompt_sequence_editor.description":"Modifica una lista di prompt usando una singola istruzione, permettendo modifiche in blocco.","search.node.data_reader.title":"Lettore Dati","search.node.data_reader.description":"Legge e mostra l'output grezzo (testo o immagine) da qualsiasi nodo connesso per il debug.","search.node.note.title":"Nota","search.node.note.description":"Una nota adesiva per commenti.","search.node.prompt_processor.title":"Processore Prompt","search.node.prompt_processor.description":"Combina gli input in un prompt migliorato.","search.node.prompt_analyzer.title":"Analizzatore Prompt","search.node.prompt_analyzer.description":"Decostruisce un prompt in componenti.","search.node.prompt_sanitizer.title":"Sanitizzatore Prompt","search.node.prompt_sanitizer.description":"Riscrive il prompt per essere pi sicuro per i modelli IA.","search.node.character_card.title":"Scheda Personaggio","search.node.character_card.description":"Memorizza informazioni dettagliate su un personaggio.","search.node.character_analyzer.title":"Analizzatore Personaggio","search.node.character_analyzer.description":"Divide una descrizione in aspetto e abbigliamento.","search.node.character_generator.title":"Generatore Personaggio","search.node.character_generator.description":"Genera una o pi descrizioni dettagliate di personaggi basate su un prompt.","search.node.image_analyzer.title":"Analizzatore Immagine","search.node.image_analyzer.description":"Descrive un'immagine usando l'IA.","search.node.image_editor.title":"Editor Immagini IA","search.node.image_editor.description":"Modifica o combina immagini con un prompt.","search.node.image_sequence_generator.title":"Generatore Sequenza Immagini","search.node.image_sequence_generator.description":"Genera una sequenza di immagini basata su una lista di prompt.","search.node.gemini_chat.title":"Chat Gemini","search.node.gemini_chat.description":"Un'interfaccia conversazionale per chattare con Gemini, utile per brainstorming o assistenza.","search.node.translator.title":"Traduttore","search.node.translator.description":"Traduce testo tra lingue usando modelli IA.","search.node.script_generator.title":"Generatore Sceneggiatura","search.node.script_generator.description":"Genera una sceneggiatura strutturata (scene, personaggi) da un'idea di storia.","search.node.script_viewer.title":"Visualizzatore Sceneggiatura","search.node.script_viewer.description":"Visualizza e gestisce i dati della sceneggiatura per la generazione fotogramma per fotogramma.","search.node.note":"Un semplice campo di testo per lasciare note e commenti sulla tela.","search.node.reroute_dot":"Un piccolo punto usato per organizzare le connessioni.","search.node.video_prompt_processor.title":"Processore Prompt Video","search.node.video_prompt_processor.description":"Crea prompt dettagliati per la generazione video.","search.node.video_output.title":"Output Video","search.node.video_output.description":"Genera un video usando il modello Veo.","search.node.image_output.title":"Output Immagine","search.node.image_output.description":"Visualizza e consente di scaricare le immagini generate.","search.node.media_viewer.title":"Visualizzatore Media","search.node.media_viewer.description":"Lettore per visualizzare file video e audio con controlli.","search.node.data_protection.title":"Protezione Dati","search.node.data_protection.description":"Difendi il tuo flusso di dati dalla corruzione in questo nodo mini-gioco.","search.node.pose_creator.title":"Pose Creator","search.node.pose_creator.description":"Visually rig and create character poses for generation guidance.","prompt_sequence_editor.instructionPlaceholder":"Inserisci istruzione per modificare i prompt...","prompt_sequence_editor.modifying":"Modifica in corso...","prompt_sequence_editor.modifySelected":"Modifica Selezionati ({count})","prompt_sequence_editor.sourcePrompts":"Prompt Sorgente","prompt_sequence_editor.finalPrompts":"Prompt Modificati","prompt_sequence_editor.error.invalidInput":"Formato dati non valido. Connetti un array di sequenza prompt.","geminiChat.mode.general":"Generale","geminiChat.mode.prompt":"Esperto Prompt","geminiChat.mode.script":"Sceneggiatore","geminiChat.mode.youtube":"Analista YouTube","image_sequence.deselect_scene":"Deseleziona tutti i fotogrammi in questa scena","image_sequence.clear_prompts_only":"Pulisci Solo Prompt di Testo","image_sequence.prev_scene":"Scena Precedente","image_sequence.next_scene":"Scena Successiva","image_sequence.frames_hidden":"({count} fotogrammi nascosti)","image_sequence.frames_count":"({count} fotogrammi)","node.content.modificationRequest":"Richiesta di modifica","node.content.technicalPrompt":"Prompt Tecnico","node.promptProcessor.safePromptTooltip":"Riscrive il prompt per rispettare le linee guida di sicurezza ed evitare violazioni delle norme.","node.promptProcessor.technicalPromptTooltip":"Converte il prompt in una specifica tecnica altamente dettagliata (illuminazione, camera, impostazioni di rendering).","node.promptProcessor.enhanceTooltip":"Usa l'IA per espandere e arricchire il prompt con dettagli descrittivi.","node.promptProcessor.chainTooltip":"Esegue questo nodo e innesca tutti i nodi connessi a valle.","image_sequence.tooltip.autoCrop":"Ritaglia automaticamente le immagini generate in rapporto 16:9.","image_sequence.tooltip.autoDownload":"Salva automaticamente ogni immagine sul dispositivo dopo la generazione.","image_sequence.tooltip.createZip":"Raggruppa tutte le immagini selezionate in un unico archivio ZIP per il download."},pb={"imageEditor.title":"Editor Immagini","imageEditor.canvasResolution":"Risoluzione Tela","imageEditor.background":"Sfondo","imageEditor.toolSettings":"Impostazioni Strumento","imageEditor.snapToEdges":"Aggancia ai Bordi","imageEditor.freeAspect":"Proporzioni Libere","imageEditor.section.aiRequest":"Richiesta Modifica IA","imageEditor.input.modificationPlaceholder":'Descrivi le modifiche, es. "cambia sfondo in blu"',"imageEditor.action.sendRequest":"Invia Richiesta","imageEditor.tooltip.removeObject":"Rimuovi (Rosso) / Mantieni (Verde)","imageEditor.action.removeObject":"Rimuovi Oggetto","imageEditor.tool.transform":"Trasforma","imageEditor.tool.hand":"Mano (Pan)","imageEditor.tool.zoom":"Zoom","imageEditor.tool.pencil":"Matita","imageEditor.tool.rectangle":"Rettangolo","imageEditor.action.fit":"Adatta alla Tela","imageEditor.action.fill":"Riempi Tela","imageEditor.action.cancel":"Annulla","imageEditor.action.resetEdits":"Resetta Modifiche","imageEditor.action.apply":"Applica","imageViewer.title":"Visualizzatore Immagini","imageEditor.outputResolution":"Risoluzione Output","imageEditor.outputResolutionHelp":'Imposta risoluzione output. Se "Auto", usa la risoluzione della tela.',"imageEditor.currentSize":"Dimensione Attuale: {width}x{height}","imageEditor.sequenceMode":"Modalit Sequenza","imageEditor.sequenceModeHelp":"Elabora le immagini di input da Input A in sequenza.","imageEditor.sequentialCombination":"Combinazione Sequenziale Immagini","imageEditor.sequentialCombinationHelp":"Per ogni fotogramma: Invia immagine Input A corrente + Tutte le immagini Input B.","imageEditor.sequentialPrompt":"Combinazione Sequenziale Prompt","imageEditor.sequentialPromptHelp":"Per ogni fotogramma: Usa un prompt unico dalla lista + immagine corrente.","imageEditor.sequentialEditingWithPrompts":"Modifica Sequenziale con Prompt","imageEditor.sequentialEditingWithPromptsHelp":"Per ogni fotogramma: Usa immagine Input B + prompt unico. Input A ignorato.","imageEditor.input":"Input","imageEditor.inputA":"Input A","imageEditor.inputB":"Input B","imageEditor.status.queued":"In Coda","imageEditor.status.generating":"Generazione...","imageEditor.action.regenerate":"Rigenera","imageEditor.tooltip.fit":"Adatta immagine ai bordi della tela (contain).","imageEditor.tooltip.fill":"Scala immagine per riempire la tela (cover).","imageEditor.tooltip.flip":"Ribalta immagine orizzontalmente.","imageEditor.background.white":"Bianco","imageEditor.background.gray":"Grigio","imageEditor.background.black":"Nero","imageEditor.background.dark":"Scuro","image_sequence.regenerate":"Rigenera","image_sequence.stop_queue":"Ferma Coda","image_sequence.move_up":"Sposta Su","image_sequence.move_down":"Sposta Gi","image_sequence.copy_prompt":"Copia Prompt","image_sequence.add_frame":"Aggiungi Fotogramma","image_sequence.delete_frame":"Elimina Fotogramma","image_sequence.expand_all_frames":"Espandi/Comprimi Tutti i Fotogrammi","image_sequence.collapse_all_frames":"Comprimi Tutti i Fotogrammi","image_sequence.expand_all_scenes":"Espandi/Comprimi Tutte le Scene","image_sequence.collapse_all_scenes":"Comprimi Tutte le Scene","image_sequence.expand_all":"Espandi Tutto","image_sequence.collapse_all":"Comprimi Tutto","image_sequence.clear_all_prompts":"Pulisci Tutti i Prompt","image_sequence.add_first_frame":"Aggiungi Primo Fotogramma","image_sequence.drop_or_add_title":"Trascina JSON Sequenza o Aggiungi Fotogramma","image_sequence.drop_or_add_desc":"Trascina un file JSON qui o clicca per aggiungere un fotogramma manualmente.","image_sequence.load_prompts":"Carica Prompt","image_sequence.output_images_title":"Immagini Output","image_sequence.prompts_list_title":"Prompt Sorgente","image_sequence.download_selected":"Scarica Selezionati","image_sequence.select_all":"Seleziona Tutto","image_sequence.select_none":"Deseleziona Tutto","image_sequence.invert_selection":"Inverti Selezione","image_sequence.run_selected":"Esegui Selezionati","image_sequence.start_queue":"Avvia Coda","image_sequence.character_prompt_combination":"Combinazione Prompt Personaggio","image_sequence.combination_none":"Nessuna","image_sequence.combination_combine":"Combina","image_sequence.combination_replace":"Sostituisci Tag","image_sequence.status.error":"Erro","image_sequence.status.pending":"In Coda","image_sequence.clear_selected_prompts":"Pulisci Prompt Selezionati","image_sequence.range_from":"Da:","image_sequence.range_to":"A:","image_sequence.stats.total":"Totale Fotogrammi: {count}","image_sequence.stats.generated":"Generati: {count}","image_sequence.stats.queue":"Coda: {count}","image_sequence.edit_in_source":"Modifica in Sorgente","image_sequence.edit_prompt":"Modifica Prompt","image_sequence.select_scene":"Seleziona Scena","image_sequence.next_scene":"Scena Successiva","image_sequence.prev_scene":"Scena Precedente","image_sequence.scene_input_label":"Scena","image_sequence.select_square":"Seleziona Quadrato (1:1)","image_sequence.select_landscape":"Seleziona Paesaggio (16:9)","image_sequence.select_portrait":"Seleziona Ritratto (9:16)","image_sequence.select_range":"Seleziona Intervallo","image_sequence.force_refresh":"Forza Aggiornamento","image_sequence.select_scene_frames":"Seleziona tutti i fotogrammi in questa scena","image_sequence.collapse_other_scenes":"Comprimi altre scene","prompt_sequence_editor.instructionPlaceholder":"Inserisci istruzione per modificare i prompt...","prompt_sequence_editor.modifying":"Modifica in corso...","prompt_sequence_editor.modifySelected":"Modifica Selezionati ({count})","prompt_sequence_editor.sourcePrompts":"Prompt Sorgente","prompt_sequence_editor.finalPrompts":"Prompt Modificati","prompt_sequence_editor.error.invalidInput":"Formato dati non valido. Connetti un array di sequenza prompt.","geminiChat.mode.general":"Generale","geminiChat.mode.prompt":"Esperto Prompt","geminiChat.mode.script":"Sceneggiatore","geminiChat.mode.youtube":"Analista YouTube","image_sequence.shot_type.WS":"Integra l'Entit con un Campo Lungo (WS) nella scena e nell'azione. Mostra l'ambiente.","image_sequence.shot_type.MS":"Integra l'Entit con un Piano Medio (MS) nella scena. Personaggio dalla vita in su.","image_sequence.shot_type.CU":"Integra l'Entit con un Primo Piano (CU) nella scena.","image_sequence.shot_type.ECU":"Integra l'Entit con un Primissimo Piano (ECU) nella scena. Massimo dettaglio.","image_sequence.shot_type.LS":"Integra l'Entit con un Piano Totale (LS) nella scena per mostrare la scala."},hb={"dialog.permission.title":"Permesso Richiesto","dialog.permission.description":"Questa app necessita del permesso di leggere gli appunti per incollare contenuti nei nodi. I tuoi dati non vengono memorizzati o inviati da nessuna parte.","dialog.permission.allow":"Consenti","dialog.permission.decline":"Rifiuta","dialog.rename.title":"Rinomina Elemento","dialog.rename.group.title":"Rinomina Gruppo","dialog.rename.catalog.title":"Rinomina Elemento Catalogo","dialog.rename.node.title":"Rinomina Nodo","dialog.rename.label":"Nuovo Nome:","dialog.rename.confirm":"Rinomina","dialog.rename.cancel":"Annulla","dialog.promptEdit.title":"Modifica Prompt","dialog.promptEdit.nameLabel":"Nome:","dialog.promptEdit.contentLabel":"Contenuto:","dialog.promptEdit.confirm":"Salva","dialog.promptEdit.cancel":"Annulla","dialog.confirmDelete.title":"Conferma Eliminazione","dialog.confirmDelete.message":"Sei sicuro di voler eliminare questo elemento? Questa azione non pu essere annullata.","dialog.confirmDelete.confirm":"Elimina","dialog.confirmDelete.cancel":"Annulla","dialog.confirmCloseTab.title":"Chiudi Scheda","dialog.confirmCloseTab.message":'Sei sicuro di voler chiudere la scheda "{tabName}"? Le modifiche non salvate andranno perse.',"dialog.confirmClear.title":"Pulisci Tela","dialog.confirmClear.message":"Sei sicuro di voler pulire l'intera tela? Questa azione non pu essere annullata.","dialog.confirmReset.title":"Resetta a Default","dialog.confirmReset.message":"Sei sicuro di voler resettare la tela allo stato predefinito? Tutto il lavoro corrente andr perso.","dialog.confirmReset.confirm":"Resetta","dialog.confirmLoad.title":"Conferma Caricamento","dialog.confirmLoad.message":"Caricare un nuovo file sostituir il contenuto corrente. Eventuali modifiche non salvate andranno perse. Continuare?","dialog.apiKey.title":"Seleziona Chiave API","dialog.apiKey.description":`Questa funzionalit richiede una chiave API di Progetto con l'API "AI Platform" abilitata. La generazione video pu richiedere alcuni minuti.`,"dialog.apiKey.billingLink":"Scopri di pi sulla fatturazione","dialog.apiKey.button":"Seleziona Chiave API","dialog.settings.title":"Impostazioni","dialog.settings.apiKeyLabel":"La tua Chiave API Google Gemini:","dialog.settings.useDevKeyLabel":"Usa chiave API gratuita (per sviluppo)","dialog.settings.instantNodeCloseLabel":"Chiusura istantanea nodi","dialog.settings.nodeAnimationLabel":"Animazione Aggiunta Nodo","dialog.settings.animationModeLabel":"Modalit Animazione Creazione","dialog.settings.anim.pulse":"Impulso","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"Nessuna","dialog.settings.description":"Per usare le tue quote e accedere a modelli specifici, inserisci la tua chiave API personale. La chiave  salvata localmente nel tuo browser.","dialog.settings.getKeyLink":"Ottieni una Chiave API qui","dialog.settings.save":"Salva","dialog.deleteNode.title":"Chiudere nodo?","dialog.deleteNode.titlePlural":"Chiudere nodi?","dialog.deleteNode.confirm":"S","dialog.deleteNode.cancel":"No","dialog.deleteNode.confirmTooltip":"Chiudi nodo - i dati persi non possono essere recuperati","dialog.deleteNode.cancelTooltip":"Non chiudere - continua a lavorare con il nodo","dialog.deleteNode.dontShowAgain":"Non mostrare pi","dialog.exitApp.title":"Chiudere il Progetto?","dialog.exitApp.message":"Sei sicuro di voler chiudere il progetto? Tutto il lavoro corrente andr perso e la tela verr resettata."},mb={"group.button.create":"Crea Gruppo ({count})","group.rename":"Rinomina Gruppo","group.saveToCatalog":"Salva nel Catalogo","group.saveToDisk":"Salva su Disco","group.ungroup":"Separa (Shift+Click per eliminare con contenuto)","group.duplicate":"Duplica gruppo con contenuto","catalog.tabs.groups":"Gruppi","catalog.tabs.library":"Libreria","catalog.tabs.characters":"Personaggi","catalog.tabs.scripts":"Sceneggiature","catalog.tabs.sequences":"Sequenze","catalog.back":"Indietro","catalog.load":"Carica da File","catalog.newFolder":"Nuova Cartella","catalog.saveTo":"Salva nel Catalogo","catalog.card.addToCanvas":"Aggiungi alla Tela","catalog.card.rename":"Rinomina","catalog.card.save":"Salva","catalog.card.delete":"Elimina","catalog.empty.description":"Questa cartella  vuota. Puoi aggiungere elementi o creare nuove cartelle.","library.loadFromFile":"Carica","library.actions.newFolder":"Nuova Cartella","library.actions.newPrompt":"Nuovo Prompt","library.actions.copy":"Copia","library.actions.edit":"Modifica","library.empty.title":"Cartella Vuota","library.empty.description":"Crea prompt e cartelle per iniziare.","library.emptyPrompt":"Prompt vuoto"},gb={...cb,...db,...ub,...pb,...hb,...mb},fb={"app.title":"Modificador de Prompt","app.subtitle":"Conecte ideias para criar uma obra-prima","app.error.title":"Notificao","app.error.copy":"Copiar Mensagem","app.error.copied":"Copiado!","error.apiKey":"Sua chave API  invlida ou no tem permisses. Por favor, selecione uma chave API vlida.","error.scriptModifierCanvas":"Esta tela pertence a outra aplicao - Script Modifier. Por favor, use o Script Modifier para abrir este arquivo.","welcome.title":"Bem-vindo ao","welcome.description":"Bem-vindo ao Modificador de Prompt. Conecte ideias para criar obras-primas. Use ns para gerar e editar contedo.","welcome.apiKeyLabel":"Sua Chave API Google Gemini","welcome.apiKeyPlaceholder":"Insira sua chave API aqui...","welcome.apiKeyHelp":"Sua chave API  armazenada localmente.","welcome.getKeyLink":"Obter Chave API","welcome.iAmDeveloper":"Sou Desenvolvedor","welcome.letsGo":"Vamos l","welcome.resume":"Continuar","welcome.startNew":"Nova Tela","welcome.freeModeActive":"Modo Gratuito Ativo","welcome.selectLanguage":"Selecione seu idioma principal","welcome.navHint":"Use as teclas do teclado  e  para mudar o idioma","toast.contentCleared":"Contedo limpo","toast.downloadStarted":"Download iniciado","toast.characterLoaded":"Carto de personagem carregado","toast.characterSavedDisk":"Carto de personagem salvo no disco","toast.copiedToClipboard":"Copiado para a rea de transferncia","toast.pastedFromClipboard":"Colado da rea de transferncia","toast.pasteFailed":"Falha ao colar","toast.nodeDuplicated":"N duplicado","toast.groupSavedToDisk":'Grupo "{groupTitle}" salvo no disco',"toast.groupDeleted":"Grupo e contedo excludos","toast.characterSavedCatalog":"Personagem salvo no catlogo","toast.promptSaved":"Prompt salvo na biblioteca: {promptName}...","toast.connectionsCut":"Conexes removidas","toast.apiKeySaved":"Chave API salva com sucesso","toast.cacheCleared":"Limpos {count} itens no utilizados do cache","toast.cacheEmpty":"Cache j est otimizado","toast.scriptSaved":"Roteiro salvo no disco","alert.groupSaved":'Grupo "{groupTitle}" salvo no catlogo.',"alert.loadCatalogFailed":"Falha ao carregar arquivo de catlogo","alert.invalidCatalogFile":"Formato de arquivo de catlogo invlido","alert.fileNotSupported":'Arquivo no suportado. "appName" ausente ou incorreto.',"alert.invalidCatalogStructure":'Estrutura de catlogo invlida. "root" ausente.',"tutorial.step1":"Clique aqui para adicionar uma palavra aleatria ao prompt.","tutorial.step2":'Clique em "Melhorar Prompt" para combinar entradas usando IA.',"tutorial.step2_waiting":"A IA est analisando suas entradas e gerando um prompt mais rico...","tutorial.step3":"Finalmente, clique aqui para gerar a imagem.","tutorial.step3b":"A gerao leva algum tempo. Voc pode monitorar o progresso aqui.","tutorial.step4":"Voc pode adicionar novos ns manualmente a partir desta barra de ferramentas.","tutorial.group.catalog":"Use o Catlogo para buscar ns ou gerenciar grupos.","tutorial.group.general":"Adicione Notas Adesivas e Leitores de Dados para depurao.","tutorial.group.input":"Entradas bsicas para texto, imagens e sequncias.","tutorial.group.processing":"Analise e processe prompts ou imagens com IA.","tutorial.group.character":"Crie, analise e armazene personagens detalhados.","tutorial.group.output":"Exiba resultados e gere sequncias.","tutorial.group.ai":"Converse com Gemini e traduza textos.","tutorial.group.video":"Ferramentas para prompts de vdeo e edio.","tutorial.group.scripts":"Gere e visualize roteiros para histrias complexas.","tutorial.group.file":"Salve seu trabalho, carregue projetos ou baixe a tela.","tutorial.success.title":"Tutorial Concludo!","tutorial.success.message":"Voc aprendeu com sucesso o bsico do Modificador de Prompt. Boa sorte criando obras-primas!","tutorial.success.button":"Comear a Criar","tutorial.skip":"Pular","tutorial.next":"Prximo","tutorial.finish":"Entendi"},xb={"toolbar.settings":"Configuraes","toolbar.resetCanvas":"Redefinir Tela","toolbar.clearCache":"Limpar Cache No Usado","toolbar.home":"Incio","toolbar.edit":"Editar (V)","toolbar.cutter":"Cortar Conexo (C) / (Segure Ctrl)","toolbar.selection":"Seleo (S) / (Segure Shift)","toolbar.reroute":"Redirecionar (R) / (Segure Ctrl+Alt)","toolbar.zoom":"Zoom (Segure Z)","toolbar.snapToGrid":"Alinhar  Grade","toolbar.smartGuides":"Guias Inteligentes","toolbar.lineStyleSpaghetti":"Linhas Spaghetti","toolbar.lineStyleOrthogonal":"Linhas Ortogonais","toolbar.resetZoom":"Redefinir Zoom","toolbar.resetCamera":"Redefinir Posio da Cmera","toolbar.clearCanvas":"Limpar Tela","toolbar.addNode":"Adicionar N (F)","toolbar.catalog":"Abrir Catlogo (Ctrl + Espao)","toolbar.addNote":"Adicionar Nota (N)","toolbar.addDataReader":"Adicionar Leitor de Dados (Shift + R)","toolbar.addTextInput":"Adicionar Entrada de Texto (T)","toolbar.addImageInput":"Adicionar Entrada de Imagem (I)","toolbar.addPromptSequenceEditor":"Adicionar Editor de Sequncia de Prompt (Q)","toolbar.addImageAnalyzer":"Adicionar Analisador de Imagem (Shift+A)","toolbar.addPromptAnalyzer":"Adicionar Analisador de Prompt (A)","toolbar.addPromptProcessor":"Adicionar Processador de Prompt (P)","toolbar.addCharacterGenerator":"Adicionar Gerador de Personagem (Shift+C)","toolbar.addCharacterAnalyzer":"Adicionar Analisador de Personagem (Ctrl+Shift+A)","toolbar.addCharacterCard":"Adicionar Carto de Personagem (Ctrl+Shift+C)","toolbar.addImageOutput":"Adicionar Sada de Imagem (O)","toolbar.addImageEditor":"Adicionar Editor de Imagem IA (Shift+I)","toolbar.addImageSequenceGenerator":"Adicionar Gerador de Sequncia de Imagem (Shift+Q)","toolbar.addTranslator":"Adicionar Tradutor (L)","toolbar.addGeminiChat":"Adicionar Chat Gemini (M)","toolbar.addVideoPromptProcessor":"Adicionar Processador de Prompt de Vdeo (Shift+P)","toolbar.addVideoOutput":"Adicionar Sada de Vdeo (Shift+O)","toolbar.addScriptGenerator":"Adicionar Gerador de Roteiro","toolbar.addScriptViewer":"Adicionar Visualizador de Roteiro (Shift + V)","toolbar.saveCanvas":"Salvar Tela (Ctrl + S)","toolbar.saveProject":"Salvar Projeto","toolbar.loadCanvas":"Carregar Projeto/Tela (Ctrl + O)","toolbar.group.general":"Geral","toolbar.group.catalog":"Catlogo","toolbar.group.input":"Entrada","toolbar.group.processing":"Processamento","toolbar.group.character":"Personagem","toolbar.group.output":"Sada","toolbar.group.aiTools":"Ferramentas IA","toolbar.group.video":"Vdeo","toolbar.group.scripts":"Roteiros","toolbar.group.file":"Arquivo","toolbar.title":"Barra de Ferramentas","toolbar.dock":"Ancorar Barra","toolbar.detach":"Desancorar Barra","toolbar.expandPanel":"Expandir Painel","toolbar.collapsePanel":"Recolher Painel","toolbar.dockArea.title":"Ancorar Barra Aqui","toolbar.duplicate":"Duplicar N","toolbar.duplicateWithContent":"Duplicar com Contedo","toolbar.dock.q1":"Esq 1 Qrt","toolbar.dock.q2":"Esq 2 Qrt","toolbar.dock.q3":"Dir 3 Qrt","toolbar.dock.q4":"Dir 4 Qrt","toolbar.dock.tl":"Topo Esquerda","toolbar.dock.bl":"Fundo Esquerda","toolbar.dock.tr":"Topo Direita","toolbar.dock.br":"Fundo Direita","toolbar.dock.left":"Metade Esquerda","toolbar.dock.right":"Metade Direita","toolbar.dock.full":"Tela Cheia","toolbar.dock.exitFull":"Sair Tela Cheia","toolbar.dock.fullFocus":"Foco Tela Cheia","hotkeys.show":"Mostrar Atalhos","hotkeys.tools.title":"Ferramentas","hotkeys.tools.edit":"Modo Edio","hotkeys.tools.cutter":"Ferramenta de Corte","hotkeys.tools.selection":"Ferramenta de Seleo","hotkeys.tools.reroute":"Ferramenta de Redirecionamento","hotkeys.tools.zoom":"Ferramenta de Zoom","hotkeys.tools.toggleLineStyle":"Alternar Estilo de Linha","hotkeys.tools.group":"Seleo de Grupo","hotkeys.tools.closeNode":"Excluir Selecionados","hotkeys.tools.duplicate":"Duplicar N","hotkeys.tools.duplicateWithContent":"Duplicar com Contedo","hotkeys.tools.deleteGroup":"Excluir Grupo (Shift+Clique)","hotkeys.windows.title":"Janelas","hotkeys.windows.search":"Busca Rpida","hotkeys.windows.catalog":"Catlogo","hotkeys.createNode.title":"Criar N","help.panelTitle":"Ajuda e Atalhos","help.title":"Atalhos de Teclado","help.howToUse.title":"Como Usar","help.howToUse.content":"Bem-vindo ao Modificador de Prompt! Use a barra de ferramentas ou atalhos para adicionar ns. Conecte ns para passar dados. Use a ferramenta Editar para mover ns e a tela. Clique duas vezes no espao vazio para abrir o menu de adio rpida. Clique com o boto direito para o menu de contexto.","help.author":"Autor","contextMenu.undoPosition":"Desfazer Posio","contextMenu.redoPosition":"Refazer Posio","contextMenu.align.left":"Alinhar  Esquerda (F)","contextMenu.align.centerX":"Alinhar Centro X (E)","contextMenu.align.right":"Alinhar  Direita (R)","contextMenu.align.top":"Alinhar ao Topo (T)","contextMenu.align.centerY":"Alinhar Centro Y (D)","contextMenu.align.bottom":"Alinhar ao Fundo (B)","contextMenu.distribute.horizontal":"Distribuir Horiz. (Ctrl+D)","contextMenu.distribute.vertical":"Distribuir Vert. (Ctrl+E)","contextMenu.emptySlot":"Slot Vazio (Clique Dir. para atribuir)","contextMenu.saveSlots":"Salvar Config. Slots","contextMenu.loadSlots":"Carregar Config. Slots","quickadd.title":"Adio Rpida","quickadd.group.tools":"Ferramentas","quickadd.group.inputs":"Entradas","quickadd.group.processing":"Processamento","quickadd.group.character":"Personagem","quickadd.group.outputs":"Sadas","quickadd.group.ai":"Ferramentas IA","quickadd.group.video":"Vdeo","quickadd.group.scripts":"Roteiros","quickadd.group.general":"Geral","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"Editar","quickadd.tool.cutter":"Cortar","quickadd.tool.selection":"Seleo","search.placeholder":"Buscar um n para adicionar...","search.noResults":"Nenhum n encontrado.","search.group.input":"Entrada & Bsico","search.group.process":"Processamento & Personagem","search.group.output":"Imagem & Sequncia","search.group.ai":"Ferramentas IA","search.group.video":"Vdeo & Script","search.group.scripts":"Roteiros","toolbar.exitApp":"Fechar Projeto"},yb={"node.title.text_input":"Entrada de Texto","node.title.image_input":"Entrada de Imagem","node.title.prompt_processor":"Processador de Prompt","node.title.prompt_sanitizer":"Higienizador de Prompt","node.title.video_prompt_processor":"Proc. Prompt Vdeo","node.title.image_output":"Sada de Imagem","node.title.video_output":"Sada de Vdeo","node.title.prompt_analyzer":"Analisador de Prompt","node.title.character_analyzer":"Analisador de Personagem","node.title.character_generator":"Gerador de Personagem","node.title.character_card":"Carto de Personagem","node.title.image_analyzer":"Analisador de Imagem","node.title.image_editor":"Editor de Imagem IA","node.title.image_sequence_generator":"Gerador de Sequncia de Imagem","node.title.prompt_sequence_editor":"Editor de Sequncia de Prompt","node.title.gemini_chat":"Chat Gemini","node.title.translator":"Tradutor","node.title.script_generator":"Gerador de Roteiro","node.title.script_viewer":"Visualizador de Roteiro","node.title.note":"Nota","node.title.reroute_dot":"Ponto de Redirecionamento","node.title.data_reader":"Leitor de Dados","node.title.video_editor":"Editor de Vdeo Alpha","node.title.media_viewer":"Visualizador de Mdia","node.title.data_protection":"Proteo de Dados","node.title.pose_creator":"Pose Creator","node.help.text_input":"Um campo de texto simples de vrias linhas para inserir prompts ou notas.","node.help.image_input":"Permite enviar ou colar uma imagem para usar como entrada em outros ns.","node.help.prompt_processor":"Combina vrias entradas de texto em um nico prompt aprimorado usando IA.","node.help.prompt_sanitizer":"Reescreve o prompt de entrada para ser mais seguro para polticas de gerao de imagem, preservando a inteno artstica.","node.help.video_prompt_processor":"Processador especializado para criar prompts detalhados de gerao de vdeo.","node.help.image_output":"Exibe o resultado da gerao de imagem. Suporta download e visualizao.","node.help.video_output":"Exibe o resultado da gerao de vdeo usando o modelo Veo.","node.help.prompt_analyzer":"Desconstri um prompt em componentes como assunto, estilo e ambiente.","node.help.character_analyzer":"Analisa uma descrio de personagem e a divide em aparncia e roupas.","node.help.character_generator":"Gera descries detalhadas de personagens com base em um prompt corto.","node.help.character_card":"Armazena dados completos do personagem, incluindo imagem e descrio.","node.help.image_analyzer":"Usa IA para descrever o contedo de uma imagem de entrada.","node.help.image_editor":"Ferramenta avanada para editar imagens usando prompts de texto e inpainting/outpainting.","node.help.image_sequence_generator":"Gera uma sequncia de imagens com base em uma lista de prompts.","node.help.prompt_sequence_editor":"Permite edio em massa de sequncias de prompts usando instrues de IA.","node.help.gemini_chat":"Uma interface de chat de uso geral com Gemini para brainstorming ou assistncia.","node.help.translator":"Traduz texto entre idiomas usando modelos de IA.","node.help.script_generator":"Gera um roteiro estruturado (cenas, personagens) a partir de uma ideia de histria.","node.help.script_viewer":"Visualiza e gerencia dados de roteiro para gerao quadro a quadro.","node.help.note":"Uma nota adesiva para adicionar comentrios ou instrues  tela.","node.help.reroute_dot":"Um pequeno ponto usado para organizar conexes e criar layouts mais limpos.","node.help.data_reader":"Ferramenta de depurao para inspecionar os data brutos que fluem pelas conexes.","node.help.video_editor":"Uma ferramenta baseada em linha do tempo para editar videoclipes e imagens.","node.help.media_viewer":"Um player para visualizar arquivos de vdeo e udio com controles de reproduo.","node.help.data_protection":"Um n de mini-jogo interativo de defesa de torre. Defenda seu fluxo de dados contra corrupo.","node.help.pose_creator":"Visual rig to define and generate character poses for consistency.","node.action.expand":"Expandir","node.action.collapse":"Recolher","node.action.help":"Ajuda","node.action.download":"Baixar","node.action.clear":"Limpar Contedo","node.action.refreshChat":"Limpar e Reiniciar Chat","node.action.paste":"Colar","node.action.resetEditor":"Redefinir Editor","node.action.saveCharacter":"Salvar Carto","node.action.loadCharacter":"Carregar Carto","node.action.copy":"Copiar","node.action.copyImage":"Copiar Imagem","node.action.copyTextPrompt":"Copiar Prompt","node.action.copyImagePrompt":"Copiar Prompt de Imagem","node.action.copyVideoPrompt":"Copiar Prompt de Vdeo","node.action.cutConnections":"Cortar Conexes","node.action.close":"Fechar","node.action.closeNode":"Fechar N (Shift+Clique para fechar instantaneamente)","node.action.closeNodeSimple":"Fechar N","node.action.randomWord":"Adicionar Palavra Aleatria","node.action.processImage":"Remover Marcas d'gua","node.action.processImageTitle":"Usa Gemini para remover marcas d'gua e texto da imagem.","node.action.editor":"Editor","node.action.rasterEditor":"Editor Raster","node.action.openInAIEditor":"Abrir no Editor IA","node.action.openInAnalyzer":"Abrir no Analisador","node.action.outputToInput":"Usar Sada como Entrada","node.action.processChainForward":"Processar Adiante","node.action.executeChain":"Executar Cadeia","node.action.executeChainTitle":"Executar todos os ns a montante para gerar o resultado final.","node.action.sanitize":"Higienizar","node.action.rename":"Renomear","node.action.stop":"Parar","node.action.stopping":"Parando...","node.action.deleteItem":"Excluir Item","node.action.detachAndPaste":"Desanexar e Colar","node.action.delete":"Excluir","node.action.flipImage":"Virar Imagem","node.action.pin":"Fixar N no Topo","node.action.unpin":"Desafixar N","node.action.updateDescription":"Atualizar Descrio","node.action.modifyCharacter":"Solicitar Mudanas","node.action.updateDataFormat":"Atualizar Formato de Dados","node.action.expand169":"Expandir para 16:9","node.action.expand916":"Expandir para 9:16","node.action.sync":"Sincronizar das Conexes","node.action.expandRatio":"Expandir Proporo","node.action.markPrimary":"Marcar como Primrio","node.action.addCard":"Adicionar Carto","node.action.removeCard":"Remover Carto","node.action.showOutputs":"Mostrar Sadas","node.action.hideOutputs":"Ocultar Sadas","node.mediaViewer.play":"Reproduzir","node.mediaViewer.pause":"Pausa","node.mediaViewer.stop":"Parar","node.mediaViewer.addMarker":"Adicionar Marcador","node.mediaViewer.exportSRT":"Exportar Marcadores (SRT)","node.mediaViewer.deleteAllMarkers":"Excluir Todos os Marcadores","node.mediaViewer.saveMarkers":"Salvar Marcadores no Disco","node.mediaViewer.loadMarkers":"Carregar Marcadores do Disco","node.mediaViewer.relink":"Revincular Arquivo","node.content.notePlaceholder":"Digite suas notas aqui...","node.content.dropImage":"Solte a imagem aqui ou clique para enviar","node.content.dropMedia":"Solte vdeo ou udio aqui","node.content.processing":"Processando...","node.content.processingChain":"Processando Cadeia...","node.content.metadataPrompt":"Prompt dos Metadados da Imagem:","node.content.metadataPromptPlaceholder":"Nenhum prompt encontrado na imagem.","node.content.copyPrompt":"Usar","node.content.prompt":"Prompt","node.content.inputPrompt":"Prompt de Entrada","node.content.enhancedResult":"Resultado Aprimorado","node.content.videoPrompt":"Prompt de Vdeo","node.content.editPromptPlaceholder":"Adicione ou edite o prompt...","node.content.enhancedPromptHere":"O prompt aprimorado aparecer aqui...","node.content.safePrompt":"Seguro para uso comercial","node.content.generating":"Gerando...","node.content.imageHere":"A imagem aparecer aqui","node.content.generationMode":"Modelo de Gerao","node.content.aspectRatio":"Proporo","node.content.aspectRatioHelp":"Definir proporo para gerao de imagem","node.content.aspectRatioNotSupportedFast":"Proporo disponvel apenas para modelos Imagen.","node.content.enableAspectRatioFormatting":"Habilitar Formatao de Proporo","node.content.autoDownload":"Download Automtico","node.content.generateImage":"Gerar Imagem","node.content.enhancing":"Melhorando...","node.content.enhancePrompt":"Melhorar Prompt","node.content.sanitizing":"Higienizando...","node.content.sanitizedPromptHere":"O prompt higienizado aparecer aqui...","node.content.analyzing":"Analisando...","node.content.analyzePrompt":"Analisar Prompt","node.content.analyzeImage":"Analisar Imagem","node.content.imageToText":"Imagem para Texto","node.content.updatePromptFromImage":"Atualizar prompt da imagem","node.content.analyzeCharacter":"Analisar Personagem","node.content.generateCharacters":"Gerar Personagens","node.content.characterPromptPlaceholder":"Descreva o(s) personagem(ns) para gerar...","node.content.character":"Personagem","node.content.clothing":"Roupas","node.content.characterPlaceholder":"A descrio do personagem aparecer aqui...","node.content.clothingPlaceholder":"A descrio das roupas aparecer aqui...","node.content.appearance":"Aparncia","node.content.personality":"Personalidade","node.content.environment":"Ambiente/Cenrio","node.content.action":"Ao","node.content.emotion":"Emoo","node.content.style":"Estilo","node.content.environmentPlaceholder":"Descrio detalhada do ambiente...","node.content.charactersPlaceholder":"Lista de personagens principais...","node.content.characters":"Personagens","node.content.characterConcepts":"Conceitos de Personagem","node.content.actionPlaceholder":"Descrio da ao...","node.content.emotionPlaceholder":"Descrio da emoo...","node.content.stylePlaceholder":"Descrio do estilo artstico...","node.content.descriptionHere":"A descrio aparecer aqui...","node.content.enableOutpainting":"Habilitar Outpainting","node.content.outpaintingPromptPlaceholder":"Prompt de Outpainting...","node.content.inputImage":"Imagens de Entrada","node.content.dropOrClick":"Soltar ou Clicar","node.content.outputImage":"Imagem de Sada","node.content.applyEdit":"Aplicar Edio","node.content.editing":"Editando...","node.content.chatPlaceholder":"Digite sua mensagem...","node.content.connectedPlaceholder":"Conectado ao n, edite na fonte.","node.content.connectedNode":"Conectado via n","node.content.connectedEmpty":"O n conectado no tem imagem.","node.content.translatePlaceholder":"Texto para traduzir...","node.content.translatedTextPlaceholder":"Texto traduzido...","node.content.targetLanguage":"Idioma de Destino","node.content.translate":"Traduzir","node.content.translating":"Traduzindo...","node.content.scriptPromptPlaceholder":"Insira uma ideia de histria ou enredo...","node.content.generateScript":"Gerar Roteiro","node.content.loadScript":"Carregar Arquivo de Roteiro","node.content.summary":"Resumo","node.content.scenes":"Cenas","node.content.unrecognizedFormat":"Formato de roteiro no reconhecido.","node.content.frames":"Quadros","node.content.characterIndex":"ndice","node.content.readData":"Ler Dados","node.content.textDataHere":"Os dados de texto aparecero aqui.","node.content.noDataRead":'Conecte um n e clique em "Ler Dados" para visualizar seu contedo.',"node.content.previewError":"Erro na Visualizao","node.content.previewPlaceholder":"A visualizao aparecer aqui","node.content.imagePrompt":"Prompt de Imagem","node.output.allPromptData":"Todos os Dados de Prompt","node.note.tab.note":"Nota","node.note.tab.references":"Referncias","node.note.nestedImages":"Imagens Aninhadas","node.note.dropPlaceholder":"Solte imagens ou clique para adicionar","node.note.addCaption":"Legenda","node.note.action.shuffle":"Embaralhar","node.note.action.undoShuffle":"Desfazer Embaralhamento","node.content.characterTypeShort":"Tipo:","node.content.numberOfCharactersShort":"Qtd:","node.content.characterType.simple":"Simples","node.content.characterType.anthro":"Anthro","node.content.characterType.chibi":"Chibi","node.content.characterType.key_item":"Item Chave","node.content.style.simple":"Simples","node.content.style.realistic":"Realista","node.content.style.3d_cartoon":"Cartoon 3D","node.content.style.3d_realistic":"Realista 3D","node.content.style.2d_animation":"Animao 2D","node.content.style.anime":"Anime","node.content.style.comics":"Quadrinhos","node.content.style.custom":"Personalizado","node.content.fullDescriptionTitle":"Descrio completa do personagem","node.content.integrationInstruction":"Instruo de integrao","node.content.additionalPromptSuffix":"Prompt Adicional (Sufixo)","search.node.text_input.title":"Entrada de Texto","search.node.text_input.description":"Um campo de texto simples de vrias linhas.","search.node.image_input.title":"Entrada de Imagem","search.node.image_input.description":"Envie ou cole uma imagem.","search.node.prompt_sequence_editor.title":"Editor de Sequncia de Prompt","search.node.prompt_sequence_editor.description":"Edita uma lista de prompts usando uma nica instruo, permitindo modificaes em lote.","search.node.data_reader.title":"Leitor de Dados","search.node.data_reader.description":"L e exibe a sada bruta (texto ou imagem) de qualquer n conectado para fins de depurao.","search.node.note.title":"Nota","search.node.note.description":"Uma nota adesiva para comentrios.","search.node.prompt_processor.title":"Processador de Prompt","search.node.prompt_processor.description":"Combina entradas em um prompt aprimorado.","search.node.prompt_analyzer.title":"Analisador de Prompt","search.node.prompt_analyzer.description":"Desconstri um prompt em componentes.","search.node.prompt_sanitizer.title":"Higienizador de Prompt","search.node.prompt_sanitizer.description":"Reescreve o prompt para ser mais seguro para modelos de IA.","search.node.character_card.title":"Carto de Personagem","search.node.character_card.description":"Armazena informaes detalhadas sobre um personagem.","search.node.character_analyzer.title":"Analisador de Personagem","search.node.character_analyzer.description":"Divide uma descrio em aparncia e roupas.","search.node.character_generator.title":"Gerador de Personagem","search.node.character_generator.description":"Gera uma ou mais descripciones detalhadas de personagens com base em um prompt.","search.node.image_analyzer.title":"Analisador de Imagem","search.node.image_analyzer.description":"Descreve uma imagem usando IA.","search.node.image_editor.title":"Editor de Imagem IA","search.node.image_editor.description":"Edita ou combina imagens com um prompt.","search.node.image_sequence_generator.title":"Gerador de Sequncia de Imagem","search.node.image_sequence_generator.description":"Gera uma sequncia de imagens com base em uma lista de prompts.","search.node.gemini_chat.title":"Chat Gemini","search.node.gemini_chat.description":"Uma interface de conversao para bater papo com Gemini, til para brainstorming ou assistncia.","search.node.translator.title":"Tradutor","search.node.translator.description":"Traduz texto entre idiomas usando modelos de IA.","search.node.script_generator.title":"Gerador de Roteiro","search.node.script_generator.description":"Gera um roteiro estruturado (cenas, personagens) a partir de uma ideia de histria.","search.node.script_viewer.title":"Visualizador de Roteiro","search.node.script_viewer.description":"Visualiza e gerencia dados de roteiro para gerao quadro a quadro.","search.node.note":"Uma caixa de texto simples para deixar notas e comentrios na tela.","search.node.reroute_dot":"Um pequeno ponto usado para organizar conexes.","search.node.video_prompt_processor.title":"Processador de Prompt de Vdeo","search.node.video_prompt_processor.description":"Cria prompts detalhados para gerao de vdeo.","search.node.video_output.title":"Sada de Vdeo","search.node.video_output.description":"Gera um vdeo usando o modelo Veo.","search.node.image_output.title":"Sada de Imagem","search.node.image_output.description":"Exibe e permite o download de imagens geradas.","search.node.media_viewer.title":"Visualizador de Mdia","search.node.media_viewer.description":"Player para visualizar arquivos de vdeo e udio com controles.","search.node.data_protection.title":"Proteo de Dados","search.node.data_protection.description":"Defenda seu fluxo de dados contra corrupo neste n de mini-jogo.","search.node.pose_creator.title":"Pose Creator","search.node.pose_creator.description":"Visually rig and create character poses for generation guidance.","prompt_sequence_editor.instructionPlaceholder":"Insira a instruo para modificar prompts...","prompt_sequence_editor.modifying":"Modificando...","prompt_sequence_editor.modifySelected":"Modificar Selecionados ({count})","prompt_sequence_editor.sourcePrompts":"Prompts de Origem","prompt_sequence_editor.finalPrompts":"Prompts Modificados","prompt_sequence_editor.error.invalidInput":"Formato de dados invlido. Por favor conecte um array de sequncia de prompts.","geminiChat.mode.general":"Geral","geminiChat.mode.prompt":"Especialista em Prompt","geminiChat.mode.script":"Roteirista","geminiChat.mode.youtube":"Analista do YouTube","image_sequence.deselect_scene":"Desmarcar todos os quadros nesta cena","image_sequence.clear_prompts_only":"Limpar Apenas Prompts de Texto","image_sequence.prev_scene":"Cena Anterior","image_sequence.next_scene":"Prxima Cena","image_sequence.frames_hidden":"({count} quadros ocultos)","image_sequence.frames_count":"({count} quadros)","node.content.modificationRequest":"Solicitao de modificao","node.content.technicalPrompt":"Prompt Tcnico","node.promptProcessor.safePromptTooltip":"Reescreve o prompt para cumprir as diretrizes de segurana e evitar violaes de poltica.","node.promptProcessor.technicalPromptTooltip":"Converte o prompt em uma especificao tcnica altamente detalhada (iluminao, cmera, configuraes de renderizao).","node.promptProcessor.enhanceTooltip":"Usa IA para expandir e enriquecer o prompt com detalhes descritivos.","node.promptProcessor.chainTooltip":"Executa este n e aciona todos os ns conectados a jusante.","image_sequence.tooltip.autoCrop":"Recorta automaticamente as imagens geradas para a proporo 16:9.","image_sequence.tooltip.autoDownload":"Salva automaticamente cada imagem no seu dispositivo aps a gerao.","image_sequence.tooltip.createZip":"Empacota todas as imagens selecionadas em um nico arquivo ZIP para download."},vb={"imageEditor.title":"Editor de Imagem","imageEditor.canvasResolution":"Resoluo da Tela","imageEditor.background":"Fundo","imageEditor.toolSettings":"Configuraes da Ferramenta","imageEditor.snapToEdges":"Alinhar s Bordas","imageEditor.freeAspect":"Proporo Livre","imageEditor.section.aiRequest":"Solicitao de Modificao IA","imageEditor.input.modificationPlaceholder":'Descreva as alteraes, ex: "mudar fundo para azul"',"imageEditor.action.sendRequest":"Enviar Solicitao","imageEditor.tooltip.removeObject":"Remover (Vermelho) / Manter (Verde)","imageEditor.action.removeObject":"Remover Objeto","imageEditor.tool.transform":"Transformar","imageEditor.tool.hand":"Mo (Pan)","imageEditor.tool.zoom":"Zoom","imageEditor.tool.pencil":"Lpis","imageEditor.tool.rectangle":"Retngulo","imageEditor.action.fit":"Ajustar  Tela","imageEditor.action.fill":"Preencher Tela","imageEditor.action.cancel":"Cancelar","imageEditor.action.resetEdits":"Redefinir Edies","imageEditor.action.apply":"Aplicar","imageViewer.title":"Visualizador de Imagem","imageEditor.outputResolution":"Resoluo de Sada","imageEditor.outputResolutionHelp":'Definir resoluo de sada. Se "Auto", usa a resoluo da tela.',"imageEditor.currentSize":"Tamanho Atual: {width}x{height}","imageEditor.sequenceMode":"Modo Sequncia","imageEditor.sequenceModeHelp":"Processar imagens de entrada da Entrada A sequencialmente.","imageEditor.sequentialCombination":"Combinao Sequencial de Imagens","imageEditor.sequentialCombinationHelp":"Para cada quadro: Envia a imagem atual da Entrada A + Todas as imagens da Entrada B.","imageEditor.sequentialPrompt":"Combinao Sequencial de Prompt","imageEditor.sequentialPromptHelp":"Para cada quadro: Usa um prompt exclusivo da lista + imagem atual.","imageEditor.sequentialEditingWithPrompts":"Edio Sequencial com Prompts","imageEditor.sequentialEditingWithPromptsHelp":"Para cada quadro: Usa imagem da Entrada B + prompt exclusivo. Entrada A  ignorada.","imageEditor.input":"Entrada","imageEditor.inputA":"Entrada A","imageEditor.inputB":"Entrada B","imageEditor.status.queued":"Na Fila","imageEditor.status.generating":"Gerando...","imageEditor.action.regenerate":"Regenerar","imageEditor.tooltip.fit":"Ajustar imagem aos limites da tela (conter).","imageEditor.tooltip.fill":"Escalar imagem para preencher a tela (cobrir).","imageEditor.tooltip.flip":"Virar imagem horizontalmente.","imageEditor.background.white":"Branco","imageEditor.background.gray":"Cinza","imageEditor.background.black":"Preto","imageEditor.background.dark":"Escuro","image_sequence.regenerate":"Regenerar","image_sequence.stop_queue":"Parar Fila","image_sequence.move_up":"Mover para Cima","image_sequence.move_down":"Mover para Baixo","image_sequence.copy_prompt":"Copiar Prompt","image_sequence.add_frame":"Adicionar Quadro","image_sequence.delete_frame":"Excluir Quadro","image_sequence.expand_all_frames":"Expandir/Recolher Todos os Quadros","image_sequence.collapse_all_frames":"Recolher Todos os Quadros","image_sequence.expand_all_scenes":"Expandir/Recolher Todas as Cenas","image_sequence.collapse_all_scenes":"Recolher Todas as Cenas","image_sequence.expand_all":"Expandir Tudo","image_sequence.collapse_all":"Recolher Tudo","image_sequence.clear_all_prompts":"Limpar Todos os Prompts","image_sequence.add_first_frame":"Adicionar Primeiro Quadro","image_sequence.drop_or_add_title":"Soltar JSON de Sequncia ou Adicionar Quadro","image_sequence.drop_or_add_desc":"Solte um arquivo JSON aqui ou clique no boto para adicionar um quadro manualmente.","image_sequence.load_prompts":"Carregar Prompts","image_sequence.output_images_title":"Imagens de Sada","image_sequence.prompts_list_title":"Prompts de Origem","image_sequence.download_selected":"Baixar Selecionados","image_sequence.select_all":"Selecionar Tudo","image_sequence.select_none":"Desmarcar Tudo","image_sequence.invert_selection":"Inverter Seleo","image_sequence.run_selected":"Executar Selecionados","image_sequence.start_queue":"Iniciar Fila","image_sequence.character_prompt_combination":"Combinao de Prompt de Personagem","image_sequence.combination_none":"Nenhum","image_sequence.combination_combine":"Combinar","image_sequence.combination_replace":"Substituir Tags","image_sequence.status.error":"Erro","image_sequence.status.pending":"Na Fila","image_sequence.clear_selected_prompts":"Limpar Prompts Selecionados","image_sequence.range_from":"De:","image_sequence.range_to":"Para:","image_sequence.stats.total":"Total de Quadros: {count}","image_sequence.stats.generated":"Gerados: {count}","image_sequence.stats.queue":"Fila: {count}","image_sequence.edit_in_source":"Editar na Fonte","image_sequence.edit_prompt":"Editar Prompt","image_sequence.select_scene":"Selecionar Cena","image_sequence.next_scene":"Prxima Cena","image_sequence.prev_scene":"Cena Anterior","image_sequence.scene_input_label":"Cena","image_sequence.select_square":"Selecionar Quadrado (1:1)","image_sequence.select_landscape":"Selecionar Paisagem (16:9)","image_sequence.select_portrait":"Selecionar Retrato (9:16)","image_sequence.select_range":"Selecionar Intervalo","image_sequence.force_refresh":"Forar Atualizao","image_sequence.select_scene_frames":"Selecionar todos os quadros nesta cena","image_sequence.collapse_other_scenes":"Recolher outras cenas","prompt_sequence_editor.instructionPlaceholder":"Insira a instruo para modificar prompts...","prompt_sequence_editor.modifying":"Modificando...","prompt_sequence_editor.modifySelected":"Modificar Selecionados ({count})","prompt_sequence_editor.sourcePrompts":"Prompts de Origem","prompt_sequence_editor.finalPrompts":"Prompts Modificados","prompt_sequence_editor.error.invalidInput":"Formato de dados invlido. Por favor conecte um array de sequncia de prompts.","geminiChat.mode.general":"Geral","geminiChat.mode.prompt":"Especialista em Prompt","geminiChat.mode.script":"Roteirista","geminiChat.mode.youtube":"Analista do YouTube","image_sequence.shot_type.WS":"Integre a Entidade com um Plano Aberto (WS) na cena e ao. Mostre o ambiente.","image_sequence.shot_type.MS":"Integre a Entidade com um Plano Mdio (MS) na cena. Personagem da cintura para cima.","image_sequence.shot_type.CU":"Integre a Entidade com um Plano Prximo (CU) na cena.","image_sequence.shot_type.ECU":"Integre a Entidade com um Plano Muito Prximo (ECU) na cena. Mximo detalhe.","image_sequence.shot_type.LS":"Integre a Entidade com um Plano Longo (LS) na cena para mostrar escala."},wb={"dialog.permission.title":"Permisso Necessria","dialog.permission.description":"Este aplicativo precisa de permisso para ler sua rea de transferncia para permitir colar contedo nos ns. Seus dados no so armazenados ou enviados para lugar nenhum.","dialog.permission.allow":"Permitir","dialog.permission.decline":"Recusar","dialog.rename.title":"Renomear Item","dialog.rename.group.title":"Renomear Grupo","dialog.rename.catalog.title":"Renomear Item do Catlogo","dialog.rename.node.title":"Renomear N","dialog.rename.label":"Novo Nome:","dialog.rename.confirm":"Renomear","dialog.rename.cancel":"Cancelar","dialog.promptEdit.title":"Editar Prompt","dialog.promptEdit.nameLabel":"Nome:","dialog.promptEdit.contentLabel":"Contedo:","dialog.promptEdit.confirm":"Salvar","dialog.promptEdit.cancel":"Cancelar","dialog.confirmDelete.title":"Confirmar Excluso","dialog.confirmDelete.message":"Tem certeza de que deseja excluir este item? Esta ao no pode ser desfeita.","dialog.confirmDelete.confirm":"Excluir","dialog.confirmDelete.cancel":"Cancelar","dialog.confirmCloseTab.title":"Fechar Aba","dialog.confirmCloseTab.message":'Tem certeza de que deseja fechar a aba "{tabName}"? As alteraes no salvas sero perdidas.',"dialog.confirmClear.title":"Limpar Tela","dialog.confirmClear.message":"Tem certeza de que deseja limpar toda a tela? Esta ao no pode ser desfeita.","dialog.confirmReset.title":"Redefinir para o Padro","dialog.confirmReset.message":"Tem certeza de que deseja redefinir a tela para o estado padro? Todo o trabalho atual ser perdido.","dialog.confirmReset.confirm":"Redefinir","dialog.confirmLoad.title":"Confirmar Carregamento","dialog.confirmLoad.message":"Carregar um novo arquivo substituir o contedo atual. Quaisquer alteraes no salvas sero perdidas. Continuar?","dialog.apiKey.title":"Selecionar Chave API","dialog.apiKey.description":'Este recurso requer uma chave API de Projeto com a API "AI Platform" ativada. A gerao de vdeo pode levar alguns minutos.',"dialog.apiKey.billingLink":"Saiba mais sobre faturamento","dialog.apiKey.button":"Selecionar Chave API","dialog.settings.title":"Configuraes","dialog.settings.apiKeyLabel":"Sua Chave API Google Gemini:","dialog.settings.useDevKeyLabel":"Usar chave API gratuita (para desenvolvimento)","dialog.settings.instantNodeCloseLabel":"Fechamento instantneo de n","dialog.settings.nodeAnimationLabel":"Animao de Adio de N","dialog.settings.animationModeLabel":"Modo de Animao de Criao","dialog.settings.anim.pulse":"Pulso","dialog.settings.anim.bladeRunner":"Blade Runner","dialog.settings.anim.none":"Nenhum","dialog.settings.description":"Para usar suas prprias cotas e acessar modelos especficos, insira sua chave API pessoal. A chave  armazenada localmente no seu navegador.","dialog.settings.getKeyLink":"Obtenha uma Chave API aqui","dialog.settings.save":"Salvar","dialog.deleteNode.title":"Fechar n?","dialog.deleteNode.titlePlural":"Fechar ns?","dialog.deleteNode.confirm":"Sim","dialog.deleteNode.cancel":"No","dialog.deleteNode.confirmTooltip":"Fechar n - dados perdidos no podem ser recuperados","dialog.deleteNode.cancelTooltip":"No fechar - continuar trabalhando com o n","dialog.deleteNode.dontShowAgain":"No mostrar novamente","dialog.exitApp.title":"Fechar Projeto?","dialog.exitApp.message":"Tem certeza de que deseja fechar o projeto? Todo o trabalho atual ser perdido e a tela ser redefinida."},bb={"group.button.create":"Criar Grupo ({count})","group.rename":"Renomear Grupo","group.saveToCatalog":"Salvar no Catlogo","group.saveToDisk":"Salvar no Disco","group.ungroup":"Desagrupar (Shift+Clique para excluir com contedo)","group.duplicate":"Duplicar grupo com contedo","catalog.tabs.groups":"Grupos","catalog.tabs.library":"Biblioteca","catalog.tabs.characters":"Personagens","catalog.tabs.scripts":"Roteiros","catalog.tabs.sequences":"Sequncias","catalog.back":"Voltar","catalog.load":"Carregar de Arquivo","catalog.newFolder":"Nova Pasta","catalog.saveTo":"Salvar no Catlogo","catalog.card.addToCanvas":"Adicionar  Tela","catalog.card.rename":"Renomear","catalog.card.save":"Salvar","catalog.card.delete":"Excluir","catalog.empty.description":"Esta pasta est vazia. Voc pode adicionar itens ou criar novas pastas.","library.loadFromFile":"Carregar","library.actions.newFolder":"Nova Pasta","library.actions.newPrompt":"Novo Prompt","library.actions.copy":"Copiar","library.actions.edit":"Editar","library.empty.title":"Pasta Vazia","library.empty.description":"Crie prompts e pastas para comear.","library.emptyPrompt":"Prompt vazio"},Cb={...fb,...xb,...yb,...vb,...wb,...bb},kb={"app.title":"","app.subtitle":"","app.error.title":"","app.error.copy":"","app.error.copied":"","error.apiKey":" API  API ","error.scriptModifierCanvas":" - Script Modifier Script Modifier ","welcome.title":"","welcome.description":"","welcome.apiKeyLabel":" Google Gemini API ","welcome.apiKeyPlaceholder":" API ...","welcome.apiKeyHelp":" API ","welcome.getKeyLink":" API ","welcome.iAmDeveloper":"","welcome.letsGo":"","welcome.resume":"","welcome.startNew":"","welcome.freeModeActive":"","welcome.selectLanguage":"","welcome.navHint":"    ","toast.contentCleared":"","toast.downloadStarted":"","toast.characterLoaded":"","toast.characterSavedDisk":"","toast.copiedToClipboard":"","toast.pastedFromClipboard":"","toast.pasteFailed":"","toast.nodeDuplicated":"","toast.groupSavedToDisk":' "{groupTitle}" ',"toast.groupDeleted":"","toast.characterSavedCatalog":"","toast.promptSaved":"{promptName}...","toast.connectionsCut":"","toast.apiKeySaved":"API ","toast.cacheCleared":" {count} ","toast.cacheEmpty":"","toast.scriptSaved":"","alert.groupSaved":' "{groupTitle}" ',"alert.loadCatalogFailed":"","alert.invalidCatalogFile":"","alert.fileNotSupported":' "appName"',"alert.invalidCatalogStructure":' "root"',"tutorial.step1":"","tutorial.step2":" AI ","tutorial.step2_waiting":"AI ...","tutorial.step3":"","tutorial.step3b":"","tutorial.step4":"","tutorial.group.catalog":"","tutorial.group.general":"","tutorial.group.input":"","tutorial.group.processing":" AI ","tutorial.group.character":"","tutorial.group.output":"","tutorial.group.ai":" Gemini ","tutorial.group.video":"","tutorial.group.scripts":"","tutorial.group.file":"","tutorial.success.title":"","tutorial.success.message":"","tutorial.success.button":"","tutorial.skip":"","tutorial.next":"","tutorial.finish":""},_b={"toolbar.settings":"","toolbar.resetCanvas":"","toolbar.clearCache":"","toolbar.home":"","toolbar.edit":" (V)","toolbar.cutter":" (C) / ( Ctrl)","toolbar.selection":" (S) / ( Shift)","toolbar.reroute":" (R) / ( Ctrl+Alt)","toolbar.zoom":" ( Z)","toolbar.snapToGrid":"","toolbar.smartGuides":"","toolbar.lineStyleSpaghetti":"","toolbar.lineStyleOrthogonal":"","toolbar.resetZoom":"","toolbar.resetCamera":"","toolbar.clearCanvas":"","toolbar.addNode":" (F)","toolbar.catalog":" (Ctrl + Space)","toolbar.addNote":" (N)","toolbar.addDataReader":" (Shift + R)","toolbar.addTextInput":" (T)","toolbar.addImageInput":" (I)","toolbar.addPromptSequenceEditor":" (Q)","toolbar.addImageAnalyzer":" (Shift+A)","toolbar.addPromptAnalyzer":" (A)","toolbar.addPromptProcessor":" (P)","toolbar.addCharacterGenerator":" (Shift+C)","toolbar.addCharacterAnalyzer":" (Ctrl+Shift+A)","toolbar.addCharacterCard":" (Ctrl+Shift+C)","toolbar.addImageOutput":" (O)","toolbar.addImageEditor":" AI  (Shift+I)","toolbar.addImageSequenceGenerator":" (Shift+Q)","toolbar.addTranslator":" (L)","toolbar.addGeminiChat":" Gemini  (M)","toolbar.addVideoPromptProcessor":" (Shift+P)","toolbar.addVideoOutput":" (Shift+O)","toolbar.addScriptGenerator":"","toolbar.addScriptViewer":" (Shift + V)","toolbar.saveCanvas":" (Ctrl + S)","toolbar.saveProject":"","toolbar.loadCanvas":"/ (Ctrl + O)","toolbar.group.general":"","toolbar.group.catalog":"","toolbar.group.input":"","toolbar.group.processing":"","toolbar.group.character":"","toolbar.group.output":"","toolbar.group.aiTools":"AI ","toolbar.group.video":"","toolbar.group.scripts":"","toolbar.group.file":"","toolbar.title":"","toolbar.dock":"","toolbar.detach":"","toolbar.expandPanel":"","toolbar.collapsePanel":"","toolbar.dockArea.title":"","toolbar.duplicate":"","toolbar.duplicateWithContent":"","toolbar.dock.q1":" 1/4","toolbar.dock.q2":" 2/4","toolbar.dock.q3":" 3/4","toolbar.dock.q4":" 4/4","toolbar.dock.tl":"","toolbar.dock.bl":"","toolbar.dock.tr":"","toolbar.dock.br":"","toolbar.dock.left":"","toolbar.dock.right":"","toolbar.dock.full":"","toolbar.dock.exitFull":"","toolbar.dock.fullFocus":"","hotkeys.show":"","hotkeys.tools.title":"","hotkeys.tools.edit":"","hotkeys.tools.cutter":"","hotkeys.tools.selection":"","hotkeys.tools.reroute":"","hotkeys.tools.zoom":"","hotkeys.tools.toggleLineStyle":"","hotkeys.tools.group":"","hotkeys.tools.closeNode":"","hotkeys.tools.duplicate":"","hotkeys.tools.duplicateWithContent":"","hotkeys.tools.deleteGroup":" (Shift+Click)","hotkeys.windows.title":"","hotkeys.windows.search":"","hotkeys.windows.catalog":"","hotkeys.createNode.title":"","help.panelTitle":"","help.subtitle":"","help.title":"","help.howToUse.title":"","help.howToUse.content":"","help.author":"","help.tab.links":"","help.section.socials":"","help.section.studioStable":"Google AI Studio ()","help.section.studioAlpha":"Google AI Studio (Alpha)","help.section.netlify":"Netlify ","help.section.github":"GitHub ","help.license":" GNU GPLv3 ","help.copyLink":"","help.copied":"","contextMenu.undoPosition":"","contextMenu.redoPosition":"","contextMenu.align.left":" (F)","contextMenu.align.centerX":" (E)","contextMenu.align.right":" (R)","contextMenu.align.top":" (T)","contextMenu.align.centerY":" (D)","contextMenu.align.bottom":" (B)","contextMenu.distribute.horizontal":" (Ctrl+D)","contextMenu.distribute.vertical":" (Ctrl+E)","contextMenu.emptySlot":" ()","contextMenu.saveSlots":"","contextMenu.loadSlots":"","quickadd.title":"","quickadd.group.tools":"","quickadd.group.inputs":"","quickadd.group.processing":"","quickadd.group.character":"","quickadd.group.outputs":"","quickadd.group.ai":"AI ","quickadd.group.video":"","quickadd.group.scripts":"","quickadd.group.general":"","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"","quickadd.tool.cutter":"","quickadd.tool.selection":"","search.placeholder":"...","search.noResults":"","search.group.input":" & ","search.group.process":" & ","search.group.output":" & ","search.group.ai":"AI ","search.group.video":" & ","search.group.scripts":"","toolbar.exitApp":""},Sb={"node.title.text_input":"","node.title.image_input":"","node.title.prompt_processor":"","node.title.prompt_sanitizer":"","node.title.video_prompt_processor":"","node.title.image_output":"","node.title.video_output":"","node.title.prompt_analyzer":"","node.title.character_analyzer":"","node.title.character_generator":"","node.title.character_card":"","node.title.image_analyzer":"","node.title.image_editor":"AI ","node.title.image_sequence_generator":"","node.title.prompt_sequence_editor":"","node.title.gemini_chat":"Gemini ","node.title.translator":"","node.title.script_generator":"","node.title.script_viewer":"","node.title.note":"","node.title.reroute_dot":"","node.title.data_reader":"","node.title.video_editor":" Alpha","node.title.media_viewer":"","node.title.data_protection":"","node.title.pose_creator":"Pose Creator","node.help.text_input":"","node.help.image_input":"","node.help.prompt_processor":" AI ","node.help.prompt_sanitizer":"","node.help.video_prompt_processor":"","node.help.image_output":"","node.help.video_output":" Veo ","node.help.prompt_analyzer":"","node.help.character_analyzer":"","node.help.character_generator":"","node.help.character_card":"","node.help.image_analyzer":" AI ","node.help.image_editor":"/","node.help.image_sequence_generator":"","node.help.prompt_sequence_editor":" AI ","node.help.gemini_chat":" Gemini ","node.help.translator":" AI ","node.help.script_generator":"","node.help.script_viewer":"","node.help.note":"","node.help.reroute_dot":"","node.help.data_reader":"","node.help.video_editor":"","node.help.media_viewer":" and ","node.help.data_protection":"","node.help.pose_creator":"","node.action.expand":"","node.action.collapse":"","node.action.help":"","node.action.download":"","node.action.clear":"","node.action.refreshChat":"","node.action.paste":"","node.action.resetEditor":"","node.action.saveCharacter":"","node.action.loadCharacter":"","node.action.copy":"","node.action.copyImage":"","node.action.copyTextPrompt":"","node.action.copyImagePrompt":"","node.action.copyVideoPrompt":"","node.action.cutConnections":"","node.action.close":"","node.action.closeNode":" (Shift+Click )","node.action.closeNodeSimple":"","node.action.randomWord":"","node.action.processImage":"","node.action.processImageTitle":" Gemini ","node.action.editor":"","node.action.rasterEditor":"","node.action.openInAIEditor":" AI ","node.action.openInAnalyzer":"","node.action.outputToInput":"","node.action.processChainForward":"","node.action.executeChain":"","node.action.executeChainTitle":"","node.action.sanitize":"","node.action.rename":"","node.action.stop":"","node.action.stopping":"...","node.action.deleteItem":"","node.action.detachAndPaste":"","node.action.delete":"","node.action.flipImage":"","node.action.pin":"","node.action.unpin":"","node.mediaViewer.play":"","node.mediaViewer.pause":"","node.mediaViewer.stop":"","node.mediaViewer.addMarker":"","node.mediaViewer.exportSRT":" (SRT)","node.mediaViewer.deleteAllMarkers":"","node.mediaViewer.saveMarkers":"","node.mediaViewer.loadMarkers":"","node.mediaViewer.relink":"","node.content.notePlaceholder":"...","node.content.dropImage":"","node.content.dropMedia":"","node.content.processing":"...","node.content.processingChain":"...","node.content.metadataPrompt":"","node.content.metadataPromptPlaceholder":"","node.content.copyPrompt":"","node.content.prompt":"","node.content.inputPrompt":"","node.content.enhancedResult":"","node.content.videoPrompt":"","node.content.editPromptPlaceholder":"...","node.content.enhancedPromptHere":"...","node.content.safePrompt":"","node.content.generating":"...","node.content.imageHere":"","node.content.generationMode":"","node.content.aspectRatio":"","node.content.aspectRatioHelp":"","node.content.aspectRatioNotSupportedFast":" Imagen ","node.content.enableAspectRatioFormatting":"","node.content.autoDownload":"","node.content.generateImage":"","node.content.enhancing":"...","node.content.enhancePrompt":"","node.content.sanitizing":"...","node.content.sanitizedPromptHere":"...","node.content.analyzing":"...","node.content.analyzePrompt":"","node.content.analyzeImage":"","node.content.imageToText":"","node.content.updatePromptFromImage":"","node.content.analyzeCharacter":"","node.content.generateCharacters":"","node.content.characterPromptPlaceholder":"...","node.content.character":"","node.content.clothing":"","node.content.characterPlaceholder":"...","node.content.clothingPlaceholder":"...","node.content.appearance":"","node.content.personality":"","node.content.environment":"/","node.content.action":"","node.content.emotion":"","node.content.style":"","node.content.environmentPlaceholder":"...","node.content.charactersPlaceholder":"...","node.content.characters":"","node.content.characterConcepts":"","node.content.actionPlaceholder":"...","node.content.emotionPlaceholder":"...","node.content.stylePlaceholder":"...","node.content.descriptionHere":"...","node.content.enableOutpainting":"","node.content.outpaintingPromptPlaceholder":"...","node.content.inputImage":"","node.content.dropOrClick":"","node.content.outputImage":"","node.content.applyEdit":"","node.content.editing":"...","node.content.chatPlaceholder":"...","node.content.connectedPlaceholder":"","node.content.connectedNode":"","node.content.connectedEmpty":"","node.content.translatePlaceholder":"...","node.content.translatedTextPlaceholder":"...","node.content.targetLanguage":"","node.content.translate":"","node.content.translating":"...","node.content.scriptPromptPlaceholder":"...","node.content.generateScript":"","node.content.loadScript":"","node.content.summary":"","node.content.scenes":"","node.content.unrecognizedFormat":"","node.content.frames":"","node.content.characterIndex":"","node.content.readData":"","node.content.textDataHere":"","node.content.noDataRead":"","node.content.previewError":"","node.content.previewPlaceholder":"","node.content.imagePrompt":"","node.output.allPromptData":"","node.note.tab.note":"","node.note.tab.references":"","node.note.nestedImages":"","node.note.dropPlaceholder":"","node.note.addCaption":"","node.note.action.shuffle":"","node.note.action.undoShuffle":"","node.content.characterTypeShort":":","node.content.numberOfCharactersShort":":","node.content.characterType.simple":"","node.content.characterType.anthro":"","node.content.characterType.chibi":"Q","node.content.characterType.key_item":"","node.content.style.simple":"","node.content.style.realistic":"","node.content.style.3d_cartoon":"3D ","node.content.style.3d_realistic":"3D ","node.content.style.2d_animation":"2D ","node.content.style.anime":"","node.content.style.comics":"","node.content.style.custom":"","node.content.fullDescriptionTitle":"","node.content.integrationInstruction":"","node.content.additionalPromptSuffix":" ()","search.node.text_input.title":"","search.node.text_input.description":"","search.node.image_input.title":"","search.node.image_input.description":"","search.node.prompt_sequence_editor.title":"","search.node.prompt_sequence_editor.description":"","search.node.data_reader.title":"","search.node.data_reader.description":"","search.node.note.title":"","search.node.note.description":"","search.node.prompt_processor.title":"","search.node.prompt_processor.description":"","search.node.prompt_analyzer.title":"","search.node.prompt_analyzer.description":"","search.node.prompt_sanitizer.title":"","search.node.prompt_sanitizer.description":" AI ","search.node.character_card.title":"","search.node.character_card.description":"","search.node.character_analyzer.title":"","search.node.character_analyzer.description":"","search.node.character_generator.title":"","search.node.character_generator.description":"","search.node.image_analyzer.title":"","search.node.image_analyzer.description":" AI ","search.node.image_editor.title":"AI ","search.node.image_editor.description":"","search.node.image_sequence_generator.title":"","search.node.image_sequence_generator.description":"","search.node.gemini_chat.title":"Gemini ","search.node.gemini_chat.description":" Gemini ","search.node.translator.title":"","search.node.translator.description":" AI ","search.node.script_generator.title":"","search.node.script_generator.description":"","search.node.script_viewer.title":"","search.node.script_viewer.description":"","search.node.note":"","search.node.reroute_dot":"","search.node.video_prompt_processor.title":"","search.node.video_prompt_processor.description":"","search.node.video_output.title":"","search.node.video_output.description":" Veo ","search.node.image_output.title":"","search.node.image_output.description":"","search.node.media_viewer.title":"","search.node.media_viewer.description":" and ","search.node.data_protection.title":"","search.node.data_protection.description":"","search.node.pose_creator.title":"Pose Creator","search.node.pose_creator.description":"","prompt_sequence_editor.instructionPlaceholder":"...","prompt_sequence_editor.modifying":"...","prompt_sequence_editor.modifySelected":" ({count})","prompt_sequence_editor.sourcePrompts":"","prompt_sequence_editor.finalPrompts":"","prompt_sequence_editor.error.invalidInput":"","geminiChat.mode.general":"","geminiChat.mode.prompt":"","geminiChat.mode.script":"","geminiChat.mode.youtube":"YouTube ","image_sequence.deselect_scene":"","image_sequence.clear_prompts_only":"","image_sequence.prev_scene":"","image_sequence.next_scene":"","image_sequence.frames_hidden":"({count} )","image_sequence.frames_count":"({count} )","node.content.modificationRequest":"","node.content.technicalPrompt":"","node.promptProcessor.safePromptTooltip":"","node.promptProcessor.technicalPromptTooltip":"","node.promptProcessor.enhanceTooltip":" AI ","node.promptProcessor.chainTooltip":"","image_sequence.tooltip.autoCrop":" 16:9 ","image_sequence.tooltip.autoDownload":"","image_sequence.tooltip.createZip":" ZIP "},Nb={"imageEditor.title":"","imageEditor.canvasResolution":"","imageEditor.background":"","imageEditor.toolSettings":"","imageEditor.snapToEdges":"","imageEditor.freeAspect":"","imageEditor.section.aiRequest":"AI ","imageEditor.input.modificationPlaceholder":"","imageEditor.action.sendRequest":"","imageEditor.tooltip.removeObject":" () /  ()","imageEditor.action.removeObject":"","imageEditor.tool.transform":"","imageEditor.tool.hand":" ()","imageEditor.tool.zoom":"","imageEditor.tool.pencil":"","imageEditor.tool.rectangle":"","imageEditor.action.fit":"","imageEditor.action.fill":"","imageEditor.action.cancel":"","imageEditor.action.resetEdits":"","imageEditor.action.apply":"","imageViewer.title":"","imageEditor.outputResolution":"","imageEditor.outputResolutionHelp":"","imageEditor.currentSize":": {width}x{height}","imageEditor.sequenceMode":"","imageEditor.sequenceModeHelp":" A ","imageEditor.sequentialCombination":"","imageEditor.sequentialCombinationHelp":" A  +  B ","imageEditor.sequentialPrompt":"","imageEditor.sequentialPromptHelp":" + ","imageEditor.sequentialEditingWithPrompts":"","imageEditor.sequentialEditingWithPromptsHelp":" B  +  A ","imageEditor.input":"","imageEditor.inputA":" A","imageEditor.inputB":" B","imageEditor.status.queued":"","imageEditor.status.generating":"...","imageEditor.action.regenerate":"","imageEditor.tooltip.fit":" (contain)","imageEditor.tooltip.fill":" (cover)","imageEditor.tooltip.flip":"","imageEditor.background.white":"","imageEditor.background.gray":"","imageEditor.background.black":"","imageEditor.background.dark":"","image_sequence.regenerate":"","image_sequence.stop_queue":"","image_sequence.move_up":"","image_sequence.move_down":"","image_sequence.copy_prompt":"","image_sequence.add_frame":"","image_sequence.delete_frame":"","image_sequence.expand_all_frames":"/","image_sequence.collapse_all_frames":"","image_sequence.expand_all_scenes":"/","image_sequence.collapse_all_scenes":"","image_sequence.expand_all":"","image_sequence.collapse_all":"","image_sequence.clear_all_prompts":"","image_sequence.add_first_frame":"","image_sequence.drop_or_add_title":" JSON ","image_sequence.drop_or_add_desc":" JSON ","image_sequence.load_prompts":"","image_sequence.output_images_title":"","image_sequence.prompts_list_title":"","image_sequence.download_selected":"","image_sequence.select_all":"","image_sequence.select_none":"","image_sequence.invert_selection":"","image_sequence.run_selected":"","image_sequence.start_queue":"","image_sequence.character_prompt_combination":"","image_sequence.combination_none":"","image_sequence.combination_combine":"","image_sequence.combination_replace":"","image_sequence.status.error":"","image_sequence.status.pending":"","image_sequence.clear_selected_prompts":"","image_sequence.range_from":":","image_sequence.range_to":":","image_sequence.stats.total":": {count}","image_sequence.stats.generated":": {count}","image_sequence.stats.queue":": {count}","image_sequence.edit_in_source":"","image_sequence.edit_prompt":"","image_sequence.select_scene":"","image_sequence.next_scene":"","image_sequence.prev_scene":"","image_sequence.scene_input_label":"","image_sequence.select_square":" (1:1)","image_sequence.select_landscape":" (16:9)","image_sequence.select_portrait":" (9:16)","image_sequence.select_range":"","image_sequence.force_refresh":"","image_sequence.select_scene_frames":"","image_sequence.collapse_other_scenes":"","prompt_sequence_editor.instructionPlaceholder":"...","prompt_sequence_editor.modifying":"...","prompt_sequence_editor.modifySelected":" ({count})","prompt_sequence_editor.sourcePrompts":"","prompt_sequence_editor.finalPrompts":"","prompt_sequence_editor.error.invalidInput":"","geminiChat.mode.general":"","geminiChat.mode.prompt":"","geminiChat.mode.script":"","geminiChat.mode.youtube":"YouTube ","image_sequence.shot_type.WS":" (WS) ","image_sequence.shot_type.MS":" (MS) ","image_sequence.shot_type.CU":" (CU) ","image_sequence.shot_type.ECU":" (ECU) ","image_sequence.shot_type.LS":" (LS) "},Eb={"dialog.permission.title":"","dialog.permission.description":"","dialog.permission.allow":"","dialog.permission.decline":"","dialog.rename.title":"","dialog.rename.group.title":"","dialog.rename.catalog.title":"","dialog.rename.node.title":"","dialog.rename.label":"","dialog.rename.confirm":"","dialog.rename.cancel":"","dialog.promptEdit.title":"","dialog.promptEdit.nameLabel":"","dialog.promptEdit.contentLabel":"","dialog.promptEdit.confirm":"","dialog.promptEdit.cancel":"","dialog.confirmDelete.title":"","dialog.confirmDelete.message":"","dialog.confirmDelete.confirm":"","dialog.confirmDelete.cancel":"","dialog.confirmCloseTab.title":"","dialog.confirmCloseTab.message":' "{tabName}" ',"dialog.confirmClear.title":"","dialog.confirmClear.message":"","dialog.confirmReset.title":"","dialog.confirmReset.message":"","dialog.confirmReset.confirm":"","dialog.confirmLoad.title":"","dialog.confirmLoad.message":"","dialog.apiKey.title":" API ","dialog.apiKey.description":' "AI Platform" API  API ',"dialog.apiKey.billingLink":"","dialog.apiKey.button":" API ","dialog.settings.title":"","dialog.settings.apiKeyLabel":" Google Gemini API ","dialog.settings.useDevKeyLabel":" API ","dialog.settings.instantNodeCloseLabel":"","dialog.settings.nodeAnimationLabel":"","dialog.settings.animationModeLabel":"","dialog.settings.anim.pulse":"","dialog.settings.anim.bladeRunner":"","dialog.settings.anim.none":"","dialog.settings.description":" API ","dialog.settings.getKeyLink":" API ","dialog.settings.save":"","dialog.deleteNode.title":"","dialog.deleteNode.titlePlural":"","dialog.deleteNode.confirm":"","dialog.deleteNode.cancel":"","dialog.deleteNode.confirmTooltip":" - ","dialog.deleteNode.cancelTooltip":" - ","dialog.deleteNode.dontShowAgain":"","dialog.exitApp.title":"","dialog.exitApp.message":""},Pb={"group.button.create":" ({count})","group.rename":"","group.saveToCatalog":"","group.saveToDisk":"","group.ungroup":" (Shift+Click )","group.duplicate":"","catalog.tabs.groups":"","catalog.tabs.library":"","catalog.tabs.characters":"","catalog.tabs.scripts":"","catalog.tabs.sequences":"","catalog.back":"","catalog.load":"","catalog.newFolder":"","catalog.saveTo":"","catalog.card.addToCanvas":"","catalog.card.rename":"","catalog.card.save":"","catalog.card.delete":"","catalog.empty.description":"","library.loadFromFile":"","library.actions.newFolder":"","library.actions.newPrompt":"","library.actions.copy":"","library.actions.edit":"","library.empty.title":"","library.empty.description":"","library.emptyPrompt":""},Tb={...kb,..._b,...Sb,...Nb,...Eb,...Pb},Ib={"app.title":"","app.subtitle":"","app.error.title":"","app.error.copy":"","app.error.copied":"","error.apiKey":"APIAPI","error.scriptModifierCanvas":"Script ModifierScript Modifier","welcome.title":"","welcome.description":"Prompt Modifier","welcome.apiKeyLabel":"Google Gemini API","welcome.apiKeyPlaceholder":"API...","welcome.apiKeyHelp":"API","welcome.getKeyLink":"API","welcome.iAmDeveloper":"","welcome.letsGo":"","welcome.resume":"","welcome.startNew":"","welcome.freeModeActive":"","welcome.selectLanguage":"","welcome.navHint":"    ","toast.contentCleared":"","toast.downloadStarted":"","toast.characterLoaded":"","toast.characterSavedDisk":"","toast.copiedToClipboard":"","toast.pastedFromClipboard":"","toast.pasteFailed":"","toast.nodeDuplicated":"","toast.groupSavedToDisk":' "{groupTitle}" ',"toast.groupDeleted":"","toast.characterSavedCatalog":"","toast.promptSaved":": {promptName}...","toast.connectionsCut":"","toast.apiKeySaved":"API","toast.cacheCleared":"{count} ","toast.cacheEmpty":"","toast.scriptSaved":"","alert.groupSaved":' "{groupTitle}" ',"alert.loadCatalogFailed":"","alert.invalidCatalogFile":"","alert.fileNotSupported":'"appName" ',"alert.invalidCatalogStructure":'"root" ',"tutorial.step1":"","tutorial.step2":"AI","tutorial.step2_waiting":"AI...","tutorial.step3":"","tutorial.step3b":"","tutorial.step4":"","tutorial.group.catalog":"","tutorial.group.general":"","tutorial.group.input":"","tutorial.group.processing":"AI","tutorial.group.character":"","tutorial.group.output":"","tutorial.group.ai":"Gemini","tutorial.group.video":"","tutorial.group.scripts":"","tutorial.group.file":"","tutorial.success.title":"","tutorial.success.message":"Prompt Modifier","tutorial.success.button":"","tutorial.skip":"","tutorial.next":"","tutorial.finish":""},jb={"toolbar.settings":"","toolbar.resetCanvas":"","toolbar.clearCache":"","toolbar.home":"","toolbar.edit":" (V)","toolbar.cutter":" (C) / (Ctrl)","toolbar.selection":" (S) / (Shift)","toolbar.reroute":" (R) / (Ctrl+Alt)","toolbar.zoom":" (Z)","toolbar.snapToGrid":"","toolbar.smartGuides":"","toolbar.lineStyleSpaghetti":"","toolbar.lineStyleOrthogonal":"","toolbar.resetZoom":"","toolbar.resetCamera":"","toolbar.clearCanvas":"","toolbar.addNode":" (F)","toolbar.catalog":" (Ctrl + Space)","toolbar.addNote":" (N)","toolbar.addDataReader":" (Shift + R)","toolbar.addTextInput":" (T)","toolbar.addImageInput":" (I)","toolbar.addPromptSequenceEditor":" (Q)","toolbar.addImageAnalyzer":" (Shift+A)","toolbar.addPromptAnalyzer":" (A)","toolbar.addPromptProcessor":" (P)","toolbar.addCharacterGenerator":" (Shift+C)","toolbar.addCharacterAnalyzer":" (Ctrl+Shift+A)","toolbar.addCharacterCard":" (Ctrl+Shift+C)","toolbar.addImageOutput":" (O)","toolbar.addImageEditor":"AI (Shift+I)","toolbar.addImageSequenceGenerator":" (Shift+Q)","toolbar.addTranslator":" (L)","toolbar.addGeminiChat":"Gemini (M)","toolbar.addVideoPromptProcessor":" (Shift+P)","toolbar.addVideoOutput":" (Shift+O)","toolbar.addScriptGenerator":"","toolbar.addScriptViewer":" (Shift + V)","toolbar.saveCanvas":" (Ctrl + S)","toolbar.saveProject":"","toolbar.loadCanvas":"/ (Ctrl + O)","toolbar.group.general":"","toolbar.group.catalog":"","toolbar.group.input":"","toolbar.group.processing":"","toolbar.group.character":"","toolbar.group.output":"","toolbar.group.aiTools":"AI","toolbar.group.video":"","toolbar.group.scripts":"","toolbar.group.file":"","toolbar.title":"","toolbar.dock":"","toolbar.detach":"","toolbar.expandPanel":"","toolbar.collapsePanel":"","toolbar.dockArea.title":"","toolbar.duplicate":"","toolbar.duplicateWithContent":"","toolbar.dock.q1":" 1/4","toolbar.dock.q2":" 2/4","toolbar.dock.q3":" 3/4","toolbar.dock.q4":" 4/4","toolbar.dock.tl":"","toolbar.dock.bl":"","toolbar.dock.tr":"","toolbar.dock.br":"","toolbar.dock.left":"","toolbar.dock.right":"","toolbar.dock.full":"","toolbar.dock.exitFull":"","toolbar.dock.fullFocus":"","hotkeys.show":"","hotkeys.tools.title":"","hotkeys.tools.edit":"","hotkeys.tools.cutter":"","hotkeys.tools.selection":"","hotkeys.tools.reroute":"","hotkeys.tools.zoom":"","hotkeys.tools.toggleLineStyle":"","hotkeys.tools.group":"","hotkeys.tools.closeNode":"","hotkeys.tools.duplicate":"","hotkeys.tools.duplicateWithContent":"","hotkeys.tools.deleteGroup":" (Shift+)","hotkeys.windows.title":"","hotkeys.windows.search":"","hotkeys.windows.catalog":"","hotkeys.createNode.title":"","help.panelTitle":" & ","help.subtitle":"","help.title":"","help.howToUse.title":"","help.howToUse.content":"Prompt Modifier","help.author":"","help.tab.links":" & ","help.section.socials":"","help.section.studioStable":"Google AI Studio ()","help.section.studioAlpha":"Google AI Studio ()","help.section.netlify":"Netlify ","help.section.github":"GitHub ","help.license":"GNU GPLv3 ","help.copyLink":"","help.copied":"","contextMenu.undoPosition":"","contextMenu.redoPosition":"","contextMenu.align.left":" (F)","contextMenu.align.centerX":" (E)","contextMenu.align.right":" (R)","contextMenu.align.top":" (T)","contextMenu.align.centerY":" (D)","contextMenu.align.bottom":" (B)","contextMenu.distribute.horizontal":" (Ctrl+D)","contextMenu.distribute.vertical":" (Ctrl+E)","contextMenu.emptySlot":" ()","contextMenu.saveSlots":"","contextMenu.loadSlots":"","quickadd.title":"","quickadd.group.tools":"","quickadd.group.inputs":"","quickadd.group.processing":"","quickadd.group.character":"","quickadd.group.outputs":"","quickadd.group.ai":"AI","quickadd.group.video":"","quickadd.group.scripts":"","quickadd.group.general":"","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"","quickadd.tool.cutter":"","quickadd.tool.selection":"","search.placeholder":"...","search.noResults":"","search.group.input":" & ","search.group.process":" & ","search.group.output":" & ","search.group.ai":"AI","search.group.video":" & ","search.group.scripts":"","toolbar.exitApp":""},Ab={"node.title.text_input":"","node.title.image_input":"","node.title.prompt_processor":"","node.title.prompt_sanitizer":"","node.title.video_prompt_processor":"","node.title.image_output":"","node.title.video_output":"","node.title.prompt_analyzer":"","node.title.character_analyzer":"","node.title.character_generator":"","node.title.character_card":"","node.title.image_analyzer":"","node.title.image_editor":"AI","node.title.image_sequence_generator":"","node.title.prompt_sequence_editor":"","node.title.gemini_chat":"Gemini","node.title.translator":"","node.title.script_generator":"","node.title.script_viewer":"","node.title.note":"","node.title.reroute_dot":"","node.title.data_reader":"","node.title.video_editor":" (Alpha)","node.title.media_viewer":"","node.title.data_protection":"","node.title.pose_creator":"","node.help.text_input":"","node.help.image_input":"","node.help.prompt_processor":"AI1","node.help.prompt_sanitizer":"","node.help.video_prompt_processor":"","node.help.image_output":"","node.help.video_output":"Veo","node.help.prompt_analyzer":"","node.help.character_analyzer":"","node.help.character_generator":"","node.help.character_card":"","node.help.image_analyzer":"AI","node.help.image_editor":"/","node.help.image_sequence_generator":"","node.help.prompt_sequence_editor":"AI","node.help.gemini_chat":"Gemini","node.help.translator":"AI","node.help.script_generator":"","node.help.script_viewer":"","node.help.note":"","node.help.reroute_dot":"","node.help.data_reader":"","node.help.video_editor":"","node.help.media_viewer":"","node.help.data_protection":"","node.help.pose_creator":"","node.action.expand":"","node.action.collapse":"","node.action.help":"","node.action.download":"","node.action.clear":"","node.action.refreshChat":"","node.action.paste":"","node.action.resetEditor":"","node.action.saveCharacter":"","node.action.loadCharacter":"","node.action.copy":"","node.action.copyImage":"","node.action.copyTextPrompt":"","node.action.copyImagePrompt":"","node.action.copyVideoPrompt":"","node.action.cutConnections":"","node.action.close":"","node.action.closeNode":" (Shift+)","node.action.closeNodeSimple":"","node.action.randomWord":"","node.action.processImage":"","node.action.processImageTitle":"Gemini","node.action.editor":"","node.action.rasterEditor":"","node.action.openInAIEditor":"AI","node.action.openInAnalyzer":"","node.action.outputToInput":"","node.action.processChainForward":"","node.action.executeChain":"","node.action.executeChainTitle":"","node.action.sanitize":"","node.action.rename":"","node.action.stop":"","node.action.stopping":"...","node.action.deleteItem":"","node.action.detachAndPaste":"","node.action.delete":"","node.action.flipImage":"","node.action.pin":"","node.action.unpin":"","node.action.updateDescription":"","node.action.modifyCharacter":"","node.action.updateDataFormat":"","node.action.expand169":"16:9","node.action.expand916":"9:16","node.action.sync":"","node.action.expandRatio":"","node.action.markPrimary":"","node.action.addCard":"","node.action.removeCard":"","node.action.showOutputs":"","node.action.hideOutputs":"","node.action.characterConcept":"","node.action.objectConcept":"","node.mediaViewer.play":"","node.mediaViewer.pause":"","node.mediaViewer.stop":"","node.mediaViewer.addMarker":"","node.mediaViewer.exportSRT":" (SRT)","node.mediaViewer.deleteAllMarkers":"","node.mediaViewer.saveMarkers":"","node.mediaViewer.loadMarkers":"","node.mediaViewer.relink":"","node.content.notePlaceholder":"...","node.content.dropImage":"","node.content.dropMedia":"","node.content.processing":"...","node.content.processingChain":"...","node.content.metadataPrompt":":","node.content.metadataPromptPlaceholder":"","node.content.copyPrompt":"","node.content.prompt":"","node.content.inputPrompt":"","node.content.enhancedResult":"","node.content.videoPrompt":"","node.content.editPromptPlaceholder":"...","node.content.enhancedPromptHere":"...","node.content.safePrompt":"","node.content.generating":"...","node.content.imageHere":"","node.content.generationMode":"","node.content.aspectRatio":"","node.content.aspectRatioHelp":"","node.content.aspectRatioNotSupportedFast":"Imagen","node.content.enableAspectRatioFormatting":"","node.content.autoDownload":"","node.content.generateImage":"","node.content.enhancing":"...","node.content.enhancePrompt":"","node.content.sanitizing":"...","node.content.sanitizedPromptHere":"...","node.content.analyzing":"...","node.content.analyzePrompt":"","node.content.analyzeImage":"","node.content.imageToText":"","node.content.updatePromptFromImage":"","node.content.analyzeCharacter":"","node.content.generateCharacters":"","node.content.characterPromptPlaceholder":"...","node.content.character":"","node.content.clothing":"","node.content.characterPlaceholder":"...","node.content.clothingPlaceholder":"...","node.content.appearance":"","node.content.personality":"","node.content.environment":"/","node.content.action":"","node.content.emotion":"","node.content.style":"","node.content.environmentPlaceholder":"...","node.content.charactersPlaceholder":"...","node.content.characters":"","node.content.characterConcepts":"","node.content.actionPlaceholder":"...","node.content.emotionPlaceholder":"...","node.content.stylePlaceholder":"...","node.content.descriptionHere":"...","node.content.enableOutpainting":"","node.content.outpaintingPromptPlaceholder":"...","node.content.inputImage":"","node.content.dropOrClick":"","node.content.outputImage":"","node.content.applyEdit":"","node.content.editing":"...","node.content.chatPlaceholder":"...","node.content.connectedPlaceholder":"","node.content.connectedNode":"","node.content.connectedEmpty":"","node.content.translatePlaceholder":"...","node.content.translatedTextPlaceholder":"...","node.content.targetLanguage":"","node.content.translate":"","node.content.translating":"...","node.content.scriptPromptPlaceholder":"...","node.content.generateScript":"","node.content.loadScript":"","node.content.summary":"","node.content.scenes":"","node.content.unrecognizedFormat":"","node.content.frames":"","node.content.characterIndex":"","node.content.readData":"","node.content.textDataHere":"","node.content.noDataRead":"","node.content.previewError":"","node.content.previewPlaceholder":"","node.content.imagePrompt":"","node.output.allPromptData":"","node.note.tab.note":"","node.note.tab.references":"","node.note.nestedImages":"","node.note.dropPlaceholder":"","node.note.addCaption":"","node.note.action.shuffle":"","node.note.action.undoShuffle":"","node.content.characterTypeShort":":","node.content.numberOfCharactersShort":":","node.content.characterType.simple":"","node.content.characterType.anthro":"","node.content.characterType.chibi":"","node.content.characterType.key_item":"","node.content.style.simple":"","node.content.style.realistic":"","node.content.style.3d_cartoon":"3D","node.content.style.3d_realistic":"3D","node.content.style.2d_animation":"2D","node.content.style.anime":"","node.content.style.comics":"","node.content.style.custom":"","node.content.fullDescriptionTitle":"","node.content.integrationInstruction":"","node.content.additionalPromptSuffix":" ()","search.node.text_input.title":"","search.node.text_input.description":"","search.node.image_input.title":"","search.node.image_input.description":"","search.node.prompt_sequence_editor.title":"","search.node.prompt_sequence_editor.description":"","search.node.data_reader.title":"","search.node.data_reader.description":"","search.node.note.title":"","search.node.note.description":"","search.node.prompt_processor.title":"","search.node.prompt_processor.description":"","search.node.prompt_analyzer.title":"","search.node.prompt_analyzer.description":"","search.node.prompt_sanitizer.title":"","search.node.prompt_sanitizer.description":"AI","search.node.character_card.title":"","search.node.character_card.description":"","search.node.character_analyzer.title":"","search.node.character_analyzer.description":"","search.node.character_generator.title":"","search.node.character_generator.description":"1","search.node.image_analyzer.title":"","search.node.image_analyzer.description":"AI","search.node.image_editor.title":"AI","search.node.image_editor.description":"","search.node.image_sequence_generator.title":"","search.node.image_sequence_generator.description":"","search.node.gemini_chat.title":"Gemini","search.node.gemini_chat.description":"Gemini","search.node.translator.title":"","search.node.translator.description":"AI","search.node.script_generator.title":"","search.node.script_generator.description":"","search.node.script_viewer.title":"","search.node.script_viewer.description":"","search.node.note":"","search.node.reroute_dot":"","search.node.video_prompt_processor.title":"","search.node.video_prompt_processor.description":"","search.node.video_output.title":"","search.node.video_output.description":"Veo","search.node.image_output.title":"","search.node.image_output.description":"","search.node.media_viewer.title":"","search.node.media_viewer.description":"","search.node.data_protection.title":"","search.node.data_protection.description":"","search.node.pose_creator.title":"","search.node.pose_creator.description":"","prompt_sequence_editor.instructionPlaceholder":"...","prompt_sequence_editor.modifying":"...","prompt_sequence_editor.modifySelected":" ({count})","prompt_sequence_editor.sourcePrompts":"","prompt_sequence_editor.finalPrompts":"","prompt_sequence_editor.error.invalidInput":"","geminiChat.mode.general":"","geminiChat.mode.prompt":"","geminiChat.mode.script":"","geminiChat.mode.youtube":"YouTube","image_sequence.deselect_scene":"","image_sequence.clear_prompts_only":"","image_sequence.prev_scene":"","image_sequence.next_scene":"","image_sequence.frames_hidden":"({count} )","image_sequence.frames_count":"({count} )","node.content.modificationRequest":"","node.content.technicalPrompt":"","node.promptProcessor.safePromptTooltip":"","node.promptProcessor.technicalPromptTooltip":"","node.promptProcessor.enhanceTooltip":"AI","node.promptProcessor.chainTooltip":"","image_sequence.tooltip.autoCrop":"16:9","image_sequence.tooltip.autoDownload":"","image_sequence.tooltip.createZip":"ZIP"},Mb={"imageEditor.title":"","imageEditor.canvasResolution":"","imageEditor.background":"","imageEditor.toolSettings":"","imageEditor.snapToEdges":"","imageEditor.freeAspect":"","imageEditor.section.aiRequest":"AI","imageEditor.input.modificationPlaceholder":"","imageEditor.action.sendRequest":"","imageEditor.tooltip.removeObject":" () /  ()","imageEditor.action.removeObject":"","imageEditor.action.removeBackground":"","imageEditor.tool.transform":"","imageEditor.tool.hand":"","imageEditor.tool.zoom":"","imageEditor.tool.pencil":"","imageEditor.tool.rectangle":"","imageEditor.action.fit":"","imageEditor.action.fill":"","imageEditor.action.cancel":"","imageEditor.action.resetEdits":"","imageEditor.action.apply":"","imageViewer.title":"","imageEditor.outputResolution":"","imageEditor.outputResolutionHelp":"Auto","imageEditor.currentSize":": {width}x{height}","imageEditor.sequenceMode":"","imageEditor.sequenceModeHelp":"A","imageEditor.sequentialCombination":"","imageEditor.sequentialCombinationHelp":"A + B","imageEditor.sequentialPrompt":"","imageEditor.sequentialPromptHelp":" + ","imageEditor.sequentialEditingWithPrompts":"","imageEditor.sequentialEditingWithPromptsHelp":"B + A","imageEditor.input":"","imageEditor.inputA":" A","imageEditor.inputB":" B","imageEditor.status.queued":"","imageEditor.status.generating":"...","imageEditor.action.regenerate":"","imageEditor.tooltip.fit":" (contain)","imageEditor.tooltip.fill":" (cover)","imageEditor.tooltip.flip":"","imageEditor.background.white":"","imageEditor.background.gray":"","imageEditor.background.black":"","imageEditor.background.dark":"","image_sequence.regenerate":"","image_sequence.stop_queue":"","image_sequence.move_up":"","image_sequence.move_down":"","image_sequence.copy_prompt":"","image_sequence.add_frame":"","image_sequence.delete_frame":"","image_sequence.expand_all_frames":"/","image_sequence.collapse_all_frames":"","image_sequence.expand_all_scenes":"/","image_sequence.collapse_all_scenes":"","image_sequence.expand_all":"","image_sequence.collapse_all":"","image_sequence.clear_all_prompts":"","image_sequence.add_first_frame":"","image_sequence.drop_or_add_title":"JSON","image_sequence.drop_or_add_desc":"JSON","image_sequence.load_prompts":"","image_sequence.output_images_title":"","image_sequence.prompts_list_title":"","image_sequence.download_selected":"","image_sequence.select_all":"","image_sequence.select_none":"","image_sequence.invert_selection":"","image_sequence.run_selected":"","image_sequence.start_queue":"","image_sequence.character_prompt_combination":"","image_sequence.combination_none":"","image_sequence.combination_combine":"","image_sequence.combination_replace":"","image_sequence.status.error":"","image_sequence.status.pending":"","image_sequence.clear_selected_prompts":"","image_sequence.range_from":":","image_sequence.range_to":":","image_sequence.stats.total":": {count}","image_sequence.stats.generated":": {count}","image_sequence.stats.queue":": {count}","image_sequence.edit_in_source":"","image_sequence.edit_prompt":"","image_sequence.select_scene":"","image_sequence.next_scene":"","image_sequence.prev_scene":"","image_sequence.scene_input_label":"","image_sequence.select_square":" (1:1) ","image_sequence.select_landscape":" (16:9) ","image_sequence.select_portrait":" (9:16) ","image_sequence.select_range":"","image_sequence.force_refresh":"","image_sequence.select_scene_frames":"","image_sequence.collapse_other_scenes":"","prompt_sequence_editor.instructionPlaceholder":"...","prompt_sequence_editor.modifying":"...","prompt_sequence_editor.modifySelected":" ({count})","prompt_sequence_editor.sourcePrompts":"","prompt_sequence_editor.finalPrompts":"","prompt_sequence_editor.error.invalidInput":"","geminiChat.mode.general":"","geminiChat.mode.prompt":"","geminiChat.mode.script":"","geminiChat.mode.youtube":"YouTube","image_sequence.shot_type.WS":" (WS) ","image_sequence.shot_type.MS":" (MS) ","image_sequence.shot_type.CU":" (CU) ","image_sequence.shot_type.ECU":" (ECU) ","image_sequence.shot_type.LS":" (LS) "},Rb={"dialog.permission.title":"","dialog.permission.description":"","dialog.permission.allow":"","dialog.permission.decline":"","dialog.rename.title":"","dialog.rename.group.title":"","dialog.rename.catalog.title":"","dialog.rename.node.title":"","dialog.rename.label":":","dialog.rename.confirm":"","dialog.rename.cancel":"","dialog.promptEdit.title":"","dialog.promptEdit.nameLabel":":","dialog.promptEdit.contentLabel":":","dialog.promptEdit.confirm":"","dialog.promptEdit.cancel":"","dialog.confirmDelete.title":"","dialog.confirmDelete.message":"","dialog.confirmDelete.confirm":"","dialog.confirmDelete.cancel":"","dialog.confirmCloseTab.title":"","dialog.confirmCloseTab.message":' "{tabName}" ',"dialog.confirmClear.title":"","dialog.confirmClear.message":"","dialog.confirmReset.title":"","dialog.confirmReset.message":"","dialog.confirmReset.confirm":"","dialog.confirmLoad.title":"","dialog.confirmLoad.message":"","dialog.apiKey.title":"API","dialog.apiKey.description":"AI PlatformAPIAPI","dialog.apiKey.billingLink":"","dialog.apiKey.button":"API","dialog.settings.title":"","dialog.settings.apiKeyLabel":"Google Gemini API:","dialog.settings.useDevKeyLabel":"API ()","dialog.settings.instantNodeCloseLabel":"","dialog.settings.nodeAnimationLabel":"","dialog.settings.animationModeLabel":"","dialog.settings.anim.pulse":"","dialog.settings.anim.bladeRunner":"","dialog.settings.anim.none":"","dialog.settings.description":"API","dialog.settings.getKeyLink":"API","dialog.settings.save":"","dialog.deleteNode.title":"","dialog.deleteNode.titlePlural":"","dialog.deleteNode.confirm":"","dialog.deleteNode.cancel":"","dialog.deleteNode.confirmTooltip":" - ","dialog.deleteNode.cancelTooltip":" - ","dialog.deleteNode.dontShowAgain":"","dialog.exitApp.title":"","dialog.exitApp.message":""},Lb={"group.button.create":" ({count})","group.rename":"","group.saveToCatalog":"","group.saveToDisk":"","group.ungroup":" (Shift+)","group.duplicate":"","catalog.tabs.groups":"","catalog.tabs.library":"","catalog.tabs.characters":"","catalog.tabs.scripts":"","catalog.tabs.sequences":"","catalog.back":"","catalog.load":"","catalog.newFolder":"","catalog.saveTo":"","catalog.card.addToCanvas":"","catalog.card.rename":"","catalog.card.save":"","catalog.card.delete":"","catalog.empty.description":"","library.loadFromFile":"","library.actions.newFolder":"","library.actions.newPrompt":"","library.actions.copy":"","library.actions.edit":"","library.empty.title":"","library.empty.description":"","library.emptyPrompt":""},Db={...Ib,...jb,...Ab,...Mb,...Rb,...Lb},zb={"app.title":" ","app.subtitle":"   ","app.error.title":"","app.error.copy":" ","app.error.copied":"!","error.apiKey":"API     .  API   .","error.scriptModifierCanvas":'    "Script Modifier" .    Script Modifier  .',"welcome.title":"","welcome.description":"Prompt Modifier   .    .     .","welcome.apiKeyLabel":"Google Gemini API ","welcome.apiKeyPlaceholder":" API  ...","welcome.apiKeyHelp":"API    .","welcome.getKeyLink":"API  ","welcome.iAmDeveloper":" ","welcome.letsGo":"","welcome.resume":"","welcome.startNew":" ","welcome.freeModeActive":"  ","welcome.selectLanguage":"  ","welcome.navHint":"        ","toast.contentCleared":" ","toast.downloadStarted":" ","toast.characterLoaded":"  ","toast.characterSavedDisk":"   ","toast.copiedToClipboard":" ","toast.pastedFromClipboard":" ","toast.pasteFailed":" ","toast.nodeDuplicated":" ","toast.groupSavedToDisk":'"{groupTitle}"   ',"toast.groupDeleted":"   ","toast.characterSavedCatalog":"  ","toast.promptSaved":"  : {promptName}...","toast.connectionsCut":" ","toast.apiKeySaved":"API   ","toast.cacheCleared":" {count}    ","toast.cacheEmpty":"   ","toast.scriptSaved":"  ","alert.groupSaved":'"{groupTitle}"   .',"alert.loadCatalogFailed":"   ","alert.invalidCatalogFile":"    ","alert.fileNotSupported":'  . "appName"   .',"alert.invalidCatalogStructure":'   . "root" .',"tutorial.step1":"     .","tutorial.step2":'" "  AI   .',"tutorial.step2_waiting":"AI       ...","tutorial.step3":",    .","tutorial.step3b":"   .      .","tutorial.step4":"        .","tutorial.group.catalog":"     .","tutorial.group.general":"      .","tutorial.group.input":",      .","tutorial.group.processing":"AI    .","tutorial.group.character":"  ,   .","tutorial.group.output":"   .","tutorial.group.ai":"Gemini   .","tutorial.group.video":"     .","tutorial.group.scripts":"     .","tutorial.group.file":" ,    .","tutorial.success.title":" !","tutorial.success.message":"Prompt Modifier   .     !","tutorial.success.button":" ","tutorial.skip":"","tutorial.next":"","tutorial.finish":""},qb={"toolbar.settings":"","toolbar.resetCanvas":" ","toolbar.clearCache":"  ","toolbar.home":"","toolbar.edit":" (V)","toolbar.cutter":"  (C) / (Ctrl )","toolbar.selection":" (S) / (Shift )","toolbar.reroute":"  (R) / (Ctrl+Alt )","toolbar.zoom":"/ (Z )","toolbar.snapToGrid":" ","toolbar.smartGuides":" ","toolbar.lineStyleSpaghetti":" ","toolbar.lineStyleOrthogonal":" ","toolbar.resetZoom":" ","toolbar.resetCamera":"  ","toolbar.clearCanvas":" ","toolbar.addNode":"  (F)","toolbar.catalog":"  (Ctrl + Space)","toolbar.addNote":"  (N)","toolbar.addDataReader":"   (Shift + R)","toolbar.addTextInput":"   (T)","toolbar.addImageInput":"   (I)","toolbar.addPromptSequenceEditor":"    (Q)","toolbar.addImageAnalyzer":"   (Shift+A)","toolbar.addPromptAnalyzer":"   (A)","toolbar.addPromptProcessor":"   (P)","toolbar.addCharacterGenerator":"   (Shift+C)","toolbar.addCharacterAnalyzer":"   (Ctrl+Shift+A)","toolbar.addCharacterCard":"   (Ctrl+Shift+C)","toolbar.addImageOutput":"   (O)","toolbar.addImageEditor":"AI    (Shift+I)","toolbar.addImageSequenceGenerator":"    (Shift+Q)","toolbar.addTranslator":"  (L)","toolbar.addGeminiChat":"Gemini   (M)","toolbar.addVideoPromptProcessor":"    (Shift+P)","toolbar.addVideoOutput":"   (Shift+O)","toolbar.addScriptGenerator":"  ","toolbar.addScriptViewer":"   (Shift + V)","toolbar.saveCanvas":"  (Ctrl + S)","toolbar.saveProject":" ","toolbar.loadCanvas":"/  (Ctrl + O)","toolbar.group.general":"","toolbar.group.catalog":"","toolbar.group.input":"","toolbar.group.processing":"","toolbar.group.character":"","toolbar.group.output":"","toolbar.group.aiTools":"AI ","toolbar.group.video":"","toolbar.group.scripts":"","toolbar.group.file":"","toolbar.title":" ","toolbar.dock":"  ","toolbar.detach":"  ","toolbar.expandPanel":" ","toolbar.collapsePanel":" ","toolbar.dockArea.title":" ","toolbar.duplicate":" ","toolbar.duplicateWithContent":"  ","toolbar.dock.q1":" 1/4","toolbar.dock.q2":" 2/4","toolbar.dock.q3":" 3/4","toolbar.dock.q4":" 4/4","toolbar.dock.tl":" ","toolbar.dock.bl":" ","toolbar.dock.tr":" ","toolbar.dock.br":" ","toolbar.dock.left":" ","toolbar.dock.right":" ","toolbar.dock.full":" ","toolbar.dock.exitFull":"  ","toolbar.dock.fullFocus":"  ","hotkeys.show":" ","hotkeys.tools.title":"","hotkeys.tools.edit":" ","hotkeys.tools.cutter":" ","hotkeys.tools.selection":" ","hotkeys.tools.reroute":"  ","hotkeys.tools.zoom":" ","hotkeys.tools.toggleLineStyle":"  ","hotkeys.tools.group":" ","hotkeys.tools.closeNode":"  ","hotkeys.tools.duplicate":" ","hotkeys.tools.duplicateWithContent":"  ","hotkeys.tools.deleteGroup":"  (Shift+Click)","hotkeys.windows.title":"","hotkeys.windows.search":" ","hotkeys.windows.catalog":"","hotkeys.createNode.title":" ","help.panelTitle":"  ","help.title":" ","help.howToUse.title":" ","help.howToUse.content":"Prompt Modifier   !      .    .       .        .    .","help.author":"","contextMenu.undoPosition":"  ","contextMenu.redoPosition":"  ","contextMenu.align.left":"  (F)","contextMenu.align.centerX":"   (E)","contextMenu.align.right":"  (R)","contextMenu.align.top":"  (T)","contextMenu.align.centerY":"   (D)","contextMenu.align.bottom":"  (B)","contextMenu.distribute.horizontal":"  (Ctrl+D)","contextMenu.distribute.vertical":"  (Ctrl+E)","contextMenu.emptySlot":"  ( )","contextMenu.saveSlots":"  ","contextMenu.loadSlots":"  ","quickadd.title":" ","quickadd.group.tools":"","quickadd.group.inputs":"","quickadd.group.processing":"","quickadd.group.character":"","quickadd.group.outputs":"","quickadd.group.ai":"AI ","quickadd.group.video":"","quickadd.group.scripts":"","quickadd.group.general":"","quickadd.group.youtube":"YouTube","quickadd.tool.edit":"","quickadd.tool.cutter":"","quickadd.tool.selection":"","search.placeholder":"  ...","search.noResults":"   .","search.group.input":" & ","search.group.process":" & ","search.group.output":" & ","search.group.ai":"AI ","search.group.video":" & ","search.group.scripts":"","toolbar.exitApp":" "},Ob={"node.title.text_input":" ","node.title.image_input":" ","node.title.prompt_processor":" ","node.title.prompt_sanitizer":" ","node.title.video_prompt_processor":"  ","node.title.image_output":" ","node.title.video_output":" ","node.title.prompt_analyzer":" ","node.title.character_analyzer":" ","node.title.character_generator":" ","node.title.character_card":" ","node.title.image_analyzer":" ","node.title.image_editor":"AI  ","node.title.image_sequence_generator":"  ","node.title.prompt_sequence_editor":"  ","node.title.gemini_chat":"Gemini ","node.title.translator":"","node.title.script_generator":" ","node.title.script_viewer":" ","node.title.note":"","node.title.reroute_dot":"  ","node.title.data_reader":" ","node.title.video_editor":"  ","node.title.media_viewer":" ","node.title.data_protection":" ","node.title.pose_creator":"Pose Creator","node.help.text_input":"        .","node.help.image_input":"        .","node.help.prompt_processor":"AI        .","node.help.prompt_sanitizer":"           .","node.help.video_prompt_processor":"       .","node.help.image_output":"   .    .","node.help.video_output":"Veo      .","node.help.prompt_analyzer":" , ,     .","node.help.character_analyzer":"     .","node.help.character_generator":"      .","node.help.character_card":"      .","node.help.image_analyzer":"AI     .","node.help.image_editor":"  /     .","node.help.image_sequence_generator":"     .","node.help.prompt_sequence_editor":"AI        .","node.help.gemini_chat":"   Gemini   .","node.help.translator":"AI      .","node.help.script_generator":"   (, ) .","node.help.script_viewer":"      .","node.help.note":"      .","node.help.reroute_dot":"         .","node.help.data_reader":"        .","node.help.video_editor":"       .","node.help.media_viewer":"        .","node.help.data_protection":"     .    .","node.help.pose_creator":"Visual rig to define and generate character poses for generation guidance.","node.action.expand":"","node.action.collapse":"","node.action.help":"","node.action.download":"","node.action.clear":" ","node.action.refreshChat":"   ","node.action.paste":"","node.action.resetEditor":" ","node.action.saveCharacter":" ","node.action.loadCharacter":" ","node.action.copy":"","node.action.copyImage":" ","node.action.copyTextPrompt":" ","node.action.copyImagePrompt":"  ","node.action.copyVideoPrompt":"  ","node.action.cutConnections":" ","node.action.close":"","node.action.closeNode":"  (Shift+Click  )","node.action.closeNodeSimple":" ","node.action.randomWord":"  ","node.action.processImage":" ","node.action.processImageTitle":"Gemini     .","node.action.editor":"","node.action.rasterEditor":" ","node.action.openInAIEditor":"AI  ","node.action.openInAnalyzer":" ","node.action.outputToInput":"  ","node.action.processChainForward":" ","node.action.executeChain":" ","node.action.executeChainTitle":"       .","node.action.sanitize":"","node.action.rename":" ","node.action.stop":"","node.action.stopping":" ...","node.action.deleteItem":" ","node.action.detachAndPaste":"  ","node.action.delete":"","node.action.flipImage":" ","node.action.pin":"  ","node.action.unpin":"  ","node.mediaViewer.play":"","node.mediaViewer.pause":" ","node.mediaViewer.stop":"","node.mediaViewer.addMarker":" ","node.mediaViewer.exportSRT":"  (SRT)","node.mediaViewer.deleteAllMarkers":"  ","node.mediaViewer.saveMarkers":"  ","node.mediaViewer.loadMarkers":"  ","node.mediaViewer.relink":"  ","node.content.notePlaceholder":"  ...","node.content.dropImage":"    ","node.content.dropMedia":"    ","node.content.processing":" ...","node.content.processingChain":"  ...","node.content.metadataPrompt":"  :","node.content.metadataPromptPlaceholder":"    .","node.content.copyPrompt":"","node.content.prompt":"","node.content.inputPrompt":" ","node.content.enhancedResult":" ","node.content.videoPrompt":" ","node.content.editPromptPlaceholder":"  ...","node.content.enhancedPromptHere":"   ...","node.content.safePrompt":"  ","node.content.generating":" ...","node.content.imageHere":"  ","node.content.generationMode":" ","node.content.aspectRatio":"","node.content.aspectRatioHelp":"    ","node.content.aspectRatioNotSupportedFast":" Imagen    .","node.content.enableAspectRatioFormatting":"  ","node.content.autoDownload":" ","node.content.generateImage":" ","node.content.enhancing":" ...","node.content.enhancePrompt":" ","node.content.sanitizing":" ...","node.content.sanitizedPromptHere":"   ...","node.content.analyzing":" ...","node.content.analyzePrompt":" ","node.content.analyzeImage":" ","node.content.imageToText":" ","node.content.analyzeCharacter":" ","node.content.generateCharacters":" ","node.content.characterPromptPlaceholder":"  ...","node.content.character":"","node.content.clothing":"","node.content.characterPlaceholder":"   ...","node.content.clothingPlaceholder":"   ...","node.content.appearance":"","node.content.personality":"","node.content.environment":"/","node.content.action":"","node.content.emotion":"","node.content.style":"","node.content.environmentPlaceholder":"   ...","node.content.charactersPlaceholder":"  ...","node.content.characters":"","node.content.characterConcepts":" ","node.content.actionPlaceholder":" ...","node.content.emotionPlaceholder":" ...","node.content.stylePlaceholder":"  ...","node.content.descriptionHere":"  ...","node.content.enableOutpainting":" ","node.content.outpaintingPromptPlaceholder":" ...","node.content.inputImage":" ","node.content.dropOrClick":"  ","node.content.outputImage":" ","node.content.applyEdit":" ","node.content.editing":" ...","node.content.chatPlaceholder":" ...","node.content.connectedPlaceholder":" ,  .","node.content.connectedNode":"  ","node.content.connectedEmpty":"   .","node.content.translatePlaceholder":" ...","node.content.translatedTextPlaceholder":" ...","node.content.targetLanguage":" ","node.content.translate":"","node.content.translating":" ...","node.content.scriptPromptPlaceholder":"   ...","node.content.generateScript":" ","node.content.loadScript":"  ","node.content.summary":"","node.content.scenes":"","node.content.unrecognizedFormat":"    .","node.content.frames":"","node.content.characterIndex":"","node.content.readData":" ","node.content.textDataHere":"   .","node.content.noDataRead":'  " "   .',"node.content.previewError":" ","node.content.previewPlaceholder":"  ","node.content.imagePrompt":" ","node.output.allPromptData":"  ","node.note.tab.note":"","node.note.tab.references":"","node.note.nestedImages":" ","node.note.dropPlaceholder":"   ","node.note.addCaption":"","node.note.action.shuffle":"","node.note.action.undoShuffle":" ","node.content.characterTypeShort":":","node.content.numberOfCharactersShort":":","node.content.characterType.simple":"","node.content.characterType.anthro":"","node.content.characterType.chibi":"","node.content.characterType.key_item":" ","node.content.style.simple":"","node.content.style.realistic":"","node.content.style.3d_cartoon":"3D ","node.content.style.3d_realistic":"3D ","node.content.style.2d_animation":"2D ","node.content.style.anime":"","node.content.style.comics":"","node.content.style.custom":" ","node.content.fullDescriptionTitle":"  ","node.content.additionalPromptSuffix":"  ()","search.node.text_input.title":" ","search.node.text_input.description":"    .","search.node.image_input.title":" ","search.node.image_input.description":"  .","search.node.prompt_sequence_editor.title":"  ","search.node.prompt_sequence_editor.description":"        .","search.node.data_reader.title":" ","search.node.data_reader.description":"     (  )  .","search.node.note.title":"","search.node.note.description":"  .","search.node.prompt_processor.title":" ","search.node.prompt_processor.description":"   .","search.node.prompt_analyzer.title":" ","search.node.prompt_analyzer.description":"   .","search.node.prompt_sanitizer.title":" ","search.node.prompt_sanitizer.description":"AI      .","search.node.character_card.title":" ","search.node.character_card.description":"    .","search.node.character_analyzer.title":" ","search.node.character_analyzer.description":"   .","search.node.character_generator.title":" ","search.node.character_generator.description":"       .","search.node.image_analyzer.title":" ","search.node.image_analyzer.description":"AI   .","search.node.image_editor.title":"AI  ","search.node.image_editor.description":"   .","search.node.image_sequence_generator.title":"  ","search.node.image_sequence_generator.description":"     .","search.node.gemini_chat.title":"Gemini ","search.node.gemini_chat.description":"   Gemini  .","search.node.translator.title":"","search.node.translator.description":"AI      .","search.node.script_generator.title":" ","search.node.script_generator.description":"   (, ) .","search.node.script_viewer.title":" ","search.node.script_viewer.description":"      .","search.node.note":"       .","search.node.reroute_dot":"     .","search.node.video_prompt_processor.title":"  ","search.node.video_prompt_processor.description":"     .","search.node.video_output.title":" ","search.node.video_output.description":"Veo    .","search.node.image_output.title":" ","search.node.image_output.description":"     .","search.node.media_viewer.title":" ","search.node.media_viewer.description":"        .","search.node.data_protection.title":" ","search.node.data_protection.description":"       .","search.node.pose_creator.title":"Pose Creator","search.node.pose_creator.description":"Visual rig to define and generate character poses for generation guidance.","prompt_sequence_editor.instructionPlaceholder":"   ...","prompt_sequence_editor.modifying":" ...","prompt_sequence_editor.modifySelected":"   ({count})","prompt_sequence_editor.sourcePrompts":" ","prompt_sequence_editor.finalPrompts":" ","prompt_sequence_editor.error.invalidInput":"   .     .","geminiChat.mode.general":"","geminiChat.mode.prompt":" ","geminiChat.mode.script":" ","geminiChat.mode.youtube":"YouTube ","image_sequence.deselect_scene":"     ","image_sequence.clear_prompts_only":"  ","image_sequence.prev_scene":" ","image_sequence.next_scene":" ","node.content.modificationRequest":" ","node.promptProcessor.safePromptTooltip":"Rewrites the prompt to comply with safety guidelines and avoid policy violations.","node.promptProcessor.technicalPromptTooltip":"Converts the prompt into a highly detailed technical specification (lighting, camera, render settings).","node.promptProcessor.enhanceTooltip":"Uses AI to expand and enrich the prompt with descriptive details.","node.promptProcessor.chainTooltip":"Executes this node and triggers all connected downstream nodes.","image_sequence.tooltip.autoCrop":"Automatically crops generated images to 16:9 ratio.","image_sequence.tooltip.autoDownload":"Automatically saves each image to your device upon generation.","image_sequence.tooltip.createZip":"Packages all selected images into a single ZIP archive for download."},Fb={"imageEditor.title":" ","imageEditor.canvasResolution":" ","imageEditor.background":"","imageEditor.toolSettings":" ","imageEditor.snapToEdges":" ","imageEditor.freeAspect":" ","imageEditor.section.aiRequest":"AI  ","imageEditor.input.modificationPlaceholder":'  , : "  "',"imageEditor.action.sendRequest":" ","imageEditor.tooltip.removeObject":" () /  ()","imageEditor.action.removeObject":" ","imageEditor.tool.transform":"","imageEditor.tool.hand":" ()","imageEditor.tool.zoom":"/","imageEditor.tool.pencil":"","imageEditor.tool.rectangle":"","imageEditor.action.fit":" ","imageEditor.action.fill":" ","imageEditor.action.cancel":"","imageEditor.action.resetEdits":" ","imageEditor.action.apply":"","imageViewer.title":" ","imageEditor.outputResolution":" ","imageEditor.outputResolutionHelp":'  . ""    .',"imageEditor.currentSize":" : {width}x{height}","imageEditor.sequenceMode":" ","imageEditor.sequenceModeHelp":" A   .","imageEditor.sequentialCombination":"  ","imageEditor.sequentialCombinationHelp":"  :   A  +   B  .","imageEditor.sequentialPrompt":"  ","imageEditor.sequentialPromptHelp":"  :    +   .","imageEditor.sequentialEditingWithPrompts":"  ","imageEditor.sequentialEditingWithPromptsHelp":"  :  B  +   .  A .","imageEditor.input":"","imageEditor.inputA":" A","imageEditor.inputB":" B","imageEditor.status.queued":" ","imageEditor.status.generating":" ...","imageEditor.action.regenerate":"","imageEditor.tooltip.fit":"    ().","imageEditor.tooltip.fill":"    ().","imageEditor.tooltip.flip":"  .","imageEditor.background.white":"","imageEditor.background.gray":"","imageEditor.background.black":"","imageEditor.background.dark":" ","image_sequence.regenerate":"","image_sequence.stop_queue":" ","image_sequence.move_up":" ","image_sequence.move_down":" ","image_sequence.copy_prompt":" ","image_sequence.add_frame":" ","image_sequence.delete_frame":" ","image_sequence.expand_all_frames":"  /","image_sequence.collapse_all_frames":"  ","image_sequence.expand_all_scenes":"  /","image_sequence.collapse_all_scenes":"  ","image_sequence.expand_all":" ","image_sequence.collapse_all":" ","image_sequence.clear_all_prompts":"  ","image_sequence.add_first_frame":"   ","image_sequence.drop_or_add_title":" JSON    ","image_sequence.drop_or_add_desc":"JSON        .","image_sequence.load_prompts":" ","image_sequence.output_images_title":" ","image_sequence.prompts_list_title":" ","image_sequence.download_selected":"  ","image_sequence.select_all":" ","image_sequence.select_none":" ","image_sequence.invert_selection":" ","image_sequence.run_selected":"  ","image_sequence.start_queue":" ","image_sequence.character_prompt_combination":"  ","image_sequence.combination_none":"","image_sequence.combination_combine":"","image_sequence.combination_replace":" ","image_sequence.status.error":"","image_sequence.status.pending":" ","image_sequence.clear_selected_prompts":"  ","image_sequence.range_from":":","image_sequence.range_to":":","image_sequence.stats.total":" : {count}","image_sequence.stats.generated":": {count}","image_sequence.stats.queue":": {count}","image_sequence.edit_in_source":" ","image_sequence.edit_prompt":" ","image_sequence.select_scene":" ","image_sequence.next_scene":" ","image_sequence.prev_scene":" ","image_sequence.scene_input_label":"","image_sequence.select_square":" (1:1) ","image_sequence.select_landscape":" (16:9) ","image_sequence.select_portrait":" (9:16) ","image_sequence.select_range":" ","image_sequence.force_refresh":" ","image_sequence.select_scene_frames":"    ","image_sequence.collapse_other_scenes":"  ","prompt_sequence_editor.instructionPlaceholder":"   ...","prompt_sequence_editor.modifying":" ...","prompt_sequence_editor.modifySelected":"   ({count})","prompt_sequence_editor.sourcePrompts":" ","prompt_sequence_editor.finalPrompts":" ","prompt_sequence_editor.error.invalidInput":"   .     .","geminiChat.mode.general":"","geminiChat.mode.prompt":" ","geminiChat.mode.script":" ","geminiChat.mode.youtube":"YouTube ","image_sequence.shot_type.WS":"  (WS)   .  .","image_sequence.shot_type.MS":"  (MS)  .   .","image_sequence.shot_type.CU":" (CU)  .","image_sequence.shot_type.ECU":"  (ECU)  .  .","image_sequence.shot_type.LS":"  (LS)    ."},Bb={"dialog.permission.title":" ","dialog.permission.description":"         .    .","dialog.permission.allow":"","dialog.permission.decline":"","dialog.rename.title":"  ","dialog.rename.group.title":"  ","dialog.rename.catalog.title":"   ","dialog.rename.node.title":"  ","dialog.rename.label":" :","dialog.rename.confirm":" ","dialog.rename.cancel":"","dialog.promptEdit.title":" ","dialog.promptEdit.nameLabel":":","dialog.promptEdit.contentLabel":":","dialog.promptEdit.confirm":"","dialog.promptEdit.cancel":"","dialog.confirmDelete.title":" ","dialog.confirmDelete.message":"  ?     .","dialog.confirmDelete.confirm":"","dialog.confirmDelete.cancel":"","dialog.confirmCloseTab.title":" ","dialog.confirmCloseTab.message":'"{tabName}"  ?     .',"dialog.confirmClear.title":" ","dialog.confirmClear.message":"  ?     .","dialog.confirmReset.title":" ","dialog.confirmReset.message":"   ?    .","dialog.confirmReset.confirm":"","dialog.confirmLoad.title":" ","dialog.confirmLoad.message":"     .     . ?","dialog.apiKey.title":"API  ","dialog.apiKey.description":'  "AI Platform" API   API  .       .',"dialog.apiKey.billingLink":"   ","dialog.apiKey.button":"API  ","dialog.settings.title":"","dialog.settings.apiKeyLabel":" Google Gemini API :","dialog.settings.useDevKeyLabel":" API   ()","dialog.settings.instantNodeCloseLabel":"  ","dialog.settings.nodeAnimationLabel":"  ","dialog.settings.animationModeLabel":"  ","dialog.settings.anim.pulse":"","dialog.settings.anim.bladeRunner":" ","dialog.settings.anim.none":"","dialog.settings.description":"       API  .    .","dialog.settings.getKeyLink":" API  ","dialog.settings.save":"","dialog.deleteNode.title":" ?","dialog.deleteNode.titlePlural":" ?","dialog.deleteNode.confirm":"","dialog.deleteNode.cancel":"","dialog.deleteNode.confirmTooltip":"  -     ","dialog.deleteNode.cancelTooltip":"  -   ","dialog.deleteNode.dontShowAgain":"  ","dialog.exitApp.title":" ?","dialog.exitApp.message":" ?      ."},Gb={"group.button.create":"  ({count})","group.rename":"  ","group.saveToCatalog":" ","group.saveToDisk":" ","group.ungroup":"  (Shift+Click   )","group.duplicate":"   ","catalog.tabs.groups":"","catalog.tabs.library":"","catalog.tabs.characters":"","catalog.tabs.scripts":"","catalog.tabs.sequences":"","catalog.back":"","catalog.load":" ","catalog.newFolder":" ","catalog.saveTo":" ","catalog.card.addToCanvas":" ","catalog.card.rename":" ","catalog.card.save":"","catalog.card.delete":"","catalog.empty.description":"   .       .","library.loadFromFile":"","library.actions.newFolder":" ","library.actions.newPrompt":" ","library.actions.copy":"","library.actions.edit":"","library.empty.title":" ","library.empty.description":"   .","library.emptyPrompt":" "},Hb={...zb,...qb,...Ob,...Fb,...Bb,...Gb},Pn={en:{name:"English",short:"EN",nativeName:"English"},ru:{name:"Russian",short:"RU",nativeName:""},es:{name:"Spanish",short:"ES",nativeName:"Espaol"},fr:{name:"French",short:"FR",nativeName:"Franais"},de:{name:"German",short:"DE",nativeName:"Deutsch"},it:{name:"Italian",short:"IT",nativeName:"Italiano"},pt:{name:"Portuguese",short:"PT",nativeName:"Portugus"},uz:{name:"Uzbek",short:"UZ",nativeName:"O'zbek"},zh:{name:"Chinese",short:"ZH",nativeName:""},ja:{name:"Japanese",short:"JA",nativeName:""},ko:{name:"Korean",short:"KO",nativeName:""}},Fc={en:Ew,ru:Rw,es:Bw,uz:Kw,fr:tb,de:lb,it:gb,pt:Cb,zh:Tb,ja:Db,ko:Hb},qo=(e,t,o)=>{const r=Fc[e]||Fc.en,a=Fc.en;let i=r[t]||a[t]||t;return o&&Object.entries(o).forEach(([s,l])=>{i=i.replace(`{${s}}`,String(l))}),i},Px=y.createContext(void 0),vt=()=>{const e=y.useContext(Px);if(!e)throw new Error("useLanguage must be used within a LanguageProvider");return e};var z=(e=>(e.TEXT_INPUT="TEXT_INPUT",e.IMAGE_INPUT="IMAGE_INPUT",e.PROMPT_PROCESSOR="PROMPT_PROCESSOR",e.VIDEO_PROMPT_PROCESSOR="VIDEO_PROMPT_PROCESSOR",e.IMAGE_OUTPUT="IMAGE_OUTPUT",e.VIDEO_OUTPUT="VIDEO_OUTPUT",e.PROMPT_ANALYZER="PROMPT_ANALYZER",e.CHARACTER_ANALYZER="CHARACTER_ANALYZER",e.CHARACTER_GENERATOR="CHARACTER_GENERATOR",e.CHARACTER_CARD="CHARACTER_CARD",e.IMAGE_ANALYZER="IMAGE_ANALYZER",e.IMAGE_EDITOR="IMAGE_EDITOR",e.IMAGE_SEQUENCE_GENERATOR="IMAGE_SEQUENCE_GENERATOR",e.PROMPT_SEQUENCE_EDITOR="PROMPT_SEQUENCE_EDITOR",e.GEMINI_CHAT="GEMINI_CHAT",e.TRANSLATOR="TRANSLATOR",e.SCRIPT_GENERATOR="SCRIPT_GENERATOR",e.SCRIPT_VIEWER="SCRIPT_VIEWER",e.NOTE="NOTE",e.REROUTE_DOT="REROUTE_DOT",e.PROMPT_SANITIZER="PROMPT_SANITIZER",e.DATA_READER="DATA_READER",e.VIDEO_EDITOR="VIDEO_EDITOR",e.MEDIA_VIEWER="MEDIA_VIEWER",e.DATA_PROTECTION="DATA_PROTECTION",e.POSE_CREATOR="POSE_CREATOR",e))(z||{}),Vt=(e=>(e.FOLDER="FOLDER",e.PROMPT="PROMPT",e))(Vt||{});const Ub=(()=>{const e=new Uint32Array(256);for(let t=0;t<256;t++){let o=t;for(let r=0;r<8;r++)o=o&1?3988292384^o>>>1:o>>>1;e[t]=o}return t=>{let o=-1;for(let r=0;r<t.length;r++)o=o>>>8^e[(o^t[r])&255];return(o^-1)>>>0}})();function Bc(e){return new TextEncoder().encode(e)}function zs(e){return new TextDecoder().decode(e)}const Bi=(e,t,o)=>{if(!e.startsWith("data:image/png;base64,"))return console.warn("Attempted to add metadata to a non-PNG image."),e;try{const r=e.substring(22),a=atob(r),i=new Uint8Array(a.length);for(let S=0;S<i.length;S++)i[S]=a.charCodeAt(S);const s=[137,80,78,71,13,10,26,10];if(i.length<8)return console.error("Invalid PNG: file is too short."),e;for(let S=0;S<s.length;S++)if(i[S]!==s[S])return console.error("Invalid PNG signature."),e;let l=-1,c=8;for(;c<i.length;){if(c+8>i.length){console.warn("Malformed PNG: not enough data for chunk header.");break}const T=new DataView(i.buffer,c).getUint32(0,!1),P=i.slice(c+4,c+8);if(P[0]===73&&P[1]===69&&P[2]===78&&P[3]===68){l=c;break}const R=12+T;if(c+R>i.length){console.warn(`Malformed PNG: chunk of type ${zs(P)} with length ${T} exceeds file bounds.`);break}c+=R}if(l===-1)return console.error("Could not find IEND chunk in PNG."),e;const d=Bc(t),u=Bc(o),p=new Uint8Array(d.length+1+u.length);p.set(d,0),p.set([0],d.length),p.set(u,d.length+1);const h=Bc("tEXt"),x=new Uint8Array(h.length+p.length);x.set(h),x.set(p,h.length);const k=Ub(x),C=new ArrayBuffer(4);new DataView(C).setUint32(0,p.length,!1);const w=new ArrayBuffer(4);new DataView(w).setUint32(0,k,!1);const f=new Uint8Array([...new Uint8Array(C),...h,...p,...new Uint8Array(w)]),g=new Uint8Array(i.length+f.length);g.set(i.slice(0,l),0),g.set(f,l),g.set(i.slice(l),l+f.length);let v="";for(let S=0;S<g.length;S++)v+=String.fromCharCode(g[S]);return`data:image/png;base64,${btoa(v)}`}catch(r){return console.error("Failed to add metadata to PNG:",r),e}},Vb=async e=>new Promise(t=>{if(!e||!e.startsWith("data:image/png;base64,"))return t({});try{const o=e.substring(22),r=atob(o),a=new Uint8Array(r.length);for(let l=0;l<a.length;l++)a[l]=r.charCodeAt(l);const i={};let s=8;for(;s<a.length;){const l=new DataView(a.buffer,s);if(s+8>a.length)break;const c=l.getUint32(0,!1),d=zs(a.slice(s+4,s+8));if(s+12+c>a.length)break;if(d==="tEXt"){const u=a.slice(s+8,s+8+c),p=u.indexOf(0);if(p!==-1){const h=zs(u.slice(0,p)),x=zs(u.slice(p+1));i[h]=x}}if(d==="IEND")break;s+=12+c}t(i)}catch(o){console.error("Failed to read metadata from PNG:",o),t({})}}),ml=async e=>{const t=await Vb(e);return t.prompt||t.Prompt||t.parameters||t.Comment||null},Rt=40,Jt=12,Nn=Rt+4,Wt={"1:1":1,"16:9":2,"9:16":3},Bl=e=>[z.IMAGE_EDITOR,z.PROMPT_SEQUENCE_EDITOR,z.IMAGE_SEQUENCE_GENERATOR,z.POSE_CREATOR].includes(e),Wb=(e,t,o)=>{const r={x:e.x-t.x,y:e.y-t.y},a={x:o.x-t.x,y:o.y-t.y},i=Math.max(0,Math.min(1,(r.x*a.x+r.y*a.y)/(a.x*a.x+a.y*a.y))),s=r.x-i*a.x,l=r.y-i*a.y;return Math.sqrt(s*s+l*l)},$b=(e,t,o,r,a)=>{const i=1-e;return{x:i*i*i*t.x+3*i*i*e*o.x+3*i*e*e*r.x+e*e*e*a.x,y:i*i*i*t.y+3*i*e*e*o.y+3*i*e*e*r.y+e*e*e*a.y}},Kb=(e,t,o,r=20)=>{const a={x:t.x+Math.abs(o.x-t.x)*.5,y:t.y},i={x:o.x-Math.abs(o.x-t.x)*.5,y:o.y},s=10;for(let l=0;l<=s;l++){const c=l/s,d=$b(c,t,a,i,o);if(Math.hypot(e.x-d.x,e.y-d.y)<r)return!0}return Wb(e,t,o)<r},yr=e=>{if(e.length===0)return null;let t=1/0,o=1/0,r=-1/0,a=-1/0;e.forEach(l=>{t=Math.min(t,l.position.x),o=Math.min(o,l.position.y),r=Math.max(r,l.position.x+l.width);const c=l.isCollapsed?Nn:l.height;a=Math.max(a,l.position.y+c)});const i=30,s=70;return{position:{x:t-i,y:o-s},width:r-t+i*2,height:a-o+s+i}},Kn=(e,t)=>{switch(e.type){case z.TEXT_INPUT:return"text";case z.IMAGE_INPUT:return t==="text"?"text":"image";case z.PROMPT_PROCESSOR:return"text";case z.PROMPT_SANITIZER:return"text";case z.VIDEO_PROMPT_PROCESSOR:return"text";case z.TRANSLATOR:return"text";case z.PROMPT_ANALYZER:return"text";case z.CHARACTER_ANALYZER:return"text";case z.CHARACTER_GENERATOR:return"character_data";case z.CHARACTER_CARD:return t==="image"?"image":["prompt","appearance","personality","clothing"].includes(t||"")?"text":"character_data";case z.IMAGE_ANALYZER:return t==="image"?"image":t==="text"?"text":null;case z.IMAGE_EDITOR:return"image";case z.GEMINI_CHAT:return null;case z.IMAGE_OUTPUT:return"image";case z.VIDEO_OUTPUT:return"video";case z.SCRIPT_GENERATOR:return"text";case z.SCRIPT_VIEWER:return"text";case z.PROMPT_SEQUENCE_EDITOR:return t==="all_data"?"text":null;case z.IMAGE_SEQUENCE_GENERATOR:return t==="all_images"?"image":null;case z.NOTE:return t==="all_images"?"image":t==="all_captions"?"text":null;case z.REROUTE_DOT:try{return JSON.parse(e.value||"{}").type||null}catch{return null}case z.VIDEO_EDITOR:return"video";case z.MEDIA_VIEWER:try{return JSON.parse(e.value||"{}").type==="audio"?"audio":"video"}catch{return"video"}case z.DATA_PROTECTION:return"text";case z.POSE_CREATOR:return"image";default:return null}},qs=(e,t)=>{switch(e.type){case z.TEXT_INPUT:return null;case z.PROMPT_PROCESSOR:return"text";case z.PROMPT_SANITIZER:return"text";case z.VIDEO_PROMPT_PROCESSOR:return"text";case z.TRANSLATOR:return"text";case z.PROMPT_ANALYZER:return"text";case z.CHARACTER_ANALYZER:return"text";case z.CHARACTER_GENERATOR:return"text";case z.IMAGE_ANALYZER:return"image";case z.IMAGE_EDITOR:return t;case z.IMAGE_OUTPUT:return"text";case z.VIDEO_OUTPUT:return"text";case z.IMAGE_SEQUENCE_GENERATOR:return"character_data";case z.GEMINI_CHAT:return"text";case z.SCRIPT_GENERATOR:return"text";case z.SCRIPT_VIEWER:return null;case z.PROMPT_SEQUENCE_EDITOR:return null;case z.DATA_READER:return null;case z.REROUTE_DOT:return null;case z.VIDEO_EDITOR:return null;case z.NOTE:return null;case z.MEDIA_VIEWER:return null;case z.DATA_PROTECTION:return"text";case z.POSE_CREATOR:return null;case z.CHARACTER_CARD:return"text";default:return null}},Gi=e=>{const{type:t}=e;switch(t){case z.POSE_CREATOR:return JSON.stringify({image:null,aspectRatio:"1:1",resolution:"1K",joints:[]});case z.VIDEO_EDITOR:return JSON.stringify({currentTime:0,totalDuration:30,clips:[],tracks:[{id:2,name:"V2",type:"video",isMuted:!1,isVisible:!0},{id:1,name:"V1",type:"video",isMuted:!1,isVisible:!0},{id:101,name:"A1",type:"audio",isMuted:!1,isVisible:!0}],mediaFiles:[],isPlaying:!1,zoom:20});case z.TEXT_INPUT:case z.PROMPT_SANITIZER:case z.IMAGE_OUTPUT:case z.VIDEO_OUTPUT:return"";case z.NOTE:return JSON.stringify({text:"",references:[],activeTab:"note"});case z.PROMPT_PROCESSOR:return JSON.stringify({inputPrompt:"",prompt:"",safePrompt:!0});case z.VIDEO_PROMPT_PROCESSOR:return JSON.stringify({inputPrompt:"",prompt:""});case z.IMAGE_INPUT:return JSON.stringify({image:null,prompt:""});case z.PROMPT_ANALYZER:return JSON.stringify({environment:"",characters:[],action:"",emotion:"",style:"",softPrompt:!1});case z.CHARACTER_ANALYZER:return JSON.stringify({character:"",clothing:""});case z.CHARACTER_GENERATOR:return JSON.stringify({prompt:"",characters:[]});case z.CHARACTER_CARD:return JSON.stringify([{name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:""}]);case z.IMAGE_ANALYZER:return JSON.stringify({image:null,description:"",softPrompt:!1});case z.IMAGE_SEQUENCE_GENERATOR:return JSON.stringify({prompts:[],images:{},currentIndex:-1,isGenerating:!1,autoDownload:!1,selectedFrameNumber:null,frameStatuses:{},aspectRatio:"16:9",characterConcepts:[],model:"gemini-2.5-flash-image",characterPromptCombination:"replace",enableAspectRatio:!1,isStyleCollapsed:!0,checkedFrameNumbers:[],topPaneHeight:440,leftPaneWidth:570,autoCrop169:!0});case z.PROMPT_SEQUENCE_EDITOR:return JSON.stringify({instruction:"",sourcePrompts:[],modifiedPrompts:[],leftPaneWidth:500,checkedSourceFrameNumbers:[],selectedFrameNumber:null,targetLanguage:"en",modificationModel:"gemini-3-flash-preview",sceneContexts:{},expandedSceneContexts:[]});case z.IMAGE_EDITOR:return JSON.stringify({inputImages:[],prompt:"",outputImage:null,aspectRatio:"1:1",enableAspectRatio:!1,enableOutpainting:!1,outpaintingPrompt:"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.",model:"gemini-3-flash-preview",autoDownload:!0,autoCrop169:!1,leftPaneWidth:360,topPaneHeight:330});case z.GEMINI_CHAT:return JSON.stringify({messages:[],currentInput:"",lastPrompt:""});case z.TRANSLATOR:return JSON.stringify({targetLanguage:"ru",inputText:"",translatedText:"",image:null});case z.SCRIPT_GENERATOR:return JSON.stringify({prompt:"",summary:"",detailedCharacters:[],scenes:[],targetLanguage:"en"});case z.SCRIPT_VIEWER:return"{}";case z.REROUTE_DOT:return JSON.stringify({type:null});case z.DATA_READER:return JSON.stringify({text:"",image:null});case z.MEDIA_VIEWER:return JSON.stringify({src:"",type:"video",name:"",markers:[],volume:.4});case z.DATA_PROTECTION:return JSON.stringify({score:0,bits:100,survivedWords:[]});case z.POSE_CREATOR:return JSON.stringify({joints:[],aspectRatio:"1:1",resolution:"1K",renderedImage:null,aiPrompt:""});default:return""}},Jb=e=>{const{type:t,value:o}=e,r=Gi(e);try{const a=JSON.parse(o||"{}"),i=JSON.parse(r);switch(t){case z.POSE_CREATOR:return JSON.stringify({...i,joints:a.joints||i.joints,aspectRatio:a.aspectRatio||i.aspectRatio,resolution:a.resolution||i.resolution});case z.VIDEO_EDITOR:return JSON.stringify({...i,tracks:a.tracks||i.tracks,totalDuration:a.totalDuration||30,mediaFiles:a.mediaFiles||[]});case z.PROMPT_PROCESSOR:return JSON.stringify({inputPrompt:a.inputPrompt||"",prompt:"",safePrompt:a.safePrompt!==void 0?a.safePrompt:!0});case z.VIDEO_PROMPT_PROCESSOR:return JSON.stringify({inputPrompt:a.inputPrompt||"",prompt:""});case z.TRANSLATOR:return JSON.stringify({...i,targetLanguage:a.targetLanguage||"ru"});case z.IMAGE_EDITOR:return JSON.stringify({...i,aspectRatio:a.aspectRatio||"1:1",enableAspectRatio:a.enableAspectRatio!==void 0?a.enableAspectRatio:!1,enableOutpainting:a.enableOutpainting!==void 0?a.enableOutpainting:!1,outpaintingPrompt:a.outpaintingPrompt||"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.",model:a.model||"gemini-3-flash-preview",autoDownload:a.autoDownload!==void 0?a.autoDownload:!0,autoCrop169:a.autoCrop169!==void 0?a.autoCrop169:!1,leftPaneWidth:a.leftPaneWidth||360,topPaneHeight:a.topPaneHeight||330});case z.IMAGE_SEQUENCE_GENERATOR:return JSON.stringify({...i,prompts:[],characterConcepts:a.characterConcepts||[],aspectRatio:a.aspectRatio||"16:9",autoDownload:a.autoDownload||!1,model:a.model||"gemini-2.5-flash-image",topPaneHeight:a.topPaneHeight||440,leftPaneWidth:a.leftPaneWidth||570,enableAspectRatio:a.enableAspectRatio!==void 0?a.enableAspectRatio:!1,isStyleCollapsed:a.isStyleCollapsed!==void 0?a.isStyleCollapsed:!0,autoCrop169:a.autoCrop169!==void 0?a.autoCrop169:!0});case z.CHARACTER_CARD:return JSON.stringify({...i,name:a.name,index:a.index,prompt:a.prompt,fullDescription:a.fullDescription,selectedRatio:a.selectedRatio});case z.NOTE:return r;case z.PROMPT_SEQUENCE_EDITOR:return JSON.stringify({...i,targetLanguage:a.targetLanguage,modificationModel:a.modificationModel,leftPaneWidth:a.leftPaneWidth||500});case z.MEDIA_VIEWER:return r;case z.DATA_PROTECTION:return r;default:return r}}catch{return r}},Ri=e=>{switch(e){case z.POSE_CREATOR:return{minWidth:600,minHeight:800};case z.VIDEO_EDITOR:return{minWidth:920,minHeight:640};case z.TEXT_INPUT:return{minWidth:460,minHeight:300};case z.IMAGE_INPUT:return{minWidth:460,minHeight:340};case z.PROMPT_PROCESSOR:return{minWidth:460,minHeight:410};case z.PROMPT_SANITIZER:return{minWidth:460,minHeight:280};case z.VIDEO_PROMPT_PROCESSOR:return{minWidth:460,minHeight:410};case z.IMAGE_OUTPUT:return{minWidth:460,minHeight:700};case z.VIDEO_OUTPUT:return{minWidth:460,minHeight:680};case z.PROMPT_ANALYZER:return{minWidth:460,minHeight:1e3};case z.CHARACTER_ANALYZER:return{minWidth:460,minHeight:500};case z.CHARACTER_GENERATOR:return{minWidth:500,minHeight:840};case z.CHARACTER_CARD:return{minWidth:520,minHeight:960};case z.IMAGE_ANALYZER:return{minWidth:460,minHeight:680};case z.IMAGE_EDITOR:return{minWidth:1e3,minHeight:920};case z.IMAGE_SEQUENCE_GENERATOR:return{minWidth:1300,minHeight:920};case z.PROMPT_SEQUENCE_EDITOR:return{minWidth:1300,minHeight:920};case z.GEMINI_CHAT:return{minWidth:400,minHeight:640};case z.TRANSLATOR:return{minWidth:380,minHeight:640};case z.SCRIPT_GENERATOR:return{minWidth:500,minHeight:1e3};case z.SCRIPT_VIEWER:return{minWidth:500,minHeight:600};case z.NOTE:return{minWidth:460,minHeight:660};case z.REROUTE_DOT:return{minWidth:60,minHeight:40};case z.DATA_READER:return{minWidth:400,minHeight:500};case z.MEDIA_VIEWER:return{minWidth:480,minHeight:320};case z.DATA_PROTECTION:return{minWidth:800,minHeight:600};default:return{minWidth:200,minHeight:150}}},Tx=(e,t,o)=>{const r=(a,i,s)=>{var x;const l=a.isCollapsed;if(a.type===z.REROUTE_DOT){let k=!1;try{k=JSON.parse(a.value||"{}").direction==="RL"}catch{}return{x:a.position.x+(s?k?a.width:0:k?0:a.width),y:a.position.y+a.height/2}}if(a.dockState){const k=s?0:160;let C=s?[void 0]:[void 0];a.type===z.IMAGE_EDITOR&&s?C=["image","text"]:a.type===z.IMAGE_SEQUENCE_GENERATOR&&s&&(C=["character_data","prompt_input"]);let w=C.indexOf(i);return w===-1&&(w=0),{x:a.position.x+k,y:a.position.y+(w+1)*(48/(C.length+1))}}const c=Ri(a.type),d=Math.max(a.width,c.minWidth),u=l?Nn:Math.max(a.height,c.minHeight),p=s?0:d;let h=u/2;if(l)if(a.type===z.CHARACTER_CARD&&!s){const k=["all_data","primary_data"],C=["image","prompt","appearance","personality","clothing"];let w=[...k,...C];a.collapsedHandles&&(w=k);const f=w.indexOf(i||"");f!==-1?h=(f+1)*(Nn/(w.length+1)):h=Nn/2}else if(a.type===z.VIDEO_EDITOR&&s){const k=["video","audio","image","text"],C=k.indexOf(i||"");C!==-1?h=(C+1)*(Nn/(k.length+1)):h=Nn/2}else h=Nn/2;else if(a.type===z.IMAGE_EDITOR&&s){const C=Rt+Jt;i==="image"?h=C+82.5:i==="image_b"?h=C+247.5:i==="text"&&(h=C+330+16+(u-(C+330+16))/2)}else if(a.type===z.IMAGE_SEQUENCE_GENERATOR&&s){let k="normal";try{const f=JSON.parse(a.value||"{}");f.conceptsMode&&(k=f.conceptsMode)}catch{}let C=390;k==="collapsed"?C=37:k==="expanded"&&(C=u-Rt-Jt);const w=Rt+Jt;if(i==="character_data")h=w+C/2;else if(i==="prompt_input")if(k==="expanded")h=u-10;else{const g=w+C+8;h=g+(u-g-Jt)/2}}else if(a.type===z.VIDEO_EDITOR&&s){const k=Rt+20,C=50;i==="video"?h=k:i==="audio"?h=k+C:i==="image"?h=k+C*2:i==="text"?h=k+C*3:h=u/2}else if(a.type===z.IMAGE_INPUT&&!s){const k=u-Rt-2*Jt,C=Math.max(0,k);i==="image"?h=Rt+Jt+C/4:i==="text"&&(h=u-80)}else if(a.type===z.CHARACTER_CARD&&!s){const k=["all_data","primary_data"],C=["image","prompt","appearance","personality","clothing"];let w=[...k,...C];a.collapsedHandles&&(w=k);const g=(u-Rt-20)/(w.length+1),v=w.indexOf(i||"");v!==-1&&(h=Rt+g*(v+1))}else if(a.type===z.PROMPT_ANALYZER&&!s)try{const C=((x=JSON.parse(a.value||"{}").characters)==null?void 0:x.length)||0,w=4+C;let f=0;i==="environment"?f=0:i!=null&&i.startsWith("character-")?f=1+parseInt(i.split("-")[1]):i==="action"?f=1+C:i==="emotion"?f=2+C:i==="style"&&(f=3+C),h=Rt+Jt+(u-Rt-60)/w*(f+.5)}catch{}else if(a.type===z.IMAGE_ANALYZER&&!s){const k=u-Rt-2*Jt,C=8,w=(k-C)/2,f=Rt+Jt;i==="image"?h=f+w/2:i==="text"&&(h=f+w+C+w/2)}return{x:a.position.x+p,y:a.position.y+h}};return{start:r(e,o.fromHandleId,!1),end:r(t,o.toHandleId,!0)}},br=async(e,t)=>new Promise((o,r)=>{if(!e)return r(new Error("Source image is empty."));const a=new Image;a.onload=()=>{const i=a.width/a.height,[s,l]=t.split(":").map(Number),c=s/l;if(Math.abs(i-c)<.01)return o({formattedImage:e,needsFormatting:!1});let d,u,p,h;i>c?(d=a.width,u=a.width/c,p=0,h=(u-a.height)/2):(u=a.height,d=a.height*c,p=(d-a.width)/2,h=0);const x=document.createElement("canvas");x.width=d,x.height=u;const k=x.getContext("2d");if(!k)return r(new Error("Could not get canvas context"));k.fillStyle="white",k.fillRect(0,0,x.width,x.height),k.drawImage(a,p,h,a.width,a.height),o({formattedImage:x.toDataURL("image/png"),needsFormatting:!0})},a.onerror=()=>{console.error("Failed to load image for formatting. The provided image source might be invalid or corrupted."),r(new Error("Failed to load the provided image. It might be corrupted or in an unsupported format."))},a.src=e}),Ra=e=>new Promise((t,o)=>{if(!e)return o(new Error("Source image is empty for cropping."));const r=new Image;r.onload=()=>{const a=1.7777777777777777,i=r.width/r.height;if(i<1.2||Math.abs(i-a)<.02)return t(e);let s,l,c=0,d=0;i>a?(l=r.height,s=r.height*a,c=(r.width-s)/2):(s=r.width,l=r.width/a,d=(r.height-l)/2);const u=document.createElement("canvas");u.width=s,u.height=l;const p=u.getContext("2d");if(!p)return o(new Error("Could not get canvas context for cropping."));p.drawImage(r,c,d,s,l,0,0,s,l),t(u.toDataURL("image/png"))},r.onerror=()=>{o(new Error("Failed to load the provided image for cropping."))},r.src=e}),Yb=e=>new Promise((t,o)=>{if(!e)return o(new Error("Source image is empty for cropping."));const r=new Image;r.onload=()=>{const a=Math.min(r.width,r.height),i=(r.width-a)/2,s=(r.height-a)/2,l=document.createElement("canvas");l.width=a,l.height=a;const c=l.getContext("2d");if(!c)return o(new Error("Could not get canvas context for cropping."));c.drawImage(r,i,s,a,a,0,0,a,a),t(l.toDataURL("image/png"))},r.onerror=()=>{o(new Error("Failed to load the provided image for cropping."))},r.src=e}),Lt=async(e,t,o)=>new Promise((r,a)=>{if(!e)return a(new Error("Source image is empty."));const i=new Image;i.onload=()=>{const s=document.createElement("canvas"),l=s.getContext("2d");if(!l)return a(new Error("Could not get canvas context"));let{width:c,height:d}=i;const u=c/d;c>t&&(c=t,d=c/u),d>o&&(d=o,c=d*u),s.width=c,s.height=d,l.drawImage(i,0,0,c,d),r(s.toDataURL("image/jpeg",.8))},i.onerror=s=>{console.error("Failed to load image for thumbnail generation:",s),a(new Error("Failed to load the provided image for thumbnailing."))},i.src=e}),Xb=(e,t,o,r,a,i)=>{const[s,l]=y.useState(e),c=y.useRef(t),d=y.useCallback((O,E)=>{l(A=>A.map(N=>N.id===O?{...N,value:E}:N))},[]),u=y.useCallback((O,E)=>{l(A=>A.map(N=>N.id===O?{...N,title:E}:N))},[]),p=y.useCallback(O=>{l(E=>E.map(A=>A.id===O&&A.isNewlyCreated?{...A,isNewlyCreated:!1}:A))},[]),h=O=>{l(E=>E.filter(A=>A.id!==O))},x=y.useCallback(O=>{const E=s.find(j=>j.id===O);if(!E)return;c.current++;const A=`node-${c.current}-${Date.now()}`,N={...E,id:A,position:{x:E.position.x+30,y:E.position.y+30},isNewlyCreated:!0,value:Jb(E)};return l(j=>[...j,N]),o(r("toast.nodeDuplicated")),A},[s,c,l,o,r]),k=y.useCallback(O=>{const E=s.find(j=>j.id===O);if(!E)return;c.current++;const A=`node-${c.current}-${Date.now()}`,N={...E,id:A,position:{x:E.position.x+30,y:E.position.y+30},isNewlyCreated:!0,value:E.value};for(let j=0;j<=100;j++){const L=i(O,j);L&&a(A,j,L)}return l(j=>[...j,N]),o(r("toast.nodeDuplicated")),A},[s,c,l,o,r,i,a]);return{nodes:s,setNodes:l,nodeIdCounter:c,handleValueChange:d,handleRenameNode:u,handleDeleteNode:h,handleDuplicateNode:x,handleDuplicateNodeWithContent:k,handlePasteNodeValue:async O=>{const E=s.find(A=>A.id===O);if(!E)return"Node not found.";try{const A=await navigator.clipboard.readText();if(E.type===z.CHARACTER_CARD)try{const N=JSON.parse(A);let j=[];if(Array.isArray(N)?j=N:typeof N=="object"&&N!==null&&(j=[N]),j.length>0&&(j[0].type==="character-card"||j[0].name||j[0].imageSources||j[0].prompt)){let M=[];try{M=JSON.parse(E.value||"[]"),Array.isArray(M)||(M=[M])}catch{M=[]}const V=M.length,H=await Promise.all(j.map(async(ee,ie)=>{const ce=V+ie,pe=ee.imageSources||{"1:1":null,"16:9":null,"9:16":null},ue={"1:1":null,"16:9":null,"9:16":null};ee.image&&!ee.imageSources&&(pe["1:1"]=ee.image);for(const[Z,te]of Object.entries(pe))if(typeof te=="string"&&te.startsWith("data:")){const ae=Wt[Z];ae&&a(O,ce*10+ae,te);try{const I=await Lt(te,256,256);ue[Z]=I}catch{ue[Z]=te}}else ue[Z]=te;const re=ee.selectedRatio||"1:1",$=pe[re];return $&&typeof $=="string"&&$.startsWith("data:")&&a(O,ce*10,$),{id:`char-card-${Date.now()}-${ce}`,name:ee.name||"",index:ee.index||ee.alias||`Entity-${ce+1}`,prompt:ee.prompt||ee.imagePrompt||"",fullDescription:ee.fullDescription||ee.description||"",selectedRatio:re,image:ue[re],thumbnails:ue,isOutput:!1}})),F=[...M,...H],Y=F.length*410+110;return l(ee=>ee.map(ie=>ie.id===O?{...ie,value:JSON.stringify(F),width:Y}:ie)),o(r("toast.pastedFromClipboard")),null}}catch{}return d(O,A),o(r("toast.pastedFromClipboard")),null}catch{return o(r("toast.pasteFailed"),"error"),"Could not read from clipboard."}},handlePasteImageToNode:async(O,E=null)=>{const A=N=>{const j=new FileReader;j.onload=async L=>{var F;const M=(F=L.target)==null?void 0:F.result;if(!M)return;const V=await Lt(M,512,512),H=await ml(M);l(G=>{const B=G.findIndex(pe=>pe.id===O);if(B===-1)return G;const Y=G[B];let ee=Y.value,ie=Y.width;try{const pe=JSON.parse(Y.value||"{}");if(Y.type===z.IMAGE_EDITOR){const ue=[...pe.inputImages||[],V];a(O,ue.length,M),ee=JSON.stringify({...pe,inputImages:ue})}else if(Y.type===z.IMAGE_INPUT||Y.type===z.IMAGE_ANALYZER||Y.type===z.CHARACTER_CARD||Y.type===z.TRANSLATOR)if(Y.type===z.TRANSLATOR&&(ee=JSON.stringify({...pe,image:V})),a(O,0,M),Y.type===z.CHARACTER_CARD){let ue=Array.isArray(pe)?[...pe]:[pe];const re=ue.length,$="1:1",Z={"1:1":V,"16:9":null,"9:16":null},te={id:`char-card-${Date.now()}-${re}`,name:`New Entity ${re+1}`,index:`Entity-${re+1}`,image:V,thumbnails:Z,selectedRatio:$,prompt:H||"",fullDescription:"",targetLanguage:"en",isOutput:ue.length===0};ue.push(te);const ae=Wt[$];ae&&a(O,re*10+ae,M),a(O,re*10,M),ie=ue.length*410+110,ee=JSON.stringify(ue)}else Y.type!==z.TRANSLATOR&&(ee=JSON.stringify({...pe,image:V,prompt:H||pe.prompt||""}));else return G}catch{if(Y.type===z.IMAGE_INPUT||Y.type===z.IMAGE_ANALYZER)a(O,0,M),ee=JSON.stringify({image:V,prompt:H||""});else if(Y.type===z.TRANSLATOR)a(O,0,M),ee=JSON.stringify({image:V});else if(Y.type===z.CHARACTER_CARD){a(O,0,M);const pe={"1:1":V,"16:9":null,"9:16":null};ee=JSON.stringify([{id:`char-card-${Date.now()}`,image:V,thumbnails:pe,selectedRatio:"1:1",name:"New Entity 1",index:"Entity-1",prompt:H||"",isOutput:!0}]),a(O,1,M),ie=410+110}else return G}const ce=[...G];return ce[B]={...Y,value:ee,width:ie},ce}),o(r("toast.pastedFromClipboard"))},j.readAsDataURL(N)};if(E)return A(E),null;try{const N=await navigator.clipboard.read();for(const j of N)for(const L of j.types)if(L.startsWith("image/")){const M=await j.getType(L),V=new File([M],"pasted_image.png",{type:M.type});return A(V),null}return o(r("toast.pasteFailed"),"error"),"No image found on clipboard."}catch{return o(r("toast.pasteFailed"),"error"),"Could not read from clipboard."}},handleCopyNodeValue:async O=>{var j,L;const E=s.find(M=>M.id===O);if(!E)return"Node not found.";let A=null,N=E.value;try{if((j=E.value)!=null&&j.startsWith("{")||(L=E.value)!=null&&L.startsWith("[")){const M=JSON.parse(E.value);switch(E.type){case z.IMAGE_INPUT:A=i(E.id,0)||M.image,A?N="":N=M.prompt||"";break;case z.IMAGE_ANALYZER:A=i(E.id,0)||M.image,N=M.prompt||M.description||"";break;case z.CHARACTER_CARD:{const H=(Array.isArray(M)?M:[M]).map((F,G)=>{const B={...F.thumbnails};Object.entries(Wt).forEach(([pe,ue])=>{const re=i(E.id,G*10+ue);re&&(B[pe]=re)});const Y=F.selectedRatio||"1:1",ie=i(E.id,G*10)||B[Y]||F.image,ce={type:"character-card",nodeTitle:E.title,...F,image:ie,imageSources:B};return delete ce.thumbnails,delete ce.id,ce});N=JSON.stringify(H,null,2),A=null}break;case z.IMAGE_EDITOR:A=i(E.id,0)||M.outputImage,N=M.prompt||"";break;case z.IMAGE_OUTPUT:A=i(E.id,0)||E.value,N="";break;case z.TRANSLATOR:N=M.translatedText||M.inputText||"";break;case z.PROMPT_PROCESSOR:N=M.prompt||"";break;case z.PROMPT_ANALYZER:case z.CHARACTER_ANALYZER:case z.SCRIPT_GENERATOR:case z.CHARACTER_GENERATOR:N=JSON.stringify(M,null,2);break;default:N=E.value}}else(E.type===z.IMAGE_OUTPUT||E.type===z.IMAGE_INPUT)&&E.value.startsWith("data:image")?(A=i(E.id,0)||E.value,N=""):N=E.value}catch{N=E.value}try{if(A&&A.startsWith("data:image")){let V=await(await fetch(A)).blob();if(V.type!=="image/png")try{const H=await createImageBitmap(V),F=document.createElement("canvas");F.width=H.width,F.height=H.height;const G=F.getContext("2d");if(G){G.drawImage(H,0,0);const B=await new Promise(Y=>F.toBlob(Y,"image/png"));B&&(V=B)}}catch{}return await navigator.clipboard.write([new ClipboardItem({[V.type]:V})]),o(r("toast.copiedToClipboard")),null}else if(N&&typeof N=="string"&&N.trim()!=="")return await navigator.clipboard.writeText(N),o(r("toast.copiedToClipboard")),null}catch{return"Could not write to clipboard."}return"Nothing to copy."},handleAspectRatioChange:(O,E)=>{l(A=>A.map(N=>N.id===O?{...N,aspectRatio:E}:N))},handleResolutionChange:(O,E)=>{l(A=>A.map(N=>N.id===O?{...N,resolution:E}:N))},handleModelChange:(O,E)=>{l(A=>A.map(N=>N.id===O?{...N,model:E}:N))},handleAutoDownloadChange:(O,E)=>{l(A=>A.map(N=>N.id===O?{...N,autoDownload:E}:N))},handleSetImageEditorOutputToInput:O=>{const E=s.find(A=>A.id===O);if(!(!E||E.type!==z.IMAGE_EDITOR))try{const A=JSON.parse(E.value);if(A.outputImage){const N=[...A.inputImages||[],A.outputImage],j=i(O,0);j&&a(O,N.length,j),d(O,JSON.stringify({...A,inputImages:N,outputImage:null}))}}catch{}},handleRefreshImageEditor:O=>{const E=s.find(L=>L.id===O);if(!E||E.type!==z.IMAGE_EDITOR)return;let A={};try{const L=JSON.parse(E.value||"{}");A={enableAspectRatio:L.enableAspectRatio,enableOutpainting:L.enableOutpainting,aspectRatio:L.aspectRatio,outpaintingPrompt:L.outpaintingPrompt}}catch{}const j={...JSON.parse(Gi(E)),...A};d(O,JSON.stringify(j))},handleToggleNodeCollapse:O=>{l(E=>E.map(A=>A.id===O?{...A,isCollapsed:!A.isCollapsed}:A))},handleToggleNodePin:O=>{l(E=>E.map(A=>A.id===O?{...A,isPinned:!A.isPinned}:A))},handleToggleNodeHandles:O=>{l(E=>E.map(A=>A.id===O?{...A,collapsedHandles:!A.collapsedHandles}:A))},handleClearNodeNewFlag:p}},Zb=(e,t,o)=>{const[r,a]=y.useState(()=>e.map((c,d)=>({...c,id:c.id||`initial-conn-${Date.now()}-${d}`}))),i=y.useCallback(c=>{a(d=>{if(d.some(p=>p.fromNodeId===c.fromNodeId&&p.toNodeId===c.toNodeId&&p.fromHandleId===c.fromHandleId&&p.toHandleId===c.toHandleId))return d;const u={...c,id:`conn-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};return[...d,u]})},[]),s=y.useCallback(c=>{a(d=>{const u=d.filter(p=>p.fromNodeId!==c&&p.toNodeId!==c);return u.length<d.length&&t(o("toast.connectionsCut")),u})},[t,o]),l=y.useCallback(c=>{a(d=>d.filter(u=>u.id!==c))},[]);return{connections:r,setConnections:a,addConnection:i,removeConnectionsByNodeId:s,removeConnectionById:l}},Qb=e=>{const[t,o]=y.useState(e||{scale:1,translate:{x:0,y:0}}),[r,a]=y.useState(null),[i,s]=y.useState({x:0,y:0}),[l,c]=y.useState(()=>({x:typeof window<"u"?window.innerWidth/2:0,y:typeof window<"u"?window.innerHeight/2:0})),d=y.useRef(null),u=y.useCallback(P=>{d.current=P},[]),p=y.useCallback(P=>{if(!d.current)return P;const R=d.current.getBoundingClientRect();return{x:P.x-R.left,y:P.y-R.top}},[]),h=y.useCallback(P=>{const R=p(P);return!Number.isFinite(t.scale)||t.scale===0||!Number.isFinite(t.translate.x)||!Number.isFinite(t.translate.y)?{x:0,y:0}:{x:(R.x-t.translate.x)/t.scale,y:(R.y-t.translate.y)/t.scale}},[t.scale,t.translate.x,t.translate.y,p]),x=y.useCallback((P,R)=>{const D=p(R);o(q=>{let O=Math.max(.1,Math.min(P,2));(!Number.isFinite(O)||Number.isNaN(O))&&(O=1);const E=Number.isFinite(q.scale)&&q.scale>0?q.scale:1,A=Number.isFinite(q.translate.x)?q.translate.x:0,N=Number.isFinite(q.translate.y)?q.translate.y:0,j=(D.x-A)/E,L=(D.y-N)/E,M=D.x-j*O,V=D.y-L*O;return!Number.isFinite(M)||!Number.isFinite(V)?q:{scale:O,translate:{x:M,y:V}}})},[p]),k=y.useCallback(P=>{const R=window.innerWidth/2,D=window.innerHeight/2;x(P,{x:R,y:D})},[x]),C=y.useCallback(P=>{P.preventDefault(),P.stopPropagation();const R=Math.pow(1.001,-P.deltaY);o(D=>{const q=Number.isFinite(D.scale)&&D.scale>0?D.scale:1,O=Number.isFinite(D.translate.x)?D.translate.x:0,E=Number.isFinite(D.translate.y)?D.translate.y:0,A=Math.max(.1,Math.min(2,q*R));if(!Number.isFinite(A))return D;const N=p({x:P.clientX,y:P.clientY}),j=(N.x-O)/q,L=(N.y-E)/q,M=N.x-j*A,V=N.y-L*A;return!Number.isFinite(M)||!Number.isFinite(V)?D:{scale:A,translate:{x:M,y:V}}})},[p]),w=y.useCallback(P=>{o(R=>!Number.isFinite(R.translate.x)||!Number.isFinite(R.translate.y)?{scale:1,translate:{x:window.innerWidth/2,y:window.innerHeight/2}}:(a({startPoint:P,startTranslate:{...R.translate}}),R))},[]),f=y.useCallback(()=>a(null),[]),g=y.useCallback(P=>{if(!r)return;const R=P.x-r.startPoint.x,D=P.y-r.startPoint.y;o(q=>{const O=r.startTranslate.x+R,E=r.startTranslate.y+D;return!Number.isFinite(O)||!Number.isFinite(E)?q:{...q,translate:{x:O,y:E}}})},[r]),v=y.useCallback(P=>{const R={x:P.clientX,y:P.clientY},D=h(R);s(D),c(R)},[h]),_=y.useCallback(()=>{const P=window.innerWidth/2,R=window.innerHeight/2;o({scale:1,translate:{x:P,y:R}})},[]);return{viewTransform:t,setViewTransform:o,isPanning:!!r,pointerPosition:i,clientPointerPosition:l,handleWheel:C,startPanning:w,stopPanning:f,pan:g,updatePointerPosition:v,setZoom:x,setCanvasRef:u,getCanvasRelativePoint:p,getTransformedPoint:h,handleZoomChange:k,scaleToSliderValue:P=>P>=1?(P-1)*100:(P-1)*125,sliderValueToScale:P=>P>=0?1+P/100:1+P/125,resetView:_}},eC=({viewTransform:e,setViewTransform:t,isPanning:o,pan:r,startPanning:a,stopPanning:i,getCanvasRelativePoint:s,setZoom:l,handleCloseAddNodeMenus:c,setSelectedNodeIds:d,effectiveTool:u,setZoomDragInfo:p,getTransformedPoint:h,setSelectionRect:x})=>{const k=y.useRef(null),C=(S,T)=>{const P=S.clientX-T.clientX,R=S.clientY-T.clientY;return Math.hypot(P,R)},w=(S,T)=>({x:(S.clientX+T.clientX)/2,y:(S.clientY+T.clientY)/2}),f=y.useCallback(S=>{if(window.focus(),document.activeElement instanceof HTMLElement&&document.activeElement.blur(),c(),S.button===1){S.preventDefault(),a({x:S.clientX,y:S.clientY});return}if(S.button===0){if(u==="zoom"){S.preventDefault(),p({startClientX:S.clientX,startScale:e.scale,pivot:{x:S.clientX,y:S.clientY}});return}if(u==="selection"||S.shiftKey){S.preventDefault(),S.shiftKey||d([]);const T=h({x:S.clientX,y:S.clientY});x({start:T,end:T});return}!S.ctrlKey&&!S.metaKey&&!S.altKey&&d([]),S.preventDefault(),a({x:S.clientX,y:S.clientY})}},[u,a,e.scale,h,d,c,p,x]),g=y.useCallback(S=>{if(window.focus(),document.activeElement instanceof HTMLElement&&document.activeElement.blur(),c(),S.touches.length===2){o&&i();const T=C(S.touches[0],S.touches[1]),P=w(S.touches[0],S.touches[1]),R=s(P);k.current={startDist:T,startCenter:R,startTransform:{...e}};return}S.touches.length===1&&a({x:S.touches[0].clientX,y:S.touches[0].clientY})},[c,a,o,i,e,s]),v=y.useCallback(S=>{if(S.touches.length===2&&k.current){S.cancelable&&S.preventDefault&&S.preventDefault();const T=C(S.touches[0],S.touches[1]),P=w(S.touches[0],S.touches[1]),R=s(P),{startDist:D,startCenter:q,startTransform:O}=k.current;if(D===0)return;const E=T/D;let A=O.scale*E;A=Math.max(.1,Math.min(A,5));const N=A/O.scale,j=R.x-(q.x-O.translate.x)*N,L=R.y-(q.y-O.translate.y)*N;t({scale:A,translate:{x:j,y:L}});return}o&&S.touches.length===1&&(S.cancelable&&S.preventDefault&&S.preventDefault(),r({x:S.touches[0].clientX,y:S.touches[0].clientY}))},[o,r,t,s]),_=y.useCallback(S=>{S.touches.length<2&&(k.current=null),o&&S.touches.length===0&&i()},[o,i]);return{handleCanvasMouseDown:f,handleCanvasTouchStart:g,handleCanvasTouchMove:v,handleCanvasTouchEnd:_,pinchRef:k}},tC=({nodesRef:e,setNodes:t,groupsRef:o,setGroups:r,viewTransform:a,isSnapToGrid:i,isSmartGuidesEnabled:s,setSmartGuides:l,handleCloseAddNodeMenus:c,setSelectedNodeIds:d,selectedNodeIds:u,getTransformedPoint:p,activeTool:h,handleDockNode:x,setIsDockingMenuVisible:k,setDockHoverMode:C,dockHoverMode:w,connections:f,setConnections:g})=>{const[v,_]=y.useState(null),S=y.useRef(null),[T,P]=y.useState(null),R=y.useRef(null),[D,q]=y.useState(null),O=y.useRef(null);Et.useEffect(()=>{S.current=v},[v]),Et.useEffect(()=>{R.current=T},[T]);const E=y.useCallback((F,G)=>{if(F.stopPropagation(),F.button!==0)return;c(),t(ee=>{const ie=ee.findIndex(Z=>Z.id===G);if(ie===-1)return ee;const ce=ee[ie],pe=ie!==ee.length-1,ue=ce.isNewlyCreated;if(!pe&&!ue)return ee;const re=[...ee],[$]=re.splice(ie,1);return re.push({...$,isNewlyCreated:!1}),re});let B=[...u];const Y=B.includes(G);if(F.shiftKey||F.ctrlKey||F.metaKey?(Y?B=B.filter(ee=>ee!==G):B.push(G),d(B)):Y||(B=[G],d(B)),B.includes(G)){if(h==="edit"&&(F.ctrlKey||F.metaKey)&&!F.altKey||h==="cutter")return;const ee=p({x:F.clientX,y:F.clientY}),ie=new Map,ce=new Map;e.current.filter(re=>B.includes(re.id)).forEach(re=>{ie.set(re.id,{x:ee.x-re.position.x,y:ee.y-re.position.y}),ce.set(re.id,{...re.position})});const ue={type:"node",id:G,offsets:ie,initialPositions:ce,isDetaching:F.altKey};S.current=ue,_(ue)}},[u,d,p,_,c,h,t,e]),A=y.useCallback((F,G)=>{if(F.touches.length!==1)return;c();const B=F.touches[0];F.stopPropagation(),t(re=>{const $=re.findIndex(W=>W.id===G);if($===-1)return re;const Z=re[$],te=$!==re.length-1,ae=Z.isNewlyCreated;if(!te&&!ae)return re;const I=[...re],[J]=I.splice($,1);return I.push({...J,isNewlyCreated:!1}),I});let Y=[...u];Y.includes(G)||(Y=[G],d(Y));const ee=p({x:B.clientX,y:B.clientY}),ie=new Map,ce=new Map;e.current.filter(re=>Y.includes(re.id)).forEach(re=>{ie.set(re.id,{x:ee.x-re.position.x,y:ee.y-re.position.y}),ce.set(re.id,{...re.position})});const ue={type:"node",id:G,offsets:ie,initialPositions:ce,isDetaching:!1};S.current=ue,_(ue)},[u,d,p,_,c,t,e]),N=y.useCallback((F,G,B)=>{F.stopPropagation(),F.preventDefault(),F.currentTarget.setPointerCapture&&F.currentTarget.setPointerCapture(F.pointerId);const Y=e.current.find(ee=>ee.id===G);if(Y){const ee={nodeId:G,startPosition:{x:F.clientX,y:F.clientY},startSize:{width:Y.width,height:Y.height},direction:B};P(ee),R.current=ee}},[e]),j=y.useCallback((F,G)=>{if(F.stopPropagation(),F.button!==0)return;c(),r(ce=>{const pe=ce.findIndex($=>$.id===G);if(pe===-1||pe===ce.length-1)return ce;const ue=[...ce],[re]=ue.splice(pe,1);return ue.push(re),ue}),d([]);const B=o.current.find(ce=>ce.id===G);if(!B)return;const Y=p({x:F.clientX,y:F.clientY}),ee=new Map;ee.set(G,{x:Y.x-B.position.x,y:Y.y-B.position.y}),B.nodeIds.forEach(ce=>{const pe=e.current.find(ue=>ue.id===ce);pe&&ee.set(ce,{x:Y.x-pe.position.x,y:Y.y-pe.position.y})});const ie={type:"group",id:G,offsets:ee};S.current=ie,_(ie)},[p,_,c,d,r,o,e]),L=y.useCallback((F,G)=>{if(F.stopPropagation(),F.touches.length!==1)return;c();const B=F.touches[0];r(pe=>{const ue=pe.findIndex(Z=>Z.id===G);if(ue===-1||ue===pe.length-1)return pe;const re=[...pe],[$]=re.splice(ue,1);return re.push($),re}),d([]);const Y=o.current.find(pe=>pe.id===G);if(!Y)return;const ee=p({x:B.clientX,y:B.clientY}),ie=new Map;ie.set(G,{x:ee.x-Y.position.x,y:ee.y-Y.position.y}),Y.nodeIds.forEach(pe=>{const ue=e.current.find(re=>re.id===pe);ue&&ie.set(pe,{x:ee.x-ue.position.x,y:ee.y-ue.position.y})});const ce={type:"group",id:G,offsets:ie};S.current=ce,_(ce)},[p,_,c,d,r,o,e]);return{handleNodeMouseDown:E,handleNodeTouchStart:A,handleNodeResizeMouseDown:N,handleGroupMouseDown:j,handleGroupTouchStart:L,processDrag:(F,G,B)=>{const Y=(F.clientX-a.translate.x)/a.scale,ee=(F.clientY-a.translate.y)/a.scale;if(S.current){const ie=S.current,ce=i?20:1;if(ie.type==="node"){const pe=ie.id,ue=e.current.find(fe=>fe.id===pe);if(ue&&!ue.dockState&&ue.type!==z.REROUTE_DOT){const fe=window.innerWidth,he=150,ye=80,Se=F.clientY<he;k(Se);const Te=document.elementFromPoint(F.clientX,F.clientY),Ae=Te==null?void 0:Te.closest("[data-dock-mode]"),Oe=Ae==null?void 0:Ae.getAttribute("data-dock-mode");Oe?C(Oe):F.clientX<ye?C("q1"):F.clientX>fe-ye?C("q4"):C(null)}const re=Array.from(ie.offsets.keys()),$=ie.id,Z=ie.offsets.get($),te=Y-Z.x,ae=ee-Z.y,I=e.current.find(fe=>fe.id===$),J=I.isCollapsed?Nn:I.height;let W=null;const U=I.width,Q=J,de=U*.05,se=Q*.05,X=te+de,K=ae+se,oe=te+U-de,ne=ae+Q-se;for(let fe=o.current.length-1;fe>=0;fe--){const he=o.current[fe],ye=he.position.x,Se=he.position.y,Te=he.position.x+he.width,Ae=he.position.y+he.height;if(!(oe<ye||X>Te||ne<Se||K>Ae)){W=he.id;break}}O.current!==W&&(O.current=W,q(W));let le=0,ge=0,we=[];if((s||B)&&re.length===1){const fe=10/a.scale,he=e.current.filter(Te=>Te.id!==$);let ye=!1,Se=!1;for(const Te of he){if(ye&&Se)break;const Ae=Te.isCollapsed?Nn:Te.height;if(!ye){const Oe=[Te.position.x,Te.position.x+Te.width/2,Te.position.x+Te.width],me=[te,te+I.width/2,te+I.width];for(let ve of Oe){let Ie=!1;for(let ke of me)if(Math.abs(ke-ve)<fe){le=ve-ke;const je=Math.min(ae,Te.position.y)-50,Ge=Math.max(ae+J,Te.position.y+Ae)+50;we.push({type:"vertical",position:ve,start:je,end:Ge}),Ie=!0,ye=!0;break}if(Ie)break}}if(!Se){const Oe=[Te.position.y,Te.position.y+Ae/2,Te.position.y+Ae],me=[ae,ae+J/2,ae+J];for(let ve of Oe){let Ie=!1;for(let ke of me)if(Math.abs(ke-ve)<fe){ge=ve-ke;const je=Math.min(te,Te.position.x)-50,Ge=Math.max(te+I.width,Te.position.x+Te.width)+50;we.push({type:"horizontal",position:ve,start:je,end:Ge}),Ie=!0,Se=!0;break}if(Ie)break}}}}l(we);const _e=e.current.map(fe=>{const he=ie.offsets.get(fe.id);if(he){let ye=Y-he.x+le,Se=ee-he.y+ge;return i&&(ye=Math.round(ye/ce)*ce,Se=Math.round(Se/ce)*ce),{...fe,position:{x:ye,y:Se}}}return fe});if(e.current=_e,t(_e),!G){const fe=o.current.filter(he=>he.nodeIds.some(ye=>re.includes(ye)));fe.length>0&&r(he=>he.map(ye=>{if(fe.some(Se=>Se.id===ye.id)){const Se=_e.filter(Ae=>ye.nodeIds.includes(Ae.id)),Te=yr(Se);return Te?{...ye,...Te}:ye}return ye}))}}else if(ie.type==="group"){const pe=ie.offsets.get(ie.id),ue=Math.round((Y-pe.x)/ce)*ce,re=Math.round((ee-pe.y)/ce)*ce;o.current.find($=>$.id===ie.id),r($=>$.map(Z=>Z.id===ie.id?{...Z,position:{x:ue,y:re}}:Z)),t($=>$.map(Z=>{const te=ie.offsets.get(Z.id);if(te){let ae=Y-te.x,I=ee-te.y;return i&&(ae=Math.round(ae/ce)*ce,I=Math.round(I/ce)*ce),{...Z,position:{x:ae,y:I}}}return Z}))}}},processResize:F=>{const G=R.current;if(G){const B=e.current.find(Y=>Y.id===G.nodeId);if(B){const Y=B.dockState?1:a.scale,ee=(F.clientX-G.startPosition.x)/Y,ie=(F.clientY-G.startPosition.y)/Y,ce=Ri(B.type);let pe=B.width,ue=B.height,re=B.position.x,$=B.position.y;const Z=G.direction||"se";if(Z.includes("e")&&(pe=Math.max(ce.minWidth,G.startSize.width+ee)),Z.includes("s")&&(ue=Math.max(ce.minHeight,G.startSize.height+ie)),Z.includes("w")){const ae=Math.max(ce.minWidth,G.startSize.width-ee);re=B.position.x+(B.width-ae),pe=ae}if(Z.includes("n")){const ae=Math.max(ce.minHeight,G.startSize.height-ie);$=B.position.y+(B.height-ae),ue=ae}i&&(pe=Math.round(pe/20)*20,ue=Math.round(ue/20)*20),t(ae=>ae.map(I=>I.id===G.nodeId?{...I,width:pe,height:ue,position:{x:re,y:$}}:I));const te=o.current.filter(ae=>ae.nodeIds.includes(G.nodeId));te.length>0&&r(ae=>ae.map(I=>{if(te.some(J=>J.id===I.id)){const J=e.current.map(U=>U.id===G.nodeId?{...U,width:pe,height:ue,position:{x:re,y:$}}:U).filter(U=>I.nodeIds.includes(U.id)),W=yr(J);return W?{...I,...W}:I}return I}))}}},endDrag:()=>{var G;const F=S.current;if(F&&F.type==="node"&&w&&x){const B=(G=F.initialPositions)==null?void 0:G.get(F.id);x(F.id,w,B)}if(F&&F.type==="node"&&f&&g){const B=e.current.find(Y=>Y.id===F.id);if(B&&B.type===z.REROUTE_DOT){const Y={x:B.position.x+B.width/2,y:B.position.y+B.height/2},ee=f.find(ie=>{if(ie.fromNodeId===B.id||ie.toNodeId===B.id)return!1;const ce=e.current.find(ue=>ue.id===ie.fromNodeId),pe=e.current.find(ue=>ue.id===ie.toNodeId);if(ce&&pe){const{start:ue,end:re}=Tx(ce,pe,ie);return Kb(Y,ue,re,20)}return!1});if(ee){const ie=e.current.find(re=>re.id===ee.fromNodeId),ce=ie?Kn(ie,ee.fromHandleId):null;ce&&t(re=>re.map($=>$.id===B.id?{...$,value:JSON.stringify({type:ce})}:$));const pe={id:`conn-${Date.now()}-1`,fromNodeId:ee.fromNodeId,fromHandleId:ee.fromHandleId,toNodeId:B.id,toHandleId:void 0},ue={id:`conn-${Date.now()}-2`,fromNodeId:B.id,fromHandleId:void 0,toNodeId:ee.toNodeId,toHandleId:ee.toHandleId};g(re=>[...re.filter($=>$.id!==ee.id),pe,ue])}}}if(F&&F.type==="node"){const B=O.current,Y=Array.from(F.offsets.keys());r(ee=>{let ie=[...ee];return B&&!F.isDetaching?ie=ie.map(ce=>ce.id===B?{...ce,nodeIds:Array.from(new Set([...ce.nodeIds,...Y]))}:ce.nodeIds.some(pe=>Y.includes(pe))?{...ce,nodeIds:ce.nodeIds.filter(pe=>!Y.includes(pe))}:ce):F.isDetaching&&(ie=ie.map(ce=>({...ce,nodeIds:ce.nodeIds.filter(pe=>!Y.includes(pe))}))),ie.filter(ce=>ce.nodeIds.length>0).map(ce=>{const pe=e.current.filter(ue=>ce.nodeIds.includes(ue.id));return{...ce,...yr(pe)||{}}})})}_(null),S.current=null,P(null),R.current=null,q(null),O.current=null,l([]),k(!1),C(null)},draggingInfo:v,resizingInfo:T,setResizingInfo:P,draggingInfoRef:S,resizingInfoRef:R,hoveredGroupIdForDrop:D}},nC=({nodesRef:e,connectionsRef:t,getTransformedPoint:o,setConnections:r,addConnection:a,handleOpenConnectionQuickAdd:i,setNodes:s})=>{const[l,c]=y.useState(null),[d,u]=y.useState(null),[p,h]=y.useState(null),x=y.useCallback((f,g,v)=>{f.stopPropagation(),f.preventDefault();const _=e.current.find(P=>P.id===g);if(!_)return;const S=Kn(_,v),T=o({x:f.clientX,y:f.clientY});c({fromNodeId:g,fromHandleId:v,fromPoint:T,fromType:S})},[o,c,e]),k=y.useCallback((f,g,v)=>{if(f.stopPropagation(),f.touches.length!==1)return;const _=f.touches[0],S=e.current.find(R=>R.id===g);if(!S)return;const T=Kn(S,v),P=o({x:_.clientX,y:_.clientY});c({fromNodeId:g,fromHandleId:v,fromPoint:P,fromType:T})},[o,c,e]);return{connectingInfo:l,connectionTarget:d,hoveredNodeId:p,setHoveredNodeId:h,handleStartConnection:x,handleStartConnectionTouch:k,processConnectionDrag:(f,g)=>{if(!l)return;let v,_;"touches"in g?(v=g.touches[0].clientX,_=g.touches[0].clientY):(v=g.clientX,_=g.clientY);const S=document.elementFromPoint(v,_),T=S==null?void 0:S.closest('[data-is-input-handle="true"]');let P=null,R=null;if(T){const D=T.getAttribute("data-node-id"),q=T.getAttribute("data-handle-id"),O=q===""?void 0:q,E=T.getAttribute("data-handle-type");D&&D!==l.fromNodeId&&(R=D,(!E||E===l.fromType)&&(P={nodeId:D,handleId:O||void 0}))}if(!P){for(let D=e.current.length-1;D>=0;D--){const q=e.current[D],O=20;let E=q.width,A=q.height;if(q.dockState?(E=160,A=48):q.isCollapsed&&(A=Nn),f.x>=q.position.x-O&&f.x<=q.position.x+E+O&&f.y>=q.position.y&&f.y<=q.position.y+A){R=q.id;break}}if(R&&R!==l.fromNodeId){const D=e.current.find(q=>q.id===R);if(D){let q,O=!1;if(D.type===z.IMAGE_EDITOR){const E=l.fromType;if(E==="image"){let A=!1,N=330;try{const j=JSON.parse(D.value||"{}");A=j.isSequenceMode&&j.isSequentialCombinationMode,j.topPaneHeight&&(N=j.topPaneHeight)}catch{}if(A){const V=D.position.y+52+N*.25,H=D.position.y+52+N*.75,F=Math.abs(f.y-V);q=Math.abs(f.y-H)<F?"image_b":"image",O=!0}else q="image",O=!0}else E==="text"&&(q="text",O=!0)}else if(D.type===z.VIDEO_EDITOR){const E={video:D.position.y+60,audio:D.position.y+110,image:D.position.y+160,text:D.position.y+210},A=l.fromType;if(A&&E[A])q=A,O=!0;else{let N=1/0,j=null;for(const[L,M]of Object.entries(E)){const V=Math.abs(f.y-M);V<N&&(N=V,j=L)}j&&(q=j,O=!0)}}else if(D.type===z.IMAGE_SEQUENCE_GENERATOR)l.fromType==="text"?(q="prompt_input",O=!0):l.fromType==="character_data"&&(q="character_data",O=!0);else if(D.type===z.PROMPT_SEQUENCE_EDITOR)l.fromType==="text"&&(q="prompts_sequence",O=!0);else if(D.type===z.NOTE)l.fromType==="text"&&(q="prompt_data",O=!0);else if(D.type===z.REROUTE_DOT||D.type===z.DATA_READER){const E=t.current.some(j=>j.toNodeId===R),A=g instanceof MouseEvent?g:g.touches[0],N=A.ctrlKey||A.metaKey;(!E||N)&&(q=void 0,O=!0)}else{const E=qs(D);E&&l.fromType===E&&(q=void 0,O=!0)}O&&(P={nodeId:R,handleId:q})}}}p!==R&&h(R),u(D=>(D==null?void 0:D.nodeId)===(P==null?void 0:P.nodeId)&&(D==null?void 0:D.handleId)===(P==null?void 0:P.handleId)?D:P)},endConnection:(f,g,v)=>{if(l){if(d){const _=f;(_.ctrlKey||_.metaKey)&&r(T=>T.filter(P=>!(P.toNodeId===d.nodeId&&P.toHandleId===d.handleId))),a({fromNodeId:l.fromNodeId,fromHandleId:l.fromHandleId,toNodeId:d.nodeId,toHandleId:d.handleId});const S=e.current.find(T=>T.id===d.nodeId);if(S&&S.type===z.REROUTE_DOT){const T=e.current.find(P=>P.id===l.fromNodeId);if(T){const P=Kn(T,l.fromHandleId);P&&s(R=>R.map(D=>D.id===S.id?{...D,value:JSON.stringify({type:P})}:D))}}}else if(!p&&!g&&!v){let _,S;"changedTouches"in f?(_=f.changedTouches[0].clientX,S=f.changedTouches[0].clientY):(_=f.clientX,S=f.clientY);const T=f.target;if((T.id==="app-container"||T.id==="canvas-transform-layer"||T.tagName.toLowerCase()==="svg"||T.closest("#canvas-transform-layer"))&&i){const R=e.current.find(D=>D.id===l.fromNodeId);i({x:_,y:S},l,R==null?void 0:R.type)}}c(null),u(null),h(null)}},setConnectingInfo:c,setConnectionTarget:u}},oC=e=>{const{selectedNodeIds:t,setSelectedNodeIds:o,nodesRef:r,groupsRef:a,draggingInfoRef:i,isTyping:s,handleSaveCanvas:l,handleLoadCanvas:c,copyNodeValue:d,copyGroup:u,handlePaste:p,handleToggleCatalog:h,handleOpenQuickSearch:x,handleOpenQuickAdd:k,deselectAllNodes:C,handleDuplicateNode:w,handleDuplicateNodeWithContent:f,deleteNodeAndConnections:g,requestDeleteNodes:v,handleGroupSelection:_,handleToggleNodeCollapse:S,handleToggleNodePin:T,onAddNode:P,pointerPositionRef:R,clientPointerPositionRef:D,handleCloseAddNodeMenus:q,setIsSnapToGrid:O,setLineStyle:E,setIsSmartGuidesEnabled:A,setActiveTool:N,setIsShiftDown:j,setIsCtrlDown:L,setIsAltDown:M,setIsZDown:V,setSelectionRect:H,isRadialMenuOpen:F,setIsRadialMenuOpen:G,setRadialMenuPosition:B,radialMenuSelectedItem:Y,setRadialMenuSelectedItem:ee,getTransformedPoint:ie,radialMenuPosition:ce,quickSlots:pe,isConnectionQuickAddOpen:ue,isInstantCloseEnabled:re,handleAlignNodes:$,undoPosition:Z,redoPosition:te,handleValueChange:ae}=e;y.useEffect(()=>{const I=U=>{var X;if((U.ctrlKey||U.metaKey)&&U.code==="Space"){U.preventDefault(),h();return}const Q=U.target;if(Q.tagName==="INPUT"||Q.tagName==="TEXTAREA"||Q.isContentEditable)return;if(U.key==="Shift"&&!U.repeat&&j(!0),U.key==="Control"&&!U.repeat&&L(!0),U.key==="Alt"&&!U.repeat&&M(!0),U.code==="KeyZ"&&!U.repeat&&t.length<=1&&!U.ctrlKey&&!U.metaKey&&V(!0),U.code==="Space"&&!U.ctrlKey&&!U.metaKey&&!U.altKey&&!U.shiftKey&&t.length===0){U.preventDefault(),U.repeat||k(D.current);return}if(U.code==="Tab"&&(U.preventDefault(),F||(B(D.current),G(!0))),(U.ctrlKey||U.metaKey)&&U.code==="KeyZ"){U.preventDefault(),U.shiftKey?te(r.current):Z(r.current);return}if((U.ctrlKey||U.metaKey)&&U.code==="KeyY"){U.preventDefault(),te(r.current);return}if(t.length>1){if(U.ctrlKey||U.metaKey){if(U.code==="KeyD"){U.preventDefault(),$(t,"distribute-horizontal");return}if(U.code==="KeyE"){U.preventDefault(),$(t,"distribute-vertical");return}}else if(!U.ctrlKey&&!U.metaKey&&!U.altKey)switch(U.code){case"KeyF":U.preventDefault(),$(t,"left");return;case"KeyT":U.preventDefault(),$(t,"top");return;case"KeyB":U.preventDefault(),$(t,"bottom");return;case"KeyR":U.preventDefault(),$(t,"right");return;case"KeyE":U.preventDefault(),$(t,"center-x");return;case"KeyD":U.preventDefault(),$(t,"center-y");return;case"KeyZ":U.preventDefault(),Z(r.current);return}}else if(U.code==="KeyF"&&!U.ctrlKey&&!U.metaKey&&!U.altKey&&!U.shiftKey){U.preventDefault(),x(D.current);return}if((U.ctrlKey||U.metaKey)&&U.code==="KeyS"){U.preventDefault(),l();return}if((U.ctrlKey||U.metaKey)&&U.code==="KeyO"){U.preventDefault(),c();return}if((U.ctrlKey||U.metaKey)&&!U.shiftKey&&U.code==="KeyC"){const K=window.getSelection();if(K&&K.toString().length>0)return;if(t.length>0){U.preventDefault();const oe=t[t.length-1];d(oe);return}else if(i.current&&i.current.type==="group"){U.preventDefault(),u(i.current.id);return}else if(i.current&&i.current.type==="node"){const oe=i.current.id,ne=a.current.find(le=>le.nodeIds.includes(oe));if(ne){U.preventDefault(),u(ne.id);return}}}if((U.ctrlKey||U.metaKey)&&U.code==="KeyV"&&(U.preventDefault(),p()),(U.ctrlKey||U.metaKey)&&!U.shiftKey&&U.code==="KeyA"){U.preventDefault(),o(r.current.map(K=>K.id));return}if(U.altKey&&U.code==="KeyA"){U.preventDefault(),C();return}if((U.ctrlKey||U.metaKey)&&U.code==="KeyD"&&t.length>0){if(U.preventDefault(),!U.repeat){const K=t.map(oe=>f(oe)).filter(oe=>!!oe);K.length>0&&o(K)}return}if(U.code==="KeyD"&&!(U.ctrlKey||U.metaKey)&&t.length>0){if(U.preventDefault(),!U.repeat){const K=t.map(oe=>w(oe)).filter(oe=>!!oe);K.length>0&&o(K)}return}if((U.code==="Delete"||U.code==="KeyX")&&t.length>0){U.preventDefault(),U.shiftKey||re?(t.forEach(K=>g(K)),o([])):v(t,D.current);return}if(U.code==="KeyH"&&!U.shiftKey&&!U.ctrlKey&&!U.altKey&&!U.metaKey){U.preventDefault(),U.repeat||t.forEach(S);return}if(U.code==="KeyG"&&!U.shiftKey&&!U.ctrlKey&&!U.altKey&&!U.metaKey){U.preventDefault(),U.repeat||(t.length>1?_():(P(z.GEMINI_CHAT,R.current),q()));return}if(!U.ctrlKey&&!U.metaKey&&!U.altKey&&!U.shiftKey&&U.code.startsWith("Digit")&&!ue){const K=parseInt(U.code.replace("Digit",""));if(K>=1&&K<=8){const oe=pe[K-1];if(oe){U.preventDefault(),U.repeat||P(oe,R.current);return}}}let de=null;const se=U.code;if(U.ctrlKey&&U.shiftKey)switch(se){case"KeyA":de=z.CHARACTER_ANALYZER;break;case"KeyC":de=z.CHARACTER_CARD;break}else if(U.shiftKey)switch(se){case"KeyA":de=z.IMAGE_ANALYZER;break;case"KeyI":de=z.IMAGE_EDITOR;break;case"KeyC":de=z.CHARACTER_GENERATOR;break;case"KeyR":de=z.DATA_READER;break;case"KeyV":de=z.SCRIPT_VIEWER;break;case"KeyQ":de=z.IMAGE_SEQUENCE_GENERATOR;break;case"KeyW":U.preventDefault(),U.repeat||O(K=>!K);return;case"KeyE":U.preventDefault(),U.repeat||E(K=>K==="spaghetti"?"orthogonal":"spaghetti");return;case"KeyL":U.preventDefault(),U.repeat||A(K=>!K);return;case"KeyP":de=z.VIDEO_PROMPT_PROCESSOR;break;case"KeyO":de=z.VIDEO_OUTPUT;break}else if(!U.ctrlKey&&!U.metaKey&&!U.altKey)switch(se){case"KeyT":de=z.TEXT_INPUT;break;case"KeyI":de=z.IMAGE_INPUT;break;case"KeyA":de=z.PROMPT_ANALYZER;break;case"KeyP":de=z.PROMPT_PROCESSOR;break;case"KeyO":de=z.IMAGE_OUTPUT;break;case"KeyM":t.length===1&&((X=r.current.find(oe=>oe.id===t[0]))==null?void 0:X.type)===z.MEDIA_VIEWER||(de=z.MEDIA_VIEWER);break;case"KeyL":de=z.TRANSLATOR;break;case"KeyN":de=z.NOTE;break;case"KeyQ":de=z.PROMPT_SEQUENCE_EDITOR;break;case"KeyE":de=z.VIDEO_EDITOR;break}if(de){U.preventDefault(),U.repeat||(P(de,R.current),q());return}if(!U.metaKey&&!U.shiftKey&&!U.ctrlKey&&!U.altKey)switch(U.code){case"KeyV":U.preventDefault(),N("edit");break;case"KeyC":U.preventDefault(),N("cutter");break;case"KeyS":U.preventDefault(),N("selection");break;case"KeyR":U.preventDefault(),N("reroute");break}},J=U=>{U.key==="Shift"&&(j(!1),H(null)),U.key==="Control"&&L(!1),U.key==="Alt"&&M(!1),U.code==="KeyZ"&&V(!1),U.code==="Tab"&&F&&(Y&&P(Y,ie(ce)),G(!1),ee(null))},W=()=>{j(!1),L(!1),M(!1),V(!1),G(!1),ee(null),H(null)};return window.addEventListener("keydown",I),window.addEventListener("keyup",J),window.addEventListener("blur",W),window.addEventListener("focus",W),document.addEventListener("visibilitychange",W),()=>{window.removeEventListener("keydown",I),window.removeEventListener("keyup",J),window.removeEventListener("blur",W),window.removeEventListener("focus",W),document.removeEventListener("visibilitychange",W)}},[t,r,i,s,l,c,d,u,p,h,x,k,C,w,f,g,v,_,S,P,R,D,q,O,E,A,N,j,L,M,V,H,F,G,B,Y,ee,ie,ce,pe,ue,re,$,Z,te,ae])},rC=e=>{const{nodes:t,setNodes:o,groups:r,setGroups:a,addConnection:i,connections:s,viewTransform:l,setViewTransform:c,updatePointerPosition:d,pan:u,isPanning:p,startPanning:h,stopPanning:x,isSnapToGrid:k,onAddNode:C,removeConnectionsByNodeId:w,handleOpenQuickSearch:f,clientPointerPosition:g,getTransformedPoint:v,getCanvasRelativePoint:_,setZoom:S,t:T,handleDeleteNode:P,handleValueChange:R,handleDuplicateNode:D,handleDuplicateNodeWithContent:q,handleToggleNodeCollapse:O,handleToggleNodePin:E,copyNodeValue:A,pasteImageToNode:N,nodeIdCounter:j,setConnections:L,addGroup:M,handleCloseAddNodeMenus:V,activeTool:H,setActiveTool:F,setSpawnLine:G,pointerPosition:B,setError:Y,handleLoadCanvasIntoCurrentTab:ee,setIsSnapToGrid:ie,setLineStyle:ce,deleteNodeAndConnections:pe,handleToggleCatalog:ue,draggingInfo:re,setDraggingInfo:$,handleDetachNodeFromGroup:Z,handleSaveCanvas:te,handleLoadCanvas:ae,handleOpenConnectionQuickAdd:I,handleOpenContextMenu:J,quickSlots:W,isConnectionQuickAddOpen:U,pasteGroup:Q,copyGroup:de,isSmartGuidesEnabled:se,setIsSmartGuidesEnabled:X,setSmartGuides:K,selectedNodeIds:oe,setSelectedNodeIds:ne,handleRenameNode:le,setFullSizeImage:ge,handleOpenQuickAdd:we,requestDeleteNodes:_e,isInstantCloseEnabled:fe,handleAlignNodes:he,handleDockNode:ye,handlePaste:Se,selectNode:Te,dockHoverMode:Ae,setDockHoverMode:Oe,isDockingMenuVisible:me,setIsDockingMenuVisible:ve,undoPosition:Ie,redoPosition:ke}=e,je=y.useRef(t);y.useEffect(()=>{je.current=t},[t]);const Ge=y.useRef(r);y.useEffect(()=>{Ge.current=r},[r]);const be=y.useRef(s);y.useEffect(()=>{be.current=s},[s]);const Pe=y.useRef(B);y.useEffect(()=>{Pe.current=B},[B]);const Ee=y.useRef(g);y.useEffect(()=>{Ee.current=g},[g]);const[Me,Fe]=y.useState(null),[tt,Nt]=y.useState(null),[xe,Be]=y.useState(!1),[Le,Ue]=y.useState(!1),[Ze,at]=y.useState(!1),[ot,rt]=y.useState(!1),[et,mt]=y.useState(!1),[xt,Ct]=y.useState(null),[pt,dt]=y.useState({x:0,y:0}),kt=y.useCallback(He=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur(),F(He)},[F]),St=ot?"zoom":H==="edit"?Le&&Ze?"reroute":Le?"cutter":xe?"selection":"edit":H,Tt=eC({viewTransform:l,setViewTransform:c,isPanning:p,pan:u,startPanning:h,stopPanning:x,getCanvasRelativePoint:_,setZoom:S,handleCloseAddNodeMenus:V,setSelectedNodeIds:ne,effectiveTool:St,setZoomDragInfo:Fe,getTransformedPoint:v,setSelectionRect:Nt}),_t=tC({nodesRef:je,setNodes:o,groupsRef:Ge,setGroups:a,viewTransform:l,isSnapToGrid:k,isSmartGuidesEnabled:se,setSmartGuides:K,handleCloseAddNodeMenus:V,setSelectedNodeIds:ne,selectedNodeIds:oe,getTransformedPoint:v,activeTool:H,handleDockNode:ye,setIsDockingMenuVisible:ve,setDockHoverMode:Oe,dockHoverMode:Ae,connections:s,setConnections:L}),It=nC({nodesRef:je,connectionsRef:be,getTransformedPoint:v,setConnections:L,addConnection:i,handleOpenConnectionQuickAdd:I,setNodes:o});oC({selectedNodeIds:oe,setSelectedNodeIds:ne,nodesRef:je,groupsRef:Ge,draggingInfoRef:_t.draggingInfoRef,isTyping:!1,handleSaveCanvas:te,handleLoadCanvas:ae,copyNodeValue:A,copyGroup:de,handlePaste:Se,handleToggleCatalog:ue,handleOpenQuickSearch:f,handleOpenQuickAdd:we,deselectAllNodes:()=>ne([]),handleDuplicateNode:D,handleDuplicateNodeWithContent:q,deleteNodeAndConnections:pe,requestDeleteNodes:_e,handleGroupSelection:()=>{if(oe.length>1){const He=je.current.filter($e=>oe.includes($e.id));M(He),ne([])}},handleToggleNodeCollapse:O,handleToggleNodePin:E,onAddNode:C,pointerPositionRef:Pe,clientPointerPositionRef:Ee,handleCloseAddNodeMenus:V,setIsSnapToGrid:ie,setLineStyle:ce,setIsSmartGuidesEnabled:X,setActiveTool:kt,setIsShiftDown:Be,setIsCtrlDown:Ue,setIsAltDown:at,setIsZDown:rt,setSelectionRect:Nt,isRadialMenuOpen:et,setIsRadialMenuOpen:mt,setRadialMenuPosition:dt,radialMenuSelectedItem:xt,setRadialMenuSelectedItem:Ct,getTransformedPoint:v,radialMenuPosition:pt,quickSlots:W,isConnectionQuickAddOpen:U,isInstantCloseEnabled:fe,handleAlignNodes:he,undoPosition:Ie,redoPosition:ke,handleValueChange:R});const Io=y.useCallback(He=>{const $e=He.target;$e.closest(".node-view")||$e.closest(".group-view")||$e.closest("button")||$e.closest("input")||$e.closest("textarea")||$e.closest(".ui-panel")||$e.closest('[role="dialog"]')||($e.id==="app-container"||$e.id==="canvas-transform-layer"||$e.tagName==="svg"||$e.classList.contains("connection-view"))&&(He.preventDefault(),we({x:He.clientX,y:He.clientY}))},[we]),jo=()=>Me?"ew-resize":_t.draggingInfo?"grabbing":St==="selection"?"crosshair":St==="zoom"?"ew-resize":St==="edit"||St==="cutter"||St==="reroute"?p?"grabbing":"grab":"default",qt=He=>{const $e="touches"in He,Qe=_t.draggingInfoRef.current,Xe=_t.resizingInfoRef.current;(Qe||Xe||It.connectingInfo||tt||p)&&He.cancelable&&He.preventDefault();let Ke=He;if($e?Ke=He.touches[0]:"pointerId"in He&&(Ke=He),!Ke)return;d({clientX:Ke.clientX,clientY:Ke.clientY});const ft=v({x:Ke.clientX,y:Ke.clientY});if(p&&(He.type==="touchmove"?Tt.handleCanvasTouchMove(He):u({x:Ke.clientX,y:Ke.clientY})),Me){const yt=Ke.clientX-Me.startClientX,wt=Math.pow(2,yt/300),jt=Math.max(.2,Math.min(2,(Me.startScale||1)*wt));S(jt,Me.pivot);return}It.connectingInfo&&It.processConnectionDrag(ft,He),Qe?_t.processDrag(Ke,Ze,xe):Xe?_t.processResize(Ke):tt&&Nt({start:tt.start,end:v({x:Ke.clientX,y:Ke.clientY})})},Re=He=>{if(p&&x(),Me&&Fe(null),tt){const $e=tt,Qe=Math.min($e.start.x,$e.end.x),Xe=Math.min($e.start.y,$e.end.y),Ke=Math.abs($e.start.x-$e.end.x),ft=Math.abs($e.start.y-$e.end.y);if(Ke>0&&ft>0){const yt=je.current.filter(ht=>{const wt=ht.isCollapsed?Nn:ht.height;return ht.position.x<Qe+Ke&&ht.position.x+ht.width>Qe&&ht.position.y<Xe+ft&&ht.position.y+wt>Xe}).map(ht=>ht.id);ne(yt),yt.length>0&&o(ht=>ht.map(wt=>yt.includes(wt.id)&&wt.isNewlyCreated?{...wt,isNewlyCreated:!1}:wt))}Nt(null)}(_t.draggingInfoRef.current||_t.resizingInfoRef.current)&&_t.endDrag(),It.connectingInfo&&It.endConnection(He,p,_t.draggingInfoRef.current)};y.useEffect(()=>(window.addEventListener("mousemove",qt),window.addEventListener("mouseup",Re),window.addEventListener("touchmove",qt,{passive:!1}),window.addEventListener("touchend",Re),window.addEventListener("pointermove",qt),window.addEventListener("pointerup",Re),()=>{window.removeEventListener("mousemove",qt),window.removeEventListener("mouseup",Re),window.removeEventListener("touchmove",qt),window.removeEventListener("touchend",Re),window.removeEventListener("pointermove",qt),window.removeEventListener("pointerup",Re)}),[p,Me,tt,It.connectingInfo,It.connectionTarget,It.endConnection,_t.draggingInfoRef.current,_t.resizingInfoRef.current,Ze,l,k,se,xe]);const qe=y.useMemo(()=>{if(oe.length<2)return null;const He=t.filter(Ke=>oe.includes(Ke.id));if(He.length<2)return null;let $e=1/0,Qe=1/0,Xe=-1/0;return He.forEach(Ke=>{$e=Math.min($e,Ke.position.x),Qe=Math.min(Qe,Ke.position.y),Xe=Math.max(Xe,Ke.position.x+Ke.width)}),{x:($e+Xe)/2,y:Qe-60}},[t,oe]);return{handleCanvasMouseDown:Tt.handleCanvasMouseDown,handleCanvasTouchStart:Tt.handleCanvasTouchStart,handleCanvasTouchMove:Tt.handleCanvasTouchMove,handleCanvasTouchEnd:Tt.handleCanvasTouchEnd,getCanvasCursor:jo,selectedNodeIds:oe,setSelectedNodeIds:ne,connectingInfo:It.connectingInfo,setConnectingInfo:It.setConnectingInfo,zoomDragInfo:Me,setZoomDragInfo:Fe,resizingInfo:_t.resizingInfo,setResizingInfo:_t.setResizingInfo,hoveredNodeId:It.hoveredNodeId,setHoveredNodeId:It.setHoveredNodeId,connectionTarget:It.connectionTarget,setConnectionTarget:It.setConnectionTarget,handleNodeResizeMouseDown:_t.handleNodeResizeMouseDown,handleNodeMouseDown:_t.handleNodeMouseDown,handleNodeTouchStart:_t.handleNodeTouchStart,handleGroupMouseDown:_t.handleGroupMouseDown,handleGroupTouchStart:_t.handleGroupTouchStart,handleStartConnection:It.handleStartConnection,handleStartConnectionTouch:It.handleStartConnectionTouch,isRadialMenuOpen:et,setIsRadialMenuOpen:mt,radialMenuPosition:pt,setRadialMenuPosition:dt,radialMenuSelectedItem:xt,setRadialMenuSelectedItem:Ct,deselectAllNodes:()=>ne([]),setSelectionRect:Nt,selectionRect:tt,effectiveTool:St,setActiveTool:kt,hoveredGroupIdForDrop:_t.hoveredGroupIdForDrop,draggingInfo:_t.draggingInfo,handleGroupSelection:()=>{if(oe.length>1){const He=je.current.filter($e=>oe.includes($e.id));M(He),ne([])}},handleCanvasDoubleClick:Io,dockHoverMode:Ae,setDockHoverMode:Oe,isDockingMenuVisible:me,setIsDockingMenuVisible:ve,clientPointerPositionRef:Ee,groupButtonPosition:qe,handlePaste:Se,selectNode:Te}},aC=e=>{const{getCurrentCanvasState:t,loadCanvasState:o,setError:r,nodes:a,handleValueChange:i,addToast:s,t:l,activeTabName:c,getFullSizeImage:d,handleRenameTab:u,activeTabId:p,setFullSizeImage:h,tabs:x,setTabs:k,setActiveTabId:C,catalogItems:w,setCatalogItems:f,libraryItems:g,setLibraryItems:v,characterCatalog:_,scriptCatalog:S,sequenceCatalog:T,language:P,setLanguage:R,isSnapToGrid:D,setIsSnapToGrid:q,lineStyle:O,setLineStyle:E,setConfirmInfo:A,handleRenameNode:N,onAddNode:j,pasteGroup:L,viewTransform:M}=e,V=y.useRef(null),H=y.useRef(null),F=y.useRef(null),G=y.useRef(null),B=y.useRef(null),Y=y.useRef(null),ee=()=>new Date().toISOString().replace(/:/g,"-").replace("T","_").split(".")[0],ie=y.useCallback(()=>{const X={type:"prompt-modifier-canvas",appName:"Prompt_modifier",version:1,...t(),timestamp:new Date().toISOString()},K=new Blob([JSON.stringify(X,null,2)],{type:"application/json"}),oe=URL.createObjectURL(K),ne=document.createElement("a");ne.href=oe;const le=c.trim().replace(/\s+/g,"_");ne.download=`Prompt_Modifier_${le}_${ee()}.json`,ne.click(),URL.revokeObjectURL(oe),ne.remove(),s(l("toast.canvasSaved"),"success")},[t,c,s,l]),ce=y.useCallback(()=>{const se=t(),X=x.map(ge=>ge.id===p?{...ge,state:se}:ge),K={type:"prompt-modifier-project",appName:"Prompt_modifier",version:1,timestamp:new Date().toISOString(),tabs:X,activeTabId:p,settings:{language:P,isSnapToGrid:D,lineStyle:O},catalogs:{groups:w,library:g,characters:_.items,scripts:S.items,sequences:T.items}},oe=new Blob([JSON.stringify(K,null,2)],{type:"application/json"}),ne=URL.createObjectURL(oe),le=document.createElement("a");le.href=ne,le.download=`Prompt_Modifier_Project_${ee()}.json`,le.click(),URL.revokeObjectURL(ne),le.remove(),s(l("toast.projectSaved"),"success")},[t,x,p,P,D,O,w,g,_.items,S.items,T.items,s,l]),pe=y.useCallback(se=>{try{const X=JSON.parse(se);if(X.type==="prompt-modifier-project"){X.tabs&&Array.isArray(X.tabs)&&(k(X.tabs),X.activeTabId&&C(X.activeTabId)),X.settings&&(X.settings.language&&R(X.settings.language),X.settings.isSnapToGrid!==void 0&&q(X.settings.isSnapToGrid),X.settings.lineStyle&&E(X.settings.lineStyle)),X.catalogs&&(X.catalogs.groups&&f(X.catalogs.groups),X.catalogs.library&&v(X.catalogs.library),X.catalogs.characters&&_.replaceAllItems(X.catalogs.characters),X.catalogs.scripts&&S.replaceAllItems(X.catalogs.scripts),X.catalogs.sequences&&T.replaceAllItems(X.catalogs.sequences)),s(l("toast.downloadStarted"),"success");return}let K;if(X.nodes&&X.connections)K={nodes:X.nodes||[],connections:X.connections||[],groups:X.groups||[],viewTransform:X.viewTransform||{scale:1,translate:{x:0,y:0}},nodeIdCounter:X.nodeIdCounter||100,fullSizeImageCache:X.fullSizeImageCache||{}};else throw new Error("Invalid file format");o(K)}catch(X){console.error("Load error:",X),r(`Failed to load file: ${X.message}`)}},[k,C,R,q,E,f,v,_,S,T,o,r,s,l]),ue=y.useCallback(se=>{var le;const X=(le=se.target.files)==null?void 0:le[0];if(!X)return;const K=X.name.match(/^Prompt_Modifier_(.+?)_\d{4}-\d{2}-\d{2}/),oe=K&&K[1]?K[1].replace(/_/g," "):null,ne=new FileReader;ne.onload=ge=>{var _e;const we=(_e=ge.target)==null?void 0:_e.result;try{const fe=JSON.parse(we);if(fe.type==="script-modifier-project"||fe.type==="script-modifier-canvas"){r(l("error.scriptModifierCanvas"));return}const he=fe.type==="prompt-modifier-project",ye=()=>{pe(we),!he&&oe&&u(p,oe)};A({title:l("dialog.confirmLoad.title"),message:l("dialog.confirmLoad.message")+(he?" (Loading Project)":""),onConfirm:ye})}catch{r("Invalid JSON file.")}},ne.readAsText(X),se.target&&(se.target.value="")},[pe,A,l,r,u,p]),re=y.useCallback(()=>{var se;(se=V.current)==null||se.click()},[]),$=y.useCallback(se=>{var X;Y.current=se,(X=H.current)==null||X.click()},[]),Z=y.useCallback(se=>{var le;const X=(le=se.target.files)==null?void 0:le[0];if(!X||!Y.current)return;const K=Y.current,oe=a.find(ge=>ge.id===K);if(!oe)return;const ne=new FileReader;ne.onload=ge=>{var _e;const we=(_e=ge.target)==null?void 0:_e.result;try{const fe=JSON.parse(we);let he=[],ye=[],Se="",Te=[],Ae={};if(fe.type==="script-prompt-modifier-data"?(he=fe.finalPrompts||fe.prompts||[],ye=fe.videoPrompts||[],Se=fe.styleOverride||"",Te=fe.usedCharacters||[],Ae=fe.sceneContexts||{}):Array.isArray(fe)?he=fe:fe.prompts&&(he=fe.prompts),Array.isArray(he)){const Oe=new Map(ye.map(je=>[je.frameNumber,je])),me=he.map((je,Ge)=>{const be=je.frameNumber!==void 0?je.frameNumber:Ge+1,Pe=Oe.get(be);let Ee=je.characters||[];const Me=je.prompt||"";if(Ee.length===0&&Me){const Fe=Me.match(/(?:character|entity)-\d+/gi)||[];Ee=[...new Set(Fe.map(tt=>tt.toLowerCase().replace(/character-/i,"Entity-").replace(/entity-/i,"Entity-")))]}return{frameNumber:be,sceneNumber:je.sceneNumber||1,sceneTitle:je.sceneTitle||"",prompt:Me,videoPrompt:(Pe==null?void 0:Pe.videoPrompt)||je.videoPrompt||"",shotType:je.shotType||je.ShotType||(Pe==null?void 0:Pe.shotType)||"WS",characters:Ee,isCollapsed:!0,duration:je.duration||3}}),ve=JSON.parse(oe.value||"{}"),Ie=me.reduce((je,Ge)=>({...je,[Ge.frameNumber]:"idle"}),{}),ke={prompts:me,frameStatuses:Ie,selectedFrameNumber:null,checkedFrameNumbers:[]};Se&&(ke.styleOverride=Se),Te.length>0&&(ke.usedCharacters=Te),Object.keys(Ae).length>0&&(ke.sceneContexts=Ae),i(K,JSON.stringify({...ve,...ke}))}else r("Invalid Image Sequence format.")}catch(fe){r(`Error loading sequence file: ${fe.message}`)}},ne.readAsText(X),Y.current=null,se.target&&(se.target.value="")},[a,i,r]),te=y.useCallback(se=>{var X;Y.current=se,(X=F.current)==null||X.click()},[]),ae=y.useCallback(se=>{var le;const X=(le=se.target.files)==null?void 0:le[0];if(!X||!Y.current)return;const K=Y.current,oe=a.find(ge=>ge.id===K);if(!oe)return;const ne=new FileReader;ne.onload=ge=>{var _e;const we=(_e=ge.target)==null?void 0:_e.result;try{const fe=JSON.parse(we);let he=null,ye=null,Se="",Te=[],Ae={};if(fe&&fe.type==="script-prompt-modifier-data"?(he=fe.finalPrompts||fe.prompts,ye=fe.videoPrompts,Se=fe.styleOverride||"",Te=fe.usedCharacters||[],Ae=fe.sceneContexts||{}):Array.isArray(fe)?he=fe:fe&&Array.isArray(fe.prompts)?he=fe.prompts:fe&&Array.isArray(fe.finalPrompts)&&(he=fe.finalPrompts),he&&Array.isArray(he)){const Oe=new Map((ye||[]).map(Ie=>[Ie.frameNumber,Ie])),me=he.map((Ie,ke)=>{const je=Ie.frameNumber!==void 0?Ie.frameNumber:ke+1,Ge=Oe.get(je);let be=Ie.prompt||(typeof Ie=="string"?Ie:""),Pe=Ie.characters||[];if(Pe.length===0&&be){const Ee=be.match(/(?:character|entity)-\d+/gi)||[];Pe=[...new Set(Ee.map(Me=>Me.toLowerCase().replace(/character-/i,"Entity-").replace(/entity-/i,"Entity-")))]}return{frameNumber:je,sceneNumber:Ie.sceneNumber||1,sceneTitle:Ie.sceneTitle||"",prompt:be,videoPrompt:(Ge==null?void 0:Ge.videoPrompt)||Ie.videoPrompt||"",shotType:Ie.shotType||Ie.ShotType||(Ge==null?void 0:Ge.shotType)||"WS",characters:Pe,isCollapsed:!0,duration:Ie.duration||3}}),ve=JSON.parse(oe.value||"{}");if(oe.type===z.PROMPT_SEQUENCE_EDITOR){const Ie={sourcePrompts:me,modifiedPrompts:[],checkedSourceFrameNumbers:[],isStyleCollapsed:!0};Se&&(Ie.styleOverride=Se),Te.length>0&&(Ie.usedCharacters=Te),Object.keys(Ae).length>0&&(Ie.sceneContexts=Ae);const ke=JSON.stringify({...ve,...Ie});i(K,ke)}}else throw new Error("JSON is not an array of prompts or does not contain a 'prompts' or 'finalPrompts' array.")}catch(fe){r(`Error loading prompts file: ${fe.message}`)}},ne.readAsText(X),Y.current=null,se.target&&(se.target.value="")},[a,i,r]),I=y.useCallback(se=>{var X;Y.current=se,(X=G.current)==null||X.click()},[]),J=y.useCallback(se=>{var ne;const X=(ne=se.target.files)==null?void 0:ne[0];if(!X||!Y.current)return;const K=Y.current,oe=new FileReader;oe.onload=async le=>{var we;const ge=(we=le.target)==null?void 0:we.result;try{let _e=JSON.parse(ge);Array.isArray(_e)||(_e=[_e]);const fe=await Promise.all(_e.map(async(he,ye)=>{const Se=he.imageSources||{"1:1":null,"16:9":null,"9:16":null},Te={"1:1":null,"16:9":null,"9:16":null};he.image&&!he.imageSources&&(Se["1:1"]=he.image);for(const[me,ve]of Object.entries(Se))if(typeof ve=="string"&&ve.startsWith("data:")){const Ie=Wt[me];Ie&&h(K,ye*10+Ie,ve);const ke=await Lt(ve,256,256);Te[me]=ke}else Te[me]=ve;const Ae=he.selectedRatio||"1:1",Oe=Se[Ae];return Oe&&typeof Oe=="string"&&Oe.startsWith("data:")&&h(K,ye*10,Oe),{id:he.id||`char-card-${Date.now()}-${ye}`,name:he.name||"",index:he.index||he.alias||`Entity-${ye+1}`,image:Te[Ae],thumbnails:Te,selectedRatio:Ae,prompt:he.prompt||he.imagePrompt||"",fullDescription:he.fullDescription||he.description||"",targetLanguage:he.targetLanguage||"en",isOutput:he.isOutput||ye===0,isDescriptionCollapsed:he.isDescriptionCollapsed??!1}}));_e.length===1&&(_e[0].nodeTitle||_e[0].title)&&N(K,_e[0].nodeTitle||_e[0].title),i(K,JSON.stringify(fe)),s(l("toast.characterLoaded"))}catch(_e){r(`Error loading character card: ${_e.message}`)}},oe.readAsText(X),Y.current=null,se.target&&(se.target.value="")},[N,i,h,s,l,r]),W=y.useCallback((se,X)=>{var oe;const K=a.find(ne=>ne.id===se);if(!(!K||K.type!==z.CHARACTER_CARD))try{let ne=JSON.parse(K.value||"[]");Array.isArray(ne)||(ne=[ne]);let le=[];if(X!==void 0){const Te=ne[X];if(!Te)return;const Ae={type:"character-card",nodeTitle:K.title,...Te,image:d(se,X*10)||Te.image,imageSources:{...Te.thumbnails},index:Te.index||Te.alias||`Entity-${X+1}`};Object.entries(Wt).forEach(([Oe,me])=>{const ve=d(se,X*10+me);ve&&(Ae.imageSources[Oe]=ve)}),delete Ae.thumbnails,delete Ae.alias,le=Ae}else le=ne.map((Te,Ae)=>{const Oe={...Te.thumbnails};Object.entries(Wt).forEach(([Ie,ke])=>{const je=d(se,Ae*10+ke);je&&(Oe[Ie]=je)});const me=d(se,Ae*10)||Te.image,ve={type:"character-card",nodeTitle:K.title,...Te,image:me,imageSources:Oe,index:Te.index||Te.alias||`Entity-${Ae+1}`};return delete ve.thumbnails,delete ve.alias,ve});const ge=JSON.stringify(le,null,2),we=new Blob([ge],{type:"application/json"}),_e=URL.createObjectURL(we),fe=document.createElement("a");fe.href=_e;let he=K.title||"Character_Card";X!==void 0&&(he=((oe=ne[X])==null?void 0:oe.name)||`Character_${X+1}`);const ye=he.trim().replace(/[\\/:*?"<>|]/g,"").replace(/\s+/g,"_"),Se=ee();fe.download=`${ye}_${Se}.json`,fe.click(),URL.revokeObjectURL(_e),fe.remove(),s(l("toast.characterSavedDisk"))}catch{r("Failed to save character card.")}},[a,d,s,l,r]),U=y.useCallback(se=>{var X;Y.current=se,(X=B.current)==null||X.click()},[]),Q=y.useCallback(se=>{var ne;const X=(ne=se.target.files)==null?void 0:ne[0];if(!X||!Y.current)return;const K=Y.current,oe=new FileReader;oe.onload=le=>{var we;const ge=(we=le.target)==null?void 0:we.result;try{JSON.parse(ge),i(K,ge)}catch(_e){r(`Error loading script file: ${_e.message}`)}},oe.readAsText(X),Y.current=null,se.target&&(se.target.value="")},[i,r]),de=y.useCallback(se=>{const X=a.find(we=>we.id===se);if(!X)return;let K="",oe=`file_${ee()}.json`;if(X.type===z.SCRIPT_GENERATOR||X.type===z.SCRIPT_VIEWER)K=X.value,oe=`script_${ee()}.json`;else if(X.type===z.PROMPT_SEQUENCE_EDITOR)try{const we=X.value?JSON.parse(X.value):{},_e=we.sourcePrompts||[],fe=we.modifiedPrompts||[],he=new Map(fe.map(Ae=>[Ae.frameNumber,Ae])),ye=_e.map(Ae=>{const Oe=he.get(Ae.frameNumber);return Oe?{...Ae,...Oe}:Ae}),Se={type:"script-prompt-modifier-data",title:X.title||" ",usedCharacters:we.usedCharacters||[],sceneContexts:we.sceneContexts||{},finalPrompts:ye.map(Ae=>({frameNumber:Ae.frameNumber,sceneNumber:Ae.sceneNumber||1,sceneTitle:Ae.sceneTitle||"",characters:Ae.characters||[],duration:Ae.duration||3,prompt:Ae.prompt||"",shotType:Ae.shotType||"WS"})),videoPrompts:ye.map(Ae=>({sceneNumber:Ae.sceneNumber||1,sceneTitle:Ae.sceneTitle||"",frameNumber:Ae.frameNumber,videoPrompt:Ae.videoPrompt||"",shotType:Ae.shotType||"WS"})),targetLanguage:"en",startFrameNumber:1,endFrameNumber:ye.length,startSceneNumber:null,endSceneNumber:null,styleOverride:we.styleOverride||"",breakIntoParagraphs:!1,copyVideoPrompt:!0,characterPaneHeight:160,isAdvancedMode:!0,model:"gemini-3-pro-preview",processWholeScene:!1,uiState:{isSettingsCollapsed:!1}};K=JSON.stringify(Se,null,2),oe=`${(X.title||"sequence").trim().replace(/\s+/g,"_")}_${ee()}.json`}catch{r("Failed to parse sequence editor data for saving to disk.");return}else if(X.type===z.IMAGE_SEQUENCE_GENERATOR)try{const we=X.value?JSON.parse(X.value):{},_e=(we.prompts||[]).map(({frameNumber:ye,characters:Se,duration:Te,prompt:Ae,videoPrompt:Oe,sceneNumber:me,sceneTitle:ve,shotType:Ie})=>({frameNumber:ye,characters:Se,duration:Te,prompt:Ae,videoPrompt:Oe,sceneNumber:me||1,sceneTitle:ve||"",shotType:Ie||"WS"})),fe={type:"script-prompt-modifier-data",title:X.title||"Sequence Generator",usedCharacters:we.usedCharacters||[],sceneContexts:we.sceneContexts||{},finalPrompts:_e.map(ye=>({frameNumber:ye.frameNumber,sceneNumber:ye.sceneNumber,sceneTitle:ye.sceneTitle,characters:ye.characters,duration:ye.duration,prompt:ye.prompt,shotType:ye.shotType})),videoPrompts:_e.map(ye=>({sceneNumber:ye.sceneNumber,sceneTitle:ye.sceneTitle,frameNumber:ye.frameNumber,videoPrompt:ye.videoPrompt||"",shotType:ye.shotType})),styleOverride:we.styleOverride||""};K=JSON.stringify(fe,null,2),oe=`${(X.title||"seq_gen").trim().replace(/\s+/g,"_")}_${ee()}.json`}catch{r("Failed to parse sequence generator data for saving to disk.");return}else return;const ne=new Blob([K],{type:"application/json"}),le=URL.createObjectURL(ne),ge=document.createElement("a");ge.href=le,ge.download=oe,ge.click(),URL.revokeObjectURL(le),ge.remove(),s(l("toast.scriptSaved"))},[a,s,l,r]);return{fileInputRef:V,handleFileChange:ue,handleLoadCanvas:re,handleSaveCanvas:ie,handleSaveProject:ce,handleLoadCanvasIntoCurrentTab:pe,imageSequenceFileInputRef:H,handleImageSequenceFileChange:Z,triggerLoadImageSequenceFile:$,promptSequenceEditorFileInputRef:F,handlePromptSequenceFileChange:ae,triggerLoadPromptSequenceFile:te,characterCardFileInputRef:G,handleCharacterCardFileChange:J,triggerLoadCharacterCard:I,handleSaveCharacterCard:W,scriptFileInputRef:B,handleScriptFileChange:Q,triggerLoadScriptFile:U,handleSaveScriptFile:de}},iC=new Map,sC=e=>{iC.delete(e)},lC="PromptModifierSessionDB",La="AppState",Jd="latest_session",cC=1,Ix=()=>new Promise((e,t)=>{const o=indexedDB.open(lC,cC);o.onerror=()=>t(o.error),o.onsuccess=()=>e(o.result),o.onupgradeneeded=()=>{o.result.objectStoreNames.contains(La)||o.result.createObjectStore(La)}}),$h=async(e,t)=>{const o=await Ix();return new Promise((r,a)=>{const l=o.transaction(La,"readwrite").objectStore(La).put({id:Jd,tabs:e,activeTabId:t},Jd);l.onerror=()=>a(l.error),l.onsuccess=()=>r()})},dC=async()=>{const e=await Ix();return new Promise((t,o)=>{const i=e.transaction(La,"readonly").objectStore(La).get(Jd);i.onerror=()=>o(i.error),i.onsuccess=()=>{const s=i.result;s&&Array.isArray(s.tabs)&&s.activeTabId?t({tabs:s.tabs,activeTabId:s.activeTabId}):t(void 0)}})},Os=e=>({nodes:[{id:"node-19-1761553959672",type:z.GEMINI_CHAT,position:{x:80,y:1160},value:'{"messages":[],"currentInput":""}',title:qo(e,"node.title.gemini_chat"),width:400,height:640},{id:"node-46-1761685266349",type:z.TEXT_INPUT,position:{x:80,y:380},value:"",title:qo(e,"node.title.text_input"),width:460,height:300},{id:"node-49-1761685294534",type:z.PROMPT_PROCESSOR,position:{x:640,y:320},value:"",title:qo(e,"node.title.prompt_processor"),width:460,height:420},{id:"node-53-1761685402016",type:z.TEXT_INPUT,position:{x:80,y:60},value:"",title:qo(e,"node.title.text_input"),width:460,height:300},{id:"node-54-1761685404557",type:z.TEXT_INPUT,position:{x:80,y:700},value:"",title:qo(e,"node.title.text_input"),width:460,height:300},{id:"node-55-1761685416437",type:z.IMAGE_OUTPUT,position:{x:1220,y:60},value:"",title:qo(e,"node.title.image_output"),width:460,height:940,aspectRatio:"1:1",model:"gemini-2.5-flash-image",autoDownload:!0},{id:"node-82-1761838643720",type:z.TRANSLATOR,position:{x:560,y:1160},value:'{"inputText":"","targetLanguage":"ru","translatedText":"","inputHeight":197}',title:qo(e,"node.title.translator"),width:460,height:640}],connections:[{fromNodeId:"node-49-1761685294534",toNodeId:"node-55-1761685416437",id:"conn-1761685421734-dlsqz1009"},{fromNodeId:"node-53-1761685402016",toNodeId:"node-49-1761685294534",id:"conn-1765381486428-7mzadq6ki"},{fromNodeId:"node-46-1761685266349",toNodeId:"node-49-1761685294534",id:"conn-1765381487379-rsa3lf6ts"},{fromNodeId:"node-54-1761685404557",toNodeId:"node-49-1761685294534",id:"conn-1765381488527-69zcwd7sm"}],groups:[],viewTransform:{scale:1,translate:{x:21.096368784472816,y:34.78642041088381}},nodeIdCounter:85,fullSizeImageCache:{}}),jx=Os("en"),ls=(e,t)=>({id:`tab-${Date.now()}`,name:e,state:{nodes:(t==null?void 0:t.nodes)||[],connections:(t==null?void 0:t.connections)||[],groups:(t==null?void 0:t.groups)||[],viewTransform:(t==null?void 0:t.viewTransform)||{scale:1,translate:{x:0,y:0}},nodeIdCounter:(t==null?void 0:t.nodeIdCounter)||0,fullSizeImageCache:(t==null?void 0:t.fullSizeImageCache)||{}}}),uC=()=>{const[e,t]=y.useState(()=>[ls("Canvas 1",jx)]),[o,r]=y.useState(e[0].id),[a,i]=y.useState(!1),s=y.useRef(null),[l,c]=y.useState(null),[d,u]=y.useState(!1);y.useEffect(()=>{(async()=>{try{const _=await dC();_&&(t(_.tabs),r(_.activeTabId))}catch(_){console.error("Failed to load session from IndexedDB:",_)}finally{i(!0)}})()},[]),y.useEffect(()=>{if(!a)return;s.current&&clearTimeout(s.current);const v=6e4;return c(Date.now()+v),s.current=setTimeout(()=>{u(!0);const _=async()=>{try{await $h(e,o)}catch(S){console.error("Failed to auto-save session:",S)}finally{u(!1),c(null)}};"requestIdleCallback"in window?window.requestIdleCallback(_,{timeout:5e3}):_()},v),()=>{s.current&&clearTimeout(s.current)}},[e,o,a]);const p=y.useCallback(v=>{v!==o&&r(v)},[o]),h=y.useCallback(()=>{const v=ls(`Canvas ${e.length+1}`);t(_=>[..._,v]),r(v.id)},[e.length]),x=y.useCallback(v=>{sC(v),t(_=>{if(_.length<=1)return _;const S=_.findIndex(P=>P.id===v),T=_.filter(P=>P.id!==v);if(o===v){const P=Math.max(0,S-1);r(T[P].id)}return T})},[o]),k=y.useCallback((v,_)=>{t(S=>S.map(T=>T.id===v?{...T,name:_}:T))},[]),C=y.useCallback(v=>{const _=Os(v),S=ls("Canvas 1",_);t([S]),r(S.id),$h([S],S.id)},[]),w=y.useCallback(v=>{const _=Os(v);t(S=>S.map(T=>T.id===o?{...T,state:_}:T))},[o]),f=y.useCallback(v=>{t(_=>_.map(S=>S.id===o?{...S,state:v}:S))},[o]),g=y.useCallback(()=>{var v;return((v=e.find(_=>_.id===o))==null?void 0:v.state)||ls("").state},[e,o]);return{tabs:e,setTabs:t,activeTabId:o,setActiveTabId:r,handleSwitchTab:p,handleAddTab:h,handleCloseTab:x,handleRenameTab:k,loadCanvasState:f,getCurrentCanvasState:g,resetTabs:C,resetCurrentTab:w,getLocalizedCanvasState:Os,nextAutoSaveTime:l,isAutoSaving:d}},Gc="quick_slots_config",pC=e=>{const{setGroups:t,renameCatalogItem:o,updateLibraryItem:r,handleRenameTab:a,handleCloseTab:i,handleRenameNode:s,getCurrentCanvasState:l,loadCanvasState:c,tabs:d,activeTabId:u,t:p,characterCatalog:h,scriptCatalog:x,sequenceCatalog:k}=e,[C,w]=y.useState(!1),[f,g]=y.useState({x:0,y:0}),[v,_]=y.useState(!1),[S,T]=y.useState({x:0,y:0}),[P,R]=y.useState(!1),[D,q]=y.useState(null),[O,E]=y.useState(!1),[A,N]=y.useState(null),[j,L]=y.useState(null),[M,V]=y.useState(null),[H,F]=y.useState(!1),[G,B]=y.useState(!1),Y=y.useRef({onSelect:()=>{},onClose:()=>{}}),[ee,ie]=y.useState(null),[ce,pe]=y.useState(null),[ue,re]=y.useState(null),[$,Z]=y.useState(null),[te,ae]=y.useState(!1),[I,J]=y.useState(Array(8).fill(null)),[W,U]=y.useState(!1);y.useEffect(()=>{const Ee=localStorage.getItem(Gc);if(Ee)try{const Me=JSON.parse(Ee);Array.isArray(Me)&&Me.length===8&&J(Me)}catch(Me){console.error("Failed to load quick slots",Me)}},[]);const Q=y.useCallback((Ee,Me)=>{J(Fe=>{const tt=[...Fe];return tt[Ee]=Me,localStorage.setItem(Gc,JSON.stringify(tt)),tt})},[]),de=y.useCallback(Ee=>{Array.isArray(Ee)&&Ee.length===8&&(J(Ee),localStorage.setItem(Gc,JSON.stringify(Ee)))},[]),se=y.useCallback(Ee=>{re({isOpen:!0,position:Ee}),Z(null),pe(null)},[]),X=y.useCallback((Ee=!1)=>{!Ee&&te||(re(null),ae(!1))},[te]),K=y.useCallback((Ee,Me)=>{Ee.preventDefault(),Ee.stopPropagation(),Z({isOpen:!0,position:{x:Ee.clientX,y:Ee.clientY},nodeId:Me}),re(null),pe(null)},[]),oe=y.useCallback(()=>{Z(null)},[]),ne=y.useCallback(()=>{ae(Ee=>!Ee)},[]),le=y.useCallback(()=>{U(Ee=>!Ee)},[]),ge=y.useCallback(Ee=>{g(Ee),w(!0)},[]),we=y.useCallback(Ee=>{_(!0),T(Ee)},[]),_e=y.useCallback(()=>{w(!1),W||_(!1),te||re(null),Z(null)},[te,W]),fe=y.useCallback((Ee,Me,Fe)=>{q({position:Ee,connectingInfo:Me,sourceNodeType:Fe}),R(!0)},[]),he=y.useCallback(()=>{R(!1),q(null)},[]),ye=y.useCallback(()=>E(Ee=>!Ee),[]),Se=y.useCallback(()=>E(!1),[]),Te=y.useCallback(Ee=>{if(!A||!Ee||!Ee.trim()){N(null);return}const Me=Ee.trim();A.type==="group"?t(Fe=>Fe.map(tt=>tt.id===A.id?{...tt,title:Me}:tt)):A.type==="catalog"?o(A.id,Me):A.type==="library"?r(A.id,{name:Me}):A.type==="tab"?a(A.id,Me):A.type==="character"?h.renameItem(A.id,Me):A.type==="script"?x.renameItem(A.id,Me):A.type==="sequence"?k.renameItem(A.id,Me):A.type==="node"&&s(A.id,Me),N(null)},[A,t,o,r,a,h,x,k,s]),Ae=y.useCallback((Ee,Me)=>{j&&r(j.id,{name:Ee.trim(),content:Me}),L(null)},[j,r]),Oe=y.useCallback(Ee=>{const Me=()=>{c({nodes:[],connections:[],groups:[],viewTransform:{scale:1,translate:{x:0,y:0}},nodeIdCounter:0,fullSizeImageCache:{}})};Ee!=null&&Ee.shiftKey?Me():V({title:p("dialog.confirmClear.title"),message:p("dialog.confirmClear.message"),onConfirm:Me})},[p,c]),me=y.useCallback(Ee=>{const Me=()=>{const Fe=JSON.parse(JSON.stringify(jx));c(Fe)};Ee!=null&&Ee.shiftKey?Me():V({title:p("dialog.confirmReset.title"),message:p("dialog.confirmReset.message"),onConfirm:Me})},[p,c]),ve=y.useCallback(Ee=>{Y.current=Ee,B(!0)},[]),Ie=y.useCallback(()=>{Y.current.onSelect(),B(!1)},[]),ke=y.useCallback(()=>{Y.current.onClose(),B(!1)},[]),je=y.useCallback((Ee,Me)=>{if(d.length<=1)return;const Fe=d.find(xe=>xe.id===Ee);if(!Fe)return;const tt=Ee===u?l():Fe.state;tt.nodes.length===0&&tt.connections.length===0&&(tt.groups||[]).length===0||Me!=null&&Me.shiftKey?i(Ee):V({title:p("dialog.confirmCloseTab.title"),message:p("dialog.confirmCloseTab.message",{tabName:Fe.name}),onConfirm:()=>i(Ee)})},[d,u,i,V,p,l]),Ge=y.useCallback(Ee=>{Ee&&navigator.clipboard.writeText(Ee).then(()=>{F(!0)})},[]),be=y.useCallback((Ee,Me)=>{pe({nodeIds:Ee,position:Me})},[]),Pe=y.useCallback(()=>{pe(null)},[]);return{isQuickSearchOpen:C,quickSearchPosition:f,isQuickAddOpen:v,quickAddPosition:S,isCatalogOpen:O,renameInfo:A,promptEditInfo:j,confirmInfo:M,isErrorCopied:H,isApiKeyDialogOpen:G,handleOpenQuickSearch:ge,handleOpenQuickAdd:we,handleCloseAddNodeMenus:_e,handleToggleCatalog:ye,handleCloseCatalog:Se,setRenameInfo:N,setPromptEditInfo:L,setConfirmInfo:V,confirmRename:Te,confirmPromptEdit:Ae,setIsErrorCopied:F,handleClearCanvas:Oe,handleResetCanvas:me,showApiKeyDialog:ve,handleApiKeySelect:Ie,handleApiKeyDialogClose:ke,handleCloseTab:je,handleCopyError:Ge,loadCanvasState:c,imageViewer:ee,setImageViewer:ie,isConnectionQuickAddOpen:P,connectionQuickAddInfo:D,handleOpenConnectionQuickAdd:fe,handleCloseConnectionQuickAdd:he,contextMenu:ue,nodeContextMenu:$,isContextMenuPinned:te,toggleContextMenuPin:ne,quickSlots:I,updateQuickSlot:Q,setAllQuickSlots:de,handleOpenContextMenu:se,handleCloseContextMenu:X,handleOpenNodeContextMenu:K,handleCloseNodeContextMenu:oe,isQuickAddMenuPinned:W,toggleQuickAddMenuPin:le,nodeDeleteConfirm:ce,requestDeleteNodes:be,cancelDeleteNodes:Pe}},hC=e=>{const[t,o]=y.useState(e),r=y.useRef(0),a=y.useCallback((l,c)=>{if(l.length===0)return;const d=yr(l);if(!d)return;r.current++;const u={id:`group-${r.current}-${Date.now()}`,title:c||`Group ${r.current}`,...d,nodeIds:l.map(p=>p.id)};o(p=>[...p,u])},[]),i=y.useCallback(l=>{o(c=>c.filter(d=>d.id!==l))},[]),s=y.useCallback((l,c)=>{o(d=>d.map(u=>{if(u.id===l){const p=c.filter(x=>u.nodeIds.includes(x.id)),h=yr(p);if(h)return{...u,...h}}return u}))},[]);return{groups:t,setGroups:o,addGroup:a,removeGroup:i,updateGroupBounds:s}};var gl=(e=>(e.FOLDER="FOLDER",e.GROUP="GROUP",e))(gl||{}),mp=(e=>(e.FOLDER="FOLDER",e.ITEM="ITEM",e))(mp||{});const mC="PromptModifierDB",Da="Catalogs",gC=1,Ax=()=>new Promise((e,t)=>{const o=indexedDB.open(mC,gC);o.onerror=()=>t(o.error),o.onsuccess=()=>e(o.result),o.onupgradeneeded=()=>{o.result.objectStoreNames.contains(Da)||o.result.createObjectStore(Da)}}),Mx=async e=>{const t=await Ax();return new Promise((o,r)=>{const s=t.transaction(Da,"readonly").objectStore(Da).get(e);s.onerror=()=>r(s.error),s.onsuccess=()=>o(s.result)})},fl=async(e,t)=>{const o=await Ax();return new Promise((r,a)=>{const l=o.transaction(Da,"readwrite").objectStore(Da).put(t,e);l.onerror=()=>a(l.error),l.onsuccess=()=>r()})},Hc="group-catalog-items",Uc=[{id:"default-group-image-editing",type:"GROUP",name:"Image Editing",parentId:null,nodes:[{id:"node-28-1761576310796",type:z.IMAGE_EDITOR,position:{x:460,y:0},value:'{"inputImage":null,"prompt":"","outputImage":null,"aspectRatio":"1:1","enableOutpainting":true,"inputImages":[],"outpaintingPrompt":"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.","topPaneHeight":645.6608879498896,"leftPaneRatio":0.4960591133004926}',title:" ",width:1040,height:1380,autoDownload:!0},{id:"node-29-1761576319677",type:z.NOTE,position:{x:0,y:0},value:`      Google

Edit images using modern innovations from Google`,title:"",width:380,height:240}],connections:[]}],Rx=()=>new Date().toISOString().replace(/:/g,"-").replace("T","_").split(".")[0],Vc=(e,t,o,r,a,i=[])=>{const[s,l]=y.useState([]),[c,d]=y.useState(!1);y.useEffect(()=>{(async()=>{try{const A=await Mx(e);if(A&&A.length>0)l(A);else{const N=i.length>0?i:[];l(N),N.length>0&&await fl(e,N)}}catch(A){console.error(`Failed to load catalog from IndexedDB (${e}):`,A),l(i)}finally{d(!0)}})()},[e]);const[u,p]=y.useState([null]),h=y.useRef(null),x=u[u.length-1],k=async E=>{try{await fl(e,E)}catch(A){console.error(`Failed to save catalog to ${e}`,A),alert(`Failed to save catalog: ${A}`)}},C=y.useMemo(()=>c?s.filter(E=>E.parentId===x).sort((E,A)=>E.type===A.type?E.name.localeCompare(A.name):E.type==="FOLDER"?-1:1):[],[s,x,c]),w=y.useMemo(()=>{const E={id:null,name:t};if(!c)return[E];const A=[];let N=x;for(;N;){const j=s.find(L=>L.id===N);if(j)A.unshift({id:j.id,name:j.name}),N=j.parentId;else break}return[E,...A]},[x,s,t,c]),f=y.useCallback(E=>{const A=u.findIndex(N=>N===E);A>-1?p(N=>N.slice(0,A+1)):p(N=>[...N,E])},[u]),g=y.useCallback(()=>{p(E=>E.length>1?E.slice(0,-1):E)},[]),v=y.useCallback(async(E,A,N)=>{if(!c)return;const j={id:`content-item-${Date.now()}-${Math.random()}`,type:E,name:A,parentId:x,content:N};l(L=>{const M=[...L,j];return k(M),M})},[c,x]),_=y.useCallback(async(E,A)=>{c&&l(N=>{const j=N.map(L=>L.id===E?{...L,name:A}:L);return k(j),j})},[c]),S=y.useCallback(async E=>{c&&l(A=>{const N=new Set([E]),j=[E];for(;j.length>0;){const M=j.shift();for(const V of A)V.parentId===M&&(N.add(V.id),V.type==="FOLDER"&&j.push(V.id))}const L=A.filter(M=>!N.has(M.id));return k(L),L})},[c]),T=y.useCallback(E=>{const A=s.find(B=>B.id===E);if(!A)return;let N;if(A.type==="ITEM"){let B;try{B=JSON.parse(A.content||"{}")}catch{B=A.content}N={type:"item",name:A.name,content:B}}else{const B=Y=>{const ee=s.find(ce=>ce.id===Y);if(!ee)return null;const ie=s.filter(ce=>ce.parentId===Y);return{name:ee.name,type:"folder",children:ie.map(ce=>{if(ce.type==="FOLDER")return B(ce.id);{let pe=ce.content;try{pe=JSON.parse(pe)}catch{}return{name:ce.name,type:"item",content:pe}}})}};N=B(E)}const L=JSON.stringify({appName:"Prompt_modifier",catalogContext:r,root:N},null,2),M=new Blob([L],{type:"application/json"}),V=URL.createObjectURL(M),H=document.createElement("a");H.href=V;const F=Rx(),G=`Catalog_${r}_${A.name.trim().replace(/\s+/g,"_")}_${F}.json`;H.download=G,H.click(),URL.revokeObjectURL(V),H.remove()},[s,r]),P=y.useCallback(async E=>{if(!c)return;const A=[],N=(L,M)=>{const V=`content-item-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;if(!L.name||!L.type)return;const H=L.type==="folder"?"FOLDER":"ITEM",F={id:V,type:H,name:L.name,parentId:M,content:H==="ITEM"?JSON.stringify(L.content):void 0};A.push(F),H==="FOLDER"&&Array.isArray(L.children)&&L.children.forEach(G=>N(G,V))},j=E.root||E;N(j,x),l(L=>{const M=[...L,...A];return k(M),M})},[c,x]),R=y.useCallback(E=>{var j;const A=(j=E.target.files)==null?void 0:j[0];if(!A)return;const N=new FileReader;N.onload=L=>{var M;try{const V=(M=L.target)==null?void 0:M.result,H=JSON.parse(V);if(H.appName!=="Prompt_modifier")throw new Error(o("alert.fileNotSupported")||'File not supported. Missing "appName": "Prompt_modifier".');if(!H.root)throw new Error(o("alert.invalidCatalogStructure")||'Invalid catalog structure. Missing "root".');if(H.catalogContext&&H.catalogContext!==r&&a){a(H);return}if(H.root)P(H);else if(H.type==="folder"&&Array.isArray(H.children))P({root:H});else{const F=A.name.replace(/^Catalog_.*?_/,"").replace(/_\d{4}-\d{2}-\d{2}.*\.json$/,"").replace(/\.json$/,"");v("ITEM",F,V)}}catch(V){alert(`${o("alert.loadCatalogFailed")}: ${V.message}`)}finally{E.target&&(E.target.value="")}},N.readAsText(A)},[v,o,r,a,P]),D=y.useCallback(()=>{var E;return(E=h.current)==null?void 0:E.click()},[]),q=y.useCallback(async(E,A)=>{c&&l(N=>{const j=N.find(M=>M.id===E);if(!j||j.parentId===A)return N;if(j.type==="FOLDER"){let M=A;for(;M;){if(M===E)return N;const V=N.find(H=>H.id===M);M=V?V.parentId:null}}const L=N.map(M=>M.id===E?{...M,parentId:A}:M);return k(L),L})},[c]),O=y.useCallback(async E=>{c&&(l(E),await k(E))},[c]);return{items:s,currentItems:C,path:w,navigateToFolder:f,navigateBack:g,createItem:v,renameItem:_,deleteItem:S,saveItemToDisk:T,fileInputRef:h,handleFileChange:R,triggerLoadFromFile:D,moveItem:q,replaceAllItems:O,importItemsData:P}},fC=(e,t)=>{const[o,r]=y.useState([]),[a,i]=y.useState(!1),s="groups";y.useEffect(()=>{(async()=>{try{const O=await Mx(Hc);O&&O.length>0?r(O):(r(Uc),await fl(Hc,Uc))}catch(O){console.error("Failed to load group catalog from IndexedDB",O),r(Uc)}finally{i(!0)}})()},[]);const[l,c]=y.useState([null]),d=y.useRef(null),u=l[l.length-1],p=async q=>{try{await fl(Hc,q)}catch(O){console.error("Failed to save group catalog to storage",O)}},h=y.useMemo(()=>a?o.filter(q=>q.parentId===u).sort((q,O)=>q.type===O.type?q.name.localeCompare(O.name):q.type==="FOLDER"?-1:1):[],[o,u,a]),x=y.useMemo(()=>{const q={id:null,name:e("catalog.tabs.groups")};if(!a)return[q];const O=[];let E=u;for(;E;){const A=o.find(N=>N.id===E);if(A)O.unshift({id:A.id,name:A.name}),E=A.parentId;else break}return[q,...O]},[u,o,e,a]),k=y.useCallback(q=>{const O=l.findIndex(E=>E===q);O>-1?c(E=>E.slice(0,O+1)):c(E=>[...E,q])},[l]),C=y.useCallback(()=>{c(q=>q.length>1?q.slice(0,-1):q)},[]),w=y.useCallback(async q=>{if(!a||q!=="FOLDER")return;const O={id:`cat-item-${Date.now()}`,type:q,name:e("library.actions.newFolder"),parentId:u};r(E=>{const A=[...E,O];return p(A),A})},[u,e,a]),f=y.useCallback(async(q,O,E,A)=>{if(!a)return;const N=O.filter(Y=>q.nodeIds.includes(Y.id));if(N.length===0)return;const j=new Set(N.map(Y=>Y.id)),L=E.filter(Y=>j.has(Y.fromNodeId)&&j.has(Y.toNodeId)),M=JSON.parse(JSON.stringify(N)),V=JSON.parse(JSON.stringify(L)),H=Math.min(...M.map(Y=>Y.position.x)),F=Math.min(...M.map(Y=>Y.position.y));M.forEach(Y=>{Y.position.x-=H,Y.position.y-=F});const G={};A&&N.forEach(Y=>{A[Y.id]&&(G[Y.id]=A[Y.id])});const B={id:`catalog-item-${Date.now()}`,type:"GROUP",name:q.title,parentId:u,nodes:M,connections:V,fullSizeImages:G};r(Y=>{const ee=[...Y,B];return p(ee),ee})},[u,a]),g=y.useCallback(async(q,O)=>{!a||!O||!O.trim()||r(E=>{const A=E.map(N=>N.id===q?{...N,name:O.trim()}:N);return p(A),A})},[a]),v=y.useCallback(async q=>{a&&r(O=>{const E=new Set([q]),A=O.find(j=>j.id===q);if((A==null?void 0:A.type)==="FOLDER"){const j=[q];for(;j.length>0;){const L=j.shift();for(const M of O)M.parentId===L&&(E.add(M.id),M.type==="FOLDER"&&j.push(M.id))}}const N=O.filter(j=>!E.has(j.id));return p(N),N})},[a]),_=y.useCallback(q=>{const O=o.find(F=>F.id===q);if(!O)return;let E;if(O.type==="GROUP")E={type:"prompModifierGroup",name:O.name,nodes:O.nodes,connections:O.connections,fullSizeImages:O.fullSizeImages};else{const F=G=>{const B=o.find(ee=>ee.id===G);if(!B)return null;const Y=o.filter(ee=>ee.parentId===G);return{name:B.name,type:"folder",children:Y.map(ee=>ee.type==="FOLDER"?F(ee.id):{type:"prompModifierGroup",name:ee.name,nodes:ee.nodes,connections:ee.connections,fullSizeImages:ee.fullSizeImages})}};E=F(q)}const N=JSON.stringify({appName:"Prompt_modifier",catalogContext:s,root:E},null,2),j=new Blob([N],{type:"application/json"}),L=URL.createObjectURL(j),M=document.createElement("a");M.href=L;const V=Rx(),H=`Catalog_${s}_${O.name.trim().replace(/\s+/g,"_")}_${V}.json`;M.download=H,M.click(),URL.revokeObjectURL(L),M.remove()},[o]),S=y.useCallback(async q=>{if(!a)return;const O=[],E=(N,j)=>{const L=`cat-item-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;if(!N.name||!N.type)return;const V=N.type==="prompModifierGroup"||N.type==="group"||N.type==="GROUP"?"GROUP":"FOLDER",H={id:L,type:V,name:N.name,parentId:j,nodes:V==="GROUP"?N.nodes||[]:void 0,connections:V==="GROUP"?N.connections||[]:void 0,fullSizeImages:V==="GROUP"?N.fullSizeImages:void 0};O.push(H),V==="FOLDER"&&Array.isArray(N.children)&&N.children.forEach(F=>E(F,L))},A=q.root||q;E(A,u),r(N=>{const j=[...N,...O];return p(j),j})},[a,u]),T=y.useCallback(async q=>{var A;const O=(A=q.target.files)==null?void 0:A[0];if(!O||!a)return;const E=new FileReader;E.onload=async N=>{var j;try{const L=(j=N.target)==null?void 0:j.result,M=JSON.parse(L);if(M.appName!=="Prompt_modifier")throw new Error(e("alert.fileNotSupported")||'File not supported. Missing "appName": "Prompt_modifier".');if(!M.root)throw new Error(e("alert.invalidCatalogStructure")||'Invalid catalog structure. Missing "root".');if(M.catalogContext&&M.catalogContext!==s&&t){t(M);return}S(M)}catch(L){alert(`${e("alert.loadCatalogFailed")}: ${L.message}`)}finally{q.target&&(q.target.value="")}},E.readAsText(O)},[e,a,s,t,S]),P=y.useCallback(()=>{var q;(q=d.current)==null||q.click()},[]),R=y.useCallback(async(q,O)=>{a&&r(E=>{const A=E.find(j=>j.id===q);if(!A||A.parentId===O)return E;if(A.type==="FOLDER"){let j=O;for(;j;){if(j===q)return E;const L=E.find(M=>M.id===j);j=L?L.parentId:null}}const N=E.map(j=>j.id===q?{...j,parentId:O}:j);return p(N),N})},[a]),D=y.useCallback(async q=>{a&&(r(q),await p(q))},[a]);return{catalogItems:o,currentCatalogItems:h,catalogPath:x,navigateCatalogBack:C,navigateCatalogToFolder:k,createCatalogItem:w,saveGroupToCatalog:f,renameCatalogItem:g,deleteCatalogItem:v,saveCatalogItemToDisk:_,catalogFileInputRef:d,handleCatalogFileChange:T,triggerLoadFromFile:P,moveCatalogItem:R,replaceAllItems:D,importItemsData:S}},xC=e=>{const[t,o]=y.useState(null),[r,a]=y.useState(!1),[i,s]=y.useState(!1);y.useEffect(()=>{let d;return(async()=>{try{d=await navigator.permissions.query({name:e}),o(d.state),d.state==="prompt"&&!i&&a(!0),d.onchange=()=>{o(d.state),d.state!=="prompt"&&a(!1)}}catch(p){console.warn(`Permission API for '${e}' not supported.`,p),o("granted")}})(),()=>{d&&(d.onchange=null)}},[e,i]);const l=y.useCallback(async()=>{try{await navigator.clipboard.readText()}catch(d){d instanceof DOMException&&d.name==="NotAllowedError"&&o("denied"),console.error("Clipboard read failed:",d)}finally{a(!1)}},[]),c=y.useCallback(()=>{a(!1),s(!0)},[]);return{showDialog:r,requestPermission:l,declinePermission:c}},Kh="prompt-library-items",Jh=[{id:"folder-1",type:Vt.FOLDER,name:"Basic Promts",parentId:null},{id:"prompt-1",type:Vt.PROMPT,name:"Fill background",parentId:"folder-1",content:"Fill the white background with the surroundings"},{id:"prompt-2",type:Vt.PROMPT,name:"Remove all watermarks",parentId:"folder-1",content:"Remove all watermarks, logos, text overlays, and advertisement banners from the image. Restore the original background naturally, blending colors and textures smoothly. Keep all other visual elements unchanged and realistic."},{id:"prompt-3",type:Vt.PROMPT,name:"Character concept",parentId:"folder-1",content:"Create a character concept based on the provided image. The character is standing full-length against a gray background."}],yC=()=>new Date().toISOString().replace(/:/g,"-").replace("T","_").split(".")[0],vC=(e,t)=>{const[o,r]=y.useState(()=>{try{const q=localStorage.getItem(Kh);return q?JSON.parse(q):Jh}catch(q){return console.error("Failed to load prompt library from storage",q),Jh}}),a="library",[i,s]=y.useState([null]),l=y.useRef(null),c=i[i.length-1],d=q=>{try{localStorage.setItem(Kh,JSON.stringify(q))}catch(O){console.error("Failed to save prompt library to storage",O)}},u=y.useMemo(()=>o.filter(q=>q.parentId===c).sort((q,O)=>q.type===O.type?q.name.localeCompare(O.name):q.type===Vt.FOLDER?-1:1),[o,c]),p=y.useMemo(()=>{const q=[{id:null,name:e("catalog.tabs.library")}];return i.slice(1).forEach(O=>{if(!O)return;const E=o.find(A=>A.id===O);E&&q.push({id:E.id,name:E.name})}),q},[i,o,e]),h=y.useCallback(q=>{const O=i.findIndex(E=>E===q);O>-1?s(E=>E.slice(0,O+1)):s(E=>[...E,q])},[i]),x=y.useCallback(()=>{s(q=>q.length>1?q.slice(0,-1):q)},[]),k=y.useCallback(q=>{const O=q===Vt.FOLDER?e("library.actions.newFolder"):e("library.actions.newPrompt"),E={id:`lib-item-${Date.now()}`,type:q,name:O,parentId:c,content:q===Vt.PROMPT?"":void 0};r(A=>{const N=[...A,E];return d(N),N})},[c,e]),C=y.useCallback((q,O)=>{const E={id:`lib-item-${Date.now()}`,type:Vt.PROMPT,name:q,parentId:c,content:O};r(A=>{const N=[...A,E];return d(N),N})},[c]),w=y.useCallback((q,O)=>{q&&r(E=>{let A=E.find(G=>G.type===Vt.FOLDER&&G.parentId===null&&G.name===O),N,j=[...E];if(A)N=A.id;else{N=`lib-item-folder-${Date.now()}`;const G={id:N,type:Vt.FOLDER,name:O,parentId:null};j.push(G)}let M=q.split(/[\s,]+/).filter(Boolean).slice(0,4).join(" ");M.length>30&&(M=M.substring(0,30)+"..."),M||(M="New Prompt");let V=M,H=1;for(;j.some(G=>G.parentId===N&&G.name===V);)V=`${M} (${H++})`;const F={id:`lib-item-prompt-${Date.now()}`,type:Vt.PROMPT,name:V,parentId:N,content:q};return j.push(F),d(j),j})},[]),f=y.useCallback(q=>{w(q,"Processor Prompts")},[w]),g=y.useCallback((q,O)=>{r(E=>{const A=E.map(N=>N.id===q?{...N,...O}:N);return d(A),A})},[]),v=y.useCallback(q=>{r(O=>{new Map(O.map(j=>[j.id,j]));const E=new Set([q]),A=[q];for(;A.length>0;){const j=A.shift();for(const L of O)L.parentId===j&&(E.add(L.id),L.type===Vt.FOLDER&&A.push(L.id))}const N=O.filter(j=>!E.has(j.id));return d(N),N})},[]),_=y.useCallback(q=>{let O,E;const A=yC();if(q.type===Vt.PROMPT){const V=q.content||"";E=`${q.name.trim().replace(/\s+/g,"_")}_${A}.txt`;const H=new Blob([V],{type:"text/plain"}),F=URL.createObjectURL(H),G=document.createElement("a");G.href=F,G.download=E,G.click(),URL.revokeObjectURL(F),G.remove();return}else{const V=H=>{const F=o.find(B=>B.id===H);if(!F)return null;const G=o.filter(B=>B.parentId===H);return{name:F.name,type:"folder",children:G.map(B=>B.type===Vt.FOLDER?V(B.id):{name:B.name,type:"prompt",content:B.content||""})}};O={appName:"Prompt_modifier",catalogContext:a,root:V(q.id)},E=`Catalog_${a}_${q.name.trim().replace(/\s+/g,"_")}_${A}.json`}const N=JSON.stringify(O,null,2),j=new Blob([N],{type:"application/json"}),L=URL.createObjectURL(j),M=document.createElement("a");M.href=L,M.download=E,M.click(),URL.revokeObjectURL(L),M.remove()},[o]),S=y.useCallback(async q=>{const O=[],E=(N,j)=>{const L=`lib-item-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;if(!N.name||!N.type)return;const M=N.type==="folder"?Vt.FOLDER:Vt.PROMPT,V={id:L,type:M,name:N.name,parentId:j,content:M===Vt.PROMPT?N.content||"":void 0};O.push(V),M===Vt.FOLDER&&Array.isArray(N.children)&&N.children.forEach(H=>E(H,L))},A=q.root||q;E(A,c),r(N=>{const j=[...N,...O];return d(j),j})},[c]),T=y.useCallback(q=>{var A;const O=(A=q.target.files)==null?void 0:A[0];if(!O)return;const E=new FileReader;E.onload=N=>{var L;const j=(L=N.target)==null?void 0:L.result;try{if(!j)throw new Error("Empty file");if(O.name.endsWith(".txt")){const V=O.name.replace(".txt","");C(V,j);return}const M=JSON.parse(j);if(M.appName!=="Prompt_modifier")throw new Error(e("alert.fileNotSupported")||'File not supported. Missing "appName": "Prompt_modifier".');if(!M.root)throw new Error(e("alert.invalidCatalogStructure")||'Invalid catalog structure. Missing "root".');if(M.catalogContext&&M.catalogContext!==a&&t){t(M);return}S(M)}catch(M){alert(`${e("alert.loadCatalogFailed")}: ${M.message}`)}finally{q.target&&(q.target.value="")}},E.onerror=()=>{alert("Error reading the selected file.")},E.readAsText(O)},[S,t,a,e,C]),P=y.useCallback(()=>{var q;(q=l.current)==null||q.click()},[]),R=y.useCallback((q,O)=>{r(E=>{const A=E.find(j=>j.id===q);if(!A||A.parentId===O)return E;if(A.type===Vt.FOLDER){let j=O;for(;j;){if(j===q)return E;const L=E.find(M=>M.id===j);j=L?L.parentId:null}}const N=E.map(j=>j.id===q?{...j,parentId:O}:j);return d(N),N})},[]),D=y.useCallback(q=>{r(q),d(q)},[]);return{libraryItems:o,currentLibraryItems:u,libraryPath:p,navigateBack:x,navigateToFolder:h,createLibraryItem:k,updateLibraryItem:g,deleteLibraryItem:v,saveLibraryItemToDisk:_,libraryFileInputRef:l,handleLibraryFileChange:T,triggerLoadLibraryFromFile:P,moveLibraryItem:R,addPromptToLibrary:C,saveProcessorPrompt:f,saveToLibrary:w,replaceAllItems:D,importItemsData:S}},Yd=410,Xd=110,wC=e=>{const{nodes:t,setNodes:o,connections:r,setConnections:a,nodeIdCounter:i,t:s,groups:l,setGroups:c,clearImagesForNodeFromCache:d,tabId:u,addToast:p,getFullSizeImage:h,setFullSizeImage:x,takeSnapshot:k}=e,C=y.useCallback((q,O,E,A={centerNode:!0})=>{i.current++;const N=`node-${i.current}-${Date.now()}`,j={[z.TEXT_INPUT]:s("node.title.text_input"),[z.IMAGE_INPUT]:s("node.title.image_input"),[z.PROMPT_PROCESSOR]:s("node.title.prompt_processor"),[z.VIDEO_PROMPT_PROCESSOR]:s("node.title.video_prompt_processor"),[z.IMAGE_OUTPUT]:s("node.title.image_output"),[z.VIDEO_OUTPUT]:s("node.title.video_output"),[z.PROMPT_ANALYZER]:s("node.title.prompt_analyzer"),[z.CHARACTER_ANALYZER]:s("node.title.character_analyzer"),[z.CHARACTER_GENERATOR]:s("node.title.character_generator"),[z.CHARACTER_CARD]:s("node.title.character_card"),[z.IMAGE_ANALYZER]:s("node.title.image_analyzer"),[z.IMAGE_EDITOR]:s("node.title.image_editor"),[z.IMAGE_SEQUENCE_GENERATOR]:s("node.title.image_sequence_generator"),[z.PROMPT_SEQUENCE_EDITOR]:s("node.title.prompt_sequence_editor"),[z.GEMINI_CHAT]:s("node.title.gemini_chat"),[z.TRANSLATOR]:s("node.title.translator"),[z.SCRIPT_GENERATOR]:s("node.title.script_generator"),[z.SCRIPT_VIEWER]:s("node.title.script_viewer"),[z.NOTE]:s("node.title.note"),[z.REROUTE_DOT]:s("node.title.reroute_dot"),[z.PROMPT_SANITIZER]:s("node.title.prompt_sanitizer"),[z.DATA_READER]:s("node.title.data_reader"),[z.VIDEO_EDITOR]:s("node.title.video_editor"),[z.MEDIA_VIEWER]:s("node.title.media_viewer"),[z.DATA_PROTECTION]:s("node.title.data_protection"),[z.POSE_CREATOR]:s("node.title.pose_creator")},L={id:N,type:q,position:O,title:E||j[q]||"New Node",value:"",width:400,height:300,isNewlyCreated:!0};switch(L.value=A.initialValue!==void 0?A.initialValue:Gi(L),q){case z.IMAGE_EDITOR:L.width=1e3,L.height=920;break;case z.PROMPT_ANALYZER:L.width=460,L.height=1e3;break;case z.IMAGE_INPUT:L.width=460,L.height=340;break;case z.IMAGE_ANALYZER:case z.VIDEO_OUTPUT:L.width=460,L.height=680;break;case z.PROMPT_PROCESSOR:L.width=460,L.height=410;break;case z.VIDEO_PROMPT_PROCESSOR:L.width=460,L.height=410;break;case z.IMAGE_OUTPUT:L.width=460,L.height=700,L.model="gemini-2.5-flash-image",L.autoDownload=!0;break;case z.GEMINI_CHAT:case z.TRANSLATOR:L.width=400,L.height=640;break;case z.NOTE:L.width=460,L.height=660;break;case z.CHARACTER_ANALYZER:L.width=460,L.height=500;break;case z.CHARACTER_CARD:L.width=520,L.height=960,L.collapsedHandles=!0;break;case z.SCRIPT_GENERATOR:L.width=500,L.height=1e3;break;case z.SCRIPT_VIEWER:L.width=500,L.height=600;break;case z.IMAGE_SEQUENCE_GENERATOR:L.width=1300,L.height=920,L.aspectRatio="16:9";break;case z.PROMPT_SEQUENCE_EDITOR:L.width=1300,L.height=920;break;case z.REROUTE_DOT:L.width=60,L.height=40;break;case z.PROMPT_SANITIZER:L.width=460,L.height=280;break;case z.DATA_READER:L.width=400,L.height=500;break;case z.CHARACTER_GENERATOR:L.width=500,L.height=840;break;case z.TEXT_INPUT:L.width=460,L.height=300;break;case z.MEDIA_VIEWER:L.width=500,L.height=340;break;case z.DATA_PROTECTION:L.width=800,L.height=600;break;case z.VIDEO_EDITOR:L.width=920,L.height=640;break;case z.POSE_CREATOR:L.width=600,L.height=800;break;default:L.width=460,L.height=280}return A.alignToInput?L.position={x:O.x,y:O.y-L.height/2}:A.centerNode?L.position={x:O.x-L.width/2,y:O.y-40/2}:L.position=O,o(M=>[...M,L]),N},[i,o,s]),w=y.useCallback(q=>{const O=t.find(E=>E.id===q);if(O&&O.type===z.REROUTE_DOT){const E=r.find(N=>N.toNodeId===q),A=r.filter(N=>N.fromNodeId===q);if(E&&A.length>0){const N=A.map(j=>({fromNodeId:E.fromNodeId,fromHandleId:E.fromHandleId,toNodeId:j.toNodeId,toHandleId:j.toHandleId,id:`conn-${Date.now()}-${Math.random()}`}));a(j=>[...j.filter(L=>L.toNodeId!==q&&L.fromNodeId!==q),...N])}}o(E=>E.filter(A=>A.id!==q)),a(E=>E.filter(A=>A.fromNodeId!==q&&A.toNodeId!==q)),c(E=>E.map(A=>({...A,nodeIds:A.nodeIds.filter(N=>N!==q)})).filter(A=>A.nodeIds.length>0)),d(q)},[t,r,o,a,c,d,u]),f=y.useCallback((q,O,E)=>{o(A=>A.map(N=>{if(N.id===q){const j=E||N.position,L=N.dockState?N.dockState.original:{x:N.position.x,y:N.position.y,width:N.width,height:N.height},M=Ri(N.type),V=56,H=window.innerWidth,F=window.innerHeight;let G=N.width,B=N.height;const Y=V*2,ee=(H-Y)/4;return O==="left"||O==="right"?(G=H/2-V*1.5,B=F-Y):O==="full"?(G=H-Y,B=F-Y):["q1","q2","q3","q4"].includes(O)?(G=ee,B=F-Y):(G=H/2-V*1.5,B=F/2-V*1.5),G=Math.max(G,M.minWidth),B=Math.max(B,M.minHeight),{...N,isCollapsed:!1,position:j,width:G,height:B,dockState:{mode:O,original:L}}}return N}))},[o]),g=y.useCallback(q=>{o(O=>{const E=O.find(j=>j.id===q);if(!E||!E.dockState)return O;const{original:A}=E.dockState,N=Ri(E.type);return O.map(j=>j.id===q?{...j,dockState:void 0,position:{x:j.position.x,y:j.position.y},width:Math.max(N.minWidth,A.width),height:Math.max(N.minHeight,A.height)}:j)}),setTimeout(()=>{o(O=>O.map(E=>E.id===q?{...E,width:E.width+1,height:E.height+1}:E)),setTimeout(()=>{o(O=>O.map(E=>E.id===q?{...E,width:E.width-1,height:E.height-1}:E))},50)},50)},[o]),v=y.useCallback(q=>{const O=t.find(A=>A.id===q);if(!O)return"";const E=(A,N)=>{const j=A.filter(M=>M.toNodeId===q),L=[];for(const M of j){const V=N.find(F=>F.id===M.fromNodeId);if(!V)continue;let H="";try{const F=JSON.parse(V.value||"{}");if(V.type===z.PROMPT_ANALYZER&&M.fromHandleId)if(M.fromHandleId.startsWith("character-")){const G=parseInt(M.fromHandleId.split("-")[1],10);F.characters&&Array.isArray(F.characters)&&(H=F.characters[G]||"")}else H=F[M.fromHandleId]||"";else V.type===z.IMAGE_INPUT&&M.fromHandleId==="text"?H=F.prompt||"":V.type===z.IMAGE_ANALYZER?H=F.description||"":H=V.value}catch{H=V.value}L.push(H)}return L.filter(M=>M&&M.trim()!=="")};if(O.type===z.IMAGE_EDITOR)try{return JSON.parse(O.value).prompt||""}catch{return""}return O.type===z.IMAGE_OUTPUT||O.type===z.VIDEO_OUTPUT?E(r,t).join(", "):""},[t,r]),_=y.useCallback(async q=>{const O=l.find(M=>M.id===q);if(!O)return;const E=t.filter(M=>O.nodeIds.includes(M.id)),A=new Set(E.map(M=>M.id)),N=r.filter(M=>A.has(M.fromNodeId)&&A.has(M.toNodeId)),j={};E.forEach(M=>{for(let V=0;V<20;V++){const H=h(M.id,V);H&&(j[M.id]||(j[M.id]={}),j[M.id][V]=H)}});const L={type:"prompModifierGroup",name:O.title,nodes:E,connections:N,fullSizeImages:j};try{await navigator.clipboard.writeText(JSON.stringify(L,null,2)),p(s("toast.copiedToClipboard"))}catch(M){console.error("Failed to copy group to clipboard",M),p(s("toast.copyFailed")+" (Check console)","error")}},[l,t,r,s,p,h]),S=y.useCallback(q=>{const O=l.find(B=>B.id===q);if(!O)return;const E=t.filter(B=>O.nodeIds.includes(B.id)),A=new Set(E.map(B=>B.id)),N=r.filter(B=>A.has(B.fromNodeId)&&A.has(B.toNodeId)),j=new Map,L=Date.now(),M={x:50,y:50},V=E.map((B,Y)=>{i.current++;const ee=`node-${i.current}-${L}-${Y}`;j.set(B.id,ee);for(let ie=0;ie<20;ie++){const ce=h(B.id,ie);ce&&x(ee,ie,ce)}return{...B,id:ee,position:{x:B.position.x+M.x,y:B.position.y+M.y},isNewlyCreated:!0}}),H=`group-${L}-${Math.random().toString(36).substr(2,5)}`,F={...O,id:H,position:{x:O.position.x+M.x,y:O.position.y+M.y},nodeIds:V.map(B=>B.id),title:`${O.title}`},G=N.map((B,Y)=>({...B,id:`conn-${L}-${Y}`,fromNodeId:j.get(B.fromNodeId),toNodeId:j.get(B.toNodeId)}));o(B=>[...B,...V]),c(B=>[...B,F]),a(B=>[...B,...G]),p(s("toast.nodeDuplicated"))},[l,t,r,i,o,c,a,s,p,h,x]),T=y.useCallback((q,O)=>{const E=q.nodes||[],A=q.connections||[],N=q.fullSizeImages||{},j=q.name||(q.group?q.group.title:"Imported Group");if(E.length===0)return;const L=new Map,M=Date.now();let V=1/0,H=1/0,F=-1/0,G=-1/0;E.forEach(I=>{V=Math.min(V,I.position.x),H=Math.min(H,I.position.y),F=Math.max(F,I.position.x+I.width),G=Math.max(G,I.position.y+I.height)});let B=50,Y=50;O?(B=O.x-V,Y=O.y-H):(B=50-V,Y=50-H);const ee=E.map((I,J)=>{i.current++;const W=`node-${i.current}-${M}-${J}`;return L.set(I.id,W),N&&N[I.id]&&Object.entries(N[I.id]).forEach(([U,Q])=>{x(W,Number(U),Q)}),{...I,id:W,position:{x:I.position.x+B,y:I.position.y+Y},isNewlyCreated:!0}}),ie=`group-${M}-${Math.random().toString(36).substr(2,5)}`,ce=30,pe=70,ue=F-V+ce*2,re=G-H+pe+ce,$=V+B-ce,Z=H+Y-pe,te={id:ie,title:j,position:{x:$,y:Z},width:ue,height:re,nodeIds:ee.map(I=>I.id)},ae=A.map((I,J)=>({...I,id:`conn-${M}-${J}`,fromNodeId:L.get(I.fromNodeId),toNodeId:L.get(I.toNodeId)}));o(I=>[...I,...ee]),c(I=>[...I,te]),a(I=>[...I,...ae]),p(s("toast.pastedFromClipboard"))},[i,o,c,a,x,s,p]),P=y.useCallback((q,O)=>{q.length<2||(O==="distribute-horizontal"||O==="distribute-vertical")&&q.length<3||(k&&k(t),o(E=>{const A=E.filter(F=>q.includes(F.id));if(A.length<2)return E;let N=1/0,j=-1/0,L=1/0,M=-1/0;A.forEach(F=>{N=Math.min(N,F.position.x),j=Math.max(j,F.position.x+F.width),L=Math.min(L,F.position.y),M=Math.max(M,F.position.y+F.height)});const V=(N+j)/2,H=(L+M)/2;if(O==="distribute-horizontal"){A.sort(($,Z)=>$.position.x-Z.position.x);const F=A[0],G=A[A.length-1],B=F.position.x,ee=G.position.x+G.width-B,ie=A.reduce(($,Z)=>$+Z.width,0),pe=(ee-ie)/(A.length-1);let ue=B;const re=new Map;re.set(F.id,ue),ue+=F.width+pe;for(let $=1;$<A.length-1;$++){const Z=A[$];re.set(Z.id,ue),ue+=Z.width+pe}return re.set(G.id,G.position.x),E.map($=>re.has($.id)?{...$,position:{x:re.get($.id),y:$.position.y}}:$)}if(O==="distribute-vertical"){A.sort(($,Z)=>$.position.y-Z.position.y);const F=A[0],G=A[A.length-1],B=F.position.y,ee=G.position.y+G.height-B,ie=A.reduce(($,Z)=>$+Z.height,0),pe=(ee-ie)/(A.length-1);let ue=B;const re=new Map;re.set(F.id,ue),ue+=F.height+pe;for(let $=1;$<A.length-1;$++){const Z=A[$];re.set(Z.id,ue),ue+=Z.width+pe}return re.set(G.id,G.position.y),E.map($=>re.has($.id)?{...$,position:{x:$.position.x,y:re.get($.id)}}:$)}return E.map(F=>{if(!q.includes(F.id))return F;let G=F.position.x,B=F.position.y;switch(O){case"left":G=N;break;case"center-x":G=V-F.width/2;break;case"right":G=j-F.width;break;case"top":B=L;break;case"center-y":B=H-F.height/2;break;case"bottom":B=M-F.height;break}return{...F,position:{x:G,y:B}}})}))},[o,k,t]),R=()=>new Date().toISOString().replace(/:/g,"-").replace("T","_").split(".")[0],D=y.useCallback((q,O)=>{const E=t.find(j=>j.id===q);if(!E)return;let A,N="";try{const j=JSON.parse(E.value||"{}");if(E.type===z.IMAGE_OUTPUT||E.type===z.VIDEO_OUTPUT)A=h(q,0)||E.value,N=v(q);else if(E.type===z.IMAGE_INPUT)A=h(q,0)||j.image,N=j.prompt||"";else if(E.type===z.IMAGE_EDITOR)A=h(q,0)||j.outputImage,N=j.prompt||"";else if(E.type===z.GEMINI_CHAT){const L={type:"gemini-chat-history",messages:j.messages||[],currentInput:j.currentInput||"",style:j.style||"general",attachment:j.attachment||null},M=new Blob([JSON.stringify(L,null,2)],{type:"application/json"}),V=URL.createObjectURL(M),H=document.createElement("a");H.href=V;const F=R();H.download=`Gemini_Chat_History_${F}.json`,document.body.appendChild(H),H.click(),document.body.removeChild(H),URL.revokeObjectURL(V),p(s("toast.scriptSaved"));return}}catch{}A&&O(A,0,N)},[t,h,v,p,s]);return{onAddNode:C,deleteNodeAndConnections:w,getPromptForNode:v,copyGroup:_,duplicateGroup:S,pasteGroup:T,handleAlignNodes:P,handleDockNode:f,handleUndockNode:g,handleDownloadImage:D}},Wc=(e,t)=>{if(!e)return"";const o={appearance:"Appearance",:"Appearance",apariencia:"Appearance",personality:"Personality",:"Personality",:"Personality",personalidad:"Personality",clothing:"Clothing",:"Clothing",ropa:"Clothing"},r=/####\s*([^\n]+)\s*([\s\S]*?)(?=####|$)/gi;let a;for(;(a=r.exec(e))!==null;){const i=a[1].trim().toLowerCase(),s=a[2].trim();if(o[i]===t)return s}return""},Yh=e=>{if(!e)return"0";let t=0;const o=e.length,r=o>1e3?e.substring(0,500)+e.substring(o-500):e;for(let a=0;a<r.length;a++){const i=r.charCodeAt(a);t=(t<<5)-t+i,t=t&t}return`${o}-${t}`},bC=e=>{const{connections:t,nodes:o,getFullSizeImage:r}=e,a=y.useRef({signature:"",data:new Map}),i=y.useRef({signature:"",data:new Map}),s=y.useMemo(()=>{const h=new Map;return t.forEach(x=>{h.has(x.toNodeId)||h.set(x.toNodeId,new Set),h.get(x.toNodeId).add(x.toHandleId)}),h},[t]),l=y.useMemo(()=>{const h=new Map;return t.forEach(x=>{const k=o.find(C=>C.id===x.toNodeId);if(k&&(k.type===z.DATA_READER||k.type===z.REROUTE_DOT)){const C=o.find(w=>w.id===x.fromNodeId);if(C){const w=Kn(C,x.fromHandleId);w&&h.set(x.toNodeId,w)}}}),h},[t,o]),c=y.useCallback((h,x,k,C)=>{var g;if(k.has(h))return null;k.add(h);const w=o.find(v=>v.id===h);if(!w||Kn(w,x)!=="image"&&w.type!==z.REROUTE_DOT)return null;if(w.type===z.IMAGE_ANALYZER||w.type===z.REROUTE_DOT){const v=t.find(_=>_.toNodeId===h);if(v)return c(v.fromNodeId,v.fromHandleId,k,C)}try{const v=JSON.parse(w.value||"{}");switch(w.type){case z.IMAGE_INPUT:return C&&v.image?v.image:r(w.id,0)||v.image||null;case z.POSE_CREATOR:return v.renderedImage||null;case z.IMAGE_ANALYZER:case z.CHARACTER_CARD:if(w.type===z.CHARACTER_CARD&&x!=="image")break;const _=Array.isArray(v)?v:[v],S=_.find(D=>D.isOutput)||_[0];if(S&&S.isActive===!1)return null;const T=_.indexOf(S),P=Wt[S.selectedRatio]||1,R=r(w.id,T*10+P);return R&&!C?R:(S==null?void 0:S.image)||((g=S==null?void 0:S.thumbnails)==null?void 0:g[S.selectedRatio])||null;case z.IMAGE_OUTPUT:return r(w.id,0)||(w.value.startsWith("data:")?w.value:null);case z.IMAGE_EDITOR:return C?v.outputImage:r(w.id,0)||v.outputImage||null}}catch{if(w.type===z.IMAGE_INPUT&&w.value.startsWith("data:image"))return w.value}return null},[o,t,r]),d=y.useMemo(()=>{const h=t.filter(w=>{const f=o.find(g=>g.id===w.toNodeId);return f?f.type===z.IMAGE_EDITOR&&w.toHandleId==="image"||f.type===z.IMAGE_ANALYZER:!1}),k=h.map(w=>{const f=o.find(g=>g.id===w.fromNodeId);return`${w.id}:${f==null?void 0:f.id}:${Yh((f==null?void 0:f.value)||"")}`}).join("|");if(k===i.current.signature)return i.current.data;const C=new Map;return h.forEach(w=>{C.has(w.toNodeId)||C.set(w.toNodeId,[]),C.get(w.toNodeId).push(c(w.fromNodeId,w.fromHandleId,new Set,!1))}),i.current={signature:k,data:C},C},[t,o,c]),u=y.useMemo(()=>{const h=o.filter(g=>g.type===z.IMAGE_SEQUENCE_GENERATOR),C=t.filter(g=>h.some(v=>v.id===g.toNodeId)&&g.toHandleId==="character_data").map(g=>{const v=o.find(_=>_.id===g.fromNodeId);return`${g.id}:${v==null?void 0:v.id}:${Yh((v==null?void 0:v.value)||"")}`}).join("|");if(C===a.current.signature)return a.current.data;const w=(g,v,_=new Set)=>{if(_.has(g))return[];_.add(g);const S=t.filter(P=>P.toNodeId===g&&(v===void 0||P.toHandleId===v)),T=[];for(const P of S){const R=o.find(D=>D.id===P.fromNodeId);R&&(R.type===z.REROUTE_DOT?T.push(...w(R.id,void 0,_)):Kn(R,P.fromHandleId)==="character_data"&&T.push({node:R,handleId:P.fromHandleId,connectionId:P.id}))}return T},f=new Map;return h.forEach(g=>{const v=w(g.id,"character_data");if(v.length>0){const _=[],S=new Set;v.forEach(T=>{var D,q;const P=T.node,R=`${P.id}:${T.handleId||"default"}`;if(!S.has(R)){S.add(R);try{const O=JSON.parse(P.value);if(P.type===z.CHARACTER_GENERATOR){const E=(D=T.handleId)==null?void 0:D.match(/character-(\d+)/),A=E?parseInt(E[1],10):-1;if(A>=0&&((q=O.characters)!=null&&q[A])){const N=O.characters[A];_.push({name:N.name,alias:N.index||N.alias,prompt:N.prompt,fullDescription:N.fullDescription,image:N.imageBase64?`data:image/png;base64,${N.imageBase64}`:null,_sourceNodeId:P.id,_connectionId:T.connectionId})}}else if(P.type===z.CHARACTER_CARD){const E=Array.isArray(O)?O:[O],A=T.handleId;let N=[];if(A==="all_data")N=E.map((j,L)=>({data:j,originalIndex:L})).filter(j=>j.data.isActive!==!1);else if(A==="primary_data"){const j=E.find(L=>L.isOutput)||E[0];if(j&&j.isActive!==!1){const L=E.indexOf(j);N=[{data:j,originalIndex:L}]}}else if(A&&A.startsWith("char_")){const j=parseInt(A.split("_")[1]);E[j]&&E[j].isActive!==!1&&(N=[{data:E[j],originalIndex:j}])}else N=E.map((j,L)=>({data:j,originalIndex:L})).filter(j=>j.data.isActive!==!1);N.forEach(({data:j,originalIndex:L})=>{if(!j)return;const M=j.thumbnails?{...j.thumbnails}:j.imageSources||{};Object.entries(Wt).forEach(([V,H])=>{const F=r(P.id,L*10+H);F&&(M[V]=F)}),_.push({...j,alias:j.index||j.alias,imageSources:M,nodeTitle:P.title,_sourceNodeId:P.id,_connectionId:T.connectionId,_fullResImage:r(P.id,L*10)})})}}catch{}}}),_.length>0&&f.set(g.id,_)}}),a.current={signature:C,data:f},f},[t,o,r]),p=y.useCallback((h,x,k,C=!1)=>{var v,_,S;const w=k||o,f=t.filter(T=>T.toNodeId===h&&(x===void 0||T.toHandleId===x)),g=[];for(const T of f){const P=w.find(D=>D.id===T.fromNodeId);if(!P)continue;if(P.type===z.REROUTE_DOT){g.push(...p(P.id,void 0,w,C));continue}const R=Kn(P,T.fromHandleId);if(R==="character_data")try{const D=JSON.parse(P.value||"{}");if(P.type===z.CHARACTER_GENERATOR&&((v=T.fromHandleId)!=null&&v.startsWith("character-"))){const q=parseInt(T.fromHandleId.split("-")[1]);D.characters&&D.characters[q]&&g.push(D.characters[q])}else if(P.type===z.CHARACTER_CARD){const q=Array.isArray(D)?D:[D];T.fromHandleId==="all_data"?g.push(q.filter(O=>O.isActive!==!1)):g.push(D)}else g.push(D)}catch{g.push(P.value)}else if(R==="text")try{const D=JSON.parse(P.value||"{}");if(P.type===z.PROMPT_ANALYZER&&T.fromHandleId)if(T.fromHandleId.startsWith("character-")){const q=parseInt(T.fromHandleId.split("-")[1],10);g.push(((_=D.characters)==null?void 0:_[q])||"")}else g.push(D[T.fromHandleId]||"");else if(P.type===z.IMAGE_INPUT&&T.fromHandleId==="text")g.push(D.prompt||"");else if(P.type===z.IMAGE_ANALYZER&&T.fromHandleId==="text")g.push(D.description||"");else if(P.type===z.CHARACTER_CARD){const q=Array.isArray(D)?D:[D],O=q.find(E=>E.isOutput)||q[0];if(!(O&&O.isActive===!1)){const E=(O==null?void 0:O.fullDescription)||"";T.fromHandleId==="prompt"?g.push((O==null?void 0:O.prompt)||""):T.fromHandleId==="appearance"?g.push(Wc(E,"Appearance")):T.fromHandleId==="personality"?g.push(Wc(E,"Personality")):T.fromHandleId==="clothing"?g.push(Wc(E,"Clothing")):g.push(P.value)}}else g.push(P.value)}catch{g.push(P.value)}else if(R==="image"){if(P.type===z.IMAGE_SEQUENCE_GENERATOR)try{const q=JSON.parse(P.value),O=q.checkedFrameNumbers||[],E=q.images||{};if(O.forEach(A=>{var j;const N=r(P.id,1e3+A)||E[A];if(N&&N.startsWith("data:")){const L=N.split(","),M=((j=N.match(/:(.*?);/))==null?void 0:j[1])||"image/png";g.push({base64ImageData:L[1],mimeType:M})}}),O.length>0)continue}catch{}const D=c(T.fromNodeId,T.fromHandleId,new Set,C);if(D&&D.startsWith("data:")){const q=D.split(","),O=((S=D.match(/:(.*?);/))==null?void 0:S[1])||"image/png";g.push({base64ImageData:q[1],mimeType:O})}}else if(P.type===z.MEDIA_VIEWER)try{const D=JSON.parse(P.value||"{}");D.src&&g.push(D.src)}catch{g.push(P.value)}else g.push(P.value)}return g},[o,t,c,r]);return{connectedInputs:s,connectedImageSources:d,connectedCharacterData:u,connectedInputTypes:l,getConnectionPoints:Tx,getUpstreamNodeValues:p}},CC=e=>{const{onAddNode:t,handleValueChange:o,handleRenameNode:r,setFullSizeImage:a,getTransformedPoint:i,handleLoadCanvasIntoCurrentTab:s,setError:l,pasteGroup:c,t:d,handleAddGroupFromCatalog:u,libraryItems:p,setNodes:h,setConfirmInfo:x}=e,k=y.useRef(0),C=_=>{const S=document.getElementById("app-container");S&&(_?S.classList.add("ring-2","ring-cyan-500","ring-inset"):S.classList.remove("ring-2","ring-cyan-500","ring-inset"))};y.useEffect(()=>{const _=S=>{S.type==="dragleave"&&S.relatedTarget||(k.current=0,C(!1))};return window.addEventListener("dragend",_),window.addEventListener("dragleave",_),()=>{window.removeEventListener("dragend",_),window.removeEventListener("dragleave",_)}},[]);const w=y.useCallback(_=>{if(_.dataTransfer.types.includes("application/prompt-modifier-card"))return;const S=_.target;(S.id==="app-container"||S.id==="canvas-transform-layer")&&(_.preventDefault(),_.stopPropagation(),k.current+=1,k.current===1&&C(!0))},[]),f=y.useCallback(_=>{if(_.dataTransfer.types.includes("application/prompt-modifier-card"))return;const S=_.target;(S.id==="app-container"||S.id==="canvas-transform-layer")&&(_.preventDefault(),_.stopPropagation(),k.current-=1,k.current<=0&&(k.current=0,C(!1)))},[]),g=y.useCallback(_=>{_.target.closest(".node-view")||(_.preventDefault(),_.stopPropagation(),_.dataTransfer.dropEffect="copy")},[]);return{handleDrop:y.useCallback(_=>{if(_.dataTransfer.types.includes("application/prompt-modifier-card"))return;_.preventDefault(),_.stopPropagation(),k.current=0,C(!1);const S=i({x:_.clientX,y:_.clientY}),T=_.dataTransfer.getData("application/prompt-modifier-drag-image");if(T){const D=t(z.IMAGE_INPUT,S);a(D,0,T),ml(T).then(q=>{Lt(T,256,256).then(O=>{o(D,JSON.stringify({image:O,prompt:q||""}))})});return}const P=_.dataTransfer.getData("application/prompt-modifier-drag-item");if(P){try{const D=JSON.parse(P);if(D.type==="catalog-group"){u&&u(D.itemId,S);return}if(D.type==="library-prompt"){const q=p.find(O=>O.id===D.itemId);q&&t(z.TEXT_INPUT,S,void 0,{centerNode:!0,initialValue:q.content||""});return}if(D.type==="content-catalog-item"){const q=D.itemType;let O=null,E="";switch(q){case"CHARACTER":O=z.CHARACTER_CARD;let A;try{A=JSON.parse(D.content||"{}")}catch{A={}}if(Array.isArray(A))E=JSON.stringify(A);else{A.image&&typeof A.image=="string"&&!A.image.startsWith("data:")&&(A.image=`data:image/png;base64,${A.image}`);const ee=A.index||A.alias||"Entity-1",ie={...A,index:ee};ie.alias&&delete ie.alias,E=JSON.stringify([ie])}break;case"SCRIPT":O=z.SCRIPT_VIEWER,E=D.content||"{}";break;case"PROMPT_SEQUENCE":O=z.PROMPT_SEQUENCE_EDITOR;const N={id:"",type:z.PROMPT_SEQUENCE_EDITOR,position:{x:0,y:0},title:"",value:"",width:0,height:0},j=Gi(N),L=JSON.parse(j),M=JSON.parse(D.content||"{}");let V=[],H=[],F="",G=[];M.type==="script-prompt-modifier-data"?(V=M.finalPrompts||M.prompts||[],H=M.videoPrompts||[],F=M.styleOverride||"",G=M.usedCharacters||[]):Array.isArray(M)?V=M:M.prompts&&(V=M.prompts);const B=new Map(H.map(ee=>[ee.frameNumber,ee])),Y=V.map((ee,ie)=>{const ce=ee.frameNumber!==void 0?ee.frameNumber:ie+1,pe=B.get(ce);let ue=ee.characters||[];const re=ee.prompt||(typeof ee=="string"?ee:"");if(ue.length===0&&re){const $=re.match(/(?:character|entity)-\d+/gi)||[];ue=[...new Set($.map(Z=>Z.toLowerCase().replace(/character-/i,"Entity-").replace(/entity-/i,"Entity-")))]}return{frameNumber:ce,sceneNumber:ee.sceneNumber||1,sceneTitle:ee.sceneTitle||"",prompt:re,videoPrompt:(pe==null?void 0:pe.videoPrompt)||ee.videoPrompt||"",shotType:ee.shotType||ee.ShotType||(pe==null?void 0:pe.shotType)||"WS",characters:ue,isCollapsed:!0,duration:ee.duration||3}});E=JSON.stringify({...L,sourcePrompts:Y,styleOverride:F,usedCharacters:G});break}if(O){const A=t(O,S,void 0,{centerNode:!0,initialValue:E});if(q==="CHARACTER")try{let N=JSON.parse(D.content||"{}");const j=Array.isArray(N)?N[0]:N;if(j!=null&&j.nodeTitle&&r(A,j.nodeTitle),Array.isArray(N)&&h){const M=N.length*Yd+Xd;h(V=>V.map(H=>H.id===A?{...H,width:M}:H))}(Array.isArray(N)?N:[N]).forEach((M,V)=>{if(M.imageSources){Object.entries(M.imageSources).forEach(([G,B])=>{const Y=Wt[G];Y&&typeof B=="string"&&B.startsWith("data:")&&a(A,V*10+Y,B)});const H=M.selectedRatio||"1:1",F=M.imageSources[H];F&&typeof F=="string"&&F.startsWith("data:")&&a(A,V*10,F)}})}catch(N){console.error("Failed to restore character images",N)}}}}catch(D){console.error("Error parsing drag data",D)}return}const R=Array.from(_.dataTransfer.files);if(R.length>0){let D=0,q=0;R.forEach(O=>{const E={x:S.x+D,y:S.y+q};if(O.type.startsWith("image/")){const A=new FileReader;A.onload=async N=>{var L;const j=(L=N.target)==null?void 0:L.result;if(j){const M=t(z.IMAGE_INPUT,E);a(M,0,j);const V=await ml(j);Lt(j,256,256).then(H=>{o(M,JSON.stringify({image:H,prompt:V||""}))})}},A.readAsDataURL(O),D+=30,q+=30}else if(O.type==="application/json"||O.name.endsWith(".json")){const A=new FileReader;A.onload=async N=>{var L;const j=(L=N.target)==null?void 0:L.result;try{const M=JSON.parse(j);if(M.type==="script-modifier-project"||M.type==="script-modifier-canvas"){l&&l(d("error.scriptModifierCanvas"));return}if(M.type==="gemini-chat-history"||M.messages&&Array.isArray(M.messages)&&!M.nodes){const V=t(z.GEMINI_CHAT,E),H=JSON.stringify({messages:M.messages||[],currentInput:M.currentInput||"",style:M.style||"general",attachment:M.attachment||null});o(V,H);return}if(M.type==="prompModifierGroup"||M.root&&M.root.type==="prompModifierGroup"){c&&c(M.root||M,E);return}if(M.type==="prompt-modifier-canvas"||M.type==="prompt-modifier-project"||Array.isArray(M.nodes)&&Array.isArray(M.connections)){if(s){const V=()=>s(j);if(x){const H=M.type==="prompt-modifier-project";x({title:d("dialog.confirmLoad.title"),message:d("dialog.confirmLoad.message")+(H?" (Loading Project)":""),onConfirm:V})}else V()}}else{const V=B=>B&&(B.type==="character-card"||B.name&&B.imageSources);let H=null,F=!1;if(Array.isArray(M)?M.length>0&&V(M[0])&&(H=M,F=!0):V(M)&&(H=[M],F=!1),H){const B=H[0].nodeTitle||H[0].title||(F?"Character Cards":"Character Card"),Y=t(z.CHARACTER_CARD,E,B);if(F&&h){const ie=H.length*Yd+Xd;h(ce=>ce.map(pe=>pe.id===Y?{...pe,width:ie}:pe))}const ee=await Promise.all(H.map(async(ie,ce)=>{const pe=ie.imageSources||{};ie.image&&!ie.imageSources&&(pe["1:1"]=ie.image);const ue={"1:1":null,"16:9":null,"9:16":null};for(const[Z,te]of Object.entries(pe))if(typeof te=="string"&&te.startsWith("data:")){const ae=Wt[Z];ae&&a(Y,ce*10+ae,te),ue[Z]=await Lt(te,256,256)}else ue[Z]=te;const re=ie.selectedRatio||"1:1",$=pe[re];return $&&typeof $=="string"&&$.startsWith("data:")&&a(Y,ce*10,$),{...ie,image:ue[re],thumbnails:ue,index:ie.index||ie.alias||`Entity-${ce+1}`}}));o(Y,JSON.stringify(ee));return}if(M.type==="script-prompt-modifier-data"||M.finalPrompts&&Array.isArray(M.finalPrompts)){const B=t(z.PROMPT_SEQUENCE_EDITOR,E),Y=M.finalPrompts||M.prompts||[],ee=M.videoPrompts||[],ie=new Map(ee.map(ue=>[ue.frameNumber,ue])),ce=Y.map((ue,re)=>{const $=ue.frameNumber!==void 0?ue.frameNumber:re+1,Z=ie.get($);let te=ue.characters||[];const ae=ue.prompt||"";if(te.length===0&&ae){const I=ae.match(/(?:character|entity)-\d+/gi)||[];te=[...new Set(I.map(J=>J.toLowerCase().replace(/character-/i,"Entity-").replace(/entity-/i,"Entity-")))]}return{frameNumber:$,sceneNumber:ue.sceneNumber||1,sceneTitle:ue.sceneTitle||"",prompt:ae,videoPrompt:(Z==null?void 0:Z.videoPrompt)||ue.videoPrompt||"",shotType:ue.shotType||ue.ShotType||(Z==null?void 0:Z.shotType)||"WS",characters:te,duration:ue.duration||3,isCollapsed:!0}}),pe=JSON.stringify({instruction:"",sourcePrompts:ce,modifiedPrompts:[],checkedSourceFrameNumbers:[],selectedFrameNumber:null,styleOverride:M.styleOverride||"",usedCharacters:M.usedCharacters||[],sceneContexts:M.sceneContexts||{},leftPaneRatio:.5});o(B,pe);return}if(M.type==="script-generator-data"||M.type==="script-analyzer-data"||M.characters&&M.scenes){const B=t(z.SCRIPT_VIEWER,E);M.type||(M.type="script-analyzer-data"),o(B,JSON.stringify(M));return}const G=t(z.TEXT_INPUT,E);o(G,JSON.stringify(M,null,2))}}catch{l&&l("Failed to parse JSON file.")}},A.readAsText(O),D+=30,q+=30}else if(O.type.startsWith("text/")){const A=new FileReader;A.onload=N=>{var j;return t(z.TEXT_INPUT,E,void 0,{centerNode:!0,initialValue:(j=N.target)==null?void 0:j.result})},A.readAsText(O),D+=30,q+=30}})}},[t,o,r,a,i,s,l,c,d,u,p,h,x]),handleDragOver:g,handleDragLeave:f,handleDragEnter:w}};var kC={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let _C,SC;function NC(){return{geminiUrl:_C,vertexUrl:SC}}function EC(e,t,o,r){var a,i;if(!(e!=null&&e.baseUrl)){const s=NC();return t?(a=s.vertexUrl)!==null&&a!==void 0?a:o:(i=s.geminiUrl)!==null&&i!==void 0?i:r}return e.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Jo{}function it(e,t){const o=/\{([^}]+)\}/g;return e.replace(o,(r,a)=>{if(Object.prototype.hasOwnProperty.call(t,a)){const i=t[a];return i!=null?String(i):""}else throw new Error(`Key '${a}' not found in valueMap.`)})}function b(e,t,o){for(let i=0;i<t.length-1;i++){const s=t[i];if(s.endsWith("[]")){const l=s.slice(0,-2);if(!(l in e))if(Array.isArray(o))e[l]=Array.from({length:o.length},()=>({}));else throw new Error(`Value must be a list given an array path ${s}`);if(Array.isArray(e[l])){const c=e[l];if(Array.isArray(o))for(let d=0;d<c.length;d++){const u=c[d];b(u,t.slice(i+1),o[d])}else for(const d of c)b(d,t.slice(i+1),o)}return}else if(s.endsWith("[0]")){const l=s.slice(0,-3);l in e||(e[l]=[{}]);const c=e[l];b(c[0],t.slice(i+1),o);return}(!e[s]||typeof e[s]!="object")&&(e[s]={}),e=e[s]}const r=t[t.length-1],a=e[r];if(a!==void 0){if(!o||typeof o=="object"&&Object.keys(o).length===0||o===a)return;if(typeof a=="object"&&typeof o=="object"&&a!==null&&o!==null)Object.assign(a,o);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof o=="object"&&o!==null&&!Array.isArray(o)?Object.assign(e,o):e[r]=o}function m(e,t,o=void 0){try{if(t.length===1&&t[0]==="_self")return e;for(let r=0;r<t.length;r++){if(typeof e!="object"||e===null)return o;const a=t[r];if(a.endsWith("[]")){const i=a.slice(0,-2);if(i in e){const s=e[i];return Array.isArray(s)?s.map(l=>m(l,t.slice(r+1),o)):o}else return o}else e=e[a]}return e}catch(r){if(r instanceof TypeError)return o;throw r}}function PC(e,t){for(const[o,r]of Object.entries(t)){const a=o.split("."),i=r.split("."),s=new Set;let l=-1;for(let c=0;c<a.length;c++)if(a[c]==="*"){l=c;break}if(l!==-1&&i.length>l)for(let c=l;c<i.length;c++){const d=i[c];d!=="*"&&!d.endsWith("[]")&&!d.endsWith("[0]")&&s.add(d)}Zd(e,a,i,0,s)}}function Zd(e,t,o,r,a){if(r>=t.length||typeof e!="object"||e===null)return;const i=t[r];if(i.endsWith("[]")){const s=i.slice(0,-2),l=e;if(s in l&&Array.isArray(l[s]))for(const c of l[s])Zd(c,t,o,r+1,a)}else if(i==="*"){if(typeof e=="object"&&e!==null&&!Array.isArray(e)){const s=e,l=Object.keys(s).filter(d=>!d.startsWith("_")&&!a.has(d)),c={};for(const d of l)c[d]=s[d];for(const[d,u]of Object.entries(c)){const p=[];for(const h of o.slice(r))h==="*"?p.push(d):p.push(h);b(s,p,u)}for(const d of l)delete s[d]}}else{const s=e;i in s&&Zd(s[i],t,o,r+1,a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function gp(e){if(typeof e!="string")throw new Error("fromImageBytes must be a string");return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function TC(e){const t={},o=m(e,["operationName"]);o!=null&&b(t,["operationName"],o);const r=m(e,["resourceName"]);return r!=null&&b(t,["_url","resourceName"],r),t}function IC(e){const t={},o=m(e,["name"]);o!=null&&b(t,["name"],o);const r=m(e,["metadata"]);r!=null&&b(t,["metadata"],r);const a=m(e,["done"]);a!=null&&b(t,["done"],a);const i=m(e,["error"]);i!=null&&b(t,["error"],i);const s=m(e,["response","generateVideoResponse"]);return s!=null&&b(t,["response"],AC(s)),t}function jC(e){const t={},o=m(e,["name"]);o!=null&&b(t,["name"],o);const r=m(e,["metadata"]);r!=null&&b(t,["metadata"],r);const a=m(e,["done"]);a!=null&&b(t,["done"],a);const i=m(e,["error"]);i!=null&&b(t,["error"],i);const s=m(e,["response"]);return s!=null&&b(t,["response"],MC(s)),t}function AC(e){const t={},o=m(e,["generatedSamples"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>RC(s))),b(t,["generatedVideos"],i)}const r=m(e,["raiMediaFilteredCount"]);r!=null&&b(t,["raiMediaFilteredCount"],r);const a=m(e,["raiMediaFilteredReasons"]);return a!=null&&b(t,["raiMediaFilteredReasons"],a),t}function MC(e){const t={},o=m(e,["videos"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>LC(s))),b(t,["generatedVideos"],i)}const r=m(e,["raiMediaFilteredCount"]);r!=null&&b(t,["raiMediaFilteredCount"],r);const a=m(e,["raiMediaFilteredReasons"]);return a!=null&&b(t,["raiMediaFilteredReasons"],a),t}function RC(e){const t={},o=m(e,["video"]);return o!=null&&b(t,["video"],BC(o)),t}function LC(e){const t={},o=m(e,["_self"]);return o!=null&&b(t,["video"],GC(o)),t}function DC(e){const t={},o=m(e,["operationName"]);return o!=null&&b(t,["_url","operationName"],o),t}function zC(e){const t={},o=m(e,["operationName"]);return o!=null&&b(t,["_url","operationName"],o),t}function qC(e){const t={},o=m(e,["name"]);o!=null&&b(t,["name"],o);const r=m(e,["metadata"]);r!=null&&b(t,["metadata"],r);const a=m(e,["done"]);a!=null&&b(t,["done"],a);const i=m(e,["error"]);i!=null&&b(t,["error"],i);const s=m(e,["response"]);return s!=null&&b(t,["response"],OC(s)),t}function OC(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["parent"]);r!=null&&b(t,["parent"],r);const a=m(e,["documentName"]);return a!=null&&b(t,["documentName"],a),t}function Lx(e){const t={},o=m(e,["name"]);o!=null&&b(t,["name"],o);const r=m(e,["metadata"]);r!=null&&b(t,["metadata"],r);const a=m(e,["done"]);a!=null&&b(t,["done"],a);const i=m(e,["error"]);i!=null&&b(t,["error"],i);const s=m(e,["response"]);return s!=null&&b(t,["response"],FC(s)),t}function FC(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["parent"]);r!=null&&b(t,["parent"],r);const a=m(e,["documentName"]);return a!=null&&b(t,["documentName"],a),t}function BC(e){const t={},o=m(e,["uri"]);o!=null&&b(t,["uri"],o);const r=m(e,["encodedVideo"]);r!=null&&b(t,["videoBytes"],gp(r));const a=m(e,["encoding"]);return a!=null&&b(t,["mimeType"],a),t}function GC(e){const t={},o=m(e,["gcsUri"]);o!=null&&b(t,["uri"],o);const r=m(e,["bytesBase64Encoded"]);r!=null&&b(t,["videoBytes"],gp(r));const a=m(e,["mimeType"]);return a!=null&&b(t,["mimeType"],a),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Xh;(function(e){e.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",e.OUTCOME_OK="OUTCOME_OK",e.OUTCOME_FAILED="OUTCOME_FAILED",e.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Xh||(Xh={}));var Zh;(function(e){e.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",e.PYTHON="PYTHON"})(Zh||(Zh={}));var Qh;(function(e){e.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",e.SILENT="SILENT",e.WHEN_IDLE="WHEN_IDLE",e.INTERRUPT="INTERRUPT"})(Qh||(Qh={}));var gt;(function(e){e.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",e.STRING="STRING",e.NUMBER="NUMBER",e.INTEGER="INTEGER",e.BOOLEAN="BOOLEAN",e.ARRAY="ARRAY",e.OBJECT="OBJECT",e.NULL="NULL"})(gt||(gt={}));var em;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(em||(em={}));var tm;(function(e){e.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",e.SIMPLE_SEARCH="SIMPLE_SEARCH",e.ELASTIC_SEARCH="ELASTIC_SEARCH"})(tm||(tm={}));var nm;(function(e){e.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",e.NO_AUTH="NO_AUTH",e.API_KEY_AUTH="API_KEY_AUTH",e.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",e.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",e.OAUTH="OAUTH",e.OIDC_AUTH="OIDC_AUTH"})(nm||(nm={}));var om;(function(e){e.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",e.HTTP_IN_QUERY="HTTP_IN_QUERY",e.HTTP_IN_HEADER="HTTP_IN_HEADER",e.HTTP_IN_PATH="HTTP_IN_PATH",e.HTTP_IN_BODY="HTTP_IN_BODY",e.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(om||(om={}));var rm;(function(e){e.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",e.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",e.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",e.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(rm||(rm={}));var am;(function(e){e.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH",e.MINIMAL="MINIMAL"})(am||(am={}));var im;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",e.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",e.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",e.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",e.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(im||(im={}));var sm;(function(e){e.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",e.SEVERITY="SEVERITY",e.PROBABILITY="PROBABILITY"})(sm||(sm={}));var lm;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE",e.OFF="OFF"})(lm||(lm={}));var cm;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.IMAGE_SAFETY="IMAGE_SAFETY",e.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",e.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",e.NO_IMAGE="NO_IMAGE",e.IMAGE_RECITATION="IMAGE_RECITATION",e.IMAGE_OTHER="IMAGE_OTHER"})(cm||(cm={}));var dm;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(dm||(dm={}));var um;(function(e){e.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",e.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",e.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",e.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",e.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(um||(um={}));var pm;(function(e){e.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",e.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",e.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",e.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",e.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(pm||(pm={}));var hm;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.IMAGE_SAFETY="IMAGE_SAFETY",e.MODEL_ARMOR="MODEL_ARMOR",e.JAILBREAK="JAILBREAK"})(hm||(hm={}));var mm;(function(e){e.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",e.ON_DEMAND="ON_DEMAND",e.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(mm||(mm={}));var za;(function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.AUDIO="AUDIO"})(za||(za={}));var gm;(function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(gm||(gm={}));var fm;(function(e){e.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",e.TUNING_MODE_FULL="TUNING_MODE_FULL",e.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(fm||(fm={}));var xm;(function(e){e.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",e.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",e.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",e.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",e.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",e.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",e.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(xm||(xm={}));var Qd;(function(e){e.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",e.JOB_STATE_QUEUED="JOB_STATE_QUEUED",e.JOB_STATE_PENDING="JOB_STATE_PENDING",e.JOB_STATE_RUNNING="JOB_STATE_RUNNING",e.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",e.JOB_STATE_FAILED="JOB_STATE_FAILED",e.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",e.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",e.JOB_STATE_PAUSED="JOB_STATE_PAUSED",e.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",e.JOB_STATE_UPDATING="JOB_STATE_UPDATING",e.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Qd||(Qd={}));var ym;(function(e){e.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",e.TUNING_TASK_I2V="TUNING_TASK_I2V",e.TUNING_TASK_T2V="TUNING_TASK_T2V",e.TUNING_TASK_R2V="TUNING_TASK_R2V"})(ym||(ym={}));var vm;(function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",e.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(vm||(vm={}));var wm;(function(e){e.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",e.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",e.BALANCED="BALANCED",e.PRIORITIZE_COST="PRIORITIZE_COST"})(wm||(wm={}));var bm;(function(e){e.UNSPECIFIED="UNSPECIFIED",e.BLOCKING="BLOCKING",e.NON_BLOCKING="NON_BLOCKING"})(bm||(bm={}));var Cm;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(Cm||(Cm={}));var km;(function(e){e.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",e.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(km||(km={}));var _m;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE",e.VALIDATED="VALIDATED"})(_m||(_m={}));var Sm;(function(e){e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(Sm||(Sm={}));var Nm;(function(e){e.DONT_ALLOW="DONT_ALLOW",e.ALLOW_ADULT="ALLOW_ADULT",e.ALLOW_ALL="ALLOW_ALL"})(Nm||(Nm={}));var Em;(function(e){e.auto="auto",e.en="en",e.ja="ja",e.ko="ko",e.hi="hi",e.zh="zh",e.pt="pt",e.es="es"})(Em||(Em={}));var Pm;(function(e){e.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",e.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",e.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",e.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",e.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Pm||(Pm={}));var Tm;(function(e){e.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",e.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",e.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",e.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Tm||(Tm={}));var Im;(function(e){e.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",e.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",e.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",e.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Im||(Im={}));var jm;(function(e){e.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",e.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",e.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",e.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",e.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",e.EDIT_MODE_STYLE="EDIT_MODE_STYLE",e.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",e.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(jm||(jm={}));var Am;(function(e){e.FOREGROUND="FOREGROUND",e.BACKGROUND="BACKGROUND",e.PROMPT="PROMPT",e.SEMANTIC="SEMANTIC",e.INTERACTIVE="INTERACTIVE"})(Am||(Am={}));var Mm;(function(e){e.ASSET="ASSET",e.STYLE="STYLE"})(Mm||(Mm={}));var Rm;(function(e){e.INSERT="INSERT",e.REMOVE="REMOVE",e.REMOVE_STATIC="REMOVE_STATIC",e.OUTPAINT="OUTPAINT"})(Rm||(Rm={}));var Lm;(function(e){e.OPTIMIZED="OPTIMIZED",e.LOSSLESS="LOSSLESS"})(Lm||(Lm={}));var Dm;(function(e){e.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",e.PREFERENCE_TUNING="PREFERENCE_TUNING"})(Dm||(Dm={}));var zm;(function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.STATE_PENDING="STATE_PENDING",e.STATE_ACTIVE="STATE_ACTIVE",e.STATE_FAILED="STATE_FAILED"})(zm||(zm={}));var qm;(function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.PROCESSING="PROCESSING",e.ACTIVE="ACTIVE",e.FAILED="FAILED"})(qm||(qm={}));var Om;(function(e){e.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",e.UPLOADED="UPLOADED",e.GENERATED="GENERATED"})(Om||(Om={}));var Fm;(function(e){e.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.RESPONSE_REJECTED="RESPONSE_REJECTED",e.NEED_MORE_INPUT="NEED_MORE_INPUT"})(Fm||(Fm={}));var Bm;(function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.DOCUMENT="DOCUMENT"})(Bm||(Bm={}));var Gm;(function(e){e.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",e.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",e.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(Gm||(Gm={}));var Hm;(function(e){e.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",e.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",e.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Hm||(Hm={}));var Um;(function(e){e.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",e.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",e.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Um||(Um={}));var Vm;(function(e){e.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",e.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",e.NO_INTERRUPTION="NO_INTERRUPTION"})(Vm||(Vm={}));var Wm;(function(e){e.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",e.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",e.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Wm||(Wm={}));var $m;(function(e){e.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",e.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",e.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",e.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",e.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",e.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",e.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",e.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",e.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",e.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",e.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",e.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",e.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})($m||($m={}));var Km;(function(e){e.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",e.QUALITY="QUALITY",e.DIVERSITY="DIVERSITY",e.VOCALIZATION="VOCALIZATION"})(Km||(Km={}));var fa;(function(e){e.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",e.PLAY="PLAY",e.PAUSE="PAUSE",e.STOP="STOP",e.RESET_CONTEXT="RESET_CONTEXT"})(fa||(fa={}));class eu{constructor(t){const o={};for(const r of t.headers.entries())o[r[0]]=r[1];this.headers=o,this.responseInternal=t}json(){return this.responseInternal.json()}}class ei{get text(){var t,o,r,a,i,s,l,c;if(((a=(r=(o=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||o===void 0?void 0:o.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",u=!1;const p=[];for(const h of(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)!==null&&c!==void 0?c:[]){for(const[x,k]of Object.entries(h))x!=="text"&&x!=="thought"&&x!=="thoughtSignature"&&(k!==null||k!==void 0)&&p.push(x);if(typeof h.text=="string"){if(typeof h.thought=="boolean"&&h.thought)continue;u=!0,d+=h.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?d:void 0}get data(){var t,o,r,a,i,s,l,c;if(((a=(r=(o=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||o===void 0?void 0:o.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="";const u=[];for(const p of(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)!==null&&c!==void 0?c:[]){for(const[h,x]of Object.entries(p))h!=="inlineData"&&(x!==null||x!==void 0)&&u.push(h);p.inlineData&&typeof p.inlineData.data=="string"&&(d+=atob(p.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var t,o,r,a,i,s,l,c;if(((a=(r=(o=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||o===void 0?void 0:o.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(u=>u.functionCall).map(u=>u.functionCall).filter(u=>u!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var t,o,r,a,i,s,l,c,d;if(((a=(r=(o=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||o===void 0?void 0:o.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const u=(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((u==null?void 0:u.length)!==0)return(d=u==null?void 0:u[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var t,o,r,a,i,s,l,c,d;if(((a=(r=(o=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||o===void 0?void 0:o.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const u=(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((u==null?void 0:u.length)!==0)return(d=u==null?void 0:u[0])===null||d===void 0?void 0:d.output}}class Jm{}class Ym{}class HC{}class UC{}class VC{}class WC{}class Xm{}class Zm{}class Qm{}class $C{}class xl{_fromAPIResponse({apiResponse:t,_isVertexAI:o}){const r=new xl;let a;const i=t;return o?a=jC(i):a=IC(i),Object.assign(r,a),r}}class eg{}class tg{}class ng{}class og{}class KC{}class JC{}class YC{}class fp{_fromAPIResponse({apiResponse:t,_isVertexAI:o}){const r=new fp,i=qC(t);return Object.assign(r,i),r}}class XC{}class ZC{}class QC{}class rg{}class e5{get text(){var t,o,r;let a="",i=!1;const s=[];for(const l of(r=(o=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||o===void 0?void 0:o.parts)!==null&&r!==void 0?r:[]){for(const[c,d]of Object.entries(l))c!=="text"&&c!=="thought"&&d!==null&&s.push(c);if(typeof l.text=="string"){if(typeof l.thought=="boolean"&&l.thought)continue;i=!0,a+=l.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),i?a:void 0}get data(){var t,o,r;let a="";const i=[];for(const s of(r=(o=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||o===void 0?void 0:o.parts)!==null&&r!==void 0?r:[]){for(const[l,c]of Object.entries(s))l!=="inlineData"&&c!==null&&i.push(l);s.inlineData&&typeof s.inlineData.data=="string"&&(a+=atob(s.inlineData.data))}return i.length>0&&console.warn(`there are non-data parts ${i} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),a.length>0?btoa(a):void 0}}class t5{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class xp{_fromAPIResponse({apiResponse:t,_isVertexAI:o}){const r=new xp,i=Lx(t);return Object.assign(r,i),r}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zt(e,t){if(!t||typeof t!="string")throw new Error("model is required and must be a string");if(t.includes("..")||t.includes("?")||t.includes("&"))throw new Error("invalid model parameter");if(e.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(t.indexOf("/")>=0){const o=t.split("/",2);return`publishers/${o[0]}/models/${o[1]}`}else return`publishers/google/models/${t}`}else return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function Dx(e,t){const o=zt(e,t);return o?o.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${o}`:o.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${o}`:o:""}function zx(e){return Array.isArray(e)?e.map(t=>yl(t)):[yl(e)]}function yl(e){if(typeof e=="object"&&e!==null)return e;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function qx(e){const t=yl(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function Ox(e){const t=yl(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function ag(e){if(e==null)throw new Error("PartUnion is required");if(typeof e=="object")return e;if(typeof e=="string")return{text:e};throw new Error(`Unsupported part type: ${typeof e}`)}function Fx(e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("PartListUnion is required");return Array.isArray(e)?e.map(t=>ag(t)):[ag(e)]}function tu(e){return e!=null&&typeof e=="object"&&"parts"in e&&Array.isArray(e.parts)}function ig(e){return e!=null&&typeof e=="object"&&"functionCall"in e}function sg(e){return e!=null&&typeof e=="object"&&"functionResponse"in e}function En(e){if(e==null)throw new Error("ContentUnion is required");return tu(e)?e:{role:"user",parts:Fx(e)}}function yp(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(o=>{const r=En(o);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(e.isVertexAI()){const o=En(t);return o.parts&&o.parts.length>0&&o.parts[0].text!==void 0?[o.parts[0].text]:[]}return Array.isArray(t)?t.map(o=>En(o)):[En(t)]}function ro(e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("contents are required");if(!Array.isArray(e)){if(ig(e)||sg(e))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[En(e)]}const t=[],o=[],r=tu(e[0]);for(const a of e){const i=tu(a);if(i!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(i)t.push(a);else{if(ig(a)||sg(a))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");o.push(a)}}return r||t.push({role:"user",parts:Fx(o)}),t}function n5(e,t){e.includes("null")&&(t.nullable=!0);const o=e.filter(r=>r!=="null");if(o.length===1)t.type=Object.values(gt).includes(o[0].toUpperCase())?o[0].toUpperCase():gt.TYPE_UNSPECIFIED;else{t.anyOf=[];for(const r of o)t.anyOf.push({type:Object.values(gt).includes(r.toUpperCase())?r.toUpperCase():gt.TYPE_UNSPECIFIED})}}function _a(e){const t={},o=["items"],r=["anyOf"],a=["properties"];if(e.type&&e.anyOf)throw new Error("type and anyOf cannot be both populated.");const i=e.anyOf;i!=null&&i.length==2&&(i[0].type==="null"?(t.nullable=!0,e=i[1]):i[1].type==="null"&&(t.nullable=!0,e=i[0])),e.type instanceof Array&&n5(e.type,t);for(const[s,l]of Object.entries(e))if(l!=null)if(s=="type"){if(l==="null")throw new Error("type: null can not be the only possible type for the field.");if(l instanceof Array)continue;t.type=Object.values(gt).includes(l.toUpperCase())?l.toUpperCase():gt.TYPE_UNSPECIFIED}else if(o.includes(s))t[s]=_a(l);else if(r.includes(s)){const c=[];for(const d of l){if(d.type=="null"){t.nullable=!0;continue}c.push(_a(d))}t[s]=c}else if(a.includes(s)){const c={};for(const[d,u]of Object.entries(l))c[d]=_a(u);t[s]=c}else{if(s==="additionalProperties")continue;t[s]=l}return t}function vp(e){return _a(e)}function wp(e){if(typeof e=="object")return e;if(typeof e=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw new Error(`Unsupported speechConfig type: ${typeof e}`)}function bp(e){if("multiSpeakerVoiceConfig"in e)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function Ga(e){if(e.functionDeclarations)for(const t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=_a(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=_a(t.response));return e}function Ha(e){if(e==null)throw new Error("tools is required");if(!Array.isArray(e))throw new Error("tools is required and must be an array of Tools");const t=[];for(const o of e)t.push(o);return t}function o5(e,t,o,r=1){const a=!t.startsWith(`${o}/`)&&t.split("/").length===r;return e.isVertexAI()?t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${e.getProject()}/${t}`:t.startsWith(`${o}/`)?`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`:a?`projects/${e.getProject()}/locations/${e.getLocation()}/${o}/${t}`:t:a?`${o}/${t}`:t}function Yo(e,t){if(typeof t!="string")throw new Error("name must be a string");return o5(e,t,"cachedContents")}function Bx(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function Sr(e){return gp(e)}function r5(e){return e!=null&&typeof e=="object"&&"name"in e}function a5(e){return e!=null&&typeof e=="object"&&"video"in e}function i5(e){return e!=null&&typeof e=="object"&&"uri"in e}function Gx(e){var t;let o;if(r5(e)&&(o=e.name),!(i5(e)&&(o=e.uri,o===void 0))&&!(a5(e)&&(o=(t=e.video)===null||t===void 0?void 0:t.uri,o===void 0))){if(typeof e=="string"&&(o=e),o===void 0)throw new Error("Could not extract file name from the provided input.");if(o.startsWith("https://")){const a=o.split("files/")[1].match(/[a-z0-9]+/);if(a===null)throw new Error(`Could not extract file name from URI ${o}`);o=a[0]}else o.startsWith("files/")&&(o=o.split("files/")[1]);return o}}function Hx(e,t){let o;return e.isVertexAI()?o=t?"publishers/google/models":"models":o=t?"models":"tunedModels",o}function Ux(e){for(const t of["models","tunedModels","publisherModels"])if(s5(e,t))return e[t];return[]}function s5(e,t){return e!==null&&typeof e=="object"&&t in e}function l5(e,t={}){const o=e,r={name:o.name,description:o.description,parametersJsonSchema:o.inputSchema};return o.outputSchema&&(r.responseJsonSchema=o.outputSchema),t.behavior&&(r.behavior=t.behavior),{functionDeclarations:[r]}}function c5(e,t={}){const o=[],r=new Set;for(const a of e){const i=a.name;if(r.has(i))throw new Error(`Duplicate function name ${i} found in MCP tools. Please ensure function names are unique.`);r.add(i);const s=l5(a,t);s.functionDeclarations&&o.push(...s.functionDeclarations)}return{functionDeclarations:o}}function Vx(e,t){let o;if(typeof t=="string")if(e.isVertexAI())if(t.startsWith("gs://"))o={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))o={format:"bigquery",bigqueryUri:t};else throw new Error(`Unsupported string source for Vertex AI: ${t}`);else if(t.startsWith("files/"))o={fileName:t};else throw new Error(`Unsupported string source for Gemini API: ${t}`);else if(Array.isArray(t)){if(e.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");o={inlinedRequests:t}}else o=t;const r=[o.gcsUri,o.bigqueryUri].filter(Boolean).length,a=[o.inlinedRequests,o.fileName].filter(Boolean).length;if(e.isVertexAI()){if(a>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||a!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return o}function d5(e){if(typeof e!="string")return e;const t=e;if(t.startsWith("gs://"))return{format:"jsonl",gcsUri:t};if(t.startsWith("bq://"))return{format:"bigquery",bigqueryUri:t};throw new Error(`Unsupported destination: ${t}`)}function Wx(e){if(typeof e!="object"||e===null)return{};const t=e,o=t.inlinedResponses;if(typeof o!="object"||o===null)return e;const a=o.inlinedResponses;if(!Array.isArray(a)||a.length===0)return e;let i=!1;for(const s of a){if(typeof s!="object"||s===null)continue;const c=s.response;if(typeof c!="object"||c===null)continue;if(c.embedding!==void 0){i=!0;break}}return i&&(t.inlinedEmbedContentResponses=t.inlinedResponses,delete t.inlinedResponses),e}function Ua(e,t){const o=t;if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(o))return o.split("/").pop();throw new Error(`Invalid batch job name: ${o}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(o))return o.split("/").pop();if(/^\d+$/.test(o))return o;throw new Error(`Invalid batch job name: ${o}.`)}function $x(e){const t=e;return t==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":t==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":t==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":t==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":t==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":t==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":t==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function u5(e){const t={},o=m(e,["responsesFile"]);o!=null&&b(t,["fileName"],o);const r=m(e,["inlinedResponses","inlinedResponses"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>V5(s))),b(t,["inlinedResponses"],i)}const a=m(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),b(t,["inlinedEmbedContentResponses"],i)}return t}function p5(e){const t={},o=m(e,["predictionsFormat"]);o!=null&&b(t,["format"],o);const r=m(e,["gcsDestination","outputUriPrefix"]);r!=null&&b(t,["gcsUri"],r);const a=m(e,["bigqueryDestination","outputUri"]);return a!=null&&b(t,["bigqueryUri"],a),t}function h5(e){const t={},o=m(e,["format"]);o!=null&&b(t,["predictionsFormat"],o);const r=m(e,["gcsUri"]);r!=null&&b(t,["gcsDestination","outputUriPrefix"],r);const a=m(e,["bigqueryUri"]);if(a!=null&&b(t,["bigqueryDestination","outputUri"],a),m(e,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(m(e,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(m(e,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}function Fs(e){const t={},o=m(e,["name"]);o!=null&&b(t,["name"],o);const r=m(e,["metadata","displayName"]);r!=null&&b(t,["displayName"],r);const a=m(e,["metadata","state"]);a!=null&&b(t,["state"],$x(a));const i=m(e,["metadata","createTime"]);i!=null&&b(t,["createTime"],i);const s=m(e,["metadata","endTime"]);s!=null&&b(t,["endTime"],s);const l=m(e,["metadata","updateTime"]);l!=null&&b(t,["updateTime"],l);const c=m(e,["metadata","model"]);c!=null&&b(t,["model"],c);const d=m(e,["metadata","output"]);return d!=null&&b(t,["dest"],u5(Wx(d))),t}function nu(e){const t={},o=m(e,["name"]);o!=null&&b(t,["name"],o);const r=m(e,["displayName"]);r!=null&&b(t,["displayName"],r);const a=m(e,["state"]);a!=null&&b(t,["state"],$x(a));const i=m(e,["error"]);i!=null&&b(t,["error"],i);const s=m(e,["createTime"]);s!=null&&b(t,["createTime"],s);const l=m(e,["startTime"]);l!=null&&b(t,["startTime"],l);const c=m(e,["endTime"]);c!=null&&b(t,["endTime"],c);const d=m(e,["updateTime"]);d!=null&&b(t,["updateTime"],d);const u=m(e,["model"]);u!=null&&b(t,["model"],u);const p=m(e,["inputConfig"]);p!=null&&b(t,["src"],m5(p));const h=m(e,["outputConfig"]);h!=null&&b(t,["dest"],p5(Wx(h)));const x=m(e,["completionStats"]);return x!=null&&b(t,["completionStats"],x),t}function m5(e){const t={},o=m(e,["instancesFormat"]);o!=null&&b(t,["format"],o);const r=m(e,["gcsSource","uris"]);r!=null&&b(t,["gcsUri"],r);const a=m(e,["bigquerySource","inputUri"]);return a!=null&&b(t,["bigqueryUri"],a),t}function g5(e,t){const o={};if(m(t,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(m(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(m(t,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const r=m(t,["fileName"]);r!=null&&b(o,["fileName"],r);const a=m(t,["inlinedRequests"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>U5(e,s))),b(o,["requests","requests"],i)}return o}function f5(e){const t={},o=m(e,["format"]);o!=null&&b(t,["instancesFormat"],o);const r=m(e,["gcsUri"]);r!=null&&b(t,["gcsSource","uris"],r);const a=m(e,["bigqueryUri"]);if(a!=null&&b(t,["bigquerySource","inputUri"],a),m(e,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(m(e,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return t}function x5(e){const t={},o=m(e,["data"]);if(o!=null&&b(t,["data"],o),m(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(e,["mimeType"]);return r!=null&&b(t,["mimeType"],r),t}function y5(e,t){const o={},r=m(t,["name"]);return r!=null&&b(o,["_url","name"],Ua(e,r)),o}function v5(e,t){const o={},r=m(t,["name"]);return r!=null&&b(o,["_url","name"],Ua(e,r)),o}function w5(e){const t={},o=m(e,["content"]);o!=null&&b(t,["content"],o);const r=m(e,["citationMetadata"]);r!=null&&b(t,["citationMetadata"],b5(r));const a=m(e,["tokenCount"]);a!=null&&b(t,["tokenCount"],a);const i=m(e,["finishReason"]);i!=null&&b(t,["finishReason"],i);const s=m(e,["avgLogprobs"]);s!=null&&b(t,["avgLogprobs"],s);const l=m(e,["groundingMetadata"]);l!=null&&b(t,["groundingMetadata"],l);const c=m(e,["index"]);c!=null&&b(t,["index"],c);const d=m(e,["logprobsResult"]);d!=null&&b(t,["logprobsResult"],d);const u=m(e,["safetyRatings"]);if(u!=null){let h=u;Array.isArray(h)&&(h=h.map(x=>x)),b(t,["safetyRatings"],h)}const p=m(e,["urlContextMetadata"]);return p!=null&&b(t,["urlContextMetadata"],p),t}function b5(e){const t={},o=m(e,["citationSources"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>a)),b(t,["citations"],r)}return t}function Kx(e){const t={},o=m(e,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(i=>Z5(i))),b(t,["parts"],a)}const r=m(e,["role"]);return r!=null&&b(t,["role"],r),t}function C5(e,t){const o={},r=m(e,["displayName"]);if(t!==void 0&&r!=null&&b(t,["batch","displayName"],r),m(e,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return o}function k5(e,t){const o={},r=m(e,["displayName"]);t!==void 0&&r!=null&&b(t,["displayName"],r);const a=m(e,["dest"]);return t!==void 0&&a!=null&&b(t,["outputConfig"],h5(d5(a))),o}function lg(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["_url","model"],zt(e,r));const a=m(t,["src"]);a!=null&&b(o,["batch","inputConfig"],g5(e,Vx(e,a)));const i=m(t,["config"]);return i!=null&&C5(i,o),o}function _5(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["model"],zt(e,r));const a=m(t,["src"]);a!=null&&b(o,["inputConfig"],f5(Vx(e,a)));const i=m(t,["config"]);return i!=null&&k5(i,o),o}function S5(e,t){const o={},r=m(e,["displayName"]);return t!==void 0&&r!=null&&b(t,["batch","displayName"],r),o}function N5(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["_url","model"],zt(e,r));const a=m(t,["src"]);a!=null&&b(o,["batch","inputConfig"],M5(e,a));const i=m(t,["config"]);return i!=null&&S5(i,o),o}function E5(e,t){const o={},r=m(t,["name"]);return r!=null&&b(o,["_url","name"],Ua(e,r)),o}function P5(e,t){const o={},r=m(t,["name"]);return r!=null&&b(o,["_url","name"],Ua(e,r)),o}function T5(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["name"]);r!=null&&b(t,["name"],r);const a=m(e,["done"]);a!=null&&b(t,["done"],a);const i=m(e,["error"]);return i!=null&&b(t,["error"],i),t}function I5(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["name"]);r!=null&&b(t,["name"],r);const a=m(e,["done"]);a!=null&&b(t,["done"],a);const i=m(e,["error"]);return i!=null&&b(t,["error"],i),t}function j5(e,t){const o={},r=m(t,["contents"]);if(r!=null){let i=yp(e,r);Array.isArray(i)&&(i=i.map(s=>s)),b(o,["requests[]","request","content"],i)}const a=m(t,["config"]);return a!=null&&(b(o,["_self"],A5(a,o)),PC(o,{"requests[].*":"requests[].request.*"})),o}function A5(e,t){const o={},r=m(e,["taskType"]);t!==void 0&&r!=null&&b(t,["requests[]","taskType"],r);const a=m(e,["title"]);t!==void 0&&a!=null&&b(t,["requests[]","title"],a);const i=m(e,["outputDimensionality"]);if(t!==void 0&&i!=null&&b(t,["requests[]","outputDimensionality"],i),m(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(m(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return o}function M5(e,t){const o={},r=m(t,["fileName"]);r!=null&&b(o,["file_name"],r);const a=m(t,["inlinedRequests"]);return a!=null&&b(o,["requests"],j5(e,a)),o}function R5(e){const t={};if(m(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=m(e,["fileUri"]);o!=null&&b(t,["fileUri"],o);const r=m(e,["mimeType"]);return r!=null&&b(t,["mimeType"],r),t}function L5(e){const t={},o=m(e,["id"]);o!=null&&b(t,["id"],o);const r=m(e,["args"]);r!=null&&b(t,["args"],r);const a=m(e,["name"]);if(a!=null&&b(t,["name"],a),m(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(m(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function D5(e){const t={},o=m(e,["mode"]);o!=null&&b(t,["mode"],o);const r=m(e,["allowedFunctionNames"]);if(r!=null&&b(t,["allowedFunctionNames"],r),m(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function z5(e,t,o){const r={},a=m(t,["systemInstruction"]);o!==void 0&&a!=null&&b(o,["systemInstruction"],Kx(En(a)));const i=m(t,["temperature"]);i!=null&&b(r,["temperature"],i);const s=m(t,["topP"]);s!=null&&b(r,["topP"],s);const l=m(t,["topK"]);l!=null&&b(r,["topK"],l);const c=m(t,["candidateCount"]);c!=null&&b(r,["candidateCount"],c);const d=m(t,["maxOutputTokens"]);d!=null&&b(r,["maxOutputTokens"],d);const u=m(t,["stopSequences"]);u!=null&&b(r,["stopSequences"],u);const p=m(t,["responseLogprobs"]);p!=null&&b(r,["responseLogprobs"],p);const h=m(t,["logprobs"]);h!=null&&b(r,["logprobs"],h);const x=m(t,["presencePenalty"]);x!=null&&b(r,["presencePenalty"],x);const k=m(t,["frequencyPenalty"]);k!=null&&b(r,["frequencyPenalty"],k);const C=m(t,["seed"]);C!=null&&b(r,["seed"],C);const w=m(t,["responseMimeType"]);w!=null&&b(r,["responseMimeType"],w);const f=m(t,["responseSchema"]);f!=null&&b(r,["responseSchema"],vp(f));const g=m(t,["responseJsonSchema"]);if(g!=null&&b(r,["responseJsonSchema"],g),m(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(m(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const v=m(t,["safetySettings"]);if(o!==void 0&&v!=null){let A=v;Array.isArray(A)&&(A=A.map(N=>Q5(N))),b(o,["safetySettings"],A)}const _=m(t,["tools"]);if(o!==void 0&&_!=null){let A=Ha(_);Array.isArray(A)&&(A=A.map(N=>tk(Ga(N)))),b(o,["tools"],A)}const S=m(t,["toolConfig"]);if(o!==void 0&&S!=null&&b(o,["toolConfig"],ek(S)),m(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const T=m(t,["cachedContent"]);o!==void 0&&T!=null&&b(o,["cachedContent"],Yo(e,T));const P=m(t,["responseModalities"]);P!=null&&b(r,["responseModalities"],P);const R=m(t,["mediaResolution"]);R!=null&&b(r,["mediaResolution"],R);const D=m(t,["speechConfig"]);if(D!=null&&b(r,["speechConfig"],wp(D)),m(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const q=m(t,["thinkingConfig"]);q!=null&&b(r,["thinkingConfig"],q);const O=m(t,["imageConfig"]);O!=null&&b(r,["imageConfig"],H5(O));const E=m(t,["enableEnhancedCivicAnswers"]);return E!=null&&b(r,["enableEnhancedCivicAnswers"],E),r}function q5(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["candidates"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(d=>w5(d))),b(t,["candidates"],c)}const a=m(e,["modelVersion"]);a!=null&&b(t,["modelVersion"],a);const i=m(e,["promptFeedback"]);i!=null&&b(t,["promptFeedback"],i);const s=m(e,["responseId"]);s!=null&&b(t,["responseId"],s);const l=m(e,["usageMetadata"]);return l!=null&&b(t,["usageMetadata"],l),t}function O5(e,t){const o={},r=m(t,["name"]);return r!=null&&b(o,["_url","name"],Ua(e,r)),o}function F5(e,t){const o={},r=m(t,["name"]);return r!=null&&b(o,["_url","name"],Ua(e,r)),o}function B5(e){const t={};if(m(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const o=m(e,["enableWidget"]);return o!=null&&b(t,["enableWidget"],o),t}function G5(e){const t={};if(m(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const o=m(e,["timeRangeFilter"]);return o!=null&&b(t,["timeRangeFilter"],o),t}function H5(e){const t={},o=m(e,["aspectRatio"]);o!=null&&b(t,["aspectRatio"],o);const r=m(e,["imageSize"]);if(r!=null&&b(t,["imageSize"],r),m(e,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(m(e,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function U5(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["request","model"],zt(e,r));const a=m(t,["contents"]);if(a!=null){let l=ro(a);Array.isArray(l)&&(l=l.map(c=>Kx(c))),b(o,["request","contents"],l)}const i=m(t,["metadata"]);i!=null&&b(o,["metadata"],i);const s=m(t,["config"]);return s!=null&&b(o,["request","generationConfig"],z5(e,s,m(o,["request"],{}))),o}function V5(e){const t={},o=m(e,["response"]);o!=null&&b(t,["response"],q5(o));const r=m(e,["error"]);return r!=null&&b(t,["error"],r),t}function W5(e,t){const o={},r=m(e,["pageSize"]);t!==void 0&&r!=null&&b(t,["_query","pageSize"],r);const a=m(e,["pageToken"]);if(t!==void 0&&a!=null&&b(t,["_query","pageToken"],a),m(e,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return o}function $5(e,t){const o={},r=m(e,["pageSize"]);t!==void 0&&r!=null&&b(t,["_query","pageSize"],r);const a=m(e,["pageToken"]);t!==void 0&&a!=null&&b(t,["_query","pageToken"],a);const i=m(e,["filter"]);return t!==void 0&&i!=null&&b(t,["_query","filter"],i),o}function K5(e){const t={},o=m(e,["config"]);return o!=null&&W5(o,t),t}function J5(e){const t={},o=m(e,["config"]);return o!=null&&$5(o,t),t}function Y5(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["nextPageToken"]);r!=null&&b(t,["nextPageToken"],r);const a=m(e,["operations"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>Fs(s))),b(t,["batchJobs"],i)}return t}function X5(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["nextPageToken"]);r!=null&&b(t,["nextPageToken"],r);const a=m(e,["batchPredictionJobs"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>nu(s))),b(t,["batchJobs"],i)}return t}function Z5(e){const t={},o=m(e,["mediaResolution"]);o!=null&&b(t,["mediaResolution"],o);const r=m(e,["codeExecutionResult"]);r!=null&&b(t,["codeExecutionResult"],r);const a=m(e,["executableCode"]);a!=null&&b(t,["executableCode"],a);const i=m(e,["fileData"]);i!=null&&b(t,["fileData"],R5(i));const s=m(e,["functionCall"]);s!=null&&b(t,["functionCall"],L5(s));const l=m(e,["functionResponse"]);l!=null&&b(t,["functionResponse"],l);const c=m(e,["inlineData"]);c!=null&&b(t,["inlineData"],x5(c));const d=m(e,["text"]);d!=null&&b(t,["text"],d);const u=m(e,["thought"]);u!=null&&b(t,["thought"],u);const p=m(e,["thoughtSignature"]);p!=null&&b(t,["thoughtSignature"],p);const h=m(e,["videoMetadata"]);return h!=null&&b(t,["videoMetadata"],h),t}function Q5(e){const t={},o=m(e,["category"]);if(o!=null&&b(t,["category"],o),m(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=m(e,["threshold"]);return r!=null&&b(t,["threshold"],r),t}function ek(e){const t={},o=m(e,["functionCallingConfig"]);o!=null&&b(t,["functionCallingConfig"],D5(o));const r=m(e,["retrievalConfig"]);return r!=null&&b(t,["retrievalConfig"],r),t}function tk(e){const t={},o=m(e,["functionDeclarations"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(p=>p)),b(t,["functionDeclarations"],u)}if(m(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(e,["googleSearchRetrieval"]);r!=null&&b(t,["googleSearchRetrieval"],r);const a=m(e,["computerUse"]);a!=null&&b(t,["computerUse"],a);const i=m(e,["fileSearch"]);i!=null&&b(t,["fileSearch"],i);const s=m(e,["codeExecution"]);if(s!=null&&b(t,["codeExecution"],s),m(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=m(e,["googleMaps"]);l!=null&&b(t,["googleMaps"],B5(l));const c=m(e,["googleSearch"]);c!=null&&b(t,["googleSearch"],G5(c));const d=m(e,["urlContext"]);return d!=null&&b(t,["urlContext"],d),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var $o;(function(e){e.PAGED_ITEM_BATCH_JOBS="batchJobs",e.PAGED_ITEM_MODELS="models",e.PAGED_ITEM_TUNING_JOBS="tuningJobs",e.PAGED_ITEM_FILES="files",e.PAGED_ITEM_CACHED_CONTENTS="cachedContents",e.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",e.PAGED_ITEM_DOCUMENTS="documents"})($o||($o={}));class Wr{constructor(t,o,r,a){this.pageInternal=[],this.paramsInternal={},this.requestInternal=o,this.init(t,r,a)}init(t,o,r){var a,i;this.nameInternal=t,this.pageInternal=o[this.nameInternal]||[],this.sdkHttpResponseInternal=o==null?void 0:o.sdkHttpResponse,this.idxInternal=0;let s={config:{}};!r||Object.keys(r).length===0?s={config:{}}:typeof r=="object"?s=Object.assign({},r):s=r,s.config&&(s.config.pageToken=o.nextPageToken),this.paramsInternal=s,this.pageInternalSize=(i=(a=s.config)===null||a===void 0?void 0:a.pageSize)!==null&&i!==void 0?i:this.pageInternal.length}initNextPage(t){this.init(this.nameInternal,t,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(t){return this.pageInternal[t]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const t=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:t,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const t=await this.requestInternal(this.params);return this.initNextPage(t),this.page}hasNextPage(){var t;return((t=this.params.config)===null||t===void 0?void 0:t.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nk extends Jo{constructor(t){super(),this.apiClient=t,this.list=async(o={})=>new Wr($o.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(o),o),this.create=async o=>(this.apiClient.isVertexAI()&&(o.config=this.formatDestination(o.src,o.config)),this.createInternal(o)),this.createEmbeddings=async o=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(o)}}createInlinedGenerateContentRequest(t){const o=lg(this.apiClient,t),r=o._url,a=it("{model}:batchGenerateContent",r),l=o.batch.inputConfig.requests,c=l.requests,d=[];for(const u of c){const p=Object.assign({},u);if(p.systemInstruction){const h=p.systemInstruction;delete p.systemInstruction;const x=p.request;x.systemInstruction=h,p.request=x}d.push(p)}return l.requests=d,delete o.config,delete o._url,delete o._query,{path:a,body:o}}getGcsUri(t){if(typeof t=="string")return t.startsWith("gs://")?t:void 0;if(!Array.isArray(t)&&t.gcsUri&&t.gcsUri.length>0)return t.gcsUri[0]}getBigqueryUri(t){if(typeof t=="string")return t.startsWith("bq://")?t:void 0;if(!Array.isArray(t))return t.bigqueryUri}formatDestination(t,o){const r=o?Object.assign({},o):{},a=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${a}`),r.dest===void 0){const i=this.getGcsUri(t),s=this.getBigqueryUri(t);if(i)i.endsWith(".jsonl")?r.dest=`${i.slice(0,-6)}/dest`:r.dest=`${i}_dest_${a}`;else if(s)r.dest=`${s}_dest_${a}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=_5(this.apiClient,t);return l=it("batchPredictionJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>nu(u))}else{const d=lg(this.apiClient,t);return l=it("{model}:batchGenerateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>Fs(u))}}async createEmbeddingsInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=N5(this.apiClient,t);return i=it("{model}:asyncBatchEmbedContent",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>Fs(c))}}async get(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=F5(this.apiClient,t);return l=it("batchPredictionJobs/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>nu(u))}else{const d=O5(this.apiClient,t);return l=it("batches/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>Fs(u))}}async cancel(t){var o,r,a,i;let s="",l={};if(this.apiClient.isVertexAI()){const c=v5(this.apiClient,t);s=it("batchPredictionJobs/{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal})}else{const c=y5(this.apiClient,t);s=it("batches/{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=J5(t);return l=it("batchPredictionJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=X5(u),h=new rg;return Object.assign(h,p),h})}else{const d=K5(t);return l=it("batches",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=Y5(u),h=new rg;return Object.assign(h,p),h})}}async delete(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=P5(this.apiClient,t);return l=it("batchPredictionJobs/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>I5(u))}else{const d=E5(this.apiClient,t);return l=it("batches/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>T5(u))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ok(e){const t={},o=m(e,["data"]);if(o!=null&&b(t,["data"],o),m(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(e,["mimeType"]);return r!=null&&b(t,["mimeType"],r),t}function cg(e){const t={},o=m(e,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(i=>Nk(i))),b(t,["parts"],a)}const r=m(e,["role"]);return r!=null&&b(t,["role"],r),t}function rk(e,t){const o={},r=m(e,["ttl"]);t!==void 0&&r!=null&&b(t,["ttl"],r);const a=m(e,["expireTime"]);t!==void 0&&a!=null&&b(t,["expireTime"],a);const i=m(e,["displayName"]);t!==void 0&&i!=null&&b(t,["displayName"],i);const s=m(e,["contents"]);if(t!==void 0&&s!=null){let u=ro(s);Array.isArray(u)&&(u=u.map(p=>cg(p))),b(t,["contents"],u)}const l=m(e,["systemInstruction"]);t!==void 0&&l!=null&&b(t,["systemInstruction"],cg(En(l)));const c=m(e,["tools"]);if(t!==void 0&&c!=null){let u=c;Array.isArray(u)&&(u=u.map(p=>Pk(p))),b(t,["tools"],u)}const d=m(e,["toolConfig"]);if(t!==void 0&&d!=null&&b(t,["toolConfig"],Ek(d)),m(e,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return o}function ak(e,t){const o={},r=m(e,["ttl"]);t!==void 0&&r!=null&&b(t,["ttl"],r);const a=m(e,["expireTime"]);t!==void 0&&a!=null&&b(t,["expireTime"],a);const i=m(e,["displayName"]);t!==void 0&&i!=null&&b(t,["displayName"],i);const s=m(e,["contents"]);if(t!==void 0&&s!=null){let p=ro(s);Array.isArray(p)&&(p=p.map(h=>h)),b(t,["contents"],p)}const l=m(e,["systemInstruction"]);t!==void 0&&l!=null&&b(t,["systemInstruction"],En(l));const c=m(e,["tools"]);if(t!==void 0&&c!=null){let p=c;Array.isArray(p)&&(p=p.map(h=>Tk(h))),b(t,["tools"],p)}const d=m(e,["toolConfig"]);t!==void 0&&d!=null&&b(t,["toolConfig"],d);const u=m(e,["kmsKeyName"]);return t!==void 0&&u!=null&&b(t,["encryption_spec","kmsKeyName"],u),o}function ik(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["model"],Dx(e,r));const a=m(t,["config"]);return a!=null&&rk(a,o),o}function sk(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["model"],Dx(e,r));const a=m(t,["config"]);return a!=null&&ak(a,o),o}function lk(e,t){const o={},r=m(t,["name"]);return r!=null&&b(o,["_url","name"],Yo(e,r)),o}function ck(e,t){const o={},r=m(t,["name"]);return r!=null&&b(o,["_url","name"],Yo(e,r)),o}function dk(e){const t={},o=m(e,["sdkHttpResponse"]);return o!=null&&b(t,["sdkHttpResponse"],o),t}function uk(e){const t={},o=m(e,["sdkHttpResponse"]);return o!=null&&b(t,["sdkHttpResponse"],o),t}function pk(e){const t={};if(m(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=m(e,["fileUri"]);o!=null&&b(t,["fileUri"],o);const r=m(e,["mimeType"]);return r!=null&&b(t,["mimeType"],r),t}function hk(e){const t={},o=m(e,["id"]);o!=null&&b(t,["id"],o);const r=m(e,["args"]);r!=null&&b(t,["args"],r);const a=m(e,["name"]);if(a!=null&&b(t,["name"],a),m(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(m(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function mk(e){const t={},o=m(e,["mode"]);o!=null&&b(t,["mode"],o);const r=m(e,["allowedFunctionNames"]);if(r!=null&&b(t,["allowedFunctionNames"],r),m(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function gk(e){const t={};if(m(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const o=m(e,["description"]);o!=null&&b(t,["description"],o);const r=m(e,["name"]);r!=null&&b(t,["name"],r);const a=m(e,["parameters"]);a!=null&&b(t,["parameters"],a);const i=m(e,["parametersJsonSchema"]);i!=null&&b(t,["parametersJsonSchema"],i);const s=m(e,["response"]);s!=null&&b(t,["response"],s);const l=m(e,["responseJsonSchema"]);return l!=null&&b(t,["responseJsonSchema"],l),t}function fk(e,t){const o={},r=m(t,["name"]);return r!=null&&b(o,["_url","name"],Yo(e,r)),o}function xk(e,t){const o={},r=m(t,["name"]);return r!=null&&b(o,["_url","name"],Yo(e,r)),o}function yk(e){const t={};if(m(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const o=m(e,["enableWidget"]);return o!=null&&b(t,["enableWidget"],o),t}function vk(e){const t={};if(m(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const o=m(e,["timeRangeFilter"]);return o!=null&&b(t,["timeRangeFilter"],o),t}function wk(e,t){const o={},r=m(e,["pageSize"]);t!==void 0&&r!=null&&b(t,["_query","pageSize"],r);const a=m(e,["pageToken"]);return t!==void 0&&a!=null&&b(t,["_query","pageToken"],a),o}function bk(e,t){const o={},r=m(e,["pageSize"]);t!==void 0&&r!=null&&b(t,["_query","pageSize"],r);const a=m(e,["pageToken"]);return t!==void 0&&a!=null&&b(t,["_query","pageToken"],a),o}function Ck(e){const t={},o=m(e,["config"]);return o!=null&&wk(o,t),t}function kk(e){const t={},o=m(e,["config"]);return o!=null&&bk(o,t),t}function _k(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["nextPageToken"]);r!=null&&b(t,["nextPageToken"],r);const a=m(e,["cachedContents"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),b(t,["cachedContents"],i)}return t}function Sk(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["nextPageToken"]);r!=null&&b(t,["nextPageToken"],r);const a=m(e,["cachedContents"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),b(t,["cachedContents"],i)}return t}function Nk(e){const t={},o=m(e,["mediaResolution"]);o!=null&&b(t,["mediaResolution"],o);const r=m(e,["codeExecutionResult"]);r!=null&&b(t,["codeExecutionResult"],r);const a=m(e,["executableCode"]);a!=null&&b(t,["executableCode"],a);const i=m(e,["fileData"]);i!=null&&b(t,["fileData"],pk(i));const s=m(e,["functionCall"]);s!=null&&b(t,["functionCall"],hk(s));const l=m(e,["functionResponse"]);l!=null&&b(t,["functionResponse"],l);const c=m(e,["inlineData"]);c!=null&&b(t,["inlineData"],ok(c));const d=m(e,["text"]);d!=null&&b(t,["text"],d);const u=m(e,["thought"]);u!=null&&b(t,["thought"],u);const p=m(e,["thoughtSignature"]);p!=null&&b(t,["thoughtSignature"],p);const h=m(e,["videoMetadata"]);return h!=null&&b(t,["videoMetadata"],h),t}function Ek(e){const t={},o=m(e,["functionCallingConfig"]);o!=null&&b(t,["functionCallingConfig"],mk(o));const r=m(e,["retrievalConfig"]);return r!=null&&b(t,["retrievalConfig"],r),t}function Pk(e){const t={},o=m(e,["functionDeclarations"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(p=>p)),b(t,["functionDeclarations"],u)}if(m(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(e,["googleSearchRetrieval"]);r!=null&&b(t,["googleSearchRetrieval"],r);const a=m(e,["computerUse"]);a!=null&&b(t,["computerUse"],a);const i=m(e,["fileSearch"]);i!=null&&b(t,["fileSearch"],i);const s=m(e,["codeExecution"]);if(s!=null&&b(t,["codeExecution"],s),m(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=m(e,["googleMaps"]);l!=null&&b(t,["googleMaps"],yk(l));const c=m(e,["googleSearch"]);c!=null&&b(t,["googleSearch"],vk(c));const d=m(e,["urlContext"]);return d!=null&&b(t,["urlContext"],d),t}function Tk(e){const t={},o=m(e,["functionDeclarations"]);if(o!=null){let p=o;Array.isArray(p)&&(p=p.map(h=>gk(h))),b(t,["functionDeclarations"],p)}const r=m(e,["retrieval"]);r!=null&&b(t,["retrieval"],r);const a=m(e,["googleSearchRetrieval"]);a!=null&&b(t,["googleSearchRetrieval"],a);const i=m(e,["computerUse"]);if(i!=null&&b(t,["computerUse"],i),m(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=m(e,["codeExecution"]);s!=null&&b(t,["codeExecution"],s);const l=m(e,["enterpriseWebSearch"]);l!=null&&b(t,["enterpriseWebSearch"],l);const c=m(e,["googleMaps"]);c!=null&&b(t,["googleMaps"],c);const d=m(e,["googleSearch"]);d!=null&&b(t,["googleSearch"],d);const u=m(e,["urlContext"]);return u!=null&&b(t,["urlContext"],u),t}function Ik(e,t){const o={},r=m(e,["ttl"]);t!==void 0&&r!=null&&b(t,["ttl"],r);const a=m(e,["expireTime"]);return t!==void 0&&a!=null&&b(t,["expireTime"],a),o}function jk(e,t){const o={},r=m(e,["ttl"]);t!==void 0&&r!=null&&b(t,["ttl"],r);const a=m(e,["expireTime"]);return t!==void 0&&a!=null&&b(t,["expireTime"],a),o}function Ak(e,t){const o={},r=m(t,["name"]);r!=null&&b(o,["_url","name"],Yo(e,r));const a=m(t,["config"]);return a!=null&&Ik(a,o),o}function Mk(e,t){const o={},r=m(t,["name"]);r!=null&&b(o,["_url","name"],Yo(e,r));const a=m(t,["config"]);return a!=null&&jk(a,o),o}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Rk extends Jo{constructor(t){super(),this.apiClient=t,this.list=async(o={})=>new Wr($o.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(o),o)}async create(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=sk(this.apiClient,t);return l=it("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>u)}else{const d=ik(this.apiClient,t);return l=it("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>u)}}async get(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=xk(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>u)}else{const d=fk(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>u)}}async delete(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=ck(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=uk(u),h=new ng;return Object.assign(h,p),h})}else{const d=lk(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=dk(u),h=new ng;return Object.assign(h,p),h})}}async update(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=Mk(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>u)}else{const d=Ak(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>u)}}async listInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=kk(t);return l=it("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=Sk(u),h=new og;return Object.assign(h,p),h})}else{const d=Ck(t);return l=it("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=_k(u),h=new og;return Object.assign(h,p),h})}}}function vl(e,t){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(o[r[a]]=e[r[a]]);return o}function dg(e){var t=typeof Symbol=="function"&&Symbol.iterator,o=t&&e[t],r=0;if(o)return o.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function bt(e){return this instanceof bt?(this.v=e,this):new bt(e)}function xo(e,t,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=o.apply(e,t||[]),a,i=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",s),a[Symbol.asyncIterator]=function(){return this},a;function s(x){return function(k){return Promise.resolve(k).then(x,p)}}function l(x,k){r[x]&&(a[x]=function(C){return new Promise(function(w,f){i.push([x,C,w,f])>1||c(x,C)})},k&&(a[x]=k(a[x])))}function c(x,k){try{d(r[x](k))}catch(C){h(i[0][3],C)}}function d(x){x.value instanceof bt?Promise.resolve(x.value.v).then(u,p):h(i[0][2],x)}function u(x){c("next",x)}function p(x){c("throw",x)}function h(x,k){x(k),i.shift(),i.length&&c(i[0][0],i[0][1])}}function yo(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],o;return t?t.call(e):(e=typeof dg=="function"?dg(e):e[Symbol.iterator](),o={},r("next"),r("throw"),r("return"),o[Symbol.asyncIterator]=function(){return this},o);function r(i){o[i]=e[i]&&function(s){return new Promise(function(l,c){s=e[i](s),a(l,c,s.done,s.value)})}}function a(i,s,l,c){Promise.resolve(c).then(function(d){i({value:d,done:l})},s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Lk(e){var t;if(e.candidates==null||e.candidates.length===0)return!1;const o=(t=e.candidates[0])===null||t===void 0?void 0:t.content;return o===void 0?!1:Jx(o)}function Jx(e){if(e.parts===void 0||e.parts.length===0)return!1;for(const t of e.parts)if(t===void 0||Object.keys(t).length===0)return!1;return!0}function Dk(e){if(e.length!==0){for(const t of e)if(t.role!=="user"&&t.role!=="model")throw new Error(`Role must be user or model, but got ${t.role}.`)}}function ug(e){if(e===void 0||e.length===0)return[];const t=[],o=e.length;let r=0;for(;r<o;)if(e[r].role==="user")t.push(e[r]),r++;else{const a=[];let i=!0;for(;r<o&&e[r].role==="model";)a.push(e[r]),i&&!Jx(e[r])&&(i=!1),r++;i?t.push(...a):t.pop()}return t}class zk{constructor(t,o){this.modelsModule=t,this.apiClient=o}create(t){return new qk(this.apiClient,this.modelsModule,t.model,t.config,structuredClone(t.history))}}class qk{constructor(t,o,r,a={},i=[]){this.apiClient=t,this.modelsModule=o,this.model=r,this.config=a,this.history=i,this.sendPromise=Promise.resolve(),Dk(i)}async sendMessage(t){var o;await this.sendPromise;const r=En(t.message),a=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(o=t.config)!==null&&o!==void 0?o:this.config});return this.sendPromise=(async()=>{var i,s,l;const c=await a,d=(s=(i=c.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content,u=c.automaticFunctionCallingHistory,p=this.getHistory(!0).length;let h=[];u!=null&&(h=(l=u.slice(p))!==null&&l!==void 0?l:[]);const x=d?[d]:[];this.recordHistory(r,x,h)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),a}async sendMessageStream(t){var o;await this.sendPromise;const r=En(t.message),a=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(o=t.config)!==null&&o!==void 0?o:this.config});this.sendPromise=a.then(()=>{}).catch(()=>{});const i=await a;return this.processStreamResponse(i,r)}getHistory(t=!1){const o=t?ug(this.history):this.history;return structuredClone(o)}processStreamResponse(t,o){return xo(this,arguments,function*(){var a,i,s,l,c,d;const u=[];try{for(var p=!0,h=yo(t),x;x=yield bt(h.next()),a=x.done,!a;p=!0){l=x.value,p=!1;const k=l;if(Lk(k)){const C=(d=(c=k.candidates)===null||c===void 0?void 0:c[0])===null||d===void 0?void 0:d.content;C!==void 0&&u.push(C)}yield yield bt(k)}}catch(k){i={error:k}}finally{try{!p&&!a&&(s=h.return)&&(yield bt(s.call(h)))}finally{if(i)throw i.error}}this.recordHistory(o,u)})}recordHistory(t,o,r){let a=[];o.length>0&&o.every(i=>i.role!==void 0)?a=o:a.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...ug(r)):this.history.push(t),this.history.push(...a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Gl extends Error{constructor(t){super(t.message),this.name="ApiError",this.status=t.status,Object.setPrototypeOf(this,Gl.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ok(e){const t={},o=m(e,["file"]);return o!=null&&b(t,["file"],o),t}function Fk(e){const t={},o=m(e,["sdkHttpResponse"]);return o!=null&&b(t,["sdkHttpResponse"],o),t}function Bk(e){const t={},o=m(e,["name"]);return o!=null&&b(t,["_url","file"],Gx(o)),t}function Gk(e){const t={},o=m(e,["sdkHttpResponse"]);return o!=null&&b(t,["sdkHttpResponse"],o),t}function Hk(e){const t={},o=m(e,["name"]);return o!=null&&b(t,["_url","file"],Gx(o)),t}function Uk(e,t){const o={},r=m(e,["pageSize"]);t!==void 0&&r!=null&&b(t,["_query","pageSize"],r);const a=m(e,["pageToken"]);return t!==void 0&&a!=null&&b(t,["_query","pageToken"],a),o}function Vk(e){const t={},o=m(e,["config"]);return o!=null&&Uk(o,t),t}function Wk(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["nextPageToken"]);r!=null&&b(t,["nextPageToken"],r);const a=m(e,["files"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),b(t,["files"],i)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class $k extends Jo{constructor(t){super(),this.apiClient=t,this.list=async(o={})=>new Wr($o.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(o),o)}async upload(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(t.file,t.config).then(o=>o)}async download(t){await this.apiClient.downloadFile(t)}async listInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=Vk(t);return i=it("files",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>{const d=Wk(c),u=new XC;return Object.assign(u,d),u})}}async createInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=Ok(t);return i=it("upload/v1beta/files",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=Fk(c),u=new ZC;return Object.assign(u,d),u})}}async get(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=Hk(t);return i=it("files/{file}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async delete(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=Bk(t);return i=it("files/{file}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>{const d=Gk(c),u=new QC;return Object.assign(u,d),u})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Bs(e){const t={},o=m(e,["data"]);if(o!=null&&b(t,["data"],o),m(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(e,["mimeType"]);return r!=null&&b(t,["mimeType"],r),t}function Kk(e){const t={},o=m(e,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(i=>d_(i))),b(t,["parts"],a)}const r=m(e,["role"]);return r!=null&&b(t,["role"],r),t}function Jk(e){const t={};if(m(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=m(e,["fileUri"]);o!=null&&b(t,["fileUri"],o);const r=m(e,["mimeType"]);return r!=null&&b(t,["mimeType"],r),t}function Yk(e){const t={},o=m(e,["id"]);o!=null&&b(t,["id"],o);const r=m(e,["args"]);r!=null&&b(t,["args"],r);const a=m(e,["name"]);if(a!=null&&b(t,["name"],a),m(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(m(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function Xk(e){const t={};if(m(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const o=m(e,["description"]);o!=null&&b(t,["description"],o);const r=m(e,["name"]);r!=null&&b(t,["name"],r);const a=m(e,["parameters"]);a!=null&&b(t,["parameters"],a);const i=m(e,["parametersJsonSchema"]);i!=null&&b(t,["parametersJsonSchema"],i);const s=m(e,["response"]);s!=null&&b(t,["response"],s);const l=m(e,["responseJsonSchema"]);return l!=null&&b(t,["responseJsonSchema"],l),t}function Zk(e){const t={},o=m(e,["modelSelectionConfig"]);o!=null&&b(t,["modelConfig"],o);const r=m(e,["responseJsonSchema"]);r!=null&&b(t,["responseJsonSchema"],r);const a=m(e,["audioTimestamp"]);a!=null&&b(t,["audioTimestamp"],a);const i=m(e,["candidateCount"]);i!=null&&b(t,["candidateCount"],i);const s=m(e,["enableAffectiveDialog"]);s!=null&&b(t,["enableAffectiveDialog"],s);const l=m(e,["frequencyPenalty"]);l!=null&&b(t,["frequencyPenalty"],l);const c=m(e,["logprobs"]);c!=null&&b(t,["logprobs"],c);const d=m(e,["maxOutputTokens"]);d!=null&&b(t,["maxOutputTokens"],d);const u=m(e,["mediaResolution"]);u!=null&&b(t,["mediaResolution"],u);const p=m(e,["presencePenalty"]);p!=null&&b(t,["presencePenalty"],p);const h=m(e,["responseLogprobs"]);h!=null&&b(t,["responseLogprobs"],h);const x=m(e,["responseMimeType"]);x!=null&&b(t,["responseMimeType"],x);const k=m(e,["responseModalities"]);k!=null&&b(t,["responseModalities"],k);const C=m(e,["responseSchema"]);C!=null&&b(t,["responseSchema"],C);const w=m(e,["routingConfig"]);w!=null&&b(t,["routingConfig"],w);const f=m(e,["seed"]);f!=null&&b(t,["seed"],f);const g=m(e,["speechConfig"]);g!=null&&b(t,["speechConfig"],g);const v=m(e,["stopSequences"]);v!=null&&b(t,["stopSequences"],v);const _=m(e,["temperature"]);_!=null&&b(t,["temperature"],_);const S=m(e,["thinkingConfig"]);S!=null&&b(t,["thinkingConfig"],S);const T=m(e,["topK"]);T!=null&&b(t,["topK"],T);const P=m(e,["topP"]);if(P!=null&&b(t,["topP"],P),m(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function Qk(e){const t={};if(m(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const o=m(e,["enableWidget"]);return o!=null&&b(t,["enableWidget"],o),t}function e_(e){const t={};if(m(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const o=m(e,["timeRangeFilter"]);return o!=null&&b(t,["timeRangeFilter"],o),t}function t_(e,t){const o={},r=m(e,["generationConfig"]);t!==void 0&&r!=null&&b(t,["setup","generationConfig"],r);const a=m(e,["responseModalities"]);t!==void 0&&a!=null&&b(t,["setup","generationConfig","responseModalities"],a);const i=m(e,["temperature"]);t!==void 0&&i!=null&&b(t,["setup","generationConfig","temperature"],i);const s=m(e,["topP"]);t!==void 0&&s!=null&&b(t,["setup","generationConfig","topP"],s);const l=m(e,["topK"]);t!==void 0&&l!=null&&b(t,["setup","generationConfig","topK"],l);const c=m(e,["maxOutputTokens"]);t!==void 0&&c!=null&&b(t,["setup","generationConfig","maxOutputTokens"],c);const d=m(e,["mediaResolution"]);t!==void 0&&d!=null&&b(t,["setup","generationConfig","mediaResolution"],d);const u=m(e,["seed"]);t!==void 0&&u!=null&&b(t,["setup","generationConfig","seed"],u);const p=m(e,["speechConfig"]);t!==void 0&&p!=null&&b(t,["setup","generationConfig","speechConfig"],bp(p));const h=m(e,["thinkingConfig"]);t!==void 0&&h!=null&&b(t,["setup","generationConfig","thinkingConfig"],h);const x=m(e,["enableAffectiveDialog"]);t!==void 0&&x!=null&&b(t,["setup","generationConfig","enableAffectiveDialog"],x);const k=m(e,["systemInstruction"]);t!==void 0&&k!=null&&b(t,["setup","systemInstruction"],Kk(En(k)));const C=m(e,["tools"]);if(t!==void 0&&C!=null){let T=Ha(C);Array.isArray(T)&&(T=T.map(P=>p_(Ga(P)))),b(t,["setup","tools"],T)}const w=m(e,["sessionResumption"]);t!==void 0&&w!=null&&b(t,["setup","sessionResumption"],u_(w));const f=m(e,["inputAudioTranscription"]);t!==void 0&&f!=null&&b(t,["setup","inputAudioTranscription"],f);const g=m(e,["outputAudioTranscription"]);t!==void 0&&g!=null&&b(t,["setup","outputAudioTranscription"],g);const v=m(e,["realtimeInputConfig"]);t!==void 0&&v!=null&&b(t,["setup","realtimeInputConfig"],v);const _=m(e,["contextWindowCompression"]);t!==void 0&&_!=null&&b(t,["setup","contextWindowCompression"],_);const S=m(e,["proactivity"]);if(t!==void 0&&S!=null&&b(t,["setup","proactivity"],S),m(e,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return o}function n_(e,t){const o={},r=m(e,["generationConfig"]);t!==void 0&&r!=null&&b(t,["setup","generationConfig"],Zk(r));const a=m(e,["responseModalities"]);t!==void 0&&a!=null&&b(t,["setup","generationConfig","responseModalities"],a);const i=m(e,["temperature"]);t!==void 0&&i!=null&&b(t,["setup","generationConfig","temperature"],i);const s=m(e,["topP"]);t!==void 0&&s!=null&&b(t,["setup","generationConfig","topP"],s);const l=m(e,["topK"]);t!==void 0&&l!=null&&b(t,["setup","generationConfig","topK"],l);const c=m(e,["maxOutputTokens"]);t!==void 0&&c!=null&&b(t,["setup","generationConfig","maxOutputTokens"],c);const d=m(e,["mediaResolution"]);t!==void 0&&d!=null&&b(t,["setup","generationConfig","mediaResolution"],d);const u=m(e,["seed"]);t!==void 0&&u!=null&&b(t,["setup","generationConfig","seed"],u);const p=m(e,["speechConfig"]);t!==void 0&&p!=null&&b(t,["setup","generationConfig","speechConfig"],bp(p));const h=m(e,["thinkingConfig"]);t!==void 0&&h!=null&&b(t,["setup","generationConfig","thinkingConfig"],h);const x=m(e,["enableAffectiveDialog"]);t!==void 0&&x!=null&&b(t,["setup","generationConfig","enableAffectiveDialog"],x);const k=m(e,["systemInstruction"]);t!==void 0&&k!=null&&b(t,["setup","systemInstruction"],En(k));const C=m(e,["tools"]);if(t!==void 0&&C!=null){let P=Ha(C);Array.isArray(P)&&(P=P.map(R=>h_(Ga(R)))),b(t,["setup","tools"],P)}const w=m(e,["sessionResumption"]);t!==void 0&&w!=null&&b(t,["setup","sessionResumption"],w);const f=m(e,["inputAudioTranscription"]);t!==void 0&&f!=null&&b(t,["setup","inputAudioTranscription"],f);const g=m(e,["outputAudioTranscription"]);t!==void 0&&g!=null&&b(t,["setup","outputAudioTranscription"],g);const v=m(e,["realtimeInputConfig"]);t!==void 0&&v!=null&&b(t,["setup","realtimeInputConfig"],v);const _=m(e,["contextWindowCompression"]);t!==void 0&&_!=null&&b(t,["setup","contextWindowCompression"],_);const S=m(e,["proactivity"]);t!==void 0&&S!=null&&b(t,["setup","proactivity"],S);const T=m(e,["explicitVadSignal"]);return t!==void 0&&T!=null&&b(t,["setup","explicitVadSignal"],T),o}function o_(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["setup","model"],zt(e,r));const a=m(t,["config"]);return a!=null&&b(o,["config"],t_(a,o)),o}function r_(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["setup","model"],zt(e,r));const a=m(t,["config"]);return a!=null&&b(o,["config"],n_(a,o)),o}function a_(e){const t={},o=m(e,["musicGenerationConfig"]);return o!=null&&b(t,["musicGenerationConfig"],o),t}function i_(e){const t={},o=m(e,["weightedPrompts"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>a)),b(t,["weightedPrompts"],r)}return t}function s_(e){const t={},o=m(e,["media"]);if(o!=null){let d=zx(o);Array.isArray(d)&&(d=d.map(u=>Bs(u))),b(t,["mediaChunks"],d)}const r=m(e,["audio"]);r!=null&&b(t,["audio"],Bs(Ox(r)));const a=m(e,["audioStreamEnd"]);a!=null&&b(t,["audioStreamEnd"],a);const i=m(e,["video"]);i!=null&&b(t,["video"],Bs(qx(i)));const s=m(e,["text"]);s!=null&&b(t,["text"],s);const l=m(e,["activityStart"]);l!=null&&b(t,["activityStart"],l);const c=m(e,["activityEnd"]);return c!=null&&b(t,["activityEnd"],c),t}function l_(e){const t={},o=m(e,["media"]);if(o!=null){let d=zx(o);Array.isArray(d)&&(d=d.map(u=>u)),b(t,["mediaChunks"],d)}const r=m(e,["audio"]);r!=null&&b(t,["audio"],Ox(r));const a=m(e,["audioStreamEnd"]);a!=null&&b(t,["audioStreamEnd"],a);const i=m(e,["video"]);i!=null&&b(t,["video"],qx(i));const s=m(e,["text"]);s!=null&&b(t,["text"],s);const l=m(e,["activityStart"]);l!=null&&b(t,["activityStart"],l);const c=m(e,["activityEnd"]);return c!=null&&b(t,["activityEnd"],c),t}function c_(e){const t={},o=m(e,["setupComplete"]);o!=null&&b(t,["setupComplete"],o);const r=m(e,["serverContent"]);r!=null&&b(t,["serverContent"],r);const a=m(e,["toolCall"]);a!=null&&b(t,["toolCall"],a);const i=m(e,["toolCallCancellation"]);i!=null&&b(t,["toolCallCancellation"],i);const s=m(e,["usageMetadata"]);s!=null&&b(t,["usageMetadata"],m_(s));const l=m(e,["goAway"]);l!=null&&b(t,["goAway"],l);const c=m(e,["sessionResumptionUpdate"]);c!=null&&b(t,["sessionResumptionUpdate"],c);const d=m(e,["voiceActivityDetectionSignal"]);return d!=null&&b(t,["voiceActivityDetectionSignal"],d),t}function d_(e){const t={},o=m(e,["mediaResolution"]);o!=null&&b(t,["mediaResolution"],o);const r=m(e,["codeExecutionResult"]);r!=null&&b(t,["codeExecutionResult"],r);const a=m(e,["executableCode"]);a!=null&&b(t,["executableCode"],a);const i=m(e,["fileData"]);i!=null&&b(t,["fileData"],Jk(i));const s=m(e,["functionCall"]);s!=null&&b(t,["functionCall"],Yk(s));const l=m(e,["functionResponse"]);l!=null&&b(t,["functionResponse"],l);const c=m(e,["inlineData"]);c!=null&&b(t,["inlineData"],Bs(c));const d=m(e,["text"]);d!=null&&b(t,["text"],d);const u=m(e,["thought"]);u!=null&&b(t,["thought"],u);const p=m(e,["thoughtSignature"]);p!=null&&b(t,["thoughtSignature"],p);const h=m(e,["videoMetadata"]);return h!=null&&b(t,["videoMetadata"],h),t}function u_(e){const t={},o=m(e,["handle"]);if(o!=null&&b(t,["handle"],o),m(e,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function p_(e){const t={},o=m(e,["functionDeclarations"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(p=>p)),b(t,["functionDeclarations"],u)}if(m(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(e,["googleSearchRetrieval"]);r!=null&&b(t,["googleSearchRetrieval"],r);const a=m(e,["computerUse"]);a!=null&&b(t,["computerUse"],a);const i=m(e,["fileSearch"]);i!=null&&b(t,["fileSearch"],i);const s=m(e,["codeExecution"]);if(s!=null&&b(t,["codeExecution"],s),m(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=m(e,["googleMaps"]);l!=null&&b(t,["googleMaps"],Qk(l));const c=m(e,["googleSearch"]);c!=null&&b(t,["googleSearch"],e_(c));const d=m(e,["urlContext"]);return d!=null&&b(t,["urlContext"],d),t}function h_(e){const t={},o=m(e,["functionDeclarations"]);if(o!=null){let p=o;Array.isArray(p)&&(p=p.map(h=>Xk(h))),b(t,["functionDeclarations"],p)}const r=m(e,["retrieval"]);r!=null&&b(t,["retrieval"],r);const a=m(e,["googleSearchRetrieval"]);a!=null&&b(t,["googleSearchRetrieval"],a);const i=m(e,["computerUse"]);if(i!=null&&b(t,["computerUse"],i),m(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=m(e,["codeExecution"]);s!=null&&b(t,["codeExecution"],s);const l=m(e,["enterpriseWebSearch"]);l!=null&&b(t,["enterpriseWebSearch"],l);const c=m(e,["googleMaps"]);c!=null&&b(t,["googleMaps"],c);const d=m(e,["googleSearch"]);d!=null&&b(t,["googleSearch"],d);const u=m(e,["urlContext"]);return u!=null&&b(t,["urlContext"],u),t}function m_(e){const t={},o=m(e,["promptTokenCount"]);o!=null&&b(t,["promptTokenCount"],o);const r=m(e,["cachedContentTokenCount"]);r!=null&&b(t,["cachedContentTokenCount"],r);const a=m(e,["candidatesTokenCount"]);a!=null&&b(t,["responseTokenCount"],a);const i=m(e,["toolUsePromptTokenCount"]);i!=null&&b(t,["toolUsePromptTokenCount"],i);const s=m(e,["thoughtsTokenCount"]);s!=null&&b(t,["thoughtsTokenCount"],s);const l=m(e,["totalTokenCount"]);l!=null&&b(t,["totalTokenCount"],l);const c=m(e,["promptTokensDetails"]);if(c!=null){let x=c;Array.isArray(x)&&(x=x.map(k=>k)),b(t,["promptTokensDetails"],x)}const d=m(e,["cacheTokensDetails"]);if(d!=null){let x=d;Array.isArray(x)&&(x=x.map(k=>k)),b(t,["cacheTokensDetails"],x)}const u=m(e,["candidatesTokensDetails"]);if(u!=null){let x=u;Array.isArray(x)&&(x=x.map(k=>k)),b(t,["responseTokensDetails"],x)}const p=m(e,["toolUsePromptTokensDetails"]);if(p!=null){let x=p;Array.isArray(x)&&(x=x.map(k=>k)),b(t,["toolUsePromptTokensDetails"],x)}const h=m(e,["trafficType"]);return h!=null&&b(t,["trafficType"],h),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function g_(e){const t={},o=m(e,["data"]);if(o!=null&&b(t,["data"],o),m(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(e,["mimeType"]);return r!=null&&b(t,["mimeType"],r),t}function f_(e){const t={},o=m(e,["content"]);o!=null&&b(t,["content"],o);const r=m(e,["citationMetadata"]);r!=null&&b(t,["citationMetadata"],x_(r));const a=m(e,["tokenCount"]);a!=null&&b(t,["tokenCount"],a);const i=m(e,["finishReason"]);i!=null&&b(t,["finishReason"],i);const s=m(e,["avgLogprobs"]);s!=null&&b(t,["avgLogprobs"],s);const l=m(e,["groundingMetadata"]);l!=null&&b(t,["groundingMetadata"],l);const c=m(e,["index"]);c!=null&&b(t,["index"],c);const d=m(e,["logprobsResult"]);d!=null&&b(t,["logprobsResult"],d);const u=m(e,["safetyRatings"]);if(u!=null){let h=u;Array.isArray(h)&&(h=h.map(x=>x)),b(t,["safetyRatings"],h)}const p=m(e,["urlContextMetadata"]);return p!=null&&b(t,["urlContextMetadata"],p),t}function x_(e){const t={},o=m(e,["citationSources"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>a)),b(t,["citations"],r)}return t}function y_(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["_url","model"],zt(e,r));const a=m(t,["contents"]);if(a!=null){let i=ro(a);Array.isArray(i)&&(i=i.map(s=>s)),b(o,["contents"],i)}return o}function v_(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["tokensInfo"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>i)),b(t,["tokensInfo"],a)}return t}function w_(e){const t={},o=m(e,["values"]);o!=null&&b(t,["values"],o);const r=m(e,["statistics"]);return r!=null&&b(t,["statistics"],b_(r)),t}function b_(e){const t={},o=m(e,["truncated"]);o!=null&&b(t,["truncated"],o);const r=m(e,["token_count"]);return r!=null&&b(t,["tokenCount"],r),t}function Hl(e){const t={},o=m(e,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(i=>I4(i))),b(t,["parts"],a)}const r=m(e,["role"]);return r!=null&&b(t,["role"],r),t}function C_(e){const t={},o=m(e,["controlType"]);o!=null&&b(t,["controlType"],o);const r=m(e,["enableControlImageComputation"]);return r!=null&&b(t,["computeControl"],r),t}function k_(e){const t={};if(m(e,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(m(e,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(m(e,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return t}function __(e,t){const o={},r=m(e,["systemInstruction"]);t!==void 0&&r!=null&&b(t,["systemInstruction"],En(r));const a=m(e,["tools"]);if(t!==void 0&&a!=null){let s=a;Array.isArray(s)&&(s=s.map(l=>Qx(l))),b(t,["tools"],s)}const i=m(e,["generationConfig"]);return t!==void 0&&i!=null&&b(t,["generationConfig"],g4(i)),o}function S_(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["_url","model"],zt(e,r));const a=m(t,["contents"]);if(a!=null){let s=ro(a);Array.isArray(s)&&(s=s.map(l=>Hl(l))),b(o,["contents"],s)}const i=m(t,["config"]);return i!=null&&k_(i),o}function N_(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["_url","model"],zt(e,r));const a=m(t,["contents"]);if(a!=null){let s=ro(a);Array.isArray(s)&&(s=s.map(l=>l)),b(o,["contents"],s)}const i=m(t,["config"]);return i!=null&&__(i,o),o}function E_(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["totalTokens"]);r!=null&&b(t,["totalTokens"],r);const a=m(e,["cachedContentTokenCount"]);return a!=null&&b(t,["cachedContentTokenCount"],a),t}function P_(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["totalTokens"]);return r!=null&&b(t,["totalTokens"],r),t}function T_(e,t){const o={},r=m(t,["model"]);return r!=null&&b(o,["_url","name"],zt(e,r)),o}function I_(e,t){const o={},r=m(t,["model"]);return r!=null&&b(o,["_url","name"],zt(e,r)),o}function j_(e){const t={},o=m(e,["sdkHttpResponse"]);return o!=null&&b(t,["sdkHttpResponse"],o),t}function A_(e){const t={},o=m(e,["sdkHttpResponse"]);return o!=null&&b(t,["sdkHttpResponse"],o),t}function M_(e,t){const o={},r=m(e,["outputGcsUri"]);t!==void 0&&r!=null&&b(t,["parameters","storageUri"],r);const a=m(e,["negativePrompt"]);t!==void 0&&a!=null&&b(t,["parameters","negativePrompt"],a);const i=m(e,["numberOfImages"]);t!==void 0&&i!=null&&b(t,["parameters","sampleCount"],i);const s=m(e,["aspectRatio"]);t!==void 0&&s!=null&&b(t,["parameters","aspectRatio"],s);const l=m(e,["guidanceScale"]);t!==void 0&&l!=null&&b(t,["parameters","guidanceScale"],l);const c=m(e,["seed"]);t!==void 0&&c!=null&&b(t,["parameters","seed"],c);const d=m(e,["safetyFilterLevel"]);t!==void 0&&d!=null&&b(t,["parameters","safetySetting"],d);const u=m(e,["personGeneration"]);t!==void 0&&u!=null&&b(t,["parameters","personGeneration"],u);const p=m(e,["includeSafetyAttributes"]);t!==void 0&&p!=null&&b(t,["parameters","includeSafetyAttributes"],p);const h=m(e,["includeRaiReason"]);t!==void 0&&h!=null&&b(t,["parameters","includeRaiReason"],h);const x=m(e,["language"]);t!==void 0&&x!=null&&b(t,["parameters","language"],x);const k=m(e,["outputMimeType"]);t!==void 0&&k!=null&&b(t,["parameters","outputOptions","mimeType"],k);const C=m(e,["outputCompressionQuality"]);t!==void 0&&C!=null&&b(t,["parameters","outputOptions","compressionQuality"],C);const w=m(e,["addWatermark"]);t!==void 0&&w!=null&&b(t,["parameters","addWatermark"],w);const f=m(e,["labels"]);t!==void 0&&f!=null&&b(t,["labels"],f);const g=m(e,["editMode"]);t!==void 0&&g!=null&&b(t,["parameters","editMode"],g);const v=m(e,["baseSteps"]);return t!==void 0&&v!=null&&b(t,["parameters","editConfig","baseSteps"],v),o}function R_(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["_url","model"],zt(e,r));const a=m(t,["prompt"]);a!=null&&b(o,["instances[0]","prompt"],a);const i=m(t,["referenceImages"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>D4(c))),b(o,["instances[0]","referenceImages"],l)}const s=m(t,["config"]);return s!=null&&M_(s,o),o}function L_(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>Ul(i))),b(t,["generatedImages"],a)}return t}function D_(e,t){const o={},r=m(e,["taskType"]);t!==void 0&&r!=null&&b(t,["requests[]","taskType"],r);const a=m(e,["title"]);t!==void 0&&a!=null&&b(t,["requests[]","title"],a);const i=m(e,["outputDimensionality"]);if(t!==void 0&&i!=null&&b(t,["requests[]","outputDimensionality"],i),m(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(m(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return o}function z_(e,t){const o={},r=m(e,["taskType"]);t!==void 0&&r!=null&&b(t,["instances[]","task_type"],r);const a=m(e,["title"]);t!==void 0&&a!=null&&b(t,["instances[]","title"],a);const i=m(e,["outputDimensionality"]);t!==void 0&&i!=null&&b(t,["parameters","outputDimensionality"],i);const s=m(e,["mimeType"]);t!==void 0&&s!=null&&b(t,["instances[]","mimeType"],s);const l=m(e,["autoTruncate"]);return t!==void 0&&l!=null&&b(t,["parameters","autoTruncate"],l),o}function q_(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["_url","model"],zt(e,r));const a=m(t,["contents"]);if(a!=null){let l=yp(e,a);Array.isArray(l)&&(l=l.map(c=>c)),b(o,["requests[]","content"],l)}const i=m(t,["config"]);i!=null&&D_(i,o);const s=m(t,["model"]);return s!==void 0&&b(o,["requests[]","model"],zt(e,s)),o}function O_(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["_url","model"],zt(e,r));const a=m(t,["contents"]);if(a!=null){let s=yp(e,a);Array.isArray(s)&&(s=s.map(l=>l)),b(o,["instances[]","content"],s)}const i=m(t,["config"]);return i!=null&&z_(i,o),o}function F_(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["embeddings"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),b(t,["embeddings"],i)}const a=m(e,["metadata"]);return a!=null&&b(t,["metadata"],a),t}function B_(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["predictions[]","embeddings"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>w_(s))),b(t,["embeddings"],i)}const a=m(e,["metadata"]);return a!=null&&b(t,["metadata"],a),t}function G_(e){const t={},o=m(e,["endpoint"]);o!=null&&b(t,["name"],o);const r=m(e,["deployedModelId"]);return r!=null&&b(t,["deployedModelId"],r),t}function H_(e){const t={};if(m(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=m(e,["fileUri"]);o!=null&&b(t,["fileUri"],o);const r=m(e,["mimeType"]);return r!=null&&b(t,["mimeType"],r),t}function U_(e){const t={},o=m(e,["id"]);o!=null&&b(t,["id"],o);const r=m(e,["args"]);r!=null&&b(t,["args"],r);const a=m(e,["name"]);if(a!=null&&b(t,["name"],a),m(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(m(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function V_(e){const t={},o=m(e,["mode"]);o!=null&&b(t,["mode"],o);const r=m(e,["allowedFunctionNames"]);if(r!=null&&b(t,["allowedFunctionNames"],r),m(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function W_(e){const t={};if(m(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const o=m(e,["description"]);o!=null&&b(t,["description"],o);const r=m(e,["name"]);r!=null&&b(t,["name"],r);const a=m(e,["parameters"]);a!=null&&b(t,["parameters"],a);const i=m(e,["parametersJsonSchema"]);i!=null&&b(t,["parametersJsonSchema"],i);const s=m(e,["response"]);s!=null&&b(t,["response"],s);const l=m(e,["responseJsonSchema"]);return l!=null&&b(t,["responseJsonSchema"],l),t}function $_(e,t,o){const r={},a=m(t,["systemInstruction"]);o!==void 0&&a!=null&&b(o,["systemInstruction"],Hl(En(a)));const i=m(t,["temperature"]);i!=null&&b(r,["temperature"],i);const s=m(t,["topP"]);s!=null&&b(r,["topP"],s);const l=m(t,["topK"]);l!=null&&b(r,["topK"],l);const c=m(t,["candidateCount"]);c!=null&&b(r,["candidateCount"],c);const d=m(t,["maxOutputTokens"]);d!=null&&b(r,["maxOutputTokens"],d);const u=m(t,["stopSequences"]);u!=null&&b(r,["stopSequences"],u);const p=m(t,["responseLogprobs"]);p!=null&&b(r,["responseLogprobs"],p);const h=m(t,["logprobs"]);h!=null&&b(r,["logprobs"],h);const x=m(t,["presencePenalty"]);x!=null&&b(r,["presencePenalty"],x);const k=m(t,["frequencyPenalty"]);k!=null&&b(r,["frequencyPenalty"],k);const C=m(t,["seed"]);C!=null&&b(r,["seed"],C);const w=m(t,["responseMimeType"]);w!=null&&b(r,["responseMimeType"],w);const f=m(t,["responseSchema"]);f!=null&&b(r,["responseSchema"],vp(f));const g=m(t,["responseJsonSchema"]);if(g!=null&&b(r,["responseJsonSchema"],g),m(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(m(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const v=m(t,["safetySettings"]);if(o!==void 0&&v!=null){let A=v;Array.isArray(A)&&(A=A.map(N=>z4(N))),b(o,["safetySettings"],A)}const _=m(t,["tools"]);if(o!==void 0&&_!=null){let A=Ha(_);Array.isArray(A)&&(A=A.map(N=>U4(Ga(N)))),b(o,["tools"],A)}const S=m(t,["toolConfig"]);if(o!==void 0&&S!=null&&b(o,["toolConfig"],H4(S)),m(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const T=m(t,["cachedContent"]);o!==void 0&&T!=null&&b(o,["cachedContent"],Yo(e,T));const P=m(t,["responseModalities"]);P!=null&&b(r,["responseModalities"],P);const R=m(t,["mediaResolution"]);R!=null&&b(r,["mediaResolution"],R);const D=m(t,["speechConfig"]);if(D!=null&&b(r,["speechConfig"],wp(D)),m(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const q=m(t,["thinkingConfig"]);q!=null&&b(r,["thinkingConfig"],q);const O=m(t,["imageConfig"]);O!=null&&b(r,["imageConfig"],w4(O));const E=m(t,["enableEnhancedCivicAnswers"]);return E!=null&&b(r,["enableEnhancedCivicAnswers"],E),r}function K_(e,t,o){const r={},a=m(t,["systemInstruction"]);o!==void 0&&a!=null&&b(o,["systemInstruction"],En(a));const i=m(t,["temperature"]);i!=null&&b(r,["temperature"],i);const s=m(t,["topP"]);s!=null&&b(r,["topP"],s);const l=m(t,["topK"]);l!=null&&b(r,["topK"],l);const c=m(t,["candidateCount"]);c!=null&&b(r,["candidateCount"],c);const d=m(t,["maxOutputTokens"]);d!=null&&b(r,["maxOutputTokens"],d);const u=m(t,["stopSequences"]);u!=null&&b(r,["stopSequences"],u);const p=m(t,["responseLogprobs"]);p!=null&&b(r,["responseLogprobs"],p);const h=m(t,["logprobs"]);h!=null&&b(r,["logprobs"],h);const x=m(t,["presencePenalty"]);x!=null&&b(r,["presencePenalty"],x);const k=m(t,["frequencyPenalty"]);k!=null&&b(r,["frequencyPenalty"],k);const C=m(t,["seed"]);C!=null&&b(r,["seed"],C);const w=m(t,["responseMimeType"]);w!=null&&b(r,["responseMimeType"],w);const f=m(t,["responseSchema"]);f!=null&&b(r,["responseSchema"],vp(f));const g=m(t,["responseJsonSchema"]);g!=null&&b(r,["responseJsonSchema"],g);const v=m(t,["routingConfig"]);v!=null&&b(r,["routingConfig"],v);const _=m(t,["modelSelectionConfig"]);_!=null&&b(r,["modelConfig"],_);const S=m(t,["safetySettings"]);if(o!==void 0&&S!=null){let L=S;Array.isArray(L)&&(L=L.map(M=>M)),b(o,["safetySettings"],L)}const T=m(t,["tools"]);if(o!==void 0&&T!=null){let L=Ha(T);Array.isArray(L)&&(L=L.map(M=>Qx(Ga(M)))),b(o,["tools"],L)}const P=m(t,["toolConfig"]);o!==void 0&&P!=null&&b(o,["toolConfig"],P);const R=m(t,["labels"]);o!==void 0&&R!=null&&b(o,["labels"],R);const D=m(t,["cachedContent"]);o!==void 0&&D!=null&&b(o,["cachedContent"],Yo(e,D));const q=m(t,["responseModalities"]);q!=null&&b(r,["responseModalities"],q);const O=m(t,["mediaResolution"]);O!=null&&b(r,["mediaResolution"],O);const E=m(t,["speechConfig"]);E!=null&&b(r,["speechConfig"],wp(E));const A=m(t,["audioTimestamp"]);A!=null&&b(r,["audioTimestamp"],A);const N=m(t,["thinkingConfig"]);N!=null&&b(r,["thinkingConfig"],N);const j=m(t,["imageConfig"]);if(j!=null&&b(r,["imageConfig"],b4(j)),m(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return r}function pg(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["_url","model"],zt(e,r));const a=m(t,["contents"]);if(a!=null){let s=ro(a);Array.isArray(s)&&(s=s.map(l=>Hl(l))),b(o,["contents"],s)}const i=m(t,["config"]);return i!=null&&b(o,["generationConfig"],$_(e,i,o)),o}function hg(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["_url","model"],zt(e,r));const a=m(t,["contents"]);if(a!=null){let s=ro(a);Array.isArray(s)&&(s=s.map(l=>l)),b(o,["contents"],s)}const i=m(t,["config"]);return i!=null&&b(o,["generationConfig"],K_(e,i,o)),o}function mg(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["candidates"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(d=>f_(d))),b(t,["candidates"],c)}const a=m(e,["modelVersion"]);a!=null&&b(t,["modelVersion"],a);const i=m(e,["promptFeedback"]);i!=null&&b(t,["promptFeedback"],i);const s=m(e,["responseId"]);s!=null&&b(t,["responseId"],s);const l=m(e,["usageMetadata"]);return l!=null&&b(t,["usageMetadata"],l),t}function gg(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["candidates"]);if(r!=null){let d=r;Array.isArray(d)&&(d=d.map(u=>u)),b(t,["candidates"],d)}const a=m(e,["createTime"]);a!=null&&b(t,["createTime"],a);const i=m(e,["modelVersion"]);i!=null&&b(t,["modelVersion"],i);const s=m(e,["promptFeedback"]);s!=null&&b(t,["promptFeedback"],s);const l=m(e,["responseId"]);l!=null&&b(t,["responseId"],l);const c=m(e,["usageMetadata"]);return c!=null&&b(t,["usageMetadata"],c),t}function J_(e,t){const o={};if(m(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(m(e,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const r=m(e,["numberOfImages"]);t!==void 0&&r!=null&&b(t,["parameters","sampleCount"],r);const a=m(e,["aspectRatio"]);t!==void 0&&a!=null&&b(t,["parameters","aspectRatio"],a);const i=m(e,["guidanceScale"]);if(t!==void 0&&i!=null&&b(t,["parameters","guidanceScale"],i),m(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const s=m(e,["safetyFilterLevel"]);t!==void 0&&s!=null&&b(t,["parameters","safetySetting"],s);const l=m(e,["personGeneration"]);t!==void 0&&l!=null&&b(t,["parameters","personGeneration"],l);const c=m(e,["includeSafetyAttributes"]);t!==void 0&&c!=null&&b(t,["parameters","includeSafetyAttributes"],c);const d=m(e,["includeRaiReason"]);t!==void 0&&d!=null&&b(t,["parameters","includeRaiReason"],d);const u=m(e,["language"]);t!==void 0&&u!=null&&b(t,["parameters","language"],u);const p=m(e,["outputMimeType"]);t!==void 0&&p!=null&&b(t,["parameters","outputOptions","mimeType"],p);const h=m(e,["outputCompressionQuality"]);if(t!==void 0&&h!=null&&b(t,["parameters","outputOptions","compressionQuality"],h),m(e,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(m(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const x=m(e,["imageSize"]);if(t!==void 0&&x!=null&&b(t,["parameters","sampleImageSize"],x),m(e,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return o}function Y_(e,t){const o={},r=m(e,["outputGcsUri"]);t!==void 0&&r!=null&&b(t,["parameters","storageUri"],r);const a=m(e,["negativePrompt"]);t!==void 0&&a!=null&&b(t,["parameters","negativePrompt"],a);const i=m(e,["numberOfImages"]);t!==void 0&&i!=null&&b(t,["parameters","sampleCount"],i);const s=m(e,["aspectRatio"]);t!==void 0&&s!=null&&b(t,["parameters","aspectRatio"],s);const l=m(e,["guidanceScale"]);t!==void 0&&l!=null&&b(t,["parameters","guidanceScale"],l);const c=m(e,["seed"]);t!==void 0&&c!=null&&b(t,["parameters","seed"],c);const d=m(e,["safetyFilterLevel"]);t!==void 0&&d!=null&&b(t,["parameters","safetySetting"],d);const u=m(e,["personGeneration"]);t!==void 0&&u!=null&&b(t,["parameters","personGeneration"],u);const p=m(e,["includeSafetyAttributes"]);t!==void 0&&p!=null&&b(t,["parameters","includeSafetyAttributes"],p);const h=m(e,["includeRaiReason"]);t!==void 0&&h!=null&&b(t,["parameters","includeRaiReason"],h);const x=m(e,["language"]);t!==void 0&&x!=null&&b(t,["parameters","language"],x);const k=m(e,["outputMimeType"]);t!==void 0&&k!=null&&b(t,["parameters","outputOptions","mimeType"],k);const C=m(e,["outputCompressionQuality"]);t!==void 0&&C!=null&&b(t,["parameters","outputOptions","compressionQuality"],C);const w=m(e,["addWatermark"]);t!==void 0&&w!=null&&b(t,["parameters","addWatermark"],w);const f=m(e,["labels"]);t!==void 0&&f!=null&&b(t,["labels"],f);const g=m(e,["imageSize"]);t!==void 0&&g!=null&&b(t,["parameters","sampleImageSize"],g);const v=m(e,["enhancePrompt"]);return t!==void 0&&v!=null&&b(t,["parameters","enhancePrompt"],v),o}function X_(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["_url","model"],zt(e,r));const a=m(t,["prompt"]);a!=null&&b(o,["instances[0]","prompt"],a);const i=m(t,["config"]);return i!=null&&J_(i,o),o}function Z_(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["_url","model"],zt(e,r));const a=m(t,["prompt"]);a!=null&&b(o,["instances[0]","prompt"],a);const i=m(t,["config"]);return i!=null&&Y_(i,o),o}function Q_(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>u4(s))),b(t,["generatedImages"],i)}const a=m(e,["positivePromptSafetyAttributes"]);return a!=null&&b(t,["positivePromptSafetyAttributes"],Xx(a)),t}function e4(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>Ul(s))),b(t,["generatedImages"],i)}const a=m(e,["positivePromptSafetyAttributes"]);return a!=null&&b(t,["positivePromptSafetyAttributes"],Zx(a)),t}function t4(e,t){const o={},r=m(e,["numberOfVideos"]);if(t!==void 0&&r!=null&&b(t,["parameters","sampleCount"],r),m(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(m(e,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const a=m(e,["durationSeconds"]);if(t!==void 0&&a!=null&&b(t,["parameters","durationSeconds"],a),m(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const i=m(e,["aspectRatio"]);t!==void 0&&i!=null&&b(t,["parameters","aspectRatio"],i);const s=m(e,["resolution"]);t!==void 0&&s!=null&&b(t,["parameters","resolution"],s);const l=m(e,["personGeneration"]);if(t!==void 0&&l!=null&&b(t,["parameters","personGeneration"],l),m(e,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const c=m(e,["negativePrompt"]);t!==void 0&&c!=null&&b(t,["parameters","negativePrompt"],c);const d=m(e,["enhancePrompt"]);if(t!==void 0&&d!=null&&b(t,["parameters","enhancePrompt"],d),m(e,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const u=m(e,["lastFrame"]);t!==void 0&&u!=null&&b(t,["instances[0]","lastFrame"],Vl(u));const p=m(e,["referenceImages"]);if(t!==void 0&&p!=null){let h=p;Array.isArray(h)&&(h=h.map(x=>oS(x))),b(t,["instances[0]","referenceImages"],h)}if(m(e,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(m(e,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return o}function n4(e,t){const o={},r=m(e,["numberOfVideos"]);t!==void 0&&r!=null&&b(t,["parameters","sampleCount"],r);const a=m(e,["outputGcsUri"]);t!==void 0&&a!=null&&b(t,["parameters","storageUri"],a);const i=m(e,["fps"]);t!==void 0&&i!=null&&b(t,["parameters","fps"],i);const s=m(e,["durationSeconds"]);t!==void 0&&s!=null&&b(t,["parameters","durationSeconds"],s);const l=m(e,["seed"]);t!==void 0&&l!=null&&b(t,["parameters","seed"],l);const c=m(e,["aspectRatio"]);t!==void 0&&c!=null&&b(t,["parameters","aspectRatio"],c);const d=m(e,["resolution"]);t!==void 0&&d!=null&&b(t,["parameters","resolution"],d);const u=m(e,["personGeneration"]);t!==void 0&&u!=null&&b(t,["parameters","personGeneration"],u);const p=m(e,["pubsubTopic"]);t!==void 0&&p!=null&&b(t,["parameters","pubsubTopic"],p);const h=m(e,["negativePrompt"]);t!==void 0&&h!=null&&b(t,["parameters","negativePrompt"],h);const x=m(e,["enhancePrompt"]);t!==void 0&&x!=null&&b(t,["parameters","enhancePrompt"],x);const k=m(e,["generateAudio"]);t!==void 0&&k!=null&&b(t,["parameters","generateAudio"],k);const C=m(e,["lastFrame"]);t!==void 0&&C!=null&&b(t,["instances[0]","lastFrame"],wo(C));const w=m(e,["referenceImages"]);if(t!==void 0&&w!=null){let v=w;Array.isArray(v)&&(v=v.map(_=>rS(_))),b(t,["instances[0]","referenceImages"],v)}const f=m(e,["mask"]);t!==void 0&&f!=null&&b(t,["instances[0]","mask"],nS(f));const g=m(e,["compressionQuality"]);return t!==void 0&&g!=null&&b(t,["parameters","compressionQuality"],g),o}function o4(e){const t={},o=m(e,["name"]);o!=null&&b(t,["name"],o);const r=m(e,["metadata"]);r!=null&&b(t,["metadata"],r);const a=m(e,["done"]);a!=null&&b(t,["done"],a);const i=m(e,["error"]);i!=null&&b(t,["error"],i);const s=m(e,["response","generateVideoResponse"]);return s!=null&&b(t,["response"],s4(s)),t}function r4(e){const t={},o=m(e,["name"]);o!=null&&b(t,["name"],o);const r=m(e,["metadata"]);r!=null&&b(t,["metadata"],r);const a=m(e,["done"]);a!=null&&b(t,["done"],a);const i=m(e,["error"]);i!=null&&b(t,["error"],i);const s=m(e,["response"]);return s!=null&&b(t,["response"],l4(s)),t}function a4(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["_url","model"],zt(e,r));const a=m(t,["prompt"]);a!=null&&b(o,["instances[0]","prompt"],a);const i=m(t,["image"]);i!=null&&b(o,["instances[0]","image"],Vl(i));const s=m(t,["video"]);s!=null&&b(o,["instances[0]","video"],e1(s));const l=m(t,["source"]);l!=null&&c4(l,o);const c=m(t,["config"]);return c!=null&&t4(c,o),o}function i4(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["_url","model"],zt(e,r));const a=m(t,["prompt"]);a!=null&&b(o,["instances[0]","prompt"],a);const i=m(t,["image"]);i!=null&&b(o,["instances[0]","image"],wo(i));const s=m(t,["video"]);s!=null&&b(o,["instances[0]","video"],t1(s));const l=m(t,["source"]);l!=null&&d4(l,o);const c=m(t,["config"]);return c!=null&&n4(c,o),o}function s4(e){const t={},o=m(e,["generatedSamples"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>h4(s))),b(t,["generatedVideos"],i)}const r=m(e,["raiMediaFilteredCount"]);r!=null&&b(t,["raiMediaFilteredCount"],r);const a=m(e,["raiMediaFilteredReasons"]);return a!=null&&b(t,["raiMediaFilteredReasons"],a),t}function l4(e){const t={},o=m(e,["videos"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>m4(s))),b(t,["generatedVideos"],i)}const r=m(e,["raiMediaFilteredCount"]);r!=null&&b(t,["raiMediaFilteredCount"],r);const a=m(e,["raiMediaFilteredReasons"]);return a!=null&&b(t,["raiMediaFilteredReasons"],a),t}function c4(e,t){const o={},r=m(e,["prompt"]);t!==void 0&&r!=null&&b(t,["instances[0]","prompt"],r);const a=m(e,["image"]);t!==void 0&&a!=null&&b(t,["instances[0]","image"],Vl(a));const i=m(e,["video"]);return t!==void 0&&i!=null&&b(t,["instances[0]","video"],e1(i)),o}function d4(e,t){const o={},r=m(e,["prompt"]);t!==void 0&&r!=null&&b(t,["instances[0]","prompt"],r);const a=m(e,["image"]);t!==void 0&&a!=null&&b(t,["instances[0]","image"],wo(a));const i=m(e,["video"]);return t!==void 0&&i!=null&&b(t,["instances[0]","video"],t1(i)),o}function u4(e){const t={},o=m(e,["_self"]);o!=null&&b(t,["image"],C4(o));const r=m(e,["raiFilteredReason"]);r!=null&&b(t,["raiFilteredReason"],r);const a=m(e,["_self"]);return a!=null&&b(t,["safetyAttributes"],Xx(a)),t}function Ul(e){const t={},o=m(e,["_self"]);o!=null&&b(t,["image"],Yx(o));const r=m(e,["raiFilteredReason"]);r!=null&&b(t,["raiFilteredReason"],r);const a=m(e,["_self"]);a!=null&&b(t,["safetyAttributes"],Zx(a));const i=m(e,["prompt"]);return i!=null&&b(t,["enhancedPrompt"],i),t}function p4(e){const t={},o=m(e,["_self"]);o!=null&&b(t,["mask"],Yx(o));const r=m(e,["labels"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>i)),b(t,["labels"],a)}return t}function h4(e){const t={},o=m(e,["video"]);return o!=null&&b(t,["video"],eS(o)),t}function m4(e){const t={},o=m(e,["_self"]);return o!=null&&b(t,["video"],tS(o)),t}function g4(e){const t={},o=m(e,["modelSelectionConfig"]);o!=null&&b(t,["modelConfig"],o);const r=m(e,["responseJsonSchema"]);r!=null&&b(t,["responseJsonSchema"],r);const a=m(e,["audioTimestamp"]);a!=null&&b(t,["audioTimestamp"],a);const i=m(e,["candidateCount"]);i!=null&&b(t,["candidateCount"],i);const s=m(e,["enableAffectiveDialog"]);s!=null&&b(t,["enableAffectiveDialog"],s);const l=m(e,["frequencyPenalty"]);l!=null&&b(t,["frequencyPenalty"],l);const c=m(e,["logprobs"]);c!=null&&b(t,["logprobs"],c);const d=m(e,["maxOutputTokens"]);d!=null&&b(t,["maxOutputTokens"],d);const u=m(e,["mediaResolution"]);u!=null&&b(t,["mediaResolution"],u);const p=m(e,["presencePenalty"]);p!=null&&b(t,["presencePenalty"],p);const h=m(e,["responseLogprobs"]);h!=null&&b(t,["responseLogprobs"],h);const x=m(e,["responseMimeType"]);x!=null&&b(t,["responseMimeType"],x);const k=m(e,["responseModalities"]);k!=null&&b(t,["responseModalities"],k);const C=m(e,["responseSchema"]);C!=null&&b(t,["responseSchema"],C);const w=m(e,["routingConfig"]);w!=null&&b(t,["routingConfig"],w);const f=m(e,["seed"]);f!=null&&b(t,["seed"],f);const g=m(e,["speechConfig"]);g!=null&&b(t,["speechConfig"],g);const v=m(e,["stopSequences"]);v!=null&&b(t,["stopSequences"],v);const _=m(e,["temperature"]);_!=null&&b(t,["temperature"],_);const S=m(e,["thinkingConfig"]);S!=null&&b(t,["thinkingConfig"],S);const T=m(e,["topK"]);T!=null&&b(t,["topK"],T);const P=m(e,["topP"]);if(P!=null&&b(t,["topP"],P),m(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function f4(e,t){const o={},r=m(t,["model"]);return r!=null&&b(o,["_url","name"],zt(e,r)),o}function x4(e,t){const o={},r=m(t,["model"]);return r!=null&&b(o,["_url","name"],zt(e,r)),o}function y4(e){const t={};if(m(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const o=m(e,["enableWidget"]);return o!=null&&b(t,["enableWidget"],o),t}function v4(e){const t={};if(m(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const o=m(e,["timeRangeFilter"]);return o!=null&&b(t,["timeRangeFilter"],o),t}function w4(e){const t={},o=m(e,["aspectRatio"]);o!=null&&b(t,["aspectRatio"],o);const r=m(e,["imageSize"]);if(r!=null&&b(t,["imageSize"],r),m(e,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(m(e,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function b4(e){const t={},o=m(e,["aspectRatio"]);o!=null&&b(t,["aspectRatio"],o);const r=m(e,["imageSize"]);r!=null&&b(t,["imageSize"],r);const a=m(e,["outputMimeType"]);a!=null&&b(t,["imageOutputOptions","mimeType"],a);const i=m(e,["outputCompressionQuality"]);return i!=null&&b(t,["imageOutputOptions","compressionQuality"],i),t}function C4(e){const t={},o=m(e,["bytesBase64Encoded"]);o!=null&&b(t,["imageBytes"],Sr(o));const r=m(e,["mimeType"]);return r!=null&&b(t,["mimeType"],r),t}function Yx(e){const t={},o=m(e,["gcsUri"]);o!=null&&b(t,["gcsUri"],o);const r=m(e,["bytesBase64Encoded"]);r!=null&&b(t,["imageBytes"],Sr(r));const a=m(e,["mimeType"]);return a!=null&&b(t,["mimeType"],a),t}function Vl(e){const t={};if(m(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const o=m(e,["imageBytes"]);o!=null&&b(t,["bytesBase64Encoded"],Sr(o));const r=m(e,["mimeType"]);return r!=null&&b(t,["mimeType"],r),t}function wo(e){const t={},o=m(e,["gcsUri"]);o!=null&&b(t,["gcsUri"],o);const r=m(e,["imageBytes"]);r!=null&&b(t,["bytesBase64Encoded"],Sr(r));const a=m(e,["mimeType"]);return a!=null&&b(t,["mimeType"],a),t}function k4(e,t,o){const r={},a=m(t,["pageSize"]);o!==void 0&&a!=null&&b(o,["_query","pageSize"],a);const i=m(t,["pageToken"]);o!==void 0&&i!=null&&b(o,["_query","pageToken"],i);const s=m(t,["filter"]);o!==void 0&&s!=null&&b(o,["_query","filter"],s);const l=m(t,["queryBase"]);return o!==void 0&&l!=null&&b(o,["_url","models_url"],Hx(e,l)),r}function _4(e,t,o){const r={},a=m(t,["pageSize"]);o!==void 0&&a!=null&&b(o,["_query","pageSize"],a);const i=m(t,["pageToken"]);o!==void 0&&i!=null&&b(o,["_query","pageToken"],i);const s=m(t,["filter"]);o!==void 0&&s!=null&&b(o,["_query","filter"],s);const l=m(t,["queryBase"]);return o!==void 0&&l!=null&&b(o,["_url","models_url"],Hx(e,l)),r}function S4(e,t){const o={},r=m(t,["config"]);return r!=null&&k4(e,r,o),o}function N4(e,t){const o={},r=m(t,["config"]);return r!=null&&_4(e,r,o),o}function E4(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["nextPageToken"]);r!=null&&b(t,["nextPageToken"],r);const a=m(e,["_self"]);if(a!=null){let i=Ux(a);Array.isArray(i)&&(i=i.map(s=>ou(s))),b(t,["models"],i)}return t}function P4(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["nextPageToken"]);r!=null&&b(t,["nextPageToken"],r);const a=m(e,["_self"]);if(a!=null){let i=Ux(a);Array.isArray(i)&&(i=i.map(s=>ru(s))),b(t,["models"],i)}return t}function T4(e){const t={},o=m(e,["maskMode"]);o!=null&&b(t,["maskMode"],o);const r=m(e,["segmentationClasses"]);r!=null&&b(t,["maskClasses"],r);const a=m(e,["maskDilation"]);return a!=null&&b(t,["dilation"],a),t}function ou(e){const t={},o=m(e,["name"]);o!=null&&b(t,["name"],o);const r=m(e,["displayName"]);r!=null&&b(t,["displayName"],r);const a=m(e,["description"]);a!=null&&b(t,["description"],a);const i=m(e,["version"]);i!=null&&b(t,["version"],i);const s=m(e,["_self"]);s!=null&&b(t,["tunedModelInfo"],V4(s));const l=m(e,["inputTokenLimit"]);l!=null&&b(t,["inputTokenLimit"],l);const c=m(e,["outputTokenLimit"]);c!=null&&b(t,["outputTokenLimit"],c);const d=m(e,["supportedGenerationMethods"]);d!=null&&b(t,["supportedActions"],d);const u=m(e,["temperature"]);u!=null&&b(t,["temperature"],u);const p=m(e,["maxTemperature"]);p!=null&&b(t,["maxTemperature"],p);const h=m(e,["topP"]);h!=null&&b(t,["topP"],h);const x=m(e,["topK"]);x!=null&&b(t,["topK"],x);const k=m(e,["thinking"]);return k!=null&&b(t,["thinking"],k),t}function ru(e){const t={},o=m(e,["name"]);o!=null&&b(t,["name"],o);const r=m(e,["displayName"]);r!=null&&b(t,["displayName"],r);const a=m(e,["description"]);a!=null&&b(t,["description"],a);const i=m(e,["versionId"]);i!=null&&b(t,["version"],i);const s=m(e,["deployedModels"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(h=>G_(h))),b(t,["endpoints"],p)}const l=m(e,["labels"]);l!=null&&b(t,["labels"],l);const c=m(e,["_self"]);c!=null&&b(t,["tunedModelInfo"],W4(c));const d=m(e,["defaultCheckpointId"]);d!=null&&b(t,["defaultCheckpointId"],d);const u=m(e,["checkpoints"]);if(u!=null){let p=u;Array.isArray(p)&&(p=p.map(h=>h)),b(t,["checkpoints"],p)}return t}function I4(e){const t={},o=m(e,["mediaResolution"]);o!=null&&b(t,["mediaResolution"],o);const r=m(e,["codeExecutionResult"]);r!=null&&b(t,["codeExecutionResult"],r);const a=m(e,["executableCode"]);a!=null&&b(t,["executableCode"],a);const i=m(e,["fileData"]);i!=null&&b(t,["fileData"],H_(i));const s=m(e,["functionCall"]);s!=null&&b(t,["functionCall"],U_(s));const l=m(e,["functionResponse"]);l!=null&&b(t,["functionResponse"],l);const c=m(e,["inlineData"]);c!=null&&b(t,["inlineData"],g_(c));const d=m(e,["text"]);d!=null&&b(t,["text"],d);const u=m(e,["thought"]);u!=null&&b(t,["thought"],u);const p=m(e,["thoughtSignature"]);p!=null&&b(t,["thoughtSignature"],p);const h=m(e,["videoMetadata"]);return h!=null&&b(t,["videoMetadata"],h),t}function j4(e){const t={},o=m(e,["productImage"]);return o!=null&&b(t,["image"],wo(o)),t}function A4(e,t){const o={},r=m(e,["numberOfImages"]);t!==void 0&&r!=null&&b(t,["parameters","sampleCount"],r);const a=m(e,["baseSteps"]);t!==void 0&&a!=null&&b(t,["parameters","baseSteps"],a);const i=m(e,["outputGcsUri"]);t!==void 0&&i!=null&&b(t,["parameters","storageUri"],i);const s=m(e,["seed"]);t!==void 0&&s!=null&&b(t,["parameters","seed"],s);const l=m(e,["safetyFilterLevel"]);t!==void 0&&l!=null&&b(t,["parameters","safetySetting"],l);const c=m(e,["personGeneration"]);t!==void 0&&c!=null&&b(t,["parameters","personGeneration"],c);const d=m(e,["addWatermark"]);t!==void 0&&d!=null&&b(t,["parameters","addWatermark"],d);const u=m(e,["outputMimeType"]);t!==void 0&&u!=null&&b(t,["parameters","outputOptions","mimeType"],u);const p=m(e,["outputCompressionQuality"]);t!==void 0&&p!=null&&b(t,["parameters","outputOptions","compressionQuality"],p);const h=m(e,["enhancePrompt"]);t!==void 0&&h!=null&&b(t,["parameters","enhancePrompt"],h);const x=m(e,["labels"]);return t!==void 0&&x!=null&&b(t,["labels"],x),o}function M4(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["_url","model"],zt(e,r));const a=m(t,["source"]);a!=null&&L4(a,o);const i=m(t,["config"]);return i!=null&&A4(i,o),o}function R4(e){const t={},o=m(e,["predictions"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>Ul(a))),b(t,["generatedImages"],r)}return t}function L4(e,t){const o={},r=m(e,["prompt"]);t!==void 0&&r!=null&&b(t,["instances[0]","prompt"],r);const a=m(e,["personImage"]);t!==void 0&&a!=null&&b(t,["instances[0]","personImage","image"],wo(a));const i=m(e,["productImages"]);if(t!==void 0&&i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>j4(l))),b(t,["instances[0]","productImages"],s)}return o}function D4(e){const t={},o=m(e,["referenceImage"]);o!=null&&b(t,["referenceImage"],wo(o));const r=m(e,["referenceId"]);r!=null&&b(t,["referenceId"],r);const a=m(e,["referenceType"]);a!=null&&b(t,["referenceType"],a);const i=m(e,["maskImageConfig"]);i!=null&&b(t,["maskImageConfig"],T4(i));const s=m(e,["controlImageConfig"]);s!=null&&b(t,["controlImageConfig"],C_(s));const l=m(e,["styleImageConfig"]);l!=null&&b(t,["styleImageConfig"],l);const c=m(e,["subjectImageConfig"]);return c!=null&&b(t,["subjectImageConfig"],c),t}function Xx(e){const t={},o=m(e,["safetyAttributes","categories"]);o!=null&&b(t,["categories"],o);const r=m(e,["safetyAttributes","scores"]);r!=null&&b(t,["scores"],r);const a=m(e,["contentType"]);return a!=null&&b(t,["contentType"],a),t}function Zx(e){const t={},o=m(e,["safetyAttributes","categories"]);o!=null&&b(t,["categories"],o);const r=m(e,["safetyAttributes","scores"]);r!=null&&b(t,["scores"],r);const a=m(e,["contentType"]);return a!=null&&b(t,["contentType"],a),t}function z4(e){const t={},o=m(e,["category"]);if(o!=null&&b(t,["category"],o),m(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=m(e,["threshold"]);return r!=null&&b(t,["threshold"],r),t}function q4(e){const t={},o=m(e,["image"]);return o!=null&&b(t,["image"],wo(o)),t}function O4(e,t){const o={},r=m(e,["mode"]);t!==void 0&&r!=null&&b(t,["parameters","mode"],r);const a=m(e,["maxPredictions"]);t!==void 0&&a!=null&&b(t,["parameters","maxPredictions"],a);const i=m(e,["confidenceThreshold"]);t!==void 0&&i!=null&&b(t,["parameters","confidenceThreshold"],i);const s=m(e,["maskDilation"]);t!==void 0&&s!=null&&b(t,["parameters","maskDilation"],s);const l=m(e,["binaryColorThreshold"]);t!==void 0&&l!=null&&b(t,["parameters","binaryColorThreshold"],l);const c=m(e,["labels"]);return t!==void 0&&c!=null&&b(t,["labels"],c),o}function F4(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["_url","model"],zt(e,r));const a=m(t,["source"]);a!=null&&G4(a,o);const i=m(t,["config"]);return i!=null&&O4(i,o),o}function B4(e){const t={},o=m(e,["predictions"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(a=>p4(a))),b(t,["generatedMasks"],r)}return t}function G4(e,t){const o={},r=m(e,["prompt"]);t!==void 0&&r!=null&&b(t,["instances[0]","prompt"],r);const a=m(e,["image"]);t!==void 0&&a!=null&&b(t,["instances[0]","image"],wo(a));const i=m(e,["scribbleImage"]);return t!==void 0&&i!=null&&b(t,["instances[0]","scribble"],q4(i)),o}function H4(e){const t={},o=m(e,["functionCallingConfig"]);o!=null&&b(t,["functionCallingConfig"],V_(o));const r=m(e,["retrievalConfig"]);return r!=null&&b(t,["retrievalConfig"],r),t}function U4(e){const t={},o=m(e,["functionDeclarations"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(p=>p)),b(t,["functionDeclarations"],u)}if(m(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(e,["googleSearchRetrieval"]);r!=null&&b(t,["googleSearchRetrieval"],r);const a=m(e,["computerUse"]);a!=null&&b(t,["computerUse"],a);const i=m(e,["fileSearch"]);i!=null&&b(t,["fileSearch"],i);const s=m(e,["codeExecution"]);if(s!=null&&b(t,["codeExecution"],s),m(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=m(e,["googleMaps"]);l!=null&&b(t,["googleMaps"],y4(l));const c=m(e,["googleSearch"]);c!=null&&b(t,["googleSearch"],v4(c));const d=m(e,["urlContext"]);return d!=null&&b(t,["urlContext"],d),t}function Qx(e){const t={},o=m(e,["functionDeclarations"]);if(o!=null){let p=o;Array.isArray(p)&&(p=p.map(h=>W_(h))),b(t,["functionDeclarations"],p)}const r=m(e,["retrieval"]);r!=null&&b(t,["retrieval"],r);const a=m(e,["googleSearchRetrieval"]);a!=null&&b(t,["googleSearchRetrieval"],a);const i=m(e,["computerUse"]);if(i!=null&&b(t,["computerUse"],i),m(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=m(e,["codeExecution"]);s!=null&&b(t,["codeExecution"],s);const l=m(e,["enterpriseWebSearch"]);l!=null&&b(t,["enterpriseWebSearch"],l);const c=m(e,["googleMaps"]);c!=null&&b(t,["googleMaps"],c);const d=m(e,["googleSearch"]);d!=null&&b(t,["googleSearch"],d);const u=m(e,["urlContext"]);return u!=null&&b(t,["urlContext"],u),t}function V4(e){const t={},o=m(e,["baseModel"]);o!=null&&b(t,["baseModel"],o);const r=m(e,["createTime"]);r!=null&&b(t,["createTime"],r);const a=m(e,["updateTime"]);return a!=null&&b(t,["updateTime"],a),t}function W4(e){const t={},o=m(e,["labels","google-vertex-llm-tuning-base-model-id"]);o!=null&&b(t,["baseModel"],o);const r=m(e,["createTime"]);r!=null&&b(t,["createTime"],r);const a=m(e,["updateTime"]);return a!=null&&b(t,["updateTime"],a),t}function $4(e,t){const o={},r=m(e,["displayName"]);t!==void 0&&r!=null&&b(t,["displayName"],r);const a=m(e,["description"]);t!==void 0&&a!=null&&b(t,["description"],a);const i=m(e,["defaultCheckpointId"]);return t!==void 0&&i!=null&&b(t,["defaultCheckpointId"],i),o}function K4(e,t){const o={},r=m(e,["displayName"]);t!==void 0&&r!=null&&b(t,["displayName"],r);const a=m(e,["description"]);t!==void 0&&a!=null&&b(t,["description"],a);const i=m(e,["defaultCheckpointId"]);return t!==void 0&&i!=null&&b(t,["defaultCheckpointId"],i),o}function J4(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["_url","name"],zt(e,r));const a=m(t,["config"]);return a!=null&&$4(a,o),o}function Y4(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["_url","model"],zt(e,r));const a=m(t,["config"]);return a!=null&&K4(a,o),o}function X4(e,t){const o={},r=m(e,["outputGcsUri"]);t!==void 0&&r!=null&&b(t,["parameters","storageUri"],r);const a=m(e,["safetyFilterLevel"]);t!==void 0&&a!=null&&b(t,["parameters","safetySetting"],a);const i=m(e,["personGeneration"]);t!==void 0&&i!=null&&b(t,["parameters","personGeneration"],i);const s=m(e,["includeRaiReason"]);t!==void 0&&s!=null&&b(t,["parameters","includeRaiReason"],s);const l=m(e,["outputMimeType"]);t!==void 0&&l!=null&&b(t,["parameters","outputOptions","mimeType"],l);const c=m(e,["outputCompressionQuality"]);t!==void 0&&c!=null&&b(t,["parameters","outputOptions","compressionQuality"],c);const d=m(e,["enhanceInputImage"]);t!==void 0&&d!=null&&b(t,["parameters","upscaleConfig","enhanceInputImage"],d);const u=m(e,["imagePreservationFactor"]);t!==void 0&&u!=null&&b(t,["parameters","upscaleConfig","imagePreservationFactor"],u);const p=m(e,["labels"]);t!==void 0&&p!=null&&b(t,["labels"],p);const h=m(e,["numberOfImages"]);t!==void 0&&h!=null&&b(t,["parameters","sampleCount"],h);const x=m(e,["mode"]);return t!==void 0&&x!=null&&b(t,["parameters","mode"],x),o}function Z4(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["_url","model"],zt(e,r));const a=m(t,["image"]);a!=null&&b(o,["instances[0]","image"],wo(a));const i=m(t,["upscaleFactor"]);i!=null&&b(o,["parameters","upscaleConfig","upscaleFactor"],i);const s=m(t,["config"]);return s!=null&&X4(s,o),o}function Q4(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>Ul(i))),b(t,["generatedImages"],a)}return t}function eS(e){const t={},o=m(e,["uri"]);o!=null&&b(t,["uri"],o);const r=m(e,["encodedVideo"]);r!=null&&b(t,["videoBytes"],Sr(r));const a=m(e,["encoding"]);return a!=null&&b(t,["mimeType"],a),t}function tS(e){const t={},o=m(e,["gcsUri"]);o!=null&&b(t,["uri"],o);const r=m(e,["bytesBase64Encoded"]);r!=null&&b(t,["videoBytes"],Sr(r));const a=m(e,["mimeType"]);return a!=null&&b(t,["mimeType"],a),t}function nS(e){const t={},o=m(e,["image"]);o!=null&&b(t,["_self"],wo(o));const r=m(e,["maskMode"]);return r!=null&&b(t,["maskMode"],r),t}function oS(e){const t={},o=m(e,["image"]);o!=null&&b(t,["image"],Vl(o));const r=m(e,["referenceType"]);return r!=null&&b(t,["referenceType"],r),t}function rS(e){const t={},o=m(e,["image"]);o!=null&&b(t,["image"],wo(o));const r=m(e,["referenceType"]);return r!=null&&b(t,["referenceType"],r),t}function e1(e){const t={},o=m(e,["uri"]);o!=null&&b(t,["uri"],o);const r=m(e,["videoBytes"]);r!=null&&b(t,["encodedVideo"],Sr(r));const a=m(e,["mimeType"]);return a!=null&&b(t,["encoding"],a),t}function t1(e){const t={},o=m(e,["uri"]);o!=null&&b(t,["gcsUri"],o);const r=m(e,["videoBytes"]);r!=null&&b(t,["bytesBase64Encoded"],Sr(r));const a=m(e,["mimeType"]);return a!=null&&b(t,["mimeType"],a),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function aS(e,t){const o={},r=m(e,["displayName"]);return t!==void 0&&r!=null&&b(t,["displayName"],r),o}function iS(e){const t={},o=m(e,["config"]);return o!=null&&aS(o,t),t}function sS(e,t){const o={},r=m(e,["force"]);return t!==void 0&&r!=null&&b(t,["_query","force"],r),o}function lS(e){const t={},o=m(e,["name"]);o!=null&&b(t,["_url","name"],o);const r=m(e,["config"]);return r!=null&&sS(r,t),t}function cS(e){const t={},o=m(e,["name"]);return o!=null&&b(t,["_url","name"],o),t}function dS(e,t){const o={},r=m(e,["customMetadata"]);if(t!==void 0&&r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),b(t,["customMetadata"],i)}const a=m(e,["chunkingConfig"]);return t!==void 0&&a!=null&&b(t,["chunkingConfig"],a),o}function uS(e){const t={},o=m(e,["name"]);o!=null&&b(t,["name"],o);const r=m(e,["metadata"]);r!=null&&b(t,["metadata"],r);const a=m(e,["done"]);a!=null&&b(t,["done"],a);const i=m(e,["error"]);i!=null&&b(t,["error"],i);const s=m(e,["response"]);return s!=null&&b(t,["response"],hS(s)),t}function pS(e){const t={},o=m(e,["fileSearchStoreName"]);o!=null&&b(t,["_url","file_search_store_name"],o);const r=m(e,["fileName"]);r!=null&&b(t,["fileName"],r);const a=m(e,["config"]);return a!=null&&dS(a,t),t}function hS(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["parent"]);r!=null&&b(t,["parent"],r);const a=m(e,["documentName"]);return a!=null&&b(t,["documentName"],a),t}function mS(e,t){const o={},r=m(e,["pageSize"]);t!==void 0&&r!=null&&b(t,["_query","pageSize"],r);const a=m(e,["pageToken"]);return t!==void 0&&a!=null&&b(t,["_query","pageToken"],a),o}function gS(e){const t={},o=m(e,["config"]);return o!=null&&mS(o,t),t}function fS(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["nextPageToken"]);r!=null&&b(t,["nextPageToken"],r);const a=m(e,["fileSearchStores"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),b(t,["fileSearchStores"],i)}return t}function n1(e,t){const o={},r=m(e,["mimeType"]);t!==void 0&&r!=null&&b(t,["mimeType"],r);const a=m(e,["displayName"]);t!==void 0&&a!=null&&b(t,["displayName"],a);const i=m(e,["customMetadata"]);if(t!==void 0&&i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),b(t,["customMetadata"],l)}const s=m(e,["chunkingConfig"]);return t!==void 0&&s!=null&&b(t,["chunkingConfig"],s),o}function xS(e){const t={},o=m(e,["fileSearchStoreName"]);o!=null&&b(t,["_url","file_search_store_name"],o);const r=m(e,["config"]);return r!=null&&n1(r,t),t}function yS(e){const t={},o=m(e,["sdkHttpResponse"]);return o!=null&&b(t,["sdkHttpResponse"],o),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const vS="Content-Type",wS="X-Server-Timeout",bS="User-Agent",au="x-goog-api-client",CS="1.34.0",kS=`google-genai-sdk/${CS}`,_S="v1beta1",SS="v1beta";class NS{constructor(t){var o,r;this.clientOptions=Object.assign(Object.assign({},t),{project:t.project,location:t.location,apiKey:t.apiKey,vertexai:t.vertexai});const a={};this.clientOptions.vertexai?(a.apiVersion=(o=this.clientOptions.apiVersion)!==null&&o!==void 0?o:_S,a.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(a.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:SS,a.baseUrl="https://generativelanguage.googleapis.com/"),a.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=a,t.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(a,t.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var t;return(t=this.clientOptions.vertexai)!==null&&t!==void 0?t:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){const t=new Headers;return await this.clientOptions.auth.addAuthHeaders(t),t}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(t){if(!t||t.baseUrl===void 0||t.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const r=[t.baseUrl.endsWith("/")?t.baseUrl.slice(0,-1):t.baseUrl];return t.apiVersion&&t.apiVersion!==""&&r.push(t.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const t=this.getBaseUrl(),o=new URL(t);return o.protocol=o.protocol=="http:"?"ws":"wss",o.toString()}setBaseUrl(t){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=t;else throw new Error("HTTP options are not correctly set.")}constructUrl(t,o,r){const a=[this.getRequestUrlInternal(o)];return r&&a.push(this.getBaseResourcePath()),t!==""&&a.push(t),new URL(`${a.join("/")}`)}shouldPrependVertexProjectPath(t){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||t.path.startsWith("projects/")||t.httpMethod==="GET"&&t.path.startsWith("publishers/google/models"))}async request(t){let o=this.clientOptions.httpOptions;t.httpOptions&&(o=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const r=this.shouldPrependVertexProjectPath(t),a=this.constructUrl(t.path,o,r);if(t.queryParams)for(const[s,l]of Object.entries(t.queryParams))a.searchParams.append(s,String(l));let i={};if(t.httpMethod==="GET"){if(t.body&&t.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else i.body=t.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,o,a.toString(),t.abortSignal),this.unaryApiCall(a,i,t.httpMethod)}patchHttpOptions(t,o){const r=JSON.parse(JSON.stringify(t));for(const[a,i]of Object.entries(o))typeof i=="object"?r[a]=Object.assign(Object.assign({},r[a]),i):i!==void 0&&(r[a]=i);return r}async requestStream(t){let o=this.clientOptions.httpOptions;t.httpOptions&&(o=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const r=this.shouldPrependVertexProjectPath(t),a=this.constructUrl(t.path,o,r);(!a.searchParams.has("alt")||a.searchParams.get("alt")!=="sse")&&a.searchParams.set("alt","sse");let i={};return i.body=t.body,i=await this.includeExtraHttpOptionsToRequestInit(i,o,a.toString(),t.abortSignal),this.streamApiCall(a,i,t.httpMethod)}async includeExtraHttpOptionsToRequestInit(t,o,r,a){if(o&&o.timeout||a){const i=new AbortController,s=i.signal;if(o.timeout&&(o==null?void 0:o.timeout)>0){const l=setTimeout(()=>i.abort(),o.timeout);l&&typeof l.unref=="function"&&l.unref()}a&&a.addEventListener("abort",()=>{i.abort()}),t.signal=s}return o&&o.extraBody!==null&&ES(t,o.extraBody),t.headers=await this.getHeadersInternal(o,r),t}async unaryApiCall(t,o,r){return this.apiCall(t.toString(),Object.assign(Object.assign({},o),{method:r})).then(async a=>(await fg(a),new eu(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}async streamApiCall(t,o,r){return this.apiCall(t.toString(),Object.assign(Object.assign({},o),{method:r})).then(async a=>(await fg(a),this.processStreamResponse(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}processStreamResponse(t){return xo(this,arguments,function*(){var r;const a=(r=t==null?void 0:t.body)===null||r===void 0?void 0:r.getReader(),i=new TextDecoder("utf-8");if(!a)throw new Error("Response body is empty");try{let s="";const l="data:",c=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:d,value:u}=yield bt(a.read());if(d){if(s.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const p=i.decode(u,{stream:!0});try{const k=JSON.parse(p);if("error"in k){const C=JSON.parse(JSON.stringify(k.error)),w=C.status,f=C.code,g=`got status: ${w}. ${JSON.stringify(k)}`;if(f>=400&&f<600)throw new Gl({message:g,status:f})}}catch(k){if(k.name==="ApiError")throw k}s+=p;let h=-1,x=0;for(;;){h=-1,x=0;for(const w of c){const f=s.indexOf(w);f!==-1&&(h===-1||f<h)&&(h=f,x=w.length)}if(h===-1)break;const k=s.substring(0,h);s=s.substring(h+x);const C=k.trim();if(C.startsWith(l)){const w=C.substring(l.length).trim();try{const f=new Response(w,{headers:t==null?void 0:t.headers,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText});yield yield bt(new eu(f))}catch(f){throw new Error(`exception parsing stream chunk ${w}. ${f}`)}}}}}finally{a.releaseLock()}})}async apiCall(t,o){return fetch(t,o).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){const t={},o=kS+" "+this.clientOptions.userAgentExtra;return t[bS]=o,t[au]=o,t[vS]="application/json",t}async getHeadersInternal(t,o){const r=new Headers;if(t&&t.headers){for(const[a,i]of Object.entries(t.headers))r.append(a,i);t.timeout&&t.timeout>0&&r.append(wS,String(Math.ceil(t.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,o),r}getFileName(t){var o;let r="";return typeof t=="string"&&(r=t.replace(/[/\\]+$/,""),r=(o=r.split(/[/\\]/).pop())!==null&&o!==void 0?o:""),r}async uploadFile(t,o){var r;const a={};o!=null&&(a.mimeType=o.mimeType,a.name=o.name,a.displayName=o.displayName),a.name&&!a.name.startsWith("files/")&&(a.name=`files/${a.name}`);const i=this.clientOptions.uploader,s=await i.stat(t);a.sizeBytes=String(s.size);const l=(r=o==null?void 0:o.mimeType)!==null&&r!==void 0?r:s.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");a.mimeType=l;const c={file:a},d=this.getFileName(t),u=it("upload/v1beta/files",c._url),p=await this.fetchUploadUrl(u,a.sizeBytes,a.mimeType,d,c,o==null?void 0:o.httpOptions);return i.upload(t,p,this)}async uploadFileToFileSearchStore(t,o,r){var a;const i=this.clientOptions.uploader,s=await i.stat(o),l=String(s.size),c=(a=r==null?void 0:r.mimeType)!==null&&a!==void 0?a:s.type;if(c===void 0||c==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const d=`upload/v1beta/${t}:uploadToFileSearchStore`,u=this.getFileName(o),p={};r!=null&&n1(r,p);const h=await this.fetchUploadUrl(d,l,c,u,p,r==null?void 0:r.httpOptions);return i.uploadToFileSearchStore(o,h,this)}async downloadFile(t){await this.clientOptions.downloader.download(t,this)}async fetchUploadUrl(t,o,r,a,i,s){var l;let c={};s?c=s:c={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${o}`,"X-Goog-Upload-Header-Content-Type":`${r}`},a?{"X-Goog-Upload-File-Name":a}:{})};const d=await this.request({path:t,body:JSON.stringify(i),httpMethod:"POST",httpOptions:c});if(!d||!(d!=null&&d.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const u=(l=d==null?void 0:d.headers)===null||l===void 0?void 0:l["x-goog-upload-url"];if(u===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}}async function fg(e){var t;if(e===void 0)throw new Error("response is undefined");if(!e.ok){const o=e.status;let r;!((t=e.headers.get("content-type"))===null||t===void 0)&&t.includes("application/json")?r=await e.json():r={error:{message:await e.text(),code:e.status,status:e.statusText}};const a=JSON.stringify(r);throw o>=400&&o<600?new Gl({message:a,status:o}):new Error(a)}}function ES(e,t){if(!t||Object.keys(t).length===0)return;if(e.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let o={};if(typeof e.body=="string"&&e.body.length>0)try{const i=JSON.parse(e.body);if(typeof i=="object"&&i!==null&&!Array.isArray(i))o=i;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(i,s){const l=Object.assign({},i);for(const c in s)if(Object.prototype.hasOwnProperty.call(s,c)){const d=s[c],u=l[c];d&&typeof d=="object"&&!Array.isArray(d)&&u&&typeof u=="object"&&!Array.isArray(u)?l[c]=r(u,d):(u&&d&&typeof u!=typeof d&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${c}". Original type: ${typeof u}, New type: ${typeof d}. Overwriting.`),l[c]=d)}return l}const a=r(o,t);e.body=JSON.stringify(a)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const PS="mcp_used/unknown";let TS=!1;function o1(e){for(const t of e)if(IS(t)||typeof t=="object"&&"inputSchema"in t)return!0;return TS}function r1(e){var t;const o=(t=e[au])!==null&&t!==void 0?t:"";e[au]=(o+` ${PS}`).trimStart()}function IS(e){return e!==null&&typeof e=="object"&&e instanceof Cp}function jS(e){return xo(this,arguments,function*(o,r=100){let a,i=0;for(;i<r;){const s=yield bt(o.listTools({cursor:a}));for(const l of s.tools)yield yield bt(l),i++;if(!s.nextCursor)break;a=s.nextCursor}})}class Cp{constructor(t=[],o){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=t,this.config=o}static create(t,o){return new Cp(t,o)}async initialize(){var t,o,r,a;if(this.mcpTools.length>0)return;const i={},s=[];for(const u of this.mcpClients)try{for(var l=!0,c=(o=void 0,yo(jS(u))),d;d=await c.next(),t=d.done,!t;l=!0){a=d.value,l=!1;const p=a;s.push(p);const h=p.name;if(i[h])throw new Error(`Duplicate function name ${h} found in MCP tools. Please ensure function names are unique.`);i[h]=u}}catch(p){o={error:p}}finally{try{!l&&!t&&(r=c.return)&&await r.call(c)}finally{if(o)throw o.error}}this.mcpTools=s,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),c5(this.mcpTools,this.config)}async callTool(t){await this.initialize();const o=[];for(const r of t)if(r.name in this.functionNameToMcpClient){const a=this.functionNameToMcpClient[r.name];let i;this.config.timeout&&(i={timeout:this.config.timeout});const s=await a.callTool({name:r.name,arguments:r.args},void 0,i);o.push({functionResponse:{name:r.name,response:s.isError?{error:s}:s}})}return o}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function AS(e,t,o){const r=new t5;let a;o.data instanceof Blob?a=JSON.parse(await o.data.text()):a=JSON.parse(o.data),Object.assign(r,a),t(r)}class MS{constructor(t,o,r){this.apiClient=t,this.auth=o,this.webSocketFactory=r}async connect(t){var o,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const a=this.apiClient.getWebsocketBaseUrl(),i=this.apiClient.getApiVersion(),s=DS(this.apiClient.getDefaultHeaders()),l=this.apiClient.getApiKey(),c=`${a}/ws/google.ai.generativelanguage.${i}.GenerativeService.BidiGenerateMusic?key=${l}`;let d=()=>{};const u=new Promise(v=>{d=v}),p=t.callbacks,h=function(){d({})},x=this.apiClient,k={onopen:h,onmessage:v=>{AS(x,p.onmessage,v)},onerror:(o=p==null?void 0:p.onerror)!==null&&o!==void 0?o:function(v){},onclose:(r=p==null?void 0:p.onclose)!==null&&r!==void 0?r:function(v){}},C=this.webSocketFactory.create(c,LS(s),k);C.connect(),await u;const g={setup:{model:zt(this.apiClient,t.model)}};return C.send(JSON.stringify(g)),new RS(C,this.apiClient)}}class RS{constructor(t,o){this.conn=t,this.apiClient=o}async setWeightedPrompts(t){if(!t.weightedPrompts||Object.keys(t.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const o=i_(t);this.conn.send(JSON.stringify({clientContent:o}))}async setMusicGenerationConfig(t){t.musicGenerationConfig||(t.musicGenerationConfig={});const o=a_(t);this.conn.send(JSON.stringify(o))}sendPlaybackControl(t){const o={playbackControl:t};this.conn.send(JSON.stringify(o))}play(){this.sendPlaybackControl(fa.PLAY)}pause(){this.sendPlaybackControl(fa.PAUSE)}stop(){this.sendPlaybackControl(fa.STOP)}resetContext(){this.sendPlaybackControl(fa.RESET_CONTEXT)}close(){this.conn.close()}}function LS(e){const t={};return e.forEach((o,r)=>{t[r]=o}),t}function DS(e){const t=new Headers;for(const[o,r]of Object.entries(e))t.append(o,r);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const zS="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function qS(e,t,o){const r=new e5;let a;o.data instanceof Blob?a=await o.data.text():o.data instanceof ArrayBuffer?a=new TextDecoder().decode(o.data):a=o.data;const i=JSON.parse(a);if(e.isVertexAI()){const s=c_(i);Object.assign(r,s)}else Object.assign(r,i);t(r)}class OS{constructor(t,o,r){this.apiClient=t,this.auth=o,this.webSocketFactory=r,this.music=new MS(this.apiClient,this.auth,this.webSocketFactory)}async connect(t){var o,r,a,i,s,l;if(t.config&&t.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const c=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let u;const p=this.apiClient.getHeaders();t.config&&t.config.tools&&o1(t.config.tools)&&r1(p);const h=HS(p);if(this.apiClient.isVertexAI())u=`${c}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(h,u);else{const D=this.apiClient.getApiKey();let q="BidiGenerateContent",O="key";D!=null&&D.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),d!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),q="BidiGenerateContentConstrained",O="access_token"),u=`${c}/ws/google.ai.generativelanguage.${d}.GenerativeService.${q}?${O}=${D}`}let x=()=>{};const k=new Promise(D=>{x=D}),C=t.callbacks,w=function(){var D;(D=C==null?void 0:C.onopen)===null||D===void 0||D.call(C),x({})},f=this.apiClient,g={onopen:w,onmessage:D=>{qS(f,C.onmessage,D)},onerror:(o=C==null?void 0:C.onerror)!==null&&o!==void 0?o:function(D){},onclose:(r=C==null?void 0:C.onclose)!==null&&r!==void 0?r:function(D){}},v=this.webSocketFactory.create(u,GS(h),g);v.connect(),await k;let _=zt(this.apiClient,t.model);if(this.apiClient.isVertexAI()&&_.startsWith("publishers/")){const D=this.apiClient.getProject(),q=this.apiClient.getLocation();_=`projects/${D}/locations/${q}/`+_}let S={};this.apiClient.isVertexAI()&&((a=t.config)===null||a===void 0?void 0:a.responseModalities)===void 0&&(t.config===void 0?t.config={responseModalities:[za.AUDIO]}:t.config.responseModalities=[za.AUDIO]),!((i=t.config)===null||i===void 0)&&i.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const T=(l=(s=t.config)===null||s===void 0?void 0:s.tools)!==null&&l!==void 0?l:[],P=[];for(const D of T)if(this.isCallableTool(D)){const q=D;P.push(await q.tool())}else P.push(D);P.length>0&&(t.config.tools=P);const R={model:_,config:t.config,callbacks:t.callbacks};return this.apiClient.isVertexAI()?S=r_(this.apiClient,R):S=o_(this.apiClient,R),delete S.config,v.send(JSON.stringify(S)),new BS(v,this.apiClient)}isCallableTool(t){return"callTool"in t&&typeof t.callTool=="function"}}const FS={turnComplete:!0};class BS{constructor(t,o){this.conn=t,this.apiClient=o}tLiveClientContent(t,o){if(o.turns!==null&&o.turns!==void 0){let r=[];try{r=ro(o.turns),t.isVertexAI()||(r=r.map(a=>Hl(a)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof o.turns}'`)}return{clientContent:{turns:r,turnComplete:o.turnComplete}}}return{clientContent:{turnComplete:o.turnComplete}}}tLiveClienttToolResponse(t,o){let r=[];if(o.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(o.functionResponses)?r=o.functionResponses:r=[o.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(const i of r){if(typeof i!="object"||i===null||!("name"in i)||!("response"in i))throw new Error(`Could not parse function response, type '${typeof i}'.`);if(!t.isVertexAI()&&!("id"in i))throw new Error(zS)}return{toolResponse:{functionResponses:r}}}sendClientContent(t){t=Object.assign(Object.assign({},FS),t);const o=this.tLiveClientContent(this.apiClient,t);this.conn.send(JSON.stringify(o))}sendRealtimeInput(t){let o={};this.apiClient.isVertexAI()?o={realtimeInput:l_(t)}:o={realtimeInput:s_(t)},this.conn.send(JSON.stringify(o))}sendToolResponse(t){if(t.functionResponses==null)throw new Error("Tool response parameters are required.");const o=this.tLiveClienttToolResponse(this.apiClient,t);this.conn.send(JSON.stringify(o))}close(){this.conn.close()}}function GS(e){const t={};return e.forEach((o,r)=>{t[r]=o}),t}function HS(e){const t=new Headers;for(const[o,r]of Object.entries(e))t.append(o,r);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const xg=10;function yg(e){var t,o,r;if(!((t=e==null?void 0:e.automaticFunctionCalling)===null||t===void 0)&&t.disable)return!0;let a=!1;for(const s of(o=e==null?void 0:e.tools)!==null&&o!==void 0?o:[])if(Sa(s)){a=!0;break}if(!a)return!0;const i=(r=e==null?void 0:e.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return i&&(i<0||!Number.isInteger(i))||i==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",i),!0):!1}function Sa(e){return"callTool"in e&&typeof e.callTool=="function"}function US(e){var t,o,r;return(r=(o=(t=e.config)===null||t===void 0?void 0:t.tools)===null||o===void 0?void 0:o.some(a=>Sa(a)))!==null&&r!==void 0?r:!1}function vg(e){var t;const o=[];return!((t=e==null?void 0:e.config)===null||t===void 0)&&t.tools&&e.config.tools.forEach((r,a)=>{if(Sa(r))return;const i=r;i.functionDeclarations&&i.functionDeclarations.length>0&&o.push(a)}),o}function wg(e){var t;return!(!((t=e==null?void 0:e.automaticFunctionCalling)===null||t===void 0)&&t.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class VS extends Jo{constructor(t){super(),this.apiClient=t,this.generateContent=async o=>{var r,a,i,s,l;const c=await this.processParamsMaybeAddMcpUsage(o);if(this.maybeMoveToResponseJsonSchem(o),!US(o)||yg(o.config))return await this.generateContentInternal(c);const d=vg(o);if(d.length>0){const C=d.map(w=>`tools[${w}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${C}.`)}let u,p;const h=ro(c.contents),x=(i=(a=(r=c.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||a===void 0?void 0:a.maximumRemoteCalls)!==null&&i!==void 0?i:xg;let k=0;for(;k<x&&(u=await this.generateContentInternal(c),!(!u.functionCalls||u.functionCalls.length===0));){const C=u.candidates[0].content,w=[];for(const f of(l=(s=o.config)===null||s===void 0?void 0:s.tools)!==null&&l!==void 0?l:[])if(Sa(f)){const v=await f.callTool(u.functionCalls);w.push(...v)}k++,p={role:"user",parts:w},c.contents=ro(c.contents),c.contents.push(C),c.contents.push(p),wg(c.config)&&(h.push(C),h.push(p))}return wg(c.config)&&(u.automaticFunctionCallingHistory=h),u},this.generateContentStream=async o=>{var r,a,i,s,l;if(this.maybeMoveToResponseJsonSchem(o),yg(o.config)){const p=await this.processParamsMaybeAddMcpUsage(o);return await this.generateContentStreamInternal(p)}const c=vg(o);if(c.length>0){const p=c.map(h=>`tools[${h}]`).join(", ");throw new Error(`Incompatible tools found at ${p}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const d=(i=(a=(r=o==null?void 0:o.config)===null||r===void 0?void 0:r.toolConfig)===null||a===void 0?void 0:a.functionCallingConfig)===null||i===void 0?void 0:i.streamFunctionCallArguments,u=(l=(s=o==null?void 0:o.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||l===void 0?void 0:l.disable;if(d&&!u)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(o)},this.generateImages=async o=>await this.generateImagesInternal(o).then(r=>{var a;let i;const s=[];if(r!=null&&r.generatedImages)for(const c of r.generatedImages)c&&(c!=null&&c.safetyAttributes)&&((a=c==null?void 0:c.safetyAttributes)===null||a===void 0?void 0:a.contentType)==="Positive Prompt"?i=c==null?void 0:c.safetyAttributes:s.push(c);let l;return i?l={generatedImages:s,positivePromptSafetyAttributes:i,sdkHttpResponse:r.sdkHttpResponse}:l={generatedImages:s,sdkHttpResponse:r.sdkHttpResponse},l}),this.list=async o=>{var r;const s={config:Object.assign(Object.assign({},{queryBase:!0}),o==null?void 0:o.config)};if(this.apiClient.isVertexAI()&&!s.config.queryBase){if(!((r=s.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");s.config.filter="labels.tune-type:*"}return new Wr($o.PAGED_ITEM_MODELS,l=>this.listInternal(l),await this.listInternal(s),s)},this.editImage=async o=>{const r={model:o.model,prompt:o.prompt,referenceImages:[],config:o.config};return o.referenceImages&&o.referenceImages&&(r.referenceImages=o.referenceImages.map(a=>a.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async o=>{let r={numberOfImages:1,mode:"upscale"};o.config&&(r=Object.assign(Object.assign({},r),o.config));const a={model:o.model,image:o.image,upscaleFactor:o.upscaleFactor,config:r};return await this.upscaleImageInternal(a)},this.generateVideos=async o=>{var r,a,i,s,l,c;if((o.prompt||o.image||o.video)&&o.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((r=o.video)===null||r===void 0)&&r.uri&&(!((a=o.video)===null||a===void 0)&&a.videoBytes)?o.video={uri:o.video.uri,mimeType:o.video.mimeType}:!((s=(i=o.source)===null||i===void 0?void 0:i.video)===null||s===void 0)&&s.uri&&(!((c=(l=o.source)===null||l===void 0?void 0:l.video)===null||c===void 0)&&c.videoBytes)&&(o.source.video={uri:o.source.video.uri,mimeType:o.source.video.mimeType})),await this.generateVideosInternal(o)}}maybeMoveToResponseJsonSchem(t){t.config&&t.config.responseSchema&&(t.config.responseJsonSchema||Object.keys(t.config.responseSchema).includes("$schema")&&(t.config.responseJsonSchema=t.config.responseSchema,delete t.config.responseSchema))}async processParamsMaybeAddMcpUsage(t){var o,r,a;const i=(o=t.config)===null||o===void 0?void 0:o.tools;if(!i)return t;const s=await Promise.all(i.map(async c=>Sa(c)?await c.tool():c)),l={model:t.model,contents:t.contents,config:Object.assign(Object.assign({},t.config),{tools:s})};if(l.config.tools=s,t.config&&t.config.tools&&o1(t.config.tools)){const c=(a=(r=t.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&a!==void 0?a:{};let d=Object.assign({},c);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),r1(d),l.config.httpOptions=Object.assign(Object.assign({},t.config.httpOptions),{headers:d})}return l}async initAfcToolsMap(t){var o,r,a;const i=new Map;for(const s of(r=(o=t.config)===null||o===void 0?void 0:o.tools)!==null&&r!==void 0?r:[])if(Sa(s)){const l=s,c=await l.tool();for(const d of(a=c.functionDeclarations)!==null&&a!==void 0?a:[]){if(!d.name)throw new Error("Function declaration name is required.");if(i.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);i.set(d.name,l)}}return i}async processAfcStream(t){var o,r,a;const i=(a=(r=(o=t.config)===null||o===void 0?void 0:o.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&a!==void 0?a:xg;let s=!1,l=0;const c=await this.initAfcToolsMap(t);return function(d,u,p){return xo(this,arguments,function*(){for(var h,x,k,C,w,f;l<i;){s&&(l++,s=!1);const S=yield bt(d.processParamsMaybeAddMcpUsage(p)),T=yield bt(d.generateContentStreamInternal(S)),P=[],R=[];try{for(var g=!0,v=(x=void 0,yo(T)),_;_=yield bt(v.next()),h=_.done,!h;g=!0){C=_.value,g=!1;const D=C;if(yield yield bt(D),D.candidates&&(!((w=D.candidates[0])===null||w===void 0)&&w.content)){R.push(D.candidates[0].content);for(const q of(f=D.candidates[0].content.parts)!==null&&f!==void 0?f:[])if(l<i&&q.functionCall){if(!q.functionCall.name)throw new Error("Function call name was not returned by the model.");if(u.has(q.functionCall.name)){const O=yield bt(u.get(q.functionCall.name).callTool([q.functionCall]));P.push(...O)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${u.keys()}, mising tool: ${q.functionCall.name}`)}}}}catch(D){x={error:D}}finally{try{!g&&!h&&(k=v.return)&&(yield bt(k.call(v)))}finally{if(x)throw x.error}}if(P.length>0){s=!0;const D=new ei;D.candidates=[{content:{role:"user",parts:P}}],yield yield bt(D);const q=[];q.push(...R),q.push({role:"user",parts:P});const O=ro(p.contents).concat(q);p.contents=O}else break}})}(this,c,t)}async generateContentInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=hg(this.apiClient,t);return l=it("{model}:generateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=gg(u),h=new ei;return Object.assign(h,p),h})}else{const d=pg(this.apiClient,t);return l=it("{model}:generateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=mg(u),h=new ei;return Object.assign(h,p),h})}}async generateContentStreamInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=hg(this.apiClient,t);return l=it("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}),s.then(function(p){return xo(this,arguments,function*(){var h,x,k,C;try{for(var w=!0,f=yo(p),g;g=yield bt(f.next()),h=g.done,!h;w=!0){C=g.value,w=!1;const v=C,_=gg(yield bt(v.json()));_.sdkHttpResponse={headers:v.headers};const S=new ei;Object.assign(S,_),yield yield bt(S)}}catch(v){x={error:v}}finally{try{!w&&!h&&(k=f.return)&&(yield bt(k.call(f)))}finally{if(x)throw x.error}}})})}else{const d=pg(this.apiClient,t);return l=it("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}),s.then(function(p){return xo(this,arguments,function*(){var h,x,k,C;try{for(var w=!0,f=yo(p),g;g=yield bt(f.next()),h=g.done,!h;w=!0){C=g.value,w=!1;const v=C,_=mg(yield bt(v.json()));_.sdkHttpResponse={headers:v.headers};const S=new ei;Object.assign(S,_),yield yield bt(S)}}catch(v){x={error:v}}finally{try{!w&&!h&&(k=f.return)&&(yield bt(k.call(f)))}finally{if(x)throw x.error}}})})}}async embedContent(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=O_(this.apiClient,t);return l=it("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=B_(u),h=new Jm;return Object.assign(h,p),h})}else{const d=q_(this.apiClient,t);return l=it("{model}:batchEmbedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=F_(u),h=new Jm;return Object.assign(h,p),h})}}async generateImagesInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=Z_(this.apiClient,t);return l=it("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=e4(u),h=new Ym;return Object.assign(h,p),h})}else{const d=X_(this.apiClient,t);return l=it("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=Q_(u),h=new Ym;return Object.assign(h,p),h})}}async editImageInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=R_(this.apiClient,t);return i=it("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>{const d=L_(c),u=new HC;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=Z4(this.apiClient,t);return i=it("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>{const d=Q4(c),u=new UC;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=M4(this.apiClient,t);return i=it("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=R4(c),u=new VC;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=F4(this.apiClient,t);return i=it("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=B4(c),u=new WC;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async get(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=x4(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>ru(u))}else{const d=f4(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>ou(u))}}async listInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=N4(this.apiClient,t);return l=it("{models_url}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=P4(u),h=new Xm;return Object.assign(h,p),h})}else{const d=S4(this.apiClient,t);return l=it("{models_url}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=E4(u),h=new Xm;return Object.assign(h,p),h})}}async update(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=Y4(this.apiClient,t);return l=it("{model}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>ru(u))}else{const d=J4(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>ou(u))}}async delete(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=I_(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=A_(u),h=new Zm;return Object.assign(h,p),h})}else{const d=T_(this.apiClient,t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=j_(u),h=new Zm;return Object.assign(h,p),h})}}async countTokens(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=N_(this.apiClient,t);return l=it("{model}:countTokens",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=P_(u),h=new Qm;return Object.assign(h,p),h})}else{const d=S_(this.apiClient,t);return l=it("{model}:countTokens",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=E_(u),h=new Qm;return Object.assign(h,p),h})}}async computeTokens(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=y_(this.apiClient,t);return i=it("{model}:computeTokens",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>{const d=v_(c),u=new $C;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=i4(this.apiClient,t);return l=it("{model}:predictLongRunning",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s.then(u=>{const p=r4(u),h=new xl;return Object.assign(h,p),h})}else{const d=a4(this.apiClient,t);return l=it("{model}:predictLongRunning",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>{const p=o4(u),h=new xl;return Object.assign(h,p),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class WS extends Jo{constructor(t){super(),this.apiClient=t}async getVideosOperation(t){const o=t.operation,r=t.config;if(o.name===void 0||o.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=o.name.split("/operations/")[0];let i;r&&"httpOptions"in r&&(i=r.httpOptions);const s=await this.fetchPredictVideosOperationInternal({operationName:o.name,resourceName:a,config:{httpOptions:i}});return o._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{const a=await this.getVideosOperationInternal({operationName:o.name,config:r});return o._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async get(t){const o=t.operation,r=t.config;if(o.name===void 0||o.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=o.name.split("/operations/")[0];let i;r&&"httpOptions"in r&&(i=r.httpOptions);const s=await this.fetchPredictVideosOperationInternal({operationName:o.name,resourceName:a,config:{httpOptions:i}});return o._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{const a=await this.getVideosOperationInternal({operationName:o.name,config:r});return o._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async getVideosOperationInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=zC(t);return l=it("{operationName}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),s}else{const d=DC(t);return l=it("{operationName}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s}}async fetchPredictVideosOperationInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=TC(t);return i=it("{resourceName}:fetchPredictOperation",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function $S(e){const t={},o=m(e,["data"]);if(o!=null&&b(t,["data"],o),m(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(e,["mimeType"]);return r!=null&&b(t,["mimeType"],r),t}function KS(e){const t={},o=m(e,["parts"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(i=>oN(i))),b(t,["parts"],a)}const r=m(e,["role"]);return r!=null&&b(t,["role"],r),t}function JS(e,t,o){const r={},a=m(t,["expireTime"]);o!==void 0&&a!=null&&b(o,["expireTime"],a);const i=m(t,["newSessionExpireTime"]);o!==void 0&&i!=null&&b(o,["newSessionExpireTime"],i);const s=m(t,["uses"]);o!==void 0&&s!=null&&b(o,["uses"],s);const l=m(t,["liveConnectConstraints"]);o!==void 0&&l!=null&&b(o,["bidiGenerateContentSetup"],nN(e,l));const c=m(t,["lockAdditionalFields"]);return o!==void 0&&c!=null&&b(o,["fieldMask"],c),r}function YS(e,t){const o={},r=m(t,["config"]);return r!=null&&b(o,["config"],JS(e,r,o)),o}function XS(e){const t={};if(m(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=m(e,["fileUri"]);o!=null&&b(t,["fileUri"],o);const r=m(e,["mimeType"]);return r!=null&&b(t,["mimeType"],r),t}function ZS(e){const t={},o=m(e,["id"]);o!=null&&b(t,["id"],o);const r=m(e,["args"]);r!=null&&b(t,["args"],r);const a=m(e,["name"]);if(a!=null&&b(t,["name"],a),m(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(m(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function QS(e){const t={};if(m(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const o=m(e,["enableWidget"]);return o!=null&&b(t,["enableWidget"],o),t}function eN(e){const t={};if(m(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const o=m(e,["timeRangeFilter"]);return o!=null&&b(t,["timeRangeFilter"],o),t}function tN(e,t){const o={},r=m(e,["generationConfig"]);t!==void 0&&r!=null&&b(t,["setup","generationConfig"],r);const a=m(e,["responseModalities"]);t!==void 0&&a!=null&&b(t,["setup","generationConfig","responseModalities"],a);const i=m(e,["temperature"]);t!==void 0&&i!=null&&b(t,["setup","generationConfig","temperature"],i);const s=m(e,["topP"]);t!==void 0&&s!=null&&b(t,["setup","generationConfig","topP"],s);const l=m(e,["topK"]);t!==void 0&&l!=null&&b(t,["setup","generationConfig","topK"],l);const c=m(e,["maxOutputTokens"]);t!==void 0&&c!=null&&b(t,["setup","generationConfig","maxOutputTokens"],c);const d=m(e,["mediaResolution"]);t!==void 0&&d!=null&&b(t,["setup","generationConfig","mediaResolution"],d);const u=m(e,["seed"]);t!==void 0&&u!=null&&b(t,["setup","generationConfig","seed"],u);const p=m(e,["speechConfig"]);t!==void 0&&p!=null&&b(t,["setup","generationConfig","speechConfig"],bp(p));const h=m(e,["thinkingConfig"]);t!==void 0&&h!=null&&b(t,["setup","generationConfig","thinkingConfig"],h);const x=m(e,["enableAffectiveDialog"]);t!==void 0&&x!=null&&b(t,["setup","generationConfig","enableAffectiveDialog"],x);const k=m(e,["systemInstruction"]);t!==void 0&&k!=null&&b(t,["setup","systemInstruction"],KS(En(k)));const C=m(e,["tools"]);if(t!==void 0&&C!=null){let T=Ha(C);Array.isArray(T)&&(T=T.map(P=>aN(Ga(P)))),b(t,["setup","tools"],T)}const w=m(e,["sessionResumption"]);t!==void 0&&w!=null&&b(t,["setup","sessionResumption"],rN(w));const f=m(e,["inputAudioTranscription"]);t!==void 0&&f!=null&&b(t,["setup","inputAudioTranscription"],f);const g=m(e,["outputAudioTranscription"]);t!==void 0&&g!=null&&b(t,["setup","outputAudioTranscription"],g);const v=m(e,["realtimeInputConfig"]);t!==void 0&&v!=null&&b(t,["setup","realtimeInputConfig"],v);const _=m(e,["contextWindowCompression"]);t!==void 0&&_!=null&&b(t,["setup","contextWindowCompression"],_);const S=m(e,["proactivity"]);if(t!==void 0&&S!=null&&b(t,["setup","proactivity"],S),m(e,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return o}function nN(e,t){const o={},r=m(t,["model"]);r!=null&&b(o,["setup","model"],zt(e,r));const a=m(t,["config"]);return a!=null&&b(o,["config"],tN(a,o)),o}function oN(e){const t={},o=m(e,["mediaResolution"]);o!=null&&b(t,["mediaResolution"],o);const r=m(e,["codeExecutionResult"]);r!=null&&b(t,["codeExecutionResult"],r);const a=m(e,["executableCode"]);a!=null&&b(t,["executableCode"],a);const i=m(e,["fileData"]);i!=null&&b(t,["fileData"],XS(i));const s=m(e,["functionCall"]);s!=null&&b(t,["functionCall"],ZS(s));const l=m(e,["functionResponse"]);l!=null&&b(t,["functionResponse"],l);const c=m(e,["inlineData"]);c!=null&&b(t,["inlineData"],$S(c));const d=m(e,["text"]);d!=null&&b(t,["text"],d);const u=m(e,["thought"]);u!=null&&b(t,["thought"],u);const p=m(e,["thoughtSignature"]);p!=null&&b(t,["thoughtSignature"],p);const h=m(e,["videoMetadata"]);return h!=null&&b(t,["videoMetadata"],h),t}function rN(e){const t={},o=m(e,["handle"]);if(o!=null&&b(t,["handle"],o),m(e,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function aN(e){const t={},o=m(e,["functionDeclarations"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(p=>p)),b(t,["functionDeclarations"],u)}if(m(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(e,["googleSearchRetrieval"]);r!=null&&b(t,["googleSearchRetrieval"],r);const a=m(e,["computerUse"]);a!=null&&b(t,["computerUse"],a);const i=m(e,["fileSearch"]);i!=null&&b(t,["fileSearch"],i);const s=m(e,["codeExecution"]);if(s!=null&&b(t,["codeExecution"],s),m(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=m(e,["googleMaps"]);l!=null&&b(t,["googleMaps"],QS(l));const c=m(e,["googleSearch"]);c!=null&&b(t,["googleSearch"],eN(c));const d=m(e,["urlContext"]);return d!=null&&b(t,["urlContext"],d),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function iN(e){const t=[];for(const o in e)if(Object.prototype.hasOwnProperty.call(e,o)){const r=e[o];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){const a=Object.keys(r).map(i=>`${o}.${i}`);t.push(...a)}else t.push(o)}return t.join(",")}function sN(e,t){let o=null;const r=e.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){const i=r.setup;typeof i=="object"&&i!==null?(e.bidiGenerateContentSetup=i,o=i):delete e.bidiGenerateContentSetup}else r!==void 0&&delete e.bidiGenerateContentSetup;const a=e.fieldMask;if(o){const i=iN(o);if(Array.isArray(t==null?void 0:t.lockAdditionalFields)&&(t==null?void 0:t.lockAdditionalFields.length)===0)i?e.fieldMask=i:delete e.fieldMask;else if(t!=null&&t.lockAdditionalFields&&t.lockAdditionalFields.length>0&&a!==null&&Array.isArray(a)&&a.length>0){const s=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let l=[];a.length>0&&(l=a.map(d=>s.includes(d)?`generationConfig.${d}`:d));const c=[];i&&c.push(i),l.length>0&&c.push(...l),c.length>0?e.fieldMask=c.join(","):delete e.fieldMask}else delete e.fieldMask}else a!==null&&Array.isArray(a)&&a.length>0?e.fieldMask=a.join(","):delete e.fieldMask;return e}class lN extends Jo{constructor(t){super(),this.apiClient=t}async create(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const l=YS(this.apiClient,t);i=it("auth_tokens",l._url),s=l._query,delete l.config,delete l._url,delete l._query;const c=sN(l,t.config);return a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>d)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function cN(e,t){const o={},r=m(e,["force"]);return t!==void 0&&r!=null&&b(t,["_query","force"],r),o}function dN(e){const t={},o=m(e,["name"]);o!=null&&b(t,["_url","name"],o);const r=m(e,["config"]);return r!=null&&cN(r,t),t}function uN(e){const t={},o=m(e,["name"]);return o!=null&&b(t,["_url","name"],o),t}function pN(e,t){const o={},r=m(e,["pageSize"]);t!==void 0&&r!=null&&b(t,["_query","pageSize"],r);const a=m(e,["pageToken"]);return t!==void 0&&a!=null&&b(t,["_query","pageToken"],a),o}function hN(e){const t={},o=m(e,["parent"]);o!=null&&b(t,["_url","parent"],o);const r=m(e,["config"]);return r!=null&&pN(r,t),t}function mN(e){const t={},o=m(e,["sdkHttpResponse"]);o!=null&&b(t,["sdkHttpResponse"],o);const r=m(e,["nextPageToken"]);r!=null&&b(t,["nextPageToken"],r);const a=m(e,["documents"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),b(t,["documents"],i)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class gN extends Jo{constructor(t){super(),this.apiClient=t,this.list=async o=>new Wr($o.PAGED_ITEM_DOCUMENTS,r=>this.listInternal({parent:o.parent,config:r.config}),await this.listInternal(o),o)}async get(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=uN(t);return i=it("{name}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async delete(t){var o,r;let a="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=dN(t);a=it("{name}",s._url),i=s._query,delete s._url,delete s._query,await this.apiClient.request({path:a,queryParams:i,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=hN(t);return i=it("{parent}/documents",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=mN(c),u=new KC;return Object.assign(u,d),u})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class fN extends Jo{constructor(t,o=new gN(t)){super(),this.apiClient=t,this.documents=o,this.list=async(r={})=>new Wr($o.PAGED_ITEM_FILE_SEARCH_STORES,a=>this.listInternal(a),await this.listInternal(r),r)}async uploadToFileSearchStore(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(t.fileSearchStoreName,t.file,t.config)}async create(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=iS(t);return i=it("fileSearchStores",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async get(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=cS(t);return i=it("{name}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async delete(t){var o,r;let a="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=lS(t);a=it("{name}",s._url),i=s._query,delete s._url,delete s._query,await this.apiClient.request({path:a,queryParams:i,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=gS(t);return i=it("fileSearchStores",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=fS(c),u=new JC;return Object.assign(u,d),u})}}async uploadToFileSearchStoreInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=xS(t);return i=it("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=yS(c),u=new YC;return Object.assign(u,d),u})}}async importFile(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=pS(t);return i=it("{file_search_store_name}:importFile",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=uS(c),u=new fp;return Object.assign(u,d),u})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let a1=function(){const{crypto:e}=globalThis;if(e!=null&&e.randomUUID)return a1=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),o=e?()=>e.getRandomValues(t)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^o()&15>>+r/4).toString(16))};const xN=()=>a1();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function iu(e){return typeof e=="object"&&e!==null&&("name"in e&&e.name==="AbortError"||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const su=e=>{if(e instanceof Error)return e;if(typeof e=="object"&&e!==null){try{if(Object.prototype.toString.call(e)==="[object Error]"){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class so extends Error{}class Rn extends so{constructor(t,o,r,a){super(`${Rn.makeMessage(t,o,r)}`),this.status=t,this.headers=a,this.error=o}static makeMessage(t,o,r){const a=o!=null&&o.message?typeof o.message=="string"?o.message:JSON.stringify(o.message):o?JSON.stringify(o):r;return t&&a?`${t} ${a}`:t?`${t} status code (no body)`:a||"(no status code or body)"}static generate(t,o,r,a){if(!t||!a)return new Wl({message:r,cause:su(o)});const i=o;return t===400?new s1(t,i,r,a):t===401?new l1(t,i,r,a):t===403?new c1(t,i,r,a):t===404?new d1(t,i,r,a):t===409?new u1(t,i,r,a):t===422?new p1(t,i,r,a):t===429?new h1(t,i,r,a):t>=500?new m1(t,i,r,a):new Rn(t,i,r,a)}}class lu extends Rn{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}}class Wl extends Rn{constructor({message:t,cause:o}){super(void 0,void 0,t||"Connection error.",void 0),o&&(this.cause=o)}}class i1 extends Wl{constructor({message:t}={}){super({message:t??"Request timed out."})}}class s1 extends Rn{}class l1 extends Rn{}class c1 extends Rn{}class d1 extends Rn{}class u1 extends Rn{}class p1 extends Rn{}class h1 extends Rn{}class m1 extends Rn{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const yN=/^[a-z][a-z0-9+.-]*:/i,vN=e=>yN.test(e);let cu=e=>(cu=Array.isArray,cu(e));const wN=cu;let bN=wN;const bg=bN;function CN(e){if(!e)return!0;for(const t in e)return!1;return!0}function kN(e,t){return Object.prototype.hasOwnProperty.call(e,t)}const _N=(e,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new so(`${e} must be an integer`);if(t<0)throw new so(`${e} must be a positive integer`);return t},SN=e=>{try{return JSON.parse(e)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const NN=e=>new Promise(t=>setTimeout(t,e));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const oa="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function EN(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const PN=()=>{var e,t,o,r,a;const i=EN();if(i==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":oa,"X-Stainless-OS":kg(Deno.build.os),"X-Stainless-Arch":Cg(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(t=(e=Deno.version)===null||e===void 0?void 0:e.deno)!==null&&t!==void 0?t:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":oa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(i==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":oa,"X-Stainless-OS":kg((o=globalThis.process.platform)!==null&&o!==void 0?o:"unknown"),"X-Stainless-Arch":Cg((r=globalThis.process.arch)!==null&&r!==void 0?r:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(a=globalThis.process.version)!==null&&a!==void 0?a:"unknown"};const s=TN();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":oa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":oa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function TN(){if(typeof navigator>"u"||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:o}of e){const r=o.exec(navigator.userAgent);if(r){const a=r[1]||0,i=r[2]||0,s=r[3]||0;return{browser:t,version:`${a}.${i}.${s}`}}}return null}const Cg=e=>e==="x32"?"x32":e==="x86_64"||e==="x64"?"x64":e==="arm"?"arm":e==="aarch64"||e==="arm64"?"arm64":e?`other:${e}`:"unknown",kg=e=>(e=e.toLowerCase(),e.includes("ios")?"iOS":e==="android"?"Android":e==="darwin"?"MacOS":e==="win32"?"Windows":e==="freebsd"?"FreeBSD":e==="openbsd"?"OpenBSD":e==="linux"?"Linux":e?`Other:${e}`:"Unknown");let cs;const IN=()=>cs??(cs=PN());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function jN(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function g1(...e){const t=globalThis.ReadableStream;if(typeof t>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function AN(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return g1({start(){},async pull(o){const{done:r,value:a}=await t.next();r?o.close():o.enqueue(a)},async cancel(){var o;await((o=t.return)===null||o===void 0?void 0:o.call(t))}})}function f1(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const o=await t.read();return o!=null&&o.done&&t.releaseLock(),o}catch(o){throw t.releaseLock(),o}},async return(){const o=t.cancel();return t.releaseLock(),await o,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function MN(e){var t,o;if(e===null||typeof e!="object")return;if(e[Symbol.asyncIterator]){await((o=(t=e[Symbol.asyncIterator]()).return)===null||o===void 0?void 0:o.call(t));return}const r=e.getReader(),a=r.cancel();r.releaseLock(),await a}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const RN=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const x1=()=>{var e;if(typeof File>"u"){const{process:t}=globalThis,o=typeof((e=t==null?void 0:t.versions)===null||e===void 0?void 0:e.node)=="string"&&parseInt(t.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(o?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function $c(e,t,o){return x1(),new File(e,t??"unknown_file",o)}function LN(e){return(typeof e=="object"&&e!==null&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const DN=e=>e!=null&&typeof e=="object"&&typeof e[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const y1=e=>e!=null&&typeof e=="object"&&typeof e.size=="number"&&typeof e.type=="string"&&typeof e.text=="function"&&typeof e.slice=="function"&&typeof e.arrayBuffer=="function",zN=e=>e!=null&&typeof e=="object"&&typeof e.name=="string"&&typeof e.lastModified=="number"&&y1(e),qN=e=>e!=null&&typeof e=="object"&&typeof e.url=="string"&&typeof e.blob=="function";async function ON(e,t,o){if(x1(),e=await e,zN(e))return e instanceof File?e:$c([await e.arrayBuffer()],e.name);if(qN(e)){const a=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),$c(await du(a),t,o)}const r=await du(e);if(t||(t=LN(e)),!(o!=null&&o.type)){const a=r.find(i=>typeof i=="object"&&"type"in i&&i.type);typeof a=="string"&&(o=Object.assign(Object.assign({},o),{type:a}))}return $c(r,t,o)}async function du(e){var t,o,r,a,i;let s=[];if(typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)s.push(e);else if(y1(e))s.push(e instanceof Blob?e:await e.arrayBuffer());else if(DN(e))try{for(var l=!0,c=yo(e),d;d=await c.next(),t=d.done,!t;l=!0){a=d.value,l=!1;const u=a;s.push(...await du(u))}}catch(u){o={error:u}}finally{try{!l&&!t&&(r=c.return)&&await r.call(c)}finally{if(o)throw o.error}}else{const u=(i=e==null?void 0:e.constructor)===null||i===void 0?void 0:i.name;throw new Error(`Unexpected data type: ${typeof e}${u?`; constructor: ${u}`:""}${FN(e)}`)}return s}function FN(e){return typeof e!="object"||e===null?"":`; props: [${Object.getOwnPropertyNames(e).map(o=>`"${o}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class v1{constructor(t){this._client=t}}v1._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function w1(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const _g=Object.freeze(Object.create(null)),BN=(e=w1)=>function(o,...r){if(o.length===1)return o[0];let a=!1;const i=[],s=o.reduce((u,p,h)=>{var x,k,C;/[?#]/.test(p)&&(a=!0);const w=r[h];let f=(a?encodeURIComponent:e)(""+w);return h!==r.length&&(w==null||typeof w=="object"&&w.toString===((C=Object.getPrototypeOf((k=Object.getPrototypeOf((x=w.hasOwnProperty)!==null&&x!==void 0?x:_g))!==null&&k!==void 0?k:_g))===null||C===void 0?void 0:C.toString))&&(f=w+"",i.push({start:u.length+p.length,length:f.length,error:`Value of type ${Object.prototype.toString.call(w).slice(8,-1)} is not a valid path parameter`})),u+p+(h===r.length?"":f)},""),l=s.split(/[?#]/,1)[0],c=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let d;for(;(d=c.exec(l))!==null;)i.push({start:d.index,length:d[0].length,error:`Value "${d[0]}" can't be safely passed as a path parameter`});if(i.sort((u,p)=>u.start-p.start),i.length>0){let u=0;const p=i.reduce((h,x)=>{const k=" ".repeat(x.start-u),C="^".repeat(x.length);return u=x.start+x.length,h+k+C},"");throw new so(`Path parameters result in path with invalid segments:
${i.map(h=>h.error).join(`
`)}
${s}
${p}`)}return s},ds=BN(w1);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class b1 extends v1{create(t,o){var r;const{api_version:a=this._client.apiVersion}=t,i=vl(t,["api_version"]);if("model"in i&&"agent_config"in i)throw new so("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in i&&"generation_config"in i)throw new so("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(ds`/${a}/interactions`,Object.assign(Object.assign({body:i},o),{stream:(r=t.stream)!==null&&r!==void 0?r:!1}))}delete(t,o={},r){const{api_version:a=this._client.apiVersion}=o??{};return this._client.delete(ds`/${a}/interactions/${t}`,r)}cancel(t,o={},r){const{api_version:a=this._client.apiVersion}=o??{};return this._client.post(ds`/${a}/interactions/${t}/cancel`,r)}get(t,o={},r){var a;const i=o??{},{api_version:s=this._client.apiVersion}=i,l=vl(i,["api_version"]);return this._client.get(ds`/${s}/interactions/${t}`,Object.assign(Object.assign({query:l},r),{stream:(a=o==null?void 0:o.stream)!==null&&a!==void 0?a:!1}))}}b1._key=Object.freeze(["interactions"]);class C1 extends b1{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function GN(e){let t=0;for(const a of e)t+=a.length;const o=new Uint8Array(t);let r=0;for(const a of e)o.set(a,r),r+=a.length;return o}let us;function kp(e){let t;return(us??(t=new globalThis.TextEncoder,us=t.encode.bind(t)))(e)}let ps;function Sg(e){let t;return(ps??(t=new globalThis.TextDecoder,ps=t.decode.bind(t)))(e)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class $l{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(t){if(t==null)return[];const o=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?kp(t):t;this.buffer=GN([this.buffer,o]);const r=[];let a;for(;(a=HN(this.buffer,this.carriageReturnIndex))!=null;){if(a.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=a.index;continue}if(this.carriageReturnIndex!=null&&(a.index!==this.carriageReturnIndex+1||a.carriage)){r.push(Sg(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const i=this.carriageReturnIndex!==null?a.preceding-1:a.preceding,s=Sg(this.buffer.subarray(0,i));r.push(s),this.buffer=this.buffer.subarray(a.index),this.carriageReturnIndex=null}return r}flush(){return this.buffer.length?this.decode(`
`):[]}}$l.NEWLINE_CHARS=new Set([`
`,"\r"]);$l.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function HN(e,t){for(let a=t??0;a<e.length;a++){if(e[a]===10)return{preceding:a,index:a+1,carriage:!1};if(e[a]===13)return{preceding:a,index:a+1,carriage:!0}}return null}function UN(e){for(let r=0;r<e.length-1;r++){if(e[r]===10&&e[r+1]===10||e[r]===13&&e[r+1]===13)return r+2;if(e[r]===13&&e[r+1]===10&&r+3<e.length&&e[r+2]===13&&e[r+3]===10)return r+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const wl={off:0,error:200,warn:300,info:400,debug:500},Ng=(e,t,o)=>{if(e){if(kN(wl,e))return e;In(o).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(wl))}`)}};function ii(){}function hs(e,t,o){return!t||wl[e]>wl[o]?ii:t[e].bind(t)}const VN={error:ii,warn:ii,info:ii,debug:ii};let Eg=new WeakMap;function In(e){var t;const o=e.logger,r=(t=e.logLevel)!==null&&t!==void 0?t:"off";if(!o)return VN;const a=Eg.get(o);if(a&&a[0]===r)return a[1];const i={error:hs("error",o,r),warn:hs("warn",o,r),info:hs("info",o,r),debug:hs("debug",o,r)};return Eg.set(o,[r,i]),i}const jr=e=>(e.options&&(e.options=Object.assign({},e.options),delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([t,o])=>[t,t.toLowerCase()==="x-goog-api-key"||t.toLowerCase()==="authorization"||t.toLowerCase()==="cookie"||t.toLowerCase()==="set-cookie"?"***":o]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class xa{constructor(t,o,r){this.iterator=t,this.controller=o,this.client=r}static fromSSEResponse(t,o,r){let a=!1;const i=r?In(r):console;function s(){return xo(this,arguments,function*(){var c,d,u,p;if(a)throw new so("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let h=!1;try{try{for(var x=!0,k=yo(WN(t,o)),C;C=yield bt(k.next()),c=C.done,!c;x=!0){p=C.value,x=!1;const w=p;if(!h)if(w.data.startsWith("[DONE]")){h=!0;continue}else try{yield yield bt(JSON.parse(w.data))}catch(f){throw i.error("Could not parse message into JSON:",w.data),i.error("From chunk:",w.raw),f}}}catch(w){d={error:w}}finally{try{!x&&!c&&(u=k.return)&&(yield bt(u.call(k)))}finally{if(d)throw d.error}}h=!0}catch(w){if(iu(w))return yield bt(void 0);throw w}finally{h||o.abort()}})}return new xa(s,o,r)}static fromReadableStream(t,o,r){let a=!1;function i(){return xo(this,arguments,function*(){var c,d,u,p;const h=new $l,x=f1(t);try{for(var k=!0,C=yo(x),w;w=yield bt(C.next()),c=w.done,!c;k=!0){p=w.value,k=!1;const f=p;for(const g of h.decode(f))yield yield bt(g)}}catch(f){d={error:f}}finally{try{!k&&!c&&(u=C.return)&&(yield bt(u.call(C)))}finally{if(d)throw d.error}}for(const f of h.flush())yield yield bt(f)})}function s(){return xo(this,arguments,function*(){var c,d,u,p;if(a)throw new so("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let h=!1;try{try{for(var x=!0,k=yo(i()),C;C=yield bt(k.next()),c=C.done,!c;x=!0){p=C.value,x=!1;const w=p;h||w&&(yield yield bt(JSON.parse(w)))}}catch(w){d={error:w}}finally{try{!x&&!c&&(u=k.return)&&(yield bt(u.call(k)))}finally{if(d)throw d.error}}h=!0}catch(w){if(iu(w))return yield bt(void 0);throw w}finally{h||o.abort()}})}return new xa(s,o,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){const t=[],o=[],r=this.iterator(),a=i=>({next:()=>{if(i.length===0){const s=r.next();t.push(s),o.push(s)}return i.shift()}});return[new xa(()=>a(t),this.controller,this.client),new xa(()=>a(o),this.controller,this.client)]}toReadableStream(){const t=this;let o;return g1({async start(){o=t[Symbol.asyncIterator]()},async pull(r){try{const{value:a,done:i}=await o.next();if(i)return r.close();const s=kp(JSON.stringify(a)+`
`);r.enqueue(s)}catch(a){r.error(a)}},async cancel(){var r;await((r=o.return)===null||r===void 0?void 0:r.call(o))}})}}function WN(e,t){return xo(this,arguments,function*(){var r,a,i,s;if(!e.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new so("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new so("Attempted to iterate over a response with no body");const l=new KN,c=new $l,d=f1(e.body);try{for(var u=!0,p=yo($N(d)),h;h=yield bt(p.next()),r=h.done,!r;u=!0){s=h.value,u=!1;const x=s;for(const k of c.decode(x)){const C=l.decode(k);C&&(yield yield bt(C))}}}catch(x){a={error:x}}finally{try{!u&&!r&&(i=p.return)&&(yield bt(i.call(p)))}finally{if(a)throw a.error}}for(const x of c.flush()){const k=l.decode(x);k&&(yield yield bt(k))}})}function $N(e){return xo(this,arguments,function*(){var o,r,a,i;let s=new Uint8Array;try{for(var l=!0,c=yo(e),d;d=yield bt(c.next()),o=d.done,!o;l=!0){i=d.value,l=!1;const u=i;if(u==null)continue;const p=u instanceof ArrayBuffer?new Uint8Array(u):typeof u=="string"?kp(u):u;let h=new Uint8Array(s.length+p.length);h.set(s),h.set(p,s.length),s=h;let x;for(;(x=UN(s))!==-1;)yield yield bt(s.slice(0,x)),s=s.slice(x)}}catch(u){r={error:u}}finally{try{!l&&!o&&(a=c.return)&&(yield bt(a.call(c)))}finally{if(r)throw r.error}}s.length>0&&(yield yield bt(s))})}class KN{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(t),t.startsWith(":"))return null;let[o,r,a]=JN(t,":");return a.startsWith(" ")&&(a=a.substring(1)),o==="event"?this.event=a:o==="data"&&this.data.push(a),null}}function JN(e,t){const o=e.indexOf(t);return o!==-1?[e.substring(0,o),t,e.substring(o+t.length)]:[e,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function YN(e,t){const{response:o,requestLogID:r,retryOfRequestLogID:a,startTime:i}=t,s=await(async()=>{var l;if(t.options.stream)return In(e).debug("response",o.status,o.url,o.headers,o.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(o,t.controller,e):xa.fromSSEResponse(o,t.controller,e);if(o.status===204)return null;if(t.options.__binaryResponse)return o;const c=o.headers.get("content-type"),d=(l=c==null?void 0:c.split(";")[0])===null||l===void 0?void 0:l.trim();return(d==null?void 0:d.includes("application/json"))||(d==null?void 0:d.endsWith("+json"))?await o.json():await o.text()})();return In(e).debug(`[${r}] response parsed`,jr({retryOfRequestLogID:a,url:o.url,status:o.status,body:s,durationMs:Date.now()-i})),s}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class _p extends Promise{constructor(t,o,r=YN){super(a=>{a(null)}),this.responsePromise=o,this.parseResponse=r,this.client=t}_thenUnwrap(t){return new _p(this.client,this.responsePromise,async(o,r)=>t(await this.parseResponse(o,r),r))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){const[t,o]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:o}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(t=>this.parseResponse(this.client,t))),this.parsedPromise}then(t,o){return this.parse().then(t,o)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const k1=Symbol("brand.privateNullableHeaders");function*XN(e){if(!e)return;if(k1 in e){const{values:r,nulls:a}=e;yield*r.entries();for(const i of a)yield[i,null];return}let t=!1,o;e instanceof Headers?o=e.entries():bg(e)?o=e:(t=!0,o=Object.entries(e??{}));for(let r of o){const a=r[0];if(typeof a!="string")throw new TypeError("expected header name to be a string");const i=bg(r[1])?r[1]:[r[1]];let s=!1;for(const l of i)l!==void 0&&(t&&!s&&(s=!0,yield[a,null]),yield[a,l])}}const ti=e=>{const t=new Headers,o=new Set;for(const r of e){const a=new Set;for(const[i,s]of XN(r)){const l=i.toLowerCase();a.has(l)||(t.delete(i),a.add(l)),s===null?(t.delete(i),o.add(l)):(t.append(i,s),o.delete(l))}}return{[k1]:!0,values:t,nulls:o}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Kc=e=>{var t,o,r,a,i,s;if(typeof globalThis.process<"u")return(r=(o=(t=kC)===null||t===void 0?void 0:t[e])===null||o===void 0?void 0:o.trim())!==null&&r!==void 0?r:void 0;if(typeof globalThis.Deno<"u")return(s=(i=(a=globalThis.Deno.env)===null||a===void 0?void 0:a.get)===null||i===void 0?void 0:i.call(a,e))===null||s===void 0?void 0:s.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var _1;class Kl{constructor(t){var o,r,a,i,s,l,c,{baseURL:d=Kc("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:u=(o=Kc("GEMINI_API_KEY"))!==null&&o!==void 0?o:null,apiVersion:p="v1beta"}=t,h=vl(t,["baseURL","apiKey","apiVersion"]);const x=Object.assign(Object.assign({apiKey:u,apiVersion:p},h),{baseURL:d||"https://generativelanguage.googleapis.com"});this.baseURL=x.baseURL,this.timeout=(r=x.timeout)!==null&&r!==void 0?r:Kl.DEFAULT_TIMEOUT,this.logger=(a=x.logger)!==null&&a!==void 0?a:console;const k="warn";this.logLevel=k,this.logLevel=(s=(i=Ng(x.logLevel,"ClientOptions.logLevel",this))!==null&&i!==void 0?i:Ng(Kc("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&s!==void 0?s:k,this.fetchOptions=x.fetchOptions,this.maxRetries=(l=x.maxRetries)!==null&&l!==void 0?l:2,this.fetch=(c=x.fetch)!==null&&c!==void 0?c:jN(),this.encoder=RN,this._options=x,this.apiKey=u,this.apiVersion=p,this.clientAdapter=x.clientAdapter}withOptions(t){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),t))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:o}){if(!(t.has("authorization")||t.has("x-goog-api-key"))&&!(this.apiKey&&t.get("x-goog-api-key"))&&!o.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(t){const o=ti([t.headers]);if(!(o.values.has("authorization")||o.values.has("x-goog-api-key"))){if(this.apiKey)return ti([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return ti([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(t){return Object.entries(t).filter(([o,r])=>typeof r<"u").map(([o,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(o)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(o)}=`;throw new so(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${oa}`}defaultIdempotencyKey(){return`stainless-node-retry-${xN()}`}makeStatusError(t,o,r,a){return Rn.generate(t,o,r,a)}buildURL(t,o,r){const a=!this.baseURLOverridden()&&r||this.baseURL,i=vN(t)?new URL(t):new URL(a+(a.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),s=this.defaultQuery();return CN(s)||(o=Object.assign(Object.assign({},s),o)),typeof o=="object"&&o&&!Array.isArray(o)&&(i.search=this.stringifyQuery(o)),i.toString()}async prepareOptions(t){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!t.path.startsWith(`/${this.apiVersion}/projects/`)){const o=t.path.slice(this.apiVersion.length+1);t.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${o}`}}async prepareRequest(t,{url:o,options:r}){}get(t,o){return this.methodRequest("get",t,o)}post(t,o){return this.methodRequest("post",t,o)}patch(t,o){return this.methodRequest("patch",t,o)}put(t,o){return this.methodRequest("put",t,o)}delete(t,o){return this.methodRequest("delete",t,o)}methodRequest(t,o,r){return this.request(Promise.resolve(r).then(a=>Object.assign({method:t,path:o},a)))}request(t,o=null){return new _p(this,this.makeRequest(t,o,void 0))}async makeRequest(t,o,r){var a,i,s;const l=await t,c=(a=l.maxRetries)!==null&&a!==void 0?a:this.maxRetries;o==null&&(o=c),await this.prepareOptions(l);const{req:d,url:u,timeout:p}=await this.buildRequest(l,{retryCount:c-o});await this.prepareRequest(d,{url:u,options:l});const h="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),x=r===void 0?"":`, retryOf: ${r}`,k=Date.now();if(In(this).debug(`[${h}] sending request`,jr({retryOfRequestLogID:r,method:l.method,url:u,options:l,headers:d.headers})),!((i=l.signal)===null||i===void 0)&&i.aborted)throw new lu;const C=new AbortController,w=await this.fetchWithTimeout(u,d,p,C).catch(su),f=Date.now();if(w instanceof globalThis.Error){const v=`retrying, ${o} attempts remaining`;if(!((s=l.signal)===null||s===void 0)&&s.aborted)throw new lu;const _=iu(w)||/timed? ?out/i.test(String(w)+("cause"in w?String(w.cause):""));if(o)return In(this).info(`[${h}] connection ${_?"timed out":"failed"} - ${v}`),In(this).debug(`[${h}] connection ${_?"timed out":"failed"} (${v})`,jr({retryOfRequestLogID:r,url:u,durationMs:f-k,message:w.message})),this.retryRequest(l,o,r??h);throw In(this).info(`[${h}] connection ${_?"timed out":"failed"} - error; no more retries left`),In(this).debug(`[${h}] connection ${_?"timed out":"failed"} (error; no more retries left)`,jr({retryOfRequestLogID:r,url:u,durationMs:f-k,message:w.message})),_?new i1:new Wl({cause:w})}const g=`[${h}${x}] ${d.method} ${u} ${w.ok?"succeeded":"failed"} with status ${w.status} in ${f-k}ms`;if(!w.ok){const v=await this.shouldRetry(w);if(o&&v){const D=`retrying, ${o} attempts remaining`;return await MN(w.body),In(this).info(`${g} - ${D}`),In(this).debug(`[${h}] response error (${D})`,jr({retryOfRequestLogID:r,url:w.url,status:w.status,headers:w.headers,durationMs:f-k})),this.retryRequest(l,o,r??h,w.headers)}const _=v?"error; no more retries left":"error; not retryable";In(this).info(`${g} - ${_}`);const S=await w.text().catch(D=>su(D).message),T=SN(S),P=T?void 0:S;throw In(this).debug(`[${h}] response error (${_})`,jr({retryOfRequestLogID:r,url:w.url,status:w.status,headers:w.headers,message:P,durationMs:Date.now()-k})),this.makeStatusError(w.status,T,P,w.headers)}return In(this).info(g),In(this).debug(`[${h}] response start`,jr({retryOfRequestLogID:r,url:w.url,status:w.status,headers:w.headers,durationMs:f-k})),{response:w,options:l,controller:C,requestLogID:h,retryOfRequestLogID:r,startTime:k}}async fetchWithTimeout(t,o,r,a){const i=o||{},{signal:s,method:l}=i,c=vl(i,["signal","method"]);s&&s.addEventListener("abort",()=>a.abort());const d=setTimeout(()=>a.abort(),r),u=globalThis.ReadableStream&&c.body instanceof globalThis.ReadableStream||typeof c.body=="object"&&c.body!==null&&Symbol.asyncIterator in c.body,p=Object.assign(Object.assign(Object.assign({signal:a.signal},u?{duplex:"half"}:{}),{method:"GET"}),c);l&&(p.method=l.toUpperCase());try{return await this.fetch.call(void 0,t,p)}finally{clearTimeout(d)}}async shouldRetry(t){const o=t.headers.get("x-should-retry");return o==="true"?!0:o==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,o,r,a){var i;let s;const l=a==null?void 0:a.get("retry-after-ms");if(l){const d=parseFloat(l);Number.isNaN(d)||(s=d)}const c=a==null?void 0:a.get("retry-after");if(c&&!s){const d=parseFloat(c);Number.isNaN(d)?s=Date.parse(c)-Date.now():s=d*1e3}if(!(s&&0<=s&&s<60*1e3)){const d=(i=t.maxRetries)!==null&&i!==void 0?i:this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(o,d)}return await NN(s),this.makeRequest(t,o-1,r)}calculateDefaultRetryTimeoutMillis(t,o){const i=o-t,s=Math.min(.5*Math.pow(2,i),8),l=1-Math.random()*.25;return s*l*1e3}async buildRequest(t,{retryCount:o=0}={}){var r,a,i;const s=Object.assign({},t),{method:l,path:c,query:d,defaultBaseURL:u}=s,p=this.buildURL(c,d,u);"timeout"in s&&_N("timeout",s.timeout),s.timeout=(r=s.timeout)!==null&&r!==void 0?r:this.timeout;const{bodyHeaders:h,body:x}=this.buildBody({options:s}),k=await this.buildHeaders({options:t,method:l,bodyHeaders:h,retryCount:o});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:l,headers:k},s.signal&&{signal:s.signal}),globalThis.ReadableStream&&x instanceof globalThis.ReadableStream&&{duplex:"half"}),x&&{body:x}),(a=this.fetchOptions)!==null&&a!==void 0?a:{}),(i=s.fetchOptions)!==null&&i!==void 0?i:{}),url:p,timeout:s.timeout}}async buildHeaders({options:t,method:o,bodyHeaders:r,retryCount:a}){let i={};this.idempotencyHeader&&o!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=t.idempotencyKey);const s=await this.authHeaders(t);let l=ti([i,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(a)},t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{}),IN()),this._options.defaultHeaders,r,t.headers,s]);return this.validateHeaders(l),l.values}buildBody({options:{body:t,headers:o}}){if(!t)return{bodyHeaders:void 0,body:void 0};const r=ti([o]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&r.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:AN(t)}:this.encoder({body:t,headers:r})}}Kl.DEFAULT_TIMEOUT=6e4;class fn extends Kl{constructor(){super(...arguments),this.interactions=new C1(this)}}_1=fn;fn.GeminiNextGenAPIClient=_1;fn.GeminiNextGenAPIClientError=so;fn.APIError=Rn;fn.APIConnectionError=Wl;fn.APIConnectionTimeoutError=i1;fn.APIUserAbortError=lu;fn.NotFoundError=d1;fn.ConflictError=u1;fn.RateLimitError=h1;fn.BadRequestError=s1;fn.AuthenticationError=l1;fn.InternalServerError=m1;fn.PermissionDeniedError=c1;fn.UnprocessableEntityError=p1;fn.toFile=ON;fn.Interactions=C1;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ZN(e,t){const o={},r=m(e,["name"]);return r!=null&&b(o,["_url","name"],r),o}function QN(e,t){const o={},r=m(e,["name"]);return r!=null&&b(o,["_url","name"],r),o}function eE(e,t){const o={},r=m(e,["sdkHttpResponse"]);return r!=null&&b(o,["sdkHttpResponse"],r),o}function tE(e,t){const o={},r=m(e,["sdkHttpResponse"]);return r!=null&&b(o,["sdkHttpResponse"],r),o}function nE(e,t,o){const r={};if(m(e,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const a=m(e,["tunedModelDisplayName"]);if(t!==void 0&&a!=null&&b(t,["displayName"],a),m(e,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const i=m(e,["epochCount"]);t!==void 0&&i!=null&&b(t,["tuningTask","hyperparameters","epochCount"],i);const s=m(e,["learningRateMultiplier"]);if(s!=null&&b(r,["tuningTask","hyperparameters","learningRateMultiplier"],s),m(e,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(m(e,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(m(e,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const l=m(e,["batchSize"]);t!==void 0&&l!=null&&b(t,["tuningTask","hyperparameters","batchSize"],l);const c=m(e,["learningRate"]);if(t!==void 0&&c!=null&&b(t,["tuningTask","hyperparameters","learningRate"],c),m(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(m(e,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return r}function oE(e,t,o){const r={};let a=m(o,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const x=m(e,["validationDataset"]);t!==void 0&&x!=null&&b(t,["supervisedTuningSpec"],Pg(x))}else if(a==="PREFERENCE_TUNING"){const x=m(e,["validationDataset"]);t!==void 0&&x!=null&&b(t,["preferenceOptimizationSpec"],Pg(x))}const i=m(e,["tunedModelDisplayName"]);t!==void 0&&i!=null&&b(t,["tunedModelDisplayName"],i);const s=m(e,["description"]);t!==void 0&&s!=null&&b(t,["description"],s);let l=m(o,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){const x=m(e,["epochCount"]);t!==void 0&&x!=null&&b(t,["supervisedTuningSpec","hyperParameters","epochCount"],x)}else if(l==="PREFERENCE_TUNING"){const x=m(e,["epochCount"]);t!==void 0&&x!=null&&b(t,["preferenceOptimizationSpec","hyperParameters","epochCount"],x)}let c=m(o,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){const x=m(e,["learningRateMultiplier"]);t!==void 0&&x!=null&&b(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],x)}else if(c==="PREFERENCE_TUNING"){const x=m(e,["learningRateMultiplier"]);t!==void 0&&x!=null&&b(t,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],x)}let d=m(o,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const x=m(e,["exportLastCheckpointOnly"]);t!==void 0&&x!=null&&b(t,["supervisedTuningSpec","exportLastCheckpointOnly"],x)}else if(d==="PREFERENCE_TUNING"){const x=m(e,["exportLastCheckpointOnly"]);t!==void 0&&x!=null&&b(t,["preferenceOptimizationSpec","exportLastCheckpointOnly"],x)}let u=m(o,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const x=m(e,["adapterSize"]);t!==void 0&&x!=null&&b(t,["supervisedTuningSpec","hyperParameters","adapterSize"],x)}else if(u==="PREFERENCE_TUNING"){const x=m(e,["adapterSize"]);t!==void 0&&x!=null&&b(t,["preferenceOptimizationSpec","hyperParameters","adapterSize"],x)}if(m(e,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(m(e,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const p=m(e,["labels"]);t!==void 0&&p!=null&&b(t,["labels"],p);const h=m(e,["beta"]);return t!==void 0&&h!=null&&b(t,["preferenceOptimizationSpec","hyperParameters","beta"],h),r}function rE(e,t){const o={},r=m(e,["baseModel"]);r!=null&&b(o,["baseModel"],r);const a=m(e,["preTunedModel"]);a!=null&&b(o,["preTunedModel"],a);const i=m(e,["trainingDataset"]);i!=null&&gE(i);const s=m(e,["config"]);return s!=null&&nE(s,o),o}function aE(e,t){const o={},r=m(e,["baseModel"]);r!=null&&b(o,["baseModel"],r);const a=m(e,["preTunedModel"]);a!=null&&b(o,["preTunedModel"],a);const i=m(e,["trainingDataset"]);i!=null&&fE(i,o,t);const s=m(e,["config"]);return s!=null&&oE(s,o,t),o}function iE(e,t){const o={},r=m(e,["name"]);return r!=null&&b(o,["_url","name"],r),o}function sE(e,t){const o={},r=m(e,["name"]);return r!=null&&b(o,["_url","name"],r),o}function lE(e,t,o){const r={},a=m(e,["pageSize"]);t!==void 0&&a!=null&&b(t,["_query","pageSize"],a);const i=m(e,["pageToken"]);t!==void 0&&i!=null&&b(t,["_query","pageToken"],i);const s=m(e,["filter"]);return t!==void 0&&s!=null&&b(t,["_query","filter"],s),r}function cE(e,t,o){const r={},a=m(e,["pageSize"]);t!==void 0&&a!=null&&b(t,["_query","pageSize"],a);const i=m(e,["pageToken"]);t!==void 0&&i!=null&&b(t,["_query","pageToken"],i);const s=m(e,["filter"]);return t!==void 0&&s!=null&&b(t,["_query","filter"],s),r}function dE(e,t){const o={},r=m(e,["config"]);return r!=null&&lE(r,o),o}function uE(e,t){const o={},r=m(e,["config"]);return r!=null&&cE(r,o),o}function pE(e,t){const o={},r=m(e,["sdkHttpResponse"]);r!=null&&b(o,["sdkHttpResponse"],r);const a=m(e,["nextPageToken"]);a!=null&&b(o,["nextPageToken"],a);const i=m(e,["tunedModels"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>S1(l))),b(o,["tuningJobs"],s)}return o}function hE(e,t){const o={},r=m(e,["sdkHttpResponse"]);r!=null&&b(o,["sdkHttpResponse"],r);const a=m(e,["nextPageToken"]);a!=null&&b(o,["nextPageToken"],a);const i=m(e,["tuningJobs"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>uu(l))),b(o,["tuningJobs"],s)}return o}function mE(e,t){const o={},r=m(e,["name"]);r!=null&&b(o,["model"],r);const a=m(e,["name"]);return a!=null&&b(o,["endpoint"],a),o}function gE(e,t){const o={};if(m(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(m(e,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const r=m(e,["examples"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>i)),b(o,["examples","examples"],a)}return o}function fE(e,t,o){const r={};let a=m(o,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const s=m(e,["gcsUri"]);t!==void 0&&s!=null&&b(t,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(a==="PREFERENCE_TUNING"){const s=m(e,["gcsUri"]);t!==void 0&&s!=null&&b(t,["preferenceOptimizationSpec","trainingDatasetUri"],s)}let i=m(o,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const s=m(e,["vertexDatasetResource"]);t!==void 0&&s!=null&&b(t,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(i==="PREFERENCE_TUNING"){const s=m(e,["vertexDatasetResource"]);t!==void 0&&s!=null&&b(t,["preferenceOptimizationSpec","trainingDatasetUri"],s)}if(m(e,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return r}function S1(e,t){const o={},r=m(e,["sdkHttpResponse"]);r!=null&&b(o,["sdkHttpResponse"],r);const a=m(e,["name"]);a!=null&&b(o,["name"],a);const i=m(e,["state"]);i!=null&&b(o,["state"],Bx(i));const s=m(e,["createTime"]);s!=null&&b(o,["createTime"],s);const l=m(e,["tuningTask","startTime"]);l!=null&&b(o,["startTime"],l);const c=m(e,["tuningTask","completeTime"]);c!=null&&b(o,["endTime"],c);const d=m(e,["updateTime"]);d!=null&&b(o,["updateTime"],d);const u=m(e,["description"]);u!=null&&b(o,["description"],u);const p=m(e,["baseModel"]);p!=null&&b(o,["baseModel"],p);const h=m(e,["_self"]);return h!=null&&b(o,["tunedModel"],mE(h)),o}function uu(e,t){const o={},r=m(e,["sdkHttpResponse"]);r!=null&&b(o,["sdkHttpResponse"],r);const a=m(e,["name"]);a!=null&&b(o,["name"],a);const i=m(e,["state"]);i!=null&&b(o,["state"],Bx(i));const s=m(e,["createTime"]);s!=null&&b(o,["createTime"],s);const l=m(e,["startTime"]);l!=null&&b(o,["startTime"],l);const c=m(e,["endTime"]);c!=null&&b(o,["endTime"],c);const d=m(e,["updateTime"]);d!=null&&b(o,["updateTime"],d);const u=m(e,["error"]);u!=null&&b(o,["error"],u);const p=m(e,["description"]);p!=null&&b(o,["description"],p);const h=m(e,["baseModel"]);h!=null&&b(o,["baseModel"],h);const x=m(e,["tunedModel"]);x!=null&&b(o,["tunedModel"],x);const k=m(e,["preTunedModel"]);k!=null&&b(o,["preTunedModel"],k);const C=m(e,["supervisedTuningSpec"]);C!=null&&b(o,["supervisedTuningSpec"],C);const w=m(e,["preferenceOptimizationSpec"]);w!=null&&b(o,["preferenceOptimizationSpec"],w);const f=m(e,["tuningDataStats"]);f!=null&&b(o,["tuningDataStats"],f);const g=m(e,["encryptionSpec"]);g!=null&&b(o,["encryptionSpec"],g);const v=m(e,["partnerModelTuningSpec"]);v!=null&&b(o,["partnerModelTuningSpec"],v);const _=m(e,["customBaseModel"]);_!=null&&b(o,["customBaseModel"],_);const S=m(e,["experiment"]);S!=null&&b(o,["experiment"],S);const T=m(e,["labels"]);T!=null&&b(o,["labels"],T);const P=m(e,["outputUri"]);P!=null&&b(o,["outputUri"],P);const R=m(e,["pipelineJob"]);R!=null&&b(o,["pipelineJob"],R);const D=m(e,["serviceAccount"]);D!=null&&b(o,["serviceAccount"],D);const q=m(e,["tunedModelDisplayName"]);q!=null&&b(o,["tunedModelDisplayName"],q);const O=m(e,["veoTuningSpec"]);return O!=null&&b(o,["veoTuningSpec"],O),o}function xE(e,t){const o={},r=m(e,["sdkHttpResponse"]);r!=null&&b(o,["sdkHttpResponse"],r);const a=m(e,["name"]);a!=null&&b(o,["name"],a);const i=m(e,["metadata"]);i!=null&&b(o,["metadata"],i);const s=m(e,["done"]);s!=null&&b(o,["done"],s);const l=m(e,["error"]);return l!=null&&b(o,["error"],l),o}function Pg(e,t){const o={},r=m(e,["gcsUri"]);r!=null&&b(o,["validationDatasetUri"],r);const a=m(e,["vertexDatasetResource"]);return a!=null&&b(o,["validationDatasetUri"],a),o}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class yE extends Jo{constructor(t){super(),this.apiClient=t,this.list=async(o={})=>new Wr($o.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(o),o),this.get=async o=>await this.getInternal(o),this.tune=async o=>{var r;if(this.apiClient.isVertexAI())if(o.baseModel.startsWith("projects/")){const a={tunedModelName:o.baseModel};!((r=o.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(a.checkpointId=o.config.preTunedModelCheckpointId);const i=Object.assign(Object.assign({},o),{preTunedModel:a});return i.baseModel=void 0,await this.tuneInternal(i)}else{const a=Object.assign({},o);return await this.tuneInternal(a)}else{const a=Object.assign({},o),i=await this.tuneMldevInternal(a);let s="";return i.metadata!==void 0&&i.metadata.tunedModel!==void 0?s=i.metadata.tunedModel:i.name!==void 0&&i.name.includes("/operations/")&&(s=i.name.split("/operations/")[0]),{name:s,state:Qd.JOB_STATE_QUEUED}}}}async getInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=sE(t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>uu(u))}else{const d=iE(t);return l=it("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>S1(u))}}async listInternal(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=uE(t);return l=it("tuningJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=hE(u),h=new eg;return Object.assign(h,p),h})}else{const d=dE(t);return l=it("tunedModels",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=pE(u),h=new eg;return Object.assign(h,p),h})}}async cancel(t){var o,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=QN(t);return l=it("{name}:cancel",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=tE(u),h=new tg;return Object.assign(h,p),h})}else{const d=ZN(t);return l=it("{name}:cancel",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:u.headers},h})),s.then(u=>{const p=eE(u),h=new tg;return Object.assign(h,p),h})}}async tuneInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=aE(t,t);return i=it("tuningJobs",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>uu(c))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(t){var o,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=rE(t);return i=it("tunedModels",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=t.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),a.then(c=>xE(c))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class vE{async download(t,o){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const wE=1024*1024*8,bE=3,CE=1e3,kE=2,bl="x-goog-upload-status";async function _E(e,t,o){var r;const a=await N1(e,t,o),i=await(a==null?void 0:a.json());if(((r=a==null?void 0:a.headers)===null||r===void 0?void 0:r[bl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return i.file}async function SE(e,t,o){var r;const a=await N1(e,t,o),i=await(a==null?void 0:a.json());if(((r=a==null?void 0:a.headers)===null||r===void 0?void 0:r[bl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const s=Lx(i),l=new xp;return Object.assign(l,s),l}async function N1(e,t,o){var r,a;let i=0,s=0,l=new eu(new Response),c="upload";for(i=e.size;s<i;){const d=Math.min(wE,i-s),u=e.slice(s,s+d);s+d>=i&&(c+=", finalize");let p=0,h=CE;for(;p<bE&&(l=await o.request({path:"",body:u,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(s),"Content-Length":String(d)}}}),!(!((r=l==null?void 0:l.headers)===null||r===void 0)&&r[bl]));)p++,await EE(h),h=h*kE;if(s+=d,((a=l==null?void 0:l.headers)===null||a===void 0?void 0:a[bl])!=="active")break;if(i<=s)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return l}async function NE(e){return{size:e.size,type:e.type}}function EE(e){return new Promise(t=>setTimeout(t,e))}class PE{async upload(t,o,r){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await _E(t,o,r)}async uploadToFileSearchStore(t,o,r){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await SE(t,o,r)}async stat(t){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await NE(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class TE{create(t,o,r){return new IE(t,o,r)}}class IE{constructor(t,o,r){this.url=t,this.headers=o,this.callbacks=r}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(t){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(t)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Tg="x-goog-api-key";class jE{constructor(t){this.apiKey=t}async addAuthHeaders(t,o){if(t.get(Tg)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");t.append(Tg,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const AE="gl-node/";class Sp{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const t=this.httpOptions;t!=null&&t.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const o=new fn({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:t==null?void 0:t.timeout});return this._interactions=o.interactions,this._interactions}constructor(t){var o;if(t.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(t.project||t.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(o=t.vertexai)!==null&&o!==void 0?o:!1,this.apiKey=t.apiKey;const r=EC(t.httpOptions,t.vertexai,void 0,void 0);r&&(t.httpOptions?t.httpOptions.baseUrl=r:t.httpOptions={baseUrl:r}),this.apiVersion=t.apiVersion,this.httpOptions=t.httpOptions;const a=new jE(this.apiKey);this.apiClient=new NS({auth:a,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:AE+"web",uploader:new PE,downloader:new vE}),this.models=new VS(this.apiClient),this.live=new OS(this.apiClient,a,new TE),this.batches=new nk(this.apiClient),this.chats=new zk(this.models,this.apiClient),this.caches=new Rk(this.apiClient),this.files=new $k(this.apiClient),this.operations=new WS(this.apiClient),this.authTokens=new lN(this.apiClient),this.tunings=new yE(this.apiClient),this.fileSearchStores=new fN(this.apiClient)}}const E1=()=>{const e=localStorage.getItem("settings_useDevKey")==="true",t=localStorage.getItem("settings_userApiKey");if(!e)return t||void 0},wn=()=>{const e=E1();if(!e)throw new Error("API Key is missing. Please check your settings or environment variables.");return new Sp({apiKey:e})},bn=async(e,t=3,o=1e3)=>{for(let r=0;r<t;r++)try{return await e()}catch(a){const i=a.status||a.code;if(!(i===503||i===429||a.message&&a.message.toLowerCase().includes("overloaded"))||r===t-1)throw a;const l=o*Math.pow(2,r);console.warn(`Gemini API overloaded (503). Retrying in ${l}ms... (Attempt ${r+1}/${t})`),await new Promise(c=>setTimeout(c,l))}throw new Error("Max retries reached")},P1=async(e,t,o)=>bn(async()=>{const r=wn(),a=e.filter(d=>d&&d.trim()!=="");if(a.length===0)return"High-quality masterpiece, 8k, detailed textures, cinematic lighting.";const i=a.join(", "),s=t?"STRICT REQUIREMENT: Zero trademarked terms, brand names, or specific artist identities. Use generic descriptive artistic terminology only.":"";let l="";o?l=`
        You are a technical prompt architect for generative AI imaging systems. 
        Your task is to aggregate the provided concepts into a singular, high-precision technical specification string.

        GUIDELINES:
        - Use structured technical language.
        - Specify precise attributes: [Subject topology], [Material properties/textures], [Physical lighting parameters], [Optical camera settings], [Render engine characteristics].
        - ABSOLUTELY NO flowery, poetic, or evocative adjectives (e.g., avoid "beautiful", "mysterious").
        - Combine all concepts into a cohesive, high-density technical instruction set.
        - ${s}
        - Output ONLY the final technical string. No introductions, no markdown blocks.
      `:l=`
        You are an expert prompt engineer for high-end AI image generation.
        Your goal is to transform the user's basic concepts into a rich, descriptive, and highly aesthetic image prompt.
        
        GUIDELINES:
        - Use evocative language and sensory details.
        - Describe lighting, mood, atmosphere, and artistic style in detail.
        - Ensure the output is a single, cohesive paragraph optimized for high-quality results.
        - ${s}
        - Output ONLY the enhanced prompt. No introductions, no markdown.
      `;const c=`Concepts to process: ${i}`;try{return(await r.models.generateContent({model:"gemini-3-flash-preview",contents:c,config:{systemInstruction:l}})).text||""}catch(d){throw console.error("Error processing prompt:",d),d}}),T1=async e=>bn(async()=>{const t=wn();if(!e||e.trim()==="")return"";const o="You are a prompt safety expert. Rewrite the user's prompt to be safer for image generation policies while preserving artistic intent. Replace age-specific terms (teenager, child) with neutral terms (young person, figure). Output only the sanitized prompt.";try{return(await t.models.generateContent({model:"gemini-3-flash-preview",contents:`Sanitize: "${e}"`,config:{systemInstruction:o}})).text||""}catch(r){throw console.error("Error sanitizing prompt:",r),r}}),I1=async e=>bn(async()=>{const t=wn(),o=e.filter(i=>i&&i.trim()!=="");if(o.length===0)return"A cinematic video, 4k, high resolution.";const a=`
      You are an expert video prompt engineer. Combine these concepts into a single, cohesive, detailed video prompt.
      Describe the scene, subjects, actions, camera movements, and lighting.
      Output only the prompt.
      
      Concepts: ${o.join(", ")}
    `;try{return(await t.models.generateContent({model:"gemini-3-flash-preview",contents:a})).text||""}catch(i){throw console.error("Error enhancing video prompt:",i),i}}),j1=async(e,t)=>bn(async()=>{const o=wn();if(!e||e.trim()==="")throw new Error("Input prompt for analysis cannot be empty.");const a=`
      ${t?"Important: When analyzing, formulate descriptions to be as neutral and safe as possible. Avoid potentially sensitive, intimate, or age-specific terms (like 'teenager', 'boy', 'girl'). Instead, use more general, age-ambiguous descriptions (like 'young person', 'figure', 'youthful character') while preserving the core artistic details and intent.":""}
      You are a meticulous and detailed prompt analyzer. Your task is to analyze the following text and deconstruct it into five distinct, comprehensive components. Do not summarize or shorten the information; instead, extract and organize all relevant details for each component.

      1.  **Environment/Setting**: Extract a complete and detailed description of the environment, setting, or background. Include all mentioned elements, atmosphere, lighting, time of day, and any contextual details. Crucially, also include descriptions of any secondary, background, or non-focal characters here (e.g., 'a crowd of people in the distance', 'birds flying in the sky').
      
      2.  **Characters/Subjects**: Identify and list ONLY the key, main, or foreground characters/subjects. Do NOT include background, secondary, or minor characters in this list. 
          For each main character, extract a detailed **physical description only**. 
          CRITICAL: **Exclude** all descriptions of actions (e.g., running, fighting, sitting), poses, and the surrounding environment/background. 
          Focus strictly on physical appearance, facial features, body type, hair, clothing, armor, and equipment/held items. The goal is to describe the character purely as they look, as if they were a 3D model or concept art asset in isolation.
          IMPORTANT: Append ", grey background, character concept" to the end of each character description. For example, if the text says "a hero fighting a dragon in a cave", the character entry for the hero should be "a hero in shining armor, detailed face, muscular build, grey background, character concept" (removing 'fighting' and 'cave').

      3.  **Action**: Describe the action being performed by the main characters in full detail. Generalize the subjects by replacing specific character names or descriptions with neutral terms such as "the character(s)" or "the subject(s)". The description of the action itself must be comprehensive and include all associated details.
      
      4.  **Emotion**: Describe the emotion being expressed by the main character(s) in general terms, detached from the specific subjects. For example, 'The character(s) are experiencing joy,' 'The subject(s) show signs of fear,' or 'A sense of wonder is being conveyed.' If no emotion is explicitly mentioned, infer a plausible one from the context of the action and environment. Focus on the feeling itself.
      
      5.  **Style**: CRITICAL: Your description for this category MUST be completely detached from the specific subjects and environment of the prompt. Analyze and describe ONLY the artistic essence. Focus on abstract elements like: art medium (e.g., photorealistic, oil painting, 3D render, anime, watercolor), mood (e.g., mysterious, cheerful, epic, melancholic), color palette (e.g., vibrant warm tones, monochromatic cool colors, pastel), lighting style (e.g., dramatic, soft, neon, chiaroscuro), composition (e.g., close-up, wide shot, rule of thirds), and artistic techniques (e.g., impressionistic brush strokes, sharp focus, cel shading). Under NO circumstances should you mention any objects, people, or places from the scene in this section. For example, instead of "cinematic shot of a knight", say "cinematic, dramatic lighting, sharp focus".

      If any component is missing from the input text, you should infer and create a plausible and complementary description for it based on the available context. The goal is to produce a complete set of components that could be used to reconstruct a detailed image prompt.

      Provide the output strictly as a JSON object with the keys "environment", "characters", "action", "emotion", and "style".

      Text to analyze: ${e}
    `,i={type:gt.OBJECT,properties:{environment:{type:gt.STRING,description:"A detailed description of the background, setting, or environment."},characters:{type:gt.ARRAY,description:"A list of all distinct characters or subjects in the prompt.",items:{type:gt.STRING}},action:{type:gt.STRING,description:"A generalized description of the action the characters/subjects are performing, with specific subjects replaced by neutral terms."},emotion:{type:gt.STRING,description:"A generalized description of the emotion expressed by the character(s), such as joy, fear, or wonder."},style:{type:gt.STRING,description:"A detailed description of the art style, mood, and color palette."}},required:["environment","characters","action","emotion","style"]};try{const l=(await o.models.generateContent({model:"gemini-3-pro-preview",contents:a,config:{responseMimeType:"application/json",responseSchema:i}})).text;if(!l)throw new Error("Received an empty response from the model. The prompt may have been blocked due to safety settings.");const c=JSON.parse(l);return Array.isArray(c.characters)||(c.characters=[String(c.characters||"")]),c}catch(s){throw console.error("Error analyzing prompt:",s),s}}),A1=async e=>bn(async()=>{const t=wn();if(!e||e.trim()==="")throw new Error("Input cannot be empty.");const o=`
      Analyze the character description. Split it into:
      1. character (physical features only)
      2. clothing (outfit only)
      Output JSON.
      Text: ${e}
    `,r={type:gt.OBJECT,properties:{character:{type:gt.STRING},clothing:{type:gt.STRING}},required:["character","clothing"]};try{const a=await t.models.generateContent({model:"gemini-3-flash-preview",contents:o,config:{responseMimeType:"application/json",responseSchema:r}});return JSON.parse(a.text||"{}")}catch(a){throw console.error("Error analyzing character:",a),a}}),ME=async(e,t,o)=>bn(async()=>{const r=wn();if(!e||!e.trim())throw new Error("Image prompt is required.");const a=`You are a character design expert. Your task is to update an existing character description based on a specific image generation prompt.
    
    INPUTS:
    1. Image Prompt: A description of a specific visual instance of the character.
    2. Current Description: A full markdown-formatted description of the character.

    GOAL:
    Rewrite the "Appearance" (/Apariencia) and "Clothing" (/Ropa) sections of the description to match the details found in the Image Prompt.
    KEEP the "Personality" (//Personalidad) section identical to the original.
    
    OUTPUT FORMAT:
    The output must be a single string in Markdown format, using the following headers in ${o}:
    - #### Appearance (or translated version)
    - #### Personality (or translated version)
    - #### Clothing (or translated version)

    Output ONLY the updated description text.`,i=`Update this character description:
    
    IMAGE PROMPT:
    ${e}
    
    CURRENT DESCRIPTION:
    ${t}`;try{return(await r.models.generateContent({model:"gemini-3-flash-preview",contents:i,config:{systemInstruction:a}})).text||""}catch(s){throw console.error("Error updating character description:",s),s}}),RE=async(e,t,o,r)=>bn(async()=>{const a=wn(),i=`You are a professional character concept artist.
    Your goal is to modify an existing character based on a user instruction.
    
    INPUTS:
    1. Instruction: What to change (e.g., "Change her clothes to a space suit").
    2. Current Image Prompt: The current short prompt used for image generation.
    3. Current Full Description: The detailed markdown description.

    TASK:
    - Update the Image Prompt to reflect the changes.
    - Update the Full Description (sections Appearance, Personality and Clothing) in ${r}.
    - Ensure all sections are consistent with the new instruction.
    - Output only a JSON object with keys 'newPrompt' and 'newDescription'.`,s={type:gt.OBJECT,properties:{newPrompt:{type:gt.STRING},newDescription:{type:gt.STRING}},required:["newPrompt","newDescription"]},l=`INSTRUCTION: ${e}
CURRENT PROMPT: ${t}
CURRENT DESCRIPTION: ${o}`;try{const c=await a.models.generateContent({model:"gemini-3-pro-preview",contents:l,config:{systemInstruction:i,responseMimeType:"application/json",responseSchema:s}});return JSON.parse(c.text||"{}")}catch(c){throw console.error("Error modifying character:",c),c}}),Vn=async(e,t="1:1",o,r="gemini-2.5-flash-image",a="1K")=>bn(async()=>{var s,l,c,d,u,p,h,x,k,C,w,f,g;const i=wn();try{if(r==="gemini-3-pro-image-preview"){const _=[...(o||[]).map(R=>({inlineData:{data:R.base64ImageData,mimeType:R.mimeType}}))];e&&e.trim()!==""&&_.push({text:e});const T=(s=(await i.models.generateContent({model:"gemini-3-pro-image-preview",contents:{parts:_},config:{imageConfig:{aspectRatio:t,imageSize:a}}})).candidates)==null?void 0:s[0],P=(c=(l=T==null?void 0:T.content)==null?void 0:l.parts)==null?void 0:c.find(R=>R.inlineData);if(P!=null&&P.inlineData)return`data:${P.inlineData.mimeType};base64,${P.inlineData.data}`;throw new Error("No image returned. The prompt may have been blocked or the model encountered an error.")}if(o&&o.length>0){const _=[...o.map(D=>({inlineData:{data:D.base64ImageData,mimeType:D.mimeType}}))];e&&e.trim()!==""&&_.push({text:e});const P=(d=(await i.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:_},config:{responseModalities:[za.IMAGE]}})).candidates)==null?void 0:d[0],R=(p=(u=P==null?void 0:P.content)==null?void 0:u.parts)==null?void 0:p.find(D=>D.inlineData);if(R!=null&&R.inlineData)return`data:${R.inlineData.mimeType};base64,${R.inlineData.data}`;throw new Error("No image returned. The prompt may have been blocked.")}else{if(!e||e.trim()==="")throw new Error("Prompt required.");if(r.startsWith("imagen-4.0")){const v=await i.models.generateImages({model:r,prompt:e,config:{numberOfImages:1,outputMimeType:"image/png",aspectRatio:t}});if((k=(x=(h=v.generatedImages)==null?void 0:h[0])==null?void 0:x.image)!=null&&k.imageBytes)return`data:image/png;base64,${v.generatedImages[0].image.imageBytes}`;throw new Error("No image returned.")}else{const v=r==="gemini-3-flash-preview"||!r?"gemini-2.5-flash-image":r,S=(g=(f=(w=(C=(await i.models.generateContent({model:v,contents:{parts:[{text:e}]},config:{responseModalities:[za.IMAGE]}})).candidates)==null?void 0:C[0])==null?void 0:w.content)==null?void 0:f.parts)==null?void 0:g.find(T=>T.inlineData);if(S!=null&&S.inlineData)return`data:${S.inlineData.mimeType};base64,${S.inlineData.data}`;throw new Error("No image returned.")}}}catch(v){let _=v.message||"";throw v.status&&(_+=` Status: ${v.status}`),v.code&&(_+=` Code: ${v.code}`),v.details&&(_+=` Details: ${JSON.stringify(v.details)}`),!_&&typeof v=="object"&&(_=JSON.stringify(v)),new Error(`Failed to generate image. ${_}`)}},2,2e3),LE=async(e,t="16:9",o="720p")=>bn(async()=>{var a,i,s,l;const r=wn();if(window.aistudio&&!await window.aistudio.hasSelectedApiKey()&&await window.aistudio.openSelectKey(),!e||e.trim()==="")throw new Error("Prompt required.");try{let c=await r.models.generateVideos({model:"veo-3.1-fast-generate-preview",prompt:e,config:{numberOfVideos:1,resolution:o,aspectRatio:t}});for(;!c.done;)await new Promise(h=>setTimeout(h,1e4)),c=await r.operations.getVideosOperation({operation:c});const d=(l=(s=(i=(a=c.response)==null?void 0:a.generatedVideos)==null?void 0:i[0])==null?void 0:s.video)==null?void 0:l.uri;if(!d)throw new Error("No video URI returned.");const u=await fetch(`${d}&key=${E1()}`);if(!u.ok)throw new Error(`Download failed: ${u.statusText}`);const p=await u.blob();return new Promise((h,x)=>{const k=new FileReader;k.onloadend=()=>h(k.result),k.onerror=x,k.readAsDataURL(p)})}catch(c){console.error("Error generating video:",c);let d=c.message||"";throw c.status&&(d+=` Status: ${c.status}`),c.code&&(d+=` Code: ${c.code}`),new Error(`Failed to video video. ${d}`)}},1),M1=async(e,t,o)=>bn(async()=>{const r=wn(),i=`${o?"Important: Use neutral, safe terms.":""} Describe this image in detail (subject, setting, colors, mood).`;try{return(await r.models.generateContent({model:"gemini-3-flash-preview",contents:{parts:[{inlineData:{data:e,mimeType:t}},{text:i}]}})).text||""}catch(s){throw console.error("Error describing image:",s),s}}),DE=async(e,t)=>bn(async()=>{const o=wn(),r=`Analyze the visual appearance of the character in this image to create a text-to-image prompt.

        **REQUIREMENTS:**
        1. **SUBJECT ONLY**: Describe ONLY the character's physical features (face, hair, body type) and clothing/accessories in detail.
        2. **STYLE**: Describe the artistic style and render quality using general descriptive terms (e.g., '3D stylized render', 'soft lighting', 'detailed textures').

        **NEGATIVE CONSTRAINTS (DO NOT INCLUDE):**
        - DO NOT describe the pose, action, or gesture.
        - DO NOT describe the background or environment.
        - DO NOT use trademarked studio names (e.g., avoid 'Pixar', 'Disney'). Use generic style descriptions instead.

        Return ONLY the raw prompt text.`;try{return(await o.models.generateContent({model:"gemini-3-flash-preview",contents:{parts:[{inlineData:{data:e,mimeType:t}},{text:r}]}})).text||""}catch(a){throw console.error("Error generating prompt from image:",a),a}}),Np=async(e,t)=>bn(async()=>{const o=wn(),r='Extract all text from this image. Return only the text found, without any description. If no text is found, say "No text found".';try{return(await o.models.generateContent({model:"gemini-3-flash-preview",contents:{parts:[{inlineData:{data:e,mimeType:t}},{text:r}]}})).text||""}catch(a){throw console.error("Error extracting text from image:",a),a}}),Ep=async(e,t)=>bn(async()=>{const o=wn();if(!e||e.trim()==="")throw new Error("Input empty.");try{return(await o.models.generateContent({model:"gemini-3-flash-preview",contents:e,config:{systemInstruction:`Translate to ${t}. Return only translated text.`}})).text||""}catch(r){throw console.error("Error translating:",r),r}}),R1=async(e,t)=>bn(async()=>{const o=wn(),r={type:gt.OBJECT,properties:{summary:{type:gt.STRING},detailedCharacters:{type:gt.ARRAY,items:{type:gt.OBJECT,properties:{name:{type:gt.STRING},fullDescription:{type:gt.STRING}}}},scenes:{type:gt.ARRAY,items:{type:gt.OBJECT,properties:{sceneNumber:{type:gt.INTEGER},description:{type:gt.STRING},narratorText:{type:gt.STRING}}}}},required:["summary","detailedCharacters","scenes"]};try{const a=await o.models.generateContent({model:"gemini-3-pro-preview",contents:e,config:{systemInstruction:`Generate a script structure in ${t}. Use markdown in fullDescription.`,responseMimeType:"application/json",responseSchema:r}});return JSON.parse(a.text||"{}")}catch(a){throw console.error("Error generating script:",a),a}}),L1=async e=>bn(async()=>{const t=wn(),o={type:gt.ARRAY,items:{type:gt.OBJECT,properties:{name:{type:gt.STRING},index:{type:gt.STRING},imagePrompt:{type:gt.STRING},fullDescription:{type:gt.STRING}},required:["name","fullDescription","index","imagePrompt"]}};try{const r=await t.models.generateContent({model:"gemini-3-flash-preview",contents:e,config:{systemInstruction:"Generate detailed characters. Use markdown headings in fullDescription. Ensure 'index' is provided (e.g. 'Entity-1', 'Entity-2').",responseMimeType:"application/json",responseSchema:o}});return JSON.parse(r.text||"[]")}catch(r){throw console.error("Error generating characters:",r),r}}),zE=async(e,t)=>bn(async()=>{const o=wn(),r=`Translate user-facing fields to ${t}. Preserve structure and markdown.`;try{const a=await o.models.generateContent({model:"gemini-3-pro-preview",contents:`Translate:
${JSON.stringify(e)}`,config:{systemInstruction:r,responseMimeType:"application/json"}});return JSON.parse(a.text||"{}")}catch(a){throw new Error(a.message)}}),D1=async(e,t,o="en",r="gemini-3-flash-preview",a=!1)=>bn(async()=>{const i=wn(),s={type:gt.ARRAY,items:{type:gt.OBJECT,properties:{frameNumber:{type:gt.INTEGER},prompt:{type:gt.STRING},videoPrompt:{type:gt.STRING},shotType:{type:gt.STRING,description:"The type of shot (e.g., WS, CU, ECU, LS, MS)."},characters:{type:gt.ARRAY,items:{type:gt.STRING}},duration:{type:gt.INTEGER}},required:["frameNumber","prompt","characters","duration","shotType",...a?["videoPrompt"]:[]]}},l=o==="ru"?"Ensure the response fields (like prompts) are in Russian.":"Ensure the response fields (like prompts) are in English.";let c="";a&&(c=`
        CRITICAL: You MUST also generate or modify the 'videoPrompt' field for every frame.
        - If 'videoPrompt' is empty or missing in the source: Generate a NEW video prompt based on the image 'prompt'. It MUST describe specific actions happening in the frame and camera movements (e.g., "Camera pans left", "Zoom in").
        - If 'videoPrompt' exists: Modify it according to the user's instruction, while maintaining consistency with the image 'prompt'.
        `);try{const d=await i.models.generateContent({model:r,contents:`Instruction: ${t}
Data: ${JSON.stringify(e)}`,config:{systemInstruction:`Modify prompts based on instruction. Return modified array. ${l} ${c} For every frame, you MUST either preserve or generate a logical 'shotType' value (e.g., WS, MS, CU, etc.) representing the camera angle.`,responseMimeType:"application/json",responseSchema:s}});return JSON.parse(d.text||"[]")}catch(d){throw console.error("Error modifying sequence:",d),d}}),qE=({nodes:e,setNodes:t,getUpstreamNodeValues:o,setError:r,t:a,setFullSizeImage:i,getFullSizeImage:s,activeTabId:l,setTabs:c,activeTabName:d,registerOperation:u,unregisterOperation:p,addToast:h})=>{const[x,k]=y.useState(null),[C,w]=y.useState(null),[f,g]=y.useState(null),[v,_]=y.useState(null),[S,T]=y.useState(null),P=y.useRef(l);y.useEffect(()=>{P.current=l},[l]);const R=y.useCallback((j,L,M,V)=>{const H=F=>{try{return JSON.parse(F||"{}")}catch{return F}};P.current===j?(V&&i(L,V.frame,V.url),t(F=>F.map(G=>{if(G.id===L){const B=H(G.value),Y=M(B),ee=typeof Y=="string"?Y:JSON.stringify(Y);return{...G,value:ee}}return G}))):c(F=>F.map(G=>{if(G.id===j){const B=G.state.nodes.map(ee=>{if(ee.id===L){const ie=H(ee.value),ce=M(ie),pe=typeof ce=="string"?ce:JSON.stringify(ce);return{...ee,value:pe}}return ee});let Y=G.state.fullSizeImageCache||{};return V&&(Y={...Y,[L]:{...Y[L]||{},[V.frame]:V.url}}),{...G,state:{...G.state,nodes:B,fullSizeImageCache:Y}}}return G}))},[t,c,i]),D=y.useCallback(async j=>{const L=P.current;k(j),r(null),u({id:j,type:"analysis",description:a("node.content.analyzing"),tabId:l,tabName:d});try{const M=e.find(B=>B.id===j);if(!M)return;const V=JSON.parse(M.value||"{}").softPrompt||!1,F=o(j).filter(B=>typeof B=="string").join(", "),G=await j1(F,V);R(L,j,B=>({...B,...G}))}catch(M){r(M.message)}finally{k(null),p(j)}},[o,r,e,a,R,u,p,l,d]),q=y.useCallback(async j=>{const L=P.current;w(j),r(null),u({id:j,type:"analysis",description:a("node.content.analyzing"),tabId:l,tabName:d});try{const V=o(j).filter(F=>typeof F=="string").join(", "),H=await A1(V);R(L,j,()=>H)}catch(M){r(M.message)}finally{w(null),p(j)}},[o,r,a,R,u,p,l,d]),O=y.useCallback(async j=>{const L=P.current;g(j),r(null),u({id:j,type:"analysis",description:a("node.content.analyzing"),tabId:l,tabName:d});try{const M=e.find(ee=>ee.id===j);if(!M)return;const V=JSON.parse(M.value||"{}"),H=V.softPrompt||!1,G=o(j).find(ee=>typeof ee=="object");let B=null;if(G)B={base64:G.base64ImageData,mime:G.mimeType};else if(V.image&&typeof V.image=="string"&&V.image.startsWith("data:image")){const ee=V.image.split(",");if(ee.length===2){const ie=V.image.match(/:(.*?);/),ce=ie?ie[1]:"image/png";B={base64:ee[1],mime:ce}}}if(!B)throw new Error("No image provided to analyzer.");const Y=await M1(B.base64,B.mime,H);R(L,j,ee=>({...ee,description:Y}))}catch(M){r(M.message)}finally{g(null),p(j)}},[o,e,r,a,R,u,p,l,d]),E=y.useCallback(async j=>{const L=P.current;g(j),r(null),u({id:j,type:"analysis",description:a("node.content.analyzing"),tabId:l,tabName:d});try{const M=e.find(ee=>ee.id===j);if(!M)return;const V=JSON.parse(M.value||"{}"),F=o(j).find(ee=>typeof ee=="object");let G=null;if(F)G={base64:F.base64ImageData,mime:F.mimeType};else{let ie=s(j,0);if(!ie&&V.image&&typeof V.image=="string"&&V.image.startsWith("data:image")&&(ie=V.image),ie){const ce=ie.split(",");if(ce.length===2){const pe=ie.match(/:(.*?);/),ue=pe?pe[1]:"image/png";G={base64:ce[1],mime:ue}}}}if(!G)throw new Error("No image provided.");const B=await Np(G.base64,G.mime),Y=M.type===z.IMAGE_INPUT?"prompt":"description";R(L,j,ee=>({...ee,[Y]:B}))}catch(M){r(M.message)}finally{g(null),p(j)}},[o,e,r,a,R,u,p,l,d,s]),A=y.useCallback(async j=>{var M;const L=P.current;_(j),r(null),u({id:j,type:"generation",description:a("node.content.processing"),tabId:l,tabName:d});try{const V=e.find(ee=>ee.id===j);if(!V)return;let H="",F="";if(V.type===z.IMAGE_INPUT){let ie=s(j,0);if(!ie)try{ie=JSON.parse(V.value||"{}").image}catch{}if(!ie)throw new Error("No image found in node.");if(ie.startsWith("data:"))H=ie.split(",")[1],F=((M=ie.match(/:(.*?);/))==null?void 0:M[1])||"image/png";else throw new Error("Image format not supported.")}else{const ie=o(j,"image").find(ce=>typeof ce=="object");ie&&(H=ie.base64ImageData,F=ie.mimeType)}if(!H)throw new Error("No image to process.");const B=await Vn("Remove all possible overlays, text, watermarks, and watermarked texts. Pay special attention to the top and bottom of the image, restoring the original background naturally.","1:1",[{base64ImageData:H,mimeType:F}],"gemini-3-flash-preview"),Y=await Lt(B,256,256);R(L,j,ee=>({...ee,image:Y}),{frame:0,url:B})}catch(V){r(V.message)}finally{_(null),p(j)}},[e,r,o,s,R,u,p,l,d,a]),N=y.useCallback(async(j,L)=>{const M=P.current,V=`${j}-${L}`;T(V),r(null),u({id:V,type:"analysis",description:a("node.content.analyzing"),tabId:l,tabName:d});try{const H=e.find(re=>re.id===j);if(!H)return;const F=JSON.parse(H.value||"[]"),B=(Array.isArray(F)?F:[F])[L];if(!B)throw new Error("Character card not found.");const Y=s(j,L*10)||B.image;if(!Y||!Y.startsWith("data:"))throw new Error("No valid image found to analyze.");const ie=Y.split(",")[1],ce=Y.match(/:(.*?);/),pe=ce?ce[1]:"image/png",ue=await DE(ie,pe);R(M,j,re=>{const $=Array.isArray(re)?[...re]:[re];return $[L]&&($[L]={...$[L],prompt:ue}),$}),h("Prompt updated from image","success")}catch(H){r(H.message)}finally{T(null),p(V)}},[e,r,a,R,u,p,l,d,s,h]);return{isAnalyzing:x,isAnalyzingCharacter:C,isAnalyzingImage:f,isProcessingImage:v,handleAnalyzePrompt:D,handleAnalyzeCharacter:q,handleAnalyzeImage:O,handleImageToText:E,handleProcessImage:A,handleUpdateCharacterPromptFromImage:N,isUpdatingCharacterPrompt:S}},Ig={general:`You are Gemini, a versatile and helpful AI assistant integrated into the "Prompt Modifier" application.
    
**Context:**
You are operating within a node-based visual editor used for creating and refining workflows for Generative AI.

**Goal:**
Assist the user with general questions, brainstorming, coding, or any other topic they raise. Be concise, professional, and helpful.`,prompt:`You are an **Expert Image Prompt Engineer**. Your sole purpose is to help the user create the perfect text-to-image prompts (for Midjourney, Stable Diffusion, Imagen, etc.).

**Behaviors:**
1.  **Analyze:** When given a vague idea, analyze it for artistic style, lighting, composition, and medium.
2.  **Enhance:** Rewrite simple prompts into rich, descriptive, and evocative prompts. Use keywords effectively.
3.  **Format:** ALWAYS wrap your final suggested prompt inside a markdown code block labeled 'prompt'.
    Example:
    \`\`\`prompt
    A futuristic city with neon lights, cinematic lighting, hyper-realistic, 8k
    \`\`\`
`,script:`You are a **Professional Screenwriter and Story Consultant**. You excel at structuring narratives, developing characters, and writing screenplay format.

**Behaviors:**
1.  **Ideation:** Help generate loglines, plot twists, and character arcs.
2.  **Formatting:** When asked to write a scene, use standard screenplay format elements (Sluglines, Action, Character, Dialogue).
3.  **Advice:** Offer constructive feedback on pacing, dialogue, and "show, don't tell".
`,youtube:`You are a **YouTube Growth Strategist and Analytics Expert**. You specialize in channel growth, video retention, and click-through rates (CTR).

**Behaviors:**
1.  **Titles & Thumbs:** Suggest viral-worthy titles and thumbnail concepts that trigger curiosity or emotion.
2.  **Retention:** Analyze script ideas for hooks, pacing, and retention spikes.
3.  **Strategy:** Provide advice on SEO, tags, trends, and audience engagement.
4.  **Tone:** Be analytical, data-driven, and direct.
`,developer:`You are an **Expert Software Developer and Solutions Architect**. You specialize in writing clean, efficient, and well-documented code.

**Behaviors:**
1.  **Code First:** Prioritize providing code solutions. When code is requested, ensure it is complete and functional.
2.  **Best Practices:** Follow standard conventions, design patterns, and security best practices.
3.  **Explain:** Briefly explain the logic, algorithms, and libraries used.
4.  **Debug:** If analyzing an error, explain the root cause and provide a specific fix.
5.  **Format:** Always use markdown code blocks for code outputs.
`},OE=({nodes:e,setNodes:t,setError:o,t:r,getUpstreamNodeValues:a,activeTabId:i,setTabs:s})=>{const[l,c]=y.useState(null),d=y.useRef(new Map),u=y.useRef(i);Et.useEffect(()=>{u.current=i},[i]);const p=y.useCallback((k,C,w)=>{const f=g=>{try{return JSON.parse(g||"{}")}catch{return g}};u.current===k?t(g=>g.map(v=>{if(v.id===C){const _=f(v.value),S=w(_),T=JSON.stringify(S);return{...v,value:T}}return v})):s(g=>g.map(v=>{if(v.id===k){const _=v.state.nodes.map(S=>{if(S.id===C){const T=f(S.value),P=w(T),R=JSON.stringify(P);return{...S,value:R}}return S});return{...v,state:{...v.state,nodes:_}}}return v}))},[t,s]),h=y.useCallback(async k=>{const C=u.current,w=e.find(T=>T.id===k);if(!w||w.type!=="GEMINI_CHAT")return;const f=JSON.parse(w.value||"{}");let{messages:g=[],currentInput:v,style:_="general"}=f;if(!v||!v.trim()){const T=a(k).filter(P=>typeof P=="string");T.length>0&&(v=T.join(`
`))}if(!v||!v.trim())return;c(k),o(null);const S=[...g,{role:"user",content:v}];p(C,k,T=>({...T,messages:S,currentInput:""}));try{const T=d.current.get(k);if(!T||T.style!==_){const A=new Sp({apiKey:void 0}),N=Ig[_]||Ig.general,j=A.chats.create({model:"gemini-3-flash-preview",config:{systemInstruction:N}});d.current.set(k,{chat:j,style:_})}const D=(await d.current.get(k).chat.sendMessage({message:v})).text||"",q=D.match(/```prompt\n([\s\S]*?)\n```/),O=q?q[1].trim():"",E=[...S,{role:"model",content:D}];p(C,k,A=>({...A,messages:E,currentInput:"",lastPrompt:O||A.lastPrompt}))}catch(T){o(T.message)}finally{c(null)}},[e,o,r,a,p]),x=y.useCallback(k=>{d.current.has(k)&&d.current.delete(k),p(u.current,k,C=>({messages:[],currentInput:"",lastPrompt:"",style:C.style||"general"}))},[p]);return{isChatting:l,handleSendMessage:h,handleRefreshChat:x}},FE=async({node:e,upstreamData:t})=>{let o=t.filter(l=>typeof l=="string"),r={},a=!0,i=!1;try{r=JSON.parse(e.value||"{}"),typeof r=="object"&&r!==null&&(a=r.safePrompt!==!1,i=r.technicalPrompt===!0)}catch{}o.length===0&&r.inputPrompt&&(o=[r.inputPrompt]);const s=await P1(o,a,i);return{value:{...r,prompt:s,safePrompt:a,technicalPrompt:i}}},BE=async({upstreamData:e})=>{const t=e.filter(r=>typeof r=="string");return{value:await T1(t.join(", "))}},GE=async({node:e,upstreamData:t})=>{let o=t.filter(i=>typeof i=="string"),r={};try{r=JSON.parse(e.value||"{}")}catch{}o.length===0&&r.inputPrompt&&(o=[r.inputPrompt]);const a=await I1(o);return{value:{...r,prompt:a}}},HE=async({node:e,upstreamData:t})=>{const o=JSON.parse(e.value||"{}"),r=t.filter(l=>typeof l=="string");let a=r.length>0?r.join(`
`):o.inputText;const i=o.targetLanguage||"en";if(o.image&&typeof o.image=="string"&&o.image.startsWith("data:image")){const l=o.image.split(",");if(l.length===2){const c=o.image.match(/:(.*?);/),d=c?c[1]:"image/png",u=l[1],p=await Np(u,d);p&&p!=="No text found"&&(a=p,o.inputText=p)}}const s=await Ep(a,i);return{value:{...o,inputText:a,translatedText:s}}},UE=async({node:e,upstreamData:t,saveImageToCache:o})=>{const a=t.filter(l=>typeof l=="string").join(", ");if(!a)throw new Error("Prompt is empty. Make sure a node with text is connected and has been processed.");const i=await Vn(a,e.aspectRatio,void 0,e.model,e.resolution),s=await Lt(i,256,256);return o(0,i),{value:s,downloadData:e.autoDownload?{url:i,prompt:a,type:e.type}:void 0}},VE=async(e,t,o,r,a,i,s)=>{const l=JSON.parse(e.value),c=[...r,...o],d=[...a,...i];if(!l.isSequentialEditingWithPrompts&&c.length===0&&l.model!=="gemini-3-pro-image-preview")throw new Error("No input image provided for editing.");let u=[l.prompt,...t].filter(Boolean).join(", "),p=[];if(!l.isSequenceMode){let v=c;const _=l.checkedInputIndices;_&&Array.isArray(_)?v=c.filter((S,T)=>_.includes(T)):v=c,p=v}if(!l.isSequenceMode){if(p.length===0&&l.model!=="gemini-3-pro-image-preview")throw new Error("No images selected for processing.");const v=p.map(async R=>{var q;const D=`data:${R.mimeType};base64,${R.base64ImageData}`;if(l.enableAspectRatio&&l.aspectRatio&&l.aspectRatio!=="Auto"){const{formattedImage:O}=await br(D,l.aspectRatio);return{base64ImageData:O.split(",")[1],mimeType:((q=O.match(/:(.*?);/))==null?void 0:q[1])||"image/png"}}return R}),_=await Promise.all(v);l.enableOutpainting&&(u=(l.outpaintingPrompt||"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.").replace("{main_prompt}",u));const S=await Vn(u,l.aspectRatio,_,l.model,l.resolution);let T=S;if(l.autoCrop169)try{T=await Ra(S)}catch(R){console.error("Failed to auto-crop image:",R.message)}const P=await Lt(T,256,256);return s(0,T),{value:{...l,outputImage:P},downloadData:l.autoDownload?{url:T,prompt:u,type:e.type}:void 0}}let h=0;l.checkedInputIndices&&l.checkedInputIndices.length>0&&(h=l.checkedInputIndices[0]),l.isSequentialEditingWithPrompts&&(h=0);let x=[];if(l.isSequentialEditingWithPrompts)x=d;else{const v=c[h]||(c.length>0?c[0]:void 0);if(!v&&l.model!=="gemini-3-pro-image-preview")throw new Error("No image found for sequence chain execution.");v&&(x=[v]),l.isSequentialCombinationMode&&!l.isSequentialEditingWithPrompts&&v&&d.length>0&&x.push(...d)}const k=x.map(async v=>{var S;const _=`data:${v.mimeType};base64,${v.base64ImageData}`;if(l.enableAspectRatio&&l.aspectRatio&&l.aspectRatio!=="Auto"){const{formattedImage:T}=await br(_,l.aspectRatio);return{base64ImageData:T.split(",")[1],mimeType:((S=T.match(/:(.*?);/))==null?void 0:S[1])||"image/png"}}return v}),C=await Promise.all(k);l.enableOutpainting&&(u=(l.outpaintingPrompt||"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.").replace("{main_prompt}",u));const w=await Vn(u,l.aspectRatio,C,l.model,l.resolution);let f=w;if(l.autoCrop169)try{f=await Ra(w)}catch(v){console.error("Failed to auto-crop image:",v.message)}const g=await Lt(f,256,256);return s(0,f),{value:{...l,outputImage:g},downloadData:l.autoDownload?{url:f,prompt:u,type:e.type}:void 0}},WE=async({node:e,upstreamData:t})=>{const o=t.filter(s=>typeof s=="string"),r=JSON.parse(e.value||"{}").softPrompt||!1,a=await j1(o.join(", "),r);return{value:{...JSON.parse(e.value||"{}"),...a}}},$E=async({upstreamData:e})=>{const t=e.filter(r=>typeof r=="string");return{value:await A1(t.join(", "))}},KE=async({node:e,upstreamData:t})=>{const o=t.find(s=>typeof s=="object");if(!o)throw new Error("No image provided to analyzer.");const r=JSON.parse(e.value||"{}"),a=r.softPrompt||!1,i=await M1(o.base64ImageData,o.mimeType,a);return{value:{...r,description:i}}},JE=async({node:e,upstreamData:t})=>{const o=JSON.parse(e.value||"{}"),r=t.filter(l=>typeof l=="string"),a=r.length>0?r.join(`
`):o.prompt,i=o.targetLanguage||"en",s=await R1(a,i);return{value:{...o,...s,prompt:a,type:"script-generator-data"}}},YE=async({node:e,upstreamData:t})=>{const o=JSON.parse(e.value||"{}"),r=t.filter(l=>typeof l=="string"),a=r.length>0?r.join(`
`):o.prompt,i=await L1(a),s=[...o.characters||[],...i];return{value:{...o,characters:s,prompt:a}}},XE=async({node:e})=>{const{instruction:t,sourcePrompts:o=[],checkedSourceFrameNumbers:r=[]}=JSON.parse(e.value||"{}");if(!(t!=null&&t.trim()))throw new Error("Modification instruction is empty.");if(r.length===0)throw new Error("No source prompts selected for modification.");const a=o.filter(u=>r.includes(u.frameNumber));if(a.length===0)throw new Error("Selected prompts not found.");const i=await D1(a,t),s=JSON.parse(e.value||"{}"),l=s.modifiedPrompts||[],c=new Map(l.map(u=>[u.frameNumber,u])),d=new Map(o.map(u=>[u.frameNumber,u]));return i.forEach(u=>{const p=d.get(u.frameNumber);p&&(!u.videoPrompt&&p.videoPrompt&&(u.videoPrompt=p.videoPrompt),!u.sceneTitle&&p.sceneTitle&&(u.sceneTitle=p.sceneTitle),!u.sceneNumber&&p.sceneNumber&&(u.sceneNumber=p.sceneNumber),!u.shotType&&p.shotType&&(u.shotType=p.shotType)),c.set(u.frameNumber,u)}),{value:{...s,modifiedPrompts:Array.from(c.values())}}},ZE={[z.PROMPT_PROCESSOR]:FE,[z.PROMPT_SANITIZER]:BE,[z.VIDEO_PROMPT_PROCESSOR]:GE,[z.TRANSLATOR]:HE,[z.IMAGE_OUTPUT]:UE,[z.PROMPT_ANALYZER]:WE,[z.CHARACTER_ANALYZER]:$E,[z.IMAGE_ANALYZER]:KE,[z.SCRIPT_GENERATOR]:JE,[z.CHARACTER_GENERATOR]:YE,[z.PROMPT_SEQUENCE_EDITOR]:XE},QE=e=>ZE[e],e3=(e,t,o)=>{const r=o==="VIDEO_OUTPUT",a=r?"video_output":o==="IMAGE_EDITOR"?"image_editor":o==="IMAGE_SEQUENCE_GENERATOR"?"sequence":"image_output",i=r?"mp4":"png",s=new Date,l=s.toISOString().split("T")[0];let c=`${a}_${l}.${i}`;if(o==="IMAGE_EDITOR")c=`Image_Editor_Frame_001_${l}.${i}`;else if(o==="IMAGE_SEQUENCE_GENERATOR")c=`Sequence_Frame_001_${l}.${i}`;else{const p=s.toTimeString().split(" ")[0].replace(/:/g,"-");c=`${a}_${l}_${p}.${i}`}let d=e;!r&&e.startsWith("data:image/png")&&(d=Bi(e,"prompt",t));const u=document.createElement("a");u.href=d,u.download=c,document.body.appendChild(u),u.click(),document.body.removeChild(u)},t3=({nodes:e,setNodes:t,connections:o,setError:r,getUpstreamNodeValues:a,t:i,setFullSizeImage:s,getFullSizeImage:l,activeTabId:c,activeTabName:d,registerOperation:u,unregisterOperation:p,isGlobalProcessing:h,setTabs:x})=>{const[k,C]=y.useState(!1),[w,f]=y.useState(null),g=y.useRef(null),v=y.useRef(c);y.useEffect(()=>{v.current=c},[c]);const _=y.useCallback((P,R,D,q)=>{v.current===P?(q&&s(R,q.frame,q.url),t(O=>O.map(E=>E.id===R?{...E,value:D}:E))):x(O=>O.map(E=>{if(E.id===P){const A=E.state.nodes.map(j=>j.id===R?{...j,value:D}:j);let N=E.state.fullSizeImageCache||{};return q&&(N={...N,[R]:{...N[R]||{},[q.frame]:q.url}}),{...E,state:{...E.state,nodes:A,fullSizeImageCache:N}}}return E}))},[t,x,s]),S=y.useCallback(async(P,R,D)=>{if(P.type===z.IMAGE_EDITOR){const O=a(P.id,"text",R).filter(V=>typeof V=="string"),E=a(P.id,"image",R).filter(V=>typeof V=="object"),A=a(P.id,"image_b",R).filter(V=>typeof V=="object"),N=JSON.parse(P.value),j=(N.inputImages||[]).map((V,H)=>{var B;const G=l(P.id,H+1)||V;return{base64ImageData:G.split(",")[1],mimeType:((B=G.match(/:(.*?);/))==null?void 0:B[1])||"image/png"}}),L=(N.inputImagesB||[]).map((V,H)=>{var B;const G=l(P.id,2e3+H+1)||V;return{base64ImageData:G.split(",")[1],mimeType:((B=G.match(/:(.*?);/))==null?void 0:B[1])||"image/png"}});return await VE(P,O,E,j,L,A,(V,H)=>{v.current===D&&s(P.id,V,H)})}const q=QE(P.type);if(q){const O=a(P.id,void 0,R);return await q({node:P,upstreamData:O,saveImageToCache:(A,N)=>{v.current===D&&s(P.id,A,N)}})}return{value:null,downloadData:void 0}},[a,s,l]),T=y.useCallback(async(P,R)=>{if(k)return;const D=v.current,q=[...e],O=[...o];C(!0),u({id:P,type:"chain",description:i(R==="execute"?"node.action.executeChain":"node.action.processChainForward"),tabId:c,tabName:d}),g.current=new AbortController;let E=[];if(R==="execute"){const A=new Set,N=j=>{if(A.has(j))return;A.add(j);const L=O.filter(M=>M.toNodeId===j);for(const M of L)N(M.fromNodeId);E.push(j)};N(P)}else{let A=P;for(;A;){E.push(A);const N=O.find(j=>j.fromNodeId===A);A=N?N.toNodeId:null}}try{const A=new Map(q.map(N=>[N.id,N]));for(const N of E){if(g.current.signal.aborted)throw new Error("Aborted");f(N);const j=A.get(N);if(j&&j.type!==z.TEXT_INPUT&&j.type!==z.IMAGE_INPUT&&j.type!==z.NOTE&&j.type!==z.REROUTE_DOT&&j.type!==z.DATA_READER&&j){const M=Array.from(A.values()),V=await S(j,M,D),{value:H,downloadData:F}=V;if(H!=null){const G=typeof H=="object"?JSON.stringify(H):String(H);A.set(N,{...j,value:G}),_(D,N,G)}F&&e3(F.url,F.prompt,F.type)}}}catch(A){A.name!=="AbortError"&&A.message!=="Aborted"&&r(A.message)}finally{C(!1),f(null),g.current=null,p(P)}},[k,e,o,r,S,u,p,c,d,i,_]);return{isExecutingChain:k,executingNodeId:w,handleExecuteChain:P=>T(P,"execute"),stopChainExecution:()=>{g.current&&g.current.abort(),C(!1)},handleProcessChainForward:P=>T(P,"forward")}},n3=({nodes:e,getUpstreamNodeValues:t,setError:o,t:r,registerOperation:a,unregisterOperation:i,updateNodeInStorage:s,activeTabId:l,activeTabName:c,activeTabIdRef:d,setFullSizeImage:u})=>{const[p,h]=y.useState(null),x=y.useCallback(async(k,C=0)=>{const w=d.current,f=e.find(g=>g.id===k);if(f){h(k),o(null),a({id:k,type:"generation",description:r("node.content.generating"),tabId:l,tabName:c});try{let g="",v=f.aspectRatio||"1:1";if(f.type===z.CHARACTER_CARD){let T=JSON.parse(f.value||"[]");Array.isArray(T)||(T=[T]);const P=T[C]||{},R=P.prompt||"";v=P.selectedRatio||"1:1";const D=P.additionalPrompt!==void 0?P.additionalPrompt:"Full body character concept on a gray background";D.trim()?g=R?`${R}, ${D}`:D:g=R}else g=t(k).filter(P=>typeof P=="string").join(", ");if(!g)throw new Error("Prompt is empty. Connect a text node or enter a prompt.");const _=await Vn(g,v,void 0,f.model,f.resolution),S=await Lt(_,256,256);if(f.type===z.CHARACTER_CARD){const T=Wt[v]||1,P=C*10+T;s(w,k,R=>{let D=Array.isArray(R)?[...R]:[R];if(!D[C])return R;const q={...D[C].thumbnails||{},[v]:S};return D[C]={...D[C],image:S,thumbnails:q},D},{frame:P,url:_}),u(k,C*10,_),u(k,P,_)}else s(w,k,()=>S,{frame:0,url:_})}catch(g){o(g.message)}finally{h(null),i(k)}}},[e,t,o,r,s,a,i,l,c,d,u]);return{isGeneratingImage:p,handleGenerateImage:x}},o3=({nodes:e,getUpstreamNodeValues:t,setError:o,t:r,registerOperation:a,unregisterOperation:i,updateNodeInStorage:s,activeTabId:l,activeTabName:c,activeTabIdRef:d,showApiKeyDialog:u})=>{const[p,h]=y.useState(null),x=y.useCallback(async k=>{const C=d.current,w=e.find(f=>f.id===k);if(w){h(k),o(null),a({id:k,type:"video",description:r("node.content.generating"),tabId:l,tabName:c});try{const g=t(k).filter(_=>typeof _=="string").join(", ");if(!g)throw new Error("Video generation requires a text prompt.");if(localStorage.getItem("settings_useDevKey")!=="true"&&!localStorage.getItem("settings_userApiKey")){u({onSelect:()=>{},onClose:()=>{h(null),i(k)}});return}const v=await LE(g,w.aspectRatio,w.resolution);s(C,k,()=>v)}catch(f){o(f.message)}finally{h(null),i(k)}}},[e,t,o,u,r,s,a,i,l,c,d]);return{isGeneratingVideo:p,handleGenerateVideo:x}},r3=(e,t)=>{let o=e;e.startsWith("data:image/png")&&(o=Bi(e,"prompt",t));const r=document.createElement("a");r.href=o;const s=`Image_Editor_Frame_001_${new Date().toISOString().split("T")[0]}.png`;r.download=s,document.body.appendChild(r),r.click(),document.body.removeChild(r)},jg=(e,t)=>Promise.race([e,new Promise((o,r)=>{t.aborted&&r(new DOMException("Aborted","AbortError"));const a=()=>{t.removeEventListener("abort",a),r(new DOMException("Aborted","AbortError"))};t.addEventListener("abort",a)})]),a3=({nodes:e,getUpstreamNodeValues:t,setError:o,t:r,registerOperation:a,unregisterOperation:i,updateNodeInStorage:s,getFullSizeImage:l,activeTabId:c,activeTabName:d,activeTabIdRef:u})=>{const[p,h]=y.useState(!1),[x,k]=y.useState(!1),C=y.useRef(null),w=y.useCallback(async(g,v)=>{const _=u.current,S=e.find(L=>L.id===g);if(!S)return;const T=JSON.parse(S.value||"{}"),P=T.isSequenceMode,R=t(g,"text").filter(L=>typeof L=="string"),D=t(g,"image").filter(L=>typeof L=="object"),q=t(g,"image_b").filter(L=>typeof L=="object"),O=new Map;R.forEach(L=>{try{const M=JSON.parse(L);let V=[];if(M.sourcePrompts||M.modifiedPrompts){const H=M.sourcePrompts||[],F=M.modifiedPrompts||[],G=new Map;H.forEach(B=>G.set(B.frameNumber,B)),F.forEach(B=>G.set(B.frameNumber,{...G.get(B.frameNumber),...B})),V=Array.from(G.values())}else M.type==="script-prompt-modifier-data"?V=M.finalPrompts||M.prompts||[]:Array.isArray(M)&&(V=M);V.length>0&&V.forEach((H,F)=>{const G=(H.frameNumber!==void 0?H.frameNumber:F+1)-1;H.prompt&&O.set(G,H.prompt)})}catch{}});const E=(T.inputImages||[]).map((L,M)=>{var F;const H=l(S.id,M+1)||L;return{base64ImageData:H.split(",")[1],mimeType:((F=H.match(/:(.*?);/))==null?void 0:F[1])||"image/png"}}),A=(T.inputImagesB||[]).map((L,M)=>{var F;const H=l(S.id,2e3+M+1)||L;return{base64ImageData:H.split(",")[1],mimeType:((F=H.match(/:(.*?);/))==null?void 0:F[1])||"image/png"}}),N=[...E,...D],j=[...A,...q];if(!T.isSequentialEditingWithPrompts&&N.length===0&&T.model!=="gemini-3-pro-image-preview"){o("No input image provided for editing.");return}h(!0),o(null),k(!1),C.current=new AbortController,a({id:g,type:"generation",description:r("node.content.editing"),tabId:c,tabName:d});try{if(P){const L=v||(T.isSequentialEditingWithPrompts?T.checkedSequenceOutputIndices||j.map((H,F)=>F):T.checkedInputIndices??N.map((H,F)=>F)),V=[...T.sequenceOutputs||[]];L.forEach(H=>{V[H]={status:"pending",thumbnail:null}}),s(_,g,H=>({...H,sequenceOutputs:V}));for(const H of L){if(C.current.signal.aborted)break;let F=[];if(T.isSequentialEditingWithPrompts)F=j;else{const G=N[H];if(!G&&T.model!=="gemini-3-pro-image-preview")continue;G&&(F=[G]),T.isSequentialCombinationMode&&j.length>0&&F.push(...j)}s(_,g,G=>{const B=[...G.sequenceOutputs||[]];return B[H]={...B[H],status:"generating"},{...G,sequenceOutputs:B}});try{let G=T.prompt;(T.isSequentialPromptMode||T.isSequentialEditingWithPrompts)&&(O.has(H)?G=O.get(H):T.framePrompts&&T.framePrompts[H]&&(G=T.framePrompts[H]));const B=R.filter(ue=>!ue.trim().startsWith("{")&&!ue.trim().startsWith("["));let Y=[G,...B].filter(Boolean).join(", ");const ee=await Promise.all(F.map(async ue=>{var $;const re=`data:${ue.mimeType};base64,${ue.base64ImageData}`;if(T.enableAspectRatio&&T.aspectRatio&&T.aspectRatio!=="Auto"){const{formattedImage:Z}=await br(re,T.aspectRatio);return{base64ImageData:Z.split(",")[1],mimeType:(($=Z.match(/:(.*?);/))==null?void 0:$[1])||"image/png"}}return ue}));T.enableOutpainting&&(Y=(T.outpaintingPrompt||"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.").replace("{main_prompt}",Y));const ie=await jg(Vn(Y,T.aspectRatio,ee,T.model,T.resolution),C.current.signal);let ce=ie;if(T.autoCrop169)try{ce=await Ra(ie)}catch(ue){console.error(ue)}const pe=await Lt(ce,256,256);if(s(_,g,ue=>{const re=[...ue.sequenceOutputs||[]];return re[H]={status:"done",thumbnail:pe},{...ue,sequenceOutputs:re}},{frame:1e3+H,url:ce}),T.autoDownload){const re=new Date().toISOString().split("T")[0],Z=`Image_Editor_Frame_${String(H+1).padStart(3,"0")}_${re}.png`;let te=ce;ce.startsWith("data:image/png")&&(te=Bi(ce,"prompt",Y));const ae=document.createElement("a");ae.href=te,ae.download=Z,document.body.appendChild(ae),ae.click(),document.body.removeChild(ae)}}catch(G){if(G.name==="AbortError"||G.message==="Aborted"){s(_,g,B=>{const Y=[...B.sequenceOutputs||[]];return Y[H]={...Y[H],status:"pending"},{...B,sequenceOutputs:Y}});break}else console.error(`Frame ${H} failed`,G),s(_,g,B=>{const Y=[...B.sequenceOutputs||[]];return Y[H]={status:"error",thumbnail:null},{...B,sequenceOutputs:Y}})}}}else{let L=[];const M=T.checkedInputIndices;M&&Array.isArray(M)?L=N.filter((ee,ie)=>M.includes(ie)):L=N;const V=R.filter(ee=>!ee.trim().startsWith("{")&&!ee.trim().startsWith("["));let H=[T.prompt,...V].filter(Boolean).join(", ");const F=await Promise.all(L.map(async ee=>{var ce;const ie=`data:${ee.mimeType};base64,${ee.base64ImageData}`;if(T.enableAspectRatio&&T.aspectRatio&&T.aspectRatio!=="Auto"){const{formattedImage:pe}=await br(ie,T.aspectRatio);return{base64ImageData:pe.split(",")[1],mimeType:((ce=pe.match(/:(.*?);/))==null?void 0:ce[1])||"image/png"}}return ee}));T.enableOutpainting&&(H=(T.outpaintingPrompt||"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.").replace("{main_prompt}",H));const G=await jg(Vn(H,T.aspectRatio,F,T.model,T.resolution),C.current.signal);let B=G;if(T.autoCrop169)try{B=await Ra(G)}catch(ee){console.error(ee)}const Y=await Lt(B,256,256);s(_,g,ee=>({...ee,outputImage:Y}),{frame:0,url:B}),T.autoDownload&&r3(B,H)}}catch(L){L.name!=="AbortError"&&L.message!=="Aborted"&&o(L.message)}finally{h(!1),k(!1),C.current=null,i(g)}},[e,t,l,o,r,s,a,i,c,d,u]),f=y.useCallback(()=>{C.current&&(k(!0),C.current.abort())},[]);return{isEditingImage:p,isStoppingEdit:x,handleEditImage:w,handleStopEdit:f}},Ag=(e,t)=>Promise.race([e,new Promise((o,r)=>{t.aborted&&r(new DOMException("Aborted","AbortError"));const a=()=>{t.removeEventListener("abort",a),r(new DOMException("Aborted","AbortError"))};t.addEventListener("abort",a)})]),Mg=(e,t,o)=>{let r=e;e.startsWith("data:image/png")&&(r=Bi(e,"prompt",o));const a=document.createElement("a");a.href=r;const i=new Date,s=i.toISOString().split("T")[0],l=i.toTimeString().split(" ")[0].replace(/:/g,"-"),c=String(t).padStart(3,"0");a.download=`Frame_${c}_seq_gen_${s}_${l}.png`,document.body.appendChild(a),a.click(),document.body.removeChild(a)},i3=({nodes:e,setError:t,t:o,registerOperation:r,unregisterOperation:a,updateNodeInStorage:i,connectedCharacterData:s,activeTabId:l,activeTabName:c,activeTabIdRef:d,addToast:u,setFullSizeImage:p})=>{const[h,x]=y.useState(null),[k,C]=y.useState(!1),w=y.useRef(null),f=(P,R)=>{const D=P.characterConcepts||[];return[...(s.get(R)||[]).map(E=>({...E,id:E.index||E.alias||E.name||`upstream-${Math.random().toString(36).substr(2,5)}`,isUpstream:!0})),...D]},g=(P,R)=>{if(!P)return null;const D=O=>String(O).toLowerCase().replace(/[^a-z0-9]/g,""),q=D(P);return R.find(O=>!!(O.index&&D(O.index)===q||O.alias&&D(O.alias)===q||O.name&&D(O.name)===q||O.id&&D(O.id)===q))},v=y.useCallback((P,R)=>{i(P,R,D=>{const q={...D.frameStatuses||{}};let O=!1;return Object.keys(q).forEach(E=>{const A=q[E];(A==="pending"||A==="generating"||A==="prompt_processing")&&(q[E]="idle",O=!0)}),O?{...D,frameStatuses:q}:D})},[i]),_=y.useCallback(async(P,R=0)=>{var O;const D=d.current,q=e.find(E=>E.id===P);if(q){x(P),t(null),C(!1),w.current=new AbortController,r({id:P,type:"sequence",description:o("node.content.generating"),tabId:l,tabName:c});try{const E=JSON.parse(q.value||"{}"),A=E.prompts||[],N=f(E,P),j=A.slice(R),L=E.isStyleInserted!==!1,M=E.isSceneContextInserted!==!1,V=E.sceneContexts||{},H=E.integrationPrompt||"Integrate these Entities into the scene, action and pose. Fill the background with environmental elements  fill in the gray area of the source scene image naturally.";i(D,P,F=>{const G={...F.frameStatuses||{}};return j.forEach(B=>{G[B.frameNumber]="pending"}),{...F,frameStatuses:G}});for(const F of j){if((O=w.current)!=null&&O.signal.aborted)break;const G=F.frameNumber;i(D,P,B=>({...B,frameStatuses:{...B.frameStatuses||{},[G]:"generating"}}));try{let B=F.characters||[];if(B.length===0&&F.prompt){const $=F.prompt.match(/(?:character|entity)-\d+/gi);$&&(B=[...new Set($)])}const Y=[],ee=new Set;for(const $ of B){const Z=g($,N);if(!Z||ee.has(Z.index||Z.id))continue;const te=Z._fullResImage||Z.image;if(te&&typeof te=="string"&&te.startsWith("data:")){const ae=te.match(/:(.*?);/),I=te.split(",")[1];I&&(Y.push({base64ImageData:I,mimeType:ae?ae[1]:"image/png",_dataUrl:te}),ee.add(Z.index||Z.id))}}let ie=F.prompt;if(Y.length>0){const $=F.shotType?o(`image_sequence.shot_type.${F.shotType}`):"";if(ie=`${H}
${$}

${ie}`,M){const Z=F.sceneNumber||1,te=V[String(Z)];te&&te.trim()&&(ie=`${te.trim()}

${ie}`)}E.characterPromptCombination==="replace"&&(ie=ie.replace(/((?:Character|Entity)[-\s]?\d+|(?:Character|Entity)[-\s]?\w+)/gi,Z=>{const te=g(Z,N);return te&&te.prompt?`${Z} (${te.prompt})`:Z}))}let ce=[];E.enableAspectRatio&&E.aspectRatio&&E.aspectRatio!=="Auto"&&Y.length>0?ce=await Promise.all(Y.map(async $=>{var Z;try{const{formattedImage:te}=await br($._dataUrl,E.aspectRatio);return{base64ImageData:te.split(",")[1],mimeType:((Z=te.match(/:(.*?);/))==null?void 0:Z[1])||"image/png"}}catch{return{base64ImageData:$.base64ImageData,mimeType:$.mimeType}}})):ce=Y.map($=>({base64ImageData:$.base64ImageData,mimeType:$.mimeType})),L&&E.styleOverride&&(ie=`${ie}

[Visual Style]: ${E.styleOverride}`);const pe=await Ag(Vn(ie,E.aspectRatio,ce.length>0?ce:void 0,E.model),w.current.signal);let ue=pe;if(E.autoCrop169&&E.aspectRatio==="16:9")try{ue=await Ra(pe)}catch{}const re=await Lt(ue,128,128);i(D,P,$=>({...$,images:{...$.images||{},[G]:re},frameStatuses:{...$.frameStatuses||{},[G]:"done"}}),{frame:1e3+G,url:ue}),E.autoDownload&&Mg(ue,G,F.prompt)}catch(B){if(B.name==="AbortError"||B.message==="Aborted"){i(D,P,Y=>({...Y,frameStatuses:{...Y.frameStatuses||{},[G]:"idle"}}));break}else console.error(`Frame ${G} failed:`,B),i(D,P,Y=>({...Y,frameStatuses:{...Y.frameStatuses||{},[G]:"error"}}))}}}catch(E){E.name!=="AbortError"&&E.message!=="Aborted"&&t(E.message)}finally{v(D,P),x(null),C(!1),w.current=null,a(P)}}},[e,s,t,o,i,r,a,l,c,d,u,p,v]),S=y.useCallback(async(P,R)=>{var A;const D=d.current,q=e.find(N=>N.id===P);if(!q)return;const O=JSON.parse(q.value||"{}"),E=R||O.checkedFrameNumbers||[];if(E.length!==0){x(P),t(null),C(!1),w.current=new AbortController,r({id:P,type:"sequence",description:o("node.content.generating"),tabId:l,tabName:c});try{const N=O.prompts||[],j=f(O,P),L=N.filter(G=>E.includes(G.frameNumber)),M=O.isStyleInserted!==!1,V=O.isSceneContextInserted!==!1,H=O.sceneContexts||{},F=O.integrationPrompt||"Integrate these Entities into the scene and action. Fill the background with environmental elements  fill in the gray area of the source scene image naturally.";i(D,P,G=>{const B={...G.frameStatuses||{}};return E.forEach(Y=>{B[Y]="pending"}),{...G,frameStatuses:B}});for(const G of L){if((A=w.current)!=null&&A.signal.aborted)break;const B=G.frameNumber;i(D,P,Y=>({...Y,frameStatuses:{...Y.frameStatuses||{},[B]:"generating"}}));try{let Y=G.characters||[];if(Y.length===0&&G.prompt){const Z=G.prompt.match(/(?:character|entity)-\d+/gi);Z&&(Y=[...new Set(Z)])}const ee=[],ie=new Set;for(const Z of Y){const te=g(Z,j);if(!te||ie.has(te.index||te.id))continue;const ae=te._fullResImage||te.image;if(ae&&typeof ae=="string"&&ae.startsWith("data:")){const I=ae.match(/:(.*?);/),J=ae.split(",")[1];J&&(ee.push({base64ImageData:J,mimeType:I?I[1]:"image/png",_dataUrl:ae}),ie.add(te.index||te.id))}}let ce=G.prompt;if(ee.length>0){const Z=G.shotType?o(`image_sequence.shot_type.${G.shotType}`):"";if(ce=`${F}
${Z}

${ce}`,V){const te=G.sceneNumber||1,ae=H[String(te)];ae&&ae.trim()&&(ce=`${ae.trim()}

${ce}`)}O.characterPromptCombination==="replace"&&(ce=ce.replace(/((?:Character|Entity)[-\s]?\d+|(?:Character|Entity)[-\s]?\w+)/gi,te=>{const ae=g(te,j);return ae&&ae.prompt?`${te} (${ae.prompt})`:te}))}let pe=[];O.enableAspectRatio&&O.aspectRatio&&O.aspectRatio!=="Auto"&&ee.length>0?pe=await Promise.all(ee.map(async Z=>{var te;try{const{formattedImage:ae}=await br(Z._dataUrl,O.aspectRatio);return{base64ImageData:ae.split(",")[1],mimeType:((te=ae.match(/:(.*?);/))==null?void 0:te[1])||"image/png"}}catch{return{base64ImageData:Z.base64ImageData,mimeType:Z.mimeType}}})):pe=ee.map(Z=>({base64ImageData:Z.base64ImageData,mimeType:Z.mimeType})),M&&O.styleOverride&&(ce=`${ce}

[Visual Style]: ${O.styleOverride}`);const ue=await Ag(Vn(ce,O.aspectRatio,pe.length>0?pe:void 0,O.model),w.current.signal);let re=ue;if(O.autoCrop169&&O.aspectRatio==="16:9")try{re=await Ra(ue)}catch{}const $=await Lt(re,128,128);i(D,P,Z=>({...Z,images:{...Z.images||{},[B]:$},frameStatuses:{...Z.frameStatuses||{},[B]:"done"}}),{frame:1e3+B,url:re}),O.autoDownload&&Mg(re,B,G.prompt)}catch(Y){if(Y.name==="AbortError"&&Y.message==="Aborted"){i(D,P,ee=>({...ee,frameStatuses:{...ee.frameStatuses||{},[B]:"idle"}}));break}else console.error(`Frame ${B} failed:`,Y),i(D,P,ee=>({...ee,frameStatuses:{...ee.frameStatuses||{},[B]:"error"}}))}}}catch(N){N.name!=="AbortError"&&N.message!=="Aborted"&&t(N.message)}finally{v(D,P),x(null),C(!1),w.current=null,a(P)}}},[e,s,t,o,i,r,a,l,c,d,u,p,v]),T=y.useCallback(()=>{w.current&&(C(!0),w.current.abort())},[]);return{isGeneratingSequence:h,isStoppingSequence:k,handleGenerateImageSequence:_,handleGenerateSelectedFrames:S,handleStopImageSequence:T}},s3=({nodes:e,setError:t,t:o,registerOperation:r,unregisterOperation:a,updateNodeInStorage:i,activeTabId:s,activeTabName:l,activeTabIdRef:c})=>{const[d,u]=y.useState(null),p=y.useCallback(async(h,x)=>{const k=c.current,C=e.find(w=>w.id===h);if(C){u(`${h}-${x}`),r({id:h,type:"generation",description:o("node.content.generating"),tabId:s,tabName:l});try{const w=JSON.parse(C.value||"{}"),f=w.characters||[],g=f.find(D=>D.id===x);if(!g)throw new Error("Character not found");const v=g.prompt||g.imagePrompt;if(!v)throw new Error("No prompt for character");const _=w.additionalPrompt||"",S=_.trim()?`${v}, ${_}`:v,P=(await Vn(S,"1:1",void 0,"gemini-3-flash-preview")).split(",")[1],R=f.map(D=>D.id===x?{...D,imageBase64:P}:D);i(k,h,D=>({...D,characters:R}))}catch(w){t(w.message)}finally{u(null),a(h)}}},[e,t,o,i,r,a,s,l,c]);return{isGeneratingCharacterImage:d,handleGenerateCharacterImage:p}},l3=({nodes:e,connections:t,setNodes:o,getUpstreamNodeValues:r,setError:a,showApiKeyDialog:i,t:s,setFullSizeImage:l,getFullSizeImage:c,connectedCharacterData:d,activeTabId:u,setTabs:p,activeTabName:h,registerOperation:x,unregisterOperation:k,isGlobalProcessing:C,addToast:w})=>{const f=y.useRef(u);y.useEffect(()=>{f.current=u},[u]);const g=y.useCallback((D,q,O,E)=>{const A=N=>{try{return JSON.parse(N||"{}")}catch{return N}};f.current===D?(E&&l(q,E.frame,E.url),o(N=>N.map(j=>{if(j.id===q){const L=A(j.value),M=O(L),V=typeof M=="string"?M:JSON.stringify(M);return{...j,value:V}}return j}))):p(N=>N.map(j=>{if(j.id===D){const L=j.state.nodes.map(V=>{if(V.id===q){const H=A(V.value),F=O(H),G=typeof F=="string"?F:JSON.stringify(F);return{...V,value:G}}return V});let M=j.state.fullSizeImageCache||{};return E&&(M={...M,[q]:{...M[q]||{},[E.frame]:E.url}}),{...j,state:{...j.state,nodes:L,fullSizeImageCache:M}}}return j}))},[o,p,l]),v={nodes:e,setNodes:o,getUpstreamNodeValues:r,setError:a,t:s,setFullSizeImage:l,getFullSizeImage:c,activeTabId:u,setTabs:p,activeTabName:h,registerOperation:x,unregisterOperation:k,updateNodeInStorage:g,activeTabIdRef:f,addToast:w},_=n3(v),S=o3({...v,showApiKeyDialog:i}),T=a3(v),P=i3({...v,connectedCharacterData:d}),R=s3(v);return{isGeneratingImage:_.isGeneratingImage,handleGenerateImage:_.handleGenerateImage,isGeneratingVideo:S.isGeneratingVideo,handleGenerateVideo:S.handleGenerateVideo,isEditingImage:T.isEditingImage,isStoppingEdit:T.isStoppingEdit,handleEditImage:T.handleEditImage,handleStopEdit:T.handleStopEdit,isGeneratingSequence:P.isGeneratingSequence,isStoppingSequence:P.isStoppingSequence,handleGenerateImageSequence:P.handleGenerateImageSequence,handleGenerateSelectedFrames:P.handleGenerateSelectedFrames,handleStopImageSequence:P.handleStopImageSequence,isGeneratingCharacterImage:R.isGeneratingCharacterImage,handleGenerateCharacterImage:R.handleGenerateCharacterImage}},c3=({nodes:e,setNodes:t,getUpstreamNodeValues:o,setError:r,t:a,activeTabId:i,setTabs:s,activeTabName:l,registerOperation:c,unregisterOperation:d,addToast:u})=>{const[p,h]=y.useState(null),[x,k]=y.useState(null),[C,w]=y.useState(null),[f,g]=y.useState(null),[v,_]=y.useState(null),[S,T]=y.useState(null),[P,R]=y.useState(null),[D,q]=y.useState(null),[O,E]=y.useState(null),[A,N]=y.useState(null),[j,L]=y.useState(!1),M=y.useRef(null),V=y.useRef(i);y.useEffect(()=>{V.current=i},[i]);const H=y.useCallback((Z,te,ae)=>{const I=J=>{try{return JSON.parse(J||"{}")}catch{return J}};V.current===Z?t(J=>J.map(W=>{if(W.id===te){const U=I(W.value),Q=ae(U),de=typeof Q=="string"?Q:JSON.stringify(Q);return{...W,value:de}}return W})):s(J=>J.map(W=>{if(W.id===Z){const U=W.state.nodes.map(Q=>{if(Q.id===te){const de=I(Q.value),se=ae(de),X=typeof se=="string"?se:JSON.stringify(se);return{...Q,value:X}}return Q});return{...W,state:{...W.state,nodes:U}}}return W}))},[t,s]),F=y.useCallback(async Z=>{const te=V.current;h(Z),r(null),c({id:Z,type:"generation",description:a("node.content.enhancing"),tabId:i,tabName:l});try{const ae=e.find(de=>de.id===Z);if(!ae)return;let I;try{I=JSON.parse(ae.value||"{}")}catch{I={prompt:ae.value}}const J=I.safePrompt!==!1,W=I.technicalPrompt===!0;let U=o(Z).filter(de=>typeof de=="string");U.length===0&&I.inputPrompt&&(U=[I.inputPrompt]);const Q=await P1(U,J,W);H(te,Z,de=>({...de,prompt:Q}))}catch(ae){r(ae.message)}finally{h(null),d(Z)}},[e,o,r,a,H,c,d,i,l]),G=y.useCallback(async Z=>{const te=V.current;w(Z),r(null),c({id:Z,type:"generation",description:a("node.content.sanitizing"),tabId:i,tabName:l});try{const ae=o(Z).filter(J=>typeof J=="string"),I=await T1(ae.join(", "));H(te,Z,()=>I)}catch(ae){r(ae.message)}finally{w(null),d(Z)}},[o,r,a,H,c,d,i,l]),B=y.useCallback(async Z=>{const te=V.current;k(Z),r(null),c({id:Z,type:"generation",description:a("node.content.enhancing"),tabId:i,tabName:l});try{const ae=o(Z).filter(J=>typeof J=="string"),I=await I1(ae);H(te,Z,J=>typeof J=="object"?{...J,prompt:I}:I)}catch(ae){r(ae.message)}finally{k(null),d(Z)}},[o,r,a,H,c,d,i,l]),Y=y.useCallback(async Z=>{const te=V.current;g(Z),r(null),c({id:Z,type:"generation",description:a("node.content.translating"),tabId:i,tabName:l});try{const ae=e.find(de=>de.id===Z);if(!ae)return;const I=JSON.parse(ae.value||"{}"),J=o(Z).filter(de=>typeof de=="string");let W=J.length>0?J.join(`
`):I.inputText;const U=I.targetLanguage||"en";if(I.image&&typeof I.image=="string"&&I.image.startsWith("data:image")){const de=I.image.split(",");if(de.length===2){const se=I.image.match(/:(.*?);/),X=se?se[1]:"image/png",K=de[1],oe=await Np(K,X);oe&&oe!=="No text found"&&(W=oe)}}const Q=await Ep(W,U);H(te,Z,de=>({...de,inputText:W,translatedText:Q}))}catch(ae){r(ae.message)}finally{g(null),d(Z)}},[e,o,r,a,H,c,d,i,l]),ee=y.useCallback(async Z=>{const te=V.current;_(Z),r(null),c({id:Z,type:"generation",description:a("node.content.translating"),tabId:i,tabName:l});try{const ae=e.find(de=>de.id===Z);if(!ae)return;const I=JSON.parse(ae.value||"{}"),J=I.targetLanguage||"en",U={en:"English",ru:"Russian"}[J]||"English",Q=await zE(I,U);H(te,Z,()=>(Q.targetLanguage=J,Q))}catch(ae){r(ae.message)}finally{_(null),d(Z)}},[e,r,a,H,c,d,i,l]),ie=y.useCallback(async Z=>{const te=V.current;T(Z),r(null),c({id:Z,type:"generation",description:a("node.content.generating"),tabId:i,tabName:l});try{const ae=e.find(de=>de.id===Z);if(!ae)return;const I=JSON.parse(ae.value||"{}"),J=o(Z).filter(de=>typeof de=="string"),W=J.length>0?J.join(`
`):I.prompt,U=I.targetLanguage||"en",Q=await R1(W,U);H(te,Z,de=>({...de,...Q,prompt:W,type:"script-generator-data"}))}catch(ae){r(ae.message)}finally{T(null),d(Z)}},[e,o,r,a,H,c,d,i,l]),ce=y.useCallback(async Z=>{var ae;const te=V.current;R(Z),r(null),M.current=new AbortController,c({id:Z,type:"generation",description:a("node.content.generating"),tabId:i,tabName:l});try{const I=e.find(fe=>fe.id===Z);if(!I)return;const J=JSON.parse(I.value||"{}"),W=o(Z).filter(fe=>typeof fe=="string"),U=W.length>0?W.join(`
`):J.prompt,Q=J.numberOfCharacters||1,de=J.targetLanguage||"ru",se=J.characterType||"simple",X=J.style||"simple",K=J.customStyle||"",oe=J.characters||[],le=`Generate ${Q} detailed character description(s) based on this prompt: "${U}". 
            Language: ${de}. 
            Character Type: ${se}. 
            Visual Style: ${X==="custom"?K:X}.
            
            **CRITICAL REQUIREMENTS:**
            1. **APPEARANCE ONLY**: Focus strictly on physical attributes: physiognomy, hair/fur texture, eye color, body type, clothing details, colors, and materials.
            2. **NEGATIVE CONSTRAINTS**: Do NOT describe the pose, action, gesture, expression (e.g. smiling), background, lighting, or camera angle.
            
            REQUIRED OUTPUT FORMAT:
            Return a JSON array where each object has:
            - 'name': Character name.
            - 'index': Short identifier (e.g. Entity-1, Entity-2).
            - 'imagePrompt': A highly detailed English image generation prompt describing the character's visual features ONLY.
            - 'fullDescription': A detailed text description formatted with markdown headers (#### ${(de==="ru"?", , ":"Appearance, Personality, Clothing").split(", ").join(", #### ")}).
            `,ge=await L1(le);if((ae=M.current)!=null&&ae.signal.aborted)return;let we=0;oe.forEach(fe=>{const ye=(fe.index||fe.alias||"").match(/(?:Entity|Character)-(\d+)/i);ye&&(we=Math.max(we,parseInt(ye[1],10)))});const _e=ge.map((fe,he)=>({id:`char-${Date.now()}-${he}`,...fe,index:fe.index||`Entity-${we+he+1}`,prompt:fe.imagePrompt}));H(te,Z,fe=>{const he=fe.characters||[],ye=[..._e,...he];return{...fe,characters:ye,prompt:U,error:null}})}catch(I){I.name!=="AbortError"&&r(I.message)}finally{R(null),M.current=null,L(!1),d(Z)}},[e,o,r,a,H,c,d,i,l]),pe=y.useCallback(()=>{M.current&&(L(!0),M.current.abort())},[]),ue=y.useCallback(async Z=>{const te=V.current;q(Z),r(null),c({id:Z,type:"sequence",description:a("prompt_sequence_editor.modifying"),tabId:i,tabName:l});try{const ae=e.find(K=>K.id===Z);if(!ae)return;const{instruction:I,sourcePrompts:J=[],checkedSourceFrameNumbers:W=[],targetLanguage:U="en",modificationModel:Q="gemini-2.5-flash",includeVideoPrompts:de=!1}=JSON.parse(ae.value||"{}");if(!I||!I.trim())throw new Error("Modification instruction is empty.");if(!W||W.length===0)throw new Error("No source prompts selected for modification.");const se=J.filter(K=>W.includes(K.frameNumber));if(se.length===0)throw new Error("Selected prompts not found in the source list.");const X=await D1(se,I,U,Q,de);H(te,Z,K=>{const oe=K.modifiedPrompts||[],ne=new Map(oe.map(ge=>[ge.frameNumber,ge]));X.forEach(ge=>{ne.set(ge.frameNumber,ge)});const le=Array.from(ne.values());return{...K,modifiedPrompts:le}})}catch(ae){r(ae.message)}finally{q(null),d(Z)}},[e,r,a,H,c,d,i,l]),re=y.useCallback(async(Z,te)=>{var J;const ae=V.current,I=`${Z}-${te}`;E(I),r(null),c({id:I,type:"generation",description:a("node.content.enhancing"),tabId:i,tabName:l});try{const W=e.find(le=>le.id===Z);if(!W)return;const U=JSON.parse(W.value||"[]"),de=(Array.isArray(U)?U:[U])[te];if(!de)throw new Error("Character card not found at specified index.");const se=de.prompt,X=de.fullDescription,K=de.targetLanguage||localStorage.getItem("settings_secondaryLanguage")||"en",oe=((J=Pn[K])==null?void 0:J.name)||"English";if(!se||!se.trim())throw new Error("Image prompt is missing for this character.");const ne=await ME(se,X,oe);H(ae,Z,le=>{const ge=Array.isArray(le)?[...le]:[le];return ge[te]&&(ge[te]={...ge[te],fullDescription:ne}),ge}),u("Description updated successfully","success")}catch(W){r(W.message)}finally{E(null),d(I)}},[e,r,a,H,c,d,i,l,u]),$=y.useCallback(async(Z,te,ae)=>{var W;const I=V.current,J=`${Z}-${te}`;N(J),r(null),c({id:J,type:"generation",description:a("prompt_sequence_editor.modifying"),tabId:i,tabName:l});try{const U=e.find(ge=>ge.id===Z);if(!U)return;const Q=JSON.parse(U.value||"[]"),se=(Array.isArray(Q)?Q:[Q])[te];if(!se)throw new Error("Character card not found.");const X=se.prompt,K=se.fullDescription,oe=se.targetLanguage||localStorage.getItem("settings_secondaryLanguage")||"en",ne=((W=Pn[oe])==null?void 0:W.name)||"English",le=await RE(ae,X,K,ne);H(I,Z,ge=>{const we=Array.isArray(ge)?[...ge]:[ge];return we[te]&&(we[te]={...we[te],prompt:le.newPrompt,fullDescription:le.newDescription}),we}),u(a("toast.modificationComplete"),"success")}catch(U){r(U.message)}finally{N(null),d(J)}},[e,r,a,H,c,d,i,l,u]);return{isEnhancing:p,isEnhancingVideo:x,isSanitizing:C,isTranslating:f,isTranslatingScript:v,isGeneratingScript:S,isGeneratingCharacters:P,isModifyingPromptSequence:D,isUpdatingDescription:O,isModifyingCharacter:A,handleEnhance:F,handleEnhanceVideo:B,handleSanitizePrompt:G,handleTranslate:Y,handleTranslateScript:ee,handleGenerateScript:ie,handleGenerateCharacters:ce,onModifyPromptSequence:ue,handleUpdateCharacterDescription:re,handleModifyCharacter:$,isStopping:j,handleStopGeneration:pe}},d3=e=>{const[t,o]=y.useState([]),[r,a]=y.useState([]),i=5,s=y.useCallback(d=>{const u=d.map(p=>({id:p.id,position:{...p.position}}));o(p=>{const h=[...p,u];return h.length>i?h.slice(h.length-i):h}),a([])},[]),l=y.useCallback(d=>{o(u=>{if(u.length===0)return u;const p=[...u],h=p.pop();if(h){const x=d.map(k=>({id:k.id,position:{...k.position}}));a(k=>[x,...k]),e(k=>k.map(C=>{const w=h.find(f=>f.id===C.id);return w?{...C,position:{...w.position}}:C}))}return p})},[e]),c=y.useCallback(d=>{a(u=>{if(u.length===0)return u;const p=[...u],h=p.shift();if(h){const x=d.map(k=>({id:k.id,position:{...k.position}}));o(k=>{const C=[...k,x];return C.length>i?C.slice(C.length-i):C}),e(k=>k.map(C=>{const w=h.find(f=>f.id===C.id);return w?{...C,position:{...w.position}}:C}))}return p})},[e]);return{takeSnapshot:s,undoPosition:l,redoPosition:c,canUndo:t.length>0,canRedo:r.length>0}},u3=({nodes:e})=>{const[t,o]=y.useState("idle"),[r,a]=y.useState(null),i=y.useRef(!1);y.useEffect(()=>{if(i.current)return;localStorage.getItem("tutorial_completed")&&o("completed"),i.current=!0},[]);const s=y.useCallback(()=>{if(localStorage.getItem("tutorial_completed")){o("completed");return}o("text_input_0")},[]),l=y.useCallback(()=>{localStorage.setItem("tutorial_completed","true"),o("completed")},[]),c=y.useCallback(()=>{o(u=>{switch(u){case"text_input_0":return"text_input_1";case"text_input_1":return"text_input_2";case"text_input_2":return"prompt_processor_enhance";case"prompt_processor_enhance":return"prompt_processor_waiting";case"prompt_processor_waiting":return"image_output_generate";case"image_output_generate":return"image_output_generating";case"image_output_generating":return"toolbar_group_catalog";case"toolbar_group_catalog":return"toolbar_group_general";case"toolbar_group_general":return"toolbar_group_input";case"toolbar_group_input":return"toolbar_group_processing";case"toolbar_group_processing":return"toolbar_group_character";case"toolbar_group_character":return"toolbar_group_output";case"toolbar_group_output":return"toolbar_group_ai";case"toolbar_group_ai":return"toolbar_group_video";case"toolbar_group_video":return"toolbar_group_scripts";case"toolbar_group_scripts":return"toolbar_group_file";case"toolbar_group_file":return"tutorial_success_message";case"tutorial_success_message":return localStorage.setItem("tutorial_completed","true"),"completed";default:return"completed"}})},[]),d=y.useCallback(u=>{o(u),u==="completed"&&localStorage.setItem("tutorial_completed","true")},[]);return y.useEffect(()=>{if(t==="completed"||t==="idle"||t==="tutorial_success_message"){a(null);return}const u=e.filter(k=>k.type===z.TEXT_INPUT).sort((k,C)=>k.position.y-C.position.y),p=e.filter(k=>k.type===z.PROMPT_PROCESSOR),h=e.filter(k=>k.type===z.IMAGE_OUTPUT);let x=null;switch(t){case"text_input_0":u.length>0&&(x=u[0].id);break;case"text_input_1":u.length>1?x=u[1].id:p.length>0&&o("prompt_processor_enhance");break;case"text_input_2":u.length>2?x=u[2].id:p.length>0&&o("prompt_processor_enhance");break;case"prompt_processor_enhance":case"prompt_processor_waiting":p.length>0&&(x=p[0].id);break;case"image_output_generate":h.length>0&&(x=h[0].id);break}a(x)},[t,e]),{tutorialStep:t,tutorialTargetId:r,advanceTutorial:c,startTutorial:s,setTutorialStep:d,skipTutorial:l}},z1="settings_googleClientId",p3=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],h3="https://www.googleapis.com/auth/drive.file";let Na,pu=!1,hu=!1;const m3=async e=>e?new Promise(t=>{const o=()=>{typeof gapi<"u"?gapi.load("client",async()=>{await gapi.client.init({clientId:e,discoveryDocs:p3}),pu=!0,a()}):setTimeout(o,100)},r=()=>{typeof google<"u"&&google.accounts?(Na=google.accounts.oauth2.initTokenClient({client_id:e,scope:h3,callback:""}),hu=!0,a()):setTimeout(r,100)},a=()=>{pu&&hu&&t(!0)};o(),r()}):!1,g3=async()=>{if(!Na)throw new Error("Google Drive API not initialized. Please check Client ID.");return new Promise((e,t)=>{Na.callback=o=>{o.error?t(o):e(o)},Na.requestAccessToken({prompt:"consent"})})},f3=async(e,t)=>{if(!pu||!hu)throw new Error("Google Drive API not initialized. Please configure Client ID in settings.");return new Promise((o,r)=>{const a=gapi.client.getToken(),i=async()=>{try{const s={name:e,mimeType:"application/json"},l="-------314159265358979323846",c=`\r
--`+l+`\r
`,d=`\r
--`+l+"--",u=c+`Content-Type: application/json\r
\r
`+JSON.stringify(s)+c+`Content-Type: application/json\r
\r
`+t+d;await gapi.client.request({path:"/upload/drive/v3/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/related; boundary="'+l+'"'},body:u}),o()}catch(s){r(s)}};a===null?(Na.callback=async s=>{s.error?r(s):await i()},Na.requestAccessToken({prompt:"consent"})):i()})},x3=()=>localStorage.getItem(z1)||"",y3=e=>localStorage.setItem(z1,e),v3=({addToast:e,getCurrentCanvasState:t,tabs:o,activeTabId:r,language:a,isSnapToGrid:i,lineStyle:s,catalogItems:l,libraryItems:c,characterCatalog:d,scriptCatalog:u,sequenceCatalog:p,t:h})=>{const[x,k]=y.useState(x3()),[C,w]=y.useState(!1),[f,g]=y.useState(!1);y.useEffect(()=>{x&&m3(x).then(()=>{w(!0)})},[x]);const v=T=>{y3(T),k(T)},_=y.useCallback(async()=>{if(!C){e(h("error.googleDriveInit"),"error");return}try{await g3(),e("Successfully signed in to Google!","success")}catch(T){console.error("Sign in failed",T),e("Failed to sign in to Google Drive","error")}},[C,e,h]),S=y.useCallback(async()=>{if(!C){e(h("error.googleDriveInit"),"error");return}g(!0);try{const T=t(),P=o.map(E=>E.id===r?{...E,state:T}:E),R={type:"prompt-modifier-project",appName:"Prompt_modifier",version:1,timestamp:new Date().toISOString(),tabs:P,activeTabId:r,settings:{language:a,isSnapToGrid:i,lineStyle:s},catalogs:{groups:l,library:c,characters:d.items,scripts:u.items,sequences:p.items}},D=JSON.stringify(R,null,2),O=`Prompt_Modifier_Project_${new Date().toISOString().replace(/:/g,"-").replace("T","_").split(".")[0]}.json`;await f3(O,D),e(h("toast.driveSaved"),"success")}catch(T){console.error("Drive Save Error:",T),e(h("toast.driveSaveFailed"),"error")}finally{g(!1)}},[C,t,o,r,a,i,s,l,c,d,u,p,h,e]);return{googleClientId:x,setGoogleClientId:v,handleSaveToDrive:S,handleGoogleSignIn:_,isGoogleDriveReady:C,isGoogleDriveSaving:f}},w3=e=>{const{t}=vt(),[o,r]=y.useState(!0),[a,i]=y.useState([]),s=y.useRef(0),[l,c]=y.useState(!1),[d,u]=y.useState("orthogonal"),[p,h]=y.useState(null),[x,k]=y.useState("edit"),[C,w]=y.useState(null),[f,g]=y.useState(null),[v,_]=y.useState({}),[S,T]=y.useState(0),[P,R]=y.useState(null),[D,q]=y.useState(!1),[O,E]=y.useState([]),[A,N]=y.useState([]),[j,L]=y.useState(!1),[M,V]=y.useState(!0),[H,F]=y.useState("pulse"),[G,B]=y.useState(null),[Y,ee]=y.useState(!1),[ie,ce]=y.useState(null),[pe,ue]=y.useState([]),[re,$]=y.useState(!1),[Z,te]=y.useState(!0),[ae,I]=y.useState(.4),[J,W]=y.useState("cyan"),[U,Q]=y.useState(null),[de,se]=y.useState(new Map);y.useEffect(()=>{const ve=localStorage.getItem("settings_instantNodeClose");L(ve==="true");const Ie=localStorage.getItem("settings_hoverHighlight");Ie!==null&&V(Ie==="true");const ke=localStorage.getItem("settings_connectionAnimation");ke!==null&&te(ke==="true");const je=localStorage.getItem("settings_connectionOpacity");if(je!==null){const Pe=parseFloat(je);isNaN(Pe)||I(Pe)}const Ge=localStorage.getItem("settings_nodeAnimationMode");if(Ge)F(Ge);else{const Pe=localStorage.getItem("settings_nodeAnimation");F(Pe==="false"?"none":"pulse")}const be=localStorage.getItem("settings_theme");be&&["cyan","orange","pink","gray"].includes(be)&&W(be)},[]),y.useEffect(()=>{document.documentElement.setAttribute("data-theme",J),localStorage.setItem("settings_theme",J)},[J]);const X=y.useCallback(ve=>{W(ve)},[]),K=y.useCallback(ve=>{te(ve),localStorage.setItem("settings_connectionAnimation",String(ve))},[]),oe=y.useCallback(ve=>{I(ve),localStorage.setItem("settings_connectionOpacity",String(ve))},[]),ne=y.useCallback((ve,Ie="success")=>{const ke=s.current++;i(je=>[...je,{id:ke,message:ve,type:Ie}]),setTimeout(()=>{i(je=>je.filter(Ge=>Ge.id!==ke))},3e3)},[]),le=y.useCallback((ve,Ie,ke)=>{ue(je=>[{id:`log-${Date.now()}-${Math.random()}`,timestamp:Date.now(),level:ve,message:Ie,details:ke},...je].slice(0,100))},[]),ge=y.useCallback(()=>{ue([])},[]),we=y.useCallback(ve=>{var Ie;if(g(ve),ve){if(ve.trim().startsWith("{")||ve.trim().includes('{"error":'))try{const ke=ve.indexOf("{"),je=ve.lastIndexOf("}");if(ke!==-1&&je!==-1){const Ge=ve.substring(ke,je+1),be=JSON.parse(Ge),Pe=ve.substring(0,ke).trim()||((Ie=be.error)==null?void 0:Ie.message)||"API Error";le("error",Pe,be);return}}catch{}le("error",ve)}},[le]),_e=y.useCallback(ve=>{se(Ie=>{const ke=new Map(Ie);return ke.set(ve.id,ve),ke})},[]),fe=y.useCallback(ve=>{se(Ie=>{const ke=new Map(Ie);return ke.delete(ve),ke})},[]),he=y.useCallback(ve=>{_(Ie=>{const ke={...Ie};return delete ke[ve],ke})},[]),ye=y.useCallback((ve,Ie,ke)=>{_(je=>({...je,[ve]:{...je[ve]||{},[Ie]:ke}}))},[]),Se=y.useCallback((ve,Ie)=>{var ke;return(ke=v[ve])==null?void 0:ke[Ie]},[v]),Te=y.useCallback(()=>{_(ve=>{const Ie=new Set(e.map(Ge=>Ge.id)),ke={};let je=0;return Object.keys(ve).forEach(Ge=>{Ie.has(Ge)?ke[Ge]=ve[Ge]:je++}),je>0?ne(t("toast.cacheCleared",{count:je})):ne(t("toast.cacheEmpty")),ke})},[e,ne,t]),Ae=y.useCallback(ve=>{R({src:ve})},[]),Oe=y.useCallback(()=>{R(null)},[]),me=y.useCallback(ve=>{ce(ve)},[]);return{showWelcome:o,setShowWelcome:r,toasts:a,addToast:ne,isSnapToGrid:l,setIsSnapToGrid:c,lineStyle:d,setLineStyle:u,spawnLine:p,setSpawnLine:h,activeTool:x,setActiveTool:k,draggingInfo:C,setDraggingInfo:w,error:f,setError:we,logs:pe,addLog:le,clearLogs:ge,isDebugConsoleOpen:re,setIsDebugConsoleOpen:$,fullSizeImageCache:v,setFullSizeImageCache:_,clearSelectionsSignal:S,setClearSelectionsSignal:T,globalImageEditor:P,openGlobalImageEditor:Ae,closeGlobalImageEditor:Oe,isSmartGuidesEnabled:D,setIsSmartGuidesEnabled:q,smartGuides:O,setSmartGuides:E,selectedNodeIds:A,setSelectedNodeIds:N,isInstantCloseEnabled:j,setIsInstantCloseEnabled:L,isHoverHighlightEnabled:M,setIsHoverHighlightEnabled:V,nodeAnimationMode:H,setNodeAnimationMode:F,dockHoverMode:G,setDockHoverMode:B,isDockingMenuVisible:Y,setIsDockingMenuVisible:ee,activeOperations:de,registerOperation:_e,unregisterOperation:fe,setFullSizeImage:ye,getFullSizeImage:Se,clearImagesForNodeFromCache:he,clearUnusedFullSizeImages:Te,t,focusedNodeId:ie,toggleNodeFullScreen:me,globalMedia:U,setGlobalMedia:Q,currentTheme:J,setTheme:X,isConnectionAnimationEnabled:Z,setIsConnectionAnimationEnabled:K,connectionOpacity:ae,setConnectionOpacity:oe}},b3=(e,t,o,r,a,i,s,l,c,d,u,p,h,x,k,C,w,f,g,v,_,S,T,P,R,D)=>{const q=y.useRef(()=>console.warn("Redirect handler not ready")),O=y.useCallback(K=>{q.current(K)},[]);y.useEffect(()=>{q.current=K=>{const oe=K.catalogContext;switch(oe){case"groups":x.importItemsData(K),T("Imported into Groups catalog.","success");break;case"library":h.importItemsData(K),T("Imported into Prompt Library.","success");break;case"characters":k.importItemsData(K),T("Imported into Character catalog.","success");break;case"scripts":C.importItemsData(K),T("Imported into Script catalog.","success");break;case"sequences":w.importItemsData(K),T("Imported into Sequence catalog.","success");break;default:P(`Unknown catalog context: ${oe}`)}}},[x,h,k,C,w,T,P]);const E=y.useCallback(K=>{K&&(h.saveProcessorPrompt(K),T(R("toast.promptSaved",{promptName:K.substring(0,20)})))},[h,T,R]),A=y.useCallback((K,oe)=>{K&&(h.saveToLibrary(K,oe),T(R("toast.promptSaved",{promptName:K.substring(0,20)})))},[h,T,R]),N=y.useCallback((K,oe)=>{const ne=e.find(le=>le.id===K);if(!(!ne||ne.type!==z.CHARACTER_CARD))try{const le=ne.value?JSON.parse(ne.value):[],ge=Array.isArray(le)?le:[le];if(oe!==void 0){const we=ge[oe];if(!we)throw new Error("Character not found");const _e=we.name||`Entity ${oe+1}`,fe={type:"character-card",nodeTitle:ne.title,...we,index:we.index||we.alias||`Entity-${oe+1}`};fe.alias&&delete fe.alias;const he=we.thumbnails?{...we.thumbnails}:we.imageSources||{};Object.entries(Wt).forEach(([Se,Te])=>{const Ae=c(K,oe*10+Te);Ae&&(he[Se]=Ae)});const ye=c(K,oe*10);ye&&(fe.image=ye),fe.imageSources=he,k.createItem("ITEM",_e,JSON.stringify(fe,null,2)),T(R("toast.characterSavedCatalog"))}else{const we=ne.title||"Character Collection",_e=ge.map((fe,he)=>{const ye={...fe.thumbnails};Object.entries(Wt).forEach(([Ae,Oe])=>{const me=c(K,he*10+Oe);me&&(ye[Ae]=me)});const Se=c(K,he*10)||fe.image,Te={type:"character-card",nodeTitle:ne.title,...fe,image:Se,imageSources:ye,index:fe.index||fe.alias||`Entity-${he+1}`};return Te.alias&&delete Te.alias,Te});k.createItem("ITEM",we,JSON.stringify(_e,null,2)),T(R("toast.characterSavedCatalog")+" (All)")}}catch{P("Failed to save character to catalog.")}},[e,k,P,T,R,c]),j=y.useCallback(K=>{try{const oe=K.name||"Unnamed Entity",ne={};K.imageBase64&&(ne["1:1"]=`data:image/png;base64,${K.imageBase64}`);const le={type:"character-card",id:`char-card-${Date.now()}`,name:K.name,index:K.alias||"Entity-1",image:K.imageBase64?`data:image/png;base64,${K.imageBase64}`:null,selectedRatio:"1:1",prompt:K.prompt,fullDescription:K.fullDescription,imageSources:ne};k.createItem("ITEM",oe,JSON.stringify(le,null,2)),T(R("toast.characterSavedCatalog"))}catch{P("Failed to save character to catalog.")}},[k,P,T,R]),L=y.useCallback(K=>{var ne;const oe=e.find(le=>le.id===K);if(!(!oe||oe.type!==z.SCRIPT_VIEWER))try{let le=oe.value||"{}";const ge=JSON.parse(le);ge.type||(ge.summary&&ge.detailedCharacters&&ge.scenes?ge.type="script-generator-data":ge.characters&&(ge.frames||ge.scenes&&((ne=ge.scenes[0])!=null&&ne.frames))&&(ge.type="script-analyzer-data"),le=JSON.stringify(ge,null,2));const we=`Script ${new Date().toLocaleDateString()}`;C.createItem("ITEM",we,le),T(R("toast.scriptSaved"))}catch{P("Failed to save script to catalog.")}},[e,C,P,T,R]),M=y.useCallback(K=>{const oe=e.find(ne=>ne.id===K);if(!(!oe||oe.type!==z.IMAGE_SEQUENCE_GENERATOR&&oe.type!==z.PROMPT_SEQUENCE_EDITOR))try{let ne={};const le=oe.title||" ",ge=oe.value?JSON.parse(oe.value):{};if(oe.type===z.IMAGE_SEQUENCE_GENERATOR){const _e=(ge.prompts||[]).map(({frameNumber:fe,characters:he,duration:ye,prompt:Se,videoPrompt:Te,sceneNumber:Ae,shotType:Oe})=>({frameNumber:fe,characters:he,duration:ye,prompt:Se,videoPrompt:Te,sceneNumber:Ae||1,shotType:Oe||"WS"}));ne={type:"script-prompt-modifier-data",title:le,usedCharacters:ge.usedCharacters||[],sceneContexts:ge.sceneContexts||{},finalPrompts:_e}}else if(oe.type===z.PROMPT_SEQUENCE_EDITOR){const _e=ge.sourcePrompts||[],fe=ge.modifiedPrompts||[],he=new Map(fe.map(Se=>[Se.frameNumber,Se])),ye=_e.map(Se=>{const Te=he.get(Se.frameNumber);return Te?{...Se,...Te}:Se});ne={type:"script-prompt-modifier-data",title:le,usedCharacters:ge.usedCharacters||[],sceneContexts:ge.sceneContexts||{},finalPrompts:ye.map(Se=>({frameNumber:Se.frameNumber,sceneNumber:Se.sceneNumber||1,characters:Se.characters||[],duration:Se.duration||3,prompt:Se.prompt||"",shotType:Se.shotType||"WS"}))}}const we=`Sequence ${new Date().toLocaleDateString()}`;w.createItem("ITEM",we,JSON.stringify(ne,null,2)),T(R("toast.characterSavedCatalog"))}catch{P("Failed to save sequence to catalog.")}},[e,w,P,T,R]),V=y.useCallback(K=>{const oe=e.find(ne=>ne.id===K);if(!(!oe||oe.type!==z.MEDIA_VIEWER))try{const ne=oe.value||"{}",le=new Blob([ne],{type:"application/json"}),ge=URL.createObjectURL(le),we=$(),_e=document.createElement("a");_e.href=ge,_e.download=`Media_Viewer_${we}.json`,_e.click(),URL.revokeObjectURL(ge),_e.remove(),T(R("toast.scriptSaved"))}catch{P("Failed to save media state.")}},[e,P,T,R]),H=y.useCallback(async K=>{const oe=e.find(ne=>ne.id===K);if(oe){P(null);try{const ne=d(K);let le=null,ge="",we=null,_e=null;const fe=ne.find(Se=>Se&&typeof Se=="object"&&(Se.type==="video"||Se.type==="audio")&&Se.url);fe&&(we=fe.url,_e=fe.type);const he=ne.find(Se=>!(!Se||typeof Se!="object"||Se.base64ImageData&&Se.mimeType||Se.type&&(Se.type==="video"||Se.type==="audio")&&Se.url));if(he){ge=JSON.stringify(he,null,2);let Se=null;if(Array.isArray(he)){const Te=he.find(Ae=>Ae.image||Ae.imageBase64||Ae.imageSources&&Object.values(Ae.imageSources).some(Oe=>Oe));Te&&(Se=Te)}else Se=he;Se&&(Se.image&&Se.image.startsWith("data:")?le=Se.image:Se.imageBase64?le=`data:image/png;base64,${Se.imageBase64}`:Se.imageSources&&Se.imageSources["1:1"]&&(le=Se.imageSources["1:1"]))}else{const Se=ne.find(Ae=>typeof Ae=="string")||"";Se&&(ge=Se);const Te=ne.find(Ae=>typeof Ae=="object"&&Ae.base64ImageData&&(Ae.type==="image"||!Ae.type));Te&&(le=`data:${Te.mimeType};base64,${Te.base64ImageData}`)}const ye=JSON.stringify({text:ge,image:le,mediaUrl:we,mediaType:_e||"video"});oe.value!==ye&&g.handleValueChange(K,ye)}catch(ne){P(ne.message)}}},[d,g,e,P]),F=y.useCallback((K,oe,ne,le)=>{if(!K)return;let ge=K;K.startsWith("data:image/png")&&(ge=Bi(K,"prompt",ne));const we=document.createElement("a");we.href=ge;let _e;if(le)_e=le.endsWith(".png")?le:`${le}.png`;else{const fe=new Date,he=fe.toISOString().split("T")[0],ye=fe.toTimeString().split(" ")[0].replace(/:/g,"-"),Se=`${he}_${ye}`,Te=(ne||"image").substring(0,30).replace(/[^a-z0-9\u0400-\u04FF]/gi,"_");_e=`frame_${oe}_${Te}_${Se}.png`}we.download=_e,document.body.appendChild(we),we.click(),document.body.removeChild(we)},[]),G=y.useCallback(async K=>{if(K)try{let ne=await(await fetch(K)).blob();if(ne.type!=="image/png"){const ge=await createImageBitmap(ne),we=document.createElement("canvas");we.width=ge.width,we.height=ge.height;const _e=we.getContext("2d");if(_e){_e.drawImage(ge,0,0);const fe=await new Promise(he=>we.toBlob(he,"image/png"));fe&&(ne=fe)}}const le=new ClipboardItem({[ne.type]:ne});await navigator.clipboard.write([le]),T(R("toast.copiedToClipboard"))}catch(oe){console.error("Failed to copy image to clipboard",oe),T(R("toast.pasteFailed"),"error")}},[T,R]),B=y.useCallback(K=>g.handleDuplicateNode(K),[g]),Y=y.useCallback(K=>{const oe=e.find(_e=>_e.id===K);if(!oe)return;g.nodeIdCounter.current++;const ne=`node-${g.nodeIdCounter.current}-${Date.now()}`,le={...oe,id:ne,position:{x:oe.position.x+30,y:oe.position.y+30},isNewlyCreated:!0,value:oe.value},we=o.filter(_e=>_e.toNodeId===K).map(_e=>({..._e,id:`conn-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,toNodeId:ne}));for(let _e=0;_e<=100;_e++){const fe=c(K,_e);fe&&l(ne,_e,fe)}return t(_e=>[..._e,le]),r(_e=>[..._e,...we]),p&&p([ne]),T(R("toast.nodeDuplicated")),ne},[e,o,g,c,l,t,r,p,T,R]),ee=y.useCallback(async K=>{const oe=await g.handleCopyNodeValue(K);oe&&P(oe)},[g,P]),ie=y.useCallback(async K=>{const oe=await g.handlePasteNodeValue(K);oe&&P(oe)},[g,P]),ce=y.useCallback(async(K,oe)=>{const ne=await g.handlePasteImageToNode(K,oe);ne&&P(ne)},[g,P]),pe=y.useCallback((K,oe)=>{const ne=e.find(le=>le.id===K);if(ne){oe._connectionId&&r(le=>le.filter(ge=>ge.id!==oe._connectionId));try{const le=JSON.parse(ne.value||"{}"),ge=le.characterConcepts||[];let we=0;ge.forEach(Se=>{const Te=(Se.id||"").match(/Entity-(\d+)/);Te&&(we=Math.max(we,parseInt(Te[1],10)))});const fe={id:`Entity-${we+1}`,name:oe.name||"Converted Concept",prompt:oe.prompt||"",image:oe._fullResImage||oe.image||null,fullDescription:oe.fullDescription||""},he=[...ge,fe],ye=JSON.stringify({...le,characterConcepts:he});g.handleValueChange(K,ye),T(R("toast.pastedFromClipboard"),"success")}catch(le){console.error("Failed to detach and paste concept",le),P("Failed to update node data.")}}},[r,e,g,T,R,P]),ue=y.useCallback((K,oe)=>{const ne=e.find(we=>we.id===oe);if(!ne)return;const le=_.getTransformedPoint({x:ne.position.x*_.viewTransform.scale+_.viewTransform.translate.x+(ne.width+50)*_.viewTransform.scale,y:ne.position.y*_.viewTransform.scale+_.viewTransform.translate.y}),ge=f.onAddNode(z.IMAGE_INPUT,le);l(ge,0,K),Lt(K,256,256).then(we=>{const _e=JSON.stringify({image:we,prompt:""});g.handleValueChange(ge,_e)})},[e,f,g,_,l]),re=y.useCallback((K,oe)=>{const ne={x:oe.position.x+oe.width+50,y:oe.position.y},le=f.onAddNode(z.CHARACTER_CARD,ne),ge=K.imageSources||{};let we=K.image;if(K.imageBase64&&!we){const fe=`data:image/png;base64,${K.imageBase64}`;ge["1:1"]=fe,we=fe,l(le,0,fe),l(le,1,fe)}else if(K.imageSources){Object.entries(K.imageSources).forEach(([he,ye])=>{if(typeof ye=="string"&&ye.startsWith("data:")){const Se=Wt[he];Se&&l(le,Se,ye)}});const fe=K._fullResImage;fe&&l(le,0,fe)}(async()=>{let fe=we;we&&we.length>5e3&&(fe=await Lt(we,256,256));const he=[{type:"character-card",id:K.id||`char-card-${Date.now()}`,name:K.name||"",index:K.index||K.alias||"Entity-1",prompt:K.prompt||"",fullDescription:K.fullDescription||"",image:fe,thumbnails:K.thumbnails||ge,selectedRatio:K.selectedRatio||"1:1",targetLanguage:K.targetLanguage||"en"}];g.handleValueChange(le,JSON.stringify(he)),p&&p([le])})()},[f,g,l,p]),$=()=>new Date().toISOString().replace(/:/g,"-").replace("T","_").split(".")[0],Z=y.useCallback(K=>{const oe=a.find(Ae=>Ae.id===K);if(!oe)return;const ne=e.filter(Ae=>oe.nodeIds.includes(Ae.id)),le=new Set(ne.map(Ae=>Ae.id)),ge=o.filter(Ae=>le.has(Ae.fromNodeId)&&le.has(Ae.toNodeId)),we={};ne.forEach(Ae=>{s[Ae.id]&&(we[Ae.id]=s[Ae.id])});const _e={type:"prompModifierGroup",name:oe.title,nodes:ne,connections:ge,fullSizeImages:we},fe=new Blob([JSON.stringify(_e,null,2)],{type:"application/json"}),he=URL.createObjectURL(fe),ye=document.createElement("a");ye.href=he;const Se=oe.title.trim().replace(/\s+/g,"_"),Te=$();ye.download=`${Se}_Prompt_Modifier_Group_${Te}.json`,ye.click(),URL.revokeObjectURL(he),T(R("toast.groupSavedToDisk",{groupTitle:oe.title}))},[a,e,o,s,T,R]),te=y.useCallback(K=>{const oe=a.find(ne=>ne.id===K);oe&&(x.saveGroupToCatalog(oe,e,o,s),T(R("alert.groupSaved",{groupTitle:oe.title})))},[a,e,o,x,R,T,s]),ae=y.useCallback((K,oe)=>{const ne=x.catalogItems.find(me=>me.id===K);if(!ne||ne.type!=="GROUP"||!ne.nodes||!ne.connections)return;let le=1/0,ge=1/0;ne.nodes.forEach(me=>{le=Math.min(le,me.position.x),ge=Math.min(ge,me.position.y)});let we,_e;oe?(we=oe.x,_e=oe.y):(we=(window.innerWidth/2-_.viewTransform.translate.x)/_.viewTransform.scale,_e=(window.innerHeight/2-_.viewTransform.translate.y)/_.viewTransform.scale);const fe=we-le,he=_e-ge,ye=new Map,Se=ne.nodes.map(me=>{g.nodeIdCounter.current++;const ve=`node-${g.nodeIdCounter.current}-${Date.now()}`;return ye.set(me.id,ve),{...me,id:ve,position:{x:me.position.x+fe,y:me.position.y+he},isNewlyCreated:!0}});ne.fullSizeImages&&Object.entries(ne.fullSizeImages).forEach(([me,ve])=>{const Ie=ye.get(me);Ie&&ve&&Object.entries(ve).forEach(([ke,je])=>{l(Ie,Number(ke),je)})});const Te=ne.connections.map(me=>({...me,id:`conn-${Date.now()}-${Math.random()}`,fromNodeId:ye.get(me.fromNodeId),toNodeId:ye.get(me.toNodeId)}));t(me=>[...me,...Se]),r(me=>[...me,...Te]);const Ae=yr(Se)||{position:{x:0,y:0},width:0,height:0},Oe={id:`group-${Date.now()}`,title:ne.name,nodeIds:Se.map(me=>me.id),...Ae};i(me=>[...me,Oe])},[x,_,g,t,r,i,l]),I=y.useCallback((K,oe)=>{if(oe.stopPropagation(),oe.shiftKey){const ne=a.find(le=>le.id===K);if(ne){const le=new Set(ne.nodeIds);t(ge=>ge.filter(we=>!le.has(we.id))),r(ge=>ge.filter(we=>!le.has(we.fromNodeId)&&!le.has(we.toNodeId))),ne.nodeIds.forEach(ge=>D(ge)),T(R("toast.groupDeleted"))}}i(ne=>ne.filter(le=>le.id!==K))},[a,t,r,D,R,T,i]),J=y.useCallback(K=>{const oe=o.find(he=>he.id===K);if(!oe)return;const ne=e.find(he=>he.id===oe.fromNodeId);if(!ne)return;const le=Kn(ne,oe.fromHandleId),ge=JSON.stringify({type:le}),we=f.onAddNode(z.REROUTE_DOT,_.pointerPosition,void 0,{centerNode:!0,initialValue:ge}),_e={id:`conn-${Date.now()}-1`,fromNodeId:oe.fromNodeId,fromHandleId:oe.fromHandleId,toNodeId:we,toHandleId:void 0},fe={id:`conn-${Date.now()}-2`,fromNodeId:we,fromHandleId:void 0,toNodeId:oe.toNodeId,toHandleId:oe.toHandleId};r(he=>[...he.filter(ye=>ye.id!==K),_e,fe])},[o,e,f,_,r]),W=y.useCallback((K,oe,ne)=>{if(!oe)return;const{position:le,connectingInfo:ge}=oe,we=_.getTransformedPoint(le);let _e;K===z.REROUTE_DOT&&ge.fromType&&(_e=JSON.stringify({type:ge.fromType}));const fe=f.onAddNode(K,we,void 0,{alignToInput:!0,initialValue:_e});let he;K===z.IMAGE_EDITOR?(ge.fromType==="image"&&(he="image"),ge.fromType==="text"&&(he="text")):K===z.IMAGE_SEQUENCE_GENERATOR?(ge.fromType==="text"&&(he="prompt_input"),ge.fromType==="character_data"&&(he="character_data")):K===z.PROMPT_SEQUENCE_EDITOR?ge.fromType==="text"&&(he="prompts_sequence"):K===z.NOTE?ge.fromType==="text"&&(he="prompt_data"):K===z.VIDEO_EDITOR&&(ge.fromType==="video"&&(he="video"),ge.fromType==="audio"&&(he="audio"),ge.fromType==="image"&&(he="image"),ge.fromType==="text"&&(he="text"));const ye={id:`conn-${Date.now()}`,fromNodeId:ge.fromNodeId,fromHandleId:ge.fromHandleId,toNodeId:fe,toHandleId:he};r(Se=>[...Se,ye]),ne()},[f,r,_]),U=y.useCallback(K=>{v.removeConnectionsByNodeId(K)},[v]),Q=y.useCallback((K,oe)=>{S.handleEditImage(K,[oe])},[S]),de=y.useCallback(async(K,oe,ne,le,ge,we)=>{const _e=le.pointerPosition||{x:0,y:0},fe=_e.x===0&&_e.y===0?le.getTransformedPoint({x:window.innerWidth/2,y:window.innerHeight/2}):_e;try{const he=await navigator.clipboard.read();for(const ye of he)if(ye.types.some(Se=>Se.startsWith("image/"))){const Se=await ye.getType(ye.types.find(Oe=>Oe.startsWith("image/")));if(K.length===1){const Oe=e.find(me=>me.id===K[0]);if(Oe&&(Oe.type===z.IMAGE_INPUT||Oe.type===z.IMAGE_EDITOR||Oe.type===z.IMAGE_ANALYZER||Oe.type===z.CHARACTER_CARD)){await ne(K[0]);return}}const Te=new File([Se],"pasted_image.png",{type:Se.type}),Ae=ge.onAddNode(z.IMAGE_INPUT,fe);await ne(Ae,Te);return}}catch{}try{const he=await navigator.clipboard.readText();if(!he)return;if(K.length===1){const ye=e.find(Se=>Se.id===K[0]);if(ye&&ye.type!==z.IMAGE_OUTPUT&&ye.type!==z.VIDEO_OUTPUT&&ye.type!==z.IMAGE_INPUT){await oe(K[0]);return}}try{let ye=JSON.parse(he);if(ye.type==="gemini-chat-history"||ye.messages&&Array.isArray(ye.messages)&&!ye.nodes){const Te=ge.onAddNode(z.GEMINI_CHAT,fe),Ae=JSON.stringify({messages:ye.messages||[],currentInput:ye.currentInput||"",style:ye.style||"general",attachment:ye.attachment||null});we.handleValueChange(Te,Ae);return}if(ye.type==="character-card"||Array.isArray(ye)&&ye.length>0&&(ye[0].type==="character-card"||ye[0].name&&ye[0].imageSources)){const Te=Array.isArray(ye)?ye:[ye],Ae=Te[0].nodeTitle||Te[0].title||"Character Card",Oe=ge.onAddNode(z.CHARACTER_CARD,fe,Ae,{centerNode:!0}),me=Te.length*Yd+Xd;t(Ie=>Ie.map(ke=>ke.id===Oe?{...ke,width:me}:ke));const ve=await Promise.all(Te.map(async(Ie,ke)=>{const je=Ie.imageSources||{},Ge={"1:1":null,"16:9":null,"9:16":null};Ie.image&&!Ie.imageSources&&(je["1:1"]=Ie.image);for(const[Ee,Me]of Object.entries(je))if(typeof Me=="string"&&Me.startsWith("data:")){const Fe=Wt[Ee];Fe&&l(Oe,ke*10+Fe,Me);try{Ge[Ee]=await Lt(Me,256,256)}catch{Ge[Ee]=Me}}else Ge[Ee]=Me;const be=Ie.selectedRatio||"1:1",Pe=je[be];return Pe&&typeof Pe=="string"&&Pe.startsWith("data:")&&l(Oe,ke*10,Pe),{...Ie,id:Ie.id||`char-card-${Date.now()}-${ke}`,image:Ge[be],thumbnails:Ge,index:Ie.index||Ie.alias||`Entity-${ke+1}`}}));we.handleValueChange(Oe,JSON.stringify(ve)),p&&p([Oe]);return}if(ye.type==="prompModifierGroup"||ye.nodes&&ye.connections){ge.pasteGroup(ye,fe);return}if(ye.type==="script-prompt-modifier-data"||ye.finalPrompts&&Array.isArray(ye.finalPrompts)){const Te=ge.onAddNode(z.PROMPT_SEQUENCE_EDITOR,fe),Ae=ye.finalPrompts||ye.prompts||[],Oe=ye.videoPrompts||[],me=new Map(Oe.map(ke=>[ke.frameNumber,ke])),ve=Ae.map((ke,je)=>{const Ge=ke.frameNumber!==void 0?ke.frameNumber:je+1,be=me.get(Ge);return{frameNumber:Ge,sceneNumber:ke.sceneNumber||1,sceneTitle:ke.sceneTitle||"",prompt:ke.prompt||"",videoPrompt:(be==null?void 0:be.videoPrompt)||ke.videoPrompt||"",shotType:ke.shotType||ke.ShotType||(be==null?void 0:be.shotType)||"WS",characters:ke.characters||[],duration:ke.duration||3,isCollapsed:!0}}),Ie=JSON.stringify({instruction:"",sourcePrompts:ve,modifiedPrompts:[],checkedSourceFrameNumbers:[],selectedFrameNumber:null,styleOverride:ye.styleOverride||"",usedCharacters:ye.usedCharacters||[],sceneContexts:ye.sceneContexts||{},leftPaneRatio:.5});we.handleValueChange(Te,Ie);return}if(ye.type==="script-generator-data"||ye.type==="script-analyzer-data"||ye.characters&&ye.scenes){const Te=ge.onAddNode(z.SCRIPT_VIEWER,fe);ye.type||(ye.type="script-analyzer-data"),we.handleValueChange(Te,JSON.stringify(ye));return}const Se=ge.onAddNode(z.TEXT_INPUT,fe);we.handleValueChange(Se,JSON.stringify(ye,null,2))}catch{const Se=ge.onAddNode(z.TEXT_INPUT,fe);we.handleValueChange(Se,he)}}catch(he){console.error("Paste failed",he)}},[e,l,T,R,p]),se=y.useCallback((K,oe)=>{const ne=e.find(we=>we.id===K);if(!ne)return;let le,ge="";try{const we=JSON.parse(ne.value||"{}");ne.type===z.IMAGE_OUTPUT||ne.type===z.VIDEO_OUTPUT?(le=c(K,0)||ne.value,ge=f.getPromptForNode(K)):ne.type===z.IMAGE_INPUT?(le=c(K,0)||we.image,ge=we.prompt||""):ne.type===z.IMAGE_EDITOR&&(le=c(K,0)||we.outputImage,ge=we.prompt||"")}catch{}le&&oe(le,0,ge)},[e,c,f]),X=y.useCallback((K,oe)=>{t(le=>le.map(ge=>{if(ge.id===K)try{const we=JSON.parse(ge.value||"{}");if(ge.type===z.PROMPT_SEQUENCE_EDITOR){const _e=[oe];let fe=we.sourcePrompts||[],he=we.collapsedSourceScenes||[];const ye=fe.find(Se=>Se.frameNumber===oe);if(ye){fe=fe.map(Te=>Te.frameNumber===oe?{...Te,isCollapsed:!1}:Te);const Se=ye.sceneNumber||1;he.includes(Se)&&(he=he.filter(Te=>Te!==Se))}return{...ge,isCollapsed:!1,value:JSON.stringify({...we,sourcePrompts:fe,collapsedSourceScenes:he,selectedFrameNumber:oe,checkedSourceFrameNumbers:_e})}}}catch{}return ge}));const ne=e.find(le=>le.id===K);if(ne){const le=window.innerWidth,ge=window.innerHeight,we=Number.isFinite(_.viewTransform.scale)&&_.viewTransform.scale>0?_.viewTransform.scale:1,_e=ne.position.x+ne.width/2,fe=ne.position.y+ne.height/2,he=le/2-_e*we,ye=ge/2-fe*we;Number.isFinite(he)&&Number.isFinite(ye)&&_.setViewTransform({scale:we,translate:{x:he,y:ye}})}},[e,t,_]);return{onRedirectImport:O,onSavePromptToLibrary:E,onSaveToLibrary:A,onSaveCharacterToCatalog:N,onSaveGeneratedCharacterToCatalog:j,onSaveScriptToCatalog:L,onSaveSequenceToCatalog:M,onSaveMediaToDisk:V,onReadData:H,onDownloadImageFromUrl:F,onCopyImageToClipboard:G,handleDuplicateNode:B,handleDuplicateNodeWithContent:Y,copyNodeValue:ee,pasteNodeValue:ie,pasteImageToNode:ce,handleDetachAndPasteConcept:pe,onDetachImageToNode:ue,onDetachCharacter:re,handleSaveGroupToDisk:Z,handleSaveGroupToCatalog:te,handleAddGroupFromCatalog:ae,handleRemoveGroup:I,handleSplitConnection:J,handleAddNodeAndConnect:W,handleNodeCutConnections:U,handleRegenerateFrame:Q,handlePaste:de,handleDownloadImage:se,handleNavigateToNodeFrame:X}},q1=y.createContext(null),C3=({children:e})=>{const{t,language:o,setLanguage:r}=vt(),a=xC("clipboard-read"),i=uC(),{tabs:s,setTabs:l,activeTabId:c,setActiveTabId:d,handleAddTab:u,handleSwitchTab:p,handleRenameTab:h,handleCloseTab:x,resetTabs:k,resetCurrentTab:C,getLocalizedCanvasState:w}=i,f=y.useMemo(()=>{const ke=s.find(je=>je.id===c);return ke||(s.length>0?s[0]:{id:"fallback",name:"Loading...",state:{nodes:[],connections:[],groups:[],viewTransform:{scale:1,translate:{x:0,y:0}},nodeIdCounter:0,fullSizeImageCache:{}}})},[s,c]),g=w3(f.state.nodes),{toasts:v,addToast:_,fullSizeImageCache:S,setFullSizeImageCache:T,setFullSizeImage:P,getFullSizeImage:R,clearImagesForNodeFromCache:D,clearUnusedFullSizeImages:q,registerOperation:O,unregisterOperation:E,activeOperations:A,selectedNodeIds:N,setSelectedNodeIds:j,draggingInfo:L,setDraggingInfo:M,showWelcome:V,setShowWelcome:H}=g,F=Xb(f.state.nodes,f.state.nodeIdCounter,_,t,P,R),G=Zb(f.state.connections,_,t),B=Qb(f.state.viewTransform),Y=hC(f.state.groups),ee=d3(F.setNodes),ie=u3({nodes:F.nodes}),ce=bC({connections:G.connections,nodes:F.nodes,getFullSizeImage:R}),{getUpstreamNodeValues:pe}=ce,ue=y.useCallback(()=>({nodes:F.nodes,connections:G.connections,groups:Y.groups,viewTransform:B.viewTransform,nodeIdCounter:F.nodeIdCounter.current,fullSizeImageCache:S}),[F.nodes,G.connections,Y.groups,B.viewTransform,F.nodeIdCounter,S]),re=y.useCallback(ke=>{F.setNodes(ke.nodes),G.setConnections(ke.connections),Y.setGroups(ke.groups||[]),B.setViewTransform(ke.viewTransform),F.nodeIdCounter.current=ke.nodeIdCounter,T(ke.fullSizeImageCache||{})},[F,G,Y,B,T]);y.useEffect(()=>{const ke=s.find(je=>je.id===c);ke&&re(ke.state)},[c]),y.useEffect(()=>{const ke=ue();l(je=>je.map(Ge=>Ge.id===c?{...Ge,state:ke}:Ge))},[ue,c,l]);const $=y.useCallback(ke=>{k(ke)},[k]),Z=y.useRef(c);y.useEffect(()=>{Z.current=c},[c]);const te=wC({nodes:F.nodes,setNodes:F.setNodes,connections:G.connections,setConnections:G.setConnections,nodeIdCounter:F.nodeIdCounter,groups:Y.groups,setGroups:Y.setGroups,t,clearImagesForNodeFromCache:D,tabId:c,addToast:_,getFullSizeImage:R,setFullSizeImage:P,takeSnapshot:ee.takeSnapshot}),ae=y.useRef(null),I=ke=>{ae.current&&ae.current.onRedirectImport&&ae.current.onRedirectImport(ke)},J=fC(t,I),W=vC(t,I),U=Vc("character-catalog",t("catalog.tabs.characters"),t,"characters",I),Q=Vc("script-catalog",t("catalog.tabs.scripts"),t,"scripts",I),de=Vc("sequence-catalog",t("catalog.tabs.sequences"),t,"sequences",I),se=v3({addToast:_,getCurrentCanvasState:ue,tabs:s,activeTabId:c,language:o,isSnapToGrid:g.isSnapToGrid,lineStyle:g.lineStyle,catalogItems:J.catalogItems,libraryItems:W.libraryItems,characterCatalog:U,scriptCatalog:Q,sequenceCatalog:de,t}),X=qE({nodes:F.nodes,setNodes:F.setNodes,getUpstreamNodeValues:pe,setError:g.setError,t,setFullSizeImage:P,getFullSizeImage:R,activeTabId:c,setTabs:l,activeTabName:f.name,registerOperation:O,unregisterOperation:E,addToast:_}),K=c3({nodes:F.nodes,setNodes:F.setNodes,getUpstreamNodeValues:pe,setError:g.setError,t,activeTabId:c,setTabs:l,activeTabName:f.name,registerOperation:O,unregisterOperation:E,addToast:_}),oe=OE({nodes:F.nodes,setNodes:F.setNodes,setError:g.setError,t,getUpstreamNodeValues:pe,activeTabId:c,setTabs:l}),ne=l3({nodes:F.nodes,connections:G.connections,setNodes:F.setNodes,getUpstreamNodeValues:pe,setError:g.setError,showApiKeyDialog:ke=>we.showApiKeyDialog(ke),t,setFullSizeImage:P,getFullSizeImage:R,connectedCharacterData:ce.connectedCharacterData,activeTabId:c,setTabs:l,activeTabName:f.name,registerOperation:O,unregisterOperation:E,isGlobalProcessing:A.size>0,addToast:_}),le=t3({nodes:F.nodes,setNodes:F.setNodes,connections:G.connections,setError:g.setError,getUpstreamNodeValues:pe,t,setFullSizeImage:P,getFullSizeImage:R,activeTabId:c,activeTabName:f.name,registerOperation:O,unregisterOperation:E,isGlobalProcessing:A.size>0,setTabs:l}),ge=aC({getCurrentCanvasState:ue,loadCanvasState:re,setError:g.setError,nodes:F.nodes,getPromptForNode:te.getPromptForNode,handleValueChange:F.handleValueChange,addToast:_,t,activeTabName:f.name,getFullSizeImage:R,handleRenameTab:h,activeTabId:c,setFullSizeImage:P,tabs:i.tabs,setTabs:i.setTabs,setActiveTabId:i.setActiveTabId,catalogItems:J.catalogItems,setCatalogItems:J.replaceAllItems,libraryItems:W.libraryItems,setLibraryItems:W.replaceAllItems,characterCatalog:U,scriptCatalog:Q,sequenceCatalog:de,language:o,setLanguage:r,isSnapToGrid:g.isSnapToGrid,setIsSnapToGrid:g.setIsSnapToGrid,lineStyle:g.lineStyle,setLineStyle:g.setLineStyle,setConfirmInfo:ke=>we.setConfirmInfo(ke),handleRenameNode:F.handleRenameNode,onAddNode:te.onAddNode,pasteGroup:te.pasteGroup,viewTransform:B.viewTransform}),we=pC({setGroups:Y.setGroups,renameCatalogItem:J.renameCatalogItem,updateLibraryItem:W.updateLibraryItem,handleRenameTab:h,handleCloseTab:x,handleRenameNode:F.handleRenameNode,getCurrentCanvasState:ue,loadCanvasState:re,tabs:s,activeTabId:c,t,characterCatalog:U,scriptCatalog:Q,sequenceCatalog:de}),_e=b3(F.nodes,F.setNodes,G.connections,G.setConnections,Y.groups,Y.setGroups,S,P,R,pe,Z,j,W,J,U,Q,de,te,F,G,B,ne,_,g.setError,t,D);y.useEffect(()=>{ae.current=_e},[_e]);const fe=y.useCallback(ke=>{we.connectionQuickAddInfo&&_e.handleAddNodeAndConnect(ke,we.connectionQuickAddInfo,we.handleCloseConnectionQuickAdd)},[we.connectionQuickAddInfo,we.handleCloseConnectionQuickAdd,_e]),he=y.useCallback(ke=>{const je=F.nodes;Y.setGroups(Ge=>{const be=Ge.find(Ee=>Ee.nodeIds.includes(ke));if(!be)return Ge;const Pe=be.nodeIds.filter(Ee=>Ee!==ke);if(Pe.length>0){const Ee=je.filter(Fe=>Pe.includes(Fe.id)),Me=yr(Ee);return Me?Ge.map(Fe=>Fe.id===be.id?{...Fe,nodeIds:Pe,...Me}:Fe):Ge.map(Fe=>Fe.id===be.id?{...Fe,nodeIds:Pe}:Fe)}else return Ge.filter(Ee=>Ee.id!==be.id)})},[Y.setGroups,F.nodes]),ye=rC({...F,...G,...Y,...B,...we,handleToggleCatalog:we.handleToggleCatalog,deleteNodeAndConnections:te.deleteNodeAndConnections,onAddNode:te.onAddNode,handleDuplicateNode:_e.handleDuplicateNode,handleDuplicateNodeWithContent:_e.handleDuplicateNodeWithContent,copyNodeValue:_e.copyNodeValue,pasteImageToNode:_e.pasteImageToNode,addConnection:G.addConnection,isSnapToGrid:g.isSnapToGrid,setIsSnapToGrid:g.setIsSnapToGrid,setLineStyle:g.setLineStyle,activeTool:g.activeTool,setActiveTool:g.setActiveTool,setSpawnLine:g.setSpawnLine,setError:g.setError,handleLoadCanvasIntoCurrentTab:ge.handleLoadCanvasIntoCurrentTab,t,draggingInfo:L,setDraggingInfo:M,handleDetachNodeFromGroup:he,handleSaveCanvas:ge.handleSaveCanvas,handleLoadCanvas:ge.handleLoadCanvas,handleOpenConnectionQuickAdd:we.handleOpenConnectionQuickAdd,handleOpenContextMenu:we.handleOpenContextMenu,quickSlots:we.quickSlots,isConnectionQuickAddOpen:we.isConnectionQuickAddOpen,pasteGroup:te.pasteGroup,copyGroup:te.copyGroup,isSmartGuidesEnabled:g.isSmartGuidesEnabled,setIsSmartGuidesEnabled:g.setIsSmartGuidesEnabled,setSmartGuides:g.setSmartGuides,selectedNodeIds:N,setSelectedNodeIds:j,handleRenameNode:F.handleRenameNode,setFullSizeImage:P,handleOpenQuickAdd:we.handleOpenQuickAdd,requestDeleteNodes:we.requestDeleteNodes,isInstantCloseEnabled:g.isInstantCloseEnabled,handleAlignNodes:te.handleAlignNodes,handleDockNode:te.handleDockNode,handlePaste:()=>_e.handlePaste(N,_e.pasteNodeValue,_e.pasteImageToNode,B,te,F),selectNode:ke=>j([ke]),dockHoverMode:g.dockHoverMode,setDockHoverMode:g.setDockHoverMode,isDockingMenuVisible:g.isDockingMenuVisible,setIsDockingMenuVisible:g.setIsDockingMenuVisible,undoPosition:ee.undoPosition,redoPosition:ee.redoPosition,handleToggleNodePin:F.handleToggleNodePin}),Se=y.useCallback((ke,je)=>{F.nodes.find(be=>be.id===je)&&(N.includes(je)||j([je]),we.handleOpenNodeContextMenu(ke,je))},[F.nodes,N,j,we.handleOpenNodeContextMenu]),Te=y.useCallback(ke=>{if(F.handleToggleNodeCollapse(ke),F.nodes.find(Ge=>Ge.id===ke)){const Ge=Y.groups.find(be=>be.nodeIds.includes(ke));if(Ge){const Pe=F.nodes.map(Me=>Me.id===ke?{...Me,isCollapsed:!Me.isCollapsed}:Me).filter(Me=>Ge.nodeIds.includes(Me.id)),Ee=yr(Pe);Ee&&Y.setGroups(Me=>Me.map(Fe=>Fe.id===Ge.id?{...Fe,...Ee}:Fe))}}},[F.handleToggleNodeCollapse,F.nodes,Y.groups,Y.setGroups]),Ae=y.useCallback((ke,je)=>{const Ge=F.nodes.find(be=>be.id===ke);(Ge==null?void 0:Ge.type)===z.IMAGE_SEQUENCE_GENERATOR?ne.handleGenerateSelectedFrames(ke,[je]):ne.handleEditImage(ke,[je])},[ne,F.nodes]),Oe=CC({...ye,...we,...B,...te,...ge,...F,...G,...Y,catalogItems:J.currentCatalogItems,libraryItems:W.currentLibraryItems,handleLoadCanvasIntoCurrentTab:ge.handleLoadCanvasIntoCurrentTab,setError:g.setError,pasteImageToNode:_e.pasteImageToNode,isPanning:B.isPanning,addGroup:Y.addGroup,onAddNode:te.onAddNode,zoomDragInfo:ye.zoomDragInfo,characterCatalogItems:U.items,scriptCatalogItems:Q.items,sequenceCatalogItems:de.items,connectingInfo:ye.connectingInfo,setFullSizeImage:P,t,handleAddGroupFromCatalog:_e.handleAddGroupFromCatalog}),me=y.useCallback(ke=>{const je=ke.target;je.closest(".node-view")||je.closest(".group-view")||je.closest(".connection-view")||je.closest("input, textarea, button, a, select")||(ke.preventDefault(),we.handleOpenContextMenu({x:ke.clientX,y:ke.clientY}))},[we.handleOpenContextMenu]),ve=y.useCallback(ke=>{const je=()=>{const Ge=w(o);C(o),re(Ge)};ke!=null&&ke.shiftKey?je():we.setConfirmInfo({title:t("dialog.confirmReset.title"),message:t("dialog.confirmReset.message"),onConfirm:je})},[C,o,t,we,w,re]),Ie=y.useMemo(()=>{const{replaceAllItems:ke,importItemsData:je,...Ge}=W,{replaceAllItems:be,importItemsData:Pe,...Ee}=J;return{...i,...F,...G,...Y,...B,...we,...Ee,...Ge,...a,...ge,...te,...ye,...ce,...Oe,...X,...oe,...le,...ne,...K,...ee,...g,..._e,...se,tutorialStep:ie.tutorialStep,advanceTutorial:ie.advanceTutorial,setTutorialStep:ie.setTutorialStep,tutorialTargetId:ie.tutorialTargetId,startTutorial:ie.startTutorial,skipTutorial:ie.skipTutorial,t,onSanitize:K.handleSanitizePrompt,characterCatalog:U,scriptCatalog:Q,sequenceCatalog:de,onRenameCharacter:(Me,Fe)=>we.setRenameInfo({type:"character",id:Me,currentTitle:Fe}),onRenameScript:(Me,Fe)=>we.setRenameInfo({type:"script",id:Me,currentTitle:Fe}),onRenameSequence:(Me,Fe)=>we.setRenameInfo({type:"sequence",id:Me,currentTitle:Fe}),onGenerateSelectedFrames:ne.handleGenerateSelectedFrames,onTranslateScript:K.handleTranslateScript,onRefreshUpstreamData:(Me,Fe)=>{},handleDetachNodeFromGroup:he,onSaveScriptToDisk:ge.handleSaveScriptFile,onSaveMediaToDisk:_e.onSaveMediaToDisk,onGenerateCharacterImage:ne.handleGenerateCharacterImage,onStopGeneration:K.handleStopGeneration,onEditImage:ne.handleEditImage,onImageToText:X.handleImageToText,handleRegenerateFrame:Ae,replaceAllItems:ke,importItemsData:je,handleToggleNodeCollapse:Te,handleNodeContextMenuLogic:Se,handleCanvasContextMenu:me,isGlobalProcessing:A.size>0,handlePaste:()=>_e.handlePaste(N,_e.pasteNodeValue,_e.pasteImageToNode,B,te,F),handleDownloadImage:Me=>_e.handleDownloadImage(Me,_e.onDownloadImageFromUrl),setLibraryItems:ke,activeTool:ye.effectiveTool,setActiveTool:ye.setActiveTool,dragOverNodeId:ye.hoveredNodeId,isDraggingOverCanvas:!1,handleOpenNodeContextMenu:Se,onRefreshChat:oe.handleRefreshChat,isStopping:K.isStopping||ne.isStoppingEdit,isStoppingSequence:ne.isStoppingEdit,selectNode:Me=>j([Me]),handleAddNodeAndConnect:fe,handleToggleNodePin:F.handleToggleNodePin,handleToggleNodeHandles:F.handleToggleNodeHandles,handleClearNodeNewFlag:F.handleClearNodeNewFlag,handleResetCanvas:ve,resetCanvasToDefault:$,showWelcome:g.showWelcome,setShowWelcome:g.setShowWelcome,nextAutoSaveTime:i.nextAutoSaveTime,isAutoSaving:i.isAutoSaving,onUpdateCharacterDescription:K.handleUpdateCharacterDescription,handleUpdateCharacterDescription:K.handleUpdateCharacterDescription,isUpdatingDescription:K.isUpdatingDescription,onModifyCharacter:K.handleModifyCharacter,handleModifyCharacter:K.handleModifyCharacter,isModifyingCharacter:K.isModifyingCharacter,onGenerateImage:ne.handleGenerateImage,handleUpdateCharacterPromptFromImage:X.handleUpdateCharacterPromptFromImage,isUpdatingCharacterPrompt:X.isUpdatingCharacterPrompt}},[i,F,G,Y,B,we,J,W,a,ge,te,ye,ce,Oe,X,oe,le,ne,K,ee,g,_e,ie,se,Te,Se,me,A.size,N,t,U,Q,de,he,fe,Ae,X.handleImageToText,ve,$,F.handleToggleNodeHandles,F.handleClearNodeNewFlag,X.handleUpdateCharacterPromptFromImage,X.isUpdatingCharacterPrompt]);return n.jsx(q1.Provider,{value:Ie,children:e})},Ut=()=>{const e=y.useContext(q1);if(!e)throw new Error("useAppContext must be used within a AppProvider");return e},Ne=({title:e,onClick:t,children:o,tooltipPosition:r="top",tooltipAlign:a="center",disabled:i=!1,className:s})=>{const c=s||"p-1 text-gray-400 rounded hover:bg-gray-600 hover:text-white transition-colors duration-150 focus:outline-none disabled:text-gray-600 disabled:bg-transparent disabled:cursor-not-allowed flex items-center justify-center";let d="";return r==="top"?(d="bottom-full mb-2",a==="center"?d+=" left-1/2 -translate-x-1/2":a==="start"?d+=" left-0":a==="end"&&(d+=" right-0")):r==="bottom"?(d="top-full mt-2",a==="center"?d+=" left-1/2 -translate-x-1/2":a==="start"?d+=" left-0":a==="end"&&(d+=" right-0")):r==="left"?d="right-full top-1/2 -translate-y-1/2 mr-2":r==="right"&&(d="left-full top-1/2 -translate-y-1/2 ml-2"),n.jsxs("div",{className:"relative group/btn-tooltip flex items-center justify-center",children:[n.jsx("button",{onClick:t,disabled:i,onMouseDown:u=>u.stopPropagation(),"aria-label":e,className:c,children:o}),e&&!i&&n.jsx("div",{className:`absolute ${d} px-2 py-1 bg-slate-700 text-slate-200 text-[10px] font-bold whitespace-nowrap rounded-md shadow-xl z-50 opacity-0 pointer-events-none group-hover/btn-tooltip:opacity-100 transition-opacity duration-200`,role:"tooltip",children:e})]})},ct=({content:e,children:t,position:o="top",align:r="center",className:a="",delay:i=0,usePortal:s=!0})=>{const[l,c]=y.useState(!1),[d,u]=y.useState(null),p=y.useRef(null),h=y.useRef(null),x=()=>{if(!h.current||!s)return;const g=h.current.getBoundingClientRect(),v=6;let _=0,S=0;o==="top"||o==="bottom"?r==="start"?_=g.left:r==="end"?_=g.right:_=g.left+g.width/2:o==="left"?_=g.left-v:o==="right"&&(_=g.right+v),o==="top"?S=g.top-v:o==="bottom"?S=g.bottom+v:S=g.top+g.height/2,u({x:_,y:S})},k=()=>{s&&x(),i>0?p.current=setTimeout(()=>c(!0),i):c(!0)},C=()=>{p.current&&(clearTimeout(p.current),p.current=null),c(!1)};if(y.useEffect(()=>{if(l&&s)return window.addEventListener("scroll",x,!0),window.addEventListener("resize",x),()=>{window.removeEventListener("scroll",x,!0),window.removeEventListener("resize",x)}},[l,s]),!e)return n.jsx("div",{className:a,children:t});let w="",f="";return s?o==="top"?r==="center"?w="translate(-50%, -100%)":r==="start"?w="translate(0, -100%)":r==="end"&&(w="translate(-100%, -100%)"):o==="bottom"?r==="center"?w="translate(-50%, 0)":r==="start"?w="translate(0, 0)":r==="end"&&(w="translate(-100%, 0)"):o==="left"?w="translate(-100%, -50%)":o==="right"&&(w="translate(0, -50%)"):o==="top"?(f="bottom-full mb-2",r==="center"?(f+=" left-1/2",w="translate(-50%, 0)"):r==="start"?f+=" left-0":r==="end"&&(f+=" right-0")):o==="bottom"?(f="top-full mt-2",r==="center"?(f+=" left-1/2",w="translate(-50%, 0)"):r==="start"?f+=" left-0":r==="end"&&(f+=" right-0")):o==="left"?(f="right-full mr-2 top-1/2",w="translate(0, -50%)"):o==="right"&&(f="left-full ml-2 top-1/2",w="translate(0, -50%)"),n.jsxs(n.Fragment,{children:[n.jsxs("div",{ref:h,className:`relative flex items-center justify-center ${a}`,onMouseEnter:k,onMouseLeave:C,onMouseDown:()=>c(!1),children:[t,!s&&l&&n.jsx("div",{className:`absolute z-50 px-3 py-1.5 bg-slate-700 text-slate-200 text-xs font-medium whitespace-nowrap rounded-md shadow-xl pointer-events-none ${f}`,style:{transform:w,animation:"fade-in-tooltip 0.15s ease-out"},children:e})]}),s&&l&&d&&Ba.createPortal(n.jsxs("div",{className:"fixed z-[9999] px-3 py-1.5 bg-slate-700 text-slate-200 text-xs font-medium whitespace-nowrap rounded-md shadow-xl pointer-events-none",style:{top:d.y,left:d.x,transform:w,animation:"fade-in-tooltip 0.15s ease-out"},children:[n.jsx("style",{children:`
                        @keyframes fade-in-tooltip {
                            from { opacity: 0; }
                            to { opacity: 1; }
                        }
                    `}),e]}),document.body)]})},k3=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}),_3=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),S3=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),N3=()=>n.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",children:n.jsx("path",{d:"M832.1 665.1c20.5 0 37.2-16.7 37.2-37.2v-69.8c0-3.4 1.9-6.7 5-8.6 5.7-3.5 10.8-7.6 15.4-12.1 16.6-16.3 25.7-37.9 25.7-60.8v-97.1h-1.1c-2.7-18.1-11.2-34.8-24.5-47.8l-1.7-1.6c-16-15-37-23.3-59.2-23.3H644.1c-4.2 0-6.4-0.5-7.4-0.7-2.7-6.9-2.7-23.6-2.7-29.4V149.5c0-22.9-8.9-44.5-25-60.9l-1.9-1.8C591 71.4 570 63 548 63h-71.1c-20.9 0-41.3 7.8-56.8 21.7h-0.4l-3.8 3.8c-16.2 16.3-25.1 37.9-25.1 61v127.2c0 5.7 0 22.5-2.7 29.3-1 0.3-3.1 0.8-7.4 0.8h-185c-21.1 0-41 7.5-56.8 21.2h-0.4l-3.8 3.8c-16.4 16.3-25.4 37.9-25.4 60.7v84.1c0.1 23.1 9.2 44.6 25.7 60.7 4.9 4.8 10.1 8.8 15.5 12.1 3 1.9 4.9 5 4.9 8.5v177.2c0 0.9-0.3 93-23.6 146.6l-1.1 2.4c-3 6.5-7.6 16.3-7.6 28.9 0 17.7 7.1 47.4 54.7 47.4H847c47.6 0 54.7-29.7 54.7-47.4 0-12.1-4.2-21.5-7.3-28.4l-1-2-0.4-1c-12.2-28.1-17.9-66.2-20.6-93.4-0.1-1.8-0.3-3.5-0.6-5-2.4-18.4-18.2-32.3-36.8-32.3-10.4 0-20.4 4.4-27.4 12.1-7 7.7-10.5 18.1-9.6 28.5 2.9 30.7 7.6 58.3 14 82.1 1.1 4-0.6 7-1.7 8.4-1.9 2.5-4.8 3.9-7.9 3.9h-74.2c-5.5 0-9.9-4.4-9.9-9.9V770.7c0-16.7-16.3-29.7-37.2-29.7S644 754 644 770.7v105.6c0 5.5-4.4 9.9-9.9 9.9h-74.7c-5.5 0-9.9-4.4-9.9-9.9V724.5c0-19.3-16.7-35-37.2-35-20.5 0-37.2 15.7-37.2 35v151.8c0 5.5-4.4 9.9-9.9 9.9h-74.7c-5.5 0-9.9-4.4-9.9-9.9V770.7c0-16.7-16.3-29.7-37.2-29.7s-37.2 13-37.2 29.7v105.6c0 5.5-4.4 9.9-9.9 9.9h-74.2c-4.3 0-6.7-2.4-7.8-3.9-1.9-2.5-2.5-5.6-1.7-8.6 16.9-63.4 17.1-135.4 17.1-138.5v-163c0-5.5 4.4-9.9 9.9-9.9H785c5.5 0 9.9 4.4 9.9 9.9v55.6c0 20.6 16.7 37.3 37.2 37.3zM452.6 342.9c11-20 12.5-43.6 12.5-66V149.5c0-3.2 1.3-6.3 3.6-8.7l0.8-0.8c2-1.6 4.6-2.5 7.2-2.5h71.1c2.5 0 5 0.9 7 2.4l1.1 1.1c2.3 2.3 3.5 5.3 3.3 8.4v70.5h-0.1v13c0 2.9-1.2 5.7-3.4 7.8-2.3 2.3-5.5 3.6-8.6 3.6H195.7c-3.2 0-6.3-1.3-8.5-3.5l-0.1-0.1c-2.2-2.1-3.4-5-3.4-7.8v-84c0-2.9 1.2-5.8 3.3-7.8 2.2-2.2 5.3-3.4 8.7-3.4h184.9c33.9-0.1 58.2-13.1 72-38.6z"})}),O1=()=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),E3=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),F1=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),P3=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})}),T3=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),I3=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})}),j3=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"})}),A3=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"4",width:"6",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"8",width:"8",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"12",width:"4",height:"2",fill:"currentColor",rx:"1"})]}),M3=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"7",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1",opacity:"0.5"}),n.jsx("rect",{x:"3",y:"4",width:"10",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"8",width:"6",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"2",y:"12",width:"12",height:"2",fill:"currentColor",rx:"1"})]}),R3=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"12",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"4",width:"6",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"3",y:"8",width:"8",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"7",y:"12",width:"4",height:"2",fill:"currentColor",rx:"1"})]}),L3=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"4",y:"5",width:"2",height:"6",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"8",y:"5",width:"2",height:"8",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"5",width:"2",height:"4",fill:"currentColor",rx:"1"})]}),D3=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"7",width:"12",height:"2",fill:"currentColor",rx:"1",opacity:"0.5"}),n.jsx("rect",{x:"4",y:"3",width:"2",height:"10",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"8",y:"5",width:"2",height:"6",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"})]}),z3=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"12",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"4",y:"5",width:"2",height:"6",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"8",y:"3",width:"2",height:"8",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"7",width:"2",height:"4",fill:"currentColor",rx:"1"})]}),q3=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"7",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"})]}),O3=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"2",y:"7",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"2",y:"12",width:"12",height:"2",fill:"currentColor",rx:"1"})]}),F3=()=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 14v6m-3-3h6M6 10h2a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2zm10 0h2a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2zM6 20h2a2 2 0 002-2v-2a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2z"})}),Dt=({className:e="h-5 w-5"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("rect",{x:"8",y:"8",width:"12",height:"12",rx:"2",ry:"2"}),n.jsx("path",{d:"M16 8V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2"})]}),B1=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),G1=({className:e="h-4 w-4"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 24 24",children:[n.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2"}),n.jsx("path",{d:"M4 4h8v16H4z",fill:"currentColor",stroke:"none",opacity:"0.8"})]}),H1=({className:e="h-4 w-4"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 24 24",children:[n.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2"}),n.jsx("path",{d:"M12 4h8v16h-8z",fill:"currentColor",stroke:"none",opacity:"0.8"})]}),Pp=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})}),Tp=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9H5a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1zm0 0l-5-5M15 9h4a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1zm0 0l5-5M9 15H5a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1zm0 0l-5 5M15 15h4a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1zm0 0l5 5"})}),Ip=({className:e="h-4 w-4"})=>n.jsx("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 512 512",fill:"currentColor",children:n.jsx("g",{children:n.jsx("path",{d:`M374.8,9.4c-12.4-12.5-32.6-12.6-45.2-0.1c-3.3,3.3-5.6,7.3-7.2,11.3c-26.6,55.5-55.8,86.7-92.8,105.2
                c-41.4,20.5-89,34.7-165.7,34.7c-4.2,0-8.3,0.8-12.2,2.4c-7.8,3.2-14,9.5-17.3,17.3c-3.2,7.8-3.2,16.6,0,24.4
                c1.6,3.9,4,7.5,6.9,10.4L145,318.7L0,512l193.3-145L297,470.6c2.9,3,6.5,5.3,10.4,6.9c3.9,1.6,8.1,2.5,12.2,2.5
                c4.2,0,8.3-0.9,12.2-2.5c7.8-3.3,14.1-9.4,17.3-17.3c1.6-3.9,2.5-8.1,2.5-12.2c0-76.7,14.2-124.3,34.6-165.1
                c18.4-36.9,49.7-66.2,105.2-92.8c4.1-1.6,8-3.9,11.3-7.2c12.4-12.6,12.4-32.7-0.1-45.2L374.8,9.4z`})})}),B3=({className:e="h-4 w-4"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),G3=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 000-6.364l-7.682 7.682-7.682-7.682z"})}),H3=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),U3=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),V3=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363 1.118l-3.976-2.888c-.784-.57-.382-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})}),W3=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363 1.118l-3.976-2.888c-.784-.57-.382-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})}),Cl=({className:e="h-4 w-4"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),kl=({className:e="h-4 w-4"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24"}),n.jsx("path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"}),n.jsx("path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"}),n.jsx("line",{x1:"2",x2:"22",y1:"2",y2:"22"})]}),$3=({className:e="h-5 w-5"})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 87.3 78",fill:"currentColor",children:[n.jsx("path",{d:"M6.6 66.85l3.85 6.65c.8 1.4 1.95 2.5 3.3 3.3l13.75-23.8h-27.5c0 1.55.4 3.1 1.2 4.5z",fill:"#0066da"}),n.jsx("path",{d:"M43.65 25l13.75-23.8c-1.35-.8-2.9-1.2-4.5-1.2h-18.5c-1.6 0-3.15.45-4.5 1.2l13.75 23.8z",fill:"#00ac47"}),n.jsx("path",{d:"M73.55 76.8c1.35-.8 2.5-1.9 3.3-3.3l9.6-16.6c.8-1.4 1.2-2.95 1.2-4.5h-27.5l13.4 24.4z",fill:"#ea4335"}),n.jsx("path",{d:"M43.65 25L29.9 1.2c-1.35.8-2.5 1.9-3.3 3.3l-9.6 16.6c-.8 1.4-1.2 2.95-1.2 4.5h27.5z",fill:"#00832d"}),n.jsx("path",{d:"M59.05 52.9H31.55l-13.75 23.8c1.35.8 2.9 1.2 4.5 1.2h18.5c1.6 0 3.15-.45 4.5-1.2l13.75-23.8z",fill:"#2684fc"}),n.jsx("path",{d:"M73.55 76.8l-13.75-23.8h-27.5l13.75 23.8c1.35.8 2.9 1.2 4.5 1.2h18.5c1.6 0 3.15-.45 4.5-1.2z",fill:"#ffba00"})]}),K3=({className:e="h-4 w-4"})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 4.5l-2.404 2.404a5.002 5.002 0 01-7.072 0l-1.06-1.06a5.002 5.002 0 010-7.072l2.404-2.404a1.5 1.5 0 012.122 0l6.01 6.01a1.5 1.5 0 010 2.122zM8.25 15.75l-4.5 4.5a1.5 1.5 0 000 2.122l1.06 1.06a1.5 1.5 0 002.122 0l4.5-4.5"})}),J3=({node:e,isDockedWindow:t,isRerouteDot:o,headerBgClass:r,onMouseDown:a,onTouchStart:i,onMouseUp:s,onDoubleClick:l,onToggleCollapse:c,onRenameNode:d,onCutConnections:u,onDuplicateNode:p,onDuplicateNodeWithContent:h,onCopyNodeValue:x,onPasteNodeValue:k,onPasteImage:C,onDownloadImage:w,onRefreshImageEditor:f,onRefreshChat:g,onValueChange:v,clearImagesForNodeFromCache:_,addToast:S,getEmptyValueForNodeType:T,onSaveSequenceToCatalog:P,onSaveScriptToDisk:R,onSaveMediaToDisk:D,onSaveCharacterToCatalog:q,onSaveCharacterCard:O,handleUndockNode:E,handleOpenNodeContextMenu:A,handleRequestDelete:N,isInstantCloseEnabled:j})=>{const{t:L}=vt(),M=Ut(),{handleDockNode:V,toggleNodeFullScreen:H,focusedNodeId:F,handleToggleNodePin:G,handleToggleNodeHandles:B}=M||{},Y=F===e.id,ee=Bl(e.type),ie=e.type===z.NOTE;let ce=!1,pe={};if(ie)try{pe=JSON.parse(e.value||"{}"),ce=!!pe.isMinimal}catch{}const ue=W=>{W.stopPropagation();const U={...pe,isMinimal:!ce};v(e.id,JSON.stringify(U))},re=Et.useMemo(()=>{if(e.type===z.IMAGE_OUTPUT||e.type===z.VIDEO_OUTPUT)return!!e.value;if(e.type===z.IMAGE_INPUT||e.type===z.IMAGE_ANALYZER||e.type===z.IMAGE_EDITOR||e.type===z.CHARACTER_CARD||e.type===z.DATA_READER)try{const W=JSON.parse(e.value||"{}");return!!W.image||W.inputImages&&W.inputImages.length>0||!!W.outputImage}catch{return e.type===z.IMAGE_INPUT?!!e.value:!1}return!1},[e.type,e.value]),$=Et.useMemo(()=>({[z.TEXT_INPUT]:L("node.help.text_input"),[z.IMAGE_INPUT]:L("node.help.image_input"),[z.PROMPT_PROCESSOR]:L("node.help.prompt_processor"),[z.PROMPT_SANITIZER]:L("node.help.prompt_sanitizer"),[z.VIDEO_PROMPT_PROCESSOR]:L("node.help.video_prompt_processor"),[z.IMAGE_OUTPUT]:L("node.help.image_output"),[z.VIDEO_OUTPUT]:L("node.help.video_output"),[z.PROMPT_ANALYZER]:L("node.help.prompt_analyzer"),[z.CHARACTER_ANALYZER]:L("node.help.character_analyzer"),[z.CHARACTER_GENERATOR]:L("node.help.character_generator"),[z.CHARACTER_CARD]:L("node.help.character_card"),[z.IMAGE_ANALYZER]:L("node.help.image_analyzer"),[z.IMAGE_EDITOR]:L("node.help.image_editor"),[z.IMAGE_SEQUENCE_GENERATOR]:L("node.help.image_sequence_generator"),[z.PROMPT_SEQUENCE_EDITOR]:L("node.help.prompt_sequence_editor"),[z.GEMINI_CHAT]:L("node.help.gemini_chat"),[z.TRANSLATOR]:L("node.help.translator"),[z.SCRIPT_GENERATOR]:L("node.help.script_generator"),[z.SCRIPT_VIEWER]:L("node.help.script_viewer"),[z.NOTE]:L("node.help.note"),[z.REROUTE_DOT]:L("node.help.reroute_dot"),[z.DATA_READER]:L("node.help.data_reader"),[z.VIDEO_EDITOR]:L("node.help.video_editor"),[z.MEDIA_VIEWER]:L("node.help.media_viewer")}),[L]),Z=W=>{W.stopPropagation(),v(e.id,T(e)),(e.type===z.IMAGE_INPUT||e.type===z.IMAGE_OUTPUT||e.type===z.IMAGE_ANALYZER||e.type===z.IMAGE_SEQUENCE_GENERATOR)&&_(e.id),S(L("toast.contentCleared"))},te=W=>{W.stopPropagation(),V&&V(e.id,"full"),H&&setTimeout(()=>H(e.id),50)},ae=W=>{if(!V||!e.dockState)return;const U=["q1","q2","q3","q4"],Q=e.dockState.mode;let de=U.indexOf(Q);de===-1&&(["left","tl","bl"].includes(Q)?de=0:["right","tr","br"].includes(Q)?de=3:de=0);let se=de+W;se<0&&(se=0),se>=U.length&&(se=U.length-1),U[se]!==Q&&V(e.id,U[se])},I=W=>{if(!V||!e.dockState)return;const U=e.dockState.mode;W==="left"?U==="tl"?V(e.id,"bl"):V(e.id,"tl"):U==="tr"?V(e.id,"br"):V(e.id,"tr")},J=W=>{W.stopPropagation();let U=[];try{const K=JSON.parse(e.value||"[]");U=Array.isArray(K)?K:[K]}catch{U=[]}let Q=1;const de=new Set(U.map(K=>K.name));for(;de.has(`New Character ${Q}`);)Q++;const se={id:`char-card-${Date.now()}`,name:`New Character ${Q}`,index:`Character-${U.length+1}`,image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:U.length===0,isDescriptionCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"},X=[...U,se];if(v(e.id,JSON.stringify(X)),M!=null&&M.setNodes){const ne=X.length*410+90;M.setNodes(le=>le.map(ge=>ge.id===e.id?{...ge,width:ne}:ge))}};return n.jsx("div",{className:`${r} text-white font-bold p-2 ${e.isCollapsed?"rounded-md":"rounded-t-md"} flex justify-between items-center flex-shrink-0 ${!o&&!t?"cursor-move":""}`,onMouseDown:a,onTouchStart:!o&&!t?i:void 0,onMouseUp:s,onContextMenu:W=>{A&&A(W,e.id)},onDoubleClick:l,style:o?{height:"100%"}:{height:`${Rt}px`},children:o?n.jsx("div",{className:"w-full h-full flex justify-center items-center"}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"flex items-center space-x-1 min-w-0",children:!ce&&n.jsxs(n.Fragment,{children:[!t&&!Y&&n.jsx(Ne,{title:e.isCollapsed?L("node.action.expand"):L("node.action.collapse"),onClick:()=>c(e.id),children:e.isCollapsed?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),!t&&!Y&&G&&n.jsx(Ne,{title:e.isPinned?L("node.action.unpin"):L("node.action.pin"),onClick:W=>{W.stopPropagation(),G(e.id)},className:`p-1 rounded hover:bg-gray-600 transition-colors border ${e.isPinned?"border-accent-text text-accent-text":"border-transparent text-gray-500 hover:text-white"}`,children:n.jsx(Ip,{className:"h-4 w-4"})}),n.jsx("span",{className:"truncate pr-2",children:e.title})]})}),n.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0",onMouseDown:W=>W.stopPropagation(),onTouchStart:W=>W.stopPropagation(),onDoubleClick:W=>W.stopPropagation(),children:[ie&&n.jsx(Ne,{title:ce?"Show Controls":"Hide Controls",onClick:ue,className:`p-1 rounded hover:bg-gray-600 transition-colors ${ce?"text-gray-500":"text-gray-400 hover:text-white"}`,children:ce?n.jsx(Cl,{className:"h-4 w-4"}):n.jsx(kl,{className:"h-4 w-4"})}),e.type===z.CHARACTER_CARD&&B&&!ce&&n.jsx(Ne,{title:e.collapsedHandles?L("node.action.showOutputs"):L("node.action.hideOutputs"),onClick:W=>{W.stopPropagation(),B(e.id)},className:`p-1 rounded hover:bg-gray-600 transition-colors border ${e.collapsedHandles?"border-accent text-accent-text":"border-transparent text-gray-400 hover:text-white"}`,children:e.collapsedHandles?n.jsx(kl,{className:"h-4 w-4"}):n.jsx(Cl,{className:"h-4 w-4"})}),!ce&&n.jsxs("div",{className:"relative flex items-center group/help-tooltip",children:[n.jsx("button",{onMouseDown:W=>W.stopPropagation(),className:"p-1 text-gray-400 rounded hover:bg-gray-600 hover:text-white transition-colors duration-150 focus:outline-none focus:ring-1 focus:ring-cyan-500","aria-label":L("node.action.help"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 bg-slate-700 text-slate-200 text-xs whitespace-normal w-64 rounded-lg shadow-xl z-50 opacity-0 pointer-events-none group-hover/help-tooltip:opacity-100 transition-opacity duration-200 ease-out",children:$[e.type]||L("node.action.help")})]}),!t&&!ce&&n.jsx(Ne,{title:L("node.action.rename"),onClick:()=>d(e.id,e.title),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),!ce&&e.type===z.PROMPT_SEQUENCE_EDITOR&&P&&R&&n.jsxs(n.Fragment,{children:[n.jsx(Ne,{title:L("catalog.saveTo"),onClick:()=>P(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2v15"})})}),n.jsx(Ne,{title:L("group.saveToDisk"),onClick:()=>R(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]}),!ce&&e.type===z.SCRIPT_VIEWER&&R&&n.jsx(Ne,{title:L("group.saveToDisk"),onClick:()=>R(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),!ce&&e.type===z.MEDIA_VIEWER&&D&&n.jsx(Ne,{title:L("group.saveToDisk"),onClick:()=>D(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),!ce&&(e.type===z.IMAGE_OUTPUT||e.type===z.VIDEO_OUTPUT||e.type===z.IMAGE_INPUT||e.type===z.GEMINI_CHAT)&&(re||e.type===z.GEMINI_CHAT)&&n.jsx(Ne,{title:L("node.action.download"),onClick:()=>w(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),!ce&&(e.type===z.IMAGE_INPUT||e.type===z.IMAGE_OUTPUT||e.type===z.DATA_READER)&&re&&n.jsx(Ne,{title:L("node.action.clear"),onClick:Z,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),!ce&&e.type===z.IMAGE_ANALYZER&&re&&n.jsx(Ne,{title:L("node.action.clear"),onClick:Z,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),!ce&&e.type===z.IMAGE_EDITOR&&n.jsx(Ne,{title:L("node.action.clear"),onClick:()=>f(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),!ce&&e.type===z.GEMINI_CHAT&&n.jsx(Ne,{title:L("node.action.refreshChat"),onClick:()=>g(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-4 w-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),!ce&&(e.type===z.PROMPT_ANALYZER||e.type===z.CHARACTER_ANALYZER||e.type===z.CHARACTER_GENERATOR)&&n.jsx(Ne,{title:L("node.action.clear"),onClick:Z,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),!ce&&(e.type===z.IMAGE_SEQUENCE_GENERATOR||e.type===z.PROMPT_SEQUENCE_EDITOR)&&n.jsx(Ne,{title:L("node.action.clear"),onClick:()=>{if(e.type===z.IMAGE_SEQUENCE_GENERATOR)try{const U={...JSON.parse(e.value||"{}"),prompts:[],images:{},frameStatuses:{},checkedFrameNumbers:[],selectedFrameNumber:null,usedCharacters:[]};v(e.id,JSON.stringify(U)),_(e.id),S(L("toast.contentCleared"))}catch{Z(null)}else Z(null)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),!ce&&(e.type===z.IMAGE_INPUT||e.type===z.IMAGE_ANALYZER||e.type===z.IMAGE_EDITOR)&&n.jsxs(n.Fragment,{children:[" ",n.jsx(Ne,{title:L("node.action.paste"),onClick:()=>C(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})})," "]}),!ce&&e.type===z.CHARACTER_CARD&&n.jsxs(n.Fragment,{children:[n.jsx(Ne,{title:L("node.action.addCard"),onClick:J,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),q&&O&&n.jsxs(n.Fragment,{children:[n.jsx(Ne,{title:L("catalog.saveTo"),onClick:()=>q(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})}),n.jsx(Ne,{title:L("node.action.saveCharacter"),onClick:()=>O(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Ne,{title:L("node.action.paste"),onClick:()=>k(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),n.jsx(Ne,{title:L("node.action.copy"),onClick:()=>x(e.id),children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Ne,{title:L("node.action.clear"),onClick:Z,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),!ce&&(e.type===z.TEXT_INPUT||e.type===z.NOTE||e.type===z.SCRIPT_GENERATOR||e.type===z.SCRIPT_VIEWER||e.type===z.MEDIA_VIEWER)&&n.jsxs(n.Fragment,{children:[" ",n.jsx(Ne,{title:L("node.action.clear"),onClick:Z,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),n.jsxs(Ne,{title:L("node.action.paste"),onClick:()=>k(e.id),children:[" ",n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})]})," "]}),!ce&&e.type!==z.IMAGE_EDITOR&&e.type!==z.CHARACTER_CARD&&n.jsx(Ne,{title:L("node.action.copy"),onClick:()=>x(e.id),children:n.jsx(Dt,{className:"h-4 w-4"})}),!t&&!ce&&n.jsx(Ne,{title:L("toolbar.duplicateWithContent"),onClick:()=>h(e.id),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("rect",{x:"5",y:"5",width:"14",height:"14",rx:"2",ry:"2"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m-3-3h6"})]})}),!t&&!ce&&n.jsx(Ne,{title:L("toolbar.duplicate"),onClick:()=>p(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("rect",{x:"5",y:"5",width:"14",height:"14",rx:"2",ry:"2"})})}),!ce&&e.type!==z.NOTE&&!t&&n.jsx(Ne,{title:L("node.action.cutConnections"),onClick:W=>{W.stopPropagation(),u(e.id)},children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121M12 12L4.5 4.5"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5l.707-.707M19.5 4.5l-.707.707"})]})}),!t&&!ce&&n.jsx(Ne,{title:L(j?"node.action.closeNodeSimple":"node.action.closeNode"),onClick:N,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),!ce&&(t||Y)&&E&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"w-px h-3 bg-gray-500 mx-1"}),!Y&&n.jsxs(n.Fragment,{children:[!ee&&n.jsx(ct,{content:"Cycle Horizontal Left",children:n.jsx("button",{onClick:W=>{W.stopPropagation(),ae(-1)},className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("path",{d:"M15 18l-6-6 6-6"})})})}),!ee&&n.jsx(ct,{content:"Cycle Vertical Left (TL/BL)",children:n.jsx("button",{onClick:W=>{W.stopPropagation(),I("left")},className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M7 15l5 5 5-5"}),n.jsx("path",{d:"M7 9l5-5 5 5"})]})})}),n.jsx(ct,{content:L("toolbar.dock.left"),children:n.jsx("button",{onClick:W=>{W.stopPropagation(),V&&V(e.id,"left")},className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsx(G1,{})})}),n.jsx(ct,{content:L("toolbar.dock.right"),children:n.jsx("button",{onClick:W=>{W.stopPropagation(),V&&V(e.id,"right")},className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsx(H1,{})})}),!ee&&n.jsx(ct,{content:"Cycle Vertical Right (TR/BR)",children:n.jsx("button",{onClick:W=>{W.stopPropagation(),I("right")},className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M7 15l5 5 5-5"}),n.jsx("path",{d:"M7 9l5-5 5 5"})]})})}),!ee&&n.jsx(ct,{content:"Cycle Horizontal Right",children:n.jsx("button",{onClick:W=>{W.stopPropagation(),ae(1)},className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("path",{d:"M9 18l6-6-6-6"})})})})]}),Y?n.jsx(ct,{content:L("toolbar.dock.exitFull"),children:n.jsx("button",{onClick:W=>{W.stopPropagation(),H==null||H(null)},className:"text-cyan-400 hover:text-white transition-colors p-1",children:n.jsx(Tp,{})})}):n.jsx(ct,{content:L("toolbar.dock.fullFocus"),children:n.jsx("button",{onClick:te,className:"text-gray-400 hover:text-white transition-colors p-1",children:n.jsx(Pp,{})})}),n.jsx(ct,{content:L("toolbar.detach"),children:n.jsx("button",{onClick:W=>{W.stopPropagation(),Y&&(H==null||H(null)),E(e.id)},className:"text-gray-400 hover:text-white transition-colors ml-1 p-1",children:n.jsx(B1,{})})})]})]})]})})},Y3=({text:e})=>n.jsx("div",{className:"absolute z-50 px-2 py-1 text-sm transition-opacity duration-200 ease-out opacity-0 pointer-events-none left-full ml-3 top-1/2 -translate-y-1/2 bg-slate-700 text-slate-200 whitespace-nowrap rounded-md shadow-xl group-hover/handle:opacity-100",children:e}),X3=({text:e})=>n.jsx("div",{className:"absolute z-50 px-2 py-1 text-sm transition-opacity duration-200 ease-out opacity-0 pointer-events-none right-full mr-3 top-1/2 -translate-y-1/2 bg-slate-700 text-slate-200 whitespace-nowrap rounded-md shadow-xl group-hover/handle:opacity-100",children:e}),Rg=({node:e,getHandleColor:t,handleCursor:o,isCollapsed:r,isProxy:a,connectedInputType:i})=>{const s=Et.useMemo(()=>{if(e.type===z.IMAGE_EDITOR)try{return JSON.parse(e.value||"{}")}catch{return{}}return{}},[e.value,e.type]),l=Et.useMemo(()=>e.type===z.IMAGE_EDITOR?s.isSequenceMode&&(s.isSequentialCombinationMode||s.isSequentialEditingWithPrompts):!1,[e.type,s]),c=Et.useMemo(()=>e.type===z.IMAGE_EDITOR?s.isSequenceMode&&s.isSequentialEditingWithPrompts:!1,[e.type,s]),d=e.type===z.REROUTE_DOT,p=Et.useMemo(()=>{if(!d)return!1;try{return JSON.parse(e.value||"{}").direction==="RL"}catch{return!1}},[d,e.value])?{right:"-10px",left:"auto"}:{left:"-10px"},h=w=>e.type===z.DATA_READER&&i?i:w,x=(w,f,g)=>n.jsx("div",{style:{top:f,cursor:o,...p},className:`absolute w-5 h-5 rounded-full border-2 border-gray-900 transform -translate-y-1/2 ${t(h(w.type),w.handleId)} group/handle transition-[transform,border-color,background-color] duration-200 hover:scale-125 hover:border-white hover:z-20`,"data-is-input-handle":"true","data-node-id":e.id,"data-handle-id":w.handleId||"","data-handle-type":w.type||"",children:n.jsx(Y3,{text:w.title})},g);if(a){let w=[];if(e.type===z.IMAGE_EDITOR)c||w.push({handleId:"image",type:"image",title:"Image"}),l&&w.push({handleId:"image_b",type:"image",title:"Image B"}),w.push({handleId:"text",type:"text",title:"Text"});else if(e.type===z.IMAGE_SEQUENCE_GENERATOR)w=[{handleId:"character_data",type:"character_data",title:"Character Data Input"},{handleId:"prompt_input",type:"text",title:"Text"}];else if(e.type===z.PROMPT_SEQUENCE_EDITOR)w=[{handleId:"prompts_sequence",type:"text",title:"Prompts Sequence Input"}];else if(e.type===z.NOTE)w=[{handleId:"prompt_data",type:"text",title:"Prompt Input"}];else if(e.type===z.VIDEO_EDITOR)w=[{handleId:"video",type:"video",title:"Video"},{handleId:"audio",type:"audio",title:"Audio"},{handleId:"image",type:"image",title:"Image"},{handleId:"text",type:"text",title:"Text"}];else if(e.type===z.CHARACTER_CARD)w=[{handleId:void 0,type:"text",title:"Input"}];else{const f=qs(e,void 0);(f!==null||e.type===z.REROUTE_DOT||e.type===z.DATA_READER)&&(w=[{handleId:void 0,type:f,title:"Input"}])}return w.length===0?null:n.jsxs(n.Fragment,{children:[" ",w.map((f,g)=>{const v=48/(w.length+1);return x(f,`${(g+1)*v}px`,f.handleId||`proxy-in-${g}`)})," "]})}if(r){let w=[];if(e.type===z.IMAGE_EDITOR)c||w.push({handleId:"image",type:"image",title:"Image Input A"}),l&&w.push({handleId:"image_b",type:"image",title:"Image Input B"}),w.push({handleId:"text",type:"text",title:"Text Input"});else if(e.type===z.IMAGE_SEQUENCE_GENERATOR)w=[{handleId:"character_data",type:"character_data",title:"Character Data Input"},{handleId:"prompt_input",type:"text",title:"Prompts JSON Input"}];else if(e.type===z.NOTE){try{if(JSON.parse(e.value||"{}").activeTab==="note")return null}catch{}w=[{handleId:"prompt_data",type:"text",title:"Prompt Data Input"}]}else if(e.type===z.PROMPT_SEQUENCE_EDITOR)w=[{handleId:"prompts_sequence",type:"text",title:"Prompts Sequence Input"}];else if(e.type===z.VIDEO_EDITOR)w=[{handleId:"video",type:"video",title:"Video Input"},{handleId:"audio",type:"audio",title:"Audio Input"},{handleId:"image",type:"image",title:"Image Input"},{handleId:"text",type:"text",title:"Text Input"}];else{const f=qs(e,void 0);(f!==null||e.type===z.REROUTE_DOT||e.type===z.DATA_READER)&&(w=[{handleId:void 0,type:f,title:"Input"}])}return w.length===0?null:n.jsxs(n.Fragment,{children:[" ",w.map((f,g)=>x(f,`${(g+1)*(Nn/(w.length+1))}px`,f.handleId||`input-${g}`))," "]})}if(e.type===z.IMAGE_EDITOR){let w=330;s.topPaneHeight&&(w=s.topPaneHeight);const f=Rt+Jt;let g,v;l?(g=f+w*.25,v=f+w*.75):g=f+w*.5;const S=f+w+16,P=e.height-Jt-S,R=S+P/2;return n.jsxs(n.Fragment,{children:[!c&&x({type:"image",handleId:"image",title:l?"Image Input A":"Image Input"},`${g}px`,"image"),l&&v&&x({type:"image",handleId:"image_b",title:"Image Input B"},`${v}px`,"image_b"),x({type:"text",handleId:"text",title:"Text Input"},`${R}px`,"text")]})}if(e.type===z.VIDEO_EDITOR){const w=Rt+20,f=50;return n.jsxs(n.Fragment,{children:[x({type:"video",handleId:"video",title:"Video Input"},`${w}px`,"video"),x({type:"audio",handleId:"audio",title:"Audio Input"},`${w+f}px`,"audio"),x({type:"image",handleId:"image",title:"Image Input"},`${w+f*2}px`,"image"),x({type:"text",handleId:"text",title:"Text Input"},`${w+f*3}px`,"text")]})}if(e.type===z.IMAGE_SEQUENCE_GENERATOR){let w="normal";try{const P=JSON.parse(e.value||"{}");P.conceptsMode&&(w=P.conceptsMode)}catch{}let f=390;w==="collapsed"?f=37:w==="expanded"&&(f=e.height-Rt-Jt);const g=Rt+Jt,v=g+f/2,S=g+f+8,T=S+(e.height-S-Jt)/2;return n.jsxs(n.Fragment,{children:[x({type:"character_data",handleId:"character_data",title:"Character Data Input"},`${v}px`,"character_data"),w!=="expanded"&&x({type:"text",handleId:"prompt_input",title:"Prompts JSON Input"},`${T}px`,"prompt_input")]})}if(e.type===z.NOTE){try{if(JSON.parse(e.value||"{}").activeTab==="note")return null}catch{}const w=80+(e.height-80)/2;return x({type:"text",handleId:"prompt_data",title:"Prompt Data Input"},`${w}px`,"prompt_data")}if(e.type===z.PROMPT_SEQUENCE_EDITOR)return x({type:"text",handleId:"prompts_sequence",title:"Prompts Sequence Input"},"50%","prompts_sequence");const k=qs(e,void 0);if(k===null)return e.type===z.REROUTE_DOT||e.type===z.DATA_READER?x({type:null,handleId:void 0,title:"Any Input"},"50%","any"):null;let C="Input";return k==="image"?C="Image Input":k==="character_data"?C="Character Data Input":k==="text"?C="Text Input":k==="video"?C="Video Input":k==="audio"&&(C="Audio Input"),x({type:k,handleId:void 0,title:C},"50%","default")},Lg=({node:e,getHandleColor:t,handleCursor:o,onOutputHandleMouseDown:r,onOutputHandleTouchStart:a,t:i,isCollapsed:s,isProxy:l})=>{const c=(w,f)=>{w.stopPropagation(),r&&r(w,e.id,f)},d=(w,f)=>{w.stopPropagation(),a&&a(w,e.id,f)},u=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{}}},[e.value]),p=e.type===z.REROUTE_DOT,x=Et.useMemo(()=>{if(!p)return!1;try{return JSON.parse(e.value||"{}").direction==="RL"}catch{return!1}},[p,e.value])?{left:"-10px",right:"auto"}:{right:"-10px"},k=(w,f,g)=>n.jsx("div",{onMouseDown:v=>c(v,w.handleId),onTouchStart:v=>d(v,w.handleId),style:{top:f,cursor:o,...x},className:`absolute w-5 h-5 rounded-full border-2 border-gray-900 transform -translate-y-1/2 ${t(w.type,w.handleId)} group/handle transition-[transform,border-color,background-color] duration-200 hover:scale-125 hover:border-white hover:z-20`,children:n.jsx(X3,{text:w.title})},g);if(l){let w=[];const f=Kn(e,void 0);return e.type===z.IMAGE_EDITOR?w=[{handleId:void 0,type:"image",title:"Output"}]:e.type===z.CHARACTER_GENERATOR?w=[{handleId:"character-0",type:"character_data",title:"Characters"}]:e.type===z.NOTE?w=[{handleId:"all_images",type:"image",title:"Images"},{handleId:"all_captions",type:"text",title:"Captions"}]:e.type===z.PROMPT_SEQUENCE_EDITOR?w=[{handleId:"all_data",type:"text",title:"All Data"}]:e.type===z.CHARACTER_CARD?w=[{handleId:"all_data",type:"character_data",title:"All Data"}]:(f!==null||e.type===z.REROUTE_DOT)&&(w=[{handleId:void 0,type:f,title:"Output"}]),w.length===0?null:n.jsxs(n.Fragment,{children:[" ",w.map((g,v)=>{const _=48/(w.length+1);return k(g,`${(v+1)*_}px`,g.handleId||`proxy-out-${v}`)})," "]})}if(s){let w=[];if(e.type===z.PROMPT_ANALYZER){const{characters:f=[]}=u;w=["environment",...f.map((v,_)=>`character-${_}`),"action","emotion","style"].map(v=>({handleId:v,type:"text",title:v.startsWith("character-")?`${i("node.content.character")} ${parseInt(v.split("-")[1],10)+1}`:i(`node.content.${v}`)}))}else if(e.type===z.PROMPT_SEQUENCE_EDITOR)w=[{handleId:"all_data",type:"text",title:i("node.output.allPromptData")}];else if(e.type===z.CHARACTER_ANALYZER)w=[{handleId:"character",type:"text",title:i("node.content.character")},{handleId:"clothing",type:"text",title:i("node.content.clothing")}];else if(e.type===z.IMAGE_INPUT||e.type===z.IMAGE_ANALYZER)w=[{handleId:"image",type:"image",title:"Image Output"},{handleId:"text",type:"text",title:"Text Output"}];else if(e.type===z.SCRIPT_GENERATOR){const{summary:f,detailedCharacters:g=[],scenes:v=[]}=u,_=g.map((T,P)=>({handleId:`character-${P}`,type:"text",title:`Character ${P+1}`})),S=v.map((T,P)=>({handleId:`scene-${P}`,type:"text",title:`Scene ${P+1}`}));w=f?[{handleId:"summary",type:"text",title:"Summary"},..._,...S]:[..._,...S]}else if(e.type===z.SCRIPT_VIEWER){const f=u.type;w=[{handleId:"full-json",type:"text",title:"Full Data JSON"}],f==="script-analyzer-data"&&w.push({handleId:"all-image-prompts",type:"text",title:"All Image Prompts"},{handleId:"all-video-prompts",type:"text",title:"All Video Prompts"})}else if(e.type===z.CHARACTER_GENERATOR){const{characters:f=[]}=u;w=f.map((g,v)=>({handleId:`character-${v}`,type:"text",title:g.name||`Character ${v+1}`}))}else if(e.type===z.CHARACTER_CARD){const f=[{handleId:"all_data",type:"character_data",title:"All Characters Data"},{handleId:"primary_data",type:"character_data",title:"Primary Character Data"}],g=[{handleId:"image",type:"image",title:"Image (primary)"},{handleId:"prompt",type:"text",title:"Prompt (primary)"},{handleId:"appearance",type:"text",title:`${i("node.content.appearance")} (primary)`},{handleId:"personality",type:"text",title:`${i("node.content.personality")} (primary)`},{handleId:"clothing",type:"text",title:`${i("node.content.clothing")} (primary)`}];e.collapsedHandles?w=f:w=[...f,...g]}else if(e.type===z.IMAGE_SEQUENCE_GENERATOR)w=[{handleId:"all_images",type:"image",title:"All Images"}];else if(e.type===z.NOTE){try{if(JSON.parse(e.value||"{}").activeTab==="note")return null}catch{}w=[{handleId:"all_images",type:"image",title:"All Images"},{handleId:"all_captions",type:"text",title:"All Captions"}]}else{const f=Kn(e,void 0);if(f!==null||e.type===z.REROUTE_DOT){const g=e.type===z.REROUTE_DOT?"Any Output":f==="image"?"Image Output":f==="character_data"?"Character Data Output":f==="video"?"Video Output":f==="audio"?"Audio Output":"Text Output";w=[{handleId:void 0,type:f,title:g}]}}return w.length===0?null:n.jsxs(n.Fragment,{children:[" ",w.map((f,g)=>k(f,`${(g+1)*(Nn/(w.length+1))}px`,f.handleId||`output-${g}`))," "]})}if(e.type===z.NOTE){try{if(JSON.parse(e.value||"{}").activeTab==="note")return null}catch{}const w=e.height-80,f=80+w*.33,g=80+w*.66;return n.jsxs(n.Fragment,{children:[k({type:"image",handleId:"all_images",title:"All Images"},`${f}px`,"all_images"),k({type:"text",handleId:"all_captions",title:"All Captions"},`${g}px`,"all_captions")]})}if(e.type===z.PROMPT_ANALYZER)return null;if(e.type===z.SCRIPT_VIEWER){const w=u.type,f=[{handleId:"full-json",type:"text",title:"Full Data JSON"}];w==="script-analyzer-data"&&f.push({handleId:"all-image-prompts",type:"text",title:"All Image Prompts"},{handleId:"all-video-prompts",type:"text",title:"All Video Prompts"});const g=e.height/(f.length+1);return n.jsxs(n.Fragment,{children:[" ",f.map((v,_)=>k(v,`${(_+1)*g}px`,v.handleId))," "]})}if(e.type===z.PROMPT_SEQUENCE_EDITOR)return k({type:"text",handleId:"all_data",title:i("node.output.allPromptData")},"50%","all_data");if(e.type===z.IMAGE_SEQUENCE_GENERATOR)return k({type:"image",handleId:"all_images",title:"All Images"},"50%","all_images");if(e.type===z.CHARACTER_GENERATOR){const{characters:w=[]}=u;if(w.length===0)return null;const f=e.height-Rt-2*Jt,g=180,v=f-g;return n.jsxs(n.Fragment,{children:[" ",w.map((_,S)=>{const T=v/(w.length+1),P=Rt+Jt+g+T*(S+1);return k({type:"character_data",handleId:`character-${S}`,title:_.name||`Character ${S+1}`},`${P}px`,`character-${S}`)})," "]})}if(e.type===z.SCRIPT_GENERATOR){const{summary:w,detailedCharacters:f=[],scenes:g=[]}=u,v=[];w&&v.push({id:"summary",title:"Summary"}),f.forEach((S,T)=>v.push({id:`character-${T}`,title:`Character ${T+1}`})),g.forEach((S,T)=>v.push({id:`scene-${T}`,title:`Scene ${T+1}`}));const _=e.height-Rt-2*Jt;return n.jsxs(n.Fragment,{children:[" ",v.map((S,T)=>{const P=Rt+Jt+_/(v.length+1)*(T+1);return k({type:"text",handleId:S.id,title:S.title},`${P}px`,S.id)})," "]})}if(e.type===z.CHARACTER_ANALYZER){const w=["character","clothing"],_=Rt+Jt,T=e.height-Jt-40-8-_;return n.jsxs(n.Fragment,{children:[" ",w.map((P,R)=>{const D=_+T/2*(R+.5),q=i(`node.content.${P}`);return k({type:"text",handleId:P,title:q},`${D}px`,P)})," "]})}if(e.type===z.IMAGE_INPUT){const w=e.height-Rt-2*Jt,f=Math.max(0,w),g=Rt+Jt+f/4,v=e.height-80;return n.jsxs(n.Fragment,{children:[k({type:"image",handleId:"image",title:"Image Output"},`${g}px`,"image"),k({type:"text",handleId:"text",title:"Text Output"},`${v}px`,"text")]})}if(e.type===z.IMAGE_ANALYZER){const w=e.height-Rt-2*Jt,f=8,g=(w-f)/2,v=Rt+Jt,_=v+g/2,S=v+g+f+g/2;return n.jsxs(n.Fragment,{children:[k({type:"image",handleId:"image",title:"Image Output"},`${_}px`,"image"),k({type:"text",handleId:"text",title:"Text Output"},`${S}px`,"text")]})}if(e.type===z.CHARACTER_CARD)try{const w=[{handleId:"all_data",type:"character_data",title:"All Characters Data"},{handleId:"primary_data",type:"character_data",title:"Primary Character Data"}];if(e.collapsedHandles){const T=(e.height-Rt-20)/(w.length+1);return n.jsx(n.Fragment,{children:w.map((P,R)=>k(P,`${Rt+T*(R+1)}px`,P.handleId||`output-${R}`))})}const f=[{handleId:"image",type:"image",title:"Image (primary)"},{handleId:"prompt",type:"text",title:"Prompt (primary)"},{handleId:"appearance",type:"text",title:`${i("node.content.appearance")} (primary)`},{handleId:"personality",type:"text",title:`${i("node.content.personality")} (primary)`},{handleId:"clothing",type:"text",title:`${i("node.content.clothing")} (primary)`}],g=[...w,...f],_=(e.height-Rt-20)/(g.length+1);return n.jsx(n.Fragment,{children:g.map((S,T)=>k(S,`${Rt+_*(T+1)}px`,S.handleId||`output-${T}`))})}catch{return null}const C=Kn(e,void 0);if(C!==null||e.type===z.REROUTE_DOT){const w=e.type===z.REROUTE_DOT?"Any Output":C==="image"?"Image Output":C==="character_data"?"Character Data Output":C==="video"?"Video Output":C==="audio"?"Audio Output":"Text Output";return k({type:C,handleId:void 0,title:w},"50%","default")}return null},jp=({libraryItems:e,onPromptInsert:t})=>{const{t:o}=vt(),[r,a]=y.useState(!1),[i,s]=y.useState(!1),[l,c]=y.useState(null),d=y.useRef(null),[u,p]=y.useState(null),h=v=>{v.stopPropagation(),r?k():x()},x=()=>{if(d.current){const v=d.current.getBoundingClientRect(),_=window.innerHeight-v.bottom,S=280;let T=v.bottom+4;_<S&&(T=v.top-S-4),p({top:T,left:v.left,width:Math.max(v.width,256)}),a(!0)}},k=()=>{s(!0),setTimeout(()=>{a(!1),s(!1),c(null)},200)};y.useEffect(()=>{if(!r)return;const v=_=>{const S=_.target,T=document.getElementById("prompt-library-portal-menu");d.current&&!d.current.contains(S)&&T&&!T.contains(S)&&k()};return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[r]),y.useEffect(()=>{if(!r)return;const v=()=>k();return window.addEventListener("scroll",v,!0),window.addEventListener("resize",v),()=>{window.removeEventListener("scroll",v,!0),window.removeEventListener("resize",v)}},[r]);const C=v=>{t(v),k()},w=v=>{if(v.stopPropagation(),l){const _=e.find(S=>S.id===l);c((_==null?void 0:_.parentId)||null)}},f=y.useMemo(()=>e.filter(v=>v.parentId===l).sort((v,_)=>v.type===_.type?v.name.localeCompare(_.name):v.type===Vt.FOLDER?-1:1),[e,l]),g=y.useMemo(()=>{var v;return l&&((v=e.find(_=>_.id===l))==null?void 0:v.name)||o("catalog.tabs.library")},[l,e,o]);return n.jsxs("div",{ref:d,className:"relative w-full",children:[n.jsxs("button",{onClick:h,title:o("catalog.tabs.library"),className:`w-full p-1.5 rounded transition-colors flex items-center justify-start space-x-2 ${r?"bg-accent":"bg-gray-700 hover:bg-gray-600"}`,children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 flex-shrink-0 ${r?"text-white":"text-accent-text"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),n.jsx("span",{className:`text-xs font-semibold truncate ${r?"text-white":"text-gray-200"}`,children:o("catalog.tabs.library")}),n.jsx("div",{className:"flex-grow"}),n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 ${r?"text-white":"text-gray-400"} transition-transform duration-200 ${r?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),r&&u&&Ba.createPortal(n.jsxs("div",{id:"prompt-library-portal-menu",className:`fixed bg-gray-800 rounded-lg shadow-xl border border-gray-600 z-[9999] flex flex-col overflow-hidden transition-all duration-200 ease-out origin-top ${i?"opacity-0 scale-95":"opacity-100 scale-100"}`,style:{top:u.top,left:u.left,width:u.width,maxHeight:"280px"},onWheel:v=>v.stopPropagation(),children:[n.jsxs("div",{className:`flex items-center p-2 border-b border-gray-700 bg-gray-900/50 transition-colors select-none ${l?"cursor-pointer hover:bg-gray-700":""}`,onClick:l?w:void 0,children:[l?n.jsx("div",{className:"mr-2 p-1 text-accent-text flex-shrink-0",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}):n.jsx("div",{className:"mr-2 p-1 text-gray-500 flex-shrink-0",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h7"})})}),n.jsx("span",{className:"text-sm font-bold text-gray-200 truncate",children:g})]}),n.jsx("div",{className:"overflow-y-auto p-1 custom-scrollbar flex-grow",children:f.length===0?n.jsx("div",{className:"p-4 text-center text-xs text-gray-500",children:o("library.empty.description")}):n.jsx("ul",{className:"space-y-0.5",children:f.map(v=>n.jsx("li",{children:v.type===Vt.FOLDER?n.jsxs("button",{onClick:_=>{_.stopPropagation(),c(v.id)},className:"w-full flex items-center justify-between p-2 rounded hover:bg-gray-700 text-left group transition-colors",children:[n.jsxs("div",{className:"flex items-center space-x-2 min-w-0",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-accent-text flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),n.jsx("span",{className:"text-sm text-gray-200 truncate group-hover:text-white",children:v.name})]}),n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-gray-500 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]}):n.jsxs("button",{onClick:_=>{_.stopPropagation(),C(v.content||"")},className:"w-full flex items-center space-x-2 p-2 rounded hover:bg-gray-700 text-left group transition-colors",title:v.content,children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-accent flex-shrink-0 opacity-70 group-hover:opacity-100",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),n.jsx("span",{className:"text-sm text-gray-300 truncate group-hover:text-white",children:v.name})]})},v.id))})})]}),document.body)]})},hn=({value:e,onDebouncedChange:t,debounceTime:o=300,onChange:r,...a})=>{const[i,s]=y.useState(e),l=y.useRef(null),c=y.useRef(!1);y.useEffect(()=>{!c.current&&e!==i&&s(e)},[e]);const d=p=>{const h=p.target.value;s(h),c.current=!0,l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{t(h),c.current=!1},o),r&&r(p)},u=p=>{l.current&&(clearTimeout(l.current),t(i),c.current=!1),a.onBlur&&a.onBlur(p)};return n.jsx("textarea",{...a,value:i,onChange:d,onBlur:u})},Z3=({text:e,onTextChange:t,libraryItems:o,t:r,deselectAllNodes:a,isMinimal:i})=>n.jsxs("div",{className:"flex flex-col h-full",children:[!i&&n.jsx("div",{className:"flex-shrink-0 mb-1",children:n.jsx(jp,{libraryItems:o,onPromptInsert:s=>{const l=e?`${e}
${s}`:s;t(l)}})}),n.jsx(hn,{value:e,onDebouncedChange:t,placeholder:r("node.content.notePlaceholder"),className:"w-full h-full p-2 bg-transparent border-none rounded-md resize-none focus:ring-2 focus:ring-cyan-500 focus:outline-none text-sm leading-relaxed",onWheel:s=>s.stopPropagation(),onMouseDown:s=>s.stopPropagation(),onFocus:a})]}),Q3=({id:e,index:t,image:o,caption:r,manualOrderValue:a,isLocked:i,isDragging:s,isSelected:l,top:c,left:d,width:u,height:p,onSelect:h,onDragStart:x,onDragEnd:k,onDrop:C,onDragOver:w,onManualOrderChange:f,onManualOrderSubmit:g,onMove:v,onMoveToStart:_,onMoveToEnd:S,onRemove:T,onCaptionChange:P,onViewImage:R,onCopyImage:D,onImageDragStart:q,deselectAllNodes:O,isFirst:E,isLast:A,insertionIndex:N,t:j})=>n.jsxs("div",{style:{position:"absolute",top:c,left:d,width:`${u}px`,height:`${p}px`},onDragOver:L=>w(L,t),onDrop:L=>C(L,t),onClick:L=>{L.stopPropagation(),h(e)},className:`bg-gray-800 rounded-md overflow-visible border-2 group flex flex-col shadow-sm transition-colors ${s?"opacity-40 border-dashed border-cyan-500":l?"border-cyan-500":"border-gray-700 hover:border-gray-500"}`,children:[N===t&&!i&&n.jsx("div",{className:"absolute left-[-10px] top-0 bottom-0 w-1.5 bg-cyan-500 rounded z-50 pointer-events-none"}),n.jsxs("div",{draggable:!i,onDragStart:L=>x(L,t),onDragEnd:k,className:`h-7 bg-gray-900/80 border-b border-gray-700 flex items-center justify-between px-2 ${i?"cursor-default":"cursor-move hover:bg-gray-700/50"} transition-colors shrink-0 rounded-t-sm`,children:[n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx("span",{className:"text-xs text-gray-500 font-mono",children:"#"}),n.jsx("input",{type:"text",value:a,onChange:L=>f(e,L.target.value),onKeyDown:L=>{L.key==="Enter"&&g(e,t,a)},disabled:i,className:`w-8 bg-gray-900 border border-gray-600 rounded text-[10px] text-center text-gray-300 focus:border-cyan-500 focus:outline-none px-0.5 py-0.5 ${i?"opacity-50":""}`,onMouseDown:L=>L.stopPropagation(),onFocus:O}),!i&&n.jsx("button",{onClick:L=>{L.stopPropagation(),g(e,t,a)},className:"text-gray-500 hover:text-cyan-400 p-0.5 rounded transition-colors",title:"Apply Order",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]}),n.jsxs("div",{className:"flex items-center space-x-1",children:[o&&n.jsx("button",{onClick:L=>{L.stopPropagation(),D(o)},className:"text-gray-400 hover:text-white p-0.5 rounded transition-colors",title:j("node.action.copy"),children:n.jsx(Dt,{className:"h-3 w-3"})}),!i&&n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:L=>{L.stopPropagation(),_()},disabled:E,className:"text-gray-500 hover:text-white disabled:opacity-30 p-0.5",title:"Move to Top",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),n.jsx("button",{onClick:L=>{L.stopPropagation(),v(t,"up")},disabled:E,className:"text-gray-500 hover:text-white disabled:opacity-30 p-0.5",title:"Move Up",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),n.jsx("button",{onClick:L=>{L.stopPropagation(),v(t,"down")},disabled:A,className:"text-gray-500 hover:text-white disabled:opacity-30 p-0.5",title:"Move Down",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),n.jsx("button",{onClick:L=>{L.stopPropagation(),S()},disabled:A,className:"text-gray-500 hover:text-white disabled:opacity-30 p-0.5",title:"Move to Bottom",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-700 mx-1"}),n.jsx("button",{onClick:L=>{L.stopPropagation(),T(e)},className:"text-gray-500 hover:text-red-400 p-0.5",title:j("node.action.delete"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})]}),n.jsx("div",{className:"h-[170px] bg-gray-900 relative cursor-pointer flex items-center justify-center shrink-0 border-b border-gray-700 overflow-hidden",onClick:()=>R(t),children:o?n.jsx("img",{src:o,alt:"Reference",draggable:!0,onDragStart:L=>{L.stopPropagation(),q(L,o)},className:"w-full h-full object-contain"}):n.jsx("span",{className:"text-xs text-gray-600",children:"No Image"})}),n.jsx("div",{className:"flex-grow p-1",children:n.jsx(hn,{value:r,onDebouncedChange:L=>P(e,L),placeholder:j("node.note.addCaption"),className:`w-full h-full bg-transparent text-xs text-gray-300 border-none focus:ring-0 p-1 placeholder-gray-600 resize-none leading-tight focus:outline-none transition-colors ${i?"cursor-default opacity-80":""}`,onMouseDown:L=>L.stopPropagation(),onFocus:O,readOnly:i})})]}),ms=200,Kr=270,Pr=8,Jr=8,eP=({references:e,isLocked:t,onAddImages:o,onReorder:r,onUpdateCaption:a,onRemoveReference:i,onDetach:s,onShuffle:l,onUndoShuffle:c,canUndoShuffle:d,t:u,deselectAllNodes:p,setImageViewer:h,addToast:x,getFullSizeImage:k,isMinimal:C})=>{const w=y.useRef(null),f=y.useRef(null),[g,v]=y.useState(0),[_,S]=y.useState(0),[T,P]=y.useState(!1),[R,D]=y.useState(!1),[q,O]=y.useState(null),[E,A]=y.useState(null),[N,j]=y.useState(null),[L,M]=y.useState({});y.useEffect(()=>{if(!w.current)return;const $=new ResizeObserver(Z=>{Z[0]&&v(Z[0].contentRect.width)});return $.observe(w.current),()=>$.disconnect()},[]);const V=y.useMemo(()=>{const $=Math.max(0,g-Jr*2),Z=Math.max(1,Math.floor(($+Pr)/(ms+Pr))),te=e.length+(t?0:1),ae=Math.ceil(te/Z),I=ae*Kr+Math.max(0,ae-1)*Pr+Jr*2;return{columns:Z,totalHeight:I,totalItems:te}},[g,e.length,t]),H=y.useMemo(()=>{var Q;const{columns:$,totalItems:Z}=V,te=600,ae=Math.max(0,_-te),I=_+(((Q=w.current)==null?void 0:Q.clientHeight)||600)+te,J=[],W=Math.floor((ae-Jr)/(Kr+Pr)),U=Math.ceil((I-Jr)/(Kr+Pr));for(let de=Math.max(0,W);de<=U;de++)for(let se=0;se<$;se++){const X=de*$+se;if(X>=Z)break;const K=Jr+de*(Kr+Pr),oe=Jr+se*(ms+Pr);J.push({index:X,top:K,left:oe,isAddButton:!t&&X===e.length})}return J},[V,_,e.length,t]),F=$=>{$.target.files&&$.target.files.length>0&&o(Array.from($.target.files)),$.target&&($.target.value="")},G=$=>{if($.preventDefault(),$.stopPropagation(),P(!1),D(!1),A(null),t)return;const Z=$.dataTransfer.getData("note-ref-index");if(Z){const I=parseInt(Z,10);isNaN(I)||r(I,e.length),O(null);return}const te=$.dataTransfer.getData("application/prompt-modifier-drag-image");if(te){o([te]);return}const ae=Array.from($.dataTransfer.files).filter(I=>I.type.startsWith("image/"));ae.length>0&&o(ae)},B=($,Z)=>{if($.preventDefault(),$.stopPropagation(),P(!1),D(!1),A(null),t)return;const te=$.dataTransfer.getData("note-ref-index");if(te){const J=parseInt(te,10);isNaN(J)||r(J,Z),O(null);return}const ae=$.dataTransfer.getData("application/prompt-modifier-drag-image");if(ae){o([ae],Z);return}const I=Array.from($.dataTransfer.files).filter(J=>J.type.startsWith("image/"));I.length>0&&o(I,Z)},Y=($,Z)=>{t||($.stopPropagation(),O(Z),$.dataTransfer.setData("note-ref-index",Z.toString()),$.dataTransfer.effectAllowed="move")},ee=$=>{O(null),A(null),P(!1),D(!1)},ie=()=>{O(null),A(null),P(!1),D(!1),j(null)},ce=($,Z,te)=>{if(!te||t)return;const ae=parseInt(te,10);if(isNaN(ae)||ae<1||ae===Z+1)return;let I;ae>e.length?I=e.length:(I=ae-1,Z<I&&(I=ae)),r(Z,I),M(J=>{const W={...J};return delete W[$],W})},pe=async $=>{if($)try{const te=await(await fetch($)).blob();await navigator.clipboard.write([new ClipboardItem({[te.type]:te})]),x(u("toast.copiedToClipboard"))}catch{x(u("toast.copyFailed"),"error")}},ue=$=>{const Z=e[$];!Z||!Z.image||h({sources:e.filter(te=>te.image).map((te,ae)=>({src:k(ae)||te.image,frameNumber:0,prompt:te.caption})),initialIndex:$})},re=e.length===0;return n.jsxs("div",{className:"flex flex-col h-full",children:[!C&&n.jsxs("div",{className:"flex justify-between items-center px-2 py-1 bg-gray-900/30 mb-1 rounded flex-shrink-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:u("node.note.nestedImages")}),n.jsx("button",{onClick:ie,className:"p-0.5 rounded hover:bg-gray-700 text-gray-500 hover:text-white transition-colors",title:"Reset/Refresh State",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})}),t&&n.jsxs("div",{className:"flex items-center text-cyan-400 text-xs gap-1 bg-cyan-900/30 px-1.5 py-0.5 rounded border border-cyan-700/50",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),n.jsx("span",{className:"font-semibold",children:"Linked"}),n.jsx("button",{onClick:s,className:"ml-1 hover:text-white",title:"Detach and Keep Data",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]}),n.jsx("div",{className:"flex items-center space-x-2",children:!t&&!re&&n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(Ne,{title:u("node.note.action.undoShuffle"),onClick:c,disabled:!d,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),n.jsx(Ne,{title:u("node.note.action.shuffle"),onClick:l,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})})]})})]}),n.jsx("div",{ref:w,className:`flex-grow w-full overflow-y-auto custom-scrollbar rounded-md transition-colors ${T?"bg-cyan-900/20 ring-2 ring-cyan-500 ring-inset":"bg-transparent"}`,onDragEnter:$=>{$.preventDefault(),$.stopPropagation(),!t&&re&&P(!0)},onDragOver:$=>{$.preventDefault(),$.stopPropagation()},onDragLeave:$=>{$.preventDefault(),$.stopPropagation(),P(!1),D(!1),A(null)},onDrop:G,onScroll:$=>S($.currentTarget.scrollTop),onWheel:$=>$.stopPropagation(),children:re&&!t?n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-500 cursor-pointer hover:text-gray-400 transition-colors p-4 text-center",onClick:()=>{var $;return($=f.current)==null?void 0:$.click()},children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 mb-2 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),n.jsx("p",{className:"text-sm font-medium",children:u("node.note.dropPlaceholder")}),n.jsx("input",{type:"file",ref:f,className:"hidden",onChange:F,multiple:!0,accept:"image/*"})]}):re&&t?n.jsx("div",{className:"h-full flex flex-col items-center justify-center text-gray-500 p-4 text-center",children:n.jsx("span",{className:"text-sm italic",children:"Waiting for prompt data..."})}):n.jsx("div",{style:{height:V.totalHeight,position:"relative",width:"100%"},children:H.map(({index:$,top:Z,left:te,isAddButton:ae})=>{if(ae)return n.jsxs("div",{className:`absolute bg-gray-800/50 rounded-md border-2 border-dashed flex flex-col gap-2 items-center justify-center cursor-pointer transition-colors ${R?"border-cyan-500 text-cyan-500 bg-cyan-900/20":"border-gray-700 hover:border-cyan-500 hover:text-cyan-500 text-gray-500"}`,style:{width:`${ms}px`,height:`${Kr}px`,top:Z,left:te},onClick:()=>{var J;return(J=f.current)==null?void 0:J.click()},onDragOver:J=>{J.preventDefault(),J.stopPropagation(),D(!0)},onDrop:G,children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),n.jsx("span",{className:"text-xs font-medium",children:"Add Images"}),n.jsx("input",{type:"file",ref:f,className:"hidden",onChange:F,multiple:!0,accept:"image/*"})]},"add-button");const I=e[$];return I?n.jsx(Q3,{id:I.id,index:$,image:I.image,caption:I.caption,manualOrderValue:L[I.id]??($+1).toString(),isLocked:t,isDragging:q===$,isSelected:N===I.id,top:Z,left:te,width:ms,height:Kr,onSelect:j,onDragStart:Y,onDragEnd:ee,onDrop:B,onDragOver:(J,W)=>{t||(J.preventDefault(),J.stopPropagation(),A(W))},onManualOrderChange:(J,W)=>M(U=>({...U,[J]:W})),onManualOrderSubmit:ce,onMove:(J,W)=>{r(J,W==="up"?J-1:J+2)},onMoveToStart:()=>r($,0),onMoveToEnd:()=>r($,e.length),onRemove:i,onCaptionChange:a,onViewImage:ue,onCopyImage:J=>pe(k($)||J),onImageDragStart:(J,W)=>{const U=k($)||W;U&&(J.dataTransfer.setData("application/prompt-modifier-drag-image",U),J.dataTransfer.effectAllowed="copy",J.stopPropagation())},deselectAllNodes:p,isFirst:$===0,isLast:$===e.length-1,insertionIndex:E,t:u},I.id):null})})})]})},tP=({node:e,onValueChange:t,t:o,deselectAllNodes:r,libraryItems:a,setImageViewer:i,addToast:s,setFullSizeImage:l,getFullSizeImage:c,connectedInputs:d,getUpstreamNodeValues:u})=>{const{setConnections:p}=Ut(),h=d==null?void 0:d.has("prompt_data"),x=y.useMemo(()=>{try{const R=JSON.parse(e.value||"{}");return typeof R=="object"&&R!==null&&("text"in R||"references"in R)?{text:R.text||"",references:R.references||[],activeTab:R.activeTab||"note",isMinimal:R.isMinimal||!1}:{text:e.value||"",references:[],activeTab:"note",isMinimal:!1}}catch{return{text:e.value||"",references:[],activeTab:"note",isMinimal:!1}}},[e.value]),[k,C]=y.useState(null),w=y.useCallback(R=>{const D={...x,...R};t(e.id,JSON.stringify(D))},[x,e.id,t]);y.useEffect(()=>{if(h){const D=u(e.id,"prompt_data")[0];if(typeof D=="string")try{const q=JSON.parse(D);if(q.type==="sequence-prompt-data"&&Array.isArray(q.sourcePrompts)){const O=q.sourcePrompts,E=[...x.references],A=[];let N=!1;const j=O.reduce((M,V)=>Math.max(M,V.frameNumber||0),0),L=new Map(O.map(M=>[M.frameNumber,M.prompt]));for(let M=0;M<j;M++){const V=M+1,H=L.get(V)||"",F=E[M];F?F.caption!==H?(A.push({...F,caption:H}),N=!0):A.push(F):(A.push({id:`ref-${Date.now()}-${M}`,image:null,caption:H}),N=!0)}E.length>j&&(N=!0),N&&w({references:A})}}catch(q){console.error("Failed to parse prompt data from sequence editor",q)}}},[h,u,e.id,w,x.references]);const f=()=>{p(R=>R.filter(D=>!(D.toNodeId===e.id&&D.toHandleId==="prompt_data"))),s&&s(o("toast.connectionsCut"))},g=async(R,D)=>{if(h)return;const q=async L=>typeof L=="string"?L:new Promise(M=>{const V=new FileReader;V.onload=H=>{var F;return M((F=H.target)==null?void 0:F.result)},V.readAsDataURL(L)}),O=await Promise.all(R.map(q)),E=[...x.references],A=[];for(let L=0;L<O.length;L++){const M=O[L],V=await Lt(M,256,256);A.push({id:`ref-${Date.now()}-${L}-${Math.random().toString(36).substr(2,9)}`,image:V,caption:""})}const N=D??E.length;E.splice(N,0,...A);const j=new Map;x.references.forEach((L,M)=>{const V=c(e.id,M);V?j.set(L.id,V):L.image&&j.set(L.id,L.image)}),A.forEach((L,M)=>{j.set(L.id,O[M])}),w({references:E,activeTab:"reference"}),E.forEach((L,M)=>{const V=j.get(L.id);V&&l(e.id,M,V)})},v=(R,D)=>{if(R===D||h)return;const q=[...x.references],[O]=q.splice(R,1),E=R<D?D-1:D;q.splice(E,0,O);const A=[];for(let j=0;j<x.references.length;j++)A.push(c(e.id,j)||x.references[j].image);const[N]=A.splice(R,1);A.splice(E,0,N),A.forEach((j,L)=>{l(e.id,L,j)}),w({references:q})},_=(R,D)=>{if(h)return;const q=x.references.map(O=>O.id===R?{...O,caption:D}:O);w({references:q})},S=R=>{if(h)return;const D=x.references.findIndex(O=>O.id===R);if(D===-1)return;const q=x.references.filter(O=>O.id!==R);for(let O=D;O<q.length;O++){const E=c(e.id,O+1);if(E)l(e.id,O,E);else{const A=x.references[O+1];A&&A.image&&l(e.id,O,A.image)}}w({references:q})},T=()=>{if(h)return;C([...x.references]);const R=new Map;x.references.forEach((q,O)=>{const E=c(e.id,O)||q.image;E&&R.set(q.id,E)});const D=[...x.references];for(let q=D.length-1;q>0;q--){const O=Math.floor(Math.random()*(q+1));[D[q],D[O]]=[D[O],D[q]]}w({references:D}),D.forEach((q,O)=>{const E=R.get(q.id);E&&l(e.id,O,E)})},P=()=>{if(!k||h)return;const R=new Map;x.references.forEach((D,q)=>{const O=c(e.id,q)||D.image;O&&R.set(D.id,O)}),k.forEach((D,q)=>{const O=R.get(D.id);O&&l(e.id,q,O)}),w({references:k}),C(null)};return n.jsxs("div",{className:"flex flex-col h-full",children:[!x.isMinimal&&n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-900/50 p-1 rounded-t-md mb-1 flex-shrink-0",children:[n.jsx("button",{onClick:()=>w({activeTab:"note"}),className:`flex-1 py-1 text-xs font-semibold rounded transition-colors ${x.activeTab==="note"?"bg-cyan-600 text-white":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:o("node.note.tab.note")}),n.jsxs("button",{onClick:()=>w({activeTab:"reference"}),className:`flex-1 py-1 text-xs font-semibold rounded transition-colors ${x.activeTab==="reference"?"bg-cyan-600 text-white":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:[o("node.note.tab.references"),x.references.length>0&&n.jsxs("span",{className:"ml-1 opacity-75",children:["(",x.references.length,")"]})]})]}),n.jsx("div",{className:"flex-grow min-h-0 relative",children:x.activeTab==="note"?n.jsx(Z3,{text:x.text,onTextChange:R=>w({text:R}),libraryItems:a,t:o,deselectAllNodes:r,isMinimal:!!x.isMinimal}):n.jsx(eP,{references:x.references,isLocked:!!h,onAddImages:g,onReorder:v,onUpdateCaption:_,onRemoveReference:S,onDetach:f,onShuffle:T,onUndoShuffle:P,canUndoShuffle:!!k,t:o,deselectAllNodes:r,setImageViewer:i,addToast:s,getFullSizeImage:R=>c(e.id,R),setFullSizeImage:(R,D)=>l(e.id,R,D),isMinimal:!!x.isMinimal})})]})},nP=()=>null,Dg={en:{subjects:["a majestic lion","a futuristic robot","a wise old wizard","a curious alien","a brave knight","a mythical dragon","a cyberpunk detective","a goddess of nature","a talking squirrel","an ancient golem","a pirate captain","a stealthy ninja","a lonely astronaut","a phantom queen","a clockwork beast"],objects:["a glowing crystal","an enchanted sword","a rusty key","a mysterious book","a floating lantern","a time-traveling watch","a powerful artifact","a forgotten map","a steampunk airship","a magical potion","a shard of a fallen star","the crown of a forgotten king"],actions:["exploring a hidden cave","casting a powerful spell","flying through the clouds","solving a complex puzzle","standing on a cliff edge","sailing across a stormy sea","building a futuristic city","meditating in a peaceful forest","leading an army into battle","discovering a lost secret","dancing in the moonlight"],environments:["in a neon-lit cyberpunk city","in an enchanted forest at night","on a volcanic planet","in a lost underwater city","in a grand, gothic castle","in a tranquil zen garden","on a floating island in the sky","in a post-apocalyptic wasteland","inside a massive spaceship","at the edge of a black hole","in a victorian-era library"]},ru:{subjects:[" "," ","  "," "," "," ","-"," "," "," "," "," "," ","-"," "],objects:[" "," "," "," "," ","    "," "," ","-"," ","  ","  "],actions:["  ","  ","  ","  ","   ","   ","  ","   ","   ","  ","   "],environments:["  -","   ","  ","   ","   ","  -","    ","  ","   ","   ","   "]},uz:{subjects:["ulugvor sher","futuristik robot","dono keksa sehrgar","qiziquvchan ozga sayyoralik","jasur ritsar","afsonaviy ajdaho","kiberpank detektiv","tabiat mabudasi","gapiruvchi sincap","qadimiy golem","qaroqchi kapitan","yashirin ninja","yolgiz astronavt","fantom malika","mexanik yirtqich"],objects:["porlayotgan kristall","sehrlangan qilich","zanglagan kalit","sirli kitob","uchuvchi chiroq","vaqt sayohati soati","qudratli artefakt","unutilgan xarita","stimpank havo kemasi","sehrli damlama","qulagan yulduz parchasi","unutilgan qirol toji"],actions:["yashirin gorni organmoqda","kuchli sehr oqimoqda","bulutlar orasidan uchmoqda","murakkab jumboqni yechmoqda","jarlik chetida turibdi","boronli dengizda suzmoqda","futuristik shahar qurmoqda","tinch ormonda meditatsiya qilmoqda","armiyani jangga boshlamoqda","yoqolgan sirni ochmoqda","oy nuri ostida raqsga tushmoqda"],environments:["neon chiroqli kiberpank shaharda","tunda sehrlangan ormonda","vulqonli sayyorada","yoqolgan suv osti shahrida","hashamatli gotik qasrda","tinch dzen bogida","osmondagi uchuvchi orolda","post-apokaliptik cholda","ulkan kosmik kema ichida","qora tuynuk chetida","viktoriya davri kutubxonasida"]},es:{subjects:["un len majestuoso","un robot futurista","un viejo mago sabio","un aliengena curioso","un caballero valiente","un dragn mtico","un detective cyberpunk","una diosa de la naturaleza","una ardilla parlante","un glem antiguo","un capitn pirata","un ninja sigiloso","un astronauta solitario","una reina fantasma","una bestia de relojera"],objects:["un cristal brillante","una espada encantada","una llave oxidada","un libro misterioso","una linterna flotante","un reloj para viajar en el tiempo","un artefacto poderoso","un mapa olvidado","una aeronave steampunk","una pocin mgica","un fragmento de estrella cada","la corona de un rey olvidado"],actions:["explorando una cueva oculta","lanzando un hechizo poderoso","volando a travs de las nubes","resolviendo un rompecabezas complejo","de pie en el borde de un acantilado","navegando por un mar tormentoso","construyendo una ciudad futurista","meditando en un bosque tranquilo","liderando un ejrcito a la batalla","descubriendo un secreto perdido","bailando a la luz de la luna"],environments:["en una ciudad cyberpunk iluminada por nen","en un bosque encantado de noche","en un planeta volcnico","en una ciudad submarina perdida","en un gran castillo gtico","en un tranquilo jardn zen","en una isla flotante en el cielo","en un pramo post-apocalptico","dentro de una nave espacial masiva","en el borde de un agujero negro","en una biblioteca de la era victoriana"]},fr:{subjects:["un lion majestueux","un robot futuriste","un vieux sorcier sage","un extraterrestre curieux","un chevalier courageux","un dragon mythique","un dtective cyberpunk","une desse de la nature","un cureuil parlant","un golem ancien","un capitaine pirate","un ninja furtif","un astronaute solitaire","une reine fantme","une bte mcanique"],objects:["un cristal brillant","une pe enchante","une cl rouille","un livre mystrieux","une lanterne flottante","une montre de voyage dans le temps","un artefact puissant","une carte oublie","un dirigeable steampunk","une potion magique","un clat d'toile tombe","la couronne d'un roi oubli"],actions:["explore une grotte cache","lance un sort puissant","vole  travers les nuages","rsout un puzzle complexe","se tient au bord d'une falaise","navigue sur une mer dchane","construit une ville futuriste","mdite dans une fort paisible","mne une arme au combat","dcouvre un secret perdu","danse au clair de lune"],environments:["dans une ville cyberpunk claire au non","dans une fort enchante la nuit","sur une plante volcanique","dans une cit sous-marine perdue","dans un grand chteau gothique","dans un jardin zen tranquille","sur une le flottante dans le ciel","dans un dsert post-apocalyptique"," l'intrieur d'un immense vaisseau spatial","au bord d'un trou noir","dans une bibliothque de l'poque victorienne"]},de:{subjects:["ein majesttischer Lwe","ein futuristischer Roboter","ein weiser alter Zauberer","ein neugieriges Alien","ein tapferer Ritter","ein mythischer Drache","ein Cyberpunk-Detektiv","eine Gttin der Natur","ein sprechendes Eichhrnchen","ein alter Golem","ein Piratenkapitn","ein heimlicher Ninja","ein einsamer Astronaut","eine Phantomknigin","ein Uhrwerk-Biest"],objects:["ein leuchtender Kristall","ein verzaubertes Schwert","ein rostiger Schlssel","ein geheimnisvolles Buch","eine schwebende Laterne","eine Zeitreiseuhr","ein mchtiges Artefakt","eine vergessene Karte","ein Steampunk-Luftschiff","ein Zaubertrank","ein Splitter eines gefallenen Sterns","die Krone eines vergessenen Knigs"],actions:["erkundet eine versteckte Hhle","wirkt einen mchtigen Zauber","fliegt durch die Wolken","lst ein komplexes Rtsel","steht am Rand einer Klippe","segelt ber ein strmisches Meer","baut eine futuristische Stadt","meditiert in einem friedlichen Wald","fhrt eine Armee in die Schlacht","entdeckt ein verlorenes Geheimnis","tanzt im Mondlicht"],environments:["in einer neonbeleuchteten Cyberpunk-Stadt","in einem verzauberten Wald bei Nacht","auf einem vulkanischen Planeten","in einer verlorenen Unterwasserstadt","in einem groen gotischen Schloss","in einem ruhigen Zen-Garten","auf einer schwebenden Insel im Himmel","in einem postapokalyptischen dland","in einem riesigen Raumschiff","am Rande eines schwarzen Lochs","in einer Bibliothek der viktorianischen ra"]},it:{subjects:["un leone maestoso","un robot futuristico","un vecchio mago saggio","un alieno curioso","un cavaliere coraggioso","un drago mitico","un detective cyberpunk","una dea della natura","uno scoiattolo parlante","un antico golem","un capitano pirata","un ninja furtivo","un astronauta solitario","una regina fantasma","una bestia a orologeria"],objects:["un cristallo luminoso","una spada incantata","una chiave arrugginita","un libro misterioso","una lanterna fluttuante","un orologio per viaggiare nel tempo","un artefatto potente","una mappa dimenticata","un dirigibile steampunk","una pozione magica","una scheggia di una stella caduta","la corona di un re dimenticato"],actions:["esplora una grotta nascosta","lancia un potente incantesimo","vola attraverso le nuvole","risolve un enigma complesso","sta sul bordo di una scogliera","naviga attraverso un mare in tempesta","costruisce una citt futuristica","medita in una foresta tranquilla","guida un esercito in battaglia","scopre un segreto perduto","balla al chiaro di luna"],environments:["in una citt cyberpunk illuminata al neon","in una foresta incantata di notte","su un pianeta vulcanico","in una citt sottomarina perduta","in un grande castello gotico","in un tranquillo giardino zen","su un'isola fluttuante nel cielo","in una terra desolata post-apocalittica","all'interno di un'enorme astronave","ai margini di un buco nero","in una biblioteca di epoca vittoriana"]},pt:{subjects:["um leo majestoso","um rob futurista","um velho mago sbio","um aliengena curioso","um cavaleiro corajoso","um drago mtico","um detetive cyberpunk","uma deusa da natureza","um esquilo falante","um golem antigo","um capito pirata","um ninja furtivo","um astronauta solitrio","uma rainha fantasma","uma besta mecnica"],objects:["um cristal brilhante","uma espada encantada","uma chave enferrujada","um livro misterioso","uma lanterna flutuante","um relgio de viagem no tempo","um artefato poderoso","um mapa esquecido","um dirigvel steampunk","uma poo mgica","um fragmento de uma estrela cada","a coroa de um rei esquecido"],actions:["explorando uma caverna escondida","lanando um feitio poderoso","voando atravs das nuvens","resolvendo um quebra-cabea complexo","de p na beira de um penhasco","navegando por um mar tempestuoso","construindo uma cidade futurista","meditando em uma floresta pacfica","liderando um exrcito para a batalha","descobrindo um segredo perdido","danando ao luar"],environments:["em uma cidade cyberpunk iluminada por neon","em uma floresta encantada  noite","em um planeta vulcnico","em uma cidade subaqutica perdida","em um grande castelo gtico","em um jardim zen tranquilo","em uma ilha flutuante no cu","em um terreno baldio ps-apocalptico","dentro de uma enorme nave espacial","na borda de um buraco negro","em uma biblioteca da era vitoriana"]},zh:{subjects:["","","","","","","","","","","","","","",""],objects:["","","","","","","","","","","",""],actions:["","","","","","","","","","",""],environments:["","","","","","","","","","",""]},ja:{subjects:["","","","","","","","","","","","","","",""],objects:["","","","","","","","","","","",""],actions:["","","","","","","","","","",""],environments:["","","","","","","","","","",""]},ko:{subjects:["  "," ","  ","  "," ","  "," "," "," "," "," "," "," "," "," "],objects:[" ","  "," "," "," ","  "," "," "," "," ","  ","  "],actions:["   ","   ","   ","   ","   ","    ","   ","   ","   ","   ","    "],environments:["    ","  "," ","  ","  ","  ","   ","  ","  "," ","  "]}},U1=e=>{const t=Dg[e]||Dg.en,o=Object.keys(t),r=o[Math.floor(Math.random()*o.length)],a=t[r];return a[Math.floor(Math.random()*a.length)]},qn=({children:e,content:t,isActive:o,position:r="top",pulseColor:a="rgba(34, 211, 238, 0.8)",className:i="",onSkip:s,onNext:l,isFinishStep:c=!1})=>{const{t:d}=vt();if(!o)return n.jsx(n.Fragment,{children:e});const u={top:"bottom-full left-1/2 -translate-x-1/2 mb-3",bottom:"top-full left-1/2 -translate-x-1/2 mt-3",left:"right-full top-1/2 -translate-y-1/2 mr-3",right:"left-full top-1/2 -translate-y-1/2 ml-3"},p={top:"top-full left-1/2 -translate-x-1/2 border-t-cyan-900",bottom:"bottom-full left-1/2 -translate-x-1/2 border-b-cyan-900",left:"left-full top-1/2 -translate-y-1/2 border-l-cyan-900",right:"right-full top-1/2 -translate-y-1/2 border-r-cyan-900"};return n.jsxs("div",{className:`relative inline-flex ${i}`,style:{zIndex:1e3},children:[n.jsx("div",{className:"absolute inset-0 rounded-md pointer-events-none tutorial-ring",style:{boxShadow:`0 0 0 0 ${a}`}}),e,n.jsx("div",{className:`absolute ${u[r]} z-[1001] w-max max-w-[250px] pointer-events-auto`,children:n.jsxs("div",{className:"bg-cyan-900 border border-cyan-500 text-white text-xs font-bold px-3 py-2 rounded-lg shadow-2xl relative animate-bounce-gentle",children:[n.jsx("div",{className:"mb-2",children:t}),n.jsxs("div",{className:"flex justify-end border-t border-cyan-700/50 pt-1 mt-1 gap-2",children:[l&&n.jsx("button",{onClick:h=>{h.stopPropagation(),l()},className:"text-[10px] text-cyan-300 hover:text-white underline decoration-cyan-500/50 hover:decoration-white transition-all",children:d("tutorial.next")}),s&&n.jsx("button",{onClick:h=>{h.stopPropagation(),s()},className:"text-[10px] text-gray-400 hover:text-white underline decoration-gray-500/50 hover:decoration-white transition-all",children:d(c?"tutorial.finish":"tutorial.skip")})]}),n.jsx("div",{className:`absolute border-4 border-transparent ${p[r]}`})]})})]})},oP=({node:e,onValueChange:t,libraryItems:o,t:r,onSelectNode:a})=>{const{language:i}=vt(),s=Ut(),{tutorialStep:l,tutorialTargetId:c,advanceTutorial:d,skipTutorial:u}=s||{},p=c===e.id&&(l==="text_input_0"||l==="text_input_1"||l==="text_input_2"),h=()=>{const x=U1(i),k=e.value?`${e.value}, ${x}`:x;t(e.id,k),p&&d&&d()};return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex items-center mb-1 flex-shrink-0 space-x-2",children:[n.jsx("div",{className:"flex-grow",children:n.jsx(jp,{libraryItems:o,onPromptInsert:x=>{const k=e.value?`${e.value}, ${x}`:x;t(e.id,k)}})}),n.jsx(qn,{content:r("tutorial.step1"),isActive:!!p,position:"left",onSkip:u,children:n.jsx(Ne,{title:r("node.action.randomWord"),onClick:h,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})})})]}),n.jsx("div",{className:"flex-grow min-h-0",children:n.jsx(hn,{value:e.value,onDebouncedChange:x=>t(e.id,x),placeholder:r("node.content.notePlaceholder"),className:"w-full h-full p-2 bg-input border border-transparent rounded-md resize-none focus:border-accent focus:outline-none",onWheel:x=>x.stopPropagation(),onMouseDown:x=>{x.stopPropagation(),a()}})})]})};let rP=500;const _l=()=>++rP,aP=({onClose:e,onPointerDown:t,onPointerMove:o,onPointerUp:r})=>{const{t:a}=vt();return n.jsxs("div",{onPointerDown:t,onPointerMove:o,onPointerUp:r,className:"p-3 border-b border-gray-700 flex justify-between items-center cursor-move bg-gray-900 select-none",children:[n.jsxs("h2",{className:"text-lg font-bold text-cyan-400 flex items-center gap-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),a("imageEditor.title")]}),n.jsx("button",{onClick:e,className:"p-1 text-gray-400 rounded-full hover:bg-gray-600 hover:text-white transition-colors",onPointerDown:i=>i.stopPropagation(),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})},Mn=({options:e,value:t,onChange:o,disabled:r,id:a,title:i})=>{const[s,l]=y.useState(!1),[c,d]=y.useState(-1),u=y.useRef(null),p=y.useRef([]),h=e.find(w=>w.value===t),x=(h==null?void 0:h.label)||t;y.useEffect(()=>{const w=f=>{u.current&&!u.current.contains(f.target)&&l(!1)};return document.addEventListener("mousedown",w,!0),()=>document.removeEventListener("mousedown",w,!0)},[]),y.useEffect(()=>{if(s){const w=e.findIndex(f=>f.value===t);d(w>-1?w:0),setTimeout(()=>{var f;return(f=p.current[w>-1?w:0])==null?void 0:f.focus()},0)}},[s,e,t]);const k=w=>{var f,g;switch(w.key){case"ArrowDown":if(w.preventDefault(),!s)l(!0);else{const v=Math.min(c+1,e.length-1);d(v),(f=p.current[v])==null||f.focus()}break;case"ArrowUp":if(w.preventDefault(),s){const v=Math.max(c-1,0);d(v),(g=p.current[v])==null||g.focus()}break;case"Enter":case" ":w.preventDefault(),s&&c!==-1?(o(e[c].value),l(!1)):l(!s);break;case"Escape":l(!1);break;case"Tab":l(!1);break}},C=w=>{o(w),l(!1)};return n.jsxs("div",{ref:u,className:"relative w-full",title:i,children:[n.jsxs("button",{id:a,disabled:r,onClick:()=>l(!s),onKeyDown:k,type:"button","aria-haspopup":"listbox","aria-expanded":s,className:"w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed flex justify-between items-center text-left group",children:[n.jsxs("span",{className:"truncate flex items-center gap-2",children:[(h==null?void 0:h.icon)&&n.jsx("span",{className:"text-gray-400",children:h.icon}),x]}),n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 transition-transform duration-200 flex-shrink-0 ml-1 ${s?"transform rotate-180":""}`,viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),s&&n.jsx("ul",{role:"listbox",className:"absolute z-10 w-full mt-1 bg-gray-700 border border-gray-600 rounded-md shadow-lg focus:outline-none",children:e.map((w,f)=>n.jsxs("li",{ref:g=>{p.current[f]=g},tabIndex:-1,role:"option","aria-selected":t===w.value,onClick:()=>C(w.value),onKeyDown:k,className:`p-2 text-sm cursor-pointer select-none transition-colors flex items-center gap-2 group ${c===f?"bg-cyan-600 text-white":"text-gray-200 hover:bg-gray-600"} ${t===w.value?"font-semibold":""}`,children:[w.icon&&n.jsx("span",{className:`${c===f?"text-white":"text-gray-400 group-hover:text-gray-200"}`,children:w.icon}),n.jsx("span",{children:w.label})]},w.value))})]})},Mo=({title:e,onClick:t,active:o,icon:r,tooltipPosition:a="right"})=>n.jsxs("div",{className:"relative group flex items-center justify-center",children:[n.jsx("button",{onClick:t,className:`w-10 h-10 rounded-md flex items-center justify-center border transition-all ${o?"bg-cyan-600/20 border-cyan-500 text-cyan-400 shadow-[0_0_10px_rgba(34,211,238,0.2)]":"bg-gray-700 border-gray-600 text-gray-400 hover:bg-gray-600 hover:text-gray-200"}`,children:r}),n.jsx("div",{className:`absolute ${a==="right"?"left-full top-1/2 -translate-y-1/2 ml-2":"top-full left-1/2 -translate-x-1/2 mt-2"} px-3 py-1.5 bg-slate-700 text-slate-200 text-xs whitespace-nowrap rounded-md shadow-xl opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50`,children:e})]}),zg=({title:e,onClick:t,disabled:o,children:r,className:a})=>n.jsxs("div",{className:"relative group flex-1 flex",children:[n.jsx("button",{onClick:t,disabled:o,className:`w-full px-2 py-1.5 text-xs font-semibold rounded transition-colors flex items-center justify-center gap-2 ${a}`,children:r}),n.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-xs whitespace-normal text-center w-40 rounded-md shadow-xl opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 break-words",children:e})]}),iP=({resolution:e,setResolution:t,aspectRatio:o,setAspectRatio:r,backgroundType:a,setBackgroundType:i,activeTool:s,isSnappingEnabled:l,setIsSnappingEnabled:c,isFreeAspect:d,setIsFreeAspect:u,brushSize:p,setBrushSize:h,modificationPrompt:x,setModificationPrompt:k,isProcessing:C,handleRequestModification:w,handleRemoveObject:f,handleRemoveBackground:g,canvasSize:v})=>{const{t:_}=vt(),S=y.useMemo(()=>[{value:"auto",label:"Auto (Fit Image)",type:"auto"},{value:"1920x1080",label:"1920x1080",type:"landscape"},{value:"1080x1920",label:"1080x1920",type:"portrait"},{value:"512x512",label:"512x512",type:"square"},{value:"1024x1024",label:"1024x1024",type:"square"},{value:"2048x2048",label:"2048x2048",type:"square"},{value:"4096x4096",label:"4096x4096",type:"square"}].map(R=>{let D;switch(R.type){case"landscape":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"2",y:"7",width:"20",height:"10",rx:"1"})});break;case"portrait":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"7",y:"2",width:"10",height:"20",rx:"1"})});break;case"square":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"1"})});break;case"auto":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})});break}return{value:R.value,label:R.label,icon:D}}),[]),T=y.useMemo(()=>[{value:"free",label:"Free",type:"free"},{value:"16:9",label:"16:9",type:"landscape"},{value:"9:16",label:"9:16",type:"portrait"},{value:"4:3",label:"4:3",type:"landscape_slight"},{value:"3:4",label:"3:4",type:"portrait_slight"},{value:"1:1",label:"1:1",type:"square"}].map(R=>{let D;switch(R.type){case"free":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})});break;case"landscape":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"2",y:"8",width:"20",height:"8",rx:"1"})});break;case"portrait":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"8",y:"2",width:"10",height:"20",rx:"1"})});break;case"landscape_slight":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"3",y:"6",width:"18",height:"12",rx:"1"})});break;case"portrait_slight":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"6",y:"3",width:"12",height:"18",rx:"1"})});break;case"square":D=n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"5",y:"5",width:"14",height:"14",rx:"1"})});break}return{value:R.value,label:R.label,icon:D}}),[]);return n.jsxs("div",{className:"w-64 p-4 border-r border-gray-700 flex-shrink-0 flex flex-col bg-gray-800 overflow-y-auto overflow-x-hidden custom-scrollbar select-none",onWheel:P=>P.stopPropagation(),children:[n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wider",children:_("imageEditor.canvasResolution")}),n.jsx(Mn,{value:e,onChange:t,options:S}),n.jsxs("p",{className:"text-[10px] text-gray-500 mt-1 text-right",children:[v.width," x ",v.height," px"]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wider",children:_("node.content.aspectRatio")}),n.jsx(Mn,{value:o,onChange:r,options:T,disabled:e!=="auto"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wider",children:_("imageEditor.background")}),n.jsxs("div",{className:"flex space-x-2 bg-gray-900/50 p-2 rounded-md border border-gray-600 justify-between items-center",children:[n.jsx("button",{onClick:()=>i("checkerboard"),className:`w-6 h-6 rounded border border-gray-500 focus:outline-none transition-transform hover:scale-110 overflow-hidden ${a==="checkerboard"?"ring-2 ring-cyan-500 scale-110":""}`,title:"Checkerboard (Transparent)",children:n.jsx("div",{className:"w-full h-full bg-[url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAIklEQVQYV2NkYGD4z8DAwMgwMoyCQAwMDAwMjAyDQAwM4wA+2wz/m6j50AAAAABJRU5ErkJggg==')]"})}),["#ffffff","#808080","#000000","#1f2937"].map(P=>n.jsx("button",{onClick:()=>i(P),className:`w-6 h-6 rounded-full border border-gray-500 focus:outline-none transition-transform hover:scale-110 ${a===P?"ring-2 ring-cyan-500 scale-110":""}`,style:{backgroundColor:P}},P)),n.jsx("input",{type:"color",value:a!=="checkerboard"?a:"#ffffff",onChange:P=>i(P.target.value),className:"w-6 h-6 p-0 rounded-full border-none overflow-hidden cursor-pointer"})]})]})]}),s==="transform"&&n.jsxs("div",{className:"mt-4 space-y-2",children:[n.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2",children:_("imageEditor.toolSettings")}),n.jsxs("div",{className:"bg-gray-700/50 p-2 rounded space-y-2",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("input",{type:"checkbox",id:"snap-toggle",checked:l,onChange:P=>c(P.target.checked),className:"h-4 w-4 rounded border-gray-500 text-accent focus:ring-accent cursor-pointer"}),n.jsx("label",{htmlFor:"snap-toggle",className:"text-xs text-gray-300 cursor-pointer select-none",children:_("imageEditor.snapToEdges")})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("input",{type:"checkbox",id:"free-aspect-toggle",checked:d,onChange:P=>u(P.target.checked),className:"h-4 w-4 rounded border-gray-500 text-accent focus:ring-accent cursor-pointer"}),n.jsx("label",{htmlFor:"free-aspect-toggle",className:"text-xs text-gray-300 cursor-pointer select-none",children:_("imageEditor.freeAspect")})]})]})]}),(s==="pencil"||s==="rectangle")&&n.jsxs("div",{className:"mt-4 space-y-2",children:[n.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-2 uppercase tracking-wider",children:"Brush Settings"}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("span",{className:"text-xs text-gray-400 w-8",children:"Size"}),n.jsx("input",{type:"range",min:"1",max:"50",value:p,onChange:P=>h(Number(P.target.value)),className:"flex-grow h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-500"}),n.jsx("span",{className:"text-xs text-gray-300 w-6 text-right",children:p})]})]}),n.jsx("div",{className:"flex-grow"}),n.jsxs("div",{className:"space-y-4 mt-4 border-t border-gray-700 pt-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2",children:_("imageEditor.section.aiRequest")}),n.jsx("textarea",{value:x,onChange:P=>k(P.target.value),placeholder:_("imageEditor.input.modificationPlaceholder"),className:"w-full p-2 bg-gray-900/50 border border-gray-600 rounded-md text-xs text-white focus:ring-2 focus:ring-cyan-500 focus:outline-none resize-none select-text",rows:3}),n.jsx("button",{onClick:w,disabled:C||!x.trim(),className:"w-full px-3 py-1.5 text-xs font-bold text-white bg-cyan-600 rounded hover:bg-cyan-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors",children:C?"Processing...":_("imageEditor.action.sendRequest")})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(zg,{title:_("imageEditor.tooltip.removeObject"),onClick:f,disabled:C,className:"text-white bg-red-600 hover:bg-red-700 border border-red-500 shadow-[0_0_15px_rgba(220,38,38,0.4)] disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none",children:C?"...":_("imageEditor.action.removeObject")}),n.jsx(zg,{title:"Remove background keeping main object",onClick:g,disabled:C,className:"text-white bg-teal-600 hover:bg-teal-700 border border-teal-500 shadow-[0_0_15px_rgba(13,148,136,0.4)] disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none",children:C?"...":_("imageEditor.action.removeBackground")})]})]})]})},sP=({activeTool:e,setActiveTool:t,onFit:o,onFill:r,onFlip:a})=>{const{t:i}=vt();return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"absolute top-4 left-4 flex flex-col gap-2 z-20 bg-gray-900/80 backdrop-blur-sm p-1.5 rounded-lg border border-gray-700 shadow-lg",children:[n.jsx(Mo,{title:i("imageEditor.tool.transform"),onClick:()=>t("transform"),active:e==="transform",icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),n.jsx(Mo,{title:i("imageEditor.tool.hand"),onClick:()=>t("hand"),active:e==="hand",icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11"})})}),n.jsx(Mo,{title:i("imageEditor.tool.zoom"),onClick:()=>t("zoom"),active:e==="zoom",icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7"})})}),n.jsx("div",{className:"w-full h-px bg-gray-700 my-1"}),n.jsx(Mo,{title:i("imageEditor.tool.pencil"),onClick:()=>t("pencil"),active:e==="pencil",icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),n.jsx(Mo,{title:i("imageEditor.tool.rectangle"),onClick:()=>t("rectangle"),active:e==="rectangle",icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"})})}),n.jsx(Mo,{title:"Eyedropper",onClick:()=>t("eyedropper"),active:e==="eyedropper",icon:n.jsx(K3,{className:"h-5 w-5"})})]}),n.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 flex gap-2 z-20 bg-gray-900/80 backdrop-blur-sm p-1.5 rounded-lg border border-gray-700 shadow-lg",children:[n.jsx(Mo,{title:i("imageEditor.action.fit"),onClick:o,icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5M15 15l5.25 5.25"})}),tooltipPosition:"bottom"}),n.jsx(Mo,{title:i("imageEditor.action.fill"),onClick:r,icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"})}),tooltipPosition:"bottom"}),n.jsx(Mo,{title:i("node.action.flipImage"),onClick:a,icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5"})}),tooltipPosition:"bottom"})]})]})},lP=({zoom:e,onZoomChange:t,onClose:o,onReset:r,onApply:a,isProcessing:i})=>{const{t:s}=vt();return n.jsxs("div",{className:"p-3 border-t border-gray-700 flex justify-between items-center bg-gray-900 gap-3 select-none",children:[n.jsx("div",{className:"flex items-center space-x-4",children:n.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-400",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),n.jsxs("span",{className:"w-12 text-right",children:[Math.round(e*100),"%"]}),n.jsx("input",{type:"range",min:"0.1",max:"4",step:"0.1",value:e,onChange:t,className:"w-32 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]})}),n.jsxs("div",{className:"flex space-x-3 items-center",children:[n.jsx("button",{onClick:o,className:"px-4 py-2 text-sm font-semibold text-gray-300 bg-gray-800 rounded-md hover:bg-gray-700 transition-colors border border-gray-600",children:s("imageEditor.action.cancel")}),n.jsx("button",{onClick:r,className:"px-4 py-2 text-sm font-semibold text-red-200 bg-red-900/30 rounded-md hover:bg-red-900/50 border border-red-900/50 transition-colors",children:s("imageEditor.action.resetEdits")}),n.jsx("button",{onClick:a,disabled:i,className:"px-6 py-2 text-sm font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 transition-colors shadow-lg shadow-cyan-900/20 disabled:opacity-50 disabled:cursor-not-allowed",children:s("imageEditor.action.apply")})]})]})},Yr=e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:0,g:0,b:0}},cP=(e,t,o)=>"#"+((1<<24)+(e<<16)+(t<<8)+o).toString(16).slice(1),Jc=(e,t,o)=>{e/=255,t/=255,o/=255;const r=Math.max(e,t,o),a=Math.min(e,t,o);let i=0,s,l=r;const c=r-a;if(s=r===0?0:c/r,r===a)i=0;else{switch(r){case e:i=(t-o)/c+(t<o?6:0);break;case t:i=(o-e)/c+2;break;case o:i=(e-t)/c+4;break}i/=6}return{h:i*360,s,v:l}},dP=(e,t,o)=>{let r=0,a=0,i=0;const s=Math.floor(e*6),l=e*6-s,c=o*(1-t),d=o*(1-l*t),u=o*(1-(1-l)*t);switch(s%6){case 0:r=o,a=u,i=c;break;case 1:r=d,a=o,i=c;break;case 2:r=c,a=o,i=u;break;case 3:r=c,a=d,i=o;break;case 4:r=u,a=c,i=o;break;case 5:r=o,a=c,i=d;break}return{r:Math.round(r*255),g:Math.round(a*255),b:Math.round(i*255)}},uP=({color:e,onChange:t})=>{const[o,r]=y.useState({h:0,s:1,v:1}),[a,i]=y.useState(e),s=y.useRef(null),l=y.useRef(null),c=y.useRef(!1),d=y.useRef(!1);y.useEffect(()=>{const f=Yr(e);r(Jc(f.r,f.g,f.b)),i(e)},[e]);const u=(f,g,v)=>{const _=dP(f/360,g,v),S=cP(_.r,_.g,_.b);t(S),r({h:f,s:g,v}),i(S)},p=y.useCallback(()=>{const f=s.current;if(!f)return;const g=f.getContext("2d");if(!g)return;const v=f.width,_=f.height;g.clearRect(0,0,v,_),g.fillStyle=`hsl(${o.h}, 100%, 50%)`,g.fillRect(0,0,v,_);const S=g.createLinearGradient(0,0,v,0);S.addColorStop(0,"rgba(255,255,255,1)"),S.addColorStop(1,"rgba(255,255,255,0)"),g.fillStyle=S,g.fillRect(0,0,v,_);const T=g.createLinearGradient(0,0,0,_);T.addColorStop(0,"rgba(0,0,0,0)"),T.addColorStop(1,"rgba(0,0,0,1)"),g.fillStyle=T,g.fillRect(0,0,v,_);const P=o.s*v,R=(1-o.v)*_;g.beginPath(),g.arc(P,R,6,0,Math.PI*2),g.strokeStyle="white",g.lineWidth=2,g.stroke(),g.beginPath(),g.arc(P,R,4,0,Math.PI*2),g.strokeStyle="black",g.lineWidth=1,g.stroke()},[o]),h=y.useCallback(()=>{const f=l.current;if(!f)return;const g=f.getContext("2d");if(!g)return;const v=f.width,_=f.height;g.clearRect(0,0,v,_);const S=g.createLinearGradient(0,0,v,0);S.addColorStop(0,"#ff0000"),S.addColorStop(1/6,"#ffff00"),S.addColorStop(2/6,"#00ff00"),S.addColorStop(3/6,"#00ffff"),S.addColorStop(4/6,"#000000"),S.addColorStop(4/6,"#0000ff"),S.addColorStop(5/6,"#ff00ff"),S.addColorStop(1,"#ff0000"),g.fillStyle=S,g.fillRect(0,0,v,_);const T=o.h/360*v;g.fillStyle="white",g.fillRect(T-2,0,4,_),g.strokeStyle="black",g.lineWidth=1,g.strokeRect(T-2,0,4,_)},[o.h]);y.useEffect(()=>{p()},[p]),y.useEffect(()=>{h()},[h]);const x=f=>{const g=s.current;if(!g)return;const v=g.getBoundingClientRect(),_=Math.max(0,Math.min(v.width,f.clientX-v.left)),S=Math.max(0,Math.min(v.height,f.clientY-v.top)),T=_/v.width,P=1-S/v.height;u(o.h,T,P)},k=f=>{const g=l.current;if(!g)return;const v=g.getBoundingClientRect(),S=Math.max(0,Math.min(v.width,f.clientX-v.left))/v.width*360;u(S,o.s,o.v)};y.useEffect(()=>{const f=P=>{c.current&&x(P),d.current&&k(P)},g=()=>{c.current=!1,d.current=!1,window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",g)},v=P=>{c.current=!0,x(P),window.addEventListener("mousemove",f),window.addEventListener("mouseup",g)},_=P=>{d.current=!0,k(P),window.addEventListener("mousemove",f),window.addEventListener("mouseup",g)},S=s.current,T=l.current;return S&&(S.onmousedown=v),T&&(T.onmousedown=_),()=>{S&&(S.onmousedown=null),T&&(T.onmousedown=null)}},[o]);const C=f=>{const g=f.target.value;if(i(g),/^#[0-9A-F]{6}$/i.test(g)){t(g);const v=Yr(g);r(Jc(v.r,v.g,v.b))}},w=["#ef4444","#f97316","#f59e0b","#84cc16","#10b981","#06b6d4","#3b82f6","#8b5cf6","#d946ef","#f43f5e","#ffffff","#000000"];return n.jsxs("div",{className:"flex flex-col gap-3 p-2 bg-gray-800 rounded border border-gray-700 w-full",children:[n.jsx("canvas",{ref:s,width:200,height:150,className:"w-full h-[150px] rounded cursor-crosshair shadow-inner"}),n.jsx("canvas",{ref:l,width:200,height:20,className:"w-full h-[20px] rounded cursor-ew-resize shadow-inner"}),n.jsxs("div",{className:"flex gap-2 items-center",children:[n.jsx("div",{className:"w-8 h-8 rounded border border-gray-500 shadow-sm flex-shrink-0",style:{backgroundColor:e}}),n.jsxs("div",{className:"flex-grow flex items-center bg-gray-900 rounded border border-gray-600 px-2 py-1",children:[n.jsx("span",{className:"text-gray-500 text-xs mr-1",children:"#"}),n.jsx("input",{type:"text",value:a.replace("#",""),onChange:C,className:"bg-transparent text-xs text-white outline-none w-full uppercase font-mono",maxLength:6})]})]}),n.jsx("div",{className:"flex flex-wrap gap-1.5 justify-between",children:w.map(f=>n.jsx("button",{onClick:()=>{t(f),i(f);const g=Yr(f);r(Jc(g.r,g.g,g.b))},className:`w-5 h-5 rounded-full border border-gray-600 transition-transform hover:scale-110 ${e===f?"ring-2 ring-white":""}`,style:{backgroundColor:f}},f))}),n.jsx("div",{className:"flex text-[10px] text-gray-500 justify-between px-1",children:n.jsxs("span",{children:["R:",Yr(e).r," G:",Yr(e).g," B:",Yr(e).b]})})]})},pP=({color:e,onChange:t})=>{const{t:o}=vt();return n.jsxs("div",{className:"w-64 bg-gray-900 border-l border-gray-700 flex flex-col flex-shrink-0 p-4 overflow-y-auto select-none",children:[n.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-3",children:"Palette & Color"}),n.jsx(uP,{color:e,onChange:t}),n.jsxs("div",{className:"mt-4 p-3 bg-gray-800/50 rounded-lg border border-gray-700 text-xs text-gray-400",children:[n.jsx("p",{className:"mb-2 font-semibold text-gray-300",children:"Tips:"}),n.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[n.jsxs("li",{children:["Use the ",n.jsx("strong",{children:"Eyedropper"})," tool to pick colors from the image."]}),n.jsxs("li",{children:["Hold ",n.jsx("strong",{children:"Alt"})," while drawing to pick color temporarily."]})]})]})]})},Yc="imageEditorModalPosition",qg="imageEditorModalSize",Jl=({isOpen:e,onClose:t,onApply:o,imageSrc:r})=>{const{t:a}=vt(),i=y.useRef(null),s=y.useRef(null),l=y.useRef(null),c=y.useRef(null),d=y.useRef(!0),[u,p]=y.useState(_l()),[h,x]=y.useState(!1),[k,C]=y.useState({zoom:1,offset:{x:0,y:0}}),[w,f]=y.useState(!1),[g,v]=y.useState({x:0,y:0,width:0,height:0}),[_,S]=y.useState(!1),[T,P]=y.useState("free"),[R,D]=y.useState("auto"),[q,O]=y.useState({width:0,height:0}),[E,A]=y.useState("checkerboard"),[N,j]=y.useState(!0),[L,M]=y.useState(!1),[V,H]=y.useState(!1),[F,G]=y.useState(""),[B,Y]=y.useState("transform"),[ee,ie]=y.useState("#ff0000"),[ce,pe]=y.useState(5),[ue,re]=y.useState(!1),[$,Z]=y.useState("none"),te=y.useRef(null),ae=y.useRef(null),I=y.useRef(null),J=y.useRef(null),[W,U]=y.useState(()=>{try{const xe=localStorage.getItem(Yc);if(xe)return JSON.parse(xe)}catch{}return{x:0,y:0}}),[Q,de]=y.useState(()=>{try{const xe=localStorage.getItem(qg);if(xe)return JSON.parse(xe)}catch{}return{width:"90vw",height:"90vh"}}),se=y.useRef(null),X=y.useRef(W);y.useEffect(()=>{X.current=W},[W]);const K=()=>{p(_l())},oe=xe=>{xe.target.closest("button")||(K(),xe.preventDefault(),xe.stopPropagation(),!h&&(xe.currentTarget.setPointerCapture(xe.pointerId),se.current={offset:{x:xe.clientX-W.x,y:xe.clientY-W.y}}))},ne=xe=>{se.current&&U({x:xe.clientX-se.current.offset.x,y:xe.clientY-se.current.offset.y})},le=xe=>{se.current=null,xe.currentTarget.releasePointerCapture(xe.pointerId),localStorage.setItem(Yc,JSON.stringify(X.current))},ge=()=>{if(c.current&&!h){const xe=c.current.getBoundingClientRect(),Be={width:xe.width,height:xe.height};de(Be),localStorage.setItem(qg,JSON.stringify(Be))}};y.useEffect(()=>{e?(d.current=!0,S(!1),K(),requestAnimationFrame(()=>f(!0))):f(!1)},[e]),y.useEffect(()=>{B==="rectangle"&&pe(1)},[B]),y.useEffect(()=>{if(e&&r){const xe=new Image;xe.crossOrigin="anonymous",xe.onload=()=>{l.current=xe;const Be=document.createElement("canvas");Be.width=xe.width,Be.height=xe.height,s.current=Be,v({x:0,y:0,width:xe.width,height:xe.height}),localStorage.getItem(Yc)||(U({x:(window.innerWidth-1200)/2,y:(window.innerHeight-800)/2}),de({width:1200,height:800}))},xe.src=r}else l.current=null,s.current=null},[e,r]),y.useEffect(()=>{let xe=1024,Be=1024;if(R!=="auto"){const Le=R.split("x").map(Number);Le.length===2&&(xe=Le[0],Be=Le[1])}else if(l.current){const Le=l.current;if(T!=="free"){const[Ue,Ze]=T.split(":").map(Number);if(Ue&&Ze){const at=Ue/Ze;Le.width/Le.height>at?(xe=Le.width,Be=Le.width/at):(Be=Le.height,xe=Le.height*at)}else xe=Le.width,Be=Le.height}else xe=Le.width,Be=Le.height}if(xe=Math.round(xe),Be=Math.round(Be),O({width:xe,height:Be}),e){if(d.current)C(Le=>({...Le,zoom:.4,offset:{x:0,y:0}})),d.current=!1;else if(l.current){const Le=l.current.width,Ue=l.current.height,Ze=Math.min(xe/Le,Be/Ue);v({x:0,y:0,width:Le*Ze,height:Ue*Ze})}}},[T,R,e,l.current]);const we=(xe,Be)=>{const Le=i.current;if(!Le)return{x:0,y:0};const Ue=Le.getBoundingClientRect(),Ze=xe-Ue.left,at=Be-Ue.top,ot=Ue.width/2,rt=Ue.height/2,et=(Ze-ot-k.offset.x)/k.zoom,mt=(at-rt-k.offset.y)/k.zoom;return{x:et,y:mt}},_e=xe=>{const Be=we(xe.clientX,xe.clientY),Le=Be.x-g.x,Ue=Be.y-g.y,Ze=l.current;if(!Ze)return{x:0,y:0};const at=Le+g.width/2,ot=Ue+g.height/2,rt=g.width/Ze.width,et=g.height/Ze.height;return{x:at/rt,y:ot/et}},fe=xe=>{const Be=i.current;if(!Be)return;const Le=Be.getBoundingClientRect(),Ue=xe.clientX-Le.left,Ze=xe.clientY-Le.top,at=Be.getContext("2d");if(!at)return;const ot=Be.width/Le.width,rt=Be.height/Le.height,et=Math.floor(Ue*ot),mt=Math.floor(Ze*rt),xt=at.getImageData(et,mt,1,1).data,Ct="#"+((1<<24)+(xt[0]<<16)+(xt[1]<<8)+xt[2]).toString(16).slice(1);ie(Ct)},he=xe=>{const Be=document.createElement("canvas");Be.width=20,Be.height=20;const Le=Be.getContext("2d");return Le&&(Le.fillStyle="#ccc",Le.fillRect(0,0,10,10),Le.fillRect(10,10,10,10),Le.fillStyle="#fff",Le.fillRect(10,0,10,10),Le.fillRect(0,10,10,10)),xe.createPattern(Be,"repeat")},ye=y.useCallback(()=>{var rt;const xe=i.current;if(!xe)return;const Be=(rt=xe.parentElement)==null?void 0:rt.getBoundingClientRect();Be&&(xe.width!==Be.width||xe.height!==Be.height)&&(xe.width=Be.width,xe.height=Be.height);const Le=xe.getContext("2d",{willReadFrequently:!0});if(!Le)return;Le.fillStyle="#374151",Le.fillRect(0,0,xe.width,xe.height),Le.save();const Ue=xe.width/2,Ze=xe.height/2;Le.translate(Ue+k.offset.x,Ze+k.offset.y),Le.scale(k.zoom,k.zoom);const at=q.width,ot=q.height;if(Le.shadowColor="rgba(0, 0, 0, 0.5)",Le.shadowBlur=30,Le.shadowOffsetX=0,Le.shadowOffsetY=10,Le.fillStyle="#000",Le.fillRect(-at/2,-ot/2,at,ot),Le.shadowColor="transparent",E==="checkerboard"){const et=he(Le);et?Le.fillStyle=et:Le.fillStyle="#fff"}else Le.fillStyle=E;if(Le.fillRect(-at/2,-ot/2,at,ot),Le.beginPath(),Le.rect(-at/2,-ot/2,at,ot),Le.clip(),l.current){const et=l.current;Le.save(),Le.translate(g.x,g.y);const mt=g.width,xt=g.height;if(_&&Le.scale(-1,1),Le.drawImage(et,-mt/2,-xt/2,mt,xt),s.current&&Le.drawImage(s.current,-mt/2,-xt/2,mt,xt),ue&&B==="rectangle"&&I.current&&ae.current){const Ct=I.current,pt=ae.current,dt=mt/et.width,kt=xt/et.height,St=Ct.x*dt-mt/2,Tt=Ct.y*kt-xt/2,_t=(pt.x-Ct.x)*dt,It=(pt.y-Ct.y)*kt;Le.strokeStyle=ee,Le.lineWidth=ce/((dt+kt)/2),Le.strokeRect(St,Tt,_t,It)}if(B==="pencil"&&J.current){const Ct=mt/et.width,pt=xt/et.height,dt=(Ct+pt)/2,kt=J.current.x*Ct-mt/2,St=J.current.y*pt-xt/2,Tt=ce/2*dt;Le.beginPath(),Le.arc(kt,St,Tt,0,Math.PI*2),Le.strokeStyle=ee,Le.lineWidth=1/k.zoom,Le.stroke(),Le.beginPath(),Le.arc(kt,St,Math.max(0,Tt-1/k.zoom),0,Math.PI*2),Le.strokeStyle="rgba(255,255,255,0.5)",Le.lineWidth=1/k.zoom,Le.stroke()}Le.restore()}if(Le.restore(),Le.save(),Le.translate(Ue+k.offset.x,Ze+k.offset.y),Le.scale(k.zoom,k.zoom),l.current&&B==="transform"){const et=g.width,mt=g.height;Le.save(),Le.translate(g.x,g.y),Le.strokeStyle="#22d3ee",Le.lineWidth=2/k.zoom,Le.strokeRect(-et/2,-mt/2,et,mt);const xt=8/k.zoom;Le.fillStyle="#22d3ee",[{x:-et/2,y:-mt/2},{x:et/2,y:-mt/2},{x:-et/2,y:mt/2},{x:et/2,y:mt/2}].forEach(pt=>{Le.fillRect(pt.x-xt/2,pt.y-xt/2,xt,xt)}),Le.restore()}Le.restore(),B==="eyedropper"&&J.current},[k,g,q,E,_,B,ue,ee,ce]);y.useEffect(()=>{if(e){let xe=requestAnimationFrame(ye);const Be=()=>{ye(),xe=requestAnimationFrame(Be)};return Be(),()=>cancelAnimationFrame(xe)}},[e,ye]);const Se=(xe,Be)=>{if(!l.current)return"none";const Le=g.width,Ue=g.height,Ze=g.x,at=g.y,ot=10/k.zoom,rt=(et,mt)=>Math.abs(xe-et)<ot&&Math.abs(Be-mt)<ot;return rt(Ze-Le/2,at-Ue/2)?"tl":rt(Ze+Le/2,at-Ue/2)?"tr":rt(Ze-Le/2,at+Ue/2)?"bl":rt(Ze+Le/2,at+Ue/2)?"br":"none"},Te=(xe,Be)=>{if(!l.current)return!1;const Le=g.width,Ue=g.height,Ze=g.x,at=g.y;return xe>=Ze-Le/2&&xe<=Ze+Le/2&&Be>=at-Ue/2&&Be<=at+Ue/2},Ae=(xe,Be,Le)=>{const Ue=i.current;if(!Ue)return;const Ze=Ue.getBoundingClientRect(),at=Math.max(.1,Math.min(Le,5)),ot=xe-Ze.left,rt=Be-Ze.top,et=Ze.width/2,mt=Ze.height/2,xt=ot-et,Ct=rt-mt,pt=k.offset.x,dt=k.offset.y,kt=at/k.zoom,St=xt-(xt-pt)*kt,Tt=Ct-(Ct-dt)*kt;C({zoom:at,offset:{x:St,y:Tt}})},Oe=xe=>{const Be=Number(xe.target.value),Le=Be/k.zoom;C({zoom:Be,offset:{x:k.offset.x*Le,y:k.offset.y*Le}})},me=(xe,Be,Le)=>Math.abs(xe-Be)<Le?Be:xe,ve=xe=>{if(K(),xe.preventDefault(),B==="eyedropper"){fe(xe);return}if(B==="zoom"){te.current={mouse:{x:xe.clientX,y:xe.clientY},viewOffset:{...k.offset},imgState:{...g},startZoom:k.zoom},re(!0);return}const Be=we(xe.clientX,xe.clientY);if(B==="transform"){const Le=Se(Be.x,Be.y);if(Le!=="none"){Z(Le),re(!0),te.current={mouse:{x:xe.clientX,y:xe.clientY},viewOffset:{...k.offset},imgState:{...g},startDist:Math.hypot(Be.x-g.x,Be.y-g.y),startAspectRatio:g.width/g.height};return}else if(Te(Be.x,Be.y))Z("none");else return}if(re(!0),te.current={mouse:{x:xe.clientX,y:xe.clientY},viewOffset:{...k.offset},imgState:{...g}},B==="pencil"||B==="rectangle"){const Le=_e(xe);if(I.current=Le,ae.current=Le,B==="pencil"&&s.current){const Ue=s.current.getContext("2d");Ue&&(Ue.beginPath(),Ue.moveTo(Le.x,Le.y),Ue.lineCap="round",Ue.lineJoin="round",Ue.strokeStyle=ee,Ue.lineWidth=ce,Ue.stroke())}}},Ie=xe=>{const Be=we(xe.clientX,xe.clientY),Le=_e(xe);if(J.current=Le,!ue){B==="transform"?Se(Be.x,Be.y)!=="none"?document.body.style.cursor="nwse-resize":Te(Be.x,Be.y)?document.body.style.cursor="move":document.body.style.cursor="default":B==="hand"?document.body.style.cursor="grab":B==="zoom"?document.body.style.cursor="ew-resize":document.body.style.cursor="crosshair";return}const Ue=te.current;if(!Ue)return;const Ze=xe.clientX-Ue.mouse.x,at=xe.clientY-Ue.mouse.y;if(B==="hand")C(ot=>({...ot,offset:{x:Ue.viewOffset.x+Ze,y:Ue.viewOffset.y+at}})),document.body.style.cursor="grabbing";else if(B==="zoom"){const rt=Math.pow(2,Ze/200),et=Math.max(.1,Math.min(10,(Ue.startZoom||1)*rt));C(mt=>({...mt,zoom:et}))}else if(B==="transform")if($!=="none"){const ot=we(xe.clientX,xe.clientY),rt=Ue.imgState.width/2,et=Ue.imgState.height/2,mt=Ue.imgState.x-rt,xt=Ue.imgState.x+rt,Ct=Ue.imgState.y-et,pt=Ue.imgState.y+et;let dt=mt,kt=xt,St=Ct,Tt=pt;if($==="tl"&&(dt=ot.x,St=ot.y),$==="tr"&&(kt=ot.x,St=ot.y),$==="bl"&&(dt=ot.x,Tt=ot.y),$==="br"&&(kt=ot.x,Tt=ot.y),N){const qt=10/k.zoom,Re=q.width/2,qe=q.height/2;$.includes("l")&&(dt=me(dt,-Re,qt),dt=me(dt,0,qt),dt=me(dt,Re,qt)),$.includes("r")&&(kt=me(kt,Re,qt),kt=me(kt,0,qt),kt=me(kt,-Re,qt)),$.includes("t")&&(St=me(St,-qe,qt),St=me(St,0,qt),St=me(St,qe,qt)),$.includes("b")&&(Tt=me(Tt,qe,qt),Tt=me(Tt,0,qt),Tt=me(Tt,-qe,qt))}let _t=Math.abs(kt-dt),It=Math.abs(Tt-St);if(!L&&Ue.startAspectRatio){const qt=Ue.startAspectRatio;_t/qt>It?It=_t/qt:_t=It*qt,$==="tl"&&(dt=kt-_t,St=Tt-It),$==="tr"&&(kt=dt+_t,St=Tt-It),$==="bl"&&(dt=kt-_t,Tt=St+It),$==="br"&&(kt=dt+_t,Tt=St+It)}const Io=(dt+kt)/2,jo=(St+Tt)/2;v({x:Io,y:jo,width:_t,height:It})}else{const ot=Ze/k.zoom,rt=at/k.zoom;let et=Ue.imgState.x+ot,mt=Ue.imgState.y+rt;if(N){const xt=10/k.zoom,Ct=Ue.imgState.width/2,pt=Ue.imgState.height/2,dt=q.width/2,kt=q.height/2,St=et-Ct,Tt=et+Ct,_t=mt-pt,It=mt+pt;Math.abs(St- -dt)<xt?et=-dt+Ct:Math.abs(Tt-dt)<xt?et=dt-Ct:Math.abs(St-0)<xt?et=0+Ct:Math.abs(Tt-0)<xt?et=0-Ct:Math.abs(et-0)<xt&&(et=0),Math.abs(_t- -kt)<xt?mt=-kt+pt:Math.abs(It-kt)<xt?mt=kt-pt:Math.abs(_t-0)<xt?mt=0+pt:Math.abs(It-0)<xt?mt=0-pt:Math.abs(mt-0)<xt&&(mt=0)}v(xt=>({...xt,x:et,y:mt}))}else if(B==="pencil"){if(s.current){const ot=s.current.getContext("2d");ot&&(ot.lineTo(Le.x,Le.y),ot.stroke())}}else B==="rectangle"&&(ae.current=Le)},ke=()=>{if(re(!1),Z("none"),te.current=null,B==="rectangle"&&I.current&&ae.current&&s.current){const xe=s.current.getContext("2d");if(xe){const Be=I.current,Le=ae.current,Ue=Le.x-Be.x,Ze=Le.y-Be.y;xe.strokeStyle=ee,xe.lineWidth=ce,xe.strokeRect(Be.x,Be.y,Ue,Ze)}}I.current=null,ae.current=null},je=()=>{J.current=null,ke()},Ge=xe=>{xe.preventDefault(),xe.stopPropagation();const Be=Math.pow(1.001,-xe.deltaY),Le=Math.max(.1,Math.min(5,k.zoom*Be));Ae(xe.clientX,xe.clientY,Le)},be=()=>{if(!l.current)return;const xe=l.current.width,Be=l.current.height,Le=q.width,Ue=q.height,Ze=Math.min(Le/xe,Ue/Be);v({x:0,y:0,width:xe*Ze,height:Be*Ze})},Pe=()=>{if(!l.current)return;const xe=l.current.width,Be=l.current.height,Le=q.width,Ue=q.height,Ze=Math.max(Le/xe,Ue/Be);v({x:0,y:0,width:xe*Ze,height:Be*Ze})},Ee=()=>{var xe,Be;if(v({x:0,y:0,width:((xe=l.current)==null?void 0:xe.width)||0,height:((Be=l.current)==null?void 0:Be.height)||0}),S(!1),P("free"),D("auto"),s.current){const Le=s.current.getContext("2d");Le&&Le.clearRect(0,0,s.current.width,s.current.height)}},Me=async()=>{if(!(!l.current||V)){H(!0);try{const xe=document.createElement("canvas");xe.width=l.current.width,xe.height=l.current.height;const Be=xe.getContext("2d");if(!Be)throw new Error("Could not get context");Be.drawImage(l.current,0,0),s.current&&Be.drawImage(s.current,0,0);const Ue=xe.toDataURL("image/png").split(",")[1],ot=await Vn("Modify the image based on the colored markings: 1. REMOVE objects covered in RED. 2. STRICTLY PRESERVE and do NOT change objects covered in GREEN. Fill the removed red areas naturally to match the surroundings.","1:1",[{base64ImageData:Ue,mimeType:"image/png"}],"gemini-3-flash-preview"),rt=new Image;rt.onload=()=>{if(l.current=rt,s.current){const et=s.current.getContext("2d");et==null||et.clearRect(0,0,s.current.width,s.current.height)}H(!1)},rt.src=ot}catch(xe){console.error("Error removing object:",xe),H(!1),alert("Failed to remove object. Please check console.")}}},Fe=async()=>{if(!(!l.current||V)){H(!0);try{const xe=document.createElement("canvas");xe.width=l.current.width,xe.height=l.current.height;const Be=xe.getContext("2d");if(!Be)throw new Error("Could not get context");Be.drawImage(l.current,0,0);const Ue=xe.toDataURL("image/png").split(",")[1],ot=await Vn("Replace the background with solid pure black color (#000000). Keep the main subject exactly identical.","1:1",[{base64ImageData:Ue,mimeType:"image/png"}],"gemini-3-flash-preview"),rt=new Image;rt.crossOrigin="anonymous",rt.onload=()=>{l.current=rt,H(!1)},rt.src=ot}catch{H(!1)}}},tt=async()=>{if(!(!l.current||V||!F.trim())){H(!0);try{const xe=document.createElement("canvas");xe.width=l.current.width,xe.height=l.current.height;const Be=xe.getContext("2d");if(!Be)throw new Error("Could not get context");Be.drawImage(l.current,0,0),s.current&&Be.drawImage(s.current,0,0);const Ue=xe.toDataURL("image/png").split(",")[1],at=await Vn(F,"1:1",[{base64ImageData:Ue,mimeType:"image/png"}],"gemini-3-flash-preview"),ot=new Image;ot.onload=()=>{if(l.current=ot,s.current){const rt=s.current.getContext("2d");rt==null||rt.clearRect(0,0,s.current.width,s.current.height)}H(!1)},ot.src=at}catch(xe){console.error("Error requesting modification:",xe),H(!1),alert("Failed to request changes. Please check console.")}}},Nt=()=>{if(!i.current||!l.current)return;const xe=q.width,Be=q.height,Le=document.createElement("canvas");Le.width=xe,Le.height=Be;const Ue=Le.getContext("2d");if(!Ue)return;E!=="checkerboard"&&(Ue.fillStyle=E,Ue.fillRect(0,0,xe,Be));const Ze=xe/2,at=Be/2;Ue.save(),Ue.translate(Ze,at),Ue.translate(g.x,g.y);const ot=g.width,rt=g.height;_&&Ue.scale(-1,1);const et=l.current;Ue.drawImage(et,-ot/2,-rt/2,ot,rt),s.current&&Ue.drawImage(s.current,-ot/2,-rt/2,ot,rt),Ue.restore();const mt=Le.toDataURL("image/png");o(mt),t()};return e?ww.createPortal(n.jsx("div",{className:`fixed inset-0 z-[${u}] pointer-events-none transition-opacity duration-300 ease-out ${w?"opacity-100":"opacity-0"}`,children:n.jsxs("div",{ref:c,className:"absolute bg-gray-800 rounded-lg shadow-2xl border-2 border-gray-700 flex flex-col pointer-events-auto overflow-hidden",onMouseDown:K,style:h?{left:0,top:0,width:"100%",height:"100%",borderRadius:0,border:"none"}:{left:W.x,top:W.y,width:Q.width,height:Q.height,maxWidth:"98vw",maxHeight:"98vh",minWidth:"800px",minHeight:"600px",resize:"both"},onMouseUp:ge,children:[n.jsx(aP,{onClose:t,onPointerDown:oe,onPointerMove:ne,onPointerUp:le}),n.jsxs("div",{className:"flex-grow min-h-0 flex",children:[n.jsx(iP,{resolution:R,setResolution:D,aspectRatio:T,setAspectRatio:P,backgroundType:E,setBackgroundType:A,activeTool:B,isSnappingEnabled:N,setIsSnappingEnabled:j,isFreeAspect:L,setIsFreeAspect:M,brushSize:ce,setBrushSize:pe,modificationPrompt:F,setModificationPrompt:G,isProcessing:V,handleRequestModification:tt,handleRemoveObject:Me,handleRemoveBackground:Fe,canvasSize:q}),n.jsxs("div",{className:"flex-grow bg-black/90 relative overflow-hidden flex items-center justify-center",style:{cursor:B==="hand"?ue?"grabbing":"grab":"default"},children:[n.jsx(sP,{activeTool:B,setActiveTool:Y,onFit:be,onFill:Pe,onFlip:()=>S(xe=>!xe)}),n.jsx("canvas",{ref:i,onMouseDown:ve,onMouseMove:Ie,onMouseUp:ke,onMouseLeave:je,onWheel:Ge,onContextMenu:xe=>xe.preventDefault()})]}),n.jsx(pP,{color:ee,onChange:ie})]}),n.jsx(lP,{zoom:k.zoom,onZoomChange:Oe,onClose:t,onReset:Ee,onApply:Nt,isProcessing:V})]})}),document.body):null},hP="Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.",Ap=async(e,t,o="",r="gemini-3-flash-preview",a=hP)=>{var p;const{formattedImage:i}=await br(e,t),l=i.split(",")[1],c=((p=i.match(/:(.*?);/))==null?void 0:p[1])||"image/png",d=o?`${o}. ${a}`:`High quality image. ${a}`;return await Vn(d,t,[{base64ImageData:l,mimeType:c}],r)},mP=({node:e,onValueChange:t,onProcessImage:o,isProcessingImage:r,onPasteImage:a,t:i,deselectAllNodes:s,getFullSizeImage:l,setImageViewer:c,setFullSizeImage:d,onCopyImageToClipboard:u,onDownloadImage:p,addToast:h,onAddNode:x,onDeleteNode:k,onImageToText:C,isAnalyzingImage:w})=>{const f=Ut(),g=x||(f==null?void 0:f.onAddNode),v=k||(f==null?void 0:f.deleteNodeAndConnections),_=f==null?void 0:f.setSelectedNodeIds,S=y.useRef(null),[T,P]=y.useState(null),[R,D]=y.useState(!1),[q,O]=y.useState(!1),[E,A]=y.useState(null),[N,j]=y.useState(null),L=(e.height??0)>=460,M=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{image:e.value.startsWith("data:image")?e.value:null,prompt:""}}},[e.value]),{image:V,prompt:H}=M,F=l(e.id,0);y.useEffect(()=>{const W=F||V;if(!W){j(null);return}const U=new Image;U.onload=()=>{j({width:U.naturalWidth,height:U.naturalHeight})},U.src=W},[F,V]);const G=W=>{t(e.id,JSON.stringify({...M,...W}))},B=async W=>{const U=await ml(W);P(U);const Q=await Lt(W,256,256);d(e.id,0,W),G({image:Q})},Y=W=>{var Q;const U=(Q=W.target.files)==null?void 0:Q[0];U&&a(e.id,U)},ee=W=>{W.preventDefault(),W.stopPropagation(),D(!0);const U=document.getElementById("app-container");U&&U.classList.remove("ring-2","ring-cyan-500","ring-inset")},ie=W=>{W.preventDefault(),W.stopPropagation(),D(!0)},ce=W=>{W.preventDefault(),W.stopPropagation(),D(!1)},pe=W=>{var de;W.preventDefault(),W.stopPropagation(),D(!1);const U=W.dataTransfer.getData("application/prompt-modifier-drag-image");if(U){fetch(U).then(se=>se.blob()).then(se=>{const X=new File([se],"dragged_image.png",{type:se.type});a(e.id,X)});return}const Q=(de=W.dataTransfer.files)==null?void 0:de[0];Q&&Q.type.startsWith("image/")&&a(e.id,Q)},ue=W=>{B(W)},re=W=>{if(W.stopPropagation(),!V)return;const U=l(e.id,0)||V;U&&c({sources:[{src:U,frameNumber:0,prompt:H||"Input Image"}],initialIndex:0})},$=W=>{W.stopPropagation();const U=l(e.id,0)||V;U&&u&&u(U)},Z=W=>{W.stopPropagation(),p&&p(e.id)},te=W=>{W.stopPropagation(),G({image:null}),h&&h(i("toast.contentCleared"))},ae=async W=>{const U=l(e.id,0)||V;if(U){A(W);try{const Q=await Ap(U,W,H);await B(Q),h&&h(`Converted to ${W} successfully`,"success")}catch(Q){console.error("Ratio expansion failed:",Q),h&&h(`Failed to convert: ${Q.message}`,"error")}finally{A(null)}}},I=(W,U)=>{if(!g)return;const Q=l(e.id,0)||V;if(!Q)return;let de={x:e.position.x,y:e.position.y};W.shiftKey||(de={x:e.position.x+e.width+50,y:e.position.y});const se=g(U,de);U===z.IMAGE_ANALYZER?(t(se,JSON.stringify({image:V,description:"",softPrompt:!1})),d(se,0,Q)):U===z.IMAGE_EDITOR&&(t(se,JSON.stringify({inputImages:[V],prompt:H||"",outputImage:null,aspectRatio:"1:1",enableAspectRatio:!1,enableOutpainting:!1,outpaintingPrompt:"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.",model:"gemini-2.5-flash-image",autoDownload:!0,autoCrop169:!1,leftPaneWidth:280,topPaneHeight:320})),d(se,1,Q)),_&&_([se]),W.shiftKey&&v&&v(e.id)},J=W=>{W.stopPropagation();const U=L?340:560;f!=null&&f.setNodes&&f.setNodes(Q=>Q.map(de=>de.id===e.id?{...de,height:U}:de))};return n.jsxs("div",{className:"flex flex-col h-full space-y-2","data-node-id":e.id,children:[n.jsx(Jl,{isOpen:q,onClose:()=>O(!1),onApply:ue,imageSrc:l(e.id,0)||V}),n.jsx("input",{ref:S,type:"file",accept:"image/*",className:"hidden",onChange:Y}),n.jsxs("div",{className:"flex-grow min-h-0 relative group rounded-md overflow-hidden bg-gray-700",children:[n.jsx("div",{onClick:()=>{var W;return(W=S.current)==null?void 0:W.click()},onDragEnter:ee,onDragOver:ie,onDragLeave:ce,onDrop:pe,className:`w-full h-full flex items-center justify-center cursor-pointer transition-all relative ${R?"bg-gray-600 ring-2 ring-accent":"hover:bg-gray-600"}`,children:V?n.jsxs(n.Fragment,{children:[n.jsx("img",{src:V||l(e.id,0),alt:"Input",className:"object-contain w-full h-full",draggable:!0,onMouseDown:W=>W.stopPropagation(),onClick:re,onDragStart:W=>{const U=l(e.id,0)||V;U&&(W.dataTransfer.setData("application/prompt-modifier-drag-image",U),W.dataTransfer.effectAllowed="copy",W.stopPropagation())}}),n.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"}),N&&n.jsxs("div",{className:"absolute bottom-2 left-2 z-20 bg-black/60 text-gray-300 text-[10px] px-1.5 py-0.5 rounded pointer-events-none backdrop-blur-sm font-mono",children:[N.width,"x",N.height]}),n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity z-10 bg-black/60 backdrop-blur-sm p-1 rounded-md",children:[n.jsx(Ne,{title:i("node.action.download"),onClick:Z,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Ne,{title:i("node.action.copy"),onClick:$,children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Ne,{title:i("node.action.clear"),onClick:te,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}):n.jsx("span",{className:"text-gray-400 pointer-events-none",children:i("node.content.dropImage")})}),n.jsx("div",{className:"absolute bottom-2 right-2 z-20",children:n.jsx(ct,{content:L?" ":" ",children:n.jsx("button",{onClick:J,className:"p-1 bg-gray-900/60 hover:bg-gray-700 text-gray-400 hover:text-white rounded transition-colors shadow-sm",children:L?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})})})})]}),L&&n.jsxs("div",{className:"flex-shrink-0 flex flex-col space-y-2 h-[220px] overflow-hidden",children:[n.jsxs("div",{className:"flex gap-2 shrink-0 h-[80px]",children:[n.jsxs("div",{className:"flex-[1.2] flex flex-col gap-2 min-w-0",children:[n.jsx(ct,{content:i("node.action.processImageTitle"),className:"w-full",children:n.jsxs("button",{onClick:()=>o(e.id),disabled:r||!V||!!E,className:"w-full h-9 px-3 text-sm font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 truncate flex items-center justify-center gap-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z"})}),n.jsx("span",{className:"truncate",children:i(r?"node.content.processing":"node.action.processImage")})]})}),n.jsxs("div",{className:"grid grid-cols-4 gap-1 h-9",children:[n.jsx(ct,{content:i("node.action.openInAnalyzer"),children:n.jsx("button",{onClick:W=>I(W,z.IMAGE_ANALYZER),disabled:!V,className:"w-full h-full flex items-center justify-center bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-white",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12.792V5.25a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 5.25v13.5A2.25 2.25 0 005.25 21h7.55"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 18.375L21 21"})]})})}),n.jsx(ct,{content:i("node.content.imageToText"),children:n.jsx("button",{onClick:()=>C&&C(e.id),disabled:!V||w||!C,className:"w-full h-full flex items-center justify-center bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:w?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-white",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})})})}),n.jsx(ct,{content:i("node.action.expand169"),children:n.jsx("button",{onClick:()=>ae("16:9"),disabled:!V||r||!!E,className:"w-full h-full px-1 text-[10px] font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center gap-1",children:E==="16:9"?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsxs(n.Fragment,{children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 hidden sm:block",children:n.jsx("rect",{x:"2",y:"6",width:"20",height:"12",rx:"2"})}),n.jsx("span",{children:"16:9"})]})})}),n.jsx(ct,{content:i("node.action.expand916"),children:n.jsx("button",{onClick:()=>ae("9:16"),disabled:!V||r||!!E,className:"w-full h-full px-1 text-[10px] font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center gap-1",children:E==="9:16"?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsxs(n.Fragment,{children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 hidden sm:block",children:n.jsx("rect",{x:"6",y:"2",width:"12",height:"20",rx:"2"})}),n.jsx("span",{children:"9:16"})]})})})]})]}),n.jsxs("div",{className:"flex-1 flex flex-col gap-2 min-w-0",children:[n.jsx(ct,{content:i("node.action.rasterEditor"),className:"w-full",children:n.jsxs("button",{onClick:()=>O(!0),disabled:!V,className:"w-full h-9 px-2 text-xs font-bold text-white bg-accent-secondary rounded-md hover:bg-accent-secondary-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center gap-1.5",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 shrink-0",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})}),n.jsx("span",{className:"truncate",children:i("node.action.rasterEditor")})]})}),n.jsx(ct,{content:i("node.action.openInAIEditor"),className:"w-full",children:n.jsxs("button",{onClick:W=>I(W,z.IMAGE_EDITOR),disabled:!V,className:"w-full h-9 px-2 text-xs font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center gap-1.5",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 shrink-0",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})}),n.jsx("span",{className:"truncate",children:i("node.action.openInAIEditor")})]})})]})]}),T&&n.jsxs("div",{className:"flex-shrink-0 relative",children:[n.jsx("div",{className:"absolute top-0 right-0 z-10",children:n.jsx("button",{onClick:()=>{G({prompt:`${H?H+", ":""}${T}`}),P(null)},className:"px-2 py-0.5 text-[10px] font-bold bg-accent hover:bg-accent-hover text-white rounded shadow-sm",title:i("node.action.copyPrompt"),children:"Use"})}),n.jsx("textarea",{readOnly:!0,value:T,placeholder:i("node.content.metadataPromptPlaceholder"),className:"w-full p-2 text-xs bg-input/50 rounded-md resize-none focus:outline-none text-gray-400 italic border border-gray-600/50",rows:2,onWheel:W=>W.stopPropagation(),onFocus:s})]}),n.jsxs("div",{className:"flex-grow min-h-0 flex flex-col relative",children:[n.jsx("textarea",{value:H||"",onChange:W=>G({prompt:W.target.value}),placeholder:i("node.content.prompt"),className:"w-full h-full p-2 bg-[#18202f] border border-gray-600 rounded-md resize-none focus:ring-1 focus:ring-accent focus:border-accent focus:outline-none custom-scrollbar text-sm",onWheel:W=>W.stopPropagation(),onMouseDown:W=>W.stopPropagation(),onFocus:s}),n.jsx("div",{className:"absolute bottom-2 right-2 opacity-50 hover:opacity-100 transition-opacity",children:n.jsx(Ne,{title:i("node.action.copy"),onClick:()=>navigator.clipboard.writeText(H||""),children:n.jsx(Dt,{className:"h-4 w-4"})})})]})]})]})},gP=({node:e,onValueChange:t,onTranslate:o,isTranslating:r,connectedInputs:a,t:i,onSelectNode:s,onPasteImage:l,getFullSizeImage:c,setImageViewer:d})=>{const u=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{inputText:"",targetLanguage:"ru",translatedText:"",image:null}}},[e.value]),{inputText:p="",targetLanguage:h="ru",translatedText:x="",image:k=null}=u,C=a==null?void 0:a.has(void 0),w=T=>{const P={...u,...T};delete P.inputHeight,t(e.id,JSON.stringify(P))},f=T=>{T.stopPropagation(),l(e.id)},g=T=>{T.stopPropagation(),w({inputText:""})},v=T=>{T.stopPropagation(),w({image:null})},_=T=>{T.stopPropagation(),k&&d({sources:[{src:k,frameNumber:0,prompt:"Input Image"}],initialIndex:0})},S=Object.entries(Pn);return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex-shrink-0 mb-2 flex items-end space-x-2",onMouseDown:T=>{T.stopPropagation(),s()},children:[n.jsxs("div",{className:"flex-grow",children:[n.jsx("label",{htmlFor:`lang-select-${e.id}`,className:"block text-xs font-medium text-gray-400 mb-1",children:i("node.content.targetLanguage")}),n.jsx(Mn,{id:`lang-select-${e.id}`,value:h,onChange:T=>w({targetLanguage:T}),disabled:r,options:S.map(([T,{name:P}])=>({value:T,label:P}))})]}),n.jsx("button",{onClick:f,className:"h-[38px] px-3 bg-accent-secondary hover:bg-accent-secondary-hover text-white rounded-md transition-colors flex items-center justify-center shadow-sm",title:i("node.action.paste"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),n.jsx("button",{onClick:()=>o(e.id),disabled:r||!C&&!p.trim()&&!k,className:"h-[38px] px-4 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors duration-200 flex-shrink-0 shadow-sm",children:i(r?"node.content.translating":"node.content.translate")})]}),n.jsxs("div",{className:"flex-1 min-h-0 mb-2 flex flex-col gap-2",children:[k&&n.jsxs("div",{className:"relative h-24 w-full bg-gray-900/50 rounded-md border border-gray-600 flex-shrink-0 group overflow-hidden",children:[n.jsx("img",{src:k,alt:"Input",className:"w-full h-full object-contain cursor-pointer",onClick:_}),n.jsx("div",{className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsx(Ne,{title:i("node.action.clear"),onClick:v,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})})]}),n.jsxs("div",{className:"relative flex-grow h-full",children:[n.jsx("textarea",{value:p,onChange:T=>w({inputText:T.target.value}),placeholder:i(C?"node.content.connectedPlaceholder":"node.content.translatePlaceholder"),className:"w-full h-full p-2 bg-input border border-gray-700/50 rounded-md resize-none focus:ring-1 focus:ring-accent focus:border-accent focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 custom-scrollbar",onWheel:T=>T.stopPropagation(),onMouseDown:T=>{T.stopPropagation(),s()},disabled:C}),!C&&p&&n.jsx("div",{className:"absolute top-1 right-1 opacity-50 hover:opacity-100 transition-opacity",children:n.jsx(Ne,{title:i("node.action.clear"),onClick:g,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})})]})]}),n.jsxs("div",{className:"flex-1 min-h-0 relative",children:[n.jsx("textarea",{value:x,onChange:T=>w({translatedText:T.target.value}),placeholder:i("node.content.translatedTextPlaceholder"),className:"w-full h-full p-2 bg-input border border-gray-700/50 rounded-md resize-none focus:ring-1 focus:ring-accent focus:border-accent focus:outline-none custom-scrollbar",onWheel:T=>T.stopPropagation(),onMouseDown:T=>{T.stopPropagation(),s()}}),n.jsx("div",{className:"absolute top-1 right-1 opacity-50 hover:opacity-100 transition-opacity",children:n.jsx(Ne,{title:i("node.action.copy"),onClick:T=>{T.stopPropagation(),navigator.clipboard.writeText(x)},children:n.jsx(Dt,{className:"h-4 w-4"})})})]})]})},gs=e=>{let t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/"/g,"&#039;");return t=t.replace(/\*\*(.*?)\*\*/g,'<strong class="text-accent-text font-bold">$1</strong>'),t=t.replace(/__(.*?)__/g,'<strong class="text-accent-text font-bold">$1</strong>'),t=t.replace(/`([^`]+)`/g,'<code class="bg-gray-800 px-1 rounded text-accent-text font-mono text-xs">$1</code>'),t},Og=({code:e})=>{const[t,o]=y.useState(!1),r=()=>{navigator.clipboard.writeText(e),o(!0),setTimeout(()=>o(!1),2e3)};return n.jsxs("div",{className:"relative group/code my-2",children:[n.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover/code:opacity-100 transition-opacity z-10",children:n.jsx("button",{onClick:r,className:"p-1.5 bg-gray-700 hover:bg-accent text-gray-300 hover:text-white rounded text-xs flex items-center gap-1 shadow-sm transition-colors",title:t?"Copied!":"Copy Code",children:t?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):n.jsx(Dt,{className:"h-4 w-4"})})}),n.jsx("pre",{className:"bg-gray-900/80 p-3 rounded-md border border-gray-600 text-accent-text overflow-x-auto font-mono text-xs shadow-inner [&::-webkit-scrollbar]:h-2 [&::-webkit-scrollbar-track]:bg-transparent [&::-webkit-scrollbar-thumb]:bg-gray-600 [&::-webkit-scrollbar-thumb]:rounded-full hover:[&::-webkit-scrollbar-thumb]:bg-gray-500 select-text",children:n.jsx("code",{children:e})})]})},fP=Et.memo(({content:e})=>{const t=e.split(/(```prompt\n[\s\S]*?\n```|```[\s\S]*?```)/g);return n.jsx("div",{className:"text-sm leading-relaxed space-y-2 text-gray-200 break-words cursor-text",children:t.map((o,r)=>{const a=o.match(/```prompt\n([\s\S]*?)\n```/);if(a)return n.jsx(Og,{code:a[1].trim()},r);const i=o.match(/```([\s\S]*?)```/);if(i){let p=i[1];const h=p.indexOf(`
`);if(h!==-1){const x=p.substring(0,h).trim();x&&!x.includes(" ")&&(p=p.substring(h+1))}return n.jsx(Og,{code:p.trim()},r)}if(!o.trim())return null;const s=o.split(`
`),l=[];let c=[],d=!1;const u=()=>{c.length>0&&(d?l.push(n.jsx("ol",{className:"list-decimal list-outside ml-4 space-y-1 mb-2 marker:text-gray-500 select-text",children:[...c]},`list-${r}-${l.length}`)):l.push(n.jsx("ul",{className:"list-disc list-outside ml-4 space-y-1 mb-2 marker:text-gray-500 select-text",children:[...c]},`list-${r}-${l.length}`)),c=[])};return s.forEach((p,h)=>{const x=p.match(/^(\d+)\.\s+(.*)/),k=p.match(/^[\*\-]\s+(.*)/),C=p.match(/^(#{1,6})\s+(.*)/);if(x){c.length>0&&!d&&u(),d=!0;const w=parseInt(x[1],10);c.push(n.jsx("li",{value:w,dangerouslySetInnerHTML:{__html:gs(x[2])}},h))}else if(k)c.length>0&&d&&u(),d=!1,c.push(n.jsx("li",{dangerouslySetInnerHTML:{__html:gs(k[1])}},h));else if(u(),C){const w=C[1].length,f=w===1?"text-lg":w===2?"text-base":"text-sm";l.push(n.jsx("div",{className:`${f} font-bold text-accent-text mt-3 mb-1 border-b border-gray-700/50 pb-1 select-text`,dangerouslySetInnerHTML:{__html:gs(C[2])}},h))}else p.trim()===""?l.push(n.jsx("div",{className:"h-2"},h)):l.push(n.jsx("div",{className:"min-h-[1.2em] select-text",dangerouslySetInnerHTML:{__html:gs(p)}},h))}),u(),n.jsx("div",{className:"select-text",children:l},r)})})}),xP=({label:e,icon:t,isActive:o,onClick:r})=>{const[a,i]=y.useState(!1);return n.jsxs("div",{className:"relative flex-1 flex",onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),onMouseDown:s=>s.stopPropagation(),children:[n.jsx("button",{onClick:r,className:`flex-1 flex items-center justify-center p-1.5 rounded transition-all duration-200 group ${o?"bg-accent text-white shadow-sm":"hover:bg-gray-700 text-gray-400 hover:text-gray-200"}`,children:t}),n.jsxs("div",{className:`absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-xs whitespace-nowrap rounded shadow-xl z-50 pointer-events-none transition-opacity duration-200 ease-out origin-bottom ${a?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:[e,n.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-700"})]})]})},yP=({selection:e,onCopy:t,rootRef:o,scale:r})=>{const[a,i]=y.useState(null);return y.useEffect(()=>{if(!e||e.rangeCount===0||e.toString().length===0){i(null);return}const s=e.getRangeAt(0),l=s.getBoundingClientRect();if(o.current&&!o.current.contains(s.commonAncestorContainer)){i(null);return}if(!o.current)return;const c=o.current.getBoundingClientRect(),d=(l.top-c.top)/r-40,u=(l.left-c.left)/r+l.width/r/2;i({top:d,left:u})},[e,o,r]),a?n.jsxs("button",{onClick:s=>{s.preventDefault(),s.stopPropagation(),t()},style:{top:a.top,left:a.left,transform:"translateX(-50%)"},className:"absolute z-[100] px-3 py-1.5 bg-gray-800 text-white text-xs font-bold rounded-lg shadow-xl border border-gray-600 hover:bg-gray-700 hover:border-cyan-500 transition-all flex items-center gap-2 animate-fade-in-up",children:[n.jsx(Dt,{className:"h-3 w-3"}),"Copy"]}):null},vP=({node:e,onValueChange:t,onSendMessage:o,isChatting:r,t:a,onSelectNode:i,addToast:s})=>{var V;const l=Ut(),c=(l==null?void 0:l.viewTransform.scale)||1,d=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{messages:[],currentInput:"",style:"general",attachment:null}}},[e.value]),{messages:u=[],currentInput:p="",style:h="general",attachment:x=null}=d,k=y.useRef(null),C=y.useRef(!0),w=y.useRef(null),f=y.useRef(null),g=y.useRef(null),[v,_]=y.useState(null);y.useLayoutEffect(()=>{const H=g.current;if(!H)return;H.style.height="80px";const F=H.scrollHeight,G=Math.min(Math.max(80,F),200);H.style.height=`${G}px`,H.style.overflowY=F>200?"auto":"hidden"},[p]);const S=H=>{H.stopPropagation();const{scrollTop:F,scrollHeight:G,clientHeight:B}=H.currentTarget;C.current=Math.abs(G-B-F)<50};y.useEffect(()=>{k.current&&C.current&&k.current.scrollTo({top:k.current.scrollHeight,behavior:"smooth"})},[u,r]),y.useEffect(()=>{const H=()=>{const F=window.getSelection();if(F&&F.toString().length>0&&k.current&&k.current.contains(F.anchorNode)){_(F);return}_(null)};return document.addEventListener("selectionchange",H),()=>document.removeEventListener("selectionchange",H)},[]);const T=()=>{r||(o(e.id),C.current=!0)},P=H=>{t(e.id,JSON.stringify({...d,style:H}))},R=()=>{var H;(H=f.current)==null||H.click()},D=async H=>{var B;const F=(B=H.target.files)==null?void 0:B[0];if(!F)return;const G=new FileReader;G.onload=Y=>{var ce;const ee=(ce=Y.target)==null?void 0:ce.result,ie={name:F.name,type:F.type,data:ee};t(e.id,JSON.stringify({...d,attachment:ie})),s&&s("File attached","success")},G.readAsDataURL(F),H.target.value=""},q=async()=>{try{const H=await navigator.clipboard.read();for(const F of H)if(F.types.some(G=>G.startsWith("image/"))){const G=await F.getType(F.types.find(ee=>ee.startsWith("image/"))),B=new File([G],"pasted_image.png",{type:G.type}),Y=new FileReader;Y.onload=ee=>{var ce;const ie=(ce=ee.target)==null?void 0:ce.result;t(e.id,JSON.stringify({...d,attachment:{name:B.name,type:B.type,data:ie}})),s&&s(a("toast.pastedFromClipboard"),"success")},Y.readAsDataURL(B);return}try{const F=await navigator.clipboard.readText();F&&(t(e.id,JSON.stringify({...d,currentInput:p+F})),s&&s(a("toast.pastedFromClipboard"),"success"))}catch{}}catch{try{const F=await navigator.clipboard.readText();F&&t(e.id,JSON.stringify({...d,currentInput:p+F}))}catch{s&&s(a("toast.pasteFailed"),"error")}}},O=()=>{t(e.id,JSON.stringify({...d,attachment:null}))},E=()=>{v&&(navigator.clipboard.writeText(v.toString()),s&&s(a("toast.copiedToClipboard")),v.removeAllRanges(),_(null))},A=H=>{const F=new Blob([H],{type:"text/plain"}),G=URL.createObjectURL(F),B=document.createElement("a");B.href=G;const Y=new Date().toISOString().replace(/[:.]/g,"-");B.download=`Gemini_Chat_${Y}.txt`,document.body.appendChild(B),B.click(),document.body.removeChild(B),URL.revokeObjectURL(G)},N=H=>{let F=H.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");F=F.replace(/^### (.*$)/gim,`<h3 style="color: #0891b2; font-size: 14pt; margin-top: 12pt; margin-bottom: 3pt; font-family: 'Calibri Light', sans-serif;">$1</h3>`),F=F.replace(/^## (.*$)/gim,`<h2 style="color: #0891b2; font-size: 16pt; margin-top: 14pt; margin-bottom: 6pt; font-family: 'Calibri Light', sans-serif;">$1</h2>`),F=F.replace(/^# (.*$)/gim,`<h1 style="color: #0891b2; font-size: 18pt; margin-top: 16pt; margin-bottom: 6pt; font-family: 'Calibri Light', sans-serif;">$1</h1>`),F=F.replace(/\*\*(.*?)\*\*/g,'<b style="color: #0891b2;">$1</b>'),F=F.replace(/__(.*?)__/g,'<b style="color: #0891b2;">$1</b>'),F=F.replace(/\*(.*?)\*/g,"<i>$1</i>"),F=F.replace(/_(.*?)_/g,"<i>$1</i>"),F=F.replace(/```([\s\S]*?)```/g,(ce,pe)=>`<div style="background-color: #f5f5f5; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-family: 'Courier New', monospace; font-size: 10pt; margin: 10px 0;">${pe.replace(/\n/g,"<br>")}</div>`),F=F.replace(/`([^`]+)`/g,`<span style="background-color: #f0f0f0; padding: 2px; border-radius: 4px; font-family: 'Courier New', monospace; color: #d63384; font-size: 10pt;">$1</span>`),F=F.replace(/\n/g,"<br>");const G=`
            <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
            <head>
                <meta charset='utf-8'>
                <title>Gemini Export</title>
                <style>
                    body { font-family: 'Calibri', 'Arial', sans-serif; font-size: 11pt; color: #000000; line-height: 1.5; }
                    h1, h2, h3, h4, h5, h6 { font-family: 'Calibri Light', 'Arial', sans-serif; color: #0891b2; }
                    strong, b { color: #0891b2; }
                </style>
            </head>
            <body>
                ${F}
            </body>
            </html>
        `,B=new Blob(["\uFEFF",G],{type:"application/msword"}),Y=URL.createObjectURL(B),ee=document.createElement("a");ee.href=Y;const ie=new Date().toISOString().replace(/[:.]/g,"-");ee.download=`Gemini_Chat_${ie}.doc`,document.body.appendChild(ee),ee.click(),document.body.removeChild(ee),URL.revokeObjectURL(Y)},j=[{id:"general",label:a("geminiChat.mode.general"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})},{id:"prompt",label:a("geminiChat.mode.prompt"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-4 w-4",children:[n.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 15-5-5L5 21"})]})},{id:"script",label:a("geminiChat.mode.script"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})},{id:"youtube",label:a("geminiChat.mode.youtube"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})},{id:"developer",label:a("geminiChat.mode.developer"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"})})}],L=(V=j.find(H=>H.id===h))==null?void 0:V.label,M=H=>{H.stopPropagation()};return n.jsxs("div",{className:"flex flex-col h-full relative",ref:w,children:[n.jsx("input",{type:"file",ref:f,className:"hidden",onChange:D,accept:"image/*,.txt,.pdf,.json"}),v&&n.jsx(yP,{selection:v,onCopy:E,rootRef:w,scale:c}),n.jsx("div",{className:"flex items-center bg-gray-900/50 p-1 rounded-md mb-2 shrink-0 justify-between",onMouseDown:H=>{H.stopPropagation(),i()},children:n.jsx("div",{className:"flex space-x-1 flex-1",children:j.map(H=>n.jsx(xP,{id:H.id,label:H.label,icon:H.icon,isActive:h===H.id,onClick:()=>P(H.id)},H.id))})}),n.jsxs("div",{ref:k,onWheel:H=>H.stopPropagation(),onScroll:S,className:"flex-grow p-2 bg-gray-900/50 rounded-md overflow-y-auto overflow-x-hidden mb-1 space-y-4 custom-scrollbar select-text cursor-text",onMouseDown:M,onMouseMove:M,onMouseUp:M,onClick:M,children:[u.length===0&&n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-500 space-y-2 opacity-50 select-none pointer-events-none",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),n.jsx("span",{className:"text-xs font-medium",children:L})]}),u.map((H,F)=>n.jsx("div",{className:`flex ${H.role==="user"?"justify-end":"justify-start"}`,children:n.jsxs("div",{className:`relative group max-w-[90%] p-3 rounded-lg select-text flex gap-2 ${H.role==="user"?"bg-accent text-white shadow-md":"bg-gray-800 border border-gray-700"}`,children:[n.jsx("div",{className:"min-w-0 flex-grow",children:H.role==="model"?n.jsx(fP,{content:H.content}):n.jsx("p",{className:`text-sm whitespace-pre-wrap break-words select-text ${H.role==="user"?"text-white":"text-gray-200"}`,children:H.content})}),H.role==="model"&&n.jsx("div",{className:"flex flex-col justify-start shrink-0 self-stretch",children:n.jsxs("div",{className:"sticky top-2 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col gap-1",children:[n.jsx(Ne,{title:a("node.action.copy"),onClick:G=>{G.stopPropagation(),navigator.clipboard.writeText(H.content),s(a("toast.copiedToClipboard"))},className:"p-1.5 bg-gray-800/80 rounded-md text-gray-400 hover:text-white border border-gray-600 hover:border-gray-500 shadow-sm",tooltipPosition:"left",children:n.jsx(Dt,{className:"h-3 w-3"})}),n.jsx(Ne,{title:a("node.action.downloadTxt"),onClick:G=>{G.stopPropagation(),A(H.content)},className:"p-1.5 bg-gray-800/80 rounded-md text-gray-400 hover:text-white border border-gray-600 hover:border-gray-500 shadow-sm",tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),n.jsx(Ne,{title:a("node.action.downloadDoc"),onClick:G=>{G.stopPropagation(),N(H.content)},className:"p-1.5 bg-gray-800/80 rounded-md text-gray-400 hover:text-white border border-gray-600 hover:border-gray-500 shadow-sm",tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})})]})})]})},F)),r&&n.jsx("div",{className:"flex justify-start",children:n.jsx("div",{className:"p-3 rounded-lg bg-gray-800 border border-gray-700",children:n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce"}),n.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),n.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})})]}),n.jsxs("div",{className:"relative w-full group flex-shrink-0 bg-gray-700 rounded-md border-none focus-within:ring-1 focus-within:ring-node-selected transition-shadow",children:[x&&n.jsxs("div",{className:"absolute -top-8 left-2 bg-gray-800 text-accent-text text-xs px-2 py-1 rounded-t-md border border-accent/50 border-b-0 flex items-center gap-2 max-w-[200px] shadow-sm z-0",children:[n.jsx("span",{className:"truncate",children:x.name}),n.jsx("button",{onClick:H=>{H.stopPropagation(),O()},className:"text-gray-500 hover:text-red-400",title:"Remove attachment",children:""})]}),n.jsx("textarea",{ref:g,value:p,onChange:H=>t(e.id,JSON.stringify({...d,currentInput:H.target.value})),onKeyDown:H=>{H.stopPropagation(),H.key==="Enter"&&!H.shiftKey&&(H.preventDefault(),T())},onKeyUp:H=>H.stopPropagation(),placeholder:a("node.content.chatPlaceholder"),onWheel:H=>H.stopPropagation(),onMouseDown:H=>{H.stopPropagation(),i()},onMouseMove:M,onMouseUp:M,className:"w-full p-2 pr-20 bg-transparent border-none rounded-md resize-none focus:outline-none text-sm text-white placeholder-gray-400",style:{minHeight:"80px",maxHeight:"200px",overflowY:"hidden"}}),n.jsxs("div",{className:"absolute bottom-2 right-2 flex gap-1",children:[n.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx(ct,{content:"  ",position:"top",children:n.jsx("button",{onClick:q,className:"p-1.5 rounded-md transition-colors duration-200 bg-gray-600 hover:bg-gray-500 text-gray-300 hover:text-white",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})})}),n.jsx(ct,{content:" ",position:"top",children:n.jsx("button",{onClick:R,className:`p-1.5 rounded-md transition-colors duration-200 ${x?"bg-accent/20 text-accent-text border border-accent/50":"bg-gray-600 hover:bg-gray-500 text-gray-300 hover:text-white"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})})})]}),n.jsx(ct,{content:"",position:"top",children:n.jsx("button",{onClick:T,disabled:r||!p.trim()&&!x,className:"p-1.5 bg-accent hover:bg-accent-hover rounded-md text-white disabled:bg-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors duration-200",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})})})})]})]})]})},wP=Et.memo(vP);function fs(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var V1={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(e,t){(function(o){e.exports=o()})(function(){return function o(r,a,i){function s(d,u){if(!a[d]){if(!r[d]){var p=typeof fs=="function"&&fs;if(!u&&p)return p(d,!0);if(l)return l(d,!0);var h=new Error("Cannot find module '"+d+"'");throw h.code="MODULE_NOT_FOUND",h}var x=a[d]={exports:{}};r[d][0].call(x.exports,function(k){var C=r[d][1][k];return s(C||k)},x,x.exports,o,r,a,i)}return a[d].exports}for(var l=typeof fs=="function"&&fs,c=0;c<i.length;c++)s(i[c]);return s}({1:[function(o,r,a){var i=o("./utils"),s=o("./support"),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(c){for(var d,u,p,h,x,k,C,w=[],f=0,g=c.length,v=g,_=i.getTypeOf(c)!=="string";f<c.length;)v=g-f,p=_?(d=c[f++],u=f<g?c[f++]:0,f<g?c[f++]:0):(d=c.charCodeAt(f++),u=f<g?c.charCodeAt(f++):0,f<g?c.charCodeAt(f++):0),h=d>>2,x=(3&d)<<4|u>>4,k=1<v?(15&u)<<2|p>>6:64,C=2<v?63&p:64,w.push(l.charAt(h)+l.charAt(x)+l.charAt(k)+l.charAt(C));return w.join("")},a.decode=function(c){var d,u,p,h,x,k,C=0,w=0,f="data:";if(c.substr(0,f.length)===f)throw new Error("Invalid base64 input, it looks like a data url.");var g,v=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===l.charAt(64)&&v--,c.charAt(c.length-2)===l.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(g=s.uint8array?new Uint8Array(0|v):new Array(0|v);C<c.length;)d=l.indexOf(c.charAt(C++))<<2|(h=l.indexOf(c.charAt(C++)))>>4,u=(15&h)<<4|(x=l.indexOf(c.charAt(C++)))>>2,p=(3&x)<<6|(k=l.indexOf(c.charAt(C++))),g[w++]=d,x!==64&&(g[w++]=u),k!==64&&(g[w++]=p);return g}},{"./support":30,"./utils":32}],2:[function(o,r,a){var i=o("./external"),s=o("./stream/DataWorker"),l=o("./stream/Crc32Probe"),c=o("./stream/DataLengthProbe");function d(u,p,h,x,k){this.compressedSize=u,this.uncompressedSize=p,this.crc32=h,this.compression=x,this.compressedContent=k}d.prototype={getContentWorker:function(){var u=new s(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),p=this;return u.on("end",function(){if(this.streamInfo.data_length!==p.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new s(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(u,p,h){return u.pipe(new l).pipe(new c("uncompressedSize")).pipe(p.compressWorker(h)).pipe(new c("compressedSize")).withStreamInfo("compression",p)},r.exports=d},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(o,r,a){var i=o("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},a.DEFLATE=o("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(o,r,a){var i=o("./utils"),s=function(){for(var l,c=[],d=0;d<256;d++){l=d;for(var u=0;u<8;u++)l=1&l?3988292384^l>>>1:l>>>1;c[d]=l}return c}();r.exports=function(l,c){return l!==void 0&&l.length?i.getTypeOf(l)!=="string"?function(d,u,p,h){var x=s,k=h+p;d^=-1;for(var C=h;C<k;C++)d=d>>>8^x[255&(d^u[C])];return-1^d}(0|c,l,l.length,0):function(d,u,p,h){var x=s,k=h+p;d^=-1;for(var C=h;C<k;C++)d=d>>>8^x[255&(d^u.charCodeAt(C))];return-1^d}(0|c,l,l.length,0):0}},{"./utils":32}],5:[function(o,r,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(o,r,a){var i=null;i=typeof Promise<"u"?Promise:o("lie"),r.exports={Promise:i}},{lie:37}],7:[function(o,r,a){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=o("pako"),l=o("./utils"),c=o("./stream/GenericWorker"),d=i?"uint8array":"array";function u(p,h){c.call(this,"FlateWorker/"+p),this._pako=null,this._pakoAction=p,this._pakoOptions=h,this.meta={}}a.magic="\b\0",l.inherits(u,c),u.prototype.processChunk=function(p){this.meta=p.meta,this._pako===null&&this._createPako(),this._pako.push(l.transformTo(d,p.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var p=this;this._pako.onData=function(h){p.push({data:h,meta:p.meta})}},a.compressWorker=function(p){return new u("Deflate",p)},a.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(o,r,a){function i(x,k){var C,w="";for(C=0;C<k;C++)w+=String.fromCharCode(255&x),x>>>=8;return w}function s(x,k,C,w,f,g){var v,_,S=x.file,T=x.compression,P=g!==d.utf8encode,R=l.transformTo("string",g(S.name)),D=l.transformTo("string",d.utf8encode(S.name)),q=S.comment,O=l.transformTo("string",g(q)),E=l.transformTo("string",d.utf8encode(q)),A=D.length!==S.name.length,N=E.length!==q.length,j="",L="",M="",V=S.dir,H=S.date,F={crc32:0,compressedSize:0,uncompressedSize:0};k&&!C||(F.crc32=x.crc32,F.compressedSize=x.compressedSize,F.uncompressedSize=x.uncompressedSize);var G=0;k&&(G|=8),P||!A&&!N||(G|=2048);var B=0,Y=0;V&&(B|=16),f==="UNIX"?(Y=798,B|=function(ie,ce){var pe=ie;return ie||(pe=ce?16893:33204),(65535&pe)<<16}(S.unixPermissions,V)):(Y=20,B|=function(ie){return 63&(ie||0)}(S.dosPermissions)),v=H.getUTCHours(),v<<=6,v|=H.getUTCMinutes(),v<<=5,v|=H.getUTCSeconds()/2,_=H.getUTCFullYear()-1980,_<<=4,_|=H.getUTCMonth()+1,_<<=5,_|=H.getUTCDate(),A&&(L=i(1,1)+i(u(R),4)+D,j+="up"+i(L.length,2)+L),N&&(M=i(1,1)+i(u(O),4)+E,j+="uc"+i(M.length,2)+M);var ee="";return ee+=`
\0`,ee+=i(G,2),ee+=T.magic,ee+=i(v,2),ee+=i(_,2),ee+=i(F.crc32,4),ee+=i(F.compressedSize,4),ee+=i(F.uncompressedSize,4),ee+=i(R.length,2),ee+=i(j.length,2),{fileRecord:p.LOCAL_FILE_HEADER+ee+R+j,dirRecord:p.CENTRAL_FILE_HEADER+i(Y,2)+ee+i(O.length,2)+"\0\0\0\0"+i(B,4)+i(w,4)+R+j+O}}var l=o("../utils"),c=o("../stream/GenericWorker"),d=o("../utf8"),u=o("../crc32"),p=o("../signature");function h(x,k,C,w){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=k,this.zipPlatform=C,this.encodeFileName=w,this.streamFiles=x,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}l.inherits(h,c),h.prototype.push=function(x){var k=x.meta.percent||0,C=this.entriesCount,w=this._sources.length;this.accumulate?this.contentBuffer.push(x):(this.bytesWritten+=x.data.length,c.prototype.push.call(this,{data:x.data,meta:{currentFile:this.currentFile,percent:C?(k+100*(C-w-1))/C:100}}))},h.prototype.openedSource=function(x){this.currentSourceOffset=this.bytesWritten,this.currentFile=x.file.name;var k=this.streamFiles&&!x.file.dir;if(k){var C=s(x,k,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:C.fileRecord,meta:{percent:0}})}else this.accumulate=!0},h.prototype.closedSource=function(x){this.accumulate=!1;var k=this.streamFiles&&!x.file.dir,C=s(x,k,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(C.dirRecord),k)this.push({data:function(w){return p.DATA_DESCRIPTOR+i(w.crc32,4)+i(w.compressedSize,4)+i(w.uncompressedSize,4)}(x),meta:{percent:100}});else for(this.push({data:C.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},h.prototype.flush=function(){for(var x=this.bytesWritten,k=0;k<this.dirRecords.length;k++)this.push({data:this.dirRecords[k],meta:{percent:100}});var C=this.bytesWritten-x,w=function(f,g,v,_,S){var T=l.transformTo("string",S(_));return p.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(f,2)+i(f,2)+i(g,4)+i(v,4)+i(T.length,2)+T}(this.dirRecords.length,C,x,this.zipComment,this.encodeFileName);this.push({data:w,meta:{percent:100}})},h.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},h.prototype.registerPrevious=function(x){this._sources.push(x);var k=this;return x.on("data",function(C){k.processChunk(C)}),x.on("end",function(){k.closedSource(k.previous.streamInfo),k._sources.length?k.prepareNextSource():k.end()}),x.on("error",function(C){k.error(C)}),this},h.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},h.prototype.error=function(x){var k=this._sources;if(!c.prototype.error.call(this,x))return!1;for(var C=0;C<k.length;C++)try{k[C].error(x)}catch{}return!0},h.prototype.lock=function(){c.prototype.lock.call(this);for(var x=this._sources,k=0;k<x.length;k++)x[k].lock()},r.exports=h},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(o,r,a){var i=o("../compressions"),s=o("./ZipFileWorker");a.generateWorker=function(l,c,d){var u=new s(c.streamFiles,d,c.platform,c.encodeFileName),p=0;try{l.forEach(function(h,x){p++;var k=function(g,v){var _=g||v,S=i[_];if(!S)throw new Error(_+" is not a valid compression method !");return S}(x.options.compression,c.compression),C=x.options.compressionOptions||c.compressionOptions||{},w=x.dir,f=x.date;x._compressWorker(k,C).withStreamInfo("file",{name:h,dir:w,date:f,comment:x.comment||"",unixPermissions:x.unixPermissions,dosPermissions:x.dosPermissions}).pipe(u)}),u.entriesCount=p}catch(h){u.error(h)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(o,r,a){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new i;for(var l in this)typeof this[l]!="function"&&(s[l]=this[l]);return s}}(i.prototype=o("./object")).loadAsync=o("./load"),i.support=o("./support"),i.defaults=o("./defaults"),i.version="3.10.1",i.loadAsync=function(s,l){return new i().loadAsync(s,l)},i.external=o("./external"),r.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(o,r,a){var i=o("./utils"),s=o("./external"),l=o("./utf8"),c=o("./zipEntries"),d=o("./stream/Crc32Probe"),u=o("./nodejsUtils");function p(h){return new s.Promise(function(x,k){var C=h.decompressed.getContentWorker().pipe(new d);C.on("error",function(w){k(w)}).on("end",function(){C.streamInfo.crc32!==h.decompressed.crc32?k(new Error("Corrupted zip : CRC32 mismatch")):x()}).resume()})}r.exports=function(h,x){var k=this;return x=i.extend(x||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:l.utf8decode}),u.isNode&&u.isStream(h)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",h,!0,x.optimizedBinaryString,x.base64).then(function(C){var w=new c(x);return w.load(C),w}).then(function(C){var w=[s.Promise.resolve(C)],f=C.files;if(x.checkCRC32)for(var g=0;g<f.length;g++)w.push(p(f[g]));return s.Promise.all(w)}).then(function(C){for(var w=C.shift(),f=w.files,g=0;g<f.length;g++){var v=f[g],_=v.fileNameStr,S=i.resolve(v.fileNameStr);k.file(S,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:x.createFolders}),v.dir||(k.file(S).unsafeOriginalName=_)}return w.zipComment.length&&(k.comment=w.zipComment),k})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(o,r,a){var i=o("../utils"),s=o("../stream/GenericWorker");function l(c,d){s.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(d)}i.inherits(l,s),l.prototype._bindStream=function(c){var d=this;(this._stream=c).pause(),c.on("data",function(u){d.push({data:u,meta:{percent:0}})}).on("error",function(u){d.isPaused?this.generatedError=u:d.error(u)}).on("end",function(){d.isPaused?d._upstreamEnded=!0:d.end()})},l.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},l.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=l},{"../stream/GenericWorker":28,"../utils":32}],13:[function(o,r,a){var i=o("readable-stream").Readable;function s(l,c,d){i.call(this,c),this._helper=l;var u=this;l.on("data",function(p,h){u.push(p)||u._helper.pause(),d&&d(h)}).on("error",function(p){u.emit("error",p)}).on("end",function(){u.push(null)})}o("../utils").inherits(s,i),s.prototype._read=function(){this._helper.resume()},r.exports=s},{"../utils":32,"readable-stream":16}],14:[function(o,r,a){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,s);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,s)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var s=new Buffer(i);return s.fill(0),s},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(o,r,a){function i(S,T,P){var R,D=l.getTypeOf(T),q=l.extend(P||{},u);q.date=q.date||new Date,q.compression!==null&&(q.compression=q.compression.toUpperCase()),typeof q.unixPermissions=="string"&&(q.unixPermissions=parseInt(q.unixPermissions,8)),q.unixPermissions&&16384&q.unixPermissions&&(q.dir=!0),q.dosPermissions&&16&q.dosPermissions&&(q.dir=!0),q.dir&&(S=f(S)),q.createFolders&&(R=w(S))&&g.call(this,R,!0);var O=D==="string"&&q.binary===!1&&q.base64===!1;P&&P.binary!==void 0||(q.binary=!O),(T instanceof p&&T.uncompressedSize===0||q.dir||!T||T.length===0)&&(q.base64=!1,q.binary=!0,T="",q.compression="STORE",D="string");var E=null;E=T instanceof p||T instanceof c?T:k.isNode&&k.isStream(T)?new C(S,T):l.prepareContent(S,T,q.binary,q.optimizedBinaryString,q.base64);var A=new h(S,E,q);this.files[S]=A}var s=o("./utf8"),l=o("./utils"),c=o("./stream/GenericWorker"),d=o("./stream/StreamHelper"),u=o("./defaults"),p=o("./compressedObject"),h=o("./zipObject"),x=o("./generate"),k=o("./nodejsUtils"),C=o("./nodejs/NodejsStreamInputAdapter"),w=function(S){S.slice(-1)==="/"&&(S=S.substring(0,S.length-1));var T=S.lastIndexOf("/");return 0<T?S.substring(0,T):""},f=function(S){return S.slice(-1)!=="/"&&(S+="/"),S},g=function(S,T){return T=T!==void 0?T:u.createFolders,S=f(S),this.files[S]||i.call(this,S,null,{dir:!0,createFolders:T}),this.files[S]};function v(S){return Object.prototype.toString.call(S)==="[object RegExp]"}var _={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(S){var T,P,R;for(T in this.files)R=this.files[T],(P=T.slice(this.root.length,T.length))&&T.slice(0,this.root.length)===this.root&&S(P,R)},filter:function(S){var T=[];return this.forEach(function(P,R){S(P,R)&&T.push(R)}),T},file:function(S,T,P){if(arguments.length!==1)return S=this.root+S,i.call(this,S,T,P),this;if(v(S)){var R=S;return this.filter(function(q,O){return!O.dir&&R.test(q)})}var D=this.files[this.root+S];return D&&!D.dir?D:null},folder:function(S){if(!S)return this;if(v(S))return this.filter(function(D,q){return q.dir&&S.test(D)});var T=this.root+S,P=g.call(this,T),R=this.clone();return R.root=P.name,R},remove:function(S){S=this.root+S;var T=this.files[S];if(T||(S.slice(-1)!=="/"&&(S+="/"),T=this.files[S]),T&&!T.dir)delete this.files[S];else for(var P=this.filter(function(D,q){return q.name.slice(0,S.length)===S}),R=0;R<P.length;R++)delete this.files[P[R].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(S){var T,P={};try{if((P=l.extend(S||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=P.type.toLowerCase(),P.compression=P.compression.toUpperCase(),P.type==="binarystring"&&(P.type="string"),!P.type)throw new Error("No output type specified.");l.checkSupport(P.type),P.platform!=="darwin"&&P.platform!=="freebsd"&&P.platform!=="linux"&&P.platform!=="sunos"||(P.platform="UNIX"),P.platform==="win32"&&(P.platform="DOS");var R=P.comment||this.comment||"";T=x.generateWorker(this,P,R)}catch(D){(T=new c("error")).error(D)}return new d(T,P.type||"string",P.mimeType)},generateAsync:function(S,T){return this.generateInternalStream(S).accumulate(T)},generateNodeStream:function(S,T){return(S=S||{}).type||(S.type="nodebuffer"),this.generateInternalStream(S).toNodejsStream(T)}};r.exports=_},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(o,r,a){r.exports=o("stream")},{stream:void 0}],17:[function(o,r,a){var i=o("./DataReader");function s(l){i.call(this,l);for(var c=0;c<this.data.length;c++)l[c]=255&l[c]}o("../utils").inherits(s,i),s.prototype.byteAt=function(l){return this.data[this.zero+l]},s.prototype.lastIndexOfSignature=function(l){for(var c=l.charCodeAt(0),d=l.charCodeAt(1),u=l.charCodeAt(2),p=l.charCodeAt(3),h=this.length-4;0<=h;--h)if(this.data[h]===c&&this.data[h+1]===d&&this.data[h+2]===u&&this.data[h+3]===p)return h-this.zero;return-1},s.prototype.readAndCheckSignature=function(l){var c=l.charCodeAt(0),d=l.charCodeAt(1),u=l.charCodeAt(2),p=l.charCodeAt(3),h=this.readData(4);return c===h[0]&&d===h[1]&&u===h[2]&&p===h[3]},s.prototype.readData=function(l){if(this.checkOffset(l),l===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=s},{"../utils":32,"./DataReader":18}],18:[function(o,r,a){var i=o("../utils");function s(l){this.data=l,this.length=l.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(l){this.checkIndex(this.index+l)},checkIndex:function(l){if(this.length<this.zero+l||l<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+l+"). Corrupted zip ?")},setIndex:function(l){this.checkIndex(l),this.index=l},skip:function(l){this.setIndex(this.index+l)},byteAt:function(){},readInt:function(l){var c,d=0;for(this.checkOffset(l),c=this.index+l-1;c>=this.index;c--)d=(d<<8)+this.byteAt(c);return this.index+=l,d},readString:function(l){return i.transformTo("string",this.readData(l))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var l=this.readInt(4);return new Date(Date.UTC(1980+(l>>25&127),(l>>21&15)-1,l>>16&31,l>>11&31,l>>5&63,(31&l)<<1))}},r.exports=s},{"../utils":32}],19:[function(o,r,a){var i=o("./Uint8ArrayReader");function s(l){i.call(this,l)}o("../utils").inherits(s,i),s.prototype.readData=function(l){this.checkOffset(l);var c=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(o,r,a){var i=o("./DataReader");function s(l){i.call(this,l)}o("../utils").inherits(s,i),s.prototype.byteAt=function(l){return this.data.charCodeAt(this.zero+l)},s.prototype.lastIndexOfSignature=function(l){return this.data.lastIndexOf(l)-this.zero},s.prototype.readAndCheckSignature=function(l){return l===this.readData(4)},s.prototype.readData=function(l){this.checkOffset(l);var c=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=s},{"../utils":32,"./DataReader":18}],21:[function(o,r,a){var i=o("./ArrayReader");function s(l){i.call(this,l)}o("../utils").inherits(s,i),s.prototype.readData=function(l){if(this.checkOffset(l),l===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(o,r,a){var i=o("../utils"),s=o("../support"),l=o("./ArrayReader"),c=o("./StringReader"),d=o("./NodeBufferReader"),u=o("./Uint8ArrayReader");r.exports=function(p){var h=i.getTypeOf(p);return i.checkSupport(h),h!=="string"||s.uint8array?h==="nodebuffer"?new d(p):s.uint8array?new u(i.transformTo("uint8array",p)):new l(i.transformTo("array",p)):new c(p)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(o,r,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(o,r,a){var i=o("./GenericWorker"),s=o("../utils");function l(c){i.call(this,"ConvertWorker to "+c),this.destType=c}s.inherits(l,i),l.prototype.processChunk=function(c){this.push({data:s.transformTo(this.destType,c.data),meta:c.meta})},r.exports=l},{"../utils":32,"./GenericWorker":28}],25:[function(o,r,a){var i=o("./GenericWorker"),s=o("../crc32");function l(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}o("../utils").inherits(l,i),l.prototype.processChunk=function(c){this.streamInfo.crc32=s(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=l},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(o,r,a){var i=o("../utils"),s=o("./GenericWorker");function l(c){s.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}i.inherits(l,s),l.prototype.processChunk=function(c){if(c){var d=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=d+c.data.length}s.prototype.processChunk.call(this,c)},r.exports=l},{"../utils":32,"./GenericWorker":28}],27:[function(o,r,a){var i=o("../utils"),s=o("./GenericWorker");function l(c){s.call(this,"DataWorker");var d=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){d.dataIsReady=!0,d.data=u,d.max=u&&u.length||0,d.type=i.getTypeOf(u),d.isPaused||d._tickAndRepeat()},function(u){d.error(u)})}i.inherits(l,s),l.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},l.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},l.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},l.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,d=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,d);break;case"uint8array":c=this.data.subarray(this.index,d);break;case"array":case"nodebuffer":c=this.data.slice(this.index,d)}return this.index=d,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=l},{"../utils":32,"./GenericWorker":28}],28:[function(o,r,a){function i(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,l){return this._listeners[s].push(l),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,l){if(this._listeners[s])for(var c=0;c<this._listeners[s].length;c++)this._listeners[s][c].call(this,l)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var l=this;return s.on("data",function(c){l.processChunk(c)}),s.on("end",function(){l.end()}),s.on("error",function(c){l.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,l){return this.extraStreamInfo[s]=l,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},r.exports=i},{}],29:[function(o,r,a){var i=o("../utils"),s=o("./ConvertWorker"),l=o("./GenericWorker"),c=o("../base64"),d=o("../support"),u=o("../external"),p=null;if(d.nodestream)try{p=o("../nodejs/NodejsStreamOutputAdapter")}catch{}function h(k,C){return new u.Promise(function(w,f){var g=[],v=k._internalType,_=k._outputType,S=k._mimeType;k.on("data",function(T,P){g.push(T),C&&C(P)}).on("error",function(T){g=[],f(T)}).on("end",function(){try{var T=function(P,R,D){switch(P){case"blob":return i.newBlob(i.transformTo("arraybuffer",R),D);case"base64":return c.encode(R);default:return i.transformTo(P,R)}}(_,function(P,R){var D,q=0,O=null,E=0;for(D=0;D<R.length;D++)E+=R[D].length;switch(P){case"string":return R.join("");case"array":return Array.prototype.concat.apply([],R);case"uint8array":for(O=new Uint8Array(E),D=0;D<R.length;D++)O.set(R[D],q),q+=R[D].length;return O;case"nodebuffer":return Buffer.concat(R);default:throw new Error("concat : unsupported type '"+P+"'")}}(v,g),S);w(T)}catch(P){f(P)}g=[]}).resume()})}function x(k,C,w){var f=C;switch(C){case"blob":case"arraybuffer":f="uint8array";break;case"base64":f="string"}try{this._internalType=f,this._outputType=C,this._mimeType=w,i.checkSupport(f),this._worker=k.pipe(new s(f)),k.lock()}catch(g){this._worker=new l("error"),this._worker.error(g)}}x.prototype={accumulate:function(k){return h(this,k)},on:function(k,C){var w=this;return k==="data"?this._worker.on(k,function(f){C.call(w,f.data,f.meta)}):this._worker.on(k,function(){i.delay(C,arguments,w)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(k){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:this._outputType!=="nodebuffer"},k)}},r.exports=x},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(o,r,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var i=new ArrayBuffer(0);try{a.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(i),a.blob=s.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!o("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(o,r,a){for(var i=o("./utils"),s=o("./support"),l=o("./nodejsUtils"),c=o("./stream/GenericWorker"),d=new Array(256),u=0;u<256;u++)d[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;d[254]=d[254]=1;function p(){c.call(this,"utf-8 decode"),this.leftOver=null}function h(){c.call(this,"utf-8 encode")}a.utf8encode=function(x){return s.nodebuffer?l.newBufferFrom(x,"utf-8"):function(k){var C,w,f,g,v,_=k.length,S=0;for(g=0;g<_;g++)(64512&(w=k.charCodeAt(g)))==55296&&g+1<_&&(64512&(f=k.charCodeAt(g+1)))==56320&&(w=65536+(w-55296<<10)+(f-56320),g++),S+=w<128?1:w<2048?2:w<65536?3:4;for(C=s.uint8array?new Uint8Array(S):new Array(S),g=v=0;v<S;g++)(64512&(w=k.charCodeAt(g)))==55296&&g+1<_&&(64512&(f=k.charCodeAt(g+1)))==56320&&(w=65536+(w-55296<<10)+(f-56320),g++),w<128?C[v++]=w:(w<2048?C[v++]=192|w>>>6:(w<65536?C[v++]=224|w>>>12:(C[v++]=240|w>>>18,C[v++]=128|w>>>12&63),C[v++]=128|w>>>6&63),C[v++]=128|63&w);return C}(x)},a.utf8decode=function(x){return s.nodebuffer?i.transformTo("nodebuffer",x).toString("utf-8"):function(k){var C,w,f,g,v=k.length,_=new Array(2*v);for(C=w=0;C<v;)if((f=k[C++])<128)_[w++]=f;else if(4<(g=d[f]))_[w++]=65533,C+=g-1;else{for(f&=g===2?31:g===3?15:7;1<g&&C<v;)f=f<<6|63&k[C++],g--;1<g?_[w++]=65533:f<65536?_[w++]=f:(f-=65536,_[w++]=55296|f>>10&1023,_[w++]=56320|1023&f)}return _.length!==w&&(_.subarray?_=_.subarray(0,w):_.length=w),i.applyFromCharCode(_)}(x=i.transformTo(s.uint8array?"uint8array":"array",x))},i.inherits(p,c),p.prototype.processChunk=function(x){var k=i.transformTo(s.uint8array?"uint8array":"array",x.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var C=k;(k=new Uint8Array(C.length+this.leftOver.length)).set(this.leftOver,0),k.set(C,this.leftOver.length)}else k=this.leftOver.concat(k);this.leftOver=null}var w=function(g,v){var _;for((v=v||g.length)>g.length&&(v=g.length),_=v-1;0<=_&&(192&g[_])==128;)_--;return _<0||_===0?v:_+d[g[_]]>v?_:v}(k),f=k;w!==k.length&&(s.uint8array?(f=k.subarray(0,w),this.leftOver=k.subarray(w,k.length)):(f=k.slice(0,w),this.leftOver=k.slice(w,k.length))),this.push({data:a.utf8decode(f),meta:x.meta})},p.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=p,i.inherits(h,c),h.prototype.processChunk=function(x){this.push({data:a.utf8encode(x.data),meta:x.meta})},a.Utf8EncodeWorker=h},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(o,r,a){var i=o("./support"),s=o("./base64"),l=o("./nodejsUtils"),c=o("./external");function d(C){return C}function u(C,w){for(var f=0;f<C.length;++f)w[f]=255&C.charCodeAt(f);return w}o("setimmediate"),a.newBlob=function(C,w){a.checkSupport("blob");try{return new Blob([C],{type:w})}catch{try{var f=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return f.append(C),f.getBlob(w)}catch{throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(C,w,f){var g=[],v=0,_=C.length;if(_<=f)return String.fromCharCode.apply(null,C);for(;v<_;)w==="array"||w==="nodebuffer"?g.push(String.fromCharCode.apply(null,C.slice(v,Math.min(v+f,_)))):g.push(String.fromCharCode.apply(null,C.subarray(v,Math.min(v+f,_)))),v+=f;return g.join("")},stringifyByChar:function(C){for(var w="",f=0;f<C.length;f++)w+=String.fromCharCode(C[f]);return w},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,l.allocBuffer(1)).length===1}catch{return!1}}()}};function h(C){var w=65536,f=a.getTypeOf(C),g=!0;if(f==="uint8array"?g=p.applyCanBeUsed.uint8array:f==="nodebuffer"&&(g=p.applyCanBeUsed.nodebuffer),g)for(;1<w;)try{return p.stringifyByChunk(C,f,w)}catch{w=Math.floor(w/2)}return p.stringifyByChar(C)}function x(C,w){for(var f=0;f<C.length;f++)w[f]=C[f];return w}a.applyFromCharCode=h;var k={};k.string={string:d,array:function(C){return u(C,new Array(C.length))},arraybuffer:function(C){return k.string.uint8array(C).buffer},uint8array:function(C){return u(C,new Uint8Array(C.length))},nodebuffer:function(C){return u(C,l.allocBuffer(C.length))}},k.array={string:h,array:d,arraybuffer:function(C){return new Uint8Array(C).buffer},uint8array:function(C){return new Uint8Array(C)},nodebuffer:function(C){return l.newBufferFrom(C)}},k.arraybuffer={string:function(C){return h(new Uint8Array(C))},array:function(C){return x(new Uint8Array(C),new Array(C.byteLength))},arraybuffer:d,uint8array:function(C){return new Uint8Array(C)},nodebuffer:function(C){return l.newBufferFrom(new Uint8Array(C))}},k.uint8array={string:h,array:function(C){return x(C,new Array(C.length))},arraybuffer:function(C){return C.buffer},uint8array:d,nodebuffer:function(C){return l.newBufferFrom(C)}},k.nodebuffer={string:h,array:function(C){return x(C,new Array(C.length))},arraybuffer:function(C){return k.nodebuffer.uint8array(C).buffer},uint8array:function(C){return x(C,new Uint8Array(C.length))},nodebuffer:d},a.transformTo=function(C,w){if(w=w||"",!C)return w;a.checkSupport(C);var f=a.getTypeOf(w);return k[f][C](w)},a.resolve=function(C){for(var w=C.split("/"),f=[],g=0;g<w.length;g++){var v=w[g];v==="."||v===""&&g!==0&&g!==w.length-1||(v===".."?f.pop():f.push(v))}return f.join("/")},a.getTypeOf=function(C){return typeof C=="string"?"string":Object.prototype.toString.call(C)==="[object Array]"?"array":i.nodebuffer&&l.isBuffer(C)?"nodebuffer":i.uint8array&&C instanceof Uint8Array?"uint8array":i.arraybuffer&&C instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(C){if(!i[C.toLowerCase()])throw new Error(C+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(C){var w,f,g="";for(f=0;f<(C||"").length;f++)g+="\\x"+((w=C.charCodeAt(f))<16?"0":"")+w.toString(16).toUpperCase();return g},a.delay=function(C,w,f){setImmediate(function(){C.apply(f||null,w||[])})},a.inherits=function(C,w){function f(){}f.prototype=w.prototype,C.prototype=new f},a.extend=function(){var C,w,f={};for(C=0;C<arguments.length;C++)for(w in arguments[C])Object.prototype.hasOwnProperty.call(arguments[C],w)&&f[w]===void 0&&(f[w]=arguments[C][w]);return f},a.prepareContent=function(C,w,f,g,v){return c.Promise.resolve(w).then(function(_){return i.blob&&(_ instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(_))!==-1)&&typeof FileReader<"u"?new c.Promise(function(S,T){var P=new FileReader;P.onload=function(R){S(R.target.result)},P.onerror=function(R){T(R.target.error)},P.readAsArrayBuffer(_)}):_}).then(function(_){var S=a.getTypeOf(_);return S?(S==="arraybuffer"?_=a.transformTo("uint8array",_):S==="string"&&(v?_=s.decode(_):f&&g!==!0&&(_=function(T){return u(T,i.uint8array?new Uint8Array(T.length):new Array(T.length))}(_))),_):c.Promise.reject(new Error("Can't read the data of '"+C+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(o,r,a){var i=o("./reader/readerFor"),s=o("./utils"),l=o("./signature"),c=o("./zipEntry"),d=o("./support");function u(p){this.files=[],this.loadOptions=p}u.prototype={checkSignature:function(p){if(!this.reader.readAndCheckSignature(p)){this.reader.index-=4;var h=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(h)+", expected "+s.pretty(p)+")")}},isSignature:function(p,h){var x=this.reader.index;this.reader.setIndex(p);var k=this.reader.readString(4)===h;return this.reader.setIndex(x),k},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var p=this.reader.readData(this.zipCommentLength),h=d.uint8array?"uint8array":"array",x=s.transformTo(h,p);this.zipComment=this.loadOptions.decodeFileName(x)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var p,h,x,k=this.zip64EndOfCentralSize-44;0<k;)p=this.reader.readInt(2),h=this.reader.readInt(4),x=this.reader.readData(h),this.zip64ExtensibleData[p]={id:p,length:h,value:x}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var p,h;for(p=0;p<this.files.length;p++)h=this.files[p],this.reader.setIndex(h.localHeaderOffset),this.checkSignature(l.LOCAL_FILE_HEADER),h.readLocalPart(this.reader),h.handleUTF8(),h.processAttributes()},readCentralDir:function(){var p;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(l.CENTRAL_FILE_HEADER);)(p=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(p);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var p=this.reader.lastIndexOfSignature(l.CENTRAL_DIRECTORY_END);if(p<0)throw this.isSignature(0,l.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(p);var h=p;if(this.checkSignature(l.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(p=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(p),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,l.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var x=this.centralDirOffset+this.centralDirSize;this.zip64&&(x+=20,x+=12+this.zip64EndOfCentralSize);var k=h-x;if(0<k)this.isSignature(h,l.CENTRAL_FILE_HEADER)||(this.reader.zero=k);else if(k<0)throw new Error("Corrupted zip: missing "+Math.abs(k)+" bytes.")},prepareReader:function(p){this.reader=i(p)},load:function(p){this.prepareReader(p),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(o,r,a){var i=o("./reader/readerFor"),s=o("./utils"),l=o("./compressedObject"),c=o("./crc32"),d=o("./utf8"),u=o("./compressions"),p=o("./support");function h(x,k){this.options=x,this.loadOptions=k}h.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(x){var k,C;if(x.skip(22),this.fileNameLength=x.readInt(2),C=x.readInt(2),this.fileName=x.readData(this.fileNameLength),x.skip(C),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((k=function(w){for(var f in u)if(Object.prototype.hasOwnProperty.call(u,f)&&u[f].magic===w)return u[f];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new l(this.compressedSize,this.uncompressedSize,this.crc32,k,x.readData(this.compressedSize))},readCentralPart:function(x){this.versionMadeBy=x.readInt(2),x.skip(2),this.bitFlag=x.readInt(2),this.compressionMethod=x.readString(2),this.date=x.readDate(),this.crc32=x.readInt(4),this.compressedSize=x.readInt(4),this.uncompressedSize=x.readInt(4);var k=x.readInt(2);if(this.extraFieldsLength=x.readInt(2),this.fileCommentLength=x.readInt(2),this.diskNumberStart=x.readInt(2),this.internalFileAttributes=x.readInt(2),this.externalFileAttributes=x.readInt(4),this.localHeaderOffset=x.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");x.skip(k),this.readExtraFields(x),this.parseZIP64ExtraField(x),this.fileComment=x.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var x=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),x==0&&(this.dosPermissions=63&this.externalFileAttributes),x==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var x=i(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=x.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=x.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=x.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=x.readInt(4))}},readExtraFields:function(x){var k,C,w,f=x.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});x.index+4<f;)k=x.readInt(2),C=x.readInt(2),w=x.readData(C),this.extraFields[k]={id:k,length:C,value:w};x.setIndex(f)},handleUTF8:function(){var x=p.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=d.utf8decode(this.fileName),this.fileCommentStr=d.utf8decode(this.fileComment);else{var k=this.findExtraFieldUnicodePath();if(k!==null)this.fileNameStr=k;else{var C=s.transformTo(x,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(C)}var w=this.findExtraFieldUnicodeComment();if(w!==null)this.fileCommentStr=w;else{var f=s.transformTo(x,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(f)}}},findExtraFieldUnicodePath:function(){var x=this.extraFields[28789];if(x){var k=i(x.value);return k.readInt(1)!==1||c(this.fileName)!==k.readInt(4)?null:d.utf8decode(k.readData(x.length-5))}return null},findExtraFieldUnicodeComment:function(){var x=this.extraFields[25461];if(x){var k=i(x.value);return k.readInt(1)!==1||c(this.fileComment)!==k.readInt(4)?null:d.utf8decode(k.readData(x.length-5))}return null}},r.exports=h},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(o,r,a){function i(k,C,w){this.name=k,this.dir=w.dir,this.date=w.date,this.comment=w.comment,this.unixPermissions=w.unixPermissions,this.dosPermissions=w.dosPermissions,this._data=C,this._dataBinary=w.binary,this.options={compression:w.compression,compressionOptions:w.compressionOptions}}var s=o("./stream/StreamHelper"),l=o("./stream/DataWorker"),c=o("./utf8"),d=o("./compressedObject"),u=o("./stream/GenericWorker");i.prototype={internalStream:function(k){var C=null,w="string";try{if(!k)throw new Error("No output type specified.");var f=(w=k.toLowerCase())==="string"||w==="text";w!=="binarystring"&&w!=="text"||(w="string"),C=this._decompressWorker();var g=!this._dataBinary;g&&!f&&(C=C.pipe(new c.Utf8EncodeWorker)),!g&&f&&(C=C.pipe(new c.Utf8DecodeWorker))}catch(v){(C=new u("error")).error(v)}return new s(C,w,"")},async:function(k,C){return this.internalStream(k).accumulate(C)},nodeStream:function(k,C){return this.internalStream(k||"nodebuffer").toNodejsStream(C)},_compressWorker:function(k,C){if(this._data instanceof d&&this._data.compression.magic===k.magic)return this._data.getCompressedWorker();var w=this._decompressWorker();return this._dataBinary||(w=w.pipe(new c.Utf8EncodeWorker)),d.createWorkerFrom(w,k,C)},_decompressWorker:function(){return this._data instanceof d?this._data.getContentWorker():this._data instanceof u?this._data:new l(this._data)}};for(var p=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},x=0;x<p.length;x++)i.prototype[p[x]]=h;r.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(o,r,a){(function(i){var s,l,c=i.MutationObserver||i.WebKitMutationObserver;if(c){var d=0,u=new c(k),p=i.document.createTextNode("");u.observe(p,{characterData:!0}),s=function(){p.data=d=++d%2}}else if(i.setImmediate||i.MessageChannel===void 0)s="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var C=i.document.createElement("script");C.onreadystatechange=function(){k(),C.onreadystatechange=null,C.parentNode.removeChild(C),C=null},i.document.documentElement.appendChild(C)}:function(){setTimeout(k,0)};else{var h=new i.MessageChannel;h.port1.onmessage=k,s=function(){h.port2.postMessage(0)}}var x=[];function k(){var C,w;l=!0;for(var f=x.length;f;){for(w=x,x=[],C=-1;++C<f;)w[C]();f=x.length}l=!1}r.exports=function(C){x.push(C)!==1||l||s()}}).call(this,typeof Ui<"u"?Ui:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(o,r,a){var i=o("immediate");function s(){}var l={},c=["REJECTED"],d=["FULFILLED"],u=["PENDING"];function p(f){if(typeof f!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,f!==s&&C(this,f)}function h(f,g,v){this.promise=f,typeof g=="function"&&(this.onFulfilled=g,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function x(f,g,v){i(function(){var _;try{_=g(v)}catch(S){return l.reject(f,S)}_===f?l.reject(f,new TypeError("Cannot resolve promise with itself")):l.resolve(f,_)})}function k(f){var g=f&&f.then;if(f&&(typeof f=="object"||typeof f=="function")&&typeof g=="function")return function(){g.apply(f,arguments)}}function C(f,g){var v=!1;function _(P){v||(v=!0,l.reject(f,P))}function S(P){v||(v=!0,l.resolve(f,P))}var T=w(function(){g(S,_)});T.status==="error"&&_(T.value)}function w(f,g){var v={};try{v.value=f(g),v.status="success"}catch(_){v.status="error",v.value=_}return v}(r.exports=p).prototype.finally=function(f){if(typeof f!="function")return this;var g=this.constructor;return this.then(function(v){return g.resolve(f()).then(function(){return v})},function(v){return g.resolve(f()).then(function(){throw v})})},p.prototype.catch=function(f){return this.then(null,f)},p.prototype.then=function(f,g){if(typeof f!="function"&&this.state===d||typeof g!="function"&&this.state===c)return this;var v=new this.constructor(s);return this.state!==u?x(v,this.state===d?f:g,this.outcome):this.queue.push(new h(v,f,g)),v},h.prototype.callFulfilled=function(f){l.resolve(this.promise,f)},h.prototype.otherCallFulfilled=function(f){x(this.promise,this.onFulfilled,f)},h.prototype.callRejected=function(f){l.reject(this.promise,f)},h.prototype.otherCallRejected=function(f){x(this.promise,this.onRejected,f)},l.resolve=function(f,g){var v=w(k,g);if(v.status==="error")return l.reject(f,v.value);var _=v.value;if(_)C(f,_);else{f.state=d,f.outcome=g;for(var S=-1,T=f.queue.length;++S<T;)f.queue[S].callFulfilled(g)}return f},l.reject=function(f,g){f.state=c,f.outcome=g;for(var v=-1,_=f.queue.length;++v<_;)f.queue[v].callRejected(g);return f},p.resolve=function(f){return f instanceof this?f:l.resolve(new this(s),f)},p.reject=function(f){var g=new this(s);return l.reject(g,f)},p.all=function(f){var g=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=f.length,_=!1;if(!v)return this.resolve([]);for(var S=new Array(v),T=0,P=-1,R=new this(s);++P<v;)D(f[P],P);return R;function D(q,O){g.resolve(q).then(function(E){S[O]=E,++T!==v||_||(_=!0,l.resolve(R,S))},function(E){_||(_=!0,l.reject(R,E))})}},p.race=function(f){var g=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=f.length,_=!1;if(!v)return this.resolve([]);for(var S=-1,T=new this(s);++S<v;)P=f[S],g.resolve(P).then(function(R){_||(_=!0,l.resolve(T,R))},function(R){_||(_=!0,l.reject(T,R))});var P;return T}},{immediate:36}],38:[function(o,r,a){var i={};(0,o("./lib/utils/common").assign)(i,o("./lib/deflate"),o("./lib/inflate"),o("./lib/zlib/constants")),r.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(o,r,a){var i=o("./zlib/deflate"),s=o("./utils/common"),l=o("./utils/strings"),c=o("./zlib/messages"),d=o("./zlib/zstream"),u=Object.prototype.toString,p=0,h=-1,x=0,k=8;function C(f){if(!(this instanceof C))return new C(f);this.options=s.assign({level:h,method:k,chunkSize:16384,windowBits:15,memLevel:8,strategy:x,to:""},f||{});var g=this.options;g.raw&&0<g.windowBits?g.windowBits=-g.windowBits:g.gzip&&0<g.windowBits&&g.windowBits<16&&(g.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var v=i.deflateInit2(this.strm,g.level,g.method,g.windowBits,g.memLevel,g.strategy);if(v!==p)throw new Error(c[v]);if(g.header&&i.deflateSetHeader(this.strm,g.header),g.dictionary){var _;if(_=typeof g.dictionary=="string"?l.string2buf(g.dictionary):u.call(g.dictionary)==="[object ArrayBuffer]"?new Uint8Array(g.dictionary):g.dictionary,(v=i.deflateSetDictionary(this.strm,_))!==p)throw new Error(c[v]);this._dict_set=!0}}function w(f,g){var v=new C(g);if(v.push(f,!0),v.err)throw v.msg||c[v.err];return v.result}C.prototype.push=function(f,g){var v,_,S=this.strm,T=this.options.chunkSize;if(this.ended)return!1;_=g===~~g?g:g===!0?4:0,typeof f=="string"?S.input=l.string2buf(f):u.call(f)==="[object ArrayBuffer]"?S.input=new Uint8Array(f):S.input=f,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new s.Buf8(T),S.next_out=0,S.avail_out=T),(v=i.deflate(S,_))!==1&&v!==p)return this.onEnd(v),!(this.ended=!0);S.avail_out!==0&&(S.avail_in!==0||_!==4&&_!==2)||(this.options.to==="string"?this.onData(l.buf2binstring(s.shrinkBuf(S.output,S.next_out))):this.onData(s.shrinkBuf(S.output,S.next_out)))}while((0<S.avail_in||S.avail_out===0)&&v!==1);return _===4?(v=i.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===p):_!==2||(this.onEnd(p),!(S.avail_out=0))},C.prototype.onData=function(f){this.chunks.push(f)},C.prototype.onEnd=function(f){f===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg},a.Deflate=C,a.deflate=w,a.deflateRaw=function(f,g){return(g=g||{}).raw=!0,w(f,g)},a.gzip=function(f,g){return(g=g||{}).gzip=!0,w(f,g)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(o,r,a){var i=o("./zlib/inflate"),s=o("./utils/common"),l=o("./utils/strings"),c=o("./zlib/constants"),d=o("./zlib/messages"),u=o("./zlib/zstream"),p=o("./zlib/gzheader"),h=Object.prototype.toString;function x(C){if(!(this instanceof x))return new x(C);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},C||{});var w=this.options;w.raw&&0<=w.windowBits&&w.windowBits<16&&(w.windowBits=-w.windowBits,w.windowBits===0&&(w.windowBits=-15)),!(0<=w.windowBits&&w.windowBits<16)||C&&C.windowBits||(w.windowBits+=32),15<w.windowBits&&w.windowBits<48&&!(15&w.windowBits)&&(w.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var f=i.inflateInit2(this.strm,w.windowBits);if(f!==c.Z_OK)throw new Error(d[f]);this.header=new p,i.inflateGetHeader(this.strm,this.header)}function k(C,w){var f=new x(w);if(f.push(C,!0),f.err)throw f.msg||d[f.err];return f.result}x.prototype.push=function(C,w){var f,g,v,_,S,T,P=this.strm,R=this.options.chunkSize,D=this.options.dictionary,q=!1;if(this.ended)return!1;g=w===~~w?w:w===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof C=="string"?P.input=l.binstring2buf(C):h.call(C)==="[object ArrayBuffer]"?P.input=new Uint8Array(C):P.input=C,P.next_in=0,P.avail_in=P.input.length;do{if(P.avail_out===0&&(P.output=new s.Buf8(R),P.next_out=0,P.avail_out=R),(f=i.inflate(P,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&D&&(T=typeof D=="string"?l.string2buf(D):h.call(D)==="[object ArrayBuffer]"?new Uint8Array(D):D,f=i.inflateSetDictionary(this.strm,T)),f===c.Z_BUF_ERROR&&q===!0&&(f=c.Z_OK,q=!1),f!==c.Z_STREAM_END&&f!==c.Z_OK)return this.onEnd(f),!(this.ended=!0);P.next_out&&(P.avail_out!==0&&f!==c.Z_STREAM_END&&(P.avail_in!==0||g!==c.Z_FINISH&&g!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=l.utf8border(P.output,P.next_out),_=P.next_out-v,S=l.buf2string(P.output,v),P.next_out=_,P.avail_out=R-_,_&&s.arraySet(P.output,P.output,v,_,0),this.onData(S)):this.onData(s.shrinkBuf(P.output,P.next_out)))),P.avail_in===0&&P.avail_out===0&&(q=!0)}while((0<P.avail_in||P.avail_out===0)&&f!==c.Z_STREAM_END);return f===c.Z_STREAM_END&&(g=c.Z_FINISH),g===c.Z_FINISH?(f=i.inflateEnd(this.strm),this.onEnd(f),this.ended=!0,f===c.Z_OK):g!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(P.avail_out=0))},x.prototype.onData=function(C){this.chunks.push(C)},x.prototype.onEnd=function(C){C===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg},a.Inflate=x,a.inflate=k,a.inflateRaw=function(C,w){return(w=w||{}).raw=!0,k(C,w)},a.ungzip=k},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(o,r,a){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(c){for(var d=Array.prototype.slice.call(arguments,1);d.length;){var u=d.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var p in u)u.hasOwnProperty(p)&&(c[p]=u[p])}}return c},a.shrinkBuf=function(c,d){return c.length===d?c:c.subarray?c.subarray(0,d):(c.length=d,c)};var s={arraySet:function(c,d,u,p,h){if(d.subarray&&c.subarray)c.set(d.subarray(u,u+p),h);else for(var x=0;x<p;x++)c[h+x]=d[u+x]},flattenChunks:function(c){var d,u,p,h,x,k;for(d=p=0,u=c.length;d<u;d++)p+=c[d].length;for(k=new Uint8Array(p),d=h=0,u=c.length;d<u;d++)x=c[d],k.set(x,h),h+=x.length;return k}},l={arraySet:function(c,d,u,p,h){for(var x=0;x<p;x++)c[h+x]=d[u+x]},flattenChunks:function(c){return[].concat.apply([],c)}};a.setTyped=function(c){c?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,s)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,l))},a.setTyped(i)},{}],42:[function(o,r,a){var i=o("./common"),s=!0,l=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{l=!1}for(var c=new i.Buf8(256),d=0;d<256;d++)c[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;function u(p,h){if(h<65537&&(p.subarray&&l||!p.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(p,h));for(var x="",k=0;k<h;k++)x+=String.fromCharCode(p[k]);return x}c[254]=c[254]=1,a.string2buf=function(p){var h,x,k,C,w,f=p.length,g=0;for(C=0;C<f;C++)(64512&(x=p.charCodeAt(C)))==55296&&C+1<f&&(64512&(k=p.charCodeAt(C+1)))==56320&&(x=65536+(x-55296<<10)+(k-56320),C++),g+=x<128?1:x<2048?2:x<65536?3:4;for(h=new i.Buf8(g),C=w=0;w<g;C++)(64512&(x=p.charCodeAt(C)))==55296&&C+1<f&&(64512&(k=p.charCodeAt(C+1)))==56320&&(x=65536+(x-55296<<10)+(k-56320),C++),x<128?h[w++]=x:(x<2048?h[w++]=192|x>>>6:(x<65536?h[w++]=224|x>>>12:(h[w++]=240|x>>>18,h[w++]=128|x>>>12&63),h[w++]=128|x>>>6&63),h[w++]=128|63&x);return h},a.buf2binstring=function(p){return u(p,p.length)},a.binstring2buf=function(p){for(var h=new i.Buf8(p.length),x=0,k=h.length;x<k;x++)h[x]=p.charCodeAt(x);return h},a.buf2string=function(p,h){var x,k,C,w,f=h||p.length,g=new Array(2*f);for(x=k=0;x<f;)if((C=p[x++])<128)g[k++]=C;else if(4<(w=c[C]))g[k++]=65533,x+=w-1;else{for(C&=w===2?31:w===3?15:7;1<w&&x<f;)C=C<<6|63&p[x++],w--;1<w?g[k++]=65533:C<65536?g[k++]=C:(C-=65536,g[k++]=55296|C>>10&1023,g[k++]=56320|1023&C)}return u(g,k)},a.utf8border=function(p,h){var x;for((h=h||p.length)>p.length&&(h=p.length),x=h-1;0<=x&&(192&p[x])==128;)x--;return x<0||x===0?h:x+c[p[x]]>h?x:h}},{"./common":41}],43:[function(o,r,a){r.exports=function(i,s,l,c){for(var d=65535&i|0,u=i>>>16&65535|0,p=0;l!==0;){for(l-=p=2e3<l?2e3:l;u=u+(d=d+s[c++]|0)|0,--p;);d%=65521,u%=65521}return d|u<<16|0}},{}],44:[function(o,r,a){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(o,r,a){var i=function(){for(var s,l=[],c=0;c<256;c++){s=c;for(var d=0;d<8;d++)s=1&s?3988292384^s>>>1:s>>>1;l[c]=s}return l}();r.exports=function(s,l,c,d){var u=i,p=d+c;s^=-1;for(var h=d;h<p;h++)s=s>>>8^u[255&(s^l[h])];return-1^s}},{}],46:[function(o,r,a){var i,s=o("../utils/common"),l=o("./trees"),c=o("./adler32"),d=o("./crc32"),u=o("./messages"),p=0,h=4,x=0,k=-2,C=-1,w=4,f=2,g=8,v=9,_=286,S=30,T=19,P=2*_+1,R=15,D=3,q=258,O=q+D+1,E=42,A=113,N=1,j=2,L=3,M=4;function V(I,J){return I.msg=u[J],J}function H(I){return(I<<1)-(4<I?9:0)}function F(I){for(var J=I.length;0<=--J;)I[J]=0}function G(I){var J=I.state,W=J.pending;W>I.avail_out&&(W=I.avail_out),W!==0&&(s.arraySet(I.output,J.pending_buf,J.pending_out,W,I.next_out),I.next_out+=W,J.pending_out+=W,I.total_out+=W,I.avail_out-=W,J.pending-=W,J.pending===0&&(J.pending_out=0))}function B(I,J){l._tr_flush_block(I,0<=I.block_start?I.block_start:-1,I.strstart-I.block_start,J),I.block_start=I.strstart,G(I.strm)}function Y(I,J){I.pending_buf[I.pending++]=J}function ee(I,J){I.pending_buf[I.pending++]=J>>>8&255,I.pending_buf[I.pending++]=255&J}function ie(I,J){var W,U,Q=I.max_chain_length,de=I.strstart,se=I.prev_length,X=I.nice_match,K=I.strstart>I.w_size-O?I.strstart-(I.w_size-O):0,oe=I.window,ne=I.w_mask,le=I.prev,ge=I.strstart+q,we=oe[de+se-1],_e=oe[de+se];I.prev_length>=I.good_match&&(Q>>=2),X>I.lookahead&&(X=I.lookahead);do if(oe[(W=J)+se]===_e&&oe[W+se-1]===we&&oe[W]===oe[de]&&oe[++W]===oe[de+1]){de+=2,W++;do;while(oe[++de]===oe[++W]&&oe[++de]===oe[++W]&&oe[++de]===oe[++W]&&oe[++de]===oe[++W]&&oe[++de]===oe[++W]&&oe[++de]===oe[++W]&&oe[++de]===oe[++W]&&oe[++de]===oe[++W]&&de<ge);if(U=q-(ge-de),de=ge-q,se<U){if(I.match_start=J,X<=(se=U))break;we=oe[de+se-1],_e=oe[de+se]}}while((J=le[J&ne])>K&&--Q!=0);return se<=I.lookahead?se:I.lookahead}function ce(I){var J,W,U,Q,de,se,X,K,oe,ne,le=I.w_size;do{if(Q=I.window_size-I.lookahead-I.strstart,I.strstart>=le+(le-O)){for(s.arraySet(I.window,I.window,le,le,0),I.match_start-=le,I.strstart-=le,I.block_start-=le,J=W=I.hash_size;U=I.head[--J],I.head[J]=le<=U?U-le:0,--W;);for(J=W=le;U=I.prev[--J],I.prev[J]=le<=U?U-le:0,--W;);Q+=le}if(I.strm.avail_in===0)break;if(se=I.strm,X=I.window,K=I.strstart+I.lookahead,oe=Q,ne=void 0,ne=se.avail_in,oe<ne&&(ne=oe),W=ne===0?0:(se.avail_in-=ne,s.arraySet(X,se.input,se.next_in,ne,K),se.state.wrap===1?se.adler=c(se.adler,X,ne,K):se.state.wrap===2&&(se.adler=d(se.adler,X,ne,K)),se.next_in+=ne,se.total_in+=ne,ne),I.lookahead+=W,I.lookahead+I.insert>=D)for(de=I.strstart-I.insert,I.ins_h=I.window[de],I.ins_h=(I.ins_h<<I.hash_shift^I.window[de+1])&I.hash_mask;I.insert&&(I.ins_h=(I.ins_h<<I.hash_shift^I.window[de+D-1])&I.hash_mask,I.prev[de&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=de,de++,I.insert--,!(I.lookahead+I.insert<D)););}while(I.lookahead<O&&I.strm.avail_in!==0)}function pe(I,J){for(var W,U;;){if(I.lookahead<O){if(ce(I),I.lookahead<O&&J===p)return N;if(I.lookahead===0)break}if(W=0,I.lookahead>=D&&(I.ins_h=(I.ins_h<<I.hash_shift^I.window[I.strstart+D-1])&I.hash_mask,W=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart),W!==0&&I.strstart-W<=I.w_size-O&&(I.match_length=ie(I,W)),I.match_length>=D)if(U=l._tr_tally(I,I.strstart-I.match_start,I.match_length-D),I.lookahead-=I.match_length,I.match_length<=I.max_lazy_match&&I.lookahead>=D){for(I.match_length--;I.strstart++,I.ins_h=(I.ins_h<<I.hash_shift^I.window[I.strstart+D-1])&I.hash_mask,W=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart,--I.match_length!=0;);I.strstart++}else I.strstart+=I.match_length,I.match_length=0,I.ins_h=I.window[I.strstart],I.ins_h=(I.ins_h<<I.hash_shift^I.window[I.strstart+1])&I.hash_mask;else U=l._tr_tally(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++;if(U&&(B(I,!1),I.strm.avail_out===0))return N}return I.insert=I.strstart<D-1?I.strstart:D-1,J===h?(B(I,!0),I.strm.avail_out===0?L:M):I.last_lit&&(B(I,!1),I.strm.avail_out===0)?N:j}function ue(I,J){for(var W,U,Q;;){if(I.lookahead<O){if(ce(I),I.lookahead<O&&J===p)return N;if(I.lookahead===0)break}if(W=0,I.lookahead>=D&&(I.ins_h=(I.ins_h<<I.hash_shift^I.window[I.strstart+D-1])&I.hash_mask,W=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart),I.prev_length=I.match_length,I.prev_match=I.match_start,I.match_length=D-1,W!==0&&I.prev_length<I.max_lazy_match&&I.strstart-W<=I.w_size-O&&(I.match_length=ie(I,W),I.match_length<=5&&(I.strategy===1||I.match_length===D&&4096<I.strstart-I.match_start)&&(I.match_length=D-1)),I.prev_length>=D&&I.match_length<=I.prev_length){for(Q=I.strstart+I.lookahead-D,U=l._tr_tally(I,I.strstart-1-I.prev_match,I.prev_length-D),I.lookahead-=I.prev_length-1,I.prev_length-=2;++I.strstart<=Q&&(I.ins_h=(I.ins_h<<I.hash_shift^I.window[I.strstart+D-1])&I.hash_mask,W=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart),--I.prev_length!=0;);if(I.match_available=0,I.match_length=D-1,I.strstart++,U&&(B(I,!1),I.strm.avail_out===0))return N}else if(I.match_available){if((U=l._tr_tally(I,0,I.window[I.strstart-1]))&&B(I,!1),I.strstart++,I.lookahead--,I.strm.avail_out===0)return N}else I.match_available=1,I.strstart++,I.lookahead--}return I.match_available&&(U=l._tr_tally(I,0,I.window[I.strstart-1]),I.match_available=0),I.insert=I.strstart<D-1?I.strstart:D-1,J===h?(B(I,!0),I.strm.avail_out===0?L:M):I.last_lit&&(B(I,!1),I.strm.avail_out===0)?N:j}function re(I,J,W,U,Q){this.good_length=I,this.max_lazy=J,this.nice_length=W,this.max_chain=U,this.func=Q}function $(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*P),this.dyn_dtree=new s.Buf16(2*(2*S+1)),this.bl_tree=new s.Buf16(2*(2*T+1)),F(this.dyn_ltree),F(this.dyn_dtree),F(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(R+1),this.heap=new s.Buf16(2*_+1),F(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*_+1),F(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Z(I){var J;return I&&I.state?(I.total_in=I.total_out=0,I.data_type=f,(J=I.state).pending=0,J.pending_out=0,J.wrap<0&&(J.wrap=-J.wrap),J.status=J.wrap?E:A,I.adler=J.wrap===2?0:1,J.last_flush=p,l._tr_init(J),x):V(I,k)}function te(I){var J=Z(I);return J===x&&function(W){W.window_size=2*W.w_size,F(W.head),W.max_lazy_match=i[W.level].max_lazy,W.good_match=i[W.level].good_length,W.nice_match=i[W.level].nice_length,W.max_chain_length=i[W.level].max_chain,W.strstart=0,W.block_start=0,W.lookahead=0,W.insert=0,W.match_length=W.prev_length=D-1,W.match_available=0,W.ins_h=0}(I.state),J}function ae(I,J,W,U,Q,de){if(!I)return k;var se=1;if(J===C&&(J=6),U<0?(se=0,U=-U):15<U&&(se=2,U-=16),Q<1||v<Q||W!==g||U<8||15<U||J<0||9<J||de<0||w<de)return V(I,k);U===8&&(U=9);var X=new $;return(I.state=X).strm=I,X.wrap=se,X.gzhead=null,X.w_bits=U,X.w_size=1<<X.w_bits,X.w_mask=X.w_size-1,X.hash_bits=Q+7,X.hash_size=1<<X.hash_bits,X.hash_mask=X.hash_size-1,X.hash_shift=~~((X.hash_bits+D-1)/D),X.window=new s.Buf8(2*X.w_size),X.head=new s.Buf16(X.hash_size),X.prev=new s.Buf16(X.w_size),X.lit_bufsize=1<<Q+6,X.pending_buf_size=4*X.lit_bufsize,X.pending_buf=new s.Buf8(X.pending_buf_size),X.d_buf=1*X.lit_bufsize,X.l_buf=3*X.lit_bufsize,X.level=J,X.strategy=de,X.method=W,te(I)}i=[new re(0,0,0,0,function(I,J){var W=65535;for(W>I.pending_buf_size-5&&(W=I.pending_buf_size-5);;){if(I.lookahead<=1){if(ce(I),I.lookahead===0&&J===p)return N;if(I.lookahead===0)break}I.strstart+=I.lookahead,I.lookahead=0;var U=I.block_start+W;if((I.strstart===0||I.strstart>=U)&&(I.lookahead=I.strstart-U,I.strstart=U,B(I,!1),I.strm.avail_out===0)||I.strstart-I.block_start>=I.w_size-O&&(B(I,!1),I.strm.avail_out===0))return N}return I.insert=0,J===h?(B(I,!0),I.strm.avail_out===0?L:M):(I.strstart>I.block_start&&(B(I,!1),I.strm.avail_out),N)}),new re(4,4,8,4,pe),new re(4,5,16,8,pe),new re(4,6,32,32,pe),new re(4,4,16,16,ue),new re(8,16,32,32,ue),new re(8,16,128,128,ue),new re(8,32,128,256,ue),new re(32,128,258,1024,ue),new re(32,258,258,4096,ue)],a.deflateInit=function(I,J){return ae(I,J,g,15,8,0)},a.deflateInit2=ae,a.deflateReset=te,a.deflateResetKeep=Z,a.deflateSetHeader=function(I,J){return I&&I.state?I.state.wrap!==2?k:(I.state.gzhead=J,x):k},a.deflate=function(I,J){var W,U,Q,de;if(!I||!I.state||5<J||J<0)return I?V(I,k):k;if(U=I.state,!I.output||!I.input&&I.avail_in!==0||U.status===666&&J!==h)return V(I,I.avail_out===0?-5:k);if(U.strm=I,W=U.last_flush,U.last_flush=J,U.status===E)if(U.wrap===2)I.adler=0,Y(U,31),Y(U,139),Y(U,8),U.gzhead?(Y(U,(U.gzhead.text?1:0)+(U.gzhead.hcrc?2:0)+(U.gzhead.extra?4:0)+(U.gzhead.name?8:0)+(U.gzhead.comment?16:0)),Y(U,255&U.gzhead.time),Y(U,U.gzhead.time>>8&255),Y(U,U.gzhead.time>>16&255),Y(U,U.gzhead.time>>24&255),Y(U,U.level===9?2:2<=U.strategy||U.level<2?4:0),Y(U,255&U.gzhead.os),U.gzhead.extra&&U.gzhead.extra.length&&(Y(U,255&U.gzhead.extra.length),Y(U,U.gzhead.extra.length>>8&255)),U.gzhead.hcrc&&(I.adler=d(I.adler,U.pending_buf,U.pending,0)),U.gzindex=0,U.status=69):(Y(U,0),Y(U,0),Y(U,0),Y(U,0),Y(U,0),Y(U,U.level===9?2:2<=U.strategy||U.level<2?4:0),Y(U,3),U.status=A);else{var se=g+(U.w_bits-8<<4)<<8;se|=(2<=U.strategy||U.level<2?0:U.level<6?1:U.level===6?2:3)<<6,U.strstart!==0&&(se|=32),se+=31-se%31,U.status=A,ee(U,se),U.strstart!==0&&(ee(U,I.adler>>>16),ee(U,65535&I.adler)),I.adler=1}if(U.status===69)if(U.gzhead.extra){for(Q=U.pending;U.gzindex<(65535&U.gzhead.extra.length)&&(U.pending!==U.pending_buf_size||(U.gzhead.hcrc&&U.pending>Q&&(I.adler=d(I.adler,U.pending_buf,U.pending-Q,Q)),G(I),Q=U.pending,U.pending!==U.pending_buf_size));)Y(U,255&U.gzhead.extra[U.gzindex]),U.gzindex++;U.gzhead.hcrc&&U.pending>Q&&(I.adler=d(I.adler,U.pending_buf,U.pending-Q,Q)),U.gzindex===U.gzhead.extra.length&&(U.gzindex=0,U.status=73)}else U.status=73;if(U.status===73)if(U.gzhead.name){Q=U.pending;do{if(U.pending===U.pending_buf_size&&(U.gzhead.hcrc&&U.pending>Q&&(I.adler=d(I.adler,U.pending_buf,U.pending-Q,Q)),G(I),Q=U.pending,U.pending===U.pending_buf_size)){de=1;break}de=U.gzindex<U.gzhead.name.length?255&U.gzhead.name.charCodeAt(U.gzindex++):0,Y(U,de)}while(de!==0);U.gzhead.hcrc&&U.pending>Q&&(I.adler=d(I.adler,U.pending_buf,U.pending-Q,Q)),de===0&&(U.gzindex=0,U.status=91)}else U.status=91;if(U.status===91)if(U.gzhead.comment){Q=U.pending;do{if(U.pending===U.pending_buf_size&&(U.gzhead.hcrc&&U.pending>Q&&(I.adler=d(I.adler,U.pending_buf,U.pending-Q,Q)),G(I),Q=U.pending,U.pending===U.pending_buf_size)){de=1;break}de=U.gzindex<U.gzhead.comment.length?255&U.gzhead.comment.charCodeAt(U.gzindex++):0,Y(U,de)}while(de!==0);U.gzhead.hcrc&&U.pending>Q&&(I.adler=d(I.adler,U.pending_buf,U.pending-Q,Q)),de===0&&(U.status=103)}else U.status=103;if(U.status===103&&(U.gzhead.hcrc?(U.pending+2>U.pending_buf_size&&G(I),U.pending+2<=U.pending_buf_size&&(Y(U,255&I.adler),Y(U,I.adler>>8&255),I.adler=0,U.status=A)):U.status=A),U.pending!==0){if(G(I),I.avail_out===0)return U.last_flush=-1,x}else if(I.avail_in===0&&H(J)<=H(W)&&J!==h)return V(I,-5);if(U.status===666&&I.avail_in!==0)return V(I,-5);if(I.avail_in!==0||U.lookahead!==0||J!==p&&U.status!==666){var X=U.strategy===2?function(K,oe){for(var ne;;){if(K.lookahead===0&&(ce(K),K.lookahead===0)){if(oe===p)return N;break}if(K.match_length=0,ne=l._tr_tally(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++,ne&&(B(K,!1),K.strm.avail_out===0))return N}return K.insert=0,oe===h?(B(K,!0),K.strm.avail_out===0?L:M):K.last_lit&&(B(K,!1),K.strm.avail_out===0)?N:j}(U,J):U.strategy===3?function(K,oe){for(var ne,le,ge,we,_e=K.window;;){if(K.lookahead<=q){if(ce(K),K.lookahead<=q&&oe===p)return N;if(K.lookahead===0)break}if(K.match_length=0,K.lookahead>=D&&0<K.strstart&&(le=_e[ge=K.strstart-1])===_e[++ge]&&le===_e[++ge]&&le===_e[++ge]){we=K.strstart+q;do;while(le===_e[++ge]&&le===_e[++ge]&&le===_e[++ge]&&le===_e[++ge]&&le===_e[++ge]&&le===_e[++ge]&&le===_e[++ge]&&le===_e[++ge]&&ge<we);K.match_length=q-(we-ge),K.match_length>K.lookahead&&(K.match_length=K.lookahead)}if(K.match_length>=D?(ne=l._tr_tally(K,1,K.match_length-D),K.lookahead-=K.match_length,K.strstart+=K.match_length,K.match_length=0):(ne=l._tr_tally(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++),ne&&(B(K,!1),K.strm.avail_out===0))return N}return K.insert=0,oe===h?(B(K,!0),K.strm.avail_out===0?L:M):K.last_lit&&(B(K,!1),K.strm.avail_out===0)?N:j}(U,J):i[U.level].func(U,J);if(X!==L&&X!==M||(U.status=666),X===N||X===L)return I.avail_out===0&&(U.last_flush=-1),x;if(X===j&&(J===1?l._tr_align(U):J!==5&&(l._tr_stored_block(U,0,0,!1),J===3&&(F(U.head),U.lookahead===0&&(U.strstart=0,U.block_start=0,U.insert=0))),G(I),I.avail_out===0))return U.last_flush=-1,x}return J!==h?x:U.wrap<=0?1:(U.wrap===2?(Y(U,255&I.adler),Y(U,I.adler>>8&255),Y(U,I.adler>>16&255),Y(U,I.adler>>24&255),Y(U,255&I.total_in),Y(U,I.total_in>>8&255),Y(U,I.total_in>>16&255),Y(U,I.total_in>>24&255)):(ee(U,I.adler>>>16),ee(U,65535&I.adler)),G(I),0<U.wrap&&(U.wrap=-U.wrap),U.pending!==0?x:1)},a.deflateEnd=function(I){var J;return I&&I.state?(J=I.state.status)!==E&&J!==69&&J!==73&&J!==91&&J!==103&&J!==A&&J!==666?V(I,k):(I.state=null,J===A?V(I,-3):x):k},a.deflateSetDictionary=function(I,J){var W,U,Q,de,se,X,K,oe,ne=J.length;if(!I||!I.state||(de=(W=I.state).wrap)===2||de===1&&W.status!==E||W.lookahead)return k;for(de===1&&(I.adler=c(I.adler,J,ne,0)),W.wrap=0,ne>=W.w_size&&(de===0&&(F(W.head),W.strstart=0,W.block_start=0,W.insert=0),oe=new s.Buf8(W.w_size),s.arraySet(oe,J,ne-W.w_size,W.w_size,0),J=oe,ne=W.w_size),se=I.avail_in,X=I.next_in,K=I.input,I.avail_in=ne,I.next_in=0,I.input=J,ce(W);W.lookahead>=D;){for(U=W.strstart,Q=W.lookahead-(D-1);W.ins_h=(W.ins_h<<W.hash_shift^W.window[U+D-1])&W.hash_mask,W.prev[U&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=U,U++,--Q;);W.strstart=U,W.lookahead=D-1,ce(W)}return W.strstart+=W.lookahead,W.block_start=W.strstart,W.insert=W.lookahead,W.lookahead=0,W.match_length=W.prev_length=D-1,W.match_available=0,I.next_in=X,I.input=K,I.avail_in=se,W.wrap=de,x},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(o,r,a){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(o,r,a){r.exports=function(i,s){var l,c,d,u,p,h,x,k,C,w,f,g,v,_,S,T,P,R,D,q,O,E,A,N,j;l=i.state,c=i.next_in,N=i.input,d=c+(i.avail_in-5),u=i.next_out,j=i.output,p=u-(s-i.avail_out),h=u+(i.avail_out-257),x=l.dmax,k=l.wsize,C=l.whave,w=l.wnext,f=l.window,g=l.hold,v=l.bits,_=l.lencode,S=l.distcode,T=(1<<l.lenbits)-1,P=(1<<l.distbits)-1;e:do{v<15&&(g+=N[c++]<<v,v+=8,g+=N[c++]<<v,v+=8),R=_[g&T];t:for(;;){if(g>>>=D=R>>>24,v-=D,(D=R>>>16&255)===0)j[u++]=65535&R;else{if(!(16&D)){if(!(64&D)){R=_[(65535&R)+(g&(1<<D)-1)];continue t}if(32&D){l.mode=12;break e}i.msg="invalid literal/length code",l.mode=30;break e}q=65535&R,(D&=15)&&(v<D&&(g+=N[c++]<<v,v+=8),q+=g&(1<<D)-1,g>>>=D,v-=D),v<15&&(g+=N[c++]<<v,v+=8,g+=N[c++]<<v,v+=8),R=S[g&P];n:for(;;){if(g>>>=D=R>>>24,v-=D,!(16&(D=R>>>16&255))){if(!(64&D)){R=S[(65535&R)+(g&(1<<D)-1)];continue n}i.msg="invalid distance code",l.mode=30;break e}if(O=65535&R,v<(D&=15)&&(g+=N[c++]<<v,(v+=8)<D&&(g+=N[c++]<<v,v+=8)),x<(O+=g&(1<<D)-1)){i.msg="invalid distance too far back",l.mode=30;break e}if(g>>>=D,v-=D,(D=u-p)<O){if(C<(D=O-D)&&l.sane){i.msg="invalid distance too far back",l.mode=30;break e}if(A=f,(E=0)===w){if(E+=k-D,D<q){for(q-=D;j[u++]=f[E++],--D;);E=u-O,A=j}}else if(w<D){if(E+=k+w-D,(D-=w)<q){for(q-=D;j[u++]=f[E++],--D;);if(E=0,w<q){for(q-=D=w;j[u++]=f[E++],--D;);E=u-O,A=j}}}else if(E+=w-D,D<q){for(q-=D;j[u++]=f[E++],--D;);E=u-O,A=j}for(;2<q;)j[u++]=A[E++],j[u++]=A[E++],j[u++]=A[E++],q-=3;q&&(j[u++]=A[E++],1<q&&(j[u++]=A[E++]))}else{for(E=u-O;j[u++]=j[E++],j[u++]=j[E++],j[u++]=j[E++],2<(q-=3););q&&(j[u++]=j[E++],1<q&&(j[u++]=j[E++]))}break}}break}}while(c<d&&u<h);c-=q=v>>3,g&=(1<<(v-=q<<3))-1,i.next_in=c,i.next_out=u,i.avail_in=c<d?d-c+5:5-(c-d),i.avail_out=u<h?h-u+257:257-(u-h),l.hold=g,l.bits=v}},{}],49:[function(o,r,a){var i=o("../utils/common"),s=o("./adler32"),l=o("./crc32"),c=o("./inffast"),d=o("./inftrees"),u=1,p=2,h=0,x=-2,k=1,C=852,w=592;function f(E){return(E>>>24&255)+(E>>>8&65280)+((65280&E)<<8)+((255&E)<<24)}function g(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(E){var A;return E&&E.state?(A=E.state,E.total_in=E.total_out=A.total=0,E.msg="",A.wrap&&(E.adler=1&A.wrap),A.mode=k,A.last=0,A.havedict=0,A.dmax=32768,A.head=null,A.hold=0,A.bits=0,A.lencode=A.lendyn=new i.Buf32(C),A.distcode=A.distdyn=new i.Buf32(w),A.sane=1,A.back=-1,h):x}function _(E){var A;return E&&E.state?((A=E.state).wsize=0,A.whave=0,A.wnext=0,v(E)):x}function S(E,A){var N,j;return E&&E.state?(j=E.state,A<0?(N=0,A=-A):(N=1+(A>>4),A<48&&(A&=15)),A&&(A<8||15<A)?x:(j.window!==null&&j.wbits!==A&&(j.window=null),j.wrap=N,j.wbits=A,_(E))):x}function T(E,A){var N,j;return E?(j=new g,(E.state=j).window=null,(N=S(E,A))!==h&&(E.state=null),N):x}var P,R,D=!0;function q(E){if(D){var A;for(P=new i.Buf32(512),R=new i.Buf32(32),A=0;A<144;)E.lens[A++]=8;for(;A<256;)E.lens[A++]=9;for(;A<280;)E.lens[A++]=7;for(;A<288;)E.lens[A++]=8;for(d(u,E.lens,0,288,P,0,E.work,{bits:9}),A=0;A<32;)E.lens[A++]=5;d(p,E.lens,0,32,R,0,E.work,{bits:5}),D=!1}E.lencode=P,E.lenbits=9,E.distcode=R,E.distbits=5}function O(E,A,N,j){var L,M=E.state;return M.window===null&&(M.wsize=1<<M.wbits,M.wnext=0,M.whave=0,M.window=new i.Buf8(M.wsize)),j>=M.wsize?(i.arraySet(M.window,A,N-M.wsize,M.wsize,0),M.wnext=0,M.whave=M.wsize):(j<(L=M.wsize-M.wnext)&&(L=j),i.arraySet(M.window,A,N-j,L,M.wnext),(j-=L)?(i.arraySet(M.window,A,N-j,j,0),M.wnext=j,M.whave=M.wsize):(M.wnext+=L,M.wnext===M.wsize&&(M.wnext=0),M.whave<M.wsize&&(M.whave+=L))),0}a.inflateReset=_,a.inflateReset2=S,a.inflateResetKeep=v,a.inflateInit=function(E){return T(E,15)},a.inflateInit2=T,a.inflate=function(E,A){var N,j,L,M,V,H,F,G,B,Y,ee,ie,ce,pe,ue,re,$,Z,te,ae,I,J,W,U,Q=0,de=new i.Buf8(4),se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!E||!E.state||!E.output||!E.input&&E.avail_in!==0)return x;(N=E.state).mode===12&&(N.mode=13),V=E.next_out,L=E.output,F=E.avail_out,M=E.next_in,j=E.input,H=E.avail_in,G=N.hold,B=N.bits,Y=H,ee=F,J=h;e:for(;;)switch(N.mode){case k:if(N.wrap===0){N.mode=13;break}for(;B<16;){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}if(2&N.wrap&&G===35615){de[N.check=0]=255&G,de[1]=G>>>8&255,N.check=l(N.check,de,2,0),B=G=0,N.mode=2;break}if(N.flags=0,N.head&&(N.head.done=!1),!(1&N.wrap)||(((255&G)<<8)+(G>>8))%31){E.msg="incorrect header check",N.mode=30;break}if((15&G)!=8){E.msg="unknown compression method",N.mode=30;break}if(B-=4,I=8+(15&(G>>>=4)),N.wbits===0)N.wbits=I;else if(I>N.wbits){E.msg="invalid window size",N.mode=30;break}N.dmax=1<<I,E.adler=N.check=1,N.mode=512&G?10:12,B=G=0;break;case 2:for(;B<16;){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}if(N.flags=G,(255&N.flags)!=8){E.msg="unknown compression method",N.mode=30;break}if(57344&N.flags){E.msg="unknown header flags set",N.mode=30;break}N.head&&(N.head.text=G>>8&1),512&N.flags&&(de[0]=255&G,de[1]=G>>>8&255,N.check=l(N.check,de,2,0)),B=G=0,N.mode=3;case 3:for(;B<32;){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}N.head&&(N.head.time=G),512&N.flags&&(de[0]=255&G,de[1]=G>>>8&255,de[2]=G>>>16&255,de[3]=G>>>24&255,N.check=l(N.check,de,4,0)),B=G=0,N.mode=4;case 4:for(;B<16;){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}N.head&&(N.head.xflags=255&G,N.head.os=G>>8),512&N.flags&&(de[0]=255&G,de[1]=G>>>8&255,N.check=l(N.check,de,2,0)),B=G=0,N.mode=5;case 5:if(1024&N.flags){for(;B<16;){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}N.length=G,N.head&&(N.head.extra_len=G),512&N.flags&&(de[0]=255&G,de[1]=G>>>8&255,N.check=l(N.check,de,2,0)),B=G=0}else N.head&&(N.head.extra=null);N.mode=6;case 6:if(1024&N.flags&&(H<(ie=N.length)&&(ie=H),ie&&(N.head&&(I=N.head.extra_len-N.length,N.head.extra||(N.head.extra=new Array(N.head.extra_len)),i.arraySet(N.head.extra,j,M,ie,I)),512&N.flags&&(N.check=l(N.check,j,ie,M)),H-=ie,M+=ie,N.length-=ie),N.length))break e;N.length=0,N.mode=7;case 7:if(2048&N.flags){if(H===0)break e;for(ie=0;I=j[M+ie++],N.head&&I&&N.length<65536&&(N.head.name+=String.fromCharCode(I)),I&&ie<H;);if(512&N.flags&&(N.check=l(N.check,j,ie,M)),H-=ie,M+=ie,I)break e}else N.head&&(N.head.name=null);N.length=0,N.mode=8;case 8:if(4096&N.flags){if(H===0)break e;for(ie=0;I=j[M+ie++],N.head&&I&&N.length<65536&&(N.head.comment+=String.fromCharCode(I)),I&&ie<H;);if(512&N.flags&&(N.check=l(N.check,j,ie,M)),H-=ie,M+=ie,I)break e}else N.head&&(N.head.comment=null);N.mode=9;case 9:if(512&N.flags){for(;B<16;){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}if(G!==(65535&N.check)){E.msg="header crc mismatch",N.mode=30;break}B=G=0}N.head&&(N.head.hcrc=N.flags>>9&1,N.head.done=!0),E.adler=N.check=0,N.mode=12;break;case 10:for(;B<32;){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}E.adler=N.check=f(G),B=G=0,N.mode=11;case 11:if(N.havedict===0)return E.next_out=V,E.avail_out=F,E.next_in=M,E.avail_in=H,N.hold=G,N.bits=B,2;E.adler=N.check=1,N.mode=12;case 12:if(A===5||A===6)break e;case 13:if(N.last){G>>>=7&B,B-=7&B,N.mode=27;break}for(;B<3;){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}switch(N.last=1&G,B-=1,3&(G>>>=1)){case 0:N.mode=14;break;case 1:if(q(N),N.mode=20,A!==6)break;G>>>=2,B-=2;break e;case 2:N.mode=17;break;case 3:E.msg="invalid block type",N.mode=30}G>>>=2,B-=2;break;case 14:for(G>>>=7&B,B-=7&B;B<32;){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}if((65535&G)!=(G>>>16^65535)){E.msg="invalid stored block lengths",N.mode=30;break}if(N.length=65535&G,B=G=0,N.mode=15,A===6)break e;case 15:N.mode=16;case 16:if(ie=N.length){if(H<ie&&(ie=H),F<ie&&(ie=F),ie===0)break e;i.arraySet(L,j,M,ie,V),H-=ie,M+=ie,F-=ie,V+=ie,N.length-=ie;break}N.mode=12;break;case 17:for(;B<14;){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}if(N.nlen=257+(31&G),G>>>=5,B-=5,N.ndist=1+(31&G),G>>>=5,B-=5,N.ncode=4+(15&G),G>>>=4,B-=4,286<N.nlen||30<N.ndist){E.msg="too many length or distance symbols",N.mode=30;break}N.have=0,N.mode=18;case 18:for(;N.have<N.ncode;){for(;B<3;){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}N.lens[se[N.have++]]=7&G,G>>>=3,B-=3}for(;N.have<19;)N.lens[se[N.have++]]=0;if(N.lencode=N.lendyn,N.lenbits=7,W={bits:N.lenbits},J=d(0,N.lens,0,19,N.lencode,0,N.work,W),N.lenbits=W.bits,J){E.msg="invalid code lengths set",N.mode=30;break}N.have=0,N.mode=19;case 19:for(;N.have<N.nlen+N.ndist;){for(;re=(Q=N.lencode[G&(1<<N.lenbits)-1])>>>16&255,$=65535&Q,!((ue=Q>>>24)<=B);){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}if($<16)G>>>=ue,B-=ue,N.lens[N.have++]=$;else{if($===16){for(U=ue+2;B<U;){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}if(G>>>=ue,B-=ue,N.have===0){E.msg="invalid bit length repeat",N.mode=30;break}I=N.lens[N.have-1],ie=3+(3&G),G>>>=2,B-=2}else if($===17){for(U=ue+3;B<U;){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}B-=ue,I=0,ie=3+(7&(G>>>=ue)),G>>>=3,B-=3}else{for(U=ue+7;B<U;){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}B-=ue,I=0,ie=11+(127&(G>>>=ue)),G>>>=7,B-=7}if(N.have+ie>N.nlen+N.ndist){E.msg="invalid bit length repeat",N.mode=30;break}for(;ie--;)N.lens[N.have++]=I}}if(N.mode===30)break;if(N.lens[256]===0){E.msg="invalid code -- missing end-of-block",N.mode=30;break}if(N.lenbits=9,W={bits:N.lenbits},J=d(u,N.lens,0,N.nlen,N.lencode,0,N.work,W),N.lenbits=W.bits,J){E.msg="invalid literal/lengths set",N.mode=30;break}if(N.distbits=6,N.distcode=N.distdyn,W={bits:N.distbits},J=d(p,N.lens,N.nlen,N.ndist,N.distcode,0,N.work,W),N.distbits=W.bits,J){E.msg="invalid distances set",N.mode=30;break}if(N.mode=20,A===6)break e;case 20:N.mode=21;case 21:if(6<=H&&258<=F){E.next_out=V,E.avail_out=F,E.next_in=M,E.avail_in=H,N.hold=G,N.bits=B,c(E,ee),V=E.next_out,L=E.output,F=E.avail_out,M=E.next_in,j=E.input,H=E.avail_in,G=N.hold,B=N.bits,N.mode===12&&(N.back=-1);break}for(N.back=0;re=(Q=N.lencode[G&(1<<N.lenbits)-1])>>>16&255,$=65535&Q,!((ue=Q>>>24)<=B);){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}if(re&&!(240&re)){for(Z=ue,te=re,ae=$;re=(Q=N.lencode[ae+((G&(1<<Z+te)-1)>>Z)])>>>16&255,$=65535&Q,!(Z+(ue=Q>>>24)<=B);){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}G>>>=Z,B-=Z,N.back+=Z}if(G>>>=ue,B-=ue,N.back+=ue,N.length=$,re===0){N.mode=26;break}if(32&re){N.back=-1,N.mode=12;break}if(64&re){E.msg="invalid literal/length code",N.mode=30;break}N.extra=15&re,N.mode=22;case 22:if(N.extra){for(U=N.extra;B<U;){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}N.length+=G&(1<<N.extra)-1,G>>>=N.extra,B-=N.extra,N.back+=N.extra}N.was=N.length,N.mode=23;case 23:for(;re=(Q=N.distcode[G&(1<<N.distbits)-1])>>>16&255,$=65535&Q,!((ue=Q>>>24)<=B);){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}if(!(240&re)){for(Z=ue,te=re,ae=$;re=(Q=N.distcode[ae+((G&(1<<Z+te)-1)>>Z)])>>>16&255,$=65535&Q,!(Z+(ue=Q>>>24)<=B);){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}G>>>=Z,B-=Z,N.back+=Z}if(G>>>=ue,B-=ue,N.back+=ue,64&re){E.msg="invalid distance code",N.mode=30;break}N.offset=$,N.extra=15&re,N.mode=24;case 24:if(N.extra){for(U=N.extra;B<U;){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}N.offset+=G&(1<<N.extra)-1,G>>>=N.extra,B-=N.extra,N.back+=N.extra}if(N.offset>N.dmax){E.msg="invalid distance too far back",N.mode=30;break}N.mode=25;case 25:if(F===0)break e;if(ie=ee-F,N.offset>ie){if((ie=N.offset-ie)>N.whave&&N.sane){E.msg="invalid distance too far back",N.mode=30;break}ce=ie>N.wnext?(ie-=N.wnext,N.wsize-ie):N.wnext-ie,ie>N.length&&(ie=N.length),pe=N.window}else pe=L,ce=V-N.offset,ie=N.length;for(F<ie&&(ie=F),F-=ie,N.length-=ie;L[V++]=pe[ce++],--ie;);N.length===0&&(N.mode=21);break;case 26:if(F===0)break e;L[V++]=N.length,F--,N.mode=21;break;case 27:if(N.wrap){for(;B<32;){if(H===0)break e;H--,G|=j[M++]<<B,B+=8}if(ee-=F,E.total_out+=ee,N.total+=ee,ee&&(E.adler=N.check=N.flags?l(N.check,L,ee,V-ee):s(N.check,L,ee,V-ee)),ee=F,(N.flags?G:f(G))!==N.check){E.msg="incorrect data check",N.mode=30;break}B=G=0}N.mode=28;case 28:if(N.wrap&&N.flags){for(;B<32;){if(H===0)break e;H--,G+=j[M++]<<B,B+=8}if(G!==(4294967295&N.total)){E.msg="incorrect length check",N.mode=30;break}B=G=0}N.mode=29;case 29:J=1;break e;case 30:J=-3;break e;case 31:return-4;case 32:default:return x}return E.next_out=V,E.avail_out=F,E.next_in=M,E.avail_in=H,N.hold=G,N.bits=B,(N.wsize||ee!==E.avail_out&&N.mode<30&&(N.mode<27||A!==4))&&O(E,E.output,E.next_out,ee-E.avail_out)?(N.mode=31,-4):(Y-=E.avail_in,ee-=E.avail_out,E.total_in+=Y,E.total_out+=ee,N.total+=ee,N.wrap&&ee&&(E.adler=N.check=N.flags?l(N.check,L,ee,E.next_out-ee):s(N.check,L,ee,E.next_out-ee)),E.data_type=N.bits+(N.last?64:0)+(N.mode===12?128:0)+(N.mode===20||N.mode===15?256:0),(Y==0&&ee===0||A===4)&&J===h&&(J=-5),J)},a.inflateEnd=function(E){if(!E||!E.state)return x;var A=E.state;return A.window&&(A.window=null),E.state=null,h},a.inflateGetHeader=function(E,A){var N;return E&&E.state&&2&(N=E.state).wrap?((N.head=A).done=!1,h):x},a.inflateSetDictionary=function(E,A){var N,j=A.length;return E&&E.state?(N=E.state).wrap!==0&&N.mode!==11?x:N.mode===11&&s(1,A,j,0)!==N.check?-3:O(E,A,j,j)?(N.mode=31,-4):(N.havedict=1,h):x},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(o,r,a){var i=o("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,p,h,x,k,C,w,f){var g,v,_,S,T,P,R,D,q,O=f.bits,E=0,A=0,N=0,j=0,L=0,M=0,V=0,H=0,F=0,G=0,B=null,Y=0,ee=new i.Buf16(16),ie=new i.Buf16(16),ce=null,pe=0;for(E=0;E<=15;E++)ee[E]=0;for(A=0;A<x;A++)ee[p[h+A]]++;for(L=O,j=15;1<=j&&ee[j]===0;j--);if(j<L&&(L=j),j===0)return k[C++]=20971520,k[C++]=20971520,f.bits=1,0;for(N=1;N<j&&ee[N]===0;N++);for(L<N&&(L=N),E=H=1;E<=15;E++)if(H<<=1,(H-=ee[E])<0)return-1;if(0<H&&(u===0||j!==1))return-1;for(ie[1]=0,E=1;E<15;E++)ie[E+1]=ie[E]+ee[E];for(A=0;A<x;A++)p[h+A]!==0&&(w[ie[p[h+A]]++]=A);if(P=u===0?(B=ce=w,19):u===1?(B=s,Y-=257,ce=l,pe-=257,256):(B=c,ce=d,-1),E=N,T=C,V=A=G=0,_=-1,S=(F=1<<(M=L))-1,u===1&&852<F||u===2&&592<F)return 1;for(;;){for(R=E-V,q=w[A]<P?(D=0,w[A]):w[A]>P?(D=ce[pe+w[A]],B[Y+w[A]]):(D=96,0),g=1<<E-V,N=v=1<<M;k[T+(G>>V)+(v-=g)]=R<<24|D<<16|q|0,v!==0;);for(g=1<<E-1;G&g;)g>>=1;if(g!==0?(G&=g-1,G+=g):G=0,A++,--ee[E]==0){if(E===j)break;E=p[h+w[A]]}if(L<E&&(G&S)!==_){for(V===0&&(V=L),T+=N,H=1<<(M=E-V);M+V<j&&!((H-=ee[M+V])<=0);)M++,H<<=1;if(F+=1<<M,u===1&&852<F||u===2&&592<F)return 1;k[_=G&S]=L<<24|M<<16|T-C|0}}return G!==0&&(k[T+G]=E-V<<24|64<<16|0),f.bits=L,0}},{"../utils/common":41}],51:[function(o,r,a){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(o,r,a){var i=o("../utils/common"),s=0,l=1;function c(Q){for(var de=Q.length;0<=--de;)Q[de]=0}var d=0,u=29,p=256,h=p+1+u,x=30,k=19,C=2*h+1,w=15,f=16,g=7,v=256,_=16,S=17,T=18,P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],R=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],O=new Array(2*(h+2));c(O);var E=new Array(2*x);c(E);var A=new Array(512);c(A);var N=new Array(256);c(N);var j=new Array(u);c(j);var L,M,V,H=new Array(x);function F(Q,de,se,X,K){this.static_tree=Q,this.extra_bits=de,this.extra_base=se,this.elems=X,this.max_length=K,this.has_stree=Q&&Q.length}function G(Q,de){this.dyn_tree=Q,this.max_code=0,this.stat_desc=de}function B(Q){return Q<256?A[Q]:A[256+(Q>>>7)]}function Y(Q,de){Q.pending_buf[Q.pending++]=255&de,Q.pending_buf[Q.pending++]=de>>>8&255}function ee(Q,de,se){Q.bi_valid>f-se?(Q.bi_buf|=de<<Q.bi_valid&65535,Y(Q,Q.bi_buf),Q.bi_buf=de>>f-Q.bi_valid,Q.bi_valid+=se-f):(Q.bi_buf|=de<<Q.bi_valid&65535,Q.bi_valid+=se)}function ie(Q,de,se){ee(Q,se[2*de],se[2*de+1])}function ce(Q,de){for(var se=0;se|=1&Q,Q>>>=1,se<<=1,0<--de;);return se>>>1}function pe(Q,de,se){var X,K,oe=new Array(w+1),ne=0;for(X=1;X<=w;X++)oe[X]=ne=ne+se[X-1]<<1;for(K=0;K<=de;K++){var le=Q[2*K+1];le!==0&&(Q[2*K]=ce(oe[le]++,le))}}function ue(Q){var de;for(de=0;de<h;de++)Q.dyn_ltree[2*de]=0;for(de=0;de<x;de++)Q.dyn_dtree[2*de]=0;for(de=0;de<k;de++)Q.bl_tree[2*de]=0;Q.dyn_ltree[2*v]=1,Q.opt_len=Q.static_len=0,Q.last_lit=Q.matches=0}function re(Q){8<Q.bi_valid?Y(Q,Q.bi_buf):0<Q.bi_valid&&(Q.pending_buf[Q.pending++]=Q.bi_buf),Q.bi_buf=0,Q.bi_valid=0}function $(Q,de,se,X){var K=2*de,oe=2*se;return Q[K]<Q[oe]||Q[K]===Q[oe]&&X[de]<=X[se]}function Z(Q,de,se){for(var X=Q.heap[se],K=se<<1;K<=Q.heap_len&&(K<Q.heap_len&&$(de,Q.heap[K+1],Q.heap[K],Q.depth)&&K++,!$(de,X,Q.heap[K],Q.depth));)Q.heap[se]=Q.heap[K],se=K,K<<=1;Q.heap[se]=X}function te(Q,de,se){var X,K,oe,ne,le=0;if(Q.last_lit!==0)for(;X=Q.pending_buf[Q.d_buf+2*le]<<8|Q.pending_buf[Q.d_buf+2*le+1],K=Q.pending_buf[Q.l_buf+le],le++,X===0?ie(Q,K,de):(ie(Q,(oe=N[K])+p+1,de),(ne=P[oe])!==0&&ee(Q,K-=j[oe],ne),ie(Q,oe=B(--X),se),(ne=R[oe])!==0&&ee(Q,X-=H[oe],ne)),le<Q.last_lit;);ie(Q,v,de)}function ae(Q,de){var se,X,K,oe=de.dyn_tree,ne=de.stat_desc.static_tree,le=de.stat_desc.has_stree,ge=de.stat_desc.elems,we=-1;for(Q.heap_len=0,Q.heap_max=C,se=0;se<ge;se++)oe[2*se]!==0?(Q.heap[++Q.heap_len]=we=se,Q.depth[se]=0):oe[2*se+1]=0;for(;Q.heap_len<2;)oe[2*(K=Q.heap[++Q.heap_len]=we<2?++we:0)]=1,Q.depth[K]=0,Q.opt_len--,le&&(Q.static_len-=ne[2*K+1]);for(de.max_code=we,se=Q.heap_len>>1;1<=se;se--)Z(Q,oe,se);for(K=ge;se=Q.heap[1],Q.heap[1]=Q.heap[Q.heap_len--],Z(Q,oe,1),X=Q.heap[1],Q.heap[--Q.heap_max]=se,Q.heap[--Q.heap_max]=X,oe[2*K]=oe[2*se]+oe[2*X],Q.depth[K]=(Q.depth[se]>=Q.depth[X]?Q.depth[se]:Q.depth[X])+1,oe[2*se+1]=oe[2*X+1]=K,Q.heap[1]=K++,Z(Q,oe,1),2<=Q.heap_len;);Q.heap[--Q.heap_max]=Q.heap[1],function(_e,fe){var he,ye,Se,Te,Ae,Oe,me=fe.dyn_tree,ve=fe.max_code,Ie=fe.stat_desc.static_tree,ke=fe.stat_desc.has_stree,je=fe.stat_desc.extra_bits,Ge=fe.stat_desc.extra_base,be=fe.stat_desc.max_length,Pe=0;for(Te=0;Te<=w;Te++)_e.bl_count[Te]=0;for(me[2*_e.heap[_e.heap_max]+1]=0,he=_e.heap_max+1;he<C;he++)be<(Te=me[2*me[2*(ye=_e.heap[he])+1]+1]+1)&&(Te=be,Pe++),me[2*ye+1]=Te,ve<ye||(_e.bl_count[Te]++,Ae=0,Ge<=ye&&(Ae=je[ye-Ge]),Oe=me[2*ye],_e.opt_len+=Oe*(Te+Ae),ke&&(_e.static_len+=Oe*(Ie[2*ye+1]+Ae)));if(Pe!==0){do{for(Te=be-1;_e.bl_count[Te]===0;)Te--;_e.bl_count[Te]--,_e.bl_count[Te+1]+=2,_e.bl_count[be]--,Pe-=2}while(0<Pe);for(Te=be;Te!==0;Te--)for(ye=_e.bl_count[Te];ye!==0;)ve<(Se=_e.heap[--he])||(me[2*Se+1]!==Te&&(_e.opt_len+=(Te-me[2*Se+1])*me[2*Se],me[2*Se+1]=Te),ye--)}}(Q,de),pe(oe,we,Q.bl_count)}function I(Q,de,se){var X,K,oe=-1,ne=de[1],le=0,ge=7,we=4;for(ne===0&&(ge=138,we=3),de[2*(se+1)+1]=65535,X=0;X<=se;X++)K=ne,ne=de[2*(X+1)+1],++le<ge&&K===ne||(le<we?Q.bl_tree[2*K]+=le:K!==0?(K!==oe&&Q.bl_tree[2*K]++,Q.bl_tree[2*_]++):le<=10?Q.bl_tree[2*S]++:Q.bl_tree[2*T]++,oe=K,we=(le=0)===ne?(ge=138,3):K===ne?(ge=6,3):(ge=7,4))}function J(Q,de,se){var X,K,oe=-1,ne=de[1],le=0,ge=7,we=4;for(ne===0&&(ge=138,we=3),X=0;X<=se;X++)if(K=ne,ne=de[2*(X+1)+1],!(++le<ge&&K===ne)){if(le<we)for(;ie(Q,K,Q.bl_tree),--le!=0;);else K!==0?(K!==oe&&(ie(Q,K,Q.bl_tree),le--),ie(Q,_,Q.bl_tree),ee(Q,le-3,2)):le<=10?(ie(Q,S,Q.bl_tree),ee(Q,le-3,3)):(ie(Q,T,Q.bl_tree),ee(Q,le-11,7));oe=K,we=(le=0)===ne?(ge=138,3):K===ne?(ge=6,3):(ge=7,4)}}c(H);var W=!1;function U(Q,de,se,X){ee(Q,(d<<1)+(X?1:0),3),function(K,oe,ne,le){re(K),Y(K,ne),Y(K,~ne),i.arraySet(K.pending_buf,K.window,oe,ne,K.pending),K.pending+=ne}(Q,de,se)}a._tr_init=function(Q){W||(function(){var de,se,X,K,oe,ne=new Array(w+1);for(K=X=0;K<u-1;K++)for(j[K]=X,de=0;de<1<<P[K];de++)N[X++]=K;for(N[X-1]=K,K=oe=0;K<16;K++)for(H[K]=oe,de=0;de<1<<R[K];de++)A[oe++]=K;for(oe>>=7;K<x;K++)for(H[K]=oe<<7,de=0;de<1<<R[K]-7;de++)A[256+oe++]=K;for(se=0;se<=w;se++)ne[se]=0;for(de=0;de<=143;)O[2*de+1]=8,de++,ne[8]++;for(;de<=255;)O[2*de+1]=9,de++,ne[9]++;for(;de<=279;)O[2*de+1]=7,de++,ne[7]++;for(;de<=287;)O[2*de+1]=8,de++,ne[8]++;for(pe(O,h+1,ne),de=0;de<x;de++)E[2*de+1]=5,E[2*de]=ce(de,5);L=new F(O,P,p+1,h,w),M=new F(E,R,0,x,w),V=new F(new Array(0),D,0,k,g)}(),W=!0),Q.l_desc=new G(Q.dyn_ltree,L),Q.d_desc=new G(Q.dyn_dtree,M),Q.bl_desc=new G(Q.bl_tree,V),Q.bi_buf=0,Q.bi_valid=0,ue(Q)},a._tr_stored_block=U,a._tr_flush_block=function(Q,de,se,X){var K,oe,ne=0;0<Q.level?(Q.strm.data_type===2&&(Q.strm.data_type=function(le){var ge,we=4093624447;for(ge=0;ge<=31;ge++,we>>>=1)if(1&we&&le.dyn_ltree[2*ge]!==0)return s;if(le.dyn_ltree[18]!==0||le.dyn_ltree[20]!==0||le.dyn_ltree[26]!==0)return l;for(ge=32;ge<p;ge++)if(le.dyn_ltree[2*ge]!==0)return l;return s}(Q)),ae(Q,Q.l_desc),ae(Q,Q.d_desc),ne=function(le){var ge;for(I(le,le.dyn_ltree,le.l_desc.max_code),I(le,le.dyn_dtree,le.d_desc.max_code),ae(le,le.bl_desc),ge=k-1;3<=ge&&le.bl_tree[2*q[ge]+1]===0;ge--);return le.opt_len+=3*(ge+1)+5+5+4,ge}(Q),K=Q.opt_len+3+7>>>3,(oe=Q.static_len+3+7>>>3)<=K&&(K=oe)):K=oe=se+5,se+4<=K&&de!==-1?U(Q,de,se,X):Q.strategy===4||oe===K?(ee(Q,2+(X?1:0),3),te(Q,O,E)):(ee(Q,4+(X?1:0),3),function(le,ge,we,_e){var fe;for(ee(le,ge-257,5),ee(le,we-1,5),ee(le,_e-4,4),fe=0;fe<_e;fe++)ee(le,le.bl_tree[2*q[fe]+1],3);J(le,le.dyn_ltree,ge-1),J(le,le.dyn_dtree,we-1)}(Q,Q.l_desc.max_code+1,Q.d_desc.max_code+1,ne+1),te(Q,Q.dyn_ltree,Q.dyn_dtree)),ue(Q),X&&re(Q)},a._tr_tally=function(Q,de,se){return Q.pending_buf[Q.d_buf+2*Q.last_lit]=de>>>8&255,Q.pending_buf[Q.d_buf+2*Q.last_lit+1]=255&de,Q.pending_buf[Q.l_buf+Q.last_lit]=255&se,Q.last_lit++,de===0?Q.dyn_ltree[2*se]++:(Q.matches++,de--,Q.dyn_ltree[2*(N[se]+p+1)]++,Q.dyn_dtree[2*B(de)]++),Q.last_lit===Q.lit_bufsize-1},a._tr_align=function(Q){ee(Q,2,3),ie(Q,v,O),function(de){de.bi_valid===16?(Y(de,de.bi_buf),de.bi_buf=0,de.bi_valid=0):8<=de.bi_valid&&(de.pending_buf[de.pending++]=255&de.bi_buf,de.bi_buf>>=8,de.bi_valid-=8)}(Q)}},{"../utils/common":41}],53:[function(o,r,a){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(o,r,a){(function(i){(function(s,l){if(!s.setImmediate){var c,d,u,p,h=1,x={},k=!1,C=s.document,w=Object.getPrototypeOf&&Object.getPrototypeOf(s);w=w&&w.setTimeout?w:s,c={}.toString.call(s.process)==="[object process]"?function(_){process.nextTick(function(){g(_)})}:function(){if(s.postMessage&&!s.importScripts){var _=!0,S=s.onmessage;return s.onmessage=function(){_=!1},s.postMessage("","*"),s.onmessage=S,_}}()?(p="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",v,!1):s.attachEvent("onmessage",v),function(_){s.postMessage(p+_,"*")}):s.MessageChannel?((u=new MessageChannel).port1.onmessage=function(_){g(_.data)},function(_){u.port2.postMessage(_)}):C&&"onreadystatechange"in C.createElement("script")?(d=C.documentElement,function(_){var S=C.createElement("script");S.onreadystatechange=function(){g(_),S.onreadystatechange=null,d.removeChild(S),S=null},d.appendChild(S)}):function(_){setTimeout(g,0,_)},w.setImmediate=function(_){typeof _!="function"&&(_=new Function(""+_));for(var S=new Array(arguments.length-1),T=0;T<S.length;T++)S[T]=arguments[T+1];var P={callback:_,args:S};return x[h]=P,c(h),h++},w.clearImmediate=f}function f(_){delete x[_]}function g(_){if(k)setTimeout(g,0,_);else{var S=x[_];if(S){k=!0;try{(function(T){var P=T.callback,R=T.args;switch(R.length){case 0:P();break;case 1:P(R[0]);break;case 2:P(R[0],R[1]);break;case 3:P(R[0],R[1],R[2]);break;default:P.apply(l,R)}})(S)}finally{f(_),k=!1}}}}function v(_){_.source===s&&typeof _.data=="string"&&_.data.indexOf(p)===0&&g(+_.data.slice(p.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof Ui<"u"?Ui:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(V1);var bP=V1.exports;const Li=vu(bP),Fg=({value:e,placeholder:t,onChange:o,min:r,className:a,title:i})=>{const s=c=>{const d=parseInt(e,10);let u=isNaN(d)?r||1:d+c;r!==void 0&&u<r&&(u=r),o(u.toString())},l=c=>{const d=c.target.value;if(d===""){o("");return}const u=parseInt(d,10);!isNaN(u)&&r!==void 0&&u<r||o(d)};return n.jsxs("div",{className:`relative flex items-center bg-gray-800 rounded border border-gray-600 h-6 ${a}`,title:i,children:[n.jsx("input",{type:"number",min:r,value:e,placeholder:t,onChange:l,className:"appearance-none w-full h-full bg-transparent text-[10px] text-white text-center focus:outline-none px-1 placeholder-gray-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",onClick:c=>c.stopPropagation(),onMouseDown:c=>c.stopPropagation()}),n.jsxs("div",{className:"flex flex-col h-full border-l border-gray-600 w-3 flex-shrink-0",children:[n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-gray-700 text-gray-400 hover:text-white transition-colors",onClick:c=>{c.stopPropagation(),s(1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-gray-700 text-gray-400 hover:text-white transition-colors border-t border-gray-600",onClick:c=>{c.stopPropagation(),s(-1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})},Qo=160,er=8,CP=({state:e,imageSlots:t,hasInputImages:o,isEditing:r,isStopping:a,isGlobalProcessing:i,totalFrames:s,doneCount:l,currentGeneratingDisplay:c,fullSizeOutputForCopy:d,imageForEditor:u,modelOptions:p,isNanoBanana:h,onUpdateState:x,onRunSelected:k,onDownloadSelected:C,onStartQueue:w,onStop:f,onEdit:g,onOpenEditor:v,onSetOutputToInput:_,onDownload:S,onCopy:T,onSelectAll:P,onSelectNone:R,onInvertSelection:D,onManualRefresh:q,onOutputClick:O,onSequenceOutputClick:E,onCheckOutput:A,onCopyFrame:N,onDownloadFrame:j,onRegenerateFrame:L,onStopFrame:M,getFullSizeImage:V,t:H,upstreamPrompt:F,isTextConnected:G,onEditPrompt:B,onEditInSource:Y})=>{const{isSequenceMode:ee,sequenceOutputs:ie,checkedSequenceOutputIndices:ce,model:pe,autoCrop169:ue,autoDownload:re,checkedInputIndices:$,prompt:Z,outputImage:te,resolution:ae,isSequentialEditingWithPrompts:I,createZip:J}=e,[W,U]=y.useState(""),[Q,de]=y.useState(""),se=y.useRef(null),[X,K]=y.useState(0),[oe,ne]=y.useState(0);y.useEffect(()=>{if(!ee||!se.current)return;const he=new ResizeObserver(ye=>{ye[0]&&ne(ye[0].contentRect.width)});return he.observe(se.current),()=>he.disconnect()},[ee]);const le=y.useMemo(()=>{if(!ee)return{columns:0,totalHeight:0,items:[]};const he=Math.max(0,oe-16),ye=Math.max(1,Math.floor((he+er)/(Qo+er))),Se=I?s:t.length,Ae=Math.ceil(Se/ye)*(Qo+er)+er;return{columns:ye,totalHeight:Ae,totalItems:Se}},[oe,t.length,ee,I,s]),ge=()=>{var Ie;const{columns:he,totalItems:ye}=le,Se=400,Te=Math.max(0,X-Se),Ae=X+(((Ie=se.current)==null?void 0:Ie.clientHeight)||500)+Se,Oe=Math.floor(Te/(Qo+er)),me=Math.ceil(Ae/(Qo+er)),ve=[];for(let ke=Oe;ke<=me;ke++)for(let je=0;je<he;je++){const Ge=ke*he+je;Ge<ye&&ve.push({index:Ge,top:ke*(Qo+er),left:je*(Qo+er)})}return ve},we=()=>{const he=parseInt(W,10),ye=parseInt(Q,10);if(isNaN(he))return;const Se=I?s:t.length,Te=isNaN(ye)?Se:Math.min(ye,Se),Ae=Math.max(1,he);if(Ae>Te)return;const Oe=[];for(let me=Ae-1;me<Te;me++)Oe.push(me);x({checkedSequenceOutputIndices:Oe})},_e=he=>{const ye=parseInt(W,10)||1,Se=5;let Te=Math.ceil(ye/Se);he==="next"?Te++:Te--,Te<1&&(Te=1);const Ae=I?s:t.length,Oe=(Te-1)*Se+1,me=Math.min(Oe+Se-1,Ae);U(Oe.toString()),de(me.toString());const ve=[];for(let Ie=Oe-1;Ie<me;Ie++)ve.push(Ie);x({checkedSequenceOutputIndices:ve})},fe=n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-white/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("rect",{x:"8",y:"8",width:"12",height:"12",rx:"2",ry:"2"}),n.jsx("path",{d:"M16 8V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2"})]});return n.jsxs("div",{className:"h-full flex flex-col space-y-2 flex-grow min-w-0 pl-1",children:[n.jsx("div",{className:"flex justify-between items-center bg-gray-900/50 p-1 rounded-md border border-gray-700",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("label",{className:"text-xs font-medium text-gray-400 pl-1",children:H(ee?"image_sequence.output_images_title":"node.content.outputImage")}),ee&&n.jsxs("div",{className:"text-[10px] text-gray-500 flex space-x-2 border-l border-gray-600 pl-3",children:[n.jsxs("span",{children:["Total: ",n.jsx("span",{className:"text-gray-300",children:s})]}),n.jsxs("span",{className:l>0?"text-cyan-400":"",children:["Done: ",l]}),n.jsxs("span",{className:"text-emerald-400",children:["Selected: ",ce.length]}),r&&n.jsxs("span",{className:"text-cyan-400 animate-pulse",children:["Processing: ",c," of ",s]})]})]})}),ee&&n.jsxs("div",{className:"flex justify-between items-center bg-gray-900/50 p-1 rounded-md border border-gray-700",children:[n.jsx("div",{className:"flex items-center space-x-1 pl-1",children:n.jsxs("div",{className:"flex items-center gap-1 bg-gray-800 rounded p-0.5",children:[n.jsx(Fg,{value:W,onChange:U,placeholder:"1",title:"Start Index",className:"w-12 border-none",min:1}),n.jsx("span",{className:"text-[10px] text-gray-500",children:"-"}),n.jsx(Fg,{value:Q,onChange:de,placeholder:I?s.toString():t.length.toString(),title:"End Index",className:"w-12 border-none",min:1}),n.jsxs("div",{className:"flex items-center ml-1 border-l border-gray-600 pl-1",children:[n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white transition-colors",onClick:he=>{he.stopPropagation(),_e("prev")},title:"Previous 5",children:n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:n.jsx("path",{d:"M15 18l-6-6 6-6"})})}),n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white transition-colors",onClick:he=>{he.stopPropagation(),_e("next")},title:"Next 5",children:n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:n.jsx("path",{d:"M9 18l6-6-6-6"})})})]}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx("button",{onClick:we,className:"p-0.5 text-gray-400 hover:text-white transition-colors",title:"Select Range",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]})}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(Ne,{title:H("image_sequence.select_all"),onClick:P,disabled:s===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${s===0?"text-gray-600":"text-green-400"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(Ne,{title:H("image_sequence.select_none"),onClick:R,disabled:ce.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${ce.length===0?"text-gray-600":"text-red-400"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(Ne,{title:H("image_sequence.invert_selection"),onClick:D,disabled:s===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${s===0?"text-gray-600":"text-gray-300"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Ne,{title:H("image_sequence.run_selected"),onClick:k,disabled:r||ce.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${r||ce.length===0?"text-gray-600":"text-emerald-400"}`,viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),n.jsx(Ne,{title:`${H("image_sequence.download_selected")} (${ce.length})`,onClick:async()=>{var Te,Ae;const he=[...ce].sort((Oe,me)=>Oe-me),Se=new Date().toISOString().split("T")[0];if(J)try{const Oe=Li.default||Li,me=new Oe;for(const ke of he){const je=V(1e3+ke)||((Te=ie[ke])==null?void 0:Te.thumbnail);if(je&&je.startsWith("data:image")){const Ge=String(ke+1).padStart(3,"0"),be=((Ae=je.match(/image\/(png|jpeg|jpg)/))==null?void 0:Ae[1])||"png",Pe=`Image_Editor_Frame_${Ge}.${be}`,Ee=await(await fetch(je)).blob();me.file(Pe,Ee)}}const ve=await me.generateAsync({type:"blob",compression:"STORE"}),Ie=document.createElement("a");Ie.href=URL.createObjectURL(ve),Ie.download=`Image_Editor_Sequence_${Se}.zip`,Ie.click(),URL.revokeObjectURL(Ie.href)}catch(Oe){console.error("ZIP Error",Oe)}else C()},disabled:ce.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${ce.length===0?"text-gray-600":"text-sky-400"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Ne,{title:H("node.action.clear"),onClick:()=>x({sequenceOutputs:[]}),disabled:r||ie.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${r||ie.length===0?"text-gray-600":"text-gray-300 hover:text-white"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Ne,{title:"Force Refresh",onClick:q,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})})]})]}),!ee&&n.jsxs("div",{onClick:O,onWheel:he=>he.stopPropagation(),className:"relative w-full flex-grow bg-gray-900/50 rounded-md flex items-center justify-center overflow-hidden group cursor-pointer",children:[te?n.jsx("img",{src:te,alt:"Output",className:"object-contain w-full h-full",onMouseDown:he=>he.stopPropagation(),draggable:!0,onDragStart:he=>{const ye=d||te;ye&&(he.dataTransfer.setData("application/prompt-modifier-drag-image",ye),he.dataTransfer.effectAllowed="copy",he.stopPropagation())}}):n.jsx("span",{className:"text-gray-400",children:H("node.content.imageHere")}),te&&!r&&n.jsxs("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none gap-4",children:[n.jsx("button",{onClick:he=>{he.stopPropagation(),T()},className:"w-20 h-20 flex items-center justify-center rounded-full bg-black/50 hover:bg-black/60 transition-colors pointer-events-auto","aria-label":H("node.action.copy"),title:H("node.action.copy"),children:fe}),n.jsx("button",{onClick:he=>{he.stopPropagation(),S()},className:"w-20 h-20 flex items-center justify-center rounded-full bg-black/50 hover:bg-black/60 transition-colors pointer-events-auto","aria-label":H("node.action.download"),title:H("node.action.download"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-white/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]}),r&&n.jsxs("div",{className:"absolute inset-0 bg-gray-800/80 flex flex-col items-center justify-center text-white",children:[n.jsxs("svg",{className:"animate-spin h-8 w-8 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n.jsx("span",{className:"mt-2 font-semibold",children:H("node.content.generating")})]}),te&&n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx(Ne,{title:H("node.action.copy"),onClick:he=>{he.stopPropagation(),T()},children:n.jsx(Dt,{})}),n.jsx(Ne,{title:H("node.action.download"),onClick:he=>{he.stopPropagation(),S()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]})]}),ee&&n.jsx("div",{className:"flex-grow min-h-0 flex flex-col space-y-2",children:n.jsx("div",{ref:se,className:"flex-grow bg-gray-900/50 rounded-md overflow-y-auto p-2 custom-scrollbar relative",onScroll:he=>K(he.currentTarget.scrollTop),onWheel:he=>he.stopPropagation(),children:n.jsx("div",{style:{height:le.totalHeight,width:"100%",position:"relative"},children:ge().map(({index:he,top:ye,left:Se})=>{if(!(I||!$||$.includes(he)))return null;const Ae=t[he];if(!Ae&&!I)return null;const Oe=ie[he],me=ce.includes(he),ve=Oe&&Oe.status==="pending",Ie=Oe&&Oe.status==="generating",ke=Oe&&Oe.status==="error",je=Oe&&Oe.status==="done"&&Oe.thumbnail,Ge=V(1e3+he);let be=je?Oe.thumbnail:Ae?Ae.src:null;!je&&I&&!be&&t.length>0&&(be=t[0].src);const Pe=!je&&!ve&&!Ie&&!ke&&be,Ee=Ge||be,Me=I;return n.jsxs("div",{className:"absolute rounded-lg border-2 overflow-hidden cursor-pointer border-gray-700 bg-gray-800 group",style:{top:ye,left:Se,width:Qo,height:Qo},onClick:Fe=>{Fe.stopPropagation(),E(he,Ee||"")},children:[be?n.jsx("img",{src:be,alt:`Output ${he+1}`,className:`w-full h-full object-contain ${Pe?"opacity-60":""}`,draggable:!0,onDragStart:Fe=>{const tt=Ge||be;tt&&(Fe.dataTransfer.setData("application/prompt-modifier-drag-image",tt),Fe.dataTransfer.effectAllowed="copy",Fe.stopPropagation())}}):n.jsxs("div",{className:"w-full h-full flex items-center justify-center text-gray-600 text-xs",children:["Frame ",he+1]}),n.jsx("div",{className:"absolute inset-x-0 top-0 h-12 bg-gradient-to-b from-black/80 to-transparent z-20 pointer-events-none"}),ve&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60",children:n.jsx("span",{className:"text-xs text-gray-400 font-medium",children:H("imageEditor.status.queued")})}),Ie&&n.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/70 z-10",children:[n.jsxs("svg",{className:"animate-spin h-6 w-6 text-cyan-500 mb-1",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n.jsx("span",{className:"text-xs text-white font-medium mb-2",children:H("imageEditor.status.generating")}),n.jsx("button",{onClick:Fe=>{Fe.stopPropagation(),M(Fe,he)},className:"px-2 py-0.5 bg-red-600/90 hover:bg-red-700 text-white text-[10px] font-bold rounded shadow-sm border border-red-500/50",children:"Stop Queue"})]}),ke&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-900/50",children:n.jsx("span",{className:"text-xs text-red-200 font-medium",children:"Error"})}),n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity z-30",children:[n.jsx(Ne,{title:H("node.action.copy"),onClick:Fe=>N(Fe,he),className:"p-1 text-gray-200 hover:text-white rounded hover:bg-gray-600 transition-colors",children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("rect",{x:"8",y:"8",width:"12",height:"12",rx:"2",ry:"2"}),n.jsx("path",{d:"M16 8V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2"})]})}),je&&n.jsx(Ne,{title:H("node.action.download"),onClick:Fe=>j(Fe,he),className:"p-1 text-gray-200 hover:text-white rounded hover:bg-gray-600 transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Ne,{title:H("imageEditor.action.regenerate"),onClick:Fe=>L(Fe,he),disabled:r,className:"p-1 text-gray-200 hover:text-white rounded hover:bg-gray-600 transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})}),Me&&n.jsx(Ne,{title:H(G?"image_sequence.edit_in_source":"image_sequence.edit_prompt"),onClick:Fe=>{Fe.stopPropagation(),G?Y(he):B(he)},className:"p-1 text-gray-200 hover:text-white rounded hover:bg-gray-600 transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]}),n.jsx("div",{className:"absolute top-1 left-1 z-20",onClick:Fe=>{Fe.stopPropagation(),A(he)},children:n.jsx("input",{type:"checkbox",checked:me,readOnly:!0,className:"h-4 w-4 rounded bg-gray-900/50 border-gray-500 text-accent focus:ring-accent cursor-pointer"})}),n.jsxs("div",{className:"absolute bottom-1 left-1 right-1 flex justify-between items-end pointer-events-none z-20",children:[n.jsx("div",{}),n.jsx("div",{className:"bg-black/60 text-white text-[10px] px-1.5 py-0.5 rounded backdrop-blur-sm",children:he+1})]})]},he)})})})}),n.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 mt-2 pt-2 border-t border-gray-700/50",children:[n.jsxs("div",{className:"flex bg-gray-700 rounded-md p-1 space-x-1 h-[36px] flex-shrink-0",children:[n.jsx(ct,{content:"Gemini 2.5 image (Nano banana)",className:"h-full",children:n.jsx("button",{onClick:()=>x({model:"gemini-2.5-flash-image"}),disabled:r,className:`px-2 text-xs font-bold rounded flex items-center transition-colors h-full ${pe==="gemini-2.5-flash-image"?"bg-cyan-600 text-white shadow":"text-gray-400 hover:text-white"}`,children:"Flash"})}),n.jsx(ct,{content:"Gemini 3.0 image (Nano banana pro)",className:"h-full",children:n.jsx("button",{onClick:()=>x({model:"gemini-3-pro-image-preview"}),disabled:r,className:`px-2 text-xs font-bold rounded flex items-center transition-colors h-full ${pe==="gemini-3-pro-image-preview"?"bg-purple-600 text-white shadow":"text-gray-400 hover:text-white"}`,children:"Pro"})})]}),n.jsxs("div",{className:"flex-1 flex space-x-2",children:[r&&ee?n.jsx("button",{onClick:f,className:"flex-1 h-[36px] font-bold text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors",children:H(a?"node.action.stopping":"node.action.stop")}):n.jsx("button",{onClick:ee?k:g,disabled:r||!o&&!I||!(G?F:Z)&&!ee,className:"flex-1 h-[36px] font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",children:H(r?"node.content.editing":ee?"image_sequence.run_selected":"node.content.applyEdit")}),!ee&&n.jsx(ct,{content:"Edit in Canvas",children:n.jsx("button",{onClick:v,disabled:!te&&!u,className:"h-[36px] px-3 font-bold text-white bg-teal-600 rounded-md hover:bg-teal-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})})}),ee&&n.jsx("button",{onClick:C,disabled:ce.length===0,className:"flex-1 h-[36px] py-2 text-sm font-bold text-white bg-sky-600 rounded-md hover:bg-sky-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",children:J?"Download ZIP":`${H("image_sequence.download_selected")} (${ce.length})`})]}),!ee&&te&&n.jsx(Ne,{title:H("node.action.outputToInput"),onClick:_,className:"h-[36px]",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L9.414 11H13a1 1 0 100-2H9.414l1.293-1.293z",clipRule:"evenodd"})})})]})]})},Bg={inputImages:[],inputImagesB:[],prompt:"",outputImage:null,enableOutpainting:!1,outpaintingPrompt:"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.",model:"gemini-2.5-flash-image",aspectRatio:"1:1",enableAspectRatio:!1,autoCrop169:!0,leftPaneWidth:360,topPaneHeight:330,resolution:"1K",isSequenceMode:!1,isSequentialCombinationMode:!1,isSequentialPromptMode:!1,isSequentialEditingWithPrompts:!1,framePrompts:{},sequenceOutputs:[],checkedSequenceOutputIndices:[],autoDownload:!0,createZip:!1,checkedInputIndices:[],selectedSourceFrameIndex:null},xs=280,Gg=300,Gs=330,W1=180,$1=450,Hg=({value:e,placeholder:t,onChange:o,min:r,className:a,title:i})=>{const s=c=>{const d=parseInt(e,10);let u=isNaN(d)?r||1:d+c;r!==void 0&&u<r&&(u=r),o(u.toString())},l=c=>{const d=c.target.value;if(d===""){o("");return}const u=parseInt(d,10);!isNaN(u)&&r!==void 0&&u<r||o(d)};return n.jsxs("div",{className:`relative flex items-center bg-gray-800 rounded border border-gray-600 h-6 ${a}`,title:i,children:[n.jsx("input",{type:"number",min:r,value:e,placeholder:t,onChange:l,className:"appearance-none w-full h-full bg-transparent text-[10px] text-white text-center focus:outline-none px-1 placeholder-gray-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",onClick:c=>c.stopPropagation(),onMouseDown:c=>c.stopPropagation()}),n.jsxs("div",{className:"flex flex-col h-full border-l border-gray-600 w-3 flex-shrink-0",children:[n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-gray-700 text-gray-400 hover:text-white transition-colors",onClick:c=>{c.stopPropagation(),s(1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-gray-700 text-gray-400 hover:text-white transition-colors border-t border-gray-600",onClick:c=>{c.stopPropagation(),s(-1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})},ys=120,Xr=150,tr=4,Ug=({title:e,slots:t,isB:o,isEditing:r,checkedIndices:a,getFullSizeImage:i,onCheck:s,onSelectAll:l,onSelectNone:c,onClear:d,onClick:u,onReorder:p,onRemove:h,onMoveToB:x,onFileClick:k,onDropFiles:C,onDropData:w,onSlotDrop:f,t:g,isSequentialCombinationMode:v,onSetCheckedIndices:_,onInvertSelection:S})=>{const[T,P]=y.useState(!1),[R,D]=y.useState(null),[q,O]=y.useState(""),[E,A]=y.useState(""),[N,j]=y.useState(null),L=y.useRef(null),[M,V]=y.useState(0),[H,F]=y.useState(0);y.useEffect(()=>{if(!L.current)return;const ae=new ResizeObserver(I=>{I[0]&&F(I[0].contentRect.width)});return ae.observe(L.current),()=>ae.disconnect()},[]);const G=y.useMemo(()=>{const ae=Math.max(0,H-8),I=Math.max(1,Math.floor((ae+tr)/(ys+tr))),J=t.length+1,U=Math.ceil(J/I)*(Xr+tr)+tr;return{columns:I,totalHeight:U,totalItems:J}},[H,t.length]),B=()=>{var X;const{columns:ae,totalItems:I}=G,J=400,W=Math.max(0,M-J),U=M+(((X=L.current)==null?void 0:X.clientHeight)||500)+J,Q=Math.floor(W/(Xr+tr)),de=Math.ceil(U/(Xr+tr)),se=[];for(let K=Q;K<=de;K++)for(let oe=0;oe<ae;oe++){const ne=K*ae+oe;ne<I&&se.push({index:ne,top:K*(Xr+tr),left:oe*(ys+tr)})}return se},Y=ae=>{ae.preventDefault(),ae.stopPropagation(),P(!0);const I=document.getElementById("app-container");I&&I.classList.remove("ring-2","ring-cyan-500","ring-inset")},ee=ae=>{ae.preventDefault(),ae.stopPropagation(),P(!0)},ie=ae=>{ae.preventDefault(),ae.stopPropagation(),P(!1)},ce=ae=>{ae.preventDefault(),ae.stopPropagation(),P(!1);const I=ae.dataTransfer.getData("application/prompt-modifier-drag-image");if(I){w(I);return}const J=ae.dataTransfer.getData("image-input-reorder-index");if(J){const W=parseInt(J,10);isNaN(W)||p(W,t.length),j(null);return}if(ae.dataTransfer.files&&ae.dataTransfer.files.length>0){const W=Array.from(ae.dataTransfer.files).filter(U=>U.type.startsWith("image/"));W.length>0&&C(W)}},pe=(ae,I)=>{ae.preventDefault(),ae.stopPropagation(),D(I)},ue=(ae,I)=>{ae.preventDefault(),ae.stopPropagation(),D(null)},re=(ae,I)=>{var Q;ae.preventDefault(),ae.stopPropagation(),D(null);const J=ae.dataTransfer.getData("image-input-reorder-index");if(J){const de=parseInt(J,10);isNaN(de)||p(de,I),j(null);return}const W=ae.dataTransfer.getData("application/prompt-modifier-drag-image");if(W){f(I,W);return}const U=(Q=ae.dataTransfer.files)==null?void 0:Q[0];U&&U.type.startsWith("image/")&&f(I,U)},$=(ae,I)=>{r||(ae.stopPropagation(),j(I),ae.dataTransfer.setData("image-input-reorder-index",I.toString()),ae.dataTransfer.effectAllowed="move")},Z=()=>{if(!_)return;const ae=parseInt(q,10),I=parseInt(E,10);if(isNaN(ae))return;const J=isNaN(I)?t.length:Math.min(I,t.length),W=Math.max(1,ae);if(W>J)return;const U=[];for(let Q=W-1;Q<J;Q++)U.push(Q);_(U)},te=ae=>{const I=parseInt(q,10)||1,J=5;let W=Math.ceil(I/J);ae==="next"?W++:W--,W<1&&(W=1);const U=(W-1)*J+1,Q=Math.min(U+J-1,t.length);if(O(U.toString()),A(Q.toString()),_){const de=[];for(let se=U-1;se<Q;se++)de.push(se);_(de)}};return n.jsxs("div",{className:"flex-1 flex flex-col min-h-0 bg-gray-900/30 p-1 rounded-md border border-gray-700/50",children:[n.jsx("div",{className:"flex flex-col gap-1 mb-1 px-1",children:n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:e}),n.jsx("div",{className:"flex items-center space-x-1",children:o?n.jsx(Ne,{title:g("node.action.clear"),onClick:d,disabled:t.length===0||r,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 ${t.length===0||r?"text-gray-600":"text-gray-300 hover:text-white"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}):n.jsx(n.Fragment,{children:n.jsxs("div",{className:"flex items-center gap-1 bg-gray-800 rounded p-0.5 border border-gray-700 mr-2",children:[n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white transition-colors border-r border-gray-600 pr-1",onClick:ae=>{ae.stopPropagation(),te("prev")},title:"Previous 5",children:n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:n.jsx("path",{d:"M15 18l-6-6 6-6"})})}),n.jsx(Hg,{value:q,onChange:O,placeholder:"1",title:"Start Index",className:"w-10 border-none",min:1}),n.jsx("span",{className:"text-[10px] text-gray-500",children:"-"}),n.jsx(Hg,{value:E,onChange:A,placeholder:t.length.toString(),title:"End Index",className:"w-10 border-none",min:1}),n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white transition-colors border-l border-gray-600 pl-1",onClick:ae=>{ae.stopPropagation(),te("next")},title:"Next 5",children:n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:n.jsx("path",{d:"M9 18l6-6-6-6"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx("button",{onClick:Z,className:"p-0.5 text-gray-400 hover:text-white transition-colors",title:"Select Range",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx(Ne,{title:g("image_sequence.select_all"),onClick:l,disabled:t.length===0||r,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 ${t.length===0||r?"text-gray-600":"text-gray-300 group-hover:text-white"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(Ne,{title:g("image_sequence.select_none"),onClick:c,disabled:!a||a.length===0||r,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 ${!a||a.length===0||r?"text-gray-600":"text-gray-300 group-hover:text-white"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),S&&n.jsx(Ne,{title:g("image_sequence.invert_selection"),onClick:S,disabled:t.length===0||r,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 ${t.length===0||r?"text-gray-600":"text-gray-300"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx(Ne,{title:g("node.action.clear"),onClick:d,disabled:t.length===0||r,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 ${t.length===0||r?"text-gray-600":"text-gray-300 hover:text-white"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})})]})}),n.jsx("div",{ref:L,className:"bg-gray-900/50 rounded-md overflow-y-auto p-1 min-h-0 flex-grow custom-scrollbar relative",onScroll:ae=>V(ae.currentTarget.scrollTop),onWheel:ae=>ae.stopPropagation(),children:n.jsx("div",{style:{height:G.totalHeight,width:"100%",position:"relative"},children:B().map(({index:ae,top:I,left:J})=>{if(ae===t.length)return n.jsx("div",{style:{position:"absolute",top:I,left:J,width:ys,height:Xr},onClick:()=>!r&&k(),onDragEnter:Y,onDragOver:ee,onDragLeave:ie,onDrop:ce,className:`bg-transparent rounded-md flex items-center justify-center cursor-pointer border-2 border-dashed transition-colors ${T?"border-cyan-500 bg-gray-700/50":"border-gray-600 hover:border-cyan-500 hover:bg-gray-700/50"} ${r?"opacity-50 cursor-not-allowed":""}`,children:n.jsxs("div",{className:"text-center text-gray-500",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),n.jsx("span",{className:"text-[10px] mt-1 block",children:g("node.content.dropOrClick")})]})},"placeholder");const W=t[ae],U=o?!0:!a||a.includes(ae),Q=(o?2e3:0)+W.index+1,de=W.type==="local"?i(Q):W.src,se=R===W.index&&(!o||W.type==="local");return n.jsxs("div",{style:{position:"absolute",top:I,left:J,width:ys,height:Xr},className:`relative group border-2 flex flex-col rounded-md overflow-visible bg-gray-800 transition-colors ${se?"border-cyan-500 z-10":"border-gray-700 hover:border-gray-600"}`,onDragOver:X=>pe(X,W.index),onDragLeave:X=>ue(X,W.index),onDrop:X=>re(X,W.index),children:[n.jsxs("div",{className:"h-6 bg-gray-900/80 border-b border-gray-700 flex items-center justify-between px-1 cursor-grab active:cursor-grabbing",draggable:W.type==="local"&&!r,onDragStart:X=>W.type==="local"?$(X,ae):X.preventDefault(),children:[n.jsxs("div",{className:"flex items-center space-x-1",children:[!o&&W.type==="local"&&n.jsx("input",{type:"checkbox",checked:U,disabled:r,readOnly:!0,onClick:X=>{X.stopPropagation(),s(ae)},className:"h-3 w-3 rounded bg-gray-900 border-gray-500 text-accent focus:ring-0 cursor-pointer disabled:opacity-50"}),n.jsxs("span",{className:"text-[10px] font-mono text-gray-400",children:["#",ae+1]})]}),W.type==="local"&&!r&&n.jsxs("div",{className:"flex items-center gap-0.5",children:[n.jsx("button",{onClick:X=>{X.stopPropagation(),p(ae,0)},className:"text-gray-500 hover:text-white p-0.5",title:"Top",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),n.jsx("button",{onClick:X=>{X.stopPropagation(),p(ae,ae-1)},className:"text-gray-500 hover:text-white p-0.5",title:"Up",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M5 15l7-7 7 7"})})}),n.jsx("button",{onClick:X=>{X.stopPropagation(),p(ae,ae+1)},className:"text-gray-500 hover:text-white p-0.5",title:"Down",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M19 9l-7 7-7-7"})})}),n.jsx("button",{onClick:X=>{X.stopPropagation(),p(ae,t.length)},className:"text-gray-500 hover:text-white p-0.5",title:"Bottom",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-700 mx-0.5"}),n.jsx("button",{onClick:X=>{X.stopPropagation(),h(W.index)},className:"text-gray-500 hover:text-red-400 p-0.5",title:"Remove",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})]}),n.jsxs("div",{className:"flex-grow relative cursor-pointer overflow-hidden bg-black/40",onClick:()=>u(ae),children:[W.src?n.jsx("img",{src:W.src||"",alt:`Input ${ae+1}`,className:`object-contain w-full h-full ${!U&&W.type==="local"?"opacity-50":""}`,onMouseDown:X=>X.stopPropagation(),draggable:!0,onDragStart:X=>{const K=de||W.src;K&&(X.dataTransfer.setData("application/prompt-modifier-drag-image",K),X.dataTransfer.effectAllowed="copy",X.stopPropagation())}}):n.jsx("div",{className:"w-full h-full bg-gray-800 flex items-center justify-center text-gray-600 text-xs",children:"No Image"}),W.type==="connected"&&n.jsx("div",{className:"absolute top-1 right-1 pointer-events-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-400 drop-shadow-md",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),!o&&v&&x&&W.type==="local"&&n.jsx("button",{onClick:X=>{X.stopPropagation(),x(W.index)},disabled:r,className:"absolute bottom-1 right-1 p-1 bg-gray-900/80 rounded text-gray-300 hover:text-cyan-400 opacity-0 group-hover:opacity-100 transition-opacity",title:"Move to Input B",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})})]})]},`${W.type}-${o?"b":"a"}-${W.index}`)})})})]})},Zt=({checked:e,onChange:t,label:o,disabled:r=!1,className:a="",title:i,id:s})=>n.jsxs("div",{id:s,className:`flex items-center space-x-2 cursor-pointer group select-none ${r?"opacity-50 cursor-not-allowed":""} ${a}`,onClick:l=>{l.stopPropagation(),r||t(!e,l)},onMouseDown:l=>l.stopPropagation(),title:i,children:[n.jsx("div",{className:`
                w-4 h-4 min-w-[1rem] min-h-[1rem] rounded border flex items-center justify-center transition-all duration-200 ease-in-out flex-shrink-0 relative
                ${e?"bg-accent border-accent shadow-[0_0_8px_var(--color-accent)]":"bg-gray-800 border-gray-600 group-hover:border-gray-500"}
            `,children:n.jsx("svg",{className:`w-3 h-3 text-white pointer-events-none block transition-transform duration-200 ${e?"scale-100":"scale-0"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,style:{transformOrigin:"center"},children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),o&&n.jsx("span",{className:`text-sm leading-tight pt-[1px] transition-colors ${e?"text-gray-200":"text-gray-400"} group-hover:text-gray-300`,children:o})]}),kP=({state:e,onUpdateState:t,onCleanupInputB:o,isEditing:r,t:a,nodeId:i,deselectAllNodes:s})=>{const{isSequenceMode:l,isSequentialCombinationMode:c,isSequentialPromptMode:d,isSequentialEditingWithPrompts:u,enableAspectRatio:p,aspectRatio:h,enableOutpainting:x,outpaintingPrompt:k}=e,C=y.useMemo(()=>[{value:"Auto",label:"Auto",icon:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})},{value:"1:1",label:"1:1",icon:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"5",y:"5",width:"14",height:"14",rx:"1"})})},{value:"16:9",label:"16:9",icon:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"2",y:"8",width:"20",height:"8",rx:"1"})})},{value:"9:16",label:"9:16",icon:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"8",y:"2",width:"8",height:"20",rx:"1"})})},{value:"4:3",label:"4:3",icon:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"3",y:"6",width:"18",height:"12",rx:"1"})})},{value:"3:4",label:"3:4",icon:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"6",y:"3",width:"12",height:"18",rx:"1"})})}],[]);return n.jsxs("div",{className:"flex-shrink-0 space-y-2",children:[n.jsxs("div",{className:"flex flex-col space-y-2",children:[n.jsx(Zt,{id:`sequence-mode-toggle-${i}`,checked:l,onChange:w=>{w||o(),t({isSequenceMode:w})},disabled:r,label:a("imageEditor.sequenceMode"),title:a("imageEditor.sequenceModeHelp")}),l&&n.jsxs("div",{className:"ml-6 flex flex-col space-y-1.5",children:[n.jsx(Zt,{id:`seq-combo-toggle-${i}`,checked:c,onChange:w=>{w?t({isSequentialCombinationMode:!0}):(o(),t({isSequentialCombinationMode:!1,isSequentialEditingWithPrompts:!1}))},disabled:r,label:a("imageEditor.sequentialCombination"),title:a("imageEditor.sequentialCombinationHelp")}),n.jsx(Zt,{id:`seq-prompt-toggle-${i}`,checked:d,onChange:w=>t({isSequentialPromptMode:w}),disabled:r,label:a("imageEditor.sequentialPrompt"),title:a("imageEditor.sequentialPromptHelp")}),n.jsx(Zt,{id:`seq-edit-prompts-toggle-${i}`,checked:u,onChange:w=>{t(w?{isSequentialEditingWithPrompts:!0,isSequentialCombinationMode:!1,isSequentialPromptMode:!0}:{isSequentialEditingWithPrompts:!1})},disabled:r,label:a("imageEditor.sequentialEditingWithPrompts"),title:a("imageEditor.sequentialEditingWithPromptsHelp")})]})]}),n.jsx(Zt,{id:`aspect-ratio-toggle-${i}`,checked:p,onChange:w=>{t({enableAspectRatio:w,aspectRatio:"Auto",enableOutpainting:w?x:!1})},label:a("node.content.enableAspectRatioFormatting")}),p&&n.jsx(n.Fragment,{children:n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:a("node.content.aspectRatio")}),n.jsx(Mn,{value:h||"1:1",onChange:w=>t({aspectRatio:w}),disabled:r,options:C})]})})]})},_P=y.forwardRef(({totalFrames:e,framePrompts:t,globalPrompt:o,onChange:r,upstreamPrompts:a,t:i,visibleIndices:s,onAddFrame:l,onSync:c,onDeleteFrame:d,onMoveFrame:u,onSelectFrame:p,onClearAll:h,selectedFrameIndex:x},k)=>{const C=y.useRef(null),w=y.useRef([]),f=a&&a.size>0;y.useImperativeHandle(k,()=>({scrollToIndex:_=>{const S=w.current[_];if(S&&C.current){const T=C.current,P=S.offsetTop,R=P+S.offsetHeight,D=T.scrollTop,q=D+T.clientHeight;(P<D||R>q)&&S.scrollIntoView({behavior:"smooth",block:"center"})}}}));const g=Array.from({length:Math.max(1,e)},(_,S)=>S),v=s?g.filter(_=>s.includes(_)):g;return n.jsxs("div",{className:"flex-grow flex flex-col bg-gray-900/30 rounded-md border border-gray-700/50 overflow-hidden h-full",children:[n.jsxs("div",{className:"flex justify-between items-center p-1 bg-gray-800/80 border-b border-gray-700/50 flex-shrink-0",children:[n.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase px-1",children:i("prompt_sequence_editor.sourcePrompts")||"Source Prompts"}),f?n.jsx("div",{className:"flex items-center",children:n.jsx(Ne,{title:"Copy Upstream Prompts to Local",onClick:_=>{_.stopPropagation(),c&&c()},className:"p-1 hover:bg-cyan-900/50 rounded text-cyan-400 hover:text-cyan-200 transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})})}):n.jsxs("div",{className:"flex items-center space-x-1",children:[d&&n.jsx(Ne,{title:"Delete Selected Frame",onClick:_=>{_.stopPropagation(),x!=null&&d(x)},disabled:x==null,className:`p-1 rounded transition-colors ${x!=null?"hover:bg-red-900/50 text-gray-400 hover:text-red-400":"text-gray-600 cursor-not-allowed"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),h&&n.jsx(Ne,{title:"Clear All Prompts",onClick:_=>{_.stopPropagation(),h()},className:"p-1 hover:bg-red-900/50 rounded text-gray-500 hover:text-red-500 transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),l&&n.jsx("button",{onClick:_=>{_.stopPropagation(),l()},className:"p-1 hover:bg-gray-700 rounded text-cyan-400 hover:text-white transition-colors",title:"Add Prompt Slot",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]})]}),n.jsxs("div",{ref:C,className:"overflow-y-auto custom-scrollbar p-2 space-y-2 flex-grow min-h-0",onWheel:_=>_.stopPropagation(),children:[v.map(_=>{const S=a==null?void 0:a.get(_+1),T=t[_],P=f?S||"":T!==void 0?T:o,R=!f&&T===void 0&&!!o,D=x===_;return n.jsxs("div",{ref:q=>{w.current[_]=q},className:`flex flex-col bg-gray-800 rounded border transition-colors ${D?"border-cyan-500 ring-1 ring-cyan-500":"border-gray-700"}`,onClick:()=>p&&p(_),children:[n.jsxs("div",{className:"flex items-center justify-between px-2 py-1 bg-gray-700/50 border-b border-gray-600/30 h-7",children:[n.jsxs("span",{className:"text-[10px] font-bold text-gray-400 uppercase",children:["Frame ",_+1]}),!f&&u&&d&&n.jsxs("div",{className:"flex items-center space-x-0.5",children:[n.jsx("button",{onClick:q=>{q.stopPropagation(),u(_,0)},className:"p-0.5 text-gray-500 hover:text-white rounded",title:"Move to Top",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),n.jsx("button",{onClick:q=>{q.stopPropagation(),u(_,_-1)},disabled:_===0,className:"p-0.5 text-gray-500 hover:text-white rounded disabled:opacity-30",title:"Move Up",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M5 15l7-7 7 7"})})}),n.jsx("button",{onClick:q=>{q.stopPropagation(),u(_,_+1)},disabled:_===e-1,className:"p-0.5 text-gray-500 hover:text-white rounded disabled:opacity-30",title:"Move Down",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M19 9l-7 7-7-7"})})}),n.jsx("button",{onClick:q=>{q.stopPropagation(),u(_,e)},className:"p-0.5 text-gray-500 hover:text-white rounded",title:"Move to Bottom",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx("button",{onClick:q=>{q.stopPropagation(),d(_)},className:"p-0.5 text-gray-500 hover:text-red-400 rounded",title:"Delete Frame",children:n.jsx("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})]}),n.jsx(hn,{value:P,onDebouncedChange:q=>!f&&r(_,q),placeholder:o||i("node.content.editPromptPlaceholder"),className:`w-full p-2 bg-transparent border-none rounded-b resize-none focus:outline-none text-xs min-h-[60px] ${R?"text-gray-500 italic":"text-gray-200"}`,readOnly:f,onWheel:q=>q.stopPropagation(),onMouseDown:q=>q.stopPropagation()})]},_)}),e===0&&n.jsx("div",{className:"text-center text-gray-500 text-xs py-4",children:"Add input images or prompts to define frames."})]})]})}),SP=y.forwardRef(({nodeId:e,state:t,leftPaneWidth:o,viewScale:r,imageSlots:a,imageSlotsB:i,onUpdateState:s,onCleanupInputB:l,inputListActions:c,previewElement:d,libraryItems:u,upstreamPrompt:p,upstreamPromptsMap:h,isTextConnected:x,isInputConnected:k,isEditing:C,seqTotalFrames:w,handleDetachAndPasteInput:f,handleManualRefresh:g,t:v,deselectAllNodes:_,onSyncPrompts:S,onDeleteFrame:T,onMoveFrame:P,onSelectFrame:R,onClearFrames:D,selectedFrameIndex:q},O)=>{const{topPaneHeight:E,inputImages:A,inputImagesB:N,checkedInputIndices:j,isSequenceMode:L,isSequentialCombinationMode:M,isSequentialPromptMode:V,isSequentialEditingWithPrompts:H,enableAspectRatio:F,framePrompts:G,prompt:B,enableOutpainting:Y,outpaintingPrompt:ee}=t,ie=y.useRef(null),{getFullSizeImage:ce,onCheck:pe,onSelectAll:ue,onSelectNone:re,onClear:$,onClick:Z,onMove:te,onRemove:ae,onMoveToB:I,onFileClick:J,onDropFiles:W,onDropData:U,onSlotDrop:Q}=c,de=t.model==="gemini-3-pro-image-preview"?8:4,se=v("node.content.inputImage"),X=v(L&&M?"imageEditor.inputA":"imageEditor.input"),K=`${v("imageEditor.inputB")} (Max ${de-1})`,oe=y.useCallback(ne=>{ne.preventDefault(),ne.stopPropagation();const le=ne.clientY,ge=E,we=r,_e=he=>{const ye=(he.clientY-le)/we;if(ie.current){const Se=ie.current.offsetHeight,Te=F?$1:W1,Ae=Math.max(Gs,Math.min(ge+ye,Se-Te));s({topPaneHeight:Ae})}},fe=()=>{window.removeEventListener("mousemove",_e),window.removeEventListener("mouseup",fe)};window.addEventListener("mousemove",_e),window.addEventListener("mouseup",fe)},[E,s,r,F]);return n.jsxs("div",{ref:ie,style:{width:`${o}px`},className:"h-full flex flex-col flex-shrink-0 pr-1",children:[n.jsxs("div",{className:"flex flex-col flex-shrink-0",style:{height:`${E}px`},children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsxs("div",{className:"flex items-center space-x-1",children:[k&&n.jsx(ct,{content:v("node.action.detachAndPaste"),children:n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white rounded transition-colors",onClick:ne=>{ne.stopPropagation(),f()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z",clipRule:"evenodd"})})})}),n.jsx("label",{className:"text-xs font-medium text-gray-400 flex-shrink-0",children:se})]}),n.jsx(Ne,{title:" ",onClick:ne=>{ne.stopPropagation(),g()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})})]}),n.jsxs("div",{className:"flex-grow flex flex-col gap-1 min-h-0",children:[!H&&n.jsx(Ug,{title:X,slots:a,isB:!1,isEditing:C,checkedIndices:j,getFullSizeImage:ne=>ce(ne),onCheck:ne=>pe(ne,!1),onSelectAll:()=>ue(!1),onSelectNone:()=>re(!1),onClear:()=>$(!1),onClick:ne=>Z(ne,!1),onReorder:(ne,le)=>te(ne,le,!1),onRemove:ne=>ae(ne,!1),onMoveToB:M?I:void 0,onFileClick:()=>J(!1),onDropFiles:ne=>W(ne,!1),onDropData:ne=>U(ne,!1),onSlotDrop:(ne,le)=>Q(ne,le,!1),t:v,isSequentialCombinationMode:M,onSetCheckedIndices:ne=>s({checkedInputIndices:ne}),onInvertSelection:()=>{const le=a.map((ge,we)=>we).filter(ge=>!j.includes(ge));s({checkedInputIndices:le})}}),(H||L&&M)&&n.jsx(Ug,{title:K,slots:i,isB:!0,isEditing:C,checkedIndices:[],getFullSizeImage:ne=>ce(2e3+ne),onCheck:()=>{},onSelectAll:()=>{},onSelectNone:()=>{},onClear:()=>$(!0),onClick:ne=>Z(ne,!0),onReorder:(ne,le)=>te(ne,le,!0),onRemove:ne=>ae(ne,!0),onFileClick:()=>J(!0),onDropFiles:ne=>W(ne,!0),onDropData:ne=>U(ne,!0),onSlotDrop:(ne,le)=>Q(ne,le,!0),t:v,isSequentialCombinationMode:!0})]})]}),n.jsx("div",{onMouseDown:oe,className:"h-2 w-full bg-gray-700/50 hover:bg-cyan-600 cursor-row-resize rounded transition-colors flex-shrink-0 my-1"}),n.jsxs("div",{className:"flex-grow min-h-0 flex flex-col space-y-2",children:[n.jsx("div",{className:"flex-shrink-0 space-y-2",children:n.jsx(kP,{state:t,onUpdateState:s,onCleanupInputB:l,isEditing:C,t:v,nodeId:e,deselectAllNodes:_})}),d,n.jsxs("div",{className:"flex-grow flex flex-col min-h-0 mt-2 space-y-2 relative",children:[n.jsxs("div",{className:"relative flex-grow min-h-0 flex flex-col overflow-hidden",children:[!V&&!H&&n.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-1 mb-1",children:[n.jsx("div",{className:"flex-grow min-w-0",children:n.jsx(jp,{libraryItems:u,onPromptInsert:ne=>s({prompt:B?`${B.trim()}, ${ne}`:ne})})}),n.jsx(Ne,{title:v("node.action.clear"),onClick:()=>s({prompt:""}),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),n.jsx("div",{className:"flex-grow min-h-0 mt-1 relative",children:V&&L||H?n.jsx(_P,{ref:O,totalFrames:H?w:a.length,framePrompts:G||{},globalPrompt:B,onChange:(ne,le)=>s({framePrompts:{...G||{},[ne]:le}}),upstreamPrompts:h,t:v,visibleIndices:H?void 0:j,onAddFrame:H?()=>{const ne=Object.keys(G||{}).length;s({framePrompts:{...G||{},[ne]:""}})}:void 0,onSync:S,onDeleteFrame:T,onMoveFrame:P,onSelectFrame:R,onClearAll:D,selectedFrameIndex:q}):n.jsx(hn,{value:x?p:B,onDebouncedChange:ne=>s({prompt:ne}),placeholder:x?p||v("node.content.connectedPlaceholder"):v("node.content.editPromptPlaceholder"),className:"w-full h-full p-2 bg-gray-900/50 rounded-md resize-none border border-gray-600 focus:border-cyan-500 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500",readOnly:x,onFocus:_,onWheel:ne=>ne.stopPropagation(),onMouseDown:ne=>ne.stopPropagation()})})]}),F&&n.jsxs("div",{className:"flex-shrink-0 space-y-2 pt-1 border-t border-gray-700/50",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("input",{id:`outpainting-toggle-${e}`,type:"checkbox",checked:Y,onChange:ne=>s({enableOutpainting:ne.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-cyan-600 focus:ring-cyan-500 bg-gray-700 cursor-pointer",onMouseDown:ne=>ne.stopPropagation()}),n.jsx("label",{htmlFor:`outpainting-toggle-${e}`,className:"text-sm text-gray-300 select-none cursor-pointer",children:v("node.content.enableOutpainting")})]}),Y&&n.jsx(hn,{value:ee,onDebouncedChange:ne=>s({outpaintingPrompt:ne}),placeholder:v("node.content.outpaintingPromptPlaceholder"),className:"w-full p-2 bg-gray-900/50 rounded-md resize-none border border-gray-600 focus:border-cyan-500 focus:outline-none text-xs",style:{height:"60px"},onFocus:_,onWheel:ne=>ne.stopPropagation(),onMouseDown:ne=>ne.stopPropagation()})]})]})]})]})}),NP=({node:e,onValueChange:t,onEditImage:o,onStopEdit:r,isEditingImage:a,onPasteImage:i,onSetImageEditorOutputToInput:s,connectedImageSources:l,t:c,deselectAllNodes:d,connectedInputs:u,onCopyImageToClipboard:p,onDownloadImage:h,libraryItems:x,onDetachImageToNode:k,getUpstreamNodeValues:C,viewTransform:w,setImageViewer:f,getFullSizeImage:g,setFullSizeImage:v,onDownloadImageFromUrl:_,onRefreshUpstreamData:S,isStopping:T,onCutConnections:P,addToast:R})=>{const{setConnections:D,handleNavigateToNodeFrame:q,nodes:O,connections:E}=Ut(),A=y.useRef(null),N=y.useRef(null),j=y.useRef(null),L=y.useRef(null),[M,V]=y.useState(null),H=y.useRef(null),[F,G]=y.useState(!1),[B,Y]=y.useState(null),ee=y.useRef(null),[ie,ce]=y.useReducer(Re=>Re+1,0),pe=y.useMemo(()=>{try{return{...Bg,...JSON.parse(e.value||"{}")}}catch{return Bg}},[e.value]),ue=y.useRef(pe);ue.current=pe;const{inputImages:re,inputImagesB:$,prompt:Z,outputImage:te,model:ae,aspectRatio:I,enableAspectRatio:J,leftPaneWidth:W,topPaneHeight:U,resolution:Q,isSequenceMode:de,isSequentialCombinationMode:se,isSequentialEditingWithPrompts:X,framePrompts:K,sequenceOutputs:oe,checkedSequenceOutputIndices:ne,checkedInputIndices:le,enableOutpainting:ge,outpaintingPrompt:we,autoDownload:_e,autoCrop169:fe,isSequentialPromptMode:he,createZip:ye,selectedSourceFrameIndex:Se}=pe,Te=ae==="gemini-3-pro-image-preview",Ae=u==null?void 0:u.has("text"),Oe=(w==null?void 0:w.scale)||1,me=y.useCallback(Re=>{const qe={...ue.current,...Re};ue.current=qe,t(e.id,JSON.stringify(qe))},[t,e.id]);y.useEffect(()=>{if(!e.width||!e.height)return;const Re=Rt+Jt*2,qe=e.width-Gg-8;let He=W;W>qe?He=Math.max(xs,qe):W<xs&&(He=xs);const Xe=e.height-Re-(J?$1:W1)-8;let Ke=U;U>Xe?Ke=Math.max(Gs,Xe):U<Gs&&(Ke=Gs),(He!==W||Ke!==U)&&me({leftPaneWidth:He,topPaneHeight:Ke})},[e.width,e.height,W,U,J,me]);const ve=y.useCallback(()=>{me({inputImagesB:[],isSequentialCombinationMode:!1,isSequentialEditingWithPrompts:!1,isSequentialPromptMode:!1})},[me]),Ie=y.useCallback(()=>{if(de){const Re=ne?[...ne].sort((qe,He)=>qe-He):[];o(e.id,Re)}else o(e.id)},[de,e.id,ne,o]),ke=y.useCallback(()=>{r&&r()},[r]),je=y.useCallback(()=>{const qe=(ue.current.sequenceOutputs||[]).map(He=>He?He.status==="done"?He:{...He,status:"idle"}:{status:"idle",thumbnail:null});me({sequenceOutputs:qe}),S&&S(e.id),ce()},[me,S,e.id]),Ge=y.useCallback(Re=>{Re.preventDefault(),Re.stopPropagation();const qe=Re.clientX,He=W;if(!j.current)return;const $e=j.current.offsetWidth,Qe=(w==null?void 0:w.scale)||1,Xe=ft=>{const yt=(ft.clientX-qe)/Qe,ht=Math.max(xs,Math.min(He+yt,$e-Gg));me({leftPaneWidth:ht})},Ke=()=>{window.removeEventListener("mousemove",Xe),window.removeEventListener("mouseup",Ke)};window.addEventListener("mousemove",Xe),window.addEventListener("mouseup",Ke)},[W,me,w==null?void 0:w.scale]),be=y.useMemo(()=>{if(!Ae)return;const Re=C(e.id,"text",void 0,!0).filter($e=>typeof $e=="string"),qe=new Map;let He=!1;return Re.forEach($e=>{const Qe=$e.trim();if(Qe.startsWith("{")||Qe.startsWith("["))try{const Xe=JSON.parse($e);let Ke=[];if(Xe.sourcePrompts||Xe.modifiedPrompts){const ft=Xe.sourcePrompts||[],yt=Xe.modifiedPrompts||[],ht=new Map;ft.forEach(wt=>ht.set(wt.frameNumber,wt)),yt.forEach(wt=>ht.set(wt.frameNumber,{...ht.get(wt.frameNumber),...wt})),Ke=Array.from(ht.values()),He=!0}else Xe.type==="script-prompt-modifier-data"?(Ke=Xe.finalPrompts||Xe.prompts||[],He=!0):Array.isArray(Xe)&&(Ke=Xe,He=!0);Ke.length>0&&Ke.forEach((ft,yt)=>{const ht=ft.frameNumber!==void 0?ft.frameNumber:yt+1;ft.prompt&&qe.set(ht,ft.prompt)})}catch{}}),He?qe:void 0},[Ae,C,e.id,ie]),Pe=y.useMemo(()=>Ae&&!be?C(e.id,"text",void 0,!0).filter(Re=>typeof Re=="string").join(`

`):"",[Ae,C,e.id,be]),Ee=y.useMemo(()=>C(e.id,"image",void 0,!0),[C,e.id,ie]),Me=y.useMemo(()=>C(e.id,"image_b",void 0,!0),[C,e.id,ie]),Fe=async Re=>{if(Re instanceof File)return new Promise(qe=>{const He=new FileReader;He.onload=$e=>{var Qe;return qe((Qe=$e.target)==null?void 0:Qe.result)},He.readAsDataURL(Re)});if(typeof Re=="string"){if(Re.startsWith("data:"))return Re;try{const He=await(await fetch(Re)).blob();return new Promise($e=>{const Qe=new FileReader;Qe.onload=Xe=>{var Ke;return $e((Ke=Xe.target)==null?void 0:Ke.result)},Qe.readAsDataURL(He)})}catch{return null}}return null},tt=async(Re,qe)=>{const $e=(await Promise.all(Re.map(yt=>Fe(yt)))).filter(Boolean);if($e.length===0)return;const Qe=qe?ue.current.inputImagesB||[]:ue.current.inputImages||[],Xe=qe?2e3:0,Ke=[];for(let yt=0;yt<$e.length;yt++){const ht=$e[yt],wt=Qe.length+yt;v(e.id,Xe+wt+1,ht);const jt=await Lt(ht,256,256);Ke.push(jt)}const ft=[...Qe,...Ke];me(qe?{inputImagesB:ft}:{inputImages:ft})},Nt=y.useCallback((Re,qe)=>{const He=qe?"inputImagesB":"inputImages",Qe=[...qe?$:re];Qe.splice(Re,1);const Xe=qe?2e3:0;for(let ft=Re;ft<Qe.length;ft++){const yt=g(e.id,Xe+ft+2);yt&&v(e.id,Xe+ft+1,yt)}const Ke={[He]:Qe};!qe&&le&&(Ke.checkedInputIndices=le.filter(ft=>ft!==Re).map(ft=>ft>Re?ft-1:ft)),me(Ke)},[re,$,le,me,e.id,g,v]),xe=y.useCallback((Re,qe,He)=>{const $e=He?$:re;if(Re===qe||qe<0||qe>=$e.length)return;const Qe=He?2e3:0,Xe=$e.map((ht,wt)=>({thumb:ht,full:g(e.id,Qe+wt+1)})),[Ke]=Xe.splice(Re,1);Xe.splice(qe,0,Ke),Xe.forEach((ht,wt)=>{ht.full&&v(e.id,Qe+wt+1,ht.full)});const ft=Xe.map(ht=>ht.thumb),yt={[He?"inputImagesB":"inputImages"]:ft};if(!He&&le){const ht=le.includes(Re);let wt=le.map(jt=>{if(jt===Re)return-1;if(Re<qe){if(jt>Re&&jt<=qe)return jt-1}else if(jt>=qe&&jt<Re)return jt+1;return jt});if(ht){const jt=wt.indexOf(-1);jt!==-1&&(wt[jt]=qe)}wt=wt.filter(jt=>jt!==-1).sort((jt,Nr)=>jt-Nr),yt.checkedInputIndices=wt}me(yt)},[re,$,le,me,e.id,g,v]),Be=y.useCallback(Re=>{const qe=re[Re],He=g(e.id,Re+1)||qe,$e=[...re];$e.splice(Re,1);for(let Ke=Re;Ke<$e.length;Ke++){const ft=g(e.id,Ke+2);v(e.id,Ke+1,ft||$e[Ke])}const Qe=[...$,qe];He&&v(e.id,2e3+Qe.length,He);let Xe=le||[];Xe.length>0&&(Xe=Xe.filter(Ke=>Ke!==Re).map(Ke=>Ke>Re?Ke-1:Ke)),me({inputImages:$e,inputImagesB:Qe,checkedInputIndices:Xe})},[re,$,g,v,e.id,me,le]),Le=async(Re,qe,He=!1)=>{const $e=await Fe(qe);if(!$e)return;const Qe=He?2e3:0;v(e.id,Qe+Re+1,$e);const Xe=await Lt($e,256,256),Ke=He?[...$]:[...re];Ke[Re]=Xe,me({[He?"inputImagesB":"inputImages"]:Ke})},Ue=(Re,qe,He)=>{const $e=[];return qe.forEach((Qe,Xe)=>{let Ke=null;typeof Qe=="string"?Ke=Qe:Qe&&typeof Qe=="object"&&(Ke=`data:${Qe.mimeType};base64,${Qe.base64ImageData}`),$e.push({type:"connected",src:Ke,index:Xe})}),Re.forEach((Qe,Xe)=>$e.push({type:"local",src:Qe,index:Xe})),$e},Ze=y.useMemo(()=>Ue(re,Ee),[re,Ee]),at=y.useMemo(()=>Ue($,Me),[$,Me]),ot=(u==null?void 0:u.has("image"))||pe.isSequentialEditingWithPrompts&&(u==null?void 0:u.has("image_b")),rt=y.useMemo(()=>{if(X){const Re=Object.keys(K||{}).length,qe=(be==null?void 0:be.size)||0;return Math.max(Re,qe,1)}return Ze.length},[X,K,be,Ze.length]);y.useEffect(()=>{if(X)(!ne||ne.length!==rt)&&me({checkedSequenceOutputIndices:Array.from({length:rt},(Re,qe)=>qe)});else{const Re=le?le.length:0;(Ze.length>Re||le===void 0)&&me({checkedInputIndices:Ze.map((qe,He)=>He)})}},[Ze.length,X,rt]),X?at.length>0:Ze.length>0;const et=y.useMemo(()=>{if(X){if(at.length>0){const Re=at[at.length-1];return Re.type==="local"&&g(e.id,2e3+Re.index+1)||Re.src}}else{const Re=Ze.filter((qe,He)=>!le||le.includes(He));if(Re.length>0){const qe=Re[Re.length-1];return qe.type==="local"&&g(e.id,qe.index+1)||qe.src}}return null},[Ze,at,g,e.id,le,X]);y.useEffect(()=>{(async()=>{if(J&&et&&I&&I!=="Auto")try{const{formattedImage:qe}=await br(et,I);H.current=qe,V(await Lt(qe,256,256))}catch{V(null)}else J&&et?(H.current=et,V(et.length>1e5?await Lt(et,256,256):et)):(V(null),H.current=null)})()},[et,I,J]);const mt=async()=>{H.current&&tt([H.current],!1)},xt=(Re,qe)=>{const He=qe?at:Ze,$e=qe?2e3:0,Qe=qe?[]:C(e.id,"image",void 0,!1),Xe=qe?C(e.id,"image_b",void 0,!1):[],Ke=qe?Xe:Qe,ft=He.map((yt,ht)=>{let wt=null;if(yt.type==="local")wt=g(e.id,$e+yt.index+1)||yt.src;else{const jt=Ke[yt.index];typeof jt=="object"&&jt.base64ImageData?wt=`data:${jt.mimeType};base64,${jt.base64ImageData}`:typeof jt=="string"?wt=jt:wt=yt.src}return wt?{src:wt,frameNumber:ht+1,prompt:`Input ${qe?"B ":""}Image ${ht+1}`}:null}).filter(Boolean);ft.length>0&&f({sources:ft,initialIndex:Re})},Ct=y.useCallback(()=>{let Re="image",qe=!1;ue.current.isSequentialEditingWithPrompts&&(Re="image_b",qe=!0);const He=C(e.id,Re,void 0,!1),$e=[];He.forEach(Qe=>{typeof Qe=="string"?$e.push(Qe):Qe&&typeof Qe=="object"&&$e.push(`data:${Qe.mimeType};base64,${Qe.base64ImageData}`)}),$e.length>0&&(tt($e,qe),P&&D(Qe=>Qe.filter(Xe=>!(Xe.toNodeId===e.id&&(Xe.toHandleId===Re||Re==="image"&&Xe.toHandleId===void 0)))))},[C,tt,P,e.id,D]),pt=Re=>{v(e.id,0,Re),Lt(Re,256,256).then(qe=>me({outputImage:qe}))},dt={getFullSizeImage:Re=>g(e.id,Re),onCheck:(Re,qe)=>{if(!qe){const He=ue.current.checkedInputIndices||[],$e=He.includes(Re)?He.filter(Qe=>Qe!==Re):[...He,Re];me({checkedInputIndices:$e})}},onSelectAll:Re=>{Re||me({checkedInputIndices:Ze.map((qe,He)=>He)})},onSelectNone:Re=>{Re||me({checkedInputIndices:[]})},onClear:Re=>{me(Re?{inputImagesB:[]}:{inputImages:[],checkedInputIndices:[]})},onClick:xt,onMove:xe,onRemove:Nt,onMoveToB:se?Be:void 0,onFileClick:Re=>{var qe,He;return Re?(qe=N.current)==null?void 0:qe.click():(He=A.current)==null?void 0:He.click()},onDropFiles:tt,onDropData:(Re,qe)=>tt([Re],qe),onSlotDrop:Le},kt=y.useCallback(Re=>{const qe={...ue.current.framePrompts},He=[...ue.current.sequenceOutputs||[]],$e=Math.max(...Object.keys(qe).map(Number)),Qe={};for(let Ke=0;Ke<=$e;Ke++)Ke<Re?qe[Ke]&&(Qe[Ke]=qe[Ke]):Ke>Re&&qe[Ke]&&(Qe[Ke-1]=qe[Ke]);Re<He.length&&He.splice(Re,1);let Xe=Se;Xe===Re?Xe=null:Xe!==null&&Xe>Re&&Xe--,me({framePrompts:Qe,sequenceOutputs:He,selectedSourceFrameIndex:Xe})},[me,Se]),St=y.useCallback(()=>{me({framePrompts:{},sequenceOutputs:[],selectedSourceFrameIndex:null})},[me]),Tt=y.useCallback((Re,qe)=>{const He={...ue.current.framePrompts},$e=[...ue.current.sequenceOutputs||[]],Qe=Math.max(...Object.keys(He).map(Number),Re,qe),Xe=[];for(let wt=0;wt<=Qe;wt++)Xe.push(He[wt]||"");const[Ke]=Xe.splice(Re,1);Xe.splice(qe,0,Ke);const ft={};for(Xe.forEach((wt,jt)=>{wt&&(ft[jt]=wt)});$e.length<=Math.max(Re,qe);)$e.push({status:"idle",thumbnail:null});const[yt]=$e.splice(Re,1);$e.splice(qe,0,yt);let ht=Se;ht===Re?ht=qe:ht!==null&&(Re<qe?ht>Re&&ht<=qe&&ht--:ht>=qe&&ht<Re&&ht++),me({framePrompts:ft,sequenceOutputs:$e,selectedSourceFrameIndex:ht})},[me,Se]),_t=y.useCallback(Re=>{me({selectedSourceFrameIndex:Re})},[me]),It=y.useMemo(()=>J&&n.jsx("div",{className:"relative group flex-shrink-0 mt-2 h-40 bg-gray-900/50 rounded-md flex items-center justify-center",children:M?n.jsxs(n.Fragment,{children:[n.jsx("img",{src:M,alt:"Preview",className:"max-w-full max-h-full object-contain",draggable:!0,onDragStart:Re=>{(H.current||M)&&(Re.dataTransfer.setData("application/prompt-modifier-drag-image",H.current||M),Re.dataTransfer.effectAllowed="copy",Re.stopPropagation())}}),n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx(Ne,{title:"Copy",onClick:Re=>{Re.stopPropagation(),p(H.current||M)},children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Ne,{title:"Use as Input",onClick:mt,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L9.414 11H13a1 1 0 100-2H9.414l1.293-1.293z",clipRule:"evenodd"})})}),n.jsx(Ne,{title:"Detach",onClick:()=>{H.current&&k(H.current,e.id)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})})]})]}):n.jsx("p",{className:"text-gray-500 text-sm text-center px-2",children:c("node.content.previewPlaceholder")})}),[J,M,mt,k,p,c]),Io=y.useCallback(Re=>{L.current&&L.current.scrollToIndex(Re)},[]),jo=y.useCallback(Re=>{const qe=($e,Qe,Xe=new Set)=>{if(!E||!O||Xe.has($e))return;Xe.add($e);const Ke=E.find(yt=>yt.toNodeId===$e&&(yt.toHandleId===Qe||Qe===void 0));if(!Ke)return;const ft=O.find(yt=>yt.id===Ke.fromNodeId);if(ft)return ft.type===z.REROUTE_DOT?qe(ft.id,void 0,Xe):ft.id},He=qe(e.id,"text");He&&q&&q(He,Re+1)},[E,O,q,e.id]),qt=y.useCallback(()=>{if(!be||be.size===0)return;const Re={...K};be.forEach((qe,He)=>{Re[He]=qe}),me({framePrompts:Re})},[be,K,me]);return n.jsxs("div",{ref:j,className:"flex w-full h-full",children:[n.jsx(Jl,{isOpen:F,onClose:()=>{G(!1),ee.current=null},onApply:pt,imageSrc:B}),n.jsx("input",{ref:A,type:"file",accept:"image/*",className:"hidden",onChange:Re=>{var qe;(qe=Re.target.files)!=null&&qe.length&&tt(Array.from(Re.target.files),!1)},multiple:!0}),n.jsx("input",{ref:N,type:"file",accept:"image/*",className:"hidden",onChange:Re=>{var qe;(qe=Re.target.files)!=null&&qe.length&&tt(Array.from(Re.target.files),!0)},multiple:!0}),n.jsx(SP,{ref:L,nodeId:e.id,state:pe,leftPaneWidth:W,viewScale:Oe,imageSlots:Ze,imageSlotsB:at,onUpdateState:me,onCleanupInputB:ve,onEditImage:()=>{},inputListActions:dt,previewElement:It,libraryItems:x,upstreamPrompt:Pe,upstreamPromptsMap:be,isTextConnected:Ae,isInputConnected:ot,isEditing:a,seqTotalFrames:de&&X?rt:Ze.length,handleDetachAndPasteInput:Ct,handleManualRefresh:je,t:c,deselectAllNodes:d,onCopyImageToClipboard:p,onDetachImageToNode:k,onSyncPrompts:qt,onDeleteFrame:kt,onMoveFrame:Tt,onSelectFrame:_t,onClearFrames:St,selectedFrameIndex:Se}),n.jsx("div",{onMouseDown:Ge,className:"w-2 h-full bg-gray-700/50 hover:bg-cyan-600 cursor-col-resize rounded transition-colors flex-shrink-0"}),n.jsx(CP,{state:pe,imageSlots:X?at:Ze,hasInputImages:X?at.length>0:Ze.length>0,isEditing:a,isStopping:T,isGlobalProcessing:!1,totalFrames:X?rt:le.length,doneCount:oe.filter((Re,qe)=>(X||le.includes(qe))&&(Re==null?void 0:Re.status)==="done").length,currentGeneratingDisplay:oe.findIndex(Re=>(Re==null?void 0:Re.status)==="generating")+1||"-",fullSizeOutputForCopy:g(e.id,0)||te,imageForEditor:g(e.id,0)||te,modelOptions:[],isNanoBanana:Te,onUpdateState:me,onRunSelected:Ie,onDownloadSelected:async()=>{var $e,Qe;const Re=[...ne].sort((Xe,Ke)=>Xe-Ke),He=new Date().toISOString().split("T")[0];if(ye)try{const Xe=new Li;for(const yt of Re){const ht=g(e.id,1e3+yt)||(($e=oe[yt])==null?void 0:$e.thumbnail);if(ht&&ht.startsWith("data:image")){const jt=`Image_Editor_Frame_${String(yt+1).padStart(3,"0")}.png`,Nr=ht.split(",")[1];Xe.file(jt,Nr,{base64:!0})}}const Ke=await Xe.generateAsync({type:"blob"}),ft=document.createElement("a");ft.href=URL.createObjectURL(Ke),ft.download=`Image_Editor_${He}.zip`,ft.click(),URL.revokeObjectURL(ft.href),R&&R("ZIP Downloaded","success")}catch(Xe){console.error("ZIP Error",Xe),R&&R("Failed to create ZIP","error")}else for(const Xe of Re){const Ke=g(e.id,1e3+Xe)||((Qe=oe[Xe])==null?void 0:Qe.thumbnail),yt=`Image_Editor_Frame_${String(Xe+1).padStart(3,"0")}_${He}.png`;Ke&&(_(Ke,Xe+1,Z||"Sequence",yt),await new Promise(ht=>setTimeout(ht,300)))}},onStartQueue:()=>{},onStop:ke,onEdit:Ie,onOpenEditor:()=>{const Re=g(e.id,0)||te;Re&&(Y(Re),ee.current=0,G(!0))},onSetOutputToInput:()=>s(e.id),onDownload:()=>h(e.id),onCopy:()=>{const Re=g(e.id,0)||te;Re&&p(Re)},onSelectAll:()=>me({checkedSequenceOutputIndices:Array.from({length:X?rt:Ze.length},(Re,qe)=>qe)}),onSelectNone:()=>me({checkedSequenceOutputIndices:[]}),onInvertSelection:()=>{const Re=X?rt:Ze.length,qe=ue.current.checkedSequenceOutputIndices||[],He=Array.from({length:Re},($e,Qe)=>Qe).filter($e=>!qe.includes($e));me({checkedSequenceOutputIndices:He})},onManualRefresh:je,onOutputClick:()=>{const Re=g(e.id,0)||te;Re&&f({sources:[{src:Re,frameNumber:0,prompt:Z}],initialIndex:0})},onSequenceOutputClick:(Re,qe)=>{if(!qe)return;const He=oe.map((Qe,Xe)=>{const Ke=g(e.id,1e3+Xe)||(Qe==null?void 0:Qe.thumbnail);return Ke?{src:Ke,frameNumber:Xe+1,prompt:`Output ${Xe+1}`}:null}).filter(Qe=>Qe!==null),$e=He.findIndex(Qe=>Qe.frameNumber===Re+1);$e!==-1&&f({sources:He,initialIndex:$e})},onCheckOutput:Re=>{const qe=ue.current.checkedSequenceOutputIndices||[],He=qe.includes(Re)?qe.filter($e=>$e!==Re):[...qe,Re];me({checkedSequenceOutputIndices:He})},onCopyFrame:(Re,qe)=>{var $e;Re.stopPropagation();const He=g(e.id,1e3+qe)||(($e=oe[qe])==null?void 0:$e.thumbnail);He&&p(He)},onDownloadFrame:(Re,qe)=>{var $e;Re.stopPropagation();const He=g(e.id,1e3+qe)||(($e=oe[qe])==null?void 0:$e.thumbnail);if(He){const Xe=new Date().toISOString().split("T")[0],ft=`Image_Editor_Frame_${String(qe+1).padStart(3,"0")}_${Xe}.png`;_(He,qe+1,Z,ft)}},onRegenerateFrame:(Re,qe)=>{Re.stopPropagation(),o(e.id,[qe])},onStopFrame:(Re,qe)=>{Re.stopPropagation(),r&&r()},getFullSizeImage:Re=>g(e.id,Re),t:c,upstreamPrompt:Pe,isTextConnected:Ae,onEditPrompt:Io,onEditInSource:jo})]})},EP=({node:e,onValueChange:t,onAnalyzeImage:o,onImageToText:r,isAnalyzingImage:a,t:i,deselectAllNodes:s,connectedImageSources:l,setImageViewer:c,getFullSizeImage:d,onSaveToLibrary:u,onCopyImageToClipboard:p,addToast:h,onPasteImage:x,onOutputHandleMouseDown:k,onOutputHandleTouchStart:C,getHandleColor:w,handleCursor:f})=>{const g=y.useRef(null),[v,_]=y.useState(!1),S=Ut(),T=S==null?void 0:S.onAddNode,P=S==null?void 0:S.setConnections,R=S==null?void 0:S.handleAnalyzePrompt,D=(S==null?void 0:S.connections)||[],q=(S==null?void 0:S.nodes)||[],O=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{image:null,description:"",softPrompt:!1}}},[e.value]),{image:E,description:A,softPrompt:N=!1}=O,j=l&&l.length>0,L=j?l[0]:E,M=re=>{t(e.id,JSON.stringify({...O,...re}))},V=re=>{var Z;const $=(Z=re.target.files)==null?void 0:Z[0];$&&x(e.id,$)},H=re=>{re.preventDefault(),re.stopPropagation(),_(!0);const $=document.getElementById("app-container");$&&$.classList.remove("ring-2","ring-cyan-500","ring-inset")},F=re=>{re.preventDefault(),re.stopPropagation(),_(!0)},G=re=>{re.preventDefault(),re.stopPropagation(),_(!1)},B=re=>{var te;re.preventDefault(),re.stopPropagation(),_(!1);const $=re.dataTransfer.getData("application/prompt-modifier-drag-image");if($){fetch($).then(ae=>ae.blob()).then(ae=>{const I=new File([ae],"dragged_image.png",{type:ae.type});x(e.id,I)});return}const Z=(te=re.dataTransfer.files)==null?void 0:te[0];Z&&Z.type.startsWith("image/")&&x(e.id,Z)},Y=re=>{var Z;if(re.stopPropagation(),!L&&j)return;if(!L&&!j){(Z=g.current)==null||Z.click();return}let $=L;j||($=d(e.id,0)||E),$&&c({sources:[{src:$,frameNumber:0,prompt:A||"Analyzed Image"}],initialIndex:0})},ee=re=>{re.stopPropagation();let $=L;j||($=d(e.id,0)||E),$&&p&&p($)},ie=re=>{re.stopPropagation(),M({image:null}),h&&h(i("toast.contentCleared"))},ce=re=>{re.stopPropagation(),A&&(navigator.clipboard.writeText(A),h&&h(i("toast.copiedToClipboard")))},pe=re=>{re.stopPropagation(),A&&u&&u(A,"Image Analyzer Prompts")},ue=y.useCallback(()=>{if(!T||!P||!R||!A)return;const re=D.find(Z=>Z.fromNodeId===e.id&&Z.fromHandleId==="text");let $=null;if(re){const Z=q.find(te=>te.id===re.toNodeId);Z&&Z.type===z.PROMPT_ANALYZER&&($=Z.id)}if($)R($);else{const Z={x:e.position.x+e.width+50,y:e.position.y},te=T(z.PROMPT_ANALYZER,Z);P(ae=>[...ae,{id:`conn-${Date.now()}-${Math.random()}`,fromNodeId:e.id,fromHandleId:"text",toNodeId:te,toHandleId:void 0}]),setTimeout(()=>{R(te)},100)}},[T,P,R,e,A,D,q]);return n.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[n.jsx("input",{ref:g,type:"file",accept:"image/*",className:"hidden",onChange:V}),n.jsxs("div",{className:"flex-1 flex flex-col min-h-0 space-y-2 relative group",children:[n.jsxs("div",{className:"flex-grow min-h-0 relative",children:[n.jsx("div",{onClick:Y,onDragEnter:H,onDragOver:F,onDragLeave:G,onDrop:B,className:`w-full h-full bg-gray-700 rounded-md flex items-center justify-center transition-all cursor-pointer ${v?"bg-gray-600 ring-2 ring-accent-text":"hover:bg-gray-600"}`,children:L?n.jsx("img",{src:L,alt:"Input",className:"object-contain w-full h-full",draggable:!0,onMouseDown:re=>re.stopPropagation(),onDragStart:re=>{let $=L;j||($=d(e.id,0)||E),$&&(re.dataTransfer.setData("application/prompt-modifier-drag-image",$),re.dataTransfer.effectAllowed="copy",re.stopPropagation())}}):!j&&n.jsx("span",{className:"text-gray-400 pointer-events-none",children:i("node.content.dropImage")})}),j&&n.jsxs("div",{className:"absolute inset-0 bg-gray-900/50 flex items-center justify-center rounded-md pointer-events-none group-hover:bg-gray-900/30 transition-colors",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-gray-400 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),n.jsx("div",{className:"absolute top-full mt-2 px-2 py-1 bg-slate-700 text-slate-200 text-sm rounded-md shadow-xl z-50 opacity-0 group-hover:opacity-100 transition-opacity",children:i("node.content.connectedPlaceholder")})]}),L&&n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[n.jsx(Ne,{title:i("node.action.copy"),onClick:ee,children:n.jsx(Dt,{className:"h-4 w-4"})}),!j&&n.jsx(Ne,{title:i("node.action.clear"),onClick:ie,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),n.jsxs("div",{className:"flex flex-col gap-2 shrink-0",children:[n.jsx("button",{onClick:()=>o(e.id),disabled:a||!L,className:"w-full px-4 py-2 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center whitespace-nowrap",children:i(a?"node.content.analyzing":"node.content.analyzeImage")}),r&&n.jsx("button",{onClick:()=>r(e.id),disabled:a||!L,className:"w-full px-4 py-2 font-bold text-white bg-accent-secondary rounded-md hover:bg-accent-secondary-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center whitespace-nowrap",children:i("node.content.imageToText")})]})]}),n.jsxs("div",{className:"flex-1 flex flex-col min-h-0 space-y-2 relative group",children:[n.jsxs("div",{className:"flex-grow min-h-0 flex flex-col relative",children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-400",children:i("node.content.prompt")}),n.jsxs("div",{className:"flex space-x-1",children:[n.jsx(Ne,{title:i("node.action.copy"),onClick:ce,disabled:!A,children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Ne,{title:i("catalog.saveTo"),onClick:pe,disabled:!A,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})})]})]}),n.jsx("textarea",{value:A,onChange:re=>M({description:re.target.value}),placeholder:i("node.content.descriptionHere"),className:"w-full h-full p-2 bg-gray-700 border-none rounded-md resize-none focus:ring-2 focus:ring-accent focus:outline-none flex-grow",onWheel:re=>re.stopPropagation(),onMouseDown:re=>re.stopPropagation(),onFocus:s})]}),n.jsx("div",{className:"flex items-center space-x-2 flex-shrink-0",children:n.jsx(Zt,{id:`soft-prompt-toggle-${e.id}`,checked:N,onChange:re=>M({softPrompt:re}),disabled:a||!L,label:" "})}),n.jsx("button",{onClick:ue,disabled:!A||a,className:"w-full px-4 py-2 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex-shrink-0",children:i("node.content.analyzePrompt")})]})]})},PP=({node:e,onValueChange:t,onAnalyze:o,isAnalyzing:r,onOutputHandleMouseDown:a,getHandleColor:i,handleCursor:s,t:l,deselectAllNodes:c,onSaveToLibrary:d})=>{const u=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{environment:"",characters:[],action:"",emotion:"",style:"",softPrompt:!1}}},[e.value]),{environment:p,characters:h=[],action:x,emotion:k,style:C,softPrompt:w=!1}=u,f=Math.max(1,h.length),g=T=>{t(e.id,JSON.stringify({...u,...T}))},v=(T,P)=>{const R=[...h];R[T]=P,g({characters:R})},_=(T,P)=>{T.stopPropagation(),a(T,e.id,P)},S=(T,P,R,D,q)=>{const O=T.startsWith("character")?`${l("node.content.character")} ${q+1}`:l(`node.content.${T}`),E=l(`node.content.${T}Placeholder`),A=N=>{N.stopPropagation(),d&&P&&d(P,"Analyzer Prompts")};return n.jsxs("div",{className:"relative flex-grow flex flex-col",children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400",children:O}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(Ne,{tooltipPosition:"left",title:l("catalog.saveTo"),onClick:A,disabled:!P,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})}),n.jsx(Ne,{tooltipPosition:"left",title:l("node.action.copy"),onClick:N=>{N.stopPropagation(),navigator.clipboard.writeText(P||"")},children:n.jsx(Dt,{className:"h-4 w-4"})})]})]}),n.jsx("div",{className:"flex-grow min-h-0",children:n.jsx("textarea",{value:P||"",onChange:N=>R(N.target.value),placeholder:E,className:"w-full h-full p-2 bg-gray-700 border-none rounded-md resize-none focus:ring-2 focus:ring-accent focus:outline-none",onWheel:N=>N.stopPropagation(),onMouseDown:N=>N.stopPropagation(),onFocus:c})}),n.jsx("div",{onMouseDown:N=>_(N,D),style:{cursor:s},className:`absolute top-1/2 -right-2.5 w-5 h-5 rounded-full border-2 border-gray-900 transform -translate-y-1/2 ${i("text",D)} group`,children:n.jsx("div",{className:"absolute right-full mr-3 top-1/2 -translate-y-1/2 px-2 py-1 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:O})})]},D)};return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 overflow-y-auto overflow-x-hidden px-2",children:[S("environment",p,T=>g({environment:T}),"environment"),Array.from({length:f}).map((T,P)=>S("character",h[P]||"",R=>v(P,R),`character-${P}`,P)),S("action",x,T=>g({action:T}),"action"),S("emotion",k,T=>g({emotion:T}),"emotion"),S("style",C,T=>g({style:T}),"style")]}),n.jsx("div",{className:"flex items-center space-x-2 mt-2 px-2",children:n.jsx(Zt,{id:`soft-prompt-toggle-${e.id}`,checked:w,onChange:T=>g({softPrompt:T}),disabled:r,label:" "})}),n.jsx("div",{className:"px-2",children:n.jsx("button",{onClick:()=>o(e.id),disabled:r,className:"w-full px-4 py-2 mt-2 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex-shrink-0",children:l(r?"node.content.analyzing":"node.content.analyzePrompt")})})]})},TP=({node:e,onValueChange:t,onAnalyzeCharacter:o,isAnalyzingCharacter:r,t:a,onSelectNode:i})=>{const s=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{character:"",clothing:""}}},[e.value]),l=c=>{t(e.id,JSON.stringify({...s,...c}))};return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"grid grid-rows-2 gap-2 flex-grow min-h-0",children:[n.jsx("div",{className:"min-h-0",children:n.jsx("textarea",{value:s.character||"",onChange:c=>l({character:c.target.value}),placeholder:a("node.content.characterPlaceholder"),className:"w-full h-full p-2 bg-gray-700 border-none rounded-md resize-none focus:ring-2 focus:ring-cyan-500 focus:outline-none",onWheel:c=>c.stopPropagation(),onMouseDown:c=>{c.stopPropagation(),i()},onKeyDown:c=>c.stopPropagation()})}),n.jsx("div",{className:"min-h-0",children:n.jsx("textarea",{value:s.clothing||"",onChange:c=>l({clothing:c.target.value}),placeholder:a("node.content.clothingPlaceholder"),className:"w-full h-full p-2 bg-gray-700 border-none rounded-md resize-none focus:ring-2 focus:ring-cyan-500 focus:outline-none",onWheel:c=>c.stopPropagation(),onMouseDown:c=>{c.stopPropagation(),i()},onKeyDown:c=>c.stopPropagation()})})]}),n.jsx("button",{onClick:()=>o(e.id),disabled:r,className:"w-full px-4 py-2 mt-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:a(r?"node.content.analyzing":"node.content.analyzeCharacter")})]})},IP=({node:e,onValueChange:t,onEnhance:o,isEnhancing:r,onProcessChainForward:a,isExecutingChain:i,t:s,onSelectNode:l,onSavePromptToLibrary:c,addToast:d,connectedInputs:u,getUpstreamNodeValues:p})=>{const{language:h}=vt(),x=Ut(),{tutorialStep:k,tutorialTargetId:C,advanceTutorial:w,skipTutorial:f}=x||{},g=C===e.id&&k==="prompt_processor_enhance",v=C===e.id&&k==="prompt_processor_waiting",_=()=>{o(e.id),g&&w&&w()};y.useEffect(()=>{v&&!r&&w&&w()},[r,v,w]);const S=y.useMemo(()=>{try{const j=JSON.parse(e.value||"{}");return typeof j=="object"&&j!==null?{inputPrompt:j.inputPrompt||"",prompt:j.prompt||"",safePrompt:j.safePrompt!==!1,technicalPrompt:j.technicalPrompt===!0}:{inputPrompt:"",prompt:e.value,safePrompt:!0,technicalPrompt:!1}}catch{return{inputPrompt:"",prompt:e.value,safePrompt:!0,technicalPrompt:!1}}},[e.value]),T=u==null?void 0:u.has(void 0),P=y.useMemo(()=>T?p(e.id).filter(L=>typeof L=="string"&&L.trim()!=="").join(", "):"",[T,p,e.id,e.value]),R=j=>{t(e.id,JSON.stringify({...S,safePrompt:j}))},D=j=>{t(e.id,JSON.stringify({...S,technicalPrompt:j}))},q=j=>{t(e.id,JSON.stringify({...S,inputPrompt:j}))},O=async()=>{try{const j=await navigator.clipboard.readText();if(j){const L=S.inputPrompt?`${S.inputPrompt}, ${j}`:j;q(L),d&&d(s("toast.pastedFromClipboard"))}}catch{d&&d(s("toast.pasteFailed"),"error")}},E=()=>{const j=U1(h),L=S.inputPrompt?`${S.inputPrompt}, ${j}`:j;q(L)},A=j=>{j.stopPropagation(),c&&S.prompt&&c(S.prompt)},N=j=>{j.stopPropagation(),S.prompt&&(navigator.clipboard.writeText(S.prompt),d&&d(s("toast.copiedToClipboard")))};return n.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[n.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsxs("div",{className:"flex items-center space-x-1",children:[T&&n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:T?s("node.content.connectedNode"):" "})]}),!T&&n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(Ne,{title:s("node.action.randomWord"),onClick:E,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})}),n.jsx(Ne,{title:s("node.action.paste"),onClick:O,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})})]})]}),n.jsx(hn,{value:T?P:S.inputPrompt,onDebouncedChange:q,placeholder:s("node.content.editPromptPlaceholder"),className:`w-full h-full p-2 bg-input border-none rounded-md resize-none focus:ring-2 focus:ring-accent focus:outline-none ${T?"text-gray-400 cursor-default":"text-white"}`,onWheel:j=>j.stopPropagation(),onMouseDown:j=>{j.stopPropagation(),l()},readOnly:T})]}),n.jsxs("div",{className:"flex-1 flex flex-col min-h-0 relative",children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:s("node.content.enhancedResult")}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(Ne,{title:s("node.action.copy"),onClick:N,disabled:!S.prompt,children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Ne,{title:s("catalog.saveTo"),onClick:A,disabled:!S.prompt,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})})]})]}),n.jsx("textarea",{readOnly:!0,value:S.prompt,placeholder:s("node.content.enhancedPromptHere"),className:"w-full h-full p-2 bg-input border-none rounded-md resize-none focus:outline-none",onWheel:j=>j.stopPropagation(),onMouseDown:j=>{j.stopPropagation(),l()}})]}),n.jsxs("div",{className:"flex flex-col gap-1 pt-1 items-start",onMouseDown:j=>{j.stopPropagation(),l()},children:[n.jsx(ct,{content:s("node.promptProcessor.safePromptTooltip"),position:"top",align:"start",usePortal:!1,children:n.jsx(Zt,{checked:S.safePrompt,onChange:R,disabled:r||i,label:s("node.content.safePrompt")})}),n.jsx(ct,{content:s("node.promptProcessor.technicalPromptTooltip"),position:"top",align:"start",usePortal:!1,children:n.jsx(Zt,{checked:S.technicalPrompt,onChange:D,disabled:r||i,label:s("node.content.technicalPrompt")})})]}),n.jsxs("div",{className:"flex space-x-2 h-10",children:[n.jsx(qn,{content:s(v?"tutorial.step2_waiting":"tutorial.step2"),isActive:!!g||!!v,position:"top",pulseColor:v?"rgba(234, 179, 8, 0.8)":void 0,onSkip:f,className:"flex-grow h-full",children:n.jsx(ct,{content:`${s("node.promptProcessor.enhanceTooltip")} (gemini-3-flash-preview)`,position:"top",className:"w-full h-full",usePortal:!1,children:n.jsx("button",{onClick:_,disabled:r||i,className:"w-full h-full px-4 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:s(r?"node.content.enhancing":"node.content.enhancePrompt")})})}),n.jsx(ct,{content:s("node.promptProcessor.chainTooltip"),position:"top",className:"h-10 w-10 flex-shrink-0",usePortal:!1,children:n.jsx("button",{onClick:()=>a(e.id),disabled:r||i,className:"h-10 w-10 flex items-center justify-center font-bold text-white bg-accent-secondary rounded-md hover:bg-accent-secondary-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:i?n.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 5l7 7m0 0l-7 7m7-7H3"})})})})]})]})},jP=({node:e,isGeneratingImage:t,isExecutingChain:o,onModelChange:r,onAspectRatioChange:a,onResolutionChange:i,onAutoDownloadChange:s,onGenerateImage:l,onStopChainExecution:c,onExecuteChain:d,t:u,onDownloadImage:p,setImageViewer:h,getFullSizeImage:x,getUpstreamNodeValues:k,isGlobalProcessing:C,onCopyImageToClipboard:w})=>{const f=Ut(),{tutorialStep:g,tutorialTargetId:v,advanceTutorial:_,skipTutorial:S}=f||{},T=v===e.id&&g==="image_output_generate",P=()=>{l(e.id),T&&_&&_()},R=M=>{M.stopPropagation();const V=x(e.id,0)||e.value;V&&w&&w(V)},D=["1:1","16:9","9:16","4:3","3:4"],q=[{value:"imagen-4.0-generate-001",label:"Imagen 4.0 (Quality)"},{value:"imagen-4.0-ultra-generate-preview-06-06",label:"Imagen 4.0 Ultra (Preview)"},{value:"gemini-3-pro-image-preview",label:"Gemini 3.0 Pro (Nano Banana Pro)"},{value:"gemini-2.5-flash-image",label:"Gemini 2.5 Flash Image (Nano Banana)"}],O=e.model==="gemini-3-pro-image-preview",A=!e.model||e.model.startsWith("imagen-4.0")||O,N=[{value:"1K",label:"1K"},{value:"2K",label:"2K"},{value:"4K",label:"4K"}],j=()=>{if(!e.value)return;const M=x(e.id,0)||e.value;if(M){const H=k(e.id).filter(F=>typeof F=="string").join(", ");h({sources:[{src:M,frameNumber:0,prompt:H}],initialIndex:0})}},L=n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-white/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("rect",{x:"8",y:"8",width:"12",height:"12",rx:"2",ry:"2"}),n.jsx("path",{d:"M16 8V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2"})]});return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{onClick:j,onWheel:M=>M.stopPropagation(),className:"relative w-full flex-grow bg-gray-700 rounded-md flex items-center justify-center overflow-hidden mb-2 group cursor-pointer border border-gray-600 hover:border-gray-500 transition-colors",children:[e.value?n.jsx("img",{src:e.value||x(e.id,0),alt:"Generated result",className:"object-contain w-full h-full",draggable:!0,onMouseDown:M=>M.stopPropagation(),onDragStart:M=>{const V=x(e.id,0)||e.value;V&&(M.dataTransfer.setData("application/prompt-modifier-drag-image",V),M.dataTransfer.effectAllowed="copy",M.stopPropagation())}}):n.jsx("span",{className:"text-gray-400",children:u("node.content.imageHere")}),n.jsxs("div",{className:`absolute inset-0 bg-gray-800/70 backdrop-blur-sm flex flex-col items-center justify-center text-white z-10 transition-opacity duration-300 ${t||o&&!e.value?"opacity-100":"opacity-0 pointer-events-none"}`,children:[n.jsxs("svg",{className:"animate-spin h-8 w-8 text-accent-text",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n.jsx("span",{className:"mt-2 font-semibold text-accent-text",children:o?"Executing...":u("node.content.generating")})]}),e.value&&!(t||o&&!e.value)&&n.jsxs("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none gap-4",children:[n.jsx("button",{onClick:R,className:"w-20 h-20 flex items-center justify-center rounded-full bg-black/50 hover:bg-black/60 transition-colors pointer-events-auto","aria-label":u("node.action.copy"),title:u("node.action.copy"),children:L}),n.jsx("button",{onClick:M=>{M.stopPropagation(),p(e.id)},className:"w-20 h-20 flex items-center justify-center rounded-full bg-black/50 hover:bg-black/60 transition-colors pointer-events-auto","aria-label":u("node.action.download"),title:u("node.action.download"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-white/80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]}),e.value&&n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx(Ne,{title:u("node.action.copy"),onClick:R,children:n.jsx(Dt,{})}),n.jsx(Ne,{title:u("node.action.download"),onClick:M=>{M.stopPropagation(),p(e.id)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]})]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:u("node.content.generationMode")}),n.jsx(Mn,{id:`model-select-${e.id}`,value:e.model||"imagen-4.0-generate-001",onChange:M=>r(e.id,M),disabled:t||o,options:q})]}),O&&n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Resolution"}),n.jsx(Mn,{value:e.resolution&&["1K","2K","4K"].includes(e.resolution)?e.resolution:"1K",onChange:M=>i(e.id,M),disabled:t||o,options:N})]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{htmlFor:`aspect-ratio-${e.id}`,className:`block text-xs font-medium mb-1 transition-colors ${A?"text-gray-400":"text-gray-600"}`,children:u("node.content.aspectRatio")}),n.jsx(Mn,{id:`aspect-ratio-${e.id}`,value:e.aspectRatio||"1:1",onChange:M=>a(e.id,M),disabled:t||!A||o,title:u(A?"node.content.aspectRatioHelp":"node.content.aspectRatioNotSupportedFast"),options:D.map(M=>({value:M,label:M}))})]}),n.jsx("div",{className:"mb-2",children:n.jsx(Zt,{id:`auto-download-toggle-${e.id}`,checked:!!e.autoDownload,onChange:M=>s(e.id,M),disabled:t||o,label:u("node.content.autoDownload")})}),n.jsxs("div",{className:"flex space-x-2 h-10",children:[n.jsx(qn,{content:u("tutorial.step3"),isActive:!!T,position:"top",onSkip:S,className:"flex-grow h-full",children:n.jsx("button",{onClick:P,disabled:t||o||C,className:"w-full h-full px-4 font-bold text-white bg-accent rounded-md hover:bg-accent-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:u(t?"node.content.generating":"node.content.generateImage")})}),o?n.jsx("button",{onClick:c,className:"h-10 w-10 flex-shrink-0 flex items-center justify-center font-bold text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors duration-200",title:" ",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1zm4 0a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})}):n.jsx("button",{onClick:()=>d(e.id),disabled:t||o||C,className:"h-10 w-10 flex-shrink-0 flex items-center justify-center font-bold text-white bg-accent-secondary rounded-md hover:bg-accent-secondary-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",title:u("node.action.executeChainTitle"),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})})]})]})},AP=({node:e,isGeneratingVideo:t,isExecutingChain:o,onAspectRatioChange:r,onResolutionChange:a,onAutoDownloadChange:i,onGenerateVideo:s,onStopChainExecution:l,onExecuteChain:c,t:d,isGlobalProcessing:u})=>{const p=["16:9","9:16"],h=["720p","1080p"];return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"relative w-full flex-grow bg-gray-700 rounded-md flex items-center justify-center overflow-hidden mb-2",children:[e.value?n.jsx("video",{src:e.value,controls:!0,className:"object-contain w-full h-full"}):n.jsx("span",{className:"text-gray-400",children:"Video will appear here"}),n.jsxs("div",{className:`absolute inset-0 bg-gray-800/70 backdrop-blur-sm flex flex-col items-center justify-center text-white z-10 transition-opacity duration-300 ${t||o&&!e.value?"opacity-100":"opacity-0 pointer-events-none"}`,children:[n.jsxs("svg",{className:"animate-spin h-8 w-8 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n.jsx("span",{className:"mt-2 font-semibold",children:d(o?"node.content.processingChain":"node.content.generating")})]})]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{htmlFor:`aspect-ratio-${e.id}`,className:"block text-xs font-medium mb-1 text-gray-400",children:d("node.content.aspectRatio")}),n.jsx(Mn,{id:`aspect-ratio-${e.id}`,value:e.aspectRatio||"16:9",onChange:x=>r(e.id,x),disabled:t||o,options:p.map(x=>({value:x,label:x}))})]}),n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{htmlFor:`resolution-${e.id}`,className:"block text-xs font-medium mb-1 text-gray-400",children:"Resolution"}),n.jsx(Mn,{id:`resolution-${e.id}`,value:e.resolution||"720p",onChange:x=>a(e.id,x),disabled:t||o,options:h.map(x=>({value:x,label:x}))})]}),n.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[n.jsx("input",{type:"checkbox",id:`auto-download-toggle-${e.id}`,checked:!!e.autoDownload,onChange:x=>i(e.id,x.target.checked),disabled:t||o,className:"h-4 w-4 rounded border-gray-300 text-accent focus:ring-accent bg-gray-700 cursor-pointer",onMouseDown:x=>x.stopPropagation()}),n.jsx("label",{htmlFor:`auto-download-toggle-${e.id}`,className:"text-sm text-gray-300 select-none cursor-pointer",children:d("node.content.autoDownload")})]}),n.jsxs("div",{className:"flex space-x-2",children:[n.jsx("button",{onClick:()=>s(e.id),disabled:t||o||u,className:"w-1/2 px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:t?d("node.content.generating"):"Generate Video"}),o?n.jsxs("button",{onClick:l,className:"w-1/2 px-4 py-2 font-bold text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors duration-200 flex items-center justify-center space-x-2",title:" ",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1zm4 0a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),n.jsx("span",{children:"Stop"})]}):n.jsxs("button",{onClick:()=>c(e.id),disabled:t||o||u,className:"w-1/2 px-4 py-2 font-bold text-white bg-teal-600 rounded-md hover:bg-teal-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center space-x-2",title:d("node.action.executeChainTitle"),children:[n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),n.jsx("span",{children:d("node.action.executeChain")})]})]})]})},MP=({node:e,onValueChange:t,onEnhanceVideo:o,isEnhancingVideo:r,onProcessChainForward:a,isExecutingChain:i,t:s,onSelectNode:l,connectedInputs:c,getUpstreamNodeValues:d})=>{const u=y.useMemo(()=>{try{const k=JSON.parse(e.value||"{}");return typeof k=="object"&&k!==null?{inputPrompt:k.inputPrompt||"",prompt:k.prompt||k.value||""}:{inputPrompt:"",prompt:e.value||""}}catch{return{inputPrompt:"",prompt:e.value||""}}},[e.value]),p=c==null?void 0:c.has(void 0),h=y.useMemo(()=>p?d(e.id).filter(C=>typeof C=="string").join(", "):"",[p,d,e.id,e.value]),x=k=>{t(e.id,JSON.stringify({...u,inputPrompt:k}))};return n.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[n.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase mb-1",children:p?s("node.content.connectedPlaceholder"):"Input Prompt"}),n.jsx(hn,{value:p?h:u.inputPrompt,onDebouncedChange:x,placeholder:s("node.content.editPromptPlaceholder"),className:`w-full h-full p-2 bg-input border-none rounded-md resize-none focus:ring-2 focus:ring-cyan-500 focus:outline-none ${p?"text-gray-400 cursor-not-allowed":"text-white"}`,onWheel:k=>k.stopPropagation(),onMouseDown:k=>{k.stopPropagation(),l()},readOnly:p})]}),n.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[n.jsx("label",{className:"text-[10px] font-bold text-cyan-400 uppercase mb-1",children:"Video Prompt"}),n.jsx("textarea",{readOnly:!0,value:u.prompt,placeholder:s("node.content.enhancedPromptHere"),className:"w-full h-full p-2 bg-input border-none rounded-md resize-none focus:outline-none",onWheel:k=>k.stopPropagation(),onMouseDown:k=>{k.stopPropagation(),l()}})]}),n.jsxs("div",{className:"flex space-x-2 pt-1",children:[n.jsx("button",{onClick:()=>o(e.id),disabled:r||i,className:"w-1/2 px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:s(r?"node.content.enhancing":"node.content.enhancePrompt")}),n.jsxs("button",{onClick:()=>a(e.id),disabled:r||i,className:"w-1/2 px-4 py-2 font-bold text-white bg-accent-secondary rounded-md hover:bg-accent-secondary-hover disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center space-x-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 5l7 7m0 0l-7 7m7-7H3"})}),n.jsx("span",{children:s(i?"node.content.processingChain":"node.action.processChainForward")})]})]})]})},RP=({node:e,onValueChange:t,connectedInputs:o,isGeneratingScript:r,onGenerateScript:a,t:i,deselectAllNodes:s})=>{const l=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{type:"script-generator-data",prompt:"",summary:"",detailedCharacters:[],scenes:[],targetLanguage:"en"}}},[e.value]),{prompt:c="",summary:d="",detailedCharacters:u=[],scenes:p=[],targetLanguage:h="en"}=l,x=o==null?void 0:o.has(void 0),k=w=>{t(e.id,JSON.stringify({...l,type:"script-generator-data",...w}))},C=Object.entries(Pn);return n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex-shrink-0 space-y-2 mb-2",children:[n.jsx("textarea",{value:c,onChange:w=>k({prompt:w.target.value}),placeholder:i(x?"node.content.connectedPlaceholder":"node.content.scriptPromptPlaceholder"),className:"w-full p-2 bg-gray-700 border-none rounded-md resize-none focus:ring-2 focus:ring-cyan-500 focus:outline-none",onWheel:w=>w.stopPropagation(),onMouseDown:w=>w.stopPropagation(),disabled:x,rows:3,onFocus:s}),n.jsxs("div",{className:"flex items-end space-x-2",children:[n.jsxs("div",{className:"flex-grow",children:[n.jsx("label",{htmlFor:`lang-select-${e.id}`,className:"block text-xs font-medium text-gray-400 mb-1",children:i("node.content.targetLanguage")}),n.jsx("select",{id:`lang-select-${e.id}`,value:h,onChange:w=>k({targetLanguage:w.target.value}),onMouseDown:w=>w.stopPropagation(),disabled:r,className:"w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:ring-2 focus:ring-cyan-500 focus:outline-none disabled:opacity-50",children:C.map(([w,{name:f}])=>n.jsx("option",{value:w,children:f},w))})]}),n.jsx("button",{onClick:()=>a(e.id),disabled:r||!x&&!c.trim(),className:"px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:i(r?"node.content.generating":"node.content.generateScript")})]})]}),n.jsxs("div",{className:"flex-grow min-h-0 overflow-y-auto space-y-4 pr-2",onWheel:w=>w.stopPropagation(),children:[d&&n.jsxs("div",{className:"bg-gray-700/50 p-3 rounded-lg",children:[n.jsx("h3",{className:"font-bold text-cyan-400 mb-1",children:"Summary"}),n.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:d})]}),u.length>0&&u.map((w,f)=>n.jsxs("div",{className:"bg-gray-700/50 p-3 rounded-lg",children:[n.jsx("h3",{className:"font-bold text-cyan-400 mb-1",children:w.name}),n.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:w.fullDescription})]},`char-${f}`)),p.length>0&&p.map((w,f)=>n.jsxs("div",{className:"bg-gray-700/50 p-3 rounded-lg",children:[n.jsxs("h3",{className:"font-bold text-cyan-400 mb-1",children:["Scene ",w.sceneNumber]}),n.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:w.description})]},`scene-${f}`))]})]})},LP=e=>(e||"").split(`
`).filter(t=>t.trim()!=="").map((t,o)=>t.startsWith("####")?n.jsx("h5",{className:"block text-cyan-400 font-bold mt-2 mb-1 text-base",children:t.replace(/####/g,"").trim()},o):n.jsx("span",{className:"block select-text break-words whitespace-pre-wrap",children:t},o)),nr=({isCollapsed:e,onClick:t,className:o})=>n.jsx("button",{onClick:t,className:`p-1 rounded hover:bg-gray-600 text-gray-400 hover:text-white transition-colors focus:outline-none ${o}`,children:e?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),DP=({node:e,onValueChange:t,onLoadScriptFile:o,t:r,onSaveScriptToCatalog:a,onSaveScriptToDisk:i,onTranslateScript:s,isTranslatingScript:l})=>{const[c,d]=y.useState(new Set),u=v=>{d(_=>{const S=new Set(_);return S.has(v)?S.delete(v):S.add(v),S})},p=y.useMemo(()=>{var v;try{if(!e.value||e.value==="{}")return{type:"empty",targetLanguage:"en"};const _=JSON.parse(e.value),S=_.targetLanguage||"en";return _.type==="script-generator-data"?{type:"generator",data:_,targetLanguage:S}:_.type==="script-analyzer-data"?{type:"analyzer",data:_,targetLanguage:S}:_.summary&&_.detailedCharacters&&_.scenes?{type:"generator",data:{..._,type:"script-generator-data"},targetLanguage:S}:_.characters&&_.scenes&&Array.isArray(_.scenes)&&((v=_.scenes[0])!=null&&v.frames)?{type:"analyzer",data:{..._,type:"script-analyzer-data"},targetLanguage:S}:{type:"invalid",targetLanguage:S}}catch{return{type:"invalid",targetLanguage:"en"}}},[e.value]),h=v=>{try{const S={...JSON.parse(e.value||"{}"),targetLanguage:v};t(e.id,JSON.stringify(S,null,2))}catch{t(e.id,JSON.stringify({targetLanguage:v},null,2))}},x=(v,_)=>n.jsxs("div",{className:"mb-4 pb-2 border-b border-gray-600 flex justify-between items-end",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-bold text-white",children:v}),_&&n.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:["Model: ",n.jsx("span",{className:"text-cyan-300",children:_})]})]}),n.jsx("div",{className:"text-xs text-gray-500 font-mono",children:"JSON"})]}),k=(v,_,S)=>n.jsxs("div",{className:"relative bg-gray-700/50 p-3 rounded-lg group overflow-hidden mb-2",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("h4",{className:"font-bold text-cyan-400 mb-1 truncate",children:v}),n.jsx("div",{className:"flex-shrink-0 ml-2",children:n.jsx(Ne,{title:r("node.action.copy"),onClick:T=>{T.stopPropagation(),navigator.clipboard.writeText(_)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})]}),n.jsx("div",{className:"text-sm text-gray-300 whitespace-pre-wrap select-text break-words",children:_})]},S),C=()=>{const v=p.type==="analyzer",_=[{id:"full-json",label:"Full Data JSON",copyVal:e.value}];v&&(_.push({id:"all-image-prompts",label:"All Image Prompts",copyVal:""}),_.push({id:"all-video-prompts",label:"All Video Prompts",copyVal:""}));const S=T=>{var D;const P=p.type==="analyzer"?p.data:null;if(!P||!P.scenes)return"";const R=[];return p.type==="analyzer"&&((D=P.scenes)==null||D.forEach(q=>q.frames.forEach(O=>{const E=T==="img"?O.imagePrompt:O.videoPrompt;E&&R.push(E)}))),R.join(`
`)};return n.jsx("div",{className:"mb-4 space-y-2",children:_.map(T=>n.jsxs("div",{className:"relative flex justify-between items-center p-2 rounded bg-gray-800 border border-gray-700 shadow-sm",children:[n.jsx("span",{className:"text-xs font-bold text-gray-400 pl-1 uppercase tracking-wider",children:T.label}),n.jsx("div",{className:"flex items-center",children:n.jsx(Ne,{title:r("node.action.copy"),onClick:P=>{P.stopPropagation();const R=T.id==="full-json"?T.copyVal:T.id==="all-image-prompts"?S("img"):S("vid");navigator.clipboard.writeText(R||"")},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})]},T.id))})},w=(v,_,S)=>{const T=`char-${_}`,P=c.has(T);return n.jsxs("div",{className:"bg-gray-700/50 rounded-lg group overflow-hidden mb-2 border border-gray-600/30",children:[n.jsxs("div",{className:"flex justify-between items-center p-3 cursor-pointer hover:bg-gray-700/80 transition-colors",onClick:R=>{R.stopPropagation(),u(T)},children:[n.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[n.jsx(nr,{isCollapsed:P,onClick:R=>{R.stopPropagation(),u(T)}}),n.jsxs("h4",{className:"font-bold text-cyan-400 truncate",children:[v.name,v.alias&&n.jsxs("span",{className:"text-xs font-mono text-gray-400 ml-2",children:["(",v.alias,")"]})]})]}),n.jsx("div",{className:"flex flex-col items-end space-y-2 flex-shrink-0",children:n.jsx("div",{className:"opacity-100",children:n.jsx(Ne,{title:r("node.action.copy"),onClick:R=>{R.stopPropagation(),navigator.clipboard.writeText(v.fullDescription)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})})]}),!P&&n.jsxs("div",{className:"px-3 pb-3 pt-0 text-sm text-gray-300 whitespace-pre-wrap select-text break-words border-t border-gray-600/30 mt-1",children:[LP(v.fullDescription),S&&v.imagePrompt&&n.jsxs("div",{className:"mt-2 p-2 bg-gray-800/50 rounded border-l-2 border-cyan-500",children:[n.jsx("span",{className:"text-xs font-bold text-gray-400 block uppercase mb-1",children:"Image Prompt"}),n.jsx("span",{className:"text-xs text-gray-300",children:v.imagePrompt})]})]})]},v.id||_)},f=(v,_)=>{var q;const S=`Frame ${v.frameNumber} (${v.duration?`${v.duration}s`:"Duration N/A"})`,T=((q=v.characters)==null?void 0:q.join(", "))||"",P=`frame-${_}-${v.frameNumber}`,R=c.has(P),D=[{label:"Description",value:v.description},{label:"Environment",value:v.environmentPrompt},{label:"Image Prompt",value:v.imagePrompt},{label:"Video Prompt",value:v.videoPrompt}].filter(O=>O.value);return n.jsxs("div",{className:"bg-gray-700/50 rounded-lg overflow-hidden mb-2 border border-gray-600/20",children:[n.jsx("div",{className:"flex justify-between items-center p-3 cursor-pointer hover:bg-gray-700/80 transition-colors",onClick:O=>{O.stopPropagation(),u(P)},children:n.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[n.jsx(nr,{isCollapsed:R,onClick:O=>{O.stopPropagation(),u(P)}}),n.jsx("h4",{className:"font-bold text-cyan-300 text-sm truncate",children:S}),T&&n.jsxs("span",{className:"text-xs text-gray-400 truncate max-w-[120px]",title:T,children:["Chars: ",T]})]})}),!R&&n.jsx("div",{className:"px-3 pb-3 pt-0 space-y-2 border-t border-gray-600/20 mt-1",children:D.map(O=>n.jsxs("div",{className:"relative bg-gray-800/50 p-2 rounded group overflow-hidden",children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsx("label",{className:"text-[10px] uppercase font-bold text-gray-400 truncate",children:O.label}),n.jsx("div",{className:"flex items-center space-x-1 flex-shrink-0",children:n.jsx("div",{children:n.jsx(Ne,{title:r("node.action.copy"),onClick:E=>{E.stopPropagation(),navigator.clipboard.writeText(O.value)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})})]}),n.jsx("p",{className:"text-xs text-gray-200 whitespace-pre-wrap select-text break-words leading-relaxed",children:O.value})]},O.label))})]},`frame-${v.frameNumber}`)},g=()=>{switch(p.type){case"empty":return n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500 p-4",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})}),n.jsx("p",{className:"font-semibold",children:"No Script Loaded"}),n.jsx("p",{className:"text-sm mt-1",children:'Drop a JSON file here or use the "Load" button.'})]});case"invalid":return n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center p-4",children:[n.jsx("span",{className:"text-red-400 font-bold mb-2",children:"Format Error"}),n.jsx("span",{className:"text-sm text-gray-400",children:r("node.content.unrecognizedFormat")})]});case"generator":{const v=p.data,_=v.customVisualStyle||v.visualStyle||v.generatedStyle||"",S=c.has("section-characters"),T=c.has("section-scenes");return n.jsxs("div",{className:"space-y-6 pb-4",children:[x("Generated Script",v.model),C(),_&&n.jsxs("div",{className:"bg-gray-800/30 p-3 rounded-lg border border-gray-600/50",children:[n.jsx("h3",{className:"font-bold text-cyan-400 mb-1 text-sm uppercase tracking-wider",children:r("node.content.style")}),n.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:_})]}),v.summary&&n.jsxs("div",{className:"bg-gray-800/30 p-3 rounded-lg border border-gray-600/50",children:[n.jsx("h3",{className:"font-bold text-cyan-400 mb-1 text-sm uppercase tracking-wider",children:r("node.content.summary")}),k("Summary",v.summary,"summary")]}),v.detailedCharacters&&v.detailedCharacters.length>0&&n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center mb-3 border-b border-gray-700 pb-1 cursor-pointer hover:bg-gray-800/50 rounded px-1 -mx-1",onClick:()=>u("section-characters"),children:[n.jsx(nr,{isCollapsed:S,onClick:P=>{P.stopPropagation(),u("section-characters")}}),n.jsx("h3",{className:"font-bold text-cyan-400 text-sm uppercase tracking-wider ml-2 select-none",children:r("node.content.characters")})]}),!S&&n.jsx("div",{className:"space-y-2",children:v.detailedCharacters.map((P,R)=>w(P,R,!1))})]}),v.scenes&&v.scenes.length>0&&n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center mb-3 border-b border-gray-700 pb-1 cursor-pointer hover:bg-gray-800/50 rounded px-1 -mx-1",onClick:()=>u("section-scenes"),children:[n.jsx(nr,{isCollapsed:T,onClick:P=>{P.stopPropagation(),u("section-scenes")}}),n.jsx("h3",{className:"font-bold text-cyan-400 text-sm uppercase tracking-wider ml-2 select-none",children:r("node.content.scenes")})]}),!T&&n.jsx("div",{className:"space-y-6",children:v.scenes.map((P,R)=>{const D=`scene-${P.sceneNumber}`,q=c.has(D);return n.jsxs("div",{className:"relative pl-4 border-l-2 border-gray-700",children:[n.jsx("div",{className:"absolute -left-[5px] top-0 w-2.5 h-2.5 bg-gray-600 rounded-full"}),n.jsxs("div",{className:"flex items-center mb-2 cursor-pointer hover:bg-gray-800/30 rounded",onClick:()=>u(D),children:[n.jsx(nr,{isCollapsed:q,onClick:O=>{O.stopPropagation(),u(D)}}),n.jsxs("h4",{className:"font-bold text-white text-lg ml-2 select-none",children:["Scene ",P.sceneNumber,": ",n.jsx("span",{className:"text-gray-300 font-normal",children:P.title})]})]}),!q&&n.jsxs(n.Fragment,{children:[k("Description",P.description,`scene-${R}`),P.narratorText&&k("Narrator",P.narratorText,`scene-${R}-narrator`)]})]},`scene-container-${R}`)})})]})]})}case"analyzer":{const v=p.data,_=c.has("section-characters"),S=c.has("section-scenes");return n.jsxs("div",{className:"space-y-6 pb-4",children:[x("Analyzed Script",v.model),C(),v.visualStyle&&n.jsxs("div",{className:"bg-gray-800/30 p-3 rounded-lg border border-gray-600/50",children:[n.jsx("h3",{className:"font-bold text-cyan-400 mb-1 text-sm uppercase tracking-wider",children:r("node.content.style")}),n.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:v.visualStyle})]}),v.characters&&v.characters.length>0&&n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center mb-3 border-b border-gray-700 pb-1 cursor-pointer hover:bg-gray-800/50 rounded px-1 -mx-1",onClick:()=>u("section-characters"),children:[n.jsx(nr,{isCollapsed:_,onClick:T=>{T.stopPropagation(),u("section-characters")}}),n.jsx("h3",{className:"font-bold text-cyan-400 text-sm uppercase tracking-wider ml-2 select-none",children:r("node.content.characters")})]}),!_&&n.jsx("div",{className:"space-y-2",children:v.characters.map((T,P)=>w(T,P,!0))})]}),v.scenes&&v.scenes.length>0&&n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center mb-3 border-b border-gray-700 pb-1 cursor-pointer hover:bg-gray-800/50 rounded px-1 -mx-1",onClick:()=>u("section-scenes"),children:[n.jsx(nr,{isCollapsed:S,onClick:T=>{T.stopPropagation(),u("section-scenes")}}),n.jsx("h3",{className:"font-bold text-cyan-400 text-sm uppercase tracking-wider ml-2 select-none",children:"Scenes & Frames"})]}),!S&&n.jsx("div",{className:"space-y-8",children:v.scenes.map((T,P)=>{var q;const R=`scene-${T.sceneNumber}`,D=c.has(R);return n.jsxs("div",{className:"bg-gray-800/20 rounded-xl p-2 border border-gray-700",children:[n.jsxs("div",{className:"bg-gray-900/50 p-2 rounded-lg mb-3 border-l-4 border-cyan-500 flex items-center cursor-pointer hover:bg-gray-900 transition-colors",onClick:()=>u(R),children:[n.jsx(nr,{isCollapsed:D,onClick:O=>{O.stopPropagation(),u(R)}}),n.jsx("div",{className:"ml-2",children:n.jsx("h4",{className:"font-bold text-lg text-white",children:T.title?T.title:`Scene ${T.sceneNumber}`})})]}),!D&&n.jsx("div",{className:"pl-2 space-y-2",children:(q=T.frames)==null?void 0:q.map(O=>f(O,T.sceneNumber))})]},`scene-${T.sceneNumber}`)})})]})]})}default:return null}};return n.jsxs("div",{className:"relative flex flex-col h-full overflow-x-hidden",children:[n.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-2 mb-2",children:[n.jsx("div",{className:"w-32",children:n.jsx(Mn,{id:`lang-select-${e.id}`,value:p.targetLanguage||"en",onChange:h,disabled:l===e.id,options:Object.entries(Pn).map(([v,{name:_}])=>({value:v,label:_}))})}),n.jsx("button",{onClick:()=>s(e.id),disabled:l===e.id||p.type==="empty"||p.type==="invalid",className:"px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:l===e.id?r("node.content.translating"):r("node.content.translate")})]}),n.jsx("div",{className:"flex-grow min-h-0 overflow-y-auto pr-2 overflow-x-hidden custom-scrollbar",onWheel:v=>v.stopPropagation(),children:g()}),n.jsxs("div",{className:"flex-shrink-0 flex items-center justify-end space-x-2 mt-2 pt-2 border-t border-gray-700",children:[n.jsx("button",{onClick:()=>o(e.id),className:"flex-1 px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 transition-colors duration-200",children:r("node.content.loadScript")}),n.jsx("button",{onClick:()=>a(e.id),disabled:p.type==="empty"||p.type==="invalid",className:"flex-1 px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",title:r("catalog.saveTo"),children:r("catalog.saveTo")}),n.jsx(Ne,{title:r("group.saveToDisk"),onClick:()=>i(e.id),disabled:p.type==="empty"||p.type==="invalid",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]})]})},zP=({value:e,onChange:t,min:o=1,max:r=10,label:a})=>{const i=l=>{let c=e+l;o!==void 0&&c<o&&(c=o),r!==void 0&&c>r&&(c=r),t(c)},s=l=>{const c=parseInt(l.target.value,10);isNaN(c)||o!==void 0&&c<o||r!==void 0&&c>r||t(c)};return n.jsxs("div",{children:[a&&n.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:a}),n.jsxs("div",{className:"relative flex items-center bg-gray-700 rounded-md border border-gray-600 h-[38px] overflow-hidden group hover:border-gray-500 transition-colors",children:[n.jsx("input",{type:"number",value:e,onChange:s,className:"appearance-none w-full h-full bg-transparent text-sm text-white text-center focus:outline-none px-2 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none font-bold",onMouseDown:l=>l.stopPropagation(),onKeyDown:l=>l.stopPropagation()}),n.jsxs("div",{className:"flex flex-col h-full border-l border-gray-600 w-5 flex-shrink-0 bg-gray-800",children:[n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-cyan-600 text-gray-400 hover:text-white transition-colors active:bg-cyan-700",onClick:l=>{l.stopPropagation(),i(1)},children:n.jsx("svg",{width:"8",height:"4",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-cyan-600 text-gray-400 hover:text-white transition-colors border-t border-gray-600 active:bg-cyan-700",onClick:l=>{l.stopPropagation(),i(-1)},children:n.jsx("svg",{width:"8",height:"4",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})]})},qP=({fullDescription:e,onDescriptionChange:t,t:o,onFocus:r})=>{const[a,i]=y.useState({});y.useEffect(()=>{const l={Appearance:"",Personality:"",Clothing:""},c={:"Appearance",:"Personality",:"Personality",:"Clothing",apariencia:"Appearance",personalidad:"Personality",ropa:"Clothing",appearance:"Appearance",personality:"Personality",clothing:"Clothing"},d=/####\s*(Appearance|Personality|Clothing|||||Apariencia|Personalidad|Ropa)\s*([\s\S]*?)(?=####|$)/gi;let u,p=!1;for(;(u=d.exec(e))!==null;){p=!0;const h=u[1].trim().toLowerCase(),x=c[h],k=u[2].trim();x&&(l[x]=k)}!p&&e.trim()&&(l.Appearance=e.trim()),i(l)},[e]);const s=(l,c)=>{const d={...a,[l]:c};i(d);const u=`#### Appearance
${d.Appearance||""}

#### Personality
${d.Personality||""}

#### Clothing
${d.Clothing||""}`;t(u)};return n.jsx("div",{className:"space-y-2 text-sm h-full flex flex-col overflow-y-auto custom-scrollbar pr-1 pb-1",children:["Appearance","Personality","Clothing"].map(l=>n.jsxs("div",{className:"flex-shrink-0 flex flex-col",children:[n.jsx("h5",{className:"font-semibold text-gray-400 text-xs uppercase tracking-wider flex-shrink-0 mb-1",children:o(`node.content.${l.toLowerCase()}`)||l}),n.jsx("textarea",{value:a[l]||"",onChange:c=>s(l,c.target.value),className:"w-full text-sm p-2 bg-gray-900/50 border-none rounded-md resize-none focus:outline-none focus:ring-1 focus:ring-cyan-500 custom-scrollbar h-[100px] min-h-[80px]",onWheel:c=>c.stopPropagation(),onKeyDown:c=>c.stopPropagation(),onFocus:r})]},l))})},vs="Full body character concept on a gray background",Vg="Full-length conceptual object on a grey background",OP=({node:e,onValueChange:t,onGenerateCharacters:o,isGeneratingCharacters:r,isStopping:a,onStopGeneration:i,t:s,deselectAllNodes:l,connectedInputs:c,clearSelectionsSignal:d,onGenerateCharacterImage:u,isGeneratingCharacterImage:p,onDetachCharacter:h,onSaveGeneratedCharacterToCatalog:x,getUpstreamNodeValues:k,addToast:C})=>{const{secondaryLanguage:w}=vt(),f=r,g=c==null?void 0:c.has(void 0),[v,_]=y.useState(!1),[S,T]=y.useState(new Set),[P,R]=y.useState(new Set);y.useEffect(()=>{d>0&&T(new Set)},[d]);const D=y.useMemo(()=>{try{const $=JSON.parse(e.value||"{}");return{prompt:$.prompt||"",numberOfCharacters:$.numberOfCharacters||1,targetLanguage:$.targetLanguage||w,characterType:$.characterType||"simple",style:$.style||"simple",customStyle:$.customStyle||"",characters:Array.isArray($.characters)?$.characters:[],additionalPrompt:$.additionalPrompt!==void 0?$.additionalPrompt:vs,error:$.error||null}}catch{return{prompt:"",numberOfCharacters:1,targetLanguage:w,characterType:"simple",style:"simple",customStyle:"",characters:[],additionalPrompt:vs,error:null}}},[e.value,w]),{prompt:q,numberOfCharacters:O,targetLanguage:E,characterType:A,style:N,customStyle:j,characters:L,additionalPrompt:M,error:V}=D,H=y.useCallback($=>{const Z={...D,...$};t(e.id,JSON.stringify(Z))},[e.id,t,D]),F=($,Z)=>{$.target.closest('textarea, input, button, [role="listbox"]')||(document.activeElement&&(document.activeElement instanceof HTMLTextAreaElement||document.activeElement instanceof HTMLInputElement)&&document.activeElement.blur(),T(ae=>{const I=new Set($.shiftKey?ae:[]);return I.has(Z)?I.delete(Z):I.add(Z),I}))},G=$=>{R(Z=>{const te=new Set(Z);return te.has($)?te.delete($):te.add($),te})},B=($,Z,te)=>{const ae=L.map(I=>I.id===$?{...I,[Z]:te}:I);H({characters:ae})},Y=$=>{H({characters:L.filter(Z=>Z.id!==$)})},ee=$=>{navigator.clipboard.writeText($)},ie=$=>{const Z={};$.imageBase64&&(Z["1:1"]=`data:image/png;base64,${$.imageBase64}`);let te=$.index||$.alias||"Entity-1";te=te.replace(/^Character-/,"Entity-");const ae={type:"character-card",name:$.name,index:te,image:$.imageBase64?`data:image/png;base64,${$.imageBase64}`:null,selectedRatio:"1:1",prompt:$.prompt,fullDescription:$.fullDescription,imageSources:Z,additionalPrompt:M},I=JSON.stringify(ae,null,2),J=new Blob([I],{type:"application/json"}),W=URL.createObjectURL(J),U=document.createElement("a");U.href=W,U.download=`${($.name||"entity").replace(/ /g,"_")}.json`,document.body.appendChild(U),U.click(),document.body.removeChild(U),URL.revokeObjectURL(W)},ce=$=>{if(x){const Z={...$,alias:($.index||$.alias||"Entity-1").replace(/^Character-/,"Entity-"),additionalPrompt:M};x(Z)}},pe=$=>{if(h){const Z={...$,index:($.index||$.alias||"Entity-1").replace(/^Character-/,"Entity-"),additionalPrompt:M};h(Z,e)}},ue=()=>{if(!g||!k)return;const Z=k(e.id).find(te=>typeof te=="string")||"";Z?(H({prompt:Z}),C==null||C("Prompt synced from connection","success")):C==null||C("No text found in connection","info")};y.useEffect(()=>{const $=L.map((te,ae)=>{let I=te.index||te.alias;return I?I.startsWith("Character-")&&(I=I.replace("Character-","Entity-")):I=`Entity-${ae+1}`,I!==te.index?{...te,index:I}:te});JSON.stringify($)!==JSON.stringify(L)&&H({characters:$})},[L.length]);const re=async()=>{if(!(!q||v)){_(!0);try{const $=await Ep(q,"en");H({prompt:$})}catch($){console.error("Translation failed",$)}finally{_(!1)}}};return n.jsxs("div",{className:"flex flex-col h-full",onWheel:$=>$.stopPropagation(),children:[n.jsxs("div",{className:"flex-shrink-0 space-y-2 mb-2",children:[n.jsxs("div",{className:"relative",children:[n.jsx("textarea",{value:q,onChange:$=>H({prompt:$.target.value}),placeholder:s(g?"node.content.connectedPlaceholder":"node.content.characterPromptPlaceholder"),disabled:g||f,className:"w-full p-2 bg-gray-700 border-none rounded-md resize-y min-h-[80px] max-h-[300px] focus:ring-2 focus:ring-cyan-500 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 custom-scrollbar overflow-y-scroll pb-8",rows:2,onWheel:$=>$.stopPropagation(),onMouseDown:$=>$.stopPropagation(),onKeyDown:$=>$.stopPropagation(),onFocus:l}),n.jsxs("div",{className:"absolute bottom-2 right-2 flex space-x-1",children:[g&&n.jsx("button",{onClick:ue,className:"p-1 bg-gray-600 hover:bg-cyan-600 text-gray-300 hover:text-white rounded transition-colors",title:"Sync from connection",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),!g&&n.jsx("button",{onClick:re,disabled:!q||v,className:"p-1 bg-gray-600 hover:bg-cyan-600 text-gray-300 hover:text-white rounded transition-colors disabled:opacity-50",title:s(v?"node.content.translating":"node.content.translate"),children:v?n.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"})})})]})]}),n.jsxs("div",{className:"flex flex-col gap-1 mb-2",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:s("node.content.additionalPromptSuffix")}),n.jsxs("div",{className:"flex gap-0.5",children:[n.jsx("button",{onClick:$=>{$.stopPropagation(),H({additionalPrompt:vs})},className:`p-0.5 rounded hover:bg-gray-700 transition-colors ${M===vs?"text-cyan-400":"text-gray-500 hover:text-white"}`,title:"Character Concept",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),n.jsx("button",{onClick:$=>{$.stopPropagation(),H({additionalPrompt:Vg})},className:`p-0.5 rounded hover:bg-gray-700 transition-colors ${M===Vg?"text-cyan-400":"text-gray-500 hover:text-white"}`,title:"Object Concept",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]})]}),n.jsx("input",{type:"text",value:M,onChange:$=>H({additionalPrompt:$.target.value}),className:"w-full p-1 bg-gray-900/60 border border-gray-700 rounded text-xs text-gray-400 focus:border-accent outline-none",onMouseDown:$=>$.stopPropagation(),onFocus:l})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:s("node.content.characterTypeShort")}),n.jsx(Mn,{value:A,onChange:$=>H({characterType:$}),disabled:f,options:[{value:"simple",label:s("node.content.characterType.simple")},{value:"anthro",label:s("node.content.characterType.anthro")},{value:"chibi",label:s("node.content.characterType.chibi")},{value:"key_item",label:s("node.content.characterType.key_item")}]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:s("node.content.style")}),n.jsx(Mn,{value:N,onChange:$=>H({style:$}),disabled:f,options:[{value:"simple",label:s("node.content.style.simple")},{value:"realistic",label:s("node.content.style.realistic")},{value:"3d_cartoon",label:s("node.content.style.3d_cartoon")},{value:"3d_realistic",label:s("node.content.style.3d_realistic")},{value:"2d_animation",label:s("node.content.style.2d_animation")},{value:"anime",label:s("node.content.style.anime")},{value:"comics",label:s("node.content.style.comics")},{value:"custom",label:s("node.content.style.custom")}]})]}),n.jsx("div",{children:n.jsx(zP,{label:s("node.content.numberOfCharactersShort"),value:O,onChange:$=>H({numberOfCharacters:$}),min:1,max:10})})]}),N==="custom"&&n.jsxs("div",{className:"flex items-center space-x-2 bg-gray-700 rounded-md p-1",children:[n.jsx("label",{htmlFor:`custom-style-input-${e.id}`,className:"text-xs text-gray-400 pl-1 flex-shrink-0",children:s("node.content.style.custom")}),n.jsx("textarea",{id:`custom-style-input-${e.id}`,value:j,onChange:$=>H({customStyle:$.target.value}),onMouseDown:$=>$.stopPropagation(),onKeyDown:$=>$.stopPropagation(),onFocus:l,rows:2,className:"w-full p-1 bg-gray-800 text-white rounded-md text-xs focus:ring-2 focus:ring-cyan-500 focus:outline-none custom-scrollbar",placeholder:"..."})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"flex items-center bg-gray-700 rounded-md p-1 space-x-1 h-10",children:[n.jsx("button",{onClick:()=>H({targetLanguage:w}),className:`px-2 py-1 rounded text-xs font-bold w-10 h-full transition-colors ${E===w?"bg-cyan-600 text-white":"text-gray-300 hover:bg-gray-600"}`,title:Pn[w].name,children:Pn[w].short}),n.jsx("button",{onClick:()=>H({targetLanguage:"en"}),className:`px-2 py-1 rounded text-xs font-bold w-10 h-full transition-colors ${E==="en"?"bg-cyan-600 text-white":"text-gray-300 hover:bg-gray-600"}`,children:"EN"})]}),n.jsx("button",{onClick:()=>o(e.id),disabled:f||a||!g&&!q.trim(),className:`flex-grow h-10 px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 flex items-center justify-center space-x-2 ${f?"bg-gray-600 cursor-not-allowed opacity-75":"bg-cyan-600 hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed"}`,children:f?n.jsxs(n.Fragment,{children:[n.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n.jsx("span",{children:s("node.content.generating")})]}):s("node.content.generateCharacters")})]})]}),n.jsxs("div",{className:"flex-grow overflow-y-auto overflow-x-hidden space-y-2 pr-2 custom-scrollbar scrollbar-gutter-stable",children:[V&&n.jsx("div",{className:"text-red-400 text-xs p-2 bg-red-900/20 rounded border border-red-800",children:V}),L.map($=>n.jsxs("div",{className:`bg-gray-800 rounded-md border-2 transition-colors ${S.has($.id)?"border-cyan-500":"border-gray-700"}`,onClick:Z=>F(Z,$.id),children:[n.jsxs("div",{className:"flex justify-between items-center p-2 cursor-pointer bg-gray-700/50 select-none",onClick:Z=>{Z.target===Z.currentTarget&&G($.id)},children:[n.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden",onClick:Z=>G($.id),children:[n.jsx(Ne,{title:P.has($.id)?s("node.action.expand"):s("node.action.collapse"),onClick:Z=>{Z.stopPropagation(),G($.id)},children:P.has($.id)?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),n.jsx("input",{type:"text",value:$.name,onChange:Z=>B($.id,"name",Z.target.value),className:"bg-transparent font-bold text-sm text-white focus:outline-none truncate",onClick:Z=>Z.stopPropagation(),onMouseDown:Z=>Z.stopPropagation(),onKeyDown:Z=>Z.stopPropagation(),onFocus:l})]}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(Ne,{title:s("catalog.saveTo"),tooltipPosition:"left",onClick:Z=>{Z.stopPropagation(),ce($)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})}),n.jsx(Ne,{title:s("node.action.saveCharacter"),tooltipPosition:"left",onClick:Z=>{Z.stopPropagation(),ie($)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Ne,{title:"Detach and Copy",tooltipPosition:"left",onClick:Z=>{Z.stopPropagation(),pe($)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})}),n.jsx(Ne,{title:s("node.action.deleteItem"),tooltipPosition:"left",onClick:Z=>{Z.stopPropagation(),Y($.id)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),!P.has($.id)&&n.jsxs("div",{className:"p-2 space-y-2 border-t border-gray-700 flex flex-col",children:[n.jsxs("div",{className:"flex space-x-2 h-[140px] flex-shrink-0",children:[n.jsx("div",{className:"w-1/3 h-full flex-shrink-0",children:n.jsx("div",{className:"aspect-square bg-gray-900 rounded-md flex items-center justify-center overflow-hidden relative group h-full w-full",children:$.imageBase64?n.jsxs(n.Fragment,{children:[n.jsx("img",{src:`data:image/png;base64,${$.imageBase64}`,alt:$.name,className:"w-full h-full object-cover"}),n.jsx("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsx(Ne,{title:s("node.action.copy"),onClick:Z=>{if(Z.stopPropagation(),$.imageBase64){const te=new Blob([Uint8Array.from(atob($.imageBase64),ae=>ae.charCodeAt(0))],{type:"image/png"});navigator.clipboard.write([new ClipboardItem({"image/png":te})])}},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})]}):n.jsx("div",{className:"text-gray-500 text-xs text-center px-2",children:p===`${e.id}-${$.id}`?n.jsxs("svg",{className:"animate-spin h-6 w-6 text-white mx-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("button",{onClick:Z=>{Z.stopPropagation(),u&&u(e.id,$.id)},className:"text-cyan-400 hover:text-cyan-300 underline",children:"Generate Image"})})})}),n.jsxs("div",{className:"w-2/3 flex flex-col space-y-1 h-full min-w-0",children:[n.jsxs("div",{className:"flex justify-between items-center flex-shrink-0",children:[n.jsx("label",{className:"text-xs text-gray-400 font-medium",children:s("node.content.characterIndex")}),n.jsx("input",{type:"text",value:$.index||$.alias||"",onChange:Z=>B($.id,"index",Z.target.value),className:"text-xs bg-gray-900 rounded px-1 border border-gray-600 w-24 focus:ring-1 focus:ring-cyan-500 focus:outline-none",onMouseDown:Z=>Z.stopPropagation(),onKeyDown:Z=>Z.stopPropagation(),onFocus:l})]}),n.jsxs("div",{className:"flex justify-between items-center flex-shrink-0",children:[n.jsx("label",{className:"text-xs text-gray-400 font-medium",children:s("node.content.imagePrompt")}),n.jsx(Ne,{title:s("node.action.copy"),onClick:Z=>{Z.stopPropagation(),ee($.prompt||"")},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),n.jsx("textarea",{value:$.prompt||"",onChange:Z=>B($.id,"prompt",Z.target.value),className:"w-full flex-grow h-full min-h-[80px] text-xs p-1 bg-gray-900 rounded resize-none border-none focus:ring-1 focus:ring-cyan-500 focus:outline-none custom-scrollbar",onWheel:Z=>Z.stopPropagation(),onMouseDown:Z=>Z.stopPropagation(),onKeyDown:Z=>Z.stopPropagation(),onFocus:l})]})]}),n.jsx("div",{className:"flex-grow flex flex-col min-h-[360px]",children:n.jsx(qP,{fullDescription:$.fullDescription||"",onDescriptionChange:Z=>B($.id,"fullDescription",Z),t:s,onFocus:l})})]})]},$.id))]})]})},FP=({value:e,onChange:t,placeholder:o,className:r,onFocus:a,readOnly:i})=>{const s=l=>{const c=parseInt(e.replace(/[^0-9]/g,""),10)||0;let d=e.replace(/[0-9]/g,"");(d==="Character-"||!d||d.trim()==="")&&(d="Entity-"),t(`${d}${Math.max(1,c+l)}`)};return n.jsxs("div",{className:`flex items-center bg-gray-700 rounded-md border border-gray-600 h-[32px] overflow-hidden group hover:border-gray-500 transition-colors ${r}`,children:[n.jsx("input",{type:"text",value:e,onChange:l=>!i&&t(l.target.value),placeholder:o,onFocus:a,readOnly:i,className:`w-full h-full bg-transparent text-sm text-white px-2 focus:outline-none border-none min-w-0 ${i?"cursor-default select-none":""}`,onMouseDown:l=>l.stopPropagation()}),n.jsxs("div",{className:"flex flex-col h-full border-l border-gray-600 w-5 flex-shrink-0 bg-gray-800",children:[n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-cyan-600 text-gray-400 hover:text-white transition-colors active:bg-cyan-700",onClick:l=>{l.stopPropagation(),s(1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-cyan-600 text-gray-400 hover:text-white transition-colors border-t border-gray-600 active:bg-cyan-700",onClick:l=>{l.stopPropagation(),s(-1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})},BP=({fullDescription:e,onDescriptionChange:t,t:o,onFocus:r})=>{const[a,i]=y.useState({});y.useEffect(()=>{const c={Appearance:"",Personality:"",Clothing:""},d={:"Appearance",:"Personality",:"Personality",:"Clothing",apariencia:"Appearance",personalidad:"Personality",ropa:"Clothing",appearance:"Appearance",personality:"Personality",clothing:"Clothing"},u=/####\s*(Appearance|Personality|Clothing|||||Apariencia|Personalidad|Ropa)\s*([\s\S]*?)(?=####|$)/gi;let p,h=!1;for(;(p=u.exec(e))!==null;){h=!0;const x=p[1].trim().toLowerCase(),k=d[x],C=p[2].trim();k&&(c[k]=C)}!h&&e.trim()&&(c.Appearance=e.trim()),i(c)},[e]);const s=(c,d)=>{const u={...a,[c]:d};i(u);const p=`#### Appearance
${u.Appearance||""}

#### Personality
${u.Personality||""}

#### Clothing
${u.Clothing||""}`;t(p)},l={Appearance:{icon:n.jsx(B3,{className:"h-3.5 w-3.5"}),color:"text-gray-400"},Personality:{icon:n.jsx(G3,{className:"h-3.5 w-3.5"}),color:"text-gray-400"},Clothing:{icon:n.jsx(H3,{className:"h-3.5 w-3.5"}),color:"text-gray-400"}};return n.jsx("div",{className:"space-y-4 p-4 pb-2 text-sm flex flex-col pr-1 overflow-x-hidden",children:["Appearance","Personality","Clothing"].map(c=>{const d=l[c];return n.jsxs("div",{className:"flex-shrink-0 flex flex-col items-start w-full",children:[n.jsxs("div",{className:"flex flex-row items-center justify-between mb-1.5 w-full",children:[n.jsxs("div",{className:"flex flex-row items-center gap-1.5",children:[n.jsx("span",{className:d.color,children:d.icon}),n.jsx("h5",{className:`font-bold ${d.color} text-[11px] uppercase tracking-wider flex-shrink-0`,children:o(`node.content.${c.toLowerCase()}`)||c})]}),n.jsx(Ne,{title:o("node.action.copy"),onClick:u=>{u.stopPropagation(),navigator.clipboard.writeText(a[c]||"")},className:"p-1 text-gray-500 hover:text-accent-text transition-colors",tooltipPosition:"left",children:n.jsx(Dt,{className:"h-3 w-3"})})]}),n.jsx("textarea",{value:a[c]||"",onChange:u=>s(c,u.target.value),className:"w-full text-sm p-2 bg-gray-900/60 border border-gray-700 rounded-md resize-y focus:outline-none focus:ring-1 focus:ring-accent custom-scrollbar min-h-[60px] transition-colors hover:bg-gray-800/80 text-gray-200 text-left",onWheel:u=>u.stopPropagation(),onKeyDown:u=>u.stopPropagation(),onFocus:r})]},c)})})},GP=({char:e,cardIdx:t,nodeId:o,isDragOver:r,setIsDragOver:a,onRatioChange:i,onPasteImage:s,onClearImage:l,onCopyImage:c,onGenerateImage:d,onEditRaster:u,onEditAI:p,onCrop1x1:h,onExpandRatio:x,onSetEditingIndex:k,getFullSizeImage:C,setImageViewer:w,onCopyImageToClipboard:f,processNewImage:g,transformingRatio:v,isGeneratingImage:_,t:S})=>{const T=!!(e.thumbnails[e.selectedRatio]||e.image);return n.jsxs("div",{className:"flex flex-col flex-shrink-0 mb-1",children:[n.jsx("div",{className:"flex items-end pl-2 gap-1 h-7 z-0",children:["1:1","16:9","9:16"].map(P=>n.jsx("button",{onClick:R=>{R.stopPropagation(),i(P)},onDragEnter:R=>{R.stopPropagation(),i(P)},className:`px-3 py-1 text-[10px] font-bold outline-none transition-colors rounded-t-md ${e.selectedRatio===P?"bg-gray-700/50 text-white h-full shadow-none":"bg-gray-900/40 text-gray-500 h-[80%] hover:bg-gray-700/50 hover:text-gray-300"}`,children:P},P))}),n.jsx("div",{onClick:k,onDragEnter:P=>{P.dataTransfer.types.includes("application/prompt-modifier-card")||(P.preventDefault(),P.stopPropagation(),a(!0))},onDragOver:P=>{P.dataTransfer.types.includes("application/prompt-modifier-card")||(P.preventDefault(),P.stopPropagation(),a(!0))},className:`flex-shrink-0 h-[256px] bg-gray-700/50 rounded-xl flex items-center justify-center cursor-pointer transition-all group relative overflow-hidden z-10 hover:z-20 hover:bg-gray-900/80 ${r?"border-2 border-accent ring-2 ring-accent/20":""}`,onDragLeave:()=>a(!1),onDrop:P=>{var q;if(P.dataTransfer.types.includes("application/prompt-modifier-card"))return;P.preventDefault(),P.stopPropagation(),a(!1);const R=P.dataTransfer.getData("application/prompt-modifier-drag-image");if(R){g(R);return}const D=(q=P.dataTransfer.files)==null?void 0:q[0];if(D!=null&&D.type.startsWith("image/")){const O=new FileReader;O.onload=E=>{var A;return g((A=E.target)==null?void 0:A.result)},O.readAsDataURL(D)}},children:e.thumbnails[e.selectedRatio]||e.image?n.jsxs(n.Fragment,{children:[n.jsx("img",{src:e.thumbnails[e.selectedRatio]||e.image,className:"object-contain w-full h-full transition-opacity group-hover:opacity-80",style:{imageRendering:"auto"},draggable:!0,onDragStart:P=>{const R=C(t*10+(Wt[e.selectedRatio]||1))||e.image;R&&(P.dataTransfer.setData("application/prompt-modifier-drag-image",R),P.stopPropagation())},onClick:P=>{P.stopPropagation(),w({sources:[{src:C(t*10+(Wt[e.selectedRatio]||1))||e.image,frameNumber:0}],initialIndex:0})}}),n.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-20",children:[n.jsx(Ne,{title:S("node.action.copy"),onClick:P=>{P.stopPropagation(),c()},className:"bg-black/60 p-1.5 rounded text-accent-text hover:text-white",tooltipPosition:"left",children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Ne,{title:S("node.action.paste"),onClick:P=>{P.stopPropagation(),s()},className:"bg-black/60 p-1.5 rounded text-accent-text hover:text-white",tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),n.jsx(Ne,{title:S("node.action.clear"),onClick:P=>{P.stopPropagation(),l()},className:"bg-black/60 p-1.5 rounded text-red-400 hover:text-white",tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{d:"M6 18L18 6M6 6l12 12",strokeWidth:2,strokeLinecap:"round"})})})]})]}):n.jsxs("div",{className:"flex flex-col items-center justify-center w-full h-full gap-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),n.jsx("div",{className:"flex flex-col items-center justify-center text-[10px] text-gray-500 uppercase font-bold text-center px-4 leading-normal gap-1 max-w-[200px]",children:n.jsx("span",{className:"text-balance",children:S("node.content.dropImage")})}),n.jsxs("button",{onClick:P=>{P.stopPropagation(),s()},className:"mt-2 px-3 py-1 bg-gray-700 hover:bg-gray-600 text-gray-300 hover:text-white text-xs font-bold rounded border border-gray-600 transition-colors flex items-center gap-1.5",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),S("node.action.paste")]})]})}),n.jsx("div",{className:"h-4"}),n.jsxs("div",{className:"flex gap-1 flex-shrink-0 mb-2 items-center px-1",children:[n.jsx("button",{onClick:P=>{P.stopPropagation(),d()},disabled:_||!e.prompt,className:"flex-grow h-8 bg-accent hover:bg-accent-hover text-white font-bold rounded text-[10px] uppercase transition-colors disabled:opacity-50 shadow-sm",children:_?"...":S("node.content.generateImage")}),n.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.selectedRatio==="1:1"&&n.jsx(ct,{content:"Crop to 1:1",children:n.jsx("button",{onClick:P=>{P.stopPropagation(),h()},disabled:!!v||!T,className:"w-12 bg-accent hover:bg-accent-hover text-white rounded text-[10px] font-bold transition-colors h-8 flex items-center justify-center disabled:opacity-50 disabled:bg-gray-700 disabled:text-gray-500",children:v==="1:1"?"...":"1:1"})}),e.selectedRatio==="16:9"&&n.jsx(ct,{content:S("node.action.expand169"),children:n.jsx("button",{onClick:P=>{P.stopPropagation(),x("16:9")},disabled:!!v||!T,className:"w-12 bg-accent hover:bg-accent-hover text-white rounded text-[10px] font-bold transition-colors h-8 flex items-center justify-center disabled:opacity-50 disabled:bg-gray-700 disabled:text-gray-500",children:v==="16:9"?"...":"16:9"})}),e.selectedRatio==="9:16"&&n.jsx(ct,{content:S("node.action.expand916"),children:n.jsx("button",{onClick:P=>{P.stopPropagation(),x("9:16")},disabled:!!v||!T,className:"w-12 bg-accent hover:bg-accent-hover text-white rounded text-[10px] font-bold transition-colors h-8 flex items-center justify-center disabled:opacity-50 disabled:bg-gray-700 disabled:text-gray-500",children:v==="9:16"?"...":"9:16"})})]}),n.jsxs("div",{className:"flex gap-1 shrink-0",children:[n.jsx(ct,{content:S("node.action.rasterEditor"),children:n.jsx("button",{onClick:P=>{P.stopPropagation(),u()},disabled:!(e.thumbnails[e.selectedRatio]||e.image),className:"w-9 h-8 bg-accent-secondary hover:bg-accent-secondary-hover text-white rounded flex items-center justify-center disabled:opacity-50 transition-colors disabled:bg-gray-700 disabled:text-gray-500",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})})}),n.jsx(ct,{content:S("node.action.openInAIEditor"),children:n.jsx("button",{onClick:P=>{P.stopPropagation(),p()},disabled:!e.image,className:"w-9 h-8 bg-accent-secondary hover:bg-accent-secondary-hover text-white rounded flex items-center justify-center disabled:opacity-50 transition-colors disabled:bg-gray-700 disabled:text-gray-500",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})})})]})]})]})},HP=380,Wg="Full body character concept on a gray background",$g="Full-length conceptual object on a grey background",Kg=({isCollapsed:e,onClick:t})=>n.jsx("button",{onClick:t,className:"p-0.5 rounded hover:bg-gray-600 text-gray-400 hover:text-white transition-colors focus:outline-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 transform transition-transform duration-200 ${e?"-rotate-90":"rotate-0"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),UP=({char:e,index:t,nodeId:o,isDragging:r,onUpdate:a,onRemove:i,onSetAsOutput:s,onToggleActive:l,onDragStart:c,onDragEnd:d,onSmartDragOver:u,onRatioChange:p,onPasteImage:h,onClearImage:x,onCopyImage:k,onGenerateImage:C,onEditRaster:w,onEditAI:f,onCrop1x1:g,onExpandRatio:v,onSetEditingIndex:_,onSyncFromConnection:S,onLoad:T,onSave:P,onSaveToCatalog:R,onCopySpecific:D,onPasteSpecific:q,onDetach:O,onModify:E,getFullSizeImage:A,setImageViewer:N,onCopyImageToClipboard:j,processNewImage:L,t:M,deselectAllNodes:V,languages:H,secondaryLanguage:F,isModifyingCharacter:G,isUpdatingDescription:B,onUpdateDescription:Y,transformingRatio:ee,isGeneratingImage:ie,isUpdatingCharacterPrompt:ce,modificationRequest:pe,setModificationRequest:ue,hasDuplicateIndex:re})=>{const[$,Z]=y.useState(!1),te=`${o}-${t}`,ae=e.isActive?"":"opacity-50 grayscale pointer-events-none",I=e.isImageCollapsed??!1,J=e.isPromptCollapsed??!1;return n.jsxs("div",{className:"flex flex-col h-full border border-gray-800 rounded-xl bg-gray-900/80 p-2.5 overflow-hidden shadow-xl hover:border-gray-700 transition-all flex-shrink-0",style:{width:`${HP}px`,contain:"content",opacity:r?.4:1,transform:r?"scale(0.95)":"none"},onDragOver:u,children:[n.jsxs("div",{className:"h-8 bg-gray-700 rounded-t-lg border-b border-gray-600 flex items-center px-3 cursor-grab active:cursor-grabbing hover:bg-gray-800 transition-colors mb-2 group/handle relative flex-shrink-0 gap-2",draggable:!0,onDragStart:c,onDragEnd:d,children:[n.jsx("div",{className:"flex items-center gap-1 overflow-hidden flex-grow",children:n.jsxs("span",{className:"text-xs font-bold truncate",children:[n.jsxs("span",{className:re?"text-red-500 font-black":"text-accent-text",children:[e.index||"CH",":"]})," ",n.jsx("span",{className:"text-gray-200 ml-1",children:e.name||"Unnamed"}),n.jsxs("span",{className:"text-[9px] text-gray-500 font-mono ml-2 opacity-50",children:["#",e.id]})]})}),n.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[n.jsx(ct,{content:e.isActive?"Mute Card (Exclude from Output)":"Unmute Card",children:n.jsx("button",{onClick:W=>{W.stopPropagation(),l()},className:`p-0.5 rounded hover:bg-gray-600 transition-colors ${e.isActive?"text-gray-400 hover:text-white":"text-gray-500"}`,onMouseDown:W=>W.stopPropagation(),children:e.isActive?n.jsx(Cl,{className:"h-4 w-4"}):n.jsx(kl,{className:"h-4 w-4"})})}),n.jsx(ct,{content:M("node.action.markPrimary"),children:n.jsx("button",{onClick:W=>{W.stopPropagation(),s()},className:`p-0.5 rounded hover:bg-gray-700 transition-colors ${e.isOutput?"text-accent-text":"text-gray-500 hover:text-gray-300"}`,onMouseDown:W=>W.stopPropagation(),children:e.isOutput?n.jsx(W3,{className:"h-4 w-4"}):n.jsx(V3,{className:"h-4 w-4"})})}),n.jsx(ct,{content:M("node.action.removeCard"),children:n.jsx("button",{onClick:W=>{W.stopPropagation(),i()},className:"p-0.5 rounded hover:bg-red-900/50 text-gray-500 hover:text-red-400 transition-colors",onMouseDown:W=>W.stopPropagation(),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{d:"M6 18L18 6M6 6l12 12",strokeWidth:2.5,strokeLinecap:"round"})})})})]})]}),n.jsxs("div",{className:`flex flex-col flex-grow min-h-0 ${ae}`,children:[n.jsxs("div",{className:"flex gap-2 flex-shrink-0 items-center mb-2 h-[32px]",children:[n.jsx("input",{type:"text",value:e.name,onChange:W=>a({name:W.target.value}),placeholder:M("node.content.character"),className:"flex-grow min-w-0 px-2 bg-gray-700 border border-gray-600 rounded-md text-sm text-white focus:ring-1 focus:ring-accent outline-none h-[32px] transition-colors hover:border-gray-500",onMouseDown:W=>W.stopPropagation(),onFocus:V}),n.jsx(FP,{value:e.index,onChange:W=>a({index:W}),placeholder:"Index",onFocus:V,readOnly:!0,className:`w-28 shrink-0 ${re?"border-red-500 hover:border-red-500":""}`})]}),n.jsxs("div",{className:"flex flex-col flex-shrink-0 mb-1",children:[n.jsx("div",{className:"flex items-center justify-between bg-gray-800/50 px-2 py-1 rounded mb-1 cursor-pointer hover:bg-gray-700/50 transition-colors select-none",onClick:()=>a({isImageCollapsed:!I}),children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Kg,{isCollapsed:I,onClick:W=>{W.stopPropagation(),a({isImageCollapsed:!I})}}),n.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:"IMAGE"})]})}),!I&&n.jsx(GP,{char:e,cardIdx:t,nodeId:o,isDragOver:$,setIsDragOver:Z,onRatioChange:p,onPasteImage:h,onClearImage:x,onCopyImage:k,onGenerateImage:C,onEditRaster:w,onEditAI:f,onCrop1x1:g,onExpandRatio:v,onSetEditingIndex:_,getFullSizeImage:A,setImageViewer:N,onCopyImageToClipboard:j,processNewImage:L,transformingRatio:ee,isGeneratingImage:ie,t:M})]}),n.jsxs("div",{className:"flex flex-col gap-1 mb-2 shrink-0",children:[n.jsxs("div",{className:"flex justify-between items-center mb-0.5 cursor-pointer select-none",onClick:()=>a({isPromptCollapsed:!J}),children:[n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx(Kg,{isCollapsed:J,onClick:W=>{W.stopPropagation(),a({isPromptCollapsed:!J})}}),n.jsx("span",{className:"text-gray-400",children:n.jsx(U3,{className:"h-3 w-3"})}),n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:M("node.content.prompt")})]}),n.jsxs("div",{className:"flex gap-1",onClick:W=>W.stopPropagation(),children:[n.jsx(Ne,{title:M("node.content.updatePromptFromImage"),onClick:()=>S(),tooltipPosition:"left",disabled:ce===te,children:ce===te?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-cyan-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),n.jsx(Ne,{title:M("node.action.copy"),onClick:()=>navigator.clipboard.writeText(e.prompt),tooltipPosition:"left",children:n.jsx(Dt,{className:"h-3 w-3"})})]})]}),!J&&n.jsxs(n.Fragment,{children:[n.jsx("textarea",{value:e.prompt,onChange:W=>a({prompt:W.target.value}),className:"w-full p-2 bg-gray-900/60 border border-gray-700 rounded text-xs text-gray-200 resize-y focus:border-accent outline-none min-h-[60px] max-h-[120px] custom-scrollbar",onMouseDown:W=>W.stopPropagation(),onFocus:V}),n.jsxs("div",{className:"flex flex-col gap-1 mb-1 mt-1",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:M("node.content.additionalPromptSuffix")}),n.jsxs("div",{className:"flex gap-0.5",children:[n.jsx(ct,{content:M("node.action.characterConcept"),children:n.jsx("button",{onClick:W=>{W.stopPropagation(),a({additionalPrompt:Wg})},className:`p-0.5 rounded hover:bg-gray-700 transition-colors ${e.additionalPrompt===Wg?"text-accent":"text-gray-500 hover:text-accent"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})})}),n.jsx(ct,{content:M("node.action.objectConcept"),children:n.jsx("button",{onClick:W=>{W.stopPropagation(),a({additionalPrompt:$g})},className:`p-0.5 rounded hover:bg-gray-700 transition-colors ${e.additionalPrompt===$g?"text-accent":"text-gray-500 hover:text-accent"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})})})]})]}),n.jsx("input",{type:"text",value:e.additionalPrompt||"",onChange:W=>a({additionalPrompt:W.target.value}),className:"w-full p-1 bg-gray-900/60 border border-gray-700 rounded text-xs text-gray-400 focus:border-accent outline-none",onMouseDown:W=>W.stopPropagation(),onFocus:V})]}),n.jsxs("div",{className:"flex flex-col gap-1 border-b border-gray-700/50 pb-3 mb-2",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:M("node.content.modificationRequest")}),n.jsxs("div",{className:"flex gap-2 h-[32px]",children:[n.jsx("input",{value:pe,onChange:W=>ue(W.target.value),placeholder:"...",className:"flex-grow bg-gray-900/60 border border-gray-700 rounded px-2 text-xs text-white focus:border-accent outline-none h-full",onMouseDown:W=>W.stopPropagation(),onFocus:V}),n.jsx("div",{className:"flex items-center bg-gray-700 rounded p-0.5 h-full space-x-0.5 justify-center min-w-[50px]",children:[{code:"en",label:"EN"},{code:F,label:H[F].short}].map((W,U)=>n.jsx("button",{onClick:Q=>{Q.stopPropagation(),a({targetLanguage:W.code})},className:`h-full flex-1 rounded px-1.5 text-[10px] font-bold transition-colors flex items-center justify-center ${e.targetLanguage===W.code?"bg-accent text-white":"text-gray-400 hover:text-gray-200"}`,children:W.label},W.code+U))}),n.jsx("div",{className:"flex gap-1 h-full",children:n.jsx(ct,{content:M("node.action.modifyCharacter"),children:n.jsx("button",{onClick:W=>{W.stopPropagation(),E()},disabled:!pe.trim()||G===te,className:"w-8 bg-accent hover:bg-accent-hover text-white rounded flex items-center justify-center disabled:opacity-50 h-full",children:G===te?n.jsxs("svg",{className:"animate-spin h-3.5 w-3.5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})})})]})]})]})]}),n.jsxs("div",{className:"flex-grow min-h-0 mt-2 relative p-0 border border-gray-700/50 rounded-xl bg-gray-900/20 shadow-inner overflow-hidden flex flex-col overflow-x-hidden",children:[n.jsxs("div",{className:"px-4 py-2 bg-gray-800 border-b border-gray-700 flex items-center justify-between cursor-pointer hover:bg-gray-750 transition-colors select-none flex-shrink-0",onClick:()=>a({isDescriptionCollapsed:!e.isDescriptionCollapsed}),children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:`transform transition-transform duration-200 ${e.isDescriptionCollapsed?"-rotate-90":""}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})}),n.jsx("span",{className:"text-[10px] font-black text-gray-300 uppercase tracking-widest",children:M("node.content.fullDescriptionTitle")})]}),n.jsxs("div",{className:"flex gap-1",children:[n.jsx(Ne,{title:M("node.action.updateDescription"),onClick:W=>{W.stopPropagation(),Y()},disabled:B===te||!e.prompt,className:"p-1 text-gray-500 hover:text-accent-text transition-colors",tooltipPosition:"left",children:B===te?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-accent-text",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),n.jsx(Ne,{title:M("node.action.copy"),onClick:W=>{W.stopPropagation(),navigator.clipboard.writeText(e.fullDescription)},className:"p-1 text-gray-500 hover:text-accent-text transition-colors",tooltipPosition:"left",children:n.jsx(Dt,{className:"h-3 w-3"})})]})]}),!e.isDescriptionCollapsed&&n.jsx("div",{className:"overflow-y-auto custom-scrollbar flex-grow overflow-x-hidden mr-1",onWheel:W=>W.stopPropagation(),style:{scrollbarGutter:"stable",overscrollBehaviorY:"contain"},children:n.jsx(BP,{fullDescription:e.fullDescription||"",onDescriptionChange:W=>a({fullDescription:W}),t:M,onFocus:V})})]}),n.jsxs("div",{className:"flex gap-1.5 pt-2.5 mt-auto border-t border-gray-700/50 flex-shrink-0 bg-gray-800/20 backdrop-blur-sm",children:[n.jsx("button",{onClick:W=>{W.stopPropagation(),P()},className:"flex-1 h-9 bg-accent hover:bg-accent-hover text-white font-bold rounded text-[10px] uppercase tracking-tighter transition-colors",children:M("node.action.saveCharacter")}),n.jsx("button",{onClick:W=>{W.stopPropagation(),T()},className:"flex-1 h-9 bg-accent-secondary hover:bg-accent-secondary-hover text-white font-bold rounded text-[10px] uppercase tracking-tighter transition-colors",children:M("node.action.loadCharacter")}),n.jsxs("div",{className:"flex gap-1.5 ml-auto",children:[n.jsx(Ne,{title:M("catalog.saveTo"),onClick:W=>{W.stopPropagation(),R()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Ne,{title:M("node.action.copy"),onClick:W=>{W.stopPropagation(),D()},children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Ne,{title:M("node.action.paste"),onClick:W=>{W.stopPropagation(),q()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),n.jsx(Ne,{title:M("node.action.detachAndPaste"),onClick:W=>{W.stopPropagation(),O()},tooltipPosition:"top",tooltipAlign:"end",children:n.jsx(B1,{className:"h-4 w-4"})})]})]})]})]})},VP=Et.memo(UP),Zr=410,Qr=90,Jg=Et.memo(({index:e,activeDropZone:t,onDragOver:o,onDrop:r,onDragLeave:a})=>n.jsx("div",{className:`w-[24px] h-full flex items-center justify-center flex-shrink-0 transition-all cursor-copy ${t===e?"bg-gray-800/30":""}`,onDragOver:i=>o(i,e),onDragLeave:a,onDrop:r,children:n.jsx("div",{className:`h-[90%] rounded-full transition-all duration-200 pointer-events-none ${t===e?"w-1 bg-accent shadow-[0_0_10px_var(--color-accent)] opacity-100 scale-y-100":"w-[1px] bg-gray-700/30 opacity-50 scale-y-90"}`})})),WP=({node:e,onValueChange:t,onSaveCharacterCard:o,onLoadCharacterCard:r,t:a,deselectAllNodes:i,onSaveCharacterToCatalog:s,setFullSizeImage:l,getFullSizeImage:c,setImageViewer:d,onCopyImageToClipboard:u,onDownloadImage:p,addToast:h,onUpdateCharacterDescription:x,isUpdatingDescription:k,onModifyCharacter:C,isModifyingCharacter:w,getUpstreamNodeValues:f,connectedInputs:g,onDetachCharacter:v,onGenerateImage:_,isGeneratingImage:S,onAddNode:T,onDeleteNode:P})=>{const R=Ut(),{setNodes:D,setSelectedNodeIds:q,handleUpdateCharacterPromptFromImage:O,isUpdatingCharacterPrompt:E}=R||{},A=T||(R==null?void 0:R.onAddNode);P||(R==null||R.deleteNodeAndConnections);const N=y.useRef(null),[j,L]=y.useState(null),[M,V]=y.useState(!1),[H,F]=y.useState(null),[G,B]=y.useState(0),[Y,ee]=y.useState({}),[ie,ce]=y.useState(null),[pe,ue]=y.useState(null),[re,$]=y.useState(null),[Z,te]=y.useState(!1),{secondaryLanguage:ae}=vt(),I=g==null?void 0:g.has(void 0),J=y.useMemo(()=>{try{let be=JSON.parse(e.value||"[]");return Array.isArray(be)||(typeof be=="object"&&be!==null?be=[be]:be=[]),be.length===0&&(be=[{id:`char-card-${Date.now()}`,name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!0,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"}]),be.map((Pe,Ee)=>({id:Pe.id||`char-card-${Date.now()}-${Ee}`,name:Pe.name||"",index:(Pe.index||Pe.alias||`Entity-${Ee+1}`).replace(/^Character-/,"Entity-"),image:Pe.image||null,thumbnails:Pe.thumbnails||Pe.imageSources||{"1:1":null,"16:9":null,"9:16":null},selectedRatio:Pe.selectedRatio||"1:1",prompt:Pe.prompt||"",additionalPrompt:Pe.additionalPrompt!==void 0?Pe.additionalPrompt:"Full body character concept on a gray background",fullDescription:Pe.fullDescription||"",targetLanguage:Pe.targetLanguage||"en",isOutput:Pe.isOutput||Ee===0&&!be.some(Me=>Me.isOutput),isActive:Pe.isActive!==!1,isDescriptionCollapsed:Pe.isDescriptionCollapsed??!1,isImageCollapsed:Pe.isImageCollapsed??!1,isPromptCollapsed:Pe.isPromptCollapsed??!1}))}catch{return[{id:`char-card-${Date.now()}`,name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!0,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"}]}},[e.value]);y.useEffect(()=>{try{const be=JSON.parse(e.value||"[]");(Array.isArray(be)?be:[be]).some(Me=>Me.index&&Me.index.startsWith("Character-"))&&t(e.id,JSON.stringify(J))}catch{}},[e.value,J,t,e.id]),y.useEffect(()=>{ce(null),ue(null),$(null)},[J.length]);const W=y.useMemo(()=>{const be={},Pe=new Set;return J.forEach(Ee=>{const Me=(Ee.index||"").trim();Me&&(be[Me]=(be[Me]||0)+1)}),Object.entries(be).forEach(([Ee,Me])=>{Me>1&&Pe.add(Ee)}),Pe},[J]),U=y.useCallback(be=>{t(e.id,JSON.stringify(be))},[e.id,t]),Q=y.useCallback((be,Pe)=>{const Ee=[...J];Ee[be]={...Ee[be],...Pe},U(Ee)},[J,U]),de=be=>{const Pe=J.map((Ee,Me)=>({...Ee,isOutput:Me===be}));U(Pe),h==null||h("Character marked as output","success")},se=be=>{const Pe=[...J];Pe[be]={...Pe[be],isActive:!Pe[be].isActive},U(Pe)},X=(be,Pe)=>{ce(Pe);const Ee=J[Pe],Me={...Ee.thumbnails};Object.entries(Wt).forEach(([tt,Nt])=>{const xe=c(e.id,Pe*10+Nt);xe&&(Me[tt]=xe)});const Fe={type:"prompt-modifier-character-card-transfer",sourceNodeId:e.id,sourceIndex:Pe,character:{...Ee,imageSources:Me,_fullResActive:c(e.id,Pe*10)}};be.dataTransfer.setData("application/prompt-modifier-card",JSON.stringify(Fe)),be.dataTransfer.effectAllowed="move"},K=(be,Pe)=>{if(!be.dataTransfer.types.includes("application/prompt-modifier-card"))return;be.preventDefault(),be.stopPropagation();const Ee=be.currentTarget.getBoundingClientRect(),Fe=be.clientX-Ee.left>Ee.width/2,tt=Pe+(Fe?1:0);$(tt),ue(tt)},oe=y.useCallback((be,Pe)=>{be.dataTransfer.types.includes("application/prompt-modifier-card")&&(be.preventDefault(),be.stopPropagation(),$(Pe),ue(Pe))},[]),ne=y.useCallback(()=>{},[]),le=async be=>{be.preventDefault(),be.stopPropagation(),$(null),ce(null),te(!1);const Pe=pe;ue(null);const Ee=be.dataTransfer.getData("application/prompt-modifier-card");if(Ee)try{const Me=JSON.parse(Ee);if(Me.type!=="prompt-modifier-character-card-transfer")return;const{sourceNodeId:Fe,sourceIndex:tt,character:Nt}=Me,xe=Pe!==null?Pe:J.length;if(Fe===e.id){if(tt===xe||tt===xe-1)return;const Be=[...J],[Le]=Be.splice(tt,1);let Ue=xe;xe>tt&&(Ue-=1),Be.splice(Ue,0,Le);const Ze={};J.forEach((at,ot)=>{for(let rt=0;rt<10;rt++){const et=c(e.id,ot*10+rt);et&&(Ze[ot*10+rt]=et)}});for(let at=0;at<J.length*10;at++)l(e.id,at,null);Be.forEach((at,ot)=>{const rt=J.findIndex(et=>et.id===at.id);if(rt!==-1)for(let et=0;et<10;et++){const mt=Ze[rt*10+et];mt&&l(e.id,ot*10+et,mt)}}),U(Be)}else{const Be=[...J];Be.length===1&&!Be[0].name&&!Be[0].image&&!Be[0].prompt&&Be.splice(0,1);const Le=Be.length===0,Ue={...Nt,id:`char-card-${Date.now()}`,isOutput:Le,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!1},Ze=Math.min(xe,Be.length);Be.splice(Ze,0,Ue),Ue.imageSources&&Object.entries(Ue.imageSources).forEach(([at,ot])=>{const rt=Wt[at];rt&&typeof ot=="string"&&l(e.id,Ze*10+rt,ot)}),Ue._fullResActive&&l(e.id,Ze*10,Ue._fullResActive),D&&D(at=>at.map(ot=>ot.id===e.id?{...ot,width:Be.length*Zr+Qr}:ot)),U(Be),D&&(R!=null&&R.setFullSizeImage)&&(R!=null&&R.getFullSizeImage)&&D(at=>at.map(ot=>{if(ot.id===Fe)try{const rt=JSON.parse(ot.value);let et=rt.filter((xt,Ct)=>Ct!==tt);if(et.length===0){et=[{id:`char-card-${Date.now()}-reset`,name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!0,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"}];for(let xt=0;xt<10;xt++)R.setFullSizeImage(Fe,xt,null)}else{rt[tt].isOutput&&et.length>0&&(et[0].isOutput=!0);for(let Ct=tt;Ct<rt.length-1;Ct++)for(let pt=0;pt<10;pt++){const dt=R.getFullSizeImage(Fe,(Ct+1)*10+pt);R.setFullSizeImage(Fe,Ct*10+pt,dt||null)}const xt=rt.length-1;for(let Ct=0;Ct<10;Ct++)R.setFullSizeImage(Fe,xt*10+Ct,null)}const mt=Math.max(Zr+Qr,et.length*Zr+Qr);return{...ot,value:JSON.stringify(et),width:mt}}catch{return ot}return ot})),h==null||h("Card transferred","success")}}catch(Me){console.error("Drop failed",Me),h==null||h("Drop failed: "+(Me instanceof Error?Me.message:"Unknown error"),"error")}},ge=be=>{be.stopPropagation();let Pe=1;const Ee=new Set(J.map(Fe=>Fe.name));for(;Ee.has(`New Entity ${Pe}`);)Pe++;const Me=[...J,{id:`char-card-${Date.now()}`,name:`New Entity ${Pe}`,index:`Entity-${J.length+1}`,image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!1,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"}];U(Me),D&&D(Fe=>Fe.map(tt=>tt.id===e.id?{...tt,width:Me.length*Zr+Qr}:tt))},we=be=>{if(J.length<=1){U([{id:`char-card-${Date.now()}`,name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!0,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"}]);return}for(let Me=be;Me<J.length-1;Me++)for(let Fe=0;Fe<10;Fe++){const tt=c(e.id,(Me+1)*10+Fe);l(e.id,Me*10+Fe,tt||null)}const Pe=J.length-1;for(let Me=0;Me<10;Me++)l(e.id,Pe*10+Me,null);const Ee=J.filter((Me,Fe)=>Fe!==be);Ee.some(Me=>Me.isOutput)||(Ee[0].isOutput=!0),U(Ee),D&&D(Me=>Me.map(Fe=>Fe.id===e.id?{...Fe,width:Math.max(Zr+Qr,Ee.length*Zr+Qr)}:Fe))},_e=async be=>{const Pe=J[be],Ee={...Pe.thumbnails};Object.entries(Wt).forEach(([Fe,tt])=>{const Nt=c(e.id,be*10+tt);Nt&&(Ee[Fe]=Nt)});const Me={type:"character-card",...Pe,imageSources:Ee};delete Me.id,delete Me.thumbnails;try{await navigator.clipboard.writeText(JSON.stringify(Me,null,2)),h==null||h(a("toast.copiedToClipboard"),"success")}catch{h==null||h(a("toast.copyFailed"),"error")}},fe=async be=>{try{const Pe=await navigator.clipboard.readText(),Ee=JSON.parse(Pe);let Me=Array.isArray(Ee)?Ee[0]:Ee;if(Me&&(Me.type==="character-card"||Me.name||Me.prompt)){const Fe=Me.imageSources||{"1:1":null,"16:9":null,"9:16":null},tt={"1:1":null,"16:9":null,"9:16":null};Me.image&&!Me.imageSources&&(Fe["1:1"]=Me.image);for(const[Be,Le]of Object.entries(Fe))if(typeof Le=="string"&&Le.startsWith("data:")){const Ue=be*10+(Wt[Be]||1);l(e.id,Ue,Le),tt[Be]=await Lt(Le,256,256)}else tt[Be]=Le;const Nt=Me.selectedRatio||"1:1";Fe[Nt]&&typeof Fe[Nt]=="string"&&Fe[Nt].startsWith("data:")&&l(e.id,be*10,Fe[Nt]);const xe=[...J];xe[be]={...J[be],name:Me.name||"",index:Me.index||Me.alias||`Entity-${be+1}`,prompt:Me.prompt||Me.imagePrompt||"",fullDescription:Me.fullDescription||Me.description||"",selectedRatio:Nt,image:tt[Nt],thumbnails:tt},U(xe),h==null||h(a("toast.pastedFromClipboard"),"success")}}catch{h==null||h(a("toast.pasteFailed"),"error")}},he=async be=>{try{const Pe=await navigator.clipboard.read();for(const Ee of Pe){const Me=Ee.types.find(Fe=>Fe.startsWith("image/"));if(Me){const Fe=await Ee.getType(Me),tt=new FileReader;tt.onload=async Nt=>{var Be;const xe=(Be=Nt.target)==null?void 0:Be.result;xe&&(await Se(be,xe),h==null||h(a("toast.pastedFromClipboard"),"success"))},tt.readAsDataURL(Fe);return}}h==null||h(a("toast.pasteFailed"),"error")}catch(Pe){console.error("Paste image failed",Pe),h==null||h(a("toast.pasteFailed"),"error")}},ye=(be,Pe)=>{const Ee=J[be];if(Pe===Ee.selectedRatio)return;const Me=c(e.id,be*10+(Wt[Pe]||1)),Fe=Ee.thumbnails[Pe]||null;Me?l(e.id,be*10,Me):Fe&&l(e.id,be*10,Fe),Q(be,{selectedRatio:Pe,image:Fe})},Se=async(be,Pe)=>{const Ee=J[be];l(e.id,be*10,Pe),l(e.id,be*10+(Wt[Ee.selectedRatio]||1),Pe);const Me=await Lt(Pe,256,256),Fe={...Ee.thumbnails,[Ee.selectedRatio]:Me};Q(be,{thumbnails:Fe,image:Me})};y.useCallback(be=>{if(!I||!f)return;const Ee=f(e.id).find(Me=>typeof Me=="string"&&!Me.trim().startsWith("{")&&!Me.trim().startsWith("["))||"";Ee?(Q(be,{prompt:Ee}),h==null||h("Prompt synced from connection","success")):h==null||h("No text found in connection","info")},[I,f,e.id,Q,h]);const Te=y.useCallback(be=>{var Ee;const Pe=(Ee=be.target.files)==null?void 0:Ee[0];if(Pe){const Me=new FileReader;Me.onload=async Fe=>{var Nt;const tt=(Nt=Fe.target)==null?void 0:Nt.result;tt&&await Se(G,tt)},Me.readAsDataURL(Pe)}be.target&&(be.target.value="")},[G,Se]),Ae=be=>{const Pe=Y[be];!(Pe!=null&&Pe.trim())||!C||(C(e.id,be,Pe),ee(Ee=>({...Ee,[be]:""})))},Oe=be=>{O&&O(e.id,be)},me=be=>{const Pe=J[be],Ee=c(e.id,be*10+(Wt[Pe.selectedRatio]||1))||Pe.image;if(!Ee||!A)return;const Me={x:e.position.x+e.width+50,y:e.position.y},Fe=A(z.IMAGE_EDITOR,Me),tt={inputImages:[Pe.thumbnails[Pe.selectedRatio]||Pe.image],prompt:Pe.prompt||"",outputImage:null,aspectRatio:Pe.selectedRatio,enableAspectRatio:!0,enableOutpainting:!1,outpaintingPrompt:"{main_prompt}. Fill the background with environment - fill in the white areas to naturally expand the image area of the original scene.",model:"gemini-2.5-flash-image",autoDownload:!0,autoCrop169:!1,leftPaneWidth:360,topPaneHeight:330};t(Fe,JSON.stringify(tt)),l(Fe,1,Ee)},ve=be=>{const Pe=J[be],Ee=c(e.id,be*10+(Wt[Pe.selectedRatio]||1))||Pe.image;Ee&&(F(Ee),B(be),V(!0))},Ie=async(be,Pe)=>{const Ee=J[be],Me=c(e.id,be*10)||Ee.image;if(Me){L(Pe);try{let Fe="Fill the background with gray studio environment";Pe==="16:9"?Fe="Fill the background with gray studio environment - fill in the white areas on the sides to naturally expand the image area of the gray scene.":Pe==="9:16"&&(Fe="Fill the background with gray studio environment - fill in the white areas on top and bottom to naturally expand the image area of the gray scene.");const tt=await Ap(Me,Pe,Fe,"gemini-2.5-flash-image","");await Se(be,tt),h&&h(`Converted to ${Pe} successfully`,"success")}catch(Fe){console.error(Fe),h&&h(`Failed to convert: ${Fe.message}`,"error")}finally{L(null)}}},ke=async be=>{const Pe=J[be],Ee=c(e.id,be*10)||Pe.image;if(Ee){L("1:1");try{const Me=await Yb(Ee);await Se(be,Me),h&&h("Cropped to 1:1 successfully","success")}catch(Me){console.error(Me),h&&h(`Failed to crop: ${Me.message}`,"error")}finally{L(null)}}},je=be=>{const Pe=J[be];if(v){const Ee={...Pe.thumbnails};Object.entries(Wt).forEach(([tt,Nt])=>{const xe=c(e.id,be*10+Nt);xe&&(Ee[tt]=xe)});const Me=c(e.id,be*10),Fe={...Pe,imageSources:Ee,_fullResImage:Me};v(Fe,e),we(be)}},Ge=be=>{(be.dataTransfer.types.includes("application/prompt-modifier-card")||be.dataTransfer.types.includes("Files")||be.dataTransfer.types.includes("application/prompt-modifier-drag-image"))&&(be.preventDefault(),be.stopPropagation(),te(!0))};return n.jsxs("div",{className:`flex h-full w-full overflow-x-scroll custom-scrollbar p-0 gap-0 pb-2 transition-colors ${Z?"bg-accent-dim":""}`,onWheel:be=>be.stopPropagation(),style:{scrollbarGutter:"stable",overscrollBehaviorY:"contain"},onDrop:le,onDragOver:Ge,onDragLeave:()=>te(!1),children:[n.jsx("style",{children:".custom-scrollbar::-webkit-scrollbar { height: 8px; width: 8px; } .custom-scrollbar::-webkit-scrollbar-track { background: rgba(31, 41, 45, 0.5); border-radius: 4px; margin: 0 4px; } .custom-scrollbar::-webkit-scrollbar-thumb { background: var(--color-scrollbar); border-radius: 4px; } .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #6b7280; }"}),n.jsx(Jl,{isOpen:M,onClose:()=>{V(!1)},onApply:be=>Se(G,be),imageSrc:H}),n.jsx("input",{ref:N,type:"file",accept:"image/*",className:"hidden",onChange:Te}),J.map((be,Pe)=>n.jsxs(Et.Fragment,{children:[n.jsx(Jg,{index:Pe,activeDropZone:re,onDragOver:oe,onDrop:le,onDragLeave:ne}),n.jsx(VP,{char:be,index:Pe,nodeId:e.id,isDragging:ie===Pe,onUpdate:Ee=>Q(Pe,Ee),onRemove:()=>we(Pe),onSetAsOutput:()=>de(Pe),onToggleActive:()=>se(Pe),onDragStart:Ee=>X(Ee,Pe),onDragEnd:()=>{ce(null),ue(null),$(null)},onSmartDragOver:Ee=>K(Ee,Pe),onRatioChange:Ee=>ye(Pe,Ee),onPasteImage:()=>he(Pe),onClearImage:()=>Q(Pe,{thumbnails:{...be.thumbnails,[be.selectedRatio]:null},image:null}),onCopyImage:()=>{const Ee=c(e.id,Pe*10)||be.image;Ee&&u(Ee)},onGenerateImage:()=>{B(Pe),_(e.id,Pe)},onEditRaster:()=>ve(Pe),onEditAI:()=>me(Pe),onCrop1x1:()=>ke(Pe),onExpandRatio:Ee=>Ie(Pe,Ee),onSetEditingIndex:()=>{var Ee;B(Pe),(Ee=N.current)==null||Ee.click()},onSyncFromConnection:()=>Oe(Pe),onLoad:()=>r(e.id),onSave:()=>o(e.id,Pe),onSaveToCatalog:()=>s(e.id,Pe),onCopySpecific:()=>_e(Pe),onPasteSpecific:()=>fe(Pe),onDetach:()=>je(Pe),onModify:()=>Ae(Pe),getFullSizeImage:Ee=>c(e.id,Ee),setImageViewer:d,onCopyImageToClipboard:u,processNewImage:Ee=>Se(Pe,Ee),t:a,deselectAllNodes:i,languages:Pn,secondaryLanguage:ae,isModifyingCharacter:w,isUpdatingDescription:k,onUpdateDescription:()=>x&&x(e.id,Pe),transformingRatio:j,isGeneratingImage:S,isUpdatingCharacterPrompt:E,modificationRequest:Y[Pe]||"",setModificationRequest:Ee=>ee(Me=>({...Me,[Pe]:Ee})),hasDuplicateIndex:W.has((be.index||"").trim())})]},be.id)),n.jsx(Jg,{index:J.length,activeDropZone:re,onDragOver:oe,onDrop:le,onDragLeave:ne}),n.jsx("div",{className:"flex items-center justify-start pl-2 min-w-[60px] h-full",children:n.jsx(ct,{content:a("node.action.addCard"),children:n.jsx("button",{onClick:ge,className:"w-12 h-12 flex items-center justify-center bg-gray-800 hover:bg-cyan-900 border border-gray-600 hover:border-cyan-500 text-gray-400 hover:text-cyan-400 rounded-full transition-all shadow-lg group relative",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 transform transition-transform duration-200 group-hover:scale-110",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{d:"M12 4v16m8-8H4"})})})})})]})},$P=({node:e,onSanitize:t,isSanitizing:o,t:r,onSelectNode:a})=>n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsx("div",{className:"relative flex-grow min-h-0 mb-2",children:n.jsx("textarea",{readOnly:!0,value:e.value,placeholder:r("node.content.sanitizedPromptHere"),className:"absolute inset-0 w-full h-full p-2 bg-gray-700 border-none rounded-md resize-none focus:outline-none",onWheel:i=>i.stopPropagation(),onMouseDown:i=>{i.stopPropagation(),a()}})}),n.jsx("button",{onClick:()=>t(e.id),disabled:o,className:"w-full px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200",children:r(o?"node.content.sanitizing":"node.action.sanitize")})]}),KP=({node:e,onReadData:t,t:o,onSelectNode:r,getUpstreamNodeValues:a})=>{const{text:i,image:s,mediaUrl:l,mediaType:c}=y.useMemo(()=>{try{const x=JSON.parse(e.value||"{}");return{text:x.text||"",image:x.image||null,mediaUrl:x.mediaUrl||null,mediaType:x.mediaType||"video"}}catch{return{text:"",image:null,mediaUrl:null,mediaType:"video"}}},[e.value]),[d,u]=y.useState(null);y.useEffect(()=>{u(null)},[s]);const p=y.useMemo(()=>a(e.id),[a,e.id]),h=JSON.stringify(p);return y.useEffect(()=>{t(e.id)},[h,t,e.id]),n.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[n.jsxs("div",{className:"flex-grow min-h-0 flex flex-col space-y-2",children:[l&&n.jsxs("div",{className:"flex-1 min-h-[150px] bg-black rounded-md overflow-hidden relative group border border-gray-700",onMouseDown:x=>{x.stopPropagation(),r()},children:[c==="video"?n.jsx("video",{src:l,controls:!0,className:"w-full h-full object-contain"}):n.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-4 bg-gray-900",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-gray-500 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),n.jsx("audio",{src:l,controls:!0,className:"w-full max-w-[90%]"})]}),n.jsx("div",{className:"absolute top-1 left-1 bg-black/60 text-white text-[10px] px-1.5 py-0.5 rounded pointer-events-none uppercase backdrop-blur-sm border border-white/10",children:c})]}),s&&n.jsxs("div",{className:"flex-1 min-h-[150px] bg-gray-900/50 rounded-md p-1 relative group",onMouseDown:x=>{x.stopPropagation(),r()},children:[n.jsx("img",{src:s,alt:"Read data",className:"object-contain w-full h-full",onLoad:x=>u({width:x.currentTarget.naturalWidth,height:x.currentTarget.naturalHeight})}),d&&n.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/70 text-white text-[10px] px-1.5 py-0.5 rounded pointer-events-none backdrop-blur-sm",children:[d.width," x ",d.height," px"]})]}),n.jsxs("div",{className:"flex-grow min-h-0 relative",children:[n.jsx("textarea",{readOnly:!0,value:i,placeholder:!s&&!i&&!l?"":o("node.content.textDataHere"),className:"w-full h-full p-2 bg-slate-800 border-none rounded-md resize-none focus:outline-none text-gray-300",onWheel:x=>x.stopPropagation(),onMouseDown:x=>{x.stopPropagation(),r()}}),!s&&!i&&!l&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-center text-gray-500 pointer-events-none p-4",children:n.jsx("span",{children:o("node.content.noDataRead")})})]})]}),n.jsx("button",{onClick:()=>t(e.id),className:"w-full px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors duration-200 flex-shrink-0",children:o("node.content.readData")})]})},JP=({data:e,color:t="rgba(255, 255, 255, 0.5)",height:o=40})=>{const r=y.useRef(null);return y.useEffect(()=>{const a=r.current;if(!a||!e)return;const i=a.getContext("2d");if(!i)return;const s=window.devicePixelRatio||1,l=a.getBoundingClientRect();a.width=l.width*s,a.height=l.height*s,i.scale(s,s),i.clearRect(0,0,l.width,l.height);const c=l.width,d=l.height,u=d/2;i.fillStyle=t,i.beginPath();const p=Math.ceil(e.length/c),h=d/2;for(let x=0;x<c;x++){let k=1,C=-1;for(let w=0;w<p;w++){const f=e[x*p+w];f<k&&(k=f),f>C&&(C=f)}i.fillRect(x,u+k*h,1,Math.max(1,(C-k)*h))}},[e,t,o]),n.jsx("canvas",{ref:r,className:"w-full h-full absolute inset-0 pointer-events-none opacity-60"})},YP=({tracks:e,clips:t,currentTime:o,duration:r,zoom:a,onSeek:i,scrollLeft:s,onScroll:l,onClipSelect:c,selectedClipId:d,audioDataMap:u})=>{var S;const p=y.useRef(null),h=y.useRef(!1),x=Math.max(r*a,((S=p.current)==null?void 0:S.clientWidth)||0)+200,k=(T,P)=>{T.stopPropagation(),c(P)},C=T=>T.type==="video"?"bg-indigo-900/80 border-indigo-500":T.type==="image"?"bg-emerald-900/80 border-emerald-500":T.type==="audio"?"bg-amber-900/80 border-amber-500":"bg-gray-700 border-gray-500",w=T=>{if(!p.current)return 0;const P=p.current.getBoundingClientRect(),D=T-P.left+p.current.scrollLeft;return Math.max(0,D/a)},f=T=>{h.current=!0,i(w(T.clientX)),window.addEventListener("mousemove",g),window.addEventListener("mouseup",v)},g=T=>{h.current&&i(w(T.clientX))},v=()=>{h.current=!1,window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",v)};y.useEffect(()=>()=>{window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",v)},[]);const _=()=>{const T=[],P=a<20?5:a<50?1:.5,R=r+10;for(let D=0;D<=R;D+=P){const q=D*a;T.push(n.jsx("div",{className:"absolute top-0 bottom-0 border-l border-gray-600 pointer-events-none",style:{left:q},children:n.jsxs("span",{className:"absolute top-0 left-1 text-[9px] text-gray-400 select-none",children:[D,"s"]})},D))}return T};return n.jsx("div",{className:"flex flex-col h-full bg-gray-900 border-t border-gray-700",children:n.jsxs("div",{className:"flex-1 flex overflow-hidden relative",children:[n.jsxs("div",{className:"w-24 flex-shrink-0 bg-gray-800 border-r border-gray-700 z-20 flex flex-col shadow-lg",children:[n.jsx("div",{className:"h-8 border-b border-gray-700 bg-gray-800"})," ",e.map(T=>n.jsxs("div",{className:"h-16 border-b border-gray-700 flex flex-col justify-center px-2 text-xs text-gray-400 bg-gray-800 gap-1 relative",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:`w-2 h-2 rounded-full ${T.type==="audio"?"bg-amber-500":"bg-indigo-500"}`}),n.jsx("span",{className:"font-bold truncate",title:T.name,children:T.name})]}),n.jsx("div",{className:"flex items-center gap-1 text-[10px] opacity-60",children:n.jsx("span",{children:T.type.toUpperCase()})})]},T.id))]}),n.jsx("div",{className:"flex-1 overflow-x-auto overflow-y-hidden relative custom-scrollbar",ref:p,onScroll:T=>l(T.currentTarget.scrollLeft),children:n.jsxs("div",{style:{width:x,height:"100%"},className:"relative",children:[n.jsxs("div",{className:"h-8 bg-gray-800 border-b border-gray-700 relative cursor-pointer hover:bg-gray-750 z-10",onMouseDown:f,children:[_(),n.jsx("div",{className:"absolute top-0 bottom-0 w-0 z-20 pointer-events-none",style:{left:o*a},children:n.jsx("div",{className:"absolute -top-0 -left-2 w-0 h-0 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent border-t-[12px] border-t-red-500"})})]}),e.map(T=>n.jsxs("div",{className:"h-16 border-b border-gray-700 relative bg-gray-900/50",children:[n.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-20"}),t.filter(P=>P.layer===T.id).map(P=>n.jsxs("div",{onClick:R=>k(R,P.id),className:`absolute top-1 bottom-1 rounded overflow-hidden cursor-pointer border border-opacity-50 select-none group
                                            ${C(P)}
                                            ${d===P.id?"ring-2 ring-white z-10":""}
                                        `,style:{left:P.start*a,width:P.duration*a},title:`${P.name} (Start: ${P.start.toFixed(1)}s, Dur: ${P.duration.toFixed(1)}s)`,children:[u&&u[P.id]&&n.jsx(JP,{data:u[P.id],color:P.type==="audio"?"rgba(251, 191, 36, 0.7)":"rgba(99, 102, 241, 0.7)"}),n.jsx("div",{className:"absolute top-0 left-0 right-0 px-1 text-[10px] text-white/90 truncate bg-black/30 pointer-events-none",children:P.name})]},P.id))]},T.id)),n.jsx("div",{className:"absolute top-8 bottom-0 w-px bg-red-500 pointer-events-none z-30",style:{left:o*a}})]})})]})})},XP=({currentTime:e,clips:t,isPlaying:o,onTimeUpdate:r})=>{const a=y.useRef(null),i=y.useRef(null),s=y.useRef(null),l=y.useRef(null),c=y.useRef(e),[d,u]=y.useState(null),[p,h]=y.useState([]);y.useEffect(()=>{const k=t.filter(w=>(w.type==="video"||w.type==="image")&&e>=w.start&&e<w.start+w.duration);k.sort((w,f)=>f.layer-w.layer),u(k[0]||null);const C=t.filter(w=>w.type==="audio"&&e>=w.start&&e<w.start+w.duration);h(C)},[e,t]),y.useEffect(()=>{const k=d;if(k&&k.type==="video"&&a.current){const C=e-k.start+k.offset;Math.abs(a.current.currentTime-C)>.3&&(a.current.currentTime=C),o&&a.current.paused?a.current.play().catch(()=>{}):!o&&!a.current.paused&&a.current.pause()}},[e,d,o]),y.useEffect(()=>{i.current&&Array.from(i.current.children).forEach(k=>{const C=k,w=C.getAttribute("data-clip-id"),f=p.find(g=>g.id===w);if(f){const g=e-f.start+f.offset;Math.abs(C.currentTime-g)>.3&&(C.currentTime=g),o&&C.paused?C.play().catch(()=>{}):!o&&!C.paused&&C.pause()}})},[e,p,o]);const x=k=>{if(o){const C=(k-c.current)/1e3,w=Math.min(C,.1);r(f=>f+w)}c.current=k,l.current=requestAnimationFrame(x)};return y.useEffect(()=>(c.current=performance.now(),l.current=requestAnimationFrame(x),()=>{l.current&&cancelAnimationFrame(l.current)}),[o]),n.jsxs("div",{ref:s,className:"w-full h-full bg-black flex items-center justify-center overflow-hidden relative",children:[d?d.type==="video"?n.jsx("video",{ref:a,src:d.src,className:"max-w-full max-h-full object-contain",muted:!0,playsInline:!0}):n.jsx("img",{src:d.src,alt:"preview",className:"max-w-full max-h-full object-contain"}):n.jsx("div",{className:"text-gray-600 text-xs",children:"No Visual Signal"}),n.jsx("div",{ref:i,className:"hidden",children:p.map(k=>n.jsx("audio",{"data-clip-id":k.id,src:k.src},k.id))}),n.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/60 px-2 py-1 rounded text-white text-xs font-mono pointer-events-none z-10",children:[e.toFixed(2),"s"]})]})},ZP=({type:e})=>{switch(e){case"folder":return n.jsx("svg",{className:"w-5 h-5 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:n.jsx("path",{d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})});case"image":return n.jsx("svg",{className:"w-5 h-5 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})});case"video":return n.jsx("svg",{className:"w-5 h-5 text-purple-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})});case"audio":return n.jsx("svg",{className:"w-5 h-5 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})});default:return n.jsx("svg",{className:"w-5 h-5 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}},QP=({className:e})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),eT=({files:e,currentFolderId:t,viewMode:o,onUpload:r,onDragStart:a,onDelete:i,onNavigate:s,onCreateFolder:l,onRename:c,onToggleView:d})=>{const u=y.useRef(null),[p,h]=y.useState(null),[x,k]=y.useState(""),C=y.useMemo(()=>e.filter(S=>S.parentId===t).sort((S,T)=>S.type==="folder"&&T.type!=="folder"?-1:S.type!=="folder"&&T.type==="folder"?1:S.name.localeCompare(T.name)),[e,t]),w=y.useMemo(()=>{const S=[];let T=t;for(;T;){const P=e.find(R=>R.id===T);P?(S.unshift({id:P.id,name:P.name}),T=P.parentId):T=null}return[{id:null,name:"Root"},...S]},[t,e]),f=()=>{if(!t)return;const S=e.find(T=>T.id===t);s(S?S.parentId:null)},g=S=>{S.isLinked||(h(S.id),k(S.name))},v=()=>{p&&x.trim()&&c(p,x.trim()),h(null)},_=S=>{S.type==="folder"&&s(S.id)};return n.jsxs("div",{className:"flex flex-col h-full bg-gray-800",children:[n.jsxs("div",{className:"flex items-center justify-between p-1 border-b border-gray-700 bg-gray-900/50",children:[n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx("button",{onClick:f,disabled:!t,className:"p-1 hover:bg-gray-700 rounded text-gray-400 disabled:opacity-30 transition-colors",title:"Up",children:n.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})})}),n.jsx("div",{className:"h-4 w-px bg-gray-700 mx-1"}),n.jsx("button",{onClick:l,className:"p-1 hover:bg-gray-700 rounded text-yellow-500 hover:text-yellow-400",title:"New Folder",children:n.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:n.jsx("path",{d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})})}),n.jsx("button",{onClick:()=>{var S;return(S=u.current)==null?void 0:S.click()},className:"p-1 hover:bg-gray-700 rounded text-cyan-400 hover:text-cyan-300",title:"Import",children:n.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0l-4 4m4 4V4"})})})]}),n.jsx("button",{onClick:d,className:"p-1 hover:bg-gray-700 rounded text-gray-400 hover:text-white",title:"Toggle View",children:o==="grid"?n.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})}):n.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),n.jsx("input",{ref:u,type:"file",multiple:!0,accept:"image/*,video/*,audio/*",className:"hidden",onChange:S=>{S.target.files&&r(S.target.files),S.target.value=""}})]}),n.jsx("div",{className:"px-2 py-1 bg-gray-900 border-b border-gray-700 text-xs text-gray-400 flex items-center overflow-x-auto whitespace-nowrap scrollbar-none",children:w.map((S,T)=>n.jsxs(Et.Fragment,{children:[n.jsx("span",{className:"hover:text-white cursor-pointer hover:underline",onClick:()=>s(S.id),children:S.name}),T<w.length-1&&n.jsx("span",{className:"mx-1 text-gray-600",children:"/"})]},S.id||"root"))}),n.jsx("div",{className:`flex-1 overflow-y-auto p-2 custom-scrollbar ${o==="grid"?"flex flex-wrap content-start gap-2":"flex flex-col space-y-1"}`,children:C.length===0?n.jsxs("div",{className:"col-span-full w-full h-32 flex flex-col items-center justify-center text-gray-500 text-xs italic",children:[n.jsx("span",{children:"Empty Folder"}),n.jsx("span",{className:"opacity-50 mt-1",children:"Drop files here"})]}):C.map(S=>n.jsxs("div",{className:`
                                group relative border border-gray-700 rounded hover:bg-gray-700/50 hover:border-gray-500 transition-colors overflow-hidden
                                ${o==="grid"?"flex flex-col w-24 h-24":"flex items-center h-8 px-2 w-full"}
                            `,draggable:S.type!=="folder"&&!!S.src,onDragStart:T=>a(T,S),onDoubleClick:()=>_(S),children:[n.jsxs("div",{className:`${o==="grid"?"flex-1 w-full bg-black/40 overflow-hidden flex items-center justify-center relative":"w-5 h-5 flex-shrink-0 mr-2 relative"}`,children:[S.thumbnail?n.jsx("img",{src:S.thumbnail,className:"w-full h-full object-cover opacity-80 group-hover:opacity-100",alt:"thumb"}):(S.type==="image"||S.type==="text"&&S.src.startsWith("data:image"))&&S.src?n.jsx("img",{src:S.src,className:"w-full h-full object-cover opacity-80 group-hover:opacity-100",alt:"thumb"}):n.jsx(ZP,{type:S.type}),S.isLinked&&n.jsx("div",{className:"absolute top-0 right-0 bg-cyan-600/80 p-0.5 rounded-bl-md z-10 shadow-sm pointer-events-none",children:n.jsx(QP,{className:"w-2.5 h-2.5 text-white"})})]}),n.jsx("div",{className:`${o==="grid"?"h-7 px-1 flex items-center bg-gray-800 border-t border-gray-700":"flex-grow min-w-0"}`,children:p===S.id?n.jsx("input",{type:"text",value:x,onChange:T=>k(T.target.value),onBlur:v,onKeyDown:T=>{T.key==="Enter"&&v()},onDoubleClick:T=>T.stopPropagation(),className:"w-full bg-gray-900 text-white text-[10px] px-1 rounded border border-blue-500 outline-none",autoFocus:!0}):n.jsx("span",{className:`text-[10px] truncate cursor-text w-full block ${S.isLinked?"text-cyan-200":"text-gray-300"}`,title:S.name,onClick:T=>{T.stopPropagation(),g(S)},children:S.name})}),!S.isLinked&&n.jsx("button",{onClick:T=>{T.stopPropagation(),i(S.id)},className:`
                                        text-gray-500 hover:text-red-400 transition-colors
                                        ${o==="grid"?"absolute top-1 right-1 bg-black/50 rounded p-0.5 opacity-0 group-hover:opacity-100":"ml-2 opacity-0 group-hover:opacity-100"}
                                    `,children:n.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},S.id))})]})},tT=e=>{const[t,o]=y.useState({}),r=y.useRef(new Set);return y.useEffect(()=>{const a=async()=>{const i={};let s=!1;const l=window.AudioContext||window.webkitAudioContext,c=new l;for(const d of e)if(!(d.type!=="audio"&&d.type!=="video"||t[d.id]||r.current.has(d.id))){r.current.add(d.id);try{const p=await(await fetch(d.src)).arrayBuffer(),x=(await c.decodeAudioData(p)).getChannelData(0);i[d.id]=x,s=!0}catch(u){console.error(`Failed to decode audio for clip ${d.id}`,u)}}s&&o(d=>({...d,...i})),c.state!=="closed"&&c.close()};e.length>0&&a()},[e,t]),t},Yg={currentTime:0,totalDuration:30,clips:[],tracks:[{id:2,name:"V2",type:"video",isMuted:!1,isVisible:!0},{id:1,name:"V1",type:"video",isMuted:!1,isVisible:!0},{id:101,name:"A1",type:"audio",isMuted:!1,isVisible:!0}],mediaFiles:[],isPlaying:!1,zoom:20,selectedClipId:null,scrollLeft:0,mediaPanelWidth:240,currentFolderId:null,viewMode:"grid"},nT=180,oT=600,rT=({node:e,onValueChange:t,t:o,deselectAllNodes:r,getUpstreamNodeValues:a,isSelected:i,onSelectNode:s})=>{const l=y.useRef(null),c=y.useRef(null),d=y.useMemo(()=>{try{return{...Yg,...JSON.parse(e.value||"{}")}}catch{return Yg}},[e.value]),u=y.useCallback(F=>{const G={...d,...F};t(e.id,JSON.stringify(G))},[d,e.id,t]),[p,h]=y.useState(d.currentTime),[x,k]=y.useState(!1),C=tT(d.clips);y.useEffect(()=>{h(d.currentTime)},[d.currentTime]),y.useEffect(()=>{if(!a)return;const F=a(e.id,"video"),G=a(e.id,"audio"),B=a(e.id,"image"),Y=a(e.id,"text"),ee=d.mediaFiles.filter($=>!$.isLinked),ie=[],ce=[{type:"video",data:F,folderName:"Video Inputs"},{type:"audio",data:G,folderName:"Audio Inputs"},{type:"image",data:B,folderName:"Image Inputs"},{type:"text",data:Y,folderName:"Text Inputs"}],pe=$=>$.replace(/[<>&'"]/g,Z=>{switch(Z){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;";default:return Z}});ce.forEach(({type:$,data:Z,folderName:te})=>{if(Z.length>0){const ae=`folder-linked-${$}`;ie.push({id:ae,type:"folder",src:"",name:te,parentId:null,isLinked:!0}),Z.forEach((I,J)=>{let W="";if(I&&typeof I=="object"&&I.base64ImageData)W=`data:${I.mimeType};base64,${I.base64ImageData}`;else if(typeof I=="string")if($==="text"){const Q=`<svg xmlns="http://www.w3.org/2000/svg" width="800" height="200" style="background:black;"><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="white" font-family="sans-serif" font-size="40">${pe(I)}</text></svg>`;W=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(Q)}`}else(I.startsWith("data:")||I.startsWith("http")||I.startsWith("blob:"))&&(W=I);ie.push({id:`linked-${$}-${J}`,type:$,src:W,name:W?`${$.charAt(0).toUpperCase()+$.slice(1)} ${J+1}`:`Empty ${$} Slot ${J+1}`,parentId:ae,isLinked:!0})})}});const ue=d.mediaFiles.filter($=>$.isLinked);if(ie.length!==ue.length||ie.some(($,Z)=>{var te,ae;return $.id!==((te=ue[Z])==null?void 0:te.id)||$.src!==((ae=ue[Z])==null?void 0:ae.src)})){let $=d.currentFolderId;$&&$.startsWith("folder-linked-")&&(ie.find(Z=>Z.id===$)||($=null)),u({mediaFiles:[...ee,...ie],currentFolderId:$})}},[a,e.id,d.mediaFiles,d.currentFolderId]);const w=y.useCallback(()=>{const F=!x;k(F),F||u({currentTime:p,isPlaying:!1})},[x,p,u]),f=F=>{h(F),x||u({currentTime:F})},g=F=>{h(G=>{const B=F(G);return B>=d.totalDuration?(k(!1),d.totalDuration):B})},v=F=>{const G=F==="in"?d.zoom*1.2:d.zoom/1.2;u({zoom:Math.max(5,Math.min(200,G))})},_=async F=>new Promise(G=>{const B=document.createElement("video");B.preload="metadata",B.src=URL.createObjectURL(F),B.muted=!0,B.playsInline=!0,B.currentTime=1,B.onloadeddata=()=>{const Y=document.createElement("canvas");Y.width=160,Y.height=90;const ee=Y.getContext("2d");ee==null||ee.drawImage(B,0,0,160,90);const ie=Y.toDataURL("image/jpeg",.7);G(ie),URL.revokeObjectURL(B.src)},B.onerror=()=>{G("")}}),S=async F=>{const G=[];for(const B of Array.from(F)){const Y=URL.createObjectURL(B);let ee="image",ie;if(B.type.startsWith("video/")){ee="video";try{ie=await _(B)}catch(ce){console.error("Thumbnail generation failed",ce)}}else if(B.type.startsWith("audio/"))ee="audio";else if(B.type.startsWith("image/")){ee="image";try{ie=await Lt(Y,160,160)}catch{}}G.push({id:`media-${Date.now()}-${Math.random()}`,type:ee,src:Y,name:B.name,parentId:d.currentFolderId,thumbnail:ie,isLinked:!1})}u({mediaFiles:[...d.mediaFiles,...G]})},T=F=>{const G=d.mediaFiles.find(ee=>ee.id===F);if(G!=null&&G.isLinked)return;const B=new Set,Y=ee=>{B.add(ee),d.mediaFiles.filter(ie=>ie.parentId===ee).forEach(ie=>Y(ie.id))};Y(F),u({mediaFiles:d.mediaFiles.filter(ee=>!B.has(ee.id))})},P=()=>{const F={id:`folder-${Date.now()}`,type:"folder",src:"",name:"New Folder",parentId:d.currentFolderId,isLinked:!1};u({mediaFiles:[...d.mediaFiles,F]})},R=F=>{u({currentFolderId:F})},D=(F,G)=>{const B=d.mediaFiles.find(Y=>Y.id===F);B!=null&&B.isLinked||u({mediaFiles:d.mediaFiles.map(Y=>Y.id===F?{...Y,name:G}:Y)})},q=()=>{u({viewMode:d.viewMode==="grid"?"list":"grid"})},O=(F,G)=>{G.type!=="folder"&&G.src&&(F.dataTransfer.setData("application/video-editor-media",JSON.stringify(G)),F.dataTransfer.effectAllowed="copy")},E=F=>{F.preventDefault(),F.stopPropagation(),c.current={x:F.clientX,startWidth:d.mediaPanelWidth},window.addEventListener("mousemove",A),window.addEventListener("mouseup",N)},A=F=>{if(!c.current)return;const G=F.clientX-c.current.x,B=Math.max(nT,Math.min(oT,c.current.startWidth+G));l.current&&u({mediaPanelWidth:B})},N=()=>{c.current=null,window.removeEventListener("mousemove",A),window.removeEventListener("mouseup",N)},j=F=>{F.preventDefault(),F.stopPropagation();const G=F.dataTransfer.getData("application/video-editor-media");if(G){const B=JSON.parse(G);L(B,F.clientX)}else F.dataTransfer.files.length>0&&S(F.dataTransfer.files)},L=(F,G)=>{var ce,pe;const B=F.type==="audio"?((ce=d.tracks.find(ue=>ue.type==="audio"))==null?void 0:ce.id)||101:((pe=d.tracks.find(ue=>ue.type==="video"))==null?void 0:pe.id)||1,Y=F.type==="text"?"image":F.type,ee=p,ie={id:`clip-${Date.now()}-${Math.random()}`,type:Y,src:F.src,start:ee,duration:F.type==="image"||F.type==="text"?5:10,offset:0,layer:B,name:F.name,thumbnail:F.thumbnail};u({clips:[...d.clips,ie]})},M=F=>{u({selectedClipId:F})},V=()=>{d.selectedClipId&&u({clips:d.clips.filter(F=>F.id!==d.selectedClipId),selectedClipId:null})},H=F=>{F.stopPropagation(),s&&s()};return y.useEffect(()=>{if(!i)return;const F=G=>{if(G.code==="Space"){const B=G.target;if(B.tagName==="INPUT"||B.tagName==="TEXTAREA"||B.isContentEditable)return;G.preventDefault(),G.stopPropagation(),w()}};return window.addEventListener("keydown",F),()=>window.removeEventListener("keydown",F)},[i,w]),n.jsxs("div",{ref:l,className:"flex flex-col w-full h-full bg-gray-900 text-white rounded-lg overflow-hidden",onMouseDown:H,onWheel:F=>F.stopPropagation(),onDragOver:F=>{F.preventDefault(),F.stopPropagation()},onDrop:j,children:[n.jsxs("div",{className:"flex-1 flex min-h-0",children:[n.jsxs("div",{style:{width:d.mediaPanelWidth},className:"flex-shrink-0 flex flex-col relative border-r border-gray-700",children:[n.jsx(eT,{files:d.mediaFiles,currentFolderId:d.currentFolderId,viewMode:d.viewMode,onUpload:S,onDragStart:O,onDelete:T,onNavigate:R,onCreateFolder:P,onRename:D,onToggleView:q}),n.jsx("div",{className:"absolute top-0 bottom-0 right-[-4px] w-2 cursor-col-resize z-10 hover:bg-cyan-500/50 transition-colors",onMouseDown:E})]}),n.jsx("div",{className:"flex-1 bg-black relative",children:n.jsx(XP,{currentTime:p,clips:d.clips,isPlaying:x,onTimeUpdate:g})}),n.jsxs("div",{className:"w-48 bg-gray-800 p-2 flex flex-col space-y-2 border-l border-gray-700 flex-shrink-0",children:[n.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase",children:"Properties"}),d.selectedClipId?n.jsxs("div",{className:"text-xs space-y-2",children:[n.jsx("p",{className:"text-gray-300",children:"Selected Clip"}),n.jsx("div",{className:"h-px bg-gray-700 w-full"}),n.jsx("button",{onClick:V,className:"w-full bg-red-600 hover:bg-red-700 px-2 py-1 rounded text-white transition-colors",children:"Delete Clip"})]}):n.jsx("p",{className:"text-xs text-gray-500",children:"No clip selected"})]})]}),n.jsxs("div",{className:"h-10 bg-gray-800 border-t border-gray-700 flex items-center px-4 justify-between shrink-0",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("button",{onClick:()=>f(0),className:"text-gray-400 hover:text-white",children:"|<"}),n.jsx("button",{onClick:w,className:`w-8 h-8 rounded-full flex items-center justify-center ${x?"bg-red-600 hover:bg-red-700":"bg-cyan-600 hover:bg-cyan-700"} text-white transition-colors`,children:x?n.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})}):n.jsx("svg",{className:"w-4 h-4 ml-0.5",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{d:"M8 5v14l11-7z"})})})]}),n.jsxs("div",{className:"font-mono text-sm text-cyan-400",children:[p.toFixed(2),"s / ",d.totalDuration,"s"]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("button",{onClick:()=>v("out"),className:"text-gray-400 hover:text-white text-xs bg-gray-700 px-2 py-1 rounded",children:"- Zoom"}),n.jsx("button",{onClick:()=>v("in"),className:"text-gray-400 hover:text-white text-xs bg-gray-700 px-2 py-1 rounded",children:"+ Zoom"})]})]}),n.jsx("div",{className:"h-56 flex-shrink-0",children:n.jsx(YP,{tracks:d.tracks,clips:d.clips,currentTime:p,duration:d.totalDuration,zoom:d.zoom,onSeek:f,scrollLeft:d.scrollLeft,onScroll:F=>u({scrollLeft:F}),onClipSelect:M,selectedClipId:d.selectedClipId,audioDataMap:C})})]})},aT=(e,t,o)=>{const r=y.useRef(null),a=Ut(),i=a==null?void 0:a.setGlobalMedia,s=a==null?void 0:a.globalMedia,l=G=>{try{const B=JSON.parse(G||"{}");return{src:B.src||"",type:B.type||"video",name:B.name||"",currentTime:B.currentTime||0,volume:B.volume!==void 0?B.volume:.4,isPlaying:B.isPlaying||!1,markers:B.markers||[]}}catch{return{src:"",type:"video",name:"",markers:[],volume:.4}}},[c,d]=y.useState(()=>{const G=l(t);return a!=null&&a.globalMedia&&a.globalMedia.nodeId===e?{...G,currentTime:a.globalMedia.currentTime,isPlaying:a.globalMedia.isPlaying}:G}),u=y.useRef(c);y.useEffect(()=>{u.current=c},[c]);const{isPlaying:p,currentTime:h,volume:x,markers:k,src:C,type:w,name:f}=c,[g,v]=y.useState(0),_=y.useRef(!1),S=y.useCallback(G=>{d(B=>{let Y={};r.current&&(Y={currentTime:r.current.currentTime,volume:r.current.volume,isPlaying:G.isPlaying!==void 0?G.isPlaying:!r.current.paused});const ee={...B,...Y,...G};return o(e,JSON.stringify(ee)),i&&(ee.isPlaying||B.isPlaying)&&i(ie=>{var ce;return{nodeId:e,name:ee.name||"Media",isPlaying:!!ee.isPlaying,currentTime:ee.currentTime||0,duration:((ce=r.current)==null?void 0:ce.duration)||0,volume:ee.volume||.4,type:ee.type||"video",command:void 0,commandTimestamp:void 0}}),ee})},[e,o,i]),T=y.useCallback(()=>{r.current&&(r.current.pause(),S({isPlaying:!1}))},[S]);y.useEffect(()=>{s&&s.nodeId!==e&&s.isPlaying&&p&&T()},[s,e,p,T]),y.useEffect(()=>{s&&s.nodeId===e&&s.command&&r.current&&(s.command==="play"?r.current.paused&&(r.current.play().catch(G=>console.error(G)),d(G=>({...G,isPlaying:!0}))):s.command==="pause"?r.current.paused||(r.current.pause(),d(G=>({...G,isPlaying:!1})),S({isPlaying:!1})):s.command==="seek"&&s.seekTarget!==void 0&&(r.current.currentTime=s.seekTarget,P(s.seekTarget)))},[s,e,S]),y.useEffect(()=>{const G=l(t),B=(s==null?void 0:s.nodeId)===e;if(G.src!==C){d(Y=>({...Y,src:G.src,name:G.name,type:G.type,currentTime:0,isPlaying:!!G.isPlaying})),r.current&&(r.current.pause(),r.current.currentTime=0),B&&i&&i(null);return}if(B){JSON.stringify(G.markers)!==JSON.stringify(k)&&d(Y=>({...Y,markers:G.markers||[]}));return}G.currentTime>.1&&Math.abs(G.currentTime-h)>.5&&!_.current&&(P(G.currentTime),r.current&&Math.abs(r.current.currentTime-G.currentTime)>.5&&(r.current.currentTime=G.currentTime)),JSON.stringify(G.markers)!==JSON.stringify(k)&&d(Y=>({...Y,markers:G.markers||[]})),G.volume!==void 0&&Math.abs(G.volume-(x||.4))>.01&&(R(G.volume),r.current&&(r.current.volume=G.volume)),G.isPlaying!==p&&(G.isPlaying?D():T())},[t,s==null?void 0:s.nodeId,e,C,h,p,x,k,i]);const P=G=>d(B=>({...B,currentTime:G})),R=G=>d(B=>({...B,volume:G})),D=y.useCallback(async()=>{if(r.current)try{await r.current.play(),S({isPlaying:!0})}catch(G){console.error(G),S({isPlaying:!1})}},[S]),q=y.useCallback(()=>{p?T():D()},[p,D,T]),O=y.useCallback(()=>{r.current&&(r.current.pause(),r.current.currentTime=0,P(0),S({isPlaying:!1,currentTime:0}))},[S]),E=y.useCallback(G=>{_.current=!0,r.current&&(r.current.currentTime=G,P(G)),setTimeout(()=>{_.current=!1},500)},[]),A=y.useCallback(G=>{r.current&&(r.current.volume=G),R(G),S({volume:G})},[S]),N=y.useCallback(()=>{const G={id:`marker-${Date.now()}`,time:h||0,label:`Marker ${(k||[]).length+1}`,color:"#3b82f6"},B=[...k||[],G].sort((Y,ee)=>Y.time-ee.time);S({markers:B})},[h,k,S]),j=y.useCallback((G,B)=>{const Y=(k||[]).map(ee=>ee.id===G?{...ee,...B}:ee);S({markers:Y})},[k,S]),L=y.useCallback(G=>{const B=(k||[]).filter(Y=>Y.id!==G);S({markers:B})},[k,S]),M=y.useCallback(()=>{S({markers:[]})},[S]),V=y.useCallback(()=>{if(r.current&&!_.current){const G=r.current.currentTime;P(G),(s==null?void 0:s.nodeId)===e&&i&&i(B=>B?{...B,currentTime:G,command:void 0,commandTimestamp:void 0}:null)}},[s==null?void 0:s.nodeId,e,i]),H=y.useCallback(()=>{if(r.current){v(r.current.duration);const G=u.current;r.current.volume=G.volume!==void 0?G.volume:.4,G.currentTime>0&&Math.abs(r.current.currentTime-G.currentTime)>.5&&(r.current.currentTime=G.currentTime),G.isPlaying&&D()}},[D]),F=y.useCallback(()=>{S({isPlaying:!1,currentTime:0}),r.current&&(r.current.currentTime=0),P(0)},[S]);return{mediaRef:r,isPlaying:!!p,currentTime:h||0,duration:g,volume:x!==void 0?x:.4,markers:k||[],togglePlay:q,stop:O,seek:E,changeVolume:A,addMarker:N,updateMarker:j,deleteMarker:L,deleteAllMarkers:M,handleTimeUpdate:V,handleLoadedMetadata:H,handleEnded:F}},iT=(e,t,o)=>{const r=y.useRef(null),a=y.useRef(null),i=y.useRef(null);return y.useEffect(()=>t!=="audio"||!e||!o?void 0:((()=>{if(r.current)r.current.state==="suspended"&&r.current.resume();else{const l=window.AudioContext||window.webkitAudioContext,c=new l,d=c.createAnalyser();d.fftSize=256;try{c.createMediaElementSource(o).connect(d),d.connect(c.destination),r.current=c,a.current=d}catch{}}})(),()=>{r.current&&r.current.state!=="closed"&&(r.current.close(),r.current=null,a.current=null)}),[e,t,o]),y.useEffect(()=>{if(t!=="audio"||!e){i.current=null;return}(async()=>{try{const c=await(await fetch(e)).arrayBuffer(),u=await new(window.AudioContext||window.webkitAudioContext)().decodeAudioData(c);i.current=u.getChannelData(0)}catch(l){console.warn("Failed to generate waveform data",l)}})()},[e,t]),{audioContextRef:r,analyserRef:a,audioDataRef:i}},Xg=e=>{const t=Math.floor(e/60),o=Math.floor(e%60);return`${t}:${o.toString().padStart(2,"0")}`},ws=(e,t)=>("000"+e).slice(t*-1),Zg=e=>{const t=Math.floor(e/3600),o=Math.floor(e%3600/60),r=Math.floor(e%60),a=Math.floor(e%1*1e3);return`${ws(t,2)}:${ws(o,2)}:${ws(r,2)},${ws(a,3)}`},sT=({marker:e,onUpdate:t,onDelete:o,onClose:r,initialPosition:a})=>{const[i,s]=y.useState(e.label),[l,c]=y.useState(e.color),d=["#22d3ee","#facc15","#ef4444","#3b82f6","#10b981","#a855f7","#f97316","#ffffff"],[u,p]=y.useState(a),h=y.useRef(null),x=g=>{g.preventDefault(),g.stopPropagation(),h.current={x:g.clientX-u.x,y:g.clientY-u.y},window.addEventListener("mousemove",k),window.addEventListener("mouseup",C)},k=g=>{h.current&&p({x:g.clientX-h.current.x,y:g.clientY-h.current.y})},C=()=>{h.current=null,window.removeEventListener("mousemove",k),window.removeEventListener("mouseup",C)},w=()=>{t(e.id,{label:i,color:l}),r()},f=()=>{o(e.id),r()};return Ba.createPortal(n.jsxs("div",{className:"fixed z-[9999] bg-gray-800 border border-gray-600 rounded-lg shadow-2xl p-2 flex flex-col gap-2 w-56",style:{left:u.x,top:u.y},onMouseDown:g=>g.stopPropagation(),children:[n.jsxs("div",{className:"flex justify-between items-center border-b border-gray-700 pb-1 mb-1 cursor-move select-none",onMouseDown:x,children:[n.jsx("span",{className:"text-xs font-bold text-gray-300",children:"Edit Marker"}),n.jsx("button",{onClick:r,className:"text-gray-500 hover:text-white",title:"Cancel",onMouseDown:g=>g.stopPropagation(),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),n.jsx("input",{type:"text",value:i,onChange:g=>s(g.target.value),className:"bg-gray-900 border border-gray-600 rounded px-2 py-1 text-xs text-white focus:outline-none focus:border-cyan-500 w-full",placeholder:"Marker Name"}),n.jsx("div",{className:"flex gap-1 justify-between",children:d.map(g=>n.jsx("button",{onClick:()=>c(g),className:`w-4 h-4 rounded-full border ${l===g?"border-white scale-110":"border-transparent hover:scale-110"}`,style:{backgroundColor:g}},g))}),n.jsxs("div",{className:"flex justify-between items-center mt-1 pt-2 border-t border-gray-700",children:[n.jsx("button",{onClick:f,className:"p-1 text-red-400 hover:text-red-200 hover:bg-red-900/30 rounded transition-colors",title:"Delete Marker",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})}),n.jsxs("button",{onClick:w,className:"px-3 py-1 bg-cyan-600 hover:bg-cyan-700 text-white text-xs font-bold rounded transition-colors flex items-center gap-1",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Apply"]})]})]}),document.body)},lT=({isPlaying:e,currentTime:t,duration:o,volume:r,markers:a,onTogglePlay:i,onStop:s,onSeek:l,onVolumeChange:c,onClear:d,onAddMarker:u,onUpdateMarker:p,onDeleteMarker:h,onDeleteAllMarkers:x,onSaveMarkers:k,onLoadMarkers:C,onSelect:w,disabled:f,t:g})=>{const v=y.useRef(null),[_,S]=y.useState(null),[T,P]=y.useState(null),R=a.find(E=>E.id===_),D=(E,A)=>{E.stopPropagation(),l(A.time)},q=(E,A)=>{E.stopPropagation();const N=E.target.getBoundingClientRect();P({x:N.left,y:N.top-160}),S(A)},O=()=>{if(a.length===0)return;const E=[...a].sort((M,V)=>M.time-V.time);let A="";E.forEach((M,V)=>{const H=Zg(M.time),F=Zg(M.time+1);A+=`${V+1}
${H} --> ${F}
${M.label}

`});const N=new Blob([A],{type:"text/plain"}),j=URL.createObjectURL(N),L=document.createElement("a");L.href=j,L.download=`markers_${new Date().toISOString().slice(0,10)}.srt`,L.click(),URL.revokeObjectURL(j)};return n.jsxs("div",{className:"flex-shrink-0 bg-gray-800 border-t border-gray-700 flex flex-col gap-1 relative z-30",onMouseDown:E=>{E.stopPropagation(),w&&w()},children:[_&&R&&T&&n.jsx(sT,{marker:R,onUpdate:p,onDelete:E=>{h(E),S(null)},onClose:()=>S(null),initialPosition:T}),n.jsxs("div",{className:"flex items-center relative group w-full pt-1",children:[n.jsxs("div",{className:"flex-grow relative h-4 flex items-center mx-1",ref:v,children:[o>0&&a.map(E=>{const A=E.time/o*100;return n.jsxs("div",{className:"absolute top-0 w-4 h-4 -ml-2 cursor-pointer z-10 group/marker flex flex-col items-center hover:z-20",style:{left:`${A}%`},onClick:N=>D(N,E),children:[n.jsx("div",{className:"w-0.5 h-full bg-white/50 group-hover/marker:bg-white pointer-events-none"}),n.jsx("div",{className:"w-2.5 h-2.5 rounded-full absolute top-1/2 -translate-y-1/2 shadow-sm border border-black/50 transition-transform group-hover/marker:scale-125",style:{backgroundColor:E.color}}),_!==E.id&&n.jsxs("div",{className:"absolute bottom-full mb-1 flex flex-col items-center gap-1 opacity-0 group-hover/marker:opacity-100 transition-opacity",children:[n.jsx("div",{className:"bg-black/80 text-white text-[9px] px-1 rounded whitespace-nowrap pointer-events-none mb-0.5",children:E.label}),n.jsx("button",{onClick:N=>q(N,E.id),className:"px-2 py-0.5 bg-gray-700 hover:bg-cyan-600 text-white text-[9px] rounded shadow border border-gray-500 hover:border-cyan-400 pointer-events-auto",children:"Edit"})]})]},E.id)}),n.jsx("input",{type:"range",min:"0",max:o||100,value:t,onChange:E=>l(parseFloat(E.target.value)),disabled:f,className:"w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-500 relative z-0"})]}),n.jsxs("span",{className:"text-[10px] text-gray-400 font-mono whitespace-nowrap min-w-[70px] text-right pr-2",children:[Xg(t)," / ",Xg(o)]})]}),n.jsxs("div",{className:"relative flex items-center justify-center px-1 h-8 mb-1",children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx(ct,{content:g("node.mediaViewer.stop"),children:n.jsx("button",{onClick:s,disabled:f,className:"p-1.5 rounded-full text-gray-400 hover:text-white hover:bg-red-600 transition-colors disabled:opacity-50","aria-label":g("node.mediaViewer.stop"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("rect",{x:"5",y:"5",width:"10",height:"10"})})})}),n.jsx(ct,{content:g(e?"node.mediaViewer.pause":"node.mediaViewer.play"),children:n.jsx("button",{onClick:i,disabled:f,className:"flex items-center justify-center w-8 h-8 rounded bg-cyan-600 hover:bg-cyan-700 text-white transition-colors disabled:bg-gray-700 disabled:text-gray-500","aria-label":g(e?"node.mediaViewer.pause":"node.mediaViewer.play"),children:e?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 ml-0.5",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:"M8 5v14l11-7z"})})})}),n.jsx(ct,{content:g("node.mediaViewer.addMarker"),children:n.jsx("button",{onClick:u,disabled:f,className:"p-1.5 rounded-full text-gray-400 hover:text-blue-400 hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":g("node.mediaViewer.addMarker"),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})})})]}),n.jsxs("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 flex items-center space-x-1 pr-1",children:[n.jsx(ct,{content:g("node.mediaViewer.saveMarkers"),children:n.jsx("button",{onClick:k,className:"p-1.5 rounded-full text-gray-400 hover:text-cyan-400 hover:bg-gray-700 transition-colors cursor-pointer","aria-label":g("node.mediaViewer.saveMarkers"),disabled:f||a.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})}),n.jsx(ct,{content:g("node.mediaViewer.loadMarkers"),children:n.jsx("button",{onClick:C,className:"p-1.5 rounded-full text-gray-400 hover:text-emerald-400 hover:bg-gray-700 transition-colors cursor-pointer","aria-label":g("node.mediaViewer.loadMarkers"),disabled:f,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0l-4 4m4-4v12"})})})}),n.jsx(ct,{content:g("node.mediaViewer.exportSRT"),children:n.jsx("button",{onClick:O,className:"p-1.5 rounded-full text-gray-400 hover:text-purple-400 hover:bg-gray-700 transition-colors cursor-pointer","aria-label":g("node.mediaViewer.exportSRT"),disabled:f||a.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})}),n.jsx(ct,{content:g("node.mediaViewer.deleteAllMarkers"),children:n.jsx("button",{onClick:x,className:"p-1.5 rounded-full text-gray-400 hover:text-red-400 hover:bg-gray-700 transition-colors cursor-pointer","aria-label":g("node.mediaViewer.deleteAllMarkers"),disabled:f||a.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]})]})]})},cT=({audioData:e,currentTime:t,duration:o,isPlaying:r,onSeek:a,markers:i,onSelect:s})=>{const l=y.useRef(null),c=y.useRef(null),d=y.useRef(a),u=y.useRef(i),p=y.useRef(!1);y.useEffect(()=>{d.current=a},[a]),y.useEffect(()=>{u.current=i},[i]);const h=y.useCallback(()=>{const f=l.current,g=c.current,v=e;if(!f||!g||!v)return;const _=f.getContext("2d");if(!_)return;const S=g.getBoundingClientRect(),T=S.width,P=S.height,R=window.devicePixelRatio||1;(f.width!==T*R||f.height!==P*R)&&(f.width=T*R,f.height=P*R),_.resetTransform(),_.scale(R,R),_.clearRect(0,0,T,P);const D=3,O=D+1,E=Math.floor(T/O),A=Math.floor(v.length/E),N=o>0?t/o:0,j=Math.floor(E*N);_.beginPath();for(let V=0;V<E;V++){let H=A*V,F=0;const G=Math.ceil(A/10);let B=0;for(let pe=0;pe<A;pe+=G)H+pe<v.length&&(F+=Math.abs(v[H+pe]),B++);const Y=B>0?F/B:0,ee=Math.min(P,Math.max(2,Y*P*2.5)),ie=V*O,ce=P-ee;_.fillStyle=V<j?"#22d3ee":"#4b5563",_.fillRect(ie,ce,D,ee)}const L=u.current;o>0&&L&&(_.font="bold 10px sans-serif",_.textAlign="center",_.textBaseline="top",L.forEach(V=>{const H=Math.round(V.time/o*T);_.beginPath(),_.strokeStyle=V.color,_.lineWidth=2,_.moveTo(H,0),_.lineTo(H,P),_.stroke(),_.beginPath(),_.fillStyle=V.color,_.arc(H,P-6,3,0,Math.PI*2),_.fill();const F=_.measureText(V.label).width,G=Math.round(H-F/2-2),B=2,Y=Math.round(F+4),ee=14;_.fillStyle="rgba(0,0,0,0.7)",_.fillRect(G,B,Y,ee),_.fillStyle=V.color,_.fillText(V.label,H,4)}));const M=Math.round(T*N);_.fillStyle="#ffffff",_.fillRect(M-1,0,2,P)},[e,t,o]);y.useEffect(()=>{let f;const g=()=>{h(),(r||p.current)&&(f=requestAnimationFrame(g))};return h(),r&&(f=requestAnimationFrame(g)),()=>{f&&cancelAnimationFrame(f)}},[h,r]),y.useEffect(()=>{if(!c.current)return;const f=new ResizeObserver(()=>requestAnimationFrame(h));return f.observe(c.current),()=>f.disconnect()},[h]);const x=f=>{if(!c.current||!o)return;const g=c.current.getBoundingClientRect(),v=f-g.left,_=Math.max(0,Math.min(1,v/g.width));d.current(_*o)},k=y.useCallback(f=>{f.preventDefault(),f.stopPropagation(),s&&s(),p.current=!0,x(f.clientX),window.addEventListener("mousemove",C),window.addEventListener("mouseup",w)},[s,o]),C=y.useCallback(f=>{p.current&&(f.preventDefault(),x(f.clientX))},[o]),w=y.useCallback(()=>{p.current=!1,window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",w)},[C]);return y.useEffect(()=>()=>{window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",w)},[C,w]),n.jsx("div",{ref:c,className:"absolute inset-0 w-full h-full cursor-pointer",onMouseDown:k,children:n.jsx("canvas",{ref:l,className:"w-full h-full object-cover block"})})},dT=({analyser:e,isPlaying:t})=>{const o=y.useRef(null),r=y.useRef(null);return y.useEffect(()=>{if(!t||!e){r.current&&cancelAnimationFrame(r.current);return}const a=()=>{const i=o.current;if(!i)return;const s=i.getContext("2d");if(!s)return;const l=new Uint8Array(e.frequencyBinCount);e.getByteTimeDomainData(l);let c=0;for(let C=0;C<l.length;C++){const w=(l[C]-128)/128;c+=w*w}const d=Math.sqrt(c/l.length),u=Math.min(1,d*4),p=i.width,h=i.height;s.clearRect(0,0,p,h),s.fillStyle="#1f2937",s.fillRect(0,0,p,h);const x=u*h,k=s.createLinearGradient(0,h,0,0);k.addColorStop(0,"#10b981"),k.addColorStop(.6,"#f59e0b"),k.addColorStop(1,"#ef4444"),s.fillStyle=k,s.fillRect(0,h-x,p,x),s.fillStyle="rgba(0,0,0,0.5)";for(let C=10;C<h;C+=10)s.fillRect(0,C,p,1);r.current=requestAnimationFrame(a)};return a(),()=>{r.current&&cancelAnimationFrame(r.current)}},[t,e]),n.jsx("canvas",{ref:o,width:8,height:150,className:"w-full h-full"})},uT=({src:e,name:t,mediaRef:o,audioData:r,analyser:a,currentTime:i,duration:s,isPlaying:l,volume:c,markers:d,onSeek:u,onVolumeChange:p,onTimeUpdate:h,onLoadedMetadata:x,onEnded:k,onClear:C,onRelink:w,onSelect:f,t:g})=>n.jsxs("div",{className:"w-full h-full flex flex-col relative group bg-gray-900 overflow-hidden pr-3",children:[n.jsxs("div",{className:"h-10 bg-gray-800 border-b border-gray-700 flex items-center px-3 space-x-2 shrink-0 z-10 w-full",onMouseDown:v=>{},children:[n.jsx("div",{className:"w-6 h-6 rounded bg-cyan-900/50 flex items-center justify-center border border-cyan-700 shadow-sm flex-shrink-0",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-cyan-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z",clipRule:"evenodd"})})}),n.jsx("span",{className:"text-gray-200 text-xs font-semibold truncate shadow-sm flex-grow",children:t}),n.jsx(Ne,{title:g("node.mediaViewer.relink"),onClick:w,tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),n.jsx(Ne,{title:g("node.action.clear"),onClick:C,tooltipPosition:"left",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),n.jsxs("div",{className:"flex-grow flex min-h-0 relative w-full",children:[n.jsx("div",{className:"flex-grow relative h-full bg-gray-900 min-w-0",children:n.jsx(cT,{audioData:r,currentTime:i,duration:s,isPlaying:l,onSeek:u,markers:d,onSelect:f})}),n.jsxs("div",{className:"w-12 bg-gray-900 border-l border-gray-700 flex flex-col items-center py-2 gap-2 flex-shrink-0 relative z-20",onMouseDown:v=>{v.stopPropagation(),f&&f()},children:[n.jsx("div",{className:"flex-1 w-2 relative bg-gray-800 rounded-full overflow-hidden",children:n.jsx(dT,{analyser:a,isPlaying:l})}),n.jsx("div",{className:"h-24 w-full flex justify-center py-1",children:n.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:c,onChange:v=>p(parseFloat(v.target.value)),className:"h-full w-1 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-cyan-500",style:{writingMode:"vertical-lr",direction:"rtl",WebkitAppearance:"slider-vertical",width:"4px"},title:`Volume: ${Math.round(c*100)}%`})}),n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z",clipRule:"evenodd"})})]})]}),n.jsx("audio",{ref:o,src:e,onTimeUpdate:h,onLoadedMetadata:x,onEnded:k})]}),pT=({src:e,mediaRef:t,onTimeUpdate:o,onLoadedMetadata:r,onEnded:a,onTogglePlay:i})=>n.jsx("video",{ref:t,src:e,className:"w-full h-full object-contain mx-auto",onTimeUpdate:o,onLoadedMetadata:r,onEnded:a,onClick:s=>{s.stopPropagation(),i()}}),hT=({node:e,onValueChange:t,t:o,isSelected:r,onSelectNode:a})=>{const i=y.useRef(null),s=y.useRef(null),l=y.useRef(null),[c,d]=y.useState(!1),[u,p]=y.useState(""),h=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{src:"",type:"video",name:""}}},[e.value]),{src:x,type:k,name:C}=h,{mediaRef:w,isPlaying:f,currentTime:g,duration:v,volume:_,markers:S,togglePlay:T,stop:P,seek:R,changeVolume:D,addMarker:q,updateMarker:O,deleteMarker:E,deleteAllMarkers:A,handleTimeUpdate:N,handleLoadedMetadata:j,handleEnded:L}=aT(e.id,e.value,t),M=y.useCallback(()=>{a&&a()},[a]),V=y.useCallback(()=>{M(),T()},[M,T]),H=y.useCallback(()=>{M(),P()},[M,P]),F=y.useCallback(X=>{M(),R(X)},[M,R]),G=y.useCallback(X=>{M(),D(X)},[M,D]),B=y.useCallback(()=>{M(),q()},[M,q]),Y=y.useCallback((X,K)=>{M(),O(X,K)},[M,O]),ee=y.useCallback(X=>{M(),E(X)},[M,E]),ie=y.useCallback(()=>{M(),A()},[M,A]);y.useEffect(()=>{if(!r||!x)return;const X=K=>{const oe=K.target;if(oe.tagName==="INPUT"||oe.tagName==="TEXTAREA"||oe.isContentEditable)return;const ne=.042;K.code==="KeyM"?(K.preventDefault(),K.stopPropagation(),q()):K.code==="ArrowLeft"?(K.preventDefault(),R(Math.max(0,g-ne))):K.code==="ArrowRight"?(K.preventDefault(),R(Math.min(v,g+ne))):K.code==="Space"&&(K.preventDefault(),T())};return window.addEventListener("keydown",X),()=>window.removeEventListener("keydown",X)},[r,x,g,v,q,R,T]);const{analyserRef:ce,audioDataRef:pe}=iT(x,k,w.current),ue=X=>{var oe;const K=(oe=X.target.files)==null?void 0:oe[0];K&&$(K),X.target&&(X.target.value="")},re=X=>{var oe;const K=(oe=X.target.files)==null?void 0:oe[0];K&&te(K),X.target&&(X.target.value="")},$=X=>{const K=URL.createObjectURL(X),oe=X.type.startsWith("audio/")?"audio":"video";t(e.id,JSON.stringify({src:K,type:oe,name:X.name,currentTime:0,volume:.4,isPlaying:!0,markers:[]}))},Z=()=>{var ge;if(!u.trim())return;const X=u.trim(),K=(ge=X.split(".").pop())==null?void 0:ge.toLowerCase(),ne=["mp3","wav","ogg","m4a","aac","flac"].includes(K||"")?"audio":"video",le=X.split("/").pop()||"Remote Media";t(e.id,JSON.stringify({src:X,type:ne,name:le.length>30?le.substring(0,30)+"...":le,currentTime:0,volume:.4,isPlaying:!0,markers:[]})),p("")},te=X=>{const K=URL.createObjectURL(X),oe=X.type.startsWith("audio/")?"audio":"video",ne=JSON.parse(e.value||"{}");t(e.id,JSON.stringify({...ne,src:K,type:oe,name:X.name,currentTime:0,isPlaying:!0}))},ae=()=>{M(),w.current&&(w.current.pause(),w.current.removeAttribute("src"),w.current.load());const X=JSON.parse(e.value||"{}");t(e.id,JSON.stringify({...X,src:"",name:"",isPlaying:!1,currentTime:0})),setTimeout(()=>{var K;(K=s.current)==null||K.click()},100)},I=()=>{if(M(),!S||S.length===0)return;const X=JSON.stringify(S,null,2),K=new Blob([X],{type:"application/json"}),oe=URL.createObjectURL(K),ne=document.createElement("a");ne.href=oe;const le=new Date().toISOString().slice(0,10);ne.download=`markers_${le}.json`,ne.click(),URL.revokeObjectURL(oe)},J=()=>{var X;M(),(X=l.current)==null||X.click()},W=X=>{var ne;const K=(ne=X.target.files)==null?void 0:ne[0];if(!K)return;const oe=new FileReader;oe.onload=le=>{var ge;try{const we=(ge=le.target)==null?void 0:ge.result,_e=JSON.parse(we);if(Array.isArray(_e)){const fe=JSON.parse(e.value||"{}");t(e.id,JSON.stringify({...fe,markers:_e}))}else console.error("Invalid markers file format")}catch(we){console.error("Failed to load markers",we)}},oe.readAsText(K),X.target&&(X.target.value="")},U=X=>{X.preventDefault(),X.stopPropagation(),d(!0)},Q=X=>{X.preventDefault(),X.stopPropagation(),d(!1)},de=X=>{var oe;X.preventDefault(),X.stopPropagation(),d(!1);const K=(oe=X.dataTransfer.files)==null?void 0:oe[0];if(K){if(K.type.startsWith("video/")||K.type.startsWith("audio/"))$(K);else if(K.name.endsWith(".json")){const ne=new FileReader;ne.onload=le=>{var ge;try{const we=(ge=le.target)==null?void 0:ge.result,_e=JSON.parse(we);if(Array.isArray(_e)){const fe=JSON.parse(e.value||"{}");t(e.id,JSON.stringify({...fe,markers:_e}))}}catch{}},ne.readAsText(K)}}},se=()=>{M(),w.current&&(w.current.pause(),w.current.src=""),t(e.id,JSON.stringify({src:"",type:"video",name:"",markers:[],volume:.4}))};return n.jsxs("div",{className:"flex flex-col h-full bg-gray-900 rounded-lg overflow-hidden",children:[n.jsx("input",{ref:i,type:"file",accept:"video/*,audio/*",className:"hidden",onChange:ue}),n.jsx("input",{ref:s,type:"file",accept:"video/*,audio/*",className:"hidden",onChange:re}),n.jsx("input",{ref:l,type:"file",accept:".json",className:"hidden",onChange:W}),n.jsx("div",{className:`flex-grow relative flex ${x?"bg-black":"bg-gray-800"} min-h-0 overflow-hidden group ${c?"ring-2 ring-cyan-500 bg-gray-800":""}`,onDragEnter:U,onDragOver:X=>{X.preventDefault(),X.stopPropagation(),d(!0)},onDragLeave:Q,onDrop:de,children:x?k==="video"?n.jsxs(n.Fragment,{children:[n.jsx(pT,{src:x,mediaRef:w,onTimeUpdate:N,onLoadedMetadata:j,onEnded:L,onTogglePlay:V}),n.jsxs("div",{className:"absolute top-2 right-2 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity z-20",children:[n.jsx(Ne,{title:o("node.mediaViewer.relink"),onClick:X=>{X.stopPropagation(),ae()},className:"bg-black/50 hover:bg-black/70 p-1.5 rounded-full text-white cursor-pointer",tooltipPosition:"bottom",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),n.jsx(Ne,{title:o("node.action.clear"),onClick:X=>{X.stopPropagation(),se()},className:"bg-black/50 hover:bg-black/70 p-1.5 rounded-full text-white cursor-pointer",tooltipPosition:"bottom",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}):n.jsx(uT,{src:x,name:C,mediaRef:w,audioData:pe.current,analyser:ce.current,currentTime:g,duration:v,isPlaying:f,volume:_,markers:S,onSeek:F,onVolumeChange:G,onTimeUpdate:N,onLoadedMetadata:j,onEnded:L,onClear:X=>{X&&X.stopPropagation(),se()},onRelink:X=>{X&&X.stopPropagation(),ae()},onSelect:M,t:o}):n.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-4",children:[n.jsxs("div",{className:"flex flex-col items-center justify-center text-gray-500 cursor-pointer hover:text-gray-400 transition-colors mb-4",onClick:()=>{var X;return(X=i.current)==null?void 0:X.click()},children:[n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 mx-auto mb-2 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),n.jsx("p",{className:"text-sm font-medium",children:o("node.content.dropMedia")})]}),n.jsx("div",{className:"w-1/2 h-px bg-gray-700 my-2"}),n.jsxs("div",{className:"w-full max-w-[80%] flex items-center space-x-1",children:[n.jsxs("div",{className:"flex-grow bg-gray-800 rounded-md border border-gray-600 flex items-center px-2 py-1 focus-within:border-cyan-500 focus-within:ring-1 focus-within:ring-cyan-500 transition-all",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),n.jsx("input",{type:"text",value:u,onChange:X=>p(X.target.value),placeholder:"Paste URL...",className:"bg-transparent border-none text-xs text-white focus:outline-none w-full",onKeyDown:X=>{X.key==="Enter"&&Z()},onMouseDown:X=>X.stopPropagation()})]}),n.jsx("button",{onClick:Z,className:"p-1.5 bg-cyan-600 hover:bg-cyan-700 rounded-md text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:!u.trim(),title:"Load from URL",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]})]})}),x&&n.jsx(lT,{isPlaying:f,currentTime:g,duration:v,volume:_,markers:S,onTogglePlay:V,onStop:H,onSeek:F,onVolumeChange:G,onClear:se,onAddMarker:B,onUpdateMarker:Y,onDeleteMarker:ee,onDeleteAllMarkers:ie,onSaveMarkers:I,onLoadMarkers:J,onSelect:M,disabled:!x,t:o})]})},No=30,Eo=20,bs=(e,t)=>{const o=[e];let r={...e},a=0;for(;(r.x!==t.x||r.y!==t.y)&&a<1e3;){a++;const i=t.x-r.x,s=t.y-r.y;let l={...r};Math.random()>.2?Math.abs(i)>Math.abs(s)?l.x+=Math.sign(i):l.y+=Math.sign(s):Math.abs(i)>Math.abs(s)?l.y+=Math.random()>.5?1:-1:l.x+=Math.random()>.5?1:-1,l.x=Math.max(0,Math.min(No-1,l.x)),l.y=Math.max(0,Math.min(Eo-1,l.y)),o.push(l),r=l}return o},mT=()=>{const e={x:Math.floor(No/2),y:Math.floor(Eo/2)},t=bs({x:0,y:Math.floor(Eo/2)},e),o=bs({x:Math.floor(No/2),y:0},e),r=bs({x:No-1,y:Math.floor(Eo/2)},e),a=bs({x:Math.floor(No/2),y:Eo-1},e);return[t,o,r,a]},gT=1500,fT=2e3,Qg=`&@/"'*?! :;*,....%$#`,xT=e=>{const t={x:Math.floor(No/2),y:Math.floor(Eo/2)},o={grid:[],paths:[],dataUnits:[],enemies:[],towers:[],projectiles:[],score:0,bits:150,wordsQueue:[],storedData:[],totalWordsInitial:0,isLevelComplete:!1,isPaused:!0,centerPoint:t},r=y.useRef(o),[a,i]=y.useState({score:0,bits:150,isPaused:!0,isLevelComplete:!1}),s=y.useRef(0),l=y.useRef(0),c=y.useRef(0),d=y.useRef(0);y.useEffect(()=>{const f=mT(),g=Array.from({length:Eo},(v,_)=>Array.from({length:No},(S,T)=>({x:T,y:_,isOccupied:!1})));r.current={...r.current,grid:g,paths:f}},[]),y.useEffect(()=>{const f=e.split(/\s+/).filter(g=>g.length>0);r.current.wordsQueue=f,r.current.totalWordsInitial=f.length,f.length>0&&(r.current.isLevelComplete=!1,r.current.storedData=[],i(g=>({...g,isLevelComplete:!1})))},[e]);const u=()=>{r.current.isPaused=!1,i(f=>({...f,isPaused:!1})),s.current=performance.now(),k()},p=()=>{r.current.isPaused=!0,i(f=>({...f,isPaused:!0})),d.current&&cancelAnimationFrame(d.current)},h=(f,g)=>{const v=r.current,_=v.paths.some(R=>R.some(D=>D.x===f&&D.y===g)),S=Math.abs(f-v.centerPoint.x),T=Math.abs(g-v.centerPoint.y),P=S<=1&&T<=1;v.bits>=50&&!v.grid[g][f].isOccupied&&!_&&!P&&(v.bits-=50,v.grid[g][f].isOccupied=!0,v.towers.push({id:`tower-${Date.now()}`,x:f,y:g,range:6,damage:3,cooldown:400,lastShotTime:0,color:"#22d3ee"}),i(R=>({...R,bits:v.bits})))},x=f=>{if(!f)return"ERR";const g=f.length;let v="";for(let _=0;_<g;_++)v+=Qg.charAt(Math.floor(Math.random()*Qg.length));return v},k=()=>{if(r.current.isPaused)return;const f=performance.now(),g=f-s.current;s.current=f,C(g,f),d.current=requestAnimationFrame(k)},C=(f,g)=>{const v=r.current;if(v.wordsQueue.length===0&&v.dataUnits.length===0&&!v.isLevelComplete&&v.totalWordsInitial>0){v.isLevelComplete=!0,v.isPaused=!0,i(_=>({..._,isLevelComplete:!0,isPaused:!0}));return}if(v.wordsQueue.length>0&&g-l.current>gT){const _=v.wordsQueue.shift();_&&(v.dataUnits.push({id:`data-${Date.now()}`,word:_,pathIndex:0,progress:0,hp:20,maxHp:20,speed:2,isDead:!1,reachedBase:!1,color:"#06b6d4"}),l.current=g)}if((v.dataUnits.length>0||v.wordsQueue.length>0)&&g-c.current>fT){const _=Math.floor(Math.random()*3)+1;v.enemies.push({id:`enemy-${Date.now()}`,pathIndex:_,progress:0,hp:8,maxHp:8,speed:2.5,reachedBase:!1,isDead:!1,damage:0,color:"#ef4444"}),c.current=g}v.dataUnits.forEach(_=>{if(_.isDead||_.reachedBase)return;const S=v.paths[_.pathIndex];_.progress+=_.speed*f/1e3,_.progress>=S.length-1&&(_.reachedBase=!0,v.score+=20,v.bits+=15,v.storedData.push(_.word),i(T=>({...T,score:v.score,bits:v.bits})))}),v.enemies.forEach(_=>{if(_.isDead||_.reachedBase)return;const S=v.paths[_.pathIndex];if(_.progress+=_.speed*f/1e3,_.progress>=S.length-1&&(_.reachedBase=!0,v.storedData.length>0)){const T=Math.floor(Math.random()*v.storedData.length),P=v.storedData[T];v.storedData[T]=x(P)}}),v.towers.forEach(_=>{if(g-_.lastShotTime>_.cooldown){let S,T=1/0;v.enemies.forEach(P=>{if(P.isDead||P.reachedBase)return;const R=v.paths[P.pathIndex],D=Math.floor(P.progress),q=R[D]||R[R.length-1],O=Math.hypot(q.x-_.x,q.y-_.y);O<=_.range&&O<T&&(T=O,S=P)}),S&&(v.projectiles.push({id:`proj-${Date.now()}-${Math.random()}`,x:_.x,y:_.y,targetId:S.id,targetType:"enemy",speed:15,damage:_.damage,color:"#fef08a"}),_.lastShotTime=g)}}),v.projectiles.forEach(_=>{const S=v.enemies.find(A=>A.id===_.targetId);if(!S||S.isDead||S.reachedBase){_.damage=0;return}const T=v.paths[S.pathIndex],P=Math.floor(S.progress),R=T[P]||T[T.length-1],D=R.x-_.x,q=R.y-_.y,O=Math.hypot(D,q),E=_.speed*f/1e3;O<=E?(S.hp-=_.damage,S.hp<=0&&(S.isDead=!0,v.bits+=5,v.score+=5,i(A=>({...A,bits:v.bits,score:v.score}))),_.damage=0):(_.x+=D/O*E,_.y+=q/O*E)}),v.dataUnits=v.dataUnits.filter(_=>!_.isDead&&!_.reachedBase),v.enemies=v.enemies.filter(_=>!_.isDead&&!_.reachedBase),v.projectiles=v.projectiles.filter(_=>_.damage>0)};return{gameStateRef:r,uiState:a,startGame:u,pauseGame:p,buildTower:h,getFinalText:()=>r.current.storedData.join(" ")}},yT=({gameStateRef:e,onCellClick:t})=>{const o=y.useRef(null),r=y.useRef(null),a=()=>{const s=o.current;if(!s)return;const l=s.getContext("2d");if(!l)return;const c=e.current;l.clearRect(0,0,s.width,s.height);const d=s.width,u=s.height,p=d/No,h=u/Eo;l.strokeStyle="rgba(255,255,255,0.03)",l.lineWidth=1;for(let g=0;g<=No;g++)l.beginPath(),l.moveTo(g*p,0),l.lineTo(g*p,u),l.stroke();for(let g=0;g<=Eo;g++)l.beginPath(),l.moveTo(0,g*h),l.lineTo(d,g*h),l.stroke();c.paths.forEach((g,v)=>{if(g.length===0)return;l.beginPath(),l.strokeStyle=v===0?"rgba(34, 211, 238, 0.2)":"rgba(239, 68, 68, 0.2)",l.lineWidth=p*.4,l.lineCap="round",l.lineJoin="round";const _=g[0];l.moveTo((_.x+.5)*p,(_.y+.5)*h);for(let S=1;S<g.length;S++){const T=g[S];l.lineTo((T.x+.5)*p,(T.y+.5)*h)}l.stroke()});const x=(c.centerPoint.x+.5)*p,k=(c.centerPoint.y+.5)*h,C=p*1.5,w=l.createRadialGradient(x,k,C*.2,x,k,C);w.addColorStop(0,"rgba(6, 182, 212, 0.8)"),w.addColorStop(.6,"rgba(16, 185, 129, 0.4)"),w.addColorStop(1,"rgba(0,0,0,0)"),l.fillStyle=w,l.beginPath(),l.arc(x,k,C,0,Math.PI*2),l.fill(),l.strokeStyle="#fff",l.lineWidth=2,l.beginPath(),l.arc(x,k,C*.5,0,Math.PI*2),l.stroke(),c.towers.forEach(g=>{l.fillStyle=g.color,l.fillRect(g.x*p+2,g.y*h+2,p-4,h-4),l.fillStyle="#fff",l.fillRect(g.x*p+p/2-2,g.y*h+h/2-2,4,4)});const f=(g,v,_,S)=>{const T=c.paths[g];if(!T)return;const P=Math.floor(v),R=T[P]||T[T.length-1],D=T[P+1]||R,q=v-P,O=R.x+(D.x-R.x)*q,E=R.y+(D.y-R.y)*q,A=(O+.5)*p,N=(E+.5)*h;l.fillStyle=_,l.beginPath(),l.arc(A,N,p*.3,0,Math.PI*2),l.fill(),l.fillStyle="red",l.fillRect(A-p*.3,N-h*.5,p*.6,3),l.fillStyle="#10b981",l.fillRect(A-p*.3,N-h*.5,p*.6*S,3)};c.dataUnits.forEach(g=>f(g.pathIndex,g.progress,g.color,g.hp/g.maxHp)),c.enemies.forEach(g=>f(g.pathIndex,g.progress,g.color,g.hp/g.maxHp)),c.projectiles.forEach(g=>{l.fillStyle=g.color,l.beginPath(),l.arc((g.x+.5)*p,(g.y+.5)*h,3,0,Math.PI*2),l.fill()}),r.current=requestAnimationFrame(a)};y.useEffect(()=>(r.current=requestAnimationFrame(a),()=>{r.current&&cancelAnimationFrame(r.current)}),[]);const i=s=>{const l=o.current;if(!l)return;const c=l.getBoundingClientRect(),d=s.clientX-c.left,u=s.clientY-c.top,p=l.width/No,h=l.height/Eo,x=l.width/c.width,k=l.height/c.height,C=Math.floor(d*x/p),w=Math.floor(u*k/h);t(C,w)};return n.jsx("canvas",{ref:o,width:900,height:600,className:"w-full h-full bg-gray-900 cursor-crosshair",onClick:i})},vT=({score:e,bits:t,isPaused:o,onTogglePause:r,t:a})=>n.jsxs("div",{className:"absolute top-2 left-2 right-2 flex justify-between items-start pointer-events-none",children:[n.jsxs("div",{className:"bg-gray-800/80 backdrop-blur rounded p-2 border border-gray-600 shadow-lg pointer-events-auto flex flex-col gap-1",children:[n.jsxs("div",{className:"text-cyan-400 font-bold text-lg",children:["Score: ",e]}),n.jsxs("div",{className:"text-yellow-400 font-mono text-sm",children:["Bits: ",t]})]}),n.jsx("div",{className:"pointer-events-auto",children:n.jsx("button",{onClick:r,className:`px-4 py-2 rounded font-bold text-white shadow-lg transition-colors ${o?"bg-emerald-600 hover:bg-emerald-700":"bg-red-600 hover:bg-red-700"}`,children:o?"START / RESUME":"PAUSE"})}),n.jsxs("div",{className:"bg-gray-800/80 backdrop-blur rounded p-2 border border-gray-600 shadow-lg text-xs text-gray-300 max-w-[150px]",children:[n.jsx("p",{children:"Click on empty cells to build towers (50 Bits)."}),n.jsx("p",{children:"Protect the blue circles!"})]})]}),wT=({node:e,onValueChange:t,t:o,getUpstreamNodeValues:r})=>{const a=y.useMemo(()=>r(e.id).filter(k=>typeof k=="string").join(" "),[r,e.id]),{gameStateRef:i,uiState:s,startGame:l,pauseGame:c,buildTower:d,getFinalText:u}=xT(a),p=()=>{const h=u();try{const x=JSON.parse(e.value||"{}");t(e.id,JSON.stringify({...x,outputText:h}))}catch{t(e.id,JSON.stringify({outputText:h}))}};return n.jsxs("div",{className:"relative w-full h-full bg-gray-900 rounded-md overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"flex-grow relative group",children:[n.jsx(yT,{gameStateRef:i,onCellClick:d}),n.jsx(vT,{score:s.score,bits:s.bits,isPaused:s.isPaused,onTogglePause:()=>s.isPaused?l():c(),t:o}),s.isLevelComplete&&n.jsxs("div",{className:"absolute inset-0 flex items-center justify-center z-20 pointer-events-auto",children:[n.jsx("div",{className:"bg-black/60 absolute inset-0 backdrop-blur-sm"}),n.jsxs("div",{className:"relative flex flex-col items-center gap-4 p-6 bg-gray-800 rounded-xl border-2 border-cyan-500 shadow-[0_0_50px_rgba(6,182,212,0.4)] animate-fade-in-up",children:[n.jsx("h2",{className:"text-2xl font-bold text-white uppercase tracking-widest",children:"Transmission Complete"}),n.jsxs("div",{className:"text-gray-300 text-sm",children:["Integrity: ",n.jsxs("span",{className:"text-cyan-400 font-mono",children:[Math.floor(s.score/(i.current.totalWordsInitial*20)*100),"%"]})]}),n.jsx("button",{onClick:p,className:"px-8 py-3 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-bold rounded-lg shadow-lg transform hover:scale-105 transition-all",children:"GENERATE OUTPUT"})]})]})]}),n.jsxs("div",{className:"h-6 bg-gray-800 border-t border-gray-700 flex items-center px-2 text-[10px] text-gray-400 justify-between shrink-0",children:[n.jsxs("span",{children:["Input: ",a.length>20?a.substring(0,20)+"...":a?`${a.length} chars`:"No Data"]}),n.jsxs("span",{children:["Status: ",s.isLevelComplete?"Complete":s.isPaused?"Paused":"Active"]})]})]})},Xc=[{id:0,name:"Nose",x:.5,y:.15,color:"#ff0000"},{id:1,name:"Neck",x:.5,y:.25,color:"#ff5500",isFixed:!0},{id:2,name:"RShoulder",x:.4,y:.25,color:"#ffaa00",parent:1},{id:3,name:"RElbow",x:.35,y:.4,color:"#ffff00",parent:2},{id:4,name:"RWrist",x:.3,y:.55,color:"#aaff00",parent:3},{id:5,name:"LShoulder",x:.6,y:.25,color:"#55ff00",parent:1},{id:6,name:"LElbow",x:.65,y:.4,color:"#00ff00",parent:5},{id:7,name:"LWrist",x:.7,y:.55,color:"#00ff55",parent:6},{id:8,name:"RHip",x:.45,y:.55,color:"#00ffaa",parent:1},{id:9,name:"RKnee",x:.45,y:.75,color:"#00ffff",parent:8},{id:10,name:"RAnkle",x:.45,y:.95,color:"#00aaff",parent:9},{id:11,name:"LHip",x:.55,y:.55,color:"#0055ff",parent:1},{id:12,name:"LKnee",x:.55,y:.75,color:"#0000ff",parent:11},{id:13,name:"LAnkle",x:.55,y:.95,color:"#5500ff",parent:12},{id:14,name:"REye",x:.48,y:.13,color:"#aa00ff",parent:0},{id:15,name:"LEye",x:.52,y:.13,color:"#ff00ff",parent:0},{id:16,name:"REar",x:.45,y:.14,color:"#ff00aa",parent:14},{id:17,name:"LEar",x:.55,y:.14,color:"#ff0055",parent:15}],bT=[{from:1,to:2,color:"#ffaa00"},{from:2,to:3,color:"#ffff00"},{from:3,to:4,color:"#aaff00"},{from:1,to:5,color:"#55ff00"},{from:5,to:6,color:"#00ff00"},{from:6,to:7,color:"#00ff55"},{from:1,to:8,color:"#00ffaa"},{from:8,to:9,color:"#00ffff"},{from:9,to:10,color:"#00aaff"},{from:1,to:11,color:"#0055ff"},{from:11,to:12,color:"#0000ff"},{from:12,to:13,color:"#5500ff"},{from:1,to:0,color:"#ff5500"},{from:0,to:14,color:"#aa00ff"},{from:14,to:16,color:"#ff00aa"},{from:0,to:15,color:"#ff00ff"},{from:15,to:17,color:"#ff0055"}],CT=(e,t,o=5)=>{if(e.length<2)return e;const r=[];for(let l=0;l<e.length-1;l++)r.push(Math.hypot(e[l+1].x-e[l].x,e[l+1].y-e[l].y));const a={x:e[0].x,y:e[0].y},i=r.reduce((l,c)=>l+c,0);if(Math.hypot(t.x-a.x,t.y-a.y)>i){for(let l=0;l<e.length-1;l++){const c=t.x-e[l].x,d=t.y-e[l].y,u=Math.hypot(c,d),p=r[l]/u;e[l+1].x=e[l].x+c*p,e[l+1].y=e[l].y+d*p}return e}for(let l=0;l<o;l++){e[e.length-1].x=t.x,e[e.length-1].y=t.y;for(let c=e.length-2;c>=0;c--){const d=e[c].x-e[c+1].x,u=e[c].y-e[c+1].y,p=Math.hypot(d,u),h=r[c]/p;e[c].x=e[c+1].x+d*h,e[c].y=e[c+1].y+u*h}e[0].x=a.x,e[0].y=a.y;for(let c=0;c<e.length-1;c++){const d=e[c+1].x-e[c].x,u=e[c+1].y-e[c].y,p=Math.hypot(d,u),h=r[c]/p;e[c+1].x=e[c].x+d*h,e[c+1].y=e[c].y+u*h}}return e},kT=({node:e,onValueChange:t,t:o,onSelectNode:r,addToast:a,onDownloadImageFromUrl:i,onCopyImageToClipboard:s})=>{const l=y.useRef(null),c=y.useRef(null),d=y.useRef(null),u=y.useMemo(()=>{try{const j=JSON.parse(e.value||"{}");return{joints:j.joints&&j.joints.length>0?j.joints:JSON.parse(JSON.stringify(Xc)),aspectRatio:j.aspectRatio||"1:1",resolution:j.resolution||"1K",renderedImage:j.renderedImage||null,aiPrompt:j.aiPrompt||""}}catch{return{joints:JSON.parse(JSON.stringify(Xc)),aspectRatio:"1:1",resolution:"1K",renderedImage:null,aiPrompt:""}}},[e.value]),[p,h]=y.useState(u.joints),[x,k]=y.useState(null),[C,w]=y.useState(!1);y.useEffect(()=>{h(u.joints)},[u.joints]);const f=(j,L,M)=>{const V={...u,...M,joints:j,renderedImage:L!==void 0?L:u.renderedImage};t(e.id,JSON.stringify(V))},g=async()=>{if(!(!u.aiPrompt.trim()||C)){w(!0);try{const L=await new Sp({apiKey:void 0}).models.generateContent({model:"gemini-3-flash-preview",contents:`Generate a 2D character pose for the following description: "${u.aiPrompt}".
                
                The rig uses 18 joints (0-17): 0:Nose, 1:Neck, 2:RShoulder, 3:RElbow, 4:RWrist, 5:LShoulder, 6:LElbow, 7:LWrist, 8:RHip, 9:RKnee, 10:RAnkle, 11:LHip, 12:LKnee, 13:LAnkle, 14:REye, 15:LEye, 16:REar, 17:LEar.
                
                Coordinates x and y must be between 0.0 (top/left) and 1.0 (bottom/right).
                Make sure the pose is dynamic, anatomically plausible, and fits within the 0-1 range.`,config:{responseMimeType:"application/json",responseSchema:{type:gt.OBJECT,properties:{joints:{type:gt.ARRAY,items:{type:gt.OBJECT,properties:{id:{type:gt.INTEGER},name:{type:gt.STRING},x:{type:gt.NUMBER},y:{type:gt.NUMBER},color:{type:gt.STRING}},required:["id","x","y"]}}},required:["joints"]}}}),M=JSON.parse(L.text);if(M.joints&&Array.isArray(M.joints)){const V=p.map(H=>{const F=M.joints.find(G=>G.id===H.id);return F?{...H,x:F.x,y:F.y}:H});h(V),f(V),a==null||a("AI Pose Generated","success")}}catch(j){console.error("AI Pose Generation failed:",j),a==null||a("AI Generation failed","error")}finally{w(!1)}}},v=(j,L,M,V=!1)=>{j.fillStyle="black",j.fillRect(0,0,L,M),bT.forEach(H=>{const F=p.find(B=>B.id===H.from),G=p.find(B=>B.id===H.to);F&&G&&(j.beginPath(),j.strokeStyle=H.color,j.lineWidth=V?6:2,j.moveTo(F.x*L,F.y*M),j.lineTo(G.x*L,G.y*M),j.stroke())}),V||p.forEach(H=>{j.beginPath(),j.fillStyle=H.color,j.arc(H.x*L,H.y*M,x===H.id?8:5,0,Math.PI*2),j.fill(),j.strokeStyle="white",j.lineWidth=1,j.stroke()})};y.useEffect(()=>{var V;const j=l.current;if(!j)return;const L=j.getContext("2d");if(!L)return;const M=(V=j.parentElement)==null?void 0:V.getBoundingClientRect();M&&(j.width=M.width,j.height=M.height),v(L,j.width,j.height)},[p,x]);const _=j=>{j.stopPropagation(),r&&r();const L=l.current;if(!L)return;const M=L.getBoundingClientRect(),V=(j.clientX-M.left)/L.width,H=(j.clientY-M.top)/L.height,F=.05,G=p.find(B=>Math.hypot(B.x-V,B.y-H)<F);G&&k(G.id)},S=j=>{if(x===null)return;const L=l.current;if(!L)return;const M=L.getBoundingClientRect(),V=(j.clientX-M.left)/L.width,H=(j.clientY-M.top)/L.height,F=[...p],G=F.find(Y=>Y.id===x);if(!G)return;if([4,7,10,13].includes(x)){let Y=[];x===4?Y=[1,2,3,4]:x===7?Y=[1,5,6,7]:x===10?Y=[1,8,9,10]:x===13&&(Y=[1,11,12,13]);const ee=Y.map(ie=>F.find(ce=>ce.id===ie));CT(ee,{x:V,y:H})}else G.x=V,G.y=H;h(F)},T=()=>{x!==null&&(k(null),f(p))},P=()=>{const j=document.createElement("canvas"),M={"720p":1280,"1080p":1920,"1K":1024,"2K":2048,"4K":4096}[u.resolution]||1024,[V,H]=u.aspectRatio.split(":").map(Number),F=V/H;let G=M,B=M;F>1?B=M/F:G=M*F,j.width=G,j.height=B;const Y=j.getContext("2d");if(Y){v(Y,G,B,!0);const ee=j.toDataURL("image/png");f(p,ee),a&&a("Pose Rendered","success")}},R=()=>{const j=JSON.parse(JSON.stringify(Xc));h(j),f(j,null)},D=()=>{var j;(j=d.current)==null||j.click()},q=j=>{var V;const L=(V=j.target.files)==null?void 0:V[0];if(!L)return;const M=new FileReader;M.onload=H=>{var F;try{const G=(F=H.target)==null?void 0:F.result,B=JSON.parse(G);if(B.joints&&Array.isArray(B.joints))h(B.joints),t(e.id,JSON.stringify({...u,...B})),a&&a("Pose Loaded","success");else throw new Error("Invalid pose format")}catch{a&&a("Failed to load pose: Invalid JSON","error")}},M.readAsText(L),j.target&&(j.target.value="")},O=j=>{j.stopPropagation(),u.renderedImage&&i&&i(u.renderedImage,0,"Pose Reference")},E=j=>{j.stopPropagation(),u.renderedImage&&s&&s(u.renderedImage)},A=["1:1","16:9","9:16","4:3","3:4"],N=["720p","1080p","1K","2K","4K"];return n.jsxs("div",{className:"flex flex-col h-full bg-gray-900 rounded-lg overflow-hidden",onWheel:j=>j.stopPropagation(),children:[n.jsx("input",{type:"file",ref:d,className:"hidden",accept:".json",onChange:q}),n.jsxs("div",{className:"p-2 bg-gray-800 border-b border-gray-700 flex gap-2 shrink-0",children:[n.jsx("input",{type:"text",value:u.aiPrompt,onChange:j=>f(p,void 0,{aiPrompt:j.target.value}),onKeyDown:j=>{j.key==="Enter"&&g()},placeholder:"Describe pose (e.g. 'Hero landing', 'Sitting on a bench')...",className:"flex-grow bg-gray-900 border border-gray-600 rounded px-2 py-1 text-xs text-white focus:border-cyan-500 outline-none",onMouseDown:j=>j.stopPropagation()}),n.jsx("button",{onClick:g,disabled:C||!u.aiPrompt.trim(),className:"px-3 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-700 rounded text-xs font-bold flex items-center gap-1.5 transition-colors shrink-0",children:C?n.jsxs("svg",{className:"animate-spin h-3 w-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):" AI"})]}),n.jsxs("div",{className:"p-2 border-b border-gray-700 flex justify-between items-center bg-gray-800 gap-2 shrink-0",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsx("div",{className:"w-24",children:n.jsx(Mn,{value:u.aspectRatio,onChange:j=>t(e.id,JSON.stringify({...u,aspectRatio:j})),options:A.map(j=>({value:j,label:j}))})}),n.jsx("div",{className:"w-24",children:n.jsx(Mn,{value:u.resolution,onChange:j=>t(e.id,JSON.stringify({...u,resolution:j})),options:N.map(j=>({value:j,label:j}))})})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[u.renderedImage&&n.jsxs(n.Fragment,{children:[n.jsx(Ne,{title:o("node.action.copy"),onClick:E,children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Ne,{title:o("node.action.download"),onClick:O,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-700 mx-1"})]}),n.jsx("button",{onClick:D,className:"p-2 bg-gray-700 hover:bg-gray-600 rounded text-xs text-gray-300",children:"Load"}),n.jsx("button",{onClick:R,className:"p-2 bg-gray-700 hover:bg-gray-600 rounded text-xs text-gray-300",children:"Reset"}),n.jsx("button",{onClick:P,className:"p-2 bg-cyan-600 hover:bg-cyan-700 rounded text-xs font-bold text-white uppercase tracking-wider",children:"Render"})]})]}),n.jsxs("div",{ref:c,className:"flex-grow relative bg-black min-h-0",children:[n.jsx("canvas",{ref:l,className:"w-full h-full cursor-crosshair block",onMouseDown:_,onMouseMove:S,onMouseUp:T,onMouseLeave:T}),u.renderedImage&&n.jsx("div",{className:"absolute bottom-2 left-2 w-24 h-24 border border-gray-600 rounded overflow-hidden shadow-lg bg-black pointer-events-none group-hover:w-48 group-hover:h-48 transition-all duration-300",children:n.jsx("img",{src:u.renderedImage,alt:"Rendered",className:"w-full h-full object-contain"})})]}),n.jsx("div",{className:"p-1.5 bg-gray-800 border-t border-gray-700 flex items-center justify-center gap-4 shrink-0",children:n.jsx("span",{className:"text-[10px] text-gray-500 font-bold uppercase tracking-widest",children:"Inverse Kinematics: Draggable Wrists & Ankles"})})]})},_T=({value:e,onDebouncedChange:t,debounceTime:o=300,onChange:r,...a})=>{const[i,s]=y.useState(e),l=y.useRef(null),c=y.useRef(!1);y.useEffect(()=>{!c.current&&e!==i&&s(e)},[e]);const d=p=>{const h=p.target.value;s(h),c.current=!0,l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{t(h),c.current=!1},o),r&&r(p)},u=p=>{l.current&&(clearTimeout(l.current),t(i),c.current=!1),a.onBlur&&a.onBlur(p)};return n.jsx("input",{...a,value:i,onChange:d,onBlur:u})},ST=({width:e,height:t})=>{const o=e/t;let r="",a="";return o>1.2?(r="M2 6h20v12H2z",a="Landscape"):o<.85?(r="M6 2h12v20H6z",a="Portrait"):(r="M4 4h16v16H4z",a="Square"),n.jsx("div",{className:"bg-black/60 rounded-tl-md px-1.5 py-1 flex items-center justify-center",title:a,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white/90",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:r})})})},NT=({concept:e,displayImage:t,fullResImage:o,isReadOnly:r,onUpdate:a,onDelete:i,onMoveUp:s,onMoveDown:l,isFirst:c,isLast:d,onDetach:u,onViewImage:p,t:h,hasError:x})=>{const k=y.useRef(null),[C,w]=y.useState(!1),[f,g]=y.useState(null),v=O=>{var A;const E=(A=O.target.files)==null?void 0:A[0];if(E){const N=new FileReader;N.onload=j=>{var L;(L=j.target)!=null&&L.result&&a({image:j.target.result})},N.readAsDataURL(E)}O.target&&(O.target.value="")},_=O=>{e.isConnected||(O.preventDefault(),O.stopPropagation(),w(!0))},S=O=>{e.isConnected||(O.preventDefault(),O.stopPropagation(),w(!1))},T=O=>{e.isConnected||(O.preventDefault(),O.stopPropagation(),w(!0))},P=O=>{var N;if(e.isConnected)return;O.preventDefault(),O.stopPropagation(),w(!1);const E=O.dataTransfer.getData("application/prompt-modifier-drag-image");if(E){E.startsWith("data:")?a({image:E}):fetch(E).then(j=>j.blob()).then(j=>{const L=new FileReader;L.onload=M=>{var V;(V=M.target)!=null&&V.result&&a({image:M.target.result})},L.readAsDataURL(j)});return}const A=(N=O.dataTransfer.files)==null?void 0:N[0];if(A&&A.type.startsWith("image/")){const j=new FileReader;j.onload=L=>{var M;(M=L.target)!=null&&M.result&&a({image:L.target.result})},j.readAsDataURL(A)}},R=O=>{var A;O.stopPropagation();const E=o||t;E?p(E):e.isConnected||(A=k.current)==null||A.click()},D=O=>{O.stopPropagation(),a({image:null}),g(null)},q=O=>{const E=o||t;E&&(O.dataTransfer.setData("application/prompt-modifier-drag-image",E),O.dataTransfer.effectAllowed="copy",O.stopPropagation())};return n.jsxs("div",{className:`bg-gray-800 rounded-lg p-2 flex flex-col h-full border-2 ${x?"border-red-500":"border-gray-700"} w-full`,children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:`text-xs font-bold ${x?"text-red-500 animate-pulse":"text-gray-400"} truncate`,title:e.id,children:e.id}),n.jsxs("div",{className:"flex items-center space-x-1",children:[e.isConnected&&n.jsx(Ne,{title:"Detach",tooltipPosition:"left",onClick:O=>{O.stopPropagation(),u()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("button",{onClick:O=>{O.stopPropagation(),s()},disabled:c,className:"text-gray-500 hover:text-white disabled:opacity-30",children:n.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),n.jsx("button",{onClick:O=>{O.stopPropagation(),l()},disabled:d,className:"text-gray-500 hover:text-white disabled:opacity-30",children:n.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),!e.isConnected&&n.jsx(Ne,{title:h("node.action.delete"),tooltipPosition:"left",onClick:O=>{O.stopPropagation(),i()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-h-0",children:[n.jsxs("div",{className:`aspect-square bg-gray-900 rounded flex items-center justify-center overflow-hidden relative group flex-shrink-0 cursor-pointer transition-all ${C?"ring-2 ring-cyan-400 bg-gray-800":"hover:ring-1 hover:ring-cyan-500"}`,onClick:R,onDragEnter:_,onDragOver:T,onDragLeave:S,onDrop:P,title:t?"Click to View":"Click to Upload or Drop Image",children:[t?n.jsxs(n.Fragment,{children:[n.jsx("img",{src:t,alt:e.name,className:"w-full h-full object-cover",draggable:!0,onDragStart:q,onLoad:O=>g({width:O.currentTarget.naturalWidth,height:O.currentTarget.naturalHeight})}),!e.isConnected&&n.jsx("div",{className:"absolute top-1 right-1",children:n.jsx(Ne,{title:h("node.action.clear"),onClick:D,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white drop-shadow-md",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})}),f&&n.jsx("div",{className:"absolute bottom-0 right-0 pointer-events-none z-10",children:n.jsx(ST,{width:f.width,height:f.height})})]}):n.jsx("div",{className:"text-gray-600 text-xs text-center px-1 pointer-events-none",children:e.isConnected?"No Image":"Drop or Click"}),n.jsx("input",{ref:k,type:"file",className:"hidden",accept:"image/*",onChange:v})]}),n.jsxs("div",{className:"space-y-1 flex-grow flex flex-col min-h-0",children:[n.jsx(_T,{value:e.name,onDebouncedChange:O=>a({name:O}),className:"w-full bg-gray-900 text-xs text-white p-1 rounded border border-gray-700 focus:outline-none focus:border-cyan-500",placeholder:"Name",readOnly:r}),n.jsx(hn,{value:e.prompt,onDebouncedChange:O=>a({prompt:O}),className:"w-full flex-grow bg-gray-900 text-xs text-gray-300 p-1 rounded border border-gray-700 focus:outline-none focus:border-cyan-500 resize-none custom-scrollbar",placeholder:"Appearance prompt...",readOnly:r})]})]})]})},ET=({allConcepts:e,onUpdateConcept:t,onDeleteConcept:o,onMoveConcept:r,onAddConcept:a,onDetachConnectedConcept:i,onClearConcepts:s,handleViewImage:l,t:c,deselectAllNodes:d,conceptsMode:u="normal",onToggleMode:p,duplicateIndices:h=new Set})=>{const[x,k]=y.useState(!1),C=v=>{v.preventDefault(),v.stopPropagation(),k(!0)},w=v=>{v.preventDefault(),v.stopPropagation(),k(!1),a()},f=v=>{p&&p(u==="collapsed"?"normal":"collapsed")},g=e.findIndex(v=>!v.isConnected);return n.jsxs("div",{className:"flex-shrink-0 flex flex-col h-full bg-gray-900/30 rounded-t-md overflow-hidden",children:[n.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-800/80 border-b border-gray-700 select-none cursor-pointer hover:bg-gray-700/80 transition-colors",onClick:f,title:"Click to toggle collapse",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs("h3",{className:`text-sm font-bold ${h.size>0?"text-red-400":"text-gray-300"} flex-shrink-0`,children:[c("node.content.characterConcepts"),h.size>0&&n.jsx("span",{className:"ml-2 text-[10px] bg-red-900/40 px-1 rounded uppercase",children:"  "})]}),n.jsx("div",{onClick:v=>v.stopPropagation(),children:n.jsx(Ne,{title:"Clear All (Local & Connected)",onClick:s,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]}),p&&n.jsxs("div",{className:"flex items-center space-x-1",onClick:v=>v.stopPropagation(),children:[u==="expanded"?n.jsx("button",{onClick:()=>p("normal"),className:"p-1 text-gray-400 hover:text-white rounded hover:bg-gray-700 transition-colors",title:"Restore size",children:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("path",{d:"M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"})})}):n.jsx("button",{onClick:()=>p("expanded"),className:"p-1 text-gray-400 hover:text-white rounded hover:bg-gray-700 transition-colors",title:"Expand to full height",children:n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("path",{d:"M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"})})}),u==="collapsed"?n.jsx("button",{onClick:()=>p("normal"),className:"p-1 text-gray-400 hover:text-white rounded hover:bg-gray-700 transition-colors",title:"Expand Panel",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}):n.jsx("button",{onClick:()=>p("collapsed"),className:"p-1 text-gray-400 hover:text-white rounded hover:bg-gray-700 transition-colors",title:"Collapse Panel",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]})]}),u!=="collapsed"&&n.jsxs("div",{className:"bg-gray-900/50 p-2 overflow-y-auto grid gap-2 custom-scrollbar flex-grow min-h-0",style:{gridTemplateColumns:"repeat(auto-fill, 240px)",gridAutoRows:"340px",justifyContent:"start"},onWheel:v=>v.stopPropagation(),children:[e.map((v,_)=>{const S=h.has((v.id||"").trim());return n.jsx("div",{className:"h-full w-full",children:n.jsx(NT,{concept:{id:v.id,name:v.name,prompt:v.prompt,image:v.image,fullDescription:v.fullDescription,isConnected:v.isConnected},displayImage:v.image,fullResImage:v._fullResImage||v.image,isReadOnly:!1,onUpdate:T=>t(_,T,v.isConnected,v.uniqueKey),onDelete:()=>o(_),onMoveUp:()=>r(_,"up"),onMoveDown:()=>r(_,"down"),isFirst:_===0||_===g&&!v.isConnected,isLast:_===e.length-1,onDetach:()=>i(v),onViewImage:l,t:c,hasError:S})},v.uniqueKey||_)}),n.jsx("button",{onClick:a,onDragEnter:C,onDragOver:v=>{v.preventDefault(),v.stopPropagation(),k(!0)},onDragLeave:()=>k(!1),onDrop:w,className:`h-[340px] bg-gray-700 hover:bg-gray-600 rounded-md flex items-center justify-center text-gray-400 text-4xl transition-all ${x?"ring-2 ring-cyan-400":""}`,children:"+"})]})]})},mu=260,gu=180,K1=44,e0=36,PT=200,TT=200,t0=16,IT=160,jT=32,AT={WS:"Integrate the character/object with a Wide Shot (WS) into the scene and action. Show the environment.",MS:"Integrate the character/object with a Medium Shot (MS) into the scene. Character from waist up.",CU:"Integrate the character/object with a Close-Up (CU) into the scene.",ECU:"Integrate the character/object with an Extreme Close-Up (ECU) into the scene. Maximum detail.",LS:"Integrate the character/object with a Long Shot (LS) into the scene to show scale."},qr=({value:e,placeholder:t,onChange:o,min:r,className:a,title:i})=>{const s=c=>{const d=parseInt(e,10);let u=isNaN(d)?r||1:d+c;r!==void 0&&u<r&&(u=r),o(u.toString())},l=c=>{const d=c.target.value;if(d===""){o("");return}const u=parseInt(d,10);!isNaN(u)&&r!==void 0&&u<r||o(d)};return n.jsxs("div",{className:`relative flex items-center bg-gray-800 rounded border border-gray-600 h-7 ${a}`,title:i,children:[n.jsx("input",{type:"number",min:r,value:e,placeholder:t,onChange:l,className:"appearance-none w-full h-full bg-transparent text-xs text-white text-center focus:outline-none px-1 placeholder-gray-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",onClick:c=>c.stopPropagation(),onMouseDown:c=>c.stopPropagation()}),n.jsxs("div",{className:"flex flex-col h-full border-l border-gray-600 w-4 flex-shrink-0",children:[n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-gray-700 text-gray-400 hover:text-white transition-colors",onClick:c=>{c.stopPropagation(),s(1)},children:n.jsx("svg",{width:"8",height:"4",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),n.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-gray-700 text-gray-400 hover:text-white transition-colors border-t border-gray-600",onClick:c=>{c.stopPropagation(),s(-1)},children:n.jsx("svg",{width:"8",height:"4",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})},MT=Et.memo(({index:e,frameNumber:t,sceneNumber:o,prompt:r,videoPrompt:a,shotType:i,characters:s,duration:l,isSelected:c,isCollapsed:d,onToggleCollapse:u,onSelect:p,onChange:h,onDelete:x,onAddAfter:k,onCopy:C,onCopyVideo:w,onMoveUp:f,onMoveDown:g,onMoveToSource:v,onMoveToStart:_,onMoveToEnd:S,isFirst:T,isLast:P,t:R,readOnly:D=!1,isChecked:q,onCheck:O,isModified:E,style:A,onRegenerate:N,isAnyGenerationInProgress:j,maxCharacters:L,onEditInSource:M,onEditPrompt:V,showVideoPrompts:H=!0,showSceneInfo:F=!0})=>{const G=y.useCallback((re,$)=>{if(D||$<1)return;const Z=(s||[])[re],te=`Entity-${$}`,ae=[...s||[]];ae[re]=te;const I=new RegExp(`\\(${Z}\\)`,"gi"),J=r.replace(I,`(${te})`);h(t,{characters:ae,prompt:J})},[D,s,r,h,t]),B=y.useCallback(re=>{if(D)return;const $=(s||[])[re],Z=(s||[]).filter((I,J)=>J!==re),te=new RegExp(`\\s*\\(${$}\\)`,"gi"),ae=r.replace(te,"").trim().replace(/,\s*$/,"");h(t,{characters:Z,prompt:ae})},[D,s,r,h,t]),Y=y.useCallback(()=>{if(D)return;const re=s||[],$=re.map(I=>parseInt(I.replace(/(?:character|entity)-/i,""),10)).filter(I=>!isNaN(I));let Z=1;for(;$.includes(Z);)Z++;const te=`Entity-${Z}`,ae=[...re,te];h(t,{characters:ae})},[D,s,h,t]),ee=re=>{if(D)return;const $=re,Z=W=>(W.match(/(?:character|entity)-\d+/gi)||[]).map(Q=>Q.toLowerCase()).sort().join(","),te=Z(r),ae=Z($),I=te!==ae,J={prompt:$};if(I){const W=$.match(/(?:character|entity)-\d+/gi)||[],U=[...new Set(W.map(Q=>Q.toLowerCase()))];J.characters=U}h(t,J)},ie=re=>{D||h(t,{videoPrompt:re})},pe=`FRAME-${String(t).padStart(3,"0")}${i?`, [${i}]`:""}`,ue=i?R(`image_sequence.shot_type.${i}`):void 0;return n.jsxs("div",{onClick:()=>p(t),style:{...A,height:d?`${K1}px`:H?ue?`${mu+30}px`:`${mu}px`:ue?`${gu+30}px`:`${gu}px`},className:`relative group bg-gray-700 p-2 rounded-lg border-2 overflow-hidden mb-1 ${c?"border-cyan-500 shadow-[0_0_15px_rgba(6,182,212,0.3)]":"border-transparent hover:border-gray-600"}`,children:[n.jsxs("div",{className:"flex justify-between items-center mb-1 h-[28px] gap-2",onDoubleClick:re=>{re.stopPropagation(),u(t)},children:[n.jsxs("div",{className:"flex items-center space-x-2 flex-1 overflow-hidden",children:[O&&n.jsx("div",{className:"flex-shrink-0",onClick:re=>re.stopPropagation(),title:"Select frame for batch modification",children:n.jsx(Zt,{checked:!!q,onChange:(re,$)=>O(t,$.shiftKey),className:"h-5 w-5"})}),n.jsx(Ne,{tooltipPosition:"right",title:R(d?"node.action.expand":"node.action.collapse"),onClick:re=>{re.stopPropagation(),u(t)},children:d?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7M19 5l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),n.jsx("h4",{className:"text-[10px] font-black text-gray-200 flex-shrink-0 whitespace-nowrap uppercase tracking-tighter",title:pe,children:pe}),n.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0 ml-1",children:[n.jsx("span",{className:"text-[10px] text-gray-500 font-semibold uppercase",children:"ENT:"}),(s||[]).map((re,$)=>{const Z=parseInt(re.replace(/(?:character|entity)-/i,""),10);return isNaN(Z)?null:n.jsxs("div",{className:"flex items-center bg-gray-600 rounded text-gray-200 border border-gray-500",children:[n.jsx("span",{className:"text-[10px] font-semibold px-1.5",children:Z}),n.jsxs("div",{className:"flex flex-col border-l border-gray-500",children:[n.jsx("button",{onClick:te=>{te.stopPropagation(),G($,Z+1)},className:"px-0.5 text-gray-300 hover:text-white text-[8px] middle-none disabled:text-gray-500 disabled:cursor-not-allowed",disabled:D,children:""}),n.jsx("button",{onClick:te=>{te.stopPropagation(),G($,Z-1)},className:"px-0.5 text-gray-300 hover:text-white text-[8px] border-t border-gray-600 disabled:text-gray-500 disabled:cursor-not-allowed",disabled:D||Z<=1,children:""})]}),n.jsx("button",{onClick:te=>{te.stopPropagation(),B($)},disabled:D,className:"px-1 text-red-300 hover:text-red-100 border-l border-gray-500 text-[10px] disabled:text-gray-500 disabled:cursor-not-allowed",children:""})]},$)}),n.jsx("button",{onClick:re=>{re.stopPropagation(),Y()},disabled:D,className:"flex items-center justify-center w-4 h-4 bg-gray-600 hover:bg-gray-500 rounded text-[10px] text-gray-300 disabled:bg-gray-700 disabled:cursor-not-allowed",children:"+"})]})]}),n.jsxs("div",{className:"flex items-center flex-shrink-0 space-x-1",children:[!d&&!D&&n.jsxs("div",{className:"flex items-center flex-shrink-0 mr-1",children:[n.jsx(qr,{value:l.toString(),onChange:re=>h(t,{duration:Math.max(0,parseInt(re,10)||0)}),min:0}),n.jsx("span",{className:"text-[9px] text-gray-400 ml-1",children:"s"})]}),v&&n.jsx(Ne,{tooltipPosition:"left",title:"Move to Source",onClick:re=>{re.stopPropagation(),v(t)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),!D&&n.jsxs("div",{className:"flex p-0.5",children:[_&&n.jsx(Ne,{tooltipPosition:"left",title:"Move to Start",onClick:re=>{re.stopPropagation(),_(e)},disabled:T,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),f&&n.jsx(Ne,{tooltipPosition:"left",title:"Move Up",onClick:re=>{re.stopPropagation(),f(e)},disabled:T,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),g&&n.jsx(Ne,{tooltipPosition:"left",title:"Move Down",onClick:re=>{re.stopPropagation(),g(e)},disabled:P,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),S&&n.jsx(Ne,{tooltipPosition:"left",title:"Move to End",onClick:re=>{re.stopPropagation(),S(e)},disabled:P,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})})]}),!D&&k&&n.jsx(Ne,{tooltipPosition:"left",title:"Add Frame After",onClick:re=>{re.stopPropagation(),k(t)},className:"p-1 rounded-md text-[#dad5cf] hover:bg-gray-600 hover:text-white transition-colors focus:outline-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),n.jsx(Ne,{tooltipPosition:"left",title:R("node.action.copyImagePrompt"),onClick:re=>{re.stopPropagation(),C(r)},children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Ne,{tooltipPosition:"left",title:R("node.action.copyVideoPrompt"),onClick:re=>{re.stopPropagation(),a&&w&&w(a)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})})}),!D&&x&&n.jsx(Ne,{tooltipPosition:"left",title:R("image_sequence.delete_frame"),onClick:re=>{re.stopPropagation(),x(t)},className:"p-1 rounded-md text-gray-500 hover:text-red-400 hover:bg-gray-600 transition-colors focus:outline-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),(!D&&V||D&&M)&&n.jsx(Ne,{title:R(D?"image_sequence.edit_in_source":"image_sequence.edit_prompt"),tooltipPosition:"left",onClick:re=>{re.stopPropagation(),D&&M?M(t):V&&V(t)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})})]})]}),!d&&n.jsxs("div",{className:"flex flex-col space-y-1 mt-1",children:[ue&&n.jsxs("div",{className:"px-2 py-1.5 bg-gray-800/80 rounded border border-gray-600/50 mb-1 text-[10px] text-gray-300 italic shadow-sm",children:[n.jsxs("span",{className:"font-bold text-cyan-400 not-italic mr-1",children:[i,":"]}),ue]}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase",children:"IMAGE PROMPT"}),n.jsx(hn,{value:r,onDebouncedChange:ee,readOnly:D,style:{height:H?"100px":"120px"},className:`w-full text-xs p-1 bg-gray-800 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-2 focus:ring-cyan-500 ${D?"cursor-default":"cursor-text"}`,onClick:re=>re.stopPropagation(),onMouseDown:re=>re.stopPropagation(),onWheel:re=>re.stopPropagation()})]}),H&&n.jsxs("div",{className:"flex flex-col mt-1 pt-1 border-t border-gray-600/30",children:[n.jsx("div",{className:"flex justify-between items-center mb-0.5",children:n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase",children:"VIDEO PROMPT"})}),n.jsx(hn,{value:a||"",onDebouncedChange:ie,readOnly:D,style:{height:"60px"},className:`w-full text-xs p-1 bg-gray-800 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-2 focus:ring-cyan-500 ${D?"cursor-default":"cursor-text"}`,onClick:re=>re.stopPropagation(),onMouseDown:re=>re.stopPropagation(),onWheel:re=>re.stopPropagation()})]})]})]})}),RT=(e,t,o,r=800,a=!0,i=!0,s={},l=[])=>{const c=y.useMemo(()=>{const x=[...e].sort((f,g)=>f.frameNumber-g.frameNumber),k=[];let C=-1,w=null;return x.forEach(f=>{const g=f.sceneNumber||1;if(g!==C){C=g;const v=f.sceneTitle||"";w={scene:g,title:v,prompts:[]},k.push(w)}w&&w.prompts.push(f)}),k},[e]),d=y.useMemo(()=>{const x=[];let k=0;return c.forEach(C=>{if(i&&(x.push({type:"scene_header",h:e0,top:k,data:C,scene:C.scene}),k+=e0),!i||!t.includes(C.scene)){const w=s[String(C.scene)]||"",f=l.includes(C.scene)?IT:jT;x.push({type:"scene_context",h:f+8,top:k,data:w,scene:C.scene}),k+=f+8,C.prompts.forEach(g=>{const _=(g.shotType?AT[g.shotType]:void 0)?30:0,S=(a?mu:gu)+_,T=(g.isCollapsed?K1:S)+8;x.push({type:"prompt",h:T,top:k,data:g,scene:C.scene}),k+=T})}}),{items:x,totalHeight:k}},[c,t,a,i,s,l]),u=y.useMemo(()=>{const k=Math.max(0,o-800),C=o+r+800;return d.items.filter(w=>w.top+w.h>k&&w.top<C)},[d,o,r]),p=x=>{const k=d.items.find(C=>C.type==="prompt"&&C.data.frameNumber===x);return k?k.top:null},h=x=>{if(!i)return null;const k=d.items.find(C=>C.type==="scene_header"&&C.scene===x);return k?k.top:null};return{groupedPrompts:c,virtualItems:d,visibleItems:u,totalHeight:d.totalHeight,getScrollPositionForFrame:p,getScrollPositionForScene:h}},LT=y.forwardRef(({prompts:e,collapsedScenes:t,checkedFrameNumbers:o,selectedFrameNumber:r,isLinked:a,onUpdatePrompts:i,onLoadFile:s,onSaveToCatalog:l,onSaveToDisk:c,t:d,onSelect:u,onToggleCollapse:p,onToggleScene:h,onDetachToEditor:x,onClearAll:k,onAddPrompt:C,onAddScene:w,onDeletePrompt:f,onMovePromptUp:g,onMovePromptDown:v,onMoveToStart:_,onMoveToEnd:S,onRegenerate:T,isAnyGenerationInProgress:P,onEditInSource:R,onEditPrompt:D,isGeneratingSequence:q,allConceptsLength:O,selectionKey:E="checkedSourceFrameNumbers",onUnlink:A,addToast:N,onClearTextOnly:j,sceneContexts:L={},onUpdateSceneContext:M,expandedSceneContexts:V=[],onToggleSceneContext:H},F)=>{const G=y.useRef(null),[B,Y]=y.useState(0),[ee,ie]=y.useState(800),[ce,pe]=y.useState(!1),[ue,re]=y.useState(""),[$,Z]=y.useState(""),[te,ae]=y.useState(""),[I,J]=y.useState(!0),[W,U]=y.useState(!0);y.useEffect(()=>{if(!G.current)return;const me=()=>{G.current&&requestAnimationFrame(()=>{G.current&&(ie(G.current.clientHeight),Y(G.current.scrollTop))})},ve=new ResizeObserver(me);return ve.observe(G.current),me(),()=>ve.disconnect()},[]);const{groupedPrompts:Q,totalHeight:de,visibleItems:se,getScrollPositionForFrame:X}=RT(e,t,B,ee,I,W,L,V);y.useImperativeHandle(F,()=>({scrollToFrame:me=>{const ve=X(me);ve!==null&&G.current&&G.current.scrollTo({top:Math.max(0,ve-100),behavior:"smooth"})},scrollToBottom:()=>{G.current&&G.current.scrollTo({top:G.current.scrollHeight,behavior:"smooth"})}}));const K=me=>{const ve=parseInt(me||ue,10);if(isNaN(ve))return;const Ie=e.find(be=>be.frameNumber===ve);if(!Ie)return;const ke=Ie.sceneNumber||1;let je=[...t];je.includes(ke)&&(je=je.filter(be=>be!==ke));const Ge=e.map(be=>be.frameNumber===ve?{...be,isCollapsed:!1}:be);i({prompts:Ge,sourcePrompts:Ge,collapsedScenes:je,collapsedSourceScenes:je,selectedFrameNumber:ve}),setTimeout(()=>{const be=X(ve);be!==null&&G.current&&G.current.scrollTo({top:be,behavior:"smooth"})},100)},oe=me=>{if(me.preventDefault(),me.stopPropagation(),pe(!1),a)return;const ve=me.dataTransfer.files[0];if(ve&&ve.type==="application/json"){const Ie=new FileReader;Ie.onload=ke=>{var je;if((je=ke.target)!=null&&je.result)try{const Ge=JSON.parse(ke.target.result);let be=Ge.finalPrompts||Ge.prompts||(Array.isArray(Ge)?Ge:[]),Pe=Ge.sceneContexts||{};be.length>0&&i({sourcePrompts:be,prompts:be,sceneContexts:Pe})}catch(Ge){console.error(Ge)}},Ie.readAsText(ve)}},ne=()=>{const me=parseInt($,10),ve=parseInt(te,10);if(isNaN(me)||isNaN(ve))return;const Ie=Math.max(1,me),ke=Math.min(e.length,ve);if(Ie>ke)return;const je=[];for(let Ge=Ie;Ge<=ke;Ge++)je.push(Ge);i({[E]:je})},le=()=>i({[E]:e.map(me=>me.frameNumber)}),ge=()=>i({[E]:[]}),we=()=>{const ve=e.map(Ie=>Ie.frameNumber).filter(Ie=>!o.includes(Ie));i({[E]:ve})},_e=Q.length>0&&Q.every(me=>t.includes(me.scene)),fe=()=>{const me=Q.map(Ie=>Ie.scene),ve=_e?[]:me;i({collapsedScenes:ve,collapsedSourceScenes:ve})},he=e.every(me=>me.isCollapsed),ye=()=>{const me=e.map(ve=>({...ve,isCollapsed:!he}));i({prompts:me,sourcePrompts:me})},Se=(me,ve)=>{if(a)return;const Ie=e.map(ke=>ke.frameNumber===me?{...ke,...ve}:ke);i({prompts:Ie,sourcePrompts:Ie})},Te=(me,ve)=>{if(ve){i({[E]:[me]});return}const Ie=o.includes(me)?o.filter(ke=>ke!==me):[...o,me];i({[E]:Ie})},Ae=me=>{navigator.clipboard.writeText(me),N&&N(d("toast.copiedToClipboard"))},Oe=()=>{j?j():k()};return n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-h-0",children:[n.jsxs("div",{className:"flex justify-between items-center flex-shrink-0 bg-gray-900/50 p-1 rounded-md border border-gray-700 h-9",onWheel:me=>me.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center space-x-1 h-full",children:[a&&n.jsx("button",{className:"text-cyan-400 hover:text-white transition-colors",title:"Linked to Upstream (Click to Unlink and Copy)",onClick:me=>{me.stopPropagation(),A&&A()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),!a&&e.length>0&&x&&n.jsx(Ne,{title:"Detach and Edit",onClick:x,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-400 hover:text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),n.jsx("h3",{className:"text-sm font-bold text-gray-300 px-1 whitespace-nowrap",children:d("image_sequence.prompts_list_title")||"Prompts"}),n.jsx("div",{className:"flex items-center",children:n.jsx(qr,{value:ue,placeholder:"#",onChange:me=>{re(me),K(me)},min:1,className:"w-12 border-none",title:"Go to Frame"})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsxs("div",{className:"flex items-center gap-1 bg-gray-800 rounded p-0.5 h-6",children:[n.jsx("span",{className:"text-[9px] text-gray-400 px-1 whitespace-nowrap",children:d("image_sequence.range_from")}),n.jsx(qr,{value:$,placeholder:"1",onChange:Z,min:1,className:"w-10 border-none"}),n.jsx("span",{className:"text-[9px] text-gray-400 px-1 whitespace-nowrap",children:d("image_sequence.range_to")}),n.jsx(qr,{value:te,placeholder:"N",onChange:ae,min:1,className:"w-10 border-none"}),n.jsx(Ne,{title:"Select range",onClick:me=>{me.stopPropagation(),ne()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-800 rounded p-0.5 h-6",children:[n.jsx(Ne,{title:d("image_sequence.select_all"),onClick:le,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600"}),n.jsx(Ne,{title:d("image_sequence.select_none"),onClick:ge,disabled:o.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600"}),n.jsx(Ne,{title:d("image_sequence.invert_selection"),onClick:we,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})})]})]}),n.jsxs("div",{className:"flex items-center space-x-1 h-full",children:[n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-900/50 rounded p-0.5",children:[n.jsx(Ne,{title:"Add Scene",onClick:w,disabled:a,children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m-3-3h6"})]})}),n.jsx(Ne,{title:d("image_sequence.add_frame"),onClick:()=>C(-1),disabled:a,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Ne,{title:I?" -":" -",onClick:()=>J(!I),children:I?n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})}),n.jsx(Ne,{title:W?" ":" ",onClick:()=>U(!W),children:W?n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Ne,{title:_e?"Expand Scenes":"Collapse Scenes",onClick:fe,children:_e?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})}),n.jsx(Ne,{title:he?"Expand Prompts":"Collapse Prompts",onClick:ye,disabled:_e,children:he?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),!a&&n.jsx(Ne,{title:d("image_sequence.clear_prompts_only"),onClick:Oe,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),n.jsx("div",{ref:G,className:`flex-grow min-h-0 bg-gray-900/50 p-2 rounded-md border-2 border-dashed transition-colors overflow-y-auto scrollbar-gutter-stable ${ce?"border-cyan-500 bg-gray-700/50":"border-transparent"} ${ce?"bg-cyan-900/20":""}`,onScroll:me=>Y(me.currentTarget.scrollTop),onDragOver:me=>{me.preventDefault(),me.stopPropagation(),pe(!0)},onDragLeave:()=>pe(!1),onDrop:oe,onWheel:me=>me.stopPropagation(),style:{overscrollBehaviorY:"contain"},children:e.length===0?n.jsx("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500 p-4 cursor-pointer",onClick:()=>!a&&C(-1),children:a?n.jsxs(n.Fragment,{children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-gray-400 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),n.jsx("p",{className:"font-semibold text-sm",children:"Linked to References"}),n.jsx("p",{className:"text-xs",children:"Waiting for data..."})]}):n.jsxs(n.Fragment,{children:[n.jsx("h4",{className:"font-semibold text-sm",children:d("image_sequence.drop_or_add_title")}),n.jsx("p",{className:"text-xs",children:d("image_sequence.drop_or_add_desc")})]})}):n.jsx("div",{style:{height:de,position:"relative"},children:se.map(me=>{if(me.type==="scene_header"){const ve=me.data,Ie=t.includes(ve.scene);return n.jsx("div",{style:{position:"absolute",top:me.top,left:0,right:0,height:me.h,paddingBottom:4},children:n.jsx("div",{className:"flex items-center justify-between bg-gray-800 p-1 rounded select-none cursor-pointer hover:bg-gray-700 transition-colors h-full",onClick:ke=>{ke.stopPropagation(),h(ve.scene)},children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"text-gray-400",children:Ie?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),n.jsxs("span",{className:"text-xs font-bold text-gray-300 uppercase tracking-wider bg-gray-800 px-2 py-1 rounded",children:[d("image_sequence.scene_input_label")," ",ve.scene,ve.title?`: ${ve.title}`:""]}),n.jsxs("span",{className:"text-[10px] text-gray-500",children:["(",ve.prompts.length," frames)"]})]})})},`header-${ve.scene}`)}else if(me.type==="scene_context"){const ve=me.data,Ie=me.scene,ke=V.includes(Ie);return n.jsx("div",{style:{position:"absolute",top:me.top,left:0,right:0,height:me.h},className:"pl-2 border-l-2 border-orange-500/50 ml-2 pb-2",children:n.jsxs("div",{className:"bg-gray-800/80 rounded border border-orange-500/30 p-2 h-full flex flex-col",children:[n.jsx("div",{className:"flex justify-between items-center cursor-pointer select-none",onClick:je=>{je.stopPropagation(),H&&H(Ie)},children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"text-orange-500",children:ke?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})}),n.jsx("label",{className:"text-[10px] font-bold text-orange-400 uppercase tracking-wider cursor-pointer",children:"SCENE CONTEXT"})]})}),ke&&n.jsx("div",{className:"flex-grow min-h-0 mt-2",children:n.jsx(hn,{value:ve,onDebouncedChange:je=>M&&M(Ie,je),readOnly:a,className:`w-full h-full text-xs p-1.5 bg-gray-900/50 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-1 focus:ring-orange-500 ${a?"cursor-default":"cursor-text"}`,placeholder:"Describe scene environment and context...",onMouseDown:je=>je.stopPropagation(),onWheel:je=>je.stopPropagation()})})]})},`context-${Ie}`)}else{const ve=me.data,Ie=e.findIndex(je=>je.frameNumber===ve.frameNumber),ke=r===ve.frameNumber;return n.jsx("div",{style:{position:"absolute",top:me.top,left:0,right:0,height:me.h},className:"pl-2 border-l-2 border-gray-700 ml-2",children:n.jsx(MT,{index:Ie,frameNumber:ve.frameNumber,sceneNumber:ve.sceneNumber,prompt:ve.prompt,videoPrompt:ve.videoPrompt,shotType:ve.shotType,characters:ve.characters,duration:ve.duration||0,isSelected:ke,isCollapsed:ve.isCollapsed??!1,onToggleCollapse:()=>p(ve.frameNumber),onSelect:()=>u(ve.frameNumber),onChange:Se,onCopy:je=>Ae(je),onCopyVideo:je=>Ae(je),t:d,readOnly:a,isChecked:o.includes(ve.frameNumber),onCheck:(je,Ge)=>Te(je,Ge),onDelete:()=>f(ve.frameNumber),onAddAfter:()=>C(ve.frameNumber),onMoveUp:()=>g(Ie),onMoveDown:()=>v(Ie),onMoveToStart:()=>_(Ie),onMoveToEnd:()=>S(Ie),isFirst:Ie===0,isLast:Ie===e.length-1,showVideoPrompts:I,onRegenerate:T,isAnyGenerationInProgress:P||q,onEditInSource:R,onEditPrompt:D,maxCharacters:O})},`prompt-${ve.frameNumber}`)}})})}),!a&&n.jsxs("div",{className:"flex-shrink-0 flex space-x-2",children:[n.jsx("div",{className:"flex-1 flex space-x-1",children:n.jsx("button",{onClick:s,className:"flex-1 px-3 py-2 text-sm font-semibold text-white bg-teal-600 hover:bg-teal-700 rounded-md",children:d("image_sequence.load_prompts")})}),n.jsx("button",{onClick:l,disabled:e.length===0,className:"flex-1 px-3 py-2 text-sm font-semibold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",title:d("catalog.saveTo"),children:d("catalog.saveTo")}),n.jsx(Ne,{title:d("group.saveToDisk"),onClick:c,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]})]})}),DT=({width:e,height:t})=>{const o=e/t;let r="",a="";return o>1.2?(r="M2 6h20v12H2z",a="Landscape"):o<.85?(r="M6 2h12v20H6z",a="Portrait"):(r="M4 4h16v16H4z",a="Square"),n.jsx("div",{className:"flex items-center justify-center w-6 h-6",title:a,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-white",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:r})})})},zT=Et.memo(({index:e,frameNumber:t,imageUrl:o,fullSizeImageUrl:r,status:a,isSelected:i,onSelect:s,onDoubleClick:l,onRegenerate:c,onDownload:d,onCopy:u,onCopyTextPrompt:p,onCopyVideo:h,onStop:x,isGeneratingSequence:k,isAnyGenerationInProgress:C,t:w,isChecked:f,onCheck:g,prompt:v,videoPrompt:_,onOpenRaster:S,onOpenAI:T,onReplaceImage:P,onEditPrompt:R,readOnlyPrompt:D,onEditInSource:q,characterIndices:O,onExpandFrame:E,shotType:A,onReportDimensions:N})=>{const j={idle:"bg-gray-800",pending:"bg-gray-700/50",prompt_processing:"bg-yellow-800/50 animate-pulse",generating:"bg-blue-800/50 animate-pulse",done:"bg-gray-800",error:"bg-red-800/50"},L={idle:"",pending:w("image_sequence.status.pending")||"Queued",prompt_processing:"Processing...",generating:"Generating...",done:"",error:w("image_sequence.status.error")},[M,V]=y.useState(!1),[H,F]=y.useState(null),G=y.useCallback(te=>{te.stopPropagation(),s(t)},[t,s]),B=y.useCallback(te=>{te.stopPropagation(),(r||o)&&S(t,r||o)},[t,r,o,S]),Y=y.useCallback(te=>{te.stopPropagation(),(r||o)&&T(r||o)},[r,o,T]),ee=te=>{a==="generating"||a==="prompt_processing"||(te.preventDefault(),te.stopPropagation(),V(!0))},ie=te=>{a==="generating"||a==="prompt_processing"||(te.preventDefault(),te.stopPropagation(),V(!0))},ce=te=>{a==="generating"||a==="prompt_processing"||(te.preventDefault(),te.stopPropagation(),V(!1))},pe=y.useCallback(te=>{if(a==="generating"||a==="prompt_processing")return;te.preventDefault(),te.stopPropagation(),V(!1);const ae=te.dataTransfer.getData("application/prompt-modifier-drag-image");if(ae){ae.startsWith("data:")?P(t,ae):fetch(ae).then(J=>J.blob()).then(J=>{const W=new FileReader;W.onload=U=>{var Q;(Q=U.target)!=null&&Q.result&&P(t,U.target.result)},W.readAsDataURL(J)});return}const I=te.dataTransfer.files;if(I&&I.length>0){const J=I[0];if(J.type.startsWith("image/")){const W=new FileReader;W.onload=U=>{var Q;(Q=U.target)!=null&&Q.result&&P(t,U.target.result)},W.readAsDataURL(J)}}},[t,P,a]),ue=te=>{const ae=te.currentTarget,I=ae.naturalWidth,J=ae.naturalHeight;F({width:I,height:J}),N&&N(t,I,J)},re="p-1 rounded-md text-[#dad5cf] hover:bg-gray-600 hover:text-white transition-colors focus:outline-none pointer-events-auto disabled:cursor-not-allowed disabled:opacity-50",$=a==="prompt_processing"||a==="generating",Z=!!o;return n.jsxs("div",{onClick:G,onDragEnter:ee,onDragOver:ie,onDragLeave:ce,onDrop:pe,className:`relative group border-2 transition-colors h-full w-full ${M?"border-cyan-400 bg-gray-700/50":i?"border-cyan-400":"border-transparent"} ${j[a]}`,children:[n.jsx("div",{className:"absolute top-1 left-1 z-20 pointer-events-auto",title:"Select frame for batch generation",children:n.jsx(Zt,{checked:!!f,onChange:(te,ae)=>g(t,ae.shiftKey)})}),n.jsxs("div",{className:"w-full h-full overflow-hidden rounded-lg pointer-events-none relative",children:[Z&&n.jsx("img",{src:o,className:`w-full h-full object-cover cursor-pointer ${$?"opacity-50 blur-[2px]":""}`,alt:`Frame ${t}`,style:{pointerEvents:"auto"},draggable:!0,onLoad:ue,onMouseDown:te=>te.stopPropagation(),onClick:te=>{te.stopPropagation(),l(t)},onDragStart:te=>{te.dataTransfer.setData("application/prompt-modifier-drag-image",r||o||""),te.dataTransfer.effectAllowed="copy",te.stopPropagation()}}),(a==="pending"||$||a==="error"||a==="idle"&&!Z)&&n.jsxs("div",{className:`absolute inset-0 flex flex-col items-center justify-center p-2 text-center z-10 ${Z?"bg-black/40":""}`,children:[a!=="pending"&&a!=="idle"&&n.jsx("span",{className:"text-white font-semibold text-sm drop-shadow-md",children:L[a]}),a==="pending"&&!Z&&n.jsx("span",{className:"text-white font-semibold text-sm drop-shadow-md",children:L[a]}),$&&n.jsxs(n.Fragment,{children:[n.jsxs("svg",{className:"animate-spin h-6 w-6 text-cyan-400 mt-2 drop-shadow-md",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n.jsx("div",{className:"flex space-x-2 mt-2 pointer-events-auto",children:n.jsx("button",{onClick:te=>{te.stopPropagation(),x(t)},className:"px-2 py-1 text-xs bg-red-600 hover:bg-red-700 rounded-md text-white font-semibold shadow-md",children:w("image_sequence.stop_queue")})})]})]})]}),!o&&a==="idle"&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:n.jsx("span",{className:"text-gray-600 text-xs",children:M?"Drop Image":""})}),!$&&a!=="pending"&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute inset-x-0 top-0 h-12 bg-gradient-to-b from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10"}),n.jsxs("div",{className:"absolute top-1 right-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity z-30 pointer-events-auto",children:[h&&_&&n.jsx(Ne,{title:w("node.action.copyVideoPrompt"),tooltipPosition:"bottom",tooltipAlign:"start",onClick:te=>{te.stopPropagation(),h(_)},className:re,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),n.jsx(Ne,{title:w("node.action.copyImagePrompt"),tooltipPosition:"bottom",tooltipAlign:"center",onClick:te=>{te.stopPropagation(),p(v)},className:re,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),o&&n.jsx(Ne,{title:w("node.action.copyImage"),tooltipPosition:"bottom",tooltipAlign:"center",onClick:te=>{te.stopPropagation(),u(t)},className:re,children:n.jsx(Dt,{className:"h-4 w-4"})}),o&&n.jsx(Ne,{title:w("node.action.download"),tooltipPosition:"bottom",tooltipAlign:"center",onClick:te=>{te.stopPropagation(),d(t,v)},className:re,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Ne,{title:w("image_sequence.regenerate"),tooltipPosition:"bottom",tooltipAlign:"end",onClick:te=>{te.stopPropagation(),c(t)},disabled:C,className:re,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})}),(!D&&R||D&&q)&&n.jsx(Ne,{title:w(D?"image_sequence.edit_in_source":"image_sequence.edit_prompt"),tooltipPosition:"bottom",tooltipAlign:"end",onClick:te=>{te.stopPropagation(),D&&q?q(t):R&&R(t)},className:re,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})})]}),o&&n.jsxs("div",{className:"absolute bottom-1 left-1 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity z-30 pointer-events-auto",children:[n.jsx(Ne,{title:w("node.action.rasterEditor"),tooltipPosition:"top",tooltipAlign:"start",onClick:B,className:"p-1 bg-emerald-600/80 rounded text-white hover:bg-emerald-700",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})}),n.jsx(Ne,{title:w("node.action.openInAIEditor"),tooltipPosition:"top",tooltipAlign:"start",onClick:Y,className:"p-1 bg-cyan-600/80 rounded text-white hover:bg-cyan-700",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})}),n.jsx(Ne,{title:"Expand to 16:9",tooltipPosition:"top",tooltipAlign:"start",disabled:C,onClick:te=>{te.stopPropagation(),E&&E(t,"16:9")},className:`p-1 rounded text-white transition-colors ${C?"bg-gray-700/50 cursor-not-allowed opacity-50":"bg-gray-700/80 hover:bg-cyan-600"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("rect",{x:"2",y:"8",width:"20",height:"8",rx:"1"})})}),n.jsx(Ne,{title:"Expand to 9:16",tooltipPosition:"top",tooltipAlign:"start",disabled:C,onClick:te=>{te.stopPropagation(),E&&E(t,"9:16")},className:`p-1 rounded text-white transition-colors ${C?"bg-gray-700/50 cursor-not-allowed opacity-50":"bg-gray-700/80 hover:bg-cyan-600"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",stroke:"currentColor",fill:"currentColor",children:n.jsx("rect",{x:"8",y:"2",width:"8",height:"20",rx:"1"})})})]}),O&&O.length>0&&n.jsx("div",{className:"absolute bottom-8 right-1 flex flex-col items-end space-y-0.5 z-10 pointer-events-none opacity-75 group-hover:opacity-100 transition-opacity",children:O.map((te,ae)=>n.jsxs("div",{className:"bg-black/60 text-white text-[9px] font-bold px-1 rounded backdrop-blur-sm",children:["ENT-",te]},ae))}),n.jsxs("div",{className:"absolute bottom-1 right-1 flex items-center space-x-1 z-10 pointer-events-none opacity-75",children:[n.jsxs("div",{className:"text-[10px] font-bold text-white bg-black/60 px-1.5 py-0.5 rounded-l-md h-6 flex items-center justify-center min-w-[20px]",children:[t,A?` [${A}]`:""]}),n.jsx("div",{className:"bg-black/60 h-6 flex items-center justify-center px-1 rounded-r-md",children:H?n.jsx(DT,{width:H.width,height:H.height}):n.jsx("span",{className:"text-[9px] text-gray-300 font-mono",children:"N/A"})})]})]})]})}),qT=({prompts:e,images:t,frameStatuses:o,selectedFrameNumber:r,checkedFrameNumbers:a,collapsedOutputScenes:i,isGeneratingSequence:s,isAnyFrameGenerating:l,t:c,onUpdateState:d,groupedPrompts:u,onRegenerate:p,onDownload:h,onCopy:x,onCopyPrompt:k,onCopyVideoPrompt:C,onStopFrame:w,onFrameSelect:f,onFrameDoubleClick:g,onCheckFrame:v,onOpenRaster:_,onOpenAI:S,onReplaceImage:T,onEditPrompt:P,onEditInSource:R,readOnlyPrompt:D,getFullSizeImage:q,onSelectByAspectRatio:O,onSelectSceneByAspectRatio:E,onSelectAll:A,onSelectNone:N,onInvertSelection:j,onRunSelected:L,onDownloadSelected:M,onForceRefresh:V,onExpandFrame:H,onExpandSelected:F,onReportDimensions:G,onClearImages:B})=>{const Y=y.useRef(null),[ee,ie]=y.useState(0),[ce,pe]=y.useState(800),[ue,re]=y.useState(600),[$,Z]=y.useState(""),[te,ae]=y.useState(""),[I,J]=y.useState(""),W=Object.keys(t).length,U=Object.values(o).filter(fe=>fe==="pending"||fe==="generating").length,Q=e.length;y.useEffect(()=>{if(!Y.current)return;const fe=()=>{Y.current&&requestAnimationFrame(()=>{Y.current&&(pe(Y.current.clientWidth),re(Y.current.clientHeight))})},he=new ResizeObserver(fe);return he.observe(Y.current),fe(),()=>he.disconnect()},[]);const de=y.useMemo(()=>{const fe=Math.max(0,ce-20),he=Math.floor(fe/(PT+t0))||1,ye=[];let Se=0;return u.forEach(Te=>{if(ye.push({type:"scene_header",h:40,top:Se,data:Te,scene:Te.scene}),Se+=40,!i.includes(Te.scene)){const Ae=Math.ceil(Te.prompts.length/he),Oe=Ae>0?Ae*TT+Math.max(0,Ae-1)*t0+24:0;ye.push({type:"scene_grid",h:Math.max(0,Oe),top:Se,data:Te,scene:Te.scene}),Se+=Math.max(0,Oe)}}),{items:ye,totalHeight:Se}},[u,i,ce]),se=()=>{const he=Math.max(0,ee-800),ye=ee+ue+800;return de.items.filter(Se=>Se.top+Se.h>he&&Se.top<ye)},X=()=>{const fe=$===""?1:parseInt($,10),he=te===""?Q:parseInt(te,10);if(isNaN(fe)||isNaN(he))return;const ye=Math.max(1,fe),Se=Math.min(Q,he);if(ye>Se)return;const Te=[];for(let Ae=ye;Ae<=Se;Ae++)Te.push(Ae);d({checkedFrameNumbers:Te})},K=fe=>{setTimeout(()=>{const he=u.findIndex(ye=>ye.scene===fe);if(he!==-1&&Y.current){const ye=he*40;Y.current.scrollTo({top:ye,behavior:"smooth"})}},50)},oe=fe=>{const he=fe!==void 0?fe:I===""?1:parseInt(I,10);if(isNaN(he))return;const ye=u.find(Oe=>Oe.scene===he);if(!ye)return;const Se=ye.prompts.map(Oe=>Oe.frameNumber),Ae=u.map(Oe=>Oe.scene).filter(Oe=>Oe!==he);d({checkedFrameNumbers:Se,collapsedOutputScenes:Ae}),fe!==void 0&&J(fe.toString()),K(he)},ne=()=>{const fe=parseInt(I,10)||1,he=u.map(Se=>Se.scene).sort((Se,Te)=>Se-Te),ye=he.indexOf(fe);ye!==-1&&ye<he.length-1?oe(he[ye+1]):ye===-1&&he.length>0&&oe(he[0])},le=()=>{const fe=parseInt(I,10)||1,he=u.map(Se=>Se.scene).sort((Se,Te)=>Se-Te),ye=he.indexOf(fe);ye>0?oe(he[ye-1]):ye===-1&&he.length>0&&oe(he[he.length-1])},ge=u.length>0&&u.every(fe=>i.includes(fe.scene)),we=()=>{const fe=u.map(ye=>ye.scene);d({collapsedOutputScenes:ge?[]:fe})},_e=()=>{B?B():d({sequenceOutputs:[]})};return n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-h-0 pl-1",children:[n.jsxs("div",{className:"flex justify-between items-center flex-shrink-0 bg-gray-900/50 p-1 rounded-md border border-gray-700 mb-1",children:[n.jsxs("div",{className:"flex items-center space-x-3 px-1",children:[n.jsx("h3",{className:"text-sm font-bold text-gray-300 flex-shrink-0",children:c("image_sequence.output_images_title")}),n.jsxs("div",{className:"text-[10px] text-gray-400 flex space-x-2 border-l border-gray-600 pl-3",children:[n.jsx("span",{children:c("image_sequence.stats.total",{count:Q})}),n.jsx("span",{className:W>0?"text-cyan-400":"",children:c("image_sequence.stats.generated",{count:W})}),U>0&&n.jsx("span",{className:"text-cyan-400 animate-pulse",children:c("image_sequence.stats.queue",{count:U})})]})]}),n.jsx(Ne,{title:c("image_sequence.force_refresh"),onClick:V,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),n.jsxs("div",{className:"flex items-center justify-between gap-2 bg-gray-900/50 p-1 rounded-md border border-gray-700 mb-1",children:[n.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0",children:[n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-800 rounded border border-gray-600 px-1 py-0.5",children:[n.jsx("span",{className:"text-[10px] text-gray-400 pr-1 whitespace-nowrap",children:c("image_sequence.range_from")}),n.jsx(qr,{value:$,placeholder:"1",onChange:Z,min:1,className:"w-12 border-none"}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx("span",{className:"text-[10px] text-gray-400 pr-1 whitespace-nowrap",children:c("image_sequence.range_to")}),n.jsx(qr,{value:te,placeholder:"Last",onChange:ae,min:1,className:"w-12 border-none"}),n.jsx(Ne,{title:c("image_sequence.select_range"),onClick:fe=>{fe.stopPropagation(),X()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-800 rounded border border-gray-600 px-1 py-0.5",children:[n.jsx("span",{className:"text-[10px] text-gray-400 px-1 whitespace-nowrap",children:c("image_sequence.scene_input_label")}),n.jsx(qr,{value:I,placeholder:"1",onChange:J,min:1,className:"w-14 border-none"}),n.jsx(Ne,{title:c("image_sequence.select_scene"),onClick:fe=>{fe.stopPropagation(),oe()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white transition-colors",onClick:fe=>{fe.stopPropagation(),le()},title:c("image_sequence.prev_scene"),children:n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:n.jsx("path",{d:"M15 18l-6-6 6-6"})})}),n.jsx("button",{className:"p-0.5 text-gray-400 hover:text-white transition-colors",onClick:fe=>{fe.stopPropagation(),ne()},title:c("image_sequence.next_scene"),children:n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:n.jsx("path",{d:"M9 18l6-6-6-6"})})})]})]}),n.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0 ml-auto",children:[n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-800 rounded p-0.5",children:[n.jsx(Ne,{title:c("image_sequence.select_square"),onClick:()=>O("square"),disabled:W===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"1"})})}),n.jsx(Ne,{title:c("image_sequence.select_landscape"),onClick:()=>O("landscape"),disabled:W===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"2",y:"7",width:"20",height:"10",rx:"1"})})}),n.jsx(Ne,{title:c("image_sequence.select_portrait"),onClick:()=>O("portrait"),disabled:W===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"7",y:"2",width:"10",height:"20",rx:"1"})})})]}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Ne,{title:c("image_sequence.select_all"),onClick:A,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${e.length===0?"text-gray-600":"text-green-400"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(Ne,{title:c("image_sequence.select_none"),onClick:N,disabled:a.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${a.length===0?"text-gray-600":"text-red-400"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(Ne,{title:c("image_sequence.invert_selection"),onClick:j,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${e.length===0?"text-gray-600":"text-gray-300"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Ne,{title:c("image_sequence.run_selected"),onClick:L,disabled:s||l||a.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${s||l||a.length===0?"text-gray-600":"text-emerald-400"}`,viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),n.jsx(Ne,{title:`${c("image_sequence.download_selected")} (${a.length})`,onClick:M,disabled:a.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${a.length===0?"text-gray-600":"text-sky-400"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Ne,{title:c("node.action.clear"),onClick:_e,disabled:Object.keys(t).length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${Object.keys(t).length===0?"text-gray-600":"text-gray-300 hover:text-white"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),n.jsx(Ne,{title:ge?"  ":"  ",onClick:we,children:ge?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})})]}),n.jsx("div",{ref:Y,onScroll:fe=>ie(fe.currentTarget.scrollTop),className:"flex-grow bg-gray-900/50 rounded-md p-2 overflow-y-auto custom-scrollbar overflow-x-hidden scrollbar-gutter-stable",onWheel:fe=>fe.stopPropagation(),style:{overscrollBehaviorY:"contain"},children:n.jsx("div",{style:{height:de.totalHeight,position:"relative"},children:se().map(fe=>{var ye,Se;const he=fe.data;if(fe.type==="scene_header"){const Te=i.includes(he.scene),Ae=(ye=he.prompts[0])==null?void 0:ye.frameNumber,Oe=(Se=he.prompts[he.prompts.length-1])==null?void 0:Se.frameNumber,me=Ae!==void 0&&Oe!==void 0?`(${Ae}-${Oe})`:"";return n.jsx("div",{style:{position:"absolute",top:fe.top,left:0,right:0,height:fe.h,paddingBottom:4},children:n.jsxs("div",{className:"flex items-center justify-between mb-2 pb-1 border-b border-gray-700 cursor-pointer hover:bg-gray-800/50 rounded transition-colors p-1 h-full",onClick:()=>{const ve=i.includes(he.scene)?i.filter(Ie=>Ie!==he.scene):[...i,he.scene];d({collapsedOutputScenes:ve})},children:[n.jsxs("div",{className:"flex items-center gap-2 overflow-hidden flex-grow mr-2",children:[n.jsx("div",{className:"text-gray-400 flex-shrink-0",children:Te?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),n.jsxs("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider bg-gray-800 px-2 py-1 rounded truncate",title:`${c("image_sequence.scene_input_label")} ${he.scene}${he.title?`: ${he.title}`:""}`,children:[c("image_sequence.scene_input_label")," ",he.scene,he.title?`: ${he.title}`:""]})]}),n.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[n.jsx("span",{className:"text-[10px] text-gray-500 font-medium whitespace-nowrap",children:Te?c("image_sequence.frames_hidden",{count:he.prompts.length}):c("image_sequence.frames_count",{count:he.prompts.length})}),n.jsx("span",{className:"text-[10px] text-gray-500 font-mono whitespace-nowrap",children:me}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(Ne,{title:c("image_sequence.select_square"),onClick:ve=>{ve.stopPropagation(),E(he.scene,"square")},disabled:!1,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"1"})})}),n.jsx(Ne,{title:c("image_sequence.select_landscape"),onClick:ve=>{ve.stopPropagation(),E(he.scene,"landscape")},disabled:!1,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"2",y:"7",width:"20",height:"10",rx:"1"})})}),n.jsx(Ne,{title:c("image_sequence.select_portrait"),onClick:ve=>{ve.stopPropagation(),E(he.scene,"portrait")},disabled:!1,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"7",y:"2",width:"10",height:"20",rx:"1"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Ne,{title:"Focus Scene (Collapse others)",tooltipPosition:"left",onClick:ve=>{ve.stopPropagation(),oe(he.scene)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-500 hover:text-cyan-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Ne,{title:c("image_sequence.deselect_scene"),tooltipPosition:"left",onClick:ve=>{ve.stopPropagation();const Ie=he.prompts.map(je=>je.frameNumber),ke=a.filter(je=>!Ie.includes(je));d({checkedFrameNumbers:ke})},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400 group-hover:text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Ne,{title:c("image_sequence.select_scene_frames"),tooltipPosition:"left",onClick:ve=>{ve.stopPropagation();const Ie=he.prompts.map(je=>je.frameNumber),ke=Array.from(new Set([...a,...Ie]));d({checkedFrameNumbers:ke})},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400 group-hover:text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]})]})]})},`grid-header-${he.scene}`)}else{const Te=fe.data;return n.jsx("div",{style:{position:"absolute",top:fe.top,left:0,right:0,height:fe.h},children:n.jsx("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-4 pl-2",children:Te.prompts.map(Ae=>{const Oe=[];Ae.characters&&Array.isArray(Ae.characters)&&Ae.characters.forEach(ke=>{const je=ke.match(/(?:character|entity)-(\d+)/i);je&&Oe.push(je[1])});const me=t[Ae.frameNumber],ve=q(1e3+Ae.frameNumber),Ie=me||ve;return n.jsx("div",{className:"w-full h-[200px]",children:n.jsx(zT,{index:Ae.frameNumber,frameNumber:Ae.frameNumber,imageUrl:Ie,fullSizeImageUrl:ve||Ie,status:o[Ae.frameNumber]||"idle",isSelected:r===Ae.frameNumber,onSelect:f,onDoubleClick:g,onRegenerate:p,onDownload:(ke,je)=>h(ke,je),onCopy:x,onCopyTextPrompt:k,onCopyVideo:C,onStop:w,isGeneratingSequence:!!s,isAnyGenerationInProgress:!!s||l,t:c,isChecked:a.includes(Ae.frameNumber),onCheck:v,prompt:Ae.prompt,videoPrompt:Ae.videoPrompt,onOpenRaster:_,onOpenAI:S,onReplaceImage:T,onEditPrompt:P,readOnlyPrompt:D,onEditInSource:R,characterIndices:Oe,onExpandFrame:H,shotType:Ae.shotType,onReportDimensions:G})},Ae.frameNumber)})})},`grid-content-${Te.scene}`)}})})})]})},OT=({model:e,autoCrop169:t,autoDownload:o,createZip:r,isGeneratingSequence:a,isAnyFrameGenerating:i,checkedCount:s,promptsLength:l,onUpdateState:c,onGenerateSelected:d,onDownloadSelected:u,onStartQueue:p,onExpandSelected:h,t:x})=>{const k=[{value:"gemini-2.5-flash-image",label:"Gemini 2.5 Flash Image"},{value:"imagen-4.0-generate-001",label:"Imagen 4.0"}];return n.jsxs("div",{className:"flex-shrink-0 space-y-2 mt-2",children:[n.jsxs("div",{className:"mb-2",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:x("node.content.generationMode")}),n.jsx(Mn,{value:e,onChange:C=>c({model:C}),disabled:a,options:k})]}),n.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-2",children:[n.jsx(Zt,{id:"auto-crop-169",checked:!!t,onChange:C=>c({autoCrop169:C}),label:"- 16:9",title:x("image_sequence.tooltip.autoCrop")}),n.jsx(Zt,{id:"auto-download",checked:o,onChange:C=>c({autoDownload:C}),label:x("node.content.autoDownload"),title:x("image_sequence.tooltip.autoDownload")}),n.jsx(Zt,{id:"create-zip",checked:!!r,onChange:C=>c({createZip:C}),label:" Zip ",title:x("image_sequence.tooltip.createZip")})]}),n.jsxs("div",{className:"flex space-x-2 mb-2",children:[n.jsxs("button",{onClick:d,disabled:a||i||s===0,className:"flex-1 py-2 text-sm font-semibold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",children:[x("image_sequence.run_selected")," (",s,")"]}),n.jsxs("button",{onClick:()=>h("16:9"),disabled:a||i||s===0,className:"flex-shrink-0 w-20 py-2 text-xs font-bold text-white bg-cyan-600 hover:bg-cyan-700 rounded-md disabled:bg-gray-700 disabled:text-gray-500 transition-colors flex items-center justify-center gap-2",title:"Expand Selected to 16:9",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"2",y:"8",width:"20",height:"8",rx:"1"})}),"16:9"]}),n.jsxs("button",{onClick:()=>h("9:16"),disabled:a||i||s===0,className:"flex-shrink-0 w-20 py-2 text-xs font-bold text-white bg-cyan-600 hover:bg-cyan-700 rounded-md disabled:bg-gray-700 disabled:text-gray-500 transition-colors flex items-center justify-center gap-2",title:"Expand Selected to 9:16",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"currentColor",viewBox:"0 0 24 24",children:n.jsx("rect",{x:"8",y:"2",width:"8",height:"20",rx:"1"})}),"9:16"]}),n.jsx("button",{onClick:u,disabled:s===0,className:"flex-1 py-2 text-sm font-semibold text-white bg-sky-600 rounded-md hover:bg-sky-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",children:r?"Download ZIP":`${x("image_sequence.download_selected")} (${s})`})]}),n.jsx("div",{children:n.jsx("button",{onClick:p,disabled:a||i||l===0,className:`w-full py-2 rounded-md font-semibold transition-colors ${a||i?"bg-gray-600 text-gray-300 cursor-not-allowed":"bg-cyan-600 hover:bg-cyan-700 text-white"}`,children:x(a||i?"node.content.generating":"image_sequence.start_queue")})})]})},Ro=640,n0=660,FT=390,BT=37,GT=({node:e,onValueChange:t,onLoadImageSequenceFile:o,onGenerateImageSequence:r,onGenerateSelectedFrames:a,onStopImageSequence:i,isGeneratingSequence:s,onRegenerateFrame:l,onDownloadImageFromUrl:c,onCopyImageToClipboard:d,t:u,deselectAllNodes:p,connectedCharacterData:h,onDetachAndPasteConcept:x,onDetachImageToNode:k,onSaveSequenceToCatalog:C,setError:w,setImageViewer:f,getFullSizeImage:g,setFullSizeImage:v,connectedInputs:_,onRefreshUpstreamData:S,clearImagesForNodeFromCache:T,getUpstreamNodeValues:P,addToast:R,onSaveScriptToDisk:D,viewTransform:q})=>{const O=_==null?void 0:_.has("prompt_input"),E=Ut(),{nodes:A,onAddNode:N,connections:j,handleNavigateToNodeFrame:L,setConnections:M,setSelectedNodeIds:V}=E||{};y.useRef(null);const H=y.useRef(null),F=y.useRef(null),G=y.useRef(null),B=y.useRef(null),[Y,ee]=y.useState(!1),[ie,ce]=y.useState(null),pe=y.useRef(null),[ue,re]=y.useState(null),[$,Z]=y.useState(!1),te=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{prompts:[],images:{},currentIndex:-1,isGenerating:!1,autoDownload:!1,selectedFrameNumber:null,frameStatuses:{},aspectRatio:"16:9",characterConcepts:[],model:"gemini-2.5-flash-image",characterPromptCombination:"replace",enableAspectRatio:!1,checkedFrameNumbers:[],styleOverride:"",isStyleSelected:!1,isStyleCollapsed:!0,isStyleInserted:!0,isSceneContextInserted:!0,isUsedCharsCollapsed:!0,isIntegrationSettingsCollapsed:!0,isCharacterPromptCombinationCollapsed:!0,integrationPrompt:"",usedCharacters:[],conceptsMode:"normal",connectedCharacterConfig:{},collapsedScenes:[],collapsedOutputScenes:[],autoCrop169:!0,leftPaneWidth:Ro,createZip:!1,imageDimensions:{},sceneContexts:{},expandedSceneContexts:[]}}},[e.value]),ae=y.useRef(te);y.useEffect(()=>{ae.current=te},[te]);let I=te.leftPaneWidth;!I&&te.leftPaneRatio?I=Math.max(Ro,(e.width||1200)*te.leftPaneRatio):I||(I=Ro);const{prompts:J=[],images:W={},selectedFrameNumber:U=null,frameStatuses:Q={},aspectRatio:de="16:9",autoDownload:se=!1,characterConcepts:X=[],model:K="gemini-2.5-flash-image",characterPromptCombination:oe="replace",enableAspectRatio:ne=!1,checkedFrameNumbers:le=[],styleOverride:ge="",isStyleCollapsed:we=!0,isStyleInserted:_e=!0,isSceneContextInserted:fe=!0,isUsedCharsCollapsed:he=!0,isIntegrationSettingsCollapsed:ye=!0,isCharacterPromptCombinationCollapsed:Se=!0,integrationPrompt:Te="",usedCharacters:Ae=[],conceptsMode:Oe="normal",collapsedScenes:me=[],collapsedOutputScenes:ve=[],autoCrop169:Ie=!0,leftPaneWidth:ke=Ro,createZip:je=!1,imageDimensions:Ge={},sceneContexts:be={},expandedSceneContexts:Pe=[]}=te,Ee=y.useMemo(()=>[...Ae].map((Ce,ze)=>({...Ce,originalIndex:ze})).sort((Ce,ze)=>{const De=We=>parseInt((We||"0").replace(/[^0-9]/g,""),10);return De(Ce.index)-De(ze.index)}),[Ae]),Me=y.useMemo(()=>Object.values(Q).some(Ce=>Ce==="pending"||Ce==="generating"),[Q]),Fe=!!s||Me,tt=y.useMemo(()=>Oe==="collapsed"?BT:Oe==="expanded"?"100%":FT,[Oe]);y.useMemo(()=>[...J].sort((Ce,ze)=>Ce.frameNumber-ze.frameNumber),[J]);const Nt=y.useMemo(()=>{const Ce=[...J].sort((nt,Je)=>nt.frameNumber-Je.frameNumber),ze=[];let De=-1,We=null;return Ce.forEach(nt=>{const Je=nt.sceneNumber||1;if(Je!==De){De=Je;const ut=nt.sceneTitle||"";We={scene:Je,title:ut,prompts:[]},ze.push(We)}We&&We.prompts.push(nt)}),ze},[J]),xe=y.useCallback(Ce=>{const De={...ae.current,...Ce};ae.current=De,t(e.id,JSON.stringify(De))},[e.id,t]);y.useEffect(()=>{if(!e.width)return;const Ce=e.width-n0;ke>Ce?xe({leftPaneWidth:Math.max(Ro,Ce)}):ke<Ro&&xe({leftPaneWidth:Ro})},[e.width,ke,xe]);const Be=h||[],Le=y.useMemo(()=>[...Be].sort((Ce,ze)=>{const De=parseInt((Ce.alias||"0").replace(/[^0-9]/g,""),10),We=parseInt((ze.alias||"0").replace(/[^0-9]/g,""),10);return De-We}),[Be]),Ue=Le.length,Ze=y.useMemo(()=>{const Ce=Le.map((De,We)=>{var nt;return{...De,id:De.index||De.alias||De.name||`upstream-stable-${We}`,index:De.index||De.alias,image:De.image||((nt=De.imageSources)==null?void 0:nt["1:1"])||null,isConnected:!0,uniqueKey:`upstream-${De.index||We}`,_connectionId:De._connectionId,_sourceNodeId:De._sourceNodeId}}),ze=X.map(De=>({...De,index:De.id,isConnected:!1,uniqueKey:`local-${De.id}`}));return[...Ce,...ze]},[Le,X]),at=y.useMemo(()=>{let Ce=!1,ze=0;const De=Je=>(Je||"").toLowerCase().trim(),We=Ee.map(Je=>{const ut=De(Je.name),st=De(Je.index);if(!ut&&!st)return{status:"empty"};const Gt=Ze.find(Ot=>De(Ot.index||Ot.id||Ot.alias)===st),At=Ze.find(Ot=>De(Ot.name)===ut);if(Gt&&At&&Gt===At)return ze++,{status:"match"};if(Gt){const Ot=Gt.name;if(De(Ot)!==ut)return Ce=!0,{status:"mismatch_name",expectedName:Ot,conceptIndex:Gt.index||Gt.id}}if(At){const Ot=At.index||At.id||At.alias;if(De(Ot)!==st)return Ce=!0,{status:"mismatch_index",expectedIndex:Ot,conceptName:At.name}}return{status:"missing"}}),nt=Ee.length>0&&ze===Ee.length&&!Ce;return{results:We,hasError:Ce,allValid:nt}},[Ee,Ze]),ot=y.useMemo(()=>{const Ce={},ze=new Set;return Ze.forEach(De=>{const We=(De.id||"").trim();We&&(Ce[We]=(Ce[We]||0)+1)}),Object.keys(Ce).forEach(De=>{Ce[De]>1&&ze.add(De)}),ze},[Ze]),rt=Ce=>{let ze=0;return Le.forEach(De=>{const We=parseInt((De.index||De.alias||"0").replace(/[^0-9]/g,""),10);isNaN(We)||(ze=Math.max(ze,We))}),ze===0&&Ue>0&&(ze=Ue),Ce.map((De,We)=>{const nt=ze+We+1;return{...De,id:`Entity-${nt}`,name:`Entity-${nt}`}})},et=y.useCallback((Ce,ze,De,We)=>{if(De)return;const nt=Ce-Ue;if(nt>=0&&nt<X.length){const Je=[...X];Je[nt]={...Je[nt],...ze},xe({characterConcepts:Je})}},[X,Ue,xe]),mt=y.useCallback(Ce=>{const ze=Ce-Ue;if(ze>=0){const De=X.filter((nt,Je)=>Je!==ze),We=rt(De);xe({characterConcepts:We})}},[X,Ue,xe,rt]),xt=y.useCallback(()=>{const Ce={id:"",name:"",prompt:"",image:null},ze=[...X,Ce],De=rt(ze);xe({characterConcepts:De})},[X,xe,rt]),Ct=y.useCallback(()=>{xe({characterConcepts:[]}),M&&M(Ce=>Ce.filter(ze=>!(ze.toNodeId===e.id&&ze.toHandleId==="character_data"))),S&&S(e.id),R&&R(u("toast.contentCleared"),"info")},[xe,S,e.id,R,u,M]),pt=y.useCallback(Ce=>{if(Ce._sourceNodeId&&M&&A&&j){const ze=A.find(De=>De.id===Ce._sourceNodeId);if(j.filter(De=>De.toNodeId===e.id&&De.toHandleId==="character_data"),ze&&ze.type===z.CHARACTER_CARD){let De=[];try{De=JSON.parse(ze.value||"[]")}catch{}Array.isArray(De)||(De=[De]);let We=0;X.forEach(Je=>{const ut=(Je.id||"").match(/(?:Character|Entity)-(\d+)/i);ut&&(We=Math.max(We,parseInt(ut[1],10)))});const nt=De.map((Je,ut)=>{var st;return{id:`Entity-${We+ut+1}`,name:Je.name||`Entity ${We+ut+1}`,prompt:Je.prompt||"",image:((st=Je.thumbnails)==null?void 0:st["1:1"])||Je.image||null,fullDescription:Je.fullDescription||""}});xe({characterConcepts:[...X,...nt]}),M(Je=>Je.filter(ut=>!(ut.toNodeId===e.id&&ut.toHandleId==="character_data"))),R&&R(u("toast.pastedFromClipboard"),"success");return}}x&&x(e.id,Ce)},[A,j,M,X,xe,x,e.id,R,u]),dt=y.useCallback((Ce,ze)=>{const De=Ce-Ue;if(De<0)return;const We=[...X],nt=ze==="up"?De-1:De+1;if(nt>=0&&nt<We.length){[We[De],We[nt]]=[We[nt],We[De]];const Je=rt(We);xe({characterConcepts:Je})}},[X,Ue,xe,rt]),kt=y.useCallback(Ce=>{xe({conceptsMode:Ce})},[xe]),St=y.useCallback(()=>{if(J.length===0||!N)return;const ze={x:e.position.x-1350,y:e.position.y},De=N(z.PROMPT_SEQUENCE_EDITOR,ze);t(De,JSON.stringify({instruction:"",sourcePrompts:J,modifiedPrompts:[],checkedSourceFrameNumbers:[],selectedFrameNumber:null,styleOverride:ge,usedCharacters:Ae,leftPaneRatio:.5})),V&&V([De]),R&&R("Prompts detached to Prompt Sequence Editor (Left)","success")},[J,N,e,ge,Ae,t,R,V]),Tt=y.useCallback(()=>{xe({prompts:[],images:{},frameStatuses:{}}),R&&R("All prompts cleared","info")},[xe,R]),_t=y.useCallback(()=>{xe({images:{}}),T(e.id),R&&R(u("toast.contentCleared"))},[xe,T,e.id,R,u]),It=y.useCallback(()=>{const ze=[...ae.current.prompts||[]].map(De=>({...De,prompt:"",videoPrompt:"",shotType:"WS"}));xe({prompts:ze}),R&&R("Text prompts cleared","info")},[xe,R]),Io=y.useCallback(Ce=>{const ze=[...ae.current.prompts||[]],De=ze.length>0?Math.max(...ze.map(Je=>Je.frameNumber))+1:1,We=ze.length>0?ze[ze.length-1].sceneNumber:1,nt={frameNumber:De,sceneNumber:We,sceneTitle:"",prompt:"",videoPrompt:"",shotType:"WS",characters:[],duration:3,isCollapsed:!0};if(Ce!==void 0&&Ce!==-1){const Je=ze.findIndex(ut=>ut.frameNumber===Ce);if(Je!==-1){ze.splice(Je+1,0,nt);const ut=ze.map((st,Gt)=>({...st,frameNumber:Gt+1}));xe({prompts:ut});return}}xe({prompts:[...ze,nt]}),setTimeout(()=>{var Je;return(Je=F.current)==null?void 0:Je.scrollToBottom()},100)},[xe]),jo=y.useCallback(()=>{const Ce=[...ae.current.prompts||[]],De=(Ce.length>0?Math.max(...Ce.map(Je=>Je.sceneNumber||1)):0)+1,nt={frameNumber:Ce.length>0?Math.max(...Ce.map(Je=>Je.frameNumber))+1:1,sceneNumber:De,sceneTitle:`Scene ${De}`,prompt:"",videoPrompt:"",shotType:"WS",characters:[],duration:3,isCollapsed:!1};xe({prompts:[...Ce,nt]}),setTimeout(()=>{var Je;return(Je=F.current)==null?void 0:Je.scrollToBottom()},100)},[xe]),qt=y.useCallback(Ce=>{if(!O||!L)return;const ze=j==null?void 0:j.find(De=>De.toNodeId===e.id&&De.toHandleId==="prompt_input");ze&&L(ze.fromNodeId,Ce)},[O,L,j,e.id]),Re=y.useCallback(Ce=>{const ze=ae.current.prompts||[],De=ae.current.collapsedScenes||[],We=ze.find(st=>st.frameNumber===Ce);if(!We)return;const nt=We.sceneNumber||1;let Je=[...De];Je.includes(nt)&&(Je=Je.filter(st=>st!==nt));let ut=ze;We.isCollapsed&&(ut=ze.map(st=>st.frameNumber===Ce?{...st,isCollapsed:!1}:st)),xe({collapsedScenes:Je,prompts:ut,selectedFrameNumber:Ce}),F.current&&setTimeout(()=>{F.current.scrollToFrame(Ce)},50)},[xe]),qe=y.useCallback(()=>{M&&e.id&&(M(Ce=>Ce.filter(ze=>!(ze.toNodeId===e.id&&ze.toHandleId==="prompt_input"))),R&&R("Unlinked from source. Data copied to local.","info"))},[M,e.id,R]),He=y.useCallback(Ce=>{if(g(e.id,1e3+Ce)||W[Ce]){const We=J.filter(ut=>g(e.id,1e3+ut.frameNumber)||W[ut.frameNumber]),nt=We.map(ut=>({src:g(e.id,1e3+ut.frameNumber)||W[ut.frameNumber],frameNumber:ut.frameNumber,prompt:ut.prompt})),Je=We.findIndex(ut=>ut.frameNumber===Ce);Je!==-1&&f({sources:nt,initialIndex:Je})}},[W,J,f,g,e.id]),$e=y.useCallback(Ce=>{if(!N)return;let ze=null;if(B.current){const De=A==null?void 0:A.find(We=>We.id===B.current);De&&De.type===z.IMAGE_EDITOR?ze=De.id:B.current=null}if(ze){const De=A==null?void 0:A.find(We=>We.id===ze);if(De){const We=JSON.parse(De.value||"{}"),nt=We.inputImages||[];Lt(Ce,256,256).then(Je=>{const ut=[...nt,Je];t(ze,JSON.stringify({...We,inputImages:ut})),v(ze,nt.length+1,Ce)})}}else{const De={x:e.position.x+e.width+100,y:e.position.y};ze=N(z.IMAGE_EDITOR,De),B.current=ze,t(ze,JSON.stringify({inputImages:[Ce],prompt:"",aspectRatio:de,enableAspectRatio:!0,model:"gemini-2.5-flash-image"})),v(ze,1,Ce),Lt(Ce,256,256).then(We=>{t(ze,JSON.stringify({inputImages:[We],prompt:"",aspectRatio:de,enableAspectRatio:!0,model:"gemini-2.5-flash-image"}))})}ze&&V&&V([ze])},[N,e,A,t,v,V,de]),Qe=y.useCallback(Ce=>{const ze=ae.current.imageDimensions||{},De=J.filter(We=>{const nt=ze[We.frameNumber];if(!nt)return!1;const Je=nt.width/nt.height;return Ce==="landscape"?Je>1.2:Ce==="portrait"?Je<.85:Ce==="square"?Je>=.85&&Je<=1.2:!1}).map(We=>We.frameNumber);De.length===0?R&&R("No images match this aspect ratio","info"):xe({checkedFrameNumbers:De})},[J,xe,R]),Xe=y.useCallback((Ce,ze)=>{const De=ae.current.imageDimensions||{},nt=J.filter(Je=>(Je.sceneNumber||1)===Ce).filter(Je=>{const ut=De[Je.frameNumber];if(!ut)return!1;const st=ut.width/ut.height;return ze==="landscape"?st>1.2:ze==="portrait"?st<.85:ze==="square"?st>=.85&&st<=1.2:!1}).map(Je=>Je.frameNumber);nt.length===0?R&&R(`No ${ze} images found in Scene ${Ce}`,"info"):xe({checkedFrameNumbers:nt})},[J,xe,R]),Ke=y.useCallback(async()=>{var De,We;const Ce=[...le].sort((nt,Je)=>nt-Je);if(Ce.length===0)return;const ze=sessionStorage.getItem("download_permission_shown");if(!je&&Ce.length>1&&!ze&&Z(!0),je){re(0);try{const nt=Li.default||Li,Je=new nt,ut=new Date,st=ut.toISOString().split("T")[0],Gt=ut.toTimeString().split(" ")[0].replace(/:/g,"-");let At=0;for(const an of Ce){const Xo=g(e.id,1e3+an)||W[an];if(Xo&&Xo.startsWith("data:image")){const Va=String(an).padStart(3,"0"),lc=((De=Xo.match(/image\/(png|jpeg|jpg)/))==null?void 0:De[1])||"png",cc=await(await fetch(Xo)).blob();Je.file(`Frame_${Va}_seq_gen_${st}_${Gt}.${lc}`,cc),At++}}if(At===0){R&&R("No valid images found to ZIP","error"),re(null);return}const Ot=await Je.generateAsync({type:"blob",compression:"STORE"},an=>{re(an.percent)}),Cn=document.createElement("a");Cn.href=URL.createObjectURL(Ot),Cn.download=`Image_Sequence_${st}_${Gt}.zip`,document.body.appendChild(Cn),Cn.click(),document.body.removeChild(Cn),URL.revokeObjectURL(Cn.href),R&&R("ZIP archive downloaded","success")}catch(nt){console.error("ZIP Error:",nt),R&&R("Failed to create ZIP","error")}finally{re(null)}}else{const nt=new Date,Je=nt.toISOString().split("T")[0],ut=nt.toTimeString().split(" ")[0].replace(/:/g,"-");for(const st of Ce){const Gt=g(e.id,1e3+st)||W[st];if(Gt){const At=((We=J.find(an=>an.frameNumber===st))==null?void 0:We.prompt)||"",Cn=`Frame_${String(st).padStart(3,"0")}_seq_gen_${Je}_${ut}.png`;c(Gt,st,At,Cn),R&&R(u("toast.downloadStarted"),"success"),await new Promise(an=>setTimeout(an,300))}}}},[le,je,g,e.id,W,J,c,R,u]),ft=y.useCallback(()=>{const Ce={...Q};Object.keys(Ce).forEach(ze=>{Ce[Number(ze)]!=="done"&&(Ce[Number(ze)]="idle")}),xe({frameStatuses:Ce}),S&&S(e.id)},[Q,xe,S,e.id]),yt=y.useCallback(async(Ce,ze)=>{var nt;const De=g(e.id,1e3+Ce)||W[Ce];if(!De)return;const We=((nt=J.find(Je=>Je.frameNumber===Ce))==null?void 0:nt.prompt)||"";try{const Je={...ae.current.frameStatuses};Je[Ce]="generating",xe({frameStatuses:Je});const ut=await Ap(De,ze,We),st=await Lt(ut,128,128);v(e.id,1e3+Ce,ut);const Gt={...ae.current.images,[Ce]:st},At={...ae.current.frameStatuses,[Ce]:"done"};xe({images:Gt,frameStatuses:At})}catch(Je){R&&R(`Expansion failed: ${Je.message}`,"error");const ut={...ae.current.frameStatuses,[Ce]:"error"};xe({frameStatuses:ut})}},[g,e.id,W,J,xe,R,v]),ht=y.useCallback(async Ce=>{const ze=[...le].sort((De,We)=>De-We);if(ze.length!==0)for(const De of ze)await yt(De,Ce)},[le,yt]),wt=y.useCallback(Ce=>{Ce.preventDefault(),Ce.stopPropagation();const ze=(q==null?void 0:q.scale)||1;G.current={startX:Ce.clientX,startWidth:ae.current.leftPaneWidth||Ro};const De=nt=>{const Je=G.current;if(!Je)return;const ut=(nt.clientX-Je.startX)/ze,st=Je.startWidth+ut,Gt=e.width-n0,At=Math.max(Ro,Math.min(st,Gt));xe({leftPaneWidth:At})},We=()=>{G.current=null,window.removeEventListener("mousemove",De),window.removeEventListener("mouseup",We)};window.addEventListener("mousemove",De),window.addEventListener("mouseup",We)},[xe,q,e.width]),jt=y.useCallback(()=>{if(!P)return null;const Ce=P(e.id,"prompt_input");if(!Ce||Ce.length===0)return null;const ze=new Map;let De=ge,We=Ae,nt=be,Je=1;return Ce.forEach(ut=>{if(typeof ut=="string")try{const st=JSON.parse(ut);let Gt=[];if(st.type==="script-prompt-modifier-data"){if(Gt=st.finalPrompts||st.prompts||[],st.styleOverride&&(De=st.styleOverride),st.usedCharacters&&(We=st.usedCharacters),st.sceneContexts&&(nt=st.sceneContexts),st.videoPrompts){const At=new Map(st.videoPrompts.map(Ot=>[Ot.frameNumber,Ot]));Gt=Gt.map(Ot=>({...Ot,videoPrompt:Ot.videoPrompt||At.get(Ot.frameNumber)||""}))}}else if(st.sourcePrompts||st.modifiedPrompts){const At=st.sourcePrompts||[],Ot=st.modifiedPrompts||[],Cn=new Map;At.forEach(an=>Cn.set(an.frameNumber,an)),Ot.forEach(an=>Cn.set(an.frameNumber,{...Cn.get(an.frameNumber),...an})),Gt=Array.from(Cn.values()),st.styleOverride&&(De=st.styleOverride),st.usedCharacters&&(We=st.usedCharacters),st.sceneContexts&&(nt=st.sceneContexts)}else Array.isArray(st)&&(Gt=st);Gt.length>0&&Gt.forEach(At=>{const Ot=At.frameNumber!==void 0?At.frameNumber:Je++,an=(ae.current.prompts||[]).find(Va=>Va.frameNumber===Ot),Xo=an?an.isCollapsed:!0;ze.set(Ot,{frameNumber:Ot,sceneNumber:At.sceneNumber||1,sceneTitle:At.sceneTitle||"",prompt:At.prompt||"",videoPrompt:At.videoPrompt||"",shotType:At.shotType||At.ShotType||"WS",characters:At.characters||[],duration:At.duration||3,isCollapsed:Xo})})}catch{}}),ze.size>0?{prompts:Array.from(ze.values()).sort((ut,st)=>ut.frameNumber-st.frameNumber),styleOverride:De,usedCharacters:We,sceneContexts:nt}:null},[P,e.id,ge,Ae,be]);y.useEffect(()=>{if(O&&!s){const Ce=jt();if(Ce){const ze=JSON.stringify(ae.current.prompts),De=JSON.stringify(Ce.prompts),We=ae.current.styleOverride,nt=JSON.stringify(ae.current.usedCharacters),Je=JSON.stringify(Ce.usedCharacters),ut=JSON.stringify(ae.current.sceneContexts),st=JSON.stringify(Ce.sceneContexts);(ze!==De||We!==Ce.styleOverride||nt!==Je||ut!==st)&&xe(Ce)}}},[O,jt,xe,s]);const Nr=Ce=>{const ze=pe.current;ze!==null&&(v(e.id,1e3+ze,Ce),Lt(Ce,128,128).then(De=>xe({images:{...W,[ze]:De}})))},Yl=(Ce,ze)=>{const De=Ee[Ce].originalIndex,We=[...Ae];We[De]&&(We[De]={...We[De],name:ze},xe({usedCharacters:We}))},Xl=()=>xe({isUsedCharsCollapsed:!he}),Zl=()=>xe({isStyleCollapsed:!we}),Ql=Ce=>xe({isStyleInserted:Ce}),ec=Ce=>xe({isSceneContextInserted:Ce}),tc=()=>xe({isIntegrationSettingsCollapsed:!ye}),nc=()=>xe({isCharacterPromptCombinationCollapsed:!Se}),oc=y.useCallback(Ce=>{navigator.clipboard.writeText(Ce),R&&R(u("toast.copiedToClipboard"),"info")},[R,u]),rc=y.useCallback(Ce=>{navigator.clipboard.writeText(Ce),R&&R(u("toast.copiedToClipboard"),"info")},[R,u]),ac=y.useCallback((Ce,ze,De)=>{var nt,Je;const We=ae.current.imageDimensions||{};((nt=We[Ce])==null?void 0:nt.width)===ze&&((Je=We[Ce])==null?void 0:Je.height)===De||xe({imageDimensions:{...We,[Ce]:{width:ze,height:De}}})},[xe]),ic=(Ce,ze)=>{const De={...be,[Ce]:ze};xe({sceneContexts:De})},sc=Ce=>{const ze=Pe||[],De=ze.includes(Ce)?ze.filter(We=>We!==Ce):[...ze,Ce];xe({expandedSceneContexts:De})};return n.jsxs("div",{className:"flex h-full w-full space-x-2",onWheel:Ce=>Ce.stopPropagation(),children:[n.jsx(Jl,{isOpen:Y,onClose:()=>{ee(!1),pe.current=null},onApply:Nr,imageSrc:ie}),n.jsxs("div",{ref:H,className:"h-full flex flex-col flex-shrink-0",style:{width:`${ke}px`},children:[n.jsx("div",{className:"flex-shrink-0 flex flex-col transition-all duration-300 ease-in-out relative z-10",style:{height:typeof tt=="string"?tt:`${tt}px`},children:n.jsx(ET,{allConcepts:Ze,characterConcepts:X,conceptSortOrder:[],onUpdateConcept:et,onDeleteConcept:mt,onMoveConcept:dt,onAddConcept:xt,onDetachConnectedConcept:Ce=>pt(Ce),onClearConcepts:Ct,handleViewImage:Ce=>f({sources:[{src:Ce,frameNumber:0}],initialIndex:0}),t:u,deselectAllNodes:p,conceptsMode:Oe,onToggleMode:kt,duplicateIndices:ot})}),Oe!=="expanded"&&n.jsxs("div",{className:"flex-grow flex flex-col min-h-0 pt-2",children:[n.jsxs("div",{className:"flex flex-col space-y-1 mb-1 flex-shrink-0",children:[n.jsxs("div",{className:`flex justify-between items-center cursor-pointer hover:bg-gray-700/50 rounded-md px-1 transition-colors group ${at.hasError?"bg-red-900/30":at.allValid?"bg-cyan-900/30":""}`,onClick:Xl,children:[n.jsxs("label",{className:`text-[10px] font-bold uppercase cursor-pointer py-1 flex-grow flex items-center gap-2 ${at.hasError?"text-red-400":at.allValid?"text-cyan-400":"text-gray-400"}`,children:[at.hasError?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}):at.allValid?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):null," ",at.allValid&&n.jsx("span",{className:"text-[9px] font-normal opacity-70 ml-1",children:"( )"})]}),n.jsx("div",{className:"text-gray-500 group-hover:text-gray-300 p-1",children:he?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!he&&n.jsx("div",{onWheel:Ce=>Ce.stopPropagation(),className:"bg-gray-700/50 p-2 rounded-md border border-gray-600 max-h-32 overflow-y-auto custom-scrollbar",children:Ee.length>0?Ee.map((Ce,ze)=>{const De=at.results[ze]||{status:"missing"};let We=null,nt="text-gray-400",Je="";return De.status==="match"?(We=n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-green-500",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),nt="text-green-400",Je="   "):De.status==="mismatch_name"?(We=n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),nt="text-red-400",Je=`  (${Ce.index}),   . : "${De.expectedName}"`):De.status==="mismatch_index"?(We=n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),nt="text-red-400",Je=`  ("${Ce.name}"),   .   : ${De.expectedIndex}`):(We=n.jsx("span",{className:"text-gray-600 text-[10px]",children:""}),Je="    "),n.jsxs("div",{className:"flex items-center gap-2 mb-1 last:mb-0 group/item",title:Je,children:[n.jsx("div",{className:"w-4 flex-shrink-0 flex items-center justify-center",children:We}),n.jsxs("span",{className:`text-[10px] font-mono w-20 shrink-0 truncate ${nt}`,children:[Ce.index,":"]}),n.jsx("input",{type:"text",value:Ce.name,onChange:ut=>Yl(ze,ut.target.value),className:`flex-grow bg-gray-800 border-none rounded px-1.5 py-0.5 text-[10px] outline-none focus:ring-1 focus:ring-cyan-500 ${De.status.startsWith("mismatch")?"text-red-200 bg-red-900/20":"text-gray-200"}`,onMouseDown:ut=>ut.stopPropagation()})]},ze)}):n.jsx("div",{className:"text-[10px] text-gray-500 italic",children:"  ."})})]}),n.jsxs("div",{className:"flex flex-col space-y-1 mb-2 flex-shrink-0",children:[n.jsxs("div",{className:"flex justify-between items-center cursor-pointer hover:bg-gray-700/50 rounded-md px-1 transition-colors group",onClick:tc,children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase cursor-pointer py-1 flex-grow",children:" "}),n.jsx("div",{className:"text-gray-500 group-hover:text-gray-300 p-1",children:ye?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!ye&&n.jsx(hn,{value:Te,onDebouncedChange:Ce=>xe({integrationPrompt:Ce}),placeholder:"Integrate these Entities into the scene...",className:"w-full p-2 bg-gray-700 border-none rounded-md resize-none focus:outline-none text-xs",style:{minHeight:"60px"},onMouseDown:Ce=>Ce.stopPropagation(),onWheel:Ce=>Ce.stopPropagation()})]}),n.jsx("div",{onWheel:Ce=>Ce.stopPropagation(),className:"flex-shrink-0 flex flex-col space-y-2 mb-2",children:n.jsxs("div",{className:"flex flex-col space-y-1",children:[n.jsxs("div",{className:"flex justify-between items-center cursor-pointer hover:bg-gray-700/50 rounded-md px-1 transition-colors group",onClick:nc,children:[n.jsxs("label",{className:"text-[10px] font-bold text-gray-400 uppercase cursor-pointer py-1 flex-grow",children:[u("image_sequence.character_prompt_combination"),oe!=="none"&&n.jsxs("span",{className:"text-cyan-400 font-normal ml-1 normal-case",children:["(",u(oe==="combine"?"image_sequence.combination_combine":"image_sequence.combination_replace"),")"]})]}),n.jsx("div",{className:"text-gray-500 group-hover:text-gray-300 p-1",children:Se?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!Se&&n.jsxs("div",{className:"flex items-center space-x-4 bg-gray-800/50 p-2 rounded-md border border-gray-700",children:[n.jsx(Zt,{checked:oe==="combine",onChange:Ce=>xe({characterPromptCombination:Ce?"combine":"none"}),label:u("image_sequence.combination_combine"),title:"     ."}),n.jsx(Zt,{checked:oe==="replace",onChange:Ce=>xe({characterPromptCombination:Ce?"replace":"none"}),label:u("image_sequence.combination_replace"),title:"  (. Character-1)     ."})]})]})}),n.jsxs("div",{className:"flex flex-col space-y-1 mb-2 flex-shrink-0",children:[n.jsxs("div",{className:"flex justify-between items-center cursor-pointer hover:bg-gray-700/50 rounded-md px-1 transition-colors group",onClick:Zl,children:[n.jsxs("div",{className:"flex items-center gap-2 flex-grow",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase cursor-pointer py-1",children:u("node.content.style")}),n.jsx("div",{onClick:Ce=>Ce.stopPropagation(),children:n.jsx(Zt,{checked:_e,onChange:Ql,title:"      .",label:" "})}),n.jsx("div",{onClick:Ce=>Ce.stopPropagation(),className:"ml-2",children:n.jsx(Zt,{checked:fe,onChange:ec,title:"         .",label:u("node.content.insertSceneContext")})})]}),n.jsx("div",{className:"text-gray-500 group-hover:text-gray-300 p-1",children:we?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!we&&n.jsx(hn,{value:ge,onDebouncedChange:Ce=>xe({styleOverride:Ce}),className:"w-full p-2 bg-gray-700 border-none rounded-md resize-none focus:outline-none text-xs",style:{minHeight:"60px"},onMouseDown:Ce=>Ce.stopPropagation(),onWheel:Ce=>Ce.stopPropagation()})]}),n.jsx("div",{className:"w-full h-0.5 bg-gray-600/80 my-3 flex-shrink-0"}),n.jsx(LT,{ref:F,prompts:J,collapsedScenes:me,checkedFrameNumbers:le,selectionKey:"checkedFrameNumbers",selectedFrameNumber:U,isLinked:!!O,onUpdatePrompts:xe,onLoadFile:()=>o(e.id),onSaveToCatalog:()=>C(e.id),onSaveToDisk:()=>D(e.id),t:u,onSelect:Ce=>xe({selectedFrameNumber:Ce}),onToggleCollapse:Ce=>{const ze=J.map(De=>De.frameNumber===Ce?{...De,isCollapsed:!De.isCollapsed}:De);xe({prompts:ze})},onToggleScene:Ce=>{const ze=me.includes(Ce)?me.filter(De=>De!==Ce):[...me,Ce];xe({collapsedScenes:ze})},onDetachToEditor:St,onClearAll:Tt,onAddPrompt:Io,onAddScene:jo,onDeletePrompt:Ce=>{const ze=J.filter(De=>De.frameNumber!==Ce);xe({prompts:ze})},onMovePromptUp:()=>{},onMovePromptDown:()=>{},onMoveToStart:()=>{},onMoveToEnd:()=>{},onRegenerate:Ce=>l(e.id,Ce),isAnyGenerationInProgress:Fe,onEditInSource:qt,onEditPrompt:Re,isGeneratingSequence:!!s,allConceptsLength:Ze.length,onUnlink:qe,addToast:R,onClearTextOnly:It,sceneContexts:be,onUpdateSceneContext:ic,expandedSceneContexts:Pe,onToggleSceneContext:sc})]})]}),n.jsx("div",{onMouseDown:wt,className:"w-2 h-full bg-gray-700/50 hover:bg-cyan-600 cursor-col-resize rounded transition-colors flex-shrink-0"}),n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-w-0",style:{width:"0",flexGrow:1,position:"relative"},children:[ue!==null&&n.jsxs("div",{className:"absolute inset-0 z-50 bg-gray-900/90 backdrop-blur-sm flex flex-col items-center justify-center rounded-md",children:[n.jsx("div",{className:"text-cyan-400 font-bold text-lg mb-4 animate-pulse",children:"Archiving Sequence..."}),n.jsx("div",{className:"w-64 h-4 bg-gray-700 rounded-full overflow-hidden border border-gray-600 shadow-inner",children:n.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-600 to-blue-500 transition-all duration-100 ease-out relative",style:{width:`${ue}%`},children:n.jsx("div",{className:"absolute inset-0 bg-white/20 animate-[progress-bar-stripes_1s_linear_infinite]",style:{backgroundImage:"linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent)",backgroundSize:"1rem 1rem"}})})}),n.jsxs("div",{className:"text-gray-300 font-mono mt-2",children:[ue.toFixed(0),"%"]})]}),$&&Ba.createPortal(n.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 backdrop-blur-sm flex flex-col items-center justify-start pt-20 text-center animate-fade-in",onClick:Ce=>Ce.stopPropagation(),children:n.jsxs("div",{className:"bg-gray-800 p-6 rounded-xl border border-cyan-500 shadow-2xl max-w-md mx-4 relative",children:[n.jsx("div",{className:"absolute -top-12 right-4 md:right-1/4 animate-bounce text-cyan-400",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 10l7-7m0 0l7 7m-7-7v18"})})}),n.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:" "}),n.jsxs("p",{className:"text-gray-300 mb-6 text-sm leading-relaxed",children:["    .",n.jsx("br",{}),",             ",n.jsx("b",{children:'" "'})," (Allow automatic downloads)."]}),n.jsx("button",{onClick:()=>{Z(!1),sessionStorage.setItem("download_permission_shown","true")},className:"w-full py-2 bg-cyan-600 hover:bg-cyan-700 text-white font-bold rounded transition-colors",children:""})]})}),document.body),n.jsx(qT,{prompts:J,images:W,frameStatuses:Q,selectedFrameNumber:U,checkedFrameNumbers:le,collapsedOutputScenes:ve,isGeneratingSequence:!!s,isAnyFrameGenerating:Me,t:u,onUpdateState:Ce=>{Ce.sequenceOutputs&&Ce.sequenceOutputs.length===0?_t():xe(Ce)},groupedPrompts:Nt,onRegenerate:Ce=>l(e.id,Ce),onDownload:(Ce,ze)=>{const De=g(e.id,1e3+Ce)||W[Ce];if(De){const We=new Date,nt=We.toISOString().split("T")[0],Je=We.toTimeString().split(" ")[0].replace(/:/g,"-"),st=`Frame_${String(Ce).padStart(3,"0")}_seq_gen_${nt}_${Je}.png`;c(De,Ce,ze,st),R&&R(u("toast.downloadStarted"),"success")}},onCopy:Ce=>d(g(e.id,1e3+Ce)||W[Ce]),onCopyPrompt:oc,onCopyVideoPrompt:rc,onStopFrame:Ce=>i(),onFrameSelect:Ce=>xe({selectedFrameNumber:Ce}),onFrameDoubleClick:He,onCheckFrame:(Ce,ze)=>{if(ze)xe({checkedFrameNumbers:[Ce]});else{const De=ae.current.checkedFrameNumbers||[],We=De.includes(Ce)?De.filter(nt=>nt!==Ce):[...De,Ce];xe({checkedFrameNumbers:We})}},onOpenRaster:(Ce,ze)=>{ce(ze),pe.current=Ce,ee(!0)},onOpenAI:$e,onReplaceImage:(Ce,ze)=>{v(e.id,1e3+Ce,ze),xe({images:{...W,[Ce]:ze}})},onEditPrompt:Re,onEditInSource:qt,readOnlyPrompt:!!O,getFullSizeImage:Ce=>g(e.id,Ce),onSelectByAspectRatio:Qe,onSelectSceneByAspectRatio:Xe,onSelectAll:()=>xe({checkedFrameNumbers:J.map(Ce=>Ce.frameNumber)}),onSelectNone:()=>xe({checkedFrameNumbers:[]}),onInvertSelection:()=>{const Ce=ae.current.checkedFrameNumbers||[],De=J.map(We=>We.frameNumber).filter(We=>!Ce.includes(We));xe({checkedFrameNumbers:De})},onRunSelected:()=>a(e.id),onDownloadSelected:Ke,onForceRefresh:ft,onExpandFrame:yt,onExpandSelected:ht,onReportDimensions:ac,onClearImages:_t}),n.jsx(OT,{model:K,autoCrop169:Ie,autoDownload:se,createZip:je,isGeneratingSequence:!!s,isAnyFrameGenerating:Me,checkedCount:le.length,promptsLength:J.length,onUpdateState:xe,onGenerateSelected:()=>a(e.id),onDownloadSelected:Ke,onStartQueue:()=>r(e.id,0),onExpandSelected:ht,t:u})]})]})},HT=({instruction:e,onInstructionChange:t,targetLanguage:o,onLanguageChange:r,modificationModel:a,onModelChange:i,includeVideoPrompts:s,onToggleVideoPrompts:l,isModifying:c,onModify:d,checkedCount:u,totalPrompts:p,instructionInputId:h,t:x})=>{const{secondaryLanguage:k}=vt();return n.jsxs("div",{className:"flex-shrink-0 space-y-2",children:[n.jsx(hn,{id:h,value:e,onDebouncedChange:t,placeholder:x("prompt_sequence_editor.instructionPlaceholder"),className:"w-full p-2 bg-gray-700 border-none rounded-md resize-y focus:ring-2 focus:ring-cyan-500 focus:outline-none",rows:2,style:{minHeight:"80px",maxHeight:"200px"},onWheel:C=>C.stopPropagation()}),n.jsxs("div",{className:"flex items-center space-x-2 h-10",children:[n.jsxs("div",{className:"flex bg-gray-900 rounded-md p-1 shrink-0 h-10 items-center border border-gray-700",children:[n.jsx("button",{onClick:()=>r(k),className:`h-full px-3 rounded text-xs font-bold transition-colors flex items-center ${o===k?"bg-cyan-600 text-white":"text-gray-400 hover:text-white"}`,title:Pn[k].name,children:Pn[k].short}),n.jsx("button",{onClick:()=>r("en"),className:`h-full px-3 rounded text-xs font-bold transition-colors flex items-center ${o==="en"?"bg-cyan-600 text-white":"text-gray-400 hover:text-white"}`,children:"EN"})]}),n.jsxs("div",{className:"flex bg-gray-900 rounded-md p-1 shrink-0 h-10 items-center border border-gray-700",children:[n.jsx("button",{onClick:()=>i("gemini-3-flash-preview"),className:`h-full px-3 rounded text-xs font-bold transition-colors flex items-center ${a==="gemini-3-flash-preview"?"bg-cyan-600 text-white":"text-gray-400 hover:text-white"}`,title:"Gemini 3.0 Flash",children:"Flash"}),n.jsx("button",{onClick:()=>i("gemini-3-pro-preview"),className:`h-full px-3 rounded text-xs font-bold transition-colors flex items-center ${a==="gemini-3-pro-preview"?"bg-cyan-600 text-white":"text-gray-400 hover:text-white"}`,title:"Gemini 3.0 Pro",children:"Pro"})]}),n.jsx("button",{onClick:l,className:`h-10 w-10 rounded-md transition-colors flex items-center justify-center border border-gray-700 ${s?"bg-cyan-600 text-white border-cyan-500":"bg-gray-900 text-gray-400 hover:text-white hover:bg-gray-700"}`,title:"Generate/Modify Video Prompts",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),n.jsx("button",{onClick:d,disabled:c||p===0||u===0,className:"flex-grow h-10 px-4 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed flex items-center justify-center",children:c?x("prompt_sequence_editor.modifying"):x("prompt_sequence_editor.modifySelected",{count:u})})]})]})},fu=260,xu=180,J1=44,o0=36,UT=160,VT=32,Y1={WS:"Integrate the character/object with a Wide Shot (WS) into the scene and action. Show the environment.",MS:"Integrate the character/object with a Medium Shot (MS) into the scene. Character from waist up.",CU:"Integrate the character/object with a Close-Up (CU) into the scene.",ECU:"Integrate the character/object with an Extreme Close-Up (ECU) into the scene. Maximum detail.",LS:"Integrate the character/object with a Long Shot (LS) into the scene to show scale."},Hs=({value:e,onChange:t,min:o,className:r,placeholder:a,title:i})=>{const s=c=>{const d=parseInt(e,10);let u=isNaN(d)?o||0:d+c;o!==void 0&&u<o&&(u=o),t(u.toString())},l=c=>{const d=c.target.value;if(d===""){t("");return}const u=parseInt(d,10);isNaN(u)||t(d)};return n.jsxs("div",{className:`flex items-center bg-gray-600 rounded px-1 h-5 ${r}`,title:i,children:[n.jsx("input",{type:"number",min:o,value:e,onChange:l,placeholder:a,className:"w-6 bg-transparent text-[10px] text-white text-center border-none p-0 focus:outline-none focus:ring-1 focus:ring-cyan-500 rounded-sm [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",onClick:c=>c.stopPropagation(),onMouseDown:c=>c.stopPropagation()}),n.jsxs("div",{className:"flex flex-col h-full ml-0.5 -mr-0.5",children:[n.jsx("button",{className:"h-2.5 flex items-center justify-center hover:text-white text-gray-300 transition-colors",onClick:c=>{c.stopPropagation(),s(1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),n.jsx("button",{className:"h-2.5 flex items-center justify-center hover:text-white text-gray-300 transition-colors",onClick:c=>{c.stopPropagation(),s(-1)},children:n.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})},WT=["WS","MS","CU","ECU","LS"],X1=Et.memo(({index:e,frameNumber:t,sceneNumber:o,prompt:r,videoPrompt:a,shotType:i,characters:s,duration:l,isSelected:c,isCollapsed:d,onToggleCollapse:u,onSelect:p,onChange:h,onDelete:x,onAddAfter:k,onCopy:C,onCopyVideo:w,onMoveUp:f,onMoveDown:g,onMoveToSource:v,onMoveToStart:_,onMoveToEnd:S,isFirst:T,isLast:P,t:R,readOnly:D=!1,isChecked:q,onCheck:O,style:E,onEditInSource:A,onEditPrompt:N,showVideoPrompts:j=!0,showSceneInfo:L=!0})=>{const M=y.useCallback((pe,ue)=>{if(D||ue<1)return;const re=(s||[])[pe],$=`Entity-${ue}`,Z=[...s||[]];Z[pe]=$;const te=re.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),ae=new RegExp(`\\(${te}\\)`,"gi"),I=r.replace(ae,`(${$})`);h(t,{characters:Z,prompt:I})},[D,s,r,h,t]),V=y.useCallback(pe=>{if(D)return;const ue=(s||[])[pe],re=(s||[]).filter((ae,I)=>I!==pe),$=ue.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),Z=new RegExp(`\\s*\\(${$}\\)`,"gi"),te=r.replace(Z,"").trim().replace(/,\s*$/,"");h(t,{characters:re,prompt:te})},[D,s,r,h,t]),H=y.useCallback(pe=>{if(D)return;const ue=`[${pe}] ${r}`;h(t,{prompt:ue})},[D,r,h,t]),F=y.useCallback(()=>{if(D)return;const pe=s||[],ue=pe.map(te=>parseInt(te.replace(/(?:character|entity)-/i,""),10)).filter(te=>!isNaN(te));let re=1;for(;ue.includes(re);)re++;const $=`Entity-${re}`,Z=[...pe,$];h(t,{characters:Z})},[D,s,h,t]),G=pe=>{if(D)return;const ue=pe,re=I=>(I.match(/(?:character|entity)-\d+/gi)||[]).map(W=>W.toLowerCase()).sort().join(","),$=re(r),Z=re(ue),te=$!==Z,ae={prompt:ue};if(te){const I=ue.match(/(?:character|entity)-\d+/gi)||[],J=[...new Set(I.map(W=>W.replace(/character-/i,"Entity-").replace(/entity-/i,"Entity-")))];ae.characters=J}h(t,ae)},B=pe=>{D||h(t,{videoPrompt:pe})},Y=pe=>{D||h(t,{shotType:pe.target.value})},ie=`FRAME-${String(t).padStart(3,"0")}${i?`, [${i}]`:""}`,ce=i?Y1[i]:void 0;return n.jsxs("div",{onClick:()=>p(t),style:{...E,height:d?`${J1}px`:j?ce?`${fu+30}px`:`${fu}px`:ce?`${xu+30}px`:`${xu}px`},className:`relative group bg-gray-700 p-2 rounded-lg border-2 overflow-hidden mb-1 ${c?"border-cyan-500 shadow-[0_0_15px_rgba(6,182,212,0.3)]":"border-transparent hover:border-gray-600"}`,children:[n.jsxs("div",{className:"flex justify-between items-center mb-1 h-[28px] gap-2",onDoubleClick:pe=>{pe.stopPropagation(),u(t)},children:[n.jsxs("div",{className:"flex items-center space-x-2 flex-1 overflow-hidden",children:[O&&n.jsx("div",{className:"flex-shrink-0",onClick:pe=>pe.stopPropagation(),title:"Select frame for batch modification",children:n.jsx(Zt,{checked:!!q,onChange:(pe,ue)=>O(t,ue.shiftKey),className:"h-5 w-5"})}),n.jsx(Ne,{tooltipPosition:"right",title:R(d?"node.action.expand":"node.action.collapse"),onClick:pe=>{pe.stopPropagation(),u(t)},children:d?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7M19 5l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),n.jsx("h4",{className:"text-[10px] font-black text-gray-200 flex-shrink-0 whitespace-nowrap uppercase tracking-tighter",title:ie,children:ie}),n.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0 ml-1",children:[n.jsx("span",{className:"text-[10px] text-gray-500 font-semibold uppercase",children:"ENT:"}),(s||[]).map((pe,ue)=>{const re=parseInt(pe.replace(/(?:character|entity)-/i,""),10);return isNaN(re)?null:n.jsxs("div",{className:"flex items-center bg-gray-600 rounded text-gray-200 border border-gray-500",children:[n.jsx("span",{className:"text-[10px] font-semibold px-1.5",children:re}),n.jsxs("div",{className:"flex flex-col border-l border-gray-500",children:[n.jsx("button",{onClick:$=>{$.stopPropagation(),M(ue,re+1)},className:"px-0.5 text-gray-300 hover:text-white text-[8px] middle-none disabled:text-gray-500 disabled:cursor-not-allowed",disabled:D,children:""}),n.jsx("button",{onClick:$=>{$.stopPropagation(),M(ue,re-1)},className:"px-0.5 text-gray-300 hover:text-white text-[8px] border-t border-gray-600 disabled:text-gray-500 disabled:cursor-not-allowed",disabled:D||re<=1,children:""})]}),n.jsx("button",{onClick:$=>{$.stopPropagation(),H(pe)},disabled:D,className:"px-1 text-cyan-300 hover:text-cyan-100 border-l border-gray-500 text-[10px] disabled:text-gray-500 disabled:cursor-not-allowed",title:"Insert at start: [Entity-N]",children:""}),n.jsx("button",{onClick:$=>{$.stopPropagation(),V(ue)},disabled:D,className:"px-1 text-red-300 hover:text-red-100 border-l border-gray-500 text-[10px] disabled:text-gray-500 disabled:cursor-not-allowed",children:""})]},ue)}),n.jsx("button",{onClick:pe=>{pe.stopPropagation(),F()},disabled:D,className:"flex items-center justify-center w-4 h-4 bg-gray-600 hover:bg-gray-500 rounded text-[10px] text-gray-300 disabled:bg-gray-700 disabled:cursor-not-allowed",children:"+"})]})]}),n.jsxs("div",{className:"flex items-center flex-shrink-0 space-x-1",children:[!d&&!D&&n.jsxs("div",{className:"flex items-center flex-shrink-0 mr-1",children:[n.jsx(Hs,{value:l.toString(),onChange:pe=>h(t,{duration:Math.max(0,parseInt(pe,10)||0)}),min:0}),n.jsx("span",{className:"text-[9px] text-gray-400 ml-1",children:"s"})]}),v&&n.jsx(Ne,{tooltipPosition:"left",title:"Move to Source",onClick:pe=>{pe.stopPropagation(),v(t)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),!D&&n.jsxs("div",{className:"flex p-0.5",children:[_&&n.jsx(Ne,{tooltipPosition:"left",title:"Move to Start",onClick:pe=>{pe.stopPropagation(),_(e)},disabled:T,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),f&&n.jsx(Ne,{tooltipPosition:"left",title:"Move Up",onClick:pe=>{pe.stopPropagation(),f(e)},disabled:T,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),g&&n.jsx(Ne,{tooltipPosition:"left",title:"Move Down",onClick:pe=>{pe.stopPropagation(),g(e)},disabled:P,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),S&&n.jsx(Ne,{tooltipPosition:"left",title:"Move to End",onClick:pe=>{pe.stopPropagation(),S(e)},disabled:P,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})})]}),!D&&k&&n.jsx(Ne,{tooltipPosition:"left",title:"Add Frame After",onClick:pe=>{pe.stopPropagation(),k(t)},className:"p-1 rounded-md text-[#dad5cf] hover:bg-gray-600 hover:text-white transition-colors focus:outline-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),n.jsx(Ne,{tooltipPosition:"left",title:R("node.action.copyImagePrompt"),onClick:pe=>{pe.stopPropagation(),C(r)},children:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(Ne,{tooltipPosition:"left",title:R("node.action.copyVideoPrompt"),onClick:pe=>{pe.stopPropagation(),a&&w&&w(a)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})})}),!D&&x&&n.jsx(Ne,{tooltipPosition:"left",title:R("image_sequence.delete_frame"),onClick:pe=>{pe.stopPropagation(),x(t)},className:"p-1 rounded-md text-gray-500 hover:text-red-400 hover:bg-gray-600 transition-colors focus:outline-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),(!D&&N||D&&A)&&n.jsx(Ne,{title:R(D?"image_sequence.edit_in_source":"image_sequence.edit_prompt"),tooltipPosition:"left",onClick:pe=>{pe.stopPropagation(),D&&A?A(t):N&&N(t)},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})})]})]}),!d&&n.jsxs("div",{className:"flex flex-col space-y-1 mt-1",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1 bg-gray-800 p-1 rounded",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase whitespace-nowrap",children:"SHOT TYPE"}),n.jsx("select",{value:i||"WS",onChange:Y,disabled:D,className:"bg-gray-700 text-white text-[10px] rounded border border-gray-600 px-1 py-0.5 focus:outline-none focus:ring-1 focus:ring-cyan-500 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed flex-grow",onClick:pe=>pe.stopPropagation(),onMouseDown:pe=>pe.stopPropagation(),children:WT.map(pe=>n.jsx("option",{value:pe,children:pe},pe))})]}),ce&&n.jsx("div",{className:"px-2 py-1.5 bg-gray-800/80 rounded border border-gray-600/50 mb-1 text-[10px] text-gray-300 italic shadow-sm",children:ce}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase",children:"IMAGE PROMPT"}),n.jsx(hn,{value:r,onDebouncedChange:G,readOnly:D,style:{height:j?"100px":"120px"},className:`w-full text-xs p-1 bg-gray-800 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-2 focus:ring-cyan-500 ${D?"cursor-default":"cursor-text"}`,onClick:pe=>pe.stopPropagation(),onMouseDown:pe=>pe.stopPropagation(),onWheel:pe=>pe.stopPropagation()})]}),j&&n.jsxs("div",{className:"flex flex-col mt-1 pt-1 border-t border-gray-600/30",children:[n.jsx("div",{className:"flex justify-between items-center mb-0.5",children:n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase",children:"VIDEO PROMPT"})}),n.jsx(hn,{value:a||"",onDebouncedChange:B,readOnly:D,style:{height:"60px"},className:`w-full text-xs p-1 bg-gray-800 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-2 focus:ring-cyan-500 ${D?"cursor-default":"cursor-text"}`,onClick:pe=>pe.stopPropagation(),onMouseDown:pe=>pe.stopPropagation(),onWheel:pe=>pe.stopPropagation()})]})]})]})}),Z1=(e,t,o,r=800,a=!0,i=!0,s={},l=[])=>{const c=y.useMemo(()=>{const x=[...e].sort((f,g)=>f.frameNumber-g.frameNumber),k=[];let C=-1,w=null;return x.forEach(f=>{const g=f.sceneNumber||1;if(g!==C){C=g;const v=f.sceneTitle||"";w={scene:g,title:v,prompts:[]},k.push(w)}w&&w.prompts.push(f)}),k},[e]),d=y.useMemo(()=>{const x=[];let k=0;return c.forEach(C=>{if(i&&(x.push({type:"scene_header",h:o0,top:k,data:C,scene:C.scene}),k+=o0),!i||!t.includes(C.scene)){const w=s[String(C.scene)]||"",f=l.includes(C.scene)?UT:VT;x.push({type:"scene_context",h:f+8,top:k,data:w,scene:C.scene}),k+=f+8,C.prompts.forEach(g=>{const _=(g.shotType?Y1[g.shotType]:void 0)?30:0,S=(a?fu:xu)+_,T=(g.isCollapsed?J1:S)+8;x.push({type:"prompt",h:T,top:k,data:g,scene:C.scene}),k+=T})}}),{items:x,totalHeight:k}},[c,t,a,i,s,l]),u=y.useMemo(()=>{const k=Math.max(0,o-800),C=o+r+800;return d.items.filter(w=>w.top+w.h>k&&w.top<C)},[d,o,r]),p=x=>{const k=d.items.find(C=>C.type==="prompt"&&C.data.frameNumber===x);return k?k.top:null},h=x=>{if(!i)return null;const k=d.items.find(C=>C.type==="scene_header"&&C.scene===x);return k?k.top:null};return{groupedPrompts:c,virtualItems:d,visibleItems:u,totalHeight:d.totalHeight,getScrollPositionForFrame:p,getScrollPositionForScene:h}},$T=y.forwardRef(({prompts:e,collapsedScenes:t,checkedFrameNumbers:o,selectedFrameNumber:r,isLinked:a,onUpdatePrompts:i,onLoadFile:s,onSaveToCatalog:l,onSaveToDisk:c,t:d,onSelect:u,onToggleCollapse:p,onToggleScene:h,onDetachToEditor:x,onClearAll:k,onAddPrompt:C,onAddScene:w,onDeletePrompt:f,onMovePromptUp:g,onMovePromptDown:v,onMoveToStart:_,onMoveToEnd:S,onRegenerate:T,isAnyGenerationInProgress:P,onEditInSource:R,onEditPrompt:D,isGeneratingSequence:q,allConceptsLength:O,selectionKey:E="checkedSourceFrameNumbers",onUnlink:A,addToast:N,onClearTextOnly:j,sceneContexts:L={},onUpdateSceneContext:M,expandedSceneContexts:V=[],onToggleSceneContext:H},F)=>{const G=y.useRef(null),[B,Y]=y.useState(0),[ee,ie]=y.useState(800),[ce,pe]=y.useState(!1),[ue,re]=y.useState(""),[$,Z]=y.useState(""),[te,ae]=y.useState(""),[I,J]=y.useState(!0),[W,U]=y.useState(!0);y.useEffect(()=>{if(!G.current)return;const me=()=>{G.current&&requestAnimationFrame(()=>{G.current&&(ie(G.current.clientHeight),Y(G.current.scrollTop))})},ve=new ResizeObserver(me);return ve.observe(G.current),me(),()=>ve.disconnect()},[]);const{groupedPrompts:Q,totalHeight:de,visibleItems:se,getScrollPositionForFrame:X}=Z1(e,t,B,ee,I,W,L,V);y.useImperativeHandle(F,()=>({scrollToFrame:me=>{const ve=X(me);ve!==null&&G.current&&G.current.scrollTo({top:Math.max(0,ve-100),behavior:"smooth"})},scrollToBottom:()=>{G.current&&G.current.scrollTo({top:G.current.scrollHeight,behavior:"smooth"})}}));const K=me=>{const ve=parseInt(me||ue,10);if(isNaN(ve))return;const Ie=e.find(be=>be.frameNumber===ve);if(!Ie)return;const ke=Ie.sceneNumber||1;let je=[...t];je.includes(ke)&&(je=je.filter(be=>be!==ke));const Ge=e.map(be=>be.frameNumber===ve?{...be,isCollapsed:!1}:be);i({prompts:Ge,sourcePrompts:Ge,collapsedScenes:je,collapsedSourceScenes:je,selectedFrameNumber:ve}),setTimeout(()=>{const be=X(ve);be!==null&&G.current&&G.current.scrollTo({top:be,behavior:"smooth"})},100)},oe=me=>{if(me.preventDefault(),me.stopPropagation(),pe(!1),a)return;const ve=me.dataTransfer.files[0];if(ve&&ve.type==="application/json"){const Ie=new FileReader;Ie.onload=ke=>{var je;if((je=ke.target)!=null&&je.result)try{const Ge=JSON.parse(ke.target.result);let be=Ge.finalPrompts||Ge.prompts||(Array.isArray(Ge)?Ge:[]),Pe=Ge.sceneContexts||{};be.length>0&&i({sourcePrompts:be,prompts:be,sceneContexts:Pe})}catch(Ge){console.error(Ge)}},Ie.readAsText(ve)}},ne=()=>{const me=parseInt($,10),ve=parseInt(te,10);if(isNaN(me)||isNaN(ve))return;const Ie=Math.max(1,me),ke=Math.min(e.length,ve);if(Ie>ke)return;const je=[];for(let Ge=Ie;Ge<=ke;Ge++)je.push(Ge);i({[E]:je})},le=()=>i({[E]:e.map(me=>me.frameNumber)}),ge=()=>i({[E]:[]}),we=()=>{const ve=e.map(Ie=>Ie.frameNumber).filter(Ie=>!o.includes(Ie));i({[E]:ve})},_e=Q.length>0&&Q.every(me=>t.includes(me.scene)),fe=()=>{const me=Q.map(Ie=>Ie.scene),ve=_e?[]:me;i({collapsedScenes:ve,collapsedSourceScenes:ve})},he=e.every(me=>me.isCollapsed),ye=()=>{const me=e.map(ve=>({...ve,isCollapsed:!he}));i({prompts:me,sourcePrompts:me})},Se=(me,ve)=>{if(a)return;const Ie=e.map(ke=>ke.frameNumber===me?{...ke,...ve}:ke);i({prompts:Ie,sourcePrompts:Ie})},Te=(me,ve)=>{if(ve){i({[E]:[me]});return}const Ie=o.includes(me)?o.filter(ke=>ke!==me):[...o,me];i({[E]:Ie})},Ae=me=>{navigator.clipboard.writeText(me),N&&N(d("toast.copiedToClipboard"))},Oe=()=>{j?j():k()};return n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-h-0",children:[n.jsxs("div",{className:"flex justify-between items-center flex-shrink-0 bg-gray-900/50 p-1 rounded-md border border-gray-700 h-9",onWheel:me=>me.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center space-x-1 h-full",children:[a&&n.jsx("button",{className:"text-cyan-400 hover:text-white transition-colors",title:"Linked to Upstream (Click to Unlink and Copy)",onClick:me=>{me.stopPropagation(),A&&A()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),!a&&e.length>0&&x&&n.jsx(Ne,{title:"Detach and Edit",onClick:x,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-400 hover:text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),n.jsx("h3",{className:"text-sm font-bold text-gray-300 px-1 whitespace-nowrap",children:d("image_sequence.prompts_list_title")||"Prompts"}),n.jsx("div",{className:"flex items-center",children:n.jsx(Hs,{value:ue,placeholder:"#",onChange:me=>{re(me),K(me)},min:1,className:"w-12 border-none",title:"Go to Frame"})}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsxs("div",{className:"flex items-center gap-1 bg-gray-800 rounded p-0.5 h-6",children:[n.jsx("span",{className:"text-[9px] text-gray-400 px-1 whitespace-nowrap",children:d("image_sequence.range_from")}),n.jsx(Hs,{value:$,placeholder:"1",onChange:Z,min:1,className:"w-10 border-none"}),n.jsx("span",{className:"text-[9px] text-gray-400 px-1 whitespace-nowrap",children:d("image_sequence.range_to")}),n.jsx(Hs,{value:te,placeholder:"N",onChange:ae,min:1,className:"w-10 border-none"}),n.jsx(Ne,{title:"Select range",onClick:me=>{me.stopPropagation(),ne()},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]}),n.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-800 rounded p-0.5 h-6",children:[n.jsx(Ne,{title:d("image_sequence.select_all"),onClick:le,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600"}),n.jsx(Ne,{title:d("image_sequence.select_none"),onClick:ge,disabled:o.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"w-px h-3 bg-gray-600"}),n.jsx(Ne,{title:d("image_sequence.invert_selection"),onClick:we,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})})]})]}),n.jsxs("div",{className:"flex items-center space-x-1 h-full",children:[n.jsx(Ne,{title:I?" -":" -",onClick:()=>J(!I),children:I?n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})}),n.jsx(Ne,{title:W?" ":" ",onClick:()=>U(!W),children:W?n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsx(Ne,{title:_e?"Expand Scenes":"Collapse Scenes",onClick:fe,children:_e?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})}),n.jsx(Ne,{title:he?"Expand Prompts":"Collapse Prompts",onClick:ye,disabled:_e,children:he?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),!a&&n.jsx(Ne,{title:d("image_sequence.clear_prompts_only"),onClick:Oe,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-600 mx-1"}),n.jsxs("div",{className:"flex items-center space-x-1 bg-gray-900/50 rounded p-0.5",children:[n.jsx(Ne,{title:"Add Scene",onClick:w,disabled:a,children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m-3-3h6"})]})}),n.jsx(Ne,{title:d("image_sequence.add_frame"),onClick:()=>C(-1),disabled:a,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]})]})]}),n.jsx("div",{ref:G,className:`flex-grow min-h-0 bg-gray-900/50 p-2 rounded-md border-2 border-dashed transition-colors overflow-y-auto scrollbar-gutter-stable ${ce?"border-cyan-500 bg-gray-700/50":"border-transparent"} ${ce?"bg-cyan-900/20":""}`,onScroll:me=>Y(me.currentTarget.scrollTop),onDragOver:me=>{me.preventDefault(),me.stopPropagation(),pe(!0)},onDragLeave:()=>pe(!1),onDrop:oe,onWheel:me=>me.stopPropagation(),style:{overscrollBehaviorY:"contain"},children:e.length===0?n.jsx("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500 p-4 cursor-pointer",onClick:()=>!a&&C(-1),children:a?n.jsxs(n.Fragment,{children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-gray-400 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),n.jsx("p",{className:"font-semibold text-sm",children:"Linked to References"}),n.jsx("p",{className:"text-xs",children:"Waiting for data..."})]}):n.jsxs(n.Fragment,{children:[n.jsx("h4",{className:"font-semibold text-sm",children:d("image_sequence.drop_or_add_title")}),n.jsx("p",{className:"text-xs",children:d("image_sequence.drop_or_add_desc")})]})}):n.jsx("div",{style:{height:de,position:"relative"},children:se.map(me=>{if(me.type==="scene_header"){const ve=me.data,Ie=t.includes(ve.scene);return n.jsx("div",{style:{position:"absolute",top:me.top,left:0,right:0,height:me.h,paddingBottom:4},children:n.jsx("div",{className:"flex items-center justify-between bg-gray-800 p-1 rounded select-none cursor-pointer hover:bg-gray-700 transition-colors h-full",onClick:ke=>{ke.stopPropagation(),h(ve.scene)},children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"text-gray-400",children:Ie?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),n.jsxs("span",{className:"text-xs font-bold text-gray-300 uppercase tracking-wider bg-gray-800 px-2 py-1 rounded",children:[d("image_sequence.scene_input_label")," ",ve.scene,ve.title?`: ${ve.title}`:""]}),n.jsxs("span",{className:"text-[10px] text-gray-500",children:["(",ve.prompts.length," frames)"]})]})})},`header-${ve.scene}`)}else if(me.type==="scene_context"){const ve=me.data,Ie=me.scene,ke=V.includes(Ie);return n.jsx("div",{style:{position:"absolute",top:me.top,left:0,right:0,height:me.h},className:"pl-2 border-l-2 border-orange-500/50 ml-2 pb-2",children:n.jsxs("div",{className:"bg-gray-800/80 rounded border border-orange-500/30 p-2 h-full flex flex-col",children:[n.jsx("div",{className:"flex justify-between items-center cursor-pointer select-none",onClick:je=>{je.stopPropagation(),H&&H(Ie)},children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"text-orange-500",children:ke?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})}),n.jsx("label",{className:"text-[10px] font-bold text-orange-400 uppercase tracking-wider cursor-pointer",children:"SCENE CONTEXT"})]})}),ke&&n.jsx("div",{className:"flex-grow min-h-0 mt-2",children:n.jsx(hn,{value:ve,onDebouncedChange:je=>M&&M(Ie,je),readOnly:a,className:`w-full h-full text-xs p-1.5 bg-gray-900/50 rounded resize-none border-none focus:outline-none transition-shadow focus:ring-1 focus:ring-orange-500 ${a?"cursor-default":"cursor-text"}`,placeholder:"Describe scene environment and context...",onMouseDown:je=>je.stopPropagation(),onWheel:je=>je.stopPropagation()})})]})},`context-${Ie}`)}else{const ve=me.data,Ie=e.findIndex(je=>je.frameNumber===ve.frameNumber),ke=r===ve.frameNumber;return n.jsx("div",{style:{position:"absolute",top:me.top,left:0,right:0,height:me.h},className:"pl-2 border-l-2 border-gray-700 ml-2",children:n.jsx(X1,{index:Ie,frameNumber:ve.frameNumber,sceneNumber:ve.sceneNumber,prompt:ve.prompt,videoPrompt:ve.videoPrompt,shotType:ve.shotType,characters:ve.characters,duration:ve.duration||0,isSelected:ke,isCollapsed:ve.isCollapsed??!1,onToggleCollapse:()=>p(ve.frameNumber),onSelect:()=>u(ve.frameNumber),onChange:Se,onCopy:je=>Ae(je),onCopyVideo:je=>Ae(je),t:d,readOnly:a,isChecked:o.includes(ve.frameNumber),onCheck:(je,Ge)=>Te(je,Ge),onDelete:()=>f(ve.frameNumber),onAddAfter:()=>C(ve.frameNumber),onMoveUp:()=>g(Ie),onMoveDown:()=>v(Ie),onMoveToStart:()=>_(Ie),onMoveToEnd:()=>S(Ie),isFirst:Ie===0,isLast:Ie===e.length-1,showVideoPrompts:I,onRegenerate:T,isAnyGenerationInProgress:P||q,onEditInSource:R,onEditPrompt:D,maxCharacters:O})},`prompt-${ve.frameNumber}`)}})})}),!a&&n.jsxs("div",{className:"flex-shrink-0 flex space-x-2",children:[n.jsx("div",{className:"flex-1 flex space-x-1",children:n.jsx("button",{onClick:s,className:"flex-1 px-3 py-2 text-sm font-semibold text-white bg-teal-600 hover:bg-teal-700 rounded-md",children:d("image_sequence.load_prompts")})}),n.jsx("button",{onClick:l,disabled:e.length===0,className:"flex-1 px-3 py-2 text-sm font-semibold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors",title:d("catalog.saveTo"),children:d("catalog.saveTo")}),n.jsx(Ne,{title:d("group.saveToDisk"),onClick:c,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]})]})}),KT=({prompts:e,collapsedScenes:t,isLinked:o,onUpdatePrompts:r,t:a,onToggleCollapse:i,onToggleScene:s,onMoveToSource:l,onMoveAllToSource:c,onClear:d})=>{const u=y.useRef(null),[p,h]=y.useState(0),[x,k]=y.useState(800);y.useEffect(()=>{if(!u.current)return;const P=()=>{u.current&&requestAnimationFrame(()=>{u.current&&(k(u.current.clientHeight),h(u.current.scrollTop))})},R=new ResizeObserver(P);return R.observe(u.current),P(),()=>R.disconnect()},[]);const{groupedPrompts:C,totalHeight:w,visibleItems:f}=Z1(e,t,p,x),g=C.length>0&&C.every(P=>t.includes(P.scene)),v=()=>{const P=C.map(R=>R.scene);r({collapsedModifiedScenes:g?[]:P})},_=e.every(P=>P.isCollapsed),S=()=>{r({modifiedPrompts:e.map(P=>({...P,isCollapsed:!_}))})},T=(P,R)=>{const D=e.map(q=>q.frameNumber===P?{...q,...R}:q);r({modifiedPrompts:D})};return n.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-h-0",children:[n.jsxs("div",{className:"flex justify-between items-center flex-shrink-0",children:[n.jsx("h3",{className:"text-sm font-bold text-gray-300",children:a("prompt_sequence_editor.finalPrompts")}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(Ne,{title:"Move All to Source",onClick:c,disabled:e.length===0||!!o,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),n.jsx(Ne,{title:g?"Expand Scenes":"Collapse Scenes",onClick:v,children:g?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})}),n.jsx(Ne,{title:_?"Expand Prompts":"Collapse Prompts",onClick:S,disabled:g,children:_?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),n.jsx(Ne,{title:"Clear Modified",onClick:d,disabled:e.length===0,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),n.jsx("div",{ref:u,onScroll:P=>h(P.currentTarget.scrollTop),className:"flex-grow min-h-0 bg-gray-900/50 p-2 rounded-md overflow-y-auto scrollbar-gutter-stable",onWheel:P=>P.stopPropagation(),children:e.length===0?n.jsx("div",{className:"h-full flex items-center justify-center text-gray-500",children:"  ."}):n.jsx("div",{style:{height:w,position:"relative"},children:f.map(P=>{if(P.type==="scene_header"){const R=P.data,D=t.includes(R.scene);return n.jsx("div",{style:{position:"absolute",top:P.top,left:0,right:0,height:P.h,paddingBottom:4},children:n.jsx("div",{className:"flex items-center justify-between bg-gray-800 p-1 rounded select-none cursor-pointer hover:bg-gray-700 transition-colors h-full",onClick:q=>{q.stopPropagation(),s(R.scene)},children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"text-gray-400",children:D?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),n.jsxs("span",{className:"text-xs font-bold text-gray-300 uppercase tracking-wider bg-gray-800 px-2 py-1 rounded",children:[a("image_sequence.scene_input_label")," ",R.scene,R.title?`: ${R.title}`:""]}),n.jsxs("span",{className:"text-[10px] text-gray-500",children:["(",R.prompts.length," frames)"]})]})})},`mod-header-${R.scene}`)}else{const R=P.data;return n.jsx("div",{style:{position:"absolute",top:P.top,left:0,right:0,height:P.h},className:"pl-2 border-l-2 border-gray-700 ml-2",children:n.jsx(X1,{index:R.frameNumber,frameNumber:R.frameNumber,sceneNumber:R.sceneNumber,prompt:R.prompt,videoPrompt:R.videoPrompt,shotType:R.shotType,characters:R.characters,duration:R.duration||0,isModified:!0,isSelected:!1,isCollapsed:R.isCollapsed??!1,onSelect:()=>{},onChange:T,onCopy:D=>navigator.clipboard.writeText(D),t:a,readOnly:!1,onToggleCollapse:()=>i(R.frameNumber),onMoveToSource:()=>l(R.frameNumber)})},`modified-${R.frameNumber}`)}})})})]})},or=620,r0=400,JT=({node:e,onValueChange:t,onModifyPromptSequence:o,isModifyingPromptSequence:r,t:a,onLoadPromptSequenceFile:i,onSaveSequenceToCatalog:s,onSaveScriptToDisk:l,setError:c,connectedInputs:d,getUpstreamNodeValues:u,addToast:p,viewTransform:h})=>{const{setConnections:x}=Ut(),k=y.useRef(null),C=y.useRef(null),w=y.useRef(null),f=`instruction-input-${e.id}`,g=d==null?void 0:d.has("prompts_sequence"),v=y.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{instruction:"",sourcePrompts:[],modifiedPrompts:[],leftPaneWidth:or,checkedSourceFrameNumbers:[],selectedFrameNumber:null,styleOverride:"",isStyleSelected:!1,isStyleCollapsed:!0,isUsedCharsCollapsed:!0,usedCharacters:[],collapsedSourceScenes:[],collapsedModifiedScenes:[],targetLanguage:"en",modificationModel:"gemini-3-flash-preview",includeVideoPrompts:!1,sceneContexts:{},expandedSceneContexts:[]}}},[e.value]),_=y.useRef(v);y.useEffect(()=>{_.current=v},[v]);let S=v.leftPaneWidth;!S&&v.leftPaneRatio?S=Math.max(or,(e.width||1200)*v.leftPaneRatio):S||(S=or);const{instruction:T="",sourcePrompts:P=[],modifiedPrompts:R=[],checkedSourceFrameNumbers:D=[],selectedFrameNumber:q=null,styleOverride:O="",isStyleCollapsed:E=!0,isUsedCharsCollapsed:A=!0,usedCharacters:N=[],collapsedSourceScenes:j=[],collapsedModifiedScenes:L=[],targetLanguage:M="en",modificationModel:V="gemini-3-flash-preview",includeVideoPrompts:H=!1,sceneContexts:F={},expandedSceneContexts:G=[]}=v,B=S,Y=y.useCallback(se=>{const K={..._.current,...se};_.current=K,t(e.id,JSON.stringify(K))},[e.id,t]),ee=y.useCallback(se=>{const X=[..._.current.sourcePrompts||[]],K=X.length>0?Math.max(...X.map(le=>le.frameNumber))+1:1,oe=X.length>0?X[X.length-1].sceneNumber:1,ne={frameNumber:K,sceneNumber:oe,sceneTitle:"",prompt:"",videoPrompt:"",shotType:"WS",characters:[],duration:3,isCollapsed:!1};if(se!==void 0&&se!==-1){const le=X.findIndex(ge=>ge.frameNumber===se);if(le!==-1){X.splice(le+1,0,ne);const ge=X.map((we,_e)=>({...we,frameNumber:_e+1}));Y({sourcePrompts:ge});return}}Y({sourcePrompts:[...X,ne]})},[Y]),ie=y.useCallback(()=>{const se=[..._.current.sourcePrompts||[]],K=(se.length>0?Math.max(...se.map(le=>le.sceneNumber||1)):0)+1,ne={frameNumber:se.length>0?Math.max(...se.map(le=>le.frameNumber))+1:1,sceneNumber:K,sceneTitle:`Scene ${K}`,prompt:"",videoPrompt:"",shotType:"WS",characters:[],duration:3,isCollapsed:!1};Y({sourcePrompts:[...se,ne]})},[Y]),ce=y.useCallback(se=>{const oe=(_.current.sourcePrompts||[]).filter(ne=>ne.frameNumber!==se).map((ne,le)=>({...ne,frameNumber:le+1}));Y({sourcePrompts:oe})},[Y]),pe=y.useCallback(se=>{if(se<=0)return;const K=[..._.current.sourcePrompts||[]];[K[se-1],K[se]]=[K[se],K[se-1]],Y({sourcePrompts:K.map((oe,ne)=>({...oe,frameNumber:ne+1}))})},[Y]),ue=y.useCallback(se=>{const X=_.current.sourcePrompts||[];if(se>=X.length-1)return;const K=[...X];[K[se],K[se+1]]=[K[se+1],K[se]],Y({sourcePrompts:K.map((oe,ne)=>({...oe,frameNumber:ne+1}))})},[Y]),re=y.useCallback(se=>{const K=[..._.current.sourcePrompts||[]],[oe]=K.splice(se,1);K.unshift(oe),Y({sourcePrompts:K.map((ne,le)=>({...ne,frameNumber:le+1}))})},[Y]),$=y.useCallback(se=>{const K=[..._.current.sourcePrompts||[]],[oe]=K.splice(se,1);K.push(oe),Y({sourcePrompts:K.map((ne,le)=>({...ne,frameNumber:le+1}))})},[Y]),Z=y.useCallback(se=>{C.current&&(C.current.scrollToFrame(se),Y({selectedFrameNumber:se}))},[Y]),te=y.useCallback(se=>{const X=_.current.sourcePrompts||[],K=_.current.modifiedPrompts||[],oe=K.find(ge=>ge.frameNumber===se);if(!oe)return;const ne=X.map(ge=>ge.frameNumber===se?{...ge,...oe}:ge),le=K.filter(ge=>ge.frameNumber!==se);Y({sourcePrompts:ne,modifiedPrompts:le})},[Y]),ae=y.useCallback(()=>{const se=_.current.sourcePrompts||[],X=_.current.modifiedPrompts||[],K=new Map(X.map(ne=>[ne.frameNumber,ne])),oe=se.map(ne=>{const le=K.get(ne.frameNumber);return le?{...ne,...le}:ne});Y({sourcePrompts:oe,modifiedPrompts:[]})},[Y]);y.useEffect(()=>{if(!e.width)return;const se=e.width-r0;B>se?Y({leftPaneWidth:Math.max(or,se)}):B<or&&Y({leftPaneWidth:or})},[e.width,B,Y]),y.useEffect(()=>{if(g){const X=u(e.id,"prompts_sequence")[0];if(typeof X=="string"&&X.trim()!=="")try{const K=JSON.parse(X);if(K.type==="script-prompt-modifier-data"&&Array.isArray(K.finalPrompts)){const oe=K.finalPrompts,ne=K.usedCharacters||[],le=K.sceneContexts||{},ge=[];let we=!1;oe.forEach(_e=>{const fe=P.find(ye=>ye.frameNumber===_e.frameNumber),he={frameNumber:_e.frameNumber,sceneNumber:_e.sceneNumber||1,sceneTitle:_e.sceneTitle||"",prompt:_e.prompt||"",videoPrompt:_e.videoPrompt||"",shotType:_e.shotType||_e.ShotType||"WS",characters:_e.characters||[],duration:_e.duration||3,isCollapsed:fe?fe.isCollapsed:!0};(!fe||fe.prompt!==he.prompt||fe.videoPrompt!==he.videoPrompt||fe.shotType!==he.shotType||JSON.stringify(fe.characters)!==JSON.stringify(he.characters))&&(we=!0),ge.push(he)}),(P.length!==ge.length||JSON.stringify(N)!==JSON.stringify(ne)||JSON.stringify(F)!==JSON.stringify(le))&&(we=!0),we&&Y({sourcePrompts:ge,usedCharacters:ne,sceneContexts:le})}}catch{}}},[g,u,e.id,Y,P,N,F]);const I=y.useCallback(se=>{se.preventDefault(),se.stopPropagation();const X=(h==null?void 0:h.scale)||1;w.current={startX:se.clientX,startWidth:_.current.leftPaneWidth||or};const K=ne=>{const le=w.current;if(!le)return;const ge=(ne.clientX-le.startX)/X,we=le.startWidth+ge,_e=e.width-r0,fe=Math.max(or,Math.min(we,_e));Y({leftPaneWidth:fe})},oe=()=>{w.current=null,window.removeEventListener("mousemove",K),window.removeEventListener("mouseup",oe)};window.addEventListener("mousemove",K),window.addEventListener("mouseup",oe)},[Y,h,e.width]),J=()=>Y({isStyleCollapsed:!E}),W=()=>Y({isUsedCharsCollapsed:!A}),U=(se,X)=>{const K=[...N];K[se]={...K[se],name:X},Y({usedCharacters:K})},Q=(se,X)=>{const K={...F,[se]:X};Y({sceneContexts:K})},de=se=>{const X=G||[],K=X.includes(se)?X.filter(oe=>oe!==se):[...X,se];Y({expandedSceneContexts:K})};return n.jsxs("div",{ref:k,className:"relative h-full w-full flex space-x-2",onMouseDown:se=>se.stopPropagation(),onWheel:se=>se.stopPropagation(),children:[n.jsxs("div",{className:"h-full flex flex-col space-y-2 flex-shrink-0",style:{width:`${B}px`},children:[n.jsx(HT,{instruction:T,onInstructionChange:se=>Y({instruction:se}),targetLanguage:M,onLanguageChange:se=>Y({targetLanguage:se}),modificationModel:V,onModelChange:se=>Y({modificationModel:se}),includeVideoPrompts:H,onToggleVideoPrompts:()=>Y({includeVideoPrompts:!H}),isModifying:r,onModify:()=>o(e.id),checkedCount:D.length,totalPrompts:P.length,instructionInputId:f,t:a}),n.jsxs("div",{className:"flex flex-col space-y-1 mb-1 flex-shrink-0",children:[n.jsxs("div",{className:"flex justify-between items-center cursor-pointer hover:bg-gray-700/50 rounded-md px-1 transition-colors group",onClick:W,children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase cursor-pointer py-1 flex-grow",children:" "}),n.jsx("div",{className:"text-gray-500 group-hover:text-gray-300 p-1",children:A?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!A&&n.jsx("div",{className:"bg-gray-700/50 p-2 rounded-md border border-gray-600 max-h-40 overflow-y-auto custom-scrollbar",children:N.length>0?N.map((se,X)=>n.jsxs("div",{className:"flex items-center gap-1 mb-1 last:mb-0 group/item",children:[n.jsxs("div",{className:"flex items-center gap-1 min-w-[100px] shrink-0 bg-gray-800/50 rounded px-1 border border-gray-600/50",children:[n.jsxs("span",{className:"text-[10px] font-mono text-cyan-400 truncate w-16",children:[se.index,":"]}),n.jsx("button",{onClick:K=>{K.stopPropagation(),navigator.clipboard.writeText(`[${se.index}]`),p&&p(a("toast.copiedToClipboard"))},className:"text-gray-500 hover:text-white p-0.5 transition-colors opacity-0 group-hover/item:opacity-100",title:"Copy as [Tag]",children:n.jsx(Dt,{className:"h-3 w-3"})})]}),n.jsxs("div",{className:"flex-grow flex items-center bg-gray-800 border-none rounded px-1.5 py-0.5 relative",children:[n.jsx("input",{type:"text",value:se.name,onChange:K=>U(X,K.target.value),placeholder:" ...",className:"w-full bg-transparent border-none text-[10px] text-gray-200 focus:outline-none focus:ring-0",onMouseDown:K=>K.stopPropagation()}),n.jsx("button",{onClick:K=>{K.stopPropagation(),navigator.clipboard.writeText(se.name),p&&p(a("toast.copiedToClipboard"))},className:"text-gray-500 hover:text-white p-0.5 transition-colors opacity-0 group-hover/item:opacity-100 absolute right-1",title:"Copy Name",children:n.jsx(Dt,{className:"h-3 w-3"})})]})]},X)):n.jsx("div",{className:"text-[10px] text-gray-500 italic",children:"  ."})})]}),n.jsxs("div",{className:"flex flex-col space-y-1 mb-2 flex-shrink-0",children:[n.jsxs("div",{className:"flex justify-between items-center cursor-pointer hover:bg-gray-700/50 rounded-md px-1 transition-colors group",onClick:J,children:[n.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase cursor-pointer py-1 flex-grow",children:a("node.content.style")}),n.jsx("div",{className:"text-gray-500 group-hover:text-gray-300 p-1",children:E?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!E&&n.jsx(hn,{value:O,onDebouncedChange:se=>Y({styleOverride:se}),className:"w-full p-2 bg-gray-700 border-none rounded-md resize-none focus:outline-none text-xs",style:{minHeight:"60px"},onMouseDown:se=>se.stopPropagation(),onWheel:se=>se.stopPropagation()})]}),n.jsx($T,{ref:C,prompts:P,collapsedScenes:j,checkedFrameNumbers:D,selectedFrameNumber:q,selectionKey:"checkedSourceFrameNumbers",isLinked:!!g,onUpdatePrompts:Y,onLoadFile:()=>i(e.id),onSaveToCatalog:()=>s(e.id),onSaveToDisk:()=>l(e.id),t:a,setError:c,onSelect:se=>Y({selectedFrameNumber:se}),onToggleCollapse:se=>{const X=P.map(K=>K.frameNumber===se?{...K,isCollapsed:!K.isCollapsed}:K);Y({sourcePrompts:X})},onToggleScene:se=>{const X=j.includes(se)?j.filter(K=>K!==se):[...j,se];Y({collapsedSourceScenes:X})},onClearAll:()=>Y({sourcePrompts:[],styleOverride:"",usedCharacters:[],sceneContexts:{}}),onAddPrompt:ee,onAddScene:ie,onDeletePrompt:ce,onMovePromptUp:pe,onMovePromptDown:ue,onMoveToStart:re,onMoveToEnd:$,onRegenerate:()=>{},isAnyGenerationInProgress:r,onEditInSource:()=>{},onEditPrompt:Z,isGeneratingSequence:r,allConceptsLength:0,sceneContexts:F,onUpdateSceneContext:Q,expandedSceneContexts:G,onToggleSceneContext:de})]}),n.jsx("div",{onMouseDown:I,className:"w-2 h-full bg-gray-700/50 hover:bg-cyan-600 cursor-col-resize rounded transition-colors flex-shrink-0"}),n.jsx("div",{className:"h-full flex flex-col space-y-2 min-w-0",style:{width:"0",flexGrow:1},children:n.jsx(KT,{prompts:R,collapsedScenes:L,isLinked:!!g,onUpdatePrompts:Y,t:a,onMoveAllToSource:ae,onClear:()=>Y({modifiedPrompts:[]}),onMoveToSource:te,onToggleCollapse:se=>{const X=R.map(K=>K.frameNumber===se?{...K,isCollapsed:!K.isCollapsed}:K);Y({modifiedPrompts:X})},onToggleScene:se=>{const X=L.includes(se)?L.filter(K=>K!==se):[...L,se];Y({collapsedModifiedScenes:X})}})})]})},a0=Et.memo(({node:e,contentProps:t})=>{switch(e.type){case z.REROUTE_DOT:return n.jsx(nP,{...t});case z.NOTE:return n.jsx(tP,{...t});case z.TRANSLATOR:return n.jsx(gP,{...t});case z.GEMINI_CHAT:return n.jsx(wP,{...t});case z.SCRIPT_GENERATOR:return n.jsx(RP,{...t});case z.SCRIPT_VIEWER:return n.jsx(DP,{...t});case z.CHARACTER_GENERATOR:return n.jsx(OP,{...t});case z.CHARACTER_CARD:return n.jsx(WP,{...t});case z.TEXT_INPUT:return n.jsx(oP,{...t});case z.IMAGE_INPUT:return n.jsx(mP,{...t});case z.IMAGE_EDITOR:return n.jsx(NP,{...t});case z.IMAGE_ANALYZER:return n.jsx(EP,{...t});case z.PROMPT_ANALYZER:return n.jsx(PP,{...t});case z.CHARACTER_ANALYZER:return n.jsx(TP,{...t});case z.PROMPT_PROCESSOR:return n.jsx(IP,{...t});case z.PROMPT_SANITIZER:return n.jsx($P,{...t});case z.VIDEO_PROMPT_PROCESSOR:return n.jsx(MP,{...t});case z.IMAGE_OUTPUT:return n.jsx(jP,{...t});case z.VIDEO_OUTPUT:return n.jsx(AP,{...t});case z.IMAGE_SEQUENCE_GENERATOR:return n.jsx(GT,{...t});case z.PROMPT_SEQUENCE_EDITOR:return n.jsx(JT,{...t});case z.DATA_READER:return n.jsx(KP,{...t});case z.VIDEO_EDITOR:return n.jsx(rT,{...t});case z.MEDIA_VIEWER:return n.jsx(hT,{...t});case z.DATA_PROTECTION:return n.jsx(wT,{...t});case z.POSE_CREATOR:return n.jsx(kT,{...t});default:return null}}),YT=({node:e,onMouseDown:t,onTouchStart:o,onResizeMouseDown:r,onNodeClick:a,onDetachNodeFromGroup:i,activeTool:s,connectingInfo:l,isDockedWindow:c,isProxyMode:d})=>{const u=y.useCallback(f=>{c||t(f,e.id)},[c,t,e.id]),p=y.useCallback(f=>{c||o(f,e.id)},[c,o,e.id]),h=y.useCallback((f,g)=>{d||r(f,e.id,g)},[d,r,e.id]),x=y.useCallback(f=>{},[]),k=y.useCallback(f=>{if(s==="cutter"){if(l)return;f.stopPropagation(),f.preventDefault(),a(e.id)}},[s,l,a,e.id]),C=y.useCallback(f=>{c||(f.altKey&&i(e.id),u(f))},[c,i,u,e.id]),w=y.useCallback((f,g)=>{f.altKey?(f.stopPropagation(),i(e.id)):c||e.type!==z.REROUTE_DOT&&g(e.id)},[c,i,e.id,e.type]);return{handleDragMouseDown:u,handleDragTouchStart:p,handleResizeMouseDown:h,handleMouseUp:x,handleHeaderMouseUp:k,handleHeaderMouseDown:C,handleHeaderDoubleClick:w}},XT=(e,t,o,r,a,i,s,l,c,d)=>{if(l)return{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:1e3,borderRadius:0,border:"none"};const u=Number.isFinite(e.position.x)?e.position.x:0,p=Number.isFinite(e.position.y)?e.position.y:0;let h=10;d?h=500:e.isPinned?h=100:a?h=90:i?h=80:c&&(h=6);const x={position:"absolute",top:0,left:0,transform:`translate(${u}px, ${p}px)`,width:o?160:Number.isFinite(e.width)?e.width:s.minWidth,height:o?48:e.isCollapsed?`${Nn}px`:Number.isFinite(e.height)?e.height:s.minHeight,minWidth:r||o?void 0:`${s.minWidth}px`,minHeight:e.isCollapsed||o||r?void 0:`${s.minHeight}px`,zIndex:h,contain:"none"};if(t&&e.dockState){const C="56px",w=e.width&&Number.isFinite(e.width)?`${e.width}px`:"auto",f=e.height&&Number.isFinite(e.height)?`${e.height}px`:"auto",g=`(100vw - ${56*2}px)`,v=`${s.minWidth}px`,_=`${s.minHeight}px`,S={position:"fixed",transform:"none",zIndex:100,minWidth:v,minHeight:_,contain:"none"};switch(e.dockState.mode){case"full":return{...S,top:C,left:C,right:C,bottom:C,width:"auto",height:"auto"};case"left":return{...S,top:C,left:C,width:w,bottom:C,height:"auto"};case"right":return{...S,top:C,right:C,width:w,bottom:C,height:"auto"};case"tl":return{...S,top:C,left:C,width:w,height:f};case"tr":return{...S,top:C,right:C,width:w,height:f};case"bl":return{...S,bottom:C,left:C,width:w,height:f};case"br":return{...S,bottom:C,right:C,width:w,height:f};case"q1":return{...S,top:C,bottom:C,left:C,width:w,height:"auto"};case"q2":return{...S,top:C,bottom:C,left:`calc(${C} + ${g} * 0.25)`,width:w,height:"auto"};case"q3":return{...S,top:C,bottom:C,right:`calc(${C} + ${g} * 0.25)`,width:w,height:"auto"};case"q4":return{...S,top:C,bottom:C,right:C,width:w,height:"auto"}}}return x},ZT=(e,t,o,r,a,i,s,l,c,d,u,p,h=!0)=>{let x="border-gray-700";s||l?x="border-node-selected":c?x="border-teal-600":d?x="border-yellow-500":a?x="border-node-selected":i&&h===!0&&!r&&!o?x="border-node-hover ring-1 ring-node-hover/50 shadow-[0_0_15px_var(--color-border-hover)]":e.isPinned?x="border-node-hover":r&&(u==="text"?x="border-connection-text":u==="image"?x="border-connection-image":u==="character_data"?x="border-connection-character":u==="video"?x="border-connection-video":u==="audio"&&(x="border-connection-audio")),t&&(x="border-gray-600 shadow-2xl hover:border-node-hover"),o&&(x="border-gray-600 border-dashed opacity-80");let k=r?"bg-gray-600":e.type===z.NOTE?"bg-gray-900/70 backdrop-blur-sm":"bg-gray-800";o&&(k="bg-gray-800/80 backdrop-blur-sm"),p&&(k="bg-gray-900",x="border-none");const C=r?"bg-transparent":e.type===z.NOTE?"bg-transparent border-b border-gray-700/50":"bg-gray-700";return{container:`node-view absolute flex flex-col transition-[border-color,background-color,box-shadow] duration-200 ease-out ${k} border-2 ${p?"":r||o?"rounded-lg":"rounded-lg shadow-2xl"} ${x} ${s?"pointer-events-none":""}`,header:C,dockResizer:g=>g==="left"?"cursor-ew-resize right-0 top-0 w-2 h-full":g==="right"?"cursor-ew-resize left-0 top-0 w-2 h-full":g==="tl"?"cursor-nwse-resize bottom-0 right-0 w-4 h-4":g==="tr"?"cursor-nesw-resize bottom-0 left-0 w-4 h-4":g==="bl"?"cursor-nesw-resize top-0 right-0 w-4 h-4":g==="br"?"cursor-nwse-resize top-0 left-0 w-4 h-4":""}},QT=(e,t,o,r,a,i,s,l)=>{let c=e;o.type===z.IMAGE_EDITOR&&!e&&(c=t==="image"||t==="image_b"?"image":"text"),r&&(c=a);let d="bg-gray-400";switch(c){case"text":d="bg-connection-text";break;case"image":d="bg-connection-image";break;case"character_data":d="bg-connection-character";break;case"video":d="bg-connection-video";break;case"audio":d="bg-connection-audio";break}return!s||!i&&!r?d:(l==null?void 0:l.nodeId)===o.id&&(o.type===z.REROUTE_DOT||o.type===z.DATA_READER||l.handleId===t)?"bg-teal-600 ring-2 ring-white":i?"bg-red-500 cursor-not-allowed":d},eI=e=>{var Z;const{node:t,activeTool:o,onOutputHandleMouseDown:r,onOutputHandleTouchStart:a,isHovered:i,isSelected:s,onNodeMouseEnter:l,onNodeMouseLeave:c,onDeleteNode:d,connectingInfo:u,connectionTarget:p,onDetachNodeFromGroup:h,isGlobalProcessing:x,isProxy:k,isFocused:C,isGrouped:w,isGroupDragging:f}=e,g=Ut(),{handleOpenNodeContextMenu:v,requestDeleteNodes:_,handleUndockNode:S,selectNode:T,nodeAnimationMode:P,connectedInputTypes:R,handleClearNodeNewFlag:D,isHoverHighlightEnabled:q=!0}=g||{},{t:O}=vt(),E=t.type===z.REROUTE_DOT,A=t.type===z.MEDIA_VIEWER,{rerouteType:N,rerouteDirection:j}=Et.useMemo(()=>{if(!E)return{rerouteType:null,rerouteDirection:"LR"};try{const te=JSON.parse(t.value||"{}");return{rerouteType:te.type||null,rerouteDirection:te.direction||"LR"}}catch{return{rerouteType:null,rerouteDirection:"LR"}}},[E,t.value]),L=y.useMemo(()=>Ri(t.type),[t.type]),M=!!t.dockState&&!k,V=!!t.dockState&&k,H=R==null?void 0:R.get(t.id),F=YT({node:t,onMouseDown:e.onMouseDown,onTouchStart:e.onTouchStart,onResizeMouseDown:e.onResizeMouseDown,onNodeClick:e.onNodeClick,onDetachNodeFromGroup:h,activeTool:o,connectingInfo:u,isDockedWindow:M,isProxyMode:V}),G=XT(t,M,V,E,s,i,L,C,w,f),B=ZT(t,M,V,E,s,i,!!e.isDragging,!!e.isDragOverTarget,(p==null?void 0:p.nodeId)===t.id,!!e.isExecuting,N,C,q),Y=o==="edit"?M?"default":"crosshair":"inherit",ee=o==="cutter"?`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="%23ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>') 12 12, auto`:"default",ie=te=>{if(te.stopPropagation(),te.shiftKey||e.isInstantCloseEnabled){d(t.id);return}_?_([t.id],{x:te.clientX,y:te.clientY}):d(t.id)},ce=te=>{if(te.stopPropagation(),E&&e.onValueChange)try{const ae=JSON.parse(t.value||"{}"),I=ae.direction==="RL"?"LR":"RL";e.onValueChange(t.id,JSON.stringify({...ae,direction:I}))}catch{}},pe=y.useCallback(()=>{t.isNewlyCreated&&D&&D(t.id)},[t.isNewlyCreated,t.id,D]),ue=Et.useCallback((te,ae)=>QT(te,ae,t,E,N,i,u,p),[t,E,N,u,i,p]),re=y.useMemo(()=>({...e,onOutputHandleTouchStart:a,onSaveGeneratedCharacterToCatalog:e.onSaveGeneratedCharacterToCatalog,t:O,getHandleColor:ue,handleCursor:Y,isGlobalProcessing:x,onSelectNode:()=>T&&T(t.id)}),[e,a,O,ue,Y,x,T,t.id]);if(V)return n.jsxs("div",{className:`node-view absolute flex items-center justify-center rounded-lg border-2 border-gray-600 bg-gray-800 text-gray-400 px-4 py-2 shadow-lg select-none cursor-move ${s?"border-node-selected text-accent-text":""}`,style:{...G,zIndex:s?12:10},onMouseUp:F.handleMouseUp,onMouseEnter:()=>l(t.id),onMouseLeave:c,onMouseDown:F.handleDragMouseDown,onTouchStart:F.handleDragTouchStart,onContextMenu:te=>{v&&v(te,t.id)},onWheel:te=>te.stopPropagation(),children:[n.jsx("span",{className:"font-bold text-xs truncate max-w-[140px] pointer-events-none",children:t.title}),n.jsx(Rg,{node:t,getHandleColor:ue,handleCursor:Y,t:O,isHovered:i,isCollapsed:!0,isProxy:!0,connectedInputType:H}),n.jsx(Lg,{node:t,getHandleColor:ue,handleCursor:Y,onOutputHandleMouseDown:r,onOutputHandleTouchStart:a,t:O,isHovered:i,isCollapsed:!0,isProxy:!0})]});(Z=t.dockState)==null||Z.mode;const $=t.isNewlyCreated&&P==="pulse"?"node-pulse-animation":"";return n.jsxs("div",{className:`${B.container} ${$}`,style:{...G,cursor:E&&!M?"move":ee},onMouseUp:F.handleMouseUp,onMouseEnter:()=>l(t.id),onMouseLeave:c,onMouseDown:E?F.handleDragMouseDown:void 0,onMouseDownCapture:pe,onTouchStartCapture:pe,onTouchStart:E?F.handleDragTouchStart:void 0,onWheel:te=>te.stopPropagation(),children:[t.isNewlyCreated&&P==="blade-runner"&&!M&&!V&&n.jsx("div",{className:"new-node-ring"}),E&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none transition-transform duration-300",style:{transform:j==="RL"?"rotate(180deg)":"rotate(0deg)"},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})}),n.jsx(J3,{node:t,isDockedWindow:M,isRerouteDot:E,headerBgClass:B.header,onMouseDown:F.handleHeaderMouseDown,onTouchStart:!E&&!M?F.handleDragTouchStart:void 0,onMouseUp:F.handleHeaderMouseUp,onDoubleClick:E?ce:te=>F.handleHeaderDoubleClick(te,e.onToggleCollapse),onToggleCollapse:e.onToggleCollapse,onRenameNode:e.onRenameNode,onDeleteNode:d,onCutConnections:e.onCutConnections,onDuplicateNode:e.onDuplicateNode,onDuplicateNodeWithContent:e.onDuplicateNodeWithContent,onCopyNodeValue:e.onCopyNodeValue,onPasteNodeValue:e.onPasteNodeValue,onPasteImage:e.onPasteImage,onDownloadImage:e.onDownloadImage,onRefreshImageEditor:e.onRefreshImageEditor,onRefreshChat:e.onRefreshChat,onValueChange:e.onValueChange,clearImagesForNodeFromCache:e.clearImagesForNodeFromCache,addToast:e.addToast,getEmptyValueForNodeType:Gi,onSaveSequenceToCatalog:e.onSaveSequenceToCatalog,onSaveScriptToDisk:e.onSaveScriptToDisk,onSaveCharacterToCatalog:e.onSaveCharacterToCatalog,onSaveCharacterCard:e.onSaveCharacterCard,handleUndockNode:S,handleOpenNodeContextMenu:v,handleRequestDelete:ie,handleDetachNodeFromGroup:h,isInstantCloseEnabled:e.isInstantCloseEnabled}),A?n.jsx("div",{className:`p-3 flex-grow min-h-0 flex flex-col ${t.isCollapsed?"hidden":"flex"}`,onMouseDown:te=>{te.stopPropagation(),T&&T(t.id)},children:n.jsx(a0,{node:t,contentProps:re})}):!E&&!t.isCollapsed&&n.jsx("div",{className:"p-3 flex-grow min-h-0",onMouseDown:te=>{te.stopPropagation(),T&&T(t.id)},children:n.jsx(a0,{node:t,contentProps:re})}),!M&&!C&&n.jsx(Rg,{node:t,getHandleColor:ue,handleCursor:Y,t:O,isHovered:i,isCollapsed:t.isCollapsed,isProxy:V,connectedInputType:H}),!M&&!C&&n.jsx(Lg,{node:t,getHandleColor:ue,handleCursor:Y,onOutputHandleMouseDown:r,onOutputHandleTouchStart:a,t:O,isHovered:i,isCollapsed:t.isCollapsed,isProxy:V}),!E&&!t.isCollapsed&&(!M&&!C?n.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 cursor-se-resize group",onPointerDown:te=>F.handleResizeMouseDown(te,void 0),children:n.jsxs("svg",{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-full h-full text-gray-700 group-hover:text-cyan-400 transition-colors",children:[n.jsx("path",{d:"M12 6L6 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),n.jsx("path",{d:"M14 10L10 14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}):M&&!C&&n.jsxs(n.Fragment,{children:[n.jsx("div",{onPointerDown:te=>F.handleResizeMouseDown(te,"n"),className:"absolute top-0 left-0 w-full h-2 cursor-ns-resize z-20"}),n.jsx("div",{onPointerDown:te=>F.handleResizeMouseDown(te,"s"),className:"absolute bottom-0 left-0 w-full h-2 cursor-ns-resize z-20"}),n.jsx("div",{onPointerDown:te=>F.handleResizeMouseDown(te,"w"),className:"absolute top-0 left-0 w-2 h-full cursor-ew-resize z-20"}),n.jsx("div",{onPointerDown:te=>F.handleResizeMouseDown(te,"e"),className:"absolute top-0 right-0 w-2 h-full cursor-ew-resize z-20"}),n.jsx("div",{onPointerDown:te=>F.handleResizeMouseDown(te,"nw"),className:"absolute top-0 left-0 w-4 h-4 cursor-nwse-resize z-30"}),n.jsx("div",{onPointerDown:te=>F.handleResizeMouseDown(te,"ne"),className:"absolute top-0 right-0 w-4 h-4 cursor-nesw-resize z-30"}),n.jsx("div",{onPointerDown:te=>F.handleResizeMouseDown(te,"sw"),className:"absolute bottom-0 left-0 w-4 h-4 cursor-nesw-resize z-30"}),n.jsx("div",{onPointerDown:te=>F.handleResizeMouseDown(te,"se"),className:"absolute bottom-0 right-0 w-4 h-4 cursor-nwse-resize z-30"})]}))]})},Zc=Et.memo(eI),tI=({connection:e,fromNode:t,toNode:o,start:r,end:a,isNodeHovered:i,activeTool:s,onDelete:l,onSplit:c,lineStyle:d})=>{const{isConnectionAnimationEnabled:u,connectionOpacity:p}=Ut()||{isConnectionAnimationEnabled:!0,connectionOpacity:.4},[h,x]=y.useState(!1),k=E=>{const A=E.isCollapsed?Nn:E.height;return{x:E.position.x,y:E.position.y,width:E.width,height:A,right:E.position.x+E.width,bottom:E.position.y+A}},w=d==="orthogonal"?((E,A,N,j)=>{const L=k(N),M=k(j),V=I=>{if(I.type!==z.REROUTE_DOT)return 1;try{return JSON.parse(I.value||"{}").direction==="RL"?-1:1}catch{return 1}},H=I=>{if(I.type!==z.REROUTE_DOT)return-1;try{return JSON.parse(I.value||"{}").direction==="RL"?1:-1}catch{return-1}},F=V(N),G=H(j),B=20,Y=A.x>E.x&&F===1&&G===-1,ee=A.x<E.x&&F===-1&&G===1,ie=N.type===z.REROUTE_DOT||j.type===z.REROUTE_DOT,ce=ie?30:150;if(Y&&A.x<E.x+ce||!ie&&ee&&A.x>E.x-400){const I=(E.x+A.x)/2;return`M ${E.x} ${E.y} L ${I} ${E.y} L ${I} ${A.y} L ${A.x} ${A.y}`}const pe=0,ue=[`M ${E.x} ${E.y}`];let re=E.x+F*B,$=E.y;ue.push(`L ${re} ${$}`);const Z=A.x+G*B,te=A.y;if(F===1&&G===-1&&Z>re||F===-1&&G===1&&Z<re)if(j.type===z.REROUTE_DOT)ue.push(`L ${re} ${te}`),ue.push(`L ${Z} ${te}`);else if(N.type===z.REROUTE_DOT)ue.push(`L ${Z} ${$}`),ue.push(`L ${Z} ${te}`);else{const I=(re+Z)/2;ue.push(`L ${I} ${$}`),ue.push(`L ${I} ${te}`),ue.push(`L ${Z} ${te}`)}else if(ie&&F===G){let I=0;F===-1?I=Math.min(re,Z):I=Math.max(re,Z),ue.push(`L ${I} ${$}`),ue.push(`L ${I} ${te}`),ue.push(`L ${Z} ${te}`)}else{let I=0;M.bottom+pe<L.y?I=(M.bottom+L.y)/2:M.y>L.bottom+pe?I=(L.bottom+M.y)/2:A.y<E.y?I=Math.min(L.y,M.y)-B:I=Math.max(L.bottom,M.bottom)+B,ue.push(`L ${re} ${I}`),ue.push(`L ${Z} ${I}`),ue.push(`L ${Z} ${te}`)}return ue.push(`L ${A.x} ${A.y}`),ue.join(" ")})(r,a,t,o):`M ${r.x} ${r.y} C ${r.x+80} ${r.y}, ${a.x-80} ${a.y}, ${a.x} ${a.y}`,f=Kn(t,e.fromHandleId),g="#6b7280";let v;switch(f){case"text":v="var(--color-connection-text)";break;case"image":v="var(--color-connection-image)";break;case"character_data":v="var(--color-connection-character)";break;case"video":v="var(--color-connection-video)";break;case"audio":v="var(--color-connection-audio)";break;default:v=g}const _=s==="cutter",S=s==="reroute",T=(_||S)&&(h||i),P=_&&T?"#ef4444":S&&T?"#06b6d4":v,R=T?1:p,D=T?5:3;let q="default";_&&(h||i)?q=`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="%23ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>') 12 12, auto`:S&&h?q="crosshair":(_||S)&&(q="pointer");const O=E=>{E.stopPropagation(),_?l(e.id):S&&c(e.id)};return n.jsxs("g",{className:"connection-view",onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),onMouseDown:O,onTouchStart:O,style:{cursor:q,pointerEvents:"auto"},children:[n.jsx("path",{d:w,stroke:"transparent",strokeWidth:"20",fill:"none",style:{pointerEvents:"stroke"}}),n.jsx("path",{d:w,stroke:P,strokeWidth:D,fill:"none",style:{pointerEvents:"none",opacity:R,transition:"stroke 0.2s ease-in-out, stroke-width 0.2s ease-in-out, opacity 0.2s ease-in-out"}}),u&&n.jsx("path",{d:w,stroke:v,strokeWidth:3,fill:"none",className:"connection-flow",style:{pointerEvents:"none",opacity:1}})]})},nI=Et.memo(tI),oI=({group:e,onMouseDown:t,onTouchStart:o,onClose:r,onRename:a,onSaveToCatalog:i,onSaveToDisk:s,onCopy:l,onDuplicate:c,isHoveredForDrop:d,isDragging:u})=>{const{t:p}=vt(),x=d||u?"border-solid border-node-selected shadow-[0_0_15px_rgba(34,211,238,0.15)]":"border-dashed border-gray-500";return n.jsx("div",{className:`group-view absolute bg-white/5 border-2 ${x} rounded-lg transition-colors duration-200 pointer-events-none`,style:{left:e.position.x,top:e.position.y,width:e.width,height:e.height,zIndex:u?490:5},children:n.jsxs("div",{className:"bg-gray-700/50 text-white font-bold p-2 rounded-t-md flex justify-between items-center cursor-move pointer-events-auto",onMouseDown:t,onTouchStart:o,onDoubleClick:()=>a(e.id,e.title),children:[n.jsx("span",{className:"truncate pr-2",children:e.title}),n.jsxs("div",{className:"flex items-center space-x-1",onMouseDown:C=>C.stopPropagation(),onTouchStart:C=>C.stopPropagation(),onDoubleClick:C=>C.stopPropagation(),children:[n.jsx(Ne,{title:p("group.rename"),onClick:()=>a(e.id,e.title),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),n.jsx(Ne,{title:p("node.action.copy"),onClick:()=>l&&l(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),n.jsx(Ne,{title:p("group.duplicate"),onClick:()=>c&&c(e.id),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:[n.jsx("rect",{x:"5",y:"5",width:"14",height:"14",rx:"2",ry:"2"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m-3-3h6"})]})}),n.jsx(Ne,{title:p("group.saveToCatalog"),onClick:()=>i(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})}),n.jsx(Ne,{title:p("group.saveToDisk"),onClick:()=>s(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Ne,{title:p("group.ungroup"),onClick:C=>r(e.id,C),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})})},rI=Et.memo(oI),Co=({title:e,onClick:t,isActive:o=!1,children:r,hoverColor:a,vertical:i=!1})=>{const s=o?"bg-accent text-white shadow-md shadow-accent/20":`bg-gray-700 ${a||"hover:bg-accent hover:text-white"} text-gray-300`;return n.jsxs("div",{className:"relative group flex items-center",children:[n.jsx("button",{onClick:t,className:`p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 ${s}`,children:r}),n.jsx("div",{className:`absolute ${i?"left-full ml-2 top-1/2 -translate-y-1/2":"bottom-full left-1/2 -translate-x-1/2 mb-2"} px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 opacity-0 pointer-events-none group-hover:opacity-100`,role:"tooltip",children:e})]})},aI=({isSnapToGrid:e,onSnapToGridChange:t,lineStyle:o,onLineStyleChange:r,zoom:a,onZoomChange:i,scaleToSliderValue:s,sliderValueToScale:l,onClearCanvas:c,onSaveCanvas:d,onLoadCanvas:u,activeTool:p,onToolChange:h,isSmartGuidesEnabled:x,onSmartGuidesChange:k,onResetView:C,vertical:w=!1})=>{const{t:f}=vt(),g=s(a),v=T=>{i(l(Number(T.target.value)))},_=w?"flex flex-col-reverse items-center gap-2 select-none":"flex items-center space-x-2 select-none",S=w?"flex flex-col-reverse items-center gap-1":"flex items-center space-x-1";return n.jsxs("div",{className:_,children:[n.jsxs("div",{className:S,children:[C&&n.jsx(Co,{title:f("toolbar.resetCamera"),onClick:C,vertical:w,children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),n.jsx(Co,{title:f("toolbar.zoom"),onClick:()=>h("zoom"),isActive:p==="zoom",vertical:w,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),!w&&n.jsxs("div",{className:"relative group flex items-center",children:[n.jsx("input",{type:"range",min:"-100",max:"100",step:"1",value:g,onChange:v,className:"w-24 h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-accent"}),n.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 opacity-0 pointer-events-none group-hover:opacity-100",role:"tooltip",children:"Zoom"})]}),n.jsx(Co,{title:f("toolbar.resetZoom"),onClick:()=>i(1),vertical:w,children:n.jsxs("span",{className:"text-xs font-semibold select-none",children:[Math.round(a*100),"%"]})})]}),!w&&n.jsx("div",{className:"w-px h-6 bg-gray-700 mx-1"}),w&&n.jsx("div",{className:"h-px w-6 bg-gray-700 my-1"}),n.jsxs("div",{className:S,children:[n.jsx(Co,{title:`${f("toolbar.snapToGrid")} (Shift+W)`,onClick:t,isActive:e,vertical:w,children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 24 24",children:[n.jsx("circle",{cx:"6",cy:"6",r:"1.5"}),n.jsx("circle",{cx:"12",cy:"6",r:"1.5"}),n.jsx("circle",{cx:"18",cy:"6",r:"1.5"}),n.jsx("circle",{cx:"6",cy:"12",r:"1.5"}),n.jsx("circle",{cx:"12",cy:"12",r:"1.5"}),n.jsx("circle",{cx:"18",cy:"12",r:"1.5"}),n.jsx("circle",{cx:"6",cy:"18",r:"1.5"}),n.jsx("circle",{cx:"12",cy:"18",r:"1.5"}),n.jsx("circle",{cx:"18",cy:"18",r:"1.5"})]})}),n.jsx(Co,{title:`${f("toolbar.smartGuides")} (Shift+L)`,onClick:k,isActive:x,vertical:w,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"4 4",d:"M12 3v18M3 12h18"})})}),n.jsx(Co,{title:`${f("toolbar.lineStyleSpaghetti")} (Shift+E)`,onClick:()=>r("spaghetti"),isActive:o==="spaghetti",vertical:w,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4c16 0 0 16 16 16"})})}),n.jsx(Co,{title:`${f("toolbar.lineStyleOrthogonal")} (Shift+E)`,onClick:()=>r("orthogonal"),isActive:o==="orthogonal",vertical:w,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8h8v8h8"})})})]}),!w&&n.jsx("div",{className:"w-px h-6 bg-gray-700 mx-1"}),w&&n.jsx("div",{className:"h-px w-6 bg-gray-700 my-1"}),n.jsxs("div",{className:S,children:[n.jsx(Co,{title:f("toolbar.clearCanvas"),onClick:c,hoverColor:"hover:bg-red-600",vertical:w,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})}),!w&&n.jsx("div",{className:"w-px h-6 bg-gray-700 mx-1"}),w&&n.jsx("div",{className:"h-px w-6 bg-gray-700 my-1"}),n.jsx(Co,{title:f("toolbar.saveCanvas"),onClick:d,vertical:w,children:n.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"square",strokeLinejoin:"miter",children:[n.jsx("path",{d:"M17.2928932,3.29289322 L21,7 L21,20 C21,20.5522847 20.5522847,21 20,21 L4,21 C3.44771525,21 3,20.5522847 3,20 L3,4 C3,3.44771525 3.44771525,3 4,3 L16.5857864,3 C16.8510029,3 17.1053568,3.10535684 17.2928932,3.29289322 Z"}),n.jsx("rect",{width:"10",height:"8",x:"7",y:"13"}),n.jsx("rect",{width:"8",height:"5",x:"8",y:"3"})]})}),n.jsx(Co,{title:f("toolbar.loadCanvas"),onClick:u,vertical:w,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z"})})})]})]})},Cs=({title:e,onClick:t,isActive:o=!1,children:r})=>{const a=o?"bg-accent text-white shadow-md shadow-accent/20":"bg-gray-700 hover:bg-accent hover:text-white text-gray-300";return n.jsxs("div",{className:"relative group flex items-center",children:[n.jsx("button",{onClick:t,"aria-label":e,className:`p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 ${a}`,children:r}),n.jsx("div",{className:"absolute left-full ml-3 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 opacity-0 pointer-events-none group-hover:opacity-100",role:"tooltip",children:e})]})},iI=({activeTool:e,onToolChange:t})=>{const{t:o}=vt(),[r,a]=y.useState(56),i=y.useRef(!1),s=y.useRef({y:0,initialTop:0}),l=y.useRef(null),c=p=>{p.preventDefault(),p.stopPropagation(),i.current=!0,s.current={y:p.clientY,initialTop:r},p.currentTarget.setPointerCapture(p.pointerId)},d=p=>{var f;if(!i.current)return;const h=p.clientY-s.current.y;let x=s.current.initialTop+h;const k=56,C=window.innerHeight,w=((f=l.current)==null?void 0:f.offsetHeight)||0;x<k&&(x=k),x+w>C-k&&(x=C-w-k),a(x)},u=p=>{i.current=!1,p.currentTarget.releasePointerCapture(p.pointerId)};return n.jsxs("div",{ref:l,onMouseDown:p=>p.stopPropagation(),style:{top:`${r}px`},className:"absolute left-2 z-20 bg-gray-900/50 backdrop-blur-md p-1 rounded-lg shadow-lg flex flex-col items-center gap-1 border border-gray-700",children:[n.jsx("div",{onPointerDown:c,onPointerMove:d,onPointerUp:u,className:"w-full h-3 flex items-center justify-center cursor-ns-resize group hover:bg-gray-800/50 rounded-t-lg -mt-0.5",title:"Drag vertically",children:n.jsx("div",{className:"w-6 h-1 bg-gray-600 rounded-full group-hover:bg-gray-400 transition-colors"})}),n.jsx(Cs,{title:o("toolbar.edit"),onClick:()=>t("edit"),isActive:e==="edit",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})}),n.jsx(Cs,{title:o("toolbar.cutter"),onClick:()=>t("cutter"),isActive:e==="cutter",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(Cs,{title:o("toolbar.selection"),onClick:()=>t("selection"),isActive:e==="selection",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"4 4",d:"M3.75 3.75h16.5v16.5H3.75z"})})}),n.jsx(Cs,{title:o("toolbar.reroute"),onClick:()=>t("reroute"),isActive:e==="reroute",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})})]})},Ht=({title:e,onClick:t,isActive:o=!1,children:r,hoverColorClass:a})=>{const i="p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9",s="bg-accent text-white shadow-lg shadow-accent/20",l=`bg-gray-700 ${a||"hover:bg-accent hover:text-white"} text-gray-300`;return n.jsxs("div",{className:"relative group flex items-center",children:[n.jsx("button",{onClick:t,"aria-label":e,className:`${i} ${o?s:l}`,children:r}),n.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 opacity-0 pointer-events-none group-hover:opacity-100",role:"tooltip",children:e})]})},ko=({title:e,children:t,isDetached:o,hoverColorClass:r,titleColorClass:a,isCompact:i})=>n.jsxs("div",{className:"flex flex-col items-center",children:[!o&&!i&&n.jsx("span",{className:`text-xs font-semibold mb-1 select-none ${a||"text-gray-400"}`,children:e}),n.jsx("div",{className:"flex items-center space-x-1",children:Et.Children.map(t,l=>Et.isValidElement(l)?Et.cloneElement(l,{hoverColorClass:r}):l)})]}),sI=({onAddNode:e,onOpenSearch:t,onToggleCatalog:o,onSaveCanvas:r,onLoadCanvas:a,isDetached:i,onSaveProject:s,isCompact:l})=>{const{t:c}=vt(),d=Ut(),{tutorialStep:u,advanceTutorial:p,skipTutorial:h,handleSaveToDrive:x,isGoogleDriveSaving:k}=d||{},C=i?"grid grid-cols-3 gap-2":"flex items-center flex-wrap justify-center gap-2";return n.jsxs("div",{className:C,children:[n.jsx(qn,{content:c("tutorial.group.catalog"),isActive:u==="toolbar_group_catalog",position:"top",onNext:p,onSkip:h,children:n.jsxs(ko,{title:c("toolbar.group.catalog"),isDetached:i,isCompact:l,children:[n.jsx(Ht,{title:c("toolbar.addNode"),onClick:t,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),n.jsx(Ht,{title:c("toolbar.catalog"),onClick:o,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})})})]})}),n.jsx(qn,{content:c("tutorial.group.general"),isActive:u==="toolbar_group_general",position:"top",onNext:p,onSkip:h,children:n.jsxs(ko,{title:c("toolbar.group.general"),isDetached:i,isCompact:l,children:[n.jsx(Ht,{title:c("toolbar.addNote"),onClick:w=>e(z.NOTE,w),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),n.jsx(Ht,{title:c("toolbar.addDataReader"),onClick:w=>e(z.DATA_READER,w),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})}),n.jsx(qn,{content:c("tutorial.group.input"),isActive:u==="toolbar_group_input",position:"top",onNext:p,onSkip:h,children:n.jsxs(ko,{title:c("toolbar.group.input"),isDetached:i,isCompact:l,children:[n.jsx(Ht,{title:c("toolbar.addTextInput"),onClick:w=>e(z.TEXT_INPUT,w),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 6h10M12 6v12"})})}),n.jsx(Ht,{title:c("toolbar.addImageInput"),onClick:w=>e(z.IMAGE_INPUT,w),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{d:"M21 15l-5-5L5 21"})]})}),n.jsx(Ht,{title:c("search.node.media_viewer.title"),onClick:w=>e(z.MEDIA_VIEWER,w),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})}),n.jsx(Ht,{title:c("toolbar.addPromptSequenceEditor"),onClick:w=>e(z.PROMPT_SEQUENCE_EDITOR,w),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z"})})})]})}),n.jsx(qn,{content:c("tutorial.group.processing"),isActive:u==="toolbar_group_processing",position:"top",onNext:p,onSkip:h,children:n.jsxs(ko,{title:c("toolbar.group.processing"),isDetached:i,isCompact:l,children:[n.jsx(Ht,{title:c("toolbar.addImageAnalyzer"),onClick:w=>e(z.IMAGE_ANALYZER,w),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12.792V5.25a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 5.25v13.5A2.25 2.25 0 005.25 21h7.55"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 18.375L21 21"})]})}),n.jsx(Ht,{title:c("toolbar.addPromptAnalyzer"),onClick:w=>e(z.PROMPT_ANALYZER,w),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})}),n.jsx(Ht,{title:c("toolbar.addPromptProcessor"),onClick:w=>e(z.PROMPT_PROCESSOR,w),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})})]})}),n.jsx(qn,{content:c("tutorial.group.character"),isActive:u==="toolbar_group_character",position:"top",onNext:p,onSkip:h,children:n.jsxs(ko,{title:c("toolbar.group.character"),isDetached:i,isCompact:l,children:[n.jsx(Ht,{title:c("toolbar.addCharacterGenerator"),onClick:w=>e(z.CHARACTER_GENERATOR,w),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})})}),n.jsx(Ht,{title:c("toolbar.addCharacterAnalyzer"),onClick:w=>e(z.CHARACTER_ANALYZER,w),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})}),n.jsx(Ht,{title:c("toolbar.addCharacterCard"),onClick:w=>e(z.CHARACTER_CARD,w),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 8a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5a7.5 7.5 0 0115 0"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.5a.75.75 0 00-.75.75v13.5c0 .414.336.75.75.75h16.5a.75.75 0 00.75-.75V5.25a.75.75 0 00-.75-.75H3.75z"})]})}),n.jsx(Ht,{title:c("search.node.pose_creator.title"),onClick:w=>e(z.POSE_CREATOR,w),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})})]})}),n.jsx(qn,{content:c("tutorial.group.output"),isActive:u==="toolbar_group_output",position:"top",onNext:p,onSkip:h,children:n.jsxs(ko,{title:c("toolbar.group.output"),isDetached:i,isCompact:l,children:[n.jsx(Ht,{title:c("toolbar.addImageOutput"),onClick:w=>e(z.IMAGE_OUTPUT,w),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})}),n.jsx(Ht,{title:c("toolbar.addImageEditor"),onClick:w=>e(z.IMAGE_EDITOR,w),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-5 h-5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]})}),n.jsx(Ht,{title:c("toolbar.addImageSequenceGenerator"),onClick:w=>e(z.IMAGE_SEQUENCE_GENERATOR,w),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})})})]})}),n.jsx(qn,{content:c("tutorial.group.ai"),isActive:u==="toolbar_group_ai",position:"top",onNext:p,onSkip:h,children:n.jsxs(ko,{title:c("toolbar.group.aiTools"),isDetached:i,isCompact:l,children:[n.jsx(Ht,{title:c("toolbar.addTranslator"),onClick:w=>e(z.TRANSLATOR,w),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})}),n.jsx(Ht,{title:c("toolbar.addGeminiChat"),onClick:w=>e(z.GEMINI_CHAT,w),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})}),n.jsx(qn,{content:c("tutorial.group.scripts"),isActive:u==="toolbar_group_scripts",position:"top",onNext:p,onSkip:h,children:n.jsxs(ko,{title:c("toolbar.group.scripts"),isDetached:i,isCompact:l,children:[n.jsx(Ht,{title:c("toolbar.addScriptGenerator"),onClick:w=>e(z.SCRIPT_GENERATOR,w),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})}),n.jsx(Ht,{title:c("toolbar.addScriptViewer"),onClick:w=>e(z.SCRIPT_VIEWER,w),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 19.82a2.25 2.25 0 01-1.897 1.13l-2.685.8.8-2.685a2.25 2.25 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})})]})}),n.jsx(qn,{content:c("tutorial.group.video"),isActive:u==="toolbar_group_video",position:"top",onNext:p,onSkip:h,children:n.jsxs(ko,{title:c("toolbar.group.video"),isDetached:i,isCompact:l,children:[n.jsx(Ht,{title:c("toolbar.addVideoPromptProcessor"),onClick:w=>e(z.VIDEO_PROMPT_PROCESSOR,w),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7l-2 4 4 2-4 2-2 4-2-4-4-2 4-2z"})]})}),n.jsx(Ht,{title:c("toolbar.addVideoOutput"),onClick:w=>e(z.VIDEO_OUTPUT,w),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9A2.25 2.25 0 0013.5 5.25h-9A2.25 2.25 0 002.25 7.5v9A2.25 2.25 0 004.5 18.75z"})})}),n.jsx(Ht,{title:c("node.title.video_editor"),onClick:w=>e(z.VIDEO_EDITOR,w),children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})]})})]})}),n.jsx(qn,{content:c("tutorial.group.file"),isActive:u==="toolbar_group_file",position:"top",onNext:p,onSkip:h,children:n.jsxs(ko,{title:c("toolbar.group.file"),isDetached:i,isCompact:l,children:[n.jsx(Ht,{title:c("toolbar.saveProject"),onClick:()=>s&&s(),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"})})}),n.jsx(Ht,{title:c("toolbar.saveCanvas"),onClick:r,children:n.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"square",strokeLinejoin:"miter",children:[n.jsx("path",{d:"M17.2928932,3.29289322 L21,7 L21,20 C21,20.5522847 20.5522847,21 20,21 L4,21 C3.44771525,21 3,20.5522847 3,20 L3,4 C3,3.44771525 3.44771525,3 4,3 L16.5857864,3 C16.8510029,3 17.1053568,3.10535684 17.2928932,3.29289322 Z"}),n.jsx("rect",{width:"10",height:"8",x:"7",y:"13"}),n.jsx("rect",{width:"8",height:"5",x:"8",y:"3"})]})}),n.jsx(Ht,{title:c("toolbar.loadCanvas"),onClick:a,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z"})})})]})})]})},lI=Et.memo(sI),cI=({title:e,children:t,align:o="center"})=>{const r=o==="left"?"left-0 bottom-full mb-2 origin-bottom-left":"left-1/2 -translate-x-1/2 bottom-full mb-2 origin-bottom";return n.jsxs("div",{className:"relative group flex items-center justify-center",children:[t,n.jsx("div",{className:`absolute px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 ease-in-out transform ${r} opacity-0 pointer-events-none group-hover:opacity-100`,role:"tooltip",children:e})]})},dI=()=>{const e=Ut(),{t}=vt(),[o,r]=y.useState(!1),[a,i]=y.useState(!1),[s,l]=y.useState(!1),[c,d]=y.useState(!1),[u,p]=y.useState(0),[h,x]=y.useState({width:window.innerWidth,height:window.innerHeight}),k=y.useCallback(Ve=>{Ve!==null&&p(Ve.getBoundingClientRect().height)},[]);if(y.useEffect(()=>{const Ve=()=>{x({width:window.innerWidth,height:window.innerHeight});const cn=800+450*2;i(window.innerWidth<cn)};return window.addEventListener("resize",Ve),()=>window.removeEventListener("resize",Ve)},[]),!e)return null;const{nodes:C,connections:w,groups:f,viewTransform:g,handleCanvasMouseDown:v,handleCanvasContextMenu:_,handleCanvasTouchStart:S,handleCanvasTouchMove:T,handleCanvasTouchEnd:P,updatePointerPosition:R,handleWheel:D,handleCanvasDoubleClick:q,handleDrop:O,handleDragOver:E,handleDragEnter:A,handleDragLeave:N,getCanvasCursor:j,setCanvasRef:L,dockHoverMode:M,handleDockNode:V,handleUndockNode:H,focusedNodeId:F,selectedNodeIds:G,hoveredNodeId:B,setHoveredNodeId:Y,dragOverNodeId:ee,draggingInfo:ie,connectingInfo:ce,connectionTarget:pe,spawnLine:ue,activeTool:re,setActiveTool:$,effectiveTool:Z,deleteNodeAndConnections:te,removeConnectionsByNodeId:ae,copyNodeValue:I,pasteNodeValue:J,pasteImageToNode:W,handleDownloadImage:U,handleDuplicateNode:Q,handleDuplicateNodeWithContent:de,handleToggleNodeCollapse:se,handleDetachNodeFromGroup:X,handleStartConnection:K,handleStartConnectionTouch:oe,handleNodeCutConnections:ne,handleNodeTouchStart:le,handleGroupMouseDown:ge,handleGroupTouchStart:we,handleRemoveGroup:_e,handleSaveGroupToCatalog:fe,handleSaveGroupToDisk:he,copyGroup:ye,duplicateGroup:Se,hoveredGroupIdForDrop:Te,handleGroupSelection:Ae,handleAlignNodes:Oe,undoPosition:me,redoPosition:ve,canUndo:Ie,canRedo:ke,handleValueChange:je,handleEnhance:Ge,isEnhancing:be,handleEnhanceVideo:Pe,isEnhancingVideo:Ee,onSanitize:Me,isSanitizing:Fe,handleAnalyzePrompt:tt,isAnalyzing:Nt,handleAnalyzeCharacter:xe,isAnalyzingCharacter:Be,handleAnalyzeImage:Le,isAnalyzingImage:Ue,handleGenerateImage:Ze,isGeneratingImage:at,handleExecuteChain:ot,isExecutingChain:rt,stopChainExecution:et,executingNodeId:mt,handleEditImage:xt,isEditingImage:Ct,handleSendMessage:pt,isChatting:dt,handleTranslate:kt,isTranslating:St,handleGenerateScript:Tt,isGeneratingScript:_t,triggerLoadScriptFile:It,handleGenerateCharacters:Io,isGeneratingCharacters:jo,handleGenerateVideo:qt,isGeneratingVideo:Re,handleGenerateImageSequence:qe,onGenerateSelectedFrames:He,isGeneratingSequence:$e,handleStopImageSequence:Qe,isStoppingSequence:Xe,handleRegenerateFrame:Ke,onDownloadImageFromUrl:ft,onCopyImageToClipboard:yt,triggerLoadImageSequenceFile:ht,triggerLoadPromptSequenceFile:wt,handleProcessImage:jt,isProcessingImage:Nr,handleSetImageEditorOutputToInput:Yl,connectedInputs:Xl,connectedImageSources:Zl,connectedCharacterData:Ql,libraryItems:ec,handleProcessChainForward:tc,handleSaveCharacterCard:nc,triggerLoadCharacterCard:oc,handleDetachAndPasteConcept:rc,onDetachImageToNode:ac,onSaveCharacterToCatalog:ic,onSaveScriptToCatalog:sc,onSaveSequenceToCatalog:Ce,setError:ze,setImageViewer:De,addToast:We,getFullSizeImage:nt,setFullSizeImage:Je,clearImagesForNodeFromCache:ut,onTranslateScript:st,isTranslatingScript:Gt,onReadData:At,getUpstreamNodeValues:Ot,onRefreshUpstreamData:Cn,onModifyPromptSequence:an,isModifyingPromptSequence:Xo,onSavePromptToLibrary:Va,onSaveToLibrary:lc,onGenerateCharacterImage:cc,isGeneratingCharacterImage:ty,onDetachCharacter:ny,onStopGeneration:oy,isStopping:ry,clearSelectionsSignal:ay,onSaveScriptToDisk:iy,onSaveMediaToDisk:sy,onSaveGeneratedCharacterToCatalog:ly,isGlobalProcessing:cy,isInstantCloseEnabled:dy,onImageToText:uy,onUpdateCharacterDescription:py,isUpdatingDescription:hy,isSnapToGrid:my,setIsSnapToGrid:gy,lineStyle:Mp,setLineStyle:fy,handleZoomChange:xy,scaleToSliderValue:yy,sliderValueToScale:vy,handleClearCanvas:wy,isSmartGuidesEnabled:by,setIsSmartGuidesEnabled:Cy,resetView:ky,smartGuides:_y,selectionRect:Ao,groupButtonPosition:dc,getConnectionPoints:Sy,removeConnectionById:Ny,handleSplitConnection:Ey,onRefreshChat:Py,handleRefreshImageEditor:Ty,handleAutoDownloadChange:Iy,handleModelChange:jy,handleResolutionChange:Ay,handleAspectRatioChange:My,onRenameCharacter:tj,onRenameScript:nj,onRenameSequence:oj,handleRenameNode:rj,setRenameInfo:Ry,handleToggleNodePin:Ly,onAddNode:Dy,handleOpenQuickSearch:zy,handleToggleCatalog:qy,handleSaveCanvas:Rp,handleLoadCanvas:Lp,handleSaveProject:Oy,getTransformedPoint:Dp,setSpawnLine:uc,tutorialStep:Fy,advanceTutorial:By}=e,Gy=y.useMemo(()=>{const Ve=new Map;return f.forEach(Ft=>{Ft.nodeIds.forEach(nn=>{Ve.set(nn,Ft.id)})}),Ve},[f]),zp=(ie==null?void 0:ie.type)==="group"?ie.id:null,pc=y.useMemo(()=>{const{scale:Ve,translate:Ft}=g,nn=300/Ve,cn={left:-Ft.x/Ve-nn,top:-Ft.y/Ve-nn,right:(h.width-Ft.x)/Ve+nn,bottom:(h.height-Ft.y)/Ve+nn},lo=on=>{if(on.dockState||on.isPinned||(ie==null?void 0:ie.type)==="node"&&ie.offsets.has(on.id))return!0;const Ky=on.isCollapsed?Nn:on.height;return on.position.x<cn.right&&on.position.x+on.width>cn.left&&on.position.y<cn.bottom&&on.position.y+Ky>cn.top},Qn=C.filter(lo),Er=new Set(Qn.map(on=>on.id)),Wy=w.filter(on=>Er.has(on.fromNodeId)||Er.has(on.toNodeId)),$y=f.filter(on=>on.position.x<cn.right&&on.position.x+on.width>cn.left&&on.position.y<cn.bottom&&on.position.y+on.height>cn.top);return{visibleNodes:Qn,visibleConnections:Wy,visibleGroups:$y}},[C,w,f,g,h,ie]),hc=Ve=>{const Ft=Gy.get(Ve.id),nn=!!Ft,cn=!!zp&&Ft===zp;return{key:Ve.id,node:Ve,isGrouped:nn,isGroupDragging:cn,onMouseDown:lo=>e.handleNodeMouseDown(lo,Ve.id),onTouchStart:le,onResizeMouseDown:e.handleNodeResizeMouseDown,onValueChange:je,onEnhance:Ge,isEnhancing:be===Ve.id,onEnhanceVideo:Pe,isEnhancingVideo:Ee===Ve.id,onSanitize:Me,isSanitizing:Fe===Ve.id,onAnalyze:tt,isAnalyzing:Nt===Ve.id,onAnalyzeCharacter:xe,isAnalyzingCharacter:Be===Ve.id,onAnalyzeImage:Le,isAnalyzingImage:Ue===Ve.id,onImageToText:uy,onGenerateImage:Ze,isGeneratingImage:at===Ve.id,onExecuteChain:ot,isExecutingChain:rt,isExecuting:mt===Ve.id,onStopChainExecution:et,onEditImage:xt,isEditingImage:Ct,onSendMessage:pt,isChatting:dt===Ve.id,onTranslate:kt,isTranslating:St===Ve.id,onGenerateScript:Tt,isGeneratingScript:_t===Ve.id,onLoadScriptFile:It,onGenerateCharacters:Io,isGeneratingCharacters:jo===Ve.id,onGenerateVideo:qt,isGeneratingVideo:Re===Ve.id,onGenerateImageSequence:qe,onGenerateSelectedFrames:He,isGeneratingSequence:$e===Ve.id,onStopImageSequence:Qe,isStoppingSequence:Xe,onRegenerateFrame:Ke,onDownloadImageFromUrl:ft,onCopyImageToClipboard:yt,onLoadImageSequenceFile:ht,onLoadPromptSequenceFile:wt,onProcessImage:jt,isProcessingImage:Nr===Ve.id,activeTool:Z,onOutputHandleMouseDown:K,onOutputHandleTouchStart:oe,onNodeClick:ne,isHovered:B===Ve.id,isSelected:G.includes(Ve.id),onNodeMouseEnter:()=>Y(Ve.id),onNodeMouseLeave:()=>Y(null),onDeleteNode:te,onCutConnections:ae,onCopyNodeValue:I,onPasteNodeValue:J,onPasteImage:W,onDownloadImage:U,onDuplicateNode:Q,onDuplicateNodeWithContent:de,onAspectRatioChange:My,onResolutionChange:Ay,onModelChange:jy,onAutoDownloadChange:Iy,onRefreshChat:Py,onRefreshImageEditor:Ty,connectedInputs:Xl.get(Ve.id),onSetImageEditorOutputToInput:Yl,connectingInfo:ce,connectionTarget:pe,connectedImageSources:Zl.get(Ve.id),connectedCharacterData:Ql.get(Ve.id),libraryItems:ec,onToggleCollapse:se,deselectAllNodes:e.deselectAllNodes,isDragOverTarget:ee===Ve.id,onProcessChainForward:tc,onSaveCharacterCard:nc,onLoadCharacterCard:oc,onDetachAndPasteConcept:rc,onDetachImageToNode:ac,onSaveCharacterToCatalog:ic,onSaveScriptToCatalog:sc,onSaveSequenceToCatalog:Ce,setError:ze,setImageViewer:De,addToast:We,getFullSizeImage:nt,setFullSizeImage:Je,clearImagesForNodeFromCache:ut,onTranslateScript:st,isTranslatingScript:Gt,onReadData:At,getUpstreamNodeValues:Ot,onRefreshUpstreamData:Cn,onModifyPromptSequence:an,isModifyingPromptSequence:Xo===Ve.id,onDetachNodeFromGroup:X,viewTransform:Ve.type===z.IMAGE_EDITOR||Ve.type===z.PROMPT_SEQUENCE_EDITOR||Ve.type===z.IMAGE_SEQUENCE_GENERATOR?g:void 0,onSavePromptToLibrary:Va,onSaveToLibrary:lc,onRenameNode:(lo,Qn)=>Ry({type:"node",id:lo,currentTitle:Qn}),onGenerateCharacterImage:cc,isGeneratingCharacterImage:ty,onDetachCharacter:ny,onStopGeneration:oy,isStopping:ry,clearSelectionsSignal:ay,onSaveScriptToDisk:iy,onSaveMediaToDisk:sy,onSaveGeneratedCharacterToCatalog:ly,isDragging:(ie==null?void 0:ie.type)==="node"&&ie.offsets.has(Ve.id),isGlobalProcessing:cy,isInstantCloseEnabled:dy,handleDockNode:V,handleUndockNode:H,onToggleNodePin:Ly,onUpdateCharacterDescription:py,isUpdatingDescription:hy}},{dockedNodes:Hy}=y.useMemo(()=>({dockedNodes:C.filter(Ft=>Ft.dockState)}),[C]),Hi=F?C.find(Ve=>Ve.id===F):null,Uy=(Ve,Ft)=>{const nn={x:window.innerWidth/2,y:window.innerHeight*.25},cn=Dp(nn);Dy(Ve,cn);const lo=Ft?{x:Ft.clientX,y:Ft.clientY}:{x:window.innerWidth/2,y:window.innerHeight-80},Qn=Dp(lo);uc({start:Qn,end:cn,fading:!1}),setTimeout(()=>{uc(Er=>Er?{...Er,fading:!0}:null),setTimeout(()=>uc(null),500)},100)},Vy=Ve=>{switch(Ve){case"text":return"var(--color-connection-text)";case"image":return"var(--color-connection-image)";case"character_data":return"var(--color-connection-character)";case"video":return"var(--color-connection-video)";case"audio":return"var(--color-connection-audio)";default:return"var(--color-border)"}};return n.jsxs("div",{id:"app-container",className:`relative w-full h-full overflow-hidden select-none ${F?"bg-gray-700":""}`,onMouseDown:v,onContextMenu:_,onTouchStart:S,onTouchMove:T,onTouchEnd:P,onMouseMove:R,onWheel:D,onDoubleClick:q,onDrop:O,onDragOver:E,onDragEnter:A,onDragLeave:N,style:{cursor:j()},children:[!F&&n.jsx(iI,{activeTool:Z,onToolChange:$}),!F&&Hy.map(Ve=>n.jsx(Zc,{node:Ve,...hc(Ve)},`${Ve.id}-docked`)),!F&&n.jsxs("div",{id:"canvas-transform-layer",style:{width:"1px",height:"1px",transform:`translate(${g.translate.x}px, ${g.translate.y}px) scale(${g.scale})`,transformOrigin:"0 0"},children:[n.jsxs("div",{className:"absolute top-0 left-0 w-0 h-0 overflow-visible pointer-events-none z-0",children:[n.jsx("div",{className:"absolute top-0 left-[-50000px] w-[100000px] h-[1px] bg-cyan-900/30 -translate-y-1/2"}),n.jsx("div",{className:"absolute left-0 top-[-50000px] w-[1px] h-[100000px] bg-cyan-900/30 -translate-x-1/2"}),n.jsxs("div",{className:"absolute top-0 left-0 w-4 h-4 -translate-x-1/2 -translate-y-1/2 flex items-center justify-center",children:[n.jsx("div",{className:"absolute w-3 h-[2px] bg-accent shadow-[0_0_5px_var(--color-accent)]"}),n.jsx("div",{className:"absolute h-3 w-[2px] bg-accent shadow-[0_0_5px_var(--color-accent)]"})]})]}),Ao&&n.jsx("div",{className:"absolute border-2 border-dashed border-accent-text pointer-events-none",style:{left:Math.min(Ao.start.x,Ao.end.x),top:Math.min(Ao.start.y,Ao.end.y),width:Math.abs(Ao.start.x-Ao.end.x),height:Math.abs(Ao.start.y-Ao.end.y),zIndex:100,backgroundColor:"var(--color-selection)"}}),dc&&n.jsxs("div",{className:"absolute z-20 flex items-center gap-2 -translate-x-1/2",style:{left:dc.x,top:dc.y},onMouseDown:Ve=>Ve.stopPropagation(),onTouchStart:Ve=>Ve.stopPropagation(),children:[n.jsx(ct,{content:t("hotkeys.tools.group"),position:"top",children:n.jsxs("button",{onClick:Ae,className:"px-4 py-2 font-bold text-white bg-accent rounded-md hover:bg-accent-hover transition-all duration-200 shadow-lg flex items-center space-x-2 whitespace-nowrap shadow-accent/20",children:[n.jsx(F3,{}),n.jsx("span",{children:t("group.button.create",{count:G.length})})]})}),n.jsxs("div",{className:"flex bg-gray-800/90 backdrop-blur-md rounded-lg shadow-lg p-1 space-x-1 border border-gray-700",children:[n.jsxs("div",{className:"flex items-center space-x-1 pr-1 border-r border-gray-600 mr-1",children:[n.jsx(ct,{content:t("contextMenu.undoPosition"),position:"top",children:n.jsx("button",{onClick:()=>me&&me(C),disabled:!Ie,className:`p-1.5 rounded transition-colors ${Ie?"text-gray-300 hover:bg-gray-700 hover:text-white":"text-gray-600 cursor-not-allowed"}`,children:n.jsx(I3,{})})}),n.jsx(ct,{content:t("contextMenu.redoPosition"),position:"top",children:n.jsx("button",{onClick:()=>ve&&ve(C),disabled:!ke,className:`p-1.5 rounded transition-colors ${ke?"text-gray-300 hover:bg-gray-700 hover:text-white":"text-gray-600 cursor-not-allowed"}`,children:n.jsx(j3,{})})})]}),n.jsx(ct,{content:t("contextMenu.align.left"),position:"top",children:n.jsx("button",{onClick:()=>Oe(G,"left"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(A3,{})})}),n.jsx(ct,{content:t("contextMenu.align.centerX"),position:"top",children:n.jsx("button",{onClick:()=>Oe(G,"center-x"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(M3,{})})}),n.jsx(ct,{content:t("contextMenu.align.right"),position:"top",children:n.jsx("button",{onClick:()=>Oe(G,"right"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(R3,{})})}),n.jsx("div",{className:"w-px bg-gray-600 mx-1"}),n.jsx(ct,{content:t("contextMenu.align.top"),position:"top",children:n.jsx("button",{onClick:()=>Oe(G,"top"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(L3,{})})}),n.jsx(ct,{content:t("contextMenu.align.centerY"),position:"top",children:n.jsx("button",{onClick:()=>Oe(G,"center-y"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(D3,{})})}),n.jsx(ct,{content:t("contextMenu.align.bottom"),position:"top",children:n.jsx("button",{onClick:()=>Oe(G,"bottom"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(z3,{})})}),G.length>=3&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"w-px bg-gray-600 mx-1"}),n.jsx(ct,{content:t("contextMenu.distribute.horizontal"),position:"top",children:n.jsx("button",{onClick:()=>Oe(G,"distribute-horizontal"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(q3,{})})}),n.jsx(ct,{content:t("contextMenu.distribute.vertical"),position:"top",children:n.jsx("button",{onClick:()=>Oe(G,"distribute-vertical"),className:"p-1.5 hover:bg-accent rounded text-gray-300 hover:text-white",children:n.jsx(O3,{})})})]})]})]}),n.jsxs("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none z-0 overflow-visible",children:[pc.visibleConnections.map(Ve=>{const Ft=C.find(Qn=>Qn.id===Ve.fromNodeId),nn=C.find(Qn=>Qn.id===Ve.toNodeId);if(!Ft||!nn)return null;const{start:cn,end:lo}=Sy(Ft,nn,Ve);return n.jsx(nI,{connection:Ve,fromNode:Ft,toNode:nn,start:cn,end:lo,isNodeHovered:Z==="cutter"&&(B===Ve.fromNodeId||B===Ve.toNodeId),activeTool:Z,onDelete:Ny,onSplit:Ey,lineStyle:Mp},Ve.id)}),ce&&n.jsx("path",{d:`M ${ce.fromPoint.x} ${ce.fromPoint.y} C ${ce.fromPoint.x+80} ${ce.fromPoint.y}, ${e.pointerPosition.x-80} ${e.pointerPosition.y}, ${e.pointerPosition.x} ${e.pointerPosition.y}`,stroke:Vy(ce.fromType),strokeWidth:"3",fill:"none",style:{strokeDasharray:"8 4",pointerEvents:"none"}}),_y.map((Ve,Ft)=>{const nn=Ve.type==="vertical",cn=nn?Ve.position:Ve.start,lo=nn?Ve.start:Ve.position,Qn=nn?Ve.position:Ve.end,Er=nn?Ve.end:Ve.position;return n.jsx("line",{x1:cn,y1:lo,x2:Qn,y2:Er,stroke:"#ec4899",strokeWidth:"1",strokeDasharray:"4 2"},`guide-${Ft}`)})]}),pc.visibleGroups.map(Ve=>n.jsx(rI,{group:Ve,onMouseDown:Ft=>e.handleGroupMouseDown(Ft,Ve.id),onTouchStart:Ft=>e.handleGroupTouchStart(Ft,Ve.id),onClose:_e,onRename:(Ft,nn)=>e.setRenameInfo({type:"group",id:Ft,currentTitle:nn}),onSaveToCatalog:()=>fe(Ve.id),onSaveToDisk:()=>he(Ve.id),onCopy:ye,onDuplicate:Se,isHoveredForDrop:Te===Ve.id,isDragging:(ie==null?void 0:ie.type)==="group"&&ie.id===Ve.id},Ve.id)),pc.visibleNodes.map(Ve=>n.jsx(Zc,{node:Ve,...hc(Ve),isProxy:!!Ve.dockState},Ve.id)),n.jsx("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none z-[15] overflow-visible",children:ue&&n.jsx("path",{d:`M ${ue.start.x} ${ue.start.y} L ${ue.end.x} ${ue.end.y}`,stroke:"var(--color-text-accent)",strokeWidth:"2",fill:"none",style:{strokeDasharray:"6 4",transition:"opacity 0.5s ease-out",opacity:ue.fading?0:1}})})]}),Hi&&n.jsx(Zc,{node:Hi,...hc(Hi),isFocused:!0},`${Hi.id}-focused`),!F&&n.jsxs("div",{className:"absolute left-1/2 z-20 flex flex-col items-center transition-transform duration-300 ease-in-out",style:{bottom:"8px",transform:s?`translate(-50%, calc(100% - ${u>0?u:32}px))`:"translate(-50%, 0)",maxWidth:"calc(100% - 112px)",width:"max-content"},onMouseDown:Ve=>Ve.stopPropagation(),children:[n.jsxs("div",{ref:k,className:"flex items-center justify-center bg-gray-800/90 backdrop-blur-md border border-gray-600 border-b-0 rounded-t-lg shadow-sm overflow-hidden",children:[n.jsx("button",{onClick:Ve=>{Ve.stopPropagation(),d(!c)},className:`px-3 py-1 transition-colors flex items-center justify-center hover:bg-gray-700 focus:outline-none ${c?"text-accent-text":"text-gray-400 hover:text-gray-200"}`,title:c?"Expand Titles":"Compact Mode (Hide Titles)",children:c?n.jsx(kl,{className:"h-3.5 w-3.5"}):n.jsx(Cl,{className:"h-3.5 w-3.5"})}),n.jsx("div",{className:"w-px h-3 bg-gray-600"}),n.jsx("button",{onClick:Ve=>{Ve.stopPropagation(),l(!s)},className:"px-3 py-1 transition-colors flex items-center justify-center hover:bg-gray-700 focus:outline-none text-gray-400 hover:text-gray-200",title:t(s?"toolbar.expandPanel":"toolbar.collapsePanel"),children:n.jsx("div",{className:`transform transition-transform duration-300 ${s?"rotate-180":"rotate-0"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})})]}),n.jsx("div",{className:"bg-gray-900/50 backdrop-blur-md border border-gray-700 rounded-lg p-1 shadow-2xl w-full",children:n.jsx(lI,{onAddNode:Uy,onOpenSearch:()=>zy({x:window.innerWidth/2,y:window.innerHeight/2}),onToggleCatalog:qy,onSaveCanvas:Rp,onLoadCanvas:Lp,onSaveProject:Oy,isDetached:!1,isCompact:c})})]}),!F&&n.jsx("div",{className:"absolute bottom-2 left-2 z-20 pointer-events-auto",onMouseDown:Ve=>Ve.stopPropagation(),children:n.jsx("div",{className:"bg-gray-900/50 backdrop-blur-md p-1 rounded-lg border border-gray-700 shadow-lg",children:n.jsxs("div",{className:`flex ${a?"flex-col-reverse items-start gap-2":"flex-row items-center space-x-2"}`,children:[n.jsx(cI,{title:t(o?"toolbar.expandPanel":"toolbar.collapsePanel"),align:"left",children:n.jsx("button",{onClick:()=>r(Ve=>!Ve),className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300",children:o?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})})}),!o&&n.jsx(aI,{isSnapToGrid:my,onSnapToGridChange:()=>gy(Ve=>!Ve),lineStyle:Mp,onLineStyleChange:fy,zoom:g.scale,onZoomChange:xy,scaleToSliderValue:yy,sliderValueToScale:vy,onClearCanvas:wy,onSaveCanvas:Rp,onLoadCanvas:Lp,activeTool:Z,onToolChange:$,isSmartGuidesEnabled:by,onSmartGuidesChange:()=>Cy(Ve=>!Ve),onResetView:ky,vertical:a})]})})}),Fy==="tutorial_success_message"&&n.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/70 backdrop-blur-sm animate-fade-in",children:n.jsxs("div",{className:"bg-gray-800 rounded-2xl shadow-2xl border-2 border-cyan-500 p-8 max-w-md text-center transform scale-100 transition-all",children:[n.jsx("div",{className:"w-20 h-20 bg-cyan-900/50 rounded-full flex items-center justify-center mx-auto mb-6 ring-4 ring-cyan-500/30",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-cyan-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),n.jsx("h2",{className:"text-3xl font-bold text-white mb-4",children:t("tutorial.success.title")}),n.jsx("p",{className:"text-gray-300 mb-8 text-lg leading-relaxed",children:t("tutorial.success.message")}),n.jsx("button",{onClick:By,className:"w-full py-4 text-xl font-bold text-white bg-gradient-to-r from-cyan-600 to-blue-600 rounded-xl hover:from-cyan-500 hover:to-blue-500 transition-all transform hover:scale-105 shadow-lg shadow-cyan-900/50",children:t("tutorial.success.button")})]})})]})},i0="helpPanelPosition",zn=({title:e,url:t,icon:o,colorClass:r,description:a,hoverClass:i})=>{const{t:s}=vt(),[l,c]=y.useState(!1),d=p=>{p.stopPropagation(),navigator.clipboard.writeText(t),c(!0),setTimeout(()=>c(!1),2e3)},u=()=>{window.open(t,"_blank","noopener,noreferrer")};return n.jsxs("div",{onClick:u,className:"group relative flex items-center justify-between bg-gray-900/40 p-3 rounded-xl border border-gray-700/50 hover:border-gray-600 transition-all duration-200 hover:bg-gray-800/60 cursor-pointer",children:[n.jsxs("div",{className:"flex items-center gap-4 overflow-hidden",children:[n.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center bg-gray-800 border border-gray-700 shadow-sm shrink-0 ${r}`,children:o}),n.jsxs("div",{className:"flex flex-col min-w-0",children:[n.jsx("span",{className:`font-bold text-gray-200 text-sm truncate transition-colors ${i||"group-hover:text-cyan-400"}`,children:e}),a&&n.jsx("span",{className:"text-[10px] text-gray-500 uppercase font-bold tracking-wider",children:a}),n.jsx("span",{className:"text-[10px] text-gray-600 truncate font-mono mt-0.5 group-hover:text-gray-500 transition-colors",children:t})]})]}),n.jsxs("div",{className:"flex items-center gap-2 pl-2",children:[n.jsx(ct,{content:s(l?"help.copied":"help.copyLink"),position:"top",children:n.jsx("button",{onClick:d,className:"p-2 rounded-lg bg-gray-800 text-gray-400 hover:text-white hover:bg-gray-700 border border-transparent hover:border-gray-600 transition-all focus:outline-none",children:l?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):n.jsx(Dt,{className:"h-4 w-4"})})}),n.jsx("div",{className:`p-2 text-gray-600 transition-colors ${i?i.replace("text-","text-opacity-80 text-"):"group-hover:text-cyan-500"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})})]})]})},ea=({title:e,colorClass:t})=>n.jsxs("div",{className:"flex items-center gap-2 mb-3 mt-4 first:mt-0",children:[n.jsx("div",{className:"h-px bg-gray-700 flex-grow"}),n.jsx("span",{className:`text-xs font-bold uppercase tracking-widest ${t||"text-gray-500"}`,children:e}),n.jsx("div",{className:"h-px bg-gray-700 flex-grow"})]}),ks=n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{d:"M12.48 10.92v3.28h7.84c-.24 1.84-.853 3.187-1.787 4.133-1.147 1.147-2.933 2.4-6.053 2.4-4.827 0-8.6-3.893-8.6-8.72s3.773-8.72 8.6-8.72c2.6 0 4.507 1.027 5.907 2.347l2.307-2.307C18.747 1.44 16.133 0 12.48 0 5.867 0 .307 5.387.307 12s5.56 12 12.173 12c3.573 0 6.267-1.173 8.373-3.36 2.16-2.16 2.84-5.213 2.84-7.667 0-.76-.053-1.467-.173-2.053H12.48z"})}),uI=()=>{const{t:e}=vt(),[t,o]=y.useState(!1),[r,a]=y.useState(!1),[i,s]=y.useState("hotkeys"),[l,c]=y.useState(!1),d=y.useRef(null),u=y.useRef(null),[p,h]=y.useState({x:0,y:0}),x=y.useRef({x:0,y:0}),k=y.useRef(!1),C=y.useRef(p);y.useEffect(()=>{C.current=p},[p]),y.useEffect(()=>{if(t){a(!0);const S=localStorage.getItem(i0);if(S)try{const T=JSON.parse(S);if(typeof T.x=="number"&&typeof T.y=="number")h(T);else throw new Error("Invalid pos")}catch{h({x:Math.max(0,window.innerWidth/2-300),y:Math.max(0,window.innerHeight/2-360)})}else if(u.current){const T=u.current.getBoundingClientRect(),P=window.innerWidth,R=window.innerHeight,D=600,q=720;let O=T.left;O+D>P&&(O=P-D-20),O=Math.max(20,O);let E=T.bottom+10;E+q>R&&(E=Math.max(20,R-q-20)),h({x:O,y:E})}else h({x:Math.max(0,window.innerWidth/2-300),y:Math.max(0,window.innerHeight/2-360)})}else{const S=setTimeout(()=>a(!1),200);return()=>clearTimeout(S)}},[t]),y.useEffect(()=>{if(!t)return;const S=T=>{d.current&&d.current.contains(T.target)||u.current&&u.current.contains(T.target)||o(!1)};return document.addEventListener("mousedown",S),()=>{document.removeEventListener("mousedown",S)}},[t]),y.useEffect(()=>{const S=T=>{T.key==="F1"&&(T.preventDefault(),o(P=>!P))};return window.addEventListener("keydown",S),()=>window.removeEventListener("keydown",S)},[]);const w=S=>{S.target.closest("button")||(S.preventDefault(),S.stopPropagation(),k.current=!0,x.current={x:S.clientX-p.x,y:S.clientY-p.y},S.currentTarget.setPointerCapture(S.pointerId))},f=S=>{k.current&&(S.preventDefault(),S.stopPropagation(),h({x:S.clientX-x.current.x,y:S.clientY-x.current.y}))},g=S=>{k.current&&(k.current=!1,S.currentTarget.releasePointerCapture(S.pointerId),localStorage.setItem(i0,JSON.stringify(C.current)))},v={tools:[{key:"V",description:e("hotkeys.tools.edit")},{key:"C",description:e("hotkeys.tools.cutter")},{key:"S",description:e("hotkeys.tools.selection")},{key:"R",description:e("hotkeys.tools.reroute")},{key:"Z",description:e("hotkeys.tools.zoom")},{key:"Shift + W",description:e("toolbar.snapToGrid")},{key:"Shift + E",description:e("hotkeys.tools.toggleLineStyle")},{key:"G",description:`${e("hotkeys.tools.group")} / ${e("node.title.gemini_chat")}`},{key:"X",description:e("hotkeys.tools.closeNode")},{key:"D",description:e("hotkeys.tools.duplicate")},{key:"Ctrl + D",description:e("hotkeys.tools.duplicateWithContent")},{key:"Shift+Click",description:e("hotkeys.tools.deleteGroup")}],windows:[{key:"Space",description:e("hotkeys.windows.search")},{key:"Ctrl+Space",description:e("hotkeys.windows.catalog")},{key:"F1",description:e("help.panelTitle")}],alignment:[{key:"F",description:e("contextMenu.align.left")},{key:"E",description:e("contextMenu.align.centerX")},{key:"R",description:e("contextMenu.align.right")},{key:"T",description:e("contextMenu.align.top")},{key:"D",description:e("contextMenu.align.centerY")},{key:"B",description:e("contextMenu.align.bottom")},{key:"Ctrl + D",description:e("contextMenu.distribute.horizontal")},{key:"Ctrl + E",description:e("contextMenu.distribute.vertical")}],createNode:[{key:"T",description:e("node.title.text_input")},{key:"I",description:e("node.title.image_input")},{key:"P",description:e("node.title.prompt_processor")},{key:"O",description:e("node.title.image_output")},{key:"A",description:e("node.title.prompt_analyzer")},{key:"M",description:e("node.title.media_viewer")},{key:"L",description:e("node.title.translator")},{key:"N",description:e("node.title.note")},{key:"Q",description:e("node.title.prompt_sequence_editor")},{key:"E",description:e("node.title.video_editor")},{key:"Shift+P",description:e("node.title.video_prompt_processor")},{key:"Shift+O",description:e("node.title.video_output")},{key:"Shift+I",description:e("node.title.image_editor")},{key:"Shift+A",description:e("node.title.image_analyzer")},{key:"Shift+C",description:e("node.title.character_generator")},{key:"Shift+R",description:e("node.title.data_reader")},{key:"Shift+V",description:e("node.title.script_viewer")},{key:"Shift+Q",description:e("node.title.image_sequence_generator")},{key:"Ctrl+Shift+C",description:e("node.title.character_card")},{key:"Ctrl+Shift+A",description:e("node.title.character_analyzer")}]},_=(S,T)=>n.jsxs("div",{children:[n.jsx("h4",{className:"font-bold text-gray-300 mb-2 border-b border-gray-600 pb-1",children:S}),n.jsx("ul",{className:"space-y-1.5",children:T.map(({key:P,description:R})=>n.jsxs("li",{className:"flex justify-between items-center",children:[n.jsx("span",{children:R}),n.jsx("kbd",{className:"font-mono bg-gray-700 px-2 py-1 rounded-md text-gray-300 text-xs",children:P})]},P))})]});return n.jsxs("div",{ref:u,className:"relative select-none",children:[n.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[n.jsx("button",{onClick:()=>o(!t),className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":e("hotkeys.show"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsxs("div",{className:`absolute top-full left-1/2 -translate-x-1/2 mt-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 ease-in-out origin-top ${l?"opacity-100":"opacity-0 pointer-events-none"}`,role:"tooltip",children:[e("hotkeys.show")," (F1)"]})]}),r&&n.jsxs("div",{ref:d,className:`fixed bg-gray-800 rounded-lg shadow-2xl w-[600px] h-[720px] z-[250] flex flex-col overflow-hidden border border-gray-700 transition-opacity duration-200 ease-in-out ${t?"opacity-100":"opacity-0 pointer-events-none"}`,style:{left:p.x,top:p.y},onMouseDown:S=>S.stopPropagation(),children:[n.jsxs("div",{className:"bg-[#18202f] border-b border-gray-600 cursor-move",onPointerDown:w,onPointerMove:f,onPointerUp:g,children:[n.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[n.jsxs("h2",{className:"text-xl font-bold text-accent-text flex items-center gap-2 pointer-events-none",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e("app.title")," ",n.jsx("span",{className:"text-xs text-accent-text/70 font-normal ml-2",children:e("help.subtitle")})]}),n.jsx("button",{onClick:()=>o(!1),className:"text-gray-400 hover:text-white transition-colors p-1 hover:bg-white/10 rounded-full",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),n.jsxs("div",{className:"flex px-6 gap-6",children:[n.jsxs("button",{onClick:()=>s("hotkeys"),className:`pb-3 text-sm font-semibold transition-colors relative ${i==="hotkeys"?"text-accent-text":"text-gray-400 hover:text-gray-200"}`,children:[e("help.panelTitle"),i==="hotkeys"&&n.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-accent rounded-t-full"})]}),n.jsxs("button",{onClick:()=>s("links"),className:`pb-3 text-sm font-semibold transition-colors relative ${i==="links"?"text-accent-text":"text-gray-400 hover:text-gray-200"}`,children:[e("help.tab.links"),i==="links"&&n.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-accent rounded-t-full"})]})]})]}),n.jsx("div",{className:"p-6 overflow-y-auto custom-scrollbar flex-grow bg-gray-800",children:i==="hotkeys"?n.jsxs("div",{className:"flex flex-col space-y-6 text-sm text-gray-400",children:[n.jsx("div",{children:_(e("hotkeys.tools.title"),v.tools)}),n.jsx("div",{children:_(e("hotkeys.windows.title"),v.windows)}),n.jsx("div",{children:_("Alignment (2+ Selected)",v.alignment)}),n.jsx("div",{children:_(e("hotkeys.createNode.title"),v.createNode)})]}):n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsx(ea,{title:e("help.section.socials"),colorClass:"text-red-400"}),n.jsx(zn,{title:"MurcelloNovaes",description:"YouTube Channel",url:"https://www.youtube.com/@MurcelloNovaes",colorClass:"text-red-500",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{d:"M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"})})}),n.jsx(zn,{title:"MeowMasterArt",description:"Linktree",url:"https://linktr.ee/meowmasterart",colorClass:"text-green-500",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-6 h-6",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 10v12m0-12c-2 0-3-1-3-3 0-1 0-2 1-3m2 6c2 0 3-1 3-3 0-1 0-2-1-3M7 7c0 2 1 3 2 5m8-5c0 2-1 3-2 5M9 2h6"})})}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(zn,{title:"Telegram Channel",url:"https://t.me/+h0YEu0nx9QdhMDNi",colorClass:"text-sky-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"})})}),n.jsx(zn,{title:"Telegram Group",url:"https://t.me/+tyQLGFxiEbRhMDdi",colorClass:"text-sky-500",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-6 h-6",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})})]}),n.jsx(ea,{title:e("help.section.githubPages"),colorClass:"text-purple-400"}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(zn,{title:"Script Modifier",description:"GitHub Pages",url:"https://neytrino2134.github.io/Script-Modifier/",colorClass:"text-green-500",hoverClass:"group-hover:text-green-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-6 h-6",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"})})}),n.jsx(zn,{title:"Prompt Modifier",description:"GitHub Pages",url:"https://neytrino2134.github.io/Prompt-Modifier/",colorClass:"text-cyan-500",hoverClass:"group-hover:text-cyan-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-6 h-6",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"})})})]}),n.jsx(ea,{title:e("help.section.netlify"),colorClass:"text-cyan-400"}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(zn,{title:"Script Modifier",url:"https://scriptmodifier2.netlify.app/",colorClass:"text-green-500",hoverClass:"group-hover:text-green-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{d:"M12 2L2 19.777h20L12 2zm0 3.7l6.6 11.677H5.4L12 5.7z"})})}),n.jsx(zn,{title:"Prompt Modifier",url:"https://promptmodifier2.netlify.app/",colorClass:"text-cyan-500",hoverClass:"group-hover:text-cyan-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{d:"M12 2L2 19.777h20L12 2zm0 3.7l6.6 11.677H5.4L12 5.7z"})})})]}),n.jsx(ea,{title:e("help.section.studioStable"),colorClass:"text-blue-500"}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(zn,{title:"Script Modifier 0.1.3",description:"Stable Version",url:"https://ai.studio/apps/drive/1enTmQ5Wz9RBArkZMZm5s5nYQcKxQ9L8M?fullscreenApplet=true",colorClass:"text-green-500",hoverClass:"group-hover:text-green-400",icon:ks}),n.jsx(zn,{title:"Prompt Modifier 0.1.7",description:"Stable Version",url:"https://ai.studio/apps/drive/1YCO0DaA4BTm9p0j5XqvpBhX_XTg9ClwC?fullscreenApplet=true",colorClass:"text-cyan-500",hoverClass:"group-hover:text-cyan-400",icon:ks})]}),n.jsx(ea,{title:e("help.section.studioAlpha"),colorClass:"text-blue-500"}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(zn,{title:"Script Modifier 0.1.4 Alpha",description:"Latest Alpha",url:"https://aistudio.google.com/apps/drive/1y9CSUmlVQK2xq7ckses7fpM6wpbZdBnB?showAssistant=true&resourceKey=&showPreview=true",colorClass:"text-green-500",hoverClass:"group-hover:text-green-400",icon:ks}),n.jsx(zn,{title:"Prompt Modifier 0.1.8 Alpha",description:"Latest Alpha",url:"https://aistudio.google.com/apps/drive/1OJfPP9wUKlnjvZ5_2_Fxq_v1dW0iftlW?showAssistant=true&resourceKey=&showPreview=true",colorClass:"text-cyan-500",hoverClass:"group-hover:text-cyan-400",icon:ks})]}),n.jsx(ea,{title:e("help.section.github"),colorClass:"text-yellow-400"}),n.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[n.jsx(zn,{title:"Script Modifier",url:"https://github.com/Neytrino2134/Script-Modifier",colorClass:"text-green-500",hoverClass:"group-hover:text-green-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"})})}),n.jsx(zn,{title:"Prompt Modifier",url:"https://github.com/Neytrino2134/Prompt-Modifier",colorClass:"text-cyan-500",hoverClass:"group-hover:text-cyan-400",icon:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:n.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"})})})]}),n.jsx("div",{className:"h-4"})]})}),n.jsxs("div",{className:"p-4 bg-gray-900 border-t border-gray-700 text-xs flex-shrink-0",children:[n.jsxs("div",{className:"flex justify-between items-baseline",children:[n.jsx("span",{className:"font-bold text-gray-600 text-sm",children:e("app.title")}),n.jsx("span",{className:"text-gray-600",children:e("help.license")})]}),n.jsx("div",{className:"w-full h-px bg-gray-700 my-3"}),n.jsxs("div",{className:"flex justify-between items-end",children:[n.jsxs("div",{className:"grid grid-cols-[auto_1fr] gap-x-2 gap-y-1 text-sm",children:[n.jsxs("span",{className:"text-gray-500",children:[e("help.author"),":"]}),n.jsx("span",{className:"text-gray-400 font-medium",children:"MeowMaster"}),n.jsx("span",{className:"text-gray-500",children:"Email:"}),n.jsx("a",{href:"mailto:MeowMasterArt@gmail.com",className:"text-gray-400 hover:text-accent-text transition-colors",children:"MeowMasterArt@gmail.com"}),n.jsx("span",{className:"text-gray-500",children:"GitHub:"}),n.jsx("a",{href:"https://github.com/Neytrino2134/Prompt-Modifier",target:"_blank",rel:"noopener noreferrer",className:"text-gray-400 hover:text-accent-text transition-colors underline",children:"Neytrino2134/Prompt-Modifier"})]}),n.jsx("a",{href:"https://www.netlify.com",target:"_blank",rel:"noopener noreferrer",className:"opacity-80 hover:opacity-100 transition-opacity",children:n.jsx("img",{src:"https://www.netlify.com/assets/badges/netlify-badge-color-accent.svg",alt:"Deploys by Netlify",className:"h-10"})})]})]})]})]})},pI=()=>{const{language:e,setLanguage:t,secondaryLanguage:o,setSecondaryLanguage:r}=vt(),[a,i]=y.useState(!1),s=y.useRef(null),l=Pn[o],c=Pn.en;y.useEffect(()=>{const u=p=>{s.current&&!s.current.contains(p.target)&&i(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]);const d=u=>{r(u),t(u),i(!1)};return n.jsxs("div",{className:"flex items-center h-9 space-x-1 select-none relative",ref:s,children:[n.jsx(ct,{content:c.name,position:"bottom",className:"h-full",children:n.jsx("button",{onClick:()=>t("en"),className:`px-3 py-1 rounded-md text-xs font-bold transition-colors h-full flex items-center justify-center focus:outline-none min-w-[36px] ${e==="en"?"bg-accent text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-white"}`,children:c.short})}),n.jsxs("div",{className:"relative flex items-center h-full",children:[n.jsx(ct,{content:l.name,position:"bottom",className:"h-full",children:n.jsx("button",{onClick:()=>t(o),className:`px-3 py-1 rounded-l-md text-xs font-bold transition-colors h-full flex items-center justify-center focus:outline-none min-w-[36px] ${e===o?"bg-accent text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-white"}`,children:l.short})}),n.jsx("button",{onClick:u=>{u.stopPropagation(),i(!a)},className:`h-full px-1 rounded-r-md flex items-center justify-center transition-colors focus:outline-none border-l border-gray-600/50 ${e===o?"bg-accent text-white hover:bg-accent-hover":"bg-gray-700 text-gray-400 hover:bg-gray-600 hover:text-white"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 transition-transform duration-200 ${a?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),a&&n.jsx("div",{className:"absolute top-full right-0 mt-1 bg-gray-800 border border-gray-600 rounded-md shadow-xl z-50 py-1 min-w-[140px] max-h-60 overflow-y-auto custom-scrollbar animate-fade-in-drop origin-top-right",children:Object.entries(Pn).filter(([u])=>u!=="en").map(([u,p])=>n.jsxs("button",{onClick:()=>d(u),className:`w-full text-left px-3 py-2 text-xs flex items-center justify-between hover:bg-gray-700 transition-colors ${o===u?"bg-gray-700/50":""}`,children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:`font-medium ${o===u?"text-accent-text":"text-gray-200"}`,children:p.nativeName}),n.jsx("span",{className:"text-[10px] text-gray-500",children:p.name})]}),n.jsx("span",{className:"text-[10px] text-gray-500 font-mono ml-2 border border-gray-600 rounded px-1",children:p.short})]},u))})]})]})},hI=({tab:e,isActive:t,onSwitchTab:o,onStartEditing:r,onCloseTab:a,t:i})=>{const s=y.useRef(null),l=y.useRef(null),[c,d]=y.useState(0),u=()=>{if(s.current&&l.current){const p=l.current.clientWidth-s.current.offsetWidth;d(p<0?p:0)}};return y.useLayoutEffect(()=>{u()},[e.name]),n.jsxs("div",{onClick:()=>o(e.id),onDoubleClick:()=>r(e),onDragOver:p=>{p.preventDefault(),t||o(e.id)},onMouseEnter:u,className:`flex items-center justify-between px-4 h-full rounded-md cursor-pointer transition-colors duration-150 group flex-shrink-0 ${t?"bg-accent text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"} max-w-[200px] overflow-hidden select-none`,children:[n.jsx(ct,{content:e.name,position:"bottom",delay:800,className:"flex-grow min-w-0",children:n.jsx("div",{ref:l,className:"flex-grow min-w-0 overflow-hidden relative mask-fade",children:n.jsx("div",{className:`inline-block whitespace-nowrap ${c<0?"group-hover:animate-swing":""}`,style:{"--scroll-dist":`${c}px`},children:n.jsx("span",{ref:s,className:"text-sm pr-1 block",children:e.name})})})}),n.jsx(ct,{content:i("node.action.close"),position:"bottom",children:n.jsx("button",{onClick:p=>{p.stopPropagation(),a(e.id,p)},className:`ml-3 p-0.5 rounded-full transition-opacity focus:outline-none opacity-50 group-hover:opacity-100 ${t?"text-white hover:bg-accent-hover":"text-gray-500 hover:bg-gray-600 hover:text-white"}`,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})})]})},mI=({tabs:e,activeTabId:t,onSwitchTab:o,onAddTab:r,onCloseTab:a,onRenameTab:i})=>{const{t:s}=vt(),[l,c]=y.useState(null),[d,u]=y.useState(""),p=y.useRef(null),h=y.useRef(null);y.useEffect(()=>{l&&p.current&&(p.current.focus(),p.current.select())},[l]);const x=f=>{c(f.id),u(f.name)},k=()=>{l&&d.trim()&&i(l,d.trim()),c(null)},C=f=>{f.key==="Enter"?k():f.key==="Escape"&&c(null)},w=f=>{h.current&&(h.current.scrollLeft+=f.deltaY)};return n.jsx("div",{onMouseDown:f=>f.stopPropagation(),className:"flex-shrink-0 pointer-events-auto max-w-[calc(100vw-350px)]",children:n.jsxs("div",{ref:h,onWheel:w,className:"flex items-center h-9 space-x-1 overflow-x-auto overflow-y-hidden hide-scrollbar [&::-webkit-scrollbar]:hidden",children:[e.map(f=>l===f.id?n.jsx("div",{className:"flex items-center justify-between px-4 h-full rounded-md bg-gray-700 max-w-[200px]",children:n.jsx("input",{ref:p,type:"text",value:d,onChange:g=>u(g.target.value),onBlur:k,onKeyDown:C,className:"bg-transparent border-b border-accent-text focus:outline-none text-sm w-full text-white",onClick:g=>g.stopPropagation()})},f.id):n.jsx(hI,{tab:f,isActive:f.id===t,onSwitchTab:o,onStartEditing:x,onCloseTab:a,t:s},f.id)),n.jsx(ct,{content:"New Canvas",position:"bottom",className:"h-full",children:n.jsx("button",{onClick:r,className:"flex-shrink-0 flex items-center justify-center w-8 h-full rounded-md bg-gray-700 text-gray-300 hover:bg-accent hover:text-white transition-colors focus:outline-none",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})})]})})},s0=({language:e,globalLanguage:t,apiKey:o,setApiKey:r,onSelectLanguage:a,onStart:i,onDeveloperStart:s,onStartNew:l,measureRef:c,onCycleLanguage:d,exitPhase:u,isResumable:p})=>{const h=y.useCallback((_,S)=>qo(e,_,S),[e]),[x,k]=y.useState(!1),[C,w]=y.useState(!1),f=y.useRef(null),g=y.useRef(null);y.useEffect(()=>{const _=setTimeout(()=>{g.current&&g.current.focus()},100);return()=>clearTimeout(_)},[]),y.useEffect(()=>{const _=setTimeout(()=>{w(!0)},1e3);return()=>clearTimeout(_)},[]),y.useEffect(()=>{const _=S=>{f.current&&!f.current.contains(S.target)&&k(!1)};return document.addEventListener("mousedown",_),()=>document.removeEventListener("mousedown",_)},[]);const v=Pn[t];return n.jsxs("div",{ref:c,className:"w-full flex flex-col items-center text-center select-none",children:[n.jsxs("div",{className:`w-full flex items-center justify-between md:justify-center gap-2 md:gap-12 mb-6 px-1 md:px-4 transition-all duration-500 ${u!=="idle"?"opacity-0 scale-90 blur-sm":"opacity-100 scale-100"}`,children:[n.jsx("button",{onClick:()=>d(-1),className:"w-10 h-10 md:w-16 md:h-16 flex-shrink-0 rounded-full border border-cyan-500/30 bg-gray-900/40 backdrop-blur-md text-cyan-400 hover:text-white hover:bg-cyan-500/20 hover:border-cyan-400 transition-all duration-300 shadow-[0_0_15px_rgba(6,182,212,0.1)] hover:shadow-[0_0_25px_rgba(6,182,212,0.4)] flex items-center justify-center group z-30","aria-label":"Previous Language",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 md:h-8 md:w-8 transform transition-transform group-hover:-translate-x-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),n.jsxs("div",{className:"flex flex-col items-center justify-center z-20 gap-3 md:gap-8 py-2",children:[n.jsx("h1",{className:"font-black tracking-tighter leading-none text-center animate-gradient-x bg-size-200 bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 via-sky-500 to-cyan-400 px-1 md:px-4 whitespace-nowrap",style:{fontSize:"clamp(2rem, 7vw, 120px)"},children:h("welcome.title")}),n.jsx("h1",{className:"font-black tracking-tighter leading-none text-center animate-gradient-x bg-size-200 bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 via-sky-500 to-cyan-400 px-1 md:px-4 whitespace-nowrap",style:{fontSize:"clamp(2rem, 7vw, 120px)"},children:h("app.title")})]}),n.jsx("button",{onClick:()=>d(1),className:"w-10 h-10 md:w-16 md:h-16 flex-shrink-0 rounded-full border border-cyan-500/30 bg-gray-900/40 backdrop-blur-md text-cyan-400 hover:text-white hover:bg-cyan-500/20 hover:border-cyan-400 transition-all duration-300 shadow-[0_0_15px_rgba(6,182,212,0.1)] hover:shadow-[0_0_25px_rgba(6,182,212,0.4)] flex items-center justify-center group z-30","aria-label":"Next Language",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 md:h-8 md:w-8 transform transition-transform group-hover:translate-x-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]}),n.jsx("div",{className:`mb-8 h-6 flex items-center justify-center transition-all duration-700 ${C&&u==="idle"?"opacity-100 translate-y-0":"opacity-0 translate-y-2"}`,children:n.jsx("p",{className:"text-gray-400 text-sm font-medium tracking-wide bg-gray-900/40 px-3 py-1 rounded-full border border-gray-700/50 backdrop-blur-sm",children:h("welcome.navHint")})}),n.jsxs("div",{className:`relative w-full max-w-[860px] mx-auto transition-all duration-700 ease-[cubic-bezier(0.34,1.56,0.64,1)] ${u==="window-exit"?"-translate-y-[150vh] scale-75 opacity-0":u==="button-exit"?"scale-95":"scale-100"}`,children:[n.jsx("div",{className:"welcome-ring"}),n.jsx("div",{className:"relative z-10 w-full bg-gray-800/80 backdrop-blur-xl rounded-3xl border border-gray-700 shadow-2xl overflow-visible",children:n.jsxs("div",{className:"p-8 md:p-10 space-y-8 text-left",children:[n.jsxs("div",{className:"space-y-4 w-full",children:[n.jsx("p",{className:"text-xl md:text-2xl text-gray-200 leading-relaxed font-light",children:h("welcome.description")}),n.jsx("div",{className:"h-px w-full bg-gradient-to-r from-transparent via-cyan-500/30 to-transparent"})]}),n.jsxs("div",{className:"space-y-2 relative z-50",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400 ml-1 uppercase tracking-wide",children:h("welcome.selectLanguage")||"Language"}),n.jsxs("div",{ref:f,className:"relative",children:[n.jsxs("button",{onClick:()=>k(!x),className:"w-full py-3 px-4 rounded-xl bg-gray-900/60 border border-gray-600 hover:border-cyan-500 hover:bg-gray-800/80 transition-all duration-200 text-left flex items-center justify-between group outline-none focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500/50",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center text-xs font-bold text-gray-300 border border-gray-600 group-hover:border-cyan-400/50 transition-colors",children:v.short}),n.jsxs("span",{className:"text-lg text-white font-medium",children:[v.nativeName," ",n.jsxs("span",{className:"text-gray-500 text-sm ml-1",children:["(",v.name,")"]})]})]}),n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 text-gray-400 transition-transform duration-300 ${x?"rotate-180 text-cyan-400":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),x&&n.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-gray-800/95 backdrop-blur-xl border border-gray-600 rounded-xl shadow-2xl max-h-60 overflow-y-auto custom-scrollbar p-1 animate-fade-in-drop origin-top z-[100]",children:Object.entries(Pn).map(([_,S])=>n.jsxs("button",{onClick:()=>{a(_),k(!1)},className:`w-full text-left px-4 py-3 rounded-lg flex items-center justify-between transition-colors ${t===_?"bg-cyan-600/20 text-cyan-400":"text-gray-300 hover:bg-gray-700 hover:text-white"}`,children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("span",{className:"text-xs font-bold w-6 text-gray-500",children:S.short}),n.jsx("span",{className:"font-medium",children:S.nativeName})]}),t===_&&n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-cyan-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},_))})]})]}),n.jsx("div",{className:"space-y-4 text-left w-full pt-4 border-t border-gray-700/50",children:n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex justify-between items-center px-1 mb-1",children:[n.jsx("label",{htmlFor:"welcome-api-key",className:"block text-sm font-medium text-gray-400",children:h("welcome.apiKeyLabel")}),n.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-xs text-cyan-400 hover:text-cyan-300 underline",children:h("welcome.getKeyLink")})]}),n.jsx("div",{className:"relative",children:n.jsx("input",{ref:g,type:"password",id:"welcome-api-key",value:o,onChange:_=>r(_.target.value),placeholder:h("welcome.apiKeyPlaceholder"),className:"w-full p-4 bg-gray-900/60 border border-gray-500 rounded-xl text-white outline-none focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition-all duration-200 shadow-inner select-text"})}),n.jsx("div",{className:"flex items-center justify-center pt-2",children:n.jsxs("div",{className:"flex items-center space-x-1.5 text-gray-500 bg-gray-900/30 px-3 py-1 rounded-full border border-gray-700/30",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),n.jsx("span",{className:"text-[10px] md:text-xs font-medium",children:h("welcome.apiKeyHelp")})]})})]})}),n.jsxs("div",{className:"pt-2 flex flex-col gap-3",children:[n.jsx("button",{onClick:i,className:"w-full py-4 text-lg font-bold text-white bg-gradient-to-r from-cyan-600 via-blue-600 to-cyan-600 bg-size-200 animate-gradient-x shadow-cyan-900/30 rounded-xl shadow-lg transform hover:scale-105 active:scale-95 transition-all duration-200 flex items-center justify-center gap-3 group relative overflow-hidden",children:n.jsxs("div",{className:`flex items-center gap-3 transition-all duration-500 ease-[cubic-bezier(0.68,-0.55,0.27,1.55)] ${u!=="idle"?"translate-x-[200px] opacity-0":"translate-x-0 opacity-100"}`,children:[n.jsx("span",{children:h(p?"welcome.resume":"welcome.letsGo")}),n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 transform group-hover:translate-x-1 transition-transform",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 7l5 5m0 0l-5 5m5-5H6"})})]})}),p&&l&&n.jsx("button",{onClick:l,className:"w-full py-3 border border-gray-600 hover:border-gray-400 text-gray-400 hover:text-white rounded-xl transition-all duration-200 text-sm font-semibold",children:h("welcome.startNew")}),n.jsx("div",{children:n.jsx("button",{onClick:s,className:"w-full py-3 border border-gray-700 hover:border-cyan-500/50 text-gray-500 hover:text-cyan-400 rounded-xl transition-all duration-200 text-xs font-semibold tracking-wide bg-transparent hover:bg-gray-800/30",children:h("welcome.iAmDeveloper")})})]})]})})]}),n.jsxs("div",{className:`mt-10 flex flex-col md:flex-row gap-4 transition-all duration-700 delay-100 ${u!=="idle"?"opacity-0 translate-y-4 pointer-events-none":"opacity-100 translate-y-0"}`,children:[n.jsxs("a",{href:"https://scriptmodifier2.netlify.app/",target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-3 px-6 py-3 rounded-full bg-gray-900/60 hover:bg-gray-800 border border-gray-700 hover:border-cyan-500/50 text-gray-400 hover:text-cyan-400 transition-all duration-300 backdrop-blur-sm shadow-lg hover:shadow-cyan-500/10",children:[n.jsx("span",{className:"font-semibold tracking-wide text-sm",children:"Go to Script Modifier on Netlify"}),n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:n.jsx("path",{d:"M12 2L2 19.777h20L12 2zm0 3.7l6.6 11.677H5.4L12 5.7z"})})]}),n.jsxs("a",{href:"https://github.com/Neytrino2134/Script-Modifier",target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-3 px-6 py-3 rounded-full bg-gray-900/60 hover:bg-gray-800 border border-gray-700 hover:border-purple-500/50 text-gray-400 hover:text-purple-400 transition-all duration-300 backdrop-blur-sm shadow-lg hover:shadow-purple-500/10",children:[n.jsx("span",{className:"font-semibold tracking-wide text-sm",children:"Go to Script Modifier on GitHub"}),n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:n.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"})})]})]})]})},gI=({onClose:e,isResumable:t=!1})=>{const o=Ut(),{language:r,setSecondaryLanguage:a,setLanguage:i,t:s}=vt(),[l,c]=y.useState(""),[d,u]=y.useState(!1),[p,h]=y.useState("idle"),[x,k]=y.useState(r),[C,w]=y.useState(null),[f,g]=y.useState(0),[v,_]=y.useState(void 0),S=y.useRef(null),T=y.useRef(null);y.useEffect(()=>{C||k(r)},[r,C]),y.useEffect(()=>{if(!S.current)return;const N=()=>{S.current&&_(S.current.offsetHeight)},j=new ResizeObserver(N);return j.observe(S.current),N(),()=>j.disconnect()},[x]),y.useEffect(()=>{const N=localStorage.getItem("settings_userApiKey");N&&c(N),requestAnimationFrame(()=>u(!0))},[]);const P=()=>{window.location.reload()},R=N=>{N!==r&&(T.current&&clearTimeout(T.current),w(x),g(1),k(N),N==="en"?i("en"):(a(N),i(N)),requestAnimationFrame(()=>{requestAnimationFrame(()=>{g(0)})}),T.current=setTimeout(()=>{w(null)},200))},D=y.useCallback(N=>{const j=Object.keys(Pn);let M=j.indexOf(x)+N;M<0&&(M=j.length-1),M>=j.length&&(M=0),R(j[M])},[x,r]);y.useEffect(()=>{const N=j=>{j.key==="ArrowLeft"?D(-1):j.key==="ArrowRight"&&D(1)};return window.addEventListener("keydown",N),()=>window.removeEventListener("keydown",N)},[D]);const q=(N,j=!1,L)=>{localStorage.setItem("hasVisited","true"),h("button-exit"),N&&o&&(o.resetCanvasToDefault&&o.resetCanvasToDefault(L||x),j?localStorage.setItem("tutorial_completed","true"):(localStorage.removeItem("tutorial_completed"),setTimeout(()=>{o.startTutorial&&o.startTutorial()},500))),setTimeout(()=>{},200),setTimeout(()=>{h("window-exit")},400),setTimeout(()=>{e()},1e3)},O=()=>{localStorage.setItem("settings_useDevKey","false"),l.trim()&&localStorage.setItem("settings_userApiKey",l.trim()),q(!t,!1)},E=()=>{localStorage.setItem("settings_useDevKey","false"),l.trim()&&localStorage.setItem("settings_userApiKey",l.trim()),q(!0,!1)},A=()=>{localStorage.setItem("settings_useDevKey","true"),o&&o.setIsInstantCloseEnabled(!0),a("ru"),i("ru"),k("ru"),q(!0,!0,"ru")};return n.jsxs("div",{className:`fixed inset-0 bg-gray-900 z-[200] flex flex-col items-center justify-center overflow-hidden text-white px-4 custom-scrollbar transition-opacity duration-700 select-none ${p==="window-exit"?"opacity-0":"opacity-100"}`,onMouseDown:N=>{N.target instanceof HTMLInputElement||N.target instanceof HTMLTextAreaElement||N.preventDefault()},children:[n.jsx("style",{children:`
            .bg-size-200 { background-size: 200% auto; }
            @keyframes gradient-x {
                0% { background-position: 0% 50%; }
                100% { background-position: -200% 50%; }
            }
            .animate-gradient-x {
                animation: gradient-x 3s linear infinite;
            }
        `}),n.jsxs("div",{className:"absolute top-4 right-4 z-50 flex items-center gap-4",children:[n.jsx("button",{onClick:P,className:"transition-all duration-300 hover:opacity-100 opacity-60 hover:scale-110 p-1",title:s("dialog.settings.reload"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,className:"text-white",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),n.jsx("a",{href:"https://github.com/Neytrino2134/Prompt-Modifier",target:"_blank",rel:"noopener noreferrer",className:"transition-all duration-300 hover:opacity-100 opacity-60 hover:scale-110",title:"View Source on GitHub",children:n.jsx("svg",{width:"32",height:"32",viewBox:"0 0 98 96",xmlns:"http://www.w3.org/2000/svg",className:"fill-white",children:n.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z"})})}),n.jsx("div",{className:"transition-opacity hover:opacity-100 opacity-80",children:n.jsx("a",{href:"https://www.netlify.com",target:"_blank",rel:"noopener noreferrer",children:n.jsx("img",{src:"https://www.netlify.com/assets/badges/netlify-badge-color-accent.svg",alt:"Deploys by Netlify"})})})]}),n.jsx("div",{className:"absolute -bottom-20 -right-20 opacity-5 pointer-events-none fixed",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-[600px] h-[600px] text-white transform rotate-[-15deg]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"0.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),n.jsx("div",{className:`relative z-10 w-full flex flex-col items-center text-center transition-all duration-700 ease-out transform ${d?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:n.jsxs("div",{className:"relative w-full transition-[height] duration-200 ease-in-out",style:{height:v?`${v}px`:"auto"},children:[n.jsx("div",{className:"relative w-full z-10",children:n.jsx(s0,{language:x,globalLanguage:r,apiKey:l,setApiKey:c,onSelectLanguage:R,onStart:O,onDeveloperStart:A,onStartNew:E,measureRef:S,onCycleLanguage:D,exitPhase:p,isResumable:t})}),C&&n.jsx("div",{className:"absolute top-0 left-0 w-full z-20 pointer-events-none transition-opacity duration-200 ease-linear",style:{opacity:f},children:n.jsx(s0,{language:C,globalLanguage:r,apiKey:l,setApiKey:c,onSelectLanguage:R,onStart:O,onDeveloperStart:A,onCycleLanguage:D,exitPhase:"idle",isResumable:t})})]})})]})},fI="v0.1.9 Alpha",Lo=({title:e,children:t,align:o="center"})=>{const[r,a]=y.useState(!1);let i="left-1/2 -translate-x-1/2 top-full mt-2 origin-top";return o==="left"&&(i="left-0 top-full mt-2 origin-top-left"),o==="right"&&(i="right-0 top-full mt-2 origin-top-right"),n.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[t,n.jsx("div",{className:`absolute px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-lg shadow-xl z-50 transition-all duration-200 ease-out transform ${i} ${r?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,role:"tooltip",children:e})]})},xI=()=>{const e=Ut(),[t,o]=y.useState(!1),[r,a]=y.useState(!1),[i,s]=y.useState(!1);y.useEffect(()=>{const j=()=>{a(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",j),()=>document.removeEventListener("fullscreenchange",j)},[]),y.useEffect(()=>{if(!i)return;const j=()=>s(!1);return document.addEventListener("click",j),()=>document.removeEventListener("click",j)},[i]);const l=()=>{document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen().catch(j=>{console.error(`Error attempting to enable full-screen mode: ${j.message} (${j.name})`)})};if(!e)return null;const{t:c,clearUnusedFullSizeImages:d,handleResetCanvas:u,tabs:p,activeTabId:h,handleSwitchTab:x,handleAddTab:k,handleCloseTab:C,handleRenameTab:w,showWelcome:f,setShowWelcome:g,nodes:v,loadCanvasState:_,setConfirmInfo:S,currentTheme:T,setTheme:P,resetTabs:R}=e,D=j=>{const L=j.currentTarget.getBoundingClientRect();window.dispatchEvent(new CustomEvent("open-settings",{detail:{x:L.left,y:L.bottom}}))},q=()=>{g(!0)},O=()=>{S({title:c("dialog.exitApp.title"),message:c("dialog.exitApp.message"),onConfirm:()=>{_({nodes:[],connections:[],groups:[],viewTransform:{scale:1,translate:{x:0,y:0}},nodeIdCounter:1,fullSizeImageCache:{}}),g(!0)}})},E=()=>{S({title:c("dialog.reload.title"),message:c("dialog.reload.message"),onConfirm:()=>{_({nodes:[],connections:[],groups:[],viewTransform:{scale:1,translate:{x:0,y:0}},nodeIdCounter:1,fullSizeImageCache:{}}),R&&R("en"),setTimeout(()=>{window.location.reload()},100)}})},A=v&&v.length>0&&localStorage.getItem("hasVisited")==="true",N=[{id:"cyan",color:"#06b6d4",label:"Cyan"},{id:"azure",color:"#0ea5e9",label:"Azure"},{id:"purple",color:"#9333ea",label:"Purple"},{id:"pink",color:"#ec4899",label:"Pink"},{id:"red",color:"#dc2626",label:"Red"},{id:"orange",color:"#f97316",label:"Orange"},{id:"lime",color:"#84cc16",label:"Lime"},{id:"emerald",color:"#10b981",label:"Emerald"},{id:"gray",color:"#71717a",label:"Gray"}];return n.jsxs(n.Fragment,{children:[f&&n.jsx(gI,{onClose:()=>g(!1),isResumable:A}),n.jsx("header",{className:"absolute top-0 left-0 w-full flex justify-start p-2 z-30 pointer-events-none",children:n.jsxs("div",{className:"bg-gray-900 rounded-lg shadow-lg p-1 flex items-center gap-1 pointer-events-auto border border-gray-700",onMouseDown:j=>j.stopPropagation(),children:[n.jsx(Lo,{title:c(t?"toolbar.expandPanel":"toolbar.collapsePanel"),align:"left",children:n.jsx("button",{onClick:()=>o(j=>!j),className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":c(t?"toolbar.expandPanel":"toolbar.collapsePanel"),children:t?n.jsx(k3,{}):n.jsx(_3,{})})}),!t&&n.jsxs(n.Fragment,{children:[n.jsx(Lo,{title:c("toolbar.home"),children:n.jsx("button",{onClick:q,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":c("toolbar.home"),children:n.jsx(S3,{})})}),n.jsx(uI,{}),n.jsx(Lo,{title:c("toolbar.clearCache"),children:n.jsx("button",{onClick:d,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":c("toolbar.clearCache"),children:n.jsx(N3,{})})}),n.jsx(Lo,{title:c("toolbar.settings"),children:n.jsx("button",{onClick:D,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":c("toolbar.settings"),children:n.jsx(O1,{})})}),n.jsx(Lo,{title:c(r?"toolbar.exitFullScreen":"toolbar.enterFullScreen"),children:n.jsx("button",{onClick:l,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":c(r?"toolbar.exitFullScreen":"toolbar.enterFullScreen"),children:r?n.jsx(Tp,{}):n.jsx(Pp,{})})}),n.jsx(Lo,{title:c("toolbar.resetCanvas"),children:n.jsx("button",{onClick:u,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300","aria-label":c("toolbar.resetCanvas"),children:n.jsx(E3,{})})}),n.jsx(pI,{}),n.jsx(mI,{tabs:p,activeTabId:h,onSwitchTab:x,onAddTab:k,onCloseTab:C,onRenameTab:w}),n.jsxs("h1",{className:"text-lg font-bold text-accent-text whitespace-nowrap flex items-center space-x-2 select-none ml-2",children:[n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{d:"M21 15l-5-5L5 21"})]}),n.jsx("span",{children:c("app.title")})]}),n.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[n.jsx("div",{className:"px-2 py-0.5 bg-gray-800 rounded border border-gray-600 text-[10px] font-mono text-gray-400 select-none",children:fI}),n.jsxs("div",{className:"relative",children:[n.jsx(Lo,{title:c("settings.themeLabel"),children:n.jsx("button",{onClick:j=>{j.stopPropagation(),s(!i)},className:`p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 ${i?"bg-accent text-white":"bg-gray-700 text-gray-300 hover:bg-accent hover:text-white"}`,children:n.jsx(P3,{})})}),i&&n.jsx("div",{className:"absolute top-full right-0 mt-2 bg-gray-800 border border-gray-600 rounded-lg shadow-xl p-2 z-50 flex flex-col gap-1 min-w-[120px] animate-fade-in-drop origin-top-right",children:N.map(j=>n.jsxs("button",{onClick:()=>P(j.id),className:`flex items-center gap-2 px-2 py-1.5 rounded hover:bg-gray-700 w-full text-left transition-colors ${T===j.id?"bg-gray-700":""}`,children:[n.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:j.color}}),n.jsx("span",{className:`text-xs ${T===j.id?"text-white font-bold":"text-gray-300"}`,children:j.label})]},j.id))})]}),n.jsx(Lo,{title:c("dialog.settings.reload"),children:n.jsx("button",{onClick:E,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 text-gray-300 hover:bg-red-600 hover:text-white","aria-label":c("dialog.settings.reload"),children:n.jsx(F1,{})})}),n.jsx(Lo,{title:c("toolbar.exitApp"),align:"right",children:n.jsx("button",{onClick:O,className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-red-600 hover:text-white text-gray-300","aria-label":c("toolbar.exitApp"),children:n.jsx(T3,{})})})]})]})]})})]})},l0="prompt_modifier_recent_nodes",yI=({isOpen:e,position:t,onClose:o,onAddNode:r})=>{const{t:a}=vt(),[i,s]=y.useState(""),[l,c]=y.useState(0),[d,u]=y.useState([]),p=y.useRef(null),h=y.useRef(null),x=y.useRef(null),[k,C]=y.useState({x:0,y:0}),[w,f]=y.useState(!1),g=y.useRef(!1),v=y.useRef({x:0,y:0}),_=y.useRef({x:0,y:0});y.useEffect(()=>{try{const L=localStorage.getItem(l0);L&&u(JSON.parse(L))}catch(L){console.error("Failed to load recent nodes",L)}},[]);const S=L=>{u(M=>{const V=M.filter(F=>F!==L),H=[L,...V].slice(0,3);return localStorage.setItem(l0,JSON.stringify(H)),H})},T=y.useMemo(()=>[{group:"input",type:z.TEXT_INPUT,title:a("search.node.text_input.title"),englishTitle:"Text Input",description:a("search.node.text_input.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 6h10M12 6v12"})})},{group:"input",type:z.IMAGE_INPUT,title:a("search.node.image_input.title"),englishTitle:"Image Input",description:a("search.node.image_input.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{d:"M21 15l-5-5L5 21"})]})},{group:"input",type:z.MEDIA_VIEWER,title:a("search.node.media_viewer.title"),englishTitle:"Media Viewer",description:a("search.node.media_viewer.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})},{group:"input",type:z.PROMPT_SEQUENCE_EDITOR,title:a("search.node.prompt_sequence_editor.title"),englishTitle:"Prompt Sequence Editor",description:a("search.node.prompt_sequence_editor.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z"})})},{group:"input",type:z.DATA_READER,title:a("search.node.data_reader.title"),englishTitle:"Data Reader",description:a("search.node.data_reader.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})},{group:"input",type:z.NOTE,title:a("search.node.note.title"),englishTitle:"Note",description:a("search.node.note.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})},{group:"process",type:z.PROMPT_PROCESSOR,title:a("search.node.prompt_processor.title"),englishTitle:"Prompt Processor",description:a("search.node.prompt_processor.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})},{group:"process",type:z.PROMPT_ANALYZER,title:a("search.node.prompt_analyzer.title"),englishTitle:"Prompt Analyzer",description:a("search.node.prompt_analyzer.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})},{group:"character",type:z.CHARACTER_CARD,title:a("search.node.character_card.title"),englishTitle:"Character Card",description:a("search.node.character_card.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 8a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5a7.5 7.5 0 0115 0"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.5a.75.75 0 00-.75.75v13.5c0 .414.336.75.75.75h16.5a.75.75 0 00.75-.75V5.25a.75.75 0 00-.75-.75H3.75z"})]})},{group:"character",type:z.CHARACTER_ANALYZER,title:a("search.node.character_analyzer.title"),englishTitle:"Character Analyzer",description:a("search.node.character_analyzer.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})},{group:"character",type:z.CHARACTER_GENERATOR,title:a("search.node.character_generator.title"),englishTitle:"Character Generator",description:a("search.node.character_generator.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})})},{group:"character",type:z.POSE_CREATOR,title:a("search.node.pose_creator.title"),englishTitle:"Pose Creator",description:a("search.node.pose_creator.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})},{group:"process",type:z.IMAGE_ANALYZER,title:a("search.node.image_analyzer.title"),englishTitle:"Image Analyzer",description:a("search.node.image_analyzer.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0z"})})},{group:"process",type:z.IMAGE_EDITOR,title:a("search.node.image_editor.title"),englishTitle:"AI Image Editor",description:a("search.node.image_editor.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]})},{group:"ai",type:z.TRANSLATOR,title:a("search.node.translator.title"),englishTitle:"Translator",description:a("search.node.translator.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})},{group:"ai",type:z.GEMINI_CHAT,title:a("search.node.gemini_chat.title"),englishTitle:"Gemini Chat",description:a("search.node.gemini_chat.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{group:"ai",type:z.PROMPT_SANITIZER,title:a("search.node.prompt_sanitizer.title"),englishTitle:"Prompt Sanitizer",description:a("search.node.prompt_sanitizer.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})},{group:"video",type:z.VIDEO_PROMPT_PROCESSOR,title:a("search.node.video_prompt_processor.title"),englishTitle:"Video Prompt Processor",description:a("search.node.video_prompt_processor.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})})},{group:"video",type:z.VIDEO_OUTPUT,title:a("search.node.video_output.title"),englishTitle:"Video Output",description:a("search.node.video_output.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9A2.25 2.25 0 0013.5 5.25h-9A2.25 2.25 0 002.25 7.5v9A2.25 2.25 0 004.5 18.75z"})})},{group:"video",type:z.VIDEO_EDITOR,title:a("node.title.video_editor"),englishTitle:"Video Editor",description:a("node.help.video_editor"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})},{group:"scripts",type:z.SCRIPT_GENERATOR,title:a("search.node.script_generator.title"),englishTitle:"Script Generator",description:a("search.node.script_generator.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})},{group:"scripts",type:z.SCRIPT_VIEWER,title:a("search.node.script_viewer.title"),englishTitle:"Script Viewer",description:a("search.node.script_viewer.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 19.82a2.25 2.25 0 01-1.897 1.13l-2.685.8.8-2.685a2.25 2.25 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})},{group:"output",type:z.IMAGE_OUTPUT,title:a("search.node.image_output.title"),englishTitle:"Image Output",description:a("search.node.image_output.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})},{group:"output",type:z.IMAGE_SEQUENCE_GENERATOR,title:a("search.node.image_sequence_generator.title"),englishTitle:"Image Sequence Generator",description:a("search.node.image_sequence_generator.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})})},{group:"output",type:z.IMAGE_EDITOR,title:a("search.node.image_editor.title"),englishTitle:"AI Image Editor",description:a("search.node.image_editor.description"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]})},{group:"game",type:z.DATA_PROTECTION,title:a("search.node.data_protection.title"),englishTitle:"Data Protection",description:a("search.node.data_protection.description"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})}],[a]),P=y.useMemo(()=>({input:a("search.group.input"),process:a("search.group.process"),character:a("quickadd.group.character"),output:a("search.group.output"),ai:a("search.group.ai"),video:a("search.group.video"),scripts:a("search.group.scripts"),game:"Games"}),[a]),R={input:"bg-emerald-800/50 text-emerald-300",process:"bg-green-800/50 text-green-300",character:"bg-pink-800/50 text-pink-300",output:"bg-blue-800/50 text-blue-300",ai:"bg-amber-800/50 text-amber-300",video:"bg-red-800/50 text-red-300",scripts:"bg-lime-800/50 text-lime-300",game:"bg-cyan-800/50 text-cyan-300"},D=y.useMemo(()=>{const L=i.toLowerCase().trim(),M=T.filter(V=>V.title.toLowerCase().includes(L)||V.englishTitle.toLowerCase().includes(L)||V.description.toLowerCase().includes(L));return L===""?{recents:d.map(H=>T.find(F=>F.type===H)).filter(Boolean),all:T}:{recents:[],all:M}},[i,T,d]),q=y.useMemo(()=>{const{recents:L,all:M}=D;return[...L.map(V=>({...V,isRecent:!0})),...M.map(V=>({...V,isRecent:!1}))]},[D]);y.useEffect(()=>{if(e){if(s(""),c(0),f(!0),x.current){const L=x.current.getBoundingClientRect();let M=t.x-L.width/2,V=t.y+10;M+L.width>window.innerWidth-10&&(M=window.innerWidth-L.width-10),M<10&&(M=10),V+400>window.innerHeight-10&&(V=t.y-400-10),V<10&&(V=10),C({x:M,y:V}),_.current={x:M,y:V}}setTimeout(()=>{var L;return(L=p.current)==null?void 0:L.focus()},50)}else f(!1)},[e,t]),y.useEffect(()=>{var L;if(l>=0&&l<q.length){const M=(L=h.current)==null?void 0:L.querySelector(`[data-index="${l}"]`);M==null||M.scrollIntoView({block:"nearest"})}},[l,q]);const O=L=>{L.preventDefault(),L.stopPropagation(),g.current=!0,v.current={x:L.clientX,y:L.clientY},_.current={...k},L.currentTarget.setPointerCapture(L.pointerId)},E=L=>{if(g.current&&x.current){const M=L.clientX-v.current.x,V=L.clientY-v.current.y;x.current.style.transform=`translate(${M}px, ${V}px)`}},A=L=>{if(g.current&&x.current){g.current=!1;const M=L.clientX-v.current.x,V=L.clientY-v.current.y;C(H=>({x:H.x+M,y:H.y+V})),x.current.style.transform="",L.currentTarget.releasePointerCapture(L.pointerId)}},N=L=>{if(L.key==="Escape")L.stopPropagation(),o();else if(L.key==="ArrowDown")L.preventDefault(),c(M=>Math.min(M+1,q.length-1));else if(L.key==="ArrowUp")L.preventDefault(),c(M=>Math.max(M-1,0));else if(L.key==="Enter"&&(L.preventDefault(),q[l])){const M=q[l].type;r(M),S(M),o()}},j=L=>{r(L),S(L),o()};return!e&&!w?null:n.jsx("div",{className:"fixed inset-0 z-50 bg-transparent pointer-events-none",children:n.jsxs("div",{ref:x,className:`bg-gray-800 rounded-lg shadow-2xl w-full max-w-md border border-gray-700 flex flex-col pointer-events-auto transition-opacity duration-150 ${w?"opacity-100":"opacity-0"}`,style:{left:k.x,top:k.y,position:"absolute"},onMouseDown:L=>L.stopPropagation(),onKeyDown:N,children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-700 cursor-move bg-gray-900/50 rounded-t-lg select-none",onPointerDown:O,onPointerMove:E,onPointerUp:A,children:[n.jsx("span",{className:"font-bold text-gray-200",children:a("hotkeys.windows.search")}),n.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[n.jsx("span",{children:"ESC to close"}),n.jsx("button",{onClick:o,onPointerDown:L=>L.stopPropagation(),className:"hover:text-white transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),n.jsx("div",{className:"p-4 border-b border-gray-700",children:n.jsx("input",{ref:p,type:"text",placeholder:a("search.placeholder"),value:i,onChange:L=>{s(L.target.value),c(0)},className:"w-full px-3 py-2 bg-gray-900 text-white rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-accent",onKeyDown:L=>{L.key==="Escape"&&(L.preventDefault(),o()),L.stopPropagation()}})}),n.jsx("ul",{ref:h,className:"max-h-80 overflow-y-auto p-2",onWheel:L=>L.stopPropagation(),children:q.length>0?q.map((L,M)=>{const V=M>0?q[M-1]:null,H=L.isRecent,F=V?V.isRecent:!1;let G=!1,B="",Y="";return H?M===0&&(G=!0,B="Recent",Y="bg-gray-700 text-gray-300"):(!V||F||L.group!==V.group)&&(G=!0,B=P[L.group],Y=R[L.group]),n.jsxs(Et.Fragment,{children:[G&&n.jsx("li",{className:`px-3 py-1 mt-2 mb-1 text-xs font-bold rounded ${Y} select-none list-none uppercase tracking-wider`,"aria-hidden":"true",children:B}),n.jsxs("li",{"data-index":M,onClick:()=>j(L.type),onMouseEnter:()=>c(M),className:`flex items-center space-x-4 p-3 rounded-md cursor-pointer transition-colors duration-150 ${M===l?"bg-accent":"hover:bg-gray-700"}`,children:[n.jsx("div",{className:`flex-shrink-0 w-8 h-8 flex items-center justify-center rounded ${M===l?"text-white":"text-gray-300"}`,children:L.icon}),n.jsxs("div",{children:[n.jsx("p",{className:`font-semibold ${M===l?"text-white":"text-gray-100"}`,children:L.title}),n.jsx("p",{className:`text-sm ${M===l?"text-white/80":"text-gray-400"}`,children:L.description})]})]})]},`${L.type}-${M}`)}):n.jsx("li",{className:"p-4 text-center text-gray-500",children:a("search.noResults")})})]})})},vI=({title:e,onClick:t,children:o,isActive:r})=>{const[a,i]=y.useState(!1);return n.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:[n.jsx("button",{onClick:t,"aria-label":e,className:`flex items-center justify-center w-9 h-9 p-2 rounded-md transition-colors text-gray-300 hover:text-white ${r?"bg-accent text-white":"bg-gray-700 hover:bg-accent"}`,children:o}),n.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 opacity-0 pointer-events-none group-hover:opacity-100",role:"tooltip",children:e})]})},wI=({isOpen:e,position:t,onClose:o,onAddNode:r,onToolChange:a,activeTool:i,isPinned:s,onPinToggle:l,onPaste:c})=>{const{t:d}=vt(),u=y.useRef(null),[p,h]=y.useState({opacity:0,pointerEvents:"none"}),[x,k]=y.useState(!1),[C,w]=y.useState({x:0,y:0}),f=y.useRef(null),g=y.useRef(!1);y.useEffect(()=>{if(e){if(w({x:0,y:0}),u.current){const A=u.current.getBoundingClientRect(),N=window.innerWidth,j=window.innerHeight,L=20,M=[{left:t.x+L,top:t.y+L},{left:t.x-A.width-L,top:t.y+L},{left:t.x+L,top:t.y-A.height-L},{left:t.x-A.width-L,top:t.y-A.height-L}];let V=null;for(const H of M){const F={left:H.left,top:H.top,right:H.left+A.width,bottom:H.top+A.height};if(F.left>=L&&F.right<=N-L&&F.top>=L&&F.bottom<=j-L){V=H;break}}V||(V=M.find(H=>{const F={left:H.left,top:H.top,right:H.left+A.width,bottom:H.top+A.height};return F.left>=0&&F.right<=N&&F.top>=0&&F.bottom<=j})||M[0]),V.left+A.width>N&&(V.left=N-A.width-L),V.top+A.height>j&&(V.top=j-A.height-L),V.left<0&&(V.left=L),V.top<0&&(V.top=L),h({left:V.left,top:V.top,position:"fixed",opacity:1,transition:"opacity 150ms ease-in-out"})}}else h({opacity:0,pointerEvents:"none"})},[e,t]);const v=A=>{A.stopPropagation(),!A.target.closest("button")&&(A.preventDefault(),A.currentTarget.setPointerCapture(A.pointerId),f.current={x:A.clientX-C.x,y:A.clientY-C.y},g.current=!0)},_=A=>{f.current&&w({x:A.clientX-f.current.x,y:A.clientY-f.current.y})},S=A=>{g.current=!1,f.current=null,A.currentTarget.releasePointerCapture(A.pointerId)},T=()=>{c&&(c(),o())},P=y.useMemo(()=>({tools:{items:[{type:"tool",id:"edit",title:d("quickadd.tool.edit"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})},{type:"tool",id:"cutter",title:d("quickadd.tool.cutter"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{type:"tool",id:"selection",title:d("quickadd.tool.selection"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"4 4",d:"M3.75 3.75h16.5v16.5H3.75z"})})}]},inputs:{items:[{type:"node",id:z.TEXT_INPUT,title:d("search.node.text_input.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 6h10M12 6v12"})})},{type:"node",id:z.IMAGE_INPUT,title:d("search.node.image_input.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{d:"M21 15l-5-5L5 21"})]})},{type:"node",id:z.MEDIA_VIEWER,title:d("search.node.media_viewer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})}]},processing:{items:[{type:"node",id:z.PROMPT_PROCESSOR,title:d("search.node.prompt_processor.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})},{type:"node",id:z.PROMPT_ANALYZER,title:d("search.node.prompt_analyzer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})},{type:"node",id:z.IMAGE_ANALYZER,title:d("search.node.image_analyzer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12.792V5.25a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 5.25v13.5A2.25 2.25 0 005.25 21h7.55"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 18.375L21 21"})]})}]},character:{items:[{type:"node",id:z.CHARACTER_GENERATOR,title:d("search.node.character_generator.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})})},{type:"node",id:z.CHARACTER_ANALYZER,title:d("search.node.character_analyzer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})},{type:"node",id:z.CHARACTER_CARD,title:d("search.node.character_card.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 8a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5a7.5 7.5 0 0115 0"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.5a.75.75 0 00-.75.75v13.5c0 .414.336.75.75.75h16.5a.75.75 0 00.75-.75V5.25a.75.75 0 00-.75-.75H3.75z"})]})}]},outputs:{items:[{type:"node",id:z.IMAGE_OUTPUT,title:d("search.node.image_output.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})},{type:"node",id:z.IMAGE_EDITOR,title:d("search.node.image_editor.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]})},{type:"node",id:z.IMAGE_SEQUENCE_GENERATOR,title:d("search.node.image_sequence_generator.title").replace("Sequence","Seq.").replace("","."),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})})}]},ai:{items:[{type:"node",id:z.GEMINI_CHAT,title:d("search.node.gemini_chat.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{type:"node",id:z.TRANSLATOR,title:d("search.node.translator.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})},{type:"node",id:z.PROMPT_SANITIZER,title:d("search.node.prompt_sanitizer.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})}]},video:{items:[{type:"node",id:z.VIDEO_PROMPT_PROCESSOR,title:d("search.node.video_prompt_processor.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7l-2 4 4 2-4 2-2 4-2-4-4-2 4-2z"})]})},{type:"node",id:z.VIDEO_OUTPUT,title:d("search.node.video_output.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9A2.25 2.25 0 0013.5 5.25h-9A2.25 2.25 0 002.25 7.5v9A2.25 2.25 0 004.5 18.75z"})})},{type:"node",id:z.VIDEO_EDITOR,title:d("node.title.video_editor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})]})}]},scripts:{items:[{type:"node",id:z.SCRIPT_GENERATOR,title:d("search.node.script_generator.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})},{type:"node",id:z.SCRIPT_VIEWER,title:d("search.node.script_viewer.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 19.82a2.25 2.25 0 01-1.897 1.13l-2.685.8.8-2.685a2.25 2.25 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})}]},general:{items:[{type:"node",id:z.NOTE,title:d("search.node.note.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})},{type:"node",id:z.DATA_READER,title:d("search.node.data_reader.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})},{type:"node",id:z.PROMPT_SEQUENCE_EDITOR,title:d("search.node.prompt_sequence_editor.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z"})})}]}}),[d]),R=A=>{A.type==="tool"?a(A.id):A.type==="node"&&r(A.id),o()},D=Object.keys(P),q=D.slice(0,5),O=D.slice(5),E=A=>{const N=P[A];return n.jsxs("div",{children:[n.jsx("h3",{className:"text-xs text-gray-400 uppercase font-bold mb-1 px-1 select-none",children:d(`quickadd.group.${A}`)}),n.jsx("div",{className:"flex flex-wrap gap-1",children:N.items.map(j=>n.jsx(vI,{title:j.title,onClick:()=>R(j),isActive:j.type==="tool"&&j.id===i,children:j.icon},j.id))})]},A)};return n.jsxs("div",{ref:u,className:"fixed bg-gray-800 rounded-lg shadow-2xl p-2 flex flex-col w-auto z-[51]",style:{...p,transform:`translate(${C.x}px, ${C.y}px)`},onMouseDown:A=>A.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center justify-between px-1 pb-2 mb-1 border-b border-gray-700 cursor-move",onPointerDown:v,onPointerMove:_,onPointerUp:S,children:[n.jsx("span",{className:"text-sm font-bold text-gray-300 select-none",children:d("quickadd.title")}),n.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),children:[n.jsx("button",{onClick:A=>{A.stopPropagation(),l&&l()},className:`p-1 rounded hover:bg-white/10 transition-colors ${s?"text-accent":"text-gray-500 hover:text-gray-300"}`,onMouseDown:A=>A.stopPropagation(),children:n.jsx(Ip,{className:"h-4 w-4"})}),n.jsx("div",{className:`absolute top-full right-0 mt-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 opacity-0 pointer-events-none origin-top-right transform ${x?"opacity-100 scale-100":"scale-90"}`,role:"tooltip",children:s?"Unpin menu":"Pin menu to screen"})]})]}),n.jsxs("div",{className:"flex space-x-4 p-1",children:[n.jsx("div",{className:"flex flex-col space-y-3",children:q.map(E)}),n.jsx("div",{className:"flex flex-col space-y-3",children:O.map(E)})]}),c&&n.jsx("div",{className:"mt-2 pt-2 border-t border-gray-700",children:n.jsxs("button",{onClick:T,className:"w-full flex items-center justify-center p-2 rounded-md bg-input hover:bg-accent text-gray-300 hover:text-white transition-colors gap-2 group",title:d("node.action.paste"),children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400 group-hover:text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),n.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:d("node.action.paste")})]})})]})},c0=150,d0=50,si=400,ta=si/2,bI=184,u0=116,CI=60,kI=({isOpen:e,position:t,onClose:o,onAddNode:r,onSelectItem:a})=>{const{t:i}=vt(),[s,l]=y.useState(null),c=y.useMemo(()=>[{name:i("quickadd.group.inputs"),color:"bg-blue-600",textColor:"text-blue-400",options:[{type:z.TEXT_INPUT,title:i("search.node.text_input.title"),icon:n.jsx("span",{className:"font-bold text-xl leading-none",children:"[T]"}),hotkey:"T"},{type:z.IMAGE_INPUT,title:i("search.node.image_input.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:[n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{d:"M21 15l-5-5L5 21"})]}),hotkey:"I"},{type:z.MEDIA_VIEWER,title:i("search.node.media_viewer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),hotkey:"M"},{type:z.PROMPT_SEQUENCE_EDITOR,title:i("search.node.prompt_sequence_editor.title").replace("Sequence","Seq.").replace("","."),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z"})}),hotkey:"Q"}]},{name:i("quickadd.group.processing"),color:"bg-purple-600",textColor:"text-purple-400",options:[{type:z.IMAGE_ANALYZER,title:i("search.node.image_analyzer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12.792V5.25a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 5.25v13.5A2.25 2.25 0 005.25 21h7.55"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 18.375L21 21"})]}),hotkey:"Shift + A"},{type:z.PROMPT_ANALYZER,title:i("search.node.prompt_analyzer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]}),hotkey:"A"},{type:z.PROMPT_PROCESSOR,title:i("search.node.prompt_processor.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})}),hotkey:"P"}]},{name:i("quickadd.group.character"),color:"bg-pink-600",textColor:"text-pink-400",options:[{type:z.CHARACTER_GENERATOR,title:i("search.node.character_generator.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})}),hotkey:"Shift + C"},{type:z.CHARACTER_ANALYZER,title:i("search.node.character_analyzer.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]}),hotkey:"Ctrl + Shift + A"},{type:z.CHARACTER_CARD,title:i("search.node.character_card.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 8a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5a7.5 7.5 0 0115 0"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.5a.75.75 0 00-.75.75v13.5c0 .414.336.75.75.75h16.5a.75.75 0 00.75-.75V5.25a.75.75 0 00-.75-.75H3.75z"})]}),hotkey:"Ctrl + Shift + C"}]},{name:i("quickadd.group.outputs"),color:"bg-teal-600",textColor:"text-teal-400",options:[{type:z.IMAGE_OUTPUT,title:i("search.node.image_output.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]}),hotkey:"O"},{type:z.IMAGE_EDITOR,title:i("search.node.image_editor.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]}),hotkey:"Shift + I"},{type:z.IMAGE_SEQUENCE_GENERATOR,title:i("search.node.image_sequence_generator.title").replace("Sequence","Seq.").replace("","."),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})}),hotkey:"Shift + Q"}]},{name:i("quickadd.group.ai"),color:"bg-green-600",textColor:"text-green-400",options:[{type:z.GEMINI_CHAT,title:i("search.node.gemini_chat.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),hotkey:"G"},{type:z.TRANSLATOR,title:i("search.node.translator.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})}),hotkey:"L"}]},{name:i("quickadd.group.scripts"),color:"bg-lime-600",textColor:"text-lime-400",options:[{type:z.SCRIPT_VIEWER,title:i("search.node.script_viewer.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 19.82a2.25 2.25 0 01-1.897 1.13l-2.685.8.8-2.685a2.25 2.25 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})}),hotkey:"Shift + V"}]},{name:i("quickadd.group.video"),color:"bg-red-600",textColor:"text-red-400",options:[{type:z.VIDEO_PROMPT_PROCESSOR,title:i("search.node.video_prompt_processor.title"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7l-2 4 4 2-4 2-2 4-2-4-4-2 4-2z"})]}),hotkey:"Shift + P"},{type:z.VIDEO_OUTPUT,title:i("search.node.video_output.title"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9A2.25 2.25 0 0013.5 5.25h-9A2.25 2.25 0 002.25 7.5v9A2.25 2.25 0 004.5 18.75z"})}),hotkey:"Shift + O"},{type:z.VIDEO_EDITOR,title:i("node.title.video_editor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})]}),hotkey:"E"}]}],[i]),d=y.useMemo(()=>c.flatMap(k=>k.options.map(C=>({...C,groupColor:k.color,textColor:k.textColor}))),[c]),u=2*Math.PI/d.length,p=y.useCallback((k,C)=>{const w=k-t.x,f=C-t.y;if(Math.sqrt(w*w+f*f)<CI){s!==null&&(l(null),a(null));return}let v=Math.atan2(f,w);v<0&&(v+=2*Math.PI);const _=d.length,S=2*Math.PI/_,T=Math.PI-S/2;let P=v-T;P<0&&(P+=2*Math.PI);const R=Math.floor(P/S)%_,D=d[R];(s==null?void 0:s.type)!==D.type&&(l(D),a(D.type))},[d,s,a,t.x,t.y]),h=y.useCallback(()=>{s?r(s.type):o()},[s,r,o]);y.useEffect(()=>{if(!e){l(null),a(null);return}const k=f=>{f.key==="Escape"&&o()},C=f=>{f.touches.length>0&&p(f.touches[0].clientX,f.touches[0].clientY)},w=()=>{h()};return window.addEventListener("keydown",k),window.addEventListener("touchmove",C),window.addEventListener("touchend",w),window.addEventListener("touchcancel",w),()=>{window.removeEventListener("keydown",k),window.removeEventListener("touchmove",C),window.removeEventListener("touchend",w),window.removeEventListener("touchcancel",w)}},[e,o,p,h,a]);const x=k=>{p(k.clientX,k.clientY)};return e?n.jsx("div",{className:"fixed inset-0 z-40",onMouseUp:()=>h(),onMouseMove:x,onMouseDown:k=>k.stopPropagation(),onContextMenu:k=>k.preventDefault(),children:n.jsxs("div",{className:"absolute pointer-events-none",style:{left:t.x,top:t.y},children:[n.jsxs("svg",{width:si,height:si,className:"absolute top-0 left-0 -translate-x-1/2 -translate-y-1/2",viewBox:`0 0 ${si} ${si}`,style:{filter:"drop-shadow(0 10px 15px rgba(0,0,0,0.1))"},children:[n.jsx("defs",{children:n.jsxs("mask",{id:"donut-mask",children:[n.jsx("rect",{width:"100%",height:"100%",fill:"white"}),n.jsx("circle",{cx:ta,cy:ta,r:u0,fill:"black"})]})}),n.jsx("circle",{cx:ta,cy:ta,r:bI,fill:"rgba(17, 24, 39, 0.85)",mask:"url(#donut-mask)",stroke:"rgb(75, 85, 99)",strokeWidth:"1"}),n.jsx("circle",{cx:ta,cy:ta,r:u0,fill:"none",stroke:"rgb(75, 85, 99)",strokeWidth:"1"})]}),n.jsxs("div",{className:"absolute top-0 left-0 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-center pointer-events-none w-48 h-48",children:[n.jsx("div",{className:`flex items-center justify-center w-20 h-20 rounded-lg mb-2 transition-all duration-200 ease-in-out shadow-lg border-2 border-white/10 ${s?`opacity-100 scale-100 ${s.groupColor}`:"opacity-0 scale-90"}`,children:s&&n.jsx("div",{className:"text-white",children:s.icon})}),n.jsxs("div",{className:"bg-gray-900/80 backdrop-blur-sm text-white px-4 py-2 rounded-lg text-center transition-opacity duration-200 flex flex-col items-center",style:{opacity:s?1:0},children:[n.jsx("span",{className:"text-sm font-semibold whitespace-nowrap",children:s==null?void 0:s.title}),(s==null?void 0:s.hotkey)&&n.jsx("span",{className:"text-xs text-gray-400 font-mono mt-0.5",children:s.hotkey})]})]}),d.map((k,C)=>{const w=u*C+Math.PI,f=c0*Math.cos(w),g=c0*Math.sin(w),v=(s==null?void 0:s.type)===k.type;return n.jsx("div",{className:`absolute flex items-center justify-center rounded-full transition-all duration-200 ease-in-out ${v?k.groupColor:""} ${v?"text-white":k.textColor}`,style:{width:d0,height:d0,top:0,left:0,transform:`translate(-50%, -50%) translate(${f}px, ${g}px) scale(${v?1.25:1})`,zIndex:v?10:1},children:k.icon},k.type)})]})}):null},Do=({tooltip:e,tooltipPosition:t="top",children:o,className:r,onMouseDown:a,...i})=>{const[s,l]=y.useState(!1);return n.jsxs("button",{className:`relative ${r}`,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),onMouseDown:a,...i,children:[o,e&&n.jsx("div",{className:`absolute ${t==="top"?"bottom-full mb-2 origin-bottom":"top-full mt-2 origin-top"} left-1/2 -translate-x-1/2 px-2 py-1 bg-slate-700 text-slate-200 text-xs whitespace-nowrap rounded shadow-xl z-[70] pointer-events-none transition-all duration-100 ease-out transform ${s?"opacity-100 scale-100":"opacity-0 scale-90"}`,children:e})]})},_s=e=>{switch(e){case"edit":return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})});case"cutter":return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});case"selection":return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"4 4",d:"M3.75 3.75h16.5v16.5H3.75z"})});case"reroute":return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})});default:return null}},Q1=e=>{if(!e)return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})});switch(e){case z.TEXT_INPUT:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 6h10M12 6v12"})});case z.IMAGE_INPUT:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),n.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),n.jsx("path",{d:"M21 15l-5-5L5 21"})]});case z.MEDIA_VIEWER:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]});case z.PROMPT_SEQUENCE_EDITOR:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z"})});case z.PROMPT_PROCESSOR:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]});case z.PROMPT_ANALYZER:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]});case z.IMAGE_ANALYZER:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12.792V5.25a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 5.25v13.5A2.25 2.25 0 005.25 21h7.55"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 18.375L21 21"})]});case z.CHARACTER_GENERATOR:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})});case z.CHARACTER_ANALYZER:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]});case z.CHARACTER_CARD:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 8a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5a7.5 7.5 0 0115 0"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 4.5a.75.75 0 00-.75.75v13.5c0 .414.336.75.75.75h16.5a.75.75 0 00.75-.75V5.25a.75.75 0 00-.75-.75H3.75z"})]});case z.IMAGE_OUTPUT:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]});case z.IMAGE_EDITOR:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]});case z.IMAGE_SEQUENCE_GENERATOR:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})});case z.GEMINI_CHAT:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});case z.TRANSLATOR:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})});case z.PROMPT_SANITIZER:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})});case z.VIDEO_PROMPT_PROCESSOR:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7l-2 4 4 2-4 2-2 4-2-4-4-2 4-2z"})]});case z.VIDEO_OUTPUT:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9A2.25 2.25 0 0013.5 5.25h-9A2.25 2.25 0 002.25 7.5v9A2.25 2.25 0 004.5 18.75z"})});case z.SCRIPT_GENERATOR:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})});case z.SCRIPT_VIEWER:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 19.82a2.25 2.25 0 01-1.897 1.13l-2.685.8.8-2.685a2.25 2.25 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})});case z.NOTE:return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})});case z.DATA_READER:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]});case z.VIDEO_EDITOR:return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})]});default:return n.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-500"})}},yu=(e,t)=>t(`search.node.${e.toLowerCase()}.title`)||e,_I=({onClose:e,slotIndex:t,onSelect:o,nodeGroups:r,t:a})=>{const[i,s]=y.useState(""),l=y.useRef(null);y.useEffect(()=>{l.current&&l.current.focus()},[]);const c=y.useMemo(()=>{if(!i)return r;const d={},u=i.toLowerCase();return Object.keys(r).forEach(p=>{const h=r[p].filter(x=>yu(x,a).toLowerCase().includes(u));h.length>0&&(d[p]=h)}),d},[r,i,a]);return n.jsxs("div",{className:"absolute top-0 left-0 w-full max-h-[340px] bg-gray-900/95 backdrop-blur-md rounded-lg shadow-2xl border border-node-border flex flex-col overflow-hidden z-20",children:[n.jsxs("div",{className:"flex flex-col p-2 border-b border-node-border flex-shrink-0 bg-input/30",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("span",{className:"text-xs font-bold text-gray-300",children:["Assign Slot ",t+1]}),n.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414-1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),n.jsx("input",{ref:l,type:"text",placeholder:"Search...",className:"w-full bg-input text-xs text-gray-200 border border-node-border rounded px-2 py-1 focus:outline-none focus:border-accent",value:i,onChange:d=>s(d.target.value),onKeyDown:d=>d.stopPropagation()})]}),n.jsx("div",{className:"overflow-y-auto p-2 space-y-3 custom-scrollbar flex-grow",children:Object.keys(c).length>0?Object.keys(c).map(d=>n.jsxs("div",{children:[n.jsx("h4",{className:"text-[10px] uppercase font-bold text-gray-500 mb-1 px-1",children:a(`quickadd.group.${d}`)}),n.jsx("div",{className:"grid grid-cols-1 gap-1",children:c[d].map(u=>n.jsxs("button",{onClick:()=>o(u),className:"flex items-center space-x-2 p-2 rounded hover:bg-accent/30 text-left transition-colors group",children:[n.jsx("div",{className:"text-gray-400 group-hover:text-accent",children:Q1(u)}),n.jsx("span",{className:"text-xs text-gray-200 group-hover:text-white truncate",children:yu(u,a)})]},u))})]},d)):n.jsx("div",{className:"p-2 text-xs text-gray-500 text-center",children:"No results found"})})]})},p0=280,h0=176,SI=({isOpen:e,position:t,onClose:o,onToolSelect:r,slots:a,onSlotUpdate:i,onSetSlots:s,onAddNode:l,isPinned:c,onPinToggle:d,zoom:u,onZoomChange:p,scaleToSliderValue:h,sliderValueToScale:x,onPaste:k})=>{const{t:C}=vt(),[w,f]=y.useState(null),g=y.useRef(null),[v,_]=y.useState({opacity:0,pointerEvents:"none",transform:"scale(0.95)",transition:"opacity 0.15s ease-out, transform 0.15s ease-out"}),[S,T]=y.useState({x:0,y:0}),P=y.useRef(null),R=y.useRef(!1),D=y.useRef(null);y.useEffect(()=>{e?(f(null),T({x:0,y:0}),t.x,t.y,requestAnimationFrame(()=>{_({opacity:1,pointerEvents:"auto",transform:"scale(1)",transition:"opacity 0.15s ease-out, transform 0.15s ease-out"})})):_({opacity:0,pointerEvents:"none",transform:"scale(0.95)",transition:"opacity 0.1s ease-in, transform 0.1s ease-in"})},[e,t]),y.useEffect(()=>{const $=Z=>{g.current&&!g.current.contains(Z.target)&&!R.current&&o()};return e&&!c&&window.addEventListener("mousedown",$),()=>window.removeEventListener("mousedown",$)},[e,o,c]);const q=$=>{$.preventDefault(),$.stopPropagation(),$.currentTarget.setPointerCapture($.pointerId),P.current={x:$.clientX-S.x,y:$.clientY-S.y},R.current=!0},O=$=>{P.current&&T({x:$.clientX-P.current.x,y:$.clientY-P.current.y})},E=$=>{R.current=!1,P.current=null,$.currentTarget.releasePointerCapture($.pointerId)},A=$=>{p&&x&&p(x(Number($.target.value)))},N=()=>{p&&p(1)},j=$=>{r($),o()},L=()=>{k&&(k(),o())},M=($,Z)=>{Z.stopPropagation();const te=a[$];te?(l(te),o()):f($)},V=($,Z)=>{Z.preventDefault(),Z.stopPropagation(),f($)},H=$=>{w!==null&&(i(w,$),f(null))},F=()=>{const $=JSON.stringify(a,null,2),Z=new Blob([$],{type:"application/json"}),te=URL.createObjectURL(Z),ae=document.createElement("a");ae.href=te,ae.download="prompt-modifier-slots.json",document.body.appendChild(ae),ae.click(),document.body.removeChild(ae),URL.revokeObjectURL(te)},G=()=>{var $;($=D.current)==null||$.click()},B=$=>{var ae;const Z=(ae=$.target.files)==null?void 0:ae[0];if(!Z)return;const te=new FileReader;te.onload=I=>{var J;try{const W=JSON.parse((J=I.target)==null?void 0:J.result);Array.isArray(W)&&W.length===8&&s?s(W):alert("Invalid slots file format")}catch(W){console.error(W),alert("Failed to load slots file")}D.current&&(D.current.value="")},te.readAsText(Z)},Y=y.useMemo(()=>({inputs:[z.TEXT_INPUT,z.IMAGE_INPUT,z.PROMPT_SEQUENCE_EDITOR,z.DATA_READER,z.NOTE,z.MEDIA_VIEWER],processing:[z.PROMPT_PROCESSOR,z.PROMPT_ANALYZER,z.IMAGE_ANALYZER,z.PROMPT_SANITIZER],character:[z.CHARACTER_GENERATOR,z.CHARACTER_ANALYZER,z.CHARACTER_CARD,z.POSE_CREATOR],outputs:[z.IMAGE_OUTPUT,z.IMAGE_EDITOR,z.IMAGE_SEQUENCE_GENERATOR],ai:[z.GEMINI_CHAT,z.TRANSLATOR],video:[z.VIDEO_PROMPT_PROCESSOR,z.VIDEO_OUTPUT,z.SCRIPT_GENERATOR,z.SCRIPT_VIEWER,z.VIDEO_EDITOR]}),[]);let ee=t.x,ie=t.y;ee+h0>window.innerWidth&&(ee=ee-h0),ie+p0>window.innerHeight&&(ie=ie-p0);const ce=ee+S.x,pe=ie+S.y,ue=h&&u?h(u):0,re=Math.round((u||1)*100);return e?n.jsx("div",{ref:g,className:"fixed z-[60] w-44",style:{...v,left:ce,top:pe},onMouseDown:$=>$.stopPropagation(),onWheel:$=>$.stopPropagation(),onContextMenu:$=>$.preventDefault(),children:n.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-2xl w-full relative z-10 flex flex-col",children:[n.jsxs("div",{className:"flex items-center justify-between px-2 py-2 cursor-move select-none border-b border-gray-700 rounded-t-lg",onPointerDown:q,onPointerMove:O,onPointerUp:E,children:[n.jsx("span",{className:"text-xs font-bold text-gray-400 pl-1",children:C("quickadd.group.tools")}),n.jsx(Do,{onClick:$=>{$.stopPropagation(),d&&d()},onPointerDown:$=>$.stopPropagation(),onMouseDown:$=>$.stopPropagation(),className:`p-1 rounded hover:bg-white/10 transition-colors ${c?"text-accent":"text-gray-500 hover:text-gray-300"}`,tooltip:c?"Unpin menu":"Pin menu to screen",tooltipPosition:"bottom",children:n.jsx(Ip,{className:"h-4 w-4"})})]}),n.jsxs("div",{className:"p-2 grid grid-cols-4 gap-1",children:[n.jsx(Do,{onClick:()=>j("edit"),className:"flex items-center justify-center rounded-md bg-input/50 text-gray-300 hover:bg-accent hover:text-white transition-colors h-9 w-9",tooltip:C("toolbar.edit"),children:_s("edit")}),n.jsx(Do,{onClick:()=>j("cutter"),className:"flex items-center justify-center rounded-md bg-input/50 text-gray-300 hover:bg-accent hover:text-white transition-colors h-9 w-9",tooltip:C("toolbar.cutter"),children:_s("cutter")}),n.jsx(Do,{onClick:()=>j("selection"),className:"flex items-center justify-center rounded-md bg-input/50 text-gray-300 hover:bg-accent hover:text-white transition-colors h-9 w-9",tooltip:C("toolbar.selection"),children:_s("selection")}),n.jsx(Do,{onClick:()=>j("reroute"),className:"flex items-center justify-center rounded-md bg-input/50 text-gray-300 hover:bg-accent hover:text-white transition-colors h-9 w-9",tooltip:C("toolbar.reroute"),children:_s("reroute")})]}),n.jsx("div",{className:"h-px bg-gray-700 w-full"}),n.jsx("div",{className:"p-2 grid grid-cols-4 gap-1",children:a.map(($,Z)=>n.jsxs("div",{className:"relative group",onContextMenu:te=>V(Z,te),onClick:te=>M(Z,te),children:[n.jsx("button",{className:`w-9 h-9 rounded-md flex items-center justify-center border transition-colors ${$?"bg-input/50 border-node-border text-gray-200 hover:bg-accent hover:text-white hover:border-accent":"bg-input/30 border-node-border border-dashed text-gray-600 hover:border-gray-500"}`,children:$?Q1($):n.jsx("span",{className:"text-[10px] font-mono",children:Z+1})}),n.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-slate-700 text-slate-200 text-xs whitespace-nowrap rounded shadow-xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-[70]",children:$?yu($,C):C("contextMenu.emptySlot")})]},Z))}),w!==null&&n.jsx(_I,{onClose:()=>f(null),slotIndex:w,onSelect:H,nodeGroups:Y,t:C}),n.jsx("div",{className:"h-px bg-gray-700 w-full"}),n.jsxs("div",{className:"p-2 space-y-2",children:[p&&x&&n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs(Do,{onClick:N,className:"flex items-center space-x-1 px-1.5 py-1 rounded bg-input/50 hover:bg-white/10 text-gray-400 hover:text-white transition-colors border border-transparent hover:border-node-border",tooltip:C("toolbar.resetZoom"),children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),n.jsxs("span",{className:"text-[10px] font-mono min-w-[3ch] text-right",children:[re,"%"]})]}),n.jsx("input",{type:"range",min:"-100",max:"100",step:"1",value:ue,onChange:A,className:"w-full h-1.5 bg-node-border rounded-lg appearance-none cursor-pointer accent-accent"})]}),n.jsxs("div",{className:"flex justify-between items-center pt-1",children:[n.jsxs("div",{className:"flex space-x-1",children:[n.jsx(Do,{onClick:F,className:"p-1.5 rounded bg-input hover:bg-white/10 text-gray-400 hover:text-white transition-colors",tooltip:C("contextMenu.saveSlots"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Do,{onClick:G,className:"p-1.5 rounded bg-input hover:bg-white/10 text-gray-400 hover:text-white transition-colors",tooltip:C("contextMenu.loadSlots"),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0l-4 4m4-4v12"})})}),n.jsx("input",{ref:D,type:"file",accept:".json",className:"hidden",onChange:B})]}),k&&n.jsxs(Do,{onClick:L,className:"px-2 py-1 rounded bg-input hover:bg-accent text-gray-300 hover:text-white text-xs font-semibold flex items-center gap-1 transition-colors",tooltip:C("node.action.paste"),children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),C("node.action.paste")]})]})]})]})}):null},dn=({title:e,icon:t,onClick:o,disabled:r})=>{const[a,i]=y.useState(!1);return n.jsxs("div",{className:"relative flex items-center justify-center",onMouseEnter:()=>!r&&i(!0),onMouseLeave:()=>i(!1),children:[n.jsx("button",{onClick:s=>{s.stopPropagation(),r||o()},disabled:r,className:`group flex items-center justify-center p-2 text-sm rounded-md transition-colors ${r?"text-gray-600 cursor-not-allowed":"text-gray-200 hover:bg-accent hover:text-white"}`,children:n.jsx("div",{className:`${r?"text-gray-600":"text-gray-400 group-hover:text-white"}`,children:t})}),n.jsx("div",{className:`absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-xs whitespace-nowrap rounded-md shadow-xl z-[70] pointer-events-none transition-opacity duration-200 ease-in-out ${a?"opacity-100":"opacity-0"}`,children:e})]})},NI=({isOpen:e,position:t,onClose:o,onAlign:r})=>{const{t:a}=vt(),i=y.useRef(null),s=Ut(),[l,c]=y.useState({opacity:0,pointerEvents:"none",transform:"scale(0.95)",transition:"opacity 0.15s ease-out, transform 0.15s ease-out"});if(y.useEffect(()=>{const f=g=>{i.current&&!i.current.contains(g.target)&&o()};return e&&window.addEventListener("mousedown",f),()=>window.removeEventListener("mousedown",f)},[e,o]),y.useEffect(()=>{if(e){let f=t.x,g=t.y;const v=240,_=100;f+v>window.innerWidth&&(f=f-v),g+_>window.innerHeight&&(g=g-_),requestAnimationFrame(()=>{c({left:f,top:g,opacity:1,pointerEvents:"auto",transform:"scale(1)",transition:"opacity 0.15s ease-out, transform 0.15s ease-out"})})}else c(f=>({...f,opacity:0,pointerEvents:"none",transform:"scale(0.95)"}))},[e,t]),!e&&l.opacity===0)return null;let d=!1;s&&s.selectedNodeIds.length>0&&(d=s.selectedNodeIds.some(f=>{const g=s.nodes.find(v=>v.id===f);return g?Bl(g.type):!1}));const u=f=>{r(f),o()},p=()=>{s&&s.undoPosition&&s.undoPosition(s.nodes)},h=()=>{s&&s.redoPosition&&s.redoPosition(s.nodes)},x=()=>{s&&s.selectedNodeIds.length>0&&(s.copyNodeValue(s.selectedNodeIds[s.selectedNodeIds.length-1]),o())},k=()=>{s&&(s.handlePaste(),o())},C=()=>{s&&(s.selectedNodeIds.forEach(f=>s.handleToggleNodeCollapse(f)),o())},w=f=>{s&&s.handleDockNode&&(s.selectedNodeIds.forEach(g=>s.handleDockNode(g,f)),o())};return n.jsxs("div",{ref:i,className:"fixed z-[70] bg-gray-800 rounded-lg shadow-2xl p-1 flex flex-col space-y-1",style:l,onContextMenu:f=>f.preventDefault(),onMouseDown:f=>f.stopPropagation(),children:[n.jsxs("div",{className:"flex flex-row space-x-1",children:[n.jsxs("div",{className:"flex items-center space-x-1 pr-1 border-r border-gray-600 mr-1",children:[n.jsx(dn,{title:a("contextMenu.undoPosition"),onClick:p,disabled:!(s!=null&&s.canUndo),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})})}),n.jsx(dn,{title:a("contextMenu.redoPosition"),onClick:h,disabled:!(s!=null&&s.canRedo),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"})})})]}),n.jsx(dn,{title:a("contextMenu.align.left"),onClick:()=>u("left"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"4",width:"6",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"8",width:"8",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"12",width:"4",height:"2",fill:"currentColor",rx:"1"})]})}),n.jsx(dn,{title:a("contextMenu.align.centerX"),onClick:()=>u("center-x"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"7",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1",opacity:"0.5"}),n.jsx("rect",{x:"3",y:"4",width:"10",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"8",width:"6",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"2",y:"12",width:"12",height:"2",fill:"currentColor",rx:"1"})]})}),n.jsx(dn,{title:a("contextMenu.align.right"),onClick:()=>u("right"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"12",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"5",y:"4",width:"6",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"3",y:"8",width:"8",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"7",y:"12",width:"4",height:"2",fill:"currentColor",rx:"1"})]})}),n.jsx("div",{className:"w-px bg-gray-600 my-1 mx-1"}),n.jsx(dn,{title:a("contextMenu.align.top"),onClick:()=>u("top"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"4",y:"5",width:"2",height:"6",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"8",y:"5",width:"2",height:"8",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"5",width:"2",height:"4",fill:"currentColor",rx:"1"})]})}),n.jsx(dn,{title:a("contextMenu.align.centerY"),onClick:()=>u("center-y"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"7",width:"12",height:"2",fill:"currentColor",rx:"1",opacity:"0.5"}),n.jsx("rect",{x:"4",y:"3",width:"2",height:"10",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"8",y:"5",width:"2",height:"6",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"})]})}),n.jsx(dn,{title:a("contextMenu.align.bottom"),onClick:()=>u("bottom"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"12",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"4",y:"5",width:"2",height:"6",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"8",y:"3",width:"2",height:"8",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"7",width:"2",height:"4",fill:"currentColor",rx:"1"})]})}),n.jsx("div",{className:"w-px bg-gray-600 my-1 mx-1"}),n.jsx(dn,{title:a("contextMenu.distribute.horizontal"),onClick:()=>u("distribute-horizontal"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"7",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"12",y:"2",width:"2",height:"12",fill:"currentColor",rx:"1"})]})}),n.jsx(dn,{title:a("contextMenu.distribute.vertical"),onClick:()=>u("distribute-vertical"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"2",y:"2",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"2",y:"7",width:"12",height:"2",fill:"currentColor",rx:"1"}),n.jsx("rect",{x:"2",y:"12",width:"12",height:"2",fill:"currentColor",rx:"1"})]})})]}),n.jsx("div",{className:"h-px bg-gray-600 w-full my-1"}),n.jsxs("div",{className:"flex flex-row space-x-1 justify-center",children:[n.jsx(dn,{title:a("node.action.copy"),onClick:x,icon:n.jsx(Dt,{className:"h-4 w-4"})}),n.jsx(dn,{title:a("node.action.paste"),onClick:k,icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),n.jsx(dn,{title:"Toggle Collapse",onClick:C,icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("div",{className:"w-px bg-gray-600 my-1 mx-1"}),!d&&n.jsxs(n.Fragment,{children:[n.jsx(dn,{title:a("toolbar.dock.q1"),onClick:()=>w("q1"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"1",y:"2",width:"3",height:"12",fill:"currentColor",opacity:"0.8"}),n.jsx("rect",{x:"0.5",y:"1.5",width:"15",height:"13",rx:"1.5",stroke:"currentColor",strokeOpacity:"0.3"})]})}),n.jsx(dn,{title:a("toolbar.dock.q2"),onClick:()=>w("q2"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"4.5",y:"2",width:"3",height:"12",fill:"currentColor",opacity:"0.8"}),n.jsx("rect",{x:"0.5",y:"1.5",width:"15",height:"13",rx:"1.5",stroke:"currentColor",strokeOpacity:"0.3"})]})})]}),n.jsx(dn,{title:a("toolbar.dock.left"),onClick:()=>w("left"),icon:n.jsx(G1,{className:"h-4 w-4"})}),n.jsx(dn,{title:a("toolbar.dock.right"),onClick:()=>w("right"),icon:n.jsx(H1,{className:"h-4 w-4"})}),!d&&n.jsxs(n.Fragment,{children:[n.jsx(dn,{title:a("toolbar.dock.q3"),onClick:()=>w("q3"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"8.5",y:"2",width:"3",height:"12",fill:"currentColor",opacity:"0.8"}),n.jsx("rect",{x:"0.5",y:"1.5",width:"15",height:"13",rx:"1.5",stroke:"currentColor",strokeOpacity:"0.3"})]})}),n.jsx(dn,{title:a("toolbar.dock.q4"),onClick:()=>w("q4"),icon:n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{x:"12",y:"2",width:"3",height:"12",fill:"currentColor",opacity:"0.8"}),n.jsx("rect",{x:"0.5",y:"1.5",width:"15",height:"13",rx:"1.5",stroke:"currentColor",strokeOpacity:"0.3"})]})})]})]})]})},EI=({isOpen:e,info:t,onClose:o,onSelect:r})=>{const{t:a}=vt(),i=y.useRef(null),[s,l]=y.useState({opacity:0,pointerEvents:"none"}),c=y.useMemo(()=>({text:[{type:z.PROMPT_ANALYZER,title:a("toolbar.addPromptAnalyzer"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})},{type:z.PROMPT_PROCESSOR,title:a("toolbar.addPromptProcessor"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})},{type:z.VIDEO_PROMPT_PROCESSOR,title:a("toolbar.addVideoPromptProcessor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7l-2 4 4 2-4 2-2 4-2-4-4-2 4-2z"})]})},{type:z.TRANSLATOR,title:a("toolbar.addTranslator"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})},{type:z.IMAGE_OUTPUT,title:a("toolbar.addImageOutput"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})},{type:z.IMAGE_EDITOR,title:a("toolbar.addImageEditor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-6 w-6",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]})},{type:z.REROUTE_DOT,title:a("node.title.reroute_dot"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})},{type:z.DATA_READER,title:a("toolbar.addDataReader"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}],image:[{type:z.IMAGE_ANALYZER,title:a("toolbar.addImageAnalyzer"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12.792V5.25a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 5.25v13.5A2.25 2.25 0 005.25 21h7.55"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 15.75a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 18.375L21 21"})]})},{type:z.IMAGE_EDITOR,title:a("toolbar.addImageEditor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-6 w-6",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})]})},{type:z.REROUTE_DOT,title:a("node.title.reroute_dot"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})},{type:z.DATA_READER,title:a("toolbar.addDataReader"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}],video:[{type:z.VIDEO_EDITOR,title:a("node.title.video_editor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})]})},{type:z.REROUTE_DOT,title:a("node.title.reroute_dot"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})},{type:z.DATA_READER,title:a("toolbar.addDataReader"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}],audio:[{type:z.VIDEO_EDITOR,title:a("node.title.video_editor"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6a2 2 0 012-2h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})]})},{type:z.REROUTE_DOT,title:a("node.title.reroute_dot"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})},{type:z.DATA_READER,title:a("toolbar.addDataReader"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}],character_data:[{type:z.IMAGE_SEQUENCE_GENERATOR,title:a("toolbar.addImageSequenceGenerator"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})})},{type:z.REROUTE_DOT,title:a("node.title.reroute_dot"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})},{type:z.DATA_READER,title:a("toolbar.addDataReader"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}],prompt_sequence:[{type:z.IMAGE_SEQUENCE_GENERATOR,title:a("toolbar.addImageSequenceGenerator"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})})},{type:z.DATA_READER,title:a("toolbar.addDataReader"),icon:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})},{type:z.REROUTE_DOT,title:a("node.title.reroute_dot"),icon:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})}]}),[a]),d=y.useMemo(()=>t?t.sourceNodeType===z.PROMPT_SEQUENCE_EDITOR?c.prompt_sequence:(t.connectingInfo.fromType?c[t.connectingInfo.fromType]:[])||[]:[],[t,c]);return y.useEffect(()=>{const u=h=>{i.current&&!i.current.contains(h.target)&&o()},p=h=>{const x=parseInt(h.key);if(!isNaN(x)&&x>0&&x<=9){const k=x-1;d[k]&&(h.preventDefault(),h.stopPropagation(),r(d[k].type))}else h.key==="Escape"&&o()};return e&&(document.addEventListener("mousedown",u),window.addEventListener("keydown",p)),()=>{document.removeEventListener("mousedown",u),window.removeEventListener("keydown",p)}},[e,o,d,r]),y.useEffect(()=>{if(e&&i.current&&t){const{position:u}=t;if(d.length===0){o();return}const p=i.current.getBoundingClientRect();let h=u.x+10,x=u.y+10;h+p.width>window.innerWidth&&(h=u.x-p.width-10),x+p.height>window.innerHeight&&(x=u.y-p.height-10),l({left:Math.max(0,h),top:Math.max(0,x),position:"fixed",opacity:1,transition:"opacity 150ms ease-in-out"})}else e||l({opacity:0,pointerEvents:"none"})},[e,t,d,o]),n.jsx("div",{ref:i,className:"fixed bg-gray-800 rounded-lg shadow-2xl p-2 flex flex-col space-y-1 z-50",style:s,onMouseDown:u=>u.stopPropagation(),children:d.map((u,p)=>n.jsxs("button",{onClick:()=>r(u.type),className:"flex items-center space-x-3 p-2 rounded-md text-left w-full text-gray-200 hover:bg-accent hover:text-white transition-colors group",children:[n.jsxs("span",{className:"text-xs font-mono font-bold text-gray-500 group-hover:text-white w-4 text-right",children:[p+1,"."]}),n.jsx("div",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center",children:u.icon}),n.jsx("span",{className:"text-sm font-semibold",children:u.title})]},u.type))})},PI=({isOpen:e,initialValue:t,onConfirm:o,onClose:r,title:a,label:i,confirmButtonText:s,cancelButtonText:l,deselectAllNodes:c})=>{const{t:d}=vt(),[u,p]=y.useState(t),h=y.useRef(null),[x,k]=y.useState(!1);y.useEffect(()=>{if(e)p(t),k(!0),setTimeout(()=>{var f,g;(f=h.current)==null||f.focus(),(g=h.current)==null||g.select()},100);else{const f=setTimeout(()=>k(!1),300);return()=>clearTimeout(f)}},[e,t]);const C=()=>{u.trim()&&o(u.trim()),r()},w=f=>{f.key==="Enter"?C():f.key==="Escape"&&r()};return!e&&!x?null:n.jsx("div",{className:`fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300 ease-in-out ${e?"opacity-100":"opacity-0"}`,onMouseDown:r,children:n.jsxs("div",{className:`bg-gray-800 border border-gray-700 rounded-xl shadow-2xl w-full max-w-sm flex flex-col select-none transform transition-all duration-300 ease-in-out ${e?"opacity-100 scale-100":"opacity-0 scale-95"}`,onMouseDown:f=>f.stopPropagation(),onKeyDown:w,children:[n.jsx("div",{className:"px-6 py-4 border-b border-gray-700 bg-[#18202f] rounded-t-xl",children:n.jsx("h2",{className:"text-lg font-bold text-accent-text",children:a||d("dialog.rename.title")})}),n.jsxs("div",{className:"p-6 space-y-4",children:[n.jsx("label",{htmlFor:"rename-input",className:"block text-sm font-medium text-gray-400",children:i||d("dialog.rename.label")}),n.jsx("input",{id:"rename-input",ref:h,type:"text",value:u,onChange:f=>p(f.target.value),onBlur:C,className:"w-full px-3 py-2 bg-gray-900 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent transition-colors",onFocus:c})]}),n.jsxs("div",{className:"px-6 py-4 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-900 rounded-b-xl",children:[n.jsx("button",{onClick:r,className:"px-4 py-2 font-semibold text-gray-400 bg-gray-800 hover:bg-gray-700 hover:text-white rounded-lg transition-colors border border-gray-600",children:l||d("dialog.rename.cancel")}),n.jsx("button",{onClick:C,className:"px-4 py-2 font-bold text-white bg-accent rounded-lg hover:bg-accent-hover transition-colors shadow-lg shadow-accent/20",children:s||d("dialog.rename.confirm")})]})]})})},TI=({isOpen:e,onAllow:t,onDecline:o})=>{const{t:r}=vt(),[a,i]=y.useState(!1);return y.useEffect(()=>{if(e)i(!0);else{const s=setTimeout(()=>i(!1),300);return()=>clearTimeout(s)}},[e]),!e&&!a?null:n.jsx("div",{className:`fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300 ease-in-out ${e?"opacity-100":"opacity-0"}`,children:n.jsxs("div",{className:`bg-gray-800 border border-gray-700 rounded-xl shadow-2xl w-full max-w-md flex flex-col select-none transform transition-all duration-300 ease-in-out ${e?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:[n.jsx("div",{className:"px-6 py-4 border-b border-gray-700 bg-[#18202f] rounded-t-xl",children:n.jsx("h2",{className:"text-lg font-bold text-accent-text",children:r("dialog.permission.title")})}),n.jsx("div",{className:"p-6 space-y-4",children:n.jsx("p",{className:"text-sm text-gray-400 leading-relaxed",children:r("dialog.permission.description")})}),n.jsxs("div",{className:"px-6 py-4 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-900 rounded-b-xl",children:[n.jsx("button",{onClick:o,className:"px-4 py-2 font-semibold text-gray-400 bg-gray-800 hover:bg-gray-700 hover:text-white rounded-lg transition-colors border border-gray-600",children:r("dialog.permission.decline")}),n.jsx("button",{onClick:t,className:"px-4 py-2 font-bold text-white bg-accent rounded-lg hover:bg-accent-hover transition-colors shadow-lg shadow-accent/20",children:r("dialog.permission.allow")})]})]})})},II=({isOpen:e,onConfirm:t,onClose:o,title:r,message:a})=>{const{t:i}=vt(),[s,l]=y.useState(!1);y.useEffect(()=>{if(e)l(!0);else{const u=setTimeout(()=>l(!1),300);return()=>clearTimeout(u)}},[e]);const c=()=>{t(),o()},d=u=>{u.key==="Enter"?c():u.key==="Escape"&&o()};return!e&&!s?null:n.jsx("div",{className:`fixed inset-0 bg-black/60 z-[200] flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300 ease-in-out ${e?"opacity-100":"opacity-0"}`,onMouseDown:o,children:n.jsxs("div",{className:`bg-gray-800 border border-gray-700 rounded-xl shadow-2xl w-full max-w-sm flex flex-col select-none transform transition-all duration-300 ease-in-out ${e?"opacity-100 scale-100":"opacity-0 scale-95"}`,onMouseDown:u=>u.stopPropagation(),onKeyDown:d,children:[n.jsx("div",{className:"px-6 py-4 border-b border-gray-700 bg-[#18202f] rounded-t-xl",children:n.jsx("h2",{className:"text-lg font-bold text-accent-text",children:r})}),n.jsx("div",{className:"p-6 space-y-4",children:n.jsx("p",{className:"text-sm text-gray-400 leading-relaxed",children:a})}),n.jsxs("div",{className:"px-6 py-4 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-900 rounded-b-xl",children:[n.jsx("button",{onClick:o,className:"px-4 py-2 font-semibold text-gray-400 bg-gray-800 hover:bg-gray-700 hover:text-white rounded-lg transition-colors border border-gray-600",children:i("dialog.confirmDelete.cancel")}),n.jsx("button",{onClick:c,className:"px-4 py-2 font-bold text-white bg-accent rounded-lg hover:bg-accent-hover transition-colors shadow-lg shadow-accent/20",children:i("dialog.confirmDelete.confirm")})]})]})})},jI=({isOpen:e,initialName:t,initialContent:o,onConfirm:r,onClose:a,deselectAllNodes:i})=>{const{t:s}=vt(),[l,c]=y.useState(t),[d,u]=y.useState(o),p=y.useRef(null),[h,x]=y.useState(!1);y.useEffect(()=>{if(e)c(t),u(o),x(!0),setTimeout(()=>{var w;return(w=p.current)==null?void 0:w.focus()},100);else{const w=setTimeout(()=>x(!1),300);return()=>clearTimeout(w)}},[e,t,o]);const k=()=>{l.trim()&&r(l.trim(),d)},C=w=>{w.key==="Escape"&&a()};return!e&&!h?null:n.jsx("div",{className:`fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300 ease-in-out ${e?"opacity-100":"opacity-0"}`,onMouseDown:a,children:n.jsxs("div",{className:`bg-gray-800 border border-gray-700 rounded-xl shadow-2xl w-full max-w-lg flex flex-col select-none transform transition-all duration-300 ease-in-out ${e?"opacity-100 scale-100":"opacity-0 scale-95"}`,onMouseDown:w=>w.stopPropagation(),onKeyDown:C,children:[n.jsx("div",{className:"px-6 py-4 border-b border-gray-700 bg-[#18202f] rounded-t-xl",children:n.jsx("h2",{className:"text-lg font-bold text-accent-text",children:s("dialog.promptEdit.title")})}),n.jsxs("div",{className:"p-6 space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"prompt-name-input",className:"block text-sm font-medium text-gray-400 mb-2",children:s("dialog.promptEdit.nameLabel")}),n.jsx("input",{id:"prompt-name-input",ref:p,type:"text",value:l,onChange:w=>c(w.target.value),className:"w-full px-3 py-2 bg-gray-900 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent transition-colors",onFocus:i})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"prompt-content-input",className:"block text-sm font-medium text-gray-400 mb-2",children:s("dialog.promptEdit.contentLabel")}),n.jsx("textarea",{id:"prompt-content-input",value:d,onChange:w=>u(w.target.value),className:"w-full h-40 px-3 py-2 bg-gray-900 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent resize-none custom-scrollbar",onWheel:w=>w.stopPropagation(),onFocus:i})]})]}),n.jsxs("div",{className:"px-6 py-4 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-900 rounded-b-xl",children:[n.jsx("button",{onClick:a,className:"px-4 py-2 font-semibold text-gray-400 bg-gray-800 hover:bg-gray-700 hover:text-white rounded-lg transition-colors border border-gray-600",children:s("dialog.promptEdit.cancel")}),n.jsx("button",{onClick:k,className:"px-4 py-2 font-bold text-white bg-accent rounded-lg hover:bg-accent-hover transition-colors shadow-lg shadow-accent/20",children:s("dialog.promptEdit.confirm")})]})]})})},Bn=({title:e,onClick:t,children:o,disabled:r=!1})=>{const[a,i]=y.useState(!1);return n.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>!r&&i(!0),onMouseLeave:()=>i(!1),children:[n.jsx("button",{onClick:t,onMouseDown:s=>s.stopPropagation(),"aria-label":e,disabled:r,className:"p-2 text-gray-300 rounded-full hover:bg-gray-600 hover:text-white transition-colors duration-150 focus:outline-none focus:ring-1 focus:ring-cyan-500 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent",children:o}),n.jsx("div",{className:`absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-lg shadow-xl z-50 transition-all duration-200 ease-out origin-bottom transform ${a?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,role:"tooltip",children:e})]})},Ar=({title:e,children:t})=>{const[o,r]=y.useState(!1);return n.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[t,n.jsx("div",{className:`absolute top-full left-1/2 -translate-x-1/2 mt-2 px-3 py-1.5 bg-slate-700 text-slate-200 text-sm whitespace-nowrap rounded-lg shadow-xl z-50 transition-all duration-200 ease-out origin-top transform ${o?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,role:"tooltip",children:e})]})},AI=({item:e,onAddToCanvas:t,onNavigate:o,onRename:r,onSave:a,onDelete:i,draggedItem:s,onDragStart:l,onDragEnd:c,onMoveItem:d,isDragOver:u,setIsDragOver:p})=>{const{t:h}=vt(),x=e.type===gl.FOLDER,k=x?()=>o(e.id):()=>{},C=g=>{l(),e.type===gl.GROUP&&(g.dataTransfer.setData("application/prompt-modifier-drag-item",JSON.stringify({type:"catalog-group",itemId:e.id})),g.dataTransfer.effectAllowed="copyMove")},w=g=>{x&&s&&s.tab==="groups"&&s.id!==e.id&&(g.preventDefault(),p(!0))},f=g=>{x&&(g.preventDefault(),g.stopPropagation(),p(!1),d(e.id))};return n.jsxs("div",{draggable:!0,onDragStart:C,onDragEnd:c,onDragOver:w,onDragLeave:()=>p(!1),onDrop:f,className:`bg-gray-700 rounded-lg p-4 flex flex-col items-center justify-between space-y-3 border border-gray-600 hover:border-cyan-500 transition-all duration-200 transform hover:-translate-y-1 ${u?"ring-2 ring-cyan-400":""}`,children:[n.jsx("div",{className:"relative w-24 h-20 mx-auto mb-2 group",onClick:k,style:{cursor:x?"pointer":"default"},children:n.jsx("div",{className:`absolute w-full h-full ${x?"group-hover:scale-110":""} bg-gray-800 rounded-lg flex items-center justify-center shadow-lg transition-transform`,children:x?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})})}),n.jsx("p",{className:"font-semibold text-gray-100 text-center break-all w-full truncate",title:e.name,children:e.name}),n.jsxs("div",{className:"flex justify-center space-x-2 w-full pt-2 border-t border-gray-600/50",children:[!x&&n.jsx(Bn,{title:h("catalog.card.addToCanvas"),onClick:()=>t(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx(Bn,{title:h("catalog.card.rename"),onClick:()=>r(e.id,e.name),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),n.jsx(Bn,{title:h("catalog.card.save"),onClick:()=>a(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Bn,{title:h("catalog.card.delete"),onClick:()=>i(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},MI=({item:e,onNavigate:t,onEdit:o,onRename:r,onSave:a,onDelete:i,draggedItem:s,onDragStart:l,onDragEnd:c,onMoveItem:d,isDragOver:u,setIsDragOver:p})=>{const{t:h}=vt(),x=e.type===Vt.FOLDER,k=()=>{e.content&&navigator.clipboard.writeText(e.content).catch(v=>console.error("Copy failed",v))},C=x?()=>t(e.id):()=>o(e),w=v=>{l(),v.dataTransfer.setData("application/prompt-modifier-drag-item",JSON.stringify({type:e.type===Vt.FOLDER?"library-folder":"library-prompt",itemId:e.id})),v.dataTransfer.effectAllowed="copyMove"},f=v=>{x&&s&&s.tab==="library"&&s.id!==e.id&&(v.preventDefault(),p(!0))},g=v=>{x&&(v.preventDefault(),v.stopPropagation(),p(!1),d(e.id))};return n.jsxs("div",{draggable:!0,onDragStart:w,onDragEnd:c,onDragOver:f,onDragLeave:()=>p(!1),onDrop:g,className:`bg-gray-700 rounded-lg p-4 flex flex-col items-center justify-between space-y-3 border border-gray-600 hover:border-cyan-500 transition-all duration-200 transform hover:-translate-y-1 ${u?"ring-2 ring-cyan-400":""}`,children:[n.jsx("div",{className:"relative w-24 h-20 mx-auto mb-2 group",onClick:C,style:{cursor:"pointer"},children:n.jsx("div",{className:`absolute w-full h-full ${x?"group-hover:scale-110":""} bg-gray-800 rounded-lg flex items-center justify-center shadow-lg transition-transform`,children:x?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})}),n.jsxs("div",{className:"text-center w-full min-h-[4rem]",children:[n.jsx("p",{className:"font-semibold text-gray-100 break-all w-full truncate",title:e.name,children:e.name}),!x&&n.jsx("p",{className:"text-xs text-gray-400 mt-1 line-clamp-2",children:e.content||h("library.emptyPrompt")})]}),n.jsxs("div",{className:"flex justify-center space-x-2 w-full pt-2 border-t border-gray-600/50",children:[!x&&n.jsx(Bn,{title:h("library.actions.copy"),onClick:k,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),x&&n.jsx(Bn,{title:h("catalog.card.rename"),onClick:()=>r(e.id,e.name),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),n.jsx(Bn,{title:h("catalog.card.save"),onClick:()=>a(e),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Bn,{title:h("catalog.card.delete"),onClick:()=>i(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},RI=({item:e,dragItemType:t,onNavigate:o,onRename:r,onSave:a,onDelete:i,draggedItem:s,onDragStart:l,onDragEnd:c,onMoveItem:d,isDragOver:u,setIsDragOver:p,t:h})=>{const x=e.type===mp.FOLDER,k=x?()=>o(e.id):()=>{},C=y.useMemo(()=>{if(!x&&e.content)try{const _=JSON.parse(e.content);if(_.image&&typeof _.image=="string"&&_.image.startsWith("data:"))return _.image;if(_.imageBase64&&typeof _.imageBase64=="string")return`data:image/png;base64,${_.imageBase64}`;if(_.imageSources&&_.imageSources["1:1"])return _.imageSources["1:1"]}catch{}return null},[e.content,x]),w=_=>{l();const S={itemId:e.id,type:x?"content-catalog-folder":"content-catalog-item",itemType:t,content:e.content};_.dataTransfer.setData("application/prompt-modifier-drag-item",JSON.stringify(S)),_.dataTransfer.effectAllowed="copyMove"},f=_=>{x&&s&&s.tab===t&&s.id!==e.id&&(_.preventDefault(),p(!0))},g=_=>{x&&(_.preventDefault(),_.stopPropagation(),p(!1),d(e.id))},v=y.useMemo(()=>{if(x)return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})});if(C)return n.jsx("img",{src:C,alt:e.name,className:"w-full h-full object-cover rounded"});switch(t){case"CHARACTER":return n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 3h15a1.5 1.5 0 011.5 1.5v15a1.5 1.5 0 01-1.5 1.5h-15a1.5 1.5 0 01-1.5-1.5v-15A1.5 1.5 0 014.5 3z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 17.25h7.5a6 6 0 00-7.5 0z"})]});case"SCRIPT":return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})});case"PROMPT_SEQUENCE":return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 5h12M6 9h12M6 13h12M6 17h12M3 3h2.5v18H3zm15.5 0H21v18h-2.5z"})});default:return null}},[x,t,C]);return n.jsxs("div",{draggable:!0,onDragStart:w,onDragEnd:c,onDragOver:f,onDragLeave:()=>p(!1),onDrop:g,className:`bg-gray-700 rounded-lg p-4 flex flex-col items-center justify-between space-y-3 border border-gray-600 hover:border-cyan-500 transition-all duration-200 transform hover:-translate-y-1 ${u?"ring-2 ring-cyan-400":""}`,children:[n.jsx("div",{className:"relative w-24 h-20 mx-auto mb-2 group",onClick:k,style:{cursor:x?"pointer":"default"},children:n.jsx("div",{className:`absolute w-full h-full ${x?"group-hover:scale-110":""} bg-gray-800 rounded-lg flex items-center justify-center shadow-lg transition-transform overflow-hidden`,children:v})}),n.jsx("p",{className:"font-semibold text-gray-100 text-center break-all w-full truncate",title:e.name,children:e.name}),n.jsxs("div",{className:"flex justify-center space-x-2 w-full pt-2 border-t border-gray-600/50",children:[n.jsx(Bn,{title:h("catalog.card.rename"),onClick:()=>r(e.id,e.name),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),n.jsx(Bn,{title:h("catalog.card.save"),onClick:()=>a(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx(Bn,{title:h("catalog.card.delete"),onClick:()=>i(e.id),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},Qc=({catalog:e,draggedItem:t,setDraggedItem:o,dragOverTarget:r,setDragOverTarget:a,dragItemType:i,onRenameItem:s,t:l})=>n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"p-3 border-b border-gray-700 flex items-center justify-between space-x-2 flex-shrink-0",children:[n.jsxs("div",{className:"flex items-center space-x-1 min-w-0",children:[n.jsx("div",{className:`rounded-full transition-colors ${r===`back-${i}`?"ring-2 ring-cyan-500 ring-offset-2 ring-offset-gray-800":""}`,onDragOver:c=>{(t==null?void 0:t.tab)===i&&e.path.length>1&&(c.preventDefault(),a(`back-${i}`))},onDragLeave:()=>a(null),onDrop:c=>{if(c.preventDefault(),c.stopPropagation(),a(null),!t||t.tab!==i||e.path.length<=1)return;const d=e.path[e.path.length-2].id;e.moveItem(t.id,d)},children:n.jsx(Bn,{title:l("catalog.back"),onClick:e.navigateBack,disabled:e.path.length<=1,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})})}),n.jsx("div",{className:"flex items-center text-sm text-gray-400 truncate",children:e.path.map((c,d)=>n.jsxs(Et.Fragment,{children:[n.jsx("span",{onClick:()=>e.navigateToFolder(c.id),className:"px-1 hover:text-white cursor-pointer truncate",children:c.name}),d<e.path.length-1&&n.jsx("span",{className:"px-1 select-none",children:"/"})]},c.id||"root"))})]}),n.jsxs("div",{className:"flex space-x-2 flex-shrink-0",children:[n.jsx(Ar,{title:l("catalog.load"),children:n.jsxs("button",{onClick:e.triggerLoadFromFile,className:"px-3 py-2 text-sm font-semibold bg-teal-600 hover:bg-teal-700 rounded-md flex items-center space-x-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})}),n.jsx("span",{children:l("library.loadFromFile")})]})}),n.jsx(Ar,{title:l("catalog.newFolder"),children:n.jsxs("button",{onClick:()=>e.createItem(mp.FOLDER,l("library.actions.newFolder")),className:"px-3 py-2 text-sm font-semibold bg-gray-600 hover:bg-gray-500 rounded-md flex items-center space-x-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),n.jsx("span",{children:l("library.actions.newFolder")})]})})]})]}),n.jsx("div",{className:"flex-grow overflow-y-auto p-4",children:e.currentItems.length>0?n.jsx("div",{className:"grid grid-cols-3 gap-4",children:e.currentItems.map(c=>n.jsx(RI,{item:c,dragItemType:i,onNavigate:e.navigateToFolder,onRename:s,onSave:e.saveItemToDisk,onDelete:e.deleteItem,draggedItem:t,onDragStart:()=>o({id:c.id,tab:i}),onDragEnd:()=>{o(null),a(null)},onMoveItem:d=>e.moveItem(t.id,d),isDragOver:r===c.id,setIsDragOver:d=>a(d?c.id:null),t:l},c.id))}):n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),n.jsx("p",{className:"font-semibold",children:l("library.empty.title")}),n.jsx("p",{className:"text-sm",children:l("catalog.empty.description")})]})})]}),LI=e=>{const{isOpen:t,onClose:o,currentCatalogItems:r,catalogPath:a,onCatalogNavigateBack:i,onCatalogNavigateToFolder:s,onCreateCatalogFolder:l,onAddGroupFromCatalog:c,onRenameCatalogItem:d,onSaveCatalogItem:u,onDeleteCatalogItem:p,onLoadCatalogItemFromFile:h,onMoveCatalogItem:x,libraryItems:k,libraryPath:C,onNavigateBack:w,onNavigateToFolder:f,onCreateLibraryItem:g,onEditLibraryItem:v,onRenameLibraryItem:_,onDeleteLibraryItem:S,onSaveLibraryItem:T,onLoadLibraryItemFromFile:P,onMoveLibraryItem:R,onRenameCharacter:D,onRenameScript:q,onRenameSequence:O}=e,{t:E}=vt(),[A,N]=y.useState("groups"),[j,L]=y.useState(null),[M,V]=y.useState(null);if(!t)return null;const H=()=>{L(null),V(null)},F=()=>n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"p-3 border-b border-gray-700 flex items-center justify-between space-x-2 flex-shrink-0",children:[n.jsxs("div",{className:"flex items-center space-x-1 min-w-0",children:[n.jsx("div",{className:`rounded-full transition-colors ${M==="back-groups"?"ring-2 ring-cyan-500 ring-offset-2 ring-offset-gray-800":""}`,onDragOver:B=>{(j==null?void 0:j.tab)==="groups"&&a.length>1&&(B.preventDefault(),V("back-groups"))},onDragLeave:()=>V(null),onDrop:B=>{if(B.preventDefault(),B.stopPropagation(),V(null),!j||j.tab!=="groups"||a.length<=1)return;const Y=a[a.length-2].id;x(j.id,Y)},children:n.jsx(Bn,{title:E("catalog.back"),onClick:i,disabled:a.length<=1,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})})}),n.jsx("div",{className:"flex items-center text-sm text-gray-400 truncate",children:a.map((B,Y)=>n.jsxs(Et.Fragment,{children:[n.jsx("span",{onClick:()=>s(B.id),className:"px-1 hover:text-white cursor-pointer truncate",children:B.name}),Y<a.length-1&&n.jsx("span",{className:"px-1 select-none",children:"/"})]},B.id||"root"))})]}),n.jsxs("div",{className:"flex space-x-2 flex-shrink-0",children:[n.jsx(Ar,{title:E("catalog.load"),children:n.jsxs("button",{onClick:h,className:"px-3 py-2 text-sm font-semibold bg-teal-600 hover:bg-teal-700 rounded-md flex items-center space-x-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})}),n.jsx("span",{children:E("library.loadFromFile")})]})}),n.jsx(Ar,{title:E("catalog.newFolder"),children:n.jsxs("button",{onClick:l,className:"px-3 py-2 text-sm font-semibold bg-gray-600 hover:bg-gray-500 rounded-md flex items-center space-x-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),n.jsx("span",{children:E("library.actions.newFolder")})]})})]})]}),n.jsx("div",{className:"flex-grow overflow-y-auto p-4",children:r.length>0?n.jsx("div",{className:"grid grid-cols-3 gap-4",children:r.map(B=>n.jsx(AI,{item:B,onAddToCanvas:c,onNavigate:Y=>s(Y),onRename:d,onSave:u,onDelete:p,draggedItem:j,onDragStart:()=>L({id:B.id,tab:"groups"}),onDragEnd:H,onMoveItem:Y=>x(j.id,Y),isDragOver:M===B.id,setIsDragOver:Y=>V(Y?B.id:null)},B.id))}):n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),n.jsx("p",{className:"font-semibold",children:E("library.empty.title")}),n.jsx("p",{className:"text-sm",children:E("catalog.empty.description")})]})})]}),G=()=>n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"p-3 border-b border-gray-700 flex items-center justify-between space-x-2 flex-shrink-0",children:[n.jsxs("div",{className:"flex items-center space-x-1 min-w-0",children:[n.jsx("div",{className:`rounded-full transition-colors ${M==="back-library"?"ring-2 ring-cyan-500 ring-offset-2 ring-offset-gray-800":""}`,onDragOver:B=>{(j==null?void 0:j.tab)==="library"&&C.length>1&&(B.preventDefault(),V("back-library"))},onDragLeave:()=>V(null),onDrop:B=>{if(B.preventDefault(),B.stopPropagation(),V(null),!j||j.tab!=="library"||C.length<=1)return;const Y=C[C.length-2].id;R(j.id,Y)},children:n.jsx(Bn,{title:E("catalog.back"),onClick:w,disabled:C.length<=1,children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})})}),n.jsx("div",{className:"flex items-center text-sm text-gray-400 truncate",children:C.map((B,Y)=>n.jsxs(Et.Fragment,{children:[n.jsx("span",{onClick:()=>f(B.id),className:"px-1 hover:text-white cursor-pointer truncate",children:B.name}),Y<C.length-1&&n.jsx("span",{className:"px-1 select-none",children:"/"})]},B.id||"root"))})]}),n.jsxs("div",{className:"flex space-x-2 flex-shrink-0",children:[n.jsx(Ar,{title:E("catalog.load"),children:n.jsxs("button",{onClick:P,className:"px-3 py-2 text-sm font-semibold bg-teal-600 hover:bg-teal-700 rounded-md flex items-center space-x-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})}),n.jsx("span",{children:E("library.loadFromFile")})]})}),n.jsx(Ar,{title:E("catalog.newFolder"),children:n.jsxs("button",{onClick:()=>g(Vt.FOLDER),className:"px-3 py-2 text-sm font-semibold bg-gray-600 hover:bg-gray-500 rounded-md flex items-center space-x-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),n.jsx("span",{children:E("library.actions.newFolder")})]})}),n.jsx(Ar,{title:E("library.actions.newPrompt"),children:n.jsxs("button",{onClick:()=>g(Vt.PROMPT),className:"px-3 py-2 text-sm font-semibold bg-cyan-600 hover:bg-cyan-700 rounded-md flex items-center space-x-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),n.jsx("span",{children:E("library.actions.newPrompt")})]})})]})]}),n.jsx("div",{className:"flex-grow overflow-y-auto p-4",children:k.length>0?n.jsx("div",{className:"grid grid-cols-3 gap-4",children:k.map(B=>n.jsx(MI,{item:B,onNavigate:f,onEdit:v,onRename:_,onSave:T,onDelete:S,draggedItem:j,onDragStart:()=>L({id:B.id,tab:"library"}),onDragEnd:H,onMoveItem:Y=>R(j.id,Y),isDragOver:M===B.id,setIsDragOver:Y=>V(Y?B.id:null)},B.id))}):n.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),n.jsx("p",{className:"font-semibold",children:E("library.empty.title")}),n.jsx("p",{className:"text-sm",children:E("library.empty.description")})]})})]});return n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",children:n.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-2xl w-full max-w-4xl border border-gray-700 flex flex-col h-[80vh] pointer-events-auto",onMouseDown:B=>B.stopPropagation(),children:[n.jsxs("div",{className:"p-4 pb-0 border-b border-gray-700 flex justify-between items-center flex-shrink-0",children:[n.jsxs("div",{className:"flex items-end space-x-4",children:[n.jsx("button",{onClick:()=>N("groups"),className:`px-4 py-2 text-lg font-bold ${A==="groups"?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-white"}`,children:E("catalog.tabs.groups")}),n.jsx("button",{onClick:()=>N("library"),className:`px-4 py-2 text-lg font-bold ${A==="library"?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-white"}`,children:E("catalog.tabs.library")}),n.jsx("button",{onClick:()=>N("characters"),className:`px-4 py-2 text-lg font-bold ${A==="characters"?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-white"}`,children:E("catalog.tabs.characters")}),n.jsx("button",{onClick:()=>N("scripts"),className:`px-4 py-2 text-lg font-bold ${A==="scripts"?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-white"}`,children:E("catalog.tabs.scripts")}),n.jsx("button",{onClick:()=>N("sequences"),className:`px-4 py-2 text-lg font-bold ${A==="sequences"?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-white"}`,children:E("catalog.tabs.sequences")})]}),n.jsx("button",{onClick:o,className:"p-1 text-gray-400 rounded hover:bg-gray-600 hover:text-white",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),A==="groups"&&F(),A==="library"&&G(),A==="characters"&&n.jsx(Qc,{catalog:e.characterCatalog,dragItemType:"CHARACTER",onRenameItem:D,t:E,draggedItem:j,setDraggedItem:L,dragOverTarget:M,setDragOverTarget:V}),A==="scripts"&&n.jsx(Qc,{catalog:e.scriptCatalog,dragItemType:"SCRIPT",onRenameItem:q,t:E,draggedItem:j,setDraggedItem:L,dragOverTarget:M,setDragOverTarget:V}),A==="sequences"&&n.jsx(Qc,{catalog:e.sequenceCatalog,dragItemType:"PROMPT_SEQUENCE",onRenameItem:O,t:E,draggedItem:j,setDraggedItem:L,dragOverTarget:M,setDragOverTarget:V})]})})},DI=({isOpen:e,onSelectKey:t,onClose:o})=>{const{t:r}=vt(),[a,i]=y.useState(!1);return y.useEffect(()=>{if(e)i(!0);else{const s=setTimeout(()=>i(!1),300);return()=>clearTimeout(s)}},[e]),!e&&!a?null:n.jsx("div",{className:`fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300 ease-in-out ${e?"opacity-100":"opacity-0"}`,onMouseDown:o,children:n.jsxs("div",{className:`bg-gray-800 border border-gray-700 rounded-xl shadow-2xl w-full max-w-md flex flex-col select-none transform transition-all duration-300 ease-in-out ${e?"opacity-100 scale-100":"opacity-0 scale-95"}`,onMouseDown:s=>s.stopPropagation(),children:[n.jsx("div",{className:"px-6 py-4 border-b border-gray-700 bg-[#18202f] rounded-t-xl",children:n.jsx("h2",{className:"text-lg font-bold text-accent-text",children:r("dialog.apiKey.title")})}),n.jsxs("div",{className:"p-6 space-y-4",children:[n.jsx("p",{className:"text-sm text-gray-400 leading-relaxed",children:r("dialog.apiKey.description")}),n.jsx("a",{href:"https://ai.google.dev/gemini-api/docs/billing",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-accent-text hover:text-accent-hover underline",children:r("dialog.apiKey.billingLink")})]}),n.jsxs("div",{className:"px-6 py-4 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-900 rounded-b-xl",children:[n.jsx("button",{onClick:o,className:"px-4 py-2 font-semibold text-gray-400 bg-gray-800 hover:bg-gray-700 hover:text-white rounded-lg transition-colors border border-gray-600",children:r("dialog.rename.cancel")}),n.jsx("button",{onClick:t,className:"px-4 py-2 font-bold text-white bg-accent rounded-lg hover:bg-accent-hover transition-colors shadow-lg shadow-accent/20",children:r("dialog.apiKey.button")})]})]})})},zI=({position:e,onConfirm:t,onCancel:o,count:r=1})=>{const{t:a}=vt(),i=y.useRef(null),[s,l]=y.useState(!1),[c,d]=y.useState(e),u=y.useRef(null),p=y.useRef(!1);y.useEffect(()=>{const C=Math.min(Math.max(0,e.x),window.innerWidth-220),w=Math.min(Math.max(0,e.y),window.innerHeight-150);d({x:C,y:w})},[]),y.useEffect(()=>{const C=f=>{f.code==="Space"||f.code==="Enter"?(f.preventDefault(),f.stopPropagation(),t(s)):f.code==="KeyX"?(f.preventDefault(),f.stopPropagation(),t(!0)):f.code==="Escape"&&(f.preventDefault(),f.stopPropagation(),o())},w=f=>{p.current||i.current&&!i.current.contains(f.target)&&o()};return window.addEventListener("keydown",C,!0),document.addEventListener("mousedown",w),()=>{window.removeEventListener("keydown",C,!0),document.removeEventListener("mousedown",w)}},[t,o,s]);const h=C=>{C.stopPropagation();const w=C.target;w.closest("button")||w.closest(".checkbox-container")||C.button===0&&(p.current=!0,u.current={x:C.clientX-c.x,y:C.clientY-c.y},window.addEventListener("mousemove",x),window.addEventListener("mouseup",k))},x=C=>{!p.current||!u.current||d({x:C.clientX-u.current.x,y:C.clientY-u.current.y})},k=()=>{p.current=!1,u.current=null,window.removeEventListener("mousemove",x),window.removeEventListener("mouseup",k)};return n.jsxs("div",{ref:i,className:"fixed z-[100] bg-gray-800/95 backdrop-blur-md shadow-2xl rounded-xl p-4 flex flex-col items-center justify-center space-y-4 select-none animate-fade-in-up min-w-[220px] cursor-move border border-gray-700/50",style:{left:c.x,top:c.y},onMouseDown:h,children:[n.jsx("span",{className:"text-sm font-semibold text-gray-200 whitespace-nowrap mt-1 pointer-events-none",children:r>1?a("dialog.deleteNode.titlePlural"):a("dialog.deleteNode.title")}),n.jsxs("div",{className:"flex items-center justify-center space-x-3 w-full pb-1",children:[n.jsxs("button",{onClick:C=>{C.stopPropagation(),t(s)},className:"flex flex-row items-center space-x-2 group focus:outline-none px-5 py-2 rounded-lg bg-transparent hover:bg-gray-700 transition-all",title:a("dialog.deleteNode.confirmTooltip"),onMouseDown:C=>C.stopPropagation(),children:[n.jsx("div",{className:"text-cyan-400 group-hover:text-white transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),n.jsx("span",{className:"text-xs text-gray-200 group-hover:text-white transition-colors uppercase font-bold tracking-wider",children:a("dialog.deleteNode.confirm")})]}),n.jsxs("button",{onClick:C=>{C.stopPropagation(),o()},className:"flex flex-row items-center space-x-2 group focus:outline-none px-5 py-2 rounded-lg bg-transparent hover:bg-gray-700 transition-all",title:a("dialog.deleteNode.cancelTooltip"),onMouseDown:C=>C.stopPropagation(),children:[n.jsx("div",{className:"text-gray-400 group-hover:text-white transition-colors",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),n.jsx("span",{className:"text-xs text-gray-400 group-hover:text-white transition-colors uppercase font-bold tracking-wider",children:a("dialog.deleteNode.cancel")})]})]}),n.jsxs("div",{className:"flex items-center space-x-2 pt-2 border-t border-gray-700/50 w-full justify-center cursor-pointer checkbox-container",onClick:C=>{C.stopPropagation(),l(!s)},onMouseDown:C=>C.stopPropagation(),children:[n.jsx("div",{className:`w-4 h-4 rounded flex items-center justify-center transition-all duration-200 border ${s?"bg-cyan-600 border-cyan-600":"bg-gray-700/50 border-gray-600 hover:border-gray-500"}`,children:n.jsx("svg",{className:`w-3 h-3 text-white transition-transform duration-200 ${s?"scale-100":"scale-0"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),n.jsxs("label",{className:"text-xs text-gray-400 select-none cursor-pointer hover:text-gray-300 transition-colors",children:[a("dialog.deleteNode.dontShowAgain")," ",n.jsx("span",{className:"text-gray-500 font-mono ml-1 opacity-50",children:"(X)"})]})]})]})},m0="settingsDialogPosition",qI=({isOpen:e,onClose:t,addToast:o,setIsInstantCloseEnabled:r,anchorPosition:a})=>{const{t:i}=vt(),s=Ut(),[l,c]=y.useState(!1),[d,u]=y.useState({x:0,y:0}),p=y.useRef({x:0,y:0}),h=y.useRef(!1),x=y.useRef(d);if(y.useEffect(()=>{x.current=d},[d]),y.useEffect(()=>{if(e){c(!0);const I=localStorage.getItem(m0);if(I)try{const J=JSON.parse(I);if(typeof J.x=="number"&&typeof J.y=="number"){u(J);return}}catch{}if(a){let U=a.x,Q=a.y+10;U+512>window.innerWidth&&(U=window.innerWidth-512-20),Q+600>window.innerHeight&&(Q=window.innerHeight-600-20),U<20&&(U=20),u({x:U,y:Q})}else u({x:Math.max(0,window.innerWidth/2-256),y:Math.max(0,window.innerHeight/2-300)})}else{const I=setTimeout(()=>c(!1),200);return()=>clearTimeout(I)}},[e]),!s)return null;const{setNodeAnimationMode:k,nodeAnimationMode:C,googleClientId:w,setGoogleClientId:f,handleGoogleSignIn:g,isGoogleDriveReady:v,currentTheme:_,setTheme:S,setConfirmInfo:T,loadCanvasState:P,resetTabs:R,setIsHoverHighlightEnabled:D,isHoverHighlightEnabled:q,isConnectionAnimationEnabled:O,setIsConnectionAnimationEnabled:E,connectionOpacity:A,setConnectionOpacity:N}=s,[j,L]=y.useState(""),[M,V]=y.useState(""),[H,F]=y.useState(!0),[G,B]=y.useState(!1),[Y,ee]=y.useState(!0),[ie,ce]=y.useState("pulse");y.useEffect(()=>{if(e){const I=localStorage.getItem("settings_userApiKey")||"",J=localStorage.getItem("settings_useDevKey"),W=localStorage.getItem("settings_instantNodeClose"),U=localStorage.getItem("settings_nodeAnimationMode"),Q=localStorage.getItem("settings_hoverHighlight"),de=localStorage.getItem("settings_nodeAnimation");L(I),V(w||""),F(J===null?!0:J==="true"),B(W==="true"),ee(Q===null?!0:Q==="true"),ce(U||(de==="false"?"none":C||"pulse"))}},[e,C,w]);const pe=()=>{localStorage.setItem("settings_userApiKey",j),localStorage.setItem("settings_useDevKey",String(H)),localStorage.setItem("settings_instantNodeClose",String(G)),localStorage.setItem("settings_nodeAnimationMode",ie),localStorage.setItem("settings_hoverHighlight",String(Y)),f&&f(M.trim()),r(G),k&&k(ie),D&&D(Y),o(i("toast.apiKeySaved"),"success"),t()},ue=()=>{T({title:i("dialog.reload.title"),message:i("dialog.reload.message"),onConfirm:()=>{P({nodes:[],connections:[],groups:[],viewTransform:{scale:1,translate:{x:0,y:0}},nodeIdCounter:1,fullSizeImageCache:{}}),R&&R("en"),setTimeout(()=>{window.location.reload()},100)}})},re=I=>{const J=I.target;J.closest("button")||J.closest("input")||(I.preventDefault(),I.stopPropagation(),h.current=!0,p.current={x:I.clientX-d.x,y:I.clientY-d.y},I.currentTarget.setPointerCapture(I.pointerId))},$=I=>{h.current&&(I.preventDefault(),I.stopPropagation(),u({x:I.clientX-p.current.x,y:I.clientY-p.current.y}))},Z=I=>{h.current=!1,I.currentTarget.releasePointerCapture(I.pointerId),localStorage.setItem(m0,JSON.stringify(x.current))};if(!e&&!l)return null;const te=[{id:"cyan",color:"#06b6d4",label:"Cyan"},{id:"azure",color:"#0ea5e9",label:"Azure"},{id:"purple",color:"#9333ea",label:"Purple"},{id:"pink",color:"#ec4899",label:"Pink"},{id:"red",color:"#dc2626",label:"Red"},{id:"orange",color:"#f97316",label:"Orange"},{id:"lime",color:"#84cc16",label:"Lime"},{id:"emerald",color:"#10b981",label:"Emerald"},{id:"gray",color:"#71717a",label:"Gray"}],ae={pulse:"pulse","blade-runner":"bladeRunner",none:"none"};return n.jsx("div",{className:`fixed inset-0 z-[100] pointer-events-none transition-opacity duration-200 ease-out ${l&&e?"opacity-100":"opacity-0"}`,children:n.jsxs("div",{className:"absolute bg-gray-800 rounded-xl shadow-2xl w-full max-w-lg flex flex-col cursor-default max-h-[90vh] overflow-hidden pointer-events-auto border border-gray-700 transition-transform duration-200 ease-out",style:{left:d.x,top:d.y,transform:l&&e?"scale(1)":"scale(0.95)"},onMouseDown:I=>I.stopPropagation(),children:[n.jsxs("div",{className:"px-6 py-4 flex justify-between items-center bg-[#18202f] cursor-move border-b border-gray-600",onPointerDown:re,onPointerMove:$,onPointerUp:Z,children:[n.jsxs("h2",{className:"text-xl font-bold text-accent-text flex items-center gap-2 pointer-events-none",children:[n.jsx(O1,{}),i("dialog.settings.title")]}),n.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors p-1 hover:bg-white/10 rounded-full",onPointerDown:I=>I.stopPropagation(),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),n.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto custom-scrollbar bg-gray-800",children:[n.jsx("p",{className:"text-sm text-gray-400 mb-2",children:i("dialog.settings.description")}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest border-b border-gray-700 pb-1 mb-2",children:i("settings.group.api")}),n.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg space-y-3",children:[n.jsxs("div",{className:`space-y-2 transition-opacity duration-200 ${H?"opacity-80 pointer-events-none":"opacity-100"}`,children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("label",{htmlFor:"apiKey",className:"block text-xs font-medium text-gray-400",children:i("dialog.settings.apiKeyLabel")}),n.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-xs text-cyan-400 hover:text-cyan-300 underline",children:i("dialog.settings.getKeyLink")})]}),n.jsx("input",{type:"password",id:"apiKey",value:j,onChange:I=>L(I.target.value),placeholder:H?"Locked by free key":"AIzaSy...",className:`w-full p-2.5 rounded-md text-sm border focus:ring-1 focus:ring-accent focus:border-accent focus:outline-none placeholder-gray-600 transition-colors
                        ${H?"bg-gray-800 border-gray-700 text-gray-500":"bg-gray-900 border-gray-600 text-white"}
                      `,disabled:H})]}),n.jsx("div",{className:"pt-1",children:n.jsx(Zt,{id:"useDevKey",checked:H,onChange:I=>F(I),label:i("dialog.settings.useDevKeyLabel"),className:"text-sm text-gray-400"})})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest border-b border-gray-700 pb-1 mb-2",children:i("settings.group.style")}),n.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400",children:i("settings.themeLabel")}),n.jsx("div",{className:"flex flex-wrap gap-3",children:te.map(I=>n.jsx("button",{onClick:()=>S(I.id),className:`w-8 h-8 rounded-full border-2 transition-all flex items-center justify-center ${_===I.id?"border-white scale-110 shadow-md":"border-transparent hover:scale-105"}`,style:{backgroundColor:I.color},title:I.label,children:_===I.id&&n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white drop-shadow-md",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})},I.id))})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400",children:i("dialog.settings.animationModeLabel")}),n.jsx("div",{className:"flex bg-gray-800 rounded-md p-1 border border-gray-700",children:["pulse","blade-runner","none"].map(I=>n.jsx("button",{onClick:()=>ce(I),className:`flex-1 py-1.5 text-xs font-medium rounded transition-colors ${ie===I?"bg-gray-700 text-white shadow-sm":"text-gray-500 hover:text-gray-300"}`,children:i(`dialog.settings.anim.${ae[I]||I}`)},I))})]}),n.jsxs("div",{className:"pt-1 flex flex-col gap-2",children:[n.jsx(Zt,{id:"instantNodeClose",checked:G,onChange:I=>B(I),label:i("dialog.settings.instantNodeCloseLabel"),className:"text-sm text-gray-400"}),n.jsx(Zt,{id:"hoverHighlight",checked:Y,onChange:I=>ee(I),label:i("dialog.settings.hoverHighlightLabel"),className:"text-sm text-gray-400"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-400",children:i("dialog.settings.connectionsLabel")}),n.jsxs("div",{className:"flex flex-col gap-2 p-2 bg-gray-800 rounded-md border border-gray-700",children:[n.jsx(Zt,{id:"connectionAnimation",checked:O,onChange:I=>E(I),label:i("dialog.settings.connectionAnimationLabel"),className:"text-sm text-gray-300"}),n.jsxs("div",{className:"space-y-1 pt-1",children:[n.jsxs("div",{className:"flex justify-between text-xs text-gray-400",children:[n.jsx("span",{children:i("dialog.settings.connectionOpacityLabel")}),n.jsxs("span",{children:[Math.round(A*100),"%"]})]}),n.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:A,onChange:I=>N(parseFloat(I.target.value)),className:"w-full h-1.5 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-accent"})]})]})]})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("div",{className:"flex justify-between items-end border-b border-gray-700 pb-1 mb-2",children:n.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest",children:i("settings.group.drive")})}),n.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{htmlFor:"googleClientId",className:"block text-xs font-medium text-gray-400",children:i("settings.googleClientIdLabel")}),n.jsx("input",{type:"text",id:"googleClientId",value:M,onChange:I=>V(I.target.value),placeholder:"Google Cloud Client ID",className:"w-full p-2.5 bg-gray-800 border border-gray-700 rounded-md text-white text-sm focus:ring-1 focus:ring-accent focus:border-accent focus:outline-none placeholder-gray-600"})]}),n.jsxs("button",{onClick:()=>g&&g(),disabled:!v,className:`w-full py-2 px-4 rounded-md text-sm font-bold text-white transition-all flex items-center justify-center gap-2 ${v?"bg-blue-600 hover:bg-blue-700 shadow-md shadow-blue-900/20":"bg-gray-700 text-gray-500 cursor-not-allowed"}`,title:v?"":"Enter Client ID and Save first",children:[n.jsx($3,{className:"w-4 h-4"}),i("settings.signInWithGoogle")]})]})]})]}),n.jsxs("div",{className:"p-4 bg-gray-900 border-t border-gray-700 flex justify-between items-center",children:[n.jsxs("button",{onClick:ue,className:"flex items-center gap-2 px-4 py-2 text-red-400 hover:text-red-300 hover:bg-red-900/30 rounded-lg transition-colors border border-transparent hover:border-red-900/50",title:i("dialog.settings.reload"),children:[n.jsx(F1,{}),n.jsx("span",{className:"text-sm font-bold",children:i("dialog.settings.reload")})]}),n.jsx("button",{onClick:pe,className:"px-6 py-2 bg-accent hover:bg-accent-hover text-white font-bold rounded-lg transition-all shadow-lg shadow-accent/40 transform hover:-translate-y-0.5 active:translate-y-0",children:i("dialog.settings.save")})]})]})})},OI=({isOpen:e,message:t,onClose:o})=>{const{t:r}=vt(),[a,i]=y.useState(!1),[s,l]=y.useState(!1);if(y.useEffect(()=>{if(e)l(!0),i(!1);else{const d=setTimeout(()=>l(!1),300);return()=>clearTimeout(d)}},[e]),y.useEffect(()=>{const d=u=>{u.key==="Escape"&&o()};return e&&window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[e,o]),!e&&!s)return null;const c=()=>{t&&(navigator.clipboard.writeText(t),i(!0),setTimeout(()=>i(!1),2e3))};return n.jsx("div",{className:`fixed top-20 left-1/2 -translate-x-1/2 z-[200] w-full max-w-lg px-4 pointer-events-none transition-all duration-300 ease-out transform ${e?"opacity-100 translate-y-0":"opacity-0 -translate-y-4"}`,children:n.jsxs("div",{className:"bg-[#20293c] bg-opacity-95 backdrop-blur-xl rounded-xl shadow-2xl flex flex-col pointer-events-auto overflow-hidden border border-gray-600/50",role:"alert",children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-black/20 border-b border-white/5 select-none",children:[n.jsxs("div",{className:"flex items-center space-x-2.5",children:[n.jsx("div",{className:"p-1.5 bg-accent/20 rounded-full text-accent-text",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n.jsx("h2",{className:"text-sm font-bold text-accent-text tracking-wide",children:r("app.error.title")})]}),n.jsx("button",{onClick:o,className:"text-text-secondary hover:text-white transition-colors p-1 hover:bg-white/10 rounded-lg",title:"Close",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),n.jsx("div",{className:"p-5 max-h-[300px] overflow-y-auto custom-scrollbar",children:n.jsx("p",{className:"text-gray-300 text-sm whitespace-pre-wrap break-words leading-relaxed font-medium select-none",children:t})}),n.jsx("div",{className:"px-4 py-3 bg-black/20 border-t border-white/5 flex justify-end",children:n.jsx("button",{onClick:c,className:`px-4 py-2 text-xs font-bold rounded-lg transition-all duration-200 flex items-center gap-2 ${a?"bg-green-600/20 text-green-300":"bg-gray-700 hover:bg-gray-600 text-gray-300 hover:text-white"}`,children:a?n.jsxs(n.Fragment,{children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),r("app.error.copied")]}):n.jsxs(n.Fragment,{children:[n.jsx(Dt,{className:"h-3.5 w-3.5"}),r("app.error.copy")]})})})]})})},FI=()=>{const e=Ut(),[t,o]=y.useState(!1),r=y.useRef(null);if(!e)return null;const{logs:a,isDebugConsoleOpen:i,setIsDebugConsoleOpen:s,clearLogs:l}=e;if(y.useEffect(()=>{i&&r.current&&(r.current.scrollTop=r.current.scrollHeight)},[a,i]),!i)return null;const c=d=>{const u=`[${new Date(d.timestamp).toLocaleTimeString()}] ${d.level.toUpperCase()}: ${d.message}
${d.details?JSON.stringify(d.details,null,2):""}`;navigator.clipboard.writeText(u)};return n.jsxs("div",{className:"fixed bottom-[60px] left-1/2 -translate-x-1/2 bg-gray-900 border border-gray-700 shadow-2xl rounded-t-lg flex flex-col z-[300] transition-all duration-300 w-full max-w-4xl",style:{height:t?"80vh":"300px"},children:[n.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-800 rounded-t-lg border-b border-gray-700 select-none cursor-pointer",onClick:()=>o(!t),children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"text-xs font-bold text-gray-300 uppercase tracking-widest flex items-center gap-2",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-accent-text",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"System Logs"]}),n.jsxs("span",{className:"text-[10px] bg-gray-700 px-1.5 rounded text-gray-400",children:[a.length," events"]})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{onClick:d=>{d.stopPropagation(),l()},className:"p-1 hover:bg-gray-700 rounded text-gray-400 hover:text-white",title:"Clear",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),n.jsx("button",{onClick:d=>{d.stopPropagation(),o(!t)},className:"p-1 hover:bg-gray-700 rounded text-gray-400 hover:text-white",title:t?"Collapse":"Expand",children:t?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),n.jsx("button",{onClick:d=>{d.stopPropagation(),s(!1)},className:"p-1 hover:bg-gray-700 rounded text-gray-400 hover:text-white",title:"Close",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),n.jsxs("div",{ref:r,className:"flex-grow overflow-y-auto p-2 font-mono text-xs bg-[#0d1117] custom-scrollbar space-y-1",children:[a.length===0&&n.jsx("div",{className:"text-gray-600 italic p-2 text-center",children:"No logs recorded."}),a.map(d=>n.jsxs("div",{className:`p-2 rounded border-l-2 ${d.level==="error"?"border-red-500 bg-red-900/10":d.level==="warning"?"border-yellow-500 bg-yellow-900/10":"border-blue-500 bg-blue-900/10"} hover:bg-gray-800/50 transition-colors group relative`,children:[n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsx("span",{className:"text-gray-500 shrink-0 mr-2",children:new Date(d.timestamp).toLocaleTimeString()}),n.jsxs("span",{className:`font-bold shrink-0 mr-2 ${d.level==="error"?"text-red-400":d.level==="warning"?"text-yellow-400":"text-blue-400"}`,children:["[",d.level.toUpperCase(),"]"]}),n.jsx("span",{className:"flex-grow text-gray-300 break-words whitespace-pre-wrap",children:d.message}),n.jsx("button",{onClick:()=>c(d),className:"opacity-0 group-hover:opacity-100 text-gray-500 hover:text-white transition-opacity ml-2",children:n.jsx(Dt,{className:"h-3 w-3"})})]}),d.details&&n.jsx("div",{className:"mt-1 ml-16 text-gray-400 bg-black/30 p-2 rounded overflow-x-auto",children:n.jsx("pre",{children:JSON.stringify(d.details,null,2)})})]},d.id))]})]})},BI=()=>{const e=Ut(),[t,o]=Et.useState(!1),[r,a]=Et.useState(null);if(Et.useEffect(()=>{const pt=dt=>{dt.detail&&a(dt.detail),o(!0)};return window.addEventListener("open-settings",pt),()=>window.removeEventListener("open-settings",pt)},[]),y.useEffect(()=>{(()=>{if(!localStorage.getItem("hasVisited"))return;const kt=localStorage.getItem("settings_useDevKey")==="true",St=localStorage.getItem("settings_userApiKey");!kt&&!St&&o(!0)})()},[]),!e)return null;const{isQuickSearchOpen:i,quickSearchPosition:s,handleCloseAddNodeMenus:l,onAddNode:c,getTransformedPoint:d,isQuickAddOpen:u,isQuickAddMenuPinned:p,quickAddPosition:h,effectiveTool:x,setActiveTool:k,toggleQuickAddMenuPin:C,isRadialMenuOpen:w,radialMenuPosition:f,setIsRadialMenuOpen:g,radialMenuSelectedItem:v,setRadialMenuSelectedItem:_,contextMenu:S,handleCloseContextMenu:T,quickSlots:P,updateQuickSlot:R,setAllQuickSlots:D,isContextMenuPinned:q,toggleContextMenuPin:O,viewTransform:E,handleZoomChange:A,scaleToSliderValue:N,sliderValueToScale:j,nodeContextMenu:L,handleCloseNodeContextMenu:M,handleAlignNodes:V,selectedNodeIds:H,isConnectionQuickAddOpen:F,connectionQuickAddInfo:G,handleCloseConnectionQuickAdd:B,handleAddNodeAndConnect:Y,nodeDeleteConfirm:ee,deleteNodeAndConnections:ie,setIsInstantCloseEnabled:ce,cancelDeleteNodes:pe,renameInfo:ue,confirmRename:re,setRenameInfo:$,deselectAllNodes:Z,t:te,showDialog:ae,requestPermission:I,declinePermission:J,confirmInfo:W,setConfirmInfo:U,promptEditInfo:Q,confirmPromptEdit:de,setPromptEditInfo:se,isCatalogOpen:X,handleCloseCatalog:K,currentCatalogItems:oe,catalogPath:ne,navigateCatalogBack:le,navigateCatalogToFolder:ge,createCatalogItem:we,handleAddGroupFromCatalog:_e,renameCatalogItem:fe,saveCatalogItemToDisk:he,deleteCatalogItem:ye,triggerLoadFromFile:Se,moveCatalogItem:Te,libraryItems:Ae,currentLibraryItems:Oe,libraryPath:me,navigateBack:ve,navigateToFolder:Ie,createLibraryItem:ke,setPromptEditInfo:je,updateLibraryItem:Ge,deleteLibraryItem:be,saveLibraryItemToDisk:Pe,triggerLoadLibraryFromFile:Ee,moveLibraryItem:Me,characterCatalog:Fe,scriptCatalog:tt,sequenceCatalog:Nt,onRenameCharacter:xe,onRenameScript:Be,onRenameSequence:Le,isApiKeyDialogOpen:Ue,handleApiKeySelect:Ze,handleApiKeyDialogClose:at,addToast:ot,handlePaste:rt,error:et,setError:mt}=e,xt=pt=>{let dt=h;i&&(dt=s);const kt=d(dt);c(pt,kt),l()},Ct=pt=>{const dt=d(f);c(pt,dt),g(!1),_(null)};return n.jsxs(n.Fragment,{children:[n.jsx(yI,{isOpen:i,position:s,onClose:l,onAddNode:pt=>{const dt=d(s);c(pt,dt),l()}}),n.jsx(wI,{isOpen:u||p,position:h,onClose:l,onAddNode:xt,onToolChange:k,activeTool:x,isPinned:p,onPinToggle:C,onPaste:rt}),n.jsx(kI,{isOpen:w,position:f,onClose:()=>g(!1),onAddNode:Ct,onSelectItem:_}),n.jsx(SI,{isOpen:!!(S!=null&&S.isOpen),position:(S==null?void 0:S.position)||{x:0,y:0},onClose:T,onToolSelect:k,slots:P,onSlotUpdate:R,onSetSlots:D,onAddNode:pt=>{const dt=d((S==null?void 0:S.position)||{x:0,y:0});c(pt,dt)},isPinned:q,onPinToggle:O,zoom:E.scale,onZoomChange:A,scaleToSliderValue:N,sliderValueToScale:j,onPaste:rt}),n.jsx(NI,{isOpen:!!(L!=null&&L.isOpen),position:(L==null?void 0:L.position)||{x:0,y:0},onClose:M,onAlign:pt=>V(H,pt)}),n.jsx(EI,{isOpen:F,info:G,onClose:B,onSelect:Y}),ee&&n.jsx(zI,{position:ee.position,onConfirm:pt=>{ee.nodeIds.forEach(dt=>ie(dt)),pt&&(localStorage.setItem("settings_instantNodeClose","true"),ce(!0)),pe()},onCancel:pe,count:ee.nodeIds.length}),n.jsx(PI,{isOpen:!!ue,initialValue:(ue==null?void 0:ue.currentTitle)||"",onConfirm:re,onClose:()=>$(null),title:(ue==null?void 0:ue.type)==="group"?te("dialog.rename.group.title"):(ue==null?void 0:ue.type)==="catalog"?te("dialog.rename.catalog.title"):(ue==null?void 0:ue.type)==="node"?te("dialog.rename.node.title"):te("dialog.rename.title"),deselectAllNodes:Z}),n.jsx(TI,{isOpen:ae,onAllow:I,onDecline:J}),n.jsx(II,{isOpen:!!W,title:(W==null?void 0:W.title)||"",message:(W==null?void 0:W.message)||"",onConfirm:(W==null?void 0:W.onConfirm)||(()=>{}),onClose:()=>U(null)}),n.jsx(OI,{isOpen:!!et,message:et,onClose:()=>mt(null)}),n.jsx(FI,{}),n.jsx(jI,{isOpen:!!Q,initialName:(Q==null?void 0:Q.name)||"",initialContent:(Q==null?void 0:Q.content)||"",onConfirm:de,onClose:()=>se(null),deselectAllNodes:Z}),n.jsx(LI,{isOpen:X,onClose:K,currentCatalogItems:oe,catalogPath:ne,onCatalogNavigateBack:le,onCatalogNavigateToFolder:ge,onCreateCatalogFolder:()=>we(gl.FOLDER),onAddGroupFromCatalog:pt=>_e(pt),onRenameCatalogItem:(pt,dt)=>$({type:"catalog",id:pt,currentTitle:dt}),onSaveCatalogItem:he,onDeleteCatalogItem:ye,onLoadCatalogItemFromFile:Se,onMoveCatalogItem:Te,libraryItems:Oe,libraryPath:me,onNavigateBack:ve,onNavigateToFolder:Ie,onCreateLibraryItem:ke,onEditLibraryItem:se,onRenameLibraryItem:(pt,dt)=>$({type:"library",id:pt,currentTitle:dt}),onDeleteLibraryItem:be,onSaveLibraryItem:Pe,onLoadLibraryItemFromFile:Ee,onMoveLibraryItem:Me,characterCatalog:Fe,scriptCatalog:tt,sequenceCatalog:Nt,onRenameCharacter:(pt,dt)=>$({type:"character",id:pt,currentTitle:dt}),onRenameScript:(pt,dt)=>$({type:"script",id:pt,currentTitle:dt}),onRenameSequence:(pt,dt)=>$({type:"sequence",id:pt,currentTitle:dt})}),n.jsx(DI,{isOpen:Ue,onSelectKey:Ze,onClose:at}),n.jsx(qI,{isOpen:t,onClose:()=>o(!1),addToast:ot,setIsInstantCloseEnabled:ce,anchorPosition:r})]})},GI=()=>{const[e,t]=y.useState(0),o=y.useRef(0),r=y.useRef(performance.now()),a=y.useRef(0);return y.useEffect(()=>{const i=()=>{const s=performance.now();o.current++,s>=r.current+1e3&&(t(o.current),o.current=0,r.current=s),a.current=requestAnimationFrame(i)};return a.current=requestAnimationFrame(i),()=>{cancelAnimationFrame(a.current)}},[]),e},HI=e=>{const t=Math.floor(e/1e3),o=Math.floor(e%1e3/10);return`${t}.${o.toString().padStart(2,"0")}s`},UI=()=>{const e=Ut(),t=GI(),[o,r]=y.useState(!1),{language:a}=vt(),[i,s]=y.useState(0),[l,c]=y.useState(0),d=y.useRef(null),u=y.useRef(null),[p,h]=y.useState(null),[x,k]=y.useState(!1),C=y.useRef(!1);if(!e)return null;const{activeOperations:w,t:f,tutorialStep:g,skipTutorial:v,advanceTutorial:_,nextAutoSaveTime:S,isAutoSaving:T,logs:P,isDebugConsoleOpen:R,setIsDebugConsoleOpen:D}=e,q=Array.from(w.values()),O=q.length>0?q[q.length-1]:null,E=q.length>0,A=P.filter(L=>L.level==="error").length,N=g==="image_output_generating";y.useEffect(()=>{if(E){d.current===null&&(d.current=performance.now(),s(0));const L=()=>{d.current!==null&&(s(performance.now()-d.current),u.current=requestAnimationFrame(L))};u.current=requestAnimationFrame(L)}else{if(d.current!==null){const L=performance.now()-d.current;c(L),s(0),d.current=null}u.current&&(cancelAnimationFrame(u.current),u.current=null)}return()=>{u.current&&cancelAnimationFrame(u.current)}},[E]),y.useEffect(()=>{if(!S){h(null);return}const L=setInterval(()=>{const M=Date.now(),V=S-M;V>0&&V<=1e4?h(Math.ceil(V/1e3)):h(null)},200);return()=>clearInterval(L)},[S]),y.useEffect(()=>{if(C.current&&!T){k(!0);const L=setTimeout(()=>k(!1),2e3);return()=>clearTimeout(L)}C.current=T},[T]);const j=E?i:l;return n.jsx("div",{className:"fixed top-2 right-2 z-50 flex flex-col items-end pointer-events-none select-none",children:n.jsx(qn,{content:f("tutorial.step3b"),isActive:!!N,position:"bottom",onSkip:v,onNext:_,children:n.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-md rounded-lg shadow-lg border border-gray-700 p-1 flex items-center space-x-2 pointer-events-auto transition-all duration-300",children:[!o&&n.jsxs(n.Fragment,{children:[n.jsx(ct,{content:"Debug Console",position:"bottom",children:n.jsxs("button",{onClick:()=>D(!R),className:`p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center relative ${R?"text-accent-text bg-gray-800":"text-gray-400 hover:text-white hover:bg-gray-800"}`,children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),A>0&&!R&&n.jsxs("span",{className:"absolute top-1 right-1 flex h-2 w-2",children:[n.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),n.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-red-500"})]})]})}),n.jsx("div",{className:"w-px h-8 bg-gray-700 mx-1"}),n.jsx("div",{className:"flex items-center space-x-3 px-2 min-w-[140px]",children:O?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"relative flex h-3 w-3 flex-shrink-0",children:[n.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-accent opacity-75"}),n.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-accent"})]}),n.jsxs("div",{className:"flex flex-col leading-tight min-w-0",children:[n.jsx("span",{className:"text-[10px] font-bold text-accent-text uppercase tracking-wider truncate",children:"Processing"}),n.jsx("span",{className:"text-xs text-gray-300 whitespace-nowrap truncate max-w-[150px]",title:O.description,children:O.description})]})]}):T?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"relative flex h-3.5 w-3.5 flex-shrink-0 text-accent-text animate-pulse",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-full h-full",children:n.jsx("path",{fillRule:"evenodd",d:"M19.5 21a3 3 0 003-3V9a3 3 0 00-3-3h-5.379a.75.75 0 01-.53-.22L11.47 3.66A2.25 2.25 0 009.879 3H4.5a3 3 0 00-3 3v12a3 3 0 003 3h15zm-6.75-10.5a.75.75 0 00-1.5 0v4.19l-1.72-1.72a.75.75 0 00-1.06 1.06l3 3a.75.75 0 001.06 0l3-3a.75.75 0 10-1.06-1.06l-1.72 1.72V10.5z",clipRule:"evenodd"})})}),n.jsxs("div",{className:"flex flex-col leading-tight",children:[n.jsx("span",{className:"text-[10px] font-bold text-accent-text uppercase tracking-wider",children:"System"}),n.jsx("span",{className:"text-xs text-accent-text",children:"Saving..."})]})]}):x?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"relative flex h-3.5 w-3.5 flex-shrink-0 text-accent-text",children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-full h-full",children:[n.jsx("path",{d:"M11.47 3.84a.75.75 0 011.06 0l8.635 8.635a.75.75 0 11-1.06 1.06l-8.635-8.635a.75.75 0 010-1.06z"}),n.jsx("path",{d:"M19.5 21a3 3 0 003-3V9a3 3 0 00-3-3h-5.379a.75.75 0 01-.53-.22L11.47 3.66A2.25 2.25 0 009.879 3H4.5a3 3 0 00-3 3v12a3 3 0 003 3h15z",opacity:"0.5"}),n.jsx("path",{fillRule:"evenodd",d:"M19.916 4.626a.75.75 0 01.208 1.04l-9 13.5a.75.75 0 01-1.154.114l-6-6a.75.75 0 011.06-1.06l5.353 5.353 8.493-12.739a.75.75 0 011.04-.208z",clipRule:"evenodd"})]})}),n.jsxs("div",{className:"flex flex-col leading-tight",children:[n.jsx("span",{className:"text-[10px] font-bold text-accent-text uppercase tracking-wider",children:"System"}),n.jsx("span",{className:"text-xs text-white",children:"Saved"})]})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"h-2.5 w-2.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)] flex-shrink-0"}),n.jsxs("div",{className:"flex flex-col leading-tight",children:[n.jsx("span",{className:"text-[10px] font-bold text-emerald-400 uppercase tracking-wider",children:"System"}),n.jsx("span",{className:"text-xs text-gray-300",children:p!==null?`Saving in ${p}s...`:"Ready"})]})]})}),n.jsx("div",{className:"w-px h-8 bg-gray-700 mx-1"}),n.jsxs("div",{className:"flex flex-col items-center justify-center px-2 min-w-[60px]",children:[n.jsx("span",{className:`text-lg font-bold font-mono leading-none ${E?"text-accent-text":"text-gray-400"}`,children:HI(j)}),n.jsx("span",{className:"text-[10px] font-medium text-gray-500 uppercase tracking-wider leading-none mt-0.5",children:"Time"})]}),n.jsx("div",{className:"w-px h-8 bg-gray-700 mx-1"}),n.jsxs("div",{className:"flex flex-col items-center justify-center px-2 min-w-[50px]",children:[n.jsx("span",{className:"text-lg font-bold text-accent-text font-mono leading-none",children:t}),n.jsx("span",{className:"text-[10px] font-medium text-gray-500 uppercase tracking-wider leading-none mt-0.5",children:"FPS"})]})]}),n.jsx(ct,{content:f(o?"toolbar.expandPanel":"toolbar.collapsePanel"),position:"bottom",children:n.jsx("button",{onClick:()=>r(!o),className:"p-2 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-accent hover:text-white text-gray-300 ml-1","aria-label":o?"Expand Panel":"Collapse Panel",children:o?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})})]})})})},VI=(e,t=2)=>{if(e===0)return"0 Bytes";const o=1024,r=t<0?0:t,a=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(o));return parseFloat((e/Math.pow(o,i)).toFixed(r))+" "+a[i]},ed="imageViewerPosition",td="imageViewerSize",WI=({sources:e,initialIndex:t,initialPosition:o,onClose:r,onDownloadImageFromUrl:a,onCopyImageToClipboard:i,onOpenInEditor:s,addToast:l})=>{const{t:c}=vt(),[d,u]=y.useState(_l()),[p,h]=y.useState(!1),[x,k]=y.useState(()=>{try{const J=localStorage.getItem(ed);if(J){const W=JSON.parse(J);if(typeof W.x=="number"&&typeof W.y=="number")return W}}catch(J){console.error("Failed to load ImageViewer position",J)}return o}),[C,w]=y.useState(()=>{try{const J=localStorage.getItem(td);if(J){const W=JSON.parse(J);if(W.width&&W.height)return W}}catch(J){console.error("Failed to load ImageViewer size",J)}return{width:"80vw",height:"80vh"}}),[f,g]=y.useState(!1),v=y.useRef(x);y.useEffect(()=>{v.current=x},[x]);const[_,S]=y.useState(t),T=y.useRef(null),P=y.useRef(null),R=y.useRef(null),[D,q]=y.useState(1),[O,E]=y.useState({x:0,y:0}),[A,N]=y.useState(!1),j=y.useRef(null),[L,M]=y.useState({width:0,height:0,size:null}),V=e[_],H=J=>{if(J.startsWith("data:")){const W=J.length-(J.indexOf(",")+1),U=J.charAt(J.length-1)==="="?J.charAt(J.length-2)==="="?2:1:0,Q=W*.75-U;return VI(Q)}return null};y.useEffect(()=>{requestAnimationFrame(()=>g(!0)),F()},[]),y.useEffect(()=>{if(!V)return;const J=new Image;J.onload=()=>{M({width:J.naturalWidth,height:J.naturalHeight,size:H(V.src)});const W=localStorage.getItem(ed),U=localStorage.getItem(td);if(!W||!U){const se=window.innerWidth,X=window.innerHeight,K=se*.95,oe=X*.95;let ne=J.naturalWidth+20,le=J.naturalHeight+100;if(ne>K||le>oe){const ge=Math.min((K-20)/J.naturalWidth,(oe-100)/J.naturalHeight);ne=J.naturalWidth*ge+20,le=J.naturalHeight*ge+100}ne=Math.max(ne,800),le=Math.max(le,456),w({width:ne,height:le}),k({x:(se-ne)/2,y:(X-le)/2})}if(P.current){const{width:Q,height:de}=P.current.getBoundingClientRect(),se=Q-20,X=de-20;if(se>0&&X>0){const K=se/J.naturalWidth,oe=X/J.naturalHeight,ne=Math.min(K,oe);q(Math.min(ne,1))}else q(1)}else q(1);E({x:0,y:0})},J.src=V.src},[V]);const F=()=>{u(_l())},G=J=>{J.stopPropagation(),h(!p)},B=J=>{J==null||J.stopPropagation(),S(W=>W>0?W-1:e.length-1)},Y=J=>{J==null||J.stopPropagation(),S(W=>W<e.length-1?W+1:0)},ee=()=>{q(1),E({x:0,y:0})};y.useEffect(()=>{const J=W=>{W.stopPropagation(),W.key==="ArrowLeft"?B():W.key==="ArrowRight"?Y():W.key==="Escape"&&r()};return window.addEventListener("keydown",J,!0),()=>{window.removeEventListener("keydown",J,!0)}},[r,e.length]);const ie=J=>{J.target.closest("button")||(F(),J.preventDefault(),J.stopPropagation(),!p&&(J.currentTarget.setPointerCapture(J.pointerId),T.current={offset:{x:J.clientX-x.x,y:J.clientY-x.y}}))},ce=J=>{if(!T.current)return;const W=J.clientX-T.current.offset.x,U=J.clientY-T.current.offset.y;k({x:W,y:U})},pe=J=>{T.current=null,J.currentTarget.releasePointerCapture(J.pointerId),localStorage.setItem(ed,JSON.stringify(v.current))},ue=()=>{if(R.current&&!p){const J=R.current.getBoundingClientRect(),W={width:J.width,height:J.height};w(W),localStorage.setItem(td,JSON.stringify(W))}},re=J=>{if(J.stopPropagation(),!P.current)return;const W=Math.pow(1.0005,-J.deltaY),U=Math.max(.1,Math.min(10,D*W)),Q=P.current.getBoundingClientRect(),de=J.clientX-Q.left,se=J.clientY-Q.top,X=de-Q.width/2,K=se-Q.height/2,oe=U/D,ne=X-(X-O.x)*oe,le=K-(K-O.y)*oe;q(U),E({x:ne,y:le})},$=()=>{if(!P.current||L.width===0)return!1;const{width:J,height:W}=P.current.getBoundingClientRect(),U=L.width*D,Q=L.height*D;return U>J||Q>W},Z=D>1||$(),te=J=>{F(),(Z||J.button===1)&&(J.preventDefault(),J.stopPropagation(),N(!0),j.current={x:J.clientX-O.x,y:J.clientY-O.y},window.addEventListener("mousemove",ae),window.addEventListener("mouseup",I))},ae=J=>{j.current&&(J.preventDefault(),J.stopPropagation(),E({x:J.clientX-j.current.x,y:J.clientY-j.current.y}))},I=()=>{N(!1),j.current=null,window.removeEventListener("mousemove",ae),window.removeEventListener("mouseup",I)};return y.useEffect(()=>()=>{window.removeEventListener("mousemove",ae),window.removeEventListener("mouseup",I)},[]),V?n.jsxs("div",{ref:R,className:`fixed bg-gray-800 rounded-lg shadow-2xl border-2 border-gray-700 flex flex-col z-[${d}] group transition-opacity duration-300 ease-out ${f?"opacity-100":"opacity-0"}`,style:p?{left:0,top:0,width:"100%",height:"100%",maxWidth:"100vw",maxHeight:"100vh",borderRadius:0,border:"none"}:{left:x.x,top:x.y,width:C.width,height:C.height,maxWidth:"98vw",maxHeight:"98vh",minWidth:"800px",minHeight:"456px",resize:"both",overflow:"hidden"},onMouseDown:J=>{J.stopPropagation(),F()},onMouseUp:ue,children:[n.jsxs("div",{onPointerDown:ie,onPointerMove:ce,onPointerUp:pe,className:"bg-gray-700 text-white font-bold p-2 rounded-t-md flex justify-between items-center cursor-move flex-shrink-0",children:[n.jsxs("span",{children:[c("imageViewer.title")," - Frame ",V.frameNumber]}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(Ne,{title:"Copy Image",onClick:J=>{J.stopPropagation(),i(V.src)},children:n.jsx(Dt,{className:"h-5 w-5"})}),n.jsx(Ne,{title:"Download Image",onClick:J=>{J.stopPropagation(),a(V.src,V.frameNumber,V.prompt||""),l&&l(c("toast.downloadStarted"),"success")},children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),n.jsx("div",{className:"w-px h-4 bg-gray-500 mx-1"}),n.jsx("button",{onClick:G,className:"p-1 text-gray-400 rounded-full hover:bg-gray-600 hover:text-white transition-colors",title:p?"Restore":"Full Screen",children:p?n.jsx(Tp,{}):n.jsx(Pp,{})}),n.jsx("button",{onClick:J=>{J.stopPropagation(),r()},className:"p-1 text-gray-400 rounded-full hover:bg-gray-600 hover:text-white",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),n.jsxs("div",{ref:P,className:"p-1 flex-grow min-h-0 bg-gray-900 relative overflow-hidden flex items-center justify-center",onWheel:re,onMouseDown:te,children:[n.jsx("img",{src:V.src,alt:`Full-size view of frame ${V.frameNumber}`,className:"shrink-0",style:{width:L.width||"auto",height:L.height||"auto",maxWidth:"none",maxHeight:"none",transform:`translate(${O.x}px, ${O.y}px) scale(${D})`,cursor:Z?A?"grabbing":"grab":"default",pointerEvents:"auto",transformOrigin:"center"},draggable:!1,onMouseDown:J=>J.preventDefault()}),n.jsxs("div",{className:"absolute bottom-12 left-1/2 -translate-x-1/2 bg-gray-800/90 backdrop-blur-sm p-2 rounded-full flex items-center space-x-3 border border-gray-600 shadow-lg z-20",onMouseDown:J=>J.stopPropagation(),children:[n.jsx("button",{onClick:ee,className:"w-8 h-8 rounded-full bg-gray-700 hover:bg-gray-600 text-xs font-bold text-white flex items-center justify-center border border-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500",title:"Reset to 100% (Actual Size)",children:"1:1"}),n.jsx("input",{type:"range",min:"0.1",max:"5",step:"0.01",value:D,onChange:J=>q(parseFloat(J.target.value)),className:"w-32 h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-500"}),n.jsxs("span",{className:"text-xs font-mono text-gray-300 w-12 text-right",children:[Math.round(D*100),"%"]})]}),e.length>1&&n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:B,className:"absolute left-4 top-1/2 -translate-y-1/2 p-2 bg-black/40 rounded-full text-white opacity-0 group-hover:opacity-100 transition-opacity focus:outline-none focus:ring-2 focus:ring-cyan-500 z-10","aria-label":"Previous image",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),n.jsx("button",{onClick:Y,className:"absolute right-4 top-1/2 -translate-y-1/2 p-2 bg-black/40 rounded-full text-white opacity-0 group-hover:opacity-100 transition-opacity focus:outline-none focus:ring-2 focus:ring-cyan-500 z-10","aria-label":"Next image",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]})]}),n.jsxs("div",{className:"bg-gray-800 text-gray-400 text-xs px-3 py-1 border-t border-gray-700 flex justify-between items-center rounded-b-lg select-none",children:[n.jsx("div",{children:L.width>0&&n.jsxs("span",{children:[L.width," x ",L.height," px"]})}),s&&n.jsx("button",{onClick:J=>{J.stopPropagation(),s(V.src)},className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors font-semibold",children:c("node.action.editor")}),n.jsx("div",{children:L.size&&n.jsx("span",{children:L.size})})]})]}):(r(),null)},uo=({mode:e,icon:t,label:o,isActive:r,onHover:a,className:i})=>n.jsxs("div",{"data-dock-mode":e,className:`relative flex items-center justify-center transition-all duration-200 cursor-pointer group ${i} ${r?"bg-accent/30 border-accent text-accent-text":"bg-gray-800/80 border-gray-600 text-gray-400 hover:bg-gray-700"}`,onMouseEnter:()=>a(e),onMouseLeave:()=>a(null),style:{pointerEvents:"auto"},children:[n.jsx("div",{className:"transform scale-90 group-hover:scale-100 transition-transform pointer-events-none",children:t}),n.jsx("div",{className:"absolute top-full mt-2 bg-gray-900 text-white text-[10px] px-2 py-1 rounded-md opacity-0 group-hover:opacity-100 whitespace-nowrap z-50 pointer-events-none border border-gray-700 transition-opacity duration-200 ease-in-out",children:o})]}),$I=({isVisible:e,hoveredMode:t})=>{const{setDockHoverMode:o,draggingInfo:r,nodes:a}=Ut()||{},{t:i}=vt();if(!e||!o)return null;let s=!1;if((r==null?void 0:r.type)==="node"){const c=a==null?void 0:a.find(d=>d.id===r.id);c&&(s=Bl(c.type))}const l=c=>{o(c)};return n.jsx("div",{className:"fixed top-6 left-1/2 -translate-x-1/2 z-[200] animate-fade-in-down pointer-events-none select-none",children:n.jsxs("div",{className:"bg-gray-900/90 backdrop-blur-xl p-1.5 rounded-lg border border-gray-600 shadow-2xl flex items-center gap-1 pointer-events-auto",children:[!s&&n.jsx(uo,{mode:"q1",label:i("toolbar.dock.q1"),isActive:t==="q1",onHover:l,className:"h-16 w-8 rounded border-2",icon:n.jsxs("svg",{width:"12",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M2 4h5v16H2z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})}),!s&&n.jsx(uo,{mode:"q2",label:i("toolbar.dock.q2"),isActive:t==="q2",onHover:l,className:"h-16 w-8 rounded border-2",icon:n.jsxs("svg",{width:"12",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M7 4h5v16H7z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})}),!s&&n.jsxs("div",{className:"flex flex-col gap-1 h-16 w-12",children:[n.jsx(uo,{mode:"tl",label:i("toolbar.dock.tl"),isActive:t==="tl",onHover:l,className:"flex-1 rounded-t border-2",icon:n.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"currentColor",children:[n.jsx("path",{d:"M2 2h6v6H2z",opacity:"0.9"}),n.jsx("path",{d:"M2 2h12v12H2z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.5"})]})}),n.jsx(uo,{mode:"bl",label:i("toolbar.dock.bl"),isActive:t==="bl",onHover:l,className:"flex-1 rounded-b border-2",icon:n.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"currentColor",children:[n.jsx("path",{d:"M2 8h6v6H2z",opacity:"0.9"}),n.jsx("path",{d:"M2 2h12v12H2z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.5"})]})})]}),n.jsx(uo,{mode:"left",label:i("toolbar.dock.left"),isActive:t==="left",onHover:l,className:"h-16 w-12 rounded border-2",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M4 4h8v16H4z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})}),n.jsx(uo,{mode:"full",label:i("toolbar.dock.full"),isActive:t==="full",onHover:l,className:"h-16 w-16 rounded-lg border-2 bg-gray-800",icon:n.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"1",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})}),n.jsx(uo,{mode:"right",label:i("toolbar.dock.right"),isActive:t==="right",onHover:l,className:"h-16 w-12 rounded border-2",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M12 4h8v16h-8z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})}),!s&&n.jsxs("div",{className:"flex flex-col gap-1 h-16 w-12",children:[n.jsx(uo,{mode:"tr",label:i("toolbar.dock.tr"),isActive:t==="tr",onHover:l,className:"flex-1 rounded-t border-2",icon:n.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"currentColor",children:[n.jsx("path",{d:"M8 2h6v6H8z",opacity:"0.9"}),n.jsx("path",{d:"M2 2h12v12H2z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.5"})]})}),n.jsx(uo,{mode:"br",label:i("toolbar.dock.br"),isActive:t==="br",onHover:l,className:"flex-1 rounded-b border-2",icon:n.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"currentColor",children:[n.jsx("path",{d:"M8 8h6v6H8z",opacity:"0.9"}),n.jsx("path",{d:"M2 2h12v12H2z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.5"})]})})]}),!s&&n.jsx(uo,{mode:"q3",label:i("toolbar.dock.q3"),isActive:t==="q3",onHover:l,className:"h-16 w-8 rounded border-2",icon:n.jsxs("svg",{width:"12",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M12 4h5v16h-5z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})}),!s&&n.jsx(uo,{mode:"q4",label:i("toolbar.dock.q4"),isActive:t==="q4",onHover:l,className:"h-16 w-8 rounded border-2",icon:n.jsxs("svg",{width:"12",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M17 4h5v16h-5z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",stroke:"currentColor",fill:"none",strokeWidth:"2",opacity:"0.5"})]})})]})})},na=({mode:e,isActive:t,icon:o,className:r})=>{const a=r?r.replace("border-b",""):"";return n.jsx("div",{"data-dock-mode":e,className:`
                w-12 h-16 flex items-center justify-center 
                transition-all duration-200 cursor-pointer flex-shrink-0
                ${t?`bg-gray-800 border-2 border-accent text-accent shadow-[0_0_15px_var(--color-accent)] z-20 scale-110 ${a}`:`bg-gray-900/95 text-gray-500 hover:bg-gray-800 hover:text-gray-300 border-gray-600 ${r||""}`}
            `,children:n.jsx("div",{className:"pointer-events-none",children:o})})},KI=()=>{const e=Ut();if(!e)return null;const{draggingInfo:t,dockHoverMode:o,nodes:r}=e,a=(t==null?void 0:t.type)==="node",i=o;let s=!1;if(a&&t){const d=r.find(u=>u.id===t.id);d&&(s=Bl(d.type))}const l=i==="tl"||i==="q1"||i==="bl",c=i==="tr"||i==="q4"||i==="br";return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed top-0 left-0 bottom-0 z-[190] flex flex-col justify-center pointer-events-none",children:n.jsxs("div",{className:`
                        absolute left-0 flex flex-col shadow-2xl rounded-r-xl overflow-hidden border-y border-r border-gray-600
                        transition-transform duration-300 ease-[cubic-bezier(0.2,0.8,0.2,1)] origin-left pointer-events-auto
                        ${l?"translate-x-0":"-translate-x-full"}
                    `,children:[!s&&n.jsx(na,{mode:"tl",isActive:i==="tl",className:"border-b",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M4 4h8v10H4z",opacity:"0.9"}),n.jsx("path",{d:"M4 4h16v16H4z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.3"})]})}),!s&&n.jsx(na,{mode:"q1",isActive:i==="q1",className:"border-b h-20",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M4 3h6v18H4z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",fill:"none",stroke:"currentColor",strokeWidth:"2",opacity:"0.3"})]})}),!s&&n.jsx(na,{mode:"bl",isActive:i==="bl",className:"",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M4 10h8v10H4z",opacity:"0.9"}),n.jsx("path",{d:"M4 4h16v16H4z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.3"})]})})]})}),n.jsx("div",{className:"fixed top-0 right-0 bottom-0 z-[190] flex flex-col justify-center pointer-events-none",children:n.jsxs("div",{className:`
                        absolute right-0 flex flex-col shadow-2xl rounded-l-xl overflow-hidden border-y border-l border-gray-600
                        transition-transform duration-300 ease-[cubic-bezier(0.2,0.8,0.2,1)] origin-right pointer-events-auto
                        ${c?"translate-x-0":"translate-x-full"}
                    `,children:[!s&&n.jsx(na,{mode:"tr",isActive:i==="tr",className:"border-b",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M12 4h8v10h-8z",opacity:"0.9"}),n.jsx("path",{d:"M4 4h16v16H4z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.3"})]})}),!s&&n.jsx(na,{mode:"q4",isActive:i==="q4",className:"border-b h-20",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M14 3h6v18h-6z",opacity:"0.9"}),n.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",fill:"none",stroke:"currentColor",strokeWidth:"2",opacity:"0.3"})]})}),!s&&n.jsx(na,{mode:"br",isActive:i==="br",className:"",icon:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:[n.jsx("path",{d:"M12 10h8v10h-8z",opacity:"0.9"}),n.jsx("path",{d:"M4 4h16v16H4z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",opacity:"0.3"})]})})]})})]})},JI=e=>{if(isNaN(e))return"0:00";const t=Math.floor(e/60),o=Math.floor(e%60);return`${t}:${o.toString().padStart(2,"0")}`},YI=()=>{const e=Ut(),[t,o]=y.useState(!1);if(!e||!e.globalMedia)return null;const{globalMedia:r,setGlobalMedia:a,selectNode:i}=e,{name:s,isPlaying:l,currentTime:c,duration:d,nodeId:u}=r,p=f=>{f.stopPropagation(),a(g=>{if(!g)return null;const v=!g.isPlaying;return{...g,isPlaying:v,command:v?"play":"pause",commandTimestamp:Date.now()}})},h=f=>{const g=parseFloat(f.target.value);a(v=>v?{...v,currentTime:g,command:void 0}:null)},x=f=>{const g=parseFloat(f.currentTarget.value);a(v=>v?{...v,command:"seek",seekTarget:g,currentTime:g,commandTimestamp:Date.now()}:null)},k=f=>{f.stopPropagation(),a(g=>g?{...g,command:"pause",commandTimestamp:Date.now()}:null),setTimeout(()=>a(null),100)},C=()=>{i(u)},w=f=>{f.stopPropagation(),o(!t)};return t?n.jsx("div",{className:"fixed bottom-4 right-4 z-50 animate-fade-in-up",children:n.jsxs("div",{className:"bg-gray-900/90 backdrop-blur-md border border-gray-700 rounded-lg shadow-2xl p-2 flex flex-col items-center space-y-2 cursor-pointer hover:bg-gray-800/90 transition-colors",onClick:C,title:s,children:[n.jsx("button",{onClick:w,className:"p-1 text-gray-400 hover:text-white hover:bg-gray-700 rounded transition-colors",title:"Expand",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),n.jsx("div",{className:"w-8 h-8 rounded bg-gray-800 flex items-center justify-center border border-gray-600 flex-shrink-0",children:r.type==="audio"?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z",clipRule:"evenodd"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-purple-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"})})}),n.jsx("button",{onClick:p,className:"text-cyan-400 hover:text-white transition-colors focus:outline-none p-1",children:l?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),n.jsx("button",{onClick:k,className:"text-gray-500 hover:text-red-400 p-1.5 hover:bg-gray-700 rounded-full transition-colors",title:"Close",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}):n.jsx("div",{className:"fixed bottom-4 right-4 z-50 animate-fade-in-up",children:n.jsxs("div",{className:"bg-gray-900/90 backdrop-blur-md border border-gray-700 rounded-lg shadow-2xl p-2 flex items-center space-x-3 w-[330px] cursor-pointer hover:bg-gray-800/90 transition-colors",onClick:C,children:[n.jsx("button",{onClick:w,className:"p-1 text-gray-500 hover:text-white hover:bg-gray-700 rounded transition-colors flex-shrink-0",title:"Collapse",onMouseDown:f=>f.stopPropagation(),children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})}),n.jsx("div",{className:"w-8 h-8 rounded bg-gray-800 flex items-center justify-center border border-gray-600 flex-shrink-0",children:r.type==="audio"?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z",clipRule:"evenodd"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-purple-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{d:"M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"})})}),n.jsxs("div",{className:"flex-grow min-w-0 flex flex-col justify-center",children:[n.jsxs("div",{className:"flex justify-between items-center mb-1",children:[n.jsx("span",{className:"text-xs font-bold text-gray-200 truncate pr-2",title:s,children:s}),n.jsx("button",{onClick:k,className:"text-gray-500 hover:text-white p-0.5 rounded",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:p,className:"text-cyan-400 hover:text-white transition-colors focus:outline-none",children:l?n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),n.jsx("input",{type:"range",min:"0",max:d||100,value:c,onChange:h,onMouseUp:x,onTouchEnd:x,onClick:f=>f.stopPropagation(),onMouseDown:f=>f.stopPropagation(),className:"w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-500"}),n.jsx("span",{className:"text-[9px] font-mono text-gray-400 whitespace-nowrap min-w-[24px]",children:JI(c)})]})]})]})})},XI=({children:e})=>{const[t,o]=y.useState("ru"),[r,a]=y.useState("en");y.useEffect(()=>{const s=localStorage.getItem("settings_secondaryLanguage");s&&["ru","es"].includes(s)&&o(s)},[]),y.useEffect(()=>{localStorage.setItem("settings_secondaryLanguage",t)},[t]);const i=y.useCallback((s,l)=>qo(r,s,l),[r]);return n.jsx(Px.Provider,{value:{language:r,setLanguage:a,secondaryLanguage:t,setSecondaryLanguage:o,t:i},children:e})},ZI=()=>{const e=Ut(),[t,o]=y.useState(!1),r=y.useRef(!1);if(y.useEffect(()=>{e&&(r.current=e.nodes.length>0||e.tabs.length>1)},[e]),y.useEffect(()=>{const E=A=>{/Electron/i.test(navigator.userAgent)||r.current&&(A.preventDefault(),A.returnValue="")};return window.addEventListener("beforeunload",E),()=>window.removeEventListener("beforeunload",E)},[]),y.useEffect(()=>{const E=setTimeout(()=>{o(!0)},150);return()=>clearTimeout(E)},[]),!e)return null;const{fileInputRef:a,handleFileChange:i,catalogFileInputRef:s,handleCatalogFileChange:l,libraryFileInputRef:c,handleLibraryFileChange:d,imageSequenceFileInputRef:u,handleImageSequenceFileChange:p,promptSequenceEditorFileInputRef:h,handlePromptSequenceFileChange:x,characterCardFileInputRef:k,handleCharacterCardFileChange:C,scriptFileInputRef:w,handleScriptFileChange:f,toasts:g,addToast:v,imageViewer:_,setImageViewer:S,onDownloadImageFromUrl:T,onCopyImageToClipboard:P,isDockingMenuVisible:R,dockHoverMode:D,clientPointerPositionRef:q,t:O}=e;return n.jsxs("div",{className:"relative w-screen h-screen flex flex-col overflow-hidden bg-canvas",style:{backgroundImage:"radial-gradient(hsla(215, 14%, 34%, 0.5) 1px, transparent 1px)",backgroundSize:"20px 20px"},children:[n.jsx("div",{className:`absolute inset-0 transition-opacity duration-700 ease-in-out ${t?"opacity-100":"opacity-0"}`,children:t&&n.jsx(dI,{})}),n.jsx(xI,{}),n.jsx(UI,{}),n.jsx(YI,{}),n.jsxs("div",{className:"absolute bottom-2 right-4 pointer-events-none z-[5] text-xs text-white/10 hover:text-white/50 transition-colors duration-300 flex flex-col items-end leading-tight select-none font-mono",children:[n.jsxs("span",{className:"font-bold",children:[O("help.author"),": MeowMaster"]}),n.jsx("span",{children:"MeowMasterArt@gmail.com"}),n.jsx("a",{href:"https://www.netlify.com",target:"_blank",rel:"noopener noreferrer",className:"pointer-events-auto hover:text-cyan-400 transition-colors mt-1",children:"Powered by Netlify"})]}),n.jsx($I,{isVisible:R,hoveredMode:D,mousePosition:q.current}),n.jsx(KI,{}),n.jsx(BI,{}),_&&n.jsx(WI,{sources:_.sources,initialIndex:_.initialIndex,initialPosition:{x:window.innerWidth/2-512,y:window.innerHeight/2-400},onClose:()=>S(null),onDownloadImageFromUrl:T,onCopyImageToClipboard:P,addToast:v}),n.jsx("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-[101] flex flex-col items-center space-y-2 pointer-events-none",children:g.map(E=>{let A="backdrop-blur font-bold px-6 py-3 rounded-xl shadow-2xl animate-fade-in-out text-sm flex items-center justify-center text-center border pointer-events-auto";return E.type==="success"?A+=" bg-accent/95 text-white border-white/20 shadow-accent/20":E.type==="error"?A+=" bg-red-600/95 text-white border-red-400/30 shadow-red-900/30":A+=" bg-gray-800/95 text-gray-200 border-gray-600/50 shadow-black/30",n.jsx("div",{className:A,children:E.message},E.id)})}),n.jsx("input",{type:"file",ref:a,className:"hidden",accept:".json",onChange:i}),n.jsx("input",{type:"file",ref:s,className:"hidden",accept:".json",onChange:l}),n.jsx("input",{type:"file",ref:c,className:"hidden",accept:".json,.txt",onChange:d}),n.jsx("input",{type:"file",ref:u,className:"hidden",accept:".json",onChange:p}),n.jsx("input",{type:"file",ref:h,className:"hidden",accept:".json",onChange:x}),n.jsx("input",{type:"file",ref:k,className:"hidden",accept:".json",onChange:C}),n.jsx("input",{type:"file",ref:w,className:"hidden",accept:".json",onChange:f})]})},QI=()=>n.jsx(XI,{children:n.jsx(C3,{children:n.jsx(ZI,{})})}),ey=document.getElementById("root");if(!ey)throw new Error("Could not find root element to mount to");const ej=nd.createRoot(ey);ej.render(n.jsx(Et.StrictMode,{children:n.jsx(QI,{})}));
